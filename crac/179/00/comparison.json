{"files":[{"patch":"@@ -57,2 +57,2 @@\n- * @run driver\/timeout=120 jdk.test.lib.crac.CracTest  false  true   5000000 true   -1     4194200\n- * @run driver\/timeout=120 jdk.test.lib.crac.CracTest  false  true   4194303 true   -1\n+ * @run driver\/timeout=120 jdk.test.lib.crac.CracTest  false  true   5000000 true   -1     MAX-100\n+ * @run driver\/timeout=120 jdk.test.lib.crac.CracTest  false  true   MAX-1   true   -1\n@@ -81,0 +81,1 @@\n+    final private String MAX_PID_PREFIX = \"MAX\";\n@@ -94,1 +95,1 @@\n-                builder.vmOption(\"-XX:CRaCMinPid=\" + lastPid);\n+                builder.vmOption(\"-XX:CRaCMinPid=\" + createLastPidValue(lastPid));\n@@ -103,0 +104,2 @@\n+                String setupLastPidCmd = \"export LAST_PID=\" + createLastPidValue(lastPidSetup)\n+                        + \" && echo ${LAST_PID} >\/proc\/sys\/kernel\/ns_last_pid\";\n@@ -104,1 +107,1 @@\n-                    .containerSetup(Arrays.asList(\"bash\", \"-c\", \"useradd the_user && echo \" + lastPidSetup + \" >\/proc\/sys\/kernel\/ns_last_pid\"))\n+                    .containerSetup(Arrays.asList(\"bash\", \"-x\", \"-c\", \"useradd the_user && cat \/proc\/sys\/kernel\/pid_max && \" + setupLastPidCmd))\n@@ -126,0 +129,8 @@\n+    private String createLastPidValue(String expr) {\n+        if (expr.startsWith(MAX_PID_PREFIX)){\n+            expr = expr.substring(MAX_PID_PREFIX.length());\n+            expr = \"$(($(cat \/proc\/sys\/kernel\/pid_max)\" + expr + \"))\";\n+        }\n+        return expr;\n+    }\n+\n","filename":"test\/jdk\/jdk\/crac\/ContainerPidAdjustmentTest.java","additions":15,"deletions":4,"binary":false,"changes":19,"status":"modified"}]}