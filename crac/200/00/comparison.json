{"files":[{"patch":"@@ -933,0 +933,1 @@\n+#define REEXEC_NAME \"HOTSPOT_GLIBC_TUNABLES_REEXEC\"\n@@ -935,1 +936,1 @@\n-  if (env && strcmp(env, env_val) == 0) {\n+  if (env && (strcmp(env, env_val) == 0 || (!INCLUDE_CPU_FEATURE_ACTIVE && getenv(REEXEC_NAME)))) {\n@@ -971,1 +972,0 @@\n-#define REEXEC_NAME \"HOTSPOT_GLIBC_TUNABLES_REEXEC\"\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,16 @@\n+#! \/bin\/bash\n+# @test\n+# @requires os.family == \"linux\"\n+# @requires os.arch==\"amd64\" | os.arch==\"x86_64\"\n+# @run shell SimpleCPUFeatures.sh\n+# @summary On old glibc (without INCLUDE_CPU_FEATURE_ACTIVE) one could get an internal error.\n+# Error occurred during initialization of VM\n+# internal error: GLIBC_TUNABLES=:glibc.cpu.hwcaps=,-AVX,-FMA,-AVX2,-BMI1,-BMI2,-ERMS,-LZCNT,-SSSE3,-POPCNT,-SSE4_1,-SSE4_2,-AVX512F,-AVX512CD,-AVX512BW,-AVX512DQ,-AVX512VL,-IBT,-MOVBE,-SHSTK,-XSAVE,-OSXSAVE,-HTT failed and HOTSPOT_GLIBC_TUNABLES_REEXEC is set\n+\n+set -ex\n+\n+export JAVA_HOME=$TESTJAVA\n+export GLIBC_TUNABLES=glibc.pthread.rseq=0\n+$JAVA_HOME\/bin\/java -XX:CPUFeatures=generic -XX:+ShowCPUFeatures -version 2>&1 | tee \/proc\/self\/fd\/2 | grep -q 'openjdk version'\n+\n+exit 0\n","filename":"test\/jdk\/jdk\/crac\/CPUFeatures\/SimpleCPUFeatures.sh","additions":16,"deletions":0,"binary":false,"changes":16,"status":"added"}]}