{"files":[{"patch":"@@ -67,12 +67,0 @@\n-        long start = System.nanoTime();\n-        while (!perfdata.toFile().exists()) {\n-            if (System.nanoTime() - start > TimeUnit.SECONDS.toNanos(10)) {\n-                if (perfDisableSharedMem) {\n-                    break;\n-                } else {\n-                    throw new IllegalStateException(\"Perf data file did not appear within time limit in the checkpointed process: \" + perfdata);\n-                }\n-            }\n-            \/\/noinspection BusyWait\n-            Thread.sleep(perfDisableSharedMem == true ? Duration.ofSeconds(10) : Duration.ofMillis(10));\n-        }\n@@ -80,3 +68,2 @@\n-            if (perfdata.toFile().exists()) {\n-                throw new IllegalStateException(\"Perf data file exists altough we run with -XX:+PerfDisableSharedMem\");\n-            }\n+            Thread.sleep(100);\n+            assertFalse(perfdata.toFile().exists(), \"Perf data file exists although we run with -XX:+PerfDisableSharedMem\");\n@@ -84,0 +71,1 @@\n+            waitForFile(perfdata);\n@@ -94,12 +82,0 @@\n-        start = System.nanoTime();\n-        while (!perfdata.toFile().exists()) {\n-            if (System.nanoTime() - start > TimeUnit.SECONDS.toNanos(10)) {\n-                if (perfDisableSharedMem) {\n-                    break;\n-                } else {\n-                    throw new IllegalStateException(\"Perf data file did not appear within time limit in the restored process: \" + perfdata);\n-                }\n-            }\n-            \/\/noinspection BusyWait\n-            Thread.sleep(perfDisableSharedMem == true ? Duration.ofSeconds(10) : Duration.ofMillis(10));\n-        }\n@@ -110,3 +86,2 @@\n-            if (perfdata.toFile().exists()) {\n-                throw new IllegalStateException(\"Perf data file exists altough we run with -XX:+PerfDisableSharedMem\");\n-            }\n+            Thread.sleep(100);\n+            assertFalse(perfdata.toFile().exists(), \"Perf data file exists although we run with -XX:+PerfDisableSharedMem\");\n@@ -114,0 +89,1 @@\n+            waitForFile(perfdata);\n@@ -127,0 +103,11 @@\n+    private static void waitForFile(Path perfdata) throws InterruptedException {\n+        long start = System.nanoTime();\n+        while (!perfdata.toFile().exists()) {\n+            if (System.nanoTime() - start > TimeUnit.SECONDS.toNanos(10)) {\n+                throw new IllegalStateException(\"Perf data file did not appear within time limit in the checkpointed process: \" + perfdata);\n+            }\n+            \/\/noinspection BusyWait\n+            Thread.sleep(10);\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/crac\/PerfMemoryRestoreTest.java","additions":17,"deletions":30,"binary":false,"changes":47,"status":"modified"}]}