{"files":[{"patch":"@@ -118,2 +118,12 @@\n-  if (!_engine->cpufeatures_store()) {\n-    return JVM_CHECKPOINT_ERROR;\n+  switch (_engine->prepare_user_data_api()) {\n+    case CracEngine::ApiStatus::OK:\n+      if (!_engine->cpufeatures_store()) {\n+\treturn JVM_CHECKPOINT_ERROR;\n+      }\n+      break;\n+    case CracEngine::ApiStatus::ERR:\n+      return JVM_CHECKPOINT_ERROR;\n+    case CracEngine::ApiStatus::UNSUPPORTED:\n+      log_warning(crac)(\"Cannot store CPUFeatures for checkpoint \"\n+\t\"with the selected CRaC engine\");\n+      break;\n@@ -510,2 +520,14 @@\n-  if (!VM_Version::ignore_cpu_features() && !engine.cpufeatures_check()) {\n-    return;\n+  if (!VM_Version::ignore_cpu_features()) {\n+    switch (engine.prepare_user_data_api()) {\n+      case CracEngine::ApiStatus::OK:\n+\tif (!engine.cpufeatures_check()) {\n+\t  return;\n+\t}\n+\tbreak;\n+      case CracEngine::ApiStatus::ERR:\n+\treturn;\n+      case CracEngine::ApiStatus::UNSUPPORTED:\n+\tlog_warning(crac)(\"Cannot verify CPUFeatures for restore \"\n+\t  \"with the selected CRaC engine\");\n+\tbreak;\n+    }\n","filename":"src\/hotspot\/share\/runtime\/crac.cpp","additions":26,"deletions":4,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -437,1 +437,1 @@\n-bool CracEngine::cpufeatures_store() {\n+bool CracEngine::cpufeatures_store() const {\n@@ -443,10 +443,0 @@\n-  switch (prepare_user_data_api()) {\n-    case CracEngine::ApiStatus::OK:\n-      break;\n-    case CracEngine::ApiStatus::ERR:\n-      return false;\n-    case CracEngine::ApiStatus::UNSUPPORTED:\n-      log_warning(crac)(\"Cannot store CPUFeatures for checkpoint \"\n-        \"with the selected CRaC engine\");\n-      return false;\n-  }\n@@ -457,1 +447,1 @@\n-bool CracEngine::cpufeatures_check() {\n+bool CracEngine::cpufeatures_check() const {\n@@ -463,10 +453,0 @@\n-  switch (prepare_user_data_api()) {\n-    case CracEngine::ApiStatus::OK:\n-      break;\n-    case CracEngine::ApiStatus::ERR:\n-      return false;\n-    case CracEngine::ApiStatus::UNSUPPORTED:\n-      log_warning(crac)(\"Cannot verify CPUFeatures for restore \"\n-        \"with the selected CRaC engine\");\n-      return false;\n-  }\n","filename":"src\/hotspot\/share\/runtime\/crac_engine.cpp","additions":2,"deletions":22,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -69,4 +69,0 @@\n-  bool cpufeatures_store();\n-  bool cpufeatures_check();\n-\n-private:\n@@ -74,0 +70,2 @@\n+  bool cpufeatures_store() const;\n+  bool cpufeatures_check() const;\n@@ -75,0 +73,1 @@\n+private:\n","filename":"src\/hotspot\/share\/runtime\/crac_engine.hpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"}]}