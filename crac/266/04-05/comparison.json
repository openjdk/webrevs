{"files":[{"patch":"@@ -73,6 +73,1 @@\n-  _tags.add({\n-    .type = LABEL,\n-    .name = name_copy,\n-    .data = value_copy,\n-    .data_length = value_length,\n-  });\n+  _tags.add({ LABEL, name_copy, value_copy, value_length });\n@@ -103,6 +98,1 @@\n-  _tags.add({\n-    .type = BITMAP,\n-    .name = name_copy,\n-    .data = (const unsigned char *) bitmap_copy,\n-    .data_length = length_bytes,\n-  });\n+  _tags.add({ BITMAP, name_copy, (const unsigned char *) bitmap_copy, length_bytes });\n@@ -215,6 +205,9 @@\n-      tags.add({\n-        .type = LABEL,\n-        .name = strdup(line + strlen(LABEL_PREFIX)),\n-        .data = strdup(eq + 1),\n-        .data_length = (size_t) (nl - eq),\n-      });\n+      char *name = strdup(line + strlen(LABEL_PREFIX));\n+      char *value = strdup(eq + 1);\n+      if (name == nullptr || value == nullptr) {\n+        fprintf(stderr, CREXEC, \"Cannot allocate memory for validation\\n\");\n+        free(name);\n+        free(value);\n+        return RESTORE_ERROR_MEMORY;\n+      }\n+      tags.add({ LABEL, name, value, (size_t) (nl - eq) });\n@@ -228,0 +221,4 @@\n+      if (data == nullptr) {\n+        fprintf(stderr, CREXEC \"Cannot allocate memory for validation\\n\");\n+        return RESTORE_ERROR_MEMORY;\n+      }\n@@ -236,6 +233,7 @@\n-      tags.add({\n-        .type = BITMAP,\n-        .name = strdup(line + strlen(BITMAP_PREFIX)),\n-        .data = data,\n-        .data_length = length,\n-      });\n+      char *name = strdup(line + strlen(BITMAP_PREFIX));\n+      if (name == nullptr) {\n+        fprintf(stderr, CREXEC \"Cannot allocate memory for validation\\n\");\n+        free(data);\n+        return RESTORE_ERROR_MEMORY;\n+      }\n+      tags.add({ BITMAP, name, data, length });\n","filename":"src\/java.base\/share\/native\/libcrexec\/image_constraints.cpp","additions":22,"deletions":24,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -110,7 +110,1 @@\n-    _constraints.add({\n-      .type = LABEL,\n-      .name = strdup(name),\n-      .data = strdup(value),\n-      .data_length = strlen(value) + 1,\n-      .comparison = EQUALS,\n-    });\n+    _constraints.add({ LABEL, strdup(name), strdup(value), strlen(value) + 1, EQUALS });\n@@ -122,7 +116,1 @@\n-    _constraints.add({\n-      .type = BITMAP,\n-      .name = strdup(name),\n-      .data = copy,\n-      .data_length = length_bytes,\n-      .comparison = comparison,\n-    });\n+    _constraints.add({ BITMAP, strdup(name), copy, length_bytes, comparison });\n","filename":"src\/java.base\/share\/native\/libcrexec\/image_constraints.hpp","additions":2,"deletions":14,"binary":false,"changes":16,"status":"modified"}]}