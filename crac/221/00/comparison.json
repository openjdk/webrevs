{"files":[{"patch":"@@ -62,2 +62,3 @@\n-jlong crac::checkpoint_millis;\n-jlong crac::checkpoint_nanos;\n+jlong crac::checkpoint_wallclock_seconds; \/\/ Wall clock time, full seconds\n+jlong crac::checkpoint_wallclock_nanos;   \/\/ Wall clock time, nanoseconds remainder [0, 999999999]\n+jlong crac::checkpoint_monotonic_nanos;   \/\/ Monotonic time\n@@ -633,2 +634,2 @@\n-  checkpoint_millis = os::javaTimeMillis();\n-  checkpoint_nanos = os::javaTimeNanos();\n+  os::javaTimeSystemUTC(checkpoint_wallclock_seconds, checkpoint_wallclock_nanos);\n+  checkpoint_monotonic_nanos = os::javaTimeNanos();\n@@ -649,2 +650,7 @@\n-    assert(checkpoint_millis >= 0, \"Restore without a checkpoint?\");\n-    long diff_millis = os::javaTimeMillis() - checkpoint_millis;\n+    jlong current_wallclock_seconds;\n+    jlong current_wallclock_nanos;\n+    os::javaTimeSystemUTC(current_wallclock_seconds, current_wallclock_nanos);\n+\n+    jlong diff_wallclock =\n+      (current_wallclock_seconds - checkpoint_wallclock_seconds) * NANOSECS_PER_SEC +\n+      current_wallclock_nanos - checkpoint_wallclock_nanos;\n@@ -652,2 +658,2 @@\n-    if (diff_millis < 0) {\n-      diff_millis = 0;\n+    if (diff_wallclock < 0) {\n+      diff_wallclock = 0;\n@@ -655,0 +661,1 @@\n+\n@@ -658,1 +665,1 @@\n-    javaTimeNanos_offset = checkpoint_nanos - os::javaTimeNanos() + diff_millis * 1000000L;\n+    javaTimeNanos_offset = checkpoint_monotonic_nanos - os::javaTimeNanos() + diff_wallclock;\n@@ -661,1 +668,1 @@\n-    jlong diff = os::javaTimeNanos() - checkpoint_nanos;\n+    jlong diff = os::javaTimeNanos() - checkpoint_monotonic_nanos;\n","filename":"src\/hotspot\/share\/runtime\/crac.cpp","additions":17,"deletions":10,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -61,2 +61,3 @@\n-  static jlong checkpoint_millis;\n-  static jlong checkpoint_nanos;\n+  static jlong checkpoint_wallclock_seconds;\n+  static jlong checkpoint_wallclock_nanos;\n+  static jlong checkpoint_monotonic_nanos;\n","filename":"src\/hotspot\/share\/runtime\/crac.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}