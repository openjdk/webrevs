{"files":[{"patch":"@@ -114,1 +114,1 @@\n-#          - build release\n+          - build release\n@@ -216,3 +216,3 @@\n-#          - jdk\/tier1 part 1\n-#          - jdk\/tier1 part 2\n-#          - jdk\/tier1 part 3\n+          - jdk\/tier1 part 1\n+          - jdk\/tier1 part 2\n+          - jdk\/tier1 part 3\n@@ -220,6 +220,6 @@\n-#          - langtools\/tier1\n-#          - hs\/tier1 common\n-#          - hs\/tier1 compiler\n-#          - hs\/tier1 gc\n-#          - hs\/tier1 runtime\n-#          - hs\/tier1 serviceability\n+          - langtools\/tier1\n+          - hs\/tier1 common\n+          - hs\/tier1 compiler\n+          - hs\/tier1 gc\n+          - hs\/tier1 runtime\n+          - hs\/tier1 serviceability\n@@ -227,6 +227,6 @@\n-#          - test: jdk\/tier1 part 1\n-#            suites: test\/jdk\/:tier1_part1\n-#          - test: jdk\/tier1 part 2\n-#            suites: test\/jdk\/:tier1_part2\n-#          - test: jdk\/tier1 part 3\n-#            suites: test\/jdk\/:tier1_part3\n+          - test: jdk\/tier1 part 1\n+            suites: test\/jdk\/:tier1_part1\n+          - test: jdk\/tier1 part 2\n+            suites: test\/jdk\/:tier1_part2\n+          - test: jdk\/tier1 part 3\n+            suites: test\/jdk\/:tier1_part3\n@@ -235,17 +235,18 @@\n-#          - test: langtools\/tier1\n-#            suites: test\/langtools\/:tier1\n-#          - test: hs\/tier1 common\n-#            suites: test\/hotspot\/jtreg\/:tier1_common\n-#            artifact: -debug\n-#          - test: hs\/tier1 compiler\n-#            suites: test\/hotspot\/jtreg\/:tier1_compiler\n-#            artifact: -debug\n-#          - test: hs\/tier1 gc  \n-#            suites: test\/hotspot\/jtreg\/:tier1_gc\n-#            artifact: -debug\n-#          - test: hs\/tier1 runtime\n-#            suites: test\/hotspot\/jtreg\/:tier1_runtime\n-#            artifact: -debug\n-#          - test: hs\/tier1 serviceability\n-#            suites: test\/hotspot\/jtreg\/:tier1_serviceability\n-#            artifact: -debug\n+            artifact: -debug\n+          - test: langtools\/tier1\n+            suites: test\/langtools\/:tier1\n+          - test: hs\/tier1 common\n+            suites: test\/hotspot\/jtreg\/:tier1_common\n+            artifact: -debug\n+          - test: hs\/tier1 compiler\n+            suites: test\/hotspot\/jtreg\/:tier1_compiler\n+            artifact: -debug\n+          - test: hs\/tier1 gc\n+            suites: test\/hotspot\/jtreg\/:tier1_gc\n+            artifact: -debug\n+          - test: hs\/tier1 runtime\n+            suites: test\/hotspot\/jtreg\/:tier1_runtime\n+            artifact: -debug\n+          - test: hs\/tier1 serviceability\n+            suites: test\/hotspot\/jtreg\/:tier1_serviceability\n+            artifact: -debug\n@@ -259,0 +260,3 @@\n+      CRIU_FILENAME: \"${{ fromJson(needs.prerequisites.outputs.dependencies).LINUX_X64_CRIU_FILENAME }}\"\n+      CRIU_URL: \"${{ fromJson(needs.prerequisites.outputs.dependencies).LINUX_X64_CRIU_URL }}\"\n+      CRIU_SHA256: \"${{ fromJson(needs.prerequisites.outputs.dependencies).LINUX_X64_CRIU_SHA256 }}\"\n@@ -280,0 +284,17 @@\n+      - name: Restore CRIU from cache\n+        id: criu\n+        uses: actions\/cache@v3\n+        with:\n+          path: ~\/criu\/criu\n+          key: criu-${{ runner.os }}-${{ env.CRIU_SHA256 }}\n+\n+      - name: Download CRIU\n+        run: |\n+          mkdir -p \"${HOME}\/criu\"\n+          wget -O \"${HOME}\/criu\/${CRIU_FILENAME}\" \"${CRIU_URL}\"\n+          echo \"${CRIU_SHA256} ${HOME}\/criu\/${CRIU_FILENAME}\" | sha256sum -c >\/dev\/null -\n+          tar -xf \"${HOME}\/criu\/${CRIU_FILENAME}\" -C \"${HOME}\/criu\"\n+          criu=`find $HOME\/criu -type f -name criu`\n+          mv ${criu} ${HOME}\/criu\/criu\n+        if: steps.criu.outputs.cache-hit != 'true'\n+\n@@ -325,0 +346,8 @@\n+      - name: Install CRIU into libraries\n+        run: |\n+          criuengine=`find ${HOME}\/jdk-linux-x64${{ matrix.artifact }}\/jdk-${{ env.JDK_VERSION }}-internal+0_linux-x64_bin${{ matrix.artifact }} -name criuengine -type f`\n+          criu=`dirname ${criuengine}`\/criu\n+          cp \"${HOME}\/criu\/criu\" ${criu}\n+          sudo chown root:root ${criu}\n+          sudo chmod u+s ${criu}\n+\n","filename":".github\/workflows\/submit.yml","additions":62,"deletions":33,"binary":false,"changes":95,"status":"modified"},{"patch":"@@ -37,0 +37,4 @@\n+LINUX_X64_CRIU_FILENAME=criu-crac-release-1.3.tar.gz\n+LINUX_X64_CRIU_URL=https:\/\/github.com\/CRaC\/criu\/releases\/download\/release-1.3\/criu-crac-release-1.3.tar.gz\n+LINUX_X64_CRIU_SHA256=82a014bf342c957305b98a71867c0994ebf6e7379f01f083121884793768d966\n+\n","filename":"make\/conf\/test-dependencies","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1,15 +0,0 @@\n-#!\/bin\/bash\n-## @test\n-## @run shell CriuVersionTest.sh\n-\n-exec 2>&1\n-set -x\n-export\n-whereis criu\n-criu --version\n-whoami\n-sudo -n whoami\n-find . -type f -iname criu \/home\/runner\/jdk-linux-x64\n-find . -type f -iname criu \/home\/runner\/work\/\n-\n-exit 1; # print output to log\n\\ No newline at end of file\n","filename":"test\/jdk\/jdk\/crac\/CriuVersionTest.sh","additions":0,"deletions":15,"binary":false,"changes":15,"status":"deleted"},{"patch":"@@ -73,0 +73,2 @@\n+            \/\/ Make sure we're starting with a clean image directory\n+            DockerTestUtils.execute(Container.ENGINE_COMMAND, \"volume\", \"rm\", \"cr\");\n@@ -99,0 +101,5 @@\n+        \/\/ At the same time docker --init is not sufficient; since `tini` does not wait for *all*\n+        \/\/ children to finish, just the main process, creating \/cr\/cppath might race and we would\n+        \/\/ not be able to restore the process.\n+        \/\/ This workaround should not be necessary when https:\/\/github.com\/openjdk\/crac\/pull\/46\n+        \/\/ is integrated.\n@@ -100,1 +107,1 @@\n-        javaCmd.addAll(Arrays.asList(\"\/jdk\/bin\/java\", \"-cp \/test-classes\/\", \"-XX:CRaCCheckpointTo=\/cr\"));\n+        javaCmd.addAll(Arrays.asList(\"\/jdk\/bin\/java\", \"-cp\", \"\/test-classes\/\", \"-XX:CRaCCheckpointTo=\/cr\"));\n@@ -103,1 +110,1 @@\n-        cmd.addAll(Arrays.asList(\"-c\", String.join(\" \", javaCmd) + \"; echo i-am-here-to-force-child-process\"));\n+        cmd.addAll(Arrays.asList(\"-c\", String.join(\" \", javaCmd) + \"; while [ ! -s \/cr\/cppath ]; do sleep 1; done;\"));\n","filename":"test\/jdk\/jdk\/crac\/java\/net\/InetAddress\/ResolveTest.java","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"}]}