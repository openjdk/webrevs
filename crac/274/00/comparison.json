{"files":[{"patch":"@@ -288,0 +288,3 @@\n+        \/\/ After restoring with CRaC the new process can appear 'younger'\n+        \/\/ than last value in counters - we will return -1 (unavailable).\n+        if (!failed && pticks->usedKernel >= tmp.usedKernel) {\n@@ -289,3 +292,0 @@\n-        if (!failed) {\n-\n-            assert(pticks->usedKernel >= tmp.usedKernel);\n","filename":"src\/jdk.management\/linux\/native\/libmanagement_ext\/UnixOperatingSystem.c","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,59 @@\n+\/*\n+ * Copyright (c) 2025, Azul Systems, Inc. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Azul Systems, 385 Moffett Park Drive, Suite 115, Sunnyvale\n+ * CA 94089 USA or visit www.azul.com if you need additional information or\n+ * have any questions.\n+ *\/\n+\n+import com.sun.management.OperatingSystemMXBean;\n+import jdk.crac.Core;\n+import jdk.test.lib.crac.*;\n+\n+import java.lang.management.ManagementFactory;\n+\n+import static jdk.test.lib.Asserts.*;\n+\n+\/*\n+ * @test\n+ * @requires (os.family == \"linux\")\n+ * @library \/test\/lib\n+ * @build OperatingSystemMxBeanTest\n+ * @run driver jdk.test.lib.crac.CracTest\n+ *\/\n+public class OperatingSystemMxBeanTest implements CracTest {\n+    @Override\n+    public void test() throws Exception {\n+        \/\/ The restore must be in a new process => cannot use simengine\n+        new CracBuilder().engine(CracEngine.CRIU).doCheckpointAndRestore();\n+    }\n+\n+    @Override\n+    public void exec() throws Exception {\n+        OperatingSystemMXBean bean = ManagementFactory.getPlatformMXBean(OperatingSystemMXBean.class);\n+        System.out.println(\"System CPU load:  \" + bean.getCpuLoad());\n+        System.out.println(\"Process CPU load: \" + bean.getProcessCpuLoad());\n+        Core.checkpointRestore();\n+        \/\/ We're restoring on the same system, so total CPU load should not have failed\n+        assertLTE(0.0, bean.getCpuLoad());\n+        \/\/ Per process ticks should be lower after restore than before checkpoint => load unavailable\n+        assertEquals(-1.0, bean.getProcessCpuLoad());\n+        \/\/ Second invocation should work with the updated value => correct\n+        assertLTE(0.0, bean.getProcessCpuLoad());\n+    }\n+}\n","filename":"test\/jdk\/jdk\/crac\/java\/lang\/management\/OperatingSystemMxBeanTest.java","additions":59,"deletions":0,"binary":false,"changes":59,"status":"added"}]}