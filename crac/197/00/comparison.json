{"files":[{"patch":"@@ -32,12 +32,0 @@\n-int CracSHM::open(int mode) {\n-  int shmfd = shm_open(_path, mode, 0600);\n-  if (-1 == shmfd) {\n-    perror(\"shm_open\");\n-  }\n-  return shmfd;\n-}\n-\n-void CracSHM::unlink() {\n-  shm_unlink(_path);\n-}\n-\n","filename":"src\/hotspot\/os\/posix\/crac_posix.cpp","additions":0,"deletions":12,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -46,7 +46,0 @@\n-int CracSHM::open(int mode) {\n-  return -1;\n-}\n-\n-void CracSHM::unlink() {\n-}\n-\n","filename":"src\/hotspot\/os\/windows\/crac_windows.cpp","additions":0,"deletions":7,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -272,0 +272,1 @@\n+    log_error(crac)(\"Cannot read restore parameters (JVM flags, env vars, system properties, arguments...)\");\n@@ -369,1 +370,1 @@\n-  if (shmid <= 0 || !VM_Crac::read_shm(shmid)) {\n+  if (shmid <= 0) {\n@@ -372,0 +373,3 @@\n+  } else if (!VM_Crac::read_shm(shmid)) {\n+    vm_direct_exit(1, \"Restore cannot continue, VM will exit.\");\n+    ShouldNotReachHere();\n@@ -548,2 +552,4 @@\n-  int shmfd = shm.open(O_RDWR | O_CREAT);\n-  if (0 <= shmfd) {\n+  int shmfd = shm.open(O_RDWR | O_CREAT | O_TRUNC);\n+  if (shmfd < 0) {\n+    log_error(crac)(\"Cannot pass parameters (JVM flags, env vars, system properties, arguments...) to the restored process.\");\n+  } else {\n","filename":"src\/hotspot\/share\/runtime\/crac.cpp","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -213,1 +213,1 @@\n-    int shmpathlen = snprintf(_path, sizeof(_path), \"\/crac_%d\", id);\n+    int shmpathlen = snprintf(_path, sizeof(_path), \"%s\/crac_%d\", os::get_temp_directory(), id);\n@@ -219,2 +219,13 @@\n-  int open(int mode);\n-  void unlink();\n+  int open(int flags) {\n+    int fd = os::open(_path, flags, 0600);\n+    if (-1 == fd) {\n+      log_error(crac)(\"Cannot %s shared object %s: %s\", flags & O_CREAT ? \"create\" : \"open\", _path, os::strerror(errno));\n+    }\n+    return fd;\n+  }\n+\n+  void unlink() {\n+    if (::remove(_path)) {\n+      log_error(crac)(\"Cannot remove shared object %s: %s\", _path, os::strerror(errno));\n+    }\n+  }\n","filename":"src\/hotspot\/share\/runtime\/crac_structs.hpp","additions":14,"deletions":3,"binary":false,"changes":17,"status":"modified"}]}