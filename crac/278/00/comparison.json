{"files":[{"patch":"@@ -65,1 +65,2 @@\n-  bool (*is_failed)(crlib_conf_t *, const char *name);\n+  \/\/ For failed require_bitmap it will copy the expected value to the provided buffer.\n+  bool (*is_failed)(crlib_conf_t *, const char *name, unsigned char *value_return);\n","filename":"src\/hotspot\/share\/include\/crlib\/crlib_image_constraints.h","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -467,1 +467,1 @@\n-  if (_image_constraints_api->is_failed(_conf, cpuarch_name)) {\n+  if (_image_constraints_api->is_failed(_conf, cpuarch_name, nullptr)) {\n@@ -470,1 +470,2 @@\n-  if (_image_constraints_api->is_failed(_conf, cpufeatures_name)) {\n+  VM_Version::VM_Features conjunction;\n+  if (_image_constraints_api->is_failed(_conf, cpufeatures_name, reinterpret_cast<unsigned char *>(&conjunction))) {\n@@ -472,1 +473,1 @@\n-    log_error(crac)(\"Restore failed due to incompatible or missing CPU features, try using -XX:CPUFeatures=%s on checkpoint.\", datap->print_numbers());\n+    log_error(crac)(\"Restore failed due to incompatible or missing CPU features, try using -XX:CPUFeatures=%s on checkpoint.\", conjunction.print_numbers());\n","filename":"src\/hotspot\/share\/runtime\/crac_engine.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -82,1 +82,1 @@\n-static bool is_failed(crlib_conf_t *, const char *name);\n+static bool is_failed(crlib_conf_t *, const char *name, unsigned char *value_return);\n@@ -629,2 +629,2 @@\n-static bool is_failed(crlib_conf_t *conf, const char *name) {\n-  return conf->image_constraints().is_failed(name);\n+static bool is_failed(crlib_conf_t *conf, const char *name, unsigned char *value_return) {\n+  return conf->image_constraints().is_failed(name, value_return);\n","filename":"src\/java.base\/share\/native\/libcrexec\/crexec.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -284,2 +284,12 @@\n-      print_bitmap(\"Constraint: \", static_cast<const unsigned char*>(c.data), c.data_size);\n-      print_bitmap(\"Image:      \", static_cast<const unsigned char*>(t->data), t->data_size);\n+      print_bitmap(\"Constraint:  \", static_cast<const unsigned char*>(c.data), c.data_size);\n+      print_bitmap(\"Image:       \", static_cast<const unsigned char*>(t->data), t->data_size);\n+      if (c.comparison != EQUALS) {\n+        free((void *) c.conjunction);\n+        c.conjunction = malloc(c.data_size);\n+        for (size_t ix = 0; ix < c.data_size; ++ix) {\n+          const_cast<unsigned char*>(static_cast<const unsigned char*>(c.conjunction))[ix]\n+            = static_cast<const unsigned char*>(c.data)[ix]\n+            & (ix >= t->data_size ? 0 : static_cast<const unsigned char*>(t->data)[ix]);\n+        }\n+        print_bitmap(\"Conjunction: \", static_cast<const unsigned char*>(c.conjunction), c.data_size);\n+      }\n","filename":"src\/java.base\/share\/native\/libcrexec\/image_constraints.cpp","additions":12,"deletions":2,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -83,0 +83,1 @@\n+    const void* conjunction; \/\/ data_size\n@@ -86,1 +87,1 @@\n-      type(t), failed(false), name(n), data(d), data_size(ds), comparison(c) {}\n+      type(t), failed(false), name(n), data(d), data_size(ds), conjunction(nullptr), comparison(c) {}\n@@ -93,0 +94,1 @@\n+      conjunction = o.conjunction;\n@@ -101,0 +103,1 @@\n+      free((void *) conjunction);\n@@ -129,1 +132,1 @@\n-  bool is_failed(const char* name) const {\n+  bool is_failed(const char* name, unsigned char *value_return) const {\n@@ -134,0 +137,3 @@\n+        if (value_return && c.conjunction) {\n+          memcpy(value_return, c.conjunction, c.data_size);\n+        }\n","filename":"src\/java.base\/share\/native\/libcrexec\/image_constraints.hpp","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"}]}