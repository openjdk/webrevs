{"files":[{"patch":"@@ -639,0 +639,2 @@\n+  check_cpufeatures_vmoptions();\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -69,1 +69,1 @@\n-  static bool ignore_cpu_features(bool is_checkpoint) { return true; }\n+  static bool ignore_cpu_features() { return true; }\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-  static bool ignore_cpu_features(bool is_checkpoint) { return true; }\n+  static bool ignore_cpu_features() { return true; }\n","filename":"src\/hotspot\/cpu\/arm\/vm_version_arm.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -353,0 +353,2 @@\n+  check_cpufeatures_vmoptions();\n+\n","filename":"src\/hotspot\/cpu\/arm\/vm_version_arm_32.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -334,0 +334,2 @@\n+\n+  check_cpufeatures_vmoptions();\n","filename":"src\/hotspot\/cpu\/ppc\/vm_version_ppc.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -58,1 +58,1 @@\n-  static bool ignore_cpu_features(bool is_checkpoint) { return true; }\n+  static bool ignore_cpu_features() { return true; }\n","filename":"src\/hotspot\/cpu\/ppc\/vm_version_ppc.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -65,0 +65,2 @@\n+\n+  check_cpufeatures_vmoptions();\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -312,1 +312,1 @@\n-  static bool ignore_cpu_features(bool is_checkpoint) { return true; }\n+  static bool ignore_cpu_features() { return true; }\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -331,0 +331,2 @@\n+\n+  check_cpufeatures_vmoptions();\n","filename":"src\/hotspot\/cpu\/s390\/vm_version_s390.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -419,1 +419,1 @@\n-  static bool ignore_cpu_features(bool is_checkpoint) { return true; }\n+  static bool ignore_cpu_features() { return true; }\n","filename":"src\/hotspot\/cpu\/s390\/vm_version_s390.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -185,14 +185,0 @@\n-  product(ccstr, CPUFeatures, nullptr, \"CPU feature set, \"                  \\\n-          \"use -XX:CPUFeatures=0xnumber with -XX:CRaCCheckpointTo when you \"\\\n-          \"get an error during -XX:CRaCRestoreFrom on a different machine; \"\\\n-          \"-XX:CPUFeatures=native is the default; \"                         \\\n-          \"-XX:CPUFeatures=ignore will disable the CPU features check; \"    \\\n-          \"-XX:CPUFeatures=generic is compatible but not as slow as 0\")     \\\n-                                                                            \\\n-  product(bool, ShowCPUFeatures, false, \"Show features of this CPU \"        \\\n-          \"to be possibly used for the -XX:CPUFeatures=0xnumber option\")    \\\n-                                                                            \\\n-  product(bool, IgnoreCPUFeatures, false, RESTORE_SETTABLE | EXPERIMENTAL,  \\\n-          \"Do not refuse to run after -XX:CRaCRestoreFrom finds out some \"  \\\n-          \"CPU features are missing\")                                       \\\n-                                                                            \\\n","filename":"src\/hotspot\/cpu\/x86\/globals_x86.hpp","additions":0,"deletions":14,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -940,1 +940,1 @@\n-  static bool ignore_cpu_features(bool is_checkpoint) {\n+  static bool ignore_cpu_features() {\n@@ -944,1 +944,1 @@\n-    return _ignore_glibc_not_using || (!is_checkpoint && IgnoreCPUFeatures);\n+    return _ignore_glibc_not_using;\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -142,0 +142,2 @@\n+\n+  check_cpufeatures_vmoptions();\n","filename":"src\/hotspot\/cpu\/zero\/vm_version_zero.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -37,1 +37,1 @@\n-  static bool ignore_cpu_features(bool is_checkpoint) { return true; }\n+  static bool ignore_cpu_features() { return true; }\n","filename":"src\/hotspot\/cpu\/zero\/vm_version_zero.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"runtime\/globals_extension.hpp\"\n@@ -405,0 +406,11 @@\n+\n+void Abstract_VM_Version::check_cpufeatures_vmoptions() {\n+  if (!FLAG_IS_DEFAULT(CPUFeatures)) {\n+    if (!strcmp(CPUFeatures, \"native\") || !strcmp(CPUFeatures, \"generic\") || !strcmp(CPUFeatures, \"ignore\")) {\n+      vm_exit_during_initialization(\"This architecture does not support arch-specific -XX:CPUFeatures option\");\n+    }\n+  }\n+  if (!FLAG_IS_DEFAULT(ShowCPUFeatures)) {\n+    tty->print_cr(\"This architecture does not support any arch-specific strings.\");\n+  }\n+}\n","filename":"src\/hotspot\/share\/runtime\/abstract_vm_version.cpp","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -230,0 +230,3 @@\n+  \/\/ Default check for non-x86_64 architectures on VM options sanity\n+  static void check_cpufeatures_vmoptions();\n+\n","filename":"src\/hotspot\/share\/runtime\/abstract_vm_version.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -320,1 +320,1 @@\n-  if (_generation == 1 && !VM_Version::ignore_cpu_features(true)) {\n+  if (_generation == 1 && !VM_Version::ignore_cpu_features()) {\n@@ -798,1 +798,1 @@\n-  if (!VM_Version::ignore_cpu_features(false)) {\n+  if (!VM_Version::ignore_cpu_features() && !IgnoreCPUFeatures) {\n","filename":"src\/hotspot\/share\/runtime\/crac.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2032,0 +2032,16 @@\n+  product(ccstr, CPUFeatures, nullptr, \"CPU feature set, \"                  \\\n+          \"Limit set of CPU features to make the CRaC image compatible \"    \\\n+          \"for running on a machine with different CPU:\"                    \\\n+          \"native: use all available features (default), \"                  \\\n+          \"generic: compatible with most CPUs, \"                            \\\n+          \"ignore: do not store CPU features at all, \"                      \\\n+          \"<arch-specific>: use -XX:+ShowCPUFeatures to find a suitable \"   \\\n+          \"architecture-specific string, e.g. 0xnumber,0xnumber on x86_64.\")\\\n+                                                                            \\\n+  product(bool, ShowCPUFeatures, false, \"Show features of this CPU \"        \\\n+          \"to be possibly used for the -XX:CPUFeatures=0xnumber option\")    \\\n+                                                                            \\\n+  product(bool, IgnoreCPUFeatures, false, RESTORE_SETTABLE | EXPERIMENTAL,  \\\n+          \"Do not refuse to run after -XX:CRaCRestoreFrom finds out some \"  \\\n+          \"CPU features are missing\")                                       \\\n+                                                                            \\\n","filename":"src\/hotspot\/share\/runtime\/globals.hpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -1884,5 +1884,18 @@\n-`-XX:CPUFeatures=`*0xnumber,0xnumber*\n-:   CPU feature set, use `-XX:CPUFeatures=`*0xnumber,0xnumber* with\n-    `-XX:CRaCCheckpointTo` when you get an error during `-XX:CRaCRestoreFrom`\n-    on a different machine. `-XX:CPUFeatures=native` is the default.\n-    `-XX:CPUFeatures=generic` is compatible with any CPU.\n+`-XX:CPUFeatures=`*features*\n+:   Limit set of CPU features to make the CRaC image compatible for running\n+    on a machine with different CPU:\n+\n+    `native`\n+    :   Use all available CPU features (default).\n+\n+    `generic`\n+    :   This option is compatible with most CPUs and faster than disabling\n+        all optional features.\n+\n+    `ignore`\n+    :   Do not store CPU features at all.\n+\n+    *arch-specific*\n+    :   Architecture specific string, e.g. *0xnumber,0xnumber* on x86_64.\n+        Use `-XX:+ShowCPUFeatures` to find a suitable architecture-specific\n+        string.\n","filename":"src\/java.base\/share\/man\/java.md","additions":18,"deletions":5,"binary":false,"changes":23,"status":"modified"}]}