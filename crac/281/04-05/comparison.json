{"files":[{"patch":"@@ -710,0 +710,4 @@\n+bool crac::is_image_constraints_supported() {\n+  return _engine->prepare_image_constraints_api() == CracEngine::ApiStatus::OK;\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/crac.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -44,0 +44,3 @@\n+  static bool is_image_constraints_supported();\n+  static bool record_image_label(const char *label, const char *value);\n+\n@@ -47,1 +50,0 @@\n-  static bool record_image_label(const char *label, const char *value);\n","filename":"src\/hotspot\/share\/runtime\/crac.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+#include \"utilities\/stringUtils.hpp\"\n@@ -57,17 +58,0 @@\n-#ifdef _WINDOWS\n-static char *strsep(char **strp, const char *delim) {\n-  char *str = *strp;\n-  if (str == nullptr) {\n-    return nullptr;\n-  }\n-  size_t len = strcspn(str, delim);\n-  if (str[len] == '\\0') {\n-    *strp = nullptr;\n-    return str;\n-  }\n-  str[len] = '\\0';\n-  *strp += len + 1;\n-  return str;\n-}\n-#endif \/\/ _WINDOWS\n-\n@@ -476,0 +460,4 @@\n+bool CracEngine::set_label(const char* label, const char* value) {\n+  return _image_constraints_api->set_label(_conf, label, value);\n+}\n+\n@@ -485,4 +473,0 @@\n-\n-bool CracEngine::set_label(const char* label, const char* value) {\n-  return _image_constraints_api->set_label(_conf, label, value);\n-}\n","filename":"src\/hotspot\/share\/runtime\/crac_engine.cpp","additions":5,"deletions":21,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -76,0 +76,1 @@\n+#include \"utilities\/stringUtils.hpp\"\n@@ -1089,1 +1090,0 @@\n-\n@@ -1092,4 +1092,10 @@\n-    LocaleGuard lg;\n-    if (metrics[0] == '@') {\n-      if (!parse_pairs_from_file(\"metric\", metrics + 1, CheckpointDCmd::accept_metric)) {\n-        return;\n+    if (crac::is_image_score_supported()) {\n+      LocaleGuard lg;\n+      if (metrics[0] == '@') {\n+        if (!parse_pairs_from_file(\"metric\", metrics + 1, CheckpointDCmd::accept_metric)) {\n+          return;\n+        }\n+      } else {\n+        if (!parse_pairs(\"metric\", metrics, CheckpointDCmd::accept_metric)) {\n+          return;\n+        }\n@@ -1098,3 +1104,1 @@\n-      if (!parse_pairs(\"metric\", metrics, CheckpointDCmd::accept_metric)) {\n-        return;\n-      }\n+      output()->print_cr(\"Warning: metrics are not supported by current C\/R engine\");\n@@ -1105,3 +1109,9 @@\n-    if (labels[0] == '@') {\n-      if (!parse_pairs_from_file(\"label\", labels + 1, CheckpointDCmd::accept_label)) {\n-        return;\n+    if (crac::is_image_constraints_supported()) {\n+      if (labels[0] == '@') {\n+        if (!parse_pairs_from_file(\"label\", labels + 1, CheckpointDCmd::accept_label)) {\n+          return;\n+        }\n+      } else {\n+        if (!parse_pairs(\"label\", labels, CheckpointDCmd::accept_label)) {\n+          return;\n+        }\n@@ -1110,3 +1120,1 @@\n-      if (!parse_pairs(\"label\", labels, CheckpointDCmd::accept_label)) {\n-        return;\n-      }\n+      output()->print_cr(\"Warning: labels are not supported by current C\/R engine\");\n@@ -1170,17 +1178,0 @@\n-#ifdef _WINDOWS\n-static char *strsep(char **strp, const char *delim) {\n-  char *str = *strp;\n-  if (str == nullptr) {\n-    return nullptr;\n-  }\n-  size_t len = strcspn(str, delim);\n-  if (str[len] == '\\0') {\n-    *strp = nullptr;\n-    return str;\n-  }\n-  str[len] = '\\0';\n-  *strp += len + 1;\n-  return str;\n-}\n-#endif \/\/ _WINDOWS\n-\n@@ -1250,1 +1241,0 @@\n-\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":22,"deletions":32,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -862,1 +862,1 @@\n-    return \"Checkpoint via jdk.crac.checkpointRestore().\";\n+    return \"Initiates a CRaC checkpoint.\";\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,18 @@\n-#endif\n+\n+\/\/ Windows does not have standard C library's strsep\n+static char *strsep(char **strp, const char *delim) {\n+  char *str = *strp;\n+  if (str == nullptr) {\n+    return nullptr;\n+  }\n+  size_t len = strcspn(str, delim);\n+  if (str[len] == '\\0') {\n+    *strp = nullptr;\n+    return str;\n+  }\n+  str[len] = '\\0';\n+  *strp += len + 1;\n+  return str;\n+}\n+#endif \/\/ _WINDOWS\n+\n","filename":"src\/hotspot\/share\/utilities\/stringUtils.hpp","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -94,2 +94,2 @@\n-    private static Path createTemp(String metrics, String text) throws IOException {\n-        Path path = Files.createTempFile(metrics, \".txt\");\n+    private static Path createTemp(String name, String text) throws IOException {\n+        Path path = Files.createTempFile(name, \".txt\");\n","filename":"test\/jdk\/jdk\/crac\/JcmdArgsTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}