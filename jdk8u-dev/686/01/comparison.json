{"files":[{"patch":"@@ -62,0 +62,1 @@\n+import sun.misc.IOUtils;\n@@ -623,10 +624,2 @@\n-        InputStream iis = new InflaterInputStream(bais);\n-        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n-\n-        int c;\n-        try {\n-            while ((c = iis.read()) != -1) {\n-                baos.write(c);\n-            }\n-        } finally {\n-            iis.close();\n+        try (InputStream iis = new InflaterInputStream(bais)) {\n+            return IOUtils.readAllBytes(iis);\n@@ -634,1 +627,0 @@\n-        return baos.toByteArray();\n","filename":"jdk\/src\/share\/classes\/com\/sun\/imageio\/plugins\/png\/PNGImageReader.java","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -534,2 +534,0 @@\n-                    Reader reader = new InputStreamReader(url.openStream(), \"ISO-8859-1\");\n-                    char[] buf = new char[1024];\n@@ -537,3 +535,8 @@\n-                    int n;\n-                    while ((n = reader.read(buf)) >= 0) {\n-                        strBuf.append(buf, 0, n);\n+                    try (InputStream in = url.openStream();\n+                         Reader reader = new InputStreamReader(in, \"ISO-8859-1\"))\n+                    {\n+                        char[] buf = new char[1024];\n+                        int n;\n+                        while ((n = reader.read(buf)) >= 0) {\n+                            strBuf.append(buf, 0, n);\n+                        }\n@@ -541,1 +544,0 @@\n-                    reader.close();\n","filename":"jdk\/src\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/Metacity.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -50,2 +50,1 @@\n-        try {\n-            AudioInputStream ais = AudioSystem.getAudioInputStream(url);\n+        try (AudioInputStream ais = AudioSystem.getAudioInputStream(url)) {\n@@ -53,1 +52,0 @@\n-            ais.close();\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/AudioFileSoundbankReader.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -189,2 +189,1 @@\n-        InputStream is = url.openStream();\n-        try {\n+        try (InputStream is = url.openStream()) {\n@@ -192,2 +191,0 @@\n-        } finally {\n-            is.close();\n@@ -200,2 +197,1 @@\n-        InputStream is = new FileInputStream(file);\n-        try {\n+        try (InputStream is = new FileInputStream(file)) {\n@@ -203,2 +199,0 @@\n-        } finally {\n-            is.close();\n@@ -873,1 +867,3 @@\n-        writeSoundbank(new RIFFWriter(name, \"DLS \"));\n+        try (RIFFWriter writer = new RIFFWriter(name, \"DLS \")) {\n+            writeSoundbank(writer);\n+        }\n@@ -877,1 +873,3 @@\n-        writeSoundbank(new RIFFWriter(file, \"DLS \"));\n+        try (RIFFWriter writer = new RIFFWriter(file, \"DLS \")) {\n+            writeSoundbank(writer);\n+        }\n@@ -881,1 +879,3 @@\n-        writeSoundbank(new RIFFWriter(out, \"DLS \"));\n+        try (RIFFWriter writer = new RIFFWriter(out, \"DLS \")) {\n+            writeSoundbank(writer);\n+        }\n@@ -921,2 +921,0 @@\n-\n-        writer.close();\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/DLSSoundbank.java","additions":11,"deletions":13,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -64,2 +64,1 @@\n-            InputStream stream = url.openStream();\n-            try {\n+            try (InputStream stream = url.openStream()) {\n@@ -74,2 +73,0 @@\n-            } finally {\n-                stream.close();\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/JARSoundbankReader.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -312,5 +312,7 @@\n-        DataInputStream is = new DataInputStream(getInputStream());\n-        buffer = new byte[(int) capacity()];\n-        offset = 0;\n-        is.readFully(buffer);\n-        is.close();\n+        try (InputStream is = getInputStream();\n+             DataInputStream dis = new DataInputStream(is))\n+        {\n+            buffer = new byte[(int) capacity()];\n+            offset = 0;\n+            dis.readFully(buffer);\n+        }\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/ModelByteBuffer.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -175,1 +175,0 @@\n-            InputStream is = buffer.getInputStream();\n@@ -177,1 +176,1 @@\n-            try {\n+            try (InputStream is = buffer.getInputStream()) {\n@@ -182,5 +181,0 @@\n-            try {\n-                is.close();\n-            } catch (IOException e) {\n-                \/\/e.printStackTrace();\n-            }\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/ModelByteBufferWavetable.java","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -92,3 +92,1 @@\n-\n-        InputStream is = url.openStream();\n-        try {\n+        try (InputStream is = url.openStream()) {\n@@ -96,2 +94,0 @@\n-        } finally {\n-            is.close();\n@@ -104,2 +100,1 @@\n-        InputStream is = new FileInputStream(file);\n-        try {\n+        try (InputStream is = new FileInputStream(file)) {\n@@ -107,2 +102,0 @@\n-        } finally {\n-            is.close();\n@@ -525,1 +518,3 @@\n-        writeSoundbank(new RIFFWriter(name, \"sfbk\"));\n+        try (RIFFWriter writer = new RIFFWriter(name, \"sfbk\")) {\n+            writeSoundbank(writer);\n+        }\n@@ -529,1 +524,3 @@\n-        writeSoundbank(new RIFFWriter(file, \"sfbk\"));\n+        try (RIFFWriter writer = new RIFFWriter(file, \"sfbk\")) {\n+            writeSoundbank(writer);\n+        }\n@@ -533,1 +530,3 @@\n-        writeSoundbank(new RIFFWriter(out, \"sfbk\"));\n+        try (RIFFWriter writer = new RIFFWriter(out, \"sfbk\")) {\n+            writeSoundbank(writer);\n+        }\n@@ -540,1 +539,0 @@\n-        writer.close();\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/SF2Soundbank.java","additions":11,"deletions":13,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -790,1 +790,0 @@\n-                        out.close();\n@@ -792,0 +791,5 @@\n+                    } finally {\n+                        try {\n+                            out.close();\n+                        } catch (final IOException ignored) {\n+                        }\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/SoftSynthesizer.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -148,7 +148,5 @@\n-        InputStream urlStream = url.openStream(); \/\/ throws IOException\n-        BufferedInputStream bis = new BufferedInputStream( urlStream, bisBufferSize );\n-        MidiFileFormat fileFormat = null;\n-        try {\n-            fileFormat = getMidiFileFormat( bis ); \/\/ throws InvalidMidiDataException\n-        } finally {\n-            bis.close();\n+        try (InputStream urlStream = url.openStream(); \/\/ throws IOException\n+             BufferedInputStream bis = new BufferedInputStream(urlStream, bisBufferSize))\n+        {\n+            MidiFileFormat fileFormat = getMidiFileFormat(bis); \/\/ throws InvalidMidiDataException\n+            return fileFormat;\n@@ -156,1 +154,0 @@\n-        return fileFormat;\n@@ -161,13 +158,10 @@\n-        FileInputStream fis = new FileInputStream(file); \/\/ throws IOException\n-        BufferedInputStream bis = new BufferedInputStream(fis, bisBufferSize);\n-\n-        \/\/ $$fb 2002-04-17: part of fix for 4635286: MidiSystem.getMidiFileFormat() returns format having invalid length\n-        long length = file.length();\n-        if (length > Integer.MAX_VALUE) {\n-            length = MidiFileFormat.UNKNOWN_LENGTH;\n-        }\n-        MidiFileFormat fileFormat = null;\n-        try {\n-            fileFormat = getMidiFileFormatFromStream(bis, (int) length, null);\n-        } finally {\n-            bis.close();\n+        try (FileInputStream fis = new FileInputStream(file); \/\/ throws IOException\n+             BufferedInputStream bis = new BufferedInputStream(fis, bisBufferSize))\n+        {\n+            \/\/ $$fb 2002-04-17: part of fix for 4635286: MidiSystem.getMidiFileFormat() returns format having invalid length\n+            long length = file.length();\n+            if (length > Integer.MAX_VALUE) {\n+                length = MidiFileFormat.UNKNOWN_LENGTH;\n+            }\n+            MidiFileFormat fileFormat = getMidiFileFormatFromStream(bis, (int) length, null);\n+            return fileFormat;\n@@ -175,1 +169,0 @@\n-        return fileFormat;\n@@ -207,7 +200,5 @@\n-        InputStream is = url.openStream();  \/\/ throws IOException\n-        is = new BufferedInputStream(is, bisBufferSize);\n-        Sequence seq = null;\n-        try {\n-            seq = getSequence(is);\n-        } finally {\n-            is.close();\n+        try (InputStream is = url.openStream(); \/\/ throws IOException\n+             BufferedInputStream bis = new BufferedInputStream(is, bisBufferSize))\n+        {\n+            Sequence seq = getSequence(bis);\n+            return seq;\n@@ -215,1 +206,0 @@\n-        return seq;\n@@ -220,7 +210,5 @@\n-        InputStream is = new FileInputStream(file); \/\/ throws IOException\n-        is = new BufferedInputStream(is, bisBufferSize);\n-        Sequence seq = null;\n-        try {\n-            seq = getSequence(is);\n-        } finally {\n-            is.close();\n+        try (InputStream is = new FileInputStream(file); \/\/ throws IOException\n+             BufferedInputStream bis = new BufferedInputStream(is, bisBufferSize))\n+        {\n+            Sequence seq = getSequence(bis);\n+            return seq;\n@@ -228,1 +216,0 @@\n-        return seq;\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/StandardMidiFileReader.java","additions":26,"deletions":39,"binary":false,"changes":65,"status":"modified"},{"patch":"@@ -152,4 +152,4 @@\n-        FileOutputStream fos = new FileOutputStream(out); \/\/ throws IOException\n-        int bytesWritten = write( in, type, fos );\n-        fos.close();\n-        return bytesWritten;\n+        try (FileOutputStream fos = new FileOutputStream(out)) { \/\/ throws IOException\n+            int bytesWritten = write(in, type, fos);\n+            return bytesWritten;\n+        }\n","filename":"jdk\/src\/share\/classes\/com\/sun\/media\/sound\/StandardMidiFileWriter.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -716,6 +716,4 @@\n-                    FileInputStream in =\n-                        new FileInputStream(propsFile);\n-\n-                    \/\/ Inputstream has been buffered in Properties class\n-                    properties.load(in);\n-                    in.close();\n+                    try (FileInputStream in = new FileInputStream(propsFile)) {\n+                        \/\/ Inputstream has been buffered in Properties class\n+                        properties.load(in);\n+                    }\n@@ -734,6 +732,4 @@\n-                        FileInputStream in =\n-                            new FileInputStream(propsFile);\n-\n-                        \/\/ Inputstream has been buffered in Properties class\n-                        properties.load(in);\n-                        in.close();\n+                        try (FileInputStream in = new FileInputStream(propsFile)) {\n+                            \/\/ Inputstream has been buffered in Properties class\n+                            properties.load(in);\n+                        }\n","filename":"jdk\/src\/share\/classes\/java\/awt\/Toolkit.java","additions":8,"deletions":12,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -194,1 +194,0 @@\n-                ins.close();\n@@ -198,1 +197,1 @@\n-            } catch (ClassNotFoundException ex) {\n+            } finally {\n@@ -200,1 +199,0 @@\n-                throw ex;\n","filename":"jdk\/src\/share\/classes\/java\/beans\/Beans.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -42,2 +42,0 @@\n-import java.util.NoSuchElementException;\n-import java.util.Set;\n@@ -1397,1 +1395,1 @@\n-        InputStream istream = null;\n+        InputStream istream;\n","filename":"jdk\/src\/share\/classes\/javax\/imageio\/ImageIO.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -797,10 +797,6 @@\n-        DataOutputStream os = null;\n-        try {\n-            conn.setRequestProperty(\"Content-Type\",\n-                    \"application\/x-www-form-urlencoded\");\n-            os = new DataOutputStream(conn.getOutputStream());\n-            os.writeBytes((String) postData);\n-        } finally {\n-            if (os != null) {\n-                os.close();\n-            }\n+        conn.setRequestProperty(\"Content-Type\",\n+                \"application\/x-www-form-urlencoded\");\n+        try (OutputStream os = conn.getOutputStream();\n+             DataOutputStream dos = new DataOutputStream(os))\n+        {\n+            dos.writeBytes((String)postData);\n","filename":"jdk\/src\/share\/classes\/javax\/swing\/JEditorPane.java","additions":6,"deletions":10,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -60,1 +60,0 @@\n-import java.lang.reflect.Method;\n@@ -1242,3 +1241,3 @@\n-                            FileInputStream ins = new FileInputStream(file);\n-                            props.load(ins);\n-                            ins.close();\n+                            try (FileInputStream ins = new FileInputStream(file)) {\n+                                props.load(ins);\n+                            }\n","filename":"jdk\/src\/share\/classes\/javax\/swing\/UIManager.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -394,4 +394,4 @@\n-            try {\n-                InputStream is = HTMLEditorKit.getResourceAsStream(DEFAULT_CSS);\n-                Reader r = new BufferedReader(\n-                        new InputStreamReader(is, \"ISO-8859-1\"));\n+            try (InputStream is = HTMLEditorKit.getResourceAsStream(DEFAULT_CSS);\n+                 InputStreamReader isr = new InputStreamReader(is, \"ISO-8859-1\");\n+                 Reader r = new BufferedReader(isr))\n+            {\n@@ -399,1 +399,0 @@\n-                r.close();\n","filename":"jdk\/src\/share\/classes\/javax\/swing\/text\/html\/HTMLEditorKit.java","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -463,5 +463,4 @@\n-        try {\n-            InputStream is;\n-\n-            is = url.openStream();\n-            Reader r = new BufferedReader(new InputStreamReader(is));\n+        try (InputStream is = url.openStream();\n+             InputStreamReader isr = new InputStreamReader(is);\n+             Reader r = new BufferedReader(isr))\n+        {\n@@ -470,2 +469,0 @@\n-            r.close();\n-            is.close();\n","filename":"jdk\/src\/share\/classes\/javax\/swing\/text\/html\/StyleSheet.java","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -181,3 +181,3 @@\n-            FileInputStream     fin = new FileInputStream(propFile);\n-            props.load(fin);\n-            fin.close();\n+            try (FileInputStream fin = new FileInputStream(propFile)) {\n+                props.load(fin);\n+            }\n","filename":"jdk\/src\/share\/classes\/sun\/awt\/DebugSettings.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -51,1 +51,0 @@\n-import sun.font.FontManagerFactory;\n@@ -202,2 +201,1 @@\n-            try {\n-                FileInputStream in = new FileInputStream(f.getPath());\n+            try (FileInputStream in = new FileInputStream(f.getPath())) {\n@@ -209,1 +207,0 @@\n-                in.close();\n","filename":"jdk\/src\/share\/classes\/sun\/awt\/FontConfiguration.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -400,2 +400,0 @@\n-                InputStream in =\n-                    new BufferedInputStream(new FileInputStream(f.getPath()));\n@@ -403,2 +401,5 @@\n-                props.load(in);\n-                in.close();\n+                try (FileInputStream is = new FileInputStream(f.getPath());\n+                     BufferedInputStream bis = new BufferedInputStream(is))\n+                {\n+                    props.load(bis);\n+                }\n","filename":"jdk\/src\/share\/classes\/sun\/print\/PSPrinterJob.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -180,1 +180,3 @@\n-                    props.load(new FileInputStream(f));\n+                    try (FileInputStream fis = new FileInputStream(f)) {\n+                        props.load(fis);\n+                    }\n","filename":"jdk\/src\/solaris\/classes\/sun\/awt\/motif\/MFontConfiguration.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -320,1 +320,3 @@\n-                    props.load(new FileInputStream(f));\n+                    try (FileInputStream fis = new FileInputStream(f)) {\n+                        props.load(fis);\n+                    }\n@@ -403,4 +405,3 @@\n-            FileOutputStream fos = new FileOutputStream(tempFile);\n-            props.store(fos,\n-                      \"JDK Font Configuration Generated File: *Do Not Edit*\");\n-            fos.close();\n+            try (FileOutputStream fos = new FileOutputStream(tempFile)) {\n+                props.store(fos, \"JDK Font Configuration Generated File: *Do Not Edit*\");\n+            }\n","filename":"jdk\/src\/solaris\/classes\/sun\/font\/FcFontConfiguration.java","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"}]}