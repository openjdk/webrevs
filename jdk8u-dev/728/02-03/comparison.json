{"files":[{"patch":"@@ -1036,1 +1036,1 @@\n-## The FreeType Project: Freetype v2.13.0\n+## The FreeType Project: Freetype v2.13.2\n","filename":"THIRD_PARTY_README","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -664,1 +664,1 @@\n-   * details on the LEAN option.\n+   * details on this option.\n@@ -666,28 +666,4 @@\n-   * There are three possible values.\n-   *\n-   * Value 1:\n-   *   This value is associated with the 'Infinality' moniker, contributed by\n-   *   an individual nicknamed Infinality with the goal of making TrueType\n-   *   fonts render better than on Windows.  A high amount of configurability\n-   *   and flexibility, down to rules for single glyphs in fonts, but also\n-   *   very slow.  Its experimental and slow nature and the original\n-   *   developer losing interest meant that this option was never enabled in\n-   *   default builds.\n-   *\n-   *   The corresponding interpreter version is v38.\n-   *\n-   * Value 2:\n-   *   The new default mode for the TrueType driver.  The Infinality code\n-   *   base was stripped to the bare minimum and all configurability removed\n-   *   in the name of speed and simplicity.  The configurability was mainly\n-   *   aimed at legacy fonts like 'Arial', 'Times New Roman', or 'Courier'.\n-   *   Legacy fonts are fonts that modify vertical stems to achieve clean\n-   *   black-and-white bitmaps.  The new mode focuses on applying a minimal\n-   *   set of rules to all fonts indiscriminately so that modern and web\n-   *   fonts render well while legacy fonts render okay.\n-   *\n-   *   The corresponding interpreter version is v40.\n-   *\n-   * Value 3:\n-   *   Compile both, making both v38 and v40 available (the latter is the\n-   *   default).\n+   * The new default mode focuses on applying a minimal set of rules to all\n+   * fonts indiscriminately so that modern and web fonts render well while\n+   * legacy fonts render okay.  The corresponding interpreter version is v40.\n+   * The so-called Infinality mode (v38) is no longer available in FreeType.\n@@ -708,3 +684,1 @@\n-\/* #define TT_CONFIG_OPTION_SUBPIXEL_HINTING  1         *\/\n-#define TT_CONFIG_OPTION_SUBPIXEL_HINTING  2\n-\/* #define TT_CONFIG_OPTION_SUBPIXEL_HINTING  ( 1 | 2 ) *\/\n+#define TT_CONFIG_OPTION_SUBPIXEL_HINTING\n@@ -980,1 +954,1 @@\n-   * The next three macros are defined if native TrueType hinting is\n+   * The next two macros are defined if native TrueType hinting is\n@@ -985,1 +959,0 @@\n-\n@@ -987,5 +960,0 @@\n-#if TT_CONFIG_OPTION_SUBPIXEL_HINTING & 1\n-#define  TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-#endif\n-\n-#if TT_CONFIG_OPTION_SUBPIXEL_HINTING & 2\n@@ -994,1 +962,0 @@\n-#endif\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/config\/ftoption.h","additions":7,"deletions":40,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -114,7 +114,7 @@\n-#define FT_FILE     FILE\n-#define ft_fclose   fclose\n-#define ft_fopen    fopen\n-#define ft_fread    fread\n-#define ft_fseek    fseek\n-#define ft_ftell    ftell\n-#define ft_sprintf  sprintf\n+#define FT_FILE      FILE\n+#define ft_fclose    fclose\n+#define ft_fopen     fopen\n+#define ft_fread     fread\n+#define ft_fseek     fseek\n+#define ft_ftell     ftell\n+#define ft_snprintf  snprintf\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/config\/ftstdlib.h","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -105,10 +105,0 @@\n-\n-  \/*************************************************************************\/\n-  \/*************************************************************************\/\n-  \/*                                                                       *\/\n-  \/*                        B A S I C   T Y P E S                          *\/\n-  \/*                                                                       *\/\n-  \/*************************************************************************\/\n-  \/*************************************************************************\/\n-\n-\n@@ -118,1 +108,1 @@\n-   *   base_interface\n+   *   font_testing_macros\n@@ -121,1 +111,1 @@\n-   *   Base Interface\n+   *   Font Testing Macros\n@@ -124,1 +114,1 @@\n-   *   The FreeType~2 base font interface.\n+   *   Macros to test various properties of fonts.\n@@ -127,2 +117,1 @@\n-   *   This section describes the most important public high-level API\n-   *   functions of FreeType~2.\n+   *   Macros to test the most important font properties.\n@@ -130,29 +119,3 @@\n-   * @order:\n-   *   FT_Library\n-   *   FT_Face\n-   *   FT_Size\n-   *   FT_GlyphSlot\n-   *   FT_CharMap\n-   *   FT_Encoding\n-   *   FT_ENC_TAG\n-   *\n-   *   FT_FaceRec\n-   *\n-   *   FT_FACE_FLAG_SCALABLE\n-   *   FT_FACE_FLAG_FIXED_SIZES\n-   *   FT_FACE_FLAG_FIXED_WIDTH\n-   *   FT_FACE_FLAG_HORIZONTAL\n-   *   FT_FACE_FLAG_VERTICAL\n-   *   FT_FACE_FLAG_COLOR\n-   *   FT_FACE_FLAG_SFNT\n-   *   FT_FACE_FLAG_CID_KEYED\n-   *   FT_FACE_FLAG_TRICKY\n-   *   FT_FACE_FLAG_KERNING\n-   *   FT_FACE_FLAG_MULTIPLE_MASTERS\n-   *   FT_FACE_FLAG_VARIATION\n-   *   FT_FACE_FLAG_GLYPH_NAMES\n-   *   FT_FACE_FLAG_EXTERNAL_STREAM\n-   *   FT_FACE_FLAG_HINTER\n-   *   FT_FACE_FLAG_SVG\n-   *   FT_FACE_FLAG_SBIX\n-   *   FT_FACE_FLAG_SBIX_OVERLAY\n+   *   It is recommended to use these high-level macros instead of directly\n+   *   testing the corresponding flags, which are scattered over various\n+   *   structures.\n@@ -160,0 +123,1 @@\n+   * @order:\n@@ -179,2 +143,7 @@\n-   *   FT_STYLE_FLAG_BOLD\n-   *   FT_STYLE_FLAG_ITALIC\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   library_setup\n@@ -182,2 +151,2 @@\n-   *   FT_SizeRec\n-   *   FT_Size_Metrics\n+   * @title:\n+   *   Library Setup\n@@ -185,3 +154,2 @@\n-   *   FT_GlyphSlotRec\n-   *   FT_Glyph_Metrics\n-   *   FT_SubGlyph\n+   * @abstract:\n+   *   Functions to start and end the usage of the FreeType library.\n@@ -189,1 +157,6 @@\n-   *   FT_Bitmap_Size\n+   * @description:\n+   *   Functions to start and end the usage of the FreeType library.\n+   *\n+   *   Note that @FT_Library_Version and @FREETYPE_XXX are of limited use\n+   *   because even a new release of FreeType with only documentation\n+   *   changes increases the version number.\n@@ -191,0 +164,2 @@\n+   * @order:\n+   *   FT_Library\n@@ -194,0 +169,27 @@\n+   *   FT_Library_Version\n+   *   FREETYPE_XXX\n+   *\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   face_creation\n+   *\n+   * @title:\n+   *   Face Creation\n+   *\n+   * @abstract:\n+   *   Functions to manage fonts.\n+   *\n+   * @description:\n+   *   The functions and structures collected in this section operate on\n+   *   fonts globally.\n+   *\n+   * @order:\n+   *   FT_Face\n+   *   FT_FaceRec\n+   *   FT_FACE_FLAG_XXX\n+   *   FT_STYLE_FLAG_XXX\n+   *\n@@ -201,0 +203,1 @@\n+   *   FT_OPEN_XXX\n@@ -205,0 +208,25 @@\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   sizing_and_scaling\n+   *\n+   * @title:\n+   *   Sizing and Scaling\n+   *\n+   * @abstract:\n+   *   Functions to manage font sizes.\n+   *\n+   * @description:\n+   *   The functions and structures collected in this section are related to\n+   *   selecting and manipulating the size of a font globally.\n+   *\n+   * @order:\n+   *   FT_Size\n+   *   FT_SizeRec\n+   *   FT_Size_Metrics\n+   *\n+   *   FT_Bitmap_Size\n+   *\n@@ -212,0 +240,1 @@\n+   *\n@@ -214,5 +243,0 @@\n-   *   FT_Load_Glyph\n-   *   FT_Get_Char_Index\n-   *   FT_Get_First_Char\n-   *   FT_Get_Next_Char\n-   *   FT_Load_Char\n@@ -220,28 +244,17 @@\n-   *   FT_OPEN_MEMORY\n-   *   FT_OPEN_STREAM\n-   *   FT_OPEN_PATHNAME\n-   *   FT_OPEN_DRIVER\n-   *   FT_OPEN_PARAMS\n-   *\n-   *   FT_LOAD_DEFAULT\n-   *   FT_LOAD_RENDER\n-   *   FT_LOAD_MONOCHROME\n-   *   FT_LOAD_LINEAR_DESIGN\n-   *   FT_LOAD_NO_SCALE\n-   *   FT_LOAD_NO_HINTING\n-   *   FT_LOAD_NO_BITMAP\n-   *   FT_LOAD_SBITS_ONLY\n-   *   FT_LOAD_NO_AUTOHINT\n-   *   FT_LOAD_COLOR\n-   *\n-   *   FT_LOAD_VERTICAL_LAYOUT\n-   *   FT_LOAD_IGNORE_TRANSFORM\n-   *   FT_LOAD_FORCE_AUTOHINT\n-   *   FT_LOAD_NO_RECURSE\n-   *   FT_LOAD_PEDANTIC\n-   *\n-   *   FT_LOAD_TARGET_NORMAL\n-   *   FT_LOAD_TARGET_LIGHT\n-   *   FT_LOAD_TARGET_MONO\n-   *   FT_LOAD_TARGET_LCD\n-   *   FT_LOAD_TARGET_LCD_V\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   glyph_retrieval\n+   *\n+   * @title:\n+   *   Glyph Retrieval\n+   *\n+   * @abstract:\n+   *   Functions to manage glyphs.\n+   *\n+   * @description:\n+   *   The functions and structures collected in this section operate on\n+   *   single glyphs, of which @FT_Load_Glyph is most important.\n@@ -249,0 +262,7 @@\n+   * @order:\n+   *   FT_GlyphSlot\n+   *   FT_GlyphSlotRec\n+   *   FT_Glyph_Metrics\n+   *\n+   *   FT_Load_Glyph\n+   *   FT_LOAD_XXX\n@@ -250,0 +270,1 @@\n+   *   FT_LOAD_TARGET_XXX\n@@ -257,0 +278,25 @@\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   character_mapping\n+   *\n+   * @title:\n+   *   Character Mapping\n+   *\n+   * @abstract:\n+   *   Functions to manage character-to-glyph maps.\n+   *\n+   * @description:\n+   *   This section holds functions and structures that are related to\n+   *   mapping character input codes to glyph indices.\n+   *\n+   *   Note that for many scripts the simplistic approach used by FreeType\n+   *   of mapping a single character to a single glyph is not valid or\n+   *   possible!  In general, a higher-level library like HarfBuzz or ICU\n+   *   should be used for handling text strings.\n+   *\n+   * @order:\n+   *   FT_CharMap\n@@ -258,0 +304,3 @@\n+   *   FT_Encoding\n+   *   FT_ENC_TAG\n+   *\n@@ -262,0 +311,26 @@\n+   *   FT_Get_Char_Index\n+   *   FT_Get_First_Char\n+   *   FT_Get_Next_Char\n+   *   FT_Load_Char\n+   *\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   information_retrieval\n+   *\n+   * @title:\n+   *   Information Retrieval\n+   *\n+   * @abstract:\n+   *   Functions to retrieve font and glyph information.\n+   *\n+   * @description:\n+   *   Functions to retrieve font and glyph information.  Only some very\n+   *   basic data is covered; see also the chapter on the format-specific\n+   *   API for more.\n+   *\n+   *\n+   * @order:\n@@ -266,0 +341,1 @@\n+   *   FT_FSTYPE_XXX\n@@ -267,0 +343,15 @@\n+   *   FT_SUBGLYPH_FLAG_XXX\n+   *\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   other_api_data\n+   *\n+   * @title:\n+   *   Other API Data\n+   *\n+   * @abstract:\n+   *   Other structures, enumerations, and macros.\n@@ -268,0 +359,5 @@\n+   * @description:\n+   *   Other structures, enumerations, and macros.  Deprecated functions are\n+   *   also listed here.\n+   *\n+   * @order:\n@@ -272,7 +368,1 @@\n-   *   FT_FACE_FLAG_XXX\n-   *   FT_STYLE_FLAG_XXX\n-   *   FT_OPEN_XXX\n-   *   FT_LOAD_XXX\n-   *   FT_LOAD_TARGET_XXX\n-   *   FT_SUBGLYPH_FLAG_XXX\n-   *   FT_FSTYPE_XXX\n+   *   FT_SubGlyph\n@@ -281,0 +371,2 @@\n+   *   FT_Face_CheckTrueTypePatents\n+   *   FT_Face_SetUnpatentedHinting\n@@ -285,0 +377,16 @@\n+  \/*************************************************************************\/\n+  \/*************************************************************************\/\n+  \/*                                                                       *\/\n+  \/*                        B A S I C   T Y P E S                          *\/\n+  \/*                                                                       *\/\n+  \/*************************************************************************\/\n+  \/*************************************************************************\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   glyph_retrieval\n+   *\n+   *\/\n+\n@@ -352,0 +460,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   sizing_and_scaling\n+   *\n+   *\/\n+\n@@ -412,0 +527,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   library_setup\n+   *\n+   *\/\n+\n@@ -486,1 +608,1 @@\n-   *   base_interface\n+   *   face_creation\n@@ -522,0 +644,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   sizing_and_scaling\n+   *\n+   *\/\n+\n@@ -554,0 +683,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   glyph_retrieval\n+   *\n+   *\/\n+\n@@ -573,0 +709,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   character_mapping\n+   *\n+   *\/\n+\n@@ -880,0 +1023,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   other_api_data\n+   *\n+   *\/\n+\n@@ -895,0 +1045,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   face_creation\n+   *\n+   *\/\n+\n@@ -921,1 +1078,1 @@\n-   *     Bit 31 is always zero (this is, `face_index` is always a positive\n+   *     Bit 31 is always zero (that is, `face_index` is always a positive\n@@ -939,1 +1096,1 @@\n-   *     (sub)font.  Bit 31 is always zero (this is, `style_flags` is always\n+   *     (sub)font.  Bit 31 is always zero (that is, `style_flags` is always\n@@ -1005,1 +1162,1 @@\n-   *     Note that the bounding box does not vary in OpenType variable fonts\n+   *     Note that the bounding box does not vary in OpenType variation fonts\n@@ -1093,3 +1250,3 @@\n-    \/*# The following member variables (down to `underline_thickness`) *\/\n-    \/*# are only relevant to scalable outlines; cf. @FT_Bitmap_Size    *\/\n-    \/*# for bitmap fonts.                                              *\/\n+    \/* The following member variables (down to `underline_thickness`) *\/\n+    \/* are only relevant to scalable outlines; cf. @FT_Bitmap_Size    *\/\n+    \/* for bitmap fonts.                                              *\/\n@@ -1113,1 +1270,1 @@\n-    \/*@private begin *\/\n+    \/* private fields, internal to FreeType *\/\n@@ -1126,2 +1283,0 @@\n-    \/*@private end *\/\n-\n@@ -1210,1 +1365,1 @@\n-   *     Note that CID-keyed fonts that are in an SFNT wrapper (this is, all\n+   *     Note that CID-keyed fonts that are in an SFNT wrapper (that is, all\n@@ -1216,1 +1371,1 @@\n-   *     The face is 'tricky', this is, it always needs the font format's\n+   *     The face is 'tricky', that is, it always needs the font format's\n@@ -1238,2 +1393,2 @@\n-   *     @FT_Set_Var_Design_Coordinates, or @FT_Set_Var_Blend_Coordinates.\n-   *     This flag is unset by a call to @FT_Set_Named_Instance.\n+   *     @FT_Set_Var_Design_Coordinates, @FT_Set_Var_Blend_Coordinates, or\n+   *     @FT_Set_MM_WeightVector to select a non-default instance.\n@@ -1275,0 +1430,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   font_testing_macros\n+   *\n+   *\/\n+\n@@ -1384,0 +1546,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   other_api_data\n+   *\n+   *\/\n+\n@@ -1396,0 +1565,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   font_testing_macros\n+   *\n+   *\/\n+\n@@ -1454,2 +1630,2 @@\n-   *   @FT_Set_MM_Design_Coordinates, @FT_Set_Var_Design_Coordinates, or\n-   *   @FT_Set_Var_Blend_Coordinates.\n+   *   @FT_Set_MM_Design_Coordinates, @FT_Set_Var_Design_Coordinates,\n+   *   @FT_Set_Var_Blend_Coordinates, or @FT_Set_MM_WeightVector.\n@@ -1631,0 +1807,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   face_creation\n+   *\n+   *\/\n+\n@@ -1657,0 +1840,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   other_api_data\n+   *\n+   *\/\n+\n@@ -1669,0 +1859,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   sizing_and_scaling\n+   *\n+   *\/\n+\n@@ -1820,0 +2017,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   other_api_data\n+   *\n+   *\/\n+\n@@ -1851,0 +2055,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   glyph_retrieval\n+   *\n+   *\/\n+\n@@ -2095,0 +2306,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   library_setup\n+   *\n+   *\/\n+\n@@ -2152,0 +2370,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   face_creation\n+   *\n+   *\/\n+\n@@ -2454,1 +2679,1 @@\n-   *   One @FT_Library instance can have multiple face objects, this is,\n+   *   One @FT_Library instance can have multiple face objects, that is,\n@@ -2653,0 +2878,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   sizing_and_scaling\n+   *\n+   *\/\n+\n@@ -2682,1 +2914,1 @@\n-   *   if the default instance is active (this is, no glyph variation takes\n+   *   if the default instance is active (that is, no glyph variation takes\n@@ -2945,0 +3177,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   glyph_retrieval\n+   *\n+   *\/\n+\n@@ -2979,1 +3218,1 @@\n-   *   for invalid CID values (this is, for CID values that don't have a\n+   *   for invalid CID values (that is, for CID values that don't have a\n@@ -2993,0 +3232,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   character_mapping\n+   *\n+   *\/\n+\n@@ -3036,0 +3282,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   glyph_retrieval\n+   *\n+   *\/\n+\n@@ -3175,4 +3428,5 @@\n-   *     set the `format` field of @FT_GlyphSlotRec to @FT_GLYPH_FORMAT_SVG.\n-   *     Note that FreeType itself can't render SVG documents; however, the\n-   *     library provides hooks to seamlessly integrate an external renderer.\n-   *     See sections @ot_svg_driver and @svg_fonts for more.\n+   *     set the `format` field of @FT_GlyphSlotRec to @FT_GLYPH_FORMAT_SVG\n+   *     ([since 2.13.1] provided @FT_LOAD_NO_SVG is not set).  Note that\n+   *     FreeType itself can't render SVG documents; however, the library\n+   *     provides hooks to seamlessly integrate an external renderer.  See\n+   *     sections @ot_svg_driver and @svg_fonts for more.\n@@ -3192,0 +3446,3 @@\n+   *   FT_LOAD_NO_SVG ::\n+   *     [Since 2.13.1] Ignore SVG glyph data when loading.\n+   *\n@@ -3257,0 +3514,1 @@\n+#define FT_LOAD_NO_SVG                       ( 1L << 24 )\n@@ -3375,0 +3633,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   sizing_and_scaling\n+   *\n+   *\/\n+\n@@ -3450,0 +3715,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   glyph_retrieval\n+   *\n+   *\/\n+\n@@ -3844,0 +4116,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   character_mapping\n+   *\n+   *\/\n+\n@@ -4060,0 +4339,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   face_creation\n+   *\n+   *\/\n+\n@@ -4158,0 +4444,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   information_retrieval\n+   *\n+   *\/\n+\n@@ -4269,3 +4562,4 @@\n-   *   the font has corresponding entries in its 'fvar' table).  If\n-   *   @FT_IS_VARIATION returns true, the algorithmically derived PostScript\n-   *   name is provided, not looking up special entries for named instances.\n+   *   the font has corresponding entries in its 'fvar' table or is the\n+   *   default named instance).  If @FT_IS_VARIATION returns true, the\n+   *   algorithmically derived PostScript name is provided, not looking up\n+   *   special entries for named instances.\n@@ -4903,22 +5197,1 @@\n-   *   version\n-   *\n-   * @title:\n-   *   FreeType Version\n-   *\n-   * @abstract:\n-   *   Functions and macros related to FreeType versions.\n-   *\n-   * @description:\n-   *   Note that those functions and macros are of limited use because even a\n-   *   new release of FreeType with only documentation changes increases the\n-   *   version number.\n-   *\n-   * @order:\n-   *   FT_Library_Version\n-   *\n-   *   FREETYPE_MAJOR\n-   *   FREETYPE_MINOR\n-   *   FREETYPE_PATCH\n-   *\n-   *   FT_Face_CheckTrueTypePatents\n-   *   FT_Face_SetUnpatentedHinting\n+   *   library_setup\n@@ -4928,1 +5201,0 @@\n-\n@@ -4953,1 +5225,1 @@\n-#define FREETYPE_PATCH  0\n+#define FREETYPE_PATCH  2\n@@ -4995,0 +5267,7 @@\n+  \/**************************************************************************\n+   *\n+   * @section:\n+   *   other_api_data\n+   *\n+   *\/\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/freetype.h","additions":421,"deletions":142,"binary":false,"changes":563,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-   *   version\n@@ -36,1 +35,21 @@\n-   *   base_interface\n+   *   library_setup\n+   *   face_creation\n+   *   font_testing_macros\n+   *   sizing_and_scaling\n+   *   glyph_retrieval\n+   *   character_mapping\n+   *   information_retrieval\n+   *   other_api_data\n+   *\n+   *\/\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @chapter:\n+   *   extended_api\n+   *\n+   * @title:\n+   *   Extended API\n+   *\n+   * @sections:\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftchapters.h","additions":21,"deletions":2,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -137,1 +137,1 @@\n-   *   Hstems (this is, hint values defined in the font to help align\n+   *   Hstems (that is, hint values defined in the font to help align\n@@ -449,1 +449,1 @@\n-   *   switched off by default (this is, `no-stem-darkening` is set to TRUE\n+   *   switched off by default (that is, `no-stem-darkening` is set to TRUE\n@@ -654,5 +654,2 @@\n-   *     Version~38 corresponds to MS rasterizer v.1.9; it is roughly\n-   *     equivalent to the hinting provided by DirectWrite ClearType (as can\n-   *     be found, for example, in the Internet Explorer~9 running on\n-   *     Windows~7).  It is used in FreeType to select the 'Infinality'\n-   *     subpixel hinting code.  The code may be removed in a future version.\n+   *     Version~38 is the same Version~40. The original 'Infinality' code is\n+   *     no longer available.\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftdriver.h","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -22,1 +22,1 @@\n-   *       FT_Outlines into FT_Bitmaps.\n+   *       `FT_Outline`s into `FT_Bitmap`s.\n@@ -259,0 +259,6 @@\n+   *\n+   * @note:\n+   *   `width` and `rows` refer to the *physical* size of the bitmap, not the\n+   *   *logical* one.  For example, if @FT_Pixel_Mode is set to\n+   *   `FT_PIXEL_MODE_LCD`, the logical width is a just a third of the\n+   *   physical one.\n@@ -859,1 +865,1 @@\n-   *   this is, from completely transparent to completely opaque.\n+   *   that is, from completely transparent to completely opaque.\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftimage.h","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-   *   FT_Trace_Set_Level( \"any:7 memory:0 );\n+   *   FT_Trace_Set_Level( \"any:7 memory:0\" );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftlogging.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -156,1 +156,1 @@\n-   *   values are integers.\n+   *   values are whole numbers (i.e., the fractional part is zero).\n@@ -402,2 +402,2 @@\n-   *   OpenType variation fonts.  For Adobe MM fonts, the values are\n-   *   integers.\n+   *   OpenType variation fonts.  For Adobe MM fonts, the values are supposed\n+   *   to be whole numbers (i.e., the fractional part is zero).\n@@ -449,2 +449,2 @@\n-   *   OpenType variation fonts.  For Adobe MM fonts, the values are\n-   *   integers.\n+   *   OpenType variation fonts.  For Adobe MM fonts, the values are whole\n+   *   numbers (i.e., the fractional part is zero).\n@@ -605,1 +605,1 @@\n-   *   length of the weight vector to~16.\n+   *   length of the weight vector to 16~elements.\n@@ -607,2 +607,4 @@\n-   *   If `len` is zero and `weightvector` is `NULL`, the weight vector array\n-   *   is reset to the default values.\n+   *   If `len` is larger than zero, this function sets the\n+   *   @FT_FACE_FLAG_VARIATION bit in @FT_Face's `face_flags` field (i.e.,\n+   *   @FT_IS_VARIATION will return true).  If `len` is zero, this bit flag\n+   *   is unset and the weight vector array is reset to the default values.\n@@ -756,0 +758,39 @@\n+\n+  \/**************************************************************************\n+   *\n+   * @function:\n+   *   FT_Get_Default_Named_Instance\n+   *\n+   * @description:\n+   *   Retrieve the index of the default named instance, to be used with\n+   *   @FT_Set_Named_Instance.\n+   *\n+   *   The default instance of a variation font is that instance for which\n+   *   the nth axis coordinate is equal to `axis[n].def` (as specified in the\n+   *   @FT_MM_Var structure), with~n covering all axes.\n+   *\n+   *   FreeType synthesizes a named instance for the default instance if the\n+   *   font does not contain such an entry.\n+   *\n+   * @input:\n+   *   face ::\n+   *     A handle to the source face.\n+   *\n+   * @output:\n+   *   instance_index ::\n+   *     The index of the default named instance.\n+   *\n+   * @return:\n+   *   FreeType error code.  0~means success.\n+   *\n+   * @note:\n+   *   For Adobe MM fonts (which don't have named instances) this function\n+   *   always returns zero for `instance_index`.\n+   *\n+   * @since:\n+   *   2.13.1\n+   *\/\n+  FT_EXPORT( FT_Error )\n+  FT_Get_Default_Named_Instance( FT_Face   face,\n+                                 FT_UInt  *instance_index );\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftmm.h","additions":49,"deletions":8,"binary":false,"changes":57,"status":"modified"},{"patch":"@@ -121,1 +121,1 @@\n-   *   (doing nothing, this is, not calling any emitter); if necessary, you\n+   *   (doing nothing, that is, not calling any emitter); if necessary, you\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftoutln.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -161,1 +161,1 @@\n-    FT_Raster_Funcs*           raster_class;\n+    const FT_Raster_Funcs*     raster_class;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftrender.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -71,0 +71,12 @@\n+  \/* Precisely adjust the glyph weight either horizontally or vertically.  *\/\n+  \/* The `xdelta` and `ydelta` values are fractions of the face Em size    *\/\n+  \/* (in fixed-point format).  Considering that a regular face would have  *\/\n+  \/* stem widths on the order of 0.1 Em, a delta of 0.05 (0x0CCC) should   *\/\n+  \/* be very noticeable.  To increase or decrease the weight, use positive *\/\n+  \/* or negative values, respectively.                                     *\/\n+  FT_EXPORT( void )\n+  FT_GlyphSlot_AdjustWeight( FT_GlyphSlot  slot,\n+                             FT_Fixed      xdelta,\n+                             FT_Fixed      ydelta );\n+\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftsynth.h","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -232,2 +232,1 @@\n-   *     The offset from the start of the stream to seek to if this is a seek\n-   *     operation (see note).\n+   *     The offset from the start of the stream to seek to.\n@@ -242,10 +241,3 @@\n-   *   The number of bytes effectively read by the stream.\n-   *\n-   * @note:\n-   *   This function performs a seek *or* a read operation depending on the\n-   *   argument values.  If `count` is zero, the operation is a seek to\n-   *   `offset` bytes.  If `count` is >~0, the operation is a read of `count`\n-   *   bytes from the current position in the stream, and the `offset` value\n-   *   should be ignored.\n-   *\n-   *   For seek operations, a non-zero return value indicates an error.\n+   *   If count >~0, return the number of bytes effectively read by the\n+   *   stream (after seeking to `offset`).  If count ==~0, return the status\n+   *   of the seek operation (non-zero indicates an error).\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/ftsystem.h","additions":4,"deletions":12,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -44,2 +44,5 @@\n-#  elif ( defined( __GNUC__ ) && __GNUC__ >= 7 )          || \\\n-        ( defined( __clang__ ) && __clang_major__ >= 10 )\n+#  elif ( defined( __GNUC__ ) && __GNUC__ >= 7 )       || \\\n+        ( defined( __clang__ )                      &&    \\\n+          ( defined( __apple_build_version__ )            \\\n+              ? __apple_build_version__ >= 12000000       \\\n+              : __clang_major__ >= 10 ) )\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/compiler-macros.h","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -335,1 +335,1 @@\n-   *   50 * abs(xx*yy - xy*yx) < xx^2 + xy^2 + yx^2 + yy^2\n+   *   32 * abs(xx*yy - xy*yx) < xx^2 + xy^2 + yx^2 + yy^2\n@@ -337,1 +337,1 @@\n-   * Value 50 is heuristic.\n+   * Value 32 is heuristic.\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/ftcalc.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -160,0 +160,1 @@\n+   *\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/ftdrv.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -31,7 +31,13 @@\n-    FT_UInt            itemCount;       \/* number of delta sets per item    *\/\n-    FT_UInt            regionIdxCount;  \/* number of region indices         *\/\n-    FT_UInt*           regionIndices;   \/* array of `regionCount' indices;  *\/\n-                                        \/* these index `varRegionList'      *\/\n-    FT_ItemVarDelta*   deltaSet;        \/* array of `itemCount' deltas      *\/\n-                                        \/* use `innerIndex' for this array  *\/\n-\n+    FT_UInt            itemCount;      \/* Number of delta sets per item.   *\/\n+    FT_UInt            regionIdxCount; \/* Number of region indices.        *\/\n+    FT_UInt*           regionIndices;  \/* Array of `regionCount` indices;  *\/\n+                                       \/* these index `varRegionList`.     *\/\n+    FT_Byte*           deltaSet;       \/* Array of `itemCount` deltas;     *\/\n+                                       \/* use `innerIndex` for this array. *\/\n+    FT_UShort          wordDeltaCount; \/* Number of the first 32-bit ints  *\/\n+                                       \/* or 16-bit ints of `deltaSet`     *\/\n+                                       \/* depending on `longWords`.        *\/\n+    FT_Bool            longWords;      \/* If true, `deltaSet` is a 32-bit  *\/\n+                                       \/* array followed by a 16-bit       *\/\n+                                       \/* array, otherwise a 16-bit array  *\/\n+                                       \/* followed by an 8-bit array.      *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/ftmmtypes.h","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -80,0 +80,3 @@\n+  typedef FT_Error\n+  (*FT_Size_Reset_Func)( FT_Size  size );\n+\n@@ -93,0 +96,1 @@\n+    FT_Size_Reset_Func       size_reset;\n@@ -104,1 +108,2 @@\n-                                                metrics_adjust_  ) \\\n+                                                metrics_adjust_,   \\\n+                                                size_reset_      ) \\\n@@ -114,1 +119,2 @@\n-    metrics_adjust_                                                \\\n+    metrics_adjust_,                                               \\\n+    size_reset_                                                    \\\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/services\/svmetric.h","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -63,3 +63,3 @@\n-  (*FT_Set_MM_Blend_Func)( FT_Face   face,\n-                           FT_UInt   num_coords,\n-                           FT_Long*  coords );\n+  (*FT_Set_MM_Blend_Func)( FT_Face    face,\n+                           FT_UInt    num_coords,\n+                           FT_Fixed*  coords );\n@@ -73,2 +73,2 @@\n-  (*FT_Set_Instance_Func)( FT_Face  face,\n-                           FT_UInt  instance_index );\n+  (*FT_Set_Named_Instance_Func)( FT_Face  face,\n+                                 FT_UInt  instance_index );\n@@ -77,3 +77,7 @@\n-  (*FT_Get_MM_Blend_Func)( FT_Face   face,\n-                           FT_UInt   num_coords,\n-                           FT_Long*  coords );\n+  (*FT_Get_Default_Named_Instance_Func)( FT_Face   face,\n+                                         FT_UInt  *instance_index );\n+\n+  typedef FT_Error\n+  (*FT_Get_MM_Blend_Func)( FT_Face    face,\n+                           FT_UInt    num_coords,\n+                           FT_Fixed*  coords );\n@@ -89,1 +93,1 @@\n-  (*FT_Done_Blend_Func)( FT_Face );\n+  (*FT_Done_Blend_Func)( FT_Face  face );\n@@ -101,0 +105,3 @@\n+  typedef void\n+  (*FT_Construct_PS_Name_Func)( FT_Face  face );\n+\n@@ -137,1 +144,2 @@\n-    FT_Set_Instance_Func                  set_instance;\n+    FT_Set_Named_Instance_Func            set_named_instance;\n+    FT_Get_Default_Named_Instance_Func    get_default_named_instance;\n@@ -142,0 +150,1 @@\n+    FT_Construct_PS_Name_Func             construct_ps_name;\n@@ -152,37 +161,43 @@\n-#define FT_DEFINE_SERVICE_MULTIMASTERSREC( class_,                  \\\n-                                           get_mm_,                 \\\n-                                           set_mm_design_,          \\\n-                                           set_mm_blend_,           \\\n-                                           get_mm_blend_,           \\\n-                                           get_mm_var_,             \\\n-                                           set_var_design_,         \\\n-                                           get_var_design_,         \\\n-                                           set_instance_,           \\\n-                                           set_weightvector_,       \\\n-                                           get_weightvector_,       \\\n-                                           load_delta_set_idx_map_, \\\n-                                           load_item_var_store_,    \\\n-                                           get_item_delta_,         \\\n-                                           done_item_var_store_,    \\\n-                                           done_delta_set_idx_map_, \\\n-                                           get_var_blend_,          \\\n-                                           done_blend_ )            \\\n-  static const FT_Service_MultiMastersRec  class_ =                 \\\n-  {                                                                 \\\n-    get_mm_,                                                        \\\n-    set_mm_design_,                                                 \\\n-    set_mm_blend_,                                                  \\\n-    get_mm_blend_,                                                  \\\n-    get_mm_var_,                                                    \\\n-    set_var_design_,                                                \\\n-    get_var_design_,                                                \\\n-    set_instance_,                                                  \\\n-    set_weightvector_,                                              \\\n-    get_weightvector_,                                              \\\n-    load_delta_set_idx_map_,                                        \\\n-    load_item_var_store_,                                           \\\n-    get_item_delta_,                                                \\\n-    done_item_var_store_,                                           \\\n-    done_delta_set_idx_map_,                                        \\\n-    get_var_blend_,                                                 \\\n-    done_blend_                                                     \\\n+#define FT_DEFINE_SERVICE_MULTIMASTERSREC( class_,                      \\\n+                                           get_mm_,                     \\\n+                                           set_mm_design_,              \\\n+                                           set_mm_blend_,               \\\n+                                           get_mm_blend_,               \\\n+                                           get_mm_var_,                 \\\n+                                           set_var_design_,             \\\n+                                           get_var_design_,             \\\n+                                           set_named_instance_,         \\\n+                                           get_default_named_instance_, \\\n+                                           set_mm_weightvector_,        \\\n+                                           get_mm_weightvector_,        \\\n+                                                                        \\\n+                                           construct_ps_name_,          \\\n+                                           load_delta_set_idx_map_,     \\\n+                                           load_item_var_store_,        \\\n+                                           get_item_delta_,             \\\n+                                           done_item_var_store_,        \\\n+                                           done_delta_set_idx_map_,     \\\n+                                           get_var_blend_,              \\\n+                                           done_blend_ )                \\\n+  static const FT_Service_MultiMastersRec  class_ =                     \\\n+  {                                                                     \\\n+    get_mm_,                                                            \\\n+    set_mm_design_,                                                     \\\n+    set_mm_blend_,                                                      \\\n+    get_mm_blend_,                                                      \\\n+    get_mm_var_,                                                        \\\n+    set_var_design_,                                                    \\\n+    get_var_design_,                                                    \\\n+    set_named_instance_,                                                \\\n+    get_default_named_instance_,                                        \\\n+    set_mm_weightvector_,                                               \\\n+    get_mm_weightvector_,                                               \\\n+                                                                        \\\n+    construct_ps_name_,                                                 \\\n+    load_delta_set_idx_map_,                                            \\\n+    load_item_var_store_,                                               \\\n+    get_item_delta_,                                                    \\\n+    done_item_var_store_,                                               \\\n+    done_delta_set_idx_map_,                                            \\\n+    get_var_blend_,                                                     \\\n+    done_blend_                                                         \\\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/services\/svmm.h","additions":62,"deletions":47,"binary":false,"changes":109,"status":"modified"},{"patch":"@@ -100,1 +100,1 @@\n-  typedef FT_UInt32\n+  typedef FT_UInt\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/services\/svpscmap.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -204,7 +204,7 @@\n-    FT_FaceRec      root;\n-    T1_FontRec      type1;\n-    const void*     psnames;\n-    const void*     psaux;\n-    const void*     afm_data;\n-    FT_CharMapRec   charmaprecs[2];\n-    FT_CharMap      charmaps[2];\n+    FT_FaceRec     root;\n+    T1_FontRec     type1;\n+    const void*    psnames;\n+    const void*    psaux;\n+    const void*    afm_data;\n+    FT_CharMapRec  charmaprecs[2];\n+    FT_CharMap     charmaps[2];\n@@ -213,1 +213,1 @@\n-    PS_Blend        blend;\n+    PS_Blend       blend;\n@@ -218,2 +218,2 @@\n-    FT_Int           ndv_idx;\n-    FT_Int           cdv_idx;\n+    FT_Int         ndv_idx;\n+    FT_Int         cdv_idx;\n@@ -223,2 +223,2 @@\n-    FT_UInt          len_buildchar;\n-    FT_Long*         buildchar;\n+    FT_UInt        len_buildchar;\n+    FT_Long*       buildchar;\n@@ -227,1 +227,1 @@\n-    const void*     pshinter;\n+    const void*    pshinter;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/t1types.h","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -782,1 +782,1 @@\n-   *   TT_Post_20Rec\n+   *   TT_Post_NamesRec\n@@ -785,2 +785,1 @@\n-   *   Postscript names sub-table, format 2.0.  Stores the PS name of each\n-   *   glyph in the font face.\n+   *   Postscript names table, either format 2.0 or 2.5.\n@@ -789,0 +788,3 @@\n+   *   loaded ::\n+   *     A flag to indicate whether the PS names are loaded.\n+   *\n@@ -801,1 +803,1 @@\n-  typedef struct  TT_Post_20Rec_\n+  typedef struct  TT_Post_NamesRec_\n@@ -803,0 +805,1 @@\n+    FT_Bool     loaded;\n@@ -806,57 +809,1 @@\n-    FT_Char**   glyph_names;\n-\n-  } TT_Post_20Rec, *TT_Post_20;\n-\n-\n-  \/**************************************************************************\n-   *\n-   * @struct:\n-   *   TT_Post_25Rec\n-   *\n-   * @description:\n-   *   Postscript names sub-table, format 2.5.  Stores the PS name of each\n-   *   glyph in the font face.\n-   *\n-   * @fields:\n-   *   num_glyphs ::\n-   *     The number of glyphs in the table.\n-   *\n-   *   offsets ::\n-   *     An array of signed offsets in a normal Mac Postscript name encoding.\n-   *\/\n-  typedef struct  TT_Post_25_\n-  {\n-    FT_UShort  num_glyphs;\n-    FT_Char*   offsets;\n-\n-  } TT_Post_25Rec, *TT_Post_25;\n-\n-\n-  \/**************************************************************************\n-   *\n-   * @struct:\n-   *   TT_Post_NamesRec\n-   *\n-   * @description:\n-   *   Postscript names table, either format 2.0 or 2.5.\n-   *\n-   * @fields:\n-   *   loaded ::\n-   *     A flag to indicate whether the PS names are loaded.\n-   *\n-   *   format_20 ::\n-   *     The sub-table used for format 2.0.\n-   *\n-   *   format_25 ::\n-   *     The sub-table used for format 2.5.\n-   *\/\n-  typedef struct  TT_Post_NamesRec_\n-  {\n-    FT_Bool  loaded;\n-\n-    union\n-    {\n-      TT_Post_20Rec  format_20;\n-      TT_Post_25Rec  format_25;\n-\n-    } names;\n+    FT_Byte**   glyph_names;\n@@ -1256,2 +1203,3 @@\n-   *   var ::\n-   *     A pointer to the Metrics Variations service.\n+   *   tt_var ::\n+   *     A pointer to the Metrics Variations service for the \"truetype\"\n+   *     driver.\n@@ -1259,3 +1207,6 @@\n-   *   hdmx ::\n-   *     The face's horizontal device metrics ('hdmx' table).  This table is\n-   *     optional in TrueType\/OpenType fonts.\n+   *   face_var ::\n+   *     A pointer to the Metrics Variations service for this `TT_Face`'s\n+   *     driver.\n+   *\n+   *   psaux ::\n+   *     A pointer to the PostScript Auxiliary service.\n@@ -1367,0 +1318,6 @@\n+   *   var_default_named_instance ::\n+   *     The index of the default named instance.\n+   *\n+   *   non_var_style_name ::\n+   *     The non-variation style name, used as a backup.\n+   *\n@@ -1413,8 +1370,0 @@\n-   *   cpal ::\n-   *     A pointer to data related to the 'CPAL' table.  `NULL` if the table\n-   *     is not available.\n-   *\n-   *   colr ::\n-   *     A pointer to data related to the 'COLR' table.  `NULL` if the table\n-   *     is not available.\n-   *\n@@ -1448,8 +1397,0 @@\n-   *   sph_found_func_flags ::\n-   *     Flags identifying special bytecode functions (used by the v38\n-   *     implementation of the bytecode interpreter).\n-   *\n-   *   sph_compatibility_mode ::\n-   *     This flag is set if we are in ClearType backward compatibility mode\n-   *     (used by the v38 implementation of the bytecode interpreter).\n-   *\n@@ -1461,0 +1402,12 @@\n+   *\n+   *   cpal ::\n+   *     A pointer to data related to the 'CPAL' table.  `NULL` if the table\n+   *     is not available.\n+   *\n+   *   colr ::\n+   *     A pointer to data related to the 'COLR' table.  `NULL` if the table\n+   *     is not available.\n+   *\n+   *   svg ::\n+   *     A pointer to data related to the 'SVG' table.  `NULL` if the table\n+   *     is not available.\n@@ -1511,2 +1464,8 @@\n-    \/* used to handle the HVAR, VVAR, and MVAR OpenType tables         *\/\n-    void*                 var;\n+    \/* used to handle the HVAR, VVAR, and MVAR OpenType tables by the  *\/\n+    \/* \"truetype\" driver                                               *\/\n+    void*                 tt_var;\n+\n+    \/* a typeless pointer to the FT_Service_MetricsVariationsRec table *\/\n+    \/* used to handle the HVAR, VVAR, and MVAR OpenType tables by this *\/\n+    \/* TT_Face's driver                                                *\/\n+    void*                 face_var;             \/* since 2.13.1 *\/\n@@ -1594,0 +1553,3 @@\n+    FT_UInt               var_default_named_instance;  \/* since 2.13.1 *\/\n+\n+    const char*           non_var_style_name;  \/* since 2.13.1 *\/\n@@ -1630,7 +1592,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    \/* since 2.4.12 *\/\n-    FT_ULong              sph_found_func_flags; \/* special functions found *\/\n-                                                \/* for this face           *\/\n-    FT_Bool               sph_compatibility_mode;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/include\/freetype\/internal\/tttypes.h","additions":46,"deletions":91,"binary":false,"changes":137,"status":"modified"},{"patch":"@@ -92,1 +92,1 @@\n-  \/\/ guaranteed to have the same vertical position with joining (this is,\n+  \/\/ guaranteed to have the same vertical position with joining (that is,\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afblue.dat","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -420,2 +420,1 @@\n-          FT_Int  first = 0;\n-          FT_Int  last  = -1;\n+          FT_Int  pp, first, last;\n@@ -424,1 +423,2 @@\n-          for ( nn = 0; nn < outline.n_contours; first = last + 1, nn++ )\n+          last = -1;\n+          for ( nn = 0; nn < outline.n_contours; nn++ )\n@@ -426,4 +426,2 @@\n-            FT_Int  pp;\n-\n-\n-            last = outline.contours[nn];\n+            first = last + 1;\n+            last  = outline.contours[nn];\n@@ -572,2 +570,2 @@\n-    FT_Bool   started = 0, same_width = 1;\n-    FT_Fixed  advance = 0, old_advance = 0;\n+    FT_Bool  started = 0, same_width = 1;\n+    FT_Long  advance = 0, old_advance = 0;\n@@ -638,2 +636,2 @@\n-  af_cjk_metrics_init( AF_CJKMetrics  metrics,\n-                       FT_Face        face )\n+  af_cjk_metrics_init( AF_StyleMetrics  metrics_,  \/* AF_CJKMetrics *\/\n+                       FT_Face          face )\n@@ -641,1 +639,2 @@\n-    FT_CharMap  oldmap = face->charmap;\n+    AF_CJKMetrics  metrics = (AF_CJKMetrics)metrics_;\n+    FT_CharMap     oldmap  = face->charmap;\n@@ -759,2 +758,2 @@\n-  af_cjk_metrics_scale( AF_CJKMetrics  metrics,\n-                        AF_Scaler      scaler )\n+  af_cjk_metrics_scale( AF_StyleMetrics  metrics_,   \/* AF_CJKMetrics *\/\n+                        AF_Scaler        scaler )\n@@ -762,0 +761,3 @@\n+    AF_CJKMetrics  metrics = (AF_CJKMetrics)metrics_;\n+\n+\n@@ -774,4 +776,4 @@\n-  FT_LOCAL_DEF( void )\n-  af_cjk_get_standard_widths( AF_CJKMetrics  metrics,\n-                              FT_Pos*        stdHW,\n-                              FT_Pos*        stdVW )\n+  FT_CALLBACK_DEF( void )\n+  af_cjk_get_standard_widths( AF_StyleMetrics  metrics_,  \/* AF_CJKMetrics *\/\n+                              FT_Pos*          stdHW,\n+                              FT_Pos*          stdVW )\n@@ -779,0 +781,3 @@\n+    AF_CJKMetrics  metrics = (AF_CJKMetrics)metrics_;\n+\n+\n@@ -1379,2 +1384,2 @@\n-  af_cjk_hints_init( AF_GlyphHints  hints,\n-                     AF_CJKMetrics  metrics )\n+  af_cjk_hints_init( AF_GlyphHints    hints,\n+                     AF_StyleMetrics  metrics_ )   \/* AF_CJKMetrics *\/\n@@ -1382,0 +1387,1 @@\n+    AF_CJKMetrics   metrics = (AF_CJKMetrics)metrics_;\n@@ -1631,1 +1637,1 @@\n-    FT_TRACE5(( \"  CJKLINK: edge %ld @%d (opos=%.2f) linked to %.2f,\"\n+    FT_TRACE5(( \"  CJKLINK: edge %td @%d (opos=%.2f) linked to %.2f,\"\n@@ -1855,1 +1861,1 @@\n-        FT_TRACE5(( \"  CJKBLUE: edge %ld @%d (opos=%.2f) snapped to %.2f,\"\n+        FT_TRACE5(( \"  CJKBLUE: edge %td @%d (opos=%.2f) snapped to %.2f,\"\n@@ -1919,1 +1925,1 @@\n-        FT_TRACE5(( \"ASSERTION FAILED for edge %ld\\n\", edge2-edges ));\n+        FT_TRACE5(( \"ASSERTION FAILED for edge %td\\n\", edge2 - edges ));\n@@ -2271,4 +2277,4 @@\n-  af_cjk_hints_apply( FT_UInt        glyph_index,\n-                      AF_GlyphHints  hints,\n-                      FT_Outline*    outline,\n-                      AF_CJKMetrics  metrics )\n+  af_cjk_hints_apply( FT_UInt          glyph_index,\n+                      AF_GlyphHints    hints,\n+                      FT_Outline*      outline,\n+                      AF_StyleMetrics  metrics_ )   \/* AF_CJKMetrics *\/\n@@ -2276,0 +2282,2 @@\n+    AF_CJKMetrics  metrics = (AF_CJKMetrics)metrics_;\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afcjk.c","additions":35,"deletions":27,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -106,2 +106,2 @@\n-  af_cjk_metrics_init( AF_CJKMetrics  metrics,\n-                       FT_Face        face );\n+  af_cjk_metrics_init( AF_StyleMetrics  metrics,\n+                       FT_Face          face );\n@@ -110,2 +110,2 @@\n-  af_cjk_metrics_scale( AF_CJKMetrics  metrics,\n-                        AF_Scaler      scaler );\n+  af_cjk_metrics_scale( AF_StyleMetrics  metrics,\n+                        AF_Scaler        scaler );\n@@ -114,2 +114,2 @@\n-  af_cjk_hints_init( AF_GlyphHints  hints,\n-                     AF_CJKMetrics  metrics );\n+  af_cjk_hints_init( AF_GlyphHints    hints,\n+                     AF_StyleMetrics  metrics );\n@@ -118,4 +118,4 @@\n-  af_cjk_hints_apply( FT_UInt        glyph_index,\n-                      AF_GlyphHints  hints,\n-                      FT_Outline*    outline,\n-                      AF_CJKMetrics  metrics );\n+  af_cjk_hints_apply( FT_UInt          glyph_index,\n+                      AF_GlyphHints    hints,\n+                      FT_Outline*      outline,\n+                      AF_StyleMetrics  metrics );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afcjk.h","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -379,1 +379,1 @@\n-  af_face_globals_free( AF_FaceGlobals  globals )\n+  af_face_globals_free( void*  globals_ )\n@@ -381,0 +381,3 @@\n+    AF_FaceGlobals  globals = (AF_FaceGlobals)globals_;\n+\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afglobal.c","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -159,1 +159,1 @@\n-  af_face_globals_free( AF_FaceGlobals  globals );\n+  af_face_globals_free( void*  globals );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afglobal.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -323,2 +323,3 @@\n-  af_print_idx( char* p,\n-                int   idx )\n+  af_print_idx( char*   p,\n+                size_t  n,\n+                int     idx )\n@@ -333,1 +334,1 @@\n-      ft_sprintf( p, \"%d\", idx );\n+      ft_snprintf( p, n, \"%d\", idx );\n@@ -460,1 +461,1 @@\n-                af_print_idx( buf1,\n+                af_print_idx( buf1, 16,\n@@ -462,2 +463,2 @@\n-                af_print_idx( buf2, segment_idx_1 ),\n-                af_print_idx( buf3,\n+                af_print_idx( buf2, 16, segment_idx_1 ),\n+                af_print_idx( buf3, 16,\n@@ -465,1 +466,1 @@\n-                af_print_idx( buf4, segment_idx_0 ),\n+                af_print_idx( buf4, 16, segment_idx_0 ),\n@@ -479,12 +480,16 @@\n-                af_print_idx( buf5, af_get_strong_edge_index( hints,\n-                                                              point->before,\n-                                                              1 ) ),\n-                af_print_idx( buf6, af_get_strong_edge_index( hints,\n-                                                              point->after,\n-                                                              1 ) ),\n-                af_print_idx( buf7, af_get_strong_edge_index( hints,\n-                                                              point->before,\n-                                                              0 ) ),\n-                af_print_idx( buf8, af_get_strong_edge_index( hints,\n-                                                              point->after,\n-                                                              0 ) ) ));\n+                af_print_idx( buf5, 16,\n+                              af_get_strong_edge_index( hints,\n+                                                        point->before,\n+                                                        1 ) ),\n+                af_print_idx( buf6, 16,\n+                              af_get_strong_edge_index( hints,\n+                                                        point->after,\n+                                                        1 ) ),\n+                af_print_idx( buf7, 16,\n+                              af_get_strong_edge_index( hints,\n+                                                        point->before,\n+                                                        0 ) ),\n+                af_print_idx( buf8, 16,\n+                              af_get_strong_edge_index( hints,\n+                                                        point->after,\n+                                                        0 ) ) ));\n@@ -577,3 +582,6 @@\n-                  af_print_idx( buf1, AF_INDEX_NUM( seg->link, segments ) ),\n-                  af_print_idx( buf2, AF_INDEX_NUM( seg->serif, segments ) ),\n-                  af_print_idx( buf3, AF_INDEX_NUM( seg->edge, edges ) ),\n+                  af_print_idx( buf1, 16,\n+                                AF_INDEX_NUM( seg->link, segments ) ),\n+                  af_print_idx( buf2, 16,\n+                                AF_INDEX_NUM( seg->serif, segments ) ),\n+                  af_print_idx( buf3, 16,\n+                                AF_INDEX_NUM( seg->edge, edges ) ),\n@@ -719,2 +727,4 @@\n-                  af_print_idx( buf1, AF_INDEX_NUM( edge->link, edges ) ),\n-                  af_print_idx( buf2, AF_INDEX_NUM( edge->serif, edges ) ),\n+                  af_print_idx( buf1, 16,\n+                                AF_INDEX_NUM( edge->link, edges ) ),\n+                  af_print_idx( buf2, 16,\n+                                AF_INDEX_NUM( edge->serif, edges ) ),\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afhints.c","additions":34,"deletions":24,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -31,2 +31,2 @@\n-  af_indic_metrics_init( AF_CJKMetrics  metrics,\n-                         FT_Face        face )\n+  af_indic_metrics_init( AF_StyleMetrics  metrics_, \/* AF_CJKMetrics *\/\n+                         FT_Face          face )\n@@ -34,0 +34,3 @@\n+    AF_CJKMetrics  metrics = (AF_CJKMetrics)metrics_;\n+\n+\n@@ -58,2 +61,2 @@\n-  af_indic_metrics_scale( AF_CJKMetrics  metrics,\n-                          AF_Scaler      scaler )\n+  af_indic_metrics_scale( AF_StyleMetrics  metrics,\n+                          AF_Scaler        scaler )\n@@ -67,2 +70,2 @@\n-  af_indic_hints_init( AF_GlyphHints  hints,\n-                       AF_CJKMetrics  metrics )\n+  af_indic_hints_init( AF_GlyphHints    hints,\n+                       AF_StyleMetrics  metrics )\n@@ -76,4 +79,4 @@\n-  af_indic_hints_apply( FT_UInt        glyph_index,\n-                        AF_GlyphHints  hints,\n-                        FT_Outline*    outline,\n-                        AF_CJKMetrics  metrics )\n+  af_indic_hints_apply( FT_UInt          glyph_index,\n+                        AF_GlyphHints    hints,\n+                        FT_Outline*      outline,\n+                        AF_StyleMetrics  metrics )\n@@ -90,3 +93,3 @@\n-  af_indic_get_standard_widths( AF_CJKMetrics  metrics,\n-                                FT_Pos*        stdHW,\n-                                FT_Pos*        stdVW )\n+  af_indic_get_standard_widths( AF_StyleMetrics  metrics_, \/* AF_CJKMetrics *\/\n+                                FT_Pos*          stdHW,\n+                                FT_Pos*          stdVW )\n@@ -94,0 +97,3 @@\n+    AF_CJKMetrics  metrics = (AF_CJKMetrics)metrics_;\n+\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afindic.c","additions":19,"deletions":13,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -499,0 +499,2 @@\n+          best_contour_first = -1;\n+          best_contour_last  = -1;\n@@ -500,2 +502,0 @@\n-          best_contour_first = 0;  \/* ditto *\/\n-          best_contour_last  = 0;  \/* ditto *\/\n@@ -505,2 +505,1 @@\n-            FT_Int  first = 0;\n-            FT_Int  last  = -1;\n+            FT_Int  pp, first, last;\n@@ -509,1 +508,2 @@\n-            for ( nn = 0; nn < outline.n_contours; first = last + 1, nn++ )\n+            last = -1;\n+            for ( nn = 0; nn < outline.n_contours; nn++ )\n@@ -511,5 +511,2 @@\n-              FT_Int  old_best_point = best_point;\n-              FT_Int  pp;\n-\n-\n-              last = outline.contours[nn];\n+              first = last + 1;\n+              last  = outline.contours[nn];\n@@ -554,1 +551,1 @@\n-              if ( best_point != old_best_point )\n+              if ( best_point > best_contour_last )\n@@ -1028,1 +1025,1 @@\n-                      \" adjusting %s %ld to %ld\\n\",\n+                      \" adjusting %s %td to %ld\\n\",\n@@ -1071,2 +1068,2 @@\n-    FT_Bool   started = 0, same_width = 1;\n-    FT_Fixed  advance = 0, old_advance = 0;\n+    FT_Bool  started = 0, same_width = 1;\n+    FT_Long  advance = 0, old_advance = 0;\n@@ -1137,1 +1134,1 @@\n-  af_latin_metrics_init( AF_LatinMetrics  metrics,\n+  af_latin_metrics_init( AF_StyleMetrics  metrics_,   \/* AF_LatinMetrics *\/\n@@ -1140,0 +1137,2 @@\n+    AF_LatinMetrics  metrics = (AF_LatinMetrics)metrics_;\n+\n@@ -1492,1 +1491,1 @@\n-  af_latin_metrics_scale( AF_LatinMetrics  metrics,\n+  af_latin_metrics_scale( AF_StyleMetrics  metrics_,   \/* AF_LatinMetrics *\/\n@@ -1495,0 +1494,3 @@\n+    AF_LatinMetrics  metrics = (AF_LatinMetrics)metrics_;\n+\n+\n@@ -1507,2 +1509,2 @@\n-  FT_LOCAL_DEF( void )\n-  af_latin_get_standard_widths( AF_LatinMetrics  metrics,\n+  FT_CALLBACK_DEF( void )\n+  af_latin_get_standard_widths( AF_StyleMetrics  metrics_, \/* AF_LatinMetrics *\/\n@@ -1512,0 +1514,3 @@\n+    AF_LatinMetrics  metrics = (AF_LatinMetrics)metrics_;\n+\n+\n@@ -2044,1 +2049,1 @@\n-          \/* (this is, how much they overlap)                          *\/\n+          \/* (that is, how much they overlap)                          *\/\n@@ -2613,1 +2618,1 @@\n-                       AF_LatinMetrics  metrics )\n+                       AF_StyleMetrics  metrics_ )   \/* AF_LatinMetrics *\/\n@@ -2615,0 +2620,2 @@\n+    AF_LatinMetrics  metrics = (AF_LatinMetrics)metrics_;\n+\n@@ -2956,1 +2963,1 @@\n-    FT_TRACE5(( \"  LINK: edge %ld (opos=%.2f) linked to %.2f,\"\n+    FT_TRACE5(( \"  LINK: edge %td (opos=%.2f) linked to %.2f,\"\n@@ -3081,2 +3088,2 @@\n-          FT_TRACE5(( \"  BLUE_ANCHOR: edge %ld (opos=%.2f) snapped to %.2f,\"\n-                      \" was %.2f (anchor=edge %ld)\\n\",\n+          FT_TRACE5(( \"  BLUE_ANCHOR: edge %td (opos=%.2f) snapped to %.2f,\"\n+                      \" was %.2f (anchor=edge %td)\\n\",\n@@ -3087,1 +3094,1 @@\n-          FT_TRACE5(( \"  BLUE: edge %ld (opos=%.2f) snapped to %.2f,\"\n+          FT_TRACE5(( \"  BLUE: edge %td (opos=%.2f) snapped to %.2f,\"\n@@ -3137,1 +3144,1 @@\n-        FT_TRACE5(( \"  ASSERTION FAILED for edge %ld\\n\", edge2 - edges ));\n+        FT_TRACE5(( \"  ASSERTION FAILED for edge %td\\n\", edge2 - edges ));\n@@ -3205,1 +3212,1 @@\n-        FT_TRACE5(( \"  ANCHOR: edge %ld (opos=%.2f) and %ld (opos=%.2f)\"\n+        FT_TRACE5(( \"  ANCHOR: edge %td (opos=%.2f) and %td (opos=%.2f)\"\n@@ -3234,1 +3241,1 @@\n-          FT_TRACE5(( \"  ADJUST: edge %ld (pos=%.2f) moved to %.2f\\n\",\n+          FT_TRACE5(( \"  ADJUST: edge %td (pos=%.2f) moved to %.2f\\n\",\n@@ -3275,1 +3282,1 @@\n-          FT_TRACE5(( \"  STEM: edge %ld (opos=%.2f) linked to %ld (opos=%.2f)\"\n+          FT_TRACE5(( \"  STEM: edge %td (opos=%.2f) linked to %td (opos=%.2f)\"\n@@ -3306,1 +3313,1 @@\n-          FT_TRACE5(( \"  STEM: edge %ld (opos=%.2f) linked to %ld (opos=%.2f)\"\n+          FT_TRACE5(( \"  STEM: edge %td (opos=%.2f) linked to %td (opos=%.2f)\"\n@@ -3329,1 +3336,1 @@\n-            FT_TRACE5(( \"  BOUND: edge %ld (pos=%.2f) moved to %.2f\\n\",\n+            FT_TRACE5(( \"  BOUND: edge %td (pos=%.2f) moved to %.2f\\n\",\n@@ -3431,1 +3438,1 @@\n-          FT_TRACE5(( \"  SERIF: edge %ld (opos=%.2f) serif to %ld (opos=%.2f)\"\n+          FT_TRACE5(( \"  SERIF: edge %td (opos=%.2f) serif to %td (opos=%.2f)\"\n@@ -3441,1 +3448,1 @@\n-          FT_TRACE5(( \"  SERIF_ANCHOR: edge %ld (opos=%.2f)\"\n+          FT_TRACE5(( \"  SERIF_ANCHOR: edge %td (opos=%.2f)\"\n@@ -3443,1 +3450,1 @@\n-                      edge-edges,\n+                      edge - edges,\n@@ -3470,2 +3477,2 @@\n-            FT_TRACE5(( \"  SERIF_LINK1: edge %ld (opos=%.2f) snapped to %.2f\"\n-                        \" from %ld (opos=%.2f)\\n\",\n+            FT_TRACE5(( \"  SERIF_LINK1: edge %td (opos=%.2f) snapped to %.2f\"\n+                        \" from %td (opos=%.2f)\\n\",\n@@ -3480,1 +3487,1 @@\n-            FT_TRACE5(( \"  SERIF_LINK2: edge %ld (opos=%.2f)\"\n+            FT_TRACE5(( \"  SERIF_LINK2: edge %td (opos=%.2f)\"\n@@ -3501,1 +3508,1 @@\n-            FT_TRACE5(( \"  BOUND: edge %ld (pos=%.2f) moved to %.2f\\n\",\n+            FT_TRACE5(( \"  BOUND: edge %td (pos=%.2f) moved to %.2f\\n\",\n@@ -3522,1 +3529,1 @@\n-            FT_TRACE5(( \"  BOUND: edge %ld (pos=%.2f) moved to %.2f\\n\",\n+            FT_TRACE5(( \"  BOUND: edge %td (pos=%.2f) moved to %.2f\\n\",\n@@ -3550,1 +3557,1 @@\n-                        AF_LatinMetrics  metrics )\n+                        AF_StyleMetrics  metrics_ )    \/* AF_LatinMetrics *\/\n@@ -3552,0 +3559,2 @@\n+    AF_LatinMetrics  metrics = (AF_LatinMetrics)metrics_;\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/aflatin.c","additions":48,"deletions":39,"binary":false,"changes":87,"status":"modified"},{"patch":"@@ -119,1 +119,1 @@\n-  af_latin_metrics_init( AF_LatinMetrics  metrics,\n+  af_latin_metrics_init( AF_StyleMetrics  metrics,\n@@ -123,1 +123,1 @@\n-  af_latin_metrics_scale( AF_LatinMetrics  metrics,\n+  af_latin_metrics_scale( AF_StyleMetrics  metrics,\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/aflatin.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -58,4 +58,2 @@\n-        face->autohint.data =\n-          (FT_Pointer)loader->globals;\n-        face->autohint.finalizer =\n-          (FT_Generic_Finalizer)af_face_globals_free;\n+        face->autohint.data      = (FT_Pointer)loader->globals;\n+        face->autohint.finalizer = af_face_globals_free;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afloader.c","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -92,4 +92,2 @@\n-        face->autohint.data =\n-          (FT_Pointer)globals;\n-        face->autohint.finalizer =\n-          (FT_Generic_Finalizer)af_face_globals_free;\n+        face->autohint.data      = (FT_Pointer)globals;\n+        face->autohint.finalizer = af_face_globals_free;\n@@ -377,2 +375,3 @@\n-    (FT_Properties_SetFunc)af_property_set,        \/* set_property *\/\n-    (FT_Properties_GetFunc)af_property_get )       \/* get_property *\/\n+    af_property_set,  \/* FT_Properties_SetFunc set_property *\/\n+    af_property_get   \/* FT_Properties_GetFunc get_property *\/\n+  )\n@@ -433,5 +432,5 @@\n-  af_autofitter_load_glyph( AF_Module     module,\n-                            FT_GlyphSlot  slot,\n-                            FT_Size       size,\n-                            FT_UInt       glyph_index,\n-                            FT_Int32      load_flags )\n+  af_autofitter_load_glyph( FT_AutoHinter  module_,\n+                            FT_GlyphSlot   slot,\n+                            FT_Size        size,\n+                            FT_UInt        glyph_index,\n+                            FT_Int32       load_flags )\n@@ -439,0 +438,2 @@\n+    AF_Module  module = (AF_Module)module_;\n+\n@@ -502,4 +503,4 @@\n-    NULL,                                                    \/* reset_face *\/\n-    NULL,                                              \/* get_global_hints *\/\n-    NULL,                                             \/* done_global_hints *\/\n-    (FT_AutoHinter_GlyphLoadFunc)af_autofitter_load_glyph    \/* load_glyph *\/\n+    NULL,                     \/* FT_AutoHinter_GlobalResetFunc reset_face        *\/\n+    NULL,                     \/* FT_AutoHinter_GlobalGetFunc   get_global_hints  *\/\n+    NULL,                     \/* FT_AutoHinter_GlobalDoneFunc  done_global_hints *\/\n+    af_autofitter_load_glyph  \/* FT_AutoHinter_GlyphLoadFunc   load_glyph        *\/\n@@ -520,3 +521,3 @@\n-    (FT_Module_Constructor)af_autofitter_init,  \/* module_init   *\/\n-    (FT_Module_Destructor) af_autofitter_done,  \/* module_done   *\/\n-    (FT_Module_Requester)  af_get_interface     \/* get_interface *\/\n+    af_autofitter_init,  \/* FT_Module_Constructor module_init   *\/\n+    af_autofitter_done,  \/* FT_Module_Destructor  module_done   *\/\n+    af_get_interface     \/* FT_Module_Requester   get_interface *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afmodule.c","additions":19,"deletions":18,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -261,1 +261,1 @@\n-     * (this is, not a single character is covered), we skip this coverage.\n+     * (that is, not a single character is covered), we skip this coverage.\n@@ -316,1 +316,1 @@\n-     * glyphs are `real', this is, they have a zero vertical offset, but\n+     * glyphs are `real', that is, they have a zero vertical offset, but\n@@ -318,1 +318,1 @@\n-     * position (this is, the `sups' feature is present in both the GSUB and\n+     * position (that is, the `sups' feature is present in both the GSUB and\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/autofit\/afshaper.c","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -85,3 +85,3 @@\n-  static int\n-  BBox_Move_To( FT_Vector*  to,\n-                TBBox_Rec*  user )\n+  FT_CALLBACK_DEF( int )\n+  BBox_Move_To( const FT_Vector*  to,\n+                void*             user_ )\n@@ -89,0 +89,3 @@\n+    TBBox_Rec*  user = (TBBox_Rec*)user_;\n+\n+\n@@ -119,3 +122,3 @@\n-  static int\n-  BBox_Line_To( FT_Vector*  to,\n-                TBBox_Rec*  user )\n+  FT_CALLBACK_DEF( int )\n+  BBox_Line_To( const FT_Vector*  to,\n+                void*             user_ )\n@@ -123,0 +126,3 @@\n+    TBBox_Rec*  user = (TBBox_Rec*)user_;\n+\n+\n@@ -208,4 +214,4 @@\n-  static int\n-  BBox_Conic_To( FT_Vector*  control,\n-                 FT_Vector*  to,\n-                 TBBox_Rec*  user )\n+  FT_CALLBACK_DEF( int )\n+  BBox_Conic_To( const FT_Vector*  control,\n+                 const FT_Vector*  to,\n+                 void*             user_ )\n@@ -213,0 +219,3 @@\n+    TBBox_Rec*  user = (TBBox_Rec*)user_;\n+\n+\n@@ -413,5 +422,5 @@\n-  static int\n-  BBox_Cubic_To( FT_Vector*  control1,\n-                 FT_Vector*  control2,\n-                 FT_Vector*  to,\n-                 TBBox_Rec*  user )\n+  FT_CALLBACK_DEF( int )\n+  BBox_Cubic_To( const FT_Vector*  control1,\n+                 const FT_Vector*  control2,\n+                 const FT_Vector*  to,\n+                 void*             user_ )\n@@ -419,0 +428,3 @@\n+    TBBox_Rec*  user = (TBBox_Rec*)user_;\n+\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftbbox.c","additions":27,"deletions":15,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -752,5 +752,4 @@\n-    FT_Matrix  m;\n-    FT_Fixed   val[4];\n-    FT_Fixed   nonzero_minval, maxval;\n-    FT_Fixed   temp1, temp2;\n-    FT_UInt    i;\n+    FT_Fixed  xx, xy, yx, yy;\n+    FT_Fixed  val;\n+    FT_Int    shift;\n+    FT_ULong  temp1, temp2;\n@@ -762,4 +761,5 @@\n-    val[0] = FT_ABS( matrix->xx );\n-    val[1] = FT_ABS( matrix->xy );\n-    val[2] = FT_ABS( matrix->yx );\n-    val[3] = FT_ABS( matrix->yy );\n+    xx  = matrix->xx;\n+    xy  = matrix->xy;\n+    yx  = matrix->yx;\n+    yy  = matrix->yy;\n+    val = FT_ABS( xx ) | FT_ABS( xy ) | FT_ABS( yx ) | FT_ABS( yy );\n@@ -767,21 +767,2 @@\n-    \/*\n-     * To avoid overflow, we ensure that each value is not larger than\n-     *\n-     *   int(sqrt(2^31 \/ 4)) = 23170  ;\n-     *\n-     * we also check that no value becomes zero if we have to scale.\n-     *\/\n-\n-    maxval         = 0;\n-    nonzero_minval = FT_LONG_MAX;\n-\n-    for ( i = 0; i < 4; i++ )\n-    {\n-      if ( val[i] > maxval )\n-        maxval = val[i];\n-      if ( val[i] && val[i] < nonzero_minval )\n-        nonzero_minval = val[i];\n-    }\n-\n-    \/* we only handle 32bit values *\/\n-    if ( maxval > 0x7FFFFFFFL )\n+    \/* we only handle non-zero 32-bit values *\/\n+    if ( !val || val > 0x7FFFFFFFL )\n@@ -790,4 +771,2 @@\n-    if ( maxval > 23170 )\n-    {\n-      FT_Fixed  scale = FT_DivFix( maxval, 23170 );\n-\n+    \/* Scale matrix to avoid the temp1 overflow, which is *\/\n+    \/* more stringent than avoiding the temp2 overflow.   *\/\n@@ -795,2 +774,1 @@\n-      if ( !FT_DivFix( nonzero_minval, scale ) )\n-        return 0;    \/* value range too large *\/\n+    shift = FT_MSB( val ) - 12;\n@@ -798,4 +776,6 @@\n-      m.xx = FT_DivFix( matrix->xx, scale );\n-      m.xy = FT_DivFix( matrix->xy, scale );\n-      m.yx = FT_DivFix( matrix->yx, scale );\n-      m.yy = FT_DivFix( matrix->yy, scale );\n+    if ( shift > 0 )\n+    {\n+      xx >>= shift;\n+      xy >>= shift;\n+      yx >>= shift;\n+      yy >>= shift;\n@@ -803,2 +783,0 @@\n-    else\n-      m = *matrix;\n@@ -806,2 +784,3 @@\n-    temp1 = FT_ABS( m.xx * m.yy - m.xy * m.yx );\n-    temp2 = m.xx * m.xx + m.xy * m.xy + m.yx * m.yx + m.yy * m.yy;\n+    temp1 = 32U * (FT_ULong)FT_ABS( xx * yy - xy * yx );\n+    temp2 = (FT_ULong)( xx * xx ) + (FT_ULong)( xy * xy ) +\n+            (FT_ULong)( yx * yx ) + (FT_ULong)( yy * yy );\n@@ -809,2 +788,1 @@\n-    if ( temp1 == 0         ||\n-         temp2 \/ temp1 > 50 )\n+    if ( temp1 <= temp2 )\n@@ -1064,1 +1042,1 @@\n-    \/* vectors is `dominant', this is, much larger than the      *\/\n+    \/* vectors is `dominant', that is, much larger than the      *\/\n@@ -1095,3 +1073,0 @@\n-#ifndef FT_INT64\n-    FT_Int64  halfUnit;\n-#endif\n@@ -1106,1 +1081,1 @@\n-    return ( temp + 0x8000 ) >> 16;\n+    return (FT_Int32)( ( temp + 0x8000 ) >> 16 );\n@@ -1142,4 +1117,3 @@\n-    \/* Round value. *\/\n-    halfUnit.hi = 0;\n-    halfUnit.lo = 0x8000;\n-    FT_Add64( &temp, &halfUnit, &temp );\n+    \/* Shift and round value. *\/\n+    return (FT_Int32)( ( ( temp.hi << 16 ) | ( temp.lo >> 16 ) )\n+                                     + ( 1 & ( temp.lo >> 15 ) ) );\n@@ -1147,2 +1121,0 @@\n-    return (FT_Int32)( ( (FT_Int32)( temp.hi & 0xFFFF ) << 16 ) |\n-                                   ( temp.lo >> 16 )            );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftcalc.c","additions":29,"deletions":57,"binary":false,"changes":86,"status":"modified"},{"patch":"@@ -966,1 +966,1 @@\n-  typedef int  _debug_mem_dummy;\n+  typedef int  debug_mem_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftdbgmem.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1085,1 +1085,1 @@\n-  typedef int  _ft_mac_dummy;\n+  typedef int  ft_mac_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftmac.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -188,0 +188,8 @@\n+\n+      if ( !error )\n+      {\n+        if ( num_coords )\n+          face->face_flags |= FT_FACE_FLAG_VARIATION;\n+        else\n+          face->face_flags &= ~FT_FACE_FLAG_VARIATION;\n+      }\n@@ -223,0 +231,8 @@\n+\n+      if ( !error )\n+      {\n+        if ( len )\n+          face->face_flags |= FT_FACE_FLAG_VARIATION;\n+        else\n+          face->face_flags &= ~FT_FACE_FLAG_VARIATION;\n+      }\n@@ -286,0 +302,24 @@\n+      if ( !error || error == -1 )\n+      {\n+        FT_Bool  is_variation_old = FT_IS_VARIATION( face );\n+\n+\n+        if ( num_coords )\n+          face->face_flags |= FT_FACE_FLAG_VARIATION;\n+        else\n+          face->face_flags &= ~FT_FACE_FLAG_VARIATION;\n+\n+        if ( service_mm->construct_ps_name )\n+        {\n+          if ( error == -1 )\n+          {\n+            \/* The PS name of a named instance and a non-named instance *\/\n+            \/* usually differs, even if the axis values are identical.  *\/\n+            if ( is_variation_old != FT_IS_VARIATION( face ) )\n+              service_mm->construct_ps_name( face );\n+          }\n+          else\n+            service_mm->construct_ps_name( face );\n+        }\n+      }\n+\n@@ -362,0 +402,24 @@\n+      if ( !error || error == -1 )\n+      {\n+        FT_Bool  is_variation_old = FT_IS_VARIATION( face );\n+\n+\n+        if ( num_coords )\n+          face->face_flags |= FT_FACE_FLAG_VARIATION;\n+        else\n+          face->face_flags &= ~FT_FACE_FLAG_VARIATION;\n+\n+        if ( service_mm->construct_ps_name )\n+        {\n+          if ( error == -1 )\n+          {\n+            \/* The PS name of a named instance and a non-named instance *\/\n+            \/* usually differs, even if the axis values are identical.  *\/\n+            if ( is_variation_old != FT_IS_VARIATION( face ) )\n+              service_mm->construct_ps_name( face );\n+          }\n+          else\n+            service_mm->construct_ps_name( face );\n+        }\n+      }\n+\n@@ -413,0 +477,24 @@\n+      if ( !error || error == -1 )\n+      {\n+        FT_Bool  is_variation_old = FT_IS_VARIATION( face );\n+\n+\n+        if ( num_coords )\n+          face->face_flags |= FT_FACE_FLAG_VARIATION;\n+        else\n+          face->face_flags &= ~FT_FACE_FLAG_VARIATION;\n+\n+        if ( service_mm->construct_ps_name )\n+        {\n+          if ( error == -1 )\n+          {\n+            \/* The PS name of a named instance and a non-named instance *\/\n+            \/* usually differs, even if the axis values are identical.  *\/\n+            if ( is_variation_old != FT_IS_VARIATION( face ) )\n+              service_mm->construct_ps_name( face );\n+          }\n+          else\n+            service_mm->construct_ps_name( face );\n+        }\n+      }\n+\n@@ -538,2 +626,29 @@\n-      if ( service_mm->set_instance )\n-        error = service_mm->set_instance( face, instance_index );\n+      if ( service_mm->set_named_instance )\n+        error = service_mm->set_named_instance( face, instance_index );\n+\n+      if ( !error || error == -1 )\n+      {\n+        FT_Bool  is_variation_old = FT_IS_VARIATION( face );\n+\n+\n+        face->face_flags &= ~FT_FACE_FLAG_VARIATION;\n+        face->face_index  = ( instance_index << 16 )        |\n+                            ( face->face_index & 0xFFFFL );\n+\n+        if ( service_mm->construct_ps_name )\n+        {\n+          if ( error == -1 )\n+          {\n+            \/* The PS name of a named instance and a non-named instance *\/\n+            \/* usually differs, even if the axis values are identical.  *\/\n+            if ( is_variation_old != FT_IS_VARIATION( face ) )\n+              service_mm->construct_ps_name( face );\n+          }\n+          else\n+            service_mm->construct_ps_name( face );\n+        }\n+      }\n+\n+      \/* internal error code -1 means `no change'; we can exit immediately *\/\n+      if ( error == -1 )\n+        return FT_Err_Ok;\n@@ -557,0 +672,18 @@\n+    return error;\n+  }\n+\n+\n+  \/* documentation is in ftmm.h *\/\n+\n+  FT_EXPORT_DEF( FT_Error )\n+  FT_Get_Default_Named_Instance( FT_Face   face,\n+                                 FT_UInt  *instance_index )\n+  {\n+    FT_Error  error;\n+\n+    FT_Service_MultiMasters  service_mm = NULL;\n+\n+\n+    \/* check of `face' delayed to `ft_face_get_mm_service' *\/\n+\n+    error = ft_face_get_mm_service( face, &service_mm );\n@@ -559,3 +692,6 @@\n-      face->face_index  = ( instance_index << 16 )        |\n-                          ( face->face_index & 0xFFFFL );\n-      face->face_flags &= ~FT_FACE_FLAG_VARIATION;\n+      \/* no error if `get_default_named_instance` is not available *\/\n+      if ( service_mm->get_default_named_instance )\n+        error = service_mm->get_default_named_instance( face,\n+                                                        instance_index );\n+      else\n+        error = FT_Err_Ok;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftmm.c","additions":141,"deletions":5,"binary":false,"changes":146,"status":"modified"},{"patch":"@@ -1022,1 +1022,2 @@\n-      if ( FT_HAS_SVG( face ) )\n+      if ( ( load_flags & FT_LOAD_NO_SVG ) == 0 &&\n+           FT_HAS_SVG( face )                   )\n@@ -1248,2 +1249,2 @@\n-                FT_Size    size,\n-                FT_Driver  driver )\n+                void*      size_,\n+                void*      driver_ )\n@@ -1251,0 +1252,4 @@\n+    FT_Size    size   = (FT_Size)size_;\n+    FT_Driver  driver = (FT_Driver)driver_;\n+\n+\n@@ -1296,2 +1301,2 @@\n-                FT_Face    face,\n-                FT_Driver  driver )\n+                void*      face_,\n+                void*      driver_ )\n@@ -1299,1 +1304,3 @@\n-    FT_Driver_Class  clazz = driver->clazz;\n+    FT_Face          face   = (FT_Face)face_;\n+    FT_Driver        driver = (FT_Driver)driver_;\n+    FT_Driver_Class  clazz  = driver->clazz;\n@@ -1313,1 +1320,1 @@\n-                      (FT_List_Destructor)destroy_size,\n+                      destroy_size,\n@@ -1349,1 +1356,1 @@\n-                      (FT_List_Destructor)destroy_face,\n+                      destroy_face,\n@@ -1743,1 +1750,2 @@\n-    args.flags = 0;\n+    args.driver = NULL;\n+    args.flags  = 0;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftobjs.c","additions":17,"deletions":9,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -61,1 +61,3 @@\n-    FT_UInt  first;     \/* index of first point in contour *\/\n+    FT_Int   first;     \/* index of first point in contour *\/\n+    FT_Int   last;      \/* index of last point in contour  *\/\n+\n@@ -76,1 +78,0 @@\n-    first = 0;\n@@ -78,0 +79,1 @@\n+    last = -1;\n@@ -80,4 +82,1 @@\n-      FT_Int  last;  \/* index of last point in contour *\/\n-\n-\n-      FT_TRACE5(( \"FT_Outline_Decompose: Outline %d\\n\", n ));\n+      FT_TRACE5(( \"FT_Outline_Decompose: Contour %d\\n\", n ));\n@@ -85,2 +84,3 @@\n-      last = outline->contours[n];\n-      if ( last < 0 )\n+      first = last + 1;\n+      last  = outline->contours[n];\n+      if ( last < first )\n@@ -88,0 +88,1 @@\n+\n@@ -285,2 +286,0 @@\n-\n-      first = (FT_UInt)last + 1;\n@@ -371,1 +370,1 @@\n-      end0 = end = -1;\n+      end0 = -1;\n@@ -383,1 +382,1 @@\n-      if ( end != n_points - 1 )\n+      if ( end0 != n_points - 1 )\n@@ -391,1 +390,1 @@\n-    return FT_THROW( Invalid_Argument );\n+    return FT_THROW( Invalid_Outline );\n@@ -553,2 +552,1 @@\n-    first = 0;\n-\n+    last = -1;\n@@ -557,0 +555,3 @@\n+      \/* keep the first contour point as is and swap points around it *\/\n+      \/* to guarantee that the cubic arches stay valid after reverse  *\/\n+      first = last + 2;\n@@ -594,2 +595,0 @@\n-\n-      first = last + 1;\n@@ -944,1 +943,1 @@\n-    first = 0;\n+    last = -1;\n@@ -952,2 +951,3 @@\n-      l_in = 0;\n-      last = outline->contours[c];\n+      first = last + 1;\n+      last  = outline->contours[c];\n+      l_in  = 0;\n@@ -1040,2 +1040,0 @@\n-\n-      first = last + 1;\n@@ -1057,1 +1055,1 @@\n-    FT_Int      c, n, first;\n+    FT_Int      c, n, first, last;\n@@ -1089,1 +1087,1 @@\n-    first = 0;\n+    last = -1;\n@@ -1092,2 +1090,2 @@\n-      FT_Int  last = outline->contours[c];\n-\n+      first = last + 1;\n+      last  = outline->contours[c];\n@@ -1109,2 +1107,0 @@\n-\n-      first = last + 1;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftoutln.c","additions":24,"deletions":28,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -144,1 +144,3 @@\n-      FT_MEM_COPY( buffer, stream->base + pos, read_bytes );\n+      \/* Allow \"reading\" zero bytes without UB even if buffer is NULL *\/\n+      if ( count )\n+        FT_MEM_COPY( buffer, stream->base + pos, read_bytes );\n@@ -181,1 +183,3 @@\n-      FT_MEM_COPY( buffer, stream->base + stream->pos, read_bytes );\n+      \/* Allow \"reading\" zero bytes without UB even if buffer is NULL *\/\n+      if ( count )\n+        FT_MEM_COPY( buffer, stream->base + stream->pos, read_bytes );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftstream.c","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2058,1 +2058,3 @@\n-    FT_UInt     first;     \/* index of first point in contour *\/\n+    FT_Int      first;     \/* index of first point in contour *\/\n+    FT_Int      last;      \/* index of last point in contour  *\/\n+\n@@ -2070,2 +2072,1 @@\n-    first = 0;\n-\n+    last = -1;\n@@ -2074,5 +2075,2 @@\n-      FT_UInt  last;  \/* index of last point in contour *\/\n-\n-\n-      last  = (FT_UInt)outline->contours[n];\n-      limit = outline->points + last;\n+      first = last + 1;\n+      last  = outline->contours[n];\n@@ -2082,2 +2080,0 @@\n-      {\n-        first = last + 1;\n@@ -2085,1 +2081,2 @@\n-      }\n+\n+      limit = outline->points + last;\n@@ -2234,2 +2231,0 @@\n-\n-      first = last + 1;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftstroke.c","additions":8,"deletions":13,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -100,0 +100,9 @@\n+  {\n+    FT_GlyphSlot_AdjustWeight( slot, 0x0AAA, 0x0AAA );\n+  }\n+\n+\n+  FT_EXPORT_DEF( void )\n+  FT_GlyphSlot_AdjustWeight( FT_GlyphSlot  slot,\n+                             FT_Fixed      xdelta,\n+                             FT_Fixed      ydelta )\n@@ -102,1 +111,1 @@\n-    FT_Face     face;\n+    FT_Size     size;\n@@ -111,1 +120,1 @@\n-    face    = slot->face;\n+    size    = slot->face->size;\n@@ -117,4 +126,3 @@\n-    \/* some reasonable strength *\/\n-    xstr = FT_MulFix( face->units_per_EM,\n-                      face->size->metrics.y_scale ) \/ 24;\n-    ystr = xstr;\n+    \/* express deltas in pixels in 26.6 format *\/\n+    xstr = (FT_Pos)size->metrics.x_ppem * xdelta \/ 1024;\n+    ystr = (FT_Pos)size->metrics.y_ppem * ydelta \/ 1024;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftsynth.c","additions":14,"deletions":6,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -209,1 +209,1 @@\n-   *   The number of bytes actually read.  If `count' is zero (this is,\n+   *   The number of bytes actually read.  If `count' is zero (that is,\n@@ -222,1 +222,1 @@\n-    if ( !count && offset > stream->size )\n+    if ( offset > stream->size && !count )\n@@ -230,0 +230,5 @@\n+    \/* Avoid calling `fread` with `buffer=NULL` and `count=0`, *\/\n+    \/* which is undefined behaviour.                           *\/\n+    if ( !count )\n+      return 0;\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/base\/ftsystem.c","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -35,2 +35,2 @@\n-  cff_cmap_encoding_init( CFF_CMapStd  cmap,\n-                          FT_Pointer   pointer )\n+  cff_cmap_encoding_init( FT_CMap     cmap,\n+                          FT_Pointer  pointer )\n@@ -38,0 +38,1 @@\n+    CFF_CMapStd   cffcmap  = (CFF_CMapStd)cmap;\n@@ -45,1 +46,1 @@\n-    cmap->gids  = encoding->codes;\n+    cffcmap->gids = encoding->codes;\n@@ -52,1 +53,1 @@\n-  cff_cmap_encoding_done( CFF_CMapStd  cmap )\n+  cff_cmap_encoding_done( FT_CMap  cmap )\n@@ -54,1 +55,4 @@\n-    cmap->gids  = NULL;\n+    CFF_CMapStd  cffcmap = (CFF_CMapStd)cmap;\n+\n+\n+    cffcmap->gids = NULL;\n@@ -59,2 +63,2 @@\n-  cff_cmap_encoding_char_index( CFF_CMapStd  cmap,\n-                                FT_UInt32    char_code )\n+  cff_cmap_encoding_char_index( FT_CMap    cmap,\n+                                FT_UInt32  char_code )\n@@ -62,1 +66,2 @@\n-    FT_UInt  result = 0;\n+    CFF_CMapStd  cffcmap = (CFF_CMapStd)cmap;\n+    FT_UInt      result  = 0;\n@@ -66,1 +71,1 @@\n-      result = cmap->gids[char_code];\n+      result = cffcmap->gids[char_code];\n@@ -72,3 +77,3 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  cff_cmap_encoding_char_next( CFF_CMapStd   cmap,\n-                               FT_UInt32    *pchar_code )\n+  FT_CALLBACK_DEF( FT_UInt )\n+  cff_cmap_encoding_char_next( FT_CMap     cmap,\n+                               FT_UInt32  *pchar_code )\n@@ -76,2 +81,3 @@\n-    FT_UInt    result    = 0;\n-    FT_UInt32  char_code = *pchar_code;\n+    CFF_CMapStd  cffcmap   = (CFF_CMapStd)cmap;\n+    FT_UInt      result    = 0;\n+    FT_UInt32    char_code = *pchar_code;\n@@ -80,3 +86,1 @@\n-    *pchar_code = 0;\n-\n-    if ( char_code < 255 )\n+    while ( char_code < 255 )\n@@ -84,4 +88,2 @@\n-      FT_UInt  code = (FT_UInt)( char_code + 1 );\n-\n-\n-      for (;;)\n+      result = cffcmap->gids[++char_code];\n+      if ( result )\n@@ -89,11 +91,2 @@\n-        if ( code >= 256 )\n-          break;\n-\n-        result = cmap->gids[code];\n-        if ( result != 0 )\n-        {\n-          *pchar_code = code;\n-          break;\n-        }\n-\n-        code++;\n+        *pchar_code = char_code;\n+        break;\n@@ -102,0 +95,1 @@\n+\n@@ -133,1 +127,1 @@\n-  cff_sid_to_glyph_name( TT_Face  face,\n+  cff_sid_to_glyph_name( void*    face_,  \/* TT_Face *\/\n@@ -136,0 +130,1 @@\n+    TT_Face      face    = (TT_Face)face_;\n@@ -146,1 +141,1 @@\n-  cff_cmap_unicode_init( PS_Unicodes  unicodes,\n+  cff_cmap_unicode_init( FT_CMap      cmap,     \/* PS_Unicodes *\/\n@@ -149,5 +144,6 @@\n-    TT_Face             face    = (TT_Face)FT_CMAP_FACE( unicodes );\n-    FT_Memory           memory  = FT_FACE_MEMORY( face );\n-    CFF_Font            cff     = (CFF_Font)face->extra.data;\n-    CFF_Charset         charset = &cff->charset;\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)cff->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    TT_Face             face     = (TT_Face)FT_CMAP_FACE( cmap );\n+    FT_Memory           memory   = FT_FACE_MEMORY( face );\n+    CFF_Font            cff      = (CFF_Font)face->extra.data;\n+    CFF_Charset         charset  = &cff->charset;\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)cff->psnames;\n@@ -169,1 +165,1 @@\n-                                   (PS_GetGlyphNameFunc)&cff_sid_to_glyph_name,\n+                                   &cff_sid_to_glyph_name,\n@@ -176,1 +172,1 @@\n-  cff_cmap_unicode_done( PS_Unicodes  unicodes )\n+  cff_cmap_unicode_done( FT_CMap  cmap )    \/* PS_Unicodes *\/\n@@ -178,2 +174,3 @@\n-    FT_Face    face   = FT_CMAP_FACE( unicodes );\n-    FT_Memory  memory = FT_FACE_MEMORY( face );\n+    PS_Unicodes  unicodes = (PS_Unicodes)cmap;\n+    FT_Face      face     = FT_CMAP_FACE( cmap );\n+    FT_Memory    memory   = FT_FACE_MEMORY( face );\n@@ -188,2 +185,2 @@\n-  cff_cmap_unicode_char_index( PS_Unicodes  unicodes,\n-                               FT_UInt32    char_code )\n+  cff_cmap_unicode_char_index( FT_CMap    cmap,       \/* PS_Unicodes *\/\n+                               FT_UInt32  char_code )\n@@ -191,3 +188,4 @@\n-    TT_Face             face    = (TT_Face)FT_CMAP_FACE( unicodes );\n-    CFF_Font            cff     = (CFF_Font)face->extra.data;\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)cff->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    TT_Face             face     = (TT_Face)FT_CMAP_FACE( cmap );\n+    CFF_Font            cff      = (CFF_Font)face->extra.data;\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)cff->psnames;\n@@ -200,3 +198,3 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  cff_cmap_unicode_char_next( PS_Unicodes  unicodes,\n-                              FT_UInt32   *pchar_code )\n+  FT_CALLBACK_DEF( FT_UInt )\n+  cff_cmap_unicode_char_next( FT_CMap     cmap,        \/* PS_Unicodes *\/\n+                              FT_UInt32  *pchar_code )\n@@ -204,3 +202,4 @@\n-    TT_Face             face    = (TT_Face)FT_CMAP_FACE( unicodes );\n-    CFF_Font            cff     = (CFF_Font)face->extra.data;\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)cff->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    TT_Face             face     = (TT_Face)FT_CMAP_FACE( cmap );\n+    CFF_Font            cff      = (CFF_Font)face->extra.data;\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)cff->psnames;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffcmap.c","additions":53,"deletions":54,"binary":false,"changes":107,"status":"modified"},{"patch":"@@ -111,1 +111,1 @@\n-  cff_get_kerning( FT_Face     ttface,          \/* TT_Face *\/\n+  cff_get_kerning( FT_Face     face,          \/* CFF_Face *\/\n@@ -116,2 +116,2 @@\n-    TT_Face       face = (TT_Face)ttface;\n-    SFNT_Service  sfnt = (SFNT_Service)face->sfnt;\n+    CFF_Face      cffface = (CFF_Face)face;\n+    SFNT_Service  sfnt    = (SFNT_Service)cffface->sfnt;\n@@ -124,1 +124,1 @@\n-      kerning->x = sfnt->get_kerning( face, left_glyph, right_glyph );\n+      kerning->x = sfnt->get_kerning( cffface, left_glyph, right_glyph );\n@@ -161,2 +161,2 @@\n-  cff_glyph_load( FT_GlyphSlot  cffslot,      \/* CFF_GlyphSlot *\/\n-                  FT_Size       cffsize,      \/* CFF_Size      *\/\n+  cff_glyph_load( FT_GlyphSlot  slot,        \/* CFF_GlyphSlot *\/\n+                  FT_Size       size,        \/* CFF_Size      *\/\n@@ -167,2 +167,2 @@\n-    CFF_GlyphSlot  slot = (CFF_GlyphSlot)cffslot;\n-    CFF_Size       size = (CFF_Size)cffsize;\n+    CFF_GlyphSlot  cffslot = (CFF_GlyphSlot)slot;\n+    CFF_Size       cffsize = (CFF_Size)size;\n@@ -171,1 +171,1 @@\n-    if ( !slot )\n+    if ( !cffslot )\n@@ -177,1 +177,1 @@\n-    if ( !size )\n+    if ( !cffsize )\n@@ -187,1 +187,1 @@\n-      if ( cffsize->face != cffslot->face )\n+      if ( size->face != slot->face )\n@@ -192,1 +192,1 @@\n-    error = cff_slot_load( slot, size, glyph_index, load_flags );\n+    error = cff_slot_load( cffslot, cffsize, glyph_index, load_flags );\n@@ -219,1 +219,1 @@\n-      TT_Face   ttface = (TT_Face)face;\n+      CFF_Face  cffface = (CFF_Face)face;\n@@ -228,1 +228,1 @@\n-             !( ttface->variation_support & TT_FACE_FLAG_VAR_VADVANCE )  )\n+             !( cffface->variation_support & TT_FACE_FLAG_VAR_VADVANCE ) )\n@@ -236,1 +236,1 @@\n-        if ( !ttface->vertical_info )\n+        if ( !cffface->vertical_info )\n@@ -244,5 +244,5 @@\n-          ( (SFNT_Service)ttface->sfnt )->get_metrics( ttface,\n-                                                       1,\n-                                                       start + nn,\n-                                                       &dummy,\n-                                                       &ah );\n+          ( (SFNT_Service)cffface->sfnt )->get_metrics( cffface,\n+                                                        1,\n+                                                        start + nn,\n+                                                        &dummy,\n+                                                        &ah );\n@@ -262,1 +262,1 @@\n-             !( ttface->variation_support & TT_FACE_FLAG_VAR_HADVANCE )  )\n+             !( cffface->variation_support & TT_FACE_FLAG_VAR_HADVANCE ) )\n@@ -267,1 +267,1 @@\n-        if ( !ttface->horizontal.number_Of_HMetrics )\n+        if ( !cffface->horizontal.number_Of_HMetrics )\n@@ -275,5 +275,5 @@\n-          ( (SFNT_Service)ttface->sfnt )->get_metrics( ttface,\n-                                                       0,\n-                                                       start + nn,\n-                                                       &dummy,\n-                                                       &aw );\n+          ( (SFNT_Service)cffface->sfnt )->get_metrics( cffface,\n+                                                        0,\n+                                                        start + nn,\n+                                                        &dummy,\n+                                                        &aw );\n@@ -315,2 +315,2 @@\n-  static FT_Error\n-  cff_get_glyph_name( CFF_Face    face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_glyph_name( FT_Face     face,        \/* CFF_Face *\/\n@@ -321,1 +321,2 @@\n-    CFF_Font    font   = (CFF_Font)face->extra.data;\n+    CFF_Face    cffface = (CFF_Face)face;\n+    CFF_Font    font    = (CFF_Font)cffface->extra.data;\n@@ -341,4 +342,1 @@\n-        return service->get_name( FT_FACE( face ),\n-                                  glyph_index,\n-                                  buffer,\n-                                  buffer_max );\n+        return service->get_name( face, glyph_index, buffer, buffer_max );\n@@ -369,1 +367,1 @@\n-    \/* now, lookup the name itself *\/\n+    \/* now, look up the name itself *\/\n@@ -382,2 +380,2 @@\n-  static FT_UInt\n-  cff_get_name_index( CFF_Face          face,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  cff_get_name_index( FT_Face           face,        \/* CFF_Face *\/\n@@ -386,2 +384,3 @@\n-    CFF_Font            cff;\n-    CFF_Charset         charset;\n+    CFF_Face            cffface = (CFF_Face)face;\n+    CFF_Font            cff     = (CFF_Font)cffface->extra.data;\n+    CFF_Charset         charset = &cff->charset;\n@@ -394,3 +393,0 @@\n-    cff     = (CFF_FontRec *)face->extra.data;\n-    charset = &cff->charset;\n-\n@@ -411,1 +407,1 @@\n-        return service->name_index( FT_FACE( face ), glyph_name );\n+        return service->name_index( face, glyph_name );\n@@ -449,2 +445,2 @@\n-    (FT_GlyphDict_GetNameFunc)  cff_get_glyph_name,      \/* get_name   *\/\n-    (FT_GlyphDict_NameIndexFunc)cff_get_name_index       \/* name_index *\/\n+    cff_get_glyph_name,  \/* FT_GlyphDict_GetNameFunc   get_name   *\/\n+    cff_get_name_index   \/* FT_GlyphDict_NameIndexFunc name_index *\/\n@@ -459,1 +455,1 @@\n-  static FT_Int\n+  FT_CALLBACK_DEF( FT_Int )\n@@ -466,2 +462,2 @@\n-  static FT_Error\n-  cff_ps_get_font_info( CFF_Face         face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_ps_get_font_info( FT_Face          face,        \/* CFF_Face *\/\n@@ -470,2 +466,3 @@\n-    CFF_Font  cff   = (CFF_Font)face->extra.data;\n-    FT_Error  error = FT_Err_Ok;\n+    CFF_Face  cffface = (CFF_Face)face;\n+    CFF_Font  cff     = (CFF_Font)cffface->extra.data;\n+    FT_Error  error   = FT_Err_Ok;\n@@ -474,0 +471,6 @@\n+    if ( cffface->is_cff2 )\n+    {\n+      error = FT_THROW( Invalid_Argument );\n+      goto Fail;\n+    }\n+\n@@ -477,1 +480,1 @@\n-      FT_Memory        memory    = face->root.memory;\n+      FT_Memory        memory    = FT_FACE_MEMORY( face );\n@@ -510,2 +513,2 @@\n-  static FT_Error\n-  cff_ps_get_font_extra( CFF_Face          face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_ps_get_font_extra( FT_Face           face,         \/* CFF_Face *\/\n@@ -514,2 +517,3 @@\n-    CFF_Font  cff   = (CFF_Font)face->extra.data;\n-    FT_Error  error = FT_Err_Ok;\n+    CFF_Face  cffface = (CFF_Face)face;\n+    CFF_Font  cff     = (CFF_Font)cffface->extra.data;\n+    FT_Error  error   = FT_Err_Ok;\n@@ -521,1 +525,1 @@\n-      FT_Memory         memory     = face->root.memory;\n+      FT_Memory         memory     = FT_FACE_MEMORY( face );\n@@ -591,3 +595,3 @@\n-    (PS_GetFontInfoFunc)   cff_ps_get_font_info,    \/* ps_get_font_info    *\/\n-    (PS_GetFontExtraFunc)  cff_ps_get_font_extra,   \/* ps_get_font_extra   *\/\n-    (PS_HasGlyphNamesFunc) cff_ps_has_glyph_names,  \/* ps_has_glyph_names  *\/\n+    cff_ps_get_font_info,    \/* PS_GetFontInfoFunc    ps_get_font_info    *\/\n+    cff_ps_get_font_extra,   \/* PS_GetFontExtraFunc   ps_get_font_extra   *\/\n+    cff_ps_has_glyph_names,  \/* PS_HasGlyphNamesFunc  ps_has_glyph_names  *\/\n@@ -595,1 +599,1 @@\n-    (PS_GetFontPrivateFunc)NULL,                    \/* ps_get_font_private *\/\n+    NULL,                    \/* PS_GetFontPrivateFunc ps_get_font_private *\/\n@@ -597,1 +601,1 @@\n-    (PS_GetFontValueFunc)  NULL                     \/* ps_get_font_value   *\/\n+    NULL                     \/* PS_GetFontValueFunc   ps_get_font_value   *\/\n@@ -606,2 +610,2 @@\n-  static const char*\n-  cff_get_ps_name( CFF_Face  face )\n+  FT_CALLBACK_DEF( const char* )\n+  cff_get_ps_name( FT_Face  face )    \/* CFF_Face *\/\n@@ -609,2 +613,3 @@\n-    CFF_Font      cff  = (CFF_Font)face->extra.data;\n-    SFNT_Service  sfnt = (SFNT_Service)face->sfnt;\n+    CFF_Face      cffface = (CFF_Face)face;\n+    CFF_Font      cff     = (CFF_Font)cffface->extra.data;\n+    SFNT_Service  sfnt    = (SFNT_Service)cffface->sfnt;\n@@ -616,1 +621,1 @@\n-    if ( FT_IS_SFNT( FT_FACE( face ) ) && sfnt )\n+    if ( FT_IS_SFNT( face ) && sfnt )\n@@ -628,1 +633,1 @@\n-        return service->get_ps_font_name( FT_FACE( face ) );\n+        return service->get_ps_font_name( face );\n@@ -631,1 +636,1 @@\n-    return (const char*)cff->font_name;\n+    return cff ? (const char*)cff->font_name : NULL;\n@@ -638,1 +643,1 @@\n-    (FT_PsName_GetFunc)cff_get_ps_name      \/* get_ps_font_name *\/\n+    cff_get_ps_name  \/* FT_PsName_GetFunc get_ps_font_name *\/\n@@ -652,1 +657,1 @@\n-  static FT_Error\n+  FT_CALLBACK_DEF( FT_Error )\n@@ -686,1 +691,1 @@\n-    (TT_CMap_Info_GetFunc)cff_get_cmap_info    \/* get_cmap_info *\/\n+    cff_get_cmap_info  \/* TT_CMap_Info_GetFunc get_cmap_info *\/\n@@ -694,2 +699,2 @@\n-  static FT_Error\n-  cff_get_ros( CFF_Face      face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_ros( FT_Face       face,        \/* FT_Face *\/\n@@ -700,2 +705,3 @@\n-    FT_Error  error = FT_Err_Ok;\n-    CFF_Font  cff   = (CFF_Font)face->extra.data;\n+    FT_Error  error   = FT_Err_Ok;\n+    CFF_Face  cffface = (CFF_Face)face;\n+    CFF_Font  cff     = (CFF_Font)cffface->extra.data;\n@@ -751,2 +757,2 @@\n-  static FT_Error\n-  cff_get_is_cid( CFF_Face  face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_is_cid( FT_Face   face,    \/* CFF_Face *\/\n@@ -755,2 +761,3 @@\n-    FT_Error  error = FT_Err_Ok;\n-    CFF_Font  cff   = (CFF_Font)face->extra.data;\n+    FT_Error  error   = FT_Err_Ok;\n+    CFF_Face  cffface = (CFF_Face)face;\n+    CFF_Font  cff     = (CFF_Font)cffface->extra.data;\n@@ -774,2 +781,2 @@\n-  static FT_Error\n-  cff_get_cid_from_glyph_index( CFF_Face  face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_cid_from_glyph_index( FT_Face   face,        \/* CFF_Face *\/\n@@ -779,3 +786,3 @@\n-    FT_Error  error = FT_Err_Ok;\n-    CFF_Font  cff;\n-\n+    FT_Error  error   = FT_Err_Ok;\n+    CFF_Face  cffface = (CFF_Face)face;\n+    CFF_Font  cff     = (CFF_Font)cffface->extra.data;\n@@ -783,1 +790,0 @@\n-    cff = (CFF_Font)face->extra.data;\n@@ -817,6 +823,6 @@\n-    (FT_CID_GetRegistryOrderingSupplementFunc)\n-      cff_get_ros,                             \/* get_ros                  *\/\n-    (FT_CID_GetIsInternallyCIDKeyedFunc)\n-      cff_get_is_cid,                          \/* get_is_cid               *\/\n-    (FT_CID_GetCIDFromGlyphIndexFunc)\n-      cff_get_cid_from_glyph_index             \/* get_cid_from_glyph_index *\/\n+    cff_get_ros,\n+      \/* FT_CID_GetRegistryOrderingSupplementFunc get_ros                  *\/\n+    cff_get_is_cid,\n+      \/* FT_CID_GetIsInternallyCIDKeyedFunc       get_is_cid               *\/\n+    cff_get_cid_from_glyph_index\n+      \/* FT_CID_GetCIDFromGlyphIndexFunc          get_cid_from_glyph_index *\/\n@@ -834,3 +840,3 @@\n-    (FT_Properties_SetFunc)ps_property_set,      \/* set_property *\/\n-    (FT_Properties_GetFunc)ps_property_get )     \/* get_property *\/\n-\n+    ps_property_set,  \/* FT_Properties_SetFunc set_property *\/\n+    ps_property_get   \/* FT_Properties_GetFunc get_property *\/\n+  )\n@@ -845,2 +851,2 @@\n-  static FT_Error\n-  cff_set_mm_blend( CFF_Face   face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_set_mm_blend( FT_Face    face,        \/* CFF_Face *\/\n@@ -850,1 +856,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -853,1 +860,1 @@\n-    return mm->set_mm_blend( FT_FACE( face ), num_coords, coords );\n+    return mm->set_mm_blend( face, num_coords, coords );\n@@ -857,2 +864,2 @@\n-  static FT_Error\n-  cff_get_mm_blend( CFF_Face   face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_mm_blend( FT_Face    face,       \/* CFF_Face *\/\n@@ -862,1 +869,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -865,1 +873,1 @@\n-    return mm->get_mm_blend( FT_FACE( face ), num_coords, coords );\n+    return mm->get_mm_blend( face, num_coords, coords );\n@@ -869,2 +877,2 @@\n-  static FT_Error\n-  cff_set_mm_weightvector( CFF_Face   face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_set_mm_weightvector( FT_Face    face,          \/* CFF_Face *\/\n@@ -874,1 +882,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -877,1 +886,1 @@\n-    return mm->set_mm_weightvector( FT_FACE( face ), len, weightvector );\n+    return mm->set_mm_weightvector( face, len, weightvector );\n@@ -881,2 +890,2 @@\n-  static FT_Error\n-  cff_get_mm_weightvector( CFF_Face   face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_mm_weightvector( FT_Face    face,          \/* CFF_Face *\/\n@@ -886,1 +895,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -889,1 +899,1 @@\n-    return mm->get_mm_weightvector( FT_FACE( face ), len, weightvector );\n+    return mm->get_mm_weightvector( face, len, weightvector );\n@@ -893,2 +903,13 @@\n-  static FT_Error\n-  cff_get_mm_var( CFF_Face     face,\n+  FT_CALLBACK_DEF( void )\n+  cff_construct_ps_name( FT_Face  face )  \/* CFF_Face *\/\n+  {\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n+\n+\n+    mm->construct_ps_name( face );\n+  }\n+\n+\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_mm_var( FT_Face      face,    \/* CFF_Face *\/\n@@ -897,1 +918,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -900,1 +922,1 @@\n-    return mm->get_mm_var( FT_FACE( face ), master );\n+    return mm->get_mm_var( face, master );\n@@ -904,2 +926,2 @@\n-  static FT_Error\n-  cff_set_var_design( CFF_Face   face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_set_var_design( FT_Face    face,       \/* CFF_Face *\/\n@@ -909,1 +931,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -912,1 +935,1 @@\n-    return mm->set_var_design( FT_FACE( face ), num_coords, coords );\n+    return mm->set_var_design( face, num_coords, coords );\n@@ -916,2 +939,2 @@\n-  static FT_Error\n-  cff_get_var_design( CFF_Face   face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_var_design( FT_Face    face,       \/* CFF_Face *\/\n@@ -921,1 +944,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -924,1 +948,1 @@\n-    return mm->get_var_design( FT_FACE( face ), num_coords, coords );\n+    return mm->get_var_design( face, num_coords, coords );\n@@ -928,3 +952,3 @@\n-  static FT_Error\n-  cff_set_instance( CFF_Face  face,\n-                    FT_UInt   instance_index )\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_set_named_instance( FT_Face   face,            \/* CFF_Face *\/\n+                          FT_UInt   instance_index )\n@@ -932,1 +956,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -935,1 +960,1 @@\n-    return mm->set_instance( FT_FACE( face ), instance_index );\n+    return mm->set_named_instance( face, instance_index );\n@@ -939,2 +964,14 @@\n-  static FT_Error\n-  cff_load_item_variation_store( CFF_Face         face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_get_default_named_instance( FT_Face   face,            \/* CFF_Face *\/\n+                                  FT_UInt  *instance_index )\n+  {\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n+\n+\n+    return mm->get_default_named_instance( face, instance_index );\n+  }\n+\n+\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_load_item_variation_store( FT_Face          face,       \/* CFF_Face *\/\n@@ -944,1 +981,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -947,1 +985,1 @@\n-    return mm->load_item_var_store( FT_FACE(face), offset, itemStore );\n+    return mm->load_item_var_store( face, offset, itemStore );\n@@ -951,2 +989,2 @@\n-  static FT_Error\n-  cff_load_delta_set_index_mapping( CFF_Face           face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_load_delta_set_index_mapping( FT_Face            face,   \/* CFF_Face *\/\n@@ -958,1 +996,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -961,1 +1000,1 @@\n-    return mm->load_delta_set_idx_map( FT_FACE( face ), offset, map,\n+    return mm->load_delta_set_idx_map( face, offset, map,\n@@ -966,2 +1005,2 @@\n-  static FT_Int\n-  cff_get_item_delta( CFF_Face         face,\n+  FT_CALLBACK_DEF( FT_Int )\n+  cff_get_item_delta( FT_Face          face,        \/* CFF_Face *\/\n@@ -972,1 +1011,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -975,2 +1015,1 @@\n-    return mm->get_item_delta( FT_FACE( face ), itemStore,\n-                               outerIndex, innerIndex );\n+    return mm->get_item_delta( face, itemStore, outerIndex, innerIndex );\n@@ -980,2 +1019,2 @@\n-  static void\n-  cff_done_item_variation_store( CFF_Face          face,\n+  FT_CALLBACK_DEF( void )\n+  cff_done_item_variation_store( FT_Face          face,       \/* CFF_Face *\/\n@@ -984,1 +1023,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -987,1 +1027,1 @@\n-    mm->done_item_var_store( FT_FACE( face ), itemStore );\n+    mm->done_item_var_store( face, itemStore );\n@@ -991,2 +1031,2 @@\n-  static void\n-  cff_done_delta_set_index_map( CFF_Face           face,\n+  FT_CALLBACK_DEF( void )\n+  cff_done_delta_set_index_map( FT_Face            face,       \/* CFF_Face *\/\n@@ -995,1 +1035,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -998,1 +1039,1 @@\n-    mm->done_delta_set_idx_map( FT_FACE ( face ), deltaSetIdxMap );\n+    mm->done_delta_set_idx_map( face, deltaSetIdxMap );\n@@ -1006,30 +1047,29 @@\n-    (FT_Get_MM_Func)        NULL,               \/* get_mm                    *\/\n-    (FT_Set_MM_Design_Func) NULL,               \/* set_mm_design             *\/\n-    (FT_Set_MM_Blend_Func)  cff_set_mm_blend,   \/* set_mm_blend              *\/\n-    (FT_Get_MM_Blend_Func)  cff_get_mm_blend,   \/* get_mm_blend              *\/\n-    (FT_Get_MM_Var_Func)    cff_get_mm_var,     \/* get_mm_var                *\/\n-    (FT_Set_Var_Design_Func)cff_set_var_design, \/* set_var_design            *\/\n-    (FT_Get_Var_Design_Func)cff_get_var_design, \/* get_var_design            *\/\n-    (FT_Set_Instance_Func)  cff_set_instance,   \/* set_instance              *\/\n-    (FT_Set_MM_WeightVector_Func)\n-                            cff_set_mm_weightvector,\n-                                                \/* set_mm_weightvector       *\/\n-    (FT_Get_MM_WeightVector_Func)\n-                            cff_get_mm_weightvector,\n-                                                \/* get_mm_weightvector       *\/\n-    (FT_Var_Load_Delta_Set_Idx_Map_Func)\n-                            cff_load_delta_set_index_mapping,\n-                                                \/* load_delta_set_idx_map    *\/\n-    (FT_Var_Load_Item_Var_Store_Func)\n-                            cff_load_item_variation_store,\n-                                                \/* load_item_variation_store *\/\n-    (FT_Var_Get_Item_Delta_Func)\n-                            cff_get_item_delta, \/* get_item_delta            *\/\n-    (FT_Var_Done_Item_Var_Store_Func)\n-                            cff_done_item_variation_store,\n-                                                \/* done_item_variation_store *\/\n-    (FT_Var_Done_Delta_Set_Idx_Map_Func)\n-                            cff_done_delta_set_index_map,\n-                                                \/* done_delta_set_index_map  *\/\n-    (FT_Get_Var_Blend_Func) cff_get_var_blend,  \/* get_var_blend             *\/\n-    (FT_Done_Blend_Func)    cff_done_blend      \/* done_blend                *\/\n+    NULL,                \/* FT_Get_MM_Func         get_mm                     *\/\n+    NULL,                \/* FT_Set_MM_Design_Func  set_mm_design              *\/\n+    cff_set_mm_blend,    \/* FT_Set_MM_Blend_Func   set_mm_blend               *\/\n+    cff_get_mm_blend,    \/* FT_Get_MM_Blend_Func   get_mm_blend               *\/\n+    cff_get_mm_var,      \/* FT_Get_MM_Var_Func     get_mm_var                 *\/\n+    cff_set_var_design,  \/* FT_Set_Var_Design_Func set_var_design             *\/\n+    cff_get_var_design,  \/* FT_Get_Var_Design_Func get_var_design             *\/\n+    cff_set_named_instance,\n+             \/* FT_Set_Named_Instance_Func         set_named_instance         *\/\n+    cff_get_default_named_instance,\n+             \/* FT_Get_Default_Named_Instance_Func get_default_named_instance *\/\n+    cff_set_mm_weightvector,\n+             \/* FT_Set_MM_WeightVector_Func        set_mm_weightvector        *\/\n+    cff_get_mm_weightvector,\n+             \/* FT_Get_MM_WeightVector_Func        get_mm_weightvector        *\/\n+    cff_construct_ps_name,\n+             \/* FT_Construct_PS_Name_Func          construct_ps_name          *\/\n+    cff_load_delta_set_index_mapping,\n+             \/* FT_Var_Load_Delta_Set_Idx_Map_Func load_delta_set_idx_map     *\/\n+    cff_load_item_variation_store,\n+             \/* FT_Var_Load_Item_Var_Store_Func    load_item_variation_store  *\/\n+    cff_get_item_delta,\n+             \/* FT_Var_Get_Item_Delta_Func         get_item_delta             *\/\n+    cff_done_item_variation_store,\n+             \/* FT_Var_Done_Item_Var_Store_Func    done_item_variation_store  *\/\n+    cff_done_delta_set_index_map,\n+             \/* FT_Var_Done_Delta_Set_Idx_Map_Func done_delta_set_index_map   *\/\n+    cff_get_var_blend,   \/* FT_Get_Var_Blend_Func  get_var_blend              *\/\n+    cff_done_blend       \/* FT_Done_Blend_Func     done_blend                 *\/\n@@ -1044,2 +1084,2 @@\n-  static FT_Error\n-  cff_hadvance_adjust( CFF_Face  face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cff_hadvance_adjust( FT_Face   face,    \/* CFF_Face *\/\n@@ -1049,1 +1089,3 @@\n-    FT_Service_MetricsVariations  var = (FT_Service_MetricsVariations)face->var;\n+    CFF_Face  cffface = (CFF_Face)face;\n+    FT_Service_MetricsVariations\n+              var     = (FT_Service_MetricsVariations)cffface->tt_var;\n@@ -1052,1 +1094,1 @@\n-    return var->hadvance_adjust( FT_FACE( face ), gindex, avalue );\n+    return var->hadvance_adjust( face, gindex, avalue );\n@@ -1056,2 +1098,2 @@\n-  static void\n-  cff_metrics_adjust( CFF_Face  face )\n+  FT_CALLBACK_DEF( void )\n+  cff_metrics_adjust( FT_Face  face )    \/* CFF_Face *\/\n@@ -1059,1 +1101,3 @@\n-    FT_Service_MetricsVariations  var = (FT_Service_MetricsVariations)face->var;\n+    CFF_Face  cffface = (CFF_Face)face;\n+    FT_Service_MetricsVariations\n+              var     = (FT_Service_MetricsVariations)cffface->tt_var;\n@@ -1062,1 +1106,1 @@\n-    var->metrics_adjust( FT_FACE( face ) );\n+    var->metrics_adjust( face );\n@@ -1069,3 +1113,3 @@\n-    (FT_HAdvance_Adjust_Func)cff_hadvance_adjust,    \/* hadvance_adjust *\/\n-    (FT_LSB_Adjust_Func)     NULL,                   \/* lsb_adjust      *\/\n-    (FT_RSB_Adjust_Func)     NULL,                   \/* rsb_adjust      *\/\n+    cff_hadvance_adjust,  \/* FT_HAdvance_Adjust_Func hadvance_adjust *\/\n+    NULL,                 \/* FT_LSB_Adjust_Func      lsb_adjust      *\/\n+    NULL,                 \/* FT_RSB_Adjust_Func      rsb_adjust      *\/\n@@ -1073,4 +1117,4 @@\n-    (FT_VAdvance_Adjust_Func)NULL,                   \/* vadvance_adjust *\/\n-    (FT_TSB_Adjust_Func)     NULL,                   \/* tsb_adjust      *\/\n-    (FT_BSB_Adjust_Func)     NULL,                   \/* bsb_adjust      *\/\n-    (FT_VOrg_Adjust_Func)    NULL,                   \/* vorg_adjust     *\/\n+    NULL,                 \/* FT_VAdvance_Adjust_Func vadvance_adjust *\/\n+    NULL,                 \/* FT_TSB_Adjust_Func      tsb_adjust      *\/\n+    NULL,                 \/* FT_BSB_Adjust_Func      bsb_adjust      *\/\n+    NULL,                 \/* FT_VOrg_Adjust_Func     vorg_adjust     *\/\n@@ -1078,1 +1122,2 @@\n-    (FT_Metrics_Adjust_Func) cff_metrics_adjust      \/* metrics_adjust  *\/\n+    cff_metrics_adjust,   \/* FT_Metrics_Adjust_Func  metrics_adjust  *\/\n+    NULL                  \/* FT_Size_Reset_Func      size_reset      *\/\n@@ -1091,5 +1136,5 @@\n-    (FT_Get_Standard_Encoding_Func)cff_get_standard_encoding,\n-    (FT_Load_Private_Dict_Func)    cff_load_private_dict,\n-    (FT_FD_Select_Get_Func)        cff_fd_select_get,\n-    (FT_Blend_Check_Vector_Func)   cff_blend_check_vector,\n-    (FT_Blend_Build_Vector_Func)   cff_blend_build_vector\n+    cff_get_standard_encoding,  \/* FT_Get_Standard_Encoding_Func get_standard_encoding *\/\n+    cff_load_private_dict,      \/* FT_Load_Private_Dict_Func     load_private_dict     *\/\n+    cff_fd_select_get,          \/* FT_FD_Select_Get_Func         fd_select_get         *\/\n+    cff_blend_check_vector,     \/* FT_Blend_Check_Vector_Func    blend_check_vector    *\/\n+    cff_blend_build_vector      \/* FT_Blend_Build_Vector_Func    blend_build_vector    *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffdrivr.c","additions":244,"deletions":199,"binary":false,"changes":443,"status":"modified"},{"patch":"@@ -359,1 +359,3 @@\n-    if ( ( load_flags & FT_LOAD_COLOR ) && face->svg )\n+    if ( ( load_flags & FT_LOAD_NO_SVG ) == 0 &&\n+         ( load_flags & FT_LOAD_COLOR )       &&\n+         face->svg                            )\n@@ -366,1 +368,1 @@\n-      SFNT_Service  sfnt  = (SFNT_Service)face->sfnt;\n+      SFNT_Service  sfnt = (SFNT_Service)face->sfnt;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffgload.c","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -403,1 +403,1 @@\n-  \/* entries to C-style strings (this is, null-terminated).       *\/\n+  \/* entries to C-style strings (that is, null-terminated).       *\/\n@@ -1364,1 +1364,1 @@\n-      FT_UInt32        sum;\n+      FT_Fixed         sum;\n@@ -1367,2 +1367,2 @@\n-      \/* convert inputs to 16.16 fixed-point *\/\n-      sum = cff_parse_num( parser, &parser->stack[i + base] ) * 0x10000;\n+      \/* convert inputs to 16.16 fixed point *\/\n+      sum = cff_parse_fixed( parser, &parser->stack[i + base] );\n@@ -1371,1 +1371,2 @@\n-        sum += cff_parse_num( parser, &parser->stack[delta++] ) * *weight++;\n+        sum += FT_MulFix( cff_parse_fixed( parser, &parser->stack[delta++] ),\n+                          *weight++ );\n@@ -1592,1 +1593,1 @@\n-  cff_get_var_blend( CFF_Face     face,\n+  cff_get_var_blend( FT_Face      face,             \/* CFF_Face *\/\n@@ -1598,1 +1599,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -1601,1 +1603,1 @@\n-    return mm->get_var_blend( FT_FACE( face ),\n+    return mm->get_var_blend( face,\n@@ -1610,1 +1612,1 @@\n-  cff_done_blend( CFF_Face  face )\n+  cff_done_blend( FT_Face  face )    \/* CFF_Face *\/\n@@ -1612,1 +1614,2 @@\n-    FT_Service_MultiMasters  mm = (FT_Service_MultiMasters)face->mm;\n+    CFF_Face                 cffface = (CFF_Face)face;\n+    FT_Service_MultiMasters  mm      = (FT_Service_MultiMasters)cffface->mm;\n@@ -1615,2 +1618,2 @@\n-    if (mm)\n-      mm->done_blend( FT_FACE( face ) );\n+    if ( mm )\n+      mm->done_blend( face );\n@@ -1653,7 +1656,0 @@\n-    \/* Zero out the code to gid\/sid mappings. *\/\n-    for ( j = 0; j < 256; j++ )\n-    {\n-      encoding->sids [j] = 0;\n-      encoding->codes[j] = 0;\n-    }\n-\n@@ -1674,0 +1670,4 @@\n+      \/* Zero out the code to gid\/sid mappings. *\/\n+      FT_ARRAY_ZERO( encoding->sids,  256 );\n+      FT_ARRAY_ZERO( encoding->codes, 256 );\n+\n@@ -2015,1 +2015,1 @@\n-                             &subfont->font_dict,\n+                             top,\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffload.c","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -108,1 +108,1 @@\n-  cff_get_var_blend( CFF_Face     face,\n+  cff_get_var_blend( FT_Face      face,\n@@ -115,1 +115,1 @@\n-  cff_done_blend( CFF_Face  face );\n+  cff_done_blend( FT_Face  face );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffload.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -72,2 +72,2 @@\n-    module = FT_Get_Module( size->root.face->driver->root.library,\n-                            \"pshinter\" );\n+    module = FT_Get_Module( font->library, \"pshinter\" );\n+\n@@ -185,2 +185,1 @@\n-    error = funcs->create( cffsize->face->memory, &priv,\n-                             &internal->topfont );\n+    error = funcs->create( memory, &priv, &internal->topfont );\n@@ -196,2 +195,1 @@\n-      error = funcs->create( cffsize->face->memory, &priv,\n-                               &internal->subfonts[i - 1] );\n+      error = funcs->create( memory, &priv, &internal->subfonts[i - 1] );\n@@ -384,2 +382,1 @@\n-      module = FT_Get_Module( slot->face->driver->root.library,\n-                              \"pshinter\" );\n+      module = FT_Get_Module( slot->library, \"pshinter\" );\n@@ -725,3 +722,0 @@\n-        FT_Service_MultiMasters       mm  = (FT_Service_MultiMasters)face->mm;\n-        FT_Service_MetricsVariations  var = (FT_Service_MetricsVariations)face->var;\n-\n@@ -732,1 +726,0 @@\n-             mm                                 &&\n@@ -735,1 +728,1 @@\n-          error = mm->set_instance( cffface, instance_index );\n+          error = FT_Set_Named_Instance( cffface, instance_index );\n@@ -738,3 +731,0 @@\n-\n-          if ( var )\n-            var->metrics_adjust( cffface );\n@@ -1163,1 +1153,1 @@\n-    cff_done_blend( face );\n+    cff_done_blend( cffface );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffobjs.c","additions":7,"deletions":17,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -66,2 +66,0 @@\n-    {\n-      FT_FREE( parser->stack );\n@@ -69,1 +67,0 @@\n-    }\n@@ -79,17 +76,0 @@\n-#ifdef CFF_CONFIG_OPTION_OLD_ENGINE\n-  static void\n-  finalize_t2_strings( FT_Memory  memory,\n-                       void*      data,\n-                       void*      user )\n-  {\n-    CFF_T2_String  t2 = (CFF_T2_String)data;\n-\n-\n-    FT_UNUSED( user );\n-\n-    memory->free( memory, t2->start );\n-    memory->free( memory, data );\n-  }\n-#endif \/* CFF_CONFIG_OPTION_OLD_ENGINE *\/\n-\n-\n@@ -105,4 +85,1 @@\n-    FT_List_Finalize( &parser->t2_strings,\n-                      finalize_t2_strings,\n-                      memory,\n-                      NULL );\n+    FT_List_Finalize( &parser->t2_strings, NULL, memory, NULL );\n@@ -113,44 +90,3 @@\n-  \/* Assuming `first >= last'. *\/\n-\n-  static FT_Error\n-  cff_parser_within_limits( CFF_Parser  parser,\n-                            FT_Byte*    first,\n-                            FT_Byte*    last )\n-  {\n-#ifndef CFF_CONFIG_OPTION_OLD_ENGINE\n-\n-    \/* Fast path for regular FreeType builds with the \"new\" engine; *\/\n-    \/*   `first >= parser->start' can be assumed.                   *\/\n-\n-    FT_UNUSED( first );\n-\n-    return last < parser->limit ? FT_Err_Ok : FT_THROW( Invalid_Argument );\n-\n-#else \/* CFF_CONFIG_OPTION_OLD_ENGINE *\/\n-\n-    FT_ListNode  node;\n-\n-\n-    if ( first >= parser->start &&\n-         last  <  parser->limit )\n-      return FT_Err_Ok;\n-\n-    node = parser->t2_strings.head;\n-\n-    while ( node )\n-    {\n-      CFF_T2_String  t2 = (CFF_T2_String)node->data;\n-\n-\n-      if ( first >= t2->start &&\n-           last  <  t2->limit )\n-        return FT_Err_Ok;\n-\n-      node = node->next;\n-    }\n-\n-    return FT_THROW( Invalid_Argument );\n-\n-#endif \/* CFF_CONFIG_OPTION_OLD_ENGINE *\/\n-  }\n-\n+  \/* The parser limit checks in the next two functions are supposed *\/\n+  \/* to detect the immediate crossing of the stream boundary.  They *\/\n+  \/* shall not be triggered from the distant t2_strings buffers.    *\/\n@@ -160,2 +96,2 @@\n-  cff_parse_integer( CFF_Parser  parser,\n-                     FT_Byte*    start )\n+  cff_parse_integer( FT_Byte*  start,\n+                     FT_Byte*  limit )\n@@ -170,1 +106,1 @@\n-      if ( cff_parser_within_limits( parser, p, p + 1 ) )\n+      if ( p + 2 > limit && limit >= p )\n@@ -177,1 +113,1 @@\n-      if ( cff_parser_within_limits( parser, p, p + 3 ) )\n+      if ( p + 4 > limit && limit >= p )\n@@ -191,1 +127,1 @@\n-      if ( cff_parser_within_limits( parser, p, p ) )\n+      if ( p + 1 > limit && limit >= p )\n@@ -198,1 +134,1 @@\n-      if ( cff_parser_within_limits( parser, p, p ) )\n+      if ( p + 1 > limit && limit >= p )\n@@ -247,4 +183,4 @@\n-  cff_parse_real( CFF_Parser  parser,\n-                  FT_Byte*    start,\n-                  FT_Long     power_ten,\n-                  FT_Long*    scaling )\n+  cff_parse_real( FT_Byte*  start,\n+                  FT_Byte*  limit,\n+                  FT_Long   power_ten,\n+                  FT_Long*  scaling )\n@@ -285,1 +221,1 @@\n-        if ( cff_parser_within_limits( parser, p, p ) )\n+        if ( p + 1 > limit && limit >= p )\n@@ -322,1 +258,1 @@\n-          if ( cff_parser_within_limits( parser, p, p ) )\n+          if ( p + 1 > limit && limit >= p )\n@@ -361,1 +297,1 @@\n-          if ( cff_parser_within_limits( parser, p, p ) )\n+          if ( p + 1 > limit && limit >= p )\n@@ -528,1 +464,1 @@\n-      return cff_parse_real( parser, *d, 0, NULL ) >> 16;\n+      return cff_parse_real( *d, parser->limit, 0, NULL ) >> 16;\n@@ -554,1 +490,1 @@\n-      return cff_parse_integer( parser, *d );\n+      return cff_parse_integer( *d, parser->limit );\n@@ -565,1 +501,19 @@\n-      return cff_parse_real( parser, *d, scaling, NULL );\n+      return cff_parse_real( *d, parser->limit, scaling, NULL );\n+    else if ( **d == 255 )\n+    {\n+      FT_Fixed val = ( ( ( (FT_UInt32)*( d[0] + 1 ) << 24 ) |\n+                         ( (FT_UInt32)*( d[0] + 2 ) << 16 ) |\n+                         ( (FT_UInt32)*( d[0] + 3 ) <<  8 ) |\n+                           (FT_UInt32)*( d[0] + 4 )         ) );\n+\n+      if ( scaling )\n+      {\n+        if ( FT_ABS( val ) > power_ten_limits[scaling] )\n+        {\n+           FT_TRACE4(( \"!!!OVERFLOW:!!!\" ));\n+           return val > 0 ? 0x7FFFFFFFL : -0x7FFFFFFFL;\n+        }\n+        val *= power_tens[scaling];\n+      }\n+      return val;\n+    }\n@@ -568,1 +522,1 @@\n-      FT_Long  val = cff_parse_integer( parser, *d );\n+      FT_Long  val = cff_parse_integer( *d, parser->limit );\n@@ -573,1 +527,1 @@\n-        if ( FT_ABS( val ) > power_ten_limits[scaling] )\n+        if ( ( FT_ABS( val ) << 16 ) > power_ten_limits[scaling] )\n@@ -603,1 +557,1 @@\n-  static FT_Fixed\n+  FT_LOCAL_DEF( FT_Fixed )\n@@ -633,1 +587,1 @@\n-      return cff_parse_real( parser, *d, 0, scaling );\n+      return cff_parse_real( *d, parser->limit, 0, scaling );\n@@ -640,1 +594,1 @@\n-      number = cff_parse_integer( parser, d[0] );\n+      number = cff_parse_integer( *d, parser->limit );\n@@ -689,1 +643,1 @@\n-      \/* We expect a well-formed font matrix, this is, the matrix elements *\/\n+      \/* We expect a well-formed font matrix, that is, the matrix elements *\/\n@@ -1267,5 +1221,2 @@\n-        FT_Fixed*      stack;\n-        FT_ListNode    node;\n-        CFF_T2_String  t2;\n-        FT_Fixed       t2_size;\n-        FT_Byte*       q;\n+        FT_Fixed*  stack;\n+        FT_Byte*   q = NULL;\n@@ -1312,0 +1263,4 @@\n+        \/* The maximum required size is 5 bytes per stack element.     *\/\n+        if ( FT_QALLOC( q, (FT_Long)( 2 * sizeof ( FT_ListNode ) ) +\n+                           5 * ( decoder.top - decoder.stack ) ) )\n+          goto Exit;\n@@ -1313,25 +1268,1 @@\n-        node = (FT_ListNode)memory->alloc( memory,\n-                                           sizeof ( FT_ListNodeRec ) );\n-        if ( !node )\n-          goto Out_Of_Memory_Error;\n-\n-        FT_List_Add( &parser->t2_strings, node );\n-\n-        t2 = (CFF_T2_String)memory->alloc( memory,\n-                                           sizeof ( CFF_T2_StringRec ) );\n-        if ( !t2 )\n-          goto Out_Of_Memory_Error;\n-\n-        node->data = t2;\n-\n-        \/* `5' is the conservative upper bound of required bytes per stack *\/\n-        \/* element.                                                        *\/\n-\n-        t2_size = 5 * ( decoder.top - decoder.stack );\n-\n-        q = (FT_Byte*)memory->alloc( memory, t2_size );\n-        if ( !q )\n-          goto Out_Of_Memory_Error;\n-\n-        t2->start = q;\n-        t2->limit = q + t2_size;\n+        FT_List_Add( &parser->t2_strings, (FT_ListNode)q );\n@@ -1339,1 +1270,1 @@\n-        stack = decoder.stack;\n+        q += 2 * sizeof ( FT_ListNode );\n@@ -1341,1 +1272,1 @@\n-        while ( stack < decoder.top )\n+        for ( stack = decoder.stack; stack < decoder.top; stack++ )\n@@ -1343,2 +1274,1 @@\n-          FT_ULong  num;\n-          FT_Bool   neg;\n+          FT_Long  num = *stack;\n@@ -1352,11 +1282,0 @@\n-          if ( *stack < 0 )\n-          {\n-            num = (FT_ULong)NEG_LONG( *stack );\n-            neg = 1;\n-          }\n-          else\n-          {\n-            num = (FT_ULong)*stack;\n-            neg = 0;\n-          }\n-\n@@ -1365,3 +1284,0 @@\n-            if ( neg )\n-              num = (FT_ULong)-num;\n-\n@@ -1369,4 +1285,4 @@\n-            *q++ = ( num & 0xFF000000U ) >> 24;\n-            *q++ = ( num & 0x00FF0000U ) >> 16;\n-            *q++ = ( num & 0x0000FF00U ) >>  8;\n-            *q++ =   num & 0x000000FFU;\n+            *q++ = (FT_Byte)( ( num >> 24 ) & 0xFF );\n+            *q++ = (FT_Byte)( ( num >> 16 ) & 0xFF );\n+            *q++ = (FT_Byte)( ( num >>  8 ) & 0xFF );\n+            *q++ = (FT_Byte)( ( num       ) & 0xFF );\n@@ -1378,1 +1294,3 @@\n-            if ( neg )\n+            if ( -107 <= num && num <= 107 )\n+              *q++ = (FT_Byte)( num + 139 );\n+            else if ( 108 <= num && num <= 1131 )\n@@ -1380,15 +1298,7 @@\n-              if ( num <= 107 )\n-                *q++ = (FT_Byte)( 139 - num );\n-              else if ( num <= 1131 )\n-              {\n-                *q++ = (FT_Byte)( ( ( num - 108 ) >> 8 ) + 251 );\n-                *q++ = (FT_Byte)( ( num - 108 ) & 0xFF );\n-              }\n-              else\n-              {\n-                num = (FT_ULong)-num;\n-\n-                *q++ = 28;\n-                *q++ = (FT_Byte)( num >> 8 );\n-                *q++ = (FT_Byte)( num & 0xFF );\n-              }\n+              *q++ = (FT_Byte)( ( ( num - 108 ) >> 8 ) + 247 );\n+              *q++ = (FT_Byte)( ( num - 108 ) & 0xFF );\n+            }\n+            else if ( -1131 <= num && num <= -108 )\n+            {\n+              *q++ = (FT_Byte)( ( ( -num - 108 ) >> 8 ) + 251 );\n+              *q++ = (FT_Byte)( ( -num - 108) & 0xFF );\n@@ -1398,13 +1308,3 @@\n-              if ( num <= 107 )\n-                *q++ = (FT_Byte)( num + 139 );\n-              else if ( num <= 1131 )\n-              {\n-                *q++ = (FT_Byte)( ( ( num - 108 ) >> 8 ) + 247 );\n-                *q++ = (FT_Byte)( ( num - 108 ) & 0xFF );\n-              }\n-              else\n-              {\n-                *q++ = 28;\n-                *q++ = (FT_Byte)( num >> 8 );\n-                *q++ = (FT_Byte)( num & 0xFF );\n-              }\n+              *q++ = 28;\n+              *q++ = (FT_Byte)( num >> 8 );\n+              *q++ = (FT_Byte)( num & 0xFF );\n@@ -1413,2 +1313,0 @@\n-\n-          stack++;\n@@ -1601,6 +1499,0 @@\n-#ifdef CFF_CONFIG_OPTION_OLD_ENGINE\n-  Out_Of_Memory_Error:\n-    error = FT_THROW( Out_Of_Memory );\n-    goto Exit;\n-#endif\n-\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffparse.c","additions":71,"deletions":179,"binary":false,"changes":250,"status":"modified"},{"patch":"@@ -79,0 +79,4 @@\n+  FT_LOCAL( FT_Fixed )\n+  cff_parse_fixed( CFF_Parser  parser,\n+                   FT_Byte**   d );\n+\n@@ -136,9 +140,0 @@\n-#ifdef CFF_CONFIG_OPTION_OLD_ENGINE\n-  typedef struct  CFF_T2_String_\n-  {\n-    FT_Byte*  start;\n-    FT_Byte*  limit;\n-\n-  } CFF_T2_StringRec, *CFF_T2_String;\n-#endif \/* CFF_CONFIG_OPTION_OLD_ENGINE *\/\n-\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cff\/cffparse.h","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -43,0 +43,111 @@\n+  \/*\n+   * A helper function to compute FD number (`fd_select`), the offset to the\n+   * head of the glyph data (`off1`), and the offset to the and of the glyph\n+   * data (`off2`).\n+   *\n+   * The number how many times `cid_get_offset` is invoked can be controlled\n+   * by the number of non-NULL arguments.  If `fd_select` is non-NULL but\n+   * `off1` and `off2` are NULL, `cid_get_offset` is invoked only for\n+   * `fd_select`; `off1` and `off2` are not validated.\n+   *\n+   *\/\n+  FT_LOCAL_DEF( FT_Error )\n+  cid_compute_fd_and_offsets( CID_Face   face,\n+                              FT_UInt    glyph_index,\n+                              FT_ULong*  fd_select_p,\n+                              FT_ULong*  off1_p,\n+                              FT_ULong*  off2_p )\n+  {\n+    FT_Error  error = FT_Err_Ok;\n+\n+    CID_FaceInfo  cid       = &face->cid;\n+    FT_Stream     stream    =  face->cid_stream;\n+    FT_UInt       entry_len = cid->fd_bytes + cid->gd_bytes;\n+\n+    FT_Byte*  p;\n+    FT_Bool   need_frame_exit = 0;\n+    FT_ULong  fd_select, off1, off2;\n+\n+\n+    \/* For ordinary fonts, read the CID font dictionary index *\/\n+    \/* and charstring offset from the CIDMap.                 *\/\n+\n+    if ( FT_STREAM_SEEK( cid->data_offset + cid->cidmap_offset +\n+                         glyph_index * entry_len )               ||\n+         FT_FRAME_ENTER( 2 * entry_len )                         )\n+      goto Exit;\n+\n+    need_frame_exit = 1;\n+\n+    p         = (FT_Byte*)stream->cursor;\n+    fd_select = cid_get_offset( &p, cid->fd_bytes );\n+    off1      = cid_get_offset( &p, cid->gd_bytes );\n+\n+    p    += cid->fd_bytes;\n+    off2  = cid_get_offset( &p, cid->gd_bytes );\n+\n+    if ( fd_select_p )\n+      *fd_select_p = fd_select;\n+    if ( off1_p )\n+      *off1_p = off1;\n+    if ( off2_p )\n+      *off2_p = off2;\n+\n+    if ( fd_select >= cid->num_dicts )\n+    {\n+      \/*\n+       * fd_select == 0xFF is often used to indicate that the CID\n+       * has no charstring to be rendered, similar to GID = 0xFFFF\n+       * in TrueType fonts.\n+       *\/\n+      if ( ( cid->fd_bytes == 1 && fd_select == 0xFFU   ) ||\n+           ( cid->fd_bytes == 2 && fd_select == 0xFFFFU ) )\n+      {\n+        FT_TRACE1(( \"cid_load_glyph: fail for glyph index %d:\\n\",\n+                    glyph_index ));\n+        FT_TRACE1(( \"                FD number %ld is the maximum\\n\",\n+                    fd_select ));\n+        FT_TRACE1(( \"                integer fitting into %d byte%s\\n\",\n+                    cid->fd_bytes, cid->fd_bytes == 1 ? \"\" : \"s\" ));\n+      }\n+      else\n+      {\n+        FT_TRACE0(( \"cid_load_glyph: fail for glyph index %d:\\n\",\n+                    glyph_index ));\n+        FT_TRACE0(( \"                FD number %ld is larger\\n\",\n+                    fd_select ));\n+        FT_TRACE0(( \"                than number of dictionaries (%d)\\n\",\n+                    cid->num_dicts ));\n+      }\n+\n+      error = FT_THROW( Invalid_Offset );\n+      goto Exit;\n+    }\n+    else if ( off2 > stream->size )\n+    {\n+      FT_TRACE0(( \"cid_load_glyph: fail for glyph index %d:\\n\",\n+                  glyph_index ));\n+      FT_TRACE0(( \"               end of the glyph data\\n\" ));\n+      FT_TRACE0(( \"               is beyond the data stream\\n\" ));\n+\n+      error = FT_THROW( Invalid_Offset );\n+      goto Exit;\n+    }\n+    else if ( off1 > off2 )\n+    {\n+      FT_TRACE0(( \"cid_load_glyph: fail for glyph index %d:\\n\",\n+                  glyph_index ));\n+      FT_TRACE0(( \"                the end position of glyph data\\n\" ));\n+      FT_TRACE0(( \"                is set before the start position\\n\" ));\n+\n+      error = FT_THROW( Invalid_Offset );\n+    }\n+\n+    Exit:\n+      if ( need_frame_exit )\n+        FT_FRAME_EXIT();\n+\n+    return error;\n+  }\n+\n+\n@@ -100,3 +211,0 @@\n-\n-    \/* For ordinary fonts read the CID font dictionary index *\/\n-    \/* and charstring offset from the CIDMap.                *\/\n@@ -104,1 +212,0 @@\n-      FT_UInt   entry_len = cid->fd_bytes + cid->gd_bytes;\n@@ -108,18 +215,3 @@\n-      if ( FT_STREAM_SEEK( cid->data_offset + cid->cidmap_offset +\n-                           glyph_index * entry_len )               ||\n-           FT_FRAME_ENTER( 2 * entry_len )                         )\n-        goto Exit;\n-\n-      p         = (FT_Byte*)stream->cursor;\n-      fd_select = cid_get_offset( &p, cid->fd_bytes );\n-      off1      = cid_get_offset( &p, cid->gd_bytes );\n-      p        += cid->fd_bytes;\n-      off2      = cid_get_offset( &p, cid->gd_bytes );\n-      FT_FRAME_EXIT();\n-\n-      if ( fd_select >= cid->num_dicts ||\n-           off2 > stream->size         ||\n-           off1 > off2                 )\n-      {\n-        FT_TRACE0(( \"cid_load_glyph: invalid glyph stream offsets\\n\" ));\n-        error = FT_THROW( Invalid_Offset );\n+      error = cid_compute_fd_and_offsets( face, glyph_index,\n+                                          &fd_select, &off1, &off2 );\n+      if ( error )\n@@ -127,1 +219,0 @@\n-      }\n@@ -164,1 +255,3 @@\n-        FT_TRACE0(( \"cid_load_glyph: invalid glyph stream offsets\\n\" ));\n+        FT_TRACE0(( \"cid_load_glyph: fail for glyph_index=%d, \"\n+                    \"offset to the charstring is beyond glyph length\\n\",\n+                    glyph_index ));\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cid\/cidgload.c","additions":117,"deletions":24,"binary":false,"changes":141,"status":"modified"},{"patch":"@@ -45,0 +45,8 @@\n+  FT_LOCAL( FT_Error )\n+  cid_compute_fd_and_offsets( CID_Face   face,\n+                              FT_UInt    glyph_index,\n+                              FT_ULong*  fd_select_p,\n+                              FT_ULong*  off1_p,\n+                              FT_ULong*  off2_p );\n+\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cid\/cidgload.h","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -158,2 +158,2 @@\n-  cid_parse_font_matrix( CID_Face     face,\n-                         CID_Parser*  parser )\n+  cid_parse_font_matrix( FT_Face  face,     \/* CID_Face *\/\n+                         void*    parser_ )\n@@ -161,0 +161,2 @@\n+    CID_Face      cidface = (CID_Face)face;\n+    CID_Parser*   parser  = (CID_Parser*)parser_;\n@@ -162,1 +164,0 @@\n-    FT_Face       root = (FT_Face)&face->root;\n@@ -167,1 +168,1 @@\n-    if ( parser->num_dict < face->cid.num_dicts )\n+    if ( parser->num_dict < cidface->cid.num_dicts )\n@@ -174,1 +175,1 @@\n-      dict   = face->cid.font_dicts + parser->num_dict;\n+      dict   = cidface->cid.font_dicts + parser->num_dict;\n@@ -207,1 +208,1 @@\n-        root->units_per_EM = (FT_UShort)FT_DivFix( 1000, temp_scale );\n+        face->units_per_EM = (FT_UShort)FT_DivFix( 1000, temp_scale );\n@@ -240,2 +241,2 @@\n-  parse_fd_array( CID_Face     face,\n-                  CID_Parser*  parser )\n+  parse_fd_array( FT_Face  face,     \/* CID_Face *\/\n+                  void*    parser_ )\n@@ -243,4 +244,6 @@\n-    CID_FaceInfo  cid    = &face->cid;\n-    FT_Memory     memory = face->root.memory;\n-    FT_Stream     stream = parser->stream;\n-    FT_Error      error  = FT_Err_Ok;\n+    CID_Face      cidface = (CID_Face)face;\n+    CID_Parser*   parser  = (CID_Parser*)parser_;\n+    CID_FaceInfo  cid     = &cidface->cid;\n+    FT_Memory     memory  = FT_FACE_MEMORY( face );\n+    FT_Stream     stream  = parser->stream;\n+    FT_Error      error   = FT_Err_Ok;\n@@ -316,1 +319,1 @@\n-  \/* changed).  We simply copy the value.                         *\/\n+  \/* be thus changed).  We simply copy the value.                 *\/\n@@ -319,2 +322,2 @@\n-  parse_expansion_factor( CID_Face     face,\n-                          CID_Parser*  parser )\n+  parse_expansion_factor( FT_Face  face,    \/* CID_Face *\/\n+                          void*    parser_ )\n@@ -322,0 +325,2 @@\n+    CID_Face      cidface = (CID_Face)face;\n+    CID_Parser*   parser  = (CID_Parser*)parser_;\n@@ -325,1 +330,1 @@\n-    if ( parser->num_dict < face->cid.num_dicts )\n+    if ( parser->num_dict < cidface->cid.num_dicts )\n@@ -327,1 +332,1 @@\n-      dict = face->cid.font_dicts + parser->num_dict;\n+      dict = cidface->cid.font_dicts + parser->num_dict;\n@@ -344,2 +349,2 @@\n-  parse_font_name( CID_Face     face,\n-                   CID_Parser*  parser )\n+  parse_font_name( FT_Face  face,     \/* CID_Face *\/\n+                   void*    parser_ )\n@@ -348,1 +353,5 @@\n-    if ( parser->num_dict < face->cid.num_dicts )\n+    CID_Face      cidface = (CID_Face)face;\n+    CID_Parser*   parser  = (CID_Parser*)parser_;\n+\n+\n+    if ( parser->num_dict < cidface->cid.num_dicts )\n@@ -364,1 +373,1 @@\n-    FT_UNUSED( parser );\n+    FT_UNUSED( parser_ );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cid\/cidload.c","additions":30,"deletions":21,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -72,2 +72,1 @@\n-      module = FT_Get_Module( slot->face->driver->root.library,\n-                              \"pshinter\" );\n+      module = FT_Get_Module( slot->library, \"pshinter\" );\n@@ -271,1 +270,2 @@\n-   *     The source font stream.\n+   *     Dummy argument for compatibility with the `FT_Face_InitFunc` API.\n+   *     Ignored.  The stream should be passed through `face->root.stream`.\n@@ -378,0 +378,8 @@\n+      \/*\n+       * For the sfnt-wrapped CID fonts for MacOS, currently,\n+       * its `cmap' tables are ignored, and the content in\n+       * its `CID ' table is treated the same as naked CID-keyed\n+       * font.  See ft_lookup_PS_in_sfnt_stream().\n+       *\/\n+      cidface->face_flags |= FT_FACE_FLAG_CID_KEYED;\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cid\/cidobjs.c","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -217,3 +217,2 @@\n-        if ( ft_strncmp( (char*)arg1, \"(Hex)\", 5 ) == 0 )\n-        {\n-          FT_Long  tmp = ft_strtol( (const char *)arg2, NULL, 10 );\n+        T1_TokenRec  type_token;\n+        FT_Long      binary_length;\n@@ -222,1 +221,8 @@\n-          if ( tmp < 0 )\n+        parser->root.cursor = arg1;\n+        cid_parser_to_token( parser, &type_token );\n+        if ( type_token.limit - type_token.start == 5              &&\n+             ft_memcmp( (char*)type_token.start, \"(Hex)\", 5 ) == 0 )\n+        {\n+          parser->root.cursor = arg2;\n+          binary_length = cid_parser_to_int( parser );\n+          if ( binary_length < 0 )\n@@ -228,1 +234,1 @@\n-            parser->binary_length = (FT_ULong)tmp;\n+            parser->binary_length = (FT_ULong)binary_length;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cid\/cidparse.c","additions":11,"deletions":5,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -51,2 +51,2 @@\n-  static const char*\n-  cid_get_postscript_name( CID_Face  face )\n+  FT_CALLBACK_DEF( const char* )\n+  cid_get_postscript_name( FT_Face  face )    \/* CID_Face *\/\n@@ -54,1 +54,2 @@\n-    const char*  result = face->cid.cid_font_name;\n+    CID_Face     cidface = (CID_Face)face;\n+    const char*  result  = cidface->cid.cid_font_name;\n@@ -75,2 +76,2 @@\n-  static FT_Error\n-  cid_ps_get_font_info( FT_Face          face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cid_ps_get_font_info( FT_Face          face,        \/* CID_Face *\/\n@@ -79,1 +80,1 @@\n-    *afont_info = ((CID_Face)face)->cid.font_info;\n+    *afont_info = ( (CID_Face)face )->cid.font_info;\n@@ -84,3 +85,4 @@\n-  static FT_Error\n-  cid_ps_get_font_extra( FT_Face          face,\n-                        PS_FontExtraRec*  afont_extra )\n+\n+  FT_CALLBACK_DEF( FT_Error )\n+  cid_ps_get_font_extra( FT_Face           face,         \/* CID_Face *\/\n+                         PS_FontExtraRec*  afont_extra )\n@@ -88,1 +90,1 @@\n-    *afont_extra = ((CID_Face)face)->font_extra;\n+    *afont_extra = ( (CID_Face)face )->font_extra;\n@@ -93,0 +95,1 @@\n+\n@@ -95,2 +98,2 @@\n-    (PS_GetFontInfoFunc)   cid_ps_get_font_info,   \/* ps_get_font_info    *\/\n-    (PS_GetFontExtraFunc)  cid_ps_get_font_extra,  \/* ps_get_font_extra   *\/\n+    cid_ps_get_font_info,   \/* PS_GetFontInfoFunc    ps_get_font_info    *\/\n+    cid_ps_get_font_extra,  \/* PS_GetFontExtraFunc   ps_get_font_extra   *\/\n@@ -98,1 +101,1 @@\n-    (PS_HasGlyphNamesFunc) NULL,                   \/* ps_has_glyph_names  *\/\n+    NULL,                   \/* PS_HasGlyphNamesFunc  ps_has_glyph_names  *\/\n@@ -100,1 +103,1 @@\n-    (PS_GetFontPrivateFunc)NULL,                   \/* ps_get_font_private *\/\n+    NULL,                   \/* PS_GetFontPrivateFunc ps_get_font_private *\/\n@@ -102,1 +105,1 @@\n-    (PS_GetFontValueFunc)  NULL                    \/* ps_get_font_value   *\/\n+    NULL                    \/* PS_GetFontValueFunc   ps_get_font_value   *\/\n@@ -110,2 +113,2 @@\n-  static FT_Error\n-  cid_get_ros( CID_Face      face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cid_get_ros( FT_Face       face,        \/* CID_Face *\/\n@@ -116,1 +119,2 @@\n-    CID_FaceInfo  cid = &face->cid;\n+    CID_Face      cidface = (CID_Face)face;\n+    CID_FaceInfo  cid     = &cidface->cid;\n@@ -132,2 +136,2 @@\n-  static FT_Error\n-  cid_get_is_cid( CID_Face  face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cid_get_is_cid( FT_Face   face,    \/* CID_Face *\/\n@@ -140,0 +144,6 @@\n+    \/*\n+     * XXX: If the ROS is Adobe-Identity-H or -V,\n+     * the font has no reliable information about\n+     * its glyph collection.  Should we not set\n+     * *is_cid in such cases?\n+     *\/\n@@ -141,1 +151,1 @@\n-      *is_cid = 1; \/* cid driver is only used for CID keyed fonts *\/\n+      *is_cid = 1;\n@@ -147,2 +157,2 @@\n-  static FT_Error\n-  cid_get_cid_from_glyph_index( CID_Face  face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  cid_get_cid_from_glyph_index( FT_Face   face,        \/* CID_Face *\/\n@@ -152,6 +162,16 @@\n-    FT_Error  error = FT_Err_Ok;\n-    FT_UNUSED( face );\n-\n-\n-    if ( cid )\n-      *cid = glyph_index; \/* identity mapping *\/\n+    FT_Error  error   = FT_Err_Ok;\n+    CID_Face  cidface = (CID_Face)face;\n+\n+\n+    \/*\n+     * Currently, FreeType does not support incrementally-defined, CID-keyed\n+     * fonts that store the glyph description data in a `\/GlyphDirectory`\n+     * array or dictionary.  Fonts loaded by the incremental loading feature\n+     * are thus not handled here.\n+     *\/\n+    error = cid_compute_fd_and_offsets( cidface, glyph_index,\n+                                        NULL, NULL, NULL );\n+    if ( error )\n+      *cid = 0;\n+    else\n+      *cid = glyph_index;\n@@ -165,6 +185,6 @@\n-    (FT_CID_GetRegistryOrderingSupplementFunc)\n-      cid_get_ros,                             \/* get_ros                  *\/\n-    (FT_CID_GetIsInternallyCIDKeyedFunc)\n-      cid_get_is_cid,                          \/* get_is_cid               *\/\n-    (FT_CID_GetCIDFromGlyphIndexFunc)\n-      cid_get_cid_from_glyph_index             \/* get_cid_from_glyph_index *\/\n+    cid_get_ros,\n+      \/* FT_CID_GetRegistryOrderingSupplementFunc get_ros                  *\/\n+    cid_get_is_cid,\n+      \/* FT_CID_GetIsInternallyCIDKeyedFunc       get_is_cid               *\/\n+    cid_get_cid_from_glyph_index\n+      \/* FT_CID_GetCIDFromGlyphIndexFunc          get_cid_from_glyph_index *\/\n@@ -182,3 +202,3 @@\n-    (FT_Properties_SetFunc)ps_property_set,      \/* set_property *\/\n-    (FT_Properties_GetFunc)ps_property_get )     \/* get_property *\/\n-\n+    ps_property_set,  \/* FT_Properties_SetFunc set_property *\/\n+    ps_property_get   \/* FT_Properties_GetFunc get_property *\/\n+  )\n@@ -212,1 +232,0 @@\n-\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/cid\/cidriver.c","additions":58,"deletions":39,"binary":false,"changes":97,"status":"modified"},{"patch":"@@ -1089,1 +1089,1 @@\n-  typedef int  _afm_parse_dummy;\n+  typedef int  afm_parse_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/psaux\/afmparse.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2156,1 +2156,1 @@\n-            FT_TRACE4(( \" callsubr (idx %d, entering level %ld)\\n\",\n+            FT_TRACE4(( \" callsubr (idx %d, entering level %td)\\n\",\n@@ -2200,1 +2200,1 @@\n-            FT_TRACE4(( \" callgsubr (idx %d, entering level %ld)\\n\",\n+            FT_TRACE4(( \" callgsubr (idx %d, entering level %td)\\n\",\n@@ -2239,1 +2239,1 @@\n-          FT_TRACE4(( \" return (leaving level %ld)\\n\",\n+          FT_TRACE4(( \" return (leaving level %td)\\n\",\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/psaux\/cffdecode.c","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -313,1 +313,1 @@\n-      FT_TRACE6(( \"  %3ld    %7.2f  %7.2f  %5d  %s%s%s%s\\n\",\n+      FT_TRACE6(( \"  %3zu    %7.2f  %7.2f  %5d  %s%s%s%s\\n\",\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/psaux\/pshints.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-  t1_cmap_std_done( T1_CMapStd  cmap )\n+  t1_cmap_std_done( FT_CMap  cmap_ )   \/* T1_CMapStd *\/\n@@ -55,0 +55,3 @@\n+    T1_CMapStd  cmap = (T1_CMapStd)cmap_;\n+\n+\n@@ -63,2 +66,2 @@\n-  t1_cmap_std_char_index( T1_CMapStd  cmap,\n-                          FT_UInt32   char_code )\n+  t1_cmap_std_char_index( FT_CMap    cmap,       \/* T1_CMapStd *\/\n+                          FT_UInt32  char_code )\n@@ -66,1 +69,2 @@\n-    FT_UInt  result = 0;\n+    T1_CMapStd  t1cmap = (T1_CMapStd)cmap;\n+    FT_UInt     result = 0;\n@@ -76,2 +80,2 @@\n-      code       = cmap->code_to_sid[char_code];\n-      glyph_name = cmap->sid_to_string( code );\n+      code       = t1cmap->code_to_sid[char_code];\n+      glyph_name = t1cmap->sid_to_string( code );\n@@ -80,1 +84,1 @@\n-      for ( n = 0; n < cmap->num_glyphs; n++ )\n+      for ( n = 0; n < t1cmap->num_glyphs; n++ )\n@@ -82,1 +86,1 @@\n-        const char* gname = cmap->glyph_names[n];\n+        const char* gname = t1cmap->glyph_names[n];\n@@ -98,3 +102,3 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  t1_cmap_std_char_next( T1_CMapStd   cmap,\n-                         FT_UInt32   *pchar_code )\n+  FT_CALLBACK_DEF( FT_UInt )\n+  t1_cmap_std_char_next( FT_CMap     cmap,\n+                         FT_UInt32  *pchar_code )\n@@ -123,1 +127,1 @@\n-  t1_cmap_standard_init( T1_CMapStd  cmap,\n+  t1_cmap_standard_init( FT_CMap     cmap,     \/* T1_CMapStd *\/\n@@ -126,0 +130,1 @@\n+    T1_CMapStd  t1cmap = (T1_CMapStd)cmap;\n@@ -129,1 +134,1 @@\n-    t1_cmap_std_init( cmap, 0 );\n+    t1_cmap_std_init( t1cmap, 0 );\n@@ -153,1 +158,1 @@\n-  t1_cmap_expert_init( T1_CMapStd  cmap,\n+  t1_cmap_expert_init( FT_CMap     cmap,     \/* T1_CMapStd *\/\n@@ -156,0 +161,1 @@\n+    T1_CMapStd  t1cmap = (T1_CMapStd)cmap;\n@@ -159,1 +165,1 @@\n-    t1_cmap_std_init( cmap, 1 );\n+    t1_cmap_std_init( t1cmap, 1 );\n@@ -191,2 +197,2 @@\n-  t1_cmap_custom_init( T1_CMapCustom  cmap,\n-                       FT_Pointer     pointer )\n+  t1_cmap_custom_init( FT_CMap     cmap,     \/* T1_CMapCustom *\/\n+                       FT_Pointer  pointer )\n@@ -194,2 +200,3 @@\n-    T1_Face      face     = (T1_Face)FT_CMAP_FACE( cmap );\n-    T1_Encoding  encoding = &face->type1.encoding;\n+    T1_CMapCustom  t1cmap   = (T1_CMapCustom)cmap;\n+    T1_Face        face     = (T1_Face)FT_CMAP_FACE( cmap );\n+    T1_Encoding    encoding = &face->type1.encoding;\n@@ -200,3 +207,3 @@\n-    cmap->first   = (FT_UInt)encoding->code_first;\n-    cmap->count   = (FT_UInt)encoding->code_last - cmap->first;\n-    cmap->indices = encoding->char_index;\n+    t1cmap->first   = (FT_UInt)encoding->code_first;\n+    t1cmap->count   = (FT_UInt)encoding->code_last - t1cmap->first;\n+    t1cmap->indices = encoding->char_index;\n@@ -204,1 +211,1 @@\n-    FT_ASSERT( cmap->indices );\n+    FT_ASSERT( t1cmap->indices );\n@@ -212,1 +219,1 @@\n-  t1_cmap_custom_done( T1_CMapCustom  cmap )\n+  t1_cmap_custom_done( FT_CMap  cmap )   \/* T1_CMapCustom *\/\n@@ -214,3 +221,6 @@\n-    cmap->indices = NULL;\n-    cmap->first   = 0;\n-    cmap->count   = 0;\n+    T1_CMapCustom  t1cmap = (T1_CMapCustom)cmap;\n+\n+\n+    t1cmap->indices = NULL;\n+    t1cmap->first   = 0;\n+    t1cmap->count   = 0;\n@@ -221,2 +231,2 @@\n-  t1_cmap_custom_char_index( T1_CMapCustom  cmap,\n-                             FT_UInt32      char_code )\n+  t1_cmap_custom_char_index( FT_CMap    cmap,       \/* T1_CMapCustom *\/\n+                             FT_UInt32  char_code )\n@@ -224,1 +234,2 @@\n-    FT_UInt    result = 0;\n+    T1_CMapCustom  t1cmap = (T1_CMapCustom)cmap;\n+    FT_UInt        result = 0;\n@@ -227,3 +238,3 @@\n-    if ( ( char_code >= cmap->first )                  &&\n-         ( char_code < ( cmap->first + cmap->count ) ) )\n-      result = cmap->indices[char_code];\n+    if ( char_code >= t1cmap->first                    &&\n+         char_code < ( t1cmap->first + t1cmap->count ) )\n+      result = t1cmap->indices[char_code];\n@@ -235,3 +246,3 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  t1_cmap_custom_char_next( T1_CMapCustom  cmap,\n-                            FT_UInt32     *pchar_code )\n+  FT_CALLBACK_DEF( FT_UInt )\n+  t1_cmap_custom_char_next( FT_CMap     cmap,        \/* T1_CMapCustom *\/\n+                            FT_UInt32  *pchar_code )\n@@ -239,2 +250,3 @@\n-    FT_UInt    result = 0;\n-    FT_UInt32  char_code = *pchar_code;\n+    T1_CMapCustom  t1cmap    = (T1_CMapCustom)cmap;\n+    FT_UInt        result    = 0;\n+    FT_UInt32      char_code = *pchar_code;\n@@ -245,2 +257,2 @@\n-    if ( char_code < cmap->first )\n-      char_code = cmap->first;\n+    if ( char_code < t1cmap->first )\n+      char_code = t1cmap->first;\n@@ -248,1 +260,1 @@\n-    for ( ; char_code < ( cmap->first + cmap->count ); char_code++ )\n+    for ( ; char_code < ( t1cmap->first + t1cmap->count ); char_code++ )\n@@ -250,1 +262,1 @@\n-      result = cmap->indices[char_code];\n+      result = t1cmap->indices[char_code];\n@@ -290,1 +302,1 @@\n-  psaux_get_glyph_name( T1_Face  face,\n+  psaux_get_glyph_name( void*    face_,\n@@ -293,0 +305,3 @@\n+    T1_Face  face = (T1_Face)face_;\n+\n+\n@@ -298,2 +313,2 @@\n-  t1_cmap_unicode_init( PS_Unicodes  unicodes,\n-                        FT_Pointer   pointer )\n+  t1_cmap_unicode_init( FT_CMap     cmap,     \/* PS_Unicodes *\/\n+                        FT_Pointer  pointer )\n@@ -301,3 +316,4 @@\n-    T1_Face             face    = (T1_Face)FT_CMAP_FACE( unicodes );\n-    FT_Memory           memory  = FT_FACE_MEMORY( face );\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)face->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    T1_Face             face     = (T1_Face)FT_CMAP_FACE( cmap );\n+    FT_Memory           memory   = FT_FACE_MEMORY( face );\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)face->psnames;\n@@ -314,1 +330,1 @@\n-                                   (PS_GetGlyphNameFunc)&psaux_get_glyph_name,\n+                                   &psaux_get_glyph_name,\n@@ -321,1 +337,1 @@\n-  t1_cmap_unicode_done( PS_Unicodes  unicodes )\n+  t1_cmap_unicode_done( FT_CMap  cmap )   \/* PS_Unicodes *\/\n@@ -323,2 +339,3 @@\n-    FT_Face    face   = FT_CMAP_FACE( unicodes );\n-    FT_Memory  memory = FT_FACE_MEMORY( face );\n+    PS_Unicodes  unicodes = (PS_Unicodes)cmap;\n+    FT_Face      face     = FT_CMAP_FACE( cmap );\n+    FT_Memory    memory   = FT_FACE_MEMORY( face );\n@@ -333,2 +350,2 @@\n-  t1_cmap_unicode_char_index( PS_Unicodes  unicodes,\n-                              FT_UInt32    char_code )\n+  t1_cmap_unicode_char_index( FT_CMap    cmap,       \/* PS_Unicodes *\/\n+                              FT_UInt32  char_code )\n@@ -336,2 +353,3 @@\n-    T1_Face             face    = (T1_Face)FT_CMAP_FACE( unicodes );\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)face->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    T1_Face             face     = (T1_Face)FT_CMAP_FACE( cmap );\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)face->psnames;\n@@ -344,3 +362,3 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  t1_cmap_unicode_char_next( PS_Unicodes  unicodes,\n-                             FT_UInt32   *pchar_code )\n+  FT_CALLBACK_DEF( FT_UInt )\n+  t1_cmap_unicode_char_next( FT_CMap     cmap,        \/* PS_Unicodes *\/\n+                             FT_UInt32  *pchar_code )\n@@ -348,2 +366,3 @@\n-    T1_Face             face    = (T1_Face)FT_CMAP_FACE( unicodes );\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)face->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    T1_Face             face     = (T1_Face)FT_CMAP_FACE( cmap );\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)face->psnames;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/psaux\/t1cmap.c","additions":80,"deletions":61,"binary":false,"changes":141,"status":"modified"},{"patch":"@@ -523,1 +523,1 @@\n-        FT_TRACE5(( \" (%ld)\", decoder->top - decoder->stack ));\n+        FT_TRACE5(( \" (%td)\", decoder->top - decoder->stack ));\n@@ -1168,1 +1168,1 @@\n-                        \" (seen %ld, expected %d)\\n\",\n+                        \" (seen %td, expected %d)\\n\",\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/psaux\/t1decode.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -519,1 +519,1 @@\n-            \/* keep original relation between hints, this is, use the *\/\n+            \/* keep original relation between hints, that is, use the *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/pshinter\/pshalgo.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-  ps_hinter_done( PS_Hinter_Module  module )\n+  ps_hinter_done( FT_Module  module_ )    \/* PS_Hinter_Module *\/\n@@ -42,0 +42,3 @@\n+    PS_Hinter_Module  module = (PS_Hinter_Module)module_;\n+\n+\n@@ -51,1 +54,1 @@\n-  ps_hinter_init( PS_Hinter_Module  module )\n+  ps_hinter_init( FT_Module  module_ )    \/* PS_Hinter_Module *\/\n@@ -53,0 +56,2 @@\n+    PS_Hinter_Module  module = (PS_Hinter_Module)module_;\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/pshinter\/pshmod.c","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -854,1 +854,1 @@\n-  ps_hints_t1stem3( PS_Hints   hints,\n+  ps_hints_t1stem3( T1_Hints   hints_,    \/* PS_Hints *\/\n@@ -858,0 +858,1 @@\n+    PS_Hints  hints = (PS_Hints)hints_;\n@@ -917,1 +918,1 @@\n-  ps_hints_t1reset( PS_Hints  hints,\n+  ps_hints_t1reset( T1_Hints  hints_,     \/* PS_Hints *\/\n@@ -920,0 +921,1 @@\n+    PS_Hints  hints = (PS_Hints)hints_;\n@@ -956,1 +958,1 @@\n-  ps_hints_t2mask( PS_Hints        hints,\n+  ps_hints_t2mask( T2_Hints        hints_,    \/* PS_Hints *\/\n@@ -961,0 +963,1 @@\n+    PS_Hints  hints = (PS_Hints)hints_;\n@@ -1002,1 +1005,1 @@\n-  ps_hints_t2counter( PS_Hints        hints,\n+  ps_hints_t2counter( T2_Hints        hints_,    \/* PS_Hints *\/\n@@ -1006,0 +1009,1 @@\n+    PS_Hints  hints = (PS_Hints)hints_;\n@@ -1090,0 +1094,7 @@\n+  static FT_Error\n+  t1_hints_close( T1_Hints  hints,\n+                  FT_UInt   end_point )\n+  {\n+    return ps_hints_close( (PS_Hints)hints, end_point );\n+  }\n+\n@@ -1105,0 +1116,10 @@\n+  static FT_Error\n+  t1_hints_apply( T1_Hints        hints,\n+                  FT_Outline*     outline,\n+                  PSH_Globals     globals,\n+                  FT_Render_Mode  hint_mode )\n+  {\n+    return ps_hints_apply( (PS_Hints)hints, outline, globals, hint_mode );\n+  }\n+\n+\n@@ -1111,1 +1132,1 @@\n-    funcs->close = (T1_Hints_CloseFunc)   ps_hints_close;\n+    funcs->close = (T1_Hints_CloseFunc)   t1_hints_close;\n@@ -1115,1 +1136,1 @@\n-    funcs->apply = (T1_Hints_ApplyFunc)   ps_hints_apply;\n+    funcs->apply = (T1_Hints_ApplyFunc)   t1_hints_apply;\n@@ -1134,0 +1155,8 @@\n+  static FT_Error\n+  t2_hints_close( T2_Hints  hints,\n+                  FT_UInt   end_point )\n+  {\n+    return ps_hints_close( (PS_Hints)hints, end_point );\n+  }\n+\n+\n@@ -1171,0 +1200,10 @@\n+  static FT_Error\n+  t2_hints_apply( T2_Hints        hints,\n+                  FT_Outline*     outline,\n+                  PSH_Globals     globals,\n+                  FT_Render_Mode  hint_mode )\n+  {\n+    return ps_hints_apply( (PS_Hints)hints, outline, globals, hint_mode );\n+  }\n+\n+\n@@ -1176,6 +1215,6 @@\n-    funcs->open    = (T2_Hints_OpenFunc)   t2_hints_open;\n-    funcs->close   = (T2_Hints_CloseFunc)  ps_hints_close;\n-    funcs->stems   = (T2_Hints_StemsFunc)  t2_hints_stems;\n-    funcs->hintmask= (T2_Hints_MaskFunc)   ps_hints_t2mask;\n-    funcs->counter = (T2_Hints_CounterFunc)ps_hints_t2counter;\n-    funcs->apply   = (T2_Hints_ApplyFunc)  ps_hints_apply;\n+    funcs->open     = (T2_Hints_OpenFunc)   t2_hints_open;\n+    funcs->close    = (T2_Hints_CloseFunc)  t2_hints_close;\n+    funcs->stems    = (T2_Hints_StemsFunc)  t2_hints_stems;\n+    funcs->hintmask = (T2_Hints_MaskFunc)   ps_hints_t2mask;\n+    funcs->counter  = (T2_Hints_CounterFunc)ps_hints_t2counter;\n+    funcs->apply    = (T2_Hints_ApplyFunc)  t2_hints_apply;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/pshinter\/pshrec.c","additions":51,"deletions":12,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -60,1 +60,1 @@\n-  static FT_UInt32\n+  FT_CALLBACK_DEF( FT_UInt32 )\n@@ -312,1 +312,1 @@\n-  static FT_Error\n+  FT_CALLBACK_DEF( FT_Error )\n@@ -411,1 +411,1 @@\n-  static FT_UInt\n+  FT_CALLBACK_DEF( FT_UInt )\n@@ -456,1 +456,1 @@\n-  static FT_UInt32\n+  FT_CALLBACK_DEF( FT_UInt )\n@@ -521,1 +521,1 @@\n-  static const char*\n+  FT_CALLBACK_DEF( const char* )\n@@ -531,1 +531,1 @@\n-  static const char*\n+  FT_CALLBACK_DEF( const char* )\n@@ -546,4 +546,4 @@\n-    (PS_Unicode_ValueFunc)     ps_unicode_value,        \/* unicode_value         *\/\n-    (PS_Unicodes_InitFunc)     ps_unicodes_init,        \/* unicodes_init         *\/\n-    (PS_Unicodes_CharIndexFunc)ps_unicodes_char_index,  \/* unicodes_char_index   *\/\n-    (PS_Unicodes_CharNextFunc) ps_unicodes_char_next,   \/* unicodes_char_next    *\/\n+    ps_unicode_value,         \/* PS_Unicode_ValueFunc      unicode_value         *\/\n+    ps_unicodes_init,         \/* PS_Unicodes_InitFunc      unicodes_init         *\/\n+    ps_unicodes_char_index,   \/* PS_Unicodes_CharIndexFunc unicodes_char_index   *\/\n+    ps_unicodes_char_next,    \/* PS_Unicodes_CharNextFunc  unicodes_char_next    *\/\n@@ -551,2 +551,2 @@\n-    (PS_Macintosh_NameFunc)    ps_get_macintosh_name,   \/* macintosh_name        *\/\n-    (PS_Adobe_Std_StringsFunc) ps_get_standard_strings, \/* adobe_std_strings     *\/\n+    ps_get_macintosh_name,    \/* PS_Macintosh_NameFunc     macintosh_name        *\/\n+    ps_get_standard_strings,  \/* PS_Adobe_Std_StringsFunc  adobe_std_strings     *\/\n@@ -563,4 +563,4 @@\n-    NULL,                                               \/* unicode_value         *\/\n-    NULL,                                               \/* unicodes_init         *\/\n-    NULL,                                               \/* unicodes_char_index   *\/\n-    NULL,                                               \/* unicodes_char_next    *\/\n+    NULL,                     \/* PS_Unicode_ValueFunc      unicode_value         *\/\n+    NULL,                     \/* PS_Unicodes_InitFunc      unicodes_init         *\/\n+    NULL,                     \/* PS_Unicodes_CharIndexFunc unicodes_char_index   *\/\n+    NULL,                     \/* PS_Unicodes_CharNextFunc  unicodes_char_next    *\/\n@@ -568,2 +568,2 @@\n-    (PS_Macintosh_NameFunc)    ps_get_macintosh_name,   \/* macintosh_name        *\/\n-    (PS_Adobe_Std_StringsFunc) ps_get_standard_strings, \/* adobe_std_strings     *\/\n+    ps_get_macintosh_name,    \/* PS_Macintosh_NameFunc     macintosh_name        *\/\n+    ps_get_standard_strings,  \/* PS_Adobe_Std_StringsFunc  adobe_std_strings     *\/\n@@ -615,3 +615,3 @@\n-    (FT_Module_Constructor)NULL,                                       \/* module_init   *\/\n-    (FT_Module_Destructor) NULL,                                       \/* module_done   *\/\n-    (FT_Module_Requester)  PUT_PS_NAMES_SERVICE( psnames_get_service ) \/* get_interface *\/\n+    NULL,                                        \/* FT_Module_Constructor module_init   *\/\n+    NULL,                                        \/* FT_Module_Destructor  module_done   *\/\n+    PUT_PS_NAMES_SERVICE( psnames_get_service )  \/* FT_Module_Requester   get_interface *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/psnames\/psmodule.c","additions":21,"deletions":21,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -1745,3 +1745,3 @@\n-  Decompose_Curve( RAS_ARGS UShort  first,\n-                            UShort  last,\n-                            Int     flipped )\n+  Decompose_Curve( RAS_ARGS Int  first,\n+                            Int  last,\n+                            Int  flipped )\n@@ -1972,2 +1972,2 @@\n-    Int   i;\n-    UInt  start;\n+    Int  i;\n+    Int  first, last;\n@@ -1988,2 +1988,1 @@\n-    start = 0;\n-\n+    last = -1;\n@@ -1999,4 +1998,2 @@\n-      if ( Decompose_Curve( RAS_VARS (UShort)start,\n-                                     (UShort)ras.outline.contours[i],\n-                                     flipped ) )\n-        return FAILURE;\n+      first = last + 1;\n+      last  = ras.outline.contours[i];\n@@ -2004,1 +2001,2 @@\n-      start = (UShort)ras.outline.contours[i] + 1;\n+      if ( Decompose_Curve( RAS_VARS first, last, flipped ) )\n+        return FAILURE;\n@@ -3170,2 +3168,2 @@\n-  ft_black_new( FT_Memory       memory,\n-                black_PRaster  *araster )\n+  ft_black_new( void*       memory_,    \/* FT_Memory     *\/\n+                FT_Raster  *araster_ )  \/* black_PRaster *\/\n@@ -3173,0 +3171,3 @@\n+    FT_Memory       memory = (FT_Memory)memory_;\n+    black_PRaster  *araster = (black_PRaster*)araster_;\n+\n@@ -3187,1 +3188,1 @@\n-  ft_black_done( black_PRaster  raster )\n+  ft_black_done( FT_Raster  raster_ )   \/* black_PRaster *\/\n@@ -3189,1 +3190,2 @@\n-    FT_Memory  memory = (FT_Memory)raster->memory;\n+    black_PRaster  raster = (black_PRaster)raster_;\n+    FT_Memory      memory = (FT_Memory)raster->memory;\n@@ -3284,5 +3286,5 @@\n-    (FT_Raster_New_Func)     ft_black_new,       \/* raster_new      *\/\n-    (FT_Raster_Reset_Func)   ft_black_reset,     \/* raster_reset    *\/\n-    (FT_Raster_Set_Mode_Func)ft_black_set_mode,  \/* raster_set_mode *\/\n-    (FT_Raster_Render_Func)  ft_black_render,    \/* raster_render   *\/\n-    (FT_Raster_Done_Func)    ft_black_done       \/* raster_done     *\/\n+    ft_black_new,       \/* FT_Raster_New_Func      raster_new      *\/\n+    ft_black_reset,     \/* FT_Raster_Reset_Func    raster_reset    *\/\n+    ft_black_set_mode,  \/* FT_Raster_Set_Mode_Func raster_set_mode *\/\n+    ft_black_render,    \/* FT_Raster_Render_Func   raster_render   *\/\n+    ft_black_done       \/* FT_Raster_Done_Func     raster_done     *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/raster\/ftraster.c","additions":23,"deletions":21,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-  ft_raster1_init( FT_Renderer  render )\n+  ft_raster1_init( FT_Module  module )   \/* FT_Renderer *\/\n@@ -32,0 +32,3 @@\n+    FT_Renderer  render = (FT_Renderer)module;\n+\n+\n@@ -191,3 +194,3 @@\n-      (FT_Module_Constructor)ft_raster1_init,  \/* module_init   *\/\n-      (FT_Module_Destructor) NULL,             \/* module_done   *\/\n-      (FT_Module_Requester)  NULL,             \/* get_interface *\/\n+      ft_raster1_init,  \/* FT_Module_Constructor module_init   *\/\n+      NULL,             \/* FT_Module_Destructor  module_done   *\/\n+      NULL,             \/* FT_Module_Requester   get_interface *\/\n@@ -197,4 +200,4 @@\n-    (FT_Renderer_RenderFunc)   ft_raster1_render,     \/* render_glyph    *\/\n-    (FT_Renderer_TransformFunc)ft_raster1_transform,  \/* transform_glyph *\/\n-    (FT_Renderer_GetCBoxFunc)  ft_raster1_get_cbox,   \/* get_glyph_cbox  *\/\n-    (FT_Renderer_SetModeFunc)  ft_raster1_set_mode,   \/* set_mode        *\/\n+    ft_raster1_render,     \/* FT_Renderer_RenderFunc    render_glyph    *\/\n+    ft_raster1_transform,  \/* FT_Renderer_TransformFunc transform_glyph *\/\n+    ft_raster1_get_cbox,   \/* FT_Renderer_GetCBoxFunc   get_glyph_cbox  *\/\n+    ft_raster1_set_mode,   \/* FT_Renderer_SetModeFunc   set_mode        *\/\n@@ -202,1 +205,1 @@\n-    (FT_Raster_Funcs*)&ft_standard_raster             \/* raster_class    *\/\n+    &ft_standard_raster    \/* FT_Raster_Funcs*          raster_class    *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/raster\/ftrend1.c","additions":12,"deletions":9,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -409,4 +409,1 @@\n-    default:\n-      \/* Shouldn't happen, but ... *\/\n-      FALL_THROUGH;\n-\n+    default:  \/* Shouldn't happen, but ... *\/\n@@ -460,1 +457,1 @@\n-  typedef int  _pngshim_dummy;\n+  typedef int  pngshim_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/pngshim.c","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -82,2 +82,16 @@\n-  static void*\n-  get_sfnt_table( TT_Face      face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  sfnt_load_table( FT_Face    face,    \/* TT_Face *\/\n+                   FT_ULong   tag,\n+                   FT_Long    offset,\n+                   FT_Byte*   buffer,\n+                   FT_ULong*  length )\n+  {\n+    TT_Face  ttface = (TT_Face)face;\n+\n+\n+    return tt_face_load_any( ttface, tag, offset, buffer, length );\n+  }\n+\n+\n+  FT_CALLBACK_DEF( void* )\n+  get_sfnt_table( FT_Face      face,  \/* TT_Face *\/\n@@ -86,0 +100,2 @@\n+    TT_Face  ttface = (TT_Face)face;\n+\n@@ -92,1 +108,1 @@\n-      table = &face->header;\n+      table = &ttface->header;\n@@ -96,1 +112,1 @@\n-      table = &face->horizontal;\n+      table = &ttface->horizontal;\n@@ -100,1 +116,1 @@\n-      table = face->vertical_info ? &face->vertical : NULL;\n+      table = ttface->vertical_info ? &ttface->vertical : NULL;\n@@ -104,1 +120,1 @@\n-      table = ( face->os2.version == 0xFFFFU ) ? NULL : &face->os2;\n+      table = ( ttface->os2.version == 0xFFFFU ) ? NULL : &ttface->os2;\n@@ -108,1 +124,1 @@\n-      table = &face->postscript;\n+      table = &ttface->postscript;\n@@ -112,1 +128,1 @@\n-      table = &face->max_profile;\n+      table = &ttface->max_profile;\n@@ -116,1 +132,1 @@\n-      table = face->pclt.Version ? &face->pclt : NULL;\n+      table = ttface->pclt.Version ? &ttface->pclt : NULL;\n@@ -127,2 +143,2 @@\n-  static FT_Error\n-  sfnt_table_info( TT_Face    face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  sfnt_table_info( FT_Face    face,    \/* TT_Face *\/\n@@ -134,0 +150,3 @@\n+    TT_Face  ttface = (TT_Face)face;\n+\n+\n@@ -138,1 +157,1 @@\n-      *length = face->num_tables;\n+      *length = ttface->num_tables;\n@@ -141,1 +160,1 @@\n-      if ( idx >= face->num_tables )\n+      if ( idx >= ttface->num_tables )\n@@ -144,3 +163,3 @@\n-      *tag    = face->dir_tables[idx].Tag;\n-      *offset = face->dir_tables[idx].Offset;\n-      *length = face->dir_tables[idx].Length;\n+      *tag    = ttface->dir_tables[idx].Tag;\n+      *offset = ttface->dir_tables[idx].Offset;\n+      *length = ttface->dir_tables[idx].Length;\n@@ -156,3 +175,3 @@\n-    (FT_SFNT_TableLoadFunc)tt_face_load_any,     \/* load_table *\/\n-    (FT_SFNT_TableGetFunc) get_sfnt_table,       \/* get_table  *\/\n-    (FT_SFNT_TableInfoFunc)sfnt_table_info       \/* table_info *\/\n+    sfnt_load_table,  \/* FT_SFNT_TableLoadFunc load_table *\/\n+    get_sfnt_table,   \/* FT_SFNT_TableGetFunc  get_table  *\/\n+    sfnt_table_info   \/* FT_SFNT_TableInfoFunc table_info *\/\n@@ -169,1 +188,1 @@\n-  static FT_Error\n+  FT_CALLBACK_DEF( FT_Error )\n@@ -187,1 +206,1 @@\n-  static FT_UInt\n+  FT_CALLBACK_DEF( FT_UInt )\n@@ -224,2 +243,2 @@\n-    (FT_GlyphDict_GetNameFunc)  sfnt_get_glyph_name,    \/* get_name   *\/\n-    (FT_GlyphDict_NameIndexFunc)sfnt_get_name_index     \/* name_index *\/\n+    sfnt_get_glyph_name,  \/* FT_GlyphDict_GetNameFunc   get_name   *\/\n+    sfnt_get_name_index   \/* FT_GlyphDict_NameIndexFunc name_index *\/\n@@ -526,1 +545,1 @@\n-        break;\n+        continue;\n@@ -529,2 +548,1 @@\n-    if ( !len )\n-      *r = '\\0';\n+    *r = '\\0';\n@@ -534,1 +552,1 @@\n-    if ( !len )\n+    if ( r != result )\n@@ -583,1 +601,1 @@\n-        break;\n+        continue;\n@@ -586,2 +604,1 @@\n-    if ( !len )\n-      *r = '\\0';\n+    *r = '\\0';\n@@ -591,1 +608,1 @@\n-    if ( !len )\n+    if ( r != result )\n@@ -605,1 +622,1 @@\n-  static FT_Bool\n+  FT_CALLBACK_DEF( FT_Bool )\n@@ -822,3 +839,3 @@\n-        \/* as a last resort we try the family name; note that this is *\/\n-        \/* not in the Adobe TechNote, but GX fonts (which predate the *\/\n-        \/* TechNote) benefit from this behaviour                      *\/\n+        \/* according to the 'name' documentation in the OpenType   *\/\n+        \/* specification the font family name is to be used if the *\/\n+        \/* typographic family name is missing, so let's do that    *\/\n@@ -856,0 +873,4 @@\n+        \/* XXX It probably makes sense to never let this fail *\/\n+        \/*     since an arbitrary prefix should work, too.    *\/\n+        \/*     On the other hand, it is very unlikely that    *\/\n+        \/*     we ever reach this code at all.                *\/\n@@ -1044,2 +1065,2 @@\n-  static const char*\n-  sfnt_get_ps_name( TT_Face  face )\n+  FT_CALLBACK_DEF( const char* )\n+  sfnt_get_ps_name( FT_Face  face )    \/* TT_Face *\/\n@@ -1047,0 +1068,2 @@\n+    TT_Face  ttface = (TT_Face)face;\n+\n@@ -1051,2 +1074,2 @@\n-    if ( face->postscript_name )\n-      return face->postscript_name;\n+    if ( ttface->postscript_name )\n+      return ttface->postscript_name;\n@@ -1055,3 +1078,3 @@\n-    if ( face->blend                                 &&\n-         ( FT_IS_NAMED_INSTANCE( FT_FACE( face ) ) ||\n-           FT_IS_VARIATION( FT_FACE( face ) )      ) )\n+    if ( ttface->blend                    &&\n+         ( FT_IS_NAMED_INSTANCE( face ) ||\n+           FT_IS_VARIATION( face )      ) )\n@@ -1059,2 +1082,2 @@\n-      face->postscript_name = sfnt_get_var_ps_name( face );\n-      return face->postscript_name;\n+      ttface->postscript_name = sfnt_get_var_ps_name( ttface );\n+      return ttface->postscript_name;\n@@ -1066,1 +1089,1 @@\n-    found = sfnt_get_name_id( face, TT_NAME_ID_PS_NAME, &win, &apple );\n+    found = sfnt_get_name_id( ttface, TT_NAME_ID_PS_NAME, &win, &apple );\n@@ -1072,3 +1095,3 @@\n-      result = get_win_string( face->root.memory,\n-                               face->name_table.stream,\n-                               face->name_table.names + win,\n+      result = get_win_string( FT_FACE_MEMORY( face ),\n+                               ttface->name_table.stream,\n+                               ttface->name_table.names + win,\n@@ -1078,3 +1101,3 @@\n-      result = get_apple_string( face->root.memory,\n-                                 face->name_table.stream,\n-                                 face->name_table.names + apple,\n+      result = get_apple_string( FT_FACE_MEMORY( face ),\n+                                 ttface->name_table.stream,\n+                                 ttface->name_table.names + apple,\n@@ -1084,1 +1107,1 @@\n-    face->postscript_name = result;\n+    ttface->postscript_name = result;\n@@ -1093,1 +1116,1 @@\n-    (FT_PsName_GetFunc)sfnt_get_ps_name       \/* get_ps_font_name *\/\n+    sfnt_get_ps_name  \/* FT_PsName_GetFunc get_ps_font_name *\/\n@@ -1103,1 +1126,1 @@\n-    (TT_CMap_Info_GetFunc)tt_get_cmap_info    \/* get_cmap_info *\/\n+    tt_get_cmap_info  \/* TT_CMap_Info_GetFunc get_cmap_info *\/\n@@ -1110,1 +1133,1 @@\n-  sfnt_get_charset_id( TT_Face       face,\n+  sfnt_get_charset_id( FT_Face       face,\n@@ -1148,2 +1171,2 @@\n-    (FT_BDF_GetCharsetIdFunc)sfnt_get_charset_id,     \/* get_charset_id *\/\n-    (FT_BDF_GetPropertyFunc) tt_face_find_bdf_prop    \/* get_property   *\/\n+    sfnt_get_charset_id,   \/* FT_BDF_GetCharsetIdFunc get_charset_id *\/\n+    tt_face_find_bdf_prop  \/* FT_BDF_GetPropertyFunc  get_property   *\/\n@@ -1340,3 +1363,3 @@\n-    (FT_Module_Constructor)NULL,               \/* module_init   *\/\n-    (FT_Module_Destructor) NULL,               \/* module_done   *\/\n-    (FT_Module_Requester)  sfnt_get_interface  \/* get_interface *\/\n+    NULL,               \/* FT_Module_Constructor module_init   *\/\n+    NULL,               \/* FT_Module_Destructor  module_done   *\/\n+    sfnt_get_interface  \/* FT_Module_Requester   get_interface *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/sfdriver.c","additions":83,"deletions":60,"binary":false,"changes":143,"status":"modified"},{"patch":"@@ -537,1 +537,1 @@\n-    if ( !face->var )\n+    if ( !face->tt_var )\n@@ -544,3 +544,3 @@\n-      face->var = ft_module_get_service( tt_module,\n-                                         FT_SERVICE_ID_METRICS_VARIATIONS,\n-                                         0 );\n+      face->tt_var = ft_module_get_service( tt_module,\n+                                            FT_SERVICE_ID_METRICS_VARIATIONS,\n+                                            0 );\n@@ -548,0 +548,6 @@\n+\n+    if ( !face->face_var )\n+      face->face_var = ft_module_get_service(\n+                         &face->root.driver->root,\n+                         FT_SERVICE_ID_METRICS_VARIATIONS,\n+                         0 );\n@@ -695,0 +701,3 @@\n+        \/* named instance indices start with value 1 *\/\n+        face->var_default_named_instance = i + 1;\n+\n@@ -1057,0 +1066,10 @@\n+#ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT\n+    {\n+      FT_Memory  memory = face->root.memory;\n+\n+\n+      if ( FT_STRDUP( face->non_var_style_name, face->root.style_name ) )\n+        goto Exit;\n+    }\n+#endif\n+\n@@ -1224,1 +1243,1 @@\n-          FT_Memory        memory   = face->root.stream->memory;\n+          FT_Memory        memory   = face->root.memory;\n@@ -1503,0 +1522,1 @@\n+    FT_FREE( face->non_var_style_name );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/sfobjs.c","additions":25,"deletions":5,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -429,1 +429,1 @@\n-  typedef int  _sfwoff_dummy;\n+  typedef int  sfwoff_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/sfwoff.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -39,0 +39,2 @@\n+  \/* An arbitrary, heuristic size limit (67MByte) for expanded WOFF2 data. *\/\n+#define MAX_SFNT_SIZE  ( 1 << 26 )\n@@ -2183,3 +2185,2 @@\n-      \/* Value 1<<26 = 67108864 is heuristic. *\/\n-      if (sfnt_size >= (1 << 26))\n-        sfnt_size = 1 << 26;\n+      if ( sfnt_size >= MAX_SFNT_SIZE )\n+        sfnt_size = MAX_SFNT_SIZE;\n@@ -2260,1 +2261,6 @@\n-    if ( woff2.uncompressed_size > sfnt_size )\n+    \/* We must not blindly trust `uncompressed_size` since its   *\/\n+    \/* value might be corrupted.  If it is too large, reject the *\/\n+    \/* font.  In other words, we don't accept a WOFF2 font that  *\/\n+    \/* expands to something larger than MAX_SFNT_SIZE.  If ever  *\/\n+    \/* necessary, this limit can be easily adjusted.             *\/\n+    if ( woff2.uncompressed_size > MAX_SFNT_SIZE )\n@@ -2262,2 +2268,2 @@\n-      FT_ERROR(( \"woff2_open_font: SFNT table lengths are too large.\\n\" ));\n-      error = FT_THROW( Invalid_Table );\n+      FT_ERROR(( \"Uncompressed font too large.\\n\" ));\n+      error = FT_THROW( Array_Too_Large );\n@@ -2381,1 +2387,1 @@\n-  typedef int  _sfwoff2_dummy;\n+  typedef int  sfwoff2_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/sfwoff2.c","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -62,2 +62,2 @@\n-  tt_cmap_init( TT_CMap   cmap,\n-                FT_Byte*  table )\n+  tt_cmap_init( FT_CMap  cmap,    \/* TT_CMap *\/\n+                void*    table_ )\n@@ -65,1 +65,5 @@\n-    cmap->data = table;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  table  = (FT_Byte*)table_;\n+\n+\n+    ttcmap->data = table;\n@@ -131,1 +135,1 @@\n-  tt_cmap0_char_index( TT_CMap    cmap,\n+  tt_cmap0_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -134,1 +138,2 @@\n-    FT_Byte*  table = cmap->data;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  table  = ttcmap->data;\n@@ -141,2 +146,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap0_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap0_char_next( FT_CMap     cmap,        \/* TT_CMap *\/\n@@ -145,1 +150,2 @@\n-    FT_Byte*   table    = cmap->data;\n+    TT_CMap    ttcmap   = (TT_CMap)cmap;\n+    FT_Byte*   table    = ttcmap->data;\n@@ -168,1 +174,1 @@\n-  tt_cmap0_get_info( TT_CMap       cmap,\n+  tt_cmap0_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -171,1 +177,2 @@\n-    FT_Byte*  p = cmap->data + 4;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 4;\n@@ -456,1 +463,1 @@\n-  tt_cmap2_char_index( TT_CMap    cmap,\n+  tt_cmap2_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -459,1 +466,2 @@\n-    FT_Byte*  table   = cmap->data;\n+    TT_CMap   ttcmap  = (TT_CMap)cmap;\n+    FT_Byte*  table   = ttcmap->data;\n@@ -494,2 +502,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap2_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap2_char_next( FT_CMap     cmap,       \/* TT_CMap *\/\n@@ -498,1 +506,2 @@\n-    FT_Byte*   table    = cmap->data;\n+    TT_CMap    ttcmap   = (TT_CMap)cmap;\n+    FT_Byte*   table    = ttcmap->data;\n@@ -582,1 +591,1 @@\n-  tt_cmap2_get_info( TT_CMap       cmap,\n+  tt_cmap2_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -585,1 +594,2 @@\n-    FT_Byte*  p = cmap->data + 4;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 4;\n@@ -709,2 +719,2 @@\n-  tt_cmap4_init( TT_CMap4  cmap,\n-                 FT_Byte*  table )\n+  tt_cmap4_init( FT_CMap  cmap,    \/* TT_CMap4 *\/\n+                 void*    table_ )\n@@ -712,0 +722,2 @@\n+    TT_CMap4  ttcmap = (TT_CMap4)cmap;\n+    FT_Byte*  table  = (FT_Byte*)table_;\n@@ -715,1 +727,1 @@\n-    cmap->cmap.data    = table;\n+    ttcmap->cmap.data = table;\n@@ -717,4 +729,4 @@\n-    p                  = table + 6;\n-    cmap->num_ranges   = FT_PEEK_USHORT( p ) >> 1;\n-    cmap->cur_charcode = (FT_UInt32)0xFFFFFFFFUL;\n-    cmap->cur_gindex   = 0;\n+    p                    = table + 6;\n+    ttcmap->num_ranges   = FT_PEEK_USHORT( p ) >> 1;\n+    ttcmap->cur_charcode = (FT_UInt32)0xFFFFFFFFUL;\n+    ttcmap->cur_gindex   = 0;\n@@ -758,1 +770,1 @@\n-        TT_Face   face  = (TT_Face)cmap->cmap.cmap.charmap.face;\n+        TT_Face   face  = (TT_Face)FT_CMAP_FACE( cmap );\n@@ -791,1 +803,1 @@\n-    TT_Face   face  = (TT_Face)cmap->cmap.cmap.charmap.face;\n+    TT_Face   face  = (TT_Face)FT_CMAP_FACE( cmap );\n@@ -797,3 +809,0 @@\n-    if ( cmap->cur_charcode >= 0xFFFFUL )\n-      goto Fail;\n-\n@@ -885,1 +894,0 @@\n-  Fail:\n@@ -1100,1 +1108,1 @@\n-    TT_Face   face  = (TT_Face)cmap->cmap.charmap.face;\n+    TT_Face   face  = (TT_Face)FT_CMAP_FACE( cmap );\n@@ -1107,1 +1115,1 @@\n-    FT_UInt32  charcode = *pcharcode;\n+    FT_UInt32  charcode = *pcharcode + next;\n@@ -1114,3 +1122,1 @@\n-    num_segs2 = FT_PAD_FLOOR( TT_PEEK_USHORT( p ), 2 );\n-\n-    num_segs = num_segs2 >> 1;\n+    num_segs = TT_PEEK_USHORT( p ) >> 1;\n@@ -1121,5 +1127,1 @@\n-    if ( next )\n-      charcode++;\n-\n-    if ( charcode > 0xFFFFU )\n-      return 0;\n+    num_segs2 = num_segs << 1;\n@@ -1235,1 +1237,1 @@\n-    TT_Face   face  = (TT_Face)cmap->cmap.charmap.face;\n+    TT_Face   face  = (TT_Face)FT_CMAP_FACE( cmap );\n@@ -1241,1 +1243,1 @@\n-    FT_UInt   charcode = (FT_UInt)*pcharcode;\n+    FT_UInt   charcode = (FT_UInt)*pcharcode + next;\n@@ -1247,1 +1249,1 @@\n-    num_segs2 = FT_PAD_FLOOR( TT_PEEK_USHORT( p ), 2 );\n+    num_segs = TT_PEEK_USHORT( p ) >> 1;\n@@ -1249,1 +1251,1 @@\n-    if ( !num_segs2 )\n+    if ( !num_segs )\n@@ -1252,8 +1254,1 @@\n-    num_segs = num_segs2 >> 1;\n-\n-    \/* make compiler happy *\/\n-    mid = num_segs;\n-    end = 0xFFFFU;\n-\n-    if ( next )\n-      charcode++;\n+    num_segs2 = num_segs << 1;\n@@ -1265,1 +1260,1 @@\n-    while ( min < max )\n+    do\n@@ -1448,0 +1443,1 @@\n+    while ( min < max );\n@@ -1457,6 +1453,2 @@\n-      if ( charcode > end )\n-      {\n-        mid++;\n-        if ( mid == num_segs )\n-          return 0;\n-      }\n+      if ( charcode > end && ++mid == num_segs )\n+        return 0;\n@@ -1477,1 +1469,0 @@\n-          cmap4->cur_charcode = charcode;\n@@ -1492,1 +1483,1 @@\n-  tt_cmap4_char_index( TT_CMap    cmap,\n+  tt_cmap4_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -1495,0 +1486,3 @@\n+    TT_CMap  ttcmap = (TT_CMap)cmap;\n+\n+\n@@ -1498,2 +1492,2 @@\n-    if ( cmap->flags & TT_CMAP_FLAG_UNSORTED )\n-      return tt_cmap4_char_map_linear( cmap, &char_code, 0 );\n+    if ( ttcmap->flags & TT_CMAP_FLAG_UNSORTED )\n+      return tt_cmap4_char_map_linear( ttcmap, &char_code, 0 );\n@@ -1501,1 +1495,1 @@\n-      return tt_cmap4_char_map_binary( cmap, &char_code, 0 );\n+      return tt_cmap4_char_map_binary( ttcmap, &char_code, 0 );\n@@ -1505,2 +1499,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap4_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap4_char_next( FT_CMap     cmap,        \/* TT_CMap *\/\n@@ -1509,0 +1503,1 @@\n+    TT_CMap  ttcmap = (TT_CMap)cmap;\n@@ -1515,2 +1510,2 @@\n-    if ( cmap->flags & TT_CMAP_FLAG_UNSORTED )\n-      gindex = tt_cmap4_char_map_linear( cmap, pchar_code, 1 );\n+    if ( ttcmap->flags & TT_CMAP_FLAG_UNSORTED )\n+      gindex = tt_cmap4_char_map_linear( ttcmap, pchar_code, 1 );\n@@ -1531,1 +1526,1 @@\n-        gindex = tt_cmap4_char_map_binary( cmap, pchar_code, 1 );\n+        gindex = tt_cmap4_char_map_binary( ttcmap, pchar_code, 1 );\n@@ -1539,1 +1534,1 @@\n-  tt_cmap4_get_info( TT_CMap       cmap,\n+  tt_cmap4_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -1542,1 +1537,2 @@\n-    FT_Byte*  p = cmap->data + 4;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 4;\n@@ -1643,1 +1639,1 @@\n-  tt_cmap6_char_index( TT_CMap    cmap,\n+  tt_cmap6_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -1646,1 +1642,2 @@\n-    FT_Byte*  table  = cmap->data;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  table  = ttcmap->data;\n@@ -1664,2 +1661,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap6_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap6_char_next( FT_CMap     cmap,        \/* TT_CMap *\/\n@@ -1668,1 +1665,2 @@\n-    FT_Byte*   table     = cmap->data;\n+    TT_CMap    ttcmap    = (TT_CMap)cmap;\n+    FT_Byte*   table     = ttcmap->data;\n@@ -1709,1 +1707,1 @@\n-  tt_cmap6_get_info( TT_CMap       cmap,\n+  tt_cmap6_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -1712,1 +1710,2 @@\n-    FT_Byte*  p = cmap->data + 4;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 4;\n@@ -1903,1 +1902,1 @@\n-  tt_cmap8_char_index( TT_CMap    cmap,\n+  tt_cmap8_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -1906,1 +1905,2 @@\n-    FT_Byte*   table      = cmap->data;\n+    TT_CMap    ttcmap     = (TT_CMap)cmap;\n+    FT_Byte*   table      = ttcmap->data;\n@@ -1935,2 +1935,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap8_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap8_char_next( FT_CMap     cmap,        \/* TT_CMap *\/\n@@ -1939,1 +1939,2 @@\n-    FT_Face    face       = cmap->cmap.charmap.face;\n+    TT_CMap    ttcmap     = (TT_CMap)cmap;\n+    FT_Face    face       = FT_CMAP_FACE( cmap );\n@@ -1943,1 +1944,1 @@\n-    FT_Byte*   table      = cmap->data;\n+    FT_Byte*   table      = ttcmap->data;\n@@ -2003,1 +2004,1 @@\n-  tt_cmap8_get_info( TT_CMap       cmap,\n+  tt_cmap8_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -2006,1 +2007,2 @@\n-    FT_Byte*  p = cmap->data + 8;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 8;\n@@ -2107,1 +2109,1 @@\n-  tt_cmap10_char_index( TT_CMap    cmap,\n+  tt_cmap10_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -2110,1 +2112,2 @@\n-    FT_Byte*   table  = cmap->data;\n+    TT_CMap    ttcmap = (TT_CMap)cmap;\n+    FT_Byte*   table  = ttcmap->data;\n@@ -2133,2 +2136,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap10_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap10_char_next( FT_CMap     cmap,        \/* TT_CMap *\/\n@@ -2137,1 +2140,2 @@\n-    FT_Byte*   table     = cmap->data;\n+    TT_CMap    ttcmap    = (TT_CMap)cmap;\n+    FT_Byte*   table     = ttcmap->data;\n@@ -2175,1 +2179,1 @@\n-  tt_cmap10_get_info( TT_CMap       cmap,\n+  tt_cmap10_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -2178,1 +2182,2 @@\n-    FT_Byte*  p = cmap->data + 8;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 8;\n@@ -2256,2 +2261,2 @@\n-  tt_cmap12_init( TT_CMap12  cmap,\n-                  FT_Byte*   table )\n+  tt_cmap12_init( FT_CMap  cmap,    \/* TT_CMap12 *\/\n+                  void*    table_ )\n@@ -2259,1 +2264,3 @@\n-    cmap->cmap.data  = table;\n+    TT_CMap12  ttcmap = (TT_CMap12)cmap;\n+    FT_Byte*   table  = (FT_Byte*)table_;\n+\n@@ -2261,2 +2268,1 @@\n-    table           += 12;\n-    cmap->num_groups = FT_PEEK_ULONG( table );\n+    ttcmap->cmap.data  = table;\n@@ -2264,1 +2270,4 @@\n-    cmap->valid      = 0;\n+    table             += 12;\n+    ttcmap->num_groups = FT_PEEK_ULONG( table );\n+\n+    ttcmap->valid      = 0;\n@@ -2334,1 +2343,1 @@\n-  tt_cmap12_next( TT_CMap12  cmap )\n+  tt_cmap12_next( FT_CMap  cmap )    \/* TT_CMap12 *\/\n@@ -2336,6 +2345,6 @@\n-    FT_Face   face = cmap->cmap.cmap.charmap.face;\n-    FT_Byte*  p;\n-    FT_ULong  start, end, start_id, char_code;\n-    FT_ULong  n;\n-    FT_UInt   gindex;\n-\n+    TT_CMap12  ttcmap = (TT_CMap12)cmap;\n+    FT_Face    face   = FT_CMAP_FACE( cmap );\n+    FT_Byte*   p;\n+    FT_ULong   start, end, start_id, char_code;\n+    FT_ULong   n;\n+    FT_UInt    gindex;\n@@ -2343,2 +2352,0 @@\n-    if ( cmap->cur_charcode >= 0xFFFFFFFFUL )\n-      goto Fail;\n@@ -2346,1 +2353,1 @@\n-    char_code = cmap->cur_charcode + 1;\n+    char_code = ttcmap->cur_charcode + 1;\n@@ -2348,1 +2355,1 @@\n-    for ( n = cmap->cur_group; n < cmap->num_groups; n++ )\n+    for ( n = ttcmap->cur_group; n < ttcmap->num_groups; n++ )\n@@ -2350,1 +2357,1 @@\n-      p        = cmap->cmap.data + 16 + 12 * n;\n+      p        = ttcmap->cmap.data + 16 + 12 * n;\n@@ -2382,3 +2389,3 @@\n-        cmap->cur_charcode = char_code;\n-        cmap->cur_gindex   = gindex;\n-        cmap->cur_group    = n;\n+        ttcmap->cur_charcode = char_code;\n+        ttcmap->cur_gindex   = gindex;\n+        ttcmap->cur_group    = n;\n@@ -2391,1 +2398,1 @@\n-    cmap->valid = 0;\n+    ttcmap->valid = 0;\n@@ -2403,1 +2410,1 @@\n-    FT_UInt32  char_code  = *pchar_code;\n+    FT_UInt32  char_code  = *pchar_code + next;\n@@ -2411,12 +2418,0 @@\n-    \/* make compiler happy *\/\n-    mid = num_groups;\n-    end = 0xFFFFFFFFUL;\n-\n-    if ( next )\n-    {\n-      if ( char_code >= 0xFFFFFFFFUL )\n-        return 0;\n-\n-      char_code++;\n-    }\n-\n@@ -2427,1 +2422,1 @@\n-    while ( min < max )\n+    do\n@@ -2451,0 +2446,1 @@\n+    while ( min < max );\n@@ -2454,1 +2450,1 @@\n-      FT_Face    face   = cmap->cmap.charmap.face;\n+      FT_Face    face   = FT_CMAP_FACE( cmap );\n@@ -2461,6 +2457,2 @@\n-      if ( char_code > end )\n-      {\n-        mid++;\n-        if ( mid == num_groups )\n-          return 0;\n-      }\n+      if ( char_code > end && ++mid == num_groups )\n+        return 0;\n@@ -2477,1 +2469,1 @@\n-        tt_cmap12_next( cmap12 );\n+        tt_cmap12_next( FT_CMAP( cmap12 ) );\n@@ -2493,1 +2485,1 @@\n-  tt_cmap12_char_index( TT_CMap    cmap,\n+  tt_cmap12_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -2496,1 +2488,1 @@\n-    return tt_cmap12_char_map_binary( cmap, &char_code, 0 );\n+    return tt_cmap12_char_map_binary( (TT_CMap)cmap, &char_code, 0 );\n@@ -2500,2 +2492,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap12_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap12_char_next( FT_CMap     cmap,        \/* TT_CMap12 *\/\n@@ -2508,0 +2500,3 @@\n+    if ( *pchar_code >= 0xFFFFFFFFUL )\n+      return 0;\n+\n@@ -2511,1 +2506,1 @@\n-      tt_cmap12_next( cmap12 );\n+      tt_cmap12_next( FT_CMAP( cmap12 ) );\n@@ -2521,1 +2516,1 @@\n-      gindex = tt_cmap12_char_map_binary( cmap, pchar_code, 1 );\n+      gindex = tt_cmap12_char_map_binary( (TT_CMap)cmap, pchar_code, 1 );\n@@ -2528,1 +2523,1 @@\n-  tt_cmap12_get_info( TT_CMap       cmap,\n+  tt_cmap12_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -2531,1 +2526,2 @@\n-    FT_Byte*  p = cmap->data + 8;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 8;\n@@ -2609,2 +2605,2 @@\n-  tt_cmap13_init( TT_CMap13  cmap,\n-                  FT_Byte*   table )\n+  tt_cmap13_init( FT_CMap  cmap,    \/* TT_CMap13 *\/\n+                  void*    table_ )\n@@ -2612,1 +2608,5 @@\n-    cmap->cmap.data  = table;\n+    TT_CMap13  ttcmap = (TT_CMap13)cmap;\n+    FT_Byte*   table  = (FT_Byte*)table_;\n+\n+\n+    ttcmap->cmap.data  = table;\n@@ -2614,2 +2614,2 @@\n-    table           += 12;\n-    cmap->num_groups = FT_PEEK_ULONG( table );\n+    table             += 12;\n+    ttcmap->num_groups = FT_PEEK_ULONG( table );\n@@ -2617,1 +2617,1 @@\n-    cmap->valid      = 0;\n+    ttcmap->valid      = 0;\n@@ -2682,1 +2682,1 @@\n-  tt_cmap13_next( TT_CMap13  cmap )\n+  tt_cmap13_next( FT_CMap  cmap )    \/* TT_CMap13 *\/\n@@ -2684,6 +2684,6 @@\n-    FT_Face   face = cmap->cmap.cmap.charmap.face;\n-    FT_Byte*  p;\n-    FT_ULong  start, end, glyph_id, char_code;\n-    FT_ULong  n;\n-    FT_UInt   gindex;\n-\n+    TT_CMap13  ttcmap = (TT_CMap13)cmap;\n+    FT_Face    face = FT_CMAP_FACE( cmap );\n+    FT_Byte*   p;\n+    FT_ULong   start, end, glyph_id, char_code;\n+    FT_ULong   n;\n+    FT_UInt    gindex;\n@@ -2691,2 +2691,0 @@\n-    if ( cmap->cur_charcode >= 0xFFFFFFFFUL )\n-      goto Fail;\n@@ -2694,1 +2692,1 @@\n-    char_code = cmap->cur_charcode + 1;\n+    char_code = ttcmap->cur_charcode + 1;\n@@ -2696,1 +2694,1 @@\n-    for ( n = cmap->cur_group; n < cmap->num_groups; n++ )\n+    for ( n = ttcmap->cur_group; n < ttcmap->num_groups; n++ )\n@@ -2698,1 +2696,1 @@\n-      p        = cmap->cmap.data + 16 + 12 * n;\n+      p        = ttcmap->cmap.data + 16 + 12 * n;\n@@ -2712,3 +2710,3 @@\n-          cmap->cur_charcode = char_code;\n-          cmap->cur_gindex   = gindex;\n-          cmap->cur_group    = n;\n+          ttcmap->cur_charcode = char_code;\n+          ttcmap->cur_gindex   = gindex;\n+          ttcmap->cur_group    = n;\n@@ -2721,2 +2719,1 @@\n-  Fail:\n-    cmap->valid = 0;\n+    ttcmap->valid = 0;\n@@ -2734,1 +2731,1 @@\n-    FT_UInt32  char_code  = *pchar_code;\n+    FT_UInt32  char_code  = *pchar_code + next;\n@@ -2742,12 +2739,0 @@\n-    \/* make compiler happy *\/\n-    mid = num_groups;\n-    end = 0xFFFFFFFFUL;\n-\n-    if ( next )\n-    {\n-      if ( char_code >= 0xFFFFFFFFUL )\n-        return 0;\n-\n-      char_code++;\n-    }\n-\n@@ -2758,1 +2743,1 @@\n-    while ( min < max )\n+    do\n@@ -2777,0 +2762,1 @@\n+    while ( min < max );\n@@ -2787,6 +2773,2 @@\n-      if ( char_code > end )\n-      {\n-        mid++;\n-        if ( mid == num_groups )\n-          return 0;\n-      }\n+      if ( char_code > end && ++mid == num_groups )\n+        return 0;\n@@ -2803,1 +2785,1 @@\n-        tt_cmap13_next( cmap13 );\n+        tt_cmap13_next( FT_CMAP( cmap13 ) );\n@@ -2819,1 +2801,1 @@\n-  tt_cmap13_char_index( TT_CMap    cmap,\n+  tt_cmap13_char_index( FT_CMap    cmap,       \/* TT_CMap *\/\n@@ -2822,1 +2804,1 @@\n-    return tt_cmap13_char_map_binary( cmap, &char_code, 0 );\n+    return tt_cmap13_char_map_binary( (TT_CMap)cmap, &char_code, 0 );\n@@ -2826,2 +2808,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap13_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap13_char_next( FT_CMap     cmap,        \/* TT_CMap13 *\/\n@@ -2834,0 +2816,3 @@\n+    if ( *pchar_code >= 0xFFFFFFFFUL )\n+      return 0;\n+\n@@ -2837,1 +2822,1 @@\n-      tt_cmap13_next( cmap13 );\n+      tt_cmap13_next( FT_CMAP( cmap13 ) );\n@@ -2847,1 +2832,1 @@\n-      gindex = tt_cmap13_char_map_binary( cmap, pchar_code, 1 );\n+      gindex = tt_cmap13_char_map_binary( (TT_CMap)cmap, pchar_code, 1 );\n@@ -2854,1 +2839,1 @@\n-  tt_cmap13_get_info( TT_CMap       cmap,\n+  tt_cmap13_get_info( FT_CharMap    cmap,       \/* TT_CMap *\/\n@@ -2857,1 +2842,2 @@\n-    FT_Byte*  p = cmap->data + 8;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = ttcmap->data + 8;\n@@ -2972,1 +2958,1 @@\n-  tt_cmap14_done( TT_CMap14  cmap )\n+  tt_cmap14_done( FT_CMap  cmap )    \/* TT_CMap14 *\/\n@@ -2974,1 +2960,2 @@\n-    FT_Memory  memory = cmap->memory;\n+    TT_CMap14  ttcmap = (TT_CMap14)cmap;\n+    FT_Memory  memory = ttcmap->memory;\n@@ -2977,3 +2964,3 @@\n-    cmap->max_results = 0;\n-    if ( memory && cmap->results )\n-      FT_FREE( cmap->results );\n+    ttcmap->max_results = 0;\n+    if ( memory && ttcmap->results )\n+      FT_FREE( ttcmap->results );\n@@ -3007,2 +2994,2 @@\n-  tt_cmap14_init( TT_CMap14  cmap,\n-                  FT_Byte*   table )\n+  tt_cmap14_init( FT_CMap  cmap,    \/* TT_CMap14 *\/\n+                  void*    table_ )\n@@ -3010,1 +2997,3 @@\n-    cmap->cmap.data = table;\n+    TT_CMap14  ttcmap = (TT_CMap14)cmap;\n+    FT_Byte*   table  = (FT_Byte*)table_;\n+\n@@ -3012,4 +3001,6 @@\n-    table               += 6;\n-    cmap->num_selectors  = FT_PEEK_ULONG( table );\n-    cmap->max_results    = 0;\n-    cmap->results        = NULL;\n+    ttcmap->cmap.data = table;\n+\n+    table                 += 6;\n+    ttcmap->num_selectors  = FT_PEEK_ULONG( table );\n+    ttcmap->max_results    = 0;\n+    ttcmap->results        = NULL;\n@@ -3145,1 +3136,1 @@\n-  tt_cmap14_char_index( TT_CMap    cmap,\n+  tt_cmap14_char_index( FT_CMap    cmap,\n@@ -3156,2 +3147,2 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap14_char_next( TT_CMap     cmap,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap14_char_next( FT_CMap     cmap,\n@@ -3169,1 +3160,1 @@\n-  tt_cmap14_get_info( TT_CMap       cmap,\n+  tt_cmap14_get_info( FT_CharMap    cmap,\n@@ -3283,2 +3274,2 @@\n-  tt_cmap14_char_var_index( TT_CMap    cmap,\n-                            TT_CMap    ucmap,\n+  tt_cmap14_char_var_index( FT_CMap    cmap,             \/* TT_CMap *\/\n+                            FT_CMap    ucmap,            \/* TT_CMap *\/\n@@ -3288,1 +3279,5 @@\n-    FT_Byte*  p = tt_cmap14_find_variant( cmap->data + 6, variantSelector );\n+    TT_CMap  ttcmap  = (TT_CMap)cmap;\n+    TT_CMap  ttucmap = (TT_CMap)ucmap;\n+\n+    FT_Byte*  p = tt_cmap14_find_variant( ttcmap->data + 6,\n+                                          variantSelector );\n@@ -3299,2 +3294,2 @@\n-    if ( defOff != 0                                                    &&\n-         tt_cmap14_char_map_def_binary( cmap->data + defOff, charcode ) )\n+    if ( defOff != 0                                                      &&\n+         tt_cmap14_char_map_def_binary( ttcmap->data + defOff, charcode ) )\n@@ -3304,1 +3299,1 @@\n-      return ucmap->cmap.clazz->char_index( &ucmap->cmap, charcode );\n+      return ttucmap->cmap.clazz->char_index( &ttucmap->cmap, charcode );\n@@ -3308,1 +3303,1 @@\n-      return tt_cmap14_char_map_nondef_binary( cmap->data + nondefOff,\n+      return tt_cmap14_char_map_nondef_binary( ttcmap->data + nondefOff,\n@@ -3316,1 +3311,1 @@\n-  tt_cmap14_char_var_isdefault( TT_CMap    cmap,\n+  tt_cmap14_char_var_isdefault( FT_CMap    cmap,             \/* TT_CMap *\/\n@@ -3320,1 +3315,3 @@\n-    FT_Byte*  p = tt_cmap14_find_variant( cmap->data + 6, variantSelector );\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte*  p      = tt_cmap14_find_variant( ttcmap->data + 6,\n+                                               variantSelector );\n@@ -3331,2 +3328,2 @@\n-    if ( defOff != 0                                                    &&\n-         tt_cmap14_char_map_def_binary( cmap->data + defOff, charcode ) )\n+    if ( defOff != 0                                                      &&\n+         tt_cmap14_char_map_def_binary( ttcmap->data + defOff, charcode ) )\n@@ -3335,3 +3332,3 @@\n-    if ( nondefOff != 0                                            &&\n-         tt_cmap14_char_map_nondef_binary( cmap->data + nondefOff,\n-                                           charcode ) != 0         )\n+    if ( nondefOff != 0                                              &&\n+         tt_cmap14_char_map_nondef_binary( ttcmap->data + nondefOff,\n+                                           charcode ) != 0           )\n@@ -3345,1 +3342,1 @@\n-  tt_cmap14_variants( TT_CMap    cmap,\n+  tt_cmap14_variants( FT_CMap    cmap,    \/* TT_CMap14 *\/\n@@ -3348,0 +3345,1 @@\n+    TT_CMap     ttcmap = (TT_CMap)cmap;\n@@ -3350,1 +3348,1 @@\n-    FT_Byte*    p      = cmap->data + 10;\n+    FT_Byte*    p      = ttcmap->data + 10;\n@@ -3371,1 +3369,1 @@\n-  tt_cmap14_char_variants( TT_CMap    cmap,\n+  tt_cmap14_char_variants( FT_CMap    cmap,      \/* TT_CMap14 *\/\n@@ -3375,1 +3373,2 @@\n-    TT_CMap14   cmap14 = (TT_CMap14)  cmap;\n+    TT_CMap     ttcmap = (TT_CMap)cmap;\n+    TT_CMap14   cmap14 = (TT_CMap14)cmap;\n@@ -3377,1 +3376,1 @@\n-    FT_Byte*    p      = cmap->data + 10;\n+    FT_Byte*    p      = ttcmap->data + 10;\n@@ -3391,6 +3390,6 @@\n-      if ( ( defOff != 0                                               &&\n-             tt_cmap14_char_map_def_binary( cmap->data + defOff,\n-                                            charCode )                 ) ||\n-           ( nondefOff != 0                                            &&\n-             tt_cmap14_char_map_nondef_binary( cmap->data + nondefOff,\n-                                               charCode ) != 0         ) )\n+      if ( ( defOff != 0                                                 &&\n+             tt_cmap14_char_map_def_binary( ttcmap->data + defOff,\n+                                            charCode )                   ) ||\n+           ( nondefOff != 0                                              &&\n+             tt_cmap14_char_map_nondef_binary( ttcmap->data + nondefOff,\n+                                               charCode ) != 0           ) )\n@@ -3492,1 +3491,1 @@\n-  tt_cmap14_variant_chars( TT_CMap    cmap,\n+  tt_cmap14_variant_chars( FT_CMap    cmap,             \/* TT_CMap *\/\n@@ -3496,5 +3495,6 @@\n-    FT_Byte    *p  = tt_cmap14_find_variant( cmap->data + 6,\n-                                             variantSelector );\n-    FT_Int      i;\n-    FT_ULong    defOff;\n-    FT_ULong    nondefOff;\n+    TT_CMap   ttcmap = (TT_CMap)cmap;\n+    FT_Byte  *p      = tt_cmap14_find_variant( ttcmap->data + 6,\n+                                               variantSelector );\n+    FT_Int    i;\n+    FT_ULong  defOff;\n+    FT_ULong  nondefOff;\n@@ -3513,1 +3513,1 @@\n-      return tt_cmap14_get_nondef_chars( cmap, cmap->data + nondefOff,\n+      return tt_cmap14_get_nondef_chars( ttcmap, ttcmap->data + nondefOff,\n@@ -3516,1 +3516,1 @@\n-      return tt_cmap14_get_def_chars( cmap, cmap->data + defOff,\n+      return tt_cmap14_get_def_chars( ttcmap, ttcmap->data + defOff,\n@@ -3522,1 +3522,1 @@\n-      TT_CMap14  cmap14 = (TT_CMap14) cmap;\n+      TT_CMap14  cmap14 = (TT_CMap14)cmap;\n@@ -3534,2 +3534,2 @@\n-      p  = cmap->data + nondefOff;\n-      dp = cmap->data + defOff;\n+      p  = ttcmap->data + nondefOff;\n+      dp = ttcmap->data + defOff;\n@@ -3542,1 +3542,1 @@\n-        return tt_cmap14_get_def_chars( cmap, cmap->data + defOff,\n+        return tt_cmap14_get_def_chars( ttcmap, ttcmap->data + defOff,\n@@ -3545,1 +3545,1 @@\n-        return tt_cmap14_get_nondef_chars( cmap, cmap->data + nondefOff,\n+        return tt_cmap14_get_nondef_chars( ttcmap, ttcmap->data + nondefOff,\n@@ -3667,1 +3667,1 @@\n-  tt_get_glyph_name( TT_Face  face,\n+  tt_get_glyph_name( void*    face_,   \/* TT_Face *\/\n@@ -3670,0 +3670,1 @@\n+    TT_Face     face   = (TT_Face)face_;\n@@ -3680,2 +3681,2 @@\n-  tt_cmap_unicode_init( PS_Unicodes  unicodes,\n-                        FT_Pointer   pointer )\n+  tt_cmap_unicode_init( FT_CMap     cmap,     \/* PS_Unicodes *\/\n+                        FT_Pointer  pointer )\n@@ -3683,3 +3684,4 @@\n-    TT_Face             face    = (TT_Face)FT_CMAP_FACE( unicodes );\n-    FT_Memory           memory  = FT_FACE_MEMORY( face );\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)face->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    TT_Face             face     = (TT_Face)FT_CMAP_FACE( cmap );\n+    FT_Memory           memory   = FT_FACE_MEMORY( face );\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)face->psnames;\n@@ -3696,1 +3698,1 @@\n-                                   (PS_GetGlyphNameFunc)&tt_get_glyph_name,\n+                                   &tt_get_glyph_name,\n@@ -3703,1 +3705,1 @@\n-  tt_cmap_unicode_done( PS_Unicodes  unicodes )\n+  tt_cmap_unicode_done( FT_CMap  cmap )    \/* PS_Unicodes *\/\n@@ -3705,2 +3707,3 @@\n-    FT_Face    face   = FT_CMAP_FACE( unicodes );\n-    FT_Memory  memory = FT_FACE_MEMORY( face );\n+    PS_Unicodes  unicodes = (PS_Unicodes)cmap;\n+    FT_Face      face     = FT_CMAP_FACE( cmap );\n+    FT_Memory    memory   = FT_FACE_MEMORY( face );\n@@ -3715,2 +3718,2 @@\n-  tt_cmap_unicode_char_index( PS_Unicodes  unicodes,\n-                              FT_UInt32    char_code )\n+  tt_cmap_unicode_char_index( FT_CMap    cmap,       \/* PS_Unicodes *\/\n+                              FT_UInt32  char_code )\n@@ -3718,2 +3721,3 @@\n-    TT_Face             face    = (TT_Face)FT_CMAP_FACE( unicodes );\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)face->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    TT_Face             face     = (TT_Face)FT_CMAP_FACE( cmap );\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)face->psnames;\n@@ -3726,3 +3730,3 @@\n-  FT_CALLBACK_DEF( FT_UInt32 )\n-  tt_cmap_unicode_char_next( PS_Unicodes  unicodes,\n-                             FT_UInt32   *pchar_code )\n+  FT_CALLBACK_DEF( FT_UInt )\n+  tt_cmap_unicode_char_next( FT_CMap     cmap,        \/* PS_Unicodes *\/\n+                             FT_UInt32  *pchar_code )\n@@ -3730,2 +3734,3 @@\n-    TT_Face             face    = (TT_Face)FT_CMAP_FACE( unicodes );\n-    FT_Service_PsCMaps  psnames = (FT_Service_PsCMaps)face->psnames;\n+    PS_Unicodes         unicodes = (PS_Unicodes)cmap;\n+    TT_Face             face     = (TT_Face)FT_CMAP_FACE( cmap );\n+    FT_Service_PsCMaps  psnames  = (FT_Service_PsCMaps)face->psnames;\n@@ -3886,1 +3891,1 @@\n-    FT_CMap        cmap  = (FT_CMap)charmap;\n+    FT_CMap        cmap  = FT_CMAP( charmap );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/ttcmap.c","additions":276,"deletions":271,"binary":false,"changes":547,"status":"modified"},{"patch":"@@ -232,1 +232,1 @@\n-      if ( base_glyphs_offset_v1 + 4 >= table_size )\n+      if ( base_glyphs_offset_v1 >= table_size - 4 )\n@@ -252,1 +252,1 @@\n-        if ( layer_offset_v1 + 4 >= table_size )\n+        if ( layer_offset_v1 >= table_size - 4 )\n@@ -702,1 +702,1 @@\n-        apaint->u.solid.color.alpha += item_deltas[0];\n+        apaint->u.solid.color.alpha += (FT_F2Dot14)item_deltas[0];\n@@ -1649,1 +1649,1 @@\n-        color_stop->color.alpha += item_deltas[1];\n+        color_stop->color.alpha += (FT_F2Dot14)item_deltas[1];\n@@ -1917,1 +1917,1 @@\n-  typedef int  _tt_colr_dummy;\n+  typedef int  tt_colr_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/ttcolr.c","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -306,1 +306,1 @@\n-  typedef int  _tt_cpal_dummy;\n+  typedef int  tt_cpal_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/ttcpal.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -507,0 +507,7 @@\n+    if ( !valid_entries )\n+    {\n+      FT_TRACE2(( \"tt_face_load_font_dir: no valid tables found\\n\" ));\n+      error = FT_THROW( Unknown_File_Format );\n+      goto Exit;\n+    }\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/ttload.c","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -242,1 +242,1 @@\n-      (FT_Service_MetricsVariations)face->var;\n+      (FT_Service_MetricsVariations)face->tt_var;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/ttmtx.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -159,3 +159,4 @@\n-  load_format_20( TT_Face    face,\n-                  FT_Stream  stream,\n-                  FT_ULong   post_len )\n+  load_format_20( TT_Post_Names  names,\n+                  FT_Stream      stream,\n+                  FT_UShort      num_glyphs,\n+                  FT_ULong       post_len )\n@@ -166,2 +167,2 @@\n-    FT_Int      num_glyphs;\n-    FT_UShort   num_names;\n+    FT_UShort   n;\n+    FT_UShort   num_names = 0;\n@@ -170,2 +171,2 @@\n-    FT_Char**   name_strings  = NULL;\n-    FT_Byte*    strings       = NULL;\n+    FT_Byte**   name_strings  = NULL;\n+    FT_Byte*    q;\n@@ -174,11 +175,1 @@\n-    if ( FT_READ_USHORT( num_glyphs ) )\n-      goto Exit;\n-\n-    \/* UNDOCUMENTED!  The number of glyphs in this table can be smaller *\/\n-    \/* than the value in the maxp table (cf. cyberbit.ttf).             *\/\n-\n-    \/* There already exist fonts which have more than 32768 glyph names *\/\n-    \/* in this table, so the test for this threshold has been dropped.  *\/\n-\n-    if ( num_glyphs > face->max_profile.numGlyphs  ||\n-         (FT_ULong)num_glyphs * 2UL > post_len - 2 )\n+    if ( (FT_ULong)num_glyphs * 2 > post_len )\n@@ -190,11 +181,4 @@\n-    \/* load the indices *\/\n-    {\n-      FT_Int  n;\n-\n-\n-      if ( FT_QNEW_ARRAY( glyph_indices, num_glyphs ) ||\n-           FT_FRAME_ENTER( num_glyphs * 2L )          )\n-        goto Fail;\n-\n-      for ( n = 0; n < num_glyphs; n++ )\n-        glyph_indices[n] = FT_GET_USHORT();\n+    \/* load the indices and note their maximum *\/\n+    if ( FT_QNEW_ARRAY( glyph_indices, num_glyphs ) ||\n+         FT_FRAME_ENTER( num_glyphs * 2 )           )\n+      goto Fail;\n@@ -202,2 +186,1 @@\n-      FT_FRAME_EXIT();\n-    }\n+    q = (FT_Byte*)stream->cursor;\n@@ -205,1 +188,1 @@\n-    \/* compute number of names stored in table *\/\n+    for ( n = 0; n < num_glyphs; n++ )\n@@ -207,1 +190,1 @@\n-      FT_Int  n;\n+      FT_UShort  idx = FT_NEXT_USHORT( q );\n@@ -210,1 +193,2 @@\n-      num_names = 0;\n+      if ( idx > num_names )\n+        num_names = idx;\n@@ -212,3 +196,2 @@\n-      for ( n = 0; n < num_glyphs; n++ )\n-      {\n-        FT_Int  idx;\n+      glyph_indices[n] = idx;\n+    }\n@@ -216,0 +199,1 @@\n+    FT_FRAME_EXIT();\n@@ -217,9 +201,2 @@\n-        idx = glyph_indices[n];\n-        if ( idx >= 258 )\n-        {\n-          idx -= 257;\n-          if ( idx > num_names )\n-            num_names = (FT_UShort)idx;\n-        }\n-      }\n-    }\n+    \/* compute number of names stored in the table *\/\n+    num_names = num_names > 257 ? num_names - 257 : 0;\n@@ -230,1 +207,0 @@\n-      FT_UShort  n;\n@@ -232,0 +208,1 @@\n+      FT_Byte*   strings;\n@@ -234,1 +211,5 @@\n-      post_len -= (FT_ULong)num_glyphs * 2UL + 2;\n+      post_len -= (FT_ULong)num_glyphs * 2;\n+\n+      if ( FT_QALLOC( name_strings, num_names * sizeof ( FT_Byte* ) +\n+                                    post_len + 1 ) )\n+        goto Fail;\n@@ -236,3 +217,2 @@\n-      if ( FT_QALLOC( strings, post_len + 1 )       ||\n-           FT_STREAM_READ( strings, post_len )      ||\n-           FT_QNEW_ARRAY( name_strings, num_names ) )\n+      strings = (FT_Byte*)( name_strings + num_names );\n+      if ( FT_STREAM_READ( strings, post_len ) )\n@@ -254,1 +234,1 @@\n-        name_strings[n] = (FT_Char*)strings + p + 1;\n+        name_strings[n] = strings + p + 1;\n@@ -262,9 +242,2 @@\n-        if ( post_len == 0 )\n-        {\n-          \/* fake empty string *\/\n-          if ( FT_QREALLOC( strings, 1, 2 ) )\n-            goto Fail;\n-\n-          post_len          = 1;\n-          strings[post_len] = 0;\n-        }\n+        FT_TRACE4(( \"load_format_20: %hu PostScript names are truncated\\n\",\n+                    num_names - n ));\n@@ -272,4 +245,0 @@\n-        FT_ERROR(( \"load_format_20:\"\n-                   \" all entries in post table are already parsed,\"\n-                   \" using NULL names for gid %d - %d\\n\",\n-                    n, num_names - 1 ));\n@@ -277,1 +246,1 @@\n-          name_strings[n] = (FT_Char*)strings + post_len;\n+          name_strings[n] = strings + post_len;\n@@ -282,3 +251,4 @@\n-    {\n-      TT_Post_20  table = &face->postscript_names.names.format_20;\n-\n+    names->num_glyphs    = num_glyphs;\n+    names->num_names     = num_names;\n+    names->glyph_indices = glyph_indices;\n+    names->glyph_names   = name_strings;\n@@ -286,5 +256,0 @@\n-      table->num_glyphs    = (FT_UShort)num_glyphs;\n-      table->num_names     = (FT_UShort)num_names;\n-      table->glyph_indices = glyph_indices;\n-      table->glyph_names   = name_strings;\n-    }\n@@ -295,1 +260,0 @@\n-    FT_FREE( strings );\n@@ -304,3 +268,4 @@\n-  load_format_25( TT_Face    face,\n-                  FT_Stream  stream,\n-                  FT_ULong   post_len )\n+  load_format_25( TT_Post_Names  names,\n+                  FT_Stream      stream,\n+                  FT_UShort      num_glyphs,\n+                  FT_ULong       post_len )\n@@ -311,4 +276,3 @@\n-    FT_Int     num_glyphs;\n-    FT_Char*   offset_table = NULL;\n-\n-    FT_UNUSED( post_len );\n+    FT_UShort   n;\n+    FT_UShort*  glyph_indices = NULL;\n+    FT_Byte*    q;\n@@ -317,7 +281,3 @@\n-    if ( FT_READ_USHORT( num_glyphs ) )\n-      goto Exit;\n-\n-    \/* check the number of glyphs *\/\n-    if ( num_glyphs > face->max_profile.numGlyphs ||\n-         num_glyphs > 258                         ||\n-         num_glyphs < 1                           )\n+    \/* check the number of glyphs, including the theoretical limit *\/\n+    if ( num_glyphs > post_len  ||\n+         num_glyphs > 258 + 128 )\n@@ -329,2 +289,3 @@\n-    if ( FT_QNEW_ARRAY( offset_table, num_glyphs )  ||\n-         FT_STREAM_READ( offset_table, num_glyphs ) )\n+    \/* load the indices and check their Mac range *\/\n+    if ( FT_QNEW_ARRAY( glyph_indices, num_glyphs ) ||\n+         FT_FRAME_ENTER( num_glyphs )               )\n@@ -333,3 +294,1 @@\n-    \/* now check the offset table *\/\n-    {\n-      FT_Int  n;\n+    q = (FT_Byte*)stream->cursor;\n@@ -337,0 +296,3 @@\n+    for ( n = 0; n < num_glyphs; n++ )\n+    {\n+      FT_Int  idx = n + FT_NEXT_CHAR( q );\n@@ -338,3 +300,0 @@\n-      for ( n = 0; n < num_glyphs; n++ )\n-      {\n-        FT_Long  idx = (FT_Long)n + offset_table[n];\n@@ -342,0 +301,2 @@\n+      if ( idx < 0 || idx > 257 )\n+        idx = 0;\n@@ -343,6 +304,1 @@\n-        if ( idx < 0 || idx > num_glyphs )\n-        {\n-          error = FT_THROW( Invalid_File_Format );\n-          goto Fail;\n-        }\n-      }\n+      glyph_indices[n] = (FT_UShort)idx;\n@@ -351,4 +307,1 @@\n-    \/* OK, set table fields and exit successfully *\/\n-    {\n-      TT_Post_25  table = &face->postscript_names.names.format_25;\n-\n+    FT_FRAME_EXIT();\n@@ -356,3 +309,3 @@\n-      table->num_glyphs = (FT_UShort)num_glyphs;\n-      table->offsets    = offset_table;\n-    }\n+    \/* OK, set table fields and exit successfully *\/\n+    names->num_glyphs    = num_glyphs;\n+    names->glyph_indices = glyph_indices;\n@@ -363,1 +316,1 @@\n-    FT_FREE( offset_table );\n+    FT_FREE( glyph_indices );\n@@ -373,3 +326,3 @@\n-    FT_Stream  stream;\n-    FT_Error   error;\n-    FT_Fixed   format;\n+    FT_Error   error = FT_Err_Ok;\n+    FT_Stream  stream = face->root.stream;\n+    FT_Fixed   format = face->postscript.FormatType;\n@@ -377,0 +330,1 @@\n+    FT_UShort  num_glyphs;\n@@ -379,3 +333,0 @@\n-    \/* get a stream for the face's resource *\/\n-    stream = face->root.stream;\n-\n@@ -387,4 +338,7 @@\n-    format = face->postscript.FormatType;\n-\n-    \/* go to beginning of subtable *\/\n-    if ( FT_STREAM_SKIP( 32 ) )\n+    \/* UNDOCUMENTED!  The number of glyphs in this table can be smaller *\/\n+    \/* than the value in the maxp table (cf. cyberbit.ttf).             *\/\n+    if ( post_len < 34                            ||\n+         FT_STREAM_SKIP( 32 )                     ||\n+         FT_READ_USHORT( num_glyphs )             ||\n+         num_glyphs > face->max_profile.numGlyphs ||\n+         num_glyphs == 0 )\n@@ -393,9 +347,7 @@\n-    \/* now read postscript table *\/\n-    if ( format == 0x00020000L && post_len >= 34 )\n-      error = load_format_20( face, stream, post_len - 32 );\n-    else if ( format == 0x00025000L && post_len >= 34 )\n-      error = load_format_25( face, stream, post_len - 32 );\n-    else\n-      error = FT_THROW( Invalid_File_Format );\n-\n-    face->postscript_names.loaded = 1;\n+    \/* now read postscript names data *\/\n+    if ( format == 0x00020000L )\n+      error = load_format_20( &face->postscript_names, stream,\n+                              num_glyphs, post_len - 34 );\n+    else if ( format == 0x00025000L )\n+      error = load_format_25( &face->postscript_names, stream,\n+                              num_glyphs, post_len - 34 );\n@@ -404,0 +356,1 @@\n+    face->postscript_names.loaded = 1;  \/* even if failed *\/\n@@ -413,1 +366,0 @@\n-    FT_Fixed       format;\n@@ -416,1 +368,1 @@\n-    if ( names->loaded )\n+    if ( names->num_glyphs )\n@@ -418,23 +370,3 @@\n-      format = face->postscript.FormatType;\n-\n-      if ( format == 0x00020000L )\n-      {\n-        TT_Post_20  table = &names->names.format_20;\n-\n-\n-        FT_FREE( table->glyph_indices );\n-        table->num_glyphs = 0;\n-\n-        if ( table->num_names )\n-        {\n-          table->glyph_names[0]--;\n-          FT_FREE( table->glyph_names[0] );\n-\n-          FT_FREE( table->glyph_names );\n-          table->num_names = 0;\n-        }\n-      }\n-      else if ( format == 0x00025000L )\n-      {\n-        TT_Post_25  table = &names->names.format_25;\n-\n+      FT_FREE( names->glyph_indices );\n+      names->num_glyphs = 0;\n+    }\n@@ -442,3 +374,4 @@\n-        FT_FREE( table->offsets );\n-        table->num_glyphs = 0;\n-      }\n+    if ( names->num_names )\n+    {\n+      FT_FREE( names->glyph_names );\n+      names->num_names = 0;\n@@ -446,0 +379,1 @@\n+\n@@ -481,1 +415,0 @@\n-    TT_Post_Names  names;\n@@ -501,2 +434,0 @@\n-    names = &face->postscript_names;\n-\n@@ -513,1 +444,2 @@\n-    else if ( format == 0x00020000L )\n+    else if ( format == 0x00020000L ||\n+              format == 0x00025000L )\n@@ -515,1 +447,1 @@\n-      TT_Post_20  table = &names->names.format_20;\n+      TT_Post_Names  names = &face->postscript_names;\n@@ -525,1 +457,1 @@\n-      if ( idx < (FT_UInt)table->num_glyphs )\n+      if ( idx < (FT_UInt)names->num_glyphs )\n@@ -527,1 +459,1 @@\n-        FT_UShort  name_index = table->glyph_indices[idx];\n+        FT_UShort  name_index = names->glyph_indices[idx];\n@@ -532,14 +464,2 @@\n-        else\n-          *PSname = (FT_String*)table->glyph_names[name_index - 258];\n-      }\n-    }\n-    else if ( format == 0x00025000L )\n-    {\n-      TT_Post_25  table = &names->names.format_25;\n-\n-\n-      if ( !names->loaded )\n-      {\n-        error = load_post_names( face );\n-        if ( error )\n-          goto End;\n+        else  \/* only for version 2.0 *\/\n+          *PSname = (FT_String*)names->glyph_names[name_index - 258];\n@@ -547,3 +467,0 @@\n-\n-      if ( idx < (FT_UInt)table->num_glyphs )    \/* paranoid checking *\/\n-        *PSname = MAC_NAME( (FT_Int)idx + table->offsets[idx] );\n@@ -555,0 +472,1 @@\n+    \/* post format errors ignored *\/\n@@ -561,1 +479,1 @@\n-  typedef int  _tt_post_dummy;\n+  typedef int  tt_post_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/ttpost.c","additions":101,"deletions":183,"binary":false,"changes":284,"status":"modified"},{"patch":"@@ -1680,1 +1680,1 @@\n-  typedef int  _tt_sbit_dummy;\n+  typedef int  tt_sbit_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/ttsbit.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -114,1 +114,1 @@\n-  typedef int  _woff2tags_dummy;\n+  typedef int  woff2tags_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/sfnt\/woff2tags.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1009,4 +1009,5 @@\n-#if defined( __SSE2__ )                          || \\\n-    defined( __x86_64__ )                        || \\\n-    defined( _M_AMD64 )                          || \\\n-    ( defined( _M_IX86_FP ) && _M_IX86_FP >= 2 )\n+#if ( defined( __SSE2__ )                          ||   \\\n+      defined( __x86_64__ )                        ||   \\\n+      defined( _M_AMD64 )                          ||   \\\n+      ( defined( _M_IX86_FP ) && _M_IX86_FP >= 2 ) ) && \\\n+    !defined( __VMS )\n@@ -1430,1 +1431,1 @@\n-                gray_PWorker      worker )\n+                void*             worker_ )  \/* gray_PWorker *\/\n@@ -1432,0 +1433,2 @@\n+    gray_PWorker  worker = (gray_PWorker)worker_;\n+\n@@ -1449,1 +1452,1 @@\n-                gray_PWorker      worker )\n+                void*             worker_ )   \/* gray_PWorker *\/\n@@ -1451,0 +1454,3 @@\n+    gray_PWorker  worker = (gray_PWorker)worker_;\n+\n+\n@@ -1459,1 +1465,1 @@\n-                 gray_PWorker      worker )\n+                 void*             worker_ )   \/* gray_PWorker *\/\n@@ -1461,0 +1467,3 @@\n+    gray_PWorker  worker = (gray_PWorker)worker_;\n+\n+\n@@ -1470,1 +1479,1 @@\n-                 gray_PWorker      worker )\n+                 void*             worker_ )   \/* gray_PWorker *\/\n@@ -1472,0 +1481,3 @@\n+    gray_PWorker  worker = (gray_PWorker)worker_;\n+\n+\n@@ -1669,0 +1681,2 @@\n+    int   last;      \/* index of last point in contour  *\/\n+\n@@ -1683,1 +1697,0 @@\n-    first = 0;\n@@ -1685,0 +1698,1 @@\n+    last = -1;\n@@ -1687,4 +1701,1 @@\n-      int  last;  \/* index of last point in contour *\/\n-\n-\n-      FT_TRACE5(( \"FT_Outline_Decompose: Outline %d\\n\", n ));\n+      FT_TRACE5(( \"FT_Outline_Decompose: Contour %d\\n\", n ));\n@@ -1692,0 +1703,1 @@\n+      first = last + 1;\n@@ -1693,1 +1705,1 @@\n-      if ( last < 0 )\n+      if ( last < first )\n@@ -1695,0 +1707,1 @@\n+\n@@ -1877,1 +1890,1 @@\n-   Close:\n+    Close:\n@@ -1880,2 +1893,0 @@\n-\n-      first = last + 1;\n@@ -1926,1 +1937,1 @@\n-      FT_TRACE7(( \"band [%d..%d]: %ld cell%s remaining\/\\n\",\n+      FT_TRACE7(( \"band [%d..%d]: %td cell%s remaining\/\\n\",\n@@ -2159,2 +2170,2 @@\n-  gray_raster_new( FT_Memory      memory,\n-                   gray_PRaster*  araster )\n+  gray_raster_new( void*       memory_,\n+                   FT_Raster*  araster_ )\n@@ -2162,0 +2173,3 @@\n+    FT_Memory      memory  = (FT_Memory)memory_;\n+    gray_PRaster*  araster = (gray_PRaster*)araster_;\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/smooth\/ftgrays.c","additions":34,"deletions":20,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -90,1 +90,1 @@\n-  ft_smooth_init( FT_Renderer  render )\n+  ft_smooth_init( FT_Module  module )   \/* FT_Renderer *\/\n@@ -92,0 +92,2 @@\n+    FT_Renderer  render = (FT_Renderer)module;\n+\n@@ -114,1 +116,1 @@\n-                       TOrigin*        target )\n+                       void*           target_ )   \/* TOrigin* *\/\n@@ -116,0 +118,2 @@\n+    TOrigin*  target = (TOrigin*)target_;\n+\n@@ -144,1 +148,1 @@\n-    params.gray_spans = (FT_SpanFunc)ft_smooth_lcd_spans;\n+    params.gray_spans = ft_smooth_lcd_spans;\n@@ -259,1 +263,1 @@\n-  ft_smooth_init( FT_Renderer  render )\n+  ft_smooth_init( FT_Module  module )   \/* FT_Renderer *\/\n@@ -261,0 +265,3 @@\n+    FT_Renderer  render = (FT_Renderer)module;\n+\n+\n@@ -343,1 +350,1 @@\n-                           TOrigin*        target )\n+                           void*           target_ )\n@@ -345,0 +352,3 @@\n+    TOrigin*  target = (TOrigin*)target_;\n+\n+\n@@ -389,1 +399,1 @@\n-    params.gray_spans = (FT_SpanFunc)ft_smooth_overlap_spans;\n+    params.gray_spans = ft_smooth_overlap_spans;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/smooth\/ftsmooth.c","additions":16,"deletions":6,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -60,1 +60,1 @@\n-  static FT_Error\n+  FT_CALLBACK_DEF( FT_Error )\n@@ -96,4 +96,8 @@\n-      if ( interpreter_version == TT_INTERPRETER_VERSION_35\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-           || interpreter_version == TT_INTERPRETER_VERSION_38\n-#endif\n+      switch ( interpreter_version )\n+      {\n+      case TT_INTERPRETER_VERSION_35:\n+        driver->interpreter_version = TT_INTERPRETER_VERSION_35;\n+        break;\n+\n+      case TT_INTERPRETER_VERSION_38:\n+      case TT_INTERPRETER_VERSION_40:\n@@ -101,1 +105,2 @@\n-           || interpreter_version == TT_INTERPRETER_VERSION_40\n+        driver->interpreter_version = TT_INTERPRETER_VERSION_40;\n+      break;\n@@ -103,3 +108,2 @@\n-         )\n-        driver->interpreter_version = interpreter_version;\n-      else\n+\n+      default:\n@@ -107,0 +111,1 @@\n+      }\n@@ -117,1 +122,1 @@\n-  static FT_Error\n+  FT_CALLBACK_DEF( FT_Error )\n@@ -120,1 +125,1 @@\n-                   const void*  value )\n+                   void*        value )\n@@ -147,2 +152,2 @@\n-    (FT_Properties_SetFunc)tt_property_set,     \/* set_property *\/\n-    (FT_Properties_GetFunc)tt_property_get      \/* get_property *\/\n+    tt_property_set,  \/* FT_Properties_SetFunc set_property *\/\n+    tt_property_get   \/* FT_Properties_GetFunc get_property *\/\n@@ -201,2 +206,2 @@\n-  static FT_Error\n-  tt_get_kerning( FT_Face     ttface,          \/* TT_Face *\/\n+  FT_CALLBACK_DEF( FT_Error )\n+  tt_get_kerning( FT_Face     face,        \/* TT_Face *\/\n@@ -207,2 +212,2 @@\n-    TT_Face       face = (TT_Face)ttface;\n-    SFNT_Service  sfnt = (SFNT_Service)face->sfnt;\n+    TT_Face       ttface = (TT_Face)face;\n+    SFNT_Service  sfnt   = (SFNT_Service)ttface->sfnt;\n@@ -215,1 +220,1 @@\n-      kerning->x = sfnt->get_kerning( face, left_glyph, right_glyph );\n+      kerning->x = sfnt->get_kerning( ttface, left_glyph, right_glyph );\n@@ -221,2 +226,2 @@\n-  static FT_Error\n-  tt_get_advances( FT_Face    ttface,\n+  FT_CALLBACK_DEF( FT_Error )\n+  tt_get_advances( FT_Face    face,      \/* TT_Face *\/\n@@ -229,1 +234,1 @@\n-    TT_Face  face = (TT_Face)ttface;\n+    TT_Face  ttface = (TT_Face)face;\n@@ -238,2 +243,2 @@\n-      if ( ( FT_IS_NAMED_INSTANCE( ttface ) || FT_IS_VARIATION( ttface ) ) &&\n-           !( face->variation_support & TT_FACE_FLAG_VAR_VADVANCE )        )\n+      if ( ( FT_IS_NAMED_INSTANCE( face ) || FT_IS_VARIATION( face ) ) &&\n+           !( ttface->variation_support & TT_FACE_FLAG_VAR_VADVANCE )  )\n@@ -250,1 +255,1 @@\n-        TT_Get_VMetrics( face, start + nn, 0, &tsb, &ah );\n+        TT_Get_VMetrics( ttface, start + nn, 0, &tsb, &ah );\n@@ -258,2 +263,2 @@\n-      if ( ( FT_IS_NAMED_INSTANCE( ttface ) || FT_IS_VARIATION( ttface ) ) &&\n-           !( face->variation_support & TT_FACE_FLAG_VAR_HADVANCE )        )\n+      if ( ( FT_IS_NAMED_INSTANCE( face ) || FT_IS_VARIATION( face ) ) &&\n+           !( ttface->variation_support & TT_FACE_FLAG_VAR_HADVANCE )  )\n@@ -269,1 +274,1 @@\n-        TT_Get_HMetrics( face, start + nn, &lsb, &aw );\n+        TT_Get_HMetrics( ttface, start + nn, &lsb, &aw );\n@@ -293,1 +298,1 @@\n-  static FT_Error\n+  FT_CALLBACK_DEF( FT_Error )\n@@ -309,1 +314,1 @@\n-      tt_size_reset( ttsize, 0 ); \/* ignore return value *\/\n+      tt_size_reset( ttsize ); \/* ignore return value *\/\n@@ -330,1 +335,1 @@\n-  static FT_Error\n+  FT_CALLBACK_DEF( FT_Error )\n@@ -370,1 +375,1 @@\n-      error = tt_size_reset( ttsize, 0 );\n+      error = tt_size_reset( ttsize );\n@@ -429,3 +434,3 @@\n-  static FT_Error\n-  tt_glyph_load( FT_GlyphSlot  ttslot,      \/* TT_GlyphSlot *\/\n-                 FT_Size       ttsize,      \/* TT_Size      *\/\n+  FT_CALLBACK_DEF( FT_Error )\n+  tt_glyph_load( FT_GlyphSlot  slot,        \/* TT_GlyphSlot *\/\n+                 FT_Size       size,        \/* TT_Size      *\/\n@@ -435,3 +440,3 @@\n-    TT_GlyphSlot  slot = (TT_GlyphSlot)ttslot;\n-    TT_Size       size = (TT_Size)ttsize;\n-    FT_Face       face = ttslot->face;\n+    TT_GlyphSlot  ttslot = (TT_GlyphSlot)slot;\n+    TT_Size       ttsize = (TT_Size)size;\n+    FT_Face       face   = ttslot->face;\n@@ -479,3 +484,3 @@\n-    size->metrics = ( load_flags & FT_LOAD_NO_HINTING )\n-                      ? &ttsize->metrics\n-                      : &size->hinted_metrics;\n+    ttsize->metrics = ( load_flags & FT_LOAD_NO_HINTING )\n+                        ? &size->metrics\n+                        : &ttsize->hinted_metrics;\n@@ -484,1 +489,1 @@\n-    error = TT_Load_Glyph( size, slot, glyph_index, load_flags );\n+    error = TT_Load_Glyph( ttsize, ttslot, glyph_index, load_flags );\n@@ -510,28 +515,25 @@\n-    (FT_Get_MM_Func)        NULL,                  \/* get_mm                    *\/\n-    (FT_Set_MM_Design_Func) NULL,                  \/* set_mm_design             *\/\n-    (FT_Set_MM_Blend_Func)  TT_Set_MM_Blend,       \/* set_mm_blend              *\/\n-    (FT_Get_MM_Blend_Func)  TT_Get_MM_Blend,       \/* get_mm_blend              *\/\n-    (FT_Get_MM_Var_Func)    TT_Get_MM_Var,         \/* get_mm_var                *\/\n-    (FT_Set_Var_Design_Func)TT_Set_Var_Design,     \/* set_var_design            *\/\n-    (FT_Get_Var_Design_Func)TT_Get_Var_Design,     \/* get_var_design            *\/\n-    (FT_Set_Instance_Func)  TT_Set_Named_Instance, \/* set_instance              *\/\n-    (FT_Set_MM_WeightVector_Func)\n-                            NULL,                  \/* set_mm_weightvector       *\/\n-    (FT_Get_MM_WeightVector_Func)\n-                            NULL,                  \/* get_mm_weightvector       *\/\n-    (FT_Var_Load_Delta_Set_Idx_Map_Func)\n-                            tt_var_load_delta_set_index_mapping,\n-                                                   \/* load_delta_set_idx_map    *\/\n-    (FT_Var_Load_Item_Var_Store_Func)\n-                            tt_var_load_item_variation_store,\n-                                                   \/* load_item_variation_store *\/\n-    (FT_Var_Get_Item_Delta_Func)\n-                            tt_var_get_item_delta, \/* get_item_delta            *\/\n-    (FT_Var_Done_Item_Var_Store_Func)\n-                            tt_var_done_item_variation_store,\n-                                                   \/* done_item_variation_store *\/\n-    (FT_Var_Done_Delta_Set_Idx_Map_Func)\n-                            tt_var_done_delta_set_index_map,\n-                                                   \/* done_delta_set_index_map  *\/\n-    (FT_Get_Var_Blend_Func) tt_get_var_blend,      \/* get_var_blend             *\/\n-    (FT_Done_Blend_Func)    tt_done_blend          \/* done_blend                *\/\n+    NULL,                  \/* FT_Get_MM_Func              get_mm                     *\/\n+    NULL,                  \/* FT_Set_MM_Design_Func       set_mm_design              *\/\n+    TT_Set_MM_Blend,       \/* FT_Set_MM_Blend_Func        set_mm_blend               *\/\n+    TT_Get_MM_Blend,       \/* FT_Get_MM_Blend_Func        get_mm_blend               *\/\n+    TT_Get_MM_Var,         \/* FT_Get_MM_Var_Func          get_mm_var                 *\/\n+    TT_Set_Var_Design,     \/* FT_Set_Var_Design_Func      set_var_design             *\/\n+    TT_Get_Var_Design,     \/* FT_Get_Var_Design_Func      get_var_design             *\/\n+    TT_Set_Named_Instance, \/* FT_Set_Named_Instance_Func  set_named_instance         *\/\n+    TT_Get_Default_Named_Instance,\n+                    \/* FT_Get_Default_Named_Instance_Func get_default_named_instance *\/\n+    NULL,                  \/* FT_Set_MM_WeightVector_Func set_mm_weightvector        *\/\n+    NULL,                  \/* FT_Get_MM_WeightVector_Func get_mm_weightvector        *\/\n+\n+    tt_construct_ps_name,  \/* FT_Construct_PS_Name_Func   construct_ps_name          *\/\n+    tt_var_load_delta_set_index_mapping,\n+                    \/* FT_Var_Load_Delta_Set_Idx_Map_Func load_delta_set_idx_map     *\/\n+    tt_var_load_item_variation_store,\n+                    \/* FT_Var_Load_Item_Var_Store_Func    load_item_variation_store  *\/\n+    tt_var_get_item_delta, \/* FT_Var_Get_Item_Delta_Func  get_item_delta             *\/\n+    tt_var_done_item_variation_store,\n+                    \/* FT_Var_Done_Item_Var_Store_Func    done_item_variation_store  *\/\n+    tt_var_done_delta_set_index_map,\n+                    \/* FT_Var_Done_Delta_Set_Idx_Map_Func done_delta_set_index_map   *\/\n+    tt_get_var_blend,      \/* FT_Get_Var_Blend_Func       get_var_blend              *\/\n+    tt_done_blend          \/* FT_Done_Blend_Func          done_blend                 *\/\n@@ -543,3 +545,3 @@\n-    (FT_HAdvance_Adjust_Func)tt_hadvance_adjust,     \/* hadvance_adjust *\/\n-    (FT_LSB_Adjust_Func)     NULL,                   \/* lsb_adjust      *\/\n-    (FT_RSB_Adjust_Func)     NULL,                   \/* rsb_adjust      *\/\n+    tt_hadvance_adjust,   \/* FT_HAdvance_Adjust_Func hadvance_adjust *\/\n+    NULL,                 \/* FT_LSB_Adjust_Func      lsb_adjust      *\/\n+    NULL,                 \/* FT_RSB_Adjust_Func      rsb_adjust      *\/\n@@ -547,4 +549,4 @@\n-    (FT_VAdvance_Adjust_Func)tt_vadvance_adjust,     \/* vadvance_adjust *\/\n-    (FT_TSB_Adjust_Func)     NULL,                   \/* tsb_adjust      *\/\n-    (FT_BSB_Adjust_Func)     NULL,                   \/* bsb_adjust      *\/\n-    (FT_VOrg_Adjust_Func)    NULL,                   \/* vorg_adjust     *\/\n+    tt_vadvance_adjust,   \/* FT_VAdvance_Adjust_Func vadvance_adjust *\/\n+    NULL,                 \/* FT_TSB_Adjust_Func      tsb_adjust      *\/\n+    NULL,                 \/* FT_BSB_Adjust_Func      bsb_adjust      *\/\n+    NULL,                 \/* FT_VOrg_Adjust_Func     vorg_adjust     *\/\n@@ -552,1 +554,2 @@\n-    (FT_Metrics_Adjust_Func) tt_apply_mvar           \/* metrics_adjust  *\/\n+    tt_apply_mvar,        \/* FT_Metrics_Adjust_Func  metrics_adjust  *\/\n+    tt_size_reset_height  \/* FT_Size_Reset_Func      size_reset      *\/\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttdriver.c","additions":80,"deletions":77,"binary":false,"changes":157,"status":"modified"},{"patch":"@@ -38,1 +38,0 @@\n-#include \"ttsubpix.h\"\n@@ -155,3 +154,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    TT_Driver  driver = (TT_Driver)FT_FACE_DRIVER( face );\n-#endif\n@@ -186,14 +182,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( driver->interpreter_version == TT_INTERPRETER_VERSION_38 &&\n-         loader->exec                                             )\n-    {\n-      loader->exec->sph_tweak_flags = 0;\n-\n-      \/* This may not be the right place for this, but it works...  *\/\n-      \/* Note that we have to unconditionally load the tweaks since *\/\n-      \/* it is possible that glyphs individually switch ClearType's *\/\n-      \/* backward compatibility mode on and off.                    *\/\n-      sph_set_tweaks( loader, glyph_index );\n-    }\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -365,0 +347,1 @@\n+    FT_Outline*     outline    = &gloader->current.outline;\n@@ -366,2 +349,0 @@\n-    FT_Outline*     outline;\n-    FT_UShort       n_ins;\n@@ -369,0 +350,1 @@\n+    FT_UShort       n_ins;\n@@ -374,2 +356,1 @@\n-    FT_Short        *cont, *cont_limit, prev_cont;\n-    FT_Int          xy_size = 0;\n+    FT_Short        *cont, *cont_limit, last;\n@@ -383,4 +364,0 @@\n-    \/* reading the contours' endpoints & number of points *\/\n-    cont       = gloader->current.outline.contours;\n-    cont_limit = cont + n_contours;\n-\n@@ -388,1 +365,1 @@\n-    if ( n_contours >= 0xFFF || p + ( n_contours + 1 ) * 2 > limit )\n+    if ( n_contours >= 0xFFF || p + 2 * n_contours + 2 > limit )\n@@ -391,7 +368,3 @@\n-    prev_cont = FT_NEXT_SHORT( p );\n-\n-    if ( n_contours > 0 )\n-      cont[0] = prev_cont;\n-\n-    if ( prev_cont < 0 )\n-      goto Invalid_Outline;\n+    \/* reading the contours' endpoints & number of points *\/\n+    cont       = outline->contours;\n+    cont_limit = cont + n_contours;\n@@ -399,1 +372,2 @@\n-    for ( cont++; cont < cont_limit; cont++ )\n+    last = -1;\n+    for ( ; cont < cont_limit; cont++ )\n@@ -401,8 +375,1 @@\n-      cont[0] = FT_NEXT_SHORT( p );\n-      if ( cont[0] <= prev_cont )\n-      {\n-        \/* unordered contours: this is invalid *\/\n-        goto Invalid_Outline;\n-      }\n-      prev_cont = cont[0];\n-    }\n+      *cont = FT_NEXT_SHORT( p );\n@@ -410,5 +377,1 @@\n-    n_points = 0;\n-    if ( n_contours > 0 )\n-    {\n-      n_points = cont[-1] + 1;\n-      if ( n_points < 0 )\n+      if ( *cont <= last )\n@@ -416,0 +379,2 @@\n+\n+      last = *cont;\n@@ -418,0 +383,2 @@\n+    n_points = last + 1;\n+\n@@ -425,7 +392,1 @@\n-    \/* reading the bytecode instructions *\/\n-    load->glyph->control_len  = 0;\n-    load->glyph->control_data = NULL;\n-\n-    if ( p + 2 > limit )\n-      goto Invalid_Outline;\n-\n+    \/* space checked above *\/\n@@ -436,0 +397,8 @@\n+    \/* check instructions size *\/\n+    if ( p + n_ins > limit )\n+    {\n+      FT_TRACE1(( \"TT_Load_Simple_Glyph: excessive instruction count\\n\" ));\n+      error = FT_THROW( Too_Many_Hints );\n+      goto Fail;\n+    }\n+\n@@ -440,1 +409,2 @@\n-      FT_ULong  tmp;\n+      TT_ExecContext  exec = load->exec;\n+      FT_Memory       memory = exec->memory;\n@@ -443,7 +413,3 @@\n-      \/* check instructions size *\/\n-      if ( ( limit - p ) < n_ins )\n-      {\n-        FT_TRACE1(( \"TT_Load_Simple_Glyph: instruction count mismatch\\n\" ));\n-        error = FT_THROW( Too_Many_Hints );\n-        goto Fail;\n-      }\n+      if ( exec->glyphSize )\n+        FT_FREE( exec->glyphIns );\n+      exec->glyphSize = 0;\n@@ -452,12 +418,5 @@\n-      \/* and thus update the bytecode array size by ourselves       *\/\n-\n-      tmp   = load->exec->glyphSize;\n-      error = Update_Max( load->exec->memory,\n-                          &tmp,\n-                          sizeof ( FT_Byte ),\n-                          (void*)&load->exec->glyphIns,\n-                          n_ins );\n-\n-      load->exec->glyphSize = (FT_UInt)tmp;\n-      if ( error )\n-        return error;\n+      \/* and thus allocate the bytecode array size by ourselves     *\/\n+      if ( n_ins )\n+      {\n+        if ( FT_QNEW_ARRAY( exec->glyphIns, n_ins ) )\n+          return error;\n@@ -465,2 +424,1 @@\n-      load->glyph->control_len  = n_ins;\n-      load->glyph->control_data = load->exec->glyphIns;\n+        FT_MEM_COPY( exec->glyphIns, p, (FT_Long)n_ins );\n@@ -468,2 +426,2 @@\n-      if ( n_ins )\n-        FT_MEM_COPY( load->exec->glyphIns, p, (FT_Long)n_ins );\n+        exec->glyphSize  = n_ins;\n+      }\n@@ -476,2 +434,0 @@\n-    outline = &gloader->current.outline;\n-\n@@ -515,3 +471,0 @@\n-    if ( p + xy_size > limit )\n-      goto Invalid_Outline;\n-\n@@ -547,1 +500,1 @@\n-    vec       = gloader->current.outline.points;\n+    vec       = outline->points;\n@@ -830,2 +783,1 @@\n-#if defined TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY || \\\n-    defined TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n+#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n@@ -839,1 +791,2 @@\n-    FT_Long       n_ins;\n+    TT_ExecContext  exec  = loader->exec;\n+    FT_Long         n_ins = exec->glyphSize;\n@@ -846,2 +799,0 @@\n-    n_ins = loader->glyph->control_len;\n-\n@@ -853,1 +804,1 @@\n-    loader->exec->GS = loader->size->GS;\n+    exec->GS = loader->size->GS;\n@@ -859,2 +810,2 @@\n-      loader->exec->metrics.x_scale = 1 << 16;\n-      loader->exec->metrics.y_scale = 1 << 16;\n+      exec->metrics.x_scale = 1 << 16;\n+      exec->metrics.y_scale = 1 << 16;\n@@ -866,2 +817,2 @@\n-      loader->exec->metrics.x_scale = loader->size->metrics->x_scale;\n-      loader->exec->metrics.y_scale = loader->size->metrics->y_scale;\n+      exec->metrics.x_scale = loader->size->metrics->x_scale;\n+      exec->metrics.y_scale = loader->size->metrics->y_scale;\n@@ -887,3 +838,0 @@\n-      FT_GlyphLoader  gloader         = loader->gloader;\n-      FT_Outline      current_outline = gloader->current.outline;\n-\n@@ -891,2 +839,1 @@\n-      TT_Set_CodeRange( loader->exec, tt_coderange_glyph,\n-                        loader->exec->glyphIns, n_ins );\n+      TT_Set_CodeRange( exec, tt_coderange_glyph, exec->glyphIns, n_ins );\n@@ -894,2 +841,2 @@\n-      loader->exec->is_composite = is_composite;\n-      loader->exec->pts          = *zone;\n+      exec->is_composite = is_composite;\n+      exec->pts          = *zone;\n@@ -897,2 +844,2 @@\n-      error = TT_Run_Context( loader->exec );\n-      if ( error && loader->exec->pedantic_hinting )\n+      error = TT_Run_Context( exec );\n+      if ( error && exec->pedantic_hinting )\n@@ -902,2 +849,2 @@\n-      current_outline.tags[0] |=\n-        ( loader->exec->GS.scan_type << 5 ) | FT_CURVE_TAG_HAS_SCANMODE;\n+      loader->gloader->current.outline.tags[0] |=\n+        ( exec->GS.scan_type << 5 ) | FT_CURVE_TAG_HAS_SCANMODE;\n@@ -908,1 +855,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n@@ -912,8 +858,1 @@\n-    if ( !( driver->interpreter_version == TT_INTERPRETER_VERSION_40 &&\n-            loader->exec->backward_compatibility ) )\n-    {\n-#endif\n-      loader->pp1 = zone->cur[zone->n_points - 4];\n-      loader->pp2 = zone->cur[zone->n_points - 3];\n-      loader->pp3 = zone->cur[zone->n_points - 2];\n-      loader->pp4 = zone->cur[zone->n_points - 1];\n+\n@@ -921,1 +860,3 @@\n-    }\n+    if ( driver->interpreter_version == TT_INTERPRETER_VERSION_40 &&\n+         exec->backward_compatibility )\n+      return FT_Err_Ok;\n@@ -924,10 +865,4 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( driver->interpreter_version == TT_INTERPRETER_VERSION_38 )\n-    {\n-      if ( loader->exec->sph_tweak_flags & SPH_TWEAK_DEEMBOLDEN )\n-        FT_Outline_EmboldenXY( &loader->gloader->current.outline, -24, 0 );\n-\n-      else if ( loader->exec->sph_tweak_flags & SPH_TWEAK_EMBOLDEN )\n-        FT_Outline_EmboldenXY( &loader->gloader->current.outline, 24, 0 );\n-    }\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n+    loader->pp1 = zone->cur[zone->n_points - 4];\n+    loader->pp2 = zone->cur[zone->n_points - 3];\n+    loader->pp3 = zone->cur[zone->n_points - 2];\n+    loader->pp4 = zone->cur[zone->n_points - 1];\n@@ -952,4 +887,4 @@\n-    FT_GlyphLoader  gloader = loader->gloader;\n-    FT_Error        error   = FT_Err_Ok;\n-    FT_Outline*     outline;\n-    FT_Int          n_points;\n+    FT_Error        error    = FT_Err_Ok;\n+    FT_GlyphLoader  gloader  = loader->gloader;\n+    FT_Outline*     outline  = &gloader->current.outline;\n+    FT_Int          n_points = outline->n_points;\n@@ -963,3 +898,0 @@\n-    outline  = &gloader->current.outline;\n-    n_points = outline->n_points;\n-\n@@ -967,1 +899,0 @@\n-\n@@ -979,1 +910,1 @@\n-      if ( FT_NEW_ARRAY( unrounded, n_points ) )\n+      if ( FT_QNEW_ARRAY( unrounded, n_points ) )\n@@ -1001,10 +932,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      TT_Face    face   = loader->face;\n-      TT_Driver  driver = (TT_Driver)FT_FACE_DRIVER( face );\n-\n-      FT_String*  family         = face->root.family_name;\n-      FT_UInt     ppem           = loader->size->metrics->x_ppem;\n-      FT_String*  style          = face->root.style_name;\n-      FT_UInt     x_scale_factor = 1000;\n-#endif\n-\n@@ -1020,46 +941,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-\n-      if ( driver->interpreter_version == TT_INTERPRETER_VERSION_38 )\n-      {\n-        \/* scale, but only if enabled and only if TT hinting is being used *\/\n-        if ( IS_HINTED( loader->load_flags ) )\n-          x_scale_factor = sph_test_tweak_x_scaling( face,\n-                                                     family,\n-                                                     ppem,\n-                                                     style,\n-                                                     loader->glyph_index );\n-        \/* scale the glyph *\/\n-        if ( ( loader->load_flags & FT_LOAD_NO_SCALE ) == 0 ||\n-             x_scale_factor != 1000                         )\n-        {\n-          x_scale = FT_MulDiv( loader->size->metrics->x_scale,\n-                               (FT_Long)x_scale_factor, 1000 );\n-          y_scale = loader->size->metrics->y_scale;\n-\n-          \/* compensate for any scaling by de\/emboldening; *\/\n-          \/* the amount was determined via experimentation *\/\n-          if ( x_scale_factor != 1000 && ppem > 11 )\n-          {\n-#ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT\n-            FT_Vector*  orig_points = outline->points;\n-\n-\n-            if ( !IS_DEFAULT_INSTANCE( FT_FACE( loader->face ) ) )\n-              outline->points = unrounded;\n-#endif\n-            FT_Outline_EmboldenXY( outline,\n-                                   FT_MulFix( 1280 * ppem,\n-                                              1000 - x_scale_factor ),\n-                                   0 );\n-#ifdef TT_CONFIG_OPTION_GX_VAR_SUPPORT\n-            if ( !IS_DEFAULT_INSTANCE( FT_FACE( loader->face ) ) )\n-              outline->points = orig_points;\n-#endif\n-          }\n-          do_scale = TRUE;\n-        }\n-      }\n-      else\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -1334,1 +1209,3 @@\n-    FT_Outline*  outline;\n+    FT_Outline*  outline = &loader->gloader->base.outline;\n+    FT_Stream    stream = loader->stream;\n+    FT_UShort    n_ins;\n@@ -1338,2 +1215,0 @@\n-    outline = &loader->gloader->base.outline;\n-\n@@ -1355,3 +1230,3 @@\n-      FT_Stream  stream = loader->stream;\n-      FT_UShort  n_ins, max_ins;\n-      FT_ULong   tmp;\n+      TT_ExecContext  exec = loader->exec;\n+      FT_Memory       memory = exec->memory;\n+\n@@ -1359,0 +1234,3 @@\n+      if ( exec->glyphSize )\n+        FT_FREE( exec->glyphIns );\n+      exec->glyphSize = 0;\n@@ -1368,20 +1246,2 @@\n-      \/* check it *\/\n-      max_ins = loader->face->max_profile.maxSizeOfInstructions;\n-      if ( n_ins > max_ins )\n-      {\n-        \/* don't trust `maxSizeOfInstructions'; *\/\n-        \/* only do a rough safety check         *\/\n-        if ( n_ins > loader->byte_len )\n-        {\n-          FT_TRACE1(( \"TT_Process_Composite_Glyph:\"\n-                      \" too many instructions (%hu) for glyph with length %u\\n\",\n-                      n_ins, loader->byte_len ));\n-          return FT_THROW( Too_Many_Hints );\n-        }\n-\n-        tmp   = loader->exec->glyphSize;\n-        error = Update_Max( loader->exec->memory,\n-                            &tmp,\n-                            sizeof ( FT_Byte ),\n-                            (void*)&loader->exec->glyphIns,\n-                            n_ins );\n+      if ( !n_ins )\n+        return FT_Err_Ok;\n@@ -1389,3 +1249,8 @@\n-        loader->exec->glyphSize = (FT_UShort)tmp;\n-        if ( error )\n-          return error;\n+      \/* don't trust `maxSizeOfInstructions'; *\/\n+      \/* only do a rough safety check         *\/\n+      if ( n_ins > loader->byte_len )\n+      {\n+        FT_TRACE1(( \"TT_Process_Composite_Glyph:\"\n+                    \" too many instructions (%hu) for glyph with length %u\\n\",\n+                    n_ins, loader->byte_len ));\n+        return FT_THROW( Too_Many_Hints );\n@@ -1393,2 +1258,0 @@\n-      else if ( n_ins == 0 )\n-        return FT_Err_Ok;\n@@ -1396,1 +1259,2 @@\n-      if ( FT_STREAM_READ( loader->exec->glyphIns, n_ins ) )\n+      if ( FT_QNEW_ARRAY( exec->glyphIns, n_ins )  ||\n+           FT_STREAM_READ( exec->glyphIns, n_ins ) )\n@@ -1399,2 +1263,1 @@\n-      loader->glyph->control_data = loader->exec->glyphIns;\n-      loader->glyph->control_len  = n_ins;\n+      exec->glyphSize = n_ins;\n@@ -1504,30 +1367,0 @@\n-    FT_Bool  subpixel_hinting = 0;\n-    FT_Bool  grayscale        = 0;\n-    FT_Bool  use_aw_2         = 0;\n-\n-#ifdef TT_CONFIG_OPTION_SUBPIXEL_HINTING\n-    TT_Driver driver = (TT_Driver)FT_FACE_DRIVER( loader->face );\n-#endif\n-\n-\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( driver->interpreter_version == TT_INTERPRETER_VERSION_38 )\n-    {\n-      subpixel_hinting = loader->exec ? loader->exec->subpixel_hinting\n-                                      : 0;\n-      grayscale        = loader->exec ? loader->exec->grayscale\n-                                      : 0;\n-    }\n-#endif\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n-    if ( driver->interpreter_version == TT_INTERPRETER_VERSION_40 )\n-    {\n-      subpixel_hinting = loader->exec ? loader->exec->subpixel_hinting_lean\n-                                      : 0;\n-      grayscale        = loader->exec ? loader->exec->grayscale_cleartype\n-                                      : 0;\n-    }\n-#endif\n-\n-    use_aw_2 = FT_BOOL( subpixel_hinting && grayscale );\n-\n@@ -1539,1 +1372,1 @@\n-    loader->pp3.x = use_aw_2 ? loader->advance \/ 2 : 0;\n+    loader->pp3.x = 0;\n@@ -1541,1 +1374,1 @@\n-    loader->pp4.x = use_aw_2 ? loader->advance \/ 2 : 0;\n+    loader->pp4.x = 0;\n@@ -1543,0 +1376,16 @@\n+\n+#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n+    {\n+      TT_Driver driver = (TT_Driver)FT_FACE_DRIVER( loader->face );\n+\n+\n+      if ( driver->interpreter_version == TT_INTERPRETER_VERSION_40 &&\n+           loader->exec                                             &&\n+           loader->exec->subpixel_hinting_lean                      &&\n+           loader->exec->grayscale_cleartype                        )\n+      {\n+        loader->pp3.x = loader->advance \/ 2;\n+        loader->pp4.x = loader->advance \/ 2;\n+      }\n+    }\n+#endif\n@@ -1665,0 +1514,3 @@\n+    {\n+      FT_ULong  len;\n+\n@@ -1666,1 +1518,4 @@\n-      offset = tt_face_get_location( face, glyph_index, &loader->byte_len );\n+      offset = tt_face_get_location( FT_FACE( face ), glyph_index, &len );\n+\n+      loader->byte_len = (FT_UInt)len;\n+    }\n@@ -1892,4 +1747,1 @@\n-        FT_Outline  outline;\n-        FT_Vector*  points    = NULL;\n-        char*       tags      = NULL;\n-        short*      contours  = NULL;\n+        FT_Outline  outline = { 0, 0, NULL, NULL, NULL, 0 };\n@@ -1903,10 +1755,4 @@\n-        outline.n_contours = outline.n_points = limit;\n-\n-        outline.points   = NULL;\n-        outline.tags     = NULL;\n-        outline.contours = NULL;\n-\n-        if ( FT_NEW_ARRAY( points, limit + 4 )    ||\n-             FT_NEW_ARRAY( tags, limit + 4 )      ||\n-             FT_NEW_ARRAY( contours, limit + 4 )  ||\n-             FT_NEW_ARRAY( unrounded, limit + 4 ) )\n+        if ( FT_QNEW_ARRAY( outline.points, limit + 4 ) ||\n+             FT_QNEW_ARRAY( outline.tags, limit )       ||\n+             FT_QNEW_ARRAY( outline.contours, limit )   ||\n+             FT_QNEW_ARRAY( unrounded, limit + 4 )      )\n@@ -1915,0 +1761,2 @@\n+        outline.n_contours = outline.n_points = limit;\n+\n@@ -1922,4 +1770,4 @@\n-          points[i].x = subglyph->arg1;\n-          points[i].y = subglyph->arg2;\n-          tags[i]     = 1;\n-          contours[i] = i;\n+          outline.points[i].x = subglyph->arg1;\n+          outline.points[i].y = subglyph->arg2;\n+          outline.tags[i]     = ON_CURVE_POINT;\n+          outline.contours[i] = i;\n@@ -1928,8 +1776,4 @@\n-        points[i++] = loader->pp1;\n-        points[i++] = loader->pp2;\n-        points[i++] = loader->pp3;\n-        points[i  ] = loader->pp4;\n-\n-        outline.points   = points;\n-        outline.tags     = tags;\n-        outline.contours = contours;\n+        outline.points[i++] = loader->pp1;\n+        outline.points[i++] = loader->pp2;\n+        outline.points[i++] = loader->pp3;\n+        outline.points[i  ] = loader->pp4;\n@@ -1950,2 +1794,2 @@\n-            subglyph->arg1 = (FT_Int16)points[i].x;\n-            subglyph->arg2 = (FT_Int16)points[i].y;\n+            subglyph->arg1 = (FT_Int16)outline.points[i].x;\n+            subglyph->arg2 = (FT_Int16)outline.points[i].y;\n@@ -2335,2 +2179,1 @@\n-#if defined TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY || \\\n-    defined TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n+#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n@@ -2356,14 +2199,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      FT_Bool  subpixel_hinting = FALSE;\n-\n-#if 0\n-      \/* not used yet *\/\n-      FT_Bool  compatible_widths;\n-      FT_Bool  symmetrical_smoothing;\n-      FT_Bool  bgr;\n-      FT_Bool  vertical_lcd;\n-      FT_Bool  subpixel_positioned;\n-      FT_Bool  gray_cleartype;\n-#endif\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -2389,0 +2218,3 @@\n+      grayscale = FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n+                             FT_RENDER_MODE_MONO             );\n+\n@@ -2405,0 +2237,1 @@\n+        grayscale = FT_BOOL( grayscale && !subpixel_hinting_lean );\n@@ -2414,69 +2247,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-\n-      if ( driver->interpreter_version == TT_INTERPRETER_VERSION_38 )\n-      {\n-        subpixel_hinting = FT_BOOL( ( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                                      FT_RENDER_MODE_MONO               )  &&\n-                                    SPH_OPTION_SET_SUBPIXEL                );\n-\n-        if ( subpixel_hinting )\n-          grayscale = FALSE;\n-        else if ( SPH_OPTION_SET_GRAYSCALE )\n-        {\n-          grayscale        = TRUE;\n-          subpixel_hinting = FALSE;\n-        }\n-        else\n-          grayscale = FALSE;\n-\n-        if ( FT_IS_TRICKY( glyph->face ) )\n-          subpixel_hinting = FALSE;\n-\n-        exec->ignore_x_mode      = subpixel_hinting || grayscale;\n-        exec->rasterizer_version = SPH_OPTION_SET_RASTERIZER_VERSION;\n-        if ( exec->sph_tweak_flags & SPH_TWEAK_RASTERIZER_35 )\n-          exec->rasterizer_version = TT_INTERPRETER_VERSION_35;\n-\n-#if 1\n-        exec->compatible_widths     = SPH_OPTION_SET_COMPATIBLE_WIDTHS;\n-        exec->symmetrical_smoothing = TRUE;\n-        exec->bgr                   = FALSE;\n-        exec->vertical_lcd          = FALSE;\n-        exec->subpixel_positioned   = TRUE;\n-        exec->gray_cleartype        = FALSE;\n-#else \/* 0 *\/\n-        exec->compatible_widths =\n-          FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                   TT_LOAD_COMPATIBLE_WIDTHS );\n-        exec->symmetrical_smoothing =\n-          FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                   TT_LOAD_SYMMETRICAL_SMOOTHING );\n-        exec->bgr =\n-          FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                   TT_LOAD_BGR );\n-        exec->vertical_lcd =\n-          FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                   TT_LOAD_VERTICAL_LCD );\n-        exec->subpixel_positioned =\n-          FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                   TT_LOAD_SUBPIXEL_POSITIONED );\n-        exec->gray_cleartype =\n-          FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                   TT_LOAD_GRAY_CLEARTYPE );\n-#endif \/* 0 *\/\n-\n-      }\n-      else\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n-      if ( driver->interpreter_version == TT_INTERPRETER_VERSION_40 )\n-        grayscale = FT_BOOL( !subpixel_hinting_lean               &&\n-                             FT_LOAD_TARGET_MODE( load_flags ) !=\n-                               FT_RENDER_MODE_MONO                );\n-      else\n-#endif\n-        grayscale = FT_BOOL( FT_LOAD_TARGET_MODE( load_flags ) !=\n-                               FT_RENDER_MODE_MONO             );\n-\n@@ -2487,30 +2251,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-\n-      if ( driver->interpreter_version == TT_INTERPRETER_VERSION_38 )\n-      {\n-        \/* a change from mono to subpixel rendering (and vice versa) *\/\n-        \/* requires a re-execution of the CVT program                *\/\n-        if ( subpixel_hinting != exec->subpixel_hinting )\n-        {\n-          FT_TRACE4(( \"tt_loader_init: subpixel hinting change,\"\n-                      \" re-executing `prep' table\\n\" ));\n-\n-          exec->subpixel_hinting = subpixel_hinting;\n-          reexecute              = TRUE;\n-        }\n-\n-        \/* a change from mono to grayscale rendering (and vice versa) *\/\n-        \/* requires a re-execution of the CVT program                 *\/\n-        if ( grayscale != exec->grayscale )\n-        {\n-          FT_TRACE4(( \"tt_loader_init: grayscale hinting change,\"\n-                      \" re-executing `prep' table\\n\" ));\n-\n-          exec->grayscale = grayscale;\n-          reexecute       = TRUE;\n-        }\n-      }\n-      else\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -2518,1 +2252,0 @@\n-\n@@ -2576,8 +2309,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      \/* check whether we have a font hinted for ClearType --           *\/\n-      \/* note that this flag can also be modified in a glyph's bytecode *\/\n-      if ( driver->interpreter_version == TT_INTERPRETER_VERSION_38 &&\n-           exec->GS.instruct_control & 4                            )\n-        exec->ignore_x_mode = FALSE;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -2619,7 +2344,0 @@\n-#endif\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-           !( driver->interpreter_version == TT_INTERPRETER_VERSION_38  &&\n-              !SPH_OPTION_BITMAP_WIDTHS                                 &&\n-              FT_LOAD_TARGET_MODE( loader->load_flags ) !=\n-                                                   FT_RENDER_MODE_MONO  &&\n-              exec->compatible_widths                                   ) &&\n@@ -2860,1 +2578,3 @@\n-    if ( ( load_flags & FT_LOAD_COLOR ) && face->svg )\n+    if ( ( load_flags & FT_LOAD_NO_SVG ) == 0 &&\n+         ( load_flags & FT_LOAD_COLOR )       &&\n+         face->svg                            )\n@@ -2958,0 +2678,3 @@\n+        glyph->control_data = loader.exec->glyphIns;\n+        glyph->control_len  = loader.exec->glyphSize;\n+\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttgload.c","additions":141,"deletions":418,"binary":false,"changes":559,"status":"modified"},{"patch":"@@ -48,0 +48,1 @@\n+#include <freetype\/internal\/services\/svmetric.h>\n@@ -468,1 +469,1 @@\n-                face,\n+                FT_FACE( face ),\n@@ -478,1 +479,1 @@\n-                face,\n+                FT_FACE( face ),\n@@ -495,1 +496,1 @@\n-  tt_var_load_item_variation_store( TT_Face          face,\n+  tt_var_load_item_variation_store( FT_Face          face,      \/* TT_Face *\/\n@@ -499,0 +500,1 @@\n+    TT_Face    ttface = (TT_Face)face;\n@@ -510,1 +512,1 @@\n-    FT_UInt  i, j, k;\n+    FT_UInt  i, j;\n@@ -513,1 +515,1 @@\n-    GX_Blend   blend           = face->blend;\n+    GX_Blend   blend           = ttface->blend;\n@@ -622,3 +624,4 @@\n-      FT_UInt  item_count;\n-      FT_UInt  word_delta_count;\n-      FT_UInt  region_idx_count;\n+      FT_UInt    item_count;\n+      FT_UShort  word_delta_count;\n+      FT_UInt    region_idx_count;\n+      FT_UInt    per_region_size;\n@@ -661,0 +664,2 @@\n+      varData->wordDeltaCount = word_delta_count;\n+      varData->longWords      = long_words;\n@@ -676,9 +681,3 @@\n-      \/* Parse delta set.                                                  *\/\n-      \/*                                                                   *\/\n-      \/* On input, deltas are (word_delta_count + region_idx_count) bytes  *\/\n-      \/* each if `long_words` isn't set, and twice as much otherwise.      *\/\n-      \/*                                                                   *\/\n-      \/* On output, deltas are expanded to `region_idx_count` shorts each. *\/\n-      if ( FT_NEW_ARRAY( varData->deltaSet, item_count * region_idx_count ) )\n-        goto Exit;\n-      varData->itemCount = item_count;\n+      per_region_size = word_delta_count + region_idx_count;\n+      if ( long_words )\n+        per_region_size *= 2;\n@@ -686,1 +685,5 @@\n-      for ( j = 0; j < item_count * region_idx_count; )\n+      if ( FT_NEW_ARRAY( varData->deltaSet, per_region_size * item_count ) )\n+        goto Exit;\n+      if ( FT_Stream_Read( stream,\n+                           varData->deltaSet,\n+                           per_region_size * item_count ) )\n@@ -688,18 +691,3 @@\n-        if ( long_words )\n-        {\n-          for ( k = 0; k < word_delta_count; k++, j++ )\n-            if ( FT_READ_LONG( varData->deltaSet[j] ) )\n-              goto Exit;\n-          for ( ; k < region_idx_count; k++, j++ )\n-            if ( FT_READ_SHORT( varData->deltaSet[j] ) )\n-              goto Exit;\n-        }\n-        else\n-        {\n-          for ( k = 0; k < word_delta_count; k++, j++ )\n-            if ( FT_READ_SHORT( varData->deltaSet[j] ) )\n-              goto Exit;\n-          for ( ; k < region_idx_count; k++, j++ )\n-            if ( FT_READ_CHAR( varData->deltaSet[j] ) )\n-              goto Exit;\n-        }\n+        FT_TRACE2(( \"deltaSet read failed.\" ));\n+        error = FT_THROW( Invalid_Table );\n+        goto Exit;\n@@ -707,0 +695,2 @@\n+\n+      varData->itemCount = item_count;\n@@ -717,1 +707,1 @@\n-  tt_var_load_delta_set_index_mapping( TT_Face            face,\n+  tt_var_load_delta_set_index_mapping( FT_Face            face, \/* TT_Face *\/\n@@ -944,1 +934,1 @@\n-              face,\n+              FT_FACE( face ),\n@@ -953,1 +943,1 @@\n-                face,\n+                FT_FACE( face ),\n@@ -995,1 +985,1 @@\n-  tt_var_get_item_delta( TT_Face          face,\n+  tt_var_get_item_delta( FT_Face          face,        \/* TT_Face *\/\n@@ -1000,0 +990,1 @@\n+    TT_Face    ttface = (TT_Face)face;\n@@ -1005,1 +996,5 @@\n-    FT_ItemVarDelta*  deltaSet;\n+    FT_ItemVarDelta*  deltaSet = NULL;\n+    FT_ItemVarDelta   deltaSetStack[16];\n+\n+    FT_Fixed*  scalars = NULL;\n+    FT_Fixed   scalarsStack[16];\n@@ -1008,2 +1003,3 @@\n-    FT_Fixed*        scalars = NULL;\n-    FT_ItemVarDelta  returnValue;\n+    FT_ItemVarDelta  returnValue = 0;\n+    FT_UInt          per_region_size;\n+    FT_Byte*         bytes;\n@@ -1012,1 +1008,1 @@\n-    if ( !face->blend || !face->blend->normalizedcoords )\n+    if ( !ttface->blend || !ttface->blend->normalizedcoords )\n@@ -1026,3 +1022,1 @@\n-    varData  = &itemStore->varData[outerIndex];\n-    deltaSet = FT_OFFSET( varData->deltaSet,\n-                          varData->regionIdxCount * innerIndex );\n+    varData = &itemStore->varData[outerIndex];\n@@ -1033,2 +1027,37 @@\n-    if ( FT_QNEW_ARRAY( scalars, varData->regionIdxCount ) )\n-      return 0;\n+    if ( varData->regionIdxCount < 16 )\n+    {\n+      deltaSet = deltaSetStack;\n+      scalars  = scalarsStack;\n+    }\n+    else\n+    {\n+      if ( FT_QNEW_ARRAY( deltaSet, varData->regionIdxCount ) )\n+        goto Exit;\n+      if ( FT_QNEW_ARRAY( scalars, varData->regionIdxCount ) )\n+        goto Exit;\n+    }\n+\n+    \/* Parse delta set.                                            *\/\n+    \/*                                                             *\/\n+    \/* Deltas are (word_delta_count + region_idx_count) bytes each *\/\n+    \/* if `longWords` isn't set, and twice as much otherwise.      *\/\n+    per_region_size = varData->wordDeltaCount + varData->regionIdxCount;\n+    if ( varData->longWords )\n+      per_region_size *= 2;\n+\n+    bytes = varData->deltaSet + per_region_size * innerIndex;\n+\n+    if ( varData->longWords )\n+    {\n+      for ( master = 0; master < varData->wordDeltaCount; master++ )\n+        deltaSet[master] = FT_NEXT_LONG( bytes );\n+      for ( ; master < varData->regionIdxCount; master++ )\n+        deltaSet[master] = FT_NEXT_SHORT( bytes );\n+    }\n+    else\n+    {\n+      for ( master = 0; master < varData->wordDeltaCount; master++ )\n+        deltaSet[master] = FT_NEXT_SHORT( bytes );\n+      for ( ; master < varData->regionIdxCount; master++ )\n+        deltaSet[master] = FT_NEXT_CHAR( bytes );\n+    }\n@@ -1063,1 +1092,1 @@\n-        else if ( face->blend->normalizedcoords[j] == axis->peakCoord )\n+        else if ( ttface->blend->normalizedcoords[j] == axis->peakCoord )\n@@ -1067,2 +1096,2 @@\n-        else if ( face->blend->normalizedcoords[j] <= axis->startCoord ||\n-                  face->blend->normalizedcoords[j] >= axis->endCoord   )\n+        else if ( ttface->blend->normalizedcoords[j] <= axis->startCoord ||\n+                  ttface->blend->normalizedcoords[j] >= axis->endCoord   )\n@@ -1075,1 +1104,1 @@\n-        else if ( face->blend->normalizedcoords[j] < axis->peakCoord )\n+        else if ( ttface->blend->normalizedcoords[j] < axis->peakCoord )\n@@ -1078,1 +1107,1 @@\n-                       face->blend->normalizedcoords[j] - axis->startCoord,\n+                       ttface->blend->normalizedcoords[j] - axis->startCoord,\n@@ -1083,1 +1112,1 @@\n-                       axis->endCoord - face->blend->normalizedcoords[j],\n+                       axis->endCoord - ttface->blend->normalizedcoords[j],\n@@ -1109,1 +1138,5 @@\n-    FT_FREE( scalars );\n+  Exit:\n+    if ( scalars != scalarsStack )\n+      FT_FREE( scalars );\n+    if ( deltaSet != deltaSetStack )\n+      FT_FREE( deltaSet );\n@@ -1209,1 +1242,1 @@\n-    delta = tt_var_get_item_delta( face,\n+    delta = tt_var_get_item_delta( FT_FACE( face ),\n@@ -1232,1 +1265,1 @@\n-  tt_hadvance_adjust( TT_Face  face,\n+  tt_hadvance_adjust( FT_Face  face,    \/* TT_Face *\/\n@@ -1236,1 +1269,1 @@\n-    return tt_hvadvance_adjust( face, gindex, avalue, 0 );\n+    return tt_hvadvance_adjust( (TT_Face)face, gindex, avalue, 0 );\n@@ -1241,1 +1274,1 @@\n-  tt_vadvance_adjust( TT_Face  face,\n+  tt_vadvance_adjust( FT_Face  face,    \/* TT_Face *\/\n@@ -1245,1 +1278,1 @@\n-    return tt_hvadvance_adjust( face, gindex, avalue, 1 );\n+    return tt_hvadvance_adjust( (TT_Face)face, gindex, avalue, 1 );\n@@ -1392,1 +1425,1 @@\n-              face,\n+              FT_FACE( face ),\n@@ -1465,1 +1498,1 @@\n-  tt_size_reset_iterator( FT_ListNode  node,\n+  ft_size_reset_iterator( FT_ListNode  node,\n@@ -1468,3 +1501,2 @@\n-    TT_Size  size = (TT_Size)node->data;\n-\n-    FT_UNUSED( user );\n+    FT_Size                       size = (FT_Size)node->data;\n+    FT_Service_MetricsVariations  var  = (FT_Service_MetricsVariations)user;\n@@ -1473,1 +1505,1 @@\n-    tt_size_reset( size, 1 );\n+    var->size_reset( size );\n@@ -1492,1 +1524,1 @@\n-  tt_apply_mvar( TT_Face  face )\n+  tt_apply_mvar( FT_Face  face )  \/* TT_Face *\/\n@@ -1494,1 +1526,3 @@\n-    GX_Blend  blend = face->blend;\n+    TT_Face  ttface = (TT_Face)face;\n+\n+    GX_Blend  blend = ttface->blend;\n@@ -1496,0 +1530,1 @@\n+\n@@ -1501,1 +1536,1 @@\n-    if ( !( face->variation_support & TT_FACE_FLAG_VAR_MVAR ) )\n+    if ( !( ttface->variation_support & TT_FACE_FLAG_VAR_MVAR ) )\n@@ -1509,1 +1544,1 @@\n-      FT_Short*  p = ft_var_get_value_pointer( face, value->tag );\n+      FT_Short*  p = ft_var_get_value_pointer( ttface, value->tag );\n@@ -1546,1 +1581,2 @@\n-      FT_Face  root = &face->root;\n+      FT_Service_MetricsVariations  var =\n+        (FT_Service_MetricsVariations)ttface->face_var;\n@@ -1574,2 +1610,2 @@\n-      FT_Short  current_line_gap = root->height - root->ascender +\n-                                   root->descender;\n+      FT_Short  current_line_gap = face->height - face->ascender +\n+                                   face->descender;\n@@ -1578,3 +1614,3 @@\n-      root->ascender  = root->ascender + mvar_hasc_delta;\n-      root->descender = root->descender + mvar_hdsc_delta;\n-      root->height    = root->ascender - root->descender +\n+      face->ascender  = face->ascender + mvar_hasc_delta;\n+      face->descender = face->descender + mvar_hdsc_delta;\n+      face->height    = face->ascender - face->descender +\n@@ -1583,3 +1619,3 @@\n-      root->underline_position  = face->postscript.underlinePosition -\n-                                  face->postscript.underlineThickness \/ 2;\n-      root->underline_thickness = face->postscript.underlineThickness;\n+      face->underline_position  = ttface->postscript.underlinePosition -\n+                                  ttface->postscript.underlineThickness \/ 2;\n+      face->underline_thickness = ttface->postscript.underlineThickness;\n@@ -1587,5 +1623,6 @@\n-      \/* iterate over all FT_Size objects and call `tt_size_reset' *\/\n-      \/* to propagate the metrics changes                          *\/\n-      FT_List_Iterate( &root->sizes_list,\n-                       tt_size_reset_iterator,\n-                       NULL );\n+      \/* iterate over all FT_Size objects and call `var->size_reset' *\/\n+      \/* to propagate the metrics changes                            *\/\n+      if ( var && var->size_reset )\n+        FT_List_Iterate( &face->sizes_list,\n+                         ft_size_reset_iterator,\n+                         (void*)var );\n@@ -2102,1 +2139,1 @@\n-          delta = tt_var_get_item_delta( face,\n+          delta = tt_var_get_item_delta( FT_FACE( face ),\n@@ -2264,1 +2301,1 @@\n-  TT_Get_MM_Var( TT_Face      face,\n+  TT_Get_MM_Var( FT_Face      face,    \/* TT_Face *\/\n@@ -2267,2 +2304,3 @@\n-    FT_Stream            stream     = face->root.stream;\n-    FT_Memory            memory     = face->root.memory;\n+    TT_Face              ttface     = (TT_Face)face;\n+    FT_Stream            stream     = FT_FACE_STREAM( face );\n+    FT_Memory            memory     = FT_FACE_MEMORY( face );\n@@ -2332,1 +2370,1 @@\n-    num_instances = (FT_UInt)face->root.style_flags >> 16;\n+    num_instances = (FT_UInt)face->style_flags >> 16;\n@@ -2337,1 +2375,1 @@\n-    need_init = !face->blend;\n+    need_init = !ttface->blend;\n@@ -2343,2 +2381,2 @@\n-      if ( FT_SET_ERROR( face->goto_table( face, TTAG_fvar,\n-                                           stream, &table_len ) ) )\n+      if ( FT_SET_ERROR( ttface->goto_table( ttface, TTAG_fvar,\n+                                             stream, &table_len ) ) )\n@@ -2377,1 +2415,1 @@\n-      if ( FT_NEW( face->blend ) )\n+      if ( FT_NEW( ttface->blend ) )\n@@ -2380,2 +2418,2 @@\n-      num_axes              = fvar_head.axisCount;\n-      face->blend->num_axis = num_axes;\n+      num_axes                = fvar_head.axisCount;\n+      ttface->blend->num_axis = num_axes;\n@@ -2384,1 +2422,1 @@\n-      num_axes = face->blend->num_axis;\n+      num_axes = ttface->blend->num_axis;\n@@ -2413,8 +2451,8 @@\n-      face->blend->mmvar_len = mmvar_size       +\n-                               axis_flags_size  +\n-                               axis_size        +\n-                               namedstyle_size  +\n-                               next_coords_size +\n-                               next_name_size;\n-\n-      if ( FT_ALLOC( mmvar, face->blend->mmvar_len ) )\n+      ttface->blend->mmvar_len = mmvar_size       +\n+                                 axis_flags_size  +\n+                                 axis_size        +\n+                                 namedstyle_size  +\n+                                 next_coords_size +\n+                                 next_name_size;\n+\n+      if ( FT_ALLOC( mmvar, ttface->blend->mmvar_len ) )\n@@ -2422,1 +2460,1 @@\n-      face->blend->mmvar = mmvar;\n+      ttface->blend->mmvar = mmvar;\n@@ -2528,1 +2566,1 @@\n-      if ( FT_NEW_ARRAY( face->blend->normalized_stylecoords,\n+      if ( FT_NEW_ARRAY( ttface->blend->normalized_stylecoords,\n@@ -2532,1 +2570,1 @@\n-      if ( fvar_head.instanceCount && !face->blend->avar_loaded )\n+      if ( fvar_head.instanceCount && !ttface->blend->avar_loaded )\n@@ -2537,1 +2575,1 @@\n-        ft_var_load_avar( face );\n+        ft_var_load_avar( ttface );\n@@ -2543,1 +2581,1 @@\n-      FT_TRACE5(( \"%d instance%s\\n\",\n+      FT_TRACE5(( \"%d named instance%s\\n\",\n@@ -2548,1 +2586,1 @@\n-      nsc = face->blend->normalized_stylecoords;\n+      nsc = ttface->blend->normalized_stylecoords;\n@@ -2571,1 +2609,1 @@\n-          SFNT_Service  sfnt = (SFNT_Service)face->sfnt;\n+          SFNT_Service  sfnt = (SFNT_Service)ttface->sfnt;\n@@ -2583,1 +2621,1 @@\n-            (void)sfnt->get_name( face,\n+            (void)sfnt->get_name( ttface,\n@@ -2592,1 +2630,1 @@\n-            (void)sfnt->get_name( face,\n+            (void)sfnt->get_name( ttface,\n@@ -2601,1 +2639,1 @@\n-          FT_TRACE5(( \"  instance %d (%s%s%s, %s%s%s)\\n\",\n+          FT_TRACE5(( \"  named instance %d (%s%s%s, %s%s%s)\\n\",\n@@ -2615,1 +2653,1 @@\n-        ft_var_to_normalized( face, num_axes, ns->coords, nsc );\n+        ft_var_to_normalized( ttface, num_axes, ns->coords, nsc );\n@@ -2623,1 +2661,1 @@\n-        SFNT_Service  sfnt = (SFNT_Service)face->sfnt;\n+        SFNT_Service  sfnt = (SFNT_Service)ttface->sfnt;\n@@ -2629,3 +2667,5 @@\n-        \/* the default instance is missing in array the   *\/\n-        \/* of named instances; try to synthesize an entry *\/\n-        found = sfnt->get_name_id( face,\n+        \/* The default instance is missing in array the    *\/\n+        \/* of named instances; try to synthesize an entry. *\/\n+        \/* If this fails, `default_named_instance` remains *\/\n+        \/* at value zero, which doesn't do any harm.       *\/\n+        found = sfnt->get_name_id( ttface,\n@@ -2639,1 +2679,1 @@\n-          found = sfnt->get_name_id( face,\n+          found = sfnt->get_name_id( ttface,\n@@ -2649,1 +2689,1 @@\n-          found = sfnt->get_name_id( face,\n+          found = sfnt->get_name_id( ttface,\n@@ -2658,0 +2698,3 @@\n+            \/* named instance indices start with value 1 *\/\n+            ttface->var_default_named_instance = num_instances;\n+\n@@ -2671,1 +2714,1 @@\n-      ft_var_load_mvar( face );\n+      ft_var_load_mvar( ttface );\n@@ -2681,1 +2724,1 @@\n-      if ( FT_ALLOC( mmvar, face->blend->mmvar_len ) )\n+      if ( FT_ALLOC( mmvar, ttface->blend->mmvar_len ) )\n@@ -2683,1 +2726,1 @@\n-      FT_MEM_COPY( mmvar, face->blend->mmvar, face->blend->mmvar_len );\n+      FT_MEM_COPY( mmvar, ttface->blend->mmvar, ttface->blend->mmvar_len );\n@@ -2759,1 +2802,1 @@\n-      if ( FT_SET_ERROR( TT_Get_MM_Var( face, NULL ) ) )\n+      if ( FT_SET_ERROR( TT_Get_MM_Var( FT_FACE( face ), NULL ) ) )\n@@ -2844,1 +2887,1 @@\n-      if ( FT_IS_NAMED_INSTANCE( FT_FACE( face ) ) )\n+      if ( !have_diff )\n@@ -2846,1 +2889,3 @@\n-        FT_UInt  instance_index = (FT_UInt)face->root.face_index >> 16;\n+        if ( FT_IS_NAMED_INSTANCE( FT_FACE( face ) ) )\n+        {\n+          FT_UInt  instance_index = (FT_UInt)face->root.face_index >> 16;\n@@ -2849,4 +2894,4 @@\n-        c = blend->normalizedcoords + i;\n-        n = blend->normalized_stylecoords            +\n-            ( instance_index - 1 ) * mmvar->num_axis +\n-            i;\n+          c = blend->normalizedcoords + i;\n+          n = blend->normalized_stylecoords            +\n+              ( instance_index - 1 ) * mmvar->num_axis +\n+              i;\n@@ -2854,10 +2899,11 @@\n-        for ( j = i; j < mmvar->num_axis; j++, n++, c++ )\n-          if ( *c != *n )\n-            have_diff = 1;\n-      }\n-      else\n-      {\n-        c = blend->normalizedcoords + i;\n-        for ( j = i; j < mmvar->num_axis; j++, c++ )\n-          if ( *c != 0 )\n-            have_diff = 1;\n+          for ( j = i; j < mmvar->num_axis; j++, n++, c++ )\n+            if ( *c != *n )\n+              have_diff = 1;\n+        }\n+        else\n+        {\n+          c = blend->normalizedcoords + i;\n+          for ( j = i; j < mmvar->num_axis; j++, c++ )\n+            if ( *c != 0 )\n+              have_diff = 1;\n+        }\n@@ -2927,3 +2973,0 @@\n-    \/* enforce recomputation of the PostScript name; *\/\n-    FT_FREE( face->postscript_name );\n-\n@@ -2961,1 +3004,2 @@\n-   *   FreeType error code.  0 means success.\n+   *   FreeType error code.  0 means success, -1 means success and unchanged\n+   *   axis values.\n@@ -2964,1 +3008,1 @@\n-  TT_Set_MM_Blend( TT_Face    face,\n+  TT_Set_MM_Blend( FT_Face    face,       \/* TT_Face *\/\n@@ -2968,13 +3012,1 @@\n-    FT_Error  error;\n-\n-\n-    error = tt_set_mm_blend( face, num_coords, coords, 1 );\n-    if ( error )\n-      return error;\n-\n-    if ( num_coords )\n-      face->root.face_flags |= FT_FACE_FLAG_VARIATION;\n-    else\n-      face->root.face_flags &= ~FT_FACE_FLAG_VARIATION;\n-\n-    return FT_Err_Ok;\n+    return tt_set_mm_blend( (TT_Face)face, num_coords, coords, 1 );\n@@ -3008,1 +3040,2 @@\n-   *   FreeType error code.  0 means success.\n+   *   FreeType error code.  0 means success, -1 means success and unchanged\n+   *   axis values.\n@@ -3011,1 +3044,1 @@\n-  TT_Get_MM_Blend( TT_Face    face,\n+  TT_Get_MM_Blend( FT_Face    face,       \/* TT_Face *\/\n@@ -3015,0 +3048,2 @@\n+    TT_Face  ttface = (TT_Face)face;\n+\n@@ -3020,1 +3055,1 @@\n-    if ( !face->blend )\n+    if ( !ttface->blend )\n@@ -3026,1 +3061,1 @@\n-    blend = face->blend;\n+    blend = ttface->blend;\n@@ -3032,1 +3067,1 @@\n-      if ( FT_SET_ERROR( tt_set_mm_blend( face, 0, NULL, 1 ) ) )\n+      if ( FT_SET_ERROR( tt_set_mm_blend( ttface, 0, NULL, 1 ) ) )\n@@ -3045,1 +3080,1 @@\n-    if ( face->doblend )\n+    if ( ttface->doblend )\n@@ -3092,1 +3127,1 @@\n-  TT_Set_Var_Design( TT_Face    face,\n+  TT_Set_Var_Design( FT_Face    face,       \/* TT_Face *\/\n@@ -3096,0 +3131,1 @@\n+    TT_Face     ttface = (TT_Face)face;\n@@ -3100,1 +3136,1 @@\n-    FT_Memory   memory = face->root.memory;\n+    FT_Memory   memory = FT_FACE_MEMORY( face );\n@@ -3109,1 +3145,1 @@\n-    if ( !face->blend )\n+    if ( !ttface->blend )\n@@ -3115,1 +3151,1 @@\n-    blend = face->blend;\n+    blend = ttface->blend;\n@@ -3143,1 +3179,1 @@\n-    if ( FT_IS_NAMED_INSTANCE( FT_FACE( face ) ) )\n+    if ( FT_IS_NAMED_INSTANCE( face ) )\n@@ -3149,1 +3185,1 @@\n-      instance_index = (FT_UInt)face->root.face_index >> 16;\n+      instance_index = (FT_UInt)face->face_index >> 16;\n@@ -3186,2 +3222,2 @@\n-    if ( !face->blend->avar_loaded )\n-      ft_var_load_avar( face );\n+    if ( !ttface->blend->avar_loaded )\n+      ft_var_load_avar( ttface );\n@@ -3191,1 +3227,1 @@\n-    ft_var_to_normalized( face, num_coords, blend->coords, normalized );\n+    ft_var_to_normalized( ttface, num_coords, blend->coords, normalized );\n@@ -3193,1 +3229,1 @@\n-    error = tt_set_mm_blend( face, mmvar->num_axis, normalized, 0 );\n+    error = tt_set_mm_blend( ttface, mmvar->num_axis, normalized, 0 );\n@@ -3197,5 +3233,0 @@\n-    if ( num_coords )\n-      face->root.face_flags |= FT_FACE_FLAG_VARIATION;\n-    else\n-      face->root.face_flags &= ~FT_FACE_FLAG_VARIATION;\n-\n@@ -3234,1 +3265,1 @@\n-  TT_Get_Var_Design( TT_Face    face,\n+  TT_Get_Var_Design( FT_Face    face,       \/* TT_Face *\/\n@@ -3238,1 +3269,2 @@\n-    FT_Error  error = FT_Err_Ok;\n+    TT_Face   ttface = (TT_Face)face;\n+    FT_Error  error  = FT_Err_Ok;\n@@ -3243,1 +3275,1 @@\n-    if ( !face->blend )\n+    if ( !ttface->blend )\n@@ -3249,1 +3281,1 @@\n-    blend = face->blend;\n+    blend = ttface->blend;\n@@ -3255,1 +3287,1 @@\n-      if ( FT_SET_ERROR( tt_set_mm_blend( face, 0, NULL, 1 ) ) )\n+      if ( FT_SET_ERROR( tt_set_mm_blend( ttface, 0, NULL, 1 ) ) )\n@@ -3268,1 +3300,1 @@\n-    if ( face->doblend )\n+    if ( ttface->doblend )\n@@ -3304,1 +3336,2 @@\n-   *   FreeType error code.  0~means success.\n+   *   FreeType error code.  0~means success, -1 means success and unchanged\n+   *   axis values.\n@@ -3307,1 +3340,1 @@\n-  TT_Set_Named_Instance( TT_Face  face,\n+  TT_Set_Named_Instance( FT_Face  face,            \/* TT_Face *\/\n@@ -3310,0 +3343,1 @@\n+    TT_Face     ttface = (TT_Face)face;\n@@ -3314,0 +3348,2 @@\n+    FT_Memory  memory = FT_FACE_MEMORY( face );\n+\n@@ -3317,1 +3353,1 @@\n-    if ( !face->blend )\n+    if ( !ttface->blend )\n@@ -3323,1 +3359,1 @@\n-    blend = face->blend;\n+    blend = ttface->blend;\n@@ -3326,1 +3362,1 @@\n-    num_instances = (FT_UInt)face->root.style_flags >> 16;\n+    num_instances = (FT_UInt)face->style_flags >> 16;\n@@ -3337,2 +3373,1 @@\n-      FT_Memory     memory = face->root.memory;\n-      SFNT_Service  sfnt   = (SFNT_Service)face->sfnt;\n+      SFNT_Service  sfnt = (SFNT_Service)ttface->sfnt;\n@@ -3346,1 +3381,1 @@\n-      error = sfnt->get_name( face,\n+      error = sfnt->get_name( ttface,\n@@ -3353,2 +3388,2 @@\n-      FT_FREE( face->root.style_name );\n-      face->root.style_name = style_name;\n+      FT_FREE( face->style_name );\n+      face->style_name = style_name;\n@@ -3360,7 +3395,0 @@\n-      if ( error )\n-      {\n-        \/* internal error code -1 means `no change' *\/\n-        if ( error == -1 )\n-          error = FT_Err_Ok;\n-        goto Exit;\n-      }\n@@ -3369,0 +3397,5 @@\n+    {\n+      \/* restore non-VF style name *\/\n+      FT_FREE( face->style_name );\n+      if ( FT_STRDUP( face->style_name, ttface->non_var_style_name ) )\n+        goto Exit;\n@@ -3370,0 +3403,32 @@\n+    }\n+\n+  Exit:\n+    return error;\n+  }\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @Function:\n+   *   TT_Get_Default_Named_Instance\n+   *\n+   * @Description:\n+   *   Get the default named instance.\n+   *\n+   * @Input:\n+   *   face ::\n+   *     A handle to the source face.\n+   *\n+   * @Output:\n+   *   instance_index ::\n+   *     The default named instance index.\n+   *\n+   * @Return:\n+   *   FreeType error code.  0~means success.\n+   *\/\n+  FT_LOCAL_DEF( FT_Error )\n+  TT_Get_Default_Named_Instance( FT_Face   face,\n+                                 FT_UInt  *instance_index )\n+  {\n+    TT_Face   ttface = (TT_Face)face;\n+    FT_Error  error  = FT_Err_Ok;\n@@ -3371,3 +3436,8 @@\n-    face->root.face_index  = ( instance_index << 16 )             |\n-                             ( face->root.face_index & 0xFFFFL );\n-    face->root.face_flags &= ~FT_FACE_FLAG_VARIATION;\n+\n+    if ( !ttface->blend )\n+    {\n+      if ( FT_SET_ERROR( TT_Get_MM_Var( face, NULL ) ) )\n+        goto Exit;\n+    }\n+\n+    *instance_index = ttface->var_default_named_instance;\n@@ -3380,0 +3450,14 @@\n+  \/* This function triggers (lazy) recomputation of the `postscript_name` *\/\n+  \/* field in `TT_Face`.                                                  *\/\n+\n+  FT_LOCAL_DEF( void )\n+  tt_construct_ps_name( FT_Face  face )\n+  {\n+    TT_Face    ttface = (TT_Face)face;\n+    FT_Memory  memory = FT_FACE_MEMORY( face );\n+\n+\n+    FT_FREE( ttface->postscript_name );\n+  }\n+\n+\n@@ -4412,1 +4496,1 @@\n-  tt_get_var_blend( TT_Face      face,\n+  tt_get_var_blend( FT_Face      face,             \/* TT_Face *\/\n@@ -4418,1 +4502,4 @@\n-    if ( face->blend )\n+    TT_Face  ttface = (TT_Face)face;\n+\n+\n+    if ( ttface->blend )\n@@ -4421,1 +4508,1 @@\n-        *num_coords       = face->blend->num_axis;\n+        *num_coords       = ttface->blend->num_axis;\n@@ -4423,1 +4510,1 @@\n-        *coords           = face->blend->coords;\n+        *coords           = ttface->blend->coords;\n@@ -4425,1 +4512,1 @@\n-        *normalizedcoords = face->blend->normalizedcoords;\n+        *normalizedcoords = ttface->blend->normalizedcoords;\n@@ -4427,1 +4514,1 @@\n-        *mm_var           = face->blend->mmvar;\n+        *mm_var           = ttface->blend->mmvar;\n@@ -4444,1 +4531,1 @@\n-  tt_var_done_item_variation_store( TT_Face          face,\n+  tt_var_done_item_variation_store( FT_Face          face,\n@@ -4473,1 +4560,1 @@\n-  tt_var_done_delta_set_index_map( TT_Face            face,\n+  tt_var_done_delta_set_index_map( FT_Face            face,\n@@ -4493,1 +4580,1 @@\n-  tt_done_blend( TT_Face  face )\n+  tt_done_blend( FT_Face  face )\n@@ -4495,0 +4582,1 @@\n+    TT_Face    ttface = (TT_Face)face;\n@@ -4496,1 +4584,1 @@\n-    GX_Blend   blend  = face->blend;\n+    GX_Blend   blend  = ttface->blend;\n@@ -4568,1 +4656,1 @@\n-  typedef int  _tt_gxvar_dummy;\n+  typedef int  tt_gxvar_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttgxvar.c","additions":306,"deletions":218,"binary":false,"changes":524,"status":"modified"},{"patch":"@@ -350,1 +350,1 @@\n-  TT_Set_MM_Blend( TT_Face    face,\n+  TT_Set_MM_Blend( FT_Face    face,\n@@ -355,1 +355,1 @@\n-  TT_Get_MM_Blend( TT_Face    face,\n+  TT_Get_MM_Blend( FT_Face    face,\n@@ -360,1 +360,1 @@\n-  TT_Set_Var_Design( TT_Face    face,\n+  TT_Set_Var_Design( FT_Face    face,\n@@ -365,1 +365,1 @@\n-  TT_Get_MM_Var( TT_Face      face,\n+  TT_Get_MM_Var( FT_Face      face,\n@@ -369,1 +369,1 @@\n-  TT_Get_Var_Design( TT_Face    face,\n+  TT_Get_Var_Design( FT_Face    face,\n@@ -374,1 +374,1 @@\n-  TT_Set_Named_Instance( TT_Face  face,\n+  TT_Set_Named_Instance( FT_Face  face,\n@@ -377,0 +377,7 @@\n+  FT_LOCAL( FT_Error )\n+  TT_Get_Default_Named_Instance( FT_Face   face,\n+                                 FT_UInt  *instance_index );\n+\n+  FT_LOCAL( void )\n+  tt_construct_ps_name( FT_Face  face );\n+\n@@ -388,1 +395,1 @@\n-  tt_hadvance_adjust( TT_Face  face,\n+  tt_hadvance_adjust( FT_Face  face,\n@@ -393,1 +400,1 @@\n-  tt_vadvance_adjust( TT_Face  face,\n+  tt_vadvance_adjust( FT_Face  face,\n@@ -398,2 +405,1 @@\n-  tt_apply_mvar( TT_Face  face );\n-\n+  tt_apply_mvar( FT_Face  face );\n@@ -402,1 +408,1 @@\n-  tt_var_load_item_variation_store( TT_Face          face,\n+  tt_var_load_item_variation_store( FT_Face          face,\n@@ -407,1 +413,1 @@\n-  tt_var_load_delta_set_index_mapping( TT_Face            face,\n+  tt_var_load_delta_set_index_mapping( FT_Face            face,\n@@ -414,1 +420,1 @@\n-  tt_var_get_item_delta( TT_Face          face,\n+  tt_var_get_item_delta( FT_Face          face,\n@@ -420,1 +426,1 @@\n-  tt_var_done_item_variation_store( TT_Face          face,\n+  tt_var_done_item_variation_store( FT_Face          face,\n@@ -424,1 +430,1 @@\n-  tt_var_done_delta_set_index_map( TT_Face            face,\n+  tt_var_done_delta_set_index_map( FT_Face            face,\n@@ -429,1 +435,1 @@\n-  tt_get_var_blend( TT_Face      face,\n+  tt_get_var_blend( FT_Face      face,\n@@ -436,1 +442,1 @@\n-  tt_done_blend( TT_Face  face );\n+  tt_done_blend( FT_Face  face );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttgxvar.h","additions":23,"deletions":17,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -32,1 +32,0 @@\n-#include \"ttsubpix.h\"\n@@ -55,6 +54,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-#define SUBPIXEL_HINTING_INFINALITY                                          \\\n-          ( ((TT_Driver)FT_FACE_DRIVER( exc->face ))->interpreter_version == \\\n-            TT_INTERPRETER_VERSION_38 )\n-#endif\n-\n@@ -278,51 +271,0 @@\n-  \/**************************************************************************\n-   *\n-   * @Function:\n-   *   Update_Max\n-   *\n-   * @Description:\n-   *   Checks the size of a buffer and reallocates it if necessary.\n-   *\n-   * @Input:\n-   *   memory ::\n-   *     A handle to the parent memory object.\n-   *\n-   *   multiplier ::\n-   *     The size in bytes of each element in the buffer.\n-   *\n-   *   new_max ::\n-   *     The new capacity (size) of the buffer.\n-   *\n-   * @InOut:\n-   *   size ::\n-   *     The address of the buffer's current size expressed\n-   *     in elements.\n-   *\n-   *   buff ::\n-   *     The address of the buffer base pointer.\n-   *\n-   * @Return:\n-   *   FreeType error code.  0 means success.\n-   *\/\n-  FT_LOCAL_DEF( FT_Error )\n-  Update_Max( FT_Memory  memory,\n-              FT_ULong*  size,\n-              FT_ULong   multiplier,\n-              void*      _pbuff,\n-              FT_ULong   new_max )\n-  {\n-    FT_Error  error;\n-    void**    pbuff = (void**)_pbuff;\n-\n-\n-    if ( *size < new_max )\n-    {\n-      if ( FT_QREALLOC( *pbuff, *size * multiplier, new_max * multiplier ) )\n-        return error;\n-      *size = new_max;\n-    }\n-\n-    return FT_Err_Ok;\n-  }\n-\n-\n@@ -362,1 +304,0 @@\n-    FT_ULong        tmp;\n@@ -365,0 +306,1 @@\n+    FT_Memory       memory = exec->memory;\n@@ -409,8 +351,3 @@\n-    tmp = (FT_ULong)exec->stackSize;\n-    error = Update_Max( exec->memory,\n-                        &tmp,\n-                        sizeof ( FT_F26Dot6 ),\n-                        (void*)&exec->stack,\n-                        maxp->maxStackElements + 32 );\n-    exec->stackSize = (FT_Long)tmp;\n-    if ( error )\n+    if ( FT_QRENEW_ARRAY( exec->stack,\n+                          exec->stackSize,\n+                          maxp->maxStackElements + 32 ) )\n@@ -418,0 +355,1 @@\n+    exec->stackSize = maxp->maxStackElements + 32;\n@@ -419,9 +357,3 @@\n-    tmp = (FT_ULong)exec->glyphSize;\n-    error = Update_Max( exec->memory,\n-                        &tmp,\n-                        sizeof ( FT_Byte ),\n-                        (void*)&exec->glyphIns,\n-                        maxp->maxSizeOfInstructions );\n-    exec->glyphSize = (FT_UInt)tmp;\n-    if ( error )\n-      return error;\n+    \/* free previous glyph code range *\/\n+    FT_FREE( exec->glyphIns );\n+    exec->glyphSize = 0;\n@@ -1533,6 +1465,7 @@\n-      exc->error = Update_Max( exc->memory,\n-                               &exc->glyfCvtSize,\n-                               sizeof ( FT_Long ),\n-                               (void*)&exc->glyfCvt,\n-                               exc->cvtSize );\n-      if ( exc->error )\n+      FT_Memory  memory = exc->memory;\n+      FT_Error   error;\n+\n+\n+      FT_MEM_QRENEW_ARRAY( exc->glyfCvt, exc->glyfCvtSize, exc->cvtSize );\n+      exc->error = error;\n+      if ( error )\n@@ -1541,0 +1474,1 @@\n+      exc->glyfCvtSize = exc->cvtSize;\n@@ -1747,11 +1681,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY                            &&\n-           ( !exc->ignore_x_mode                                ||\n-             ( exc->sph_tweak_flags & SPH_TWEAK_ALLOW_X_DMOVE ) ) )\n-        zone->cur[point].x = ADD_LONG( zone->cur[point].x,\n-                                       FT_MulDiv( distance,\n-                                                  v,\n-                                                  exc->F_dot_P ) );\n-      else\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -1863,6 +1786,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY && !exc->ignore_x_mode )\n-      zone->cur[point].x = ADD_LONG( zone->cur[point].x, distance );\n-    else\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -3072,22 +2989,1 @@\n-    {\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      \/* subpixel hinting - avoid Typeman Dstroke and *\/\n-      \/* IStroke and Vacuform rounds                  *\/\n-      if ( SUBPIXEL_HINTING_INFINALITY                 &&\n-           exc->ignore_x_mode                          &&\n-           ( ( I == 24                             &&\n-               ( exc->face->sph_found_func_flags &\n-                 ( SPH_FDEF_SPACING_1 |\n-                   SPH_FDEF_SPACING_2 )          ) ) ||\n-             ( I == 22                      &&\n-               ( exc->sph_in_func_flags   &\n-                 SPH_FDEF_TYPEMAN_STROKES ) )        ||\n-             ( I == 8                              &&\n-               ( exc->face->sph_found_func_flags &\n-                 SPH_FDEF_VACUFORM_ROUND_1       ) &&\n-               exc->iup_called                     ) ) )\n-        args[0] = 0;\n-      else\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-        args[0] = exc->storage[I];\n-    }\n+      args[0] = exc->storage[I];\n@@ -3120,1 +3016,2 @@\n-        FT_ULong  tmp = (FT_ULong)exc->glyfStoreSize;\n+        FT_Memory  memory = exc->memory;\n+        FT_Error   error;\n@@ -3123,7 +3020,5 @@\n-        exc->error = Update_Max( exc->memory,\n-                                 &tmp,\n-                                 sizeof ( FT_Long ),\n-                                 (void*)&exc->glyfStorage,\n-                                 exc->storeSize );\n-        exc->glyfStoreSize = (FT_UShort)tmp;\n-        if ( exc->error )\n+        FT_MEM_QRENEW_ARRAY( exc->glyfStorage,\n+                             exc->glyfStoreSize,\n+                             exc->storeSize );\n+        exc->error  = error;\n+        if ( error )\n@@ -3132,0 +3027,1 @@\n+        exc->glyfStoreSize = exc->storeSize;\n@@ -3607,100 +3503,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    \/* arguments to opcodes are skipped by `SKIP_Code' *\/\n-    FT_Byte    opcode_pattern[9][12] = {\n-                 \/* #0 inline delta function 1 *\/\n-                 {\n-                   0x4B, \/* PPEM    *\/\n-                   0x53, \/* GTEQ    *\/\n-                   0x23, \/* SWAP    *\/\n-                   0x4B, \/* PPEM    *\/\n-                   0x51, \/* LTEQ    *\/\n-                   0x5A, \/* AND     *\/\n-                   0x58, \/* IF      *\/\n-                   0x38, \/*   SHPIX *\/\n-                   0x1B, \/* ELSE    *\/\n-                   0x21, \/*   POP   *\/\n-                   0x21, \/*   POP   *\/\n-                   0x59  \/* EIF     *\/\n-                 },\n-                 \/* #1 inline delta function 2 *\/\n-                 {\n-                   0x4B, \/* PPEM    *\/\n-                   0x54, \/* EQ      *\/\n-                   0x58, \/* IF      *\/\n-                   0x38, \/*   SHPIX *\/\n-                   0x1B, \/* ELSE    *\/\n-                   0x21, \/*   POP   *\/\n-                   0x21, \/*   POP   *\/\n-                   0x59  \/* EIF     *\/\n-                 },\n-                 \/* #2 diagonal stroke function *\/\n-                 {\n-                   0x20, \/* DUP     *\/\n-                   0x20, \/* DUP     *\/\n-                   0xB0, \/* PUSHB_1 *\/\n-                         \/*   1     *\/\n-                   0x60, \/* ADD     *\/\n-                   0x46, \/* GC_cur  *\/\n-                   0xB0, \/* PUSHB_1 *\/\n-                         \/*   64    *\/\n-                   0x23, \/* SWAP    *\/\n-                   0x42  \/* WS      *\/\n-                 },\n-                 \/* #3 VacuFormRound function *\/\n-                 {\n-                   0x45, \/* RCVT    *\/\n-                   0x23, \/* SWAP    *\/\n-                   0x46, \/* GC_cur  *\/\n-                   0x60, \/* ADD     *\/\n-                   0x20, \/* DUP     *\/\n-                   0xB0  \/* PUSHB_1 *\/\n-                         \/*   38    *\/\n-                 },\n-                 \/* #4 TTFautohint bytecode (old) *\/\n-                 {\n-                   0x20, \/* DUP     *\/\n-                   0x64, \/* ABS     *\/\n-                   0xB0, \/* PUSHB_1 *\/\n-                         \/*   32    *\/\n-                   0x60, \/* ADD     *\/\n-                   0x66, \/* FLOOR   *\/\n-                   0x23, \/* SWAP    *\/\n-                   0xB0  \/* PUSHB_1 *\/\n-                 },\n-                 \/* #5 spacing function 1 *\/\n-                 {\n-                   0x01, \/* SVTCA_x *\/\n-                   0xB0, \/* PUSHB_1 *\/\n-                         \/*   24    *\/\n-                   0x43, \/* RS      *\/\n-                   0x58  \/* IF      *\/\n-                 },\n-                 \/* #6 spacing function 2 *\/\n-                 {\n-                   0x01, \/* SVTCA_x *\/\n-                   0x18, \/* RTG     *\/\n-                   0xB0, \/* PUSHB_1 *\/\n-                         \/*   24    *\/\n-                   0x43, \/* RS      *\/\n-                   0x58  \/* IF      *\/\n-                 },\n-                 \/* #7 TypeMan Talk DiagEndCtrl function *\/\n-                 {\n-                   0x01, \/* SVTCA_x *\/\n-                   0x20, \/* DUP     *\/\n-                   0xB0, \/* PUSHB_1 *\/\n-                         \/*   3     *\/\n-                   0x25, \/* CINDEX  *\/\n-                 },\n-                 \/* #8 TypeMan Talk Align *\/\n-                 {\n-                   0x06, \/* SPVTL   *\/\n-                   0x7D, \/* RDTG    *\/\n-                 },\n-               };\n-    FT_UShort  opcode_patterns   = 9;\n-    FT_UShort  opcode_pointer[9] = {  0, 0, 0, 0, 0, 0, 0, 0, 0 };\n-    FT_UShort  opcode_size[9]    = { 12, 8, 8, 6, 7, 4, 5, 4, 2 };\n-    FT_UShort  i;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -3751,2 +3547,0 @@\n-    rec->inline_delta   = FALSE;\n-    rec->sph_fdef_flags = 0x0000;\n@@ -3757,7 +3551,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    \/* We don't know for sure these are typeman functions, *\/\n-    \/* however they are only active when RS 22 is called   *\/\n-    if ( n >= 64 && n <= 66 )\n-      rec->sph_fdef_flags |= SPH_FDEF_TYPEMAN_STROKES;\n-#endif\n-\n@@ -3769,112 +3556,0 @@\n-\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-\n-      if ( SUBPIXEL_HINTING_INFINALITY )\n-      {\n-        for ( i = 0; i < opcode_patterns; i++ )\n-        {\n-          if ( opcode_pointer[i] < opcode_size[i]                  &&\n-               exc->opcode == opcode_pattern[i][opcode_pointer[i]] )\n-          {\n-            opcode_pointer[i] += 1;\n-\n-            if ( opcode_pointer[i] == opcode_size[i] )\n-            {\n-              FT_TRACE6(( \"sph: Function %d, opcode ptrn: %ld, %s %s\\n\",\n-                          i, n,\n-                          exc->face->root.family_name,\n-                          exc->face->root.style_name ));\n-\n-              switch ( i )\n-              {\n-              case 0:\n-                rec->sph_fdef_flags             |= SPH_FDEF_INLINE_DELTA_1;\n-                exc->face->sph_found_func_flags |= SPH_FDEF_INLINE_DELTA_1;\n-                break;\n-\n-              case 1:\n-                rec->sph_fdef_flags             |= SPH_FDEF_INLINE_DELTA_2;\n-                exc->face->sph_found_func_flags |= SPH_FDEF_INLINE_DELTA_2;\n-                break;\n-\n-              case 2:\n-                switch ( n )\n-                {\n-                  \/* needs to be implemented still *\/\n-                case 58:\n-                  rec->sph_fdef_flags             |= SPH_FDEF_DIAGONAL_STROKE;\n-                  exc->face->sph_found_func_flags |= SPH_FDEF_DIAGONAL_STROKE;\n-                }\n-                break;\n-\n-              case 3:\n-                switch ( n )\n-                {\n-                case 0:\n-                  rec->sph_fdef_flags             |= SPH_FDEF_VACUFORM_ROUND_1;\n-                  exc->face->sph_found_func_flags |= SPH_FDEF_VACUFORM_ROUND_1;\n-                }\n-                break;\n-\n-              case 4:\n-                \/* probably not necessary to detect anymore *\/\n-                rec->sph_fdef_flags             |= SPH_FDEF_TTFAUTOHINT_1;\n-                exc->face->sph_found_func_flags |= SPH_FDEF_TTFAUTOHINT_1;\n-                break;\n-\n-              case 5:\n-                switch ( n )\n-                {\n-                case 0:\n-                case 1:\n-                case 2:\n-                case 4:\n-                case 7:\n-                case 8:\n-                  rec->sph_fdef_flags             |= SPH_FDEF_SPACING_1;\n-                  exc->face->sph_found_func_flags |= SPH_FDEF_SPACING_1;\n-                }\n-                break;\n-\n-              case 6:\n-                switch ( n )\n-                {\n-                case 0:\n-                case 1:\n-                case 2:\n-                case 4:\n-                case 7:\n-                case 8:\n-                  rec->sph_fdef_flags             |= SPH_FDEF_SPACING_2;\n-                  exc->face->sph_found_func_flags |= SPH_FDEF_SPACING_2;\n-                }\n-                break;\n-\n-               case 7:\n-                 rec->sph_fdef_flags             |= SPH_FDEF_TYPEMAN_DIAGENDCTRL;\n-                 exc->face->sph_found_func_flags |= SPH_FDEF_TYPEMAN_DIAGENDCTRL;\n-                 break;\n-\n-               case 8:\n-#if 0\n-                 rec->sph_fdef_flags             |= SPH_FDEF_TYPEMAN_DIAGENDCTRL;\n-                 exc->face->sph_found_func_flags |= SPH_FDEF_TYPEMAN_DIAGENDCTRL;\n-#endif\n-                 break;\n-              }\n-              opcode_pointer[i] = 0;\n-            }\n-          }\n-\n-          else\n-            opcode_pointer[i] = 0;\n-        }\n-\n-        \/* Set sph_compatibility_mode only when deltas are detected *\/\n-        exc->face->sph_compatibility_mode =\n-          ( ( exc->face->sph_found_func_flags & SPH_FDEF_INLINE_DELTA_1 ) |\n-            ( exc->face->sph_found_func_flags & SPH_FDEF_INLINE_DELTA_2 ) );\n-      }\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -3908,4 +3583,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    exc->sph_in_func_flags = 0x0000;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -3999,11 +3670,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY                                    &&\n-         exc->ignore_x_mode                                             &&\n-         ( ( exc->iup_called                                        &&\n-             ( exc->sph_tweak_flags & SPH_TWEAK_NO_CALL_AFTER_IUP ) ) ||\n-           ( def->sph_fdef_flags & SPH_FDEF_VACUFORM_ROUND_1 )        ) )\n-      goto Fail;\n-    else\n-      exc->sph_in_func_flags = def->sph_fdef_flags;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -4087,9 +3747,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY                         &&\n-         exc->ignore_x_mode                                  &&\n-         ( def->sph_fdef_flags & SPH_FDEF_VACUFORM_ROUND_1 ) )\n-      goto Fail;\n-    else\n-      exc->sph_in_func_flags = def->sph_fdef_flags;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -5001,8 +4652,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    \/* Disable Type 2 Vacuform Rounds - e.g. Arial Narrow *\/\n-    if ( SUBPIXEL_HINTING_INFINALITY         &&\n-         exc->ignore_x_mode                  &&\n-         ( D < 0 ? NEG_LONG( D ) : D ) == 64 )\n-      D += 1;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -5270,7 +4913,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      \/* INSTCTRL modifying flag 3 also has an effect *\/\n-      \/* outside of the CVT program                   *\/\n-      if ( SUBPIXEL_HINTING_INFINALITY )\n-        exc->ignore_x_mode = !FT_BOOL( L == 4 );\n-#endif\n-\n@@ -5608,6 +5244,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      \/* doesn't follow Cleartype spec but produces better result *\/\n-      if ( SUBPIXEL_HINTING_INFINALITY && exc->ignore_x_mode )\n-        Move_Zp2_Point( exc, point, 0, dy, TRUE );\n-      else\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n@@ -5774,70 +5404,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY &&\n-           exc->ignore_x_mode          )\n-      {\n-        FT_Int  B1, B2;\n-\n-\n-        \/*  If not using ignore_x_mode rendering, allow ZP2 move.        *\/\n-        \/*  If inline deltas aren't allowed, skip ZP2 move.              *\/\n-        \/*  If using ignore_x_mode rendering, allow ZP2 point move if:   *\/\n-        \/*   - freedom vector is y and sph_compatibility_mode is off     *\/\n-        \/*   - the glyph is composite and the move is in the Y direction *\/\n-        \/*   - the glyph is specifically set to allow SHPIX moves        *\/\n-        \/*   - the move is on a previously Y-touched point               *\/\n-\n-        \/* save point for later comparison *\/\n-        B1 = exc->zp2.cur[point].y;\n-\n-        if ( exc->face->sph_compatibility_mode )\n-        {\n-          if ( exc->sph_tweak_flags & SPH_TWEAK_ROUND_NONPIXEL_Y_MOVES )\n-            dy = FT_PIX_ROUND( B1 + dy ) - B1;\n-\n-          \/* skip post-iup deltas *\/\n-          if ( exc->iup_called                                          &&\n-               ( ( exc->sph_in_func_flags & SPH_FDEF_INLINE_DELTA_1 ) ||\n-                 ( exc->sph_in_func_flags & SPH_FDEF_INLINE_DELTA_2 ) ) )\n-            goto Skip;\n-\n-          if ( !( exc->sph_tweak_flags & SPH_TWEAK_ALWAYS_SKIP_DELTAP ) &&\n-                ( ( exc->is_composite && exc->GS.freeVector.y != 0 ) ||\n-                  ( exc->zp2.tags[point] & FT_CURVE_TAG_TOUCH_Y )    ||\n-                  ( exc->sph_tweak_flags & SPH_TWEAK_DO_SHPIX )      )  )\n-            Move_Zp2_Point( exc, point, 0, dy, TRUE );\n-\n-          \/* save new point *\/\n-          if ( exc->GS.freeVector.y != 0 )\n-          {\n-            B2 = exc->zp2.cur[point].y;\n-\n-            \/* reverse any disallowed moves *\/\n-            if ( ( B1 & 63 ) == 0 &&\n-                 ( B2 & 63 ) != 0 &&\n-                 B1 != B2         )\n-              Move_Zp2_Point( exc, point, 0, NEG_LONG( dy ), TRUE );\n-          }\n-        }\n-        else if ( exc->GS.freeVector.y != 0 )\n-        {\n-          Move_Zp2_Point( exc, point, dx, dy, TRUE );\n-\n-          \/* save new point *\/\n-          B2 = exc->zp2.cur[point].y;\n-\n-          \/* reverse any disallowed moves *\/\n-          if ( ( exc->sph_tweak_flags & SPH_TWEAK_SKIP_NONPIXEL_Y_MOVES ) &&\n-               ( B1 & 63 ) != 0                                           &&\n-               ( B2 & 63 ) != 0                                           &&\n-               B1 != B2                                                   )\n-            Move_Zp2_Point( exc,\n-                            point,\n-                            NEG_LONG( dx ),\n-                            NEG_LONG( dy ),\n-                            TRUE );\n-        }\n-        else if ( exc->sph_in_func_flags & SPH_FDEF_TYPEMAN_DIAGENDCTRL )\n-          Move_Zp2_Point( exc, point, dx, dy, TRUE );\n-      }\n-      else\n-#endif\n@@ -5863,3 +5423,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    Skip:\n-#endif\n@@ -5910,22 +5467,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    \/* subpixel hinting - make MSIRP respect CVT cut-in; *\/\n-    if ( SUBPIXEL_HINTING_INFINALITY &&\n-         exc->ignore_x_mode          &&\n-         exc->GS.freeVector.x != 0   )\n-    {\n-      FT_F26Dot6  control_value_cutin = exc->GS.control_value_cutin;\n-      FT_F26Dot6  delta;\n-\n-\n-      if ( !( exc->sph_tweak_flags & SPH_TWEAK_NORMAL_ROUND ) )\n-        control_value_cutin = 0;\n-\n-      delta = SUB_LONG( distance, args[1] );\n-      if ( delta < 0 )\n-        delta = NEG_LONG( delta );\n-\n-      if ( delta >= control_value_cutin )\n-        distance = args[1];\n-    }\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -5972,8 +5507,1 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY &&\n-           exc->ignore_x_mode          &&\n-           exc->GS.freeVector.x != 0   )\n-        distance = SUB_LONG( Round_None( exc, cur_dist, 3 ), cur_dist );\n-      else\n-#endif\n-        distance = SUB_LONG( exc->func_round( exc, cur_dist, 3 ), cur_dist );\n+      distance = SUB_LONG( exc->func_round( exc, cur_dist, 3 ), cur_dist );\n@@ -6042,8 +5570,1 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      \/* Only adjust if not in sph_compatibility_mode or ignore_x_mode. *\/\n-      \/* Determined via experimentation and may be incorrect...         *\/\n-      if ( !( SUBPIXEL_HINTING_INFINALITY           &&\n-              ( exc->ignore_x_mode                &&\n-                exc->face->sph_compatibility_mode ) ) )\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-        exc->zp0.org[point].x = TT_MulFix14( distance,\n+      exc->zp0.org[point].x = TT_MulFix14( distance,\n@@ -6055,8 +5576,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY                    &&\n-         exc->ignore_x_mode                             &&\n-         ( exc->sph_tweak_flags & SPH_TWEAK_MIAP_HACK ) &&\n-         distance > 0                                   &&\n-         exc->GS.freeVector.y != 0                      )\n-      distance = 0;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n@@ -6072,9 +5585,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY                        &&\n-           exc->ignore_x_mode                                 &&\n-           exc->GS.freeVector.x != 0                          &&\n-           exc->GS.freeVector.y == 0                          &&\n-           !( exc->sph_tweak_flags & SPH_TWEAK_NORMAL_ROUND ) )\n-        control_value_cutin = 0;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -6088,8 +5592,1 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY &&\n-           exc->ignore_x_mode          &&\n-           exc->GS.freeVector.x != 0   )\n-        distance = Round_None( exc, distance, 3 );\n-      else\n-#endif\n-        distance = exc->func_round( exc, distance, 3 );\n+      distance = exc->func_round( exc, distance, 3 );\n@@ -6188,8 +5685,1 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY &&\n-           exc->ignore_x_mode          &&\n-           exc->GS.freeVector.x != 0   )\n-        distance = Round_None( exc, org_dist, exc->opcode & 3 );\n-      else\n-#endif\n-        distance = exc->func_round( exc, org_dist, exc->opcode & 3 );\n+      distance = exc->func_round( exc, org_dist, exc->opcode & 3 );\n@@ -6207,8 +5697,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY                        &&\n-           exc->ignore_x_mode                                 &&\n-           exc->GS.freeVector.x != 0                          &&\n-           !( exc->sph_tweak_flags & SPH_TWEAK_NORMAL_ROUND ) )\n-        minimum_distance = 0;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -6357,33 +5839,0 @@\n-    {\n-\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      \/* do cvt cut-in always in MIRP for sph *\/\n-      if ( SUBPIXEL_HINTING_INFINALITY  &&\n-           exc->ignore_x_mode           &&\n-           exc->GS.gep0 == exc->GS.gep1 )\n-      {\n-        FT_F26Dot6  control_value_cutin = exc->GS.control_value_cutin;\n-\n-\n-        if ( exc->GS.freeVector.x != 0                          &&\n-             !( exc->sph_tweak_flags & SPH_TWEAK_NORMAL_ROUND ) )\n-          control_value_cutin = 0;\n-\n-        if ( exc->GS.freeVector.y != 0                                 &&\n-             ( exc->sph_tweak_flags & SPH_TWEAK_TIMES_NEW_ROMAN_HACK ) )\n-        {\n-          if ( cur_dist < -64 )\n-            cvt_dist -= 16;\n-          else if ( cur_dist > 64 && cur_dist < 84 )\n-            cvt_dist += 32;\n-        }\n-\n-        delta = SUB_LONG( cvt_dist, org_dist );\n-        if ( delta < 0 )\n-          delta = NEG_LONG( delta );\n-\n-        if ( delta > control_value_cutin )\n-          cvt_dist = org_dist;\n-      }\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -6391,1 +5840,0 @@\n-    }\n@@ -6400,8 +5848,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-      if ( SUBPIXEL_HINTING_INFINALITY                        &&\n-           exc->ignore_x_mode                                 &&\n-           exc->GS.freeVector.x != 0                          &&\n-           !( exc->sph_tweak_flags & SPH_TWEAK_NORMAL_ROUND ) )\n-        minimum_distance = 0;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -6420,45 +5860,4 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY &&\n-         exc->ignore_x_mode          &&\n-         exc->GS.freeVector.y != 0   )\n-    {\n-      FT_Int   B1, B2;\n-\n-\n-      B1 = exc->zp1.cur[point].y;\n-\n-      \/* Round moves if necessary *\/\n-      if ( exc->sph_tweak_flags & SPH_TWEAK_ROUND_NONPIXEL_Y_MOVES )\n-        distance = FT_PIX_ROUND( B1 + distance - cur_dist ) - B1 + cur_dist;\n-\n-      if ( ( exc->opcode & 16 ) == 0                               &&\n-           ( exc->opcode & 8 ) == 0                                &&\n-           ( exc->sph_tweak_flags & SPH_TWEAK_COURIER_NEW_2_HACK ) )\n-        distance += 64;\n-\n-      exc->func_move( exc,\n-                      &exc->zp1,\n-                      point,\n-                      SUB_LONG( distance, cur_dist ) );\n-\n-      B2 = exc->zp1.cur[point].y;\n-\n-      \/* Reverse move if necessary *\/\n-      if ( ( exc->face->sph_compatibility_mode &&\n-             ( B1 & 63 ) == 0                  &&\n-             ( B2 & 63 ) != 0                  )                          ||\n-           ( ( exc->sph_tweak_flags & SPH_TWEAK_SKIP_NONPIXEL_Y_MOVES ) &&\n-             ( B1 & 63 ) != 0                                           &&\n-             ( B2 & 63 ) != 0                                           ) )\n-        exc->func_move( exc,\n-                        &exc->zp1,\n-                        point,\n-                        SUB_LONG( cur_dist, distance ) );\n-    }\n-    else\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n-      exc->func_move( exc,\n-                      &exc->zp1,\n-                      point,\n-                      SUB_LONG( distance, cur_dist ) );\n+    exc->func_move( exc,\n+                    &exc->zp1,\n+                    point,\n+                    SUB_LONG( distance, cur_dist ) );\n@@ -6489,11 +5888,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY                               &&\n-         exc->ignore_x_mode                                        &&\n-         exc->iup_called                                           &&\n-         ( exc->sph_tweak_flags & SPH_TWEAK_NO_ALIGNRP_AFTER_IUP ) )\n-    {\n-      exc->error = FT_THROW( Invalid_Reference );\n-      goto Fail;\n-    }\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -7058,10 +6446,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY &&\n-         exc->ignore_x_mode          )\n-    {\n-      exc->iup_called = TRUE;\n-      if ( exc->sph_tweak_flags & SPH_TWEAK_SKIP_IUP )\n-        return;\n-    }\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -7140,8 +6518,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    if ( SUBPIXEL_HINTING_INFINALITY                              &&\n-         exc->ignore_x_mode                                       &&\n-         exc->iup_called                                          &&\n-         ( exc->sph_tweak_flags & SPH_TWEAK_NO_DELTAP_AFTER_IUP ) )\n-      goto Fail;\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -7200,1 +6570,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n@@ -7202,1 +6571,5 @@\n-          if ( SUBPIXEL_HINTING_INFINALITY )\n+#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n+          \/* See `ttinterp.h' for details on backward compatibility *\/\n+          \/* mode.                                                  *\/\n+          if ( SUBPIXEL_HINTING_MINIMAL    &&\n+               exc->backward_compatibility )\n@@ -7204,11 +6577,3 @@\n-            \/*\n-             * Allow delta move if\n-             *\n-             * - not using ignore_x_mode rendering,\n-             * - glyph is specifically set to allow it, or\n-             * - glyph is composite and freedom vector is not in subpixel\n-             *   direction.\n-             *\/\n-            if ( !exc->ignore_x_mode                                   ||\n-                 ( exc->sph_tweak_flags & SPH_TWEAK_ALWAYS_DO_DELTAP ) ||\n-                 ( exc->is_composite && exc->GS.freeVector.y != 0 )    )\n+            if ( !( exc->iupx_called && exc->iupy_called )              &&\n+                 ( ( exc->is_composite && exc->GS.freeVector.y != 0 ) ||\n+                   ( exc->zp0.tags[A] & FT_CURVE_TAG_TOUCH_Y )        ) )\n@@ -7216,44 +6581,0 @@\n-\n-            \/* Otherwise, apply subpixel hinting and compatibility mode *\/\n-            \/* rules, always skipping deltas in subpixel direction.     *\/\n-            else if ( exc->ignore_x_mode && exc->GS.freeVector.y != 0 )\n-            {\n-              FT_UShort  B1, B2;\n-\n-\n-              \/* save the y value of the point now; compare after move *\/\n-              B1 = (FT_UShort)exc->zp0.cur[A].y;\n-\n-              \/* Standard subpixel hinting: Allow y move for y-touched *\/\n-              \/* points.  This messes up DejaVu ...                    *\/\n-              if ( !exc->face->sph_compatibility_mode          &&\n-                   ( exc->zp0.tags[A] & FT_CURVE_TAG_TOUCH_Y ) )\n-                exc->func_move( exc, &exc->zp0, A, B );\n-\n-              \/* compatibility mode *\/\n-              else if ( exc->face->sph_compatibility_mode                        &&\n-                        !( exc->sph_tweak_flags & SPH_TWEAK_ALWAYS_SKIP_DELTAP ) )\n-              {\n-                if ( exc->sph_tweak_flags & SPH_TWEAK_ROUND_NONPIXEL_Y_MOVES )\n-                  B = FT_PIX_ROUND( B1 + B ) - B1;\n-\n-                \/* Allow delta move if using sph_compatibility_mode,   *\/\n-                \/* IUP has not been called, and point is touched on Y. *\/\n-                if ( !exc->iup_called                            &&\n-                     ( exc->zp0.tags[A] & FT_CURVE_TAG_TOUCH_Y ) )\n-                  exc->func_move( exc, &exc->zp0, A, B );\n-              }\n-\n-              B2 = (FT_UShort)exc->zp0.cur[A].y;\n-\n-              \/* Reverse this move if it results in a disallowed move *\/\n-              if ( exc->GS.freeVector.y != 0                          &&\n-                   ( ( exc->face->sph_compatibility_mode          &&\n-                       ( B1 & 63 ) == 0                           &&\n-                       ( B2 & 63 ) != 0                           ) ||\n-                     ( ( exc->sph_tweak_flags                   &\n-                         SPH_TWEAK_SKIP_NONPIXEL_Y_MOVES_DELTAP ) &&\n-                       ( B1 & 63 ) != 0                           &&\n-                       ( B2 & 63 ) != 0                           ) ) )\n-                exc->func_move( exc, &exc->zp0, A, NEG_LONG( B ) );\n-            }\n@@ -7262,16 +6583,0 @@\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n-          {\n-\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_MINIMAL\n-            \/* See `ttinterp.h' for details on backward compatibility *\/\n-            \/* mode.                                                  *\/\n-            if ( SUBPIXEL_HINTING_MINIMAL    &&\n-                 exc->backward_compatibility )\n-            {\n-              if ( !( exc->iupx_called && exc->iupy_called )              &&\n-                   ( ( exc->is_composite && exc->GS.freeVector.y != 0 ) ||\n-                     ( exc->zp0.tags[A] & FT_CURVE_TAG_TOUCH_Y )        ) )\n-                exc->func_move( exc, &exc->zp0, A, B );\n-            }\n-            else\n@@ -7279,2 +6584,1 @@\n-              exc->func_move( exc, &exc->zp0, A, B );\n-          }\n+            exc->func_move( exc, &exc->zp0, A, B );\n@@ -7383,8 +6687,0 @@\n-   *\n-   * XXX: UNDOCUMENTED: Selector bits higher than 9 are currently (May\n-   *      2015) not documented in the OpenType specification.\n-   *\n-   *      Selector bit 11 is incorrectly described as bit 8, while the\n-   *      real meaning of bit 8 (vertical LCD subpixels) stays\n-   *      undocumented.  The same mistake can be found in Greg Hitchcock's\n-   *      whitepaper.\n@@ -7402,25 +6698,2 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    \/*********************************\n-     * RASTERIZER VERSION\n-     * Selector Bit:  0\n-     * Return Bit(s): 0-7\n-     *\/\n-    if ( SUBPIXEL_HINTING_INFINALITY &&\n-         ( args[0] & 1 ) != 0        &&\n-         exc->subpixel_hinting       )\n-    {\n-      if ( exc->ignore_x_mode )\n-      {\n-        \/* if in ClearType backward compatibility mode,         *\/\n-        \/* we sometimes change the TrueType version dynamically *\/\n-        K = exc->rasterizer_version;\n-        FT_TRACE6(( \"Setting rasterizer version %d\\n\",\n-                    exc->rasterizer_version ));\n-      }\n-      else\n-        K = TT_INTERPRETER_VERSION_38;\n-    }\n-    else\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-      if ( ( args[0] & 1 ) != 0 )\n-        K = driver->interpreter_version;\n+    if ( ( args[0] & 1 ) != 0 )\n+      K = driver->interpreter_version;\n@@ -7449,2 +6722,0 @@\n-     *\n-     * XXX: UNDOCUMENTED!\n@@ -7525,83 +6796,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-\n-    if ( SUBPIXEL_HINTING_INFINALITY                          &&\n-         exc->rasterizer_version >= TT_INTERPRETER_VERSION_35 )\n-    {\n-\n-      if ( exc->rasterizer_version >= 37 )\n-      {\n-        \/*********************************\n-         * HINTING FOR SUBPIXEL\n-         * Selector Bit:  6\n-         * Return Bit(s): 13\n-         *\/\n-        if ( ( args[0] & 64 ) != 0 && exc->subpixel_hinting )\n-          K |= 1 << 13;\n-\n-        \/*********************************\n-         * COMPATIBLE WIDTHS ENABLED\n-         * Selector Bit:  7\n-         * Return Bit(s): 14\n-         *\n-         * Functionality still needs to be added\n-         *\/\n-        if ( ( args[0] & 128 ) != 0 && exc->compatible_widths )\n-          K |= 1 << 14;\n-\n-        \/*********************************\n-         * VERTICAL LCD SUBPIXELS?\n-         * Selector Bit:  8\n-         * Return Bit(s): 15\n-         *\n-         * Functionality still needs to be added\n-         *\/\n-        if ( ( args[0] & 256 ) != 0 && exc->vertical_lcd )\n-          K |= 1 << 15;\n-\n-        \/*********************************\n-         * HINTING FOR BGR?\n-         * Selector Bit:  9\n-         * Return Bit(s): 16\n-         *\n-         * Functionality still needs to be added\n-         *\/\n-        if ( ( args[0] & 512 ) != 0 && exc->bgr )\n-          K |= 1 << 16;\n-\n-        if ( exc->rasterizer_version >= 38 )\n-        {\n-          \/*********************************\n-           * SUBPIXEL POSITIONED?\n-           * Selector Bit:  10\n-           * Return Bit(s): 17\n-           *\n-           * Functionality still needs to be added\n-           *\/\n-          if ( ( args[0] & 1024 ) != 0 && exc->subpixel_positioned )\n-            K |= 1 << 17;\n-\n-          \/*********************************\n-           * SYMMETRICAL SMOOTHING\n-           * Selector Bit:  11\n-           * Return Bit(s): 18\n-           *\n-           * Functionality still needs to be added\n-           *\/\n-          if ( ( args[0] & 2048 ) != 0 && exc->symmetrical_smoothing )\n-            K |= 1 << 18;\n-\n-          \/*********************************\n-           * GRAY CLEARTYPE\n-           * Selector Bit:  12\n-           * Return Bit(s): 19\n-           *\n-           * Functionality still needs to be added\n-           *\/\n-          if ( ( args[0] & 4096 ) != 0 && exc->gray_cleartype )\n-            K |= 1 << 19;\n-        }\n-      }\n-    }\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -7742,1 +6930,1 @@\n-  TT_RunIns( TT_ExecContext  exc )\n+  TT_RunIns( void*  exec )\n@@ -7744,0 +6932,2 @@\n+    TT_ExecContext  exc = (TT_ExecContext)exec;\n+\n@@ -7748,13 +6938,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    FT_Byte    opcode_pattern[1][2] = {\n-                  \/* #8 TypeMan Talk Align *\/\n-                  {\n-                    0x06, \/* SPVTL   *\/\n-                    0x7D, \/* RDTG    *\/\n-                  },\n-                };\n-    FT_UShort  opcode_patterns   = 1;\n-    FT_UShort  opcode_pointer[1] = { 0 };\n-    FT_UShort  opcode_size[1]    = { 1 };\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -7838,3 +7015,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    exc->iup_called  = FALSE;\n-#endif\n@@ -7909,1 +7083,1 @@\n-        \/* this is, calling any of the GX API functions on the current *\/\n+        \/* that is, calling any of the GX API functions on the current *\/\n@@ -7930,33 +7104,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-\n-      if ( SUBPIXEL_HINTING_INFINALITY )\n-      {\n-        for ( i = 0; i < opcode_patterns; i++ )\n-        {\n-          if ( opcode_pointer[i] < opcode_size[i]                  &&\n-               exc->opcode == opcode_pattern[i][opcode_pointer[i]] )\n-          {\n-            opcode_pointer[i] += 1;\n-\n-            if ( opcode_pointer[i] == opcode_size[i] )\n-            {\n-              FT_TRACE6(( \"sph: opcode ptrn: %d, %s %s\\n\",\n-                          i,\n-                          exc->face->root.family_name,\n-                          exc->face->root.style_name ));\n-\n-              switch ( i )\n-              {\n-              case 0:\n-                break;\n-              }\n-              opcode_pointer[i] = 0;\n-            }\n-          }\n-          else\n-            opcode_pointer[i] = 0;\n-        }\n-      }\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -8469,1 +7610,1 @@\n-          \/* this is, calling any of the GX API functions on the current *\/\n+          \/* that is, calling any of the GX API functions on the current *\/\n@@ -8607,1 +7748,1 @@\n-  typedef int  _tt_interp_dummy;\n+  typedef int  tt_interp_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttinterp.c","additions":50,"deletions":909,"binary":false,"changes":959,"status":"modified"},{"patch":"@@ -101,42 +101,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-\n-  \/**************************************************************************\n-   *\n-   * These structures define rules used to tweak subpixel hinting for\n-   * various fonts.  \"\", 0, \"\", NULL value indicates to match any value.\n-   *\/\n-\n-#define SPH_MAX_NAME_SIZE      32\n-#define SPH_MAX_CLASS_MEMBERS  100\n-\n-  typedef struct  SPH_TweakRule_\n-  {\n-    const char      family[SPH_MAX_NAME_SIZE];\n-    const FT_UInt   ppem;\n-    const char      style[SPH_MAX_NAME_SIZE];\n-    const FT_ULong  glyph;\n-\n-  } SPH_TweakRule;\n-\n-\n-  typedef struct  SPH_ScaleRule_\n-  {\n-    const char      family[SPH_MAX_NAME_SIZE];\n-    const FT_UInt   ppem;\n-    const char      style[SPH_MAX_NAME_SIZE];\n-    const FT_ULong  glyph;\n-    const FT_ULong  scale;\n-\n-  } SPH_ScaleRule;\n-\n-\n-  typedef struct  SPH_Font_Class_\n-  {\n-    const char  name[SPH_MAX_NAME_SIZE];\n-    const char  member[SPH_MAX_CLASS_MEMBERS][SPH_MAX_NAME_SIZE];\n-\n-  } SPH_Font_Class;\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n-\n@@ -402,32 +360,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    TT_Round_Func      func_round_sphn;   \/* subpixel rounding function *\/\n-\n-    FT_Bool            subpixel_hinting;  \/* Using subpixel hinting?       *\/\n-    FT_Bool            ignore_x_mode;     \/* Standard rendering mode for   *\/\n-                                          \/* subpixel hinting.  On if gray *\/\n-                                          \/* or subpixel hinting is on.    *\/\n-\n-    \/* The following 6 aren't fully implemented but here for MS rasterizer *\/\n-    \/* compatibility.                                                      *\/\n-    FT_Bool            compatible_widths;     \/* compatible widths?        *\/\n-    FT_Bool            symmetrical_smoothing; \/* symmetrical_smoothing?    *\/\n-    FT_Bool            bgr;                   \/* bgr instead of rgb?       *\/\n-    FT_Bool            vertical_lcd;          \/* long side of LCD subpixel *\/\n-                                              \/* rectangles is horizontal  *\/\n-    FT_Bool            subpixel_positioned;   \/* subpixel positioned       *\/\n-                                              \/* (DirectWrite ClearType)?  *\/\n-    FT_Bool            gray_cleartype;        \/* ClearType hinting but     *\/\n-                                              \/* grayscale rendering       *\/\n-\n-    FT_Int             rasterizer_version;    \/* MS rasterizer version     *\/\n-\n-    FT_Bool            iup_called;            \/* IUP called for glyph?     *\/\n-\n-    FT_ULong           sph_tweak_flags;       \/* flags to control          *\/\n-                                              \/* hint tweaks               *\/\n-\n-    FT_ULong           sph_in_func_flags;     \/* flags to indicate if in   *\/\n-                                              \/* special functions         *\/\n-\n-#endif \/* TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY *\/\n-\n@@ -463,8 +389,0 @@\n-\n-\n-  FT_LOCAL( FT_Error )\n-  Update_Max( FT_Memory  memory,\n-              FT_ULong*  size,\n-              FT_ULong   multiplier,\n-              void*      _pbuff,\n-              FT_ULong   new_max );\n@@ -539,1 +457,1 @@\n-  TT_RunIns( TT_ExecContext  exec );\n+  TT_RunIns( void*  exec );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttinterp.h","additions":1,"deletions":83,"binary":false,"changes":84,"status":"modified"},{"patch":"@@ -315,1 +315,2 @@\n-                                       [TRICK_SFNT_IDS_PER_FACE] = {\n+                                       [TRICK_SFNT_IDS_PER_FACE] =\n+    {\n@@ -584,1 +585,1 @@\n-    FT_UInt   asize;\n+    FT_ULong  asize;\n@@ -592,1 +593,1 @@\n-      tt_face_get_location( face, i, &asize );\n+      tt_face_get_location( ttface, i, &asize );\n@@ -780,1 +781,0 @@\n-\n@@ -788,1 +788,1 @@\n-        error = TT_Set_Named_Instance( face, instance_index );\n+        error = FT_Set_Named_Instance( ttface, instance_index );\n@@ -791,2 +791,0 @@\n-\n-        tt_apply_mvar( face );\n@@ -795,1 +793,0 @@\n-\n@@ -861,1 +858,1 @@\n-    tt_done_blend( face );\n+    tt_done_blend( ttface );\n@@ -1341,1 +1338,1 @@\n-   *   tt_size_reset\n+   *   tt_size_reset_height\n@@ -1344,2 +1341,3 @@\n-   *   Reset a TrueType size when resolutions and character dimensions\n-   *   have been changed.\n+   *   Recompute a TrueType size's ascender, descender, and height\n+   *   when resolutions and character dimensions have been changed.\n+   *   Used for variation fonts as an iterator function.\n@@ -1348,7 +1346,5 @@\n-   *   size ::\n-   *     A handle to the target size object.\n-   *\n-   *   only_height ::\n-   *     Only recompute ascender, descender, and height;\n-   *     this flag is used for variation fonts where\n-   *     `tt_size_reset' is used as an iterator function.\n+   *   ft_size ::\n+   *     A handle to the target TT_Size object. This function will be called\n+   *     through a `FT_Size_Reset_Func` pointer which takes `FT_Size`. This\n+   *     function must take `FT_Size` as a result. The passed `FT_Size` is\n+   *     expected to point to a `TT_Size`.\n@@ -1357,2 +1353,1 @@\n-  tt_size_reset( TT_Size  size,\n-                 FT_Bool  only_height )\n+  tt_size_reset_height( FT_Size  ft_size )\n@@ -1360,9 +1355,3 @@\n-    TT_Face           face;\n-    FT_Size_Metrics*  size_metrics;\n-\n-\n-    face = (TT_Face)size->root.face;\n-\n-    \/* nothing to do for CFF2 *\/\n-    if ( face->is_cff2 )\n-      return FT_Err_Ok;\n+    TT_Size           size         = (TT_Size)ft_size;\n+    TT_Face           face         = (TT_Face)size->root.face;\n+    FT_Size_Metrics*  size_metrics = &size->hinted_metrics;\n@@ -1372,2 +1361,0 @@\n-    size_metrics = &size->hinted_metrics;\n-\n@@ -1400,6 +1387,28 @@\n-    if ( only_height )\n-    {\n-      \/* we must not recompute the scaling values here since       *\/\n-      \/* `tt_size_reset' was already called (with only_height = 0) *\/\n-      return FT_Err_Ok;\n-    }\n+    return FT_Err_Ok;\n+  }\n+\n+\n+  \/**************************************************************************\n+   *\n+   * @Function:\n+   *   tt_size_reset\n+   *\n+   * @Description:\n+   *   Reset a TrueType size when resolutions and character dimensions\n+   *   have been changed.\n+   *\n+   * @Input:\n+   *   size ::\n+   *     A handle to the target size object.\n+   *\/\n+  FT_LOCAL_DEF( FT_Error )\n+  tt_size_reset( TT_Size  size )\n+  {\n+    FT_Error          error;\n+    TT_Face           face         = (TT_Face)size->root.face;\n+    FT_Size_Metrics*  size_metrics = &size->hinted_metrics;\n+\n+\n+    error = tt_size_reset_height( (FT_Size)size );\n+    if ( error )\n+      return error;\n@@ -1475,3 +1484,0 @@\n-#ifdef TT_SUPPORT_SUBPIXEL_HINTING_INFINALITY\n-    driver->interpreter_version = TT_INTERPRETER_VERSION_38;\n-#endif\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttobjs.c","additions":47,"deletions":41,"binary":false,"changes":88,"status":"modified"},{"patch":"@@ -165,2 +165,0 @@\n-    FT_Bool   inline_delta;   \/* is function that defines inline delta? *\/\n-    FT_ULong  sph_fdef_flags; \/* flags to identify special functions    *\/\n@@ -394,2 +392,4 @@\n-  tt_size_reset( TT_Size  size,\n-                 FT_Bool  only_height );\n+  tt_size_reset_height( FT_Size  size );\n+\n+  FT_LOCAL( FT_Error )\n+  tt_size_reset( TT_Size  size );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttobjs.h","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -183,3 +183,3 @@\n-  tt_face_get_location( TT_Face   face,\n-                        FT_UInt   gindex,\n-                        FT_UInt  *asize )\n+  tt_face_get_location( FT_Face    face,   \/* TT_Face *\/\n+                        FT_UInt    gindex,\n+                        FT_ULong  *asize )\n@@ -187,0 +187,1 @@\n+    TT_Face   ttface = (TT_Face)face;\n@@ -194,1 +195,1 @@\n-    if ( gindex < face->num_locations )\n+    if ( gindex < ttface->num_locations )\n@@ -196,1 +197,1 @@\n-      if ( face->header.Index_To_Loc_Format != 0 )\n+      if ( ttface->header.Index_To_Loc_Format != 0 )\n@@ -198,2 +199,2 @@\n-        p       = face->glyph_locations + gindex * 4;\n-        p_limit = face->glyph_locations + face->num_locations * 4;\n+        p       = ttface->glyph_locations + gindex * 4;\n+        p_limit = ttface->glyph_locations + ttface->num_locations * 4;\n@@ -209,2 +210,2 @@\n-        p       = face->glyph_locations + gindex * 2;\n-        p_limit = face->glyph_locations + face->num_locations * 2;\n+        p       = ttface->glyph_locations + gindex * 2;\n+        p_limit = ttface->glyph_locations + ttface->num_locations * 2;\n@@ -224,1 +225,1 @@\n-    if ( pos1 > face->glyf_len )\n+    if ( pos1 > ttface->glyf_len )\n@@ -231,1 +232,1 @@\n-                  face->glyf_len ));\n+                  ttface->glyf_len ));\n@@ -236,1 +237,1 @@\n-    if ( pos2 > face->glyf_len )\n+    if ( pos2 > ttface->glyf_len )\n@@ -239,1 +240,1 @@\n-      if ( gindex == face->num_locations - 2 )\n+      if ( gindex == ttface->num_locations - 2 )\n@@ -246,2 +247,2 @@\n-                    face->glyf_len - pos1 ));\n-        pos2 = face->glyf_len;\n+                    ttface->glyf_len - pos1 ));\n+        pos2 = ttface->glyf_len;\n@@ -256,1 +257,1 @@\n-                    face->glyf_len ));\n+                    ttface->glyf_len ));\n@@ -271,1 +272,1 @@\n-      *asize = (FT_UInt)( pos2 - pos1 );\n+      *asize = (FT_ULong)( pos2 - pos1 );\n@@ -273,1 +274,1 @@\n-      *asize = (FT_UInt)( face->glyf_len - pos1 );\n+      *asize = (FT_ULong)( ttface->glyf_len - pos1 );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttpload.c","additions":19,"deletions":18,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -34,3 +34,3 @@\n-  tt_face_get_location( TT_Face   face,\n-                        FT_UInt   gindex,\n-                        FT_UInt  *asize );\n+  tt_face_get_location( FT_Face    face,\n+                        FT_UInt    gindex,\n+                        FT_ULong  *asize );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/truetype\/ttpload.h","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -408,1 +408,1 @@\n-  typedef int  _t1_afm_dummy;\n+  typedef int  t1_afm_dummy_;\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/type1\/t1afm.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -59,2 +59,2 @@\n-  static FT_Error\n-  t1_get_glyph_name( T1_Face     face,\n+  FT_CALLBACK_DEF( FT_Error )\n+  t1_get_glyph_name( FT_Face     face,        \/* T1_Face *\/\n@@ -65,1 +65,4 @@\n-    FT_STRCPYN( buffer, face->type1.glyph_names[glyph_index], buffer_max );\n+    T1_Face  t1face = (T1_Face)face;\n+\n+\n+    FT_STRCPYN( buffer, t1face->type1.glyph_names[glyph_index], buffer_max );\n@@ -71,2 +74,2 @@\n-  static FT_UInt\n-  t1_get_name_index( T1_Face           face,\n+  FT_CALLBACK_DEF( FT_UInt )\n+  t1_get_name_index( FT_Face           face,        \/* T1_Face *\/\n@@ -75,1 +78,2 @@\n-    FT_Int  i;\n+    T1_Face  t1face = (T1_Face)face;\n+    FT_Int   i;\n@@ -78,1 +82,1 @@\n-    for ( i = 0; i < face->type1.num_glyphs; i++ )\n+    for ( i = 0; i < t1face->type1.num_glyphs; i++ )\n@@ -80,1 +84,1 @@\n-      FT_String*  gname = face->type1.glyph_names[i];\n+      FT_String*  gname = t1face->type1.glyph_names[i];\n@@ -93,2 +97,2 @@\n-    (FT_GlyphDict_GetNameFunc)  t1_get_glyph_name,    \/* get_name   *\/\n-    (FT_GlyphDict_NameIndexFunc)t1_get_name_index     \/* name_index *\/\n+    t1_get_glyph_name,  \/* FT_GlyphDict_GetNameFunc   get_name   *\/\n+    t1_get_name_index   \/* FT_GlyphDict_NameIndexFunc name_index *\/\n@@ -104,1 +108,1 @@\n-  t1_get_ps_name( T1_Face  face )\n+  t1_get_ps_name( FT_Face  face )    \/* T1_Face *\/\n@@ -106,1 +110,4 @@\n-    return (const char*) face->type1.font_name;\n+    T1_Face  t1face = (T1_Face)face;\n+\n+\n+    return (const char*) t1face->type1.font_name;\n@@ -124,24 +131,22 @@\n-    (FT_Get_MM_Func)        T1_Get_Multi_Master,    \/* get_mm                    *\/\n-    (FT_Set_MM_Design_Func) T1_Set_MM_Design,       \/* set_mm_design             *\/\n-    (FT_Set_MM_Blend_Func)  T1_Set_MM_Blend,        \/* set_mm_blend              *\/\n-    (FT_Get_MM_Blend_Func)  T1_Get_MM_Blend,        \/* get_mm_blend              *\/\n-    (FT_Get_MM_Var_Func)    T1_Get_MM_Var,          \/* get_mm_var                *\/\n-    (FT_Set_Var_Design_Func)T1_Set_Var_Design,      \/* set_var_design            *\/\n-    (FT_Get_Var_Design_Func)T1_Get_Var_Design,      \/* get_var_design            *\/\n-    (FT_Set_Instance_Func)  T1_Reset_MM_Blend,      \/* set_instance              *\/\n-    (FT_Set_MM_WeightVector_Func)\n-                            T1_Set_MM_WeightVector, \/* set_mm_weightvector       *\/\n-    (FT_Get_MM_WeightVector_Func)\n-                            T1_Get_MM_WeightVector, \/* get_mm_weightvector       *\/\n-    (FT_Var_Load_Delta_Set_Idx_Map_Func)\n-                            NULL,                   \/* load_delta_set_idx_map    *\/\n-    (FT_Var_Load_Item_Var_Store_Func)\n-                            NULL,                   \/* load_item_variation_store *\/\n-    (FT_Var_Get_Item_Delta_Func)\n-                            NULL,                   \/* get_item_delta            *\/\n-    (FT_Var_Done_Item_Var_Store_Func)\n-                            NULL,                   \/* done_item_variation_store *\/\n-    (FT_Var_Done_Delta_Set_Idx_Map_Func)\n-                            NULL,                   \/* done_delta_set_index_map  *\/\n-    (FT_Get_Var_Blend_Func) NULL,                   \/* get_var_blend             *\/\n-    (FT_Done_Blend_Func)    T1_Done_Blend           \/* done_blend                *\/\n+    T1_Get_Multi_Master,    \/* FT_Get_MM_Func             get_mm             *\/\n+    T1_Set_MM_Design,       \/* FT_Set_MM_Design_Func      set_mm_design      *\/\n+    T1_Set_MM_Blend,        \/* FT_Set_MM_Blend_Func       set_mm_blend       *\/\n+    T1_Get_MM_Blend,        \/* FT_Get_MM_Blend_Func       get_mm_blend       *\/\n+    T1_Get_MM_Var,          \/* FT_Get_MM_Var_Func         get_mm_var         *\/\n+    T1_Set_Var_Design,      \/* FT_Set_Var_Design_Func     set_var_design     *\/\n+    T1_Get_Var_Design,      \/* FT_Get_Var_Design_Func     get_var_design     *\/\n+    T1_Reset_MM_Blend,      \/* FT_Set_Named_Instance_Func set_named_instance *\/\n+    NULL,   \/* FT_Get_Default_Named_Instance_Func get_default_named_instance *\/\n+    T1_Set_MM_WeightVector,\n+            \/* FT_Set_MM_WeightVector_Func        set_mm_weightvector        *\/\n+    T1_Get_MM_WeightVector,\n+            \/* FT_Get_MM_WeightVector_Func        get_mm_weightvector        *\/\n+\n+    NULL,   \/* FT_Construct_PS_Name_Func          construct_ps_name          *\/\n+    NULL,   \/* FT_Var_Load_Delta_Set_Idx_Map_Func load_delta_set_idx_map     *\/\n+    NULL,   \/* FT_Var_Load_Item_Var_Store_Func    load_item_variation_store  *\/\n+    NULL,   \/* FT_Var_Get_Item_Delta_Func         get_item_delta             *\/\n+    NULL,   \/* FT_Var_Done_Item_Var_Store_Func    done_item_variation_store  *\/\n+    NULL,   \/* FT_Var_Done_Delta_Set_Idx_Map_Func done_delta_set_index_map   *\/\n+    NULL,           \/* FT_Get_Var_Blend_Func      get_var_blend              *\/\n+    T1_Done_Blend   \/* FT_Done_Blend_Func         done_blend                 *\/\n@@ -635,5 +640,5 @@\n-    (PS_GetFontInfoFunc)   t1_ps_get_font_info,    \/* ps_get_font_info    *\/\n-    (PS_GetFontExtraFunc)  t1_ps_get_font_extra,   \/* ps_get_font_extra   *\/\n-    (PS_HasGlyphNamesFunc) t1_ps_has_glyph_names,  \/* ps_has_glyph_names  *\/\n-    (PS_GetFontPrivateFunc)t1_ps_get_font_private, \/* ps_get_font_private *\/\n-    (PS_GetFontValueFunc)  t1_ps_get_font_value,   \/* ps_get_font_value   *\/\n+    t1_ps_get_font_info,     \/* PS_GetFontInfoFunc    ps_get_font_info    *\/\n+    t1_ps_get_font_extra,    \/* PS_GetFontExtraFunc   ps_get_font_extra   *\/\n+    t1_ps_has_glyph_names,   \/* PS_HasGlyphNamesFunc  ps_has_glyph_names  *\/\n+    t1_ps_get_font_private,  \/* PS_GetFontPrivateFunc ps_get_font_private *\/\n+    t1_ps_get_font_value,    \/* PS_GetFontValueFunc   ps_get_font_value   *\/\n@@ -659,3 +664,3 @@\n-    (FT_Properties_SetFunc)ps_property_set,      \/* set_property *\/\n-    (FT_Properties_GetFunc)ps_property_get )     \/* get_property *\/\n-\n+    ps_property_set,  \/* FT_Properties_SetFunc set_property *\/\n+    ps_property_get   \/* FT_Properties_GetFunc get_property *\/\n+  )\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/type1\/t1driver.c","additions":49,"deletions":44,"binary":false,"changes":93,"status":"modified"},{"patch":"@@ -76,1 +76,2 @@\n-#define IS_INCREMENTAL  FT_BOOL( face->root.internal->incremental_interface )\n+#define IS_INCREMENTAL  \\\n+          FT_BOOL( FT_FACE( face )->internal->incremental_interface )\n@@ -177,1 +178,1 @@\n-  T1_Get_Multi_Master( T1_Face           face,\n+  T1_Get_Multi_Master( FT_Face           face,    \/* T1_Face *\/\n@@ -180,1 +181,2 @@\n-    PS_Blend  blend = face->blend;\n+    T1_Face   t1face = (T1_Face)face;\n+    PS_Blend  blend  = t1face->blend;\n@@ -228,5 +230,6 @@\n-        return INT_TO_FIXED( axismap->design_points[j - 1] ) +\n-               ( axismap->design_points[j] - axismap->design_points[j - 1] ) *\n-               FT_DivFix( ncv - axismap->blend_points[j - 1],\n-                          axismap->blend_points[j] -\n-                            axismap->blend_points[j - 1] );\n+        return INT_TO_FIXED( axismap->design_points[j - 1] +\n+                               FT_MulDiv( ncv - axismap->blend_points[j - 1],\n+                                          axismap->design_points[j] -\n+                                            axismap->design_points[j - 1],\n+                                          axismap->blend_points[j] -\n+                                            axismap->blend_points[j - 1] ) );\n@@ -287,1 +290,1 @@\n-  T1_Get_MM_Var( T1_Face      face,\n+  T1_Get_MM_Var( FT_Face      face,    \/* T1_Face *\/\n@@ -290,2 +293,3 @@\n-    FT_Memory        memory = face->root.memory;\n-    FT_MM_Var       *mmvar = NULL;\n+    T1_Face          t1face = (T1_Face)face;\n+    FT_Memory        memory = FT_FACE_MEMORY( face );\n+    FT_MM_Var       *mmvar  = NULL;\n@@ -296,1 +300,1 @@\n-    PS_Blend         blend = face->blend;\n+    PS_Blend         blend  = t1face->blend;\n@@ -322,3 +326,3 @@\n-    if ( FT_ALLOC( mmvar, mmvar_size +\n-                          axis_flags_size +\n-                          axis_size ) )\n+    if ( FT_QALLOC( mmvar, mmvar_size +\n+                           axis_flags_size +\n+                           axis_size ) )\n@@ -335,2 +339,1 @@\n-    for ( i = 0; i < mmaster.num_axis; i++ )\n-      axis_flags[i] = 0;\n+    FT_ARRAY_ZERO( axis_flags, mmaster.num_axis );\n@@ -441,1 +444,1 @@\n-  T1_Set_MM_Blend( T1_Face    face,\n+  T1_Set_MM_Blend( FT_Face    face,       \/* T1_Face *\/\n@@ -445,13 +448,1 @@\n-    FT_Error  error;\n-\n-\n-    error = t1_set_mm_blend( face, num_coords, coords );\n-    if ( error )\n-      return error;\n-\n-    if ( num_coords )\n-      face->root.face_flags |= FT_FACE_FLAG_VARIATION;\n-    else\n-      face->root.face_flags &= ~FT_FACE_FLAG_VARIATION;\n-\n-    return FT_Err_Ok;\n+    return t1_set_mm_blend( (T1_Face)face, num_coords, coords );\n@@ -462,1 +453,1 @@\n-  T1_Get_MM_Blend( T1_Face    face,\n+  T1_Get_MM_Blend( FT_Face    face,       \/* T1_Face *\/\n@@ -466,1 +457,2 @@\n-    PS_Blend  blend = face->blend;\n+    T1_Face   t1face = (T1_Face)face;\n+    PS_Blend  blend  = t1face->blend;\n@@ -497,1 +489,1 @@\n-  T1_Set_MM_WeightVector( T1_Face    face,\n+  T1_Set_MM_WeightVector( FT_Face    face,          \/* T1_Face *\/\n@@ -501,1 +493,2 @@\n-    PS_Blend  blend = face->blend;\n+    T1_Face   t1face = (T1_Face)face;\n+    PS_Blend  blend  = t1face->blend;\n@@ -525,5 +518,0 @@\n-\n-      if ( len )\n-        face->root.face_flags |= FT_FACE_FLAG_VARIATION;\n-      else\n-        face->root.face_flags &= ~FT_FACE_FLAG_VARIATION;\n@@ -537,1 +525,1 @@\n-  T1_Get_MM_WeightVector( T1_Face    face,\n+  T1_Get_MM_WeightVector( FT_Face    face,          \/* T1_Face *\/\n@@ -541,1 +529,2 @@\n-    PS_Blend  blend = face->blend;\n+    T1_Face   t1face = (T1_Face)face;\n+    PS_Blend  blend  = t1face->blend;\n@@ -566,1 +555,1 @@\n-  T1_Set_MM_Design( T1_Face   face,\n+  T1_Set_MM_Design( FT_Face   face,       \/* T1_Face *\/\n@@ -570,0 +559,1 @@\n+    T1_Face   t1face = (T1_Face)face;\n@@ -571,1 +561,1 @@\n-    PS_Blend  blend = face->blend;\n+    PS_Blend  blend  = t1face->blend;\n@@ -637,1 +627,1 @@\n-    error = t1_set_mm_blend( face, blend->num_axis, final_blends );\n+    error = t1_set_mm_blend( t1face, blend->num_axis, final_blends );\n@@ -641,5 +631,0 @@\n-    if ( num_coords )\n-      face->root.face_flags |= FT_FACE_FLAG_VARIATION;\n-    else\n-      face->root.face_flags &= ~FT_FACE_FLAG_VARIATION;\n-\n@@ -653,1 +638,1 @@\n-  T1_Reset_MM_Blend( T1_Face  face,\n+  T1_Reset_MM_Blend( FT_Face  face,\n@@ -668,1 +653,1 @@\n-  T1_Set_Var_Design( T1_Face    face,\n+  T1_Set_Var_Design( FT_Face    face,       \/* T1_Face *\/\n@@ -687,1 +672,1 @@\n-  T1_Get_Var_Design( T1_Face    face,\n+  T1_Get_Var_Design( FT_Face    face,       \/* T1_Face *\/\n@@ -691,1 +676,2 @@\n-    PS_Blend  blend = face->blend;\n+    T1_Face   t1face = (T1_Face)face;\n+    PS_Blend  blend  = t1face->blend;\n@@ -723,1 +709,1 @@\n-  T1_Done_Blend( T1_Face  face )\n+  T1_Done_Blend( FT_Face  face )    \/* T1_Face *\/\n@@ -725,2 +711,3 @@\n-    FT_Memory  memory = face->root.memory;\n-    PS_Blend   blend  = face->blend;\n+    T1_Face    t1face = (T1_Face)face;\n+    FT_Memory  memory = FT_FACE_MEMORY( face );\n+    PS_Blend   blend  = t1face->blend;\n@@ -771,1 +758,1 @@\n-      FT_FREE( face->blend );\n+      FT_FREE( t1face->blend );\n@@ -777,2 +764,2 @@\n-  parse_blend_axis_types( T1_Face    face,\n-                          T1_Loader  loader )\n+  parse_blend_axis_types( FT_Face  face,     \/* T1_Face *\/\n+                          void*    loader_ )\n@@ -780,0 +767,2 @@\n+    T1_Face      t1face = (T1_Face)face;\n+    T1_Loader    loader = (T1_Loader)loader_;\n@@ -782,1 +771,1 @@\n-    FT_Error     error = FT_Err_Ok;\n+    FT_Error     error  = FT_Err_Ok;\n@@ -784,1 +773,1 @@\n-    FT_Memory    memory;\n+    FT_Memory    memory = FT_FACE_MEMORY( face );\n@@ -804,1 +793,1 @@\n-    error = t1_allocate_blend( face, 0, (FT_UInt)num_axis );\n+    error = t1_allocate_blend( t1face, 0, (FT_UInt)num_axis );\n@@ -810,2 +799,1 @@\n-    blend  = face->blend;\n-    memory = face->root.memory;\n+    blend = t1face->blend;\n@@ -859,2 +847,2 @@\n-  parse_blend_design_positions( T1_Face    face,\n-                                T1_Loader  loader )\n+  parse_blend_design_positions( FT_Face  face,     \/* T1_Face *\/\n+                                void*    loader_ )\n@@ -862,0 +850,2 @@\n+    T1_Face      t1face   = (T1_Face)face;\n+    T1_Loader    loader   = (T1_Loader)loader_;\n@@ -866,1 +856,1 @@\n-    FT_Memory    memory   = face->root.memory;\n+    FT_Memory    memory   = FT_FACE_MEMORY( face );\n@@ -924,1 +914,1 @@\n-          error = t1_allocate_blend( face,\n+          error = t1_allocate_blend( t1face,\n@@ -965,1 +955,1 @@\n-      blend = face->blend;\n+      blend = t1face->blend;\n@@ -983,2 +973,2 @@\n-  parse_blend_design_map( T1_Face    face,\n-                          T1_Loader  loader )\n+  parse_blend_design_map( FT_Face  face,     \/* T1_Face *\/\n+                          void*    loader_ )\n@@ -986,0 +976,2 @@\n+    T1_Face      t1face = (T1_Face)face;\n+    T1_Loader    loader = (T1_Loader)loader_;\n@@ -993,1 +985,1 @@\n-    FT_Memory    memory = face->root.memory;\n+    FT_Memory    memory = FT_FACE_MEMORY( face );\n@@ -1014,1 +1006,1 @@\n-    error = t1_allocate_blend( face, 0, (FT_UInt)num_axis );\n+    error = t1_allocate_blend( t1face, 0, (FT_UInt)num_axis );\n@@ -1017,1 +1009,1 @@\n-    blend = face->blend;\n+    blend = t1face->blend;\n@@ -1092,2 +1084,2 @@\n-  parse_weight_vector( T1_Face    face,\n-                       T1_Loader  loader )\n+  parse_weight_vector( FT_Face  face,     \/* T1_Face *\/\n+                       void*    loader_ )\n@@ -1095,0 +1087,2 @@\n+    T1_Face      t1face = (T1_Face)face;\n+    T1_Loader    loader = (T1_Loader)loader_;\n@@ -1098,1 +1092,1 @@\n-    FT_Memory    memory = face->root.memory;\n+    FT_Memory    memory = FT_FACE_MEMORY( face );\n@@ -1100,1 +1094,1 @@\n-    PS_Blend     blend  = face->blend;\n+    PS_Blend     blend  = t1face->blend;\n@@ -1125,1 +1119,1 @@\n-      error = t1_allocate_blend( face, (FT_UInt)num_designs, 0 );\n+      error = t1_allocate_blend( t1face, (FT_UInt)num_designs, 0 );\n@@ -1128,1 +1122,1 @@\n-      blend = face->blend;\n+      blend = t1face->blend;\n@@ -1176,2 +1170,2 @@\n-  parse_buildchar( T1_Face    face,\n-                   T1_Loader  loader )\n+  parse_buildchar( FT_Face  face,     \/* T1_Face *\/\n+                   void*    loader_ )\n@@ -1179,2 +1173,6 @@\n-    face->len_buildchar = (FT_UInt)T1_ToFixedArray( &loader->parser,\n-                                                    0, NULL, 0 );\n+    T1_Face    t1face = (T1_Face)face;\n+    T1_Loader  loader = (T1_Loader)loader_;\n+\n+\n+    t1face->len_buildchar = (FT_UInt)T1_ToFixedArray( &loader->parser,\n+                                                      0, NULL, 0 );\n@@ -1188,1 +1186,1 @@\n-      for ( i = 0; i < face->len_buildchar; i++ )\n+      for ( i = 0; i < t1face->len_buildchar; i++ )\n@@ -1338,2 +1336,2 @@\n-  parse_private( T1_Face    face,\n-                 T1_Loader  loader )\n+  parse_private( FT_Face  face,\n+                 void*    loader_ )\n@@ -1341,0 +1339,1 @@\n+    T1_Loader  loader = (T1_Loader)loader_;\n@@ -1404,2 +1403,2 @@\n-  t1_parse_font_matrix( T1_Face    face,\n-                        T1_Loader  loader )\n+  t1_parse_font_matrix( FT_Face  face,     \/* T1_Face *\/\n+                        void*    loader_ )\n@@ -1407,0 +1406,2 @@\n+    T1_Face     t1face = (T1_Face)face;\n+    T1_Loader   loader = (T1_Loader)loader_;\n@@ -1408,3 +1409,2 @@\n-    FT_Matrix*  matrix = &face->type1.font_matrix;\n-    FT_Vector*  offset = &face->type1.font_offset;\n-    FT_Face     root   = (FT_Face)&face->root;\n+    FT_Matrix*  matrix = &t1face->type1.font_matrix;\n+    FT_Vector*  offset = &t1face->type1.font_offset;\n@@ -1446,1 +1446,1 @@\n-      root->units_per_EM = (FT_UShort)FT_DivFix( 1000, temp_scale );\n+      face->units_per_EM = (FT_UShort)FT_DivFix( 1000, temp_scale );\n@@ -1474,2 +1474,2 @@\n-  parse_encoding( T1_Face    face,\n-                  T1_Loader  loader )\n+  parse_encoding( FT_Face  face,     \/* T1_Face *\/\n+                  void*    loader_ )\n@@ -1477,0 +1477,2 @@\n+    T1_Face    t1face = (T1_Face)face;\n+    T1_Loader  loader = (T1_Loader)loader_;\n@@ -1481,1 +1483,1 @@\n-    PSAux_Service  psaux = (PSAux_Service)face->psaux;\n+    PSAux_Service  psaux = (PSAux_Service)t1face->psaux;\n@@ -1497,1 +1499,1 @@\n-      T1_Encoding  encode          = &face->type1.encoding;\n+      T1_Encoding  encode          = &t1face->type1.encoding;\n@@ -1679,1 +1681,1 @@\n-      face->type1.encoding_type = T1_ENCODING_TYPE_ARRAY;\n+      t1face->type1.encoding_type = T1_ENCODING_TYPE_ARRAY;\n@@ -1690,1 +1692,1 @@\n-        face->type1.encoding_type = T1_ENCODING_TYPE_STANDARD;\n+        t1face->type1.encoding_type = T1_ENCODING_TYPE_STANDARD;\n@@ -1697,1 +1699,1 @@\n-        face->type1.encoding_type = T1_ENCODING_TYPE_EXPERT;\n+        t1face->type1.encoding_type = T1_ENCODING_TYPE_EXPERT;\n@@ -1704,1 +1706,1 @@\n-        face->type1.encoding_type = T1_ENCODING_TYPE_ISOLATIN1;\n+        t1face->type1.encoding_type = T1_ENCODING_TYPE_ISOLATIN1;\n@@ -1718,2 +1720,2 @@\n-  parse_subrs( T1_Face    face,\n-               T1_Loader  loader )\n+  parse_subrs( FT_Face  face,     \/* T1_Face *\/\n+               void*    loader_ )\n@@ -1721,0 +1723,2 @@\n+    T1_Face    t1face = (T1_Face)face;\n+    T1_Loader  loader = (T1_Loader)loader_;\n@@ -1728,1 +1732,1 @@\n-    PSAux_Service  psaux = (PSAux_Service)face->psaux;\n+    PSAux_Service  psaux = (PSAux_Service)t1face->psaux;\n@@ -1772,1 +1776,1 @@\n-                  \" (from %d to %ld)\\n\",\n+                  \" (from %d to %zu)\\n\",\n@@ -1860,1 +1864,1 @@\n-      if ( face->type1.private_dict.lenIV >= 0 )\n+      if ( t1face->type1.private_dict.lenIV >= 0 )\n@@ -1868,1 +1872,1 @@\n-        if ( size < (FT_ULong)face->type1.private_dict.lenIV )\n+        if ( size < (FT_ULong)t1face->type1.private_dict.lenIV )\n@@ -1879,3 +1883,5 @@\n-        size -= (FT_ULong)face->type1.private_dict.lenIV;\n-        error = T1_Add_Table( table, (FT_Int)idx,\n-                              temp + face->type1.private_dict.lenIV, size );\n+        size -= (FT_ULong)t1face->type1.private_dict.lenIV;\n+        error = T1_Add_Table( table,\n+                              (FT_Int)idx,\n+                              temp + t1face->type1.private_dict.lenIV,\n+                              size );\n@@ -1913,2 +1919,2 @@\n-  parse_charstrings( T1_Face    face,\n-                     T1_Loader  loader )\n+  parse_charstrings( FT_Face  face,     \/* T1_Face *\/\n+                     void*    loader_ )\n@@ -1916,0 +1922,2 @@\n+    T1_Face        t1face       = (T1_Face)face;\n+    T1_Loader      loader       = (T1_Loader)loader_;\n@@ -1923,1 +1931,1 @@\n-    PSAux_Service  psaux        = (PSAux_Service)face->psaux;\n+    PSAux_Service  psaux        = (PSAux_Service)t1face->psaux;\n@@ -1943,1 +1951,1 @@\n-                  \" (from %d to %ld)\\n\",\n+                  \" (from %d to %zu)\\n\",\n@@ -2072,1 +2080,1 @@\n-        if ( face->type1.private_dict.lenIV >= 0 &&\n+        if ( t1face->type1.private_dict.lenIV >= 0 &&\n@@ -2078,1 +2086,1 @@\n-          if ( size <= (FT_ULong)face->type1.private_dict.lenIV )\n+          if ( size <= (FT_ULong)t1face->type1.private_dict.lenIV )\n@@ -2089,3 +2097,5 @@\n-          size -= (FT_ULong)face->type1.private_dict.lenIV;\n-          error = T1_Add_Table( code_table, n,\n-                                temp + face->type1.private_dict.lenIV, size );\n+          size -= (FT_ULong)t1face->type1.private_dict.lenIV;\n+          error = T1_Add_Table( code_table,\n+                                n,\n+                                temp + t1face->type1.private_dict.lenIV,\n+                                size );\n@@ -2573,1 +2583,1 @@\n-      T1_Done_Blend( face );\n+      T1_Done_Blend( FT_FACE( face ) );\n@@ -2593,1 +2603,1 @@\n-      T1_Done_Blend( face );\n+      T1_Done_Blend( FT_FACE( face ) );\n@@ -2597,1 +2607,1 @@\n-      T1_Done_Blend( face );\n+      T1_Done_Blend( FT_FACE( face ) );\n@@ -2601,1 +2611,1 @@\n-      T1_Done_Blend( face );\n+      T1_Done_Blend( FT_FACE( face ) );\n@@ -2612,1 +2622,1 @@\n-          T1_Done_Blend( face );\n+          T1_Done_Blend( FT_FACE( face ) );\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/type1\/t1load.c","additions":135,"deletions":125,"binary":false,"changes":260,"status":"modified"},{"patch":"@@ -69,1 +69,1 @@\n-  T1_Get_Multi_Master( T1_Face           face,\n+  T1_Get_Multi_Master( FT_Face           face,\n@@ -73,1 +73,1 @@\n-  T1_Get_MM_Var( T1_Face      face,\n+  T1_Get_MM_Var( FT_Face      face,\n@@ -77,1 +77,1 @@\n-  T1_Set_MM_Blend( T1_Face    face,\n+  T1_Set_MM_Blend( FT_Face    face,\n@@ -82,1 +82,1 @@\n-  T1_Get_MM_Blend( T1_Face    face,\n+  T1_Get_MM_Blend( FT_Face    face,\n@@ -87,1 +87,1 @@\n-  T1_Set_MM_Design( T1_Face   face,\n+  T1_Set_MM_Design( FT_Face   face,\n@@ -92,1 +92,1 @@\n-  T1_Reset_MM_Blend( T1_Face  face,\n+  T1_Reset_MM_Blend( FT_Face  face,\n@@ -96,1 +96,1 @@\n-  T1_Get_Var_Design( T1_Face    face,\n+  T1_Get_Var_Design( FT_Face    face,\n@@ -101,1 +101,1 @@\n-  T1_Set_Var_Design( T1_Face    face,\n+  T1_Set_Var_Design( FT_Face    face,\n@@ -106,1 +106,1 @@\n-  T1_Done_Blend( T1_Face  face );\n+  T1_Done_Blend( FT_Face  face );\n@@ -109,1 +109,1 @@\n-  T1_Set_MM_WeightVector( T1_Face    face,\n+  T1_Set_MM_WeightVector( FT_Face    face,\n@@ -114,1 +114,1 @@\n-  T1_Get_MM_WeightVector( T1_Face    face,\n+  T1_Get_MM_WeightVector( FT_Face    face,\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/type1\/t1load.h","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -170,2 +170,1 @@\n-      module = FT_Get_Module( slot->face->driver->root.library,\n-                              \"pshinter\" );\n+      module = FT_Get_Module( slot->library, \"pshinter\" );\n@@ -230,1 +229,1 @@\n-    T1_Done_Blend( face );\n+    T1_Done_Blend( t1face );\n@@ -293,1 +292,2 @@\n-   *     input stream where to load font data.\n+   *     Dummy argument for compatibility with the `FT_Face_InitFunc` API.\n+   *     Ignored.  The stream should be passed through `face->root.stream`.\n","filename":"jdk\/src\/share\/native\/sun\/awt\/libfreetype\/src\/type1\/t1objs.c","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}