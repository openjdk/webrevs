{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2008, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,2 +42,0 @@\n-    private static final long NUM_THREAD_DUMPS = 100;\n-\n@@ -46,1 +44,0 @@\n-    private static final long MAX_VALUE_FOR_PASS = Long.MAX_VALUE;\n@@ -48,1 +45,11 @@\n-    private static boolean trace = false;\n+    \/\/ Thread.getAllStackTraces() should cause safepoints.\n+    \/\/ If this test is failing because it doesn't,\n+    \/\/ MIN_VALUE_FOR_PASS should be reset to 0\n+    public static long executeThreadDumps(long initial_value) {\n+        long value;\n+        do {\n+            Thread.getAllStackTraces();\n+            value = mbean.getTotalSafepointTime();\n+        } while (value == initial_value);\n+        return value;\n+    }\n@@ -51,12 +58,2 @@\n-        if (args.length > 0 && args[0].equals(\"trace\")) {\n-            trace = true;\n-        }\n-\n-        \/\/ Thread.getAllStackTraces() should cause safepoints.\n-        \/\/ If this test is failing because it doesn't,\n-        \/\/ MIN_VALUE_FOR_PASS should be reset to 0\n-        for (int i = 0; i < NUM_THREAD_DUMPS; i++) {\n-             Thread.getAllStackTraces();\n-        }\n-\n-        long value = mbean.getTotalSafepointTime();\n+        long value = executeThreadDumps(0);\n+        System.out.println(\"Total safepoint time (ms): \" + value);\n@@ -64,5 +61,1 @@\n-        if (trace) {\n-            System.out.println(\"Total safepoint time (ms): \" + value);\n-        }\n-\n-        if (value < MIN_VALUE_FOR_PASS || value > MAX_VALUE_FOR_PASS) {\n+        if (value < MIN_VALUE_FOR_PASS) {\n@@ -71,2 +64,1 @@\n-                                       \"(MIN = \" + MIN_VALUE_FOR_PASS + \"; \" +\n-                                       \"MAX = \" + MAX_VALUE_FOR_PASS + \")\");\n+                                       \"(MIN = \" + MIN_VALUE_FOR_PASS + \")\");\n@@ -75,8 +67,2 @@\n-        for (int i = 0; i < 2 * NUM_THREAD_DUMPS; i++) {\n-             Thread.getAllStackTraces();\n-        }\n-        long value2 = mbean.getTotalSafepointTime();\n-\n-        if (trace) {\n-            System.out.println(\"Total safepoint time2 (ms): \" + value2);\n-        }\n+        long value2 = executeThreadDumps(value);\n+        System.out.println(\"Total safepoint time (ms): \" + value2);\n","filename":"jdk\/test\/sun\/management\/HotspotRuntimeMBean\/GetTotalSafepointTime.java","additions":18,"deletions":32,"binary":false,"changes":50,"status":"modified"}]}