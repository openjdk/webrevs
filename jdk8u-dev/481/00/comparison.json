{"files":[{"patch":"@@ -30,1 +30,4 @@\n- * @run main\/othervm\/timeout=300 -Dsun.net.spi.nameservice.provider.1=ns,mock ReplayCacheTestProc\n+ * @run main\/othervm\/timeout=300 -Dsun.net.spi.nameservice.provider.1=ns,mock\n+ *      -Dtest.libs=J ReplayCacheTestProc\n+ * @run main\/othervm\/timeout=300 -Dsun.net.spi.nameservice.provider.1=ns,mock\n+ *      -Dtest.libs=N ReplayCacheTestProc\n@@ -46,0 +49,1 @@\n+import jdk.test.lib.Asserts;\n@@ -54,1 +58,1 @@\n- * - test.libs on what types of acceptors to use\n+ * - test.libs on what types of acceptors to use. Cannot be null.\n@@ -56,1 +60,0 @@\n- *   Default: J,N on Solaris and Linux where N is available, or J\n@@ -120,0 +123,10 @@\n+            \/\/ User-provided libs\n+            String userLibs = System.getProperty(\"test.libs\");\n+            Asserts.assertNotNull(userLibs, \"test.libs property must be provided\");\n+            libs = userLibs.split(\",\");\n+            if (Arrays.asList(libs).contains(\"N\") && !isNativeLibAvailable()) {\n+                \/\/ Skip test when native GSS libs are not available in running platform\n+                System.out.println(\"Native mode not available - skipped\");\n+                return;\n+            }\n+\n@@ -132,19 +145,0 @@\n-            \/\/ User-provided libs\n-            String userLibs = System.getProperty(\"test.libs\");\n-\n-            if (userLibs != null) {\n-                libs = userLibs.split(\",\");\n-            } else {\n-                if (Platform.isOSX() || Platform.isWindows()) {\n-                    \/\/ macOS uses Heimdal and Windows has no native lib\n-                    libs = new String[]{\"J\"};\n-                } else {\n-                    if (acceptor(\"N\", \"sanity\").waitFor() != 0) {\n-                        Proc.d(\"Native mode sanity check failed, only java\");\n-                        libs = new String[]{\"J\"};\n-                    } else {\n-                        libs = new String[]{\"J\", \"N\"};\n-                    }\n-                }\n-            }\n-\n@@ -326,0 +320,7 @@\n+    \/\/ returns true if native lib is available in running platform\n+    \/\/ macOS uses Heimdal and Windows has no native lib\n+    private static boolean isNativeLibAvailable() throws Exception {\n+        return !Platform.isOSX() && !Platform.isWindows()\n+                && acceptor(\"N\", \"sanity\").waitFor() == 0;\n+    }\n+\n","filename":"jdk\/test\/sun\/security\/krb5\/auto\/ReplayCacheTestProc.java","additions":23,"deletions":22,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -27,1 +27,3 @@\n-# @run main\/othervm\/timeout=300 -Dsun.net.spi.nameservice.provider.1=ns,mock -Djdk.krb5.rcache.useMD5=true ReplayCacheTestProc\n+# @run main\/othervm\/timeout=300 -Dsun.net.spi.nameservice.provider.1=ns,mock\n+#           -Djdk.krb5.rcache.useMD5=true\n+#           -Dtest.libs=J ReplayCacheTestProc\n","filename":"jdk\/test\/sun\/security\/krb5\/auto\/rcache_usemd5.sh","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"}]}