{"files":[{"patch":"@@ -1582,6 +1582,0 @@\n-      - name: Determine current artifacts endpoint\n-        id: actions_runtime\n-        uses: actions\/github-script@v7\n-        with:\n-          script: \"return { url: process.env['ACTIONS_RUNTIME_URL'], token: process.env['ACTIONS_RUNTIME_TOKEN'] }\"\n-\n@@ -1589,4 +1583,6 @@\n-        run: >\n-          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n-          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n-          '${{ fromJson(steps.actions_runtime.outputs.result).url }}_apis\/pipelines\/workflows\/${{ github.run_id }}\/artifacts?api-version=6.0-preview'\n+        run: |\n+          curl -sL \\\n+              -H 'Accept: application\/vnd.github+json' \\\n+              -H 'Authorization: Bearer ${{ github.token }}' \\\n+              -H 'X-GitHub-Api-Version: 2022-11-28' \\\n+              '${{ github.api_url }}\/repos\/${{ github.repository }}\/actions\/runs\/${{ github.run_id }}\/artifacts'\n@@ -1595,26 +1591,18 @@\n-        run: >\n-          for url in `\n-          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n-          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n-          '${{ fromJson(steps.actions_runtime.outputs.result).url }}_apis\/pipelines\/workflows\/${{ github.run_id }}\/artifacts?api-version=6.0-preview' |\n-          jq -r -c '.value | map(select(.name|startswith(\"transient_\"))) | .[].url'`; do\n-          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n-          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n-          -X DELETE \"${url}\";\n-          done\n-\n-      - name: Fetch remaining artifacts (test results)\n-        uses: actions\/download-artifact@v4\n-        with:\n-          path: test-results\n-\n-      - name: Delete remaining artifacts\n-        run: >\n-          for url in `\n-          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n-          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n-          '${{ fromJson(steps.actions_runtime.outputs.result).url }}_apis\/pipelines\/workflows\/${{ github.run_id }}\/artifacts?api-version=6.0-preview' |\n-          jq -r -c '.value | .[].url'`; do\n-          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n-          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n-          -X DELETE \"${url}\";\n+        run: |\n+          # Find and remove all transient artifacts\n+          # See: https:\/\/docs.github.com\/en\/rest\/actions\/artifacts?apiVersion=2022-11-28\n+          ALL_ARTIFACT_IDS=\"$(curl -sL \\\n+              -H 'Accept: application\/vnd.github+json' \\\n+              -H 'Authorization: Bearer ${{ github.token }}' \\\n+              -H 'X-GitHub-Api-Version: 2022-11-28' \\\n+              '${{ github.api_url }}\/repos\/${{ github.repository }}\/actions\/runs\/${{ github.run_id }}\/artifacts')\"\n+          BUNDLE_ARTIFACT_IDS=\"$(echo \"$ALL_ARTIFACT_IDS\" | jq -r -c '.artifacts | map(select(.name|startswith(\"transient_\"))) | .[].id')\"\n+          for id in $BUNDLE_ARTIFACT_IDS; do\n+            echo \"Removing $id\"\n+            curl -sL \\\n+                -X DELETE \\\n+                -H 'Accept: application\/vnd.github+json' \\\n+                -H 'Authorization: Bearer ${{ github.token }}' \\\n+                -H 'X-GitHub-Api-Version: 2022-11-28' \\\n+                \"${{ github.api_url }}\/repos\/${{ github.repository }}\/actions\/artifacts\/$id\" \\\n+            || echo \"Failed to remove bundle\"\n@@ -1624,1 +1612,1 @@\n-        uses: actions\/upload-artifact@v4\n+        uses: actions\/upload-artifact\/merge@v4\n@@ -1627,1 +1615,2 @@\n-          path: test-results\n+          separate-directories: false\n+          delete-merged: true\n","filename":".github\/workflows\/submit.yml","additions":27,"deletions":38,"binary":false,"changes":65,"status":"modified"}]}