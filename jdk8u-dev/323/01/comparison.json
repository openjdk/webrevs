{"files":[{"patch":"@@ -88,0 +88,2 @@\n+        return create(optResult);\n+    }\n@@ -89,0 +91,1 @@\n+    public static CgroupMetrics create(Optional<CgroupTypeResult> optResult) {\n","filename":"jdk\/src\/linux\/classes\/jdk\/internal\/platform\/CgroupSubsystemFactory.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import static org.junit.Assert.fail;\n@@ -53,1 +54,1 @@\n- * @bug 8293540 8287107\n+ * @bug 8287107 8287073 8293540\n@@ -67,0 +68,1 @@\n+    private Path cgroupv2CgInfoZeroMinimal;\n@@ -128,0 +130,3 @@\n+    private String cgroupsZeroHierarchyMinimal =\n+            \"#subsys_name hierarchy num_cgroups enabled\\n\" +\n+            \"cpu 0 1 1\\n\";\n@@ -311,0 +316,3 @@\n+            cgroupv2CgInfoZeroMinimal = Paths.get(existingDirectory.toString(), \"cgv2_proc_cgroups_minimal\");\n+            Files.write(cgroupv2CgInfoZeroMinimal, cgroupsZeroHierarchyMinimal.getBytes(StandardCharsets.UTF_8));\n+\n@@ -492,0 +500,24 @@\n+    \/*\n+     * On some systems the memory controller might not show up in \/proc\/cgroups\n+     * which may provoke a NPE on instantiation. See bug 8287073.\n+     *\/\n+    @Test\n+    public void testZeroHierarchyCgroupsV2Minimal() throws IOException {\n+        String cgroups = cgroupv2CgInfoZeroMinimal.toString();\n+        String mountInfo = cgroupv2MntInfoZeroHierarchy.toString();\n+        String selfCgroup = cgroupv2SelfCgroup.toString();\n+        Optional<CgroupTypeResult> result = CgroupSubsystemFactory.determineType(mountInfo, cgroups, selfCgroup);\n+\n+        assertTrue(\"Expected non-empty cgroup result\", result.isPresent());\n+        CgroupTypeResult res = result.get();\n+\n+        assertTrue(\"zero hierarchy ids with mounted controllers expected cgroups v2\", res.isCgroupV2());\n+        assertNull(\"Only cpu controller present\", res.getInfos().get(\"memory\"));\n+        try {\n+            CgroupSubsystemFactory.create(result);\n+            \/\/ pass\n+        } catch (NullPointerException e) {\n+            fail(\"Missing memory controller should not cause any NPE\");\n+        }\n+    }\n+\n","filename":"jdk\/test\/jdk\/internal\/platform\/cgroup\/TestCgroupSubsystemFactory.java","additions":33,"deletions":1,"binary":false,"changes":34,"status":"modified"}]}