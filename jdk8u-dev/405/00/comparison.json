{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2016, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,4 +25,19 @@\n-   @bug 7123767\n-   @summary Wrong tooltip location in Multi-Monitor configurations\n-   @author Vladislav Karnaukhov\n-   @run main bug7123767\n+* @bug      7123767\n+*\n+* @summary  Check if a tooltip location in Multi-Monitor\n+*           configurations is correct.\n+*           If the configurations number per device exceeds 5,\n+*           then some 5 random configurations will be checked.\n+*           Please Use -Dseed=X to set the random generator seed\n+*           (if necessary).\n+*\n+* @author   Vladislav Karnaukhov\n+*\n+* @key      headful\n+* @key      randomness\n+*\n+* @modules  java.desktop\/sun.awt\n+* @library  \/lib\/testlibrary\/\n+* @build    jdk.testlibrary.*\n+*\n+* @run      main\/timeout=300 bug7123767\n@@ -37,0 +52,8 @@\n+import java.util.List;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Random;\n+\n+import jdk.testlibrary.RandomFactory;\n+\n+\n@@ -39,0 +62,34 @@\n+    \/\/ maximum number of GraphicsConfigurations checked per GraphicsDevice\n+    private static final int MAX_N_CONFIGS = 5;\n+    private static final List<GraphicsConfiguration> CONFIGS = getConfigs();\n+\n+    private static List<GraphicsConfiguration> getConfigs() {\n+\n+        Random rnd = RandomFactory.getRandom();\n+\n+        List<GraphicsConfiguration> configs = new ArrayList<>();\n+\n+        GraphicsEnvironment ge =\n+                GraphicsEnvironment.getLocalGraphicsEnvironment();\n+        GraphicsDevice[] devices = ge.getScreenDevices();\n+\n+        for (GraphicsDevice device : devices) {\n+            GraphicsConfiguration[] allConfigs = device.getConfigurations();\n+            int nConfigs = allConfigs.length;\n+            if (nConfigs <= MAX_N_CONFIGS) {\n+                Collections.addAll(configs, allConfigs);\n+            } else { \/\/ see JDK-8159454\n+                System.out.println(\"check only \" + MAX_N_CONFIGS +\n+                    \" configurations for device \" + device);\n+                configs.add(device.getDefaultConfiguration()); \/\/ check default\n+                for (int j = 0; j < MAX_N_CONFIGS - 1; j++) {\n+                    int k = rnd.nextInt(nConfigs);\n+                    configs.add(allConfigs[k]);\n+                }\n+            }\n+        }\n+\n+        return configs;\n+    }\n+\n+\n@@ -62,0 +119,1 @@\n+        @Override\n@@ -63,1 +121,4 @@\n-            GraphicsConfiguration mouseGC = testGC(MouseInfo.getPointerInfo().getLocation());\n+\n+            GraphicsConfiguration mouseGC =\n+                testGC(MouseInfo.getPointerInfo().getLocation());\n+\n@@ -65,1 +126,2 @@\n-                throw new RuntimeException(\"Can't find GraphicsConfiguration that mouse pointer belongs to\");\n+                throw new RuntimeException(\"Can't find GraphicsConfiguration \"\n+                        + \"that mouse pointer belongs to\");\n@@ -70,1 +132,2 @@\n-                throw new RuntimeException(\"Can't find GraphicsConfiguration that tip belongs to\");\n+                throw new RuntimeException(\n+                        \"Can't find GraphicsConfiguration that tip belongs to\");\n@@ -81,11 +144,8 @@\n-            GraphicsEnvironment environment = GraphicsEnvironment.getLocalGraphicsEnvironment();\n-            GraphicsDevice[] devices = environment.getScreenDevices();\n-            for (GraphicsDevice device : devices) {\n-                GraphicsConfiguration[] configs = device.getConfigurations();\n-                for (GraphicsConfiguration config : configs) {\n-                    Rectangle rect = config.getBounds();\n-                    Insets insets = Toolkit.getDefaultToolkit().getScreenInsets(config);\n-                    adjustInsets(rect, insets);\n-                    if (rect.contains(pt))\n-                        return config;\n-                }\n+\n+            for (GraphicsConfiguration config: CONFIGS) {\n+\n+                Rectangle rect = config.getBounds();\n+                Insets insets =\n+                    Toolkit.getDefaultToolkit().getScreenInsets(config);\n+                adjustInsets(rect, insets);\n+                if (rect.contains(pt)) { return config; }\n@@ -103,0 +163,1 @@\n+\n@@ -107,0 +168,1 @@\n+        if (frame != null) { frame.dispose(); }\n@@ -112,0 +174,1 @@\n+\n@@ -135,10 +198,8 @@\n-        GraphicsEnvironment environment = GraphicsEnvironment.getLocalGraphicsEnvironment();\n-        GraphicsDevice[] devices = environment.getScreenDevices();\n-        for (GraphicsDevice device : devices) {\n-            GraphicsConfiguration[] configs = device.getConfigurations();\n-            for (GraphicsConfiguration config : configs) {\n-                Insets localInsets = Toolkit.getDefaultToolkit().getScreenInsets(config);\n-                Rectangle localRect = config.getBounds();\n-                adjustInsets(localRect, localInsets);\n-                rect.add(localRect);\n-            }\n+\n+        for (GraphicsConfiguration config: CONFIGS) {\n+\n+            Insets localInsets =\n+                Toolkit.getDefaultToolkit().getScreenInsets(config);\n+            Rectangle localRect = config.getBounds();\n+            adjustInsets(localRect, localInsets);\n+            rect.add(localRect);\n@@ -146,0 +207,1 @@\n+\n@@ -166,8 +228,23 @@\n-        GraphicsEnvironment environment = GraphicsEnvironment.getLocalGraphicsEnvironment();\n-        GraphicsDevice[] devices = environment.getScreenDevices();\n-        for (GraphicsDevice device : devices) {\n-            GraphicsConfiguration[] configs = device.getConfigurations();\n-            for (GraphicsConfiguration config : configs) {\n-                Rectangle rect = config.getBounds();\n-                Insets insets = Toolkit.getDefaultToolkit().getScreenInsets(config);\n-                adjustInsets(rect, insets);\n+        for (GraphicsConfiguration config: CONFIGS) {\n+            Rectangle rect = config.getBounds();\n+            Insets insets = Toolkit.getDefaultToolkit().getScreenInsets(config);\n+            adjustInsets(rect, insets);\n+\n+            \/\/ Upper left\n+            glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n+                    rect.x + MARGIN, rect.y + MARGIN);\n+            robot.waitForIdle();\n+\n+            \/\/ Lower left\n+            glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n+                    rect.x + MARGIN, rect.y + rect.height - MARGIN);\n+            robot.waitForIdle();\n+\n+            \/\/ Upper right\n+            glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n+                    rect.x + rect.width - MARGIN, rect.y + MARGIN);\n+            robot.waitForIdle();\n+\n+            \/\/ Lower right\n+            glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n+                    rect.x + rect.width - MARGIN, rect.y + rect.height - MARGIN);\n@@ -175,19 +252,1 @@\n-                \/\/ Upper left\n-                glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n-                        rect.x + MARGIN, rect.y + MARGIN);\n-                robot.waitForIdle();\n-\n-                \/\/ Lower left\n-                glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n-                        rect.x + MARGIN, rect.y + rect.height - MARGIN);\n-                robot.waitForIdle();\n-\n-                \/\/ Upper right\n-                glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n-                        rect.x + rect.width - MARGIN, rect.y + MARGIN);\n-                robot.waitForIdle();\n-\n-                \/\/ Lower right\n-                glide(rect.x + rect.width \/ 2, rect.y + rect.height \/ 2,\n-                        rect.x + rect.width - MARGIN, rect.y + rect.height - MARGIN);\n-                robot.waitForIdle();\n+            robot.waitForIdle();\n","filename":"jdk\/test\/javax\/swing\/ToolTipManager\/7123767\/bug7123767.java","additions":115,"deletions":56,"binary":false,"changes":171,"status":"modified"}]}