{"files":[{"patch":"@@ -41,0 +41,1 @@\n+import java.nio.ByteBuffer;\n@@ -96,1 +97,1 @@\n-        handshaking(ssle, sc, null);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, null);\n@@ -99,1 +100,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n@@ -139,1 +140,1 @@\n-        handshaking(ssle, sc, null);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, null);\n@@ -145,1 +146,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n","filename":"jdk\/test\/javax\/net\/ssl\/SSLEngine\/LargePacket.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -73,1 +73,1 @@\n-        \/\/ create buufer.\n+        \/\/ create buffer.\n@@ -131,1 +131,1 @@\n-                    System.out.println(\"resize destination buffer upto \" +\n+                    System.out.println(\"send: resize destination buffer upto \" +\n@@ -146,2 +146,2 @@\n-    protected static void receive(SSLEngine ssle, SocketChannel sc)\n-        throws Exception {\n+    protected static void receive(SSLEngine ssle, SocketChannel sc,\n+            ByteBuffer peerNetData) throws Exception {\n@@ -149,1 +149,1 @@\n-        \/\/ create buufers.\n+        \/\/ create buffer.\n@@ -151,1 +151,0 @@\n-        int netBufferMax = ssle.getSession().getPacketBufferSize();\n@@ -153,1 +152,1 @@\n-        \/\/ allocate less in order to check BUFFER_OVERFLOW\/BUFFER_UNDERFLOW\n+        \/\/ allocate less in order to check BUFFER_OVERFLOW\n@@ -155,1 +154,0 @@\n-        ByteBuffer peerNetData = ByteBuffer.allocate(netBufferMax\/2);\n@@ -192,2 +190,2 @@\n-                System.out.println(\"\\tcomsumed \" + res.bytesConsumed() +\n-                        \" byes network data\");\n+                System.out.println(\"\\tconsumed \" + res.bytesConsumed() +\n+                        \" bytes network data\");\n@@ -212,1 +210,1 @@\n-                    System.out.println(\"resize destination buffer upto \" +\n+                    System.out.println(\"recv: resize destination buffer upto \" +\n@@ -222,2 +220,2 @@\n-                    System.out.println(\"resize source buffer upto \" + size +\n-                        \" bytes for BUFFER_UNDERFLOW\");\n+                    System.out.println(\"recv: resize source buffer upto \" +\n+                        size + \" bytes for BUFFER_UNDERFLOW\");\n@@ -237,1 +235,1 @@\n-    protected static void handshaking(SSLEngine ssle, SocketChannel sc,\n+    protected static ByteBuffer handshaking(SSLEngine ssle, SocketChannel sc,\n@@ -243,0 +241,3 @@\n+        \/\/ zero-byte app buffers - we do not want to exchange app data here\n+        ByteBuffer localAppData = ByteBuffer.allocate(0);\n+        ByteBuffer peerAppData = ByteBuffer.allocate(0);\n@@ -244,2 +245,0 @@\n-        ByteBuffer localAppData = ByteBuffer.allocate(appBufferMax\/10);\n-        ByteBuffer peerAppData = ByteBuffer.allocate(appBufferMax\/10);\n@@ -275,1 +274,1 @@\n-                            return;\n+                            throw new EOFException();\n@@ -283,1 +282,1 @@\n-                        return;\n+                        throw new EOFException();\n@@ -301,1 +300,1 @@\n-                        System.out.println(\"resize source buffer upto \" +\n+                        System.out.println(\"hs recv: resize source buffer upto \" +\n@@ -312,1 +311,1 @@\n-                        System.out.println(\"resize destination buffer upto \" +\n+                        System.out.println(\"hs recv: resize destination buffer upto \" +\n@@ -349,1 +348,1 @@\n-                        System.out.println(\"resize destination buffer upto \" +\n+                        System.out.println(\"hs send: resize destination buffer upto \" +\n@@ -374,0 +373,1 @@\n+        return peerNetData;\n","filename":"jdk\/test\/javax\/net\/ssl\/SSLEngine\/SSLEngineService.java","additions":21,"deletions":21,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -145,1 +145,1 @@\n-        handshaking(ssle, sc, buffer);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, buffer);\n@@ -148,1 +148,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n@@ -195,1 +195,1 @@\n-        handshaking(ssle, sc, null);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, null);\n@@ -201,1 +201,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n","filename":"jdk\/test\/javax\/net\/ssl\/ServerName\/SSLEngineExplorer.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,1 +74,1 @@\n-    static boolean debug = false;\n+    static boolean debug = true;\n@@ -157,1 +157,1 @@\n-        handshaking(ssle, sc, buffer);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, buffer);\n@@ -160,1 +160,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n@@ -212,1 +212,1 @@\n-        handshaking(ssle, sc, null);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, null);\n@@ -218,1 +218,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n","filename":"jdk\/test\/javax\/net\/ssl\/ServerName\/SSLEngineExplorerMatchedSNI.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -151,1 +151,1 @@\n-            handshaking(ssle, sc, buffer);\n+            ByteBuffer peerNetData = handshaking(ssle, sc, buffer);\n@@ -154,1 +154,1 @@\n-            receive(ssle, sc);\n+            receive(ssle, sc, peerNetData);\n@@ -216,1 +216,1 @@\n-            handshaking(ssle, sc, null);\n+            ByteBuffer peerNetData = handshaking(ssle, sc, null);\n@@ -222,1 +222,1 @@\n-            receive(ssle, sc);\n+            receive(ssle, sc, peerNetData);\n","filename":"jdk\/test\/javax\/net\/ssl\/ServerName\/SSLEngineExplorerUnmatchedSNI.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -139,1 +139,1 @@\n-        handshaking(ssle, sc, buffer);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, buffer);\n@@ -142,1 +142,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n@@ -193,1 +193,1 @@\n-        handshaking(ssle, sc, null);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, null);\n@@ -199,1 +199,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n","filename":"jdk\/test\/javax\/net\/ssl\/ServerName\/SSLEngineExplorerWithCli.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -148,1 +148,1 @@\n-        handshaking(ssle, sc, buffer);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, buffer);\n@@ -151,1 +151,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n@@ -196,1 +196,1 @@\n-        handshaking(ssle, sc, null);\n+        ByteBuffer peerNetData = handshaking(ssle, sc, null);\n@@ -202,1 +202,1 @@\n-        receive(ssle, sc);\n+        receive(ssle, sc, peerNetData);\n","filename":"jdk\/test\/javax\/net\/ssl\/ServerName\/SSLEngineExplorerWithSrv.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}