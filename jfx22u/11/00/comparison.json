{"files":[{"patch":"@@ -574,0 +574,1 @@\n+        OP_UDF              = 0xDE00\n@@ -1011,0 +1012,5 @@\n+    void udf(uint8_t imm = 0)\n+    {\n+        m_formatter.oneWordOp8Imm8(OP_UDF, imm);\n+    }\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/assembler\/ARMv7Assembler.h","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2654,1 +2654,1 @@\n-        m_assembler.bkpt(imm);\n+        m_assembler.udf(imm);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/assembler\/MacroAssemblerARMv7.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1360,1 +1360,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 64) {\n+            if (width > 0 && lsb + width < 64) {\n@@ -1384,1 +1384,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 32) {\n+            if (width > 0 && lsb + width < 32) {\n@@ -1409,1 +1409,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 64) {\n+            if (width > 0 && lsb + width < 64) {\n@@ -1435,1 +1435,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 32) {\n+            if (width > 0 && lsb + width < 32) {\n@@ -1465,1 +1465,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 64) {\n+            if (width > 0 && lsb + width < 64) {\n@@ -1495,1 +1495,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 32) {\n+            if (width > 0 && lsb + width < 32) {\n@@ -1525,1 +1525,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 64) {\n+            if (width > 0 && lsb + width < 64) {\n@@ -1554,1 +1554,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 32) {\n+            if (width > 0 && lsb + width < 32) {\n@@ -1579,1 +1579,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 32) {\n+            if (width > 0 && lsb + width < 32) {\n@@ -1676,1 +1676,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 32) {\n+            if (width > 0 && lsb + width < 32) {\n@@ -1706,1 +1706,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 64) {\n+            if (width > 0 && lsb + width < 64) {\n@@ -1735,1 +1735,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 32) {\n+            if (width > 0 && lsb + width < 32) {\n@@ -1765,1 +1765,1 @@\n-            if (lsb >= 0 && width > 0 && lsb + width < 64) {\n+            if (width > 0 && lsb + width < 64) {\n@@ -1796,1 +1796,1 @@\n-                if (0 <= lsb && lsb < datasize) {\n+                if (lsb < datasize) {\n@@ -1833,1 +1833,1 @@\n-                if (0 <= lsb && lsb < datasize) {\n+                if (lsb < datasize) {\n@@ -3013,1 +3013,1 @@\n-        return value & (1ull << 48) - 1;\n+        return value & ((1ull << 48) - 1);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/assembler\/testmasm.cpp","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2015-2022 Apple Inc. All rights reserved.\n+ * Copyright (C) 2015-2023 Apple Inc. All rights reserved.\n@@ -1984,5 +1984,12 @@\n-            \/\/ Turn this: Trunc(constant)\n-            \/\/ Into this: static_cast<int32_t>(constant)\n-            if (m_value->child(0)->hasInt64() || m_value->child(0)->hasDouble()) {\n-                replaceWithNewValue(\n-                    m_proc.addIntConstant(m_value, static_cast<int32_t>(m_value->child(0)->asInt64())));\n+            \/\/ Turn this: Trunc(int64Constant)\n+            \/\/ Into this: static_cast<int32_t>(int64Constant)\n+            if (m_value->child(0)->hasInt64()) {\n+                replaceWithNewValue(m_proc.addIntConstant(m_value, static_cast<int32_t>(m_value->child(0)->asInt64())));\n+                break;\n+            }\n+\n+            \/\/ Turn this: Trunc(doubleConstant)\n+            \/\/ Into this: bitwise_cast<float>(static_cast<int32_t>(bitwise_cast<int64_t>(doubleConstant)))\n+            if (m_value->child(0)->hasDouble()) {\n+                double value = m_value->child(0)->asDouble();\n+                replaceWithNewValue(m_proc.addConstant(m_value->origin(), m_value->type(), bitwise_cast<int64_t>(value)));\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/b3\/B3ReduceStrength.cpp","additions":13,"deletions":6,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -1075,0 +1075,2 @@\n+void testReduceStrengthTruncInt64Constant(int64_t filler, int32_t value);\n+void testReduceStrengthTruncDoubleConstant(double filler, float value);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/b3\/testb3.h","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -789,0 +789,2 @@\n+    RUN_BINARY(testReduceStrengthTruncInt64Constant, int64Operands(), int32Operands());\n+    RUN_BINARY(testReduceStrengthTruncDoubleConstant, floatingPointOperands<double>(), floatingPointOperands<float>());\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/b3\/testb3_1.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -383,0 +383,37 @@\n+template<typename B3ContType, typename Type64, typename Type32>\n+void testReduceStrengthTruncConstant(Type64 filler, Type32 value)\n+{\n+    Procedure proc;\n+    BasicBlock* root = proc.addBlock();\n+\n+    int64_t bits = bitwise_cast<int64_t>(filler);\n+    int32_t loBits = bitwise_cast<int32_t>(value);\n+    bits = ((bits >> 32) << 32) | loBits;\n+    Type64 testValue = bitwise_cast<Type64>(bits);\n+\n+    Value* b2  = root->appendNew<B3ContType>(proc, Origin(), testValue);\n+    Value* b3  = root->appendNew<Value>(proc, JSC::B3::Trunc, Origin(), b2);\n+    root->appendNew<Value>(proc, Return, Origin(), b3);\n+\n+    proc.resetReachability();\n+\n+    reduceStrength(proc);\n+\n+    CHECK_EQ(root->last()->opcode(), Return);\n+    if constexpr (std::is_same_v<B3ContType, ConstDoubleValue>) {\n+        CHECK_EQ(root->last()->child(0)->opcode(), ConstFloat);\n+        CHECK(bitwise_cast<int32_t>(root->last()->child(0)->asFloat()) == bitwise_cast<int32_t>(value));\n+    } else\n+        CHECK(root->last()->child(0)->isInt32(value));\n+}\n+\n+void testReduceStrengthTruncInt64Constant(int64_t filler, int32_t value)\n+{\n+    testReduceStrengthTruncConstant<Const64Value>(filler, value);\n+}\n+\n+void testReduceStrengthTruncDoubleConstant(double filler, float value)\n+{\n+    testReduceStrengthTruncConstant<ConstDoubleValue>(filler, value);\n+}\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/b3\/testb3_7.cpp","additions":37,"deletions":0,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -2319,0 +2319,6 @@\n+    \/\/ It is possible that the global object and\/or other data relating to this origin\n+    \/\/ was collected by GC, but we are still asking for this (ex: in a patchpoint generate() function).\n+    \/\/ Plan::cancel should have cleared this in that case.\n+    \/\/ Let's make sure we can continue to execute safely, even though we don't have a global object to give.\n+    if (!inlineCallFrame->baselineCodeBlock)\n+        return nullptr;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/bytecode\/CodeBlock.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1344,3 +1344,11 @@\n-    Locker cellLock { object->cellLock() };\n-    Structure* structure = object->structure();\n-    if (!structureSet.toStructureSet().contains(structure))\n+    JSValue result;\n+    auto set = structureSet.toStructureSet();\n+    {\n+        Locker cellLock { object->cellLock() };\n+        Structure* structure = object->structure();\n+        if (!set.contains(structure))\n+            return JSValue();\n+        result = object->getDirectConcurrently(cellLock, structure, offset);\n+    }\n+\n+    if (!result)\n@@ -1349,1 +1357,20 @@\n-    return object->getDirectConcurrently(cellLock, structure, offset);\n+    \/\/ If all structures are watched, we don't need to consider whether object transitions and changes the value.\n+    \/\/ If the object gets transition while compiling, then it invalidates the code.\n+    bool allAreWatched = true;\n+    for (unsigned i = structureSet.size(); i--;) {\n+        RegisteredStructure structure = structureSet[i];\n+        if (!structure->dfgShouldWatch()) {\n+            allAreWatched = false;\n+            break;\n+        }\n+    }\n+    if (allAreWatched)\n+        return result;\n+\n+    \/\/ However, if structures transitions are not watched, then object can get to the one of the structures transitively while it is changing the value.\n+    \/\/ But we can still optimize it if StructureSet is only one: in that case, there is no way to fulfill Structure requirement while changing the property\n+    \/\/ and avoiding the replacement watchpoint firing.\n+    if (structureSet.size() != 1)\n+        return JSValue();\n+\n+    return result;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/dfg\/DFGGraph.cpp","additions":31,"deletions":4,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -1331,1 +1331,11 @@\n-        return bytecodeCanTruncateInteger(add->arithNodeFlags()) ? SpeculateInt32AndTruncateConstants : DontSpeculateInt32;\n+        if (bytecodeCanTruncateInteger(add->arithNodeFlags())) {\n+            \/\/ If int32 + const double, then we should not speculate this add node with int32 type.\n+            \/\/ Because ToInt32(int32 + const double) is not always equivalent to int32 + ToInt32(const double).\n+            \/\/ For example:\n+            \/\/ let the int32 = -1 and const double = 0.1, then ToInt32(-1 + 0.1) = 0 but -1 + ToInt32(0.1) = -1.\n+            if (operandResultType == NodeResultInt32 && !isInteger(doubleImmediate))\n+                return DontSpeculateInt32;\n+            return SpeculateInt32AndTruncateConstants;\n+        }\n+\n+        return DontSpeculateInt32;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/dfg\/DFGGraph.h","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2209,1 +2209,5 @@\n-    return ClonedArguments::createByCopyingFrom(globalObject, structure, argumentStart, length, callee, butterfly);\n+    auto scope = DECLARE_THROW_SCOPE(vm);\n+\n+    JSCell* result = ClonedArguments::createByCopyingFrom(globalObject, structure, argumentStart, length, callee, butterfly);\n+    EXCEPTION_ASSERT_UNUSED(scope, scope.exception() || result);\n+    return result;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/dfg\/DFGOperations.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -178,1 +178,4 @@\n-    m_inlineCallFrames = nullptr;\n+    if (m_inlineCallFrames) {\n+        for (auto i : *m_inlineCallFrames)\n+            i->baselineCodeBlock.clear();\n+    }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/dfg\/DFGPlan.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -386,2 +386,5 @@\n-            case PhantomClonedArguments:\n-                return ClonedArguments::createWithMachineFrame(globalObject, callFrame, ArgumentsMode::Cloned);\n+            case PhantomClonedArguments: {\n+                ClonedArguments* result = ClonedArguments::createWithMachineFrame(globalObject, callFrame, ArgumentsMode::Cloned);\n+                RELEASE_ASSERT(result);\n+                return result;\n+            }\n@@ -470,0 +473,1 @@\n+            RELEASE_ASSERT(result);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/ftl\/FTLOperations.cpp","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -289,1 +289,1 @@\n-    if (!callResult)\n+    if (!callResult || !callResult.value())\n@@ -312,1 +312,1 @@\n-    if (!callResult)\n+    if (!callResult || !callResult.value())\n@@ -341,1 +341,1 @@\n-    if (!callResult)\n+    if (!callResult || !callResult.value())\n@@ -362,1 +362,1 @@\n-    if (!callResult)\n+    if (!callResult || !callResult.value())\n@@ -414,1 +414,1 @@\n-    if (!callResult)\n+    if (!callResult || !callResult.value())\n@@ -454,1 +454,1 @@\n-    return callResult ? asObject(callResult.value()) : nullptr;\n+    return callResult && callResult.value() ? asObject(callResult.value()) : nullptr;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/inspector\/InjectedScript.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -199,4 +199,2 @@\n-    ASSERT_UNUSED(result, result.value().isUndefined());\n-\n-    ASSERT(result);\n-    if (!result) {\n+    ASSERT_UNUSED(result, result && result.value() && result.value().isUndefined());\n+    if (!result || !result.value()) {\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/inspector\/InjectedScriptBase.cpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -79,0 +79,4 @@\n+    if (!hasInjectedModuleResult.value()) {\n+        WTFLogAlways(\"VM is terminated when calling 'injectModule' for '%s'\\n\", name().utf8().data());\n+        RELEASE_ASSERT_NOT_REACHED();\n+    }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/inspector\/InjectedScriptModule.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2012, 2013, 2014 Apple Inc. All rights reserved.\n+ * Copyright (C) 2012-2023 Apple Inc. All rights reserved.\n@@ -49,5 +49,1 @@\n-    \\\n-    FOR_EACH_BYTECODE_HELPER_ID(macro) \\\n-    \\\n-    FOR_EACH_LLINT_NOJIT_RETURN_HELPER(macro) \\\n-\n+    FOR_EACH_LLINT_NOJIT_RETURN_HELPER(macro)\n@@ -55,1 +51,3 @@\n-#define FOR_EACH_LLINT_OPCODE_EXTENSION(macro) FOR_EACH_LLINT_NATIVE_HELPER(macro)\n+#define FOR_EACH_LLINT_OPCODE_EXTENSION(macro) \\\n+    FOR_EACH_BYTECODE_HELPER_ID(macro) \\\n+    FOR_EACH_LLINT_NATIVE_HELPER(macro)\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/llint\/LLIntOpcode.h","additions":5,"deletions":7,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2757,1 +2757,1 @@\n-        # on Intel, which is 1 byte, and bkpt on ARMv7, which is 2 bytes.)\n+        # on Intel, which is 1 byte, and udf on ARMv7, which is 2 bytes.)\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/llint\/LowLevelInterpreter.asm","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2012-2022 Apple Inc. All rights reserved.\n+ * Copyright (C) 2012-2023 Apple Inc. All rights reserved.\n@@ -282,0 +282,1 @@\n+        FOR_EACH_BYTECODE_HELPER_ID(OPCODE_ENTRY)\n@@ -333,0 +334,6 @@\n+    UNUSED_VARIABLE(t0);\n+    UNUSED_VARIABLE(t1);\n+    UNUSED_VARIABLE(t2);\n+    UNUSED_VARIABLE(t3);\n+    UNUSED_VARIABLE(t5);\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/llint\/LowLevelInterpreter.cpp","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -836,1 +836,1 @@\n-            $asm.puts \"bkpt #0\"\n+            $asm.puts \"udf #0\"\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/offlineasm\/arm.rb","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -44,0 +44,4 @@\n+tempFlnm = File.join(\n+    ENV['TARGET_TEMP_DIR'] || File.dirname(outputFlnm),\n+    \"#{File.basename(outputFlnm)}.part\"\n+)\n@@ -99,1 +103,1 @@\n-File.open(outputFlnm, \"w\") {\n+File.open(tempFlnm, \"w\") {\n@@ -153,1 +157,0 @@\n-\n@@ -155,0 +158,1 @@\n+File.rename(tempFlnm, outputFlnm)\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/offlineasm\/generate_offset_extractor.rb","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -43,0 +43,4 @@\n+tempFlnm = File.join(\n+    ENV['TARGET_TEMP_DIR'] || File.dirname(outputFlnm),\n+    \"#{File.basename(outputFlnm)}.part\"\n+)\n@@ -81,1 +85,1 @@\n-File.open(outputFlnm, \"w\") {\n+File.open(tempFlnm, \"w\") {\n@@ -99,1 +103,0 @@\n-\n@@ -101,0 +104,1 @@\n+File.rename(tempFlnm, outputFlnm)\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/offlineasm\/generate_settings_extractor.rb","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+    auto scope = DECLARE_THROW_SCOPE(vm);\n@@ -51,2 +52,2 @@\n-        butterfly = createArrayStorageButterfly(vm, nullptr, structure, length, vectorLength);\n-        butterfly->arrayStorage()->m_numValuesInVector = vectorLength;\n+            butterfly = createArrayStorageButterfly(vm, nullptr, structure, length, vectorLength);\n+            butterfly->arrayStorage()->m_numValuesInVector = vectorLength;\n@@ -56,6 +57,8 @@\n-        IndexingHeader indexingHeader;\n-        indexingHeader.setVectorLength(vectorLength);\n-        indexingHeader.setPublicLength(length);\n-        butterfly = Butterfly::tryCreate(vm, nullptr, 0, structure->outOfLineCapacity(), true, indexingHeader, vectorLength * sizeof(EncodedJSValue));\n-        if (!butterfly)\n-            return nullptr;\n+            IndexingHeader indexingHeader;\n+            indexingHeader.setVectorLength(vectorLength);\n+            indexingHeader.setPublicLength(length);\n+            butterfly = Butterfly::tryCreate(vm, nullptr, 0, structure->outOfLineCapacity(), true, indexingHeader, vectorLength * sizeof(EncodedJSValue));\n+            if (UNLIKELY(!butterfly)) {\n+                throwOutOfMemoryError(structure->globalObject(), scope);\n+                return nullptr;\n+            }\n@@ -94,1 +97,1 @@\n-        ASSERT(!result->needsSlowPutIndexing() || shouldUseSlowPut(result->structure()->indexingType()));\n+        ASSERT(!result || !result->needsSlowPutIndexing() || shouldUseSlowPut(result->structure()->indexingType()));\n@@ -108,0 +111,2 @@\n+            if (!result)\n+                return result;\n@@ -114,0 +119,2 @@\n+            if (!result)\n+                return result;\n@@ -123,0 +130,2 @@\n+        if (!result)\n+            return result;\n@@ -134,1 +143,1 @@\n-    ASSERT(!result->needsSlowPutIndexing() || shouldUseSlowPut(result->structure()->indexingType()));\n+    ASSERT(!result || !result->needsSlowPutIndexing() || shouldUseSlowPut(result->structure()->indexingType()));\n@@ -142,0 +151,2 @@\n+    if (!result)\n+        return result;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/ClonedArguments.cpp","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -168,1 +168,3 @@\n-    RETURN(ClonedArguments::createWithMachineFrame(globalObject, callFrame, ArgumentsMode::Cloned));\n+    auto result = ClonedArguments::createWithMachineFrame(globalObject, callFrame, ArgumentsMode::Cloned);\n+    EXCEPTION_ASSERT(throwScope.exception() || result);\n+    RETURN(result);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/CommonSlowPaths.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2008-2021 Apple Inc. All rights reserved.\n+ * Copyright (C) 2008-2023 Apple Inc. All rights reserved.\n@@ -65,2 +65,7 @@\n-    if (v.isSymbol())\n-        return asSymbol(v)->descriptiveString();\n+    if (v.isSymbol()) {\n+        auto expectedDescription = asSymbol(v)->tryGetDescriptiveString();\n+        if (expectedDescription)\n+            return expectedDescription.value();\n+        ASSERT(expectedDescription.error() == ErrorTypeWithExtension::OutOfMemoryError);\n+        return String(\"Symbol\"_s);\n+    }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/ExceptionHelpers.cpp","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -223,1 +223,3 @@\n-    return JSValue::encode(retrieveArguments(vm, vm.topCallFrame, thisObj));\n+    JSValue result = retrieveArguments(vm, vm.topCallFrame, thisObj);\n+    EXCEPTION_ASSERT(scope.exception() || result);\n+    return JSValue::encode(result);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/FunctionPrototype.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -666,1 +666,4 @@\n-            throwRangeError(globalObject, scope, \"invalid time zone: \"_s + originalTz);\n+            String message = tryMakeString(\"invalid time zone: \"_s, originalTz);\n+            if (!message)\n+                message = \"invalid time zone\"_s;\n+            throwRangeError(globalObject, scope, message);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/IntlDateTimeFormat.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -238,0 +238,1 @@\n+    v(Bool, validateSerializedValue, false, Normal, nullptr) \/* tests CloneSerializer\/Deserializer *\/ \\\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/OptionsList.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2012-2022 Apple Inc. All rights reserved.\n+ * Copyright (C) 2012-2023 Apple Inc. All rights reserved.\n@@ -91,0 +91,8 @@\n+Expected<String, ErrorTypeWithExtension> Symbol::tryGetDescriptiveString() const\n+{\n+    String description = tryMakeString(\"Symbol(\"_s, StringView(m_privateName.uid()), ')');\n+    if (!description)\n+        return makeUnexpected(ErrorTypeWithExtension::OutOfMemoryError);\n+    return description;\n+}\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/Symbol.cpp","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2012-2022 Apple Inc. All rights reserved.\n+ * Copyright (C) 2012-2023 Apple Inc. All rights reserved.\n@@ -29,0 +29,1 @@\n+#include \"ErrorType.h\"\n@@ -31,0 +32,1 @@\n+#include <wtf\/Expected.h>\n@@ -62,0 +64,1 @@\n+    Expected<String, ErrorTypeWithExtension> tryGetDescriptiveString() const;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/Symbol.h","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -65,0 +65,3 @@\n+#if CPU(BIG_ENDIAN)\n+constexpr UGPRPair makeUGPRPair(UCPURegister first, UCPURegister second) { return static_cast<uint64_t>(first) << 32 | second; }\n+#else\n@@ -66,0 +69,1 @@\n+#endif\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/runtime\/UGPRPair.h","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -95,1 +95,1 @@\n-int RegularExpression::match(StringView str, int startFrom, int* matchLength) const\n+int RegularExpression::match(StringView str, unsigned startFrom, int* matchLength) const\n@@ -174,1 +174,0 @@\n-        index += replacement.length();\n@@ -177,0 +176,1 @@\n+        index += replacement.length();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/yarr\/RegularExpression.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-    int match(StringView, int startFrom = 0, int* matchLength = nullptr) const;\n+    int match(StringView, unsigned startFrom = 0, int* matchLength = nullptr) const;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/yarr\/RegularExpression.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -772,1 +772,1 @@\n-            input.uncheckInput(backTrack->matchAmount);\n+            input.setPos(backTrack->begin);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/JavaScriptCore\/yarr\/YarrInterpreter.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1498,0 +1498,13 @@\n+CanvasFingerprintingQuirkEnabled:\n+  type: bool\n+  status: stable\n+  category: dom\n+  humanReadableName: \"Enable Canvas fingerprinting-related quirk\"\n+  defaultValue:\n+    WebKitLegacy:\n+      default: false\n+    WebKit:\n+      default: true\n+    WebCore:\n+      default: true\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/Scripts\/Preferences\/UnifiedWebPreferences.yaml","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -80,0 +80,41 @@\n+    URL(const URL&) = default;\n+    URL& operator=(const URL&) = default;\n+\n+    URL(URL&& other)\n+        : m_string(WTFMove(other.m_string))\n+        , m_isValid(other.m_isValid)\n+        , m_protocolIsInHTTPFamily(other.m_protocolIsInHTTPFamily)\n+        , m_hasOpaquePath(other.m_hasOpaquePath)\n+        , m_portLength(other.m_portLength)\n+        , m_schemeEnd(other.m_schemeEnd)\n+        , m_userStart(other.m_userStart)\n+        , m_userEnd(other.m_userEnd)\n+        , m_passwordEnd(other.m_passwordEnd)\n+        , m_hostEnd(other.m_hostEnd)\n+        , m_pathAfterLastSlash(other.m_pathAfterLastSlash)\n+        , m_pathEnd(other.m_pathEnd)\n+        , m_queryEnd(other.m_queryEnd)\n+    {\n+        other.m_isValid = false;\n+    }\n+\n+    URL& operator=(URL&& other)\n+    {\n+        m_string = WTFMove(other.m_string);\n+        m_isValid = other.m_isValid;\n+        other.m_isValid = false;\n+        m_protocolIsInHTTPFamily = other.m_protocolIsInHTTPFamily;\n+        m_hasOpaquePath = other.m_hasOpaquePath;\n+        m_portLength = other.m_portLength;\n+        m_schemeEnd = other.m_schemeEnd;\n+        m_userStart = other.m_userStart;\n+        m_userEnd = other.m_userEnd;\n+        m_passwordEnd = other.m_passwordEnd;\n+        m_hostEnd = other.m_hostEnd;\n+        m_pathAfterLastSlash = other.m_pathAfterLastSlash;\n+        m_pathEnd = other.m_pathEnd;\n+        m_queryEnd = other.m_queryEnd;\n+\n+        return *this;\n+    }\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/URL.h","additions":41,"deletions":0,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -155,0 +155,1 @@\n+#ifdef RLIMIT_RTTIME\n@@ -172,0 +173,1 @@\n+#endif\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/linux\/RealTimeThreads.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -89,1 +89,1 @@\n-void MediaKeySystemRequest::allow(CompletionHandler<void()>&& completionHandler)\n+void MediaKeySystemRequest::allow()\n@@ -91,4 +91,6 @@\n-    queueTaskKeepingObjectAlive(*this, TaskSource::UserInteraction, [this, handler = WTFMove(completionHandler)]() mutable {\n-        auto completionHandler = WTFMove(m_allowCompletionHandler);\n-        completionHandler(WTFMove(m_promise));\n-        handler();\n+    if (!scriptExecutionContext())\n+        return;\n+\n+    queueTaskKeepingObjectAlive(*this, TaskSource::UserInteraction, [this] {\n+        if (auto allowCompletionHandler = std::exchange(m_allowCompletionHandler, { }))\n+            allowCompletionHandler(WTFMove(m_promise));\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/Modules\/encryptedmedia\/MediaKeySystemRequest.cpp","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -54,1 +54,1 @@\n-    WEBCORE_EXPORT void allow(CompletionHandler<void()>&&);\n+    WEBCORE_EXPORT void allow();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/Modules\/encryptedmedia\/MediaKeySystemRequest.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -107,2 +107,8 @@\n-    request->setAllowCallback([keySystem, supportedConfigurations = WTFMove(supportedConfigurations), &document, logger = WTFMove(logger), identifier = WTFMove(identifier)](Ref<DeferredPromise>&& promise) mutable {\n-        document.postTask([promise = WTFMove(promise), &document, keySystem, logger = WTFMove(logger), identifier = WTFMove(identifier), supportedConfigurations = WTFMove(supportedConfigurations)] (ScriptExecutionContext&) mutable {\n+    request->setAllowCallback([keySystem, supportedConfigurations = WTFMove(supportedConfigurations), weakDocument = WeakPtr { document }, logger = WTFMove(logger), identifier = WTFMove(identifier)](Ref<DeferredPromise>&& promise) mutable {\n+        RefPtr document = weakDocument.get();\n+        if (!document) {\n+            promise->reject(ExceptionCode::InvalidStateError);\n+            return;\n+        }\n+\n+        document->postTask([promise = WTFMove(promise), keySystem, logger = WTFMove(logger), identifier = WTFMove(identifier), supportedConfigurations = WTFMove(supportedConfigurations)] (ScriptExecutionContext& context) mutable {\n@@ -122,0 +128,1 @@\n+            auto& document = downcast<Document>(context);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/Modules\/encryptedmedia\/NavigatorEME.cpp","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -76,4 +76,2 @@\n-            if (!m_resources)\n-                m_resources = NotificationResources::create();\n-            m_loaders.add(makeUnique<ResourceLoader>(*m_notification.scriptExecutionContext(), iconURL, [this](ResourceLoader* loader, RefPtr<BitmapImage>&& image) {\n-                if (!m_resources)\n+            auto loader = makeUnique<ResourceLoader>(*m_notification.scriptExecutionContext(), iconURL, [this](ResourceLoader* loader, RefPtr<BitmapImage>&& image) {\n+                if (m_stopped)\n@@ -82,1 +80,6 @@\n-                m_resources->setIcon(WTFMove(image));\n+                if (image) {\n+                    if (!m_resources)\n+                        m_resources = NotificationResources::create();\n+                    m_resources->setIcon(WTFMove(image));\n+                }\n+\n@@ -84,1 +87,4 @@\n-            }));\n+            });\n+\n+            if (!loader->finished())\n+                m_loaders.add(WTFMove(loader));\n@@ -91,1 +97,1 @@\n-        m_completionHandler(nullptr);\n+        m_completionHandler(WTFMove(m_resources));\n@@ -96,1 +102,5 @@\n-    m_resources = nullptr;\n+    if (m_stopped)\n+        return;\n+\n+    m_stopped = true;\n+\n@@ -110,3 +120,5 @@\n-    m_loaders.remove(loader);\n-    if (m_loaders.isEmpty() && m_completionHandler)\n-        m_completionHandler(WTFMove(m_resources));\n+    if (m_loaders.contains(loader)) {\n+        m_loaders.remove(loader);\n+        if (m_loaders.isEmpty() && m_completionHandler)\n+            m_completionHandler(WTFMove(m_resources));\n+    }\n@@ -156,0 +168,2 @@\n+    m_finished = true;\n+\n@@ -165,0 +179,2 @@\n+    m_finished = true;\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/Modules\/notifications\/NotificationResourcesLoader.cpp","additions":27,"deletions":11,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -64,0 +64,2 @@\n+        bool finished() const { return m_finished; }\n+\n@@ -71,0 +73,1 @@\n+        bool m_finished { false };\n@@ -80,0 +83,1 @@\n+    bool m_stopped { false };\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/Modules\/notifications\/NotificationResourcesLoader.h","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -180,1 +180,2 @@\n-    notifyReportObservers(Report::create(testReportBody->type(), WTFMove(reportURL), WTFMove(testReportBody)));\n+    auto bodyType = testReportBody->type();\n+    notifyReportObservers(Report::create(bodyType, reportURL, WTFMove(testReportBody)));\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/Modules\/reporting\/ReportingScope.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2009 Google Inc. All rights reserved.\n+ * Copyright (C) 2009-2014 Google Inc. All rights reserved.\n@@ -132,1 +132,1 @@\n-            RefPtr<SQLTransaction> transaction = info.pendingTransactions.first();\n+            RefPtr transaction = info.pendingTransactions.takeFirst();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/Modules\/webdatabase\/SQLTransactionCoordinator.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -851,0 +851,4 @@\n+    \/\/ The object may have already been created during relations update\n+    if (auto* object = get(node))\n+        return object;\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/accessibility\/AXObjectCache.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -203,0 +203,1 @@\n+    ASSERT(lexicalGlobalObject->vm().currentThreadIsHoldingAPILock());\n@@ -250,0 +251,1 @@\n+    ASSERT(lexicalGlobalObject->vm().currentThreadIsHoldingAPILock());\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/bindings\/js\/JSLocalDOMWindowCustom.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -92,0 +92,1 @@\n+#include <JavaScriptCore\/Options.h>\n@@ -102,0 +103,1 @@\n+#include <wtf\/DataLog.h>\n@@ -130,0 +132,7 @@\n+namespace SerializationHelper {\n+\n+static constexpr bool verboseTrace = false;\n+\n+} \/\/ namespace SerializationHelper\n+\n+\n@@ -244,0 +253,132 @@\n+static const char* name(SerializationTag tag)\n+{\n+    switch (tag) {\n+    case ArrayTag: return \"ArrayTag\";\n+    case ObjectTag: return \"ObjectTag\";\n+    case UndefinedTag: return \"UndefinedTag\";\n+    case NullTag: return \"NullTag\";\n+    case IntTag: return \"IntTag\";\n+    case ZeroTag: return \"ZeroTag\";\n+    case OneTag: return \"OneTag\";\n+    case FalseTag: return \"FalseTag\";\n+    case TrueTag: return \"TrueTag\";\n+    case DoubleTag: return \"DoubleTag\";\n+    case DateTag: return \"DateTag\";\n+    case FileTag: return \"FileTag\";\n+    case FileListTag: return \"FileListTag\";\n+    case ImageDataTag: return \"ImageDataTag\";\n+    case BlobTag: return \"BlobTag\";\n+    case StringTag: return \"StringTag\";\n+    case EmptyStringTag: return \"EmptyStringTag\";\n+    case RegExpTag: return \"RegExpTag\";\n+    case ObjectReferenceTag: return \"ObjectReferenceTag\";\n+    case MessagePortReferenceTag: return \"MessagePortReferenceTag\";\n+    case ArrayBufferTag: return \"ArrayBufferTag\";\n+    case ArrayBufferViewTag: return \"ArrayBufferViewTag\";\n+    case ArrayBufferTransferTag: return \"ArrayBufferTransferTag\";\n+    case TrueObjectTag: return \"TrueObjectTag\";\n+    case FalseObjectTag: return \"FalseObjectTag\";\n+    case StringObjectTag: return \"StringObjectTag\";\n+    case EmptyStringObjectTag: return \"EmptyStringObjectTag\";\n+    case NumberObjectTag: return \"NumberObjectTag\";\n+    case SetObjectTag: return \"SetObjectTag\";\n+    case MapObjectTag: return \"MapObjectTag\";\n+    case NonMapPropertiesTag: return \"NonMapPropertiesTag\";\n+    case NonSetPropertiesTag: return \"NonSetPropertiesTag\";\n+#if ENABLE(WEB_CRYPTO)\n+    case CryptoKeyTag: return \"CryptoKeyTag\";\n+#endif\n+    case SharedArrayBufferTag: return \"SharedArrayBufferTag\";\n+#if ENABLE(WEBASSEMBLY)\n+    case WasmModuleTag: return \"WasmModuleTag\";\n+#endif\n+    case DOMPointReadOnlyTag: return \"DOMPointReadOnlyTag\";\n+    case DOMPointTag: return \"DOMPointTag\";\n+    case DOMRectReadOnlyTag: return \"DOMRectReadOnlyTag\";\n+    case DOMRectTag: return \"DOMRectTag\";\n+    case DOMMatrixReadOnlyTag: return \"DOMMatrixReadOnlyTag\";\n+    case DOMMatrixTag: return \"DOMMatrixTag\";\n+    case DOMQuadTag: return \"DOMQuadTag\";\n+    case ImageBitmapTransferTag: return \"ImageBitmapTransferTag\";\n+#if ENABLE(WEB_RTC)\n+    case RTCCertificateTag: return \"RTCCertificateTag\";\n+#endif\n+    case ImageBitmapTag: return \"ImageBitmapTag\";\n+#if ENABLE(OFFSCREEN_CANVAS_IN_WORKERS)\n+    case OffscreenCanvasTransferTag: return \"OffscreenCanvasTransferTag\";\n+#endif\n+    case BigIntTag: return \"BigIntTag\";\n+    case BigIntObjectTag: return \"BigIntObjectTag\";\n+#if ENABLE(WEBASSEMBLY)\n+    case WasmMemoryTag: return \"WasmMemoryTag\";\n+#endif\n+#if ENABLE(WEB_RTC)\n+    case RTCDataChannelTransferTag: return \"RTCDataChannelTransferTag\";\n+#endif\n+    case DOMExceptionTag: return \"DOMExceptionTag\";\n+#if ENABLE(WEB_CODECS)\n+    case WebCodecsEncodedVideoChunkTag: return \"WebCodecsEncodedVideoChunkTag\";\n+    case WebCodecsVideoFrameTag: return \"WebCodecsVideoFrameTag\";\n+#endif\n+    case ResizableArrayBufferTag: return \"ResizableArrayBufferTag\";\n+    case ErrorInstanceTag: return \"ErrorInstanceTag\";\n+#if ENABLE(OFFSCREEN_CANVAS_IN_WORKERS)\n+    case InMemoryOffscreenCanvasTag: return \"InMemoryOffscreenCanvasTag\";\n+#endif\n+    case InMemoryMessagePortTag: return \"InMemoryMessagePortTag\";\n+    case ErrorTag: return \"ErrorTag\";\n+    }\n+    RELEASE_ASSERT_NOT_REACHED();\n+}\n+\n+} \/\/ namespace WebCore\n+\n+namespace WTF {\n+\n+void printInternal(PrintStream&, WebCore::SerializationTag);\n+\n+void printInternal(PrintStream& out, WebCore::SerializationTag tag)\n+{\n+    const char* tagName = WebCore::name(tag);\n+    if (tagName[0] != '<')\n+        out.print(tagName);\n+    else\n+        out.print(\"<unknown tag \", static_cast<unsigned>(tag), \">\");\n+}\n+\n+} \/\/ namespace WTF\n+\n+namespace WebCore {\n+\n+\/\/ This function is only used for a sanity check mechanism used in\n+\/\/ CloneSerializer::addToObjectPoolIfNotDupe() and CloneDeserializer::addToObjectPool().\n+static constexpr bool canBeAddedToObjectPool(SerializationTag tag)\n+{\n+    \/\/ If you add a type to the allow ist (i.e. returns true) here, it means\n+    \/\/ that both the serializer and deserializer will push objects of this\n+    \/\/ type onto their m_objectPool. This is important because the order of\n+    \/\/ the objects in the m_objectPool must match for both the serializer and\n+    \/\/ deserializer.\n+    switch (tag) {\n+    case ArrayTag:\n+    case ArrayBufferTag:\n+    case ArrayBufferViewTag:\n+    case BigIntObjectTag:\n+    case EmptyStringObjectTag:\n+    case FalseObjectTag:\n+    case MapObjectTag:\n+    case NumberObjectTag:\n+    case ObjectTag:\n+    case ResizableArrayBufferTag:\n+    case SetObjectTag:\n+    case SharedArrayBufferTag:\n+    case StringObjectTag:\n+    case TrueObjectTag:\n+        return true;\n+    default:\n+        break;\n+    }\n+    return false;\n+}\n+\n+\n@@ -429,0 +570,6 @@\n+#define SERIALIZE_TRACE(...) do { \\\n+        if constexpr (SerializationHelper::verboseTrace) \\\n+            dataLogLn(\"TRACE \", __VA_ARGS__, \" @ \", __LINE__); \\\n+    } while (false)\n+\n+\n@@ -744,0 +891,13 @@\n+#if ASSERT_ENABLED\n+public:\n+    const Vector<SerializationTag>& objectPoolTags() const { return m_objectPoolTags; }\n+\n+protected:\n+    void appendObjectPoolTag(SerializationTag tag)\n+    {\n+        m_objectPoolTags.append(tag);\n+    }\n+#else\n+    ALWAYS_INLINE void appendObjectPoolTag(SerializationTag) { }\n+#endif\n+\n@@ -746,1 +906,4 @@\n-    MarkedArgumentBuffer m_gcBuffer;\n+    MarkedArgumentBuffer m_objectPool;\n+#if ASSERT_ENABLED\n+    Vector<SerializationTag> m_objectPoolTags;\n+#endif\n@@ -808,1 +971,6 @@\n-class CloneSerializer : CloneBase {\n+class CloneSerializer;\n+#if ASSERT_ENABLED\n+static void validateSerializedResult(CloneSerializer&, SerializationReturnCode, Vector<uint8_t>& result, JSGlobalObject*, Vector<RefPtr<MessagePort>>&, ArrayBufferContentsArray&, ArrayBufferContentsArray& sharedBuffers, Vector<RefPtr<MessagePort>>&);\n+#endif\n+\n+class CloneSerializer : public CloneBase {\n@@ -831,0 +999,5 @@\n+#if ASSERT_ENABLED\n+        auto& vm = lexicalGlobalObject->vm();\n+        auto scope = DECLARE_THROW_SCOPE(vm);\n+#endif\n+\n@@ -849,1 +1022,6 @@\n-        return serializer.serialize(value);\n+        auto code = serializer.serialize(value);\n+#if ASSERT_ENABLED\n+        RETURN_IF_EXCEPTION(scope, code);\n+        validateSerializedResult(serializer, code, out, lexicalGlobalObject, messagePorts, sharedBuffers, sharedBuffers, inMemoryMessagePorts);\n+#endif\n+        return code;\n@@ -868,0 +1046,7 @@\n+#if ASSERT_ENABLED\n+    bool didSeeComplexCases() const { return m_didSeeComplexCases; }\n+    void setDidSeeComplexCases() { m_didSeeComplexCases = true; }\n+#else\n+    ALWAYS_INLINE void setDidSeeComplexCases() { }\n+#endif\n+\n@@ -869,1 +1054,1 @@\n-    typedef HashMap<JSObject*, uint32_t> ObjectPool;\n+    using ObjectPoolMap = HashMap<JSObject*, uint32_t>;\n@@ -924,1 +1109,1 @@\n-    void fillTransferMap(const Vector<T>& input, ObjectPool& result)\n+    void fillTransferMap(const Vector<T>& input, ObjectPoolMap& result)\n@@ -961,1 +1146,2 @@\n-    bool checkForDuplicate(JSObject* object)\n+    template<SerializationTag tag1, SerializationTag tag2 = ErrorTag, SerializationTag tag3 = ErrorTag>\n+    bool writeObjectReferenceIfDupe(JSObject* object)\n@@ -963,0 +1149,4 @@\n+        static_assert(canBeAddedToObjectPool(tag1)\n+            && (canBeAddedToObjectPool(tag2) || tag2 == ErrorTag)\n+            && (canBeAddedToObjectPool(tag3) || tag3 == ErrorTag));\n+\n@@ -964,1 +1154,1 @@\n-        ObjectPool::const_iterator found = m_objectPool.find(object);\n+        auto found = m_objectPoolMap.find(object);\n@@ -967,1 +1157,1 @@\n-        if (found != m_objectPool.end()) {\n+        if (found != m_objectPoolMap.end()) {\n@@ -969,1 +1159,1 @@\n-            ASSERT(found->value < m_objectPool.size());\n+            ASSERT(found->value < m_objectPoolMap.size());\n@@ -971,1 +1161,3 @@\n-            return true;\n+            return true; \/\/ is dupe.\n+        }\n+        return false; \/\/ not dupe.\n@@ -974,10 +1166,2 @@\n-        return false;\n-    }\n-\n-    void recordObject(JSObject* object)\n-    {\n-        m_objectPool.add(object, m_objectPool.size());\n-        m_gcBuffer.appendWithCrashOnOverflow(object);\n-    }\n-\n-    bool startObjectInternal(JSObject* object)\n+    template<SerializationTag tag1, SerializationTag tag2 = ErrorTag, SerializationTag tag3 = ErrorTag>\n+    bool addToObjectPool(JSObject* object)\n@@ -985,5 +1169,3 @@\n-        if (checkForDuplicate(object))\n-            return false;\n-        recordObject(object);\n-        return true;\n-    }\n+        static_assert(canBeAddedToObjectPool(tag1)\n+            && (canBeAddedToObjectPool(tag2) || tag2 == ErrorTag)\n+            && (canBeAddedToObjectPool(tag3) || tag3 == ErrorTag));\n@@ -991,7 +1173,2 @@\n-    bool startObject(JSObject* object)\n-    {\n-        if (!startObjectInternal(object))\n-            return false;\n-        write(ObjectTag);\n-        return true;\n-    }\n+        m_objectPoolMap.add(object, m_objectPoolMap.size());\n+        m_objectPool.appendWithCrashOnOverflow(object);\n@@ -999,4 +1176,2 @@\n-    bool startArray(JSArray* array)\n-    {\n-        if (!startObjectInternal(array))\n-            return false;\n+        if constexpr (tag2 == ErrorTag)\n+            appendObjectPoolTag(tag1);\n@@ -1004,4 +1179,1 @@\n-        unsigned length = array->length();\n-        write(ArrayTag);\n-        write(length);\n-        return true;\n+        return true; \/\/ new object added.\n@@ -1010,1 +1182,2 @@\n-    bool startSet(JSSet* set)\n+    template<SerializationTag tag1, SerializationTag tag2 = ErrorTag, SerializationTag tag3 = ErrorTag>\n+    bool addToObjectPoolIfNotDupe(JSObject* object)\n@@ -1012,6 +1185,3 @@\n-        if (!startObjectInternal(set))\n-            return false;\n-\n-        write(SetObjectTag);\n-        return true;\n-    }\n+        static_assert(canBeAddedToObjectPool(tag1)\n+            && (canBeAddedToObjectPool(tag2) || tag2 == ErrorTag)\n+            && (canBeAddedToObjectPool(tag3) || tag3 == ErrorTag));\n@@ -1019,4 +1189,2 @@\n-    bool startMap(JSMap* map)\n-    {\n-        if (!startObjectInternal(map))\n-            return false;\n+        if (writeObjectReferenceIfDupe<tag1, tag2, tag3>(object))\n+            return false; \/\/ new object NOT added. It's a dupe.\n@@ -1024,2 +1192,2 @@\n-        write(MapObjectTag);\n-        return true;\n+        addToObjectPool<tag1, tag2, tag3>(object);\n+        return true; \/\/ new object added.\n@@ -1098,1 +1266,2 @@\n-        if (string.isEmpty())\n+        if (string.isEmpty()) {\n+            appendObjectPoolTag(EmptyStringObjectTag);\n@@ -1100,1 +1269,2 @@\n-        else {\n+        } else {\n+            appendObjectPoolTag(StringObjectTag);\n@@ -1203,2 +1373,6 @@\n-        else\n-            return false;\n+        else {\n+            \/\/ We need to return true here because the client only checks for the error condition if\n+            \/\/ the return value is true (same as all the error cases below).\n+            code = SerializationReturnCode::DataCloneError;\n+            return true;\n+        }\n@@ -1478,1 +1652,1 @@\n-                if (!startObjectInternal(booleanObject)) \/\/ handle duplicates\n+                if (!addToObjectPoolIfNotDupe<TrueObjectTag, FalseObjectTag>(booleanObject))\n@@ -1480,1 +1654,3 @@\n-                write(booleanObject->internalValue().toBoolean(m_lexicalGlobalObject) ? TrueObjectTag : FalseObjectTag);\n+                auto tag = booleanObject->internalValue().toBoolean(m_lexicalGlobalObject) ? TrueObjectTag : FalseObjectTag;\n+                write(tag);\n+                appendObjectPoolTag(tag);\n@@ -1484,1 +1660,1 @@\n-                if (!startObjectInternal(stringObject)) \/\/ handle duplicates\n+                if (!addToObjectPoolIfNotDupe<EmptyStringObjectTag, StringObjectTag>(stringObject))\n@@ -1491,1 +1667,1 @@\n-                if (!startObjectInternal(numberObject)) \/\/ handle duplicates\n+                if (!addToObjectPoolIfNotDupe<NumberObjectTag>(numberObject))\n@@ -1498,1 +1674,1 @@\n-                if (!startObjectInternal(bigIntObject)) \/\/ handle duplicates\n+                if (!addToObjectPoolIfNotDupe<BigIntObjectTag>(bigIntObject))\n@@ -1500,0 +1676,1 @@\n+                write(BigIntObjectTag);\n@@ -1502,1 +1679,0 @@\n-                write(BigIntObjectTag);\n@@ -1640,1 +1816,1 @@\n-                if (!startObjectInternal(obj)) \/\/ handle duplicates\n+                if (!addToObjectPoolIfNotDupe<ArrayBufferTag, ResizableArrayBufferTag, SharedArrayBufferTag>(obj))\n@@ -1652,0 +1828,1 @@\n+                        appendObjectPoolTag(SharedArrayBufferTag);\n@@ -1660,0 +1837,1 @@\n+                    appendObjectPoolTag(ResizableArrayBufferTag);\n@@ -1669,0 +1847,1 @@\n+                appendObjectPoolTag(ArrayBufferTag);\n@@ -1676,1 +1855,5 @@\n-                if (checkForDuplicate(obj))\n+                \/\/ Note: we can't just use addToObjectPoolIfNotDupe() here because the deserializer\n+                \/\/ expects to deserialize the children before it deserializes the JSArrayBufferView.\n+                \/\/ We need to make the serializer follow the same serialization order here by doing\n+                \/\/ this dance with writeObjectReferenceIfDupe() and addToObjectPool().\n+                if (writeObjectReferenceIfDupe<ArrayBufferViewTag>(obj))\n@@ -1679,1 +1862,1 @@\n-                recordObject(obj);\n+                addToObjectPool<ArrayBufferViewTag>(obj);\n@@ -1831,0 +2014,1 @@\n+        SERIALIZE_TRACE(\"serialize \", tag);\n@@ -1923,1 +2107,1 @@\n-        writeConstantPoolIndex(m_objectPool, i);\n+        writeConstantPoolIndex(m_objectPoolMap, i);\n@@ -2296,4 +2480,4 @@\n-    ObjectPool m_objectPool;\n-    ObjectPool m_transferredMessagePorts;\n-    ObjectPool m_transferredArrayBuffers;\n-    ObjectPool m_transferredImageBitmaps;\n+    ObjectPoolMap m_objectPoolMap;\n+    ObjectPoolMap m_transferredMessagePorts;\n+    ObjectPoolMap m_transferredArrayBuffers;\n+    ObjectPoolMap m_transferredImageBitmaps;\n@@ -2301,1 +2485,1 @@\n-    ObjectPool m_transferredOffscreenCanvases;\n+    ObjectPoolMap m_transferredOffscreenCanvases;\n@@ -2304,1 +2488,1 @@\n-    ObjectPool m_transferredRTCDataChannels;\n+    ObjectPoolMap m_transferredRTCDataChannels;\n@@ -2327,0 +2511,4 @@\n+#endif\n+    MarkedArgumentBuffer m_keepAliveBuffer;\n+#if ASSERT_ENABLED\n+    bool m_didSeeComplexCases { false };\n@@ -2354,1 +2542,1 @@\n-                if (!startArray(inArray))\n+                if (!addToObjectPoolIfNotDupe<ArrayTag>(inArray))\n@@ -2356,0 +2544,2 @@\n+                write(ArrayTag);\n+                write(length);\n@@ -2414,1 +2604,1 @@\n-                if (!startObject(inObject))\n+                if (!addToObjectPoolIfNotDupe<ObjectTag>(inObject))\n@@ -2416,0 +2606,1 @@\n+                write(ObjectTag);\n@@ -2477,1 +2668,1 @@\n-                if (!startMap(inMap))\n+                if (!addToObjectPoolIfNotDupe<MapObjectTag>(inMap))\n@@ -2479,0 +2670,1 @@\n+                write(MapObjectTag);\n@@ -2480,2 +2672,1 @@\n-                m_gcBuffer.appendWithCrashOnOverflow(inMap);\n-                m_gcBuffer.appendWithCrashOnOverflow(iterator);\n+                m_keepAliveBuffer.appendWithCrashOnOverflow(iterator);\n@@ -2503,1 +2694,1 @@\n-                m_gcBuffer.appendWithCrashOnOverflow(value);\n+                m_keepAliveBuffer.appendWithCrashOnOverflow(value);\n@@ -2523,1 +2714,1 @@\n-                if (!startSet(inSet))\n+                if (!addToObjectPoolIfNotDupe<SetObjectTag>(inSet))\n@@ -2525,0 +2716,1 @@\n+                write(SetObjectTag);\n@@ -2526,2 +2718,1 @@\n-                m_gcBuffer.appendWithCrashOnOverflow(inSet);\n-                m_gcBuffer.appendWithCrashOnOverflow(iterator);\n+                m_keepAliveBuffer.appendWithCrashOnOverflow(iterator);\n@@ -2586,1 +2777,1 @@\n-class CloneDeserializer : CloneBase {\n+class CloneDeserializer : public CloneBase {\n@@ -2655,1 +2846,25 @@\n-        return deserializer.deserialize();\n+        auto result = deserializer.deserialize();\n+        \/\/ Deserialize again if data may have wrong version number, see rdar:\/\/118775332.\n+        if (UNLIKELY(result.second != SerializationReturnCode::SuccessfullyCompleted && deserializer.version() == 14)) {\n+            CloneDeserializer newDeserializer(lexicalGlobalObject, globalObject, messagePorts, arrayBufferContentsArray, buffer, blobURLs, blobFilePaths, sharedBuffers, deserializer.takeBackingStores()\n+#if ENABLE(OFFSCREEN_CANVAS_IN_WORKERS)\n+                , deserializer.takeDetachedOffscreenCanvases()\n+                , inMemoryOffscreenCanvases\n+#endif\n+                , inMemoryMessagePorts\n+#if ENABLE(WEB_RTC)\n+                , deserializer.takeDetachedRTCDataChannels()\n+#endif\n+#if ENABLE(WEBASSEMBLY)\n+                , wasmModules\n+                , wasmMemoryHandles\n+#endif\n+#if ENABLE(WEB_CODECS)\n+                , deserializer.takeSerializedVideoChunks()\n+                , deserializer.takeSerializedVideoFrames()\n+#endif\n+                );\n+            newDeserializer.upgradeVersion();\n+            result = newDeserializer.deserialize();\n+        }\n+        return result;\n@@ -2810,0 +3025,12 @@\n+    Vector<std::optional<ImageBitmapBacking>> takeBackingStores() { return std::exchange(m_backingStores, { }); }\n+#if ENABLE(OFFSCREEN_CANVAS_IN_WORKERS)\n+    Vector<std::unique_ptr<DetachedOffscreenCanvas>> takeDetachedOffscreenCanvases() { return std::exchange(m_detachedOffscreenCanvases, { }); }\n+#endif\n+#if ENABLE(WEB_RTC)\n+    Vector<std::unique_ptr<DetachedRTCDataChannel>> takeDetachedRTCDataChannels() { return std::exchange(m_detachedRTCDataChannels, { }); }\n+#endif\n+#if ENABLE(WEB_CODECS)\n+    Vector<RefPtr<WebCodecsEncodedVideoChunkStorage>> takeSerializedVideoChunks() { return std::exchange(m_serializedVideoChunks, { }); }\n+    Vector<WebCodecsVideoFrameData> takeSerializedVideoFrames() { return std::exchange(m_serializedVideoFrames, { }); }\n+#endif\n+\n@@ -2811,0 +3038,14 @@\n+    unsigned version() const { return m_version; }\n+    void upgradeVersion()\n+    {\n+        RELEASE_ASSERT(m_version == 14);\n+        ++m_version;\n+    }\n+\n+    template<SerializationTag tag>\n+    inline void addToObjectPool(JSValue object)\n+    {\n+        static_assert(canBeAddedToObjectPool(tag));\n+        m_objectPool.appendWithCrashOnOverflow(object);\n+        appendObjectPoolTag(tag);\n+    }\n@@ -2815,0 +3056,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3009,0 +3251,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3019,0 +3262,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3029,1 +3273,2 @@\n-        if (m_ptr >= m_end)\n+        if (m_ptr >= m_end) {\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3031,1 +3276,4 @@\n-        return static_cast<SerializationTag>(*m_ptr++);\n+        }\n+        auto tag = static_cast<SerializationTag>(*m_ptr++);\n+        SERIALIZE_TRACE(\"deserialize \", tag);\n+        return tag;\n@@ -3876,0 +4124,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3895,0 +4144,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3911,0 +4161,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3923,0 +4174,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3928,0 +4180,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3933,0 +4186,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3938,0 +4192,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3969,0 +4224,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -3988,0 +4244,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4002,0 +4259,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4023,0 +4281,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4033,0 +4292,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4040,0 +4300,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4077,0 +4338,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4080,1 +4342,0 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(bigInt);\n@@ -4101,0 +4362,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4108,0 +4370,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4111,1 +4374,0 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(bigInt);\n@@ -4119,0 +4381,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4132,0 +4395,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4137,0 +4401,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4151,0 +4416,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4154,1 +4420,0 @@\n-        m_gcBuffer.appendWithCrashOnOverflow(bigInt);\n@@ -4162,0 +4427,1 @@\n+            SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4187,1 +4453,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(obj);\n+            addToObjectPool<FalseObjectTag>(obj);\n@@ -4193,1 +4459,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(obj);\n+            addToObjectPool<TrueObjectTag>(obj);\n@@ -4209,1 +4475,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(obj);\n+            addToObjectPool<NumberObjectTag>(obj);\n@@ -4218,1 +4484,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(obj);\n+            addToObjectPool<BigIntObjectTag>(obj);\n@@ -4259,0 +4525,1 @@\n+                    SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4271,0 +4538,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4284,0 +4552,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4293,0 +4562,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4333,1 +4603,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(obj);\n+            addToObjectPool<StringObjectTag>(obj);\n@@ -4339,1 +4609,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(obj);\n+            addToObjectPool<EmptyStringObjectTag>(obj);\n@@ -4358,0 +4628,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4363,0 +4634,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4368,0 +4640,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4373,0 +4646,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4378,0 +4652,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4383,0 +4658,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4389,1 +4665,1 @@\n-            auto index = readConstantPoolIndex(m_gcBuffer);\n+            auto index = readConstantPoolIndex(m_objectPool);\n@@ -4391,0 +4667,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4394,1 +4671,1 @@\n-            return m_gcBuffer.at(*index);\n+            return m_objectPool.at(*index);\n@@ -4400,0 +4677,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4409,0 +4687,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4421,0 +4700,1 @@\n+                    SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4428,0 +4708,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4437,1 +4718,0 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(result);\n@@ -4445,0 +4725,1 @@\n+                    SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4452,0 +4733,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4468,0 +4750,1 @@\n+                    SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4478,1 +4761,0 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(result);\n@@ -4485,0 +4767,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4492,0 +4775,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4496,1 +4780,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(result);\n+            addToObjectPool<ArrayBufferTag>(result);\n@@ -4502,0 +4786,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4509,0 +4794,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4513,1 +4799,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(result);\n+            addToObjectPool<ResizableArrayBufferTag>(result);\n@@ -4520,0 +4806,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize ArrayBufferTransferTag: indexSuccessfullyRead \", indexSuccessfullyRead, \" index \", index, \" m_arrayBuffers.size() \", m_arrayBuffers.size());\n@@ -4534,0 +4821,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4541,1 +4829,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(result);\n+            addToObjectPool<SharedArrayBufferTag>(result);\n@@ -4547,0 +4835,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4550,1 +4839,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(arrayBufferView);\n+            addToObjectPool<ArrayBufferViewTag>(arrayBufferView);\n@@ -4557,0 +4846,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4562,0 +4852,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4569,0 +4860,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4572,1 +4864,0 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(cryptoKey);\n@@ -4619,0 +4910,1 @@\n+            SERIALIZE_TRACE(\"push back \", tag);\n@@ -4680,0 +4972,4 @@\n+\n+#if ASSERT_ENABLED\n+    friend void validateSerializedResult(CloneSerializer&, SerializationReturnCode, Vector<uint8_t>&, JSGlobalObject*, Vector<RefPtr<MessagePort>>&, ArrayBufferContentsArray&, ArrayBufferContentsArray&, Vector<RefPtr<MessagePort>>&);\n+#endif\n@@ -4703,0 +4999,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4707,1 +5004,2 @@\n-            if (UNLIKELY(scope.exception()))\n+            if (UNLIKELY(scope.exception())) {\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4709,1 +5007,2 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(outArray);\n+            }\n+            addToObjectPool<ArrayTag>(outArray);\n@@ -4717,0 +5016,1 @@\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4725,0 +5025,1 @@\n+                        SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4770,1 +5071,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(outObject);\n+            addToObjectPool<ObjectTag>(outObject);\n@@ -4779,1 +5080,2 @@\n-                if (!wasTerminator)\n+                if (!wasTerminator) {\n+                    SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4781,0 +5083,1 @@\n+                }\n@@ -4801,2 +5104,3 @@\n-        mapObjectStartState: {\n-            if (outputObjectStack.size() > maximumFilterRecursion)\n+        mapStartState: {\n+            if (outputObjectStack.size() > maximumFilterRecursion) {\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4804,0 +5108,1 @@\n+            }\n@@ -4805,1 +5110,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(map);\n+            addToObjectPool<MapObjectTag>(map);\n@@ -4830,2 +5135,3 @@\n-        setObjectStartState: {\n-            if (outputObjectStack.size() > maximumFilterRecursion)\n+        setStartState: {\n+            if (outputObjectStack.size() > maximumFilterRecursion) {\n+                SERIALIZE_TRACE(\"FAIL deserialize\");\n@@ -4833,0 +5139,1 @@\n+            }\n@@ -4834,1 +5141,1 @@\n-            m_gcBuffer.appendWithCrashOnOverflow(set);\n+            addToObjectPool<SetObjectTag>(set);\n@@ -4866,1 +5173,1 @@\n-                goto mapObjectStartState;\n+                goto mapStartState;\n@@ -4868,1 +5175,1 @@\n-                goto setObjectStartState;\n+                goto setStartState;\n@@ -4885,0 +5192,108 @@\n+#if ASSERT_ENABLED\n+void validateSerializedResult(CloneSerializer& serializer, SerializationReturnCode code, Vector<uint8_t>& result, JSGlobalObject* lexicalGlobalObject, Vector<RefPtr<MessagePort>>& messagePorts, ArrayBufferContentsArray& arrayBufferContentsArray, ArrayBufferContentsArray& sharedBuffers, Vector<RefPtr<MessagePort>>& inMemoryMessagePorts)\n+{\n+    if (!JSC::Options::validateSerializedValue())\n+        return;\n+    if (serializer.didSeeComplexCases())\n+        return;\n+    if (code != SerializationReturnCode::SuccessfullyCompleted)\n+        return;\n+\n+    SERIALIZE_TRACE(\"validation start\");\n+\n+    VM& vm = lexicalGlobalObject->vm();\n+    auto scope = DECLARE_CATCH_SCOPE(vm);\n+\n+    JSGlobalObject* globalObject = lexicalGlobalObject;\n+    Vector<String> blobURLs;\n+    Vector<String> blobFilePaths;\n+    Vector<std::optional<ImageBitmapBacking>> backingStores;\n+#if ENABLE(OFFSCREEN_CANVAS_IN_WORKERS)\n+    Vector<std::unique_ptr<DetachedOffscreenCanvas>> detachedOffscreenCanvases;\n+    Vector<RefPtr<OffscreenCanvas>> inMemoryOffscreenCanvases;\n+#endif\n+#if ENABLE(WEB_RTC)\n+    Vector<std::unique_ptr<DetachedRTCDataChannel>> detachedRTCDataChannels;\n+#endif\n+#if ENABLE(WEBASSEMBLY)\n+    WasmModuleArray* wasmModules = nullptr;\n+    WasmMemoryHandleArray* wasmMemoryHandles = nullptr;\n+#endif\n+#if ENABLE(WEB_CODECS)\n+    Vector<RefPtr<WebCodecsEncodedVideoChunkStorage>> serializedVideoChunks;\n+    Vector<WebCodecsVideoFrameData> serializedVideoFrames;\n+#endif\n+\n+    CloneDeserializer deserializer(lexicalGlobalObject, globalObject, messagePorts, &arrayBufferContentsArray, result, blobURLs, blobFilePaths, &sharedBuffers, WTFMove(backingStores)\n+#if ENABLE(OFFSCREEN_CANVAS_IN_WORKERS)\n+        , WTFMove(detachedOffscreenCanvases)\n+        , inMemoryOffscreenCanvases\n+#endif\n+        , inMemoryMessagePorts\n+#if ENABLE(WEB_RTC)\n+        , WTFMove(detachedRTCDataChannels)\n+#endif\n+#if ENABLE(WEBASSEMBLY)\n+        , wasmModules\n+        , wasmMemoryHandles\n+#endif\n+#if ENABLE(WEB_CODECS)\n+        , WTFMove(serializedVideoChunks)\n+        , WTFMove(serializedVideoFrames)\n+        , WTFMove(serializedAudioChunks)\n+        , WTFMove(serializedAudioData)\n+#endif\n+        );\n+    RELEASE_ASSERT(deserializer.isValid());\n+    auto deserializationResult = deserializer.deserialize();\n+    if (scope.exception()) {\n+        scope.clearException();\n+        SERIALIZE_TRACE(\"validation abort due to exception\");\n+        return;\n+    }\n+\n+    if (deserializationResult.second != SerializationReturnCode::SuccessfullyCompleted) {\n+        SERIALIZE_TRACE(\"validation abort due to deserialization failure\");\n+        return;\n+    }\n+\n+    unsigned numChecks = 0;\n+    unsigned numMismatches = 0;\n+#define VALIDATE_EQ(a, b, ...) do { \\\n+        if ((a) != (b)) \\\n+            numMismatches++; \\\n+    } while (false)\n+\n+    auto& serializerTags = serializer.objectPoolTags();\n+    auto& deserializerTags = deserializer.objectPoolTags();\n+    VALIDATE_EQ(serializerTags.size(), deserializerTags.size(), \"\");\n+    size_t commonMinSize = std::min(serializerTags.size(), deserializerTags.size());\n+    size_t maxSize = std::max(serializerTags.size(), deserializerTags.size());\n+    for (size_t i = 0; i < commonMinSize; ++i)\n+        VALIDATE_EQ(serializerTags[i], deserializerTags[i], \" at i \", i);\n+    numChecks = 1 + maxSize;\n+    if (commonMinSize != maxSize)\n+        numMismatches += maxSize - commonMinSize;\n+\n+    if (numMismatches) {\n+        dataLogLn(\"\\n\\nERROR: serialization \/ deserialization mismatch:\");\n+        dataLogLn(\"\\n\");\n+        dataLogLn(\"    # of serializerTags = \", serializerTags.size());\n+        dataLogLn(\"    # of deserializerTags = \", deserializerTags.size());\n+        dataLogLn(\"    FOUND \", numMismatches, \" mismatches out of \", numChecks, \" checks\");\n+\n+        for (size_t i = 0; i < commonMinSize; ++i)\n+            dataLogLn(\"      serializerTags[\", i, \"] (\", serializerTags[i], \") deserializerTags[\", i, \"] (\", deserializerTags[i], \")\", serializerTags[i] == deserializerTags[i] ? \"\" : \" DIFFERENT\");\n+        for (size_t i = commonMinSize; i < serializerTags.size(); ++i)\n+            dataLogLn(\"      serializerTags[\", i, \"] (\", serializerTags[i], \") DIFFERENT\");\n+        for (size_t i = commonMinSize; i < deserializerTags.size(); ++i)\n+            dataLogLn(\"      deserializerTags[\", i, \"] (\", deserializerTags[i], \") DIFFERENT\");\n+        dataLogLn(\"\\n\\n\");\n+    }\n+#undef VALIDATE_EQ\n+    RELEASE_ASSERT(!numMismatches);\n+\n+    SERIALIZE_TRACE(\"validation done\");\n+}\n+#endif \/\/ ASSERT_ENABLED\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/bindings\/js\/SerializedScriptValue.cpp","additions":531,"deletions":116,"binary":false,"changes":647,"status":"modified"},{"patch":"@@ -582,1 +582,1 @@\n-\n+        newChild.setTreeScopeRecursively(treeScope());\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/ContainerNode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -30,1 +30,0 @@\n-    DisabledByQuirk=shouldDisableElementFullscreen,\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/Document+Fullscreen.idl","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -58,0 +58,1 @@\n+    options.sameOriginDataURLFlag = SameOriginDataURLFlag::Set;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/DocumentFontLoader.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-    DisabledByQuirk=shouldDisableElementFullscreen,\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/Element+Fullscreen.idl","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -4017,1 +4017,0 @@\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/Element.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -620,1 +620,1 @@\n-    bool dispatchMouseEvent(const PlatformMouseEvent&, const AtomString& eventType, int clickCount = 0, Element* relatedTarget = nullptr, IsSyntheticClick isSyntethicClick = IsSyntheticClick::No);\n+    bool dispatchMouseEvent(const PlatformMouseEvent&, const AtomString& eventType, int clickCount = 0, Element* relatedTarget = nullptr, IsSyntheticClick isSyntheticClick = IsSyntheticClick::No);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/Element.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -136,0 +136,3 @@\n+        ASSERT(node);\n+        if (!node)\n+            return;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/EventPath.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -100,1 +100,1 @@\n-    if (!passive.has_value() && Quirks::shouldMakeEventListenerPassive(*this, eventType, listener.get()))\n+    if (!passive.has_value() && Quirks::shouldMakeEventListenerPassive(*this, eventType))\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/EventTarget.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -201,0 +201,1 @@\n+    bool isCharacterData() const { return hasNodeFlag(NodeFlag::IsCharacterData); }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/Node.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -319,1 +319,1 @@\n-    if (anchorNode->isTextNode())\n+    if (anchorNode->isCharacterData())\n@@ -326,1 +326,1 @@\n-    if (anchorNode->isTextNode())\n+    if (anchorNode->isCharacterData())\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/Position.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -460,2 +460,3 @@\n-    for (auto& anchor : descendantsOfType<HTMLAnchorElement>(m_rootNode)) {\n-        if (m_rootNode.document().inQuirksMode()) {\n+    Ref rootNode = m_rootNode;\n+    for (auto& anchor : descendantsOfType<HTMLAnchorElement>(rootNode)) {\n+        if (rootNode->document().inQuirksMode()) {\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/TreeScope.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -117,1 +117,2 @@\n-    for (auto& element : descendantsOfType<Element>(scope.rootNode())) {\n+    Ref rootNode = scope.rootNode();\n+    for (auto& element : descendantsOfType<Element>(rootNode)) {\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/TreeScopeOrderedMap.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-UserGestureToken::UserGestureToken(ProcessingUserGestureState state, UserGestureType gestureType, Document* document, std::optional<WTF::UUID> authorizationToken)\n+UserGestureToken::UserGestureToken(ProcessingUserGestureState state, UserGestureType gestureType, Document* document, std::optional<WTF::UUID> authorizationToken, CanRequestDOMPaste canRequestDOMPaste)\n@@ -50,0 +50,1 @@\n+    , m_canRequestDOMPaste(canRequestDOMPaste)\n@@ -109,1 +110,1 @@\n-UserGestureIndicator::UserGestureIndicator(std::optional<ProcessingUserGestureState> state, Document* document, UserGestureType gestureType, ProcessInteractionStyle processInteractionStyle, std::optional<WTF::UUID> authorizationToken)\n+UserGestureIndicator::UserGestureIndicator(std::optional<ProcessingUserGestureState> state, Document* document, UserGestureType gestureType, ProcessInteractionStyle processInteractionStyle, std::optional<WTF::UUID> authorizationToken, CanRequestDOMPaste canRequestDOMPaste)\n@@ -115,1 +116,1 @@\n-        currentToken() = UserGestureToken::create(state.value(), gestureType, document, authorizationToken);\n+        currentToken() = UserGestureToken::create(state.value(), gestureType, document, authorizationToken, canRequestDOMPaste);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/UserGestureIndicator.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -49,1 +49,2 @@\n-enum class UserGestureType { EscapeKey, ActivationTriggering, Other };\n+enum class CanRequestDOMPaste : bool { No, Yes };\n+enum class UserGestureType : uint8_t { EscapeKey, ActivationTriggering, Other };\n@@ -57,1 +58,1 @@\n-    static Ref<UserGestureToken> create(ProcessingUserGestureState state, UserGestureType gestureType, Document* document = nullptr, std::optional<WTF::UUID> authorizationToken = std::nullopt)\n+    static Ref<UserGestureToken> create(ProcessingUserGestureState state, UserGestureType gestureType, Document* document = nullptr, std::optional<WTF::UUID> authorizationToken = std::nullopt, CanRequestDOMPaste canRequestDOMPaste = CanRequestDOMPaste::Yes)\n@@ -59,1 +60,1 @@\n-        return adoptRef(*new UserGestureToken(state, gestureType, document, authorizationToken));\n+        return adoptRef(*new UserGestureToken(state, gestureType, document, authorizationToken, canRequestDOMPaste));\n@@ -109,0 +110,2 @@\n+    bool canRequestDOMPaste() const { return m_canRequestDOMPaste == CanRequestDOMPaste::Yes; }\n+\n@@ -114,1 +117,1 @@\n-    UserGestureToken(ProcessingUserGestureState, UserGestureType, Document*, std::optional<WTF::UUID> authorizationToken);\n+    UserGestureToken(ProcessingUserGestureState, UserGestureType, Document*, std::optional<WTF::UUID> authorizationToken, CanRequestDOMPaste);\n@@ -120,0 +123,1 @@\n+    CanRequestDOMPaste m_canRequestDOMPaste { CanRequestDOMPaste::No };\n@@ -138,1 +142,1 @@\n-    WEBCORE_EXPORT explicit UserGestureIndicator(std::optional<ProcessingUserGestureState>, Document* = nullptr, UserGestureType = UserGestureType::ActivationTriggering, ProcessInteractionStyle = ProcessInteractionStyle::Immediate, std::optional<WTF::UUID> authorizationToken = std::nullopt);\n+    WEBCORE_EXPORT explicit UserGestureIndicator(std::optional<ProcessingUserGestureState>, Document* = nullptr, UserGestureType = UserGestureType::ActivationTriggering, ProcessInteractionStyle = ProcessInteractionStyle::Immediate, std::optional<WTF::UUID> authorizationToken = std::nullopt, CanRequestDOMPaste = CanRequestDOMPaste::Yes);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/dom\/UserGestureIndicator.h","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+#include \"Quirks.h\"\n@@ -86,3 +87,3 @@\n-    auto& topDocument = document.topDocument();\n-    auto* ancestorDocument = &document;\n-    while (ancestorDocument != &topDocument) {\n+    Ref topDocument = document.topDocument();\n+    RefPtr ancestorDocument = &document;\n+    while (ancestorDocument.get() != topDocument.ptr()) {\n@@ -95,9 +96,15 @@\n-        auto* ownerElement = ancestorDocument->ownerElement();\n-        if (is<HTMLIFrameElement>(ownerElement)) {\n-            const auto& featurePolicy = downcast<HTMLIFrameElement>(ownerElement)->featurePolicy();\n-            if (!featurePolicy.allows(type, ancestorDocument->securityOrigin().data())) {\n-                if (logFailure == LogFeaturePolicyFailure::Yes && document.domWindow()) {\n-                    auto& allowValue = downcast<HTMLIFrameElement>(ownerElement)->attributeWithoutSynchronization(HTMLNames::allowAttr);\n-                    document.domWindow()->printErrorMessage(makeString(\"Feature policy '\", policyTypeName(type), \"' check failed for iframe with origin '\", document.securityOrigin().toString(), \"' and allow attribute '\", allowValue, \"'.\"));\n-                }\n-                return false;\n+        RefPtr ownerElement = ancestorDocument->ownerElement();\n+        RefPtr iframe = dynamicDowncast<HTMLIFrameElement>(ownerElement.get());\n+\n+        bool isAllowedByFeaturePolicy = false;\n+        if (iframe)\n+            isAllowedByFeaturePolicy = iframe->featurePolicy().allows(type, ancestorDocument->securityOrigin().data());\n+        else if (ownerElement)\n+            isAllowedByFeaturePolicy = FeaturePolicy::defaultPolicy(ownerElement->document()).allows(type, ancestorDocument->securityOrigin().data());\n+\n+        if (!isAllowedByFeaturePolicy) {\n+            if (logFailure == LogFeaturePolicyFailure::Yes && document.domWindow()) {\n+                String allowValue;\n+                if (iframe)\n+                    allowValue = iframe->attributeWithoutSynchronization(HTMLNames::allowAttr);\n+                document.domWindow()->printErrorMessage(makeString(\"Feature policy '\", policyTypeName(type), \"' check failed for element with origin '\", document.securityOrigin().toString(), \"' and allow attribute '\", allowValue, \"'.\"));\n@@ -105,0 +112,1 @@\n+            return false;\n@@ -167,1 +175,0 @@\n-    \/\/ We keep the empty string value equivalent to '*' for existing websites.\n@@ -169,0 +176,5 @@\n+        if (document.quirks().shouldStarBeFeaturePolicyDefaultValue()) {\n+            rule.type = FeaturePolicy::AllowRule::Type::All;\n+            return;\n+        }\n+\n@@ -189,1 +201,1 @@\n-FeaturePolicy FeaturePolicy::parse(Document& document, const HTMLIFrameElement& iframe, StringView allowAttributeValue)\n+FeaturePolicy FeaturePolicy::parse(Document& document, const HTMLIFrameElement* iframe, StringView allowAttributeValue)\n@@ -213,52 +225,53 @@\n-    for (auto allowItem : allowAttributeValue.split(';')) {\n-        auto item = allowItem.trim(isASCIIWhitespace<UChar>);\n-        if (item.startsWith(\"camera\"_s)) {\n-            isCameraInitialized = true;\n-            updateList(document, iframe, policy.m_cameraRule, item.substring(7));\n-            continue;\n-        }\n-        if (item.startsWith(\"microphone\"_s)) {\n-            isMicrophoneInitialized = true;\n-            updateList(document, iframe, policy.m_microphoneRule, item.substring(11));\n-            continue;\n-        }\n-        if (item.startsWith(\"speaker-selection\"_s)) {\n-            isSpeakerSelectionInitialized = true;\n-            updateList(document, iframe, policy.m_speakerSelectionRule, item.substring(18));\n-            continue;\n-        }\n-        if (item.startsWith(\"display-capture\"_s)) {\n-            isDisplayCaptureInitialized = true;\n-            updateList(document, iframe, policy.m_displayCaptureRule, item.substring(16));\n-            continue;\n-        }\n-        if (item.startsWith(\"geolocation\"_s)) {\n-            isGeolocationInitialized = true;\n-            updateList(document, iframe, policy.m_geolocationRule, item.substring(12));\n-            continue;\n-        }\n-        if (item.startsWith(\"payment\"_s)) {\n-            isPaymentInitialized = true;\n-            updateList(document, iframe, policy.m_paymentRule, item.substring(8));\n-            continue;\n-        }\n-        if (item.startsWith(\"screen-wake-lock\"_s)) {\n-            isScreenWakeLockInitialized = true;\n-            updateList(document, iframe, policy.m_screenWakeLockRule, item.substring(17));\n-            continue;\n-        }\n-        if (item.startsWith(\"sync-xhr\"_s)) {\n-            isSyncXHRInitialized = true;\n-            updateList(document, iframe, policy.m_syncXHRRule, item.substring(9));\n-            continue;\n-        }\n-        if (item.startsWith(\"fullscreen\"_s)) {\n-            isFullscreenInitialized = true;\n-            updateList(document, iframe, policy.m_fullscreenRule, item.substring(11));\n-            continue;\n-        }\n-        if (item.startsWith(\"web-share\"_s)) {\n-            isWebShareInitialized = true;\n-            updateList(document, iframe, policy.m_webShareRule, item.substring(10));\n-            continue;\n-        }\n+    if (iframe) {\n+        for (auto allowItem : allowAttributeValue.split(';')) {\n+            auto item = allowItem.trim(isASCIIWhitespace<UChar>);\n+            if (item.startsWith(\"camera\"_s)) {\n+                isCameraInitialized = true;\n+                updateList(document, *iframe, policy.m_cameraRule, item.substring(7));\n+                continue;\n+            }\n+            if (item.startsWith(\"microphone\"_s)) {\n+                isMicrophoneInitialized = true;\n+                updateList(document, *iframe, policy.m_microphoneRule, item.substring(11));\n+                continue;\n+            }\n+            if (item.startsWith(\"speaker-selection\"_s)) {\n+                isSpeakerSelectionInitialized = true;\n+                updateList(document, *iframe, policy.m_speakerSelectionRule, item.substring(18));\n+                continue;\n+            }\n+            if (item.startsWith(\"display-capture\"_s)) {\n+                isDisplayCaptureInitialized = true;\n+                updateList(document, *iframe, policy.m_displayCaptureRule, item.substring(16));\n+                continue;\n+            }\n+            if (item.startsWith(\"geolocation\"_s)) {\n+                isGeolocationInitialized = true;\n+                updateList(document, *iframe, policy.m_geolocationRule, item.substring(12));\n+                continue;\n+            }\n+            if (item.startsWith(\"payment\"_s)) {\n+                isPaymentInitialized = true;\n+                updateList(document, *iframe, policy.m_paymentRule, item.substring(8));\n+                continue;\n+            }\n+            if (item.startsWith(\"screen-wake-lock\"_s)) {\n+                isScreenWakeLockInitialized = true;\n+                updateList(document, *iframe, policy.m_screenWakeLockRule, item.substring(17));\n+                continue;\n+            }\n+            if (item.startsWith(\"sync-xhr\"_s)) {\n+                isSyncXHRInitialized = true;\n+                updateList(document, *iframe, policy.m_syncXHRRule, item.substring(9));\n+                continue;\n+            }\n+            if (item.startsWith(\"fullscreen\"_s)) {\n+                isFullscreenInitialized = true;\n+                updateList(document, *iframe, policy.m_fullscreenRule, item.substring(11));\n+                continue;\n+            }\n+            if (item.startsWith(\"web-share\"_s)) {\n+                isWebShareInitialized = true;\n+                updateList(document, *iframe, policy.m_webShareRule, item.substring(10));\n+                continue;\n+            }\n@@ -266,15 +279,15 @@\n-        if (item.startsWith(\"gyroscope\"_s)) {\n-            isGyroscopeInitialized = true;\n-            updateList(document, iframe, policy.m_gyroscopeRule, item.substring(10));\n-            continue;\n-        }\n-        if (item.startsWith(\"accelerometer\"_s)) {\n-            isAccelerometerInitialized = true;\n-            updateList(document, iframe, policy.m_accelerometerRule, item.substring(14));\n-            continue;\n-        }\n-        if (item.startsWith(\"magnetometer\"_s)) {\n-            isMagnetometerInitialized = true;\n-            updateList(document, iframe, policy.m_magnetometerRule, item.substring(13));\n-            continue;\n-        }\n+            if (item.startsWith(\"gyroscope\"_s)) {\n+                isGyroscopeInitialized = true;\n+                updateList(document, *iframe, policy.m_gyroscopeRule, item.substring(10));\n+                continue;\n+            }\n+            if (item.startsWith(\"accelerometer\"_s)) {\n+                isAccelerometerInitialized = true;\n+                updateList(document, *iframe, policy.m_accelerometerRule, item.substring(14));\n+                continue;\n+            }\n+            if (item.startsWith(\"magnetometer\"_s)) {\n+                isMagnetometerInitialized = true;\n+                updateList(document, *iframe, policy.m_magnetometerRule, item.substring(13));\n+                continue;\n+            }\n@@ -283,5 +296,5 @@\n-        if (item.startsWith(\"publickey-credentials-get\"_s)) {\n-            isPublickeyCredentialsGetInitialized = true;\n-            updateList(document, iframe, policy.m_publickeyCredentialsGetRule, item.substring(26));\n-            continue;\n-        }\n+            if (item.startsWith(\"publickey-credentials-get\"_s)) {\n+                isPublickeyCredentialsGetInitialized = true;\n+                updateList(document, *iframe, policy.m_publickeyCredentialsGetRule, item.substring(26));\n+                continue;\n+            }\n@@ -290,5 +303,5 @@\n-        if (item.startsWith(\"xr-spatial-tracking\"_s)) {\n-            isXRSpatialTrackingInitialized = true;\n-            updateList(document, iframe, policy.m_xrSpatialTrackingRule, item.substring(19));\n-            continue;\n-        }\n+            if (item.startsWith(\"xr-spatial-tracking\"_s)) {\n+                isXRSpatialTrackingInitialized = true;\n+                updateList(document, *iframe, policy.m_xrSpatialTrackingRule, item.substring(19));\n+                continue;\n+            }\n@@ -296,0 +309,1 @@\n+        }\n@@ -337,1 +351,1 @@\n-        if (iframe.hasAttribute(allowfullscreenAttr) || iframe.hasAttribute(webkitallowfullscreenAttr)) {\n+        if (iframe && (iframe->hasAttribute(allowfullscreenAttr) || iframe->hasAttribute(webkitallowfullscreenAttr))) {\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/FeaturePolicy.cpp","additions":106,"deletions":92,"binary":false,"changes":198,"status":"modified"},{"patch":"@@ -39,1 +39,2 @@\n-    static FeaturePolicy parse(Document&, const HTMLIFrameElement&, StringView);\n+    static FeaturePolicy defaultPolicy(Document& document) { return parse(document, nullptr, { }); }\n+    static FeaturePolicy parse(Document& document, const HTMLIFrameElement& frame, StringView allow) { return parse(document, &frame, allow); }\n@@ -73,0 +74,2 @@\n+    static FeaturePolicy parse(Document&, const HTMLIFrameElement*, StringView);\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/FeaturePolicy.h","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -50,0 +50,1 @@\n+#include \"Quirks.h\"\n@@ -105,1 +106,1 @@\n-    if (isLink())\n+    if (isLink() && !document().quirks().needsAnchorElementsToBeMouseFocusable())\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/HTMLAnchorElement.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -725,3 +725,5 @@\n-    if (document().quirks().shouldEnableCanvas2DAdvancedPrivacyProtectionQuirk()) {\n-        if (auto url = document().quirks().advancedPrivacyProtectionSubstituteDataURLForText(lastFillText()); !url.isNull())\n-            return UncachedString { url };\n+    if (auto url = document().quirks().advancedPrivacyProtectionSubstituteDataURLForScriptWithFeatures(lastFillText(), width(), height()); !url.isNull()) {\n+        RELEASE_LOG(FingerprintingMitigation, \"HTMLCanvasElement::toDataURL: Quirking returned URL for identified fingerprinting script\");\n+        auto consoleMessage = \"Detected fingerprinting script. Quirking value returned from HTMLCanvasElement.toDataURL()\"_s;\n+        canvasBaseScriptExecutionContext()->addConsoleMessage(MessageSource::Rendering, MessageLevel::Info, consoleMessage);\n+        return UncachedString { url };\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/HTMLCanvasElement.cpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-bool HTMLFrameElement::rendererIsNeeded(const RenderStyle&)\n+bool HTMLFrameElement::rendererIsNeeded(const RenderStyle& style)\n@@ -54,2 +54,1 @@\n-    \/\/ For compatibility, frames render even when display: none is set.\n-    return canLoad();\n+    return HTMLFrameElementBase::rendererIsNeeded(style) && canLoad();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/HTMLFrameElement.cpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -149,6 +149,0 @@\n-bool HTMLFrameSetElement::rendererIsNeeded(const RenderStyle&)\n-{\n-    \/\/ For compatibility, frames render even when display: none is set.\n-    return true;\n-}\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/HTMLFrameSetElement.cpp","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -65,1 +65,0 @@\n-    bool rendererIsNeeded(const RenderStyle&) final;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/HTMLFrameSetElement.h","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1158,9 +1158,0 @@\n-#if PLATFORM(COCOA)\n-    if (document().quirks().shouldAdvertiseSupportForHLSSubtitleTypes()\n-        && contentType.containerType() == \"application\/vnd.apple.mpegurl\"_s\n-        && (contentType.codecs().contains(\"stpp.ttml.im1t\"_s) || contentType.codecs().contains(\"wvtt\"_s))) {\n-        ALWAYS_LOG(LOGIDENTIFIER, \"Quirk, \", mimeType, \": probably\");\n-        return \"probably\"_s;\n-    }\n-#endif\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/HTMLMediaElement.cpp","additions":0,"deletions":9,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -198,1 +198,1 @@\n-        transform.translate(x, y).rotate(rad2deg(rotation));\n+        transform.translate(x, y).rotateRadians(rotation);\n@@ -206,1 +206,1 @@\n-        transform.translate(x, y).rotate(rad2deg(rotation));\n+        transform.translate(x, y).rotateRadians(rotation);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/canvas\/CanvasPath.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -38,1 +38,2 @@\n-    : m_is8Bit(line.is8Bit())\n+    : m_source(line)\n+    , m_is8Bit(line.is8Bit())\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/track\/VTTScanner.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -149,0 +149,1 @@\n+    const String m_source;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/html\/track\/VTTScanner.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -531,0 +531,8 @@\n+bool ImageLoader::hasPendingActivity() const\n+{\n+    \/\/ Because of lazy image loading, an image's load may be deferred indefinitely. To avoid leaking the element, we only\n+    \/\/ protect it once the load has actually started.\n+    bool imageWillBeLoadedLater = m_image && !m_image->isLoading() && m_image->stillNeedsLoad();\n+    return (m_hasPendingLoadEvent && !imageWillBeLoadedLater) || m_hasPendingErrorEvent;\n+}\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/loader\/ImageLoader.cpp","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -76,1 +76,1 @@\n-    bool hasPendingActivity() const { return m_hasPendingLoadEvent || m_hasPendingErrorEvent; }\n+    bool hasPendingActivity() const;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/loader\/ImageLoader.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -252,0 +252,1 @@\n+        CachedResourceHandle resource = m_resource.get();\n@@ -268,1 +269,1 @@\n-            m_resource->responseReceived(opaqueRedirectedResponse);\n+            resource->responseReceived(opaqueRedirectedResponse);\n@@ -289,1 +290,1 @@\n-        if (newRequest.isConditional() && m_resource->resourceToRevalidate() && newRequest.url() != m_resource->resourceToRevalidate()->response().url()) {\n+        if (newRequest.isConditional() && resource->resourceToRevalidate() && newRequest.url() != resource->resourceToRevalidate()->response().url()) {\n@@ -291,1 +292,1 @@\n-            MemoryCache::singleton().revalidationFailed(*m_resource);\n+            MemoryCache::singleton().revalidationFailed(*resource);\n@@ -297,1 +298,1 @@\n-        m_site = m_documentLoader->cachedResourceLoader().computeFetchMetadataSite(newRequest, m_resource->type(), options().mode, originalOrigin, m_site);\n+        m_site = m_documentLoader->cachedResourceLoader().computeFetchMetadataSite(newRequest, resource->type(), options().mode, originalOrigin, m_site);\n@@ -299,1 +300,1 @@\n-        if (!m_documentLoader->cachedResourceLoader().updateRequestAfterRedirection(m_resource->type(), newRequest, options(), m_site, originalRequest().url())) {\n+        if (!m_documentLoader->cachedResourceLoader().updateRequestAfterRedirection(resource->type(), newRequest, options(), m_site, originalRequest().url())) {\n@@ -323,1 +324,1 @@\n-        if (m_resource->isImage() && m_documentLoader->cachedResourceLoader().shouldDeferImageLoad(newRequest.url())) {\n+        if (resource->isImage() && m_documentLoader->cachedResourceLoader().shouldDeferImageLoad(newRequest.url())) {\n@@ -328,1 +329,1 @@\n-        m_resource->redirectReceived(WTFMove(newRequest), redirectResponse, [this, protectedThis = WTFMove(protectedThis), completionHandler = WTFMove(completionHandler), continueWillSendRequest = WTFMove(continueWillSendRequest)] (ResourceRequest&& request) mutable {\n+        resource->redirectReceived(WTFMove(newRequest), redirectResponse, [this, protectedThis = WTFMove(protectedThis), completionHandler = WTFMove(completionHandler), continueWillSendRequest = WTFMove(continueWillSendRequest)] (ResourceRequest&& request) mutable {\n@@ -342,1 +343,1 @@\n-    m_resource->didSendData(bytesSent, totalBytesToBeSent);\n+    protectedCachedResource()->didSendData(bytesSent, totalBytesToBeSent);\n@@ -363,1 +364,1 @@\n-    m_resource->previewResponseReceived(response);\n+    protectedCachedResource()->previewResponseReceived(response);\n@@ -413,1 +414,1 @@\n-    \/\/ redirection with no Location headers and fetch in manual redirect mode. Or in rare circumstances,\n+    \/\/ redirection with no or empty Location headers and fetch in manual redirect mode. Or in rare circumstances,\n@@ -416,1 +417,1 @@\n-    ASSERT(response.httpStatusCode() < 300 || response.httpStatusCode() >= 400 || response.httpStatusCode() == 304 || !response.httpHeaderField(HTTPHeaderName::Location) || response.type() == ResourceResponse::Type::Opaqueredirect);\n+    ASSERT(response.httpStatusCode() < 300 || response.httpStatusCode() >= 400 || response.httpStatusCode() == 304 || response.httpHeaderField(HTTPHeaderName::Location).isEmpty() || response.type() == ResourceResponse::Type::Opaqueredirect);\n@@ -426,1 +427,2 @@\n-    if (!m_resource) {\n+    CachedResourceHandle resource = m_resource.get();\n+    if (!resource) {\n@@ -431,1 +433,1 @@\n-    if (m_resource && m_resource->resourceToRevalidate()) {\n+    if (resource && resource->resourceToRevalidate()) {\n@@ -437,2 +439,2 @@\n-            m_resource->setResponse(revalidationResponse);\n-            MemoryCache::singleton().revalidationSucceeded(*m_resource, revalidationResponse);\n+            resource->setResponse(revalidationResponse);\n+            MemoryCache::singleton().revalidationSucceeded(*resource, revalidationResponse);\n@@ -446,1 +448,1 @@\n-        MemoryCache::singleton().revalidationFailed(*m_resource);\n+        MemoryCache::singleton().revalidationFailed(*resource);\n@@ -470,2 +472,2 @@\n-            if (m_resource)\n-                m_resource->responseReceived(opaqueRedirectedResponse);\n+            if (resource)\n+                resource->responseReceived(opaqueRedirectedResponse);\n@@ -478,2 +480,2 @@\n-    if (m_resource)\n-        m_resource->responseReceived(response);\n+    if (resource)\n+        resource->responseReceived(response);\n@@ -492,1 +494,2 @@\n-        if (isResponseMultipart && m_resource && m_resource->type() != CachedResource::Type::MainResource) {\n+        CachedResourceHandle resource = m_resource.get();\n+        if (isResponseMultipart && resource && resource->type() != CachedResource::Type::MainResource) {\n@@ -497,1 +500,1 @@\n-            if (!m_resource->isImage()) {\n+            if (!resource->isImage()) {\n@@ -507,2 +510,2 @@\n-            if (m_resource)\n-                m_resource->finishLoading(buffer->copy().ptr(), { });\n+            if (resource)\n+                resource->finishLoading(buffer->copy().ptr(), { });\n@@ -523,1 +526,1 @@\n-            m_resource->error(CachedResource::LoadError);\n+            resource->error(CachedResource::LoadError);\n@@ -549,1 +552,2 @@\n-    ASSERT(m_resource);\n+    CachedResourceHandle resource = m_resource.get();\n+    ASSERT(resource);\n@@ -551,1 +555,1 @@\n-    if (m_resource->response().httpStatusCode() >= 400 && !m_resource->shouldIgnoreHTTPStatusCodeErrors())\n+    if (resource->response().httpStatusCode() >= 400 && !resource->shouldIgnoreHTTPStatusCodeErrors())\n@@ -553,2 +557,2 @@\n-    ASSERT(!m_resource->resourceToRevalidate());\n-    ASSERT(!m_resource->errorOccurred());\n+    ASSERT(!resource->resourceToRevalidate());\n+    ASSERT(!resource->errorOccurred());\n@@ -564,1 +568,1 @@\n-            m_resource->updateBuffer(*resourceData);\n+            resource->updateBuffer(*resourceData);\n@@ -566,1 +570,1 @@\n-            m_resource->updateData(buffer.makeContiguous());\n+            resource->updateData(buffer.makeContiguous());\n@@ -831,1 +835,2 @@\n-    LOG(ResourceLoading, \"Cancelled load of '%s'.\\n\", m_resource->url().string().latin1().data());\n+    CachedResourceHandle resource = m_resource.get();\n+    LOG(ResourceLoading, \"Cancelled load of '%s'.\\n\", resource->url().string().latin1().data());\n@@ -840,1 +845,1 @@\n-    if (m_resource->resourceToRevalidate())\n+    if (resource->resourceToRevalidate())\n@@ -842,1 +847,1 @@\n-    m_resource->setResourceError(error);\n+    resource->setResourceError(error);\n@@ -853,1 +858,2 @@\n-    if (m_resource->type() != CachedResource::Type::MainResource)\n+    CachedResourceHandle resource = m_resource.get();\n+    if (resource->type() != CachedResource::Type::MainResource)\n@@ -856,1 +862,1 @@\n-    m_resource->cancelLoad();\n+    resource->cancelLoad();\n@@ -893,1 +899,1 @@\n-        m_resource->clearLoader();\n+        CachedResourceHandle { m_resource.get() }->clearLoader();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/loader\/SubresourceLoader.cpp","additions":43,"deletions":37,"binary":false,"changes":80,"status":"modified"},{"patch":"@@ -54,1 +54,3 @@\n-    CachedResource* cachedResource() const override { return m_resource.get(); };\n+    CachedResource* cachedResource() const override { return m_resource.get(); }\n+    CachedResourceHandle<CachedResource> protectedCachedResource() const { return cachedResource(); }\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/loader\/SubresourceLoader.h","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -3726,1 +3726,2 @@\n-    UserGestureIndicator gestureIndicator(ProcessingUserGesture, m_frame.document(), gestureType, UserGestureIndicator::ProcessInteractionStyle::Delayed);\n+    auto canRequestDOMPaste = m_frame.document()->quirks().needsDisableDOMPasteAccessQuirk() ? CanRequestDOMPaste::No : CanRequestDOMPaste::Yes;\n+    UserGestureIndicator gestureIndicator(ProcessingUserGesture, m_frame.document(), gestureType, UserGestureIndicator::ProcessInteractionStyle::Delayed, std::nullopt, canRequestDOMPaste);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/EventHandler.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -580,1 +580,1 @@\n-    if (!gestureToken || !gestureToken->processingUserGesture())\n+    if (!gestureToken || !gestureToken->processingUserGesture() || !gestureToken->canRequestDOMPaste())\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/LocalFrame.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -4268,15 +4268,0 @@\n-void LocalFrameView::scrollToPositionWithAnimation(const ScrollPosition& position, const ScrollPositionChangeOptions& options)\n-{\n-    \/\/ FIXME: Why isn't all this in ScrollableArea?\n-    auto previousScrollType = currentScrollType();\n-    setCurrentScrollType(options.type);\n-\n-    if (scrollAnimationStatus() == ScrollAnimationStatus::Animating)\n-        scrollAnimator().cancelAnimations();\n-\n-    if (position != scrollPosition())\n-        ScrollableArea::scrollToPositionWithAnimation(position, options);\n-\n-    setCurrentScrollType(previousScrollType);\n-}\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/LocalFrameView.cpp","additions":0,"deletions":15,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -721,2 +721,0 @@\n-    void scrollToPositionWithAnimation(const ScrollPosition&, const ScrollPositionChangeOptions& options = ScrollPositionChangeOptions::createProgrammatic());\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/LocalFrameView.h","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -65,0 +65,6 @@\n+#include <JavaScriptCore\/CodeBlock.h>\n+#include <JavaScriptCore\/JSLock.h>\n+#include <JavaScriptCore\/ScriptExecutable.h>\n+#include <JavaScriptCore\/SourceCode.h>\n+#include <JavaScriptCore\/SourceProvider.h>\n+#include <JavaScriptCore\/StackVisitor.h>\n@@ -85,1 +91,1 @@\n-    return startsWithLettersIgnoringASCIICase(host, \"mail.\"_s) && topPrivatelyControlledDomain(host.toString()).startsWith(\"yahoo.\"_s);\n+    return host.startsWith(\"mail.\"_s) && topPrivatelyControlledDomain(host.toString()).startsWith(\"yahoo.\"_s);\n@@ -106,0 +112,19 @@\n+\/\/ FIXME: Add more options to the helper to cover more patterns.\n+\/\/ - end of domain\n+\/\/ - full domain\n+\/\/ - path?\n+\/\/ or make different helpers\n+bool Quirks::isDomain(const String& domainString) const\n+{\n+    return RegistrableDomain(m_document->topDocument().url()).string() == domainString;\n+}\n+\n+\/\/ vote.gov https:\/\/bugs.webkit.org\/show_bug.cgi?id=267779\n+bool Quirks::needsAnchorElementsToBeMouseFocusable() const\n+{\n+    if (!needsQuirks())\n+        return false;\n+\n+    return isDomain(\"vote.gov\"_s);\n+}\n+\n@@ -113,2 +138,1 @@\n-    auto host = m_document->url().host();\n-    return equalLettersIgnoringASCIICase(host, \"ceac.state.gov\"_s) || host.endsWithIgnoringASCIICase(\".ceac.state.gov\"_s);\n+    return m_document->topDocument().url().host() == \"ceac.state.gov\"_s;\n@@ -137,2 +161,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"netflix.com\"_s) || host.endsWithIgnoringASCIICase(\".netflix.com\"_s);\n+    return isDomain(\"netflix.com\"_s);\n@@ -151,2 +174,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"netflix.com\"_s) || host.endsWithIgnoringASCIICase(\".netflix.com\"_s);\n+    return isDomain(\"netflix.com\"_s);\n@@ -156,1 +178,0 @@\n-\/\/ bing.com https:\/\/bugs.webkit.org\/show_bug.cgi?id=213118\n@@ -163,2 +184,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"www.bing.com\"_s) || host.endsWithIgnoringASCIICase(\".zoom.us\"_s);\n+    return isDomain(\"zoom.us\"_s);\n@@ -181,2 +201,1 @@\n-    auto domain = RegistrableDomain(m_document->url()).string();\n-    m_hasBrokenEncryptedMediaAPISupportQuirk = domain == \"starz.com\"_s || domain == \"youtube.com\"_s || domain == \"hulu.com\"_s;\n+    m_hasBrokenEncryptedMediaAPISupportQuirk = isDomain(\"starz.com\"_s) || isDomain(\"youtube.com\"_s) || isDomain(\"hulu.com\"_s);\n@@ -188,16 +207,0 @@\n-bool Quirks::shouldDisableContentChangeObserver() const\n-{\n-    if (!needsQuirks())\n-        return false;\n-\n-    auto& topDocument = m_document->topDocument();\n-\n-    auto host = topDocument.url().host();\n-    auto isYouTube = host.endsWith(\".youtube.com\"_s) || host == \"youtube.com\"_s;\n-\n-    if (isYouTube && (topDocument.url().path().startsWithIgnoringASCIICase(\"\/results\"_s) || topDocument.url().path().startsWithIgnoringASCIICase(\"\/watch\"_s)))\n-        return true;\n-\n-    return false;\n-}\n-\n@@ -215,2 +218,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return host.endsWith(\".youtube.com\"_s) || host == \"youtube.com\"_s;\n+    return isDomain(\"youtube.com\"_s);\n@@ -225,1 +227,1 @@\n-    if (!equalLettersIgnoringASCIICase(m_document->topDocument().url().host(), \"covid.cdc.gov\"_s))\n+    if (!isDomain(\"covid.cdc.gov\"_s))\n@@ -251,2 +253,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"docs.google.com\"_s);\n+    return m_document->topDocument().url().host() == \"docs.google.com\"_s;\n@@ -272,1 +273,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"twitter.com\"_s))\n+    if (isDomain(\"twitter.com\"_s))\n@@ -275,1 +276,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"onedrive.live.com\"_s))\n+    if (host == \"onedrive.live.com\"_s)\n@@ -278,1 +279,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"trix-editor.org\"_s))\n+    if (isDomain(\"trix-editor.org\"_s))\n@@ -281,1 +282,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"www.icloud.com\"_s)) {\n+    if (host == \"www.icloud.com\"_s) {\n@@ -292,1 +293,2 @@\n-static bool shouldSuppressAutocorrectionAndAutocapitalizationInHiddenEditableAreasForHost(StringView host)\n+\/\/ FIXME https:\/\/bugs.webkit.org\/show_bug.cgi?id=260698\n+bool Quirks::shouldSuppressAutocorrectionAndAutocapitalizationInHiddenEditableAreas() const\n@@ -294,0 +296,1 @@\n+\n@@ -295,3 +298,1 @@\n-    return equalLettersIgnoringASCIICase(host, \"docs.google.com\"_s);\n-#else\n-    UNUSED_PARAM(host);\n+    if (!needsQuirks())\n@@ -299,0 +300,4 @@\n+\n+    auto host = m_document->topDocument().url().host();\n+    if (host == \"docs.google.com\"_s)\n+        return true;\n@@ -300,0 +305,1 @@\n+    return false;\n@@ -312,2 +318,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    if (equalLettersIgnoringASCIICase(host, \"medium.com\"_s) || host.endsWithIgnoringASCIICase(\".medium.com\"_s))\n+    if (isDomain(\"medium.com\"_s))\n@@ -316,1 +321,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"weebly.com\"_s) || host.endsWithIgnoringASCIICase(\".weebly.com\"_s))\n+    if (isDomain(\"weebly.com\"_s))\n@@ -332,1 +337,1 @@\n-    return equalLettersIgnoringASCIICase(m_document->url().host(), \"www.youtube.com\"_s);\n+    return m_document->url().host() == \"www.youtube.com\"_s;\n@@ -346,1 +351,1 @@\n-    return equalLettersIgnoringASCIICase(url.host(), \"mail.google.com\"_s);\n+    return url.host() == \"mail.google.com\"_s;\n@@ -352,9 +357,0 @@\n-\/\/ rdar:\/\/49864669\n-bool Quirks::shouldSuppressAutocorrectionAndAutocapitalizationInHiddenEditableAreas() const\n-{\n-    if (!needsQuirks())\n-        return false;\n-\n-    return shouldSuppressAutocorrectionAndAutocapitalizationInHiddenEditableAreasForHost(m_document->topDocument().url().host());\n-}\n-\n@@ -375,1 +371,0 @@\n-\/\/ msn.com rdar:\/\/49403260\n@@ -377,1 +372,0 @@\n-\/\/ iqiyi.com rdar:\/\/53235709\n@@ -402,1 +396,1 @@\n-        if (host == \"wix.com\"_s || host.endsWith(\".wix.com\"_s)) {\n+        if (isDomain(\"wix.com\"_s)) {\n@@ -407,1 +401,1 @@\n-        if (host == \"trello.com\"_s || host.endsWith(\".trello.com\"_s))\n+        if (isDomain(\"trello.com\"_s))\n@@ -409,1 +403,1 @@\n-        if (host == \"airtable.com\"_s || host.endsWith(\".airtable.com\"_s))\n+        if (isDomain(\"airtable.com\"_s))\n@@ -411,5 +405,1 @@\n-        if (host == \"msn.com\"_s || host.endsWith(\".msn.com\"_s))\n-            return ShouldDispatchSimulatedMouseEvents::Yes;\n-        if (host == \"flipkart.com\"_s || host.endsWith(\".flipkart.com\"_s))\n-            return ShouldDispatchSimulatedMouseEvents::Yes;\n-        if (host == \"iqiyi.com\"_s || host.endsWith(\".iqiyi.com\"_s))\n+        if (isDomain(\"flipkart.com\"_s))\n@@ -419,1 +409,1 @@\n-        if (host == \"soundcloud.com\"_s)\n+        if (isDomain(\"soundcloud.com\"_s))\n@@ -436,1 +426,1 @@\n-        if (host == \"mybinder.org\"_s || host.endsWith(\".mybinder.org\"_s))\n+        if (isDomain(\"mybinder.org\"_s))\n@@ -486,1 +476,1 @@\n-    if (equalLettersIgnoringASCIICase(m_document->topDocument().url().host(), \"soundcloud.com\"_s) && is<Element>(target))\n+    if (isDomain(\"soundcloud.com\"_s) && is<Element>(target))\n@@ -494,1 +484,0 @@\n-\/\/ airtable.com rdar:\/\/51557377\n@@ -507,2 +496,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    if (equalLettersIgnoringASCIICase(host, \"desmos.com\"_s) || host.endsWithIgnoringASCIICase(\".desmos.com\"_s))\n+    if (isDomain(\"desmos.com\"_s))\n@@ -511,6 +499,0 @@\n-    if (equalLettersIgnoringASCIICase(host, \"airtable.com\"_s) || host.endsWithIgnoringASCIICase(\".airtable.com\"_s)) {\n-        \/\/ We want to limit simulated mouse events to elements under <div id=\"paneContainer\"> to allow for column re-ordering and multiple cell selection.\n-        if (is<Node>(target)) {\n-            auto* node = downcast<Node>(target);\n-            if (auto* paneContainer = node->treeScope().getElementById(AtomString(\"paneContainer\"_s))) {\n-                if (paneContainer->contains(node))\n@@ -518,6 +500,0 @@\n-            }\n-        }\n-        return { };\n-    }\n-\n-    return Event::IsCancelable::Yes;\n@@ -534,1 +510,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"www.youtube.com\"_s)) {\n+    if (host == \"www.youtube.com\"_s) {\n@@ -553,2 +529,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"shutterstock.com\"_s) || host.endsWithIgnoringASCIICase(\".shutterstock.com\"_s);\n+    return isDomain(\"shutterstock.com\"_s);\n@@ -563,1 +538,1 @@\n-    if (is<Element>(target) && touchEventType == eventNames().touchendEvent && equalLettersIgnoringASCIICase(m_document->topDocument().url().host(), \"sites.google.com\"_s)) {\n+    if (is<Element>(target) && touchEventType == eventNames().touchendEvent && m_document->topDocument().url().host() == \"sites.google.com\"_s) {\n@@ -598,1 +573,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"live.com\"_s) || host.endsWithIgnoringASCIICase(\".live.com\"_s))\n+    if (isDomain(\"live.com\"_s))\n@@ -601,1 +576,1 @@\n-    if (equalLettersIgnoringASCIICase(host, \"twitter.com\"_s) || host.endsWithIgnoringASCIICase(\".twitter.com\"_s))\n+    if (isDomain(\"twitter.com\"_s))\n@@ -604,1 +579,1 @@\n-    if ((equalLettersIgnoringASCIICase(host, \"google.com\"_s) || host.endsWithIgnoringASCIICase(\".google.com\"_s)) && url.path().startsWithIgnoringASCIICase(\"\/maps\/\"_s))\n+    if (isDomain(\"google.com\"_s) && url.path().startsWithIgnoringASCIICase(\"\/maps\/\"_s))\n@@ -607,1 +582,1 @@\n-    if (host.endsWithIgnoringASCIICase(\".sharepoint.com\"_s))\n+    if (host.endsWith(\".sharepoint.com\"_s))\n@@ -620,3 +595,1 @@\n-    auto& url = m_document->topDocument().url();\n-    auto host = url.host();\n-    if (equalLettersIgnoringASCIICase(host, \"mailchimp.com\"_s) || host.endsWithIgnoringASCIICase(\".mailchimp.com\"_s))\n+    if (isDomain(\"mailchimp.com\"_s))\n@@ -639,1 +612,1 @@\n-    return equalLettersIgnoringASCIICase(url.host(), \"docs.google.com\"_s) && startsWithLettersIgnoringASCIICase(url.path(), \"\/spreadsheets\/\"_s);\n+    return url.host() == \"docs.google.com\"_s && startsWithLettersIgnoringASCIICase(url.path(), \"\/spreadsheets\/\"_s);\n@@ -654,1 +627,1 @@\n-        m_needsGMailOverflowScrollQuirk = equalLettersIgnoringASCIICase(m_document->url().host(), \"mail.google.com\"_s);\n+        m_needsGMailOverflowScrollQuirk = m_document->url().host() == \"mail.google.com\"_s;\n@@ -671,1 +644,1 @@\n-        m_needsYouTubeOverflowScrollQuirk = equalLettersIgnoringASCIICase(m_document->url().host(), \"www.youtube.com\"_s);\n+        m_needsYouTubeOverflowScrollQuirk = m_document->url().host() == \"www.youtube.com\"_s;\n@@ -686,4 +659,2 @@\n-    if (!m_needsFullscreenDisplayNoneQuirk) {\n-        auto host = m_document->topDocument().url().host();\n-        m_needsFullscreenDisplayNoneQuirk = equalLettersIgnoringASCIICase(host, \"gizmodo.com\"_s) || host.endsWithIgnoringASCIICase(\".gizmodo.com\"_s);\n-    }\n+    if (!m_needsFullscreenDisplayNoneQuirk)\n+        m_needsFullscreenDisplayNoneQuirk = isDomain(\"gizmodo.com\"_s);\n@@ -732,1 +703,1 @@\n-    return RegistrableDomain(m_document->topDocument().url()) == \"youtube.com\"_s;\n+    return isDomain(\"youtube.com\"_s);\n@@ -751,4 +722,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"nytimes.com\"_s) || host.endsWithIgnoringASCIICase(\".nytimes.com\"_s)\n-        || equalLettersIgnoringASCIICase(host, \"twitter.com\"_s) || host.endsWithIgnoringASCIICase(\".twitter.com\"_s)\n-        || equalLettersIgnoringASCIICase(host, \"zillow.com\"_s) || host.endsWithIgnoringASCIICase(\".zillow.com\"_s);\n+    return isDomain(\"nytimes.com\"_s) || isDomain(\"twitter.com\"_s) || isDomain(\"zillow.com\"_s) || isDomain(\"365scores.com\"_s);\n@@ -772,2 +740,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"twitter.com\"_s) || host.endsWithIgnoringASCIICase(\".twitter.com\"_s);\n+    return isDomain(\"twitter.com\"_s);\n@@ -785,1 +752,1 @@\n-    return equalLettersIgnoringASCIICase(m_document->url().host(), \"www.zillow.com\"_s);\n+    return m_document->url().host() == \"www.zillow.com\"_s;\n@@ -794,2 +761,1 @@\n-    auto host = m_document->url().host();\n-    return equalLettersIgnoringASCIICase(host, \"att.com\"_s) || host.endsWithIgnoringASCIICase(\".att.com\"_s);\n+    return isDomain(\"att.com\"_s);\n@@ -805,2 +771,1 @@\n-    auto host = m_document->url().host();\n-    return equalLettersIgnoringASCIICase(host, \"www.ralphlauren.com\"_s);\n+    return m_document->url().host() == \"www.ralphlauren.com\"_s;\n@@ -837,1 +802,1 @@\n-    if (!equalLettersIgnoringASCIICase(openerURL.host(), \"docs.google.com\"_s))\n+    if (openerURL.host() != \"docs.google.com\"_s)\n@@ -882,0 +847,1 @@\n+    RegistrableDomain registrableDomain { topURL };\n@@ -887,1 +853,1 @@\n-    if (topURL.protocolIs(\"https\"_s) && equalLettersIgnoringASCIICase(host, \"vimeo.com\"_s)) {\n+    if (topURL.protocolIs(\"https\"_s) && host == \"vimeo.com\"_s) {\n@@ -892,0 +858,12 @@\n+    \/\/ Login issue on bankofamerica.com (rdar:\/\/104938789).\n+    if (registrableDomain == \"bankofamerica.com\"_s) {\n+        if (auto* window = m_document->domWindow()) {\n+            if (window->hasEventListeners(eventNames().unloadEvent)) {\n+                static MainThreadNeverDestroyed<const AtomString> signInId(\"signIn\"_s);\n+                static MainThreadNeverDestroyed<const AtomString> loadingClass(\"loading\"_s);\n+                RefPtr signinButton = m_document->getElementById(signInId.get());\n+                return signinButton && signinButton->classNames().contains(loadingClass.get());\n+            }\n+        }\n+    }\n+\n@@ -908,1 +886,2 @@\n-\/\/ bungalow.com rdar:\/\/61658940\n+\/\/ bungalow.com: rdar:\/\/61658940\n+\/\/ sfusd.edu: rdar:\/\/116292738\n@@ -917,1 +896,2 @@\n-        m_shouldBypassAsyncScriptDeferring = (domain == \"bungalow.com\"_s);\n+        \/\/ Deferring the google maps script on sfusd.edu may get the page in a bad state (rdar:\/\/116292738).\n+        m_shouldBypassAsyncScriptDeferring = domain == \"bungalow.com\"_s || domain == \"sfusd.edu\"_s;\n@@ -923,1 +903,1 @@\n-bool Quirks::shouldMakeEventListenerPassive(const EventTarget& eventTarget, const AtomString& eventType, const EventListener& eventListener)\n+bool Quirks::shouldMakeEventListenerPassive(const EventTarget& eventTarget, const AtomString& eventType)\n@@ -956,2 +936,0 @@\n-    if (eventType == eventNames().mousewheelEvent) {\n-        if (!is<JSEventListener>(eventListener))\n@@ -959,17 +937,0 @@\n-\n-        \/\/ For SmoothScroll.js\n-        \/\/ Matches Blink intervention in https:\/\/chromium.googlesource.com\/chromium\/src\/+\/b6b13c9cfe64d52a4168d9d8d1ad9bb8f0b46a2a%5E%21\/\n-        if (is<LocalDOMWindow>(eventTarget)) {\n-            auto* document = downcast<LocalDOMWindow>(eventTarget).document();\n-            if (!document || !document->quirks().needsQuirks())\n-                return false;\n-\n-            auto& jsEventListener = downcast<JSEventListener>(eventListener);\n-            if (jsEventListener.functionName() == \"ssc_wheel\"_s)\n-                return true;\n-        }\n-\n-        return false;\n-    }\n-\n-    return false;\n@@ -994,20 +955,0 @@\n-\/\/ nfl.com rdar:\/\/58807210\n-bool Quirks::shouldDisableElementFullscreenQuirk() const\n-{\n-#if PLATFORM(IOS_FAMILY)\n-    if (!needsQuirks())\n-        return false;\n-\n-    if (m_shouldDisableElementFullscreenQuirk)\n-        return m_shouldDisableElementFullscreenQuirk.value();\n-\n-    auto domain = m_document->securityOrigin().domain().convertToASCIILowercase();\n-\n-    m_shouldDisableElementFullscreenQuirk = domain == \"nfl.com\"_s || domain.endsWith(\".nfl.com\"_s);\n-\n-    return m_shouldDisableElementFullscreenQuirk.value();\n-#else\n-    return false;\n-#endif\n-}\n-\n@@ -1099,1 +1040,21 @@\n-    return url.host() == \"teams.microsoft.com\"_s && url.query().toString().contains(\"Retried+3+times+without+success\"_s);\n+    return url.host() == \"teams.microsoft.com\"_s && url.query().contains(\"Retried+3+times+without+success\"_s);\n+}\n+\n+static bool elementHasClassInClosestAncestors(const Element& element, const AtomString& className, unsigned distance)\n+{\n+    if (element.hasClass() && element.classNames().contains(className))\n+        return true;\n+\n+    unsigned currentDistance = 1;\n+    RefPtr ancestor = dynamicDowncast<Element>(element.parentNode());\n+    while (currentDistance <= distance) {\n+        if (ancestor->hasClass() && ancestor->classNames().contains(className))\n+            return true;\n+\n+        ancestor = dynamicDowncast<Element>(ancestor->parentNode());\n+        if (!ancestor)\n+            return false;\n+\n+        ++currentDistance;\n+    }\n+    return false;\n@@ -1102,1 +1063,0 @@\n-\/\/ microsoft.com rdar:\/\/72453487\n@@ -1113,7 +1073,0 @@\n-    \/\/ Skype case.\n-    \/\/ FIXME(220105): Remove this quirk once Skype under outlook.live.com completes their login flow redesign.\n-    if (url.host() == \"outlook.live.com\"_s) {\n-        return element.hasClass()\n-        && (element.classNames().contains(\"_3ioEp2RGR5vb0gqRDsaFPa\"_s)\n-        || element.classNames().contains(\"_2Am2jvTaBz17UJ8XnfxFOy\"_s));\n-    }\n@@ -1129,0 +1082,4 @@\n+    \/\/ Gizmodo login case: rdar:\/\/106782128.\n+    if (url.host() == \"gizmodo.com\"_s)\n+        return elementHasClassInClosestAncestors(element, \"js_user-button\"_s, 6);\n+\n@@ -1142,5 +1099,0 @@\n-const String& Quirks::staticRadioPlayerURLString()\n-{\n-    static NeverDestroyed<String> staticRadioPlayerURLString = \"https:\/\/static.radioplayer.co.uk\/\"_s;\n-    return staticRadioPlayerURLString;\n-}\n@@ -1168,0 +1120,1 @@\n+    m_document->addConsoleMessage(MessageSource::Other, MessageLevel::Info, makeString(\"requestStorageAccess is invoked on behalf of domain \\\"\", domainInNeedOfStorageAccess.string(), \"\\\"\"));\n@@ -1197,1 +1150,0 @@\n-        set.add(RegistrableDomain::uncheckedCreateFromRegistrableDomainString(\"gizmodo.com\"_s));\n@@ -1277,0 +1229,1 @@\n+    UNUSED_PARAM(isSyntheticClick);\n@@ -1288,1 +1241,1 @@\n-        m_needsVP9FullRangeFlagQuirk = equalLettersIgnoringASCIICase(m_document->url().host(), \"www.youtube.com\"_s);\n+        m_needsVP9FullRangeFlagQuirk = m_document->url().host() == \"www.youtube.com\"_s;\n@@ -1304,1 +1257,1 @@\n-        m_requiresUserGestureToPauseInPictureInPicture = domain == \"facebook.com\"_s || domain == \"twitter.com\"_s || domain == \"reddit.com\"_s;\n+        m_requiresUserGestureToPauseInPictureInPicture = isDomain(\"facebook.com\"_s) || isDomain(\"twitter.com\"_s) || isDomain(\"reddit.com\"_s);\n@@ -1322,4 +1275,2 @@\n-    if (!m_requiresUserGestureToLoadInPictureInPicture) {\n-        auto domain = RegistrableDomain(m_document->topDocument().url());\n-        m_requiresUserGestureToLoadInPictureInPicture = domain.string() == \"twitter.com\"_s;\n-    }\n+    if (!m_requiresUserGestureToLoadInPictureInPicture)\n+        m_requiresUserGestureToLoadInPictureInPicture = isDomain(\"twitter.com\"_s);\n@@ -1343,4 +1294,2 @@\n-    if (!m_blocksReturnToFullscreenFromPictureInPictureQuirk) {\n-        auto domain = RegistrableDomain { m_document->topDocument().url() };\n-        m_blocksReturnToFullscreenFromPictureInPictureQuirk = domain == \"vimeo.com\"_s;\n-    }\n+    if (!m_blocksReturnToFullscreenFromPictureInPictureQuirk)\n+        m_blocksReturnToFullscreenFromPictureInPictureQuirk = isDomain(\"vimeo.com\"_s);\n@@ -1363,2 +1312,1 @@\n-        auto domain = RegistrableDomain { m_document->topDocument().url() };\n-        m_blocksEnteringStandardFullscreenFromPictureInPictureQuirk = domain == \"vimeo.com\"_s;\n+        m_blocksEnteringStandardFullscreenFromPictureInPictureQuirk = isDomain(\"vimeo.com\"_s);\n@@ -1386,1 +1334,1 @@\n-        m_shouldDisableEndFullscreenEventWhenEnteringPictureInPictureFromFullscreenQuirk = equalLettersIgnoringASCIICase(host, \"trailers.apple.com\"_s) || domain == \"espn.com\"_s || domain == \"vimeo.com\"_s;\n+        m_shouldDisableEndFullscreenEventWhenEnteringPictureInPictureFromFullscreenQuirk = host == \"trailers.apple.com\"_s || domain == \"espn.com\"_s || domain == \"vimeo.com\"_s;\n@@ -1403,4 +1351,2 @@\n-    if (!m_shouldDelayFullscreenEventWhenExitingPictureInPictureQuirk) {\n-        auto domain = RegistrableDomain(m_document->topDocument().url());\n-        m_shouldDelayFullscreenEventWhenExitingPictureInPictureQuirk = domain == \"bbc.com\"_s;\n-    }\n+    if (!m_shouldDelayFullscreenEventWhenExitingPictureInPictureQuirk)\n+        m_shouldDelayFullscreenEventWhenExitingPictureInPictureQuirk = isDomain(\"bbc.com\"_s);\n@@ -1466,1 +1412,1 @@\n-        m_shouldEnableFontLoadingAPIQuirk = equalLettersIgnoringASCIICase(m_document->url().host(), \"play.hbomax.com\"_s);\n+        m_shouldEnableFontLoadingAPIQuirk = m_document->url().host() == \"play.hbomax.com\"_s;\n@@ -1491,1 +1437,0 @@\n-        auto domain = RegistrableDomain(m_document->url()).string();\n@@ -1495,1 +1440,1 @@\n-        m_shouldExposeShowModalDialog = domain == \"pandora.com\"_s || domain == \"marcus.com\"_s || domain == \"soundcloud.com\"_s;\n+        m_shouldExposeShowModalDialog = isDomain(\"pandora.com\"_s) || isDomain(\"marcus.com\"_s) || isDomain(\"soundcloud.com\"_s);\n@@ -1507,1 +1452,0 @@\n-        auto domain = RegistrableDomain(m_document->url()).string();\n@@ -1509,1 +1453,1 @@\n-        m_shouldNavigatorPluginsBeEmpty = domain == \"marcus.com\"_s;\n+        m_shouldNavigatorPluginsBeEmpty = isDomain(\"marcus.com\"_s);\n@@ -1539,2 +1483,1 @@\n-    auto host = m_document->topDocument().url().host();\n-    return equalLettersIgnoringASCIICase(host, \"victoriassecret.com\"_s) || host.endsWithIgnoringASCIICase(\".victoriassecret.com\"_s);\n+    return isDomain(\"victoriassecret.com\"_s);\n@@ -1556,15 +1499,0 @@\n-#if PLATFORM(COCOA)\n-bool Quirks::shouldAdvertiseSupportForHLSSubtitleTypes() const\n-{\n-    if (!needsQuirks())\n-        return false;\n-\n-    if (!m_shouldAdvertiseSupportForHLSSubtitleTypes) {\n-        auto domain = RegistrableDomain(m_document->url()).string();\n-        m_shouldAdvertiseSupportForHLSSubtitleTypes = domain == \"hulu.com\"_s;\n-    }\n-\n-    return *m_shouldAdvertiseSupportForHLSSubtitleTypes;\n-}\n-#endif\n-\n@@ -1578,1 +1506,1 @@\n-    return equalLettersIgnoringASCIICase(host, \"apple-console.lrn.com\"_s);\n+    return host == \"apple-console.lrn.com\"_s;\n@@ -1588,1 +1516,1 @@\n-bool Quirks::shouldEnableCanvas2DAdvancedPrivacyProtectionQuirk() const\n+String Quirks::advancedPrivacyProtectionSubstituteDataURLForScriptWithFeatures(const String& lastDrawnText, int canvasWidth, int canvasHeight) const\n@@ -1590,5 +1518,2 @@\n-    if (!needsQuirks() || !m_document->noiseInjectionHashSalt())\n-        return false;\n-    auto& url = m_document->topDocument().url();\n-    auto host = url.host();\n-    auto path = url.path();\n+    if (!needsQuirks() || !m_document->settings().canvasFingerprintingQuirkEnabled() || !m_document->noiseInjectionHashSalt())\n+        return { };\n@@ -1596,3 +1521,2 @@\n-    if (!equalLettersIgnoringASCIICase(host, \"walgreens.com\"_s) && !host.endsWithIgnoringASCIICase(\".walgreens.com\"_s)\n-        && !equalLettersIgnoringASCIICase(host, \"fedex.com\"_s) && !host.endsWithIgnoringASCIICase(\".fedex.com\"_s))\n-        return false;\n+    if (\"<@nv45. F1n63r,Pr1n71n6!\"_s != lastDrawnText || canvasWidth != 280 || canvasHeight != 60)\n+        return { };\n@@ -1600,3 +1524,2 @@\n-    if ((host.endsWithIgnoringASCIICase(\"walgreens.com\"_s) && equalLettersIgnoringASCIICase(path, \"\/login.jsp\"_s))\n-        || (host.endsWithIgnoringASCIICase(\"fedex.com\"_s) && (path.startsWithIgnoringASCIICase(\"\/secure-login\/\"_s) || path.startsWithIgnoringASCIICase(\"\/fedextrack\/\"_s))))\n-        return true;\n+    if (!m_document->globalObject())\n+        return { };\n@@ -1604,2 +1527,4 @@\n-        return false;\n-}\n+    auto& vm = m_document->globalObject()->vm();\n+    auto* callFrame = vm.topCallFrame;\n+    if (!callFrame)\n+        return { };\n@@ -1607,6 +1532,16 @@\n-String Quirks::advancedPrivacyProtectionSubstituteDataURLForText(const String& text) const\n-{\n-    if (text == \"<@nv45. F1n63r,Pr1n71n6!\"_s)\n-        return \"data:image\/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAA8CAYAAAC9xKUYAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABGKADAAQAAAABAAAAPAAAAAA5JkqIAAAbsklEQVR4Ae1dCZwUxdV\/VT0zu7Asl1xyuSAiiBowikoQQVE8AI2ARAiKcqmgRPP5oZ8xrvetMagIAiLeoGBEjSQeQAJEISoYViDccir3sezuTFd9\/1c9Mzuz5+y9sPX49XZ3na9e1fvXq1fVA5ElKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErgWNWAuKY5fw4ZXzEVxRyHHKO0+ZVaLNcl9xp55KvQiuxhZdIArJEqW3iCpeABZfSi9jKrvSyq6icFmAqSrK2XCsBKwGyAGMHgZWAlUCFSaBGAczvP5l12v\/Mn3N6hUmzjAUzfz6VVsZSbHYrgeojgRoFMI7PP8Av5KDqI\/54TgK+wGB\/9rnxgfbNSuAYlkCNAhi\/4xwNuaHa1bW\/mDdNWdWVPcuXlUCJJVCjACY7mLPF5\/hbl1hKlZQhKZDc2pV7dSVVZ6uxEqhwCdQogJH+pE2uUqdUuFRLWUF2TrCtK7ZZgCml\/Gy26ieBGgUwtWWdb4j0Gemvvppc3bqCeRJCd1aBzTWqT6pbP1h+ylcCNWowp\/fqFRIkF2Y3S72ofMVY9tKONq\/fi3kjcstemC3BSqCaSKBGAYyRuVSfhEj2rybyj7IhFF1N4C0aYB+sBI4DCdQ4gMlW+m3Sesjo5fOqzW4S8+JqdZ3h7TgYVLYJVgIRCdQ4gPnTZQN24Pzy3Hp73DERIVT13fACngxvVc2Mrd9KoBwlUOMAhmWX7PO\/4HPkhOrg7GUemBcn5P65HPvVFmUlUC0kUCMB5qHe\/Zcp151ztGW9R6u6F440S30oFArOebzvtf+ual5s\/VYC5S2BGgkwRogHgvdILQfe+\/m8fuUt1ETLmzD\/g34+xzdYHnTvSTSPTWclcCxJoMYCzBPXXntAaRrrhtwpd3z0ftvK7jSuUwh6hXlgXiq7fluflUBlSKDGAgwL94k+V89zfPKZ5IDz\/m2ffNK4MgTOdXBdXKfjyKeZh8qq19ZjJVDZEqiSn8zUY+h8EnKwDqlWwidPJqVZuXdj+3gr+eRyCqoZYiptrCxh\/O\/8Ofc6Qg7MynEHPNd3wIa89epb5FgVUmfD2njLP5X+Hhuv07EntY1ujg2Le9YUQlumRMLYcmFwwbb0e0\/2ueaRSHjkPno5RT8V6LRD0jlrVCSqyPunZ0vaWafgtFcsJ9Uc0n2rFzmZSUUWk3DkSbtId9wpRIs9mrLxI5VbGpBa2oFk0J+\/iECQqPsaohZ7ifw4R7iuEanVzUn\/dELZfhpUornXL4qv7\/y19Fo4JIgxdoS0WofvR98WM2lPfMrE3\/QtdKoO0qPCoflicm5fJl5CbkqUdTkpapcbUsiTpJViEuHgZX4qT34ipevbqK6bSX3RxnO0oqawrjdJl+aI6bQ8kobvOTfR2X4fjTNhLj0sptG62Pi8z5X6+6V6JF0CdXwIKnQuOh79D3ZUVCmak6AzyVVXIM0f9Rgxj47qG8syMPI2trB3VvR7P\/8wOylAS+AXGRVrVYDnC8DT8xLHbKWk71FGHMDQLjoFfL9YWNmIy0acARj29\/CSTDrymccuvvrpQvOEI5rsUQSFSYgWdyIATP6kPVYRXfUNJAqam0NUVoARgL8rvyK370pyRC4WcvHyMkjnyb6k9tf16uPA1nsFjftEU71MfvPo3P\/iSCEeX+9BekkHSKiUJMFLAfK5IVocxpihZHpW3ywfEi+rh6JxCT7o0VRPBWku+r4jmnsI2aKTRYJFxCdT4iZMpAPjAwt4C9FEhOYDmHLnB5XoUdQJo3QOfnK0veEksq7x0d0Y\/w9ggnwgwqHfMeDoydihjxFePQAmNIpGYSi9BIZ8UNV9AJbpeP6AArQBSrqbUqkRYrrgh5t\/g4Zei07oR7VlRvZw1TtphlHsSBsr5P7Ixf2fBrisAZC8eNdf3+uRsvPQffcvvTEJ\/MzAL3AX\/iPcIfoFqwhw8jDyLs3HnCN3p786LZl3i7BzNRg6MRp1zcuXroiAEDr8szOLSICovclRoI4m7L6a6Df5OYrGl+bhkgxJ\/VYqI49v2hJ904aoIdTuCnzldcJhNG6RlE\/29Xjxh4hu\/tQDl8P4+mvxKbBa6pA6bz2JU34iecMiEnuTyV2dVoR8i2ASYo\/SipOIttcnffkKegIWAuCO\/BhnzdExA\/AWwP1BPYK+x4z7QTRTMQ96PLWmLPGGlLpjMUkTjlY5eon0Ub2CMmBsdIXl4MUJgs0XTxXBDwDLDxz+DPU2IxLbldIT8b7GCTjjSbkXQo7pwZG0EJb7gnhuEnsrNwuGGWVwgLKNc\/xyppikorO6O5Juh\/I9b1iSchI6e7yYQjCc42g73vj6GIj6OMp5Hem6+P00Vw+ns8UM2h+XugJe2HKZMGvWIqrrPJbd6oRNn2SP3nHJihltHRdTfyGEsdyZAV86tBjm82WxyfiELh+iwzkXmJvuHLU\/54zSOHQZYOZ2jS256OdGUPghC0h14iOF5Ug+NLbXdx54fJNGNLl3buG8TLpuCdHJ2xU1ANDsgzV1+iZSAB3Dw3TYgavaGCBxFp9O9OibpBtmkui6VTqr07wyc0sr+dOydkTLTiZxxVi6Jze3IizHz4bl8QXCUlH7jbgnBDC8LKaj6jHM76m55ZX9yXmVnkMpfMURWyYAzO8RyADzPvQjqj+csKL4QdGjsZJoinuQQvoqJ7wk0oPcj6mh2ISJ\/kSfpGGIX4CrxIRhUTbS11MLlURjtaaRsDwac2kqW70bKRUmVhsMsSfMu+OMEZNcY2ICNNIwr9wAv0ZrKOcKSkLHH6CDrmOWUVl0mHpSCpRWUCflB+BgMoyWOYYuxqDpQCFY\/YpO8AnqLZPkOcpVmwBki9E5bLqRvhWoHKRrUL+iE2mKSDdzW6QY0jdRcwy6q02AoBnIlxkGgFsXPn7Zlh2NOj728FVv0uk\/\/vPIL7YvTWmxd02AwGQsob4u\/B4K0td854Nz\/DGl+d7pp5whqHsuTLZ+D\/X59TKOLxXFTtUJFDDur0Qn7vcU+7uWpDpv9Z4LytphO1GTPaRWtZMy5aimUzZrt80B6eyupfSG5kKsbIV5NUxdN0pqeETRIVgjr18YCfXuWOpQc5STmUy8ijIcpyoptzaEkuMtwwMXk5jfV7UR4oJVmlr8nAsuJwAYOwGU9qcQ7a8v5Hmrtcm7sq2ktU1RTnyVCb0B9Jdjuf13KMo1yGBgGmOyJSRyFSbELbg2Bfw0AnEuLOgP2e8BS2cQlsUvmAqE2KZcfdAskQqoUQ+lulRXDsNkuIMyab4boCvA5\/kYF3WR\/FusBefCjwEpF02wgJ9BHa1w3yxTjUJHM5SInwR1I1I49PYO6JggRz4spqjlkXAxm3JCI\/R4bosvyfku+hGuiPlFNLjfIukLu5caYGA29YSdfBs6qj+mqEg5++BYmSlDuQADBZ6EkYFhJ6dFwWUM3YkwzA4UQEcAkQAGmfQHkSxfdpS6D+MzU7ypU2DJsEX0PdJcD0C6W0SsGE0PIlc3JalbwIflFNePnjFl4QXr7bex3h6COlog\/4s8MkM\/UgaiFuGKUgigBXBCfbQJ4PJSJMKYohs+nUAbPqX12764fV3djnf+85SrUtY3OeOxuy5zByQF\/Buyc7Lw41W+zI9XzeomkmrR6qZdLn5gQIOh2UmpbRtk7l7jyzn44ZY6rU6tiuP\/Dtq7tSHRnF+Su60JOZ3fjLQs\/70\/YO\/kXSSX\/6ypy3pNyItuNUovaIWmZe0lTe3pgUDznzAdoHNWt5aUGYC8EdwKjtsgcuzEvPsWG9QxtKi9okXtYwLCj7x0aruDi8ICvrGpzOQ7cR\/R0KUkD+ArsaQcDBqkY7pgtaI7MYeGIqPMCy7BX7ETo4LTe\/w58PVpesHxiZ2OD0CgtfddmhJj9G36BKgNu6qzQi5N9jn6fkyATyF9R4wlj+nYmuvAn+iB0VqdTBPgmDIgFkkCML0fgNYffox\/RcLy3mG9XIkwBjmSfvqdeI6OxqVxSsBPorqBCgw4CjrZ1JWpzCjhSTmURW18PsqATsxGHC43lx2H9kVfNZ6LoRJ1mWEohYYB9W4F6p0WKRvvX8P7PBlD5R0xWWVGw0cax1gfxP8sjqrxHA5hjkU3PeOlEZ9hvsN8S5cCZ\/oAJFjZkUhj2GMkv0Kr1Cj6G+rq4\/roIgTN4fAIAfGH4DkTa+3ZKkctx9oWw5A6o5zr9M2wWCbRAtQH9KXOPoduwH0Rrij5AvJGBibwPSMSaHaFdjozIdT6iHqr3f0rJurRK4bSD++khXxJdz14zeyFQVe1CwQCLZIz9zWBC6Fu0pHddHHGu90aZ+6ipnvXQ0ndU1HeXZgdmz03nG6PAmOkkhLeGYPrRqUan9lF5JFa8WEvXilpF3aUoA1O\/SPxcYW9nb1OUw5GwzdtJW2sq9zzN5LTCvsu56xV9GU7cte3JKfuQQMGztZ6Sg\/+B+lfrSeZFF7oZiHvrHPIXXwGA1TBdOouSR02K91lEwlYWMR5vsbOU97UEYfwNoBkACCztilpgAuLocRkrNiQ8pyq0vkhTlm0ht+Bhxt2bASlwP+w0JlI2foOmgvLd4H\/Bc\/ywDLLI10kD+1RBhBCZiDVuxRSjXC\/BWGN0A+PIobHbz7Sg2DHE1SZe0uK+WKS\/iBfopSS81OsbrxMC9BTpv2oLxNcNISufYhVwWkAF0P6ZmchZbpDxUzsk0YoSPCeRV7gOy2GwkUVkwrRRvG201Y8prIgoXyHsRsyO5it\/hyYYZS4oEKu5UAh5VvidXUk7KR6knsU9K6Yon\/DD6BnQyPodSyxfuu90lfhOwlHLkZlfXBeBXOhN5NG4nDPRNCpMO2YLwavaejgjUjfAJX2QvoF4HMqhP0Cwgfp0epmdKVRCQyaHkjXgrNBqK9xfia1mcZLv9sDXG+XdfRYL9T763OzFX9mgDcDgGbL0aW7wmlCAJSlDvQTA+s8hLVHe4aRTzRAFf3CaUp1YyV+6o2Cs7Ik7wKsHooBmcK2qwsuwQtlcEkfRLQn1cjYWXoa6YdnkUjJIuq4ixwADDU8ipaBsNjju2DLZVdDLJsOKGNtXL+UnNQg6U\/P8tJ5JXt\/OcNtHyuC9WLK4NCZFwnazOpXAC0+TdLM7l5\/Y7comqeApCbo1C2kHBhVk0eFlxcONUDft0Hf3oAE6ANAS477vEkc8wc22WTnldzlN0eFLYh4KyImT6GPQr4Eyzk6ZjAeAdGUDn25sLA8bipd6ZBubuKV8yzstHxJS8lPsbqBj\/LSwvXVhoS\/gJDroPIfwwy0YievDmCJ+TvqKP4U9oEq+AgiABMo3oKJJM3XqEICUiPh0i8nkk\/dVQS4sCV1iUkfVJ565Mib2RwFvmRiUfO7SFnmLoDSYXJDueYkzp8c4GAVVLymjScp\/wLT04ALRwA8DqD8\/5hEQZXCd5lE7+CWAzCpAyjpb+L4jzYDD5vPziIxgzaZoJF0JkzUx\/k5pPSwqFA5oCByqQE87jC\/6RDM6Yt906gHrC4e0KfzwDVZtO4bHAXrrIKINc8HQZeVVsBy2RPtXSA3FrU\/1vWM4WQDyUT1s6JDizJaCZowlOiPAxXdDTsyo6mXtu+3JOp7lk4cSzhTQasAUrzb8zNAiWnEZ5r4jE5cwvDLl510NFgVCy9YRmHr+8YvkUXQTHMpeh618BhjcGEJPeObnjvG8G5IBuOdqZHwUt2zFAAilzAmmCMmCX9fjHS9QP7r+MnYRwDDH8SU0N9yY8r4lIBukM+z4MI1+aETA6FDrfnC82CEB40DOEsanTDpfPRzDGdw5xdNmLcSI5EOHb+JHvf5xRgocQOsO+9Bt93hjqJ30JEvQbHMrB5bmuOINGOtBAmmqQGJq2FNsEXztnhJsWJGCWvXCHKyjR21YJC+GyeC4q+LJg4\/AHzyhQE5dphowaYn6nqR9sDJ9xH4gLNX3ID49zGzMMgNYEvMDYadzrxdR\/QmggIQ7kRsy30RrqbQGzriLUTyFUcID6KOO1HHNaijsc8nL0Tr58clKsFLtp+MMheWJcu0tLDYxMJ3p6L1eehwirfc4d0jpizwwZSJ+qb20nQk2Xs\/DOtpRm9yHnnHA7vTfpZySd143IDzniZd6qWX0KbBi8jtuZac\/jij849O8RYYp9pVJz8\/Xu6C\/+5KIfdobXLSfg6PQzgjMVFtcAJyO2T\/DpbLKwvMWRsWZ\/mQwrQZHcNcJPx7ucoojB8lribjbNbUG4Hc2BfjIsv4kohuUNDdH7ENVYgec6bT+5Fqoc+zgiOoG1wL47WrmEdDPLaxlMrEuPaJl7AVUwwlDDBcjn863aNv1Y+QkkNRKfthzoRjdTiihodGYhdF0SQ4zWaBCc9joHUTLE0OmeVROma\/7WGHklJRAOFyDTl0hpnLhNghpmsMijAJ0cOAFFyOkaDIHeCDfYc8hI2HPCGMaK+Sdn+NcvpA8eshRR\/wXg\/pDjlJWHcyCfqt0HQ6P7qKOsPBHDubdOZw5BujR4vLXaVf802lN0xYIX9YBljDZpizBEqfUkiyhIK5QUeh1BVJmb78Ysu1V7yad9citxUm3R2wCSLgEuHpQAocvfXh9N1D1Hg37DdsGUfi8t7hnKfZ3cmBn4d4+Xfmj9j6a59bP7c1JwxmefMW9j7vPHKwTU1Tzo53sgJcCsvC4QcSUZKiCoiJy+Kdl5h3zIoFjMWYBMDZERjDDgmRibM2RY6nmGwJPSakG6yRYbGjTxbmLRi+mC8RPx660gZ642dw4TRCCOxRCmBHkbI1xaGrS0bcIVhnTpavmANmF2KJ8B5KCMH30BXg8iqet0I5I0sRjaVJkqnhK4PghQ46cD2M02mll5j0\/HyLMxqgcCJA6ifaRN7SJxJZgrt42f0I5bPFFCDHGQzP\/m9NdiHfiw6wsMXD4fCdXAD1uCR6QQ9MevhVwFVv\/LwlhjKecDIZO1Z3A1wHhuPjbtp1w54R8VNcxDH6ciDVgxx2vBZFh3GsjePP3Eh64BLS5xRgZ8JpS4dSvOF34m7PKVdUmcdlnDTLEKiIfh3Ka1wBldpOJ8a9oAtewjE\/6J1DONDBy0xDWuvdMDCKdfBy4hIDjFeF9xdnDBbJqTgzkEVpysW2M5\/QxZoXz+04BRCalysBPY6ai79SNiyDbzkc9x58jxAcvP3I1T35Xbve8gjmWQ9y3YkmKKTGcn6OLy2hE2dwXh1yrwfK9eFHMDiVwwyFYLEIsy3OW+Pxl5QbOA2cuK8h12DMDrNMHomtRaUeA7hO18MJ83cu4T0NyP8LhGhIOSM35th92twM\/+8B2G8BK6VBnt2penhvtp8bS7SRTxeBztoIJ9x\/cPhtZf5hxvkbHPTOtuxoBEnVMGKLAOMIE5ZRwgVV0XxMrjuhs5u5bvharszLA+zQnuGwf4n0XHNFZNMgDIQCJ9W8ZeTv+bwpEnjnbSxnGv0flK2lq+lGbBev4WwYNmv57mbRRXwHEi7mOyyEqyDgISzk0E00HO+zOZxJBmQqwm\/H2u8DvAZgIX2E5QhbSWUi8PQaFwCefoUbjHD6L9aZUWsJzuKNAMx3C7rQLrOWhoW2ktemSGt8StCmj7lMUGrIoXRsbxqLxWyNJgk2eZPQ5t1whr\/OifhQItp2n7n4sNcxRv86WdPeOt6sNPZTolq8IACisEUzZCEpP+Y49gdtaew1LKONdzKp+W5FfZeR9rOBjfSp2J8Z\/ndysetDQVgyq+EwLo5+tVZQ328FddiUO5MWl6dax+fgoChUwfCIMydVxqtWj3Ld6KkxWHmYVQS\/45zbRQCHW\/EIg4U+5zAmHP9Iw6m2wZg0Bxofkhdc6F90b\/kR+x1Q2oxIiVBm9m9cghl+HO5vADQeAGL2h8LyEuNNvqC0eMXpRUkn4Z1f7jN3\/qPpPZFK10ffy\/AAJ98aWEr\/MMsflAMra3oZivOytkAbtgvwp3uzMwyur1HY\/v43KdEZaz3eNciG6twiJtJBkyFAbXF\/0DwLcyZnq3ku7g+UsjoQ+04+OF\/S8M+V8bU8Bdjc0lRSo\/2KP2aU\/EnDy5divYw707I2is5qSW6XreT0w+7SJTgIz+DTEhZQ7RxPud7uRnpPreL3ibpnaGqLheZ\/WpGzOs0Uz1h1zBKc3h08dMG+9Kb83x1VWsO20GtuCxrBLg5Y7jMx+d2PFcZOvPNRC+7J+fIc+hNNDXMUwhiWiY\/h8FCooOb4YHkIwcumrmB8rFlnHlV9EPYeUBFbyvjMEQ5YbCX\/EmmexMXLoKPYOl6I+zhYC7z86gqkfBqK+5S+3POFIC+jqobnG3NmPMGsO8px2CKEEZ6HsJRBCI9LhTpfyxNb5CuXiX9xyzRjNh7RA5DxGVw54KoWru4AyToA0oxgiLqjDe8XWLDM4xAsMJEXyLN8aYmVnRvsNbpkpQTDoyNy59xfAzSe64ftEWw18\/Z42+3KHALc1JDUK\/iAAz\/DECWuc9ql5PytizCgwydz22PRDHChnTg\/++xlpGK\/pma\/TGEECzEfMSy54fbF8pgvYf6AbNOf\/H18IqQoy6QXfHY5njDOXI7DJJkvDi5RHoNG9BjHaH0uYfJNC\/OwrsTL\/yL44TINPwnqBtcNMOmO8ToZbeBdobZ47wYdPQiXwExo40DsGxvnruE+dtzGPuc2Le4JXVSxBGDhtd08XPiYmK7DWRGzHNLpsMrS4ztFT4anOqYxAJaL8KMAH0JkKUDX+7F8ebBiuS196Qb8WgDdcbIGJuSPUaulhEXG\/h5MCbNWevLkI+Q2yhHO7oB2s8Jb2oUx4QCMTjyI47I5grZjCzv2YGBhefKGPzGT1Hc4ofF2z\/DSIm8CvGMXqcLHdAHVHjdBWCZ1wnZMNjWhDXn1szSNrJTOcEfQo\/ie4x5mED6VeaEQ\/TFQ+Olf3p1pg9lpAtaFo02jhJgrJhtLoTRtPKbyHEsAU5mC7bOc3F\/\/m+TMXiSWtC+8ZgswhcumKmKKMErLjx12AMOS2QZw+QO81f38AeqH8yTbldafoZZtAJI9+JqzLk7inwCfzPkIO8vYrkIcgan2MG1Wz5UfN7akY1ECHfZIZ0l7pZe1PRa5r7k8V4oFExGvHoYfYKhNv8cJy1vgbG0WCS\/gvg++lL\/AT3KvCH9wVkCa4zLIWjAFdyvvj\/PPPBRH1oIpTkKVG59Al1UMQ\/iAqj72Vtrha+A2GDxpMsk5gKPLP8D1mYFtb+wz1EyyAFO2frcAUzb5lXfuSlkiFcR0+EPC5YjjC5RvQ8gLtn+tBKwEjlkJJLZNd8w2zzJuJWAlUJUSsABTldK3dVsJHOcSsABznHewbZ6VQFVKwAJMVUrf1m0lcJxLwALMcd7BtnlWAlUpAQswVSl9W7eVwHEuAQswx3kH2+ZZCVSlBCzAVKX0bd1WAse5BCzAVLMOxhfn9sRhKfvEyq6UgrPZrASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwECpLA\/wNiq9JJ3UFXngAAAABJRU5ErkJggg==A\"_s;\n-    if (text == \"!H71JCaj)]# 1@#\"_s)\n-        return \"data:image\/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABLKADAAQAAAABAAAAlgAAAABJS0H3AAAnpklEQVR4Ae2dCXwVRZ7Hq7rfy00IgQAh3IqM4U4CeKCAiCKKOnjNzognAio66+w6s5\/POsqMzs6oO7OzDqLiOeO4OnLsx2VA8QAEHJUzHKKAhoQj4Q4kgSTvve7a37\/6db\/3cr4AaoB\/fz4vXV1XV3+r6l\/\/+ld1Rwg+mAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbQKgnIpkqlnn46VaSlZek4hlElysoOyxkz7KbStCRMvfBCthUKFZg+X7ZQKhFpgyHL2uq\/\/\/6lLcmnNcelZxRSXqnLaNufyGnTtsdT3uDMmWMluJhSVsupU+fEk+ZsiKOeeSZdJCVNpGcNSLku8Z57Nn5bz62ee26YMIzzdf61tW\/JBx+sbe5eJ1rflK+aMcMnsrMzRG1tW9zXxHMeFLt3V6HPBZq779kS7qv7oICWEMzJyfMLMUrYdlJMeDbkyuzZe+G\/QVjWJnn\/\/VUx4S24QD79IKQmQliZOpl0ZKeUsgqNMkskJHTR\/nv3bmqpkFQvvvhvKF\/ssxmGhfyC+B0VPt9GEQyugyCg62\/3UCoNN+ipbyLll\/HezJeQ0BN8ciDsquNN09J4DXJqIBOMUMfNadP+0EDQt+IFQdEfz24I0zyCOtoZc5O0tETUXU\/ySxCiDKdvTWChnWSjrfeie4nUVNxONCuwUO4W17eaObOH8PuHIf8++CWIRBq7cVhosl261Aaee+4j\/75969APQk7A2fvXiH50ElYAdJfftsfVE1ZuRKU6a43B53Mq0vVvwRn3MTCCXIUkrrDajzw34Z7f4HcEwmogrn+of9nZnVqQtRPVthOR1hfzIw2OGhMJgWDwKoTdp559lhrX2Xs0xKkuN7pWKvm7gqSUkmgbN0JYTcT54u\/qvt\/rfRITB+P+\/fAjoRh7oN36DWN8qEOH0bEBZ+dVrBbSpcs4NM7OYRQK7p3o2NshQGohSLLtQCDHMIyWC5C6bLt27YbRwxEWSn2JUfRv0VHU88+Pib4+CXcQjX4VjVSYeiaaCQk09czR+SnVDiPoHXDPPIn8z5SkFup5Q2MPY1vWt6bl1bvnnDkxg2i98DPYw1bqEPrXl2iju9HffBDaBXD3pEf2+f0Xq1df3STvvHPvGYyg2UfzBJaePyvVP5xCoaP\/Rd5zz466OUCYFKBxXw6Yqm5Y3NeBQFukd6Ibxua407U0olIVeIYPopPBxvADXN+Cn8Svg3rllSx5110HouOcdW6laOr1f2fdc7eWB7asPRg8y4zdu2OmfeiTX8GmdQeK2VUXtbqaBlsWWBpGZmY7nLVKatv2IXPq1HrCiuLBaLwGnX6DuPvukJg8WSelP+qll3pgNMjHrzN+Gcij3PD7D4pQqDDa0Ay7yVj49XYTQvMZAnvWOfpaygqkpenHuThrL4SPQvgxNz6mc0tOxnaGjvkVhO42CN2+Os\/aWmoMWmBpI6uUpEEGUeb3vHuGHXjGIXB2hcZmYwFicbRNQU+nc3IusiyrOwzlXVB+EvqHrWCwAna6ull515qbbReAVxfD52uLkfWoFQjsQHpnsQMxYdNLhJZ7hU5kmscghJd4GUQ5UC8jMBC0Qx5KlJa+\/20Ya\/V0PidnFG5L3DrhXhLPXGr6\/ftEdfXyhgzT8aZRs2b1tg4c6OfxkrI76v5a7xF9vn1wF3nXcKDOOlq2PVyaZjdDynao1\/0o02bU36fR8Vx3vO3Ujd\/Y+UTru6H8qE816A+bVeDFFzfDROMILCk7NBTvbPKL9KTkZAMVrZ8dFZ9JK4Ty4YcjgiKKCjp9UEyd6vlgRetSpB2FTuap83rqaFmd0ID6BWfNWunbv39ZuIPnoyN7xnzTND3hhDzKEZ8Ep3eg8fZ1hZf29PkKcT5hY7\/OQ8qQdwMpw6oefFBW\/HrARasy76mbbkoQ27b1RHmrxIED5RBU58KfbA1C5OZ6mpv6r\/\/KECkpt6D8tKqng5EPepPKQflpVGzwgDF1GNLQNNwQJSUdRWHhxRQRnT8grrjiPRhiaaFAiMOHlcjJ6YfVo1T7nXeuUsOHfw3BTWWMHKmpf8M981FGqoNK\/OoJ3EjkE3Ohs2eivD\/Cr2N0DroObftc2+\/vCwHytrz33v1ueIvS+Hy9TcsaCmHb3k5NrTDatqVs8ty8IMiLMK2PCCylLsQzDwdjr90Rc\/jlQNBlySlTYrTGFrZT97b1zida3\/UyisPDL2X7qGjBKPdZ6YwIrD17ymFwt3XnkdKwP\/\/8jyo\/fySoKGg5T\/g2bHjdJQT\/lVAgOuC31pgy5bfo0JchnRNsGEWh2toyX1JSZ2vx4lvN0tJ83GR6aPhwmoZ9JGpqdoi33voj3FiIxKGUhZ8jKcmNeyM\/KpduhPY55\/yvccklK3Rc+hMMUmcUKAO15i34mUh\/vVy37jPyr3uooUPfQwfrFe1vvfRSmnneeZvEpZd+Bo3kUHSYKC9vq1asuBDpJoqiolyo6o7BuVOnUOjVV3eY3buX4N5rjXZRcjU19XqUIVvno1QII34xOhbZ\/bLgH9O5KY4aMuQRPOMj4uWXDTFkyDuioOALsN+uVq4cIY8fH6Dz+eADW4wf\/y65SVOCZroR+V1s7N+fD698cNLR3D92SsphA1M7ug7Z9lp\/AytKWgAXFa1GWkuuWeMIgi1beom1a+9Xw4Z1k6tW\/dzNr+4ZGoUP9\/9R1PNUIp\/t8KPK620cO9bFmDv3t7j+D3XBBWPlZ5993mwaDE4Y2DrYmzY9gvsn2y++OBTPQKvHWgLZWCU0UlN3q9TUr+WoUYvNtm3L6pZLtxdqP4ZRBltbIuWn4yiVp0aO7KcqK2+XhvEUZgSrdDudO\/dH4vjxLDF27K9D7dtvoXYKIa81fJ9pjhCdOlF7WF\/vPtEeLazv6KQtddvBYHc8k04W8PkOtjT9mRbfE1jhTrEZjWUgPSS0LFpipZ+QWVnDMN14F5qVCywX2w\/aoSFU2lKO9oY3234HcbzKVpdeejUElB4hjJSU0WjAS8W8ee\/A7y3KN57DKCnZKf\/yl780EHca\/Lpof6VSGwh3vGybnqF3dLhJmmR1dTEaey3OpV7YqlWDxRdfTJahUIrnF3H4fMFgH\/HNN31kUdFI0abNmwjaoG1iYcMorivB73XfffdFaxhD0CGui2QDl2m2QTxatYR0CflDodBnvkOH3hdHj86GVkXCeQj23wyz1q3bZubnOza+QGAdpoXDVd++izAHqxHbt6\/QnVWI31PeEKDdcNICy6fUBvKrd3zzTR7SDIRQWe2FlZaeBwYd1DnnDFSTJz\/q+Uc5QsHgKgzte\/0R4Vsm2rV7Q958s9Z09X69VateF4FAmk6WmztcQGAFs7L6N5kmKWmS9eGHt5q7d2vN0mtHiYlVGJgSDcvKEBUVGbKior94880h4DVJTJ8eVTI4pVwDzfMDdyqK+rgJvloLVsHgBLTT8xDngG6nNTXJ4tChPriuEZs3P+efM0drqbUzZ\/ZL8PspHUAal6GdbkB\/cAZR7Rn5c0L1HUneIpf6859z0FfIREHPaSfY9tctyuAMjOwJLP1slZXvYqNoRzSMzqg4b9pkdOxInX461OwqhH0mZs92UBiGH4LNUVmVKsFUwBNWOsKxY572AvtMG9G58zkiK6sEGsgcMz3dESIVFUUY8cqdDJ2\/ts93kREM9o\/2IzdG4SvRwa9E+qG4HFE3vN61YaSJ7t1noyOlQxAkoqPmij17rvLi+XxL3IYeGjRoktiw4UEvDIsBWBX9G+xwm3DPVNswhqHR3IVORcLGjw7VhuKiLAPN8AgIQbQEAtsTVjqvUKgK6bxstSM1tQTl0Y0PU5+dvgMHyN5EHeSYGjToR9DqNsGdIAsLrxaDBn1JaWC32wv+++TIkY6wueyy+ZiW7xb5+Vpgob4coY2tIfK++2J4Unp9SEkaM3Rb\/3J9xh+rtDTHxFn26LELz+XJDDeczj7DSLaUGuT5BQLvk7Dy6uONN4ZiWhipj\/R0rdGibdRL4+UxZ04O3A9gCphLfqpDh5WyvPwJDARrxM03P4CySLuoqNxYuvSgsqzHIXh6guNSaKW\/FrfdRkmoE6\/BtO\/vzkX4byCwBoK9H+rakMEg2RwtcfXVJShLPqb3XXFtIN0KGRZWlCpx+vQvMJXNA0PStJx2KsR2Cqt7nFB9180kjmsIzQQI4uu8qFJuxrMe967PUkeMwJI\/+1k1pnkvBJ9\/fijmzgM8Jqbp2FKcTXG0QpgIrYFGI2rr7kGdrOkDWwnQULZjlKJO5ggOpd6INspTBvYll6yEQHDySknRHVb7B4NjoR4\/hM7hhDX3l7SYceMoFmUWhJ2oGALLSXXw4JdYHfycLmATSodQ+k8nANedO38uN2wYjZG\/2vXD+X9Cv\/vdGrFy5UMwuHt2FYgiR2AbRgDTjsLohYiotLHOn\/zkY3RIPVWEhPgQQs4bzXHfbdagQU9CwP\/SCIXaWcuX53uJQ6F1YK8fCEJtMPx3e2GuwzTXuc56Z8MYjY4sYAv6iMLsqiq\/WVPTFfUYED16\/B0d2annegkFTXHH6To3zWr5wAM7dPrG6oMGChxIk1U3DfmjMxpiwQLSUHNx7xpMixfKgoK16JCL0f6kHhClVEafPvvkU0+9iSn4ApTtFTCbCI3jUWifL4iuXQ8gfbiRUK7hA9NI7Soqok2fSch\/LaZ5ToPZv783hWGapZ8\/nEKfMN3aAA2GBBYKiC0vjRwnVN+N5NWkd9eu14Gda06oxKD7fpPxz5LAGIFFz4yRjIxRq9BIqFInkp9dXf0NOhapz3oVEZGckRgaFoXrw7YrXWcT50YbgpsGwuMCaFwX07WVmlpkXn\/9J+Ldd3UwtJyFGCmd3cYwtqJBjnHTtfSMzno4Ks2jcDuNIzNzm7z22gVy4cJoYaWjmpmZATFhwgLYfHZAaO1Ex\/OJTZsuUWVl3WRlZQo62rjQkCFJMALXWLW1X+H8OhLu9e6zdOlw2K\/GYlrcS7Rtq7UQaBSOxuRFwjjQrt1\/qOPHH8DUL8MsLh5LHVxrYErRlP1y8Cd7Uq4YNWqRqIzCTp1\/8uQtYsqUqNwcZ9h+dRGuLAiST8jXKC6mDixRhiI5ffo75NfQoQVMdvaNOsyyHIGAi0brwzAS1F\/\/mi6OHdOCCx3PS6PzWLToX3EmoX9MjBnzG9GrF02PE9WoUePsgoJhRnb2BCsl5YDZoYOy8vLoYWphc7tB5eW9g2e\/VvzjH+OghRHb+keHDkHYIYVVUtLNRCjsWkuwApsBLVHYe\/fmUMOFVF5WNyGEVfQCU4PtVNe3O6PAam64r9TN6qSv1csvj8YA2k9nBJsonnnOyayMn3SBWlEG9QSWVzYSDGFDOhr2GvjPhfF9Ajrh+V6caIdphqIvG3RjHt6gf7SnbT\/hXQ4ZstRzw+Ffu5autZ8qKLgb7jHR4Q24adf889o\/EJiAsztiCdjU0r34lkV50aHE0KHLtKupP2RXatdur9i71xQLF94gbdsR5Eijp4fQYrDSdwku7xFvvDFX3HrrFzq7ffvGYMS\/Vhw8KPSPPDt2XIS\/C3V4+I9ctqxGXXvtGmiDl+up5\/z5JMBXUKOFdroVbpryJKHT5mKKFElqWYXRnQiMZqIOb9ARioqor7bR7lBoKwYkATuT0zGPHv0BrrVBGx38cbOwcFYkU7jS0xO9a+pA4aPR+oCahFVVAyunTsyoNJhG9kLZZ+gA03wcwuoItIduYvHiayB8H9MjYVmZ8wrEN99ciQGKotIg9WcIvoehWY4XR470Ehs39sF0+VOdD\/6g\/N1x+lQ89ZSJOKmYauoyI\/3DxmuvTYZm6oeZQQtQv2kuQny8tmpV+woLSWiTVkVTRe3EueF2mplpIszpM1LSAH7KD6yqDoOwGhnOWOF+c6GB7zzlNzpNM9Tto8Gy27ajyVAg3IB2HMKKtK7I4a7uwScQCKQojNbRv0hEzxXJ0\/OKOLAyR9sjHCGUkVFs5ubuhrYVidBSF1YdsTO4hn6iW7f\/s0MhSIrwkZnZR739dpoaMKAdGmuG9k1JKcLUqAyNxHSjNXV27V+Io0RycilG8teR10wIdrKrONOV48dvhEbWn\/Kxk5O3Ktv+QPl8X9N1+PCEnetBZ6yOrvCuk5MjtgylCl1\/2JViB49AYK0bps+GQQKa3lygH7ndw\/GjV3Mih\/ZDB8+MeDkuMhWAia479OSwFKobK+oaWrp86KEjDaax7WlglIxd3ZvFqlVPa9bLl4+BxqrtXdq\/S5d1ApouwjzhSLnTdBnv2c0lJ6aF50bdEWqTFlC0\/60ThHwa2lG09t9O+0USdICzM4R7N88LWqHnbuSdQV3fNH3GQSuSUfFPiRODUR6eY3w4M4VnmId+99UpyfwMycQTWNi01w5G3fO853KnXuThuj\/8sNwLJ0cgcD6mQY\/RL+G11zbCAGzH\/IS4Lya+aZLdoanjt15gXt4y7U5Li0t4eOkaccjx42uNrVs\/8IJ9viTr4MEbsMjgdXqVmFimwzHa6s2aXuTGHXbfvm+EJkz4o5g0abZx553Tsb3iAWwBmQBNaqyXqrRUT\/+M666bZ6xff4XdvftjXlhaWnvPHeUwzj+\/DC\/cOtPWUOgyL2jv3h1wV9I1bHm5nn8gcBQdKpZvSsptCM\/SP8P4jOLCfjUeGgh9DSCbrnEO2Ndf\/29wOfEqK5\/W\/nX\/WJYuCwk0vQ+pbnhCQqQDh0LHdHADaSCwnTJL+Zx45pk0u7T0HFFcXKDjKzXPKCjIE9dcs0DceOObYPtc3dtAa1ui\/aqqYrhhgWI72mOm6NMnxyoo+KuOk5q6nZ41OHZsHgasVdovJ+ctnPWzelsgKMAwetJJH020Uwx6ug8gbXv95Qg3zUme8QI0TZFpFkAHxn0xH4tYm\/UV\/\/EIeAILPt0wOv0YKukk\/VKwK6Qoqqv+XnEFTXNO\/LDt2A4VlROmL+MxopCNhd6MXy3OPbdEu7HfS59PxZ\/du2NsKejwvewuXW5ws5YpKbtdNz7t0cNzw4F9UCR0tOCJ9scesXd92dkV8JMh08x3w+Tq1R9jZrRTXx87FtO5zOrqSjcenjUHI2uKdw0HrrujLrLQOR37V5QmAFtWCJ1rY3R87T5+fE9dP5payrVrD4revSvAth\/Cg7BffSw\/\/7wCe7W0oFbp6SVGVtZxiqd\/X3\/doBaM+E59kHaTmjqi7r3wCklksAsEDlF4TJr09EvDaQbSGR3+i5DPN8zYtetclI0GJZr+\/EzOnk3vf2otxkhO1lO4cDrnlJRURA7YIOtrgps2lYvRo49go63WJq3k5PX0rP727bepI0c66Qz69q0QDz0UCD\/vUfLTgseytIZHlyhPo+0U5Xa19Jj61vksWkQv3Q8md0sO\/YaF338t0kjUu408aBq4qSV5nC1xnfl49NPSJjqf70F7wIAUY2O4X5x7btfQnXfSTm5PGwkn2YuRaxGmQ45qjamjvX\/\/l0Zt7TEYctOxonOLqKrK0XGPH\/8CleBWdvQdtRv2hBnu9gArO\/tptGDqYHRcjg5soUwBbEjt5qutXaOnG07YSf+VaWm9vUxqanQD1tdSTsR9l0KNUTCgk92l7rM7ybBHCZ2nwNiypb\/v4MGJ9kUX+THSZ0ghaKrpaB2WFT3dwEdRyiKaqmEkYhp0NwTiatguaAMkCUr97FZiYrlWL5WK7ZzB4BqUi+xakePAgdLIRR3Xzp158GkDxiths9FzbKxAjgZTYWdm7tD3qJOk7qXP51sOP8onAc9VgIFNYtm9EOWlzcYDxerVEWFeUrKe0sekCYXyQr\/5TZKcP787hVlXX90JGzVzYZinZwMusR9CxBHwzgbYjth+4QpyCe1\/KKZLEpt5i8FPoPwZaF\/12y8yMg4f1mXBJt9tuISFcKElqR2SIOzdex\/ueQ+ExGJc74Vw6ISp\/OVGeEEJr1Kt9U2f3mg7xdRyFcql6wfPNzI0a1YK7JU0sGTaO3fmQgNt0GCvy9HYH1r5dTdeK7UPba0zXh+jKXr9Iy1ttbz11or6AWeHT6TCY19mTsBrEV09BDk5F8B+5TQm8nSNqErtEhdf\/CBWvCbDT1cUKp4OaoCVaCilnsD66is9JdGhdf6EBg++HsJqqPaWciE2ds5HQyKNLx0\/GmVvQGcWaOC0h2g7rmM0pTrZxXWJVbhDVEg7I+OQ22Htw4cTUH6azqSi0SThfBU6icCzN57na6+NRJqfopxaOFGeLT3QyNvjfuPQgWKSYpe3K0ANrC5myfXr9chP+6zQoEsQuaeXgN4SaOywLK3dYKPvx24UIyFhDO4pZPfuO12\/ps5kwwzMnv0BNoJereNZVj4kkqdRxqQ9cEBrkHXTYNVzuBvP7NSpP9w22ocWShDa+90w1HVk+wZ5kk2R7msYO6B5LxRLltCUqeGjrMzARlMSipbVp48zpaqqugTpfdjztgUako2wNsjrRp0BBAX4ayfKUA7hs0RfNPIHq6kloWef3Yo20ZeiQEsfShzpcPPRFyf6x5mqO9P1hvKord0NbxZYGLW+xMbON9A4SKU9DxUaMXg6H78TqNBDGNmWoCk86LKk9w2hUj+PKdQ18KPXKmJ7nRtxzx7HroHrYChU63eFQCCA1XHjcTcaKv8x7NWy1OWXz0Ve16E87b0wUtf9\/sYbqxuR9o3RB\/zcqazrH3WWhw9\/jZF1n5md7aycIQw73HuiBf4KZaBXbSIjJQlo01yJjtQeXAYgzBZbtkBnyLsD7lcoKWWtUlJKRYcORSIjY7\/MyDhmffLJOKxWkb1Ez4GCgUD96ZZSsX5kEwwfTjcKXxjGfr2yF74sufJK7erx4ov6XH777X8onjv3D3SB5xA506ZRl8XsyBTVMCklmwHgMP5998Cr\/p3i2PZB\/e5TxUdrJgc\/3ECrbPS60CBMZUlbaPBImDJlNTTBg0g8ERE8bjqyZelpXN2E0WmwAZm+dRVEej9WWNvh\/cjdVkXFPzBg5KGzRxYF7r33cwiFNj7b\/kFMfiSUCwtpAJNY\/a2CZq\/vaQ0e\/LBhmg\/ruAsWUPvTg4c5d+6zeK7fw0CejDYmjKqqXPHSSw+hDKbVuXOhOX78h1H5f2FUVi5Ce9YaKPmHUF\/QosipoM157c48cGAe+so1AKqntxRBH1IeQpoN+BTMZXRN7dwJaPovyleD8rnaZNORg0FHOjYd64wN9VQHbRtxdveSBiPUmDEX4nS3fvIdO+Zg+f0TM\/wydHTHofDwatk87FP5X9gySDNri99RvMRKau1Q\/GKOhPvvL4QH\/QRsV5OwWkOjLX2zah4M1mvJjdGZRv4\/0WIAhFQCRmL6AuXhqJU5itbgISdPfqLhACxJu6o35kfmvfdqoy40vLsxUrbFG\/8XixdeMLEz+jnRvn0HdAoSlkexo3xX1HaBeW7edn7+9XBruQJhPtX44Q9fh92JNmLSVyOPmCtW0DQyC1OQUnxh4VE3Xcx548Z3xQUXvA+\/DihbDc6ewIqJV\/eCtAL3WeqE0a4C88gRHZ7l1TAVFO9Q+yOKDCXLMKvc1CQwIitrrm+dc\/iTQ7\/Xhvf09E4Q4hKCcR9eaboBUR2tpak0hnETBNb5YvnyT+XSpf+DfWt3gRel6Ih9VgOxaLExzPqD0LBh2RBmt+A5SXuciQ3GBxHHeY8yFFrvfjoIbyPQS9nOwBB9b8vSgx0JK++w7XTEFXLfvl3wo7o8CrPGPlqU8eKEHfhU93tw0i\/mQF8hQTkftt730Saz3fqWt9\/u2hGXxyRo5gLt8KlmonBwmEBUc67DxLLIDpGvfXfs2CTnzg3WiVHvEhVJ0p8EjT4g2BqfpiCG3sxYXPyrcMdTEBq\/Dif1To2+ZuLFaIHDsjLDnYM6s9dA0aBJYNyEXwJWgWaYM2bcBjfZhBy7UNSXKeBH2ggtPxfBeSldQ\/btgG1otli3ji61wCcHhDGdmj5oC8DUqWWIRD\/Ku+n48YT6\/WLX66+TGiWmXFiu3u3zU7m2up8Yu\/VPOvWT3Z4V97SfJx7ZNdmadejHkAn4IMTgyzKgXblT0GbvErYjQio6B56VPvjoXjZ4pjTWkCFrwPt87LnKpUi4+Uc4Udvyo25eQz7\/hAGqCq9FXYd3CX9HcXAQo4PaJeV4OqOeVulr+lNePgPaltPpk5L+jue+CFs+bjBra5dh0KHpXzHq6Ci03V5uGmPfvhrkWe1en8g5vJnTq+8TyYPTtIxAowKLVpiQle6BLcuyBbG3b78NI5TTiAxjPjrMxhakbnlUw7jcTYR3wra4bvyzh19A6lyLa3rb\/1ZsbtyMLxc4HcCNFD5j+nEfnH9AuUfirDUSaARtVdeuyTLqVR68E3geVP2eenR33h6ok9O3e4k9X\/oGg5I\/1+ePjuapcitda4N5KV9pv8UVFwr4aTcM3nELK53gRP\/Qu6hCTIIQ+Sn23c1EnZdAa3oV06spEHhDEPYVFi30dDXqFokQZE59SHkjBJIFrs+44dJZ2aylAdDavr0fBj4LtqgPoa1VQIMbThIZ159h60NkscNNzOfTikCjAguN6GY0oif100j5z3g14p1T+WTUwZVh\/FL3IDK+2vYjzeVPhmeUKZvi4X2wHnjfzkliGOehvNogDaPNNuzMNjFKvwKhtBiNdyuEURLSjUbkf3USiBCW99eE3QLCaQfS\/zfi\/Bx+NMV5EprOSFy\/hev1QdtOw7uVwzDtuwe2Fj19pbQYtQuR\/wh0nkx8HuYllZ39KryD0A7GYGT\/ueFuzKT3476nY1T6en3vZZWO5pbhrxaDk74UFaEke31Nf61dnWjR4q0PWVxMg58+YEd62W7T5n5M0nIhoEgI3QbN9F58Ygd6lLoL106lGgZp6k+gXczWCZVybFSkxZnmHNQZhcce+BoF6qMt9nqtMrCdgQJRz2NowQb5LI2NzFenI4FGBRYaTyY6bE\/9ULadecofrlOne9CTulO+MH6\/Za5f7wz7Td3IMH6B4H+hKJ6wcuLPQlkdV0bGT2A\/+giN9GasPN6M5yCDtxMW+fs4Gvy2yCVcFRWPQtBBXEnKnzryeKQdT3EgrOgUvQpEe3VqsFL0n4gzQgda1o9xpp9TNkzHvvcDRveLUtbZFkaGT6vz9UNcmLxWmdKW\/zieh38jdFLyirjGVx94cdxlQdoQNKt7we9jsJ5k5ed\/Bu1ullizZqoaOPBnQb+\/P\/7pQik0r12URg0evAz3iW2n+MKpm1\/MOfw1CpmQsML1V4HAJVgdJWH4sevH59OXQGxDiH4On89Co3J8ol\/TIR+sIOKTHwpToUB0krpubBysppdO9RHeDOjFMYx\/Qf6QJniHNjHxCc+\/KYdp4lMDTZrFIF3CX+l07SJR+dFGThjWH0NneC3KWzvD04pfQLNagOd7Gg18EH7OvCoSeT\/83kYZ\/qRfE6HvYeXn\/xTxn8Kz6JUpJzN5EHF+iWX\/28GJPt8ba\/9TKsETsJG8T7nL2LPHamPWmOtq+okjQedR8tO2S3BQyypo9uUsGJzwjVtWH95twH85PufzPAT+NLSOZ+28vKuwT+pOuXEj2amcOWw4tt7B7qVsxoGNuyoUUtBwyS7mfhViAJxV4pxz1oVtjM1kwsGtmUBYLWnNRTyxsmmD\/tatOZia0Vc\/JYRHMXY972tJbvhy5vnYHNlFp7HtXWEhVS8LNWJEO9hd6KVVWh0tg7a2KiwA68UlD2yHmIhPKTurjUrdAlvL225ECEAS4s0eJfOQHNpjjxudhbnyO+4QFRMm1EvXs2ePen4Ne7gqasOh34Yv7FIP4xkeR96JmOZV4YN7n0q\/fzOE\/QYIdBotO+NHHxxUYHTbt1EGzvP0ItC4hnV6PUe90oY\/0LYDAfQ7oQOf+f0SCenX5CFXriRj7uImI0UFQrO4IUpT\/CYqKH5nMyty8Wf0\/cWEXfRpfE5oMQT9a+AxBFO3sTiP1SWKej5I8M3fXyn5zq2JwBkrsFoTZNhsumEZ\/g4Y57H8ZYxAp7xGl88wDuC9vC9OpKxtScM6RQfN2t3Z\/ynKMu5soPXSynCeuvDCHGizA\/Tuecs6D5oXXm3wHUfBivDlUG+BJO6MOeIZSYAF1ndTrb0hrH6tbxWRDNj1YE3zOdtHdBC2UzwfpXk1WbKMN99sMjwS2PxUL1KkSKrv2iU\/\/ZQ2XdLvve\/63ny\/04cAC6zvoq4MoxbGd\/peViqmN3th9d4MG9aT2Gy62r09tDB6ufdi97q5c2X41Rw3Xm3v3sj6JI3obmZ8ZgKtlMAZa3RvpbybLVaLjO7N5iZEz549uY7j4MRRTg8C4T0Hp0dhuZRMgAmc3QRYYJ3d9c9PzwROKwI8XWhl1VVcXEy2qFN28JTwlKHkjFoBAdawWkElcBGYABOIjwALrPg4cSwmwARaAQEWWK2gErgITIAJxEeABVZ8nDgWE2ACrYAAC6xWUAlcBCbABOIjwAIrPk4ciwkwgVZAgAVWK6gELgITYALxEWCBFR8njsUEmEArIMACqxVUAheBCTCB+AiwwIqPE8diAkygFRBggdUKKoGLwASYQHwEWGDFx4ljMQEm0AoIsMBqBZXARWACTCA+Aiyw4uP0ncXCZ5Ob+T9m8RflVOYV\/105JhNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMgAkwASbABJgAE2ACTIAJMAEmwASYABNgAkyACTABJsAEmAATYAJMoFUS+H9lQdqS8c3B0QAAAABJRU5ErkJggg==\"_s;\n+    bool sourceMatchesExpectedLength = false;\n+    JSC::StackVisitor::visit(callFrame, vm, [&](auto& visitor) {\n+        if (visitor->isImplementationVisibilityPrivate())\n+            return IterationStatus::Continue;\n+\n+        auto* codeBlock = visitor->codeBlock();\n+        if (!codeBlock)\n+            return IterationStatus::Continue;\n+\n+        auto* scriptExecutable = codeBlock->ownerExecutable();\n+        if (!scriptExecutable)\n+            return IterationStatus::Continue;\n+\n+        RefPtr sourceProvider = scriptExecutable->source().provider();\n+        if (!sourceProvider)\n+            return IterationStatus::Continue;\n@@ -1614,1 +1549,9 @@\n-    return \"\"_s;\n+        auto sourceCodeLength = sourceProvider->source().length();\n+        sourceMatchesExpectedLength = sourceCodeLength == 212053 || sourceCodeLength == 219192;\n+        return IterationStatus::Done;\n+    });\n+\n+    if (!sourceMatchesExpectedLength)\n+        return { };\n+\n+        return \"data:image\/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAA8CAYAAAC9xKUYAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABGKADAAQAAAABAAAAPAAAAAA5JkqIAAAbsklEQVR4Ae1dCZwUxdV\/VT0zu7Asl1xyuSAiiBowikoQQVE8AI2ARAiKcqmgRPP5oZ8xrvetMagIAiLeoGBEjSQeQAJEISoYViDccir3sezuTFd9\/1c9Mzuz5+y9sPX49XZ3na9e1fvXq1fVA5ElKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErgWNWAuKY5fw4ZXzEVxRyHHKO0+ZVaLNcl9xp55KvQiuxhZdIArJEqW3iCpeABZfSi9jKrvSyq6icFmAqSrK2XCsBKwGyAGMHgZWAlUCFSaBGAczvP5l12v\/Mn3N6hUmzjAUzfz6VVsZSbHYrgeojgRoFMI7PP8Av5KDqI\/54TgK+wGB\/9rnxgfbNSuAYlkCNAhi\/4xwNuaHa1bW\/mDdNWdWVPcuXlUCJJVCjACY7mLPF5\/hbl1hKlZQhKZDc2pV7dSVVZ6uxEqhwCdQogJH+pE2uUqdUuFRLWUF2TrCtK7ZZgCml\/Gy26ieBGgUwtWWdb4j0Gemvvppc3bqCeRJCd1aBzTWqT6pbP1h+ylcCNWowp\/fqFRIkF2Y3S72ofMVY9tKONq\/fi3kjcstemC3BSqCaSKBGAYyRuVSfhEj2rybyj7IhFF1N4C0aYB+sBI4DCdQ4gMlW+m3Sesjo5fOqzW4S8+JqdZ3h7TgYVLYJVgIRCdQ4gPnTZQN24Pzy3Hp73DERIVT13fACngxvVc2Mrd9KoBwlUOMAhmWX7PO\/4HPkhOrg7GUemBcn5P65HPvVFmUlUC0kUCMB5qHe\/Zcp151ztGW9R6u6F440S30oFArOebzvtf+ual5s\/VYC5S2BGgkwRogHgvdILQfe+\/m8fuUt1ETLmzD\/g34+xzdYHnTvSTSPTWclcCxJoMYCzBPXXntAaRrrhtwpd3z0ftvK7jSuUwh6hXlgXiq7fluflUBlSKDGAgwL94k+V89zfPKZ5IDz\/m2ffNK4MgTOdXBdXKfjyKeZh8qq19ZjJVDZEqiSn8zUY+h8EnKwDqlWwidPJqVZuXdj+3gr+eRyCqoZYiptrCxh\/O\/8Ofc6Qg7MynEHPNd3wIa89epb5FgVUmfD2njLP5X+Hhuv07EntY1ujg2Le9YUQlumRMLYcmFwwbb0e0\/2ueaRSHjkPno5RT8V6LRD0jlrVCSqyPunZ0vaWafgtFcsJ9Uc0n2rFzmZSUUWk3DkSbtId9wpRIs9mrLxI5VbGpBa2oFk0J+\/iECQqPsaohZ7ifw4R7iuEanVzUn\/dELZfhpUornXL4qv7\/y19Fo4JIgxdoS0WofvR98WM2lPfMrE3\/QtdKoO0qPCoflicm5fJl5CbkqUdTkpapcbUsiTpJViEuHgZX4qT34ipevbqK6bSX3RxnO0oqawrjdJl+aI6bQ8kobvOTfR2X4fjTNhLj0sptG62Pi8z5X6+6V6JF0CdXwIKnQuOh79D3ZUVCmak6AzyVVXIM0f9Rgxj47qG8syMPI2trB3VvR7P\/8wOylAS+AXGRVrVYDnC8DT8xLHbKWk71FGHMDQLjoFfL9YWNmIy0acARj29\/CSTDrymccuvvrpQvOEI5rsUQSFSYgWdyIATP6kPVYRXfUNJAqam0NUVoARgL8rvyK370pyRC4WcvHyMkjnyb6k9tf16uPA1nsFjftEU71MfvPo3P\/iSCEeX+9BekkHSKiUJMFLAfK5IVocxpihZHpW3ywfEi+rh6JxCT7o0VRPBWku+r4jmnsI2aKTRYJFxCdT4iZMpAPjAwt4C9FEhOYDmHLnB5XoUdQJo3QOfnK0veEksq7x0d0Y\/w9ggnwgwqHfMeDoydihjxFePQAmNIpGYSi9BIZ8UNV9AJbpeP6AArQBSrqbUqkRYrrgh5t\/g4Zei07oR7VlRvZw1TtphlHsSBsr5P7Ixf2fBrisAZC8eNdf3+uRsvPQffcvvTEJ\/MzAL3AX\/iPcIfoFqwhw8jDyLs3HnCN3p786LZl3i7BzNRg6MRp1zcuXroiAEDr8szOLSICovclRoI4m7L6a6Df5OYrGl+bhkgxJ\/VYqI49v2hJ904aoIdTuCnzldcJhNG6RlE\/29Xjxh4hu\/tQDl8P4+mvxKbBa6pA6bz2JU34iecMiEnuTyV2dVoR8i2ASYo\/SipOIttcnffkKegIWAuCO\/BhnzdExA\/AWwP1BPYK+x4z7QTRTMQ96PLWmLPGGlLpjMUkTjlY5eon0Ub2CMmBsdIXl4MUJgs0XTxXBDwDLDxz+DPU2IxLbldIT8b7GCTjjSbkXQo7pwZG0EJb7gnhuEnsrNwuGGWVwgLKNc\/xyppikorO6O5Juh\/I9b1iSchI6e7yYQjCc42g73vj6GIj6OMp5Hem6+P00Vw+ns8UM2h+XugJe2HKZMGvWIqrrPJbd6oRNn2SP3nHJihltHRdTfyGEsdyZAV86tBjm82WxyfiELh+iwzkXmJvuHLU\/54zSOHQZYOZ2jS256OdGUPghC0h14iOF5Ug+NLbXdx54fJNGNLl3buG8TLpuCdHJ2xU1ANDsgzV1+iZSAB3Dw3TYgavaGCBxFp9O9OibpBtmkui6VTqr07wyc0sr+dOydkTLTiZxxVi6Jze3IizHz4bl8QXCUlH7jbgnBDC8LKaj6jHM76m55ZX9yXmVnkMpfMURWyYAzO8RyADzPvQjqj+csKL4QdGjsZJoinuQQvoqJ7wk0oPcj6mh2ISJ\/kSfpGGIX4CrxIRhUTbS11MLlURjtaaRsDwac2kqW70bKRUmVhsMsSfMu+OMEZNcY2ICNNIwr9wAv0ZrKOcKSkLHH6CDrmOWUVl0mHpSCpRWUCflB+BgMoyWOYYuxqDpQCFY\/YpO8AnqLZPkOcpVmwBki9E5bLqRvhWoHKRrUL+iE2mKSDdzW6QY0jdRcwy6q02AoBnIlxkGgFsXPn7Zlh2NOj728FVv0uk\/\/vPIL7YvTWmxd02AwGQsob4u\/B4K0td854Nz\/DGl+d7pp5whqHsuTLZ+D\/X59TKOLxXFTtUJFDDur0Qn7vcU+7uWpDpv9Z4LytphO1GTPaRWtZMy5aimUzZrt80B6eyupfSG5kKsbIV5NUxdN0pqeETRIVgjr18YCfXuWOpQc5STmUy8ijIcpyoptzaEkuMtwwMXk5jfV7UR4oJVmlr8nAsuJwAYOwGU9qcQ7a8v5Hmrtcm7sq2ktU1RTnyVCb0B9Jdjuf13KMo1yGBgGmOyJSRyFSbELbg2Bfw0AnEuLOgP2e8BS2cQlsUvmAqE2KZcfdAskQqoUQ+lulRXDsNkuIMyab4boCvA5\/kYF3WR\/FusBefCjwEpF02wgJ9BHa1w3yxTjUJHM5SInwR1I1I49PYO6JggRz4spqjlkXAxm3JCI\/R4bosvyfku+hGuiPlFNLjfIukLu5caYGA29YSdfBs6qj+mqEg5++BYmSlDuQADBZ6EkYFhJ6dFwWUM3YkwzA4UQEcAkQAGmfQHkSxfdpS6D+MzU7ypU2DJsEX0PdJcD0C6W0SsGE0PIlc3JalbwIflFNePnjFl4QXr7bex3h6COlog\/4s8MkM\/UgaiFuGKUgigBXBCfbQJ4PJSJMKYohs+nUAbPqX12764fV3djnf+85SrUtY3OeOxuy5zByQF\/Buyc7Lw41W+zI9XzeomkmrR6qZdLn5gQIOh2UmpbRtk7l7jyzn44ZY6rU6tiuP\/Dtq7tSHRnF+Su60JOZ3fjLQs\/70\/YO\/kXSSX\/6ypy3pNyItuNUovaIWmZe0lTe3pgUDznzAdoHNWt5aUGYC8EdwKjtsgcuzEvPsWG9QxtKi9okXtYwLCj7x0aruDi8ICvrGpzOQ7cR\/R0KUkD+ArsaQcDBqkY7pgtaI7MYeGIqPMCy7BX7ETo4LTe\/w58PVpesHxiZ2OD0CgtfddmhJj9G36BKgNu6qzQi5N9jn6fkyATyF9R4wlj+nYmuvAn+iB0VqdTBPgmDIgFkkCML0fgNYffox\/RcLy3mG9XIkwBjmSfvqdeI6OxqVxSsBPorqBCgw4CjrZ1JWpzCjhSTmURW18PsqATsxGHC43lx2H9kVfNZ6LoRJ1mWEohYYB9W4F6p0WKRvvX8P7PBlD5R0xWWVGw0cax1gfxP8sjqrxHA5hjkU3PeOlEZ9hvsN8S5cCZ\/oAJFjZkUhj2GMkv0Kr1Cj6G+rq4\/roIgTN4fAIAfGH4DkTa+3ZKkctx9oWw5A6o5zr9M2wWCbRAtQH9KXOPoduwH0Rrij5AvJGBibwPSMSaHaFdjozIdT6iHqr3f0rJurRK4bSD++khXxJdz14zeyFQVe1CwQCLZIz9zWBC6Fu0pHddHHGu90aZ+6ipnvXQ0ndU1HeXZgdmz03nG6PAmOkkhLeGYPrRqUan9lF5JFa8WEvXilpF3aUoA1O\/SPxcYW9nb1OUw5GwzdtJW2sq9zzN5LTCvsu56xV9GU7cte3JKfuQQMGztZ6Sg\/+B+lfrSeZFF7oZiHvrHPIXXwGA1TBdOouSR02K91lEwlYWMR5vsbOU97UEYfwNoBkACCztilpgAuLocRkrNiQ8pyq0vkhTlm0ht+Bhxt2bASlwP+w0JlI2foOmgvLd4H\/Bc\/ywDLLI10kD+1RBhBCZiDVuxRSjXC\/BWGN0A+PIobHbz7Sg2DHE1SZe0uK+WKS\/iBfopSS81OsbrxMC9BTpv2oLxNcNISufYhVwWkAF0P6ZmchZbpDxUzsk0YoSPCeRV7gOy2GwkUVkwrRRvG201Y8prIgoXyHsRsyO5it\/hyYYZS4oEKu5UAh5VvidXUk7KR6knsU9K6Yon\/DD6BnQyPodSyxfuu90lfhOwlHLkZlfXBeBXOhN5NG4nDPRNCpMO2YLwavaejgjUjfAJX2QvoF4HMqhP0Cwgfp0epmdKVRCQyaHkjXgrNBqK9xfia1mcZLv9sDXG+XdfRYL9T763OzFX9mgDcDgGbL0aW7wmlCAJSlDvQTA+s8hLVHe4aRTzRAFf3CaUp1YyV+6o2Cs7Ik7wKsHooBmcK2qwsuwQtlcEkfRLQn1cjYWXoa6YdnkUjJIuq4ixwADDU8ipaBsNjju2DLZVdDLJsOKGNtXL+UnNQg6U\/P8tJ5JXt\/OcNtHyuC9WLK4NCZFwnazOpXAC0+TdLM7l5\/Y7comqeApCbo1C2kHBhVk0eFlxcONUDft0Hf3oAE6ANAS477vEkc8wc22WTnldzlN0eFLYh4KyImT6GPQr4Eyzk6ZjAeAdGUDn25sLA8bipd6ZBubuKV8yzstHxJS8lPsbqBj\/LSwvXVhoS\/gJDroPIfwwy0YievDmCJ+TvqKP4U9oEq+AgiABMo3oKJJM3XqEICUiPh0i8nkk\/dVQS4sCV1iUkfVJ565Mib2RwFvmRiUfO7SFnmLoDSYXJDueYkzp8c4GAVVLymjScp\/wLT04ALRwA8DqD8\/5hEQZXCd5lE7+CWAzCpAyjpb+L4jzYDD5vPziIxgzaZoJF0JkzUx\/k5pPSwqFA5oCByqQE87jC\/6RDM6Yt906gHrC4e0KfzwDVZtO4bHAXrrIKINc8HQZeVVsBy2RPtXSA3FrU\/1vWM4WQDyUT1s6JDizJaCZowlOiPAxXdDTsyo6mXtu+3JOp7lk4cSzhTQasAUrzb8zNAiWnEZ5r4jE5cwvDLl510NFgVCy9YRmHr+8YvkUXQTHMpeh618BhjcGEJPeObnjvG8G5IBuOdqZHwUt2zFAAilzAmmCMmCX9fjHS9QP7r+MnYRwDDH8SU0N9yY8r4lIBukM+z4MI1+aETA6FDrfnC82CEB40DOEsanTDpfPRzDGdw5xdNmLcSI5EOHb+JHvf5xRgocQOsO+9Bt93hjqJ30JEvQbHMrB5bmuOINGOtBAmmqQGJq2FNsEXztnhJsWJGCWvXCHKyjR21YJC+GyeC4q+LJg4\/AHzyhQE5dphowaYn6nqR9sDJ9xH4gLNX3ID49zGzMMgNYEvMDYadzrxdR\/QmggIQ7kRsy30RrqbQGzriLUTyFUcID6KOO1HHNaijsc8nL0Tr58clKsFLtp+MMheWJcu0tLDYxMJ3p6L1eehwirfc4d0jpizwwZSJ+qb20nQk2Xs\/DOtpRm9yHnnHA7vTfpZySd143IDzniZd6qWX0KbBi8jtuZac\/jij849O8RYYp9pVJz8\/Xu6C\/+5KIfdobXLSfg6PQzgjMVFtcAJyO2T\/DpbLKwvMWRsWZ\/mQwrQZHcNcJPx7ucoojB8lribjbNbUG4Hc2BfjIsv4kohuUNDdH7ENVYgec6bT+5Fqoc+zgiOoG1wL47WrmEdDPLaxlMrEuPaJl7AVUwwlDDBcjn863aNv1Y+QkkNRKfthzoRjdTiihodGYhdF0SQ4zWaBCc9joHUTLE0OmeVROma\/7WGHklJRAOFyDTl0hpnLhNghpmsMijAJ0cOAFFyOkaDIHeCDfYc8hI2HPCGMaK+Sdn+NcvpA8eshRR\/wXg\/pDjlJWHcyCfqt0HQ6P7qKOsPBHDubdOZw5BujR4vLXaVf802lN0xYIX9YBljDZpizBEqfUkiyhIK5QUeh1BVJmb78Ysu1V7yad9citxUm3R2wCSLgEuHpQAocvfXh9N1D1Hg37DdsGUfi8t7hnKfZ3cmBn4d4+Xfmj9j6a59bP7c1JwxmefMW9j7vPHKwTU1Tzo53sgJcCsvC4QcSUZKiCoiJy+Kdl5h3zIoFjMWYBMDZERjDDgmRibM2RY6nmGwJPSakG6yRYbGjTxbmLRi+mC8RPx660gZ642dw4TRCCOxRCmBHkbI1xaGrS0bcIVhnTpavmANmF2KJ8B5KCMH30BXg8iqet0I5I0sRjaVJkqnhK4PghQ46cD2M02mll5j0\/HyLMxqgcCJA6ifaRN7SJxJZgrt42f0I5bPFFCDHGQzP\/m9NdiHfiw6wsMXD4fCdXAD1uCR6QQ9MevhVwFVv\/LwlhjKecDIZO1Z3A1wHhuPjbtp1w54R8VNcxDH6ciDVgxx2vBZFh3GsjePP3Eh64BLS5xRgZ8JpS4dSvOF34m7PKVdUmcdlnDTLEKiIfh3Ka1wBldpOJ8a9oAtewjE\/6J1DONDBy0xDWuvdMDCKdfBy4hIDjFeF9xdnDBbJqTgzkEVpysW2M5\/QxZoXz+04BRCalysBPY6ai79SNiyDbzkc9x58jxAcvP3I1T35Xbve8gjmWQ9y3YkmKKTGcn6OLy2hE2dwXh1yrwfK9eFHMDiVwwyFYLEIsy3OW+Pxl5QbOA2cuK8h12DMDrNMHomtRaUeA7hO18MJ83cu4T0NyP8LhGhIOSM35th92twM\/+8B2G8BK6VBnt2penhvtp8bS7SRTxeBztoIJ9x\/cPhtZf5hxvkbHPTOtuxoBEnVMGKLAOMIE5ZRwgVV0XxMrjuhs5u5bvharszLA+zQnuGwf4n0XHNFZNMgDIQCJ9W8ZeTv+bwpEnjnbSxnGv0flK2lq+lGbBev4WwYNmv57mbRRXwHEi7mOyyEqyDgISzk0E00HO+zOZxJBmQqwm\/H2u8DvAZgIX2E5QhbSWUi8PQaFwCefoUbjHD6L9aZUWsJzuKNAMx3C7rQLrOWhoW2ktemSGt8StCmj7lMUGrIoXRsbxqLxWyNJgk2eZPQ5t1whr\/OifhQItp2n7n4sNcxRv86WdPeOt6sNPZTolq8IACisEUzZCEpP+Y49gdtaew1LKONdzKp+W5FfZeR9rOBjfSp2J8Z\/ndysetDQVgyq+EwLo5+tVZQ328FddiUO5MWl6dax+fgoChUwfCIMydVxqtWj3Ld6KkxWHmYVQS\/45zbRQCHW\/EIg4U+5zAmHP9Iw6m2wZg0Bxofkhdc6F90b\/kR+x1Q2oxIiVBm9m9cghl+HO5vADQeAGL2h8LyEuNNvqC0eMXpRUkn4Z1f7jN3\/qPpPZFK10ffy\/AAJ98aWEr\/MMsflAMra3oZivOytkAbtgvwp3uzMwyur1HY\/v43KdEZaz3eNciG6twiJtJBkyFAbXF\/0DwLcyZnq3ku7g+UsjoQ+04+OF\/S8M+V8bU8Bdjc0lRSo\/2KP2aU\/EnDy5divYw707I2is5qSW6XreT0w+7SJTgIz+DTEhZQ7RxPud7uRnpPreL3ibpnaGqLheZ\/WpGzOs0Uz1h1zBKc3h08dMG+9Kb83x1VWsO20GtuCxrBLg5Y7jMx+d2PFcZOvPNRC+7J+fIc+hNNDXMUwhiWiY\/h8FCooOb4YHkIwcumrmB8rFlnHlV9EPYeUBFbyvjMEQ5YbCX\/EmmexMXLoKPYOl6I+zhYC7z86gqkfBqK+5S+3POFIC+jqobnG3NmPMGsO8px2CKEEZ6HsJRBCI9LhTpfyxNb5CuXiX9xyzRjNh7RA5DxGVw54KoWru4AyToA0oxgiLqjDe8XWLDM4xAsMJEXyLN8aYmVnRvsNbpkpQTDoyNy59xfAzSe64ftEWw18\/Z42+3KHALc1JDUK\/iAAz\/DECWuc9ql5PytizCgwydz22PRDHChnTg\/++xlpGK\/pma\/TGEECzEfMSy54fbF8pgvYf6AbNOf\/H18IqQoy6QXfHY5njDOXI7DJJkvDi5RHoNG9BjHaH0uYfJNC\/OwrsTL\/yL44TINPwnqBtcNMOmO8ToZbeBdobZ47wYdPQiXwExo40DsGxvnruE+dtzGPuc2Le4JXVSxBGDhtd08XPiYmK7DWRGzHNLpsMrS4ztFT4anOqYxAJaL8KMAH0JkKUDX+7F8ebBiuS196Qb8WgDdcbIGJuSPUaulhEXG\/h5MCbNWevLkI+Q2yhHO7oB2s8Jb2oUx4QCMTjyI47I5grZjCzv2YGBhefKGPzGT1Hc4ofF2z\/DSIm8CvGMXqcLHdAHVHjdBWCZ1wnZMNjWhDXn1szSNrJTOcEfQo\/ie4x5mED6VeaEQ\/TFQ+Olf3p1pg9lpAtaFo02jhJgrJhtLoTRtPKbyHEsAU5mC7bOc3F\/\/m+TMXiSWtC+8ZgswhcumKmKKMErLjx12AMOS2QZw+QO81f38AeqH8yTbldafoZZtAJI9+JqzLk7inwCfzPkIO8vYrkIcgan2MG1Wz5UfN7akY1ECHfZIZ0l7pZe1PRa5r7k8V4oFExGvHoYfYKhNv8cJy1vgbG0WCS\/gvg++lL\/AT3KvCH9wVkCa4zLIWjAFdyvvj\/PPPBRH1oIpTkKVG59Al1UMQ\/iAqj72Vtrha+A2GDxpMsk5gKPLP8D1mYFtb+wz1EyyAFO2frcAUzb5lXfuSlkiFcR0+EPC5YjjC5RvQ8gLtn+tBKwEjlkJJLZNd8w2zzJuJWAlUJUSsABTldK3dVsJHOcSsABznHewbZ6VQFVKwAJMVUrf1m0lcJxLwALMcd7BtnlWAlUpAQswVSl9W7eVwHEuAQswx3kH2+ZZCVSlBCzAVKX0bd1WAse5BCzAVLMOxhfn9sRhKfvEyq6UgrPZrASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwErASsBKwECpLA\/wNiq9JJ3UFXngAAAABJRU5ErkJggg==A\"_s;\n@@ -1627,0 +1570,34 @@\n+bool Quirks::shouldStarBeFeaturePolicyDefaultValue() const\n+{\n+    if (!needsQuirks())\n+        return false;\n+\n+    if (!m_shouldStarBeFeaturePolicyDefaultValueQuirk) {\n+        auto domain = m_document->securityOrigin().domain().convertToASCIILowercase();\n+        m_shouldStarBeFeaturePolicyDefaultValueQuirk = domain == \"jsfiddle.net\"_s;\n+    }\n+    return *m_shouldStarBeFeaturePolicyDefaultValueQuirk;\n+}\n+\n+bool Quirks::needsDisableDOMPasteAccessQuirk() const\n+{\n+    if (!needsQuirks())\n+        return false;\n+\n+    if (m_needsDisableDOMPasteAccessQuirk)\n+        return *m_needsDisableDOMPasteAccessQuirk;\n+\n+    m_needsDisableDOMPasteAccessQuirk = [&] {\n+        if (!m_document)\n+            return false;\n+        auto* globalObject = m_document->globalObject();\n+        if (!globalObject)\n+            return false;\n+\n+        JSC::JSLockHolder lock(globalObject->vm());\n+        auto tableauPrepProperty = JSC::Identifier::fromString(globalObject->vm(), \"tableauPrep\"_s);\n+        return globalObject->hasProperty(globalObject, tableauPrepProperty);\n+    }();\n+    return *m_needsDisableDOMPasteAccessQuirk;\n+}\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/Quirks.cpp","additions":210,"deletions":233,"binary":false,"changes":443,"status":"modified"},{"patch":"@@ -62,0 +62,1 @@\n+    bool needsAnchorElementsToBeMouseFocusable() const;\n@@ -87,1 +88,0 @@\n-    WEBCORE_EXPORT bool shouldDisableContentChangeObserver() const;\n@@ -117,1 +117,1 @@\n-    static bool shouldMakeEventListenerPassive(const EventTarget&, const AtomString& eventType, const EventListener&);\n+    static bool shouldMakeEventListenerPassive(const EventTarget&, const AtomString& eventType);\n@@ -123,2 +123,0 @@\n-    bool shouldDisableElementFullscreenQuirk() const;\n-\n@@ -146,1 +144,0 @@\n-    WEBCORE_EXPORT static const String& staticRadioPlayerURLString();\n@@ -164,4 +161,0 @@\n-#if PLATFORM(COCOA)\n-    bool shouldAdvertiseSupportForHLSSubtitleTypes() const;\n-#endif\n-\n@@ -178,1 +171,1 @@\n-    String advancedPrivacyProtectionSubstituteDataURLForText(const String&) const;\n+    String advancedPrivacyProtectionSubstituteDataURLForScriptWithFeatures(const String& lastDrawnText, int canvasWidth, int canvasHeight) const;\n@@ -182,0 +175,4 @@\n+    bool shouldStarBeFeaturePolicyDefaultValue() const;\n+\n+    bool needsDisableDOMPasteAccessQuirk() const;\n+\n@@ -184,0 +181,1 @@\n+    bool isDomain(const String&) const;\n@@ -201,1 +199,0 @@\n-    mutable std::optional<bool> m_shouldDisableElementFullscreenQuirk;\n@@ -240,3 +237,0 @@\n-#if PLATFORM(COCOA)\n-    mutable std::optional<bool> m_shouldAdvertiseSupportForHLSSubtitleTypes;\n-#endif\n@@ -245,0 +239,2 @@\n+    mutable std::optional<bool> m_shouldStarBeFeaturePolicyDefaultValueQuirk;\n+    mutable std::optional<bool> m_needsDisableDOMPasteAccessQuirk;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/Quirks.h","additions":10,"deletions":14,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -57,0 +57,4 @@\n+        if (m_pendingFileLoads.isEmpty()) {\n+            \/\/ The previous load failed synchronously and cancel() was called. We should not attempt to do any further loads.\n+            break;\n+        }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/ShareDataReader.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -134,3 +134,5 @@\n-    ensureOnMainThread([weakPage = WeakPtr { m_page }] {\n-        if (weakPage)\n-            weakPage->scheduleRenderingUpdate(RenderingUpdateStep::WheelEventMonitorCallbacks);\n+    ensureOnMainThread([weakThis = ThreadSafeWeakPtr { *this }] {\n+        RefPtr protectedThis = weakThis.get();\n+        if (!protectedThis)\n+            return;\n+        protectedThis->m_page.scheduleRenderingUpdate(RenderingUpdateStep::WheelEventMonitorCallbacks);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/WheelEventTestMonitor.cpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+#include <wtf\/ThreadSafeWeakPtr.h>\n@@ -42,2 +43,1 @@\n-class WheelEventTestMonitor : public ThreadSafeRefCounted<WheelEventTestMonitor> {\n-    WTF_MAKE_NONCOPYABLE(WheelEventTestMonitor); WTF_MAKE_FAST_ALLOCATED;\n+class WheelEventTestMonitor : public ThreadSafeRefCountedAndCanMakeThreadSafeWeakPtr<WheelEventTestMonitor> {\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/WheelEventTestMonitor.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -829,1 +829,3 @@\n-        if (!usesReportTo && !is<Document>(m_scriptExecutionContext))\n+        \/\/ Unable to ref the document as it may have started destruction.\n+        auto* document = dynamicDowncast<Document>(m_scriptExecutionContext);\n+        if (!document || !document->frame())\n@@ -832,6 +834,1 @@\n-        auto& document = downcast<Document>(*m_scriptExecutionContext);\n-        auto* frame = document.frame();\n-        if (!frame)\n-            return;\n-\n-        info.documentURI = shouldReportProtocolOnly(document.url()) ? document.url().protocol().toString() : document.url().strippedForUseAsReferrer();\n+        info.documentURI = shouldReportProtocolOnly(document->url()) ? document->url().protocol().toString() : document->url().strippedForUseAsReferrer();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/page\/csp\/ContentSecurityPolicy.cpp","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -78,0 +78,1 @@\n+        startAborting();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/AbortableTaskQueue.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -57,2 +57,2 @@\n-        # Specify video decoding limits.\n-        set_source_files_properties(platform\/graphics\/gstreamer\/GStreamerRegistryScanner.cpp PROPERTIES COMPILE_DEFINITIONS VIDEO_DECODING_LIMIT=\"${VIDEO_DECODING_LIMIT}\")\n+        # Specify video decoding limits for platform\/graphics\/gstreamer\/GStreamerRegistryScanner.cpp\n+        list(APPEND WebCore_PRIVATE_DEFINITIONS VIDEO_DECODING_LIMIT=\"${VIDEO_DECODING_LIMIT}\")\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/GStreamer.cmake","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -642,0 +642,4 @@\n+    \/\/ -min() is saturated to max().\n+    if (a == LayoutUnit::min())\n+        return LayoutUnit::max();\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/LayoutUnit.h","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -66,0 +66,1 @@\n+    M(FingerprintingMitigation) \\\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/Logging.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -178,0 +178,9 @@\n+    if (scrollAnimationStatus() == ScrollAnimationStatus::Animating)\n+        scrollAnimator().cancelAnimations();\n+\n+    if (position == scrollPosition())\n+        return;\n+\n+    auto previousScrollType = currentScrollType();\n+    setCurrentScrollType(options.type);\n+\n@@ -184,0 +193,2 @@\n+\n+    setCurrentScrollType(previousScrollType);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/ScrollableArea.cpp","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -356,1 +356,2 @@\n-    ASSERT(m_player.get());\n+    if (!m_player.get())\n+        return;\n@@ -371,1 +372,3 @@\n-    ASSERT(m_player.get());\n+    if (!m_player.get())\n+        return;\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/encryptedmedia\/CDMProxy.cpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -100,0 +100,2 @@\n+    case BTN_MODE:\n+        return ManetteGamepad::StandardGamepadButton::Mode;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/gamepad\/manette\/ManetteGamepad.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -67,0 +67,1 @@\n+        Mode,\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/gamepad\/manette\/ManetteGamepad.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -125,0 +125,1 @@\n+        VideoFullscreenModeAllValidBitsMask = (VideoFullscreenModeStandard | VideoFullscreenModePictureInPicture)\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/MediaPlayerEnums.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -900,1 +900,1 @@\n-    blurLayerImage(layerData->bytes(), blurRect.size(), blurRect.width() * 4);\n+    blurLayerImage(layerData->bytes(), layerData->size(), layerData->size().width() * 4);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/ShadowBlur.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3,0 +3,1 @@\n+ * Copyright (C) 2014 Google Inc.  All rights reserved.\n@@ -131,1 +132,5 @@\n-    a = deg2rad(a);\n+    return rotateRadians(deg2rad(a));\n+}\n+\n+AffineTransform& AffineTransform::rotateRadians(double a)\n+{\n@@ -190,1 +195,1 @@\n-    return rotate(rad2deg(atan2(y, x)));\n+    return rotateRadians(atan2(y, x));\n@@ -411,1 +416,1 @@\n-    m.rotate(rad2deg(-angle));\n+    m.rotateRadians(-angle);\n@@ -435,1 +440,1 @@\n-    this->rotate(rad2deg(decomp.angle));\n+    this->rotateRadians(decomp.angle);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/transforms\/AffineTransform.cpp","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -3,0 +3,1 @@\n+ * Copyright (C) 2014 Google Inc.  All rights reserved.\n@@ -113,0 +114,1 @@\n+    WEBCORE_EXPORT AffineTransform& rotateRadians(double);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/transforms\/AffineTransform.h","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -76,0 +76,10 @@\n+    bool applyUnrounded(TransformationMatrix& transform, const FloatSize& \/*borderBoxSize*\/) const override\n+    {\n+        if (type() == TransformOperation::Type::Rotate)\n+            transform.rotate(m_angle, TransformationMatrix::RotationSnapping::None);\n+        else\n+            transform.rotate3d(m_x, m_y, m_z, m_angle, TransformationMatrix::RotationSnapping::None);\n+        return false;\n+    }\n+\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/transforms\/RotateTransformOperation.h","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -82,0 +82,4 @@\n+    virtual bool applyUnrounded(TransformationMatrix& transform, const FloatSize& borderBoxSize) const\n+    {\n+        return apply(transform, borderBoxSize);\n+    }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/transforms\/TransformOperation.h","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -646,1 +646,1 @@\n-    return rotate(rad2deg(atan2(y, x)));\n+    return rotateRadians(atan2(y, x));\n@@ -926,1 +926,1 @@\n-TransformationMatrix& TransformationMatrix::rotate3d(double x, double y, double z, double angle)\n+TransformationMatrix& TransformationMatrix::rotate3d(double x, double y, double z, double angle, RotationSnapping snapping)\n@@ -946,2 +946,2 @@\n-    double sinTheta = roundEpsilonToZero(sin(angle));\n-    double cosTheta = roundEpsilonToZero(cos(angle));\n+    double sinTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(sin(angle)) : sin(angle);\n+    double cosTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(cos(angle)) : cos(angle);\n@@ -1017,1 +1017,1 @@\n-TransformationMatrix& TransformationMatrix::rotate(double angle)\n+TransformationMatrix& TransformationMatrix::rotate(double angle, RotationSnapping snapping)\n@@ -1022,3 +1022,7 @@\n-    angle = deg2rad(angle);\n-    double sinZ = roundEpsilonToZero(sin(angle));\n-    double cosZ = roundEpsilonToZero(cos(angle));\n+    return rotateRadians(deg2rad(angle), snapping);\n+}\n+\n+TransformationMatrix& TransformationMatrix::rotateRadians(double angle, RotationSnapping snapping)\n+{\n+    double sinZ = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(sin(angle)) : sin(angle);\n+    double cosZ = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(cos(angle)) : cos(angle);\n@@ -1029,1 +1033,1 @@\n-TransformationMatrix& TransformationMatrix::rotate3d(double rx, double ry, double rz)\n+TransformationMatrix& TransformationMatrix::rotate3d(double rx, double ry, double rz, RotationSnapping snapping)\n@@ -1038,2 +1042,2 @@\n-    double sinTheta = roundEpsilonToZero(sin(rz));\n-    double cosTheta = roundEpsilonToZero(cos(rz));\n+    double sinTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(sin(rz)) : sin(rz);\n+    double cosTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(cos(rz)) : cos(rz);\n@@ -1056,2 +1060,2 @@\n-    sinTheta = sin(ry);\n-    cosTheta = cos(ry);\n+    sinTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(sin(ry)) : sin(ry);\n+    cosTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(cos(ry)) : cos(ry);\n@@ -1074,2 +1078,2 @@\n-    sinTheta = sin(rx);\n-    cosTheta = cos(rx);\n+    sinTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(sin(rx)) : sin(rx);\n+    cosTheta = snapping == RotationSnapping::Snap90degRotations ? roundEpsilonToZero(cos(rx)) : cos(rx);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/transforms\/TransformationMatrix.cpp","additions":19,"deletions":15,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -276,0 +276,5 @@\n+    enum class RotationSnapping {\n+        None,\n+        Snap90degRotations,\n+    };\n+\n@@ -277,1 +282,2 @@\n-    WEBCORE_EXPORT TransformationMatrix& rotate(double);\n+    WEBCORE_EXPORT TransformationMatrix& rotate(double, RotationSnapping = RotationSnapping::Snap90degRotations);\n+    WEBCORE_EXPORT TransformationMatrix& rotateRadians(double, RotationSnapping = RotationSnapping::Snap90degRotations);\n@@ -279,1 +285,1 @@\n-    WEBCORE_EXPORT TransformationMatrix& rotate3d(double rx, double ry, double rz);\n+    WEBCORE_EXPORT TransformationMatrix& rotate3d(double rx, double ry, double rz, RotationSnapping = RotationSnapping::Snap90degRotations);\n@@ -282,1 +288,1 @@\n-    TransformationMatrix& rotate3d(double x, double y, double z, double angle);\n+    TransformationMatrix& rotate3d(double x, double y, double z, double angle, RotationSnapping = RotationSnapping::Snap90degRotations);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/graphics\/transforms\/TransformationMatrix.h","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -50,2 +50,2 @@\n-    , m_logger(m_player.mediaPlayerLogger())\n-    , m_logIdentifier(m_player.mediaPlayerLogIdentifier())\n+    , m_logger(m_player->mediaPlayerLogger())\n+    , m_logIdentifier(m_player->mediaPlayerLogIdentifier())\n@@ -55,1 +55,1 @@\n-    client.setLogIdentifier(m_player.mediaPlayerLogIdentifier());\n+    client.setLogIdentifier(m_player->mediaPlayerLogIdentifier());\n@@ -102,1 +102,2 @@\n-    m_player.updateDuration(duration);\n+    if (m_player)\n+        m_player->updateDuration(duration);\n@@ -107,2 +108,2 @@\n-    if (status == EosNoError)\n-        m_player.setNetworkState(MediaPlayer::NetworkState::Loaded);\n+    if (m_player && status == EosNoError)\n+        m_player->setNetworkState(MediaPlayer::NetworkState::Loaded);\n@@ -119,1 +120,3 @@\n-    return m_player.readyState();\n+    if (m_player)\n+        return m_player->readyState();\n+    return MediaPlayer::ReadyState::HaveNothing;\n@@ -124,1 +127,2 @@\n-    m_player.setReadyState(readyState);\n+    if (m_player)\n+        m_player->setReadyState(readyState);\n@@ -129,1 +133,1 @@\n-    m_player.waitForSeekCompleted();\n+    m_player->waitForSeekCompleted();\n@@ -134,1 +138,1 @@\n-    m_player.seekCompleted();\n+    m_player->seekCompleted();\n@@ -186,1 +190,3 @@\n-    return m_player.currentMediaTime();\n+    if (m_player)\n+        return m_player->currentMediaTime();\n+    return MediaTime::invalidTime();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/mock\/mediasource\/MockMediaSourcePrivate.cpp","additions":17,"deletions":11,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -57,1 +57,1 @@\n-    MockMediaPlayerMediaSource& player() const { return m_player; }\n+    WeakPtr<MockMediaPlayerMediaSource> player() const { return m_player; }\n@@ -98,1 +98,1 @@\n-    MockMediaPlayerMediaSource& m_player;\n+    WeakPtr<MockMediaPlayerMediaSource> m_player;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/mock\/mediasource\/MockMediaSourcePrivate.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -216,1 +216,1 @@\n-    return m_mediaSource ? m_mediaSource->player().readyState() : MediaPlayer::ReadyState::HaveNothing;\n+    return m_mediaSource && m_mediaSource->player() ? m_mediaSource->player()->readyState() : MediaPlayer::ReadyState::HaveNothing;\n@@ -221,2 +221,2 @@\n-    if (m_mediaSource)\n-        m_mediaSource->player().setReadyState(readyState);\n+    if (m_mediaSource && m_mediaSource->player())\n+        m_mediaSource->player()->setReadyState(readyState);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/mock\/mediasource\/MockSourceBufferPrivate.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -430,0 +430,2 @@\n+        map.add(RegistrableDomain::uncheckedCreateFromRegistrableDomainString(\"gizmodo.com\"_s), HashSet {\n+            RegistrableDomain::uncheckedCreateFromRegistrableDomainString(\"kinja.com\"_s) });\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/platform\/network\/NetworkStorageSession.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1683,3 +1683,1 @@\n-    m_strategy->maximizeTracks(tracks(m_direction), m_direction == ForColumns ? m_freeSpaceColumns : m_freeSpaceRows);\n-    if (m_strategy->isComputingSizeOrInlineSizeContainment() && !m_renderGrid->explicitIntrinsicInnerLogicalSize(m_direction))\n-        return;\n+    m_strategy->maximizeTracks(tracks(m_direction), m_direction == GridTrackSizingDirection::ForColumns ? m_freeSpaceColumns : m_freeSpaceRows);\n@@ -1688,0 +1686,1 @@\n+    if (!m_strategy->isComputingSizeOrInlineSizeContainment() || m_renderGrid->explicitIntrinsicInnerLogicalSize(m_direction))\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/GridTrackSizingAlgorithm.cpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -873,0 +873,4 @@\n+    bool canContainFixedPosObjects = canContainFixedPositionObjects();\n+    if (isSkippedContentRoot() && (posChildNeedsLayout() || canContainFixedPosObjects))\n+        return false;\n+\n@@ -887,1 +891,0 @@\n-    bool canContainFixedPosObjects = canContainFixedPositionObjects();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderBlock.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -3482,1 +3482,1 @@\n-        auto shouldSynthesizeBaseline = !style().isOverflowVisible() && !is<HTMLFormControlElement>(element());\n+        auto shouldSynthesizeBaseline = !style().isOverflowVisible() && !is<HTMLFormControlElement>(element()) && !isTextControlInnerBlock();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderBlockFlow.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -4585,0 +4585,7 @@\n+\n+        \/\/ FIXME: Transforming a clip doesn't make a whole lot of sense, since it we have to round out to the\n+        \/\/ bounding box of the transformed quad.\n+        \/\/ It would be better for callers to transform rects into the coordinate space of the nearest clipped layer, apply\n+        \/\/ the clip in local space, and then repeat until the required coordinate space is reached.\n+        bool needsTransform = clipRectsType == AbsoluteClipRects ? m_hasTransformedAncestor || !canUseOffsetFromAncestor() : !canUseOffsetFromAncestor(*clipRectsContext.rootLayer);\n+\n@@ -4586,1 +4593,1 @@\n-        if (!m_hasTransformedAncestor && canUseOffsetFromAncestor())\n+        if (!needsTransform)\n@@ -4588,2 +4595,0 @@\n-        else\n-            offset = LayoutPoint(renderer().localToContainerPoint(FloatPoint(), &clipRectsContext.rootLayer->renderer()));\n@@ -4595,1 +4600,4 @@\n-            ClipRect newOverflowClip = rendererOverflowClipRectForChildLayers(offset, nullptr, clipRectsContext.overlayScrollbarSizeRelevancy());\n+            ClipRect newOverflowClip = rendererOverflowClipRectForChildLayers({ }, nullptr, clipRectsContext.overlayScrollbarSizeRelevancy());\n+            if (needsTransform)\n+                newOverflowClip = LayoutRect(renderer().localToContainerQuad(FloatRect(newOverflowClip.rect()), &clipRectsContext.rootLayer->renderer()).boundingBox());\n+            newOverflowClip.moveBy(offset);\n@@ -4604,1 +4612,4 @@\n-            LayoutRect newPosClip = downcast<RenderBox>(renderer()).clipRect(offset, nullptr);\n+            LayoutRect newPosClip = downcast<RenderBox>(renderer()).clipRect({ }, nullptr);\n+            if (needsTransform)\n+                newPosClip = LayoutRect(renderer().localToContainerQuad(FloatRect(newPosClip), &clipRectsContext.rootLayer->renderer()).boundingBox());\n+            newPosClip.moveBy(offset);\n@@ -5216,0 +5227,9 @@\n+bool RenderLayer::canUseOffsetFromAncestor(const RenderLayer& ancestor) const\n+{\n+    for (auto* layer = this; layer != &ancestor; layer = layer->parent()) {\n+        if (!layer->canUseOffsetFromAncestor())\n+            return false;\n+    }\n+    return true;\n+}\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderLayer.cpp","additions":25,"deletions":5,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -604,0 +604,1 @@\n+    bool canUseOffsetFromAncestor(const RenderLayer& ancestor) const;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderLayer.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2988,2 +2988,1 @@\n-    for (auto* layer = &child; layer != &ancestor; layer = layer->parent()) {\n-        if (!layer->canUseOffsetFromAncestor())\n+    if (!child.canUseOffsetFromAncestor(ancestor))\n@@ -2991,1 +2990,0 @@\n-    }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderLayerBacking.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4727,0 +4727,3 @@\n+    if (!scrollingCoordinator)\n+        return 0;\n+\n@@ -4823,0 +4826,2 @@\n+    if (!scrollingCoordinator)\n+        return;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderLayerCompositor.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -155,2 +155,20 @@\n-        if (inputElement().hasAutoFillStrongPasswordButton() && innerTextRenderer && containerLogicalHeight != innerTextLogicalHeight) {\n-            containerRenderer->mutableStyle().setLogicalHeight(Length { innerTextLogicalHeight, LengthType::Fixed });\n+\n+        auto* autoFillStrongPasswordButtonRenderer = [&]() -> RenderBox* {\n+            if (!inputElement().hasAutoFillStrongPasswordButton())\n+                return nullptr;\n+\n+            auto* autoFillButtonElement = inputElement().autoFillButtonElement();\n+            if (!autoFillButtonElement)\n+                return nullptr;\n+\n+            return autoFillButtonElement->renderBox();\n+        }();\n+\n+        if (autoFillStrongPasswordButtonRenderer && innerTextRenderer && innerBlockRenderer) {\n+            auto newContainerHeight = innerTextLogicalHeight;\n+\n+            \/\/ Don't expand the container height if the AutoFill button is wrapped onto a new line.\n+            if (autoFillStrongPasswordButtonRenderer->logicalTop() < innerBlockRenderer->logicalBottom())\n+                newContainerHeight = std::max<LayoutUnit>(newContainerHeight, autoFillStrongPasswordButtonRenderer->logicalHeight());\n+\n+            containerRenderer->mutableStyle().setLogicalHeight(Length { newContainerHeight, LengthType::Fixed });\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderTextControlSingleLine.cpp","additions":20,"deletions":2,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -194,1 +194,1 @@\n-    if (videoElement().isFullscreen() && areAspectRatiosEssentiallyEqual(intrinsicSize, contentSize(), page().deviceScaleFactor()))\n+    if (!intrinsicSize.isEmpty() && videoElement().isFullscreen() && areAspectRatiosEssentiallyEqual(intrinsicSize, contentSize(), page().deviceScaleFactor()))\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/RenderVideo.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -559,0 +559,5 @@\n+    if (!ancestorInlineBox) {\n+        ASSERT_NOT_REACHED();\n+        return;\n+    }\n+\n@@ -596,0 +601,4 @@\n+        if (!ancestorInlineBox) {\n+            ASSERT_NOT_REACHED();\n+            break;\n+        }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/TextBoxPainter.cpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -234,0 +234,2 @@\n+\n+        layoutPositionedObjects(relayoutChildren);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/mathml\/RenderMathMLOperator.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -364,1 +364,5 @@\n-    for (auto child = firstChildBox(); child; child = child->nextSiblingBox())\n+    for (auto child = firstChildBox(); child; child = child->nextSiblingBox()) {\n+        if (child->isOutOfFlowPositioned()) {\n+            child->containingBlock()->insertPositionedObject(*child);\n+            continue;\n+        }\n@@ -366,0 +370,1 @@\n+    }\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/mathml\/RenderMathMLScripts.cpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -597,0 +597,2 @@\n+    layoutPositionedObjects(relayoutChildren);\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/mathml\/RenderMathMLToken.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -458,0 +458,15 @@\n+        auto* previousBoxOnLine = textBox.previousOnLine();\n+\n+        \/\/ If we start a new chunk following an chunk that had a textLength set, use that\n+        \/\/ textLength to determine the chunk start position, instead of glyph advance values.\n+        auto moveToExpectedChunkStartPositionIfNeeded = [&]() {\n+            if (m_inPathLayout || !m_lastChunkHasTextLength || !previousBoxOnLine)\n+                return;\n+\n+            if (m_isVerticalText) {\n+                if (y != SVGTextLayoutAttributes::emptyValue())\n+                    return;\n+            } else {\n+                if (x != SVGTextLayoutAttributes::emptyValue())\n+                    return;\n+            }\n@@ -459,4 +474,14 @@\n-        \/\/ When we've advanced to the box start offset, determine using the original x\/y values\n-        \/\/ whether this character starts a new text chunk before doing any further processing.\n-        bool startsNewTextChunk = false;\n-        if (m_visualCharacterOffset == textBox.start()) {\n+            auto* textContentElement = SVGTextContentElement::elementFromRenderer(&previousBoxOnLine->renderer());\n+            if (!textContentElement)\n+                return;\n+\n+            SVGLengthContext lengthContext(textContentElement);\n+            auto specifiedTextLength = textContentElement->specifiedTextLength().value(lengthContext);\n+\n+            if (m_lastChunkIsVerticalText)\n+                y = m_lastChunkStartPosition + specifiedTextLength;\n+            else\n+                x = m_lastChunkStartPosition + specifiedTextLength;\n+        };\n+\n+        bool startsNewTextChunk = [&]() {\n@@ -469,7 +494,2 @@\n-            startsNewTextChunk = logicalAttributes->context().characterStartsNewTextChunk(m_logicalCharacterOffset);\n-\n-            auto currentBoxOnLineHasAbsolutePosition = [&]() {\n-                if (m_isVerticalText)\n-                    return y != SVGTextLayoutAttributes::emptyValue();\n-                return x != SVGTextLayoutAttributes::emptyValue();\n-            };\n+            if (logicalAttributes->context().characterStartsNewTextChunk(m_logicalCharacterOffset))\n+                return true;\n@@ -482,16 +502,5 @@\n-            auto* previousBoxOnLine = textBox.previousOnLine();\n-            if (m_lastChunkHasTextLength && previousBoxOnLine) {\n-                startsNewTextChunk = true;\n-\n-                if (!currentBoxOnLineHasAbsolutePosition()) {\n-                    if (auto* textContentElement = SVGTextContentElement::elementFromRenderer(&previousBoxOnLine->renderer())) {\n-                        SVGLengthContext lengthContext(textContentElement);\n-                        auto specifiedTextLength = textContentElement->specifiedTextLength().value(lengthContext);\n-\n-                        if (m_lastChunkIsVerticalText)\n-                            y = m_lastChunkStartPosition + specifiedTextLength;\n-                        else\n-                            x = m_lastChunkStartPosition + specifiedTextLength;\n-                    }\n-                }\n-            }\n+            if (m_lastChunkHasTextLength && previousBoxOnLine)\n+                return true;\n+\n+            return false;\n+        }();\n@@ -499,0 +508,4 @@\n+        \/\/ When we've advanced to the box start offset, determine using the original x\/y values\n+        \/\/ whether this character starts a new text chunk before doing any further processing.\n+        if (m_visualCharacterOffset == textBox.start()) {\n+            moveToExpectedChunkStartPositionIfNeeded();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/svg\/SVGTextLayoutEngine.cpp","additions":40,"deletions":27,"binary":false,"changes":67,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"RenderMenuList.h\"\n@@ -56,1 +57,1 @@\n-        if (child.isFloating() || child.isOutOfFlowPositioned())\n+        if (child.isFloating() || child.isOutOfFlowPositioned() || is<RenderMenuList>(child))\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/rendering\/updating\/RenderTreeBuilderList.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -308,0 +308,6 @@\n+    if (m_element && (m_element->hasTagName(frameTag) || m_element->hasTagName(framesetTag))) {\n+        \/\/ Framesets ignore display and position properties.\n+        style.setPosition(PositionType::Static);\n+        style.setEffectiveDisplay(DisplayType::Block);\n+    }\n+\n@@ -314,7 +320,0 @@\n-            \/\/ Frames and framesets never honor position:relative or position:absolute. This is necessary to\n-            \/\/ fix a crash where a site tries to position these objects. They also never honor display.\n-            if (m_element->hasTagName(frameTag) || m_element->hasTagName(framesetTag)) {\n-                style.setPosition(PositionType::Static);\n-                style.setEffectiveDisplay(DisplayType::Block);\n-            }\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/style\/StyleAdjuster.cpp","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -307,0 +307,19 @@\n+void SVGAnimateMotionElement::childrenChanged(const ChildChange& change)\n+{\n+    SVGElement::childrenChanged(change);\n+    switch (change.type) {\n+    case ChildChange::Type::ElementRemoved:\n+    case ChildChange::Type::AllChildrenRemoved:\n+    case ChildChange::Type::AllChildrenReplaced:\n+        updateAnimationPath();\n+        break;\n+    case ChildChange::Type::ElementInserted:\n+    case ChildChange::Type::TextInserted:\n+    case ChildChange::Type::TextRemoved:\n+    case ChildChange::Type::TextChanged:\n+    case ChildChange::Type::NonContentsChildInserted:\n+    case ChildChange::Type::NonContentsChildRemoved:\n+        break;\n+    }\n+}\n+\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/svg\/SVGAnimateMotionElement.cpp","additions":19,"deletions":0,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -62,0 +62,1 @@\n+    void childrenChanged(const ChildChange&) final;\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/svg\/SVGAnimateMotionElement.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -98,1 +98,0 @@\n-    notifyParentOfPathChange(&oldParentOfRemovedTree);\n@@ -130,5 +129,1 @@\n-    notifyParentOfPathChange(parentNode());\n-}\n-\n-void SVGMPathElement::notifyParentOfPathChange(ContainerNode* parent)\n-{\n+    auto* parent = parentNode();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/svg\/SVGMPathElement.cpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -57,2 +57,0 @@\n-\n-    void notifyParentOfPathChange(ContainerNode*);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/svg\/SVGMPathElement.h","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -67,0 +67,1 @@\n+    options.sameOriginDataURLFlag = SameOriginDataURLFlag::Set;\n@@ -143,0 +144,2 @@\n+    if (m_fontLoadRequestClient)\n+        m_fontLoadRequestClient->fontLoaded(*this);\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/workers\/WorkerFontLoadRequest.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -134,2 +134,2 @@\n-            if (response)\n-                response->cancelStream();\n+            if (RefPtr protectedResponse = response.get())\n+                protectedResponse->cancelStream();\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WebCore\/workers\/service\/context\/ServiceWorkerFetch.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}