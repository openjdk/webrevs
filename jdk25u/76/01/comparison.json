{"files":[{"patch":"@@ -26,0 +26,1 @@\n+import java.lang.management.ThreadMXBean;\n@@ -74,1 +75,1 @@\n-     * Counting the events that are emitted for a given throttle in a given time.\n+     * Counting the events that are emitted for a given throttle in a given (CPU) time.\n@@ -86,2 +87,0 @@\n-            var bean = ManagementFactory.getThreadMXBean();\n-\n@@ -90,5 +89,1 @@\n-            long startThreadCpuTime = bean.getCurrentThreadCpuTime();\n-\n-            wasteCPU(timeMs);\n-\n-            long spendCPUTime = bean.getCurrentThreadCpuTime() - startThreadCpuTime;\n+            long spendCPUTime = wasteCPU(timeMs);\n@@ -102,1 +97,0 @@\n-\n@@ -107,2 +101,3 @@\n-    private static void wasteCPU(int durationMs) {\n-        long start = System.currentTimeMillis();\n+    private static long wasteCPU(int durationMs) {\n+        ThreadMXBean bean = ManagementFactory.getThreadMXBean();\n+        long start = bean.getCurrentThreadCpuTime();\n@@ -110,1 +105,1 @@\n-        while (System.currentTimeMillis() - start < durationMs) {\n+        while (bean.getCurrentThreadCpuTime() - start < durationMs * 1_000_000) {\n@@ -115,0 +110,1 @@\n+        return bean.getCurrentThreadCpuTime() - start;\n","filename":"test\/jdk\/jdk\/jfr\/event\/profiling\/TestCPUTimeSampleThrottling.java","additions":8,"deletions":12,"binary":false,"changes":20,"status":"modified"}]}