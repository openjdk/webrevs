{"files":[{"patch":"@@ -55,0 +55,1 @@\n+import java.util.ArrayList;\n@@ -197,2 +198,8 @@\n-        return AddLauncherArguments.merge(mainParams, launcherParams, ICON.getID(), ADD_LAUNCHERS\n-                .getID(), FILE_ASSOCIATIONS.getID());\n+\n+        var excludes = new ArrayList<String>(List.of(ICON.getID(), ADD_LAUNCHERS.getID()));\n+        if (!NAME.findIn(mainParams).equals(NAME.findIn(launcherParams))) {\n+            \/\/ This is the additional launcher. It shouldn't have FA.\n+            excludes.add(FILE_ASSOCIATIONS.getID());\n+        }\n+\n+        return AddLauncherArguments.merge(mainParams, launcherParams, excludes.toArray(String[]::new));\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/FromParams.java","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -275,3 +275,0 @@\n-        \/\/ Setup test app to have valid jpackage command line before running the check.\n-        addHelloAppInitializer(null);\n-\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/PackageTest.java","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import jdk.jpackage.test.AdditionalLauncher;\n@@ -34,0 +35,1 @@\n+import jdk.jpackage.test.RunnablePackageTest;\n@@ -67,1 +69,1 @@\n- * @run main\/othervm\/timeout=540 -Xmx512m jdk.jpackage.test.Main\n+ * @run main\/othervm\/timeout=1080 -Xmx512m jdk.jpackage.test.Main\n@@ -88,1 +90,1 @@\n-        PackageTest packageTest = new PackageTest();\n+        PackageTest packageTest = new PackageTest().configureHelloApp();\n@@ -147,0 +149,28 @@\n+    @Test\n+    @Parameter(\"true\")\n+    @Parameter(\"false\")\n+    public static void testFromAppImage(boolean withAdditionalLauncher) {\n+\n+        var appImageCmd = JPackageCommand.helloAppImage();\n+\n+        if (RunnablePackageTest.hasAction(RunnablePackageTest.Action.INSTALL)) {\n+            \/\/ Ensure launchers are executable.\n+            appImageCmd.ignoreFakeRuntime();\n+        }\n+\n+        if (withAdditionalLauncher) {\n+            new AdditionalLauncher(\"foo\").applyTo(appImageCmd);\n+        }\n+\n+        var test = new PackageTest().excludeTypes(PackageType.MAC_DMG)\n+        .addRunOnceInitializer(appImageCmd::execute)\n+        .addInitializer(cmd -> {\n+            cmd.removeArgumentWithValue(\"--input\");\n+            cmd.setArgumentValue(\"--app-image\", appImageCmd.outputBundle());\n+        });\n+\n+        new FileAssociations(\"jptest3\").applyTo(test);\n+\n+        test.run();\n+    }\n+\n","filename":"test\/jdk\/tools\/jpackage\/share\/FileAssociationsTest.java","additions":32,"deletions":2,"binary":false,"changes":34,"status":"modified"}]}