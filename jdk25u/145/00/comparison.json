{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import utils.JstatGcCauseTool;\n@@ -39,1 +40,1 @@\n-    private final TmTool<? extends JstatResults> jstatTool;\n+    private final JstatGcCauseTool jstatTool;\n@@ -41,1 +42,1 @@\n-    public GarbageProducerTest(TmTool<? extends JstatResults> tool) {\n+    public GarbageProducerTest(JstatGcCauseTool tool) {\n@@ -48,4 +49,4 @@\n-        \/\/ Run once and get the  results asserting that they are reasonable\n-        JstatResults measurement1 = jstatTool.measure();\n-        measurement1.assertConsistency();\n-        \/\/ Eat metaspace and heap then run the tool again and get the results  asserting that they are reasonable\n+        \/\/ Run once and get the results asserting that they are reasonable\n+        JstatResults measurement1 = jstatTool.measureAndAssertConsistency();\n+\n+        \/\/ Eat metaspace and heap then run the tool again and get the results, asserting that they are reasonable\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/GarbageProducerTest.java","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,2 +47,1 @@\n-        JstatGcNewResults measurement1 = jstatGcTool.measure();\n-        measurement1.assertConsistency();\n+        JstatGcNewResults measurement1 = jstatGcTool.measureAndAssertConsistency();\n@@ -54,2 +53,1 @@\n-        JstatGcNewResults measurement2 = jstatGcTool.measure();\n-        measurement2.assertConsistency();\n+        JstatGcNewResults measurement2 = jstatGcTool.measureAndAssertConsistency();\n@@ -63,2 +61,1 @@\n-        JstatGcNewResults measurement3 = jstatGcTool.measure();\n-        measurement3.assertConsistency();\n+        JstatGcNewResults measurement3 = jstatGcTool.measureAndAssertConsistency();\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/GcNewTest.java","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,3 +50,2 @@\n-        \/\/ Run once and get the  results asserting that they are reasonable\n-        JstatGcResults measurement1 = jstatGcTool.measure();\n-        measurement1.assertConsistency();\n+        \/\/ Run once and get the results asserting that they are reasonable\n+        JstatGcResults measurement1 = jstatGcTool.measureAndAssertConsistency();\n@@ -59,2 +58,1 @@\n-        JstatGcResults measurement2 = jstatGcTool.measure();\n-        measurement2.assertConsistency();\n+        JstatGcResults measurement2 = jstatGcTool.measureAndAssertConsistency();\n@@ -69,2 +67,1 @@\n-        JstatGcResults measurement3 = jstatGcTool.measure();\n-        measurement3.assertConsistency();\n+        JstatGcResults measurement3 = jstatGcTool.measureAndAssertConsistency();\n@@ -75,1 +72,0 @@\n-\n@@ -77,1 +73,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/GcTest01.java","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -45,1 +45,1 @@\n-        new GarbageProducerTest(new JstatGcTool(ProcessHandle.current().pid())).run();\n+        new GarbageProducerTest(new JstatGcCauseTool(ProcessHandle.current().pid())).run();\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/GcTest02.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n-public class JstatGcCapacityTool extends TmTool<JstatGcCapacityResults> {\n+public class JstatGcCapacityTool extends JstatTool<JstatGcCapacityResults> {\n@@ -36,1 +36,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/utils\/JstatGcCapacityTool.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n-public class JstatGcCauseTool extends TmTool<JstatGcCauseResults> {\n+public class JstatGcCauseTool extends JstatTool<JstatGcCauseResults> {\n@@ -36,1 +36,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/utils\/JstatGcCauseTool.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n-public class JstatGcNewTool extends TmTool<JstatGcNewResults> {\n+public class JstatGcNewTool extends JstatTool<JstatGcNewResults> {\n@@ -36,1 +36,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/utils\/JstatGcNewTool.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n-public class JstatGcTool extends TmTool<JstatGcResults> {\n+public class JstatGcTool extends JstatTool<JstatGcResults> {\n@@ -36,1 +36,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/utils\/JstatGcTool.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-abstract public class JstatResults extends ToolResults {\n+public abstract class JstatResults extends ToolResults {\n@@ -184,1 +184,1 @@\n-    abstract public void assertConsistency();\n+     public abstract void assertConsistency();\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/utils\/JstatResults.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,59 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package utils;\n+\n+import common.TmTool;\n+\n+\/**\n+ * Common base class for Jstat tools.\n+ *\/\n+public class JstatTool<T extends JstatResults> extends TmTool<T> {\n+\n+    private static final int TRIES = 3;\n+\n+     public JstatTool(Class<T> resultsClz, String toolName, String otherArgs) {\n+        super(resultsClz, toolName, otherArgs);\n+    }\n+\n+    \/**\n+     * Measure, and call assertConsistency() on the results,\n+     * tolerating a set number of failures to account for inconsistencies in PerfData.\n+     *\/\n+    public T measureAndAssertConsistency() throws Exception {\n+        T results = null;\n+        for (int i = 1; i <= TRIES; i++) {\n+            try {\n+                results = measure();\n+                results.assertConsistency();\n+            } catch (RuntimeException e) {\n+                System.out.println(\"Attempt \" + i + \": \" + e);\n+                if (i == TRIES) {\n+                    System.out.println(\"Too many failures.\");\n+                    throw(e);\n+                }\n+                \/\/ Will retry.\n+            }\n+        }\n+        return results;\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/utils\/JstatTool.java","additions":59,"deletions":0,"binary":false,"changes":59,"status":"added"}]}