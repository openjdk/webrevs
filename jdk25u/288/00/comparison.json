{"files":[{"patch":"@@ -92,1 +92,1 @@\n-    static String nss_library = \"softokn3\";\n+    static String nss_library = System.getProperty(\"CUSTOM_P11_LIBRARY_NAME\", \"softokn3\");\n@@ -202,0 +202,11 @@\n+        String customBaseDir = System.getProperty(\"CUSTOM_P11_CONFIG_BASE_DIR\");\n+        if (customBaseDir != null) {\n+            File base = new File(customBaseDir);\n+            if (!base.exists()) {\n+                throw new RuntimeException(\n+                        \"Directory specified by CUSTOM_P11_CONFIG_BASE_DIR does not exist: \"\n+                                + base.getAbsolutePath());\n+            }\n+            PKCS11_BASE = base.getAbsolutePath();\n+            return PKCS11_BASE;\n+        }\n@@ -457,0 +468,34 @@\n+    \/**\n+     * Prepares the NSS configuration file hierarchy, then returns the\n+     * path of the configuration file that should be used to configure\n+     * the PKCS11 provider.\n+     *\n+     * By default, the contents of the directory\n+     * \"test\/jdk\/sun\/security\/pkcs11\/nss\" are copied to the jtreg\n+     * scratch directory (\".\"), and \".\/nss\/p11-nss.txt\" is returned.\n+     *\n+     * The following system properties modify the default behavior:\n+     *\n+     * CUSTOM_P11_CONFIG_BASE_DIR: The path of a custom configuration\n+     * file hierarchy; overrides the default,\n+     * \"test\/jdk\/sun\/security\/pkcs11\".\n+     *\n+     * CUSTOM_P11_CONFIG_NAME: The name of a custom configuration\n+     * file; overrides the default, \"p11-nss.txt\".  Note that some\n+     * test cases set CUSTOM_P11_CONFIG_NAME using -D in jtreg @run\n+     * tags; for those test cases, setting this property on the\n+     * top-level jtreg command line has no effect.\n+     *\n+     * CUSTOM_P11_CONFIG: The path of a custom configuration file;\n+     * overrides the default \".\/nss\/p11-nss.txt\".  This takes\n+     * precedence over CUSTOM_P11_CONFIG_NAME.  Tests that hard-code\n+     * CUSTOM_P11_CONFIG_NAME in jtreg @run tags may not work\n+     * correctly when CUSTOM_P11_CONFIG is set on the top-level jtreg\n+     * command line.\n+     *\n+     * CUSTOM_DB_DIR: The path of a custom database directory;\n+     * overrides the default, \".\/nss\/db\".\n+     *\n+     * CUSTOM_P11_LIBRARY_NAME: The name of a custom provider library\n+     * to load; overrides the default, \"softokn3\".\n+     *\/\n","filename":"test\/jdk\/sun\/security\/pkcs11\/PKCS11Test.java","additions":46,"deletions":1,"binary":false,"changes":47,"status":"modified"}]}