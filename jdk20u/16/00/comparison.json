{"files":[{"patch":"@@ -39,10 +39,2 @@\n-import java.security.cert.Certificate;\n-import java.security.cert.CertificateExpiredException;\n-import java.security.cert.CertificateNotYetValidException;\n-import java.security.cert.X509Certificate;\n-import java.util.Date;\n-import java.util.Enumeration;\n-import java.util.HashMap;\n-import java.util.HashSet;\n-import java.util.HexFormat;\n-import java.util.Map;\n+import java.security.cert.*;\n+import java.util.*;\n@@ -254,1 +246,0 @@\n-    \/\/ Exception list to 90 days expiry policy\n@@ -283,1 +274,0 @@\n-        md = MessageDigest.getInstance(\"SHA-256\");\n@@ -285,0 +275,2 @@\n+        \/\/ verify integrity of cacerts\n+        md = MessageDigest.getInstance(\"SHA-256\");\n@@ -289,2 +281,2 @@\n-            System.err.println(\"ERROR: wrong checksum\\n\" + checksum);\n-            System.err.println(\"Expected checksum\\n\" + CHECKSUM);\n+            System.err.println(\"ERROR: wrong checksum\" + checksum);\n+            System.err.println(\"Expected checksum\" + CHECKSUM);\n@@ -303,0 +295,9 @@\n+        System.out.println(\"Trusted CA Certificate count: \" + ks.size());\n+\n+        \/\/ also ensure FINGERPRINT_MAP lists correct count\n+        if (FINGERPRINT_MAP.size() != COUNT) {\n+            atLeastOneFailed = true;\n+            System.err.println(\"ERROR: \" + FINGERPRINT_MAP.size()\n+                    + \" FINGERPRINT_MAP entries, should be \" + COUNT);\n+        }\n+\n@@ -316,1 +317,3 @@\n-            System.out.println(\"\\nVerifying \" + alias);\n+            System.out.println(\"Verifying \" + alias);\n+\n+            \/\/ Is cert trusted?\n@@ -319,2 +322,1 @@\n-                System.err.println(\"ERROR: \" + alias\n-                        + \" is not a trusted cert entry\");\n+                System.err.println(\"ERROR: \" + alias + \" is not a trusted cert entry\");\n@@ -322,0 +324,2 @@\n+\n+            \/\/ Does fingerprint match?\n@@ -327,1 +331,2 @@\n-            \/\/ Make sure cert can be self-verified\n+\n+            \/\/ Can cert be self-verified?\n@@ -332,2 +337,1 @@\n-                System.err.println(\"ERROR: cert cannot be verified:\"\n-                        + e.getMessage());\n+                System.err.println(\"ERROR: cert cannot be verified:\" + e.getMessage());\n@@ -336,1 +340,1 @@\n-            \/\/ Make sure cert is not expired or not yet valid\n+            \/\/ Is cert expired?\n@@ -342,1 +346,1 @@\n-                    System.err.println(\"ERROR: cert is expired\");\n+                    System.err.println(\"ERROR: cert is expired but not in EXPIRY_EXC_ENTRIES\");\n@@ -349,1 +353,1 @@\n-            \/\/ If cert is within 90 days of expiring, mark as failure so\n+            \/\/ If cert is within 90 days of expiring, mark as warning so\n@@ -354,3 +358,2 @@\n-                    atLeastOneFailed = true;\n-                    System.err.println(\"ERROR: cert \\\"\" + alias + \"\\\" expiry \\\"\"\n-                            + notAfter.toString() + \"\\\" will expire within 90 days\");\n+                    System.err.println(\"WARNING: cert \\\"\" + alias + \"\\\" expiry \\\"\"\n+                            + notAfter + \"\\\" will expire within 90 days\");\n@@ -362,1 +365,1 @@\n-            throw new Exception(\"At least one cacert test failed\");\n+            throw new RuntimeException(\"At least one cacert test failed\");\n@@ -367,1 +370,1 @@\n-            throws Exception {\n+            throws CertificateEncodingException {\n@@ -371,1 +374,1 @@\n-            return true;\n+            return false;\n@@ -373,1 +376,0 @@\n-        System.out.println(\"Checking fingerprint of \" + alias);\n@@ -377,1 +379,0 @@\n-\n","filename":"test\/jdk\/sun\/security\/lib\/cacerts\/VerifyCACerts.java","additions":32,"deletions":31,"binary":false,"changes":63,"status":"modified"}]}