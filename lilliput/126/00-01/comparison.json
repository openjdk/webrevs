{"files":[{"patch":"@@ -142,5 +142,0 @@\n-\n-  # Workaround stylesheet bug\n-  HEADER_STYLE := style=\"margin-top: 9px;\"\n-else\n-  HEADER_STYLE := style=\"margin-top: 14px;\"\n@@ -342,1 +337,1 @@\n-  $1_HEADER_TITLE := <div $$(HEADER_STYLE)><strong>$$($1_SHORT_NAME)<\/strong> \\\n+  $1_HEADER_TITLE := <div><strong>$$($1_SHORT_NAME)<\/strong> \\\n@@ -650,1 +645,1 @@\n-  HEADER_RIGHT_SIDE_INFO := <strong>$(subst &amp;,&,$(JDK_SHORT_NAME))$(DRAFT_MARKER_STR)<\/strong>\n+  HEADER_RIGHT_SIDE_INFO := <strong>$(subst &amp;,&,$(JDK_SHORT_NAME))<\/strong>$(DRAFT_MARKER_STR)\n","filename":"make\/Docs.gmk","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -972,4 +972,10 @@\n-  # The ct.sym generation uses all the moduleinfos as input\n-  jdk.compiler-gendata: $(GENSRC_MODULEINFO_TARGETS) $(JAVA_TARGETS)\n-  # jdk.compiler-gendata needs the BUILD_JDK. If the BUILD_JDK was supplied\n-  # externally, no extra prerequisites are needed.\n+  # jdk.compiler gendata generates ct.sym, which requires all generated\n+  # java source and compiled classes present.\n+  jdk.compiler-gendata: $(JAVA_TARGETS)\n+\n+  # jdk.javadoc gendata generates element-list, which requires all java sources\n+  # but not compiled classes.\n+  jdk.javadoc-gendata: $(GENSRC_TARGETS)\n+\n+  # ct.sym and element-list generation also needs the BUILD_JDK. If the\n+  # BUILD_JDK was supplied externally, no extra prerequisites are needed.\n@@ -981,0 +987,1 @@\n+      jdk.javadoc-gendata: create-buildjdk\n@@ -986,0 +993,1 @@\n+    jdk.javadoc-gendata: jdk.compiler-launchers\n","filename":"make\/Main.gmk","additions":12,"deletions":4,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -120,0 +120,5 @@\n+        ],\n+        IF_TRUE: [\n+            # Add debug prefix map gcc system include paths, as they cause\n+            # non-deterministic debug paths depending on gcc path location.\n+            DEBUG_PREFIX_MAP_GCC_INCLUDE_PATHS\n@@ -161,0 +166,49 @@\n+# gcc will embed the full system include paths in the debug info\n+# resulting in non-deterministic debug symbol files and thus\n+# non-reproducible native libraries if gcc includes are located\n+# in different paths.\n+# Add -fdebug-prefix-map'ings for root and gcc include paths,\n+# pointing to a common set of folders so that the binaries are deterministic:\n+#  root include : \/usr\/include\n+#  gcc include  : \/usr\/local\/gcc_include\n+#  g++ include  : \/usr\/local\/gxx_include\n+AC_DEFUN([DEBUG_PREFIX_MAP_GCC_INCLUDE_PATHS],\n+[\n+    # Determine gcc system include paths.\n+    # Assume default roots to start with:\n+    GCC_ROOT_INCLUDE=\"\/usr\/include\"\n+\n+    # Determine is sysroot or devkit specified?\n+    if test \"x$SYSROOT\" != \"x\"; then\n+      GCC_ROOT_INCLUDE=\"${SYSROOT%\/}\/usr\/include\"\n+    fi\n+\n+    # Add root include mapping => \/usr\/include\n+    GCC_INCLUDE_DEBUG_MAP_FLAGS=\"-fdebug-prefix-map=${GCC_ROOT_INCLUDE}\/=\/usr\/include\/\"\n+\n+    # Add gcc system include mapping => \/usr\/local\/gcc_include\n+    #   Find location of stddef.h using build C compiler\n+    GCC_SYSTEM_INCLUDE=`$ECHO \"#include <stddef.h>\" | \\\n+                        $CC $CFLAGS -v -E - 2>&1 | \\\n+                        $GREP stddef | $TAIL -1 | $TR -s \" \" | $CUT -d'\"' -f2`\n+    if test \"x$GCC_SYSTEM_INCLUDE\" != \"x\"; then\n+      GCC_SYSTEM_INCLUDE=`$DIRNAME $GCC_SYSTEM_INCLUDE`\n+      GCC_INCLUDE_DEBUG_MAP_FLAGS=\"$GCC_INCLUDE_DEBUG_MAP_FLAGS \\\n+          -fdebug-prefix-map=${GCC_SYSTEM_INCLUDE}\/=\/usr\/local\/gcc_include\/\"\n+    fi\n+\n+    # Add g++ system include mapping => \/usr\/local\/gxx_include\n+    #   Find location of cstddef using build C++ compiler\n+    GXX_SYSTEM_INCLUDE=`$ECHO \"#include <cstddef>\" | \\\n+                        $CXX $CXXFLAGS -v -E -x c++ - 2>&1 | \\\n+                        $GREP cstddef | $TAIL -1 | $TR -s \" \" | $CUT -d'\"' -f2`\n+    if test \"x$GXX_SYSTEM_INCLUDE\" != \"x\"; then\n+      GXX_SYSTEM_INCLUDE=`$DIRNAME $GXX_SYSTEM_INCLUDE`\n+      GCC_INCLUDE_DEBUG_MAP_FLAGS=\"$GCC_INCLUDE_DEBUG_MAP_FLAGS \\\n+          -fdebug-prefix-map=${GXX_SYSTEM_INCLUDE}\/=\/usr\/local\/gxx_include\/\"\n+    fi\n+\n+    # Add to debug prefix cflags\n+    DEBUG_PREFIX_CFLAGS=\"$DEBUG_PREFIX_CFLAGS $GCC_INCLUDE_DEBUG_MAP_FLAGS\"\n+])\n+\n@@ -428,1 +482,1 @@\n-    CFLAGS_OS_DEF_JVM=\"-DLINUX\"\n+    CFLAGS_OS_DEF_JVM=\"-DLINUX -D_FILE_OFFSET_BITS=64\"\n","filename":"make\/autoconf\/flags-cflags.m4","additions":56,"deletions":2,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -51,3 +51,0 @@\n-  BUILD_LIBJVM_ostream.cpp_CXXFLAGS := -D_FILE_OFFSET_BITS=64\n-  BUILD_LIBJVM_logFileOutput.cpp_CXXFLAGS := -D_FILE_OFFSET_BITS=64\n-\n","filename":"make\/hotspot\/lib\/JvmOverrideFiles.gmk","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -110,0 +110,1 @@\n+        -XDsuppressNotes \\\n","filename":"make\/test\/BuildMicrobenchmark.gmk","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -114,1 +114,1 @@\n-  \/\/ The object's monitor m is unlocked iff m->owner == NULL,\n+  \/\/ The object's monitor m is unlocked iff m->owner == nullptr,\n@@ -117,1 +117,1 @@\n-  \/\/ Try to CAS m->owner from NULL to current thread.\n+  \/\/ Try to CAS m->owner from null to current thread.\n","filename":"src\/hotspot\/cpu\/aarch64\/c2_MacroAssembler_aarch64.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n-  const int start_index = aslr ? os::random() : 0;\n+  const int start_index = aslr ? os::next_random((int)os::javaTimeNanos()) : 0;\n","filename":"src\/hotspot\/cpu\/aarch64\/compressedKlass_aarch64.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -124,1 +124,1 @@\n-  \/\/ The object's monitor m is unlocked iff m->owner == NULL,\n+  \/\/ The object's monitor m is unlocked iff m->owner == nullptr,\n@@ -127,1 +127,1 @@\n-  \/\/ Try to CAS m->owner from NULL to current thread.\n+  \/\/ Try to CAS m->owner from null to current thread.\n@@ -1832,0 +1832,43 @@\n+static void float_to_float16_slow_path(C2_MacroAssembler& masm, C2GeneralStub<Register, FloatRegister, Register>& stub) {\n+#define __ masm.\n+  Register dst = stub.data<0>();\n+  FloatRegister src = stub.data<1>();\n+  Register tmp = stub.data<2>();\n+  __ bind(stub.entry());\n+\n+  __ fmv_x_w(dst, src);\n+\n+  \/\/ preserve the payloads of non-canonical NaNs.\n+  __ srai(dst, dst, 13);\n+  \/\/ preserve the sign bit.\n+  __ srai(tmp, dst, 13);\n+  __ slli(tmp, tmp, 10);\n+  __ mv(t0, 0x3ff);\n+  __ orr(tmp, tmp, t0);\n+\n+  \/\/ get the result by merging sign bit and payloads of preserved non-canonical NaNs.\n+  __ andr(dst, dst, tmp);\n+\n+  __ j(stub.continuation());\n+#undef __\n+}\n+\n+\/\/ j.l.Float.floatToFloat16\n+void C2_MacroAssembler::float_to_float16(Register dst, FloatRegister src, FloatRegister ftmp, Register xtmp) {\n+  auto stub = C2CodeStub::make<Register, FloatRegister, Register>(dst, src, xtmp, 130, float_to_float16_slow_path);\n+\n+  \/\/ in riscv, NaN needs a special process as fcvt does not work in that case.\n+\n+  \/\/ check whether it's a NaN.\n+  \/\/ replace fclass with feq as performance optimization.\n+  feq_s(t0, src, src);\n+  \/\/ jump to stub processing NaN cases.\n+  beqz(t0, stub->entry());\n+\n+  \/\/ non-NaN cases, just use built-in instructions.\n+  fcvt_h_s(ftmp, src);\n+  fmv_x_h(dst, ftmp);\n+\n+  bind(stub->continuation());\n+}\n+\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":46,"deletions":3,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -176,0 +176,1 @@\n+  void float_to_float16(Register dst, FloatRegister src, FloatRegister ftmp, Register xtmp);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1937,0 +1937,1 @@\n+    case Op_ConvF2HF:\n@@ -8295,0 +8296,12 @@\n+instruct convF2HF_reg_reg(iRegINoSp dst, fRegF src, fRegF ftmp, iRegINoSp xtmp) %{\n+  match(Set dst (ConvF2HF src));\n+  effect(TEMP_DEF dst, TEMP ftmp, TEMP xtmp);\n+  format %{ \"fcvt.h.s $ftmp, $src\\t# convert single precision to half\\n\\t\"\n+            \"fmv.x.h $dst, $ftmp\\t# move result from $ftmp to $dst\"\n+  %}\n+  ins_encode %{\n+    __ float_to_float16($dst$$Register, $src$$FloatRegister, $ftmp$$FloatRegister, $xtmp$$Register);\n+  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -2871,1 +2871,1 @@\n-    \/\/ Life is simple. NULL the object pointer.\n+    \/\/ Life is simple. Null the object pointer.\n","filename":"src\/hotspot\/cpu\/s390\/templateTable_s390.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -819,2 +819,2 @@\n-  void emit_data(jint data, relocInfo::relocType    rtype, int format);\n-  void emit_data(jint data, RelocationHolder const& rspec, int format);\n+  void emit_data(jint data, relocInfo::relocType    rtype, int format = 0);\n+  void emit_data(jint data, RelocationHolder const& rspec, int format = 0);\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -5285,0 +5285,36 @@\n+#ifdef _LP64\n+void C2_MacroAssembler::vector_compress_expand_avx2(int opcode, XMMRegister dst, XMMRegister src,\n+                                                    XMMRegister mask, Register rtmp, Register rscratch,\n+                                                    XMMRegister permv, XMMRegister xtmp, BasicType bt,\n+                                                    int vec_enc) {\n+  assert(type2aelembytes(bt) >= 4, \"\");\n+  assert(opcode == Op_CompressV || opcode == Op_ExpandV, \"\");\n+  address compress_perm_table = nullptr;\n+  address expand_perm_table = nullptr;\n+  if (type2aelembytes(bt) == 8) {\n+    compress_perm_table = StubRoutines::x86::compress_perm_table64();\n+    expand_perm_table  = StubRoutines::x86::expand_perm_table64();\n+    vmovmskpd(rtmp, mask, vec_enc);\n+  } else {\n+    compress_perm_table = StubRoutines::x86::compress_perm_table32();\n+    expand_perm_table = StubRoutines::x86::expand_perm_table32();\n+    vmovmskps(rtmp, mask, vec_enc);\n+  }\n+  shlq(rtmp, 5); \/\/ for 32 byte permute row.\n+  if (opcode == Op_CompressV) {\n+    lea(rscratch, ExternalAddress(compress_perm_table));\n+  } else {\n+    lea(rscratch, ExternalAddress(expand_perm_table));\n+  }\n+  addptr(rtmp, rscratch);\n+  vmovdqu(permv, Address(rtmp));\n+  vpermps(dst, permv, src, Assembler::AVX_256bit);\n+  vpxor(xtmp, xtmp, xtmp, vec_enc);\n+  \/\/ Blend the result with zero vector using permute mask, each column entry\n+  \/\/ in a permute table row contains either a valid permute index or a -1 (default)\n+  \/\/ value, this can potentially be used as a blending mask after\n+  \/\/ compressing\/expanding the source vector lanes.\n+  vblendvps(dst, dst, xtmp, permv, vec_enc, false, permv);\n+}\n+#endif\n+\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.cpp","additions":36,"deletions":0,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -393,0 +393,4 @@\n+\n+  void vector_compress_expand_avx2(int opcode, XMMRegister dst, XMMRegister src, XMMRegister mask,\n+                                   Register rtmp, Register rscratch, XMMRegister permv, XMMRegister xtmp,\n+                                   BasicType bt, int vec_enc);\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.hpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -954,0 +954,86 @@\n+address StubGenerator::generate_compress_perm_table(const char *stub_name, int32_t esize) {\n+  __ align(CodeEntryAlignment);\n+  StubCodeMark mark(this, \"StubRoutines\", stub_name);\n+  address start = __ pc();\n+  if (esize == 32) {\n+    \/\/ Loop to generate 256 x 8 int compression permute index table. A row is\n+    \/\/ accessed using 8 bit index computed using vector mask. An entry in\n+    \/\/ a row holds either a valid permute index corresponding to set bit position\n+    \/\/ or a -1 (default) value.\n+    for (int mask = 0; mask < 256; mask++) {\n+      int ctr = 0;\n+      for (int j = 0; j < 8; j++) {\n+        if (mask & (1 << j)) {\n+          __ emit_data(j, relocInfo::none);\n+          ctr++;\n+        }\n+      }\n+      for (; ctr < 8; ctr++) {\n+        __ emit_data(-1, relocInfo::none);\n+      }\n+    }\n+  } else {\n+    assert(esize == 64, \"\");\n+    \/\/ Loop to generate 16 x 4 long compression permute index table. A row is\n+    \/\/ accessed using 4 bit index computed using vector mask. An entry in\n+    \/\/ a row holds either a valid permute index pair for a quadword corresponding\n+    \/\/ to set bit position or a -1 (default) value.\n+    for (int mask = 0; mask < 16; mask++) {\n+      int ctr = 0;\n+      for (int j = 0; j < 4; j++) {\n+        if (mask & (1 << j)) {\n+          __ emit_data(2 * j, relocInfo::none);\n+          __ emit_data(2 * j + 1, relocInfo::none);\n+          ctr++;\n+        }\n+      }\n+      for (; ctr < 4; ctr++) {\n+        __ emit_data64(-1L, relocInfo::none);\n+      }\n+    }\n+  }\n+  return start;\n+}\n+\n+address StubGenerator::generate_expand_perm_table(const char *stub_name, int32_t esize) {\n+  __ align(CodeEntryAlignment);\n+  StubCodeMark mark(this, \"StubRoutines\", stub_name);\n+  address start = __ pc();\n+  if (esize == 32) {\n+    \/\/ Loop to generate 256 x 8 int expand permute index table. A row is accessed\n+    \/\/ using 8 bit index computed using vector mask. An entry in a row holds either\n+    \/\/ a valid permute index (starting from least significant lane) placed at poisition\n+    \/\/ corresponding to set bit position or a -1 (default) value.\n+    for (int mask = 0; mask < 256; mask++) {\n+      int ctr = 0;\n+      for (int j = 0; j < 8; j++) {\n+        if (mask & (1 << j)) {\n+          __ emit_data(ctr++, relocInfo::none);\n+        } else {\n+          __ emit_data(-1, relocInfo::none);\n+        }\n+      }\n+    }\n+  } else {\n+    assert(esize == 64, \"\");\n+    \/\/ Loop to generate 16 x 4 long expand permute index table. A row is accessed\n+    \/\/ using 4 bit index computed using vector mask. An entry in a row holds either\n+    \/\/ a valid doubleword permute index pair representing a quadword index (starting\n+    \/\/ from least significant lane) placed at poisition corresponding to set bit\n+    \/\/ position or a -1 (default) value.\n+    for (int mask = 0; mask < 16; mask++) {\n+      int ctr = 0;\n+      for (int j = 0; j < 4; j++) {\n+        if (mask & (1 << j)) {\n+          __ emit_data(2 * ctr, relocInfo::none);\n+          __ emit_data(2 * ctr + 1, relocInfo::none);\n+          ctr++;\n+        } else {\n+          __ emit_data64(-1L, relocInfo::none);\n+        }\n+      }\n+    }\n+  }\n+  return start;\n+}\n+\n@@ -4098,0 +4184,7 @@\n+  if (VM_Version::supports_avx2() && !VM_Version::supports_avx512vl()) {\n+    StubRoutines::x86::_compress_perm_table32 = generate_compress_perm_table(\"compress_perm_table32\", 32);\n+    StubRoutines::x86::_compress_perm_table64 = generate_compress_perm_table(\"compress_perm_table64\", 64);\n+    StubRoutines::x86::_expand_perm_table32 = generate_expand_perm_table(\"expand_perm_table32\", 32);\n+    StubRoutines::x86::_expand_perm_table64 = generate_expand_perm_table(\"expand_perm_table64\", 64);\n+  }\n+\n","filename":"src\/hotspot\/cpu\/x86\/stubGenerator_x86_64.cpp","additions":93,"deletions":0,"binary":false,"changes":93,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -102,0 +102,4 @@\n+  address generate_compress_perm_table(const char *stub_name, int32_t esize);\n+\n+  address generate_expand_perm_table(const char *stub_name, int32_t esize);\n+\n","filename":"src\/hotspot\/cpu\/x86\/stubGenerator_x86_64.hpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,0 +85,4 @@\n+address StubRoutines::x86::_compress_perm_table32 = nullptr;\n+address StubRoutines::x86::_compress_perm_table64 = nullptr;\n+address StubRoutines::x86::_expand_perm_table32 = nullptr;\n+address StubRoutines::x86::_expand_perm_table64 = nullptr;\n","filename":"src\/hotspot\/cpu\/x86\/stubRoutines_x86.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,1 +40,1 @@\n-  _compiler_stubs_code_size     = 20000 LP64_ONLY(+32000) WINDOWS_ONLY(+2000),\n+  _compiler_stubs_code_size     = 20000 LP64_ONLY(+39000) WINDOWS_ONLY(+2000),\n@@ -61,0 +61,4 @@\n+  static address _compress_perm_table32;\n+  static address _compress_perm_table64;\n+  static address _expand_perm_table32;\n+  static address _expand_perm_table64;\n@@ -341,0 +345,4 @@\n+  static address compress_perm_table32() { return _compress_perm_table32; }\n+  static address compress_perm_table64() { return _compress_perm_table64; }\n+  static address expand_perm_table32() { return _expand_perm_table32; }\n+  static address expand_perm_table64() { return _expand_perm_table64; }\n","filename":"src\/hotspot\/cpu\/x86\/stubRoutines_x86.hpp","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -47,1 +47,0 @@\n-\n","filename":"src\/hotspot\/cpu\/x86\/stubRoutines_x86_64.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1428,0 +1428,2 @@\n+    case Op_CompressV:\n+    case Op_ExpandV:\n@@ -1662,6 +1664,0 @@\n-    case Op_CompressV:\n-    case Op_ExpandV:\n-      if (!VM_Version::supports_avx512vl()) {\n-        return false;\n-      }\n-      break;\n@@ -1955,1 +1951,1 @@\n-      if (size_in_bits < 128 ) {\n+      if (!is_LP64 && !VM_Version::supports_avx512vl() && size_in_bits < 512) {\n@@ -1958,1 +1954,1 @@\n-      if (size_in_bits < 512 && !VM_Version::supports_avx512vl()) {\n+      if (size_in_bits < 128 ) {\n@@ -1961,1 +1957,0 @@\n-      break;\n@@ -9181,0 +9176,17 @@\n+#ifdef _LP64\n+instruct vcompress_reg_avx(vec dst, vec src, vec mask, rRegI rtmp, rRegL rscratch, vec perm, vec xtmp, rFlagsReg cr) %{\n+  predicate(!VM_Version::supports_avx512vl() && Matcher::vector_length_in_bytes(n) <= 32);\n+  match(Set dst (CompressV src mask));\n+  match(Set dst (ExpandV src mask));\n+  effect(TEMP_DEF dst, TEMP perm, TEMP xtmp, TEMP rtmp, TEMP rscratch, KILL cr);\n+  format %{ \"vector_compress $dst, $src, $mask \\t!using $xtmp, $rtmp, $rscratch and $perm as TEMP\" %}\n+  ins_encode %{\n+    int opcode = this->ideal_Opcode();\n+    int vlen_enc = vector_length_encoding(this);\n+    BasicType bt  = Matcher::vector_element_basic_type(this);\n+    __ vector_compress_expand_avx2(opcode, $dst$$XMMRegister, $src$$XMMRegister, $mask$$XMMRegister, $rtmp$$Register,\n+                                   $rscratch$$Register, $perm$$XMMRegister, $xtmp$$XMMRegister, bt, vlen_enc);\n+  %}\n+  ins_pipe( pipe_slow );\n+%}\n+#endif\n@@ -9183,0 +9195,1 @@\n+  predicate(VM_Version::supports_avx512vl() || Matcher::vector_length_in_bytes(n) == 64);\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":22,"deletions":9,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2005, 2020, Oracle and\/or its affiliates. All rights reserved.\n- * Copyright (c) 2012, 2018 SAP SE. All rights reserved.\n+ * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024 SAP SE. All rights reserved.\n@@ -52,5 +52,6 @@\n-  \/*  to the maximum C Heap consumption we expect.                             *\/   \\\n-  \/*  We need to know this because we need to leave \"breathing space\" for the  *\/   \\\n-  \/*  data segment when placing the java heap. If that space is too small, we  *\/   \\\n-  \/*  reduce our chance of getting a low heap address (needed for compressed   *\/   \\\n-  \/*  Oops).                                                                   *\/   \\\n+  \/*  maximum C Heap consumption we expect.                                    *\/   \\\n+  \/*  We need to leave \"breathing space\" for the data segment when             *\/   \\\n+  \/*  placing the java heap. If the MaxExpectedDataSegmentSize setting         *\/   \\\n+  \/*  is too small, we might run into resource issues creating many native     *\/   \\\n+  \/*  threads, if it is too large, we reduce our chance of getting a low heap  *\/   \\\n+  \/*  address (needed for compressed Oops).                                    *\/   \\\n","filename":"src\/hotspot\/os\/aix\/globals_aix.hpp","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2022, 2023, Oracle and\/or its affiliates. All rights reserved.\n- * Copyright (c) 2012, 2018 SAP SE. All rights reserved.\n+ * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024 SAP SE. All rights reserved.\n@@ -216,6 +216,2 @@\n-      if (-1 == libperfstat::perfstat_cpu_total(nullptr, &psct, sizeof(perfstat_cpu_total_t_61), 1)) {\n-        if (-1 == libperfstat::perfstat_cpu_total(nullptr, &psct, sizeof(perfstat_cpu_total_t_53), 1)) {\n-          trcVerbose(\"perfstat_cpu_total() failed (errno=%d)\", errno);\n-          return false;\n-        }\n-      }\n+      trcVerbose(\"perfstat_cpu_total() failed (errno=%d)\", errno);\n+      return false;\n@@ -255,8 +251,2 @@\n-      if (-1 == libperfstat::perfstat_partition_total(nullptr, &pspt, sizeof(perfstat_partition_total_t_61), 1)) {\n-        if (-1 == libperfstat::perfstat_partition_total(nullptr, &pspt, sizeof(perfstat_partition_total_t_53), 1)) {\n-          if (-1 == libperfstat::perfstat_partition_total(nullptr, &pspt, sizeof(perfstat_partition_total_t_53_5), 1)) {\n-            trcVerbose(\"perfstat_partition_total() failed (errno=%d)\", errno);\n-            return false;\n-          }\n-        }\n-      }\n+      trcVerbose(\"perfstat_partition_total() failed (errno=%d)\", errno);\n+      return false;\n@@ -327,4 +317,2 @@\n-    if (-1 == libperfstat::perfstat_wpar_total(nullptr, &pswt, sizeof(perfstat_wpar_total_t_61), 1)) {\n-      trcVerbose(\"perfstat_wpar_total() failed (errno=%d)\", errno);\n-      return false;\n-    }\n+    trcVerbose(\"perfstat_wpar_total() failed (errno=%d)\", errno);\n+    return false;\n","filename":"src\/hotspot\/os\/aix\/libperfstat_aix.cpp","additions":8,"deletions":20,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2022, 2022, Oracle and\/or its affiliates. All rights reserved.\n- * Copyright (c) 2012, 2018 SAP SE. All rights reserved.\n+ * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024 SAP SE. All rights reserved.\n@@ -41,1 +41,1 @@\n-\/\/ These are excerpts from the AIX 5.3, 6.1, 7.1 libperfstat.h -\n+\/\/ These are excerpts from the AIX 7.1 libperfstat.h -\n@@ -43,8 +43,0 @@\n-\/\/\n-\/\/ Note: I define all structures as if I were to include libperfstat.h on an AIX 5.2\n-\/\/ build machine.\n-\/\/\n-\/\/ The ratio behind that is that if I would build on an AIX 5.2 build machine,\n-\/\/ include libperfstat.h and hard-link against libperfstat.a, the program should\n-\/\/ work without recompilation on all newer AIX versions.\n-\/\/\n@@ -97,163 +89,0 @@\n-typedef struct { \/* global cpu information AIX 5.3 < TL10 *\/\n-  int ncpus;                            \/* number of active logical processors *\/\n-  int ncpus_cfg;                        \/* number of configured processors *\/\n-  char description[IDENTIFIER_LENGTH];  \/* processor description (type\/official name) *\/\n-  u_longlong_t processorHZ;             \/* processor speed in Hz *\/\n-  u_longlong_t user;                    \/* raw total number of clock ticks spent in user mode *\/\n-  u_longlong_t sys;                     \/* raw total number of clock ticks spent in system mode *\/\n-  u_longlong_t idle;                    \/* raw total number of clock ticks spent idle *\/\n-  u_longlong_t wait;                    \/* raw total number of clock ticks spent waiting for I\/O *\/\n-  u_longlong_t pswitch;                 \/* number of process switches (change in currently running process) *\/\n-  u_longlong_t syscall;                 \/* number of system calls executed *\/\n-  u_longlong_t sysread;                 \/* number of read system calls executed *\/\n-  u_longlong_t syswrite;                \/* number of write system calls executed *\/\n-  u_longlong_t sysfork;                 \/* number of forks system calls executed *\/\n-  u_longlong_t sysexec;                 \/* number of execs system calls executed *\/\n-  u_longlong_t readch;                  \/* number of characters transferred with read system call *\/\n-  u_longlong_t writech;                 \/* number of characters transferred with write system call *\/\n-  u_longlong_t devintrs;                \/* number of device interrupts *\/\n-  u_longlong_t softintrs;               \/* number of software interrupts *\/\n-  time_t lbolt;                         \/* number of ticks since last reboot *\/\n-  u_longlong_t loadavg[3];              \/* (1<<SBITS) times the average number of runnables processes during the last 1, 5 and 15 minutes.\n-                                               * To calculate the load average, divide the numbers by (1<<SBITS). SBITS is defined in <sys\/proc.h>. *\/\n-  u_longlong_t runque;                  \/* length of the run queue (processes ready) *\/\n-  u_longlong_t swpque;                  \/* ength of the swap queue (processes waiting to be paged in) *\/\n-  u_longlong_t bread;                   \/* number of blocks read *\/\n-  u_longlong_t bwrite;                  \/* number of blocks written *\/\n-  u_longlong_t lread;                   \/* number of logical read requests *\/\n-  u_longlong_t lwrite;                  \/* number of logical write requests *\/\n-  u_longlong_t phread;                  \/* number of physical reads (reads on raw devices) *\/\n-  u_longlong_t phwrite;                 \/* number of physical writes (writes on raw devices) *\/\n-  u_longlong_t runocc;                  \/* updated whenever runque is updated, i.e. the runqueue is occupied.\n-                                               * This can be used to compute the simple average of ready processes  *\/\n-  u_longlong_t swpocc;                  \/* updated whenever swpque is updated. i.e. the swpqueue is occupied.\n-                                               * This can be used to compute the simple average processes waiting to be paged in *\/\n-  u_longlong_t iget;                    \/* number of inode lookups *\/\n-  u_longlong_t namei;                   \/* number of vnode lookup from a path name *\/\n-  u_longlong_t dirblk;                  \/* number of 512-byte block reads by the directory search routine to locate an entry for a file *\/\n-  u_longlong_t msg;                     \/* number of IPC message operations *\/\n-  u_longlong_t sema;                    \/* number of IPC semaphore operations *\/\n-  u_longlong_t rcvint;                  \/* number of tty receive interrupts *\/\n-  u_longlong_t xmtint;                  \/* number of tyy transmit interrupts *\/\n-  u_longlong_t mdmint;                  \/* number of modem interrupts *\/\n-  u_longlong_t tty_rawinch;             \/* number of raw input characters  *\/\n-  u_longlong_t tty_caninch;             \/* number of canonical input characters (always zero) *\/\n-  u_longlong_t tty_rawoutch;            \/* number of raw output characters *\/\n-  u_longlong_t ksched;                  \/* number of kernel processes created *\/\n-  u_longlong_t koverf;                  \/* kernel process creation attempts where:\n-                                               * -the user has forked to their maximum limit\n-                                               * -the configuration limit of processes has been reached *\/\n-  u_longlong_t kexit;                   \/* number of kernel processes that became zombies *\/\n-  u_longlong_t rbread;                  \/* number of remote read requests *\/\n-  u_longlong_t rcread;                  \/* number of cached remote reads *\/\n-  u_longlong_t rbwrt;                   \/* number of remote writes *\/\n-  u_longlong_t rcwrt;                   \/* number of cached remote writes *\/\n-  u_longlong_t traps;                   \/* number of traps *\/\n-  int ncpus_high;                       \/* index of highest processor online *\/\n-  u_longlong_t puser;                   \/* raw number of physical processor tics in user mode *\/\n-  u_longlong_t psys;                    \/* raw number of physical processor tics in system mode *\/\n-  u_longlong_t pidle;                   \/* raw number of physical processor tics idle *\/\n-  u_longlong_t pwait;                   \/* raw number of physical processor tics waiting for I\/O *\/\n-  u_longlong_t decrintrs;               \/* number of decrementer tics interrupts *\/\n-  u_longlong_t mpcrintrs;               \/* number of mpc's received interrupts *\/\n-  u_longlong_t mpcsintrs;               \/* number of mpc's sent interrupts *\/\n-  u_longlong_t phantintrs;              \/* number of phantom interrupts *\/\n-  u_longlong_t idle_donated_purr;       \/* number of idle cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_donated_spurr;      \/* number of idle spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_purr;       \/* number of busy cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_spurr;      \/* number of busy spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_stolen_purr;        \/* number of idle cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t idle_stolen_spurr;       \/* number of idle spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_purr;        \/* number of busy cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_spurr;       \/* number of busy spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  short iowait;                         \/* number of processes that are asleep waiting for buffered I\/O *\/\n-  short physio;                         \/* number of processes waiting for raw I\/O *\/\n-  longlong_t twait;                     \/* number of threads that are waiting for filesystem direct(cio) *\/\n-  u_longlong_t hpi;                     \/* number of hypervisor page-ins *\/\n-  u_longlong_t hpit;                    \/* Time spent in hypervisor page-ins (in nanoseconds) *\/\n-} perfstat_cpu_total_t_53;\n-\n-typedef struct { \/* global cpu information AIX 6.1|5.3 > TL09 *\/\n-  int ncpus;                            \/* number of active logical processors *\/\n-  int ncpus_cfg;                        \/* number of configured processors *\/\n-  char description[IDENTIFIER_LENGTH];  \/* processor description (type\/official name) *\/\n-  u_longlong_t processorHZ;             \/* processor speed in Hz *\/\n-  u_longlong_t user;                    \/* raw total number of clock ticks spent in user mode *\/\n-  u_longlong_t sys;                     \/* raw total number of clock ticks spent in system mode *\/\n-  u_longlong_t idle;                    \/* raw total number of clock ticks spent idle *\/\n-  u_longlong_t wait;                    \/* raw total number of clock ticks spent waiting for I\/O *\/\n-  u_longlong_t pswitch;                 \/* number of process switches (change in currently running process) *\/\n-  u_longlong_t syscall;                 \/* number of system calls executed *\/\n-  u_longlong_t sysread;                 \/* number of read system calls executed *\/\n-  u_longlong_t syswrite;                \/* number of write system calls executed *\/\n-  u_longlong_t sysfork;                 \/* number of forks system calls executed *\/\n-  u_longlong_t sysexec;                 \/* number of execs system calls executed *\/\n-  u_longlong_t readch;                  \/* number of characters transferred with read system call *\/\n-  u_longlong_t writech;                 \/* number of characters transferred with write system call *\/\n-  u_longlong_t devintrs;                \/* number of device interrupts *\/\n-  u_longlong_t softintrs;               \/* number of software interrupts *\/\n-  time_t lbolt;                         \/* number of ticks since last reboot *\/\n-  u_longlong_t loadavg[3];              \/* (1<<SBITS) times the average number of runnables processes during the last 1, 5 and 15 minutes.\n-                                               * To calculate the load average, divide the numbers by (1<<SBITS). SBITS is defined in <sys\/proc.h>. *\/\n-  u_longlong_t runque;                  \/* length of the run queue (processes ready) *\/\n-  u_longlong_t swpque;                  \/* length of the swap queue (processes waiting to be paged in) *\/\n-  u_longlong_t bread;                   \/* number of blocks read *\/\n-  u_longlong_t bwrite;                  \/* number of blocks written *\/\n-  u_longlong_t lread;                   \/* number of logical read requests *\/\n-  u_longlong_t lwrite;                  \/* number of logical write requests *\/\n-  u_longlong_t phread;                  \/* number of physical reads (reads on raw devices) *\/\n-  u_longlong_t phwrite;                 \/* number of physical writes (writes on raw devices) *\/\n-  u_longlong_t runocc;                  \/* updated whenever runque is updated, i.e. the runqueue is occupied.\n-                                               * This can be used to compute the simple average of ready processes  *\/\n-  u_longlong_t swpocc;                  \/* updated whenever swpque is updated. i.e. the swpqueue is occupied.\n-                                               * This can be used to compute the simple average processes waiting to be paged in *\/\n-  u_longlong_t iget;                    \/* number of inode lookups *\/\n-  u_longlong_t namei;                   \/* number of vnode lookup from a path name *\/\n-  u_longlong_t dirblk;                  \/* number of 512-byte block reads by the directory search routine to locate an entry for a file *\/\n-  u_longlong_t msg;                     \/* number of IPC message operations *\/\n-  u_longlong_t sema;                    \/* number of IPC semaphore operations *\/\n-  u_longlong_t rcvint;                  \/* number of tty receive interrupts *\/\n-  u_longlong_t xmtint;                  \/* number of tyy transmit interrupts *\/\n-  u_longlong_t mdmint;                  \/* number of modem interrupts *\/\n-  u_longlong_t tty_rawinch;             \/* number of raw input characters  *\/\n-  u_longlong_t tty_caninch;             \/* number of canonical input characters (always zero) *\/\n-  u_longlong_t tty_rawoutch;            \/* number of raw output characters *\/\n-  u_longlong_t ksched;                  \/* number of kernel processes created *\/\n-  u_longlong_t koverf;                  \/* kernel process creation attempts where:\n-                                               * -the user has forked to their maximum limit\n-                                               * -the configuration limit of processes has been reached *\/\n-  u_longlong_t kexit;                   \/* number of kernel processes that became zombies *\/\n-  u_longlong_t rbread;                  \/* number of remote read requests *\/\n-  u_longlong_t rcread;                  \/* number of cached remote reads *\/\n-  u_longlong_t rbwrt;                   \/* number of remote writes *\/\n-  u_longlong_t rcwrt;                   \/* number of cached remote writes *\/\n-  u_longlong_t traps;                   \/* number of traps *\/\n-  int ncpus_high;                       \/* index of highest processor online *\/\n-  u_longlong_t puser;                   \/* raw number of physical processor tics in user mode *\/\n-  u_longlong_t psys;                    \/* raw number of physical processor tics in system mode *\/\n-  u_longlong_t pidle;                   \/* raw number of physical processor tics idle *\/\n-  u_longlong_t pwait;                   \/* raw number of physical processor tics waiting for I\/O *\/\n-  u_longlong_t decrintrs;               \/* number of decrementer tics interrupts *\/\n-  u_longlong_t mpcrintrs;               \/* number of mpc's received interrupts *\/\n-  u_longlong_t mpcsintrs;               \/* number of mpc's sent interrupts *\/\n-  u_longlong_t phantintrs;              \/* number of phantom interrupts *\/\n-  u_longlong_t idle_donated_purr;       \/* number of idle cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_donated_spurr;      \/* number of idle spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_purr;       \/* number of busy cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_spurr;      \/* number of busy spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_stolen_purr;        \/* number of idle cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t idle_stolen_spurr;       \/* number of idle spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_purr;        \/* number of busy cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_spurr;       \/* number of busy spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  short iowait;                         \/* number of processes that are asleep waiting for buffered I\/O *\/\n-  short physio;                         \/* number of processes waiting for raw I\/O *\/\n-  longlong_t twait;                     \/* number of threads that are waiting for filesystem direct(cio) *\/\n-  u_longlong_t hpi;                     \/* number of hypervisor page-ins *\/\n-  u_longlong_t hpit;                    \/* Time spent in hypervisor page-ins (in nanoseconds) *\/\n-  u_longlong_t puser_spurr;             \/* number of spurr cycles spent in user mode *\/\n-  u_longlong_t psys_spurr;              \/* number of spurr cycles spent in kernel mode *\/\n-  u_longlong_t pidle_spurr;             \/* number of spurr cycles spent in idle mode *\/\n-  u_longlong_t pwait_spurr;             \/* number of spurr cycles spent in wait mode *\/\n-  int spurrflag;                        \/* set if running in spurr mode *\/\n-} perfstat_cpu_total_t_61;\n-\n@@ -567,160 +396,0 @@\n-typedef struct { \/* partition total information AIX 5.3 < TL6 *\/\n-  char name[IDENTIFIER_LENGTH];         \/* name of the logical partition *\/\n-  perfstat_partition_type_t type;       \/* set of bits describing the partition *\/\n-  int lpar_id;                          \/* logical partition identifier *\/\n-  int group_id;                         \/* identifier of the LPAR group this partition is a member of *\/\n-  int pool_id;                          \/* identifier of the shared pool of physical processors this partition is a member of *\/\n-  int online_cpus;                      \/* number of virtual CPUs currently online on the partition *\/\n-  int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n-  int min_cpus;                         \/* minimum number of virtual CPUs this partition must have *\/\n-  u_longlong_t online_memory;           \/* amount of memory currently online *\/\n-  u_longlong_t max_memory;              \/* maximum amount of memory this partition can ever have *\/\n-  u_longlong_t min_memory;              \/* minimum amount of memory this partition must have *\/\n-  int entitled_proc_capacity;           \/* number of processor units this partition is entitled to receive *\/\n-  int max_proc_capacity;                \/* maximum number of processor units this partition can ever have *\/\n-  int min_proc_capacity;                \/* minimum number of processor units this partition must have *\/\n-  int proc_capacity_increment;          \/* increment value to the entitled capacity *\/\n-  int unalloc_proc_capacity;            \/* number of processor units currently unallocated in the shared processor pool this partition belongs to *\/\n-  int var_proc_capacity_weight;         \/* partition priority weight to receive extra capacity *\/\n-  int unalloc_var_proc_capacity_weight; \/* number of variable processor capacity weight units currently unallocated  in the shared processor pool this partition belongs to *\/\n-  int online_phys_cpus_sys;             \/* number of physical CPUs currently active in the system containing this partition *\/\n-  int max_phys_cpus_sys;                \/* maximum possible number of physical CPUs in the system containing this partition *\/\n-  int phys_cpus_pool;                   \/* number of the physical CPUs currently in the shared processor pool this partition belong to *\/\n-  u_longlong_t puser;                   \/* raw number of physical processor tics in user mode *\/\n-  u_longlong_t psys;                    \/* raw number of physical processor tics in system mode *\/\n-  u_longlong_t pidle;                   \/* raw number of physical processor tics idle *\/\n-  u_longlong_t pwait;                   \/* raw number of physical processor tics waiting for I\/O *\/\n-  u_longlong_t pool_idle_time;          \/* number of clock tics a processor in the shared pool was idle *\/\n-  u_longlong_t phantintrs;              \/* number of phantom interrupts received by the partition *\/\n-  u_longlong_t invol_virt_cswitch;      \/* number involuntary virtual CPU context switches *\/\n-  u_longlong_t vol_virt_cswitch;        \/* number voluntary virtual CPU context switches *\/\n-  u_longlong_t timebase_last;           \/* most recently cpu time base *\/\n-  u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n-  u_longlong_t reserved_pagesize;       \/* Currently 16GB pagesize Cannot participate in DR operations *\/\n-} perfstat_partition_total_t_53_5;\n-\n-typedef struct { \/* partition total information AIX 5.3 < TL10 *\/\n-  char name[IDENTIFIER_LENGTH];         \/* name of the logical partition *\/\n-  perfstat_partition_type_t type;       \/* set of bits describing the partition *\/\n-  int lpar_id;                          \/* logical partition identifier *\/\n-  int group_id;                         \/* identifier of the LPAR group this partition is a member of *\/\n-  int pool_id;                          \/* identifier of the shared pool of physical processors this partition is a member of *\/\n-  int online_cpus;                      \/* number of virtual CPUs currently online on the partition *\/\n-  int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n-  int min_cpus;                         \/* minimum number of virtual CPUs this partition must have *\/\n-  u_longlong_t online_memory;           \/* amount of memory currently online *\/\n-  u_longlong_t max_memory;              \/* maximum amount of memory this partition can ever have *\/\n-  u_longlong_t min_memory;              \/* minimum amount of memory this partition must have *\/\n-  int entitled_proc_capacity;           \/* number of processor units this partition is entitled to receive *\/\n-  int max_proc_capacity;                \/* maximum number of processor units this partition can ever have *\/\n-  int min_proc_capacity;                \/* minimum number of processor units this partition must have *\/\n-  int proc_capacity_increment;          \/* increment value to the entitled capacity *\/\n-  int unalloc_proc_capacity;            \/* number of processor units currently unallocated in the shared processor pool this partition belongs to *\/\n-  int var_proc_capacity_weight;         \/* partition priority weight to receive extra capacity *\/\n-  int unalloc_var_proc_capacity_weight; \/* number of variable processor capacity weight units currently unallocated  in the shared processor pool this partition belongs to *\/\n-  int online_phys_cpus_sys;             \/* number of physical CPUs currently active in the system containing this partition *\/\n-  int max_phys_cpus_sys;                \/* maximum possible number of physical CPUs in the system containing this partition *\/\n-  int phys_cpus_pool;                   \/* number of the physical CPUs currently in the shared processor pool this partition belong to *\/\n-  u_longlong_t puser;                   \/* raw number of physical processor tics in user mode *\/\n-  u_longlong_t psys;                    \/* raw number of physical processor tics in system mode *\/\n-  u_longlong_t pidle;                   \/* raw number of physical processor tics idle *\/\n-  u_longlong_t pwait;                   \/* raw number of physical processor tics waiting for I\/O *\/\n-  u_longlong_t pool_idle_time;          \/* number of clock tics a processor in the shared pool was idle *\/\n-  u_longlong_t phantintrs;              \/* number of phantom interrupts received by the partition *\/\n-  u_longlong_t invol_virt_cswitch;      \/* number involuntary virtual CPU context switches *\/\n-  u_longlong_t vol_virt_cswitch;        \/* number voluntary virtual CPU context switches *\/\n-  u_longlong_t timebase_last;           \/* most recently cpu time base *\/\n-  u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n-  u_longlong_t reserved_pagesize;       \/* Currently 16GB pagesize Cannot participate in DR operations *\/\n-  u_longlong_t idle_donated_purr;       \/* number of idle cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_donated_spurr;      \/* number of idle spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_purr;       \/* number of busy cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_spurr;      \/* number of busy spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_stolen_purr;        \/* number of idle cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t idle_stolen_spurr;       \/* number of idle spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_purr;        \/* number of busy cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_spurr;       \/* number of busy spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t shcpus_in_sys;           \/* Number of physical processors allocated for shared processor use *\/\n-  u_longlong_t max_pool_capacity;       \/* Maximum processor capacity of partitions pool *\/\n-  u_longlong_t entitled_pool_capacity;  \/* Entitled processor capacity of partitions pool *\/\n-  u_longlong_t pool_max_time;           \/* Summation of maximum time that could be consumed by the pool (nano seconds) *\/\n-  u_longlong_t pool_busy_time;          \/* Summation of busy (non-idle) time accumulated across all partitions in the pool (nano seconds) *\/\n-  u_longlong_t pool_scaled_busy_time;   \/* Scaled summation of busy (non-idle) time accumulated across all partitions in the pool (nano seconds) *\/\n-  u_longlong_t shcpu_tot_time;          \/* Summation of total time across all physical processors allocated for shared processor use (nano seconds) *\/\n-  u_longlong_t shcpu_busy_time;         \/* Summation of busy (non-idle) time accumulated across all shared processor partitions (nano seconds) *\/\n-  u_longlong_t shcpu_scaled_busy_time;  \/* Scaled summation of busy time accumulated across all shared processor partitions (nano seconds) *\/\n-  int ams_pool_id;                      \/* AMS pool id of the pool the LPAR belongs to *\/\n-  int var_mem_weight;                   \/* variable memory capacity weight *\/\n-  u_longlong_t iome;                    \/* I\/O memory entitlement of the partition in bytes*\/\n-  u_longlong_t pmem;                    \/* Physical memory currently backing the partition's logical memory in bytes*\/\n-  u_longlong_t hpi;                     \/* number of hypervisor page-ins *\/\n-  u_longlong_t hpit;                    \/* Time spent in hypervisor page-ins (in nanoseconds)*\/\n-  u_longlong_t hypv_pagesize;           \/* Hypervisor page size in KB*\/\n-} perfstat_partition_total_t_53;\n-\n-typedef struct { \/* partition total information AIX 6.1|5.3 > TL09 *\/\n-  char name[IDENTIFIER_LENGTH];         \/* name of the logical partition *\/\n-  perfstat_partition_type_t type;       \/* set of bits describing the partition *\/\n-  int lpar_id;                          \/* logical partition identifier *\/\n-  int group_id;                         \/* identifier of the LPAR group this partition is a member of *\/\n-  int pool_id;                          \/* identifier of the shared pool of physical processors this partition is a member of *\/\n-  int online_cpus;                      \/* number of virtual CPUs currently online on the partition *\/\n-  int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n-  int min_cpus;                         \/* minimum number of virtual CPUs this partition must have *\/\n-  u_longlong_t online_memory;           \/* amount of memory currently online *\/\n-  u_longlong_t max_memory;              \/* maximum amount of memory this partition can ever have *\/\n-  u_longlong_t min_memory;              \/* minimum amount of memory this partition must have *\/\n-  int entitled_proc_capacity;           \/* number of processor units this partition is entitled to receive *\/\n-  int max_proc_capacity;                \/* maximum number of processor units this partition can ever have *\/\n-  int min_proc_capacity;                \/* minimum number of processor units this partition must have *\/\n-  int proc_capacity_increment;          \/* increment value to the entitled capacity *\/\n-  int unalloc_proc_capacity;            \/* number of processor units currently unallocated in the shared processor pool this partition belongs to *\/\n-  int var_proc_capacity_weight;         \/* partition priority weight to receive extra capacity *\/\n-  int unalloc_var_proc_capacity_weight; \/* number of variable processor capacity weight units currently unallocated  in the shared processor pool this partition belongs to *\/\n-  int online_phys_cpus_sys;             \/* number of physical CPUs currently active in the system containing this partition *\/\n-  int max_phys_cpus_sys;                \/* maximum possible number of physical CPUs in the system containing this partition *\/\n-  int phys_cpus_pool;                   \/* number of the physical CPUs currently in the shared processor pool this partition belong to *\/\n-  u_longlong_t puser;                   \/* raw number of physical processor tics in user mode *\/\n-  u_longlong_t psys;                    \/* raw number of physical processor tics in system mode *\/\n-  u_longlong_t pidle;                   \/* raw number of physical processor tics idle *\/\n-  u_longlong_t pwait;                   \/* raw number of physical processor tics waiting for I\/O *\/\n-  u_longlong_t pool_idle_time;          \/* number of clock tics a processor in the shared pool was idle *\/\n-  u_longlong_t phantintrs;              \/* number of phantom interrupts received by the partition *\/\n-  u_longlong_t invol_virt_cswitch;      \/* number involuntary virtual CPU context switches *\/\n-  u_longlong_t vol_virt_cswitch;        \/* number voluntary virtual CPU context switches *\/\n-  u_longlong_t timebase_last;           \/* most recently cpu time base *\/\n-  u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n-  u_longlong_t reserved_pagesize;       \/* Currently 16GB pagesize Cannot participate in DR operations *\/\n-  u_longlong_t idle_donated_purr;       \/* number of idle cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_donated_spurr;      \/* number of idle spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_purr;       \/* number of busy cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t busy_donated_spurr;      \/* number of busy spurr cycles donated by a dedicated partition enabled for donation *\/\n-  u_longlong_t idle_stolen_purr;        \/* number of idle cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t idle_stolen_spurr;       \/* number of idle spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_purr;        \/* number of busy cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t busy_stolen_spurr;       \/* number of busy spurr cycles stolen by the hypervisor from a dedicated partition *\/\n-  u_longlong_t shcpus_in_sys;           \/* Number of physical processors allocated for shared processor use *\/\n-  u_longlong_t max_pool_capacity;       \/* Maximum processor capacity of partitions pool *\/\n-  u_longlong_t entitled_pool_capacity;  \/* Entitled processor capacity of partitions pool *\/\n-  u_longlong_t pool_max_time;           \/* Summation of maximum time that could be consumed by the pool (nano seconds) *\/\n-  u_longlong_t pool_busy_time;          \/* Summation of busy (non-idle) time accumulated across all partitions in the pool (nano seconds) *\/\n-  u_longlong_t pool_scaled_busy_time;   \/* Scaled summation of busy (non-idle) time accumulated across all partitions in the pool (nano seconds) *\/\n-  u_longlong_t shcpu_tot_time;          \/* Summation of total time across all physical processors allocated for shared processor use (nano seconds) *\/\n-  u_longlong_t shcpu_busy_time;         \/* Summation of busy (non-idle) time accumulated across all shared processor partitions (nano seconds) *\/\n-  u_longlong_t shcpu_scaled_busy_time;  \/* Scaled summation of busy time accumulated across all shared processor partitions (nano seconds) *\/\n-  int ams_pool_id;                      \/* AMS pool id of the pool the LPAR belongs to *\/\n-  int var_mem_weight;                   \/* variable memory capacity weight *\/\n-  u_longlong_t iome;                    \/* I\/O memory entitlement of the partition in bytes*\/\n-  u_longlong_t pmem;                    \/* Physical memory currently backing the partition's logical memory in bytes*\/\n-  u_longlong_t hpi;                     \/* number of hypervisor page-ins *\/\n-  u_longlong_t hpit;                    \/* Time spent in hypervisor page-ins (in nanoseconds)*\/\n-  u_longlong_t hypv_pagesize;           \/* Hypervisor page size in KB*\/\n-  uint online_lcpus;                    \/* number of online logical cpus *\/\n-  uint smt_thrds;                       \/* number of hardware threads that are running *\/\n-  u_longlong_t puser_spurr;             \/* number of spurr cycles spent in user mode *\/\n-  u_longlong_t psys_spurr;              \/* number of spurr cycles spent in kernel mode *\/\n-  u_longlong_t pidle_spurr;             \/* number of spurr cycles spent in idle mode *\/\n-  u_longlong_t pwait_spurr;             \/* number of spurr cycles spent in wait mode *\/\n-  int spurrflag;                        \/* set if running in spurr mode *\/\n-} perfstat_partition_total_t_61;\n-\n@@ -944,11 +613,0 @@\n-typedef struct { \/* Workload partition Information AIX 5.3 & 6.1*\/\n-       char name[MAXCORRALNAMELEN+1]; \/* name of the Workload Partition *\/\n-       perfstat_wpar_type_t type;     \/* set of bits describing the wpar *\/\n-       cid_t wpar_id;                 \/* workload partition identifier *\/\n-       uint  online_cpus;             \/* Number of Virtual CPUs in partition rset or  number of virtual CPUs currently online on the Global partition*\/\n-       int   cpu_limit;               \/* CPU limit in 100ths of % - 1..10000 *\/\n-       int   mem_limit;               \/* Memory limit in 100ths of % - 1..10000 *\/\n-       u_longlong_t online_memory;    \/* amount of memory currently online in Global Partition *\/\n-       int entitled_proc_capacity;    \/* number of processor units this partition is entitled to receive *\/\n-} perfstat_wpar_total_t_61;\n-\n@@ -986,1 +644,1 @@\n-\/\/ end: libperfstat.h (AIX 5.2, 5.3, 6.1, 7.1)\n+\/\/ end: libperfstat.h (AIX 7.1)\n","filename":"src\/hotspot\/os\/aix\/libperfstat_aix.hpp","additions":4,"deletions":346,"binary":false,"changes":350,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1587,1 +1587,1 @@\n-  \/\/ which invokes this function with a request address != NULL - is to map at the specified address\n+  \/\/ which invokes this function with a request address != nullptr - is to map at the specified address\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -988,0 +988,7 @@\n+    if (CheckJNICalls) {\n+      tty->print_cr(\"WARNING: IEEE subnormal handling check failed before loading %s\", filename);\n+      Thread* current = Thread::current();\n+      if (current->is_Java_thread()) {\n+        JavaThread::cast(current)->print_jni_stack();\n+      }\n+    }\n@@ -1041,0 +1048,7 @@\n+        if (CheckJNICalls) {\n+          tty->print_cr(\"WARNING: IEEE subnormal handling could not be corrected after loading %s\", filename);\n+          Thread* current = Thread::current();\n+          if (current->is_Java_thread()) {\n+            JavaThread::cast(current)->print_jni_stack();\n+          }\n+        }\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -187,0 +187,2 @@\n+  static_assert(sizeof(off_t) == 8, \"Expected Large File Support in this file\");\n+\n@@ -449,1 +451,1 @@\n-  struct stat64 st;\n+  struct stat st;\n@@ -456,1 +458,1 @@\n-  RESTARTABLE(::stat64(fn, &st), ret);\n+  RESTARTABLE(::stat(fn, &st), ret);\n@@ -476,2 +478,2 @@\n-  struct stat64 st;\n-  ret = stat64(LinuxAttachListener::path(), &st);\n+  struct stat st;\n+  ret = stat(LinuxAttachListener::path(), &st);\n@@ -516,1 +518,1 @@\n-  struct stat64 st;\n+  struct stat st;\n@@ -518,1 +520,1 @@\n-  RESTARTABLE(::stat64(fn, &st), ret);\n+  RESTARTABLE(::stat(fn, &st), ret);\n@@ -523,1 +525,1 @@\n-    RESTARTABLE(::stat64(fn, &st), ret);\n+    RESTARTABLE(::stat(fn, &st), ret);\n","filename":"src\/hotspot\/os\/linux\/attachListener_linux.cpp","additions":10,"deletions":8,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -1816,0 +1816,7 @@\n+    if (CheckJNICalls) {\n+      tty->print_cr(\"WARNING: IEEE subnormal handling check failed before loading %s\", filename);\n+      Thread* current = Thread::current();\n+      if (current->is_Java_thread()) {\n+        JavaThread::cast(current)->print_jni_stack();\n+      }\n+    }\n@@ -1870,0 +1877,7 @@\n+        if (CheckJNICalls) {\n+          tty->print_cr(\"WARNING: IEEE subnormal handling could not be corrected after loading %s\", filename);\n+          Thread* current = Thread::current();\n+          if (current->is_Java_thread()) {\n+            JavaThread::cast(current)->print_jni_stack();\n+          }\n+        }\n@@ -2761,0 +2775,2 @@\n+  static_assert(sizeof(off_t) == 8, \"Expected Large File Support in this file\");\n+\n@@ -4123,1 +4139,1 @@\n-  \/\/ NULL pointer dereferences.\n+  \/\/ null pointer dereferences.\n@@ -4251,1 +4267,1 @@\n-  return ::sendfile64(out_fd, in_fd, (off64_t*)offset, (size_t)count);\n+  return ::sendfile(out_fd, in_fd, (off_t*)offset, (size_t)count);\n@@ -4929,1 +4945,1 @@\n-  int fd = ::open64(path, oflag, mode);\n+  int fd = ::open(path, oflag, mode);\n@@ -4934,3 +4950,3 @@\n-    struct stat64 buf64;\n-    int ret = ::fstat64(fd, &buf64);\n-    int st_mode = buf64.st_mode;\n+    struct stat buf;\n+    int ret = ::fstat(fd, &buf);\n+    int st_mode = buf.st_mode;\n@@ -4973,1 +4989,1 @@\n-  return ::open64(path, oflags, S_IREAD | S_IWRITE);\n+  return ::open(path, oflags, S_IREAD | S_IWRITE);\n@@ -4978,1 +4994,1 @@\n-  return (jlong)::lseek64(fd, (off64_t)0, SEEK_CUR);\n+  return (jlong)::lseek(fd, (off_t)0, SEEK_CUR);\n@@ -4983,1 +4999,1 @@\n-  return (jlong)::lseek64(fd, (off64_t)offset, SEEK_SET);\n+  return (jlong)::lseek(fd, (off_t)offset, SEEK_SET);\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":25,"deletions":9,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -290,0 +290,1 @@\n+  static_assert(sizeof(off_t) == 8, \"Expected Large File Support in this file\");\n@@ -755,1 +756,1 @@\n-  return (jlong) BSD_ONLY(::lseek) NOT_BSD(::lseek64)(fd, offset, whence);\n+  return (jlong) ::lseek(fd, offset, whence);\n@@ -759,1 +760,1 @@\n-   return BSD_ONLY(::ftruncate) NOT_BSD(::ftruncate64)(fd, length);\n+   return ::ftruncate(fd, length);\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-\/\/ non-Posix functionality. For example, the use of lseek64 and ftruncate64.\n+\/\/ non-Posix functionality.\n","filename":"src\/hotspot\/os\/posix\/os_posix.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -251,1 +251,2 @@\n-    guarantee(res == WAIT_OBJECT_0, \"wait failed\");\n+    guarantee(res != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+    guarantee(res == WAIT_OBJECT_0, \"WaitForSingleObject failed with return value: %lu\", res);\n@@ -254,1 +255,3 @@\n-    guarantee(res == WAIT_OBJECT_0, \"wait failed\");\n+    guarantee(res != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+    guarantee(res == WAIT_OBJECT_0, \"WaitForSingleObject failed with return value: %lu\", res);\n+\n@@ -341,0 +344,3 @@\n+  assert(res != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+  assert(res == WAIT_OBJECT_0, \"WaitForSingleObject failed with return value: %lu\", res);\n+\n","filename":"src\/hotspot\/os\/windows\/attachListener_windows.cpp","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -5357,1 +5357,2 @@\n-    assert(rv == WAIT_OBJECT_0 || rv == WAIT_TIMEOUT, \"WaitForSingleObject failed\");\n+    assert(rv != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+    assert(rv == WAIT_OBJECT_0 || rv == WAIT_TIMEOUT, \"WaitForSingleObject failed with return value: %lu\", rv);\n@@ -5396,1 +5397,2 @@\n-    assert(rv == WAIT_OBJECT_0, \"WaitForSingleObject failed\");\n+    assert(rv != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+    assert(rv == WAIT_OBJECT_0, \"WaitForSingleObject failed with return value: %lu\", rv);\n@@ -5459,2 +5461,1 @@\n-  if (thread->is_interrupted(false) ||\n-      WaitForSingleObject(_ParkHandle, 0) == WAIT_OBJECT_0) {\n+  if (thread->is_interrupted(false)) {\n@@ -5464,2 +5465,9 @@\n-    ThreadBlockInVM tbivm(thread);\n-    OSThreadWaitState osts(thread->osthread(), false \/* not Object.wait() *\/);\n+    DWORD rv = WaitForSingleObject(_ParkHandle, 0);\n+    assert(rv != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+    assert(rv == WAIT_OBJECT_0 || rv == WAIT_TIMEOUT, \"WaitForSingleObject failed with return value: %lu\", rv);\n+    if (rv == WAIT_OBJECT_0) {\n+      ResetEvent(_ParkHandle);\n+      return;\n+    } else {\n+      ThreadBlockInVM tbivm(thread);\n+      OSThreadWaitState osts(thread->osthread(), false \/* not Object.wait() *\/);\n@@ -5467,2 +5475,5 @@\n-    WaitForSingleObject(_ParkHandle, time);\n-    ResetEvent(_ParkHandle);\n+      rv = WaitForSingleObject(_ParkHandle, time);\n+      assert(rv != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+      assert(rv == WAIT_OBJECT_0 || rv == WAIT_TIMEOUT, \"WaitForSingleObject failed with return value: %lu\", rv);\n+      ResetEvent(_ParkHandle);\n+    }\n@@ -5544,1 +5555,3 @@\n-    WaitForSingleObject(pi.hProcess, INFINITE);\n+    DWORD rv = WaitForSingleObject(pi.hProcess, INFINITE);\n+    assert(rv != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+    assert(rv == WAIT_OBJECT_0, \"WaitForSingleObject failed with return value: %lu\", rv);\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":23,"deletions":10,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,2 @@\n-    assert(ret == WAIT_OBJECT_0, \"unexpected return value from WaitForSingleObject\");\n+    assert(ret != WAIT_FAILED,   \"WaitForSingleObject failed with error code: %lu\", GetLastError());\n+    assert(ret == WAIT_OBJECT_0, \"WaitForSingleObject failed with return value: %lu\", ret);\n","filename":"src\/hotspot\/os\/windows\/threadCritical_windows.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -52,0 +52,1 @@\n+#define   RISCV_HWPROBE_EXT_ZFH                 (1 << 27)\n@@ -148,0 +149,3 @@\n+  if (is_set(RISCV_HWPROBE_KEY_IMA_EXT_0, RISCV_HWPROBE_EXT_ZFH)) {\n+    VM_Version::ext_Zfh.enable_feature();\n+  }\n","filename":"src\/hotspot\/os_cpu\/linux_riscv\/riscv_hwprobe.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -172,1 +172,1 @@\n-  if (!strcmp(vm_mode, \"sv39\")) {\n+  if (!strncmp(vm_mode, \"sv39\", sizeof \"sv39\" - 1)) {\n@@ -174,1 +174,1 @@\n-  } else if (!strcmp(vm_mode, \"sv48\")) {\n+  } else if (!strncmp(vm_mode, \"sv48\", sizeof \"sv48\" - 1)) {\n@@ -176,1 +176,1 @@\n-  } else if (!strcmp(vm_mode, \"sv57\")) {\n+  } else if (!strncmp(vm_mode, \"sv57\", sizeof \"sv57\" - 1)) {\n@@ -178,1 +178,1 @@\n-  } else if (!strcmp(vm_mode, \"sv64\")) {\n+  } else if (!strncmp(vm_mode, \"sv64\", sizeof \"sv64\" - 1)) {\n@@ -200,1 +200,1 @@\n-          mode = VM_Version::parse_satp_mode(p);\n+          mode = VM_Version::parse_satp_mode(p + 2);\n","filename":"src\/hotspot\/os_cpu\/linux_riscv\/vm_version_linux_riscv.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2161,1 +2161,1 @@\n-    if (bitmap_base == NULL) {\n+    if (bitmap_base == nullptr) {\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -841,4 +841,4 @@\n-  oop* ptr = h.ptr_raw();\n-  if (ptr != nullptr) {\n-    assert(_handles.owner_of(ptr), \"Got unexpected handle \" PTR_FORMAT, p2i(ptr));\n-    NativeAccess<>::oop_store(ptr, oop(nullptr));\n+  if (!h.is_empty()) {\n+    assert(_handles.owner_of(h.ptr_raw()),\n+           \"Got unexpected handle \" PTR_FORMAT, p2i(h.ptr_raw()));\n+    h.replace(oop(nullptr));\n@@ -1006,1 +1006,5 @@\n-  out->print_cr(\" - class loader        \" INTPTR_FORMAT, p2i(_class_loader.ptr_raw()));\n+  if (!_unloading) {\n+    out->print_cr(\" - class loader        \" INTPTR_FORMAT, p2i(_class_loader.peek()));\n+  } else {\n+    out->print_cr(\" - class loader        <unloading, oop is bad>\");\n+  }\n","filename":"src\/hotspot\/share\/classfile\/classLoaderData.cpp","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -390,1 +390,1 @@\n-    pp1->extend_loader_constraint(class_name, loader1, klass);\n+    pp1->extend_loader_constraint(class_name, loader2, klass);\n","filename":"src\/hotspot\/share\/classfile\/loaderConstraints.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -599,2 +599,2 @@\n-  do_intrinsic(_notifyJvmtiVThreadHideFrames, java_lang_VirtualThread, notifyJvmtiHideFrames_name, bool_void_signature, F_RN) \\\n-  do_intrinsic(_notifyJvmtiVThreadDisableSuspend, java_lang_VirtualThread, notifyJvmtiDisableSuspend_name, bool_void_signature, F_RN) \\\n+  do_intrinsic(_notifyJvmtiVThreadHideFrames, java_lang_VirtualThread, notifyJvmtiHideFrames_name, bool_void_signature, F_SN) \\\n+  do_intrinsic(_notifyJvmtiVThreadDisableSuspend, java_lang_VirtualThread, notifyJvmtiDisableSuspend_name, bool_void_signature, F_SN) \\\n","filename":"src\/hotspot\/share\/classfile\/vmIntrinsics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -239,1 +239,1 @@\n-void CodeBlob::print_code() {\n+void CodeBlob::print_code_on(outputStream* st) {\n@@ -241,1 +241,1 @@\n-  Disassembler::decode(this, tty);\n+  Disassembler::decode(this, st);\n","filename":"src\/hotspot\/share\/code\/codeBlob.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -243,1 +243,1 @@\n-  void print_code();\n+  void print_code_on(outputStream* st);\n","filename":"src\/hotspot\/share\/code\/codeBlob.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -690,6 +690,9 @@\n-    ttyLocker ttyl;\n-    tty->print_cr(\"implicit exception happened at \" INTPTR_FORMAT, p2i(pc));\n-    print();\n-    method()->print_codes();\n-    print_code();\n-    print_pcs();\n+\n+    \/\/ Keep tty output consistent. To avoid ttyLocker, we buffer in stream, and print all at once.\n+    stringStream ss;\n+    ss.print_cr(\"implicit exception happened at \" INTPTR_FORMAT, p2i(pc));\n+    print_on(&ss);\n+    method()->print_codes_on(&ss);\n+    print_code_on(&ss);\n+    print_pcs_on(&ss);\n+    tty->print(\"%s\", ss.as_string()); \/\/ print all at once\n","filename":"src\/hotspot\/share\/code\/compiledMethod.cpp","additions":10,"deletions":7,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -230,1 +230,1 @@\n-  virtual void print_pcs() = 0;\n+  virtual void print_pcs_on(outputStream* st) = 0;\n","filename":"src\/hotspot\/share\/code\/compiledMethod.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1024,1 +1024,1 @@\n-      print_pcs();\n+      print_pcs_on(tty);\n","filename":"src\/hotspot\/share\/code\/nmethod.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -624,1 +624,0 @@\n-  void print_pcs() { print_pcs_on(tty); }\n@@ -638,2 +637,1 @@\n-  \/\/ void print_pcs()                             PRODUCT_RETURN;\n-  void print_pcs()                                { return; }\n+  void print_pcs_on(outputStream* st) { return; }\n","filename":"src\/hotspot\/share\/code\/nmethod.hpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -146,5 +146,0 @@\n-  \/\/ Round to next 8 byte boundary for array to maximize space usage.\n-  size_t const cur_size = G1CardSetArray::size_in_bytes(G1RemSetArrayOfCardsEntries);\n-  FLAG_SET_ERGO(G1RemSetArrayOfCardsEntries,\n-                G1RemSetArrayOfCardsEntries + (uint)(align_up(cur_size, G1CardSetAllocOptions::SlotAlignment) - cur_size) \/ sizeof(G1CardSetArray::EntryDataType));\n-\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Arguments.cpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -289,1 +289,4 @@\n-    _table(mm, initial_log_table_size, false),\n+    _table(Mutex::service-1,\n+           mm,\n+           initial_log_table_size,\n+           false \/* enable_statistics *\/),\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSet.cpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -87,2 +87,4 @@\n-    _table(Log2DefaultNumBuckets,\n-           HashTable::DEFAULT_MAX_SIZE_LOG2),\n+    _table(Mutex::service-1,\n+           nullptr,\n+           Log2DefaultNumBuckets,\n+           false \/* enable_statistics *\/),\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CodeRootSet.cpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -124,2 +124,2 @@\n-    _serial_compaction_point(this),\n-    _humongous_compaction_point(this),\n+    _serial_compaction_point(this, nullptr),\n+    _humongous_compaction_point(this, nullptr),\n@@ -146,2 +146,2 @@\n-    _markers[i] = new G1FullGCMarker(this, i, _preserved_marks_set.get(i), _live_stats);\n-    _compaction_points[i] = new G1FullGCCompactionPoint(this);\n+    _markers[i] = new G1FullGCMarker(this, i, _live_stats);\n+    _compaction_points[i] = new G1FullGCCompactionPoint(this, _preserved_marks_set.get(i));\n@@ -151,0 +151,2 @@\n+  _serial_compaction_point.set_preserved_stack(_preserved_marks_set.get(0));\n+  _humongous_compaction_point.set_preserved_stack(_preserved_marks_set.get(0));\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullCollector.cpp","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -105,2 +105,2 @@\n-  G1FullGCMarker* marker = collector()->marker(worker_id);\n-  marker->preserved_stack()->adjust_during_full_gc();\n+  G1FullGCCompactionPoint* cp = collector()->compaction_point(worker_id);\n+  cp->preserved_stack()->adjust_during_full_gc();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCAdjustTask.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-G1FullGCCompactionPoint::G1FullGCCompactionPoint(G1FullCollector* collector) :\n+G1FullGCCompactionPoint::G1FullGCCompactionPoint(G1FullCollector* collector, PreservedMarks* preserved_stack) :\n@@ -37,1 +37,2 @@\n-    _compaction_top(nullptr) {\n+    _compaction_top(nullptr),\n+    _preserved_stack(preserved_stack) {\n@@ -107,0 +108,3 @@\n+    if (!object->is_forwarded()) {\n+      preserved_stack()->push_if_necessary(object, object->mark());\n+    }\n@@ -174,1 +178,1 @@\n-  _collector->marker(0)->preserved_stack()->push_if_necessary(obj, obj->mark());\n+  preserved_stack()->push_if_necessary(obj, obj->mark());\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCCompactionPoint.cpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+class PreservedMarks;\n@@ -40,0 +41,1 @@\n+  PreservedMarks* _preserved_stack;\n@@ -50,1 +52,1 @@\n-  G1FullGCCompactionPoint(G1FullCollector* collector);\n+  G1FullGCCompactionPoint(G1FullCollector* collector, PreservedMarks* preserved_stack);\n@@ -68,0 +70,10 @@\n+\n+  PreservedMarks* preserved_stack() const {\n+    assert(_preserved_stack != nullptr, \"must be initialized\");\n+    return _preserved_stack;\n+  }\n+\n+  void set_preserved_stack(PreservedMarks* preserved_stack) {\n+    assert(_preserved_stack == nullptr, \"only initialize once\");\n+    _preserved_stack = preserved_stack;\n+  }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCCompactionPoint.hpp","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -36,1 +36,0 @@\n-                               PreservedMarks* preserved_stack,\n@@ -43,1 +42,0 @@\n-    _preserved_stack(preserved_stack),\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,1 +31,0 @@\n-#include \"gc\/shared\/preservedMarks.hpp\"\n@@ -62,1 +61,0 @@\n-  PreservedMarks*    _preserved_stack;\n@@ -92,1 +90,0 @@\n-                 PreservedMarks* preserved_stack,\n@@ -99,1 +96,0 @@\n-  PreservedMarks*    preserved_stack() { return _preserved_stack; }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.hpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -54,7 +54,0 @@\n-  \/\/ Marked by us, preserve if needed.\n-  if (_collector->is_compacting(obj)) {\n-    \/\/ It is not necessary to preserve marks for objects in regions we do not\n-    \/\/ compact because we do not change their headers (i.e. forward them).\n-    preserved_stack()->push_if_necessary(obj, obj->mark());\n-  }\n-\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.inline.hpp","additions":0,"deletions":7,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -183,2 +183,0 @@\n-  void recalculate_eden_size();\n-\n","filename":"src\/hotspot\/share\/gc\/g1\/g1MonitoringSupport.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -162,2 +162,0 @@\n-  virtual Generation::Name kind() { return Generation::DefNew; }\n-\n@@ -229,1 +227,1 @@\n-  virtual void gc_epilogue(bool full);\n+  void gc_epilogue(bool full);\n@@ -253,1 +251,1 @@\n-  virtual void compute_new_size();\n+  void compute_new_size();\n","filename":"src\/hotspot\/share\/gc\/serial\/defNewGeneration.hpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -44,1 +44,0 @@\n-  to()->set_saved_mark();\n","filename":"src\/hotspot\/share\/gc\/serial\/defNewGeneration.inline.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -186,15 +186,0 @@\n-\n-class GenerationObjIterateClosure : public SpaceClosure {\n- private:\n-  ObjectClosure* _cl;\n- public:\n-  virtual void do_space(Space* s) {\n-    s->object_iterate(_cl);\n-  }\n-  GenerationObjIterateClosure(ObjectClosure* cl) : _cl(cl) {}\n-};\n-\n-void Generation::object_iterate(ObjectClosure* cl) {\n-  GenerationObjIterateClosure blk(cl);\n-  space_iterate(&blk);\n-}\n","filename":"src\/hotspot\/share\/gc\/serial\/generation.cpp","additions":0,"deletions":15,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -86,7 +86,0 @@\n-  \/\/ The set of possible generation kinds.\n-  enum Name {\n-    DefNew,\n-    MarkSweepCompact,\n-    Other\n-  };\n-\n@@ -102,3 +95,0 @@\n-\n-  virtual Generation::Name kind() { return Generation::Other; }\n-\n@@ -115,4 +105,0 @@\n-  \/\/ If this is a young generation, the maximum number of bytes that can be\n-  \/\/ allocated in this generation before a GC is triggered.\n-  virtual size_t capacity_before_gc() const { return 0; }\n-\n@@ -227,8 +213,0 @@\n-  \/\/ Some generations may require some cleanup or preparation actions before\n-  \/\/ allowing a collection.  The default is to do nothing.\n-  virtual void gc_prologue(bool full) {}\n-\n-  \/\/ Some generations may require some cleanup actions after a collection.\n-  \/\/ The default is to do nothing.\n-  virtual void gc_epilogue(bool full) {}\n-\n@@ -247,17 +225,0 @@\n-  \/\/ Accessing \"marks\".\n-\n-  \/\/ This function gives a generation a chance to note a point between\n-  \/\/ collections.  For example, a contiguous generation might note the\n-  \/\/ beginning allocation point post-collection, which might allow some later\n-  \/\/ operations to be optimized.\n-  virtual void save_marks() {}\n-\n-  \/\/ This function is \"true\" iff any no allocations have occurred in the\n-  \/\/ generation since the last call to \"save_marks\".\n-  virtual bool no_allocs_since_save_marks() = 0;\n-\n-  \/\/ When an older generation has been collected, and perhaps resized,\n-  \/\/ this method will be invoked on all younger generations (from older to\n-  \/\/ younger), allowing them to resize themselves as appropriate.\n-  virtual void compute_new_size() = 0;\n-\n@@ -268,6 +229,0 @@\n-  \/\/ Iteration.\n-\n-  \/\/ Iterate over all objects in the generation, calling \"cl.do_object\" on\n-  \/\/ each.\n-  virtual void object_iterate(ObjectClosure* cl);\n-\n","filename":"src\/hotspot\/share\/gc\/serial\/generation.hpp","additions":0,"deletions":45,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -124,1 +124,1 @@\n-  _old_pool = new GenerationPool(old, \"Tenured Gen\", true);\n+  _old_pool = new TenuredGenerationPool(old, \"Tenured Gen\", true);\n@@ -1058,10 +1058,0 @@\n-class GenGCPrologueClosure: public SerialHeap::GenClosure {\n- private:\n-  bool _full;\n- public:\n-  void do_generation(Generation* gen) {\n-    gen->gc_prologue(_full);\n-  }\n-  GenGCPrologueClosure(bool full) : _full(full) {};\n-};\n-\n@@ -1074,13 +1064,1 @@\n-  \/\/ Walk generations\n-  GenGCPrologueClosure blk(full);\n-  generation_iterate(&blk, false);  \/\/ not old-to-young.\n-};\n-\n-class GenGCEpilogueClosure: public SerialHeap::GenClosure {\n- private:\n-  bool _full;\n- public:\n-  void do_generation(Generation* gen) {\n-    gen->gc_epilogue(_full);\n-  }\n-  GenGCEpilogueClosure(bool full) : _full(full) {};\n+  _old_gen->gc_prologue();\n@@ -1096,2 +1074,2 @@\n-  GenGCEpilogueClosure blk(full);\n-  generation_iterate(&blk, false);  \/\/ not old-to-young.\n+  _young_gen->gc_epilogue(full);\n+  _old_gen->gc_epilogue();\n","filename":"src\/hotspot\/share\/gc\/serial\/serialHeap.cpp","additions":4,"deletions":26,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -367,2 +367,1 @@\n-    assert(_young_gen->kind() == Generation::DefNew, \"Wrong generation type\");\n-    return static_cast<DefNewGeneration*>(_young_gen);\n+    return _young_gen;\n@@ -372,2 +371,1 @@\n-    assert(_old_gen->kind() == Generation::MarkSweepCompact, \"Wrong generation type\");\n-    return static_cast<TenuredGeneration*>(_old_gen);\n+    return _old_gen;\n","filename":"src\/hotspot\/share\/gc\/serial\/serialHeap.hpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-#include \"gc\/serial\/generation.hpp\"\n@@ -29,0 +28,1 @@\n+#include \"gc\/serial\/tenuredGeneration.hpp\"\n@@ -75,3 +75,3 @@\n-GenerationPool::GenerationPool(Generation* gen,\n-                               const char* name,\n-                               bool support_usage_threshold) :\n+TenuredGenerationPool::TenuredGenerationPool(TenuredGeneration* gen,\n+                                             const char* name,\n+                                             bool support_usage_threshold) :\n@@ -82,1 +82,1 @@\n-size_t GenerationPool::used_in_bytes() {\n+size_t TenuredGenerationPool::used_in_bytes() {\n@@ -86,1 +86,1 @@\n-MemoryUsage GenerationPool::get_memory_usage() {\n+MemoryUsage TenuredGenerationPool::get_memory_usage() {\n","filename":"src\/hotspot\/share\/gc\/serial\/serialMemoryPools.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-class GenerationPool : public CollectedMemoryPool {\n+class TenuredGenerationPool : public CollectedMemoryPool {\n@@ -67,1 +67,1 @@\n-  Generation* _gen;\n+  TenuredGeneration* _gen;\n@@ -69,1 +69,1 @@\n-  GenerationPool(Generation* gen, const char* name, bool support_usage_threshold);\n+  TenuredGenerationPool(TenuredGeneration* gen, const char* name, bool support_usage_threshold);\n","filename":"src\/hotspot\/share\/gc\/serial\/serialMemoryPools.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -334,1 +334,1 @@\n-void TenuredGeneration::gc_prologue(bool full) {\n+void TenuredGeneration::gc_prologue() {\n@@ -488,1 +488,1 @@\n-void TenuredGeneration::gc_epilogue(bool full) {\n+void TenuredGeneration::gc_epilogue() {\n","filename":"src\/hotspot\/share\/gc\/serial\/tenuredGeneration.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -84,1 +84,1 @@\n-  virtual void compute_new_size();\n+  void compute_new_size();\n@@ -110,2 +110,0 @@\n-  Generation::Name kind() { return Generation::MarkSweepCompact; }\n-\n@@ -143,2 +141,2 @@\n-  virtual void gc_prologue(bool full);\n-  virtual void gc_epilogue(bool full);\n+  void gc_prologue();\n+  void gc_epilogue();\n","filename":"src\/hotspot\/share\/gc\/serial\/tenuredGeneration.hpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -71,2 +71,0 @@\n-\n-  save_marks();\n","filename":"src\/hotspot\/share\/gc\/serial\/tenuredGeneration.inline.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -74,0 +74,9 @@\n+#ifndef PRODUCT\n+bool AgeTable::is_clear() const {\n+  for (const size_t* p = sizes; p < sizes + table_size; ++p) {\n+    if (*p != 0) return false;\n+  }\n+  return true;\n+}\n+#endif \/\/ !PRODUCT\n+\n","filename":"src\/hotspot\/share\/gc\/shared\/ageTable.cpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"memory\/allocation.hpp\"\n@@ -39,1 +40,1 @@\n-class AgeTable {\n+class AgeTable: public CHeapObj<mtGC> {\n@@ -56,0 +57,5 @@\n+#ifndef PRODUCT\n+  \/\/ check whether it's clear\n+  bool is_clear() const;\n+#endif \/\/ !PRODUCT\n+\n@@ -60,1 +66,1 @@\n-    assert(age > 0 && age < table_size, \"invalid age of object\");\n+    assert(age < table_size, \"invalid age of object\");\n@@ -64,2 +70,1 @@\n-  \/\/ Merge another age table with the current one.  Used\n-  \/\/ for parallel young generation gc.\n+  \/\/ Merge another age table with the current one.\n","filename":"src\/hotspot\/share\/gc\/shared\/ageTable.hpp","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -149,8 +149,5 @@\n-  if (is_empty()) return;\n-  object_iterate_from(bottom(), blk);\n-}\n-\n-void ContiguousSpace::object_iterate_from(HeapWord* mark, ObjectClosure* blk) {\n-  while (mark < top()) {\n-    blk->do_object(cast_to_oop(mark));\n-    mark += cast_to_oop(mark)->size();\n+  HeapWord* addr = bottom();\n+  while (addr < top()) {\n+    oop obj = cast_to_oop(addr);\n+    blk->do_object(obj);\n+    addr += obj->size();\n","filename":"src\/hotspot\/share\/gc\/shared\/space.cpp","additions":5,"deletions":8,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -85,2 +85,0 @@\n-  void set_saved_mark_word(HeapWord* p) { _saved_mark_word = p; }\n-\n@@ -140,5 +138,0 @@\n-  \/\/ Iterate over all objects in the space, calling \"cl.do_object\" on\n-  \/\/ each.  Objects allocated by applications of the closure are not\n-  \/\/ included in the iteration.\n-  virtual void object_iterate(ObjectClosure* blk) = 0;\n-\n@@ -276,1 +269,1 @@\n-  void object_iterate(ObjectClosure* blk) override;\n+  void object_iterate(ObjectClosure* blk);\n@@ -288,5 +281,0 @@\n-  \/\/ Same as object_iterate, but starting from \"mark\", which is required\n-  \/\/ to denote the start of an object.  Objects allocated by\n-  \/\/ applications of the closure *are* included in the iteration.\n-  virtual void object_iterate_from(HeapWord* mark, ObjectClosure* blk);\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/space.hpp","additions":1,"deletions":13,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -74,1 +74,0 @@\n-      debug_only(HeapWord* prev = p);\n@@ -80,1 +79,1 @@\n-  set_saved_mark_word(p);\n+  set_saved_mark();\n","filename":"src\/hotspot\/share\/gc\/shared\/space.inline.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -216,6 +216,0 @@\n-  \/* constants from Generation::Name enum *\/                                \\\n-                                                                            \\\n-  declare_constant(Generation::DefNew)                                      \\\n-  declare_constant(Generation::MarkSweepCompact)                            \\\n-  declare_constant(Generation::Other)                                       \\\n-                                                                            \\\n","filename":"src\/hotspot\/share\/gc\/shared\/vmStructs_gc.hpp","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -48,2 +48,0 @@\n-  _degenerated_cycles_in_a_row(0),\n-  _successful_cycles_in_a_row(0),\n@@ -202,1 +200,1 @@\n-  return _degenerated_cycles_in_a_row <= ShenandoahFullGCThreshold;\n+  return ShenandoahHeap::heap()->shenandoah_policy()->consecutive_degenerated_gc_count() <= ShenandoahFullGCThreshold;\n@@ -223,3 +221,0 @@\n-  _degenerated_cycles_in_a_row = 0;\n-  _successful_cycles_in_a_row++;\n-\n@@ -233,3 +228,0 @@\n-  _degenerated_cycles_in_a_row++;\n-  _successful_cycles_in_a_row = 0;\n-\n@@ -240,3 +232,0 @@\n-  _degenerated_cycles_in_a_row = 0;\n-  _successful_cycles_in_a_row++;\n-\n@@ -257,2 +246,1 @@\n-  if (!ClassUnloading) return false;\n-  return true;\n+  return ClassUnloading;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahHeuristics.cpp","additions":2,"deletions":14,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -83,3 +83,0 @@\n-  uint _degenerated_cycles_in_a_row;\n-  uint _successful_cycles_in_a_row;\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahHeuristics.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+  _abbreviated_concurrent_gcs(0),\n@@ -35,0 +36,1 @@\n+  _abbreviated_degenerated_gcs(0),\n@@ -36,0 +38,1 @@\n+  _consecutive_degenerated_gcs(0),\n@@ -42,2 +45,1 @@\n-  _implicit_full(0),\n-  _cycle_counter(0) {\n+  _implicit_full(0) {\n@@ -48,1 +50,0 @@\n-\n@@ -78,0 +79,1 @@\n+  _consecutive_degenerated_gcs = 0;\n@@ -81,1 +83,2 @@\n-void ShenandoahCollectorPolicy::record_success_concurrent() {\n+void ShenandoahCollectorPolicy::record_success_concurrent(bool is_abbreviated) {\n+  _consecutive_degenerated_gcs = 0;\n@@ -83,0 +86,3 @@\n+  if (is_abbreviated) {\n+    _abbreviated_concurrent_gcs++;\n+  }\n@@ -85,1 +91,1 @@\n-void ShenandoahCollectorPolicy::record_success_degenerated() {\n+void ShenandoahCollectorPolicy::record_success_degenerated(bool is_abbreviated) {\n@@ -87,0 +93,4 @@\n+  _consecutive_degenerated_gcs++;\n+  if (is_abbreviated) {\n+    _abbreviated_degenerated_gcs++;\n+  }\n@@ -90,0 +100,1 @@\n+  _consecutive_degenerated_gcs = 0;\n@@ -93,8 +104,0 @@\n-size_t ShenandoahCollectorPolicy::cycle_counter() const {\n-  return _cycle_counter;\n-}\n-\n-void ShenandoahCollectorPolicy::record_cycle_start() {\n-  _cycle_counter++;\n-}\n-\n@@ -113,1 +116,2 @@\n-  out->print_cr(\"to avoid Degenerated and Full GC cycles.\");\n+  out->print_cr(\"to avoid Degenerated and Full GC cycles. Abbreviated cycles are those which found\");\n+  out->print_cr(\"enough regions with no live objects to skip evacuation.\");\n@@ -116,3 +120,6 @@\n-  out->print_cr(SIZE_FORMAT_W(5) \" successful concurrent GCs\",         _success_concurrent_gcs);\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked explicitly\",           _explicit_concurrent);\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked implicitly\",           _implicit_concurrent);\n+  size_t completed_gcs = _success_full_gcs + _success_degenerated_gcs + _success_concurrent_gcs;\n+  out->print_cr(SIZE_FORMAT_W(5) \" Completed GCs\", completed_gcs);\n+  out->print_cr(SIZE_FORMAT_W(5) \" Successful Concurrent GCs (%.2f%%)\",  _success_concurrent_gcs, percent_of(_success_concurrent_gcs, completed_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked explicitly (%.2f%%)\",    _explicit_concurrent, percent_of(_explicit_concurrent, _success_concurrent_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked implicitly (%.2f%%)\",    _implicit_concurrent, percent_of(_implicit_concurrent, _success_concurrent_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" abbreviated (%.2f%%)\",           _abbreviated_concurrent_gcs, percent_of(_abbreviated_concurrent_gcs, _success_concurrent_gcs));\n@@ -121,2 +128,5 @@\n-  out->print_cr(SIZE_FORMAT_W(5) \" Degenerated GCs\",                   _success_degenerated_gcs);\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" caused by allocation failure\", _alloc_failure_degenerated);\n+  size_t degenerated_gcs = _alloc_failure_degenerated_upgrade_to_full + _success_degenerated_gcs;\n+  out->print_cr(SIZE_FORMAT_W(5) \" Degenerated GCs (%.2f%%)\", degenerated_gcs, percent_of(degenerated_gcs, completed_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" upgraded to Full GC (%.2f%%)\",          _alloc_failure_degenerated_upgrade_to_full, percent_of(_alloc_failure_degenerated_upgrade_to_full, degenerated_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" caused by allocation failure (%.2f%%)\", _alloc_failure_degenerated, percent_of(_alloc_failure_degenerated, degenerated_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" abbreviated (%.2f%%)\",                  _abbreviated_degenerated_gcs, percent_of(_abbreviated_degenerated_gcs, degenerated_gcs));\n@@ -129,1 +139,0 @@\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" upgraded to Full GC\",          _alloc_failure_degenerated_upgrade_to_full);\n@@ -132,5 +141,5 @@\n-  out->print_cr(SIZE_FORMAT_W(5) \" Full GCs\",                          _success_full_gcs + _alloc_failure_degenerated_upgrade_to_full);\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked explicitly\",           _explicit_full);\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked implicitly\",           _implicit_full);\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" caused by allocation failure\", _alloc_failure_full);\n-  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" upgraded from Degenerated GC\", _alloc_failure_degenerated_upgrade_to_full);\n+  out->print_cr(SIZE_FORMAT_W(5) \" Full GCs (%.2f%%)\",                          _success_full_gcs, percent_of(_success_full_gcs, completed_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked explicitly (%.2f%%)\",           _explicit_full, percent_of(_explicit_full, _success_full_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" invoked implicitly (%.2f%%)\",           _implicit_full, percent_of(_implicit_full, _success_full_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" caused by allocation failure (%.2f%%)\", _alloc_failure_full, percent_of(_alloc_failure_full, _success_full_gcs));\n+  out->print_cr(\"  \" SIZE_FORMAT_W(5) \" upgraded from Degenerated GC (%.2f%%)\", _alloc_failure_degenerated_upgrade_to_full, percent_of(_alloc_failure_degenerated_upgrade_to_full, _success_full_gcs));\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahCollectorPolicy.cpp","additions":34,"deletions":25,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -42,0 +42,1 @@\n+  size_t _abbreviated_concurrent_gcs;\n@@ -43,0 +44,1 @@\n+  size_t _abbreviated_degenerated_gcs;\n@@ -45,0 +47,1 @@\n+  uint _consecutive_degenerated_gcs;\n@@ -55,1 +58,0 @@\n-\n@@ -58,1 +60,0 @@\n-  size_t _cycle_counter;\n@@ -63,6 +64,7 @@\n-  \/\/ TODO: This is different from gc_end: that one encompasses one VM operation.\n-  \/\/ These two encompass the entire cycle.\n-  void record_cycle_start();\n-\n-  void record_success_concurrent();\n-  void record_success_degenerated();\n+  \/\/ A collection cycle may be \"abbreviated\" if Shenandoah finds a sufficient percentage\n+  \/\/ of regions that contain no live objects (ShenandoahImmediateThreshold). These cycles\n+  \/\/ end after final mark, skipping the evacuation and reference-updating phases. Such\n+  \/\/ cycles are very efficient and are worth tracking. Note that both degenerated and\n+  \/\/ concurrent cycles can be abbreviated.\n+  void record_success_concurrent(bool is_abbreviated);\n+  void record_success_degenerated(bool is_abbreviated);\n@@ -83,2 +85,0 @@\n-  size_t cycle_counter() const;\n-\n@@ -90,0 +90,7 @@\n+\n+  \/\/ If the heuristics find that the number of consecutive degenerated cycles is above\n+  \/\/ ShenandoahFullGCThreshold, then they will initiate a Full GC upon an allocation\n+  \/\/ failure.\n+  inline size_t consecutive_degenerated_gc_count() const {\n+    return _consecutive_degenerated_gcs;\n+  }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahCollectorPolicy.hpp","additions":17,"deletions":10,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -90,1 +90,2 @@\n-  _degen_point(ShenandoahDegenPoint::_degenerated_unset) {\n+  _degen_point(ShenandoahDegenPoint::_degenerated_unset),\n+  _abbreviated(false) {\n@@ -191,0 +192,1 @@\n+    _abbreviated = true;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahConcurrentGC.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -48,0 +48,1 @@\n+  bool                      _abbreviated;\n@@ -54,0 +55,3 @@\n+  \/\/ Return true if this cycle found enough immediate garbage to skip evacuation\n+  bool abbreviated() const { return _abbreviated; }\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahConcurrentGC.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -53,1 +53,0 @@\n-  _periodic_task(this),\n@@ -60,18 +59,0 @@\n-  _periodic_task.enroll();\n-  if (ShenandoahPacing) {\n-    _periodic_pacer_notify_task.enroll();\n-  }\n-}\n-\n-ShenandoahControlThread::~ShenandoahControlThread() {\n-  \/\/ This is here so that super is called.\n-}\n-\n-void ShenandoahPeriodicTask::task() {\n-  _thread->handle_force_counters_update();\n-  _thread->handle_counters_update();\n-}\n-\n-void ShenandoahPeriodicPacerNotify::task() {\n-  assert(ShenandoahPacing, \"Should not be here otherwise\");\n-  ShenandoahHeap::heap()->pacer()->notify_waiters();\n@@ -198,1 +179,1 @@\n-      set_forced_counters_update(true);\n+      heap->set_forced_counters_update(true);\n@@ -239,1 +220,1 @@\n-        Universe::heap()->update_capacity_and_used_at_gc();\n+        heap->update_capacity_and_used_at_gc();\n@@ -242,1 +223,1 @@\n-        Universe::heap()->record_whole_heap_examined_timestamp();\n+        heap->record_whole_heap_examined_timestamp();\n@@ -247,2 +228,2 @@\n-      handle_force_counters_update();\n-      set_forced_counters_update(false);\n+      heap->handle_force_counters_update();\n+      heap->set_forced_counters_update(false);\n@@ -399,1 +380,1 @@\n-    heap->shenandoah_policy()->record_success_concurrent();\n+    heap->shenandoah_policy()->record_success_concurrent(gc.abbreviated());\n@@ -430,4 +411,0 @@\n-\n-  ShenandoahHeap* const heap = ShenandoahHeap::heap();\n-  heap->heuristics()->record_success_full();\n-  heap->shenandoah_policy()->record_success_full();\n@@ -444,4 +421,0 @@\n-\n-  ShenandoahHeap* const heap = ShenandoahHeap::heap();\n-  heap->heuristics()->record_success_degenerated();\n-  heap->shenandoah_policy()->record_success_degenerated();\n@@ -584,14 +557,0 @@\n-void ShenandoahControlThread::handle_counters_update() {\n-  if (_do_counters_update.is_set()) {\n-    _do_counters_update.unset();\n-    ShenandoahHeap::heap()->monitoring_support()->update_counters();\n-  }\n-}\n-\n-void ShenandoahControlThread::handle_force_counters_update() {\n-  if (_force_counters_update.is_set()) {\n-    _do_counters_update.unset(); \/\/ reset these too, we do update now!\n-    ShenandoahHeap::heap()->monitoring_support()->update_counters();\n-  }\n-}\n-\n@@ -600,6 +559,0 @@\n-\n-  \/\/ Update monitoring counters when we took a new region. This amortizes the\n-  \/\/ update costs on slow path.\n-  if (_do_counters_update.is_unset()) {\n-    _do_counters_update.set();\n-  }\n@@ -617,4 +570,0 @@\n-void ShenandoahControlThread::set_forced_counters_update(bool value) {\n-  _force_counters_update.set_cond(value);\n-}\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahControlThread.cpp","additions":6,"deletions":57,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-#include \"runtime\/task.hpp\"\n@@ -37,19 +36,0 @@\n-\/\/ Periodic task is useful for doing asynchronous things that do not require (heap) locks,\n-\/\/ or synchronization with other parts of collector. These could run even when ShenandoahConcurrentThread\n-\/\/ is busy driving the GC cycle.\n-class ShenandoahPeriodicTask : public PeriodicTask {\n-private:\n-  ShenandoahControlThread* _thread;\n-public:\n-  ShenandoahPeriodicTask(ShenandoahControlThread* thread) :\n-          PeriodicTask(100), _thread(thread) {}\n-  virtual void task();\n-};\n-\n-\/\/ Periodic task to notify blocked paced waiters.\n-class ShenandoahPeriodicPacerNotify : public PeriodicTask {\n-public:\n-  ShenandoahPeriodicPacerNotify() : PeriodicTask(PeriodicTask::min_interval) {}\n-  virtual void task();\n-};\n-\n@@ -72,2 +52,0 @@\n-  ShenandoahPeriodicTask _periodic_task;\n-  ShenandoahPeriodicPacerNotify _periodic_pacer_notify_task;\n@@ -84,2 +62,0 @@\n-  ShenandoahSharedFlag _do_counters_update;\n-  ShenandoahSharedFlag _force_counters_update;\n@@ -122,1 +98,0 @@\n-  ~ShenandoahControlThread();\n@@ -135,4 +110,0 @@\n-  void handle_counters_update();\n-  void handle_force_counters_update();\n-  void set_forced_counters_update(bool value);\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahControlThread.hpp","additions":0,"deletions":29,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -47,1 +47,2 @@\n-  _degen_point(degen_point) {\n+  _degen_point(degen_point),\n+  _abbreviated(false) {\n@@ -196,0 +197,2 @@\n+      } else {\n+        _abbreviated = true;\n@@ -233,0 +236,2 @@\n+    heap->shenandoah_policy()->record_success_degenerated(_abbreviated);\n+    heap->heuristics()->record_success_degenerated();\n@@ -346,5 +351,1 @@\n-  log_info(gc)(\"Cannot finish degeneration, upgrading to Full GC\");\n-  ShenandoahHeap::heap()->shenandoah_policy()->record_degenerated_upgrade_to_full();\n-\n-  ShenandoahFullGC full_gc;\n-  full_gc.op_full(GCCause::_shenandoah_upgrade_to_full_gc);\n+  upgrade_to_full();\n@@ -354,3 +355,1 @@\n-  ShenandoahHeap::heap()->shenandoah_policy()->record_degenerated_upgrade_to_full();\n-  ShenandoahFullGC full_gc;\n-  full_gc.op_full(GCCause::_shenandoah_upgrade_to_full_gc);\n+  upgrade_to_full();\n@@ -376,0 +375,7 @@\n+\n+void ShenandoahDegenGC::upgrade_to_full() {\n+  log_info(gc)(\"Degenerated GC upgrading to Full GC\");\n+  ShenandoahHeap::heap()->shenandoah_policy()->record_degenerated_upgrade_to_full();\n+  ShenandoahFullGC full_gc;\n+  full_gc.op_full(GCCause::_shenandoah_upgrade_to_full_gc);\n+}\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahDegeneratedGC.cpp","additions":15,"deletions":9,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+  bool _abbreviated;\n@@ -51,0 +52,1 @@\n+\n@@ -61,0 +63,3 @@\n+  \/\/ Turns this degenerated cycle into a full gc without leaving the safepoint\n+  void upgrade_to_full();\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahDegeneratedGC.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+#include \"gc\/shenandoah\/shenandoahCollectorPolicy.hpp\"\n@@ -109,0 +110,2 @@\n+  ShenandoahHeap* const heap = ShenandoahHeap::heap();\n+\n@@ -112,1 +115,1 @@\n-    ShenandoahHeap::heap()->notify_gc_progress();\n+    heap->notify_gc_progress();\n@@ -116,1 +119,1 @@\n-    ShenandoahHeap::heap()->notify_gc_no_progress();\n+    heap->notify_gc_no_progress();\n@@ -118,0 +121,4 @@\n+\n+  \/\/ Regardless if progress was made, we record that we completed a \"successful\" full GC.\n+  heap->heuristics()->record_success_full();\n+  heap->shenandoah_policy()->record_success_full();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFullGC.cpp","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -436,2 +436,0 @@\n-  } else {\n-    _pacer = nullptr;\n@@ -788,1 +786,1 @@\n-    control_thread()->notify_heap_changed();\n+    notify_heap_changed();\n@@ -792,0 +790,15 @@\n+void ShenandoahHeap::notify_heap_changed() {\n+  \/\/ Update monitoring counters when we took a new region. This amortizes the\n+  \/\/ update costs on slow path.\n+  monitoring_support()->notify_heap_changed();\n+  control_thread()->notify_heap_changed();\n+}\n+\n+void ShenandoahHeap::set_forced_counters_update(bool value) {\n+  monitoring_support()->set_forced_counters_update(value);\n+}\n+\n+void ShenandoahHeap::handle_force_counters_update() {\n+  monitoring_support()->handle_force_counters_update();\n+}\n+\n@@ -921,1 +934,1 @@\n-    control_thread()->notify_heap_changed();\n+    notify_heap_changed();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":17,"deletions":4,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -210,0 +210,9 @@\n+\/\/ ---------- Periodic Tasks\n+\/\/\n+private:\n+  void notify_heap_changed();\n+\n+public:\n+  void set_forced_counters_update(bool value);\n+  void handle_force_counters_update();\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.hpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-  virtual void update_all() {\n+  void update_all() override {\n@@ -49,1 +49,1 @@\n-  ShenandoahGenerationCounters(ShenandoahHeap* heap) :\n+  explicit ShenandoahGenerationCounters(ShenandoahHeap* heap) :\n@@ -54,1 +54,1 @@\n-  virtual void update_all() {\n+  void update_all() override {\n@@ -61,1 +61,2 @@\n-        _full_counters(nullptr)\n+        _full_counters(nullptr),\n+        _counters_update_task(this)\n@@ -74,0 +75,2 @@\n+\n+  _counters_update_task.enroll();\n@@ -106,0 +109,41 @@\n+\n+void ShenandoahMonitoringSupport::notify_heap_changed() {\n+  _counters_update_task.notify_heap_changed();\n+}\n+\n+void ShenandoahMonitoringSupport::set_forced_counters_update(bool value) {\n+  _counters_update_task.set_forced_counters_update(value);\n+}\n+\n+void ShenandoahMonitoringSupport::handle_force_counters_update() {\n+  _counters_update_task.handle_force_counters_update();\n+}\n+\n+void ShenandoahPeriodicCountersUpdateTask::task() {\n+  handle_force_counters_update();\n+  handle_counters_update();\n+}\n+\n+void ShenandoahPeriodicCountersUpdateTask::handle_counters_update() {\n+  if (_do_counters_update.is_set()) {\n+    _do_counters_update.unset();\n+    _monitoring_support->update_counters();\n+  }\n+}\n+\n+void ShenandoahPeriodicCountersUpdateTask::handle_force_counters_update() {\n+  if (_force_counters_update.is_set()) {\n+    _do_counters_update.unset(); \/\/ reset these too, we do update now!\n+    _monitoring_support->update_counters();\n+  }\n+}\n+\n+void ShenandoahPeriodicCountersUpdateTask::notify_heap_changed() {\n+  if (_do_counters_update.is_unset()) {\n+    _do_counters_update.set();\n+  }\n+}\n+\n+void ShenandoahPeriodicCountersUpdateTask::set_forced_counters_update(bool value) {\n+  _force_counters_update.set_cond(value);\n+}\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahMonitoringSupport.cpp","additions":48,"deletions":4,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"gc\/shenandoah\/shenandoahSharedVariables.hpp\"\n@@ -29,0 +30,1 @@\n+#include \"runtime\/task.hpp\"\n@@ -35,0 +37,20 @@\n+class ShenandoahMonitoringSupport;\n+\n+class ShenandoahPeriodicCountersUpdateTask : public PeriodicTask {\n+private:\n+  ShenandoahSharedFlag _do_counters_update;\n+  ShenandoahSharedFlag _force_counters_update;\n+  ShenandoahMonitoringSupport* const _monitoring_support;\n+\n+public:\n+  explicit ShenandoahPeriodicCountersUpdateTask(ShenandoahMonitoringSupport* monitoring_support) :\n+    PeriodicTask(100),\n+    _monitoring_support(monitoring_support) { }\n+\n+  void task() override;\n+\n+  void handle_counters_update();\n+  void handle_force_counters_update();\n+  void set_forced_counters_update(bool value);\n+  void notify_heap_changed();\n+};\n@@ -47,0 +69,1 @@\n+  ShenandoahPeriodicCountersUpdateTask _counters_update_task;\n@@ -49,6 +72,11 @@\n- ShenandoahMonitoringSupport(ShenandoahHeap* heap);\n- CollectorCounters* stw_collection_counters();\n- CollectorCounters* full_stw_collection_counters();\n- CollectorCounters* concurrent_collection_counters();\n- CollectorCounters* partial_collection_counters();\n- void update_counters();\n+  explicit ShenandoahMonitoringSupport(ShenandoahHeap* heap);\n+  CollectorCounters* stw_collection_counters();\n+  CollectorCounters* full_stw_collection_counters();\n+  CollectorCounters* concurrent_collection_counters();\n+  CollectorCounters* partial_collection_counters();\n+\n+  void notify_heap_changed();\n+  void set_forced_counters_update(bool value);\n+  void handle_force_counters_update();\n+\n+  void update_counters();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahMonitoringSupport.hpp","additions":34,"deletions":6,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -341,0 +341,5 @@\n+\n+void ShenandoahPeriodicPacerNotifyTask::task() {\n+  assert(ShenandoahPacing, \"Should not be here otherwise\");\n+  _pacer->notify_waiters();\n+}\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahPacer.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"runtime\/task.hpp\"\n@@ -34,0 +35,15 @@\n+class ShenandoahPacer;\n+\n+\n+\/\/ Periodic task to notify blocked paced waiters.\n+class ShenandoahPeriodicPacerNotifyTask : public PeriodicTask {\n+private:\n+  ShenandoahPacer* const _pacer;\n+public:\n+  explicit ShenandoahPeriodicPacerNotifyTask(ShenandoahPacer* pacer) :\n+    PeriodicTask(PeriodicTask::min_interval),\n+    _pacer(pacer) { }\n+\n+  void task() override;\n+};\n+\n@@ -51,0 +67,1 @@\n+  ShenandoahPeriodicPacerNotifyTask _notify_waiters_task;\n@@ -67,1 +84,1 @@\n-  ShenandoahPacer(ShenandoahHeap* heap) :\n+  explicit ShenandoahPacer(ShenandoahHeap* heap) :\n@@ -72,0 +89,1 @@\n+          _notify_waiters_task(this),\n@@ -75,1 +93,3 @@\n-          _progress(PACING_PROGRESS_UNINIT) {}\n+          _progress(PACING_PROGRESS_UNINIT) {\n+    _notify_waiters_task.enroll();\n+  }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahPacer.hpp","additions":22,"deletions":2,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -52,1 +52,0 @@\n-  _heap->shenandoah_policy()->record_cycle_start();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahUtils.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1155,1 +1155,1 @@\n-JVM_VirtualThreadHideFrames(JNIEnv* env, jobject vthread, jboolean hide);\n+JVM_VirtualThreadHideFrames(JNIEnv* env, jclass clazz, jboolean hide);\n@@ -1158,1 +1158,1 @@\n-JVM_VirtualThreadDisableSuspend(JNIEnv* env, jobject vthread, jboolean enter);\n+JVM_VirtualThreadDisableSuspend(JNIEnv* env, jclass clazz, jboolean enter);\n","filename":"src\/hotspot\/share\/include\/jvm.h","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -195,1 +195,3 @@\n-  ttyLocker ttyl;  \/\/ keep the following output coherent\n+  \/\/ Keep output to st coherent: collect all lines and print at once.\n+  ResourceMark rm;\n+  stringStream ss;\n@@ -197,1 +199,1 @@\n-    method_printer.trace(method, s.bcp(), st);\n+    method_printer.trace(method, s.bcp(), &ss);\n@@ -199,0 +201,1 @@\n+  st->print(\"%s\", ss.as_string());\n","filename":"src\/hotspot\/share\/interpreter\/bytecodeTracer.cpp","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -587,1 +587,1 @@\n-    } else if (_java_mirror.ptr_raw() == nullptr) {\n+    } else if (_java_mirror.is_empty()) {\n","filename":"src\/hotspot\/share\/oops\/klass.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -543,1 +543,1 @@\n-void Method::print_invocation_count() {\n+void Method::print_invocation_count(outputStream* st) {\n@@ -545,7 +545,7 @@\n-  if (is_static()) tty->print(\"static \");\n-  if (is_final()) tty->print(\"final \");\n-  if (is_synchronized()) tty->print(\"synchronized \");\n-  if (is_native()) tty->print(\"native \");\n-  tty->print(\"%s::\", method_holder()->external_name());\n-  name()->print_symbol_on(tty);\n-  signature()->print_symbol_on(tty);\n+  if (is_static())       { st->print(\"static \"); }\n+  if (is_final())        { st->print(\"final \"); }\n+  if (is_synchronized()) { st->print(\"synchronized \"); }\n+  if (is_native())       { st->print(\"native \"); }\n+  st->print(\"%s::\", method_holder()->external_name());\n+  name()->print_symbol_on(st);\n+  signature()->print_symbol_on(st);\n@@ -555,1 +555,1 @@\n-    tty->print(\" {%d}\", code_size());\n+    st->print(\" {%d}\", code_size());\n@@ -557,1 +557,1 @@\n-  tty->cr();\n+  st->cr();\n@@ -564,3 +564,3 @@\n-  tty->print_cr (\"  interpreter_invocation_count: \" INT32_FORMAT_W(11), interpreter_invocation_count());\n-  tty->print_cr (\"  invocation_counter:           \" INT32_FORMAT_W(11), invocation_count());\n-  tty->print_cr (\"  backedge_counter:             \" INT32_FORMAT_W(11), backedge_count());\n+  st->print_cr (\"  interpreter_invocation_count: \" INT32_FORMAT_W(11), interpreter_invocation_count());\n+  st->print_cr (\"  invocation_counter:           \" INT32_FORMAT_W(11), invocation_count());\n+  st->print_cr (\"  backedge_counter:             \" INT32_FORMAT_W(11), backedge_count());\n@@ -569,1 +569,1 @@\n-    tty->print_cr (\"  decompile_count:              \" UINT32_FORMAT_W(11), method_data()->decompile_count());\n+    st->print_cr (\"  decompile_count:              \" UINT32_FORMAT_W(11), method_data()->decompile_count());\n@@ -574,1 +574,1 @@\n-    tty->print_cr (\"  compiled_invocation_count:    \" INT64_FORMAT_W(11), compiled_invocation_count());\n+    st->print_cr (\"  compiled_invocation_count:    \" INT64_FORMAT_W(11), compiled_invocation_count());\n","filename":"src\/hotspot\/share\/oops\/method.cpp","additions":15,"deletions":15,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -457,1 +457,1 @@\n-  void print_invocation_count();\n+  void print_invocation_count(outputStream* st);\n","filename":"src\/hotspot\/share\/oops\/method.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,3 +60,2 @@\n-  oop* ptr = ptr_raw();\n-  assert(ptr != nullptr, \"should not use replace\");\n-  NativeAccess<>::oop_store(ptr, obj);\n+  assert(!is_empty(), \"should not use replace\");\n+  NativeAccess<>::oop_store(_obj, obj);\n","filename":"src\/hotspot\/share\/oops\/oopHandle.inline.hpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -2944,1 +2944,1 @@\n-    Node* hide = _gvn.transform(argument(1)); \/\/ hide argument for temporary VTMS transition notification\n+    Node* hide = _gvn.transform(argument(0)); \/\/ hide argument for temporary VTMS transition notification\n@@ -2967,1 +2967,1 @@\n-    Node* arg = _gvn.transform(argument(1)); \/\/ argument for notification\n+    Node* arg = _gvn.transform(argument(0)); \/\/ argument for notification\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -158,1 +158,1 @@\n-    if (out->is_CountedLoopEnd()) {\n+    if (out->is_BaseCountedLoopEnd()) {\n","filename":"src\/hotspot\/share\/opto\/subnode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -3989,1 +3989,1 @@\n-JVM_ENTRY(void, JVM_VirtualThreadHideFrames(JNIEnv* env, jobject vthread, jboolean hide))\n+JVM_ENTRY(void, JVM_VirtualThreadHideFrames(JNIEnv* env, jclass clazz, jboolean hide))\n@@ -4003,1 +4003,1 @@\n-JVM_ENTRY(void, JVM_VirtualThreadDisableSuspend(JNIEnv* env, jobject vthread, jboolean enter))\n+JVM_ENTRY(void, JVM_VirtualThreadDisableSuspend(JNIEnv* env, jclass clazz, jboolean enter))\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1893,1 +1893,1 @@\n-  if (cp->cache() == NULL) {\n+  if (cp->cache() == nullptr) {\n@@ -1911,1 +1911,1 @@\n-  if (cp->cache() == NULL) {\n+  if (cp->cache() == nullptr) {\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2184,1 +2184,1 @@\n-  assert(chunk->bitmap().count_one_bits(chunk->bit_index_for(effective_end), chunk->bit_index_for(end)) == 0, \"bits should not be set\");\n+  assert(effective_end == end || !chunk->bitmap().at(chunk->bit_index_for(effective_end)), \"bit should not be set\");\n","filename":"src\/hotspot\/share\/runtime\/continuationFreezeThaw.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1606,0 +1606,4 @@\n+  \/\/ These objects may escape when we return to Interpreter after deoptimization.\n+  \/\/ We need barrier so that stores that initialize these objects can't be reordered\n+  \/\/ with subsequent stores that make these objects accessible by other threads.\n+  OrderAccess::storestore();\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -133,5 +133,10 @@\n-        ttyLocker ttyl;\n-        tty->print_cr(\"------------------------------------------------------------------------\");\n-        m->print_invocation_count();\n-        tty->print_cr(\"  mdo size: %d bytes\", m->method_data()->size_in_bytes());\n-        tty->cr();\n+\n+        \/\/ Instead of taking tty lock, we collect all lines into a string stream\n+        \/\/ and then print them all at once.\n+        ResourceMark rm2;\n+        stringStream ss;\n+\n+        ss.print_cr(\"------------------------------------------------------------------------\");\n+        m->print_invocation_count(&ss);\n+        ss.print_cr(\"  mdo size: %d bytes\", m->method_data()->size_in_bytes());\n+        ss.cr();\n@@ -140,2 +145,2 @@\n-          tty->fill_to(2);\n-          m->method_data()->parameters_type_data()->print_data_on(tty);\n+          ss.fill_to(2);\n+          m->method_data()->parameters_type_data()->print_data_on(&ss);\n@@ -143,1 +148,2 @@\n-        m->print_codes();\n+        m->print_codes_on(&ss);\n+        tty->print(\"%s\", ss.as_string()); \/\/ print all at once\n@@ -195,1 +201,1 @@\n-    if ((iic + cic) >= (uint64_t)MethodHistogramCutoff) m->print_invocation_count();\n+    if ((iic + cic) >= (uint64_t)MethodHistogramCutoff) m->print_invocation_count(tty);\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":16,"deletions":10,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -197,1 +197,1 @@\n-  if (_scopedValueCache.ptr_raw() != nullptr) { \/\/ i.e. if the OopHandle has been allocated\n+  if (!_scopedValueCache.is_empty()) { \/\/ i.e. if the OopHandle has been allocated\n","filename":"src\/hotspot\/share\/runtime\/javaThread.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -194,1 +194,1 @@\n-  \/\/ is chosen to give us reasonable protection against NULL pointer dereferences while being\n+  \/\/ is chosen to give us reasonable protection against null pointer dereferences while being\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -162,8 +162,10 @@\n-      ttyLocker ttyl;\n-      tty->print_cr(\"Error in fill_from_frame: pc_desc for \"\n-                    INTPTR_FORMAT \" not found or invalid at %d\",\n-                    p2i(_frame.pc()), decode_offset);\n-      nm()->print();\n-      nm()->method()->print_codes();\n-      nm()->print_code();\n-      nm()->print_pcs();\n+      \/\/ Keep tty output consistent. To avoid ttyLocker, we buffer in stream, and print all at once.\n+      stringStream ss;\n+      ss.print_cr(\"Error in fill_from_frame: pc_desc for \"\n+                  INTPTR_FORMAT \" not found or invalid at %d\",\n+                  p2i(_frame.pc()), decode_offset);\n+      nm()->print_on(&ss);\n+      nm()->method()->print_codes_on(&ss);\n+      nm()->print_code_on(&ss);\n+      nm()->print_pcs_on(&ss);\n+      tty->print(\"%s\", ss.as_string()); \/\/ print all at once\n","filename":"src\/hotspot\/share\/runtime\/vframe.inline.hpp","additions":11,"deletions":9,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1899,1 +1899,0 @@\n-   declare_integer_type(Generation::Name)                                 \\\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -854,0 +854,2 @@\n+#define DEFAULT_PERFMAP_FILENAME \"\/tmp\/perf-<pid>.map\"\n+\n@@ -856,1 +858,1 @@\n-  _filename(\"filename\", \"Name of the map file\", \"STRING\", false)\n+  _filename(\"filename\", \"Name of the map file\", \"STRING\", false, DEFAULT_PERFMAP_FILENAME)\n@@ -862,1 +864,4 @@\n-  CodeCache::write_perf_map(_filename.value());\n+  \/\/ The check for _filename.is_set() is because we don't want to use\n+  \/\/ DEFAULT_PERFMAP_FILENAME, since it is meant as a description\n+  \/\/ of the default, not the actual default.\n+  CodeCache::write_perf_map(_filename.is_set() ? _filename.value() : nullptr);\n@@ -994,0 +999,2 @@\n+#define DEFAULT_CDS_ARCHIVE_FILENAME \"java_pid<pid>_<subcmd>.jsa\"\n+\n@@ -997,1 +1004,2 @@\n-  _filename(\"filename\", \"Name of shared archive to be dumped\", \"STRING\", false)\n+  _filename(\"filename\", \"Name of shared archive to be dumped\", \"STRING\", false,\n+            DEFAULT_CDS_ARCHIVE_FILENAME)\n@@ -1006,1 +1014,5 @@\n-  const char* file = _filename.value();\n+\n+  \/\/ The check for _filename.is_set() is because we don't want to use\n+  \/\/ DEFAULT_CDS_ARCHIVE_FILENAME, since it is meant as a description\n+  \/\/ of the default, not the actual default.\n+  const char* file = _filename.is_set() ? _filename.value() : nullptr;\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":17,"deletions":5,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -683,1 +683,1 @@\n-  if (_writer != NULL) {\n+  if (_writer != nullptr) {\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+#include \"runtime\/mutex.hpp\"\n@@ -409,0 +410,1 @@\n+                      Mutex::Rank rank = Mutex::nosafepoint-2,\n@@ -411,2 +413,2 @@\n-  explicit ConcurrentHashTable(void* context, size_t log2size = DEFAULT_START_SIZE_LOG2, bool enable_statistics = DEFAULT_ENABLE_STATISTICS) :\n-    ConcurrentHashTable(log2size, DEFAULT_MAX_SIZE_LOG2, DEFAULT_GROW_HINT, enable_statistics, context) {}\n+  explicit ConcurrentHashTable(Mutex::Rank rank, void* context, size_t log2size = DEFAULT_START_SIZE_LOG2, bool enable_statistics = DEFAULT_ENABLE_STATISTICS) :\n+    ConcurrentHashTable(log2size, DEFAULT_MAX_SIZE_LOG2, DEFAULT_GROW_HINT, enable_statistics, rank, context) {}\n","filename":"src\/hotspot\/share\/utilities\/concurrentHashTable.hpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1015,1 +1015,1 @@\n-ConcurrentHashTable(size_t log2size, size_t log2size_limit, size_t grow_hint, bool enable_statistics, void* context)\n+ConcurrentHashTable(size_t log2size, size_t log2size_limit, size_t grow_hint, bool enable_statistics, Mutex::Rank rank, void* context)\n@@ -1026,2 +1026,1 @@\n-  _resize_lock =\n-    new Mutex(Mutex::service-1, \"ConcurrentHashTableResize_lock\");\n+  _resize_lock = new Mutex(rank, \"ConcurrentHashTableResize_lock\");\n","filename":"src\/hotspot\/share\/utilities\/concurrentHashTable.inline.hpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -127,2 +127,0 @@\n-  const static GrowableArrayView EMPTY;\n-\n@@ -353,3 +351,0 @@\n-template<typename E>\n-const GrowableArrayView<E> GrowableArrayView<E>::EMPTY(nullptr, 0, 0);\n-\n","filename":"src\/hotspot\/share\/utilities\/growableArray.hpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -58,0 +58,2 @@\n+\n+import jdk.internal.event.SerializationMisdeclarationEvent;\n@@ -462,0 +464,4 @@\n+\n+        if (SerializationMisdeclarationEvent.enabled() && serializable) {\n+            SerializationMisdeclarationChecker.checkMisdeclarations(cl);\n+        }\n","filename":"src\/java.base\/share\/classes\/java\/io\/ObjectStreamClass.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,277 @@\n+\/*\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package java.io;\n+\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Member;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Proxy;\n+import java.security.AccessController;\n+import java.security.PrivilegedAction;\n+import java.util.Arrays;\n+\n+import static jdk.internal.event.SerializationMisdeclarationEvent.*;\n+import static java.lang.reflect.Modifier.*;\n+\n+final class SerializationMisdeclarationChecker {\n+\n+    private static final String SUID_NAME = \"serialVersionUID\";\n+    private static final String SERIAL_PERSISTENT_FIELDS_NAME = \"serialPersistentFields\";\n+    private static final String WRITE_OBJECT_NAME = \"writeObject\";\n+    private static final String READ_OBJECT_NAME = \"readObject\";\n+    private static final String READ_OBJECT_NO_DATA_NAME = \"readObjectNoData\";\n+    private static final String WRITE_REPLACE_NAME = \"writeReplace\";\n+    private static final String READ_RESOLVE_NAME = \"readResolve\";\n+\n+    private static final Class<?>[] WRITE_OBJECT_PARAM_TYPES = {ObjectOutputStream.class};\n+    private static final Class<?>[] READ_OBJECT_PARAM_TYPES = {ObjectInputStream.class};\n+\n+    \/*\n+     * The sharing of a single Class<?>[] instance here is just to avoid wasting\n+     * space, and should not be considered as a conceptual sharing of types.\n+     *\/\n+    private static final Class<?>[] READ_OBJECT_NO_DATA_PARAM_TYPES = {};\n+    private static final Class<?>[] WRITE_REPLACE_PARAM_TYPES = READ_OBJECT_NO_DATA_PARAM_TYPES;\n+    private static final Class<?>[] READ_RESOLVE_PARAM_TYPES = READ_OBJECT_NO_DATA_PARAM_TYPES;\n+\n+    static void checkMisdeclarations(Class<?> cl) {\n+        checkSerialVersionUID(cl);\n+        checkSerialPersistentFields(cl);\n+\n+        checkPrivateMethod(cl, WRITE_OBJECT_NAME,\n+                WRITE_OBJECT_PARAM_TYPES, Void.TYPE);\n+        checkPrivateMethod(cl, READ_OBJECT_NAME,\n+                READ_OBJECT_PARAM_TYPES, Void.TYPE);\n+        checkPrivateMethod(cl, READ_OBJECT_NO_DATA_NAME,\n+                READ_OBJECT_NO_DATA_PARAM_TYPES, Void.TYPE);\n+\n+        checkAccessibleMethod(cl, WRITE_REPLACE_NAME,\n+                WRITE_REPLACE_PARAM_TYPES, Object.class);\n+        checkAccessibleMethod(cl, READ_RESOLVE_NAME,\n+                READ_RESOLVE_PARAM_TYPES, Object.class);\n+    }\n+\n+    private static void checkSerialVersionUID(Class<?> cl) {\n+        Field f = privilegedDeclaredField(cl, SUID_NAME);\n+        if (f == null) {\n+            if (isOrdinaryClass(cl)) {\n+                commitEvent(cl, SUID_NAME + \" should be declared explicitly\" +\n+                        \" as a private static final long field\");\n+            }\n+            return;\n+        }\n+        if (cl.isEnum()) {\n+            commitEvent(cl, SUID_NAME + \" should not be declared in an enum class\");\n+        }\n+        if (!isPrivate(f)) {\n+            commitEvent(cl, SUID_NAME + \" should be private\");\n+        }\n+        if (!isStatic(f)) {\n+            commitEvent(cl, SUID_NAME + \" must be static\");\n+        }\n+        if (!isFinal(f)) {\n+            commitEvent(cl, SUID_NAME + \" must be final\");\n+        }\n+        if (f.getType() != Long.TYPE) {\n+            commitEvent(cl, SUID_NAME + \" must be of type long\");\n+        }\n+    }\n+\n+    private static void checkSerialPersistentFields(Class<?> cl) {\n+        Field f = privilegedDeclaredField(cl, SERIAL_PERSISTENT_FIELDS_NAME);\n+        if (f == null) {\n+            return;\n+        }\n+        if (cl.isRecord()) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME +\n+                    \" should not be declared in a record class\");\n+        } else if (cl.isEnum()) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME +\n+                    \" should not be declared in an enum class\");\n+        }\n+        if (!isPrivate(f)) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME + \" must be private\");\n+        }\n+        if (!isStatic(f)) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME + \" must be static\");\n+        }\n+        if (!isFinal(f)) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME + \" must be final\");\n+        }\n+        if (f.getType() != ObjectStreamField[].class) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME +\n+                    \" should be of type ObjectStreamField[]\");\n+        }\n+        if (!isStatic(f)) {\n+            return;\n+        }\n+        f.setAccessible(true);\n+        Object spf = objectFromStatic(f);\n+        if (spf == null) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME + \" should be non-null\");\n+            return;\n+        }\n+        if (!(spf instanceof ObjectStreamField[])) {\n+            commitEvent(cl, SERIAL_PERSISTENT_FIELDS_NAME +\n+                    \" must be an instance of ObjectStreamField[]\");\n+        }\n+    }\n+\n+    private static void checkPrivateMethod(Class<?> cl,\n+            String name, Class<?>[] paramTypes, Class<?> retType) {\n+        for (Method m : privilegedDeclaredMethods(cl)) {\n+            if (m.getName().equals(name)) {\n+                checkPrivateMethod(cl, m, paramTypes, retType);\n+            }\n+        }\n+    }\n+\n+    private static void checkPrivateMethod(Class<?> cl,\n+            Method m, Class<?>[] paramTypes, Class<?> retType) {\n+        if (cl.isEnum()) {\n+            commitEvent(cl, \"method \" + m + \" should not be declared in an enum class\");\n+        } else if (cl.isRecord()) {\n+            commitEvent(cl, \"method \" + m + \" should not be declared in a record class\");\n+        }\n+        if (!isPrivate(m)) {\n+            commitEvent(cl, \"method \" + m + \" must be private\");\n+        }\n+        if (isStatic(m)) {\n+            commitEvent(cl, \"method \" + m + \" must be non-static\");\n+        }\n+        if (m.getReturnType() != retType) {\n+            commitEvent(cl, \"method \" + m + \" must have return type \" + retType);\n+        }\n+        if (!Arrays.equals(m.getParameterTypes(), paramTypes)) {\n+            commitEvent(cl, \"method \" + m + \" must have parameter types \" + Arrays.toString(paramTypes));\n+        }\n+    }\n+\n+    private static void checkAccessibleMethod(Class<?> cl,\n+            String name, Class<?>[] paramTypes, Class<?> retType) {\n+        for (Class<?> superCl = cl; superCl != null; superCl = superCl.getSuperclass()) {\n+            for (Method m : privilegedDeclaredMethods(superCl)) {\n+                if (m.getName().equals(name)) {\n+                    checkAccessibleMethod(cl, superCl, m, paramTypes, retType);\n+                }\n+            }\n+        }\n+    }\n+\n+    private static void checkAccessibleMethod(Class<?> cl,\n+            Class<?> superCl, Method m, Class<?>[] paramTypes, Class<?> retType) {\n+        if (superCl.isEnum()) {\n+            commitEvent(cl, \"method \" + m + \" should not be declared in an enum class\");\n+        }\n+        if (isAbstract(m)) {\n+            commitEvent(cl, \"method \" + m + \" must be non-abstract\");\n+        }\n+        if (isStatic(m)) {\n+            commitEvent(cl, \"method \" + m + \" must be non-static\");\n+        }\n+        if (m.getReturnType() != retType) {\n+            commitEvent(cl, \"method \" + m + \" must have return type \" + retType);\n+        }\n+        if (!Arrays.equals(m.getParameterTypes(), paramTypes)) {\n+            commitEvent(cl, \"method \" + m + \" must have parameter types \" + Arrays.toString(paramTypes));\n+        }\n+        if (isPrivate(m) && cl != superCl\n+                || isPackageProtected(m) && !isSamePackage(cl, superCl)) {\n+            commitEvent(cl, \"method \" + m + \" is not accessible\");\n+        }\n+    }\n+\n+    private static boolean isSamePackage(Class<?> cl0, Class<?> cl1) {\n+        return cl0.getClassLoader() == cl1.getClassLoader()\n+                && cl0.getPackageName().equals(cl1.getPackageName());\n+    }\n+\n+    private static boolean isOrdinaryClass(Class<?> cl) {\n+        \/* class Enum and class Record are not considered ordinary classes *\/\n+        return !(cl.isRecord() || cl.isEnum() || cl.isArray()\n+                || Enum.class == cl || Record.class == cl\n+                || Proxy.isProxyClass(cl));\n+    }\n+\n+    private static boolean isPrivate(Member m) {\n+        return (m.getModifiers() & PRIVATE) != 0;\n+    }\n+\n+    private static boolean isPackageProtected(Member m) {\n+        return (m.getModifiers() & (PRIVATE | PROTECTED | PUBLIC)) == 0;\n+    }\n+\n+    private static boolean isAbstract(Member m) {\n+        return (m.getModifiers() & ABSTRACT) != 0;\n+    }\n+\n+    private static boolean isFinal(Member m) {\n+        return (m.getModifiers() & FINAL) != 0;\n+    }\n+\n+    private static boolean isStatic(Member m) {\n+        return (m.getModifiers() & STATIC) != 0;\n+    }\n+\n+    @SuppressWarnings(\"removal\")\n+    private static Field privilegedDeclaredField(Class<?> cl, String name) {\n+        if (System.getSecurityManager() == null) {\n+            return declaredField(cl, name);\n+        }\n+        return AccessController.doPrivileged((PrivilegedAction<Field>) () ->\n+                declaredField(cl, name));\n+    }\n+\n+    private static Field declaredField(Class<?> cl, String name) {\n+        try {\n+            return cl.getDeclaredField(name);\n+        } catch (NoSuchFieldException ignored) {\n+        }\n+        return null;\n+    }\n+\n+    @SuppressWarnings(\"removal\")\n+    private static Method[] privilegedDeclaredMethods(Class<?> cl) {\n+        if (System.getSecurityManager() == null) {\n+            return cl.getDeclaredMethods();\n+        }\n+        return AccessController.doPrivileged(\n+                (PrivilegedAction<Method[]>) cl::getDeclaredMethods);\n+    }\n+\n+    private static Object objectFromStatic(Field f) {\n+        try {\n+            return f.get(null);\n+        } catch (IllegalAccessException ignored) {\n+        }\n+        return null;\n+    }\n+\n+    private static void commitEvent(Class<?> cl, String msg) {\n+        commit(timestamp(), cl, msg);\n+    }\n+\n+}\n","filename":"src\/java.base\/share\/classes\/java\/io\/SerializationMisdeclarationChecker.java","additions":277,"deletions":0,"binary":false,"changes":277,"status":"added"},{"patch":"@@ -30,1 +30,1 @@\n-sealed abstract class BaseVirtualThread extends Thread\n+abstract sealed class BaseVirtualThread extends Thread\n","filename":"src\/java.base\/share\/classes\/java\/lang\/BaseVirtualThread.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1178,1 +1178,1 @@\n-    private native void notifyJvmtiHideFrames(boolean hide);\n+    private static native void notifyJvmtiHideFrames(boolean hide);\n@@ -1181,1 +1181,1 @@\n-    private native void notifyJvmtiDisableSuspend(boolean enter);\n+    private static native void notifyJvmtiDisableSuspend(boolean enter);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/VirtualThread.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -617,0 +617,11 @@\n+    \/**\n+     * {@return a string identifying this {@code ChoiceFormat}, for debugging}\n+     *\/\n+    @Override\n+    public String toString() {\n+        return\n+            \"\"\"\n+            ChoiceFormat [pattern: \"%s\"]\n+            \"\"\".formatted(toPattern());\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/text\/ChoiceFormat.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -2394,0 +2394,11 @@\n+    \/**\n+     * {@return a string identifying this {@code CompactNumberFormat}, for debugging}\n+     *\/\n+    @Override\n+    public String toString() {\n+        return\n+            \"\"\"\n+            CompactNumberFormat [locale: \"%s\", decimal pattern: \"%s\", compact patterns: \"%s\"]\n+            \"\"\".formatted(symbols.getLocale().getDisplayName(), decimalPattern, Arrays.toString(compactPatterns));\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/text\/CompactNumberFormat.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -355,0 +355,9 @@\n+ * <h3 id=\"digit_limits\"> Integer and Fraction Digit Limits <\/h3>\n+ *\n+ * @implSpec\n+ * When formatting a {@code Number} other than {@code BigInteger} and\n+ * {@code BigDecimal}, {@code 309} is used as the upper limit for integer digits,\n+ * and {@code 340} as the upper limit for fraction digits. This occurs, even if\n+ * one of the {@code DecimalFormat} getter methods, for example, {@link #getMinimumFractionDigits()}\n+ * returns a numerically greater value.\n+ *\n@@ -2999,0 +3008,11 @@\n+    \/**\n+     * {@return a string identifying this {@code DecimalFormat}, for debugging}\n+     *\/\n+    @Override\n+    public String toString() {\n+        return\n+            \"\"\"\n+            DecimalFormat [locale: \"%s\", pattern: \"%s\"]\n+            \"\"\".formatted(symbols.getLocale().getDisplayName(), toPattern());\n+    }\n+\n@@ -3710,4 +3730,1 @@\n-     * number.\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of {@code newValue} and\n-     * 309 is used. Negative input values are replaced with 0.\n+     * number. Negative input values are replaced with 0.\n@@ -3715,0 +3732,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n@@ -3729,4 +3747,1 @@\n-     * number.\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of {@code newValue} and\n-     * 309 is used. Negative input values are replaced with 0.\n+     * number. Negative input values are replaced with 0.\n@@ -3734,0 +3749,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n@@ -3748,4 +3764,1 @@\n-     * number.\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of {@code newValue} and\n-     * 340 is used. Negative input values are replaced with 0.\n+     * number. Negative input values are replaced with 0.\n@@ -3753,0 +3766,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n@@ -3767,4 +3781,1 @@\n-     * number.\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of {@code newValue} and\n-     * 340 is used. Negative input values are replaced with 0.\n+     * number. Negative input values are replaced with 0.\n@@ -3772,0 +3783,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n@@ -3786,4 +3798,3 @@\n-     * number.\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of the return value and\n-     * 309 is used.\n+     * number. The maximum number of integer digits can be set by either {@link #setMaximumIntegerDigits(int)}\n+     * or {@link #applyPattern(String)}. See the {@link ##patterns Pattern Section} for\n+     * comprehensive rules regarding maximum integer digits in patterns.\n@@ -3791,0 +3802,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n@@ -3800,3 +3812,0 @@\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of the return value and\n-     * 309 is used.\n@@ -3804,0 +3813,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n@@ -3813,3 +3823,0 @@\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of the return value and\n-     * 340 is used.\n@@ -3817,0 +3824,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n@@ -3826,3 +3834,0 @@\n-     * For formatting numbers other than {@code BigInteger} and\n-     * {@code BigDecimal} objects, the lower of the return value and\n-     * 340 is used.\n@@ -3830,0 +3835,1 @@\n+     * @see ##digit_limits Integer and Fraction Digit Limits\n","filename":"src\/java.base\/share\/classes\/java\/text\/DecimalFormat.java","additions":36,"deletions":30,"binary":false,"changes":66,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -533,1 +533,1 @@\n-     * {@inheritDoc}\n+     * {@return a string identifying this {@code ListFormat}, for debugging}\n","filename":"src\/java.base\/share\/classes\/java\/text\/ListFormat.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1187,0 +1187,11 @@\n+    \/**\n+     * {@return a string identifying this {@code MessageFormat}, for debugging}\n+     *\/\n+    @Override\n+    public String toString() {\n+        return\n+            \"\"\"\n+            MessageFormat [locale: %s, pattern: \"%s\"]\n+            \"\"\".formatted(locale == null ? null : '\"' + locale.getDisplayName() + '\"', toPattern());\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/text\/MessageFormat.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -2425,0 +2425,11 @@\n+    \/**\n+     * {@return a string identifying this {@code SimpleDateFormat}, for debugging}\n+     *\/\n+    @Override\n+    public String toString() {\n+        return\n+            \"\"\"\n+            SimpleDateFormat [locale: %s, pattern: \"%s\"]\n+            \"\"\".formatted(locale == null ? null : '\"' + locale.getDisplayName() + '\"', toPattern());\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/text\/SimpleDateFormat.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -851,1 +851,1 @@\n-        this.sizeCtl = DEFAULT_CAPACITY;\n+        this(m.size());\n@@ -1087,1 +1087,3 @@\n-        tryPresize(m.size());\n+        if (table != null) {\n+            tryPresize(size() + m.size());\n+        }\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ConcurrentHashMap.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,91 @@\n+\/*\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.internal.event;\n+\n+\/**\n+ * A JFR event for serialization misdeclarations.\n+ * This event is mirrored in {@code jdk.jfr.events.SerializationMisdeclarationEvent}\n+ * where the metadata for the event is provided with annotations.\n+ * Some of the methods are replaced by generated methods when jfr is enabled.\n+ * Note that the order of the arguments of the {@link #commit(long,Class,String)}\n+ * method must be the same as the order of the fields.\n+ *\/\n+public class SerializationMisdeclarationEvent extends Event {\n+\n+    public Class<?> misdeclaredClass;\n+    public String message;\n+\n+    \/**\n+     * Commit a serialization misdeclaration event.\n+     * The implementation of this method is generated automatically if jfr is enabled.\n+     * The order of the fields must be the same as the parameters in this method.\n+     * {@code commit(long,Class,String)}\n+     *\n+     * @param start             timestamp of the start of the operation\n+     * @param misdeclaredClass  the affected class\n+     * @param message           the specific event message\n+     *\/\n+    public static void commit(long start, Class<?> misdeclaredClass, String message) {\n+        \/\/ Generated by JFR\n+    }\n+\n+    \/**\n+     * Determine if an event should be emitted.  The duration of the operation\n+     * must exceed some threshold in order to commit the event.  The implementation\n+     * of this method is generated automatically if jfr is enabled.\n+     *\n+     * @param duration  time in nanoseconds to complete the operation\n+     * @return  true if the event should be commited\n+     *\/\n+    public static boolean shouldCommit(long duration) {\n+        \/\/ Generated by JFR\n+        return false;\n+    }\n+\n+    \/**\n+     * Determine if this kind of event is enabled.  The implementation\n+     * of this method is generated automatically if jfr is enabled.\n+     *\n+     * @return whether serialization misdeclaration events are enabled\n+     *\/\n+    public static boolean enabled() {\n+        \/\/ Generated by JFR\n+        return false;\n+    }\n+\n+    \/**\n+     * Fetch the current timestamp in nanoseconds.  This method is used\n+     * to determine the start and end of an operation.  The implementation\n+     * of this method is generated automatically if jfr is enabled.\n+     *\n+     * @return  the current timestamp value\n+     *\/\n+    public static long timestamp() {\n+        \/\/ Generated by JFR\n+        return 0L;\n+    }\n+\n+}\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/event\/SerializationMisdeclarationEvent.java","additions":91,"deletions":0,"binary":false,"changes":91,"status":"added"},{"patch":"@@ -40,1 +40,1 @@\n-public sealed abstract class ResolverConfiguration permits ResolverConfigurationImpl {\n+public abstract sealed class ResolverConfiguration permits ResolverConfigurationImpl {\n","filename":"src\/java.base\/share\/classes\/sun\/net\/dns\/ResolverConfiguration.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,6 +47,0 @@\n-    \/*\n-     * Interface to be able to call retrieve() in plugin if\n-     * this variable is set.\n-     *\/\n-    private static URLJarFileCallBack callback = null;\n-\n@@ -60,4 +54,0 @@\n-    static JarFile getJarFile(URL url) throws IOException {\n-        return getJarFile(url, null);\n-    }\n-\n@@ -75,17 +65,0 @@\n-    \/*\n-     * Changed modifier from private to public in order to be able\n-     * to instantiate URLJarFile from sun.plugin package.\n-     *\/\n-    public URLJarFile(File file) throws IOException {\n-        this(file, null);\n-    }\n-\n-    \/*\n-     * Changed modifier from private to public in order to be able\n-     * to instantiate URLJarFile from sun.plugin package.\n-     *\/\n-    public URLJarFile(File file, URLJarFileCloseController closeController) throws IOException {\n-        super(file, true, ZipFile.OPEN_READ | ZipFile.OPEN_DELETE);\n-        this.closeController = closeController;\n-    }\n-\n@@ -191,24 +164,17 @@\n-        \/*\n-         * See if interface is set, then call retrieve function of the class\n-         * that implements URLJarFileCallBack interface (sun.plugin - to\n-         * handle the cache failure for JARJAR file.)\n-         *\/\n-        if (callback != null)\n-        {\n-            return callback.retrieve(url);\n-        }\n-\n-        else\n-        {\n-\n-            JarFile result = null;\n-            Runtime.Version version = \"runtime\".equals(url.getRef())\n-                    ? JarFile.runtimeVersion()\n-                    : JarFile.baseVersion();\n-\n-            \/* get the stream before asserting privileges *\/\n-            try (final InputStream in = url.openConnection().getInputStream()) {\n-                result = AccessController.doPrivileged(\n-                    new PrivilegedExceptionAction<>() {\n-                        public JarFile run() throws IOException {\n-                            Path tmpFile = Files.createTempFile(\"jar_cache\", null);\n+        JarFile result = null;\n+        Runtime.Version version = \"runtime\".equals(url.getRef())\n+                ? JarFile.runtimeVersion()\n+                : JarFile.baseVersion();\n+\n+        \/* get the stream before asserting privileges *\/\n+        try (final InputStream in = url.openConnection().getInputStream()) {\n+            result = AccessController.doPrivileged(\n+                new PrivilegedExceptionAction<>() {\n+                    public JarFile run() throws IOException {\n+                        Path tmpFile = Files.createTempFile(\"jar_cache\", null);\n+                        try {\n+                            Files.copy(in, tmpFile, StandardCopyOption.REPLACE_EXISTING);\n+                            JarFile jarFile = new URLJarFile(tmpFile.toFile(), closeController, version);\n+                            tmpFile.toFile().deleteOnExit();\n+                            return jarFile;\n+                        } catch (Throwable thr) {\n@@ -216,11 +182,3 @@\n-                                Files.copy(in, tmpFile, StandardCopyOption.REPLACE_EXISTING);\n-                                JarFile jarFile = new URLJarFile(tmpFile.toFile(), closeController, version);\n-                                tmpFile.toFile().deleteOnExit();\n-                                return jarFile;\n-                            } catch (Throwable thr) {\n-                                try {\n-                                    Files.delete(tmpFile);\n-                                } catch (IOException ioe) {\n-                                    thr.addSuppressed(ioe);\n-                                }\n-                                throw thr;\n+                                Files.delete(tmpFile);\n+                            } catch (IOException ioe) {\n+                                thr.addSuppressed(ioe);\n@@ -228,0 +186,1 @@\n+                            throw thr;\n@@ -229,6 +188,4 @@\n-                    });\n-            } catch (PrivilegedActionException pae) {\n-                throw (IOException) pae.getException();\n-            }\n-\n-            return result;\n+                    }\n+                });\n+        } catch (PrivilegedActionException pae) {\n+            throw (IOException) pae.getException();\n@@ -236,1 +193,0 @@\n-    }\n@@ -238,7 +194,1 @@\n-    \/*\n-     * Set the call back interface to call retrieve function in sun.plugin\n-     * package if plugin is running.\n-     *\/\n-    public static void setCallBack(URLJarFileCallBack cb)\n-    {\n-        callback = cb;\n+        return result;\n@@ -247,1 +197,0 @@\n-\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/jar\/URLJarFile.java","additions":27,"deletions":78,"binary":false,"changes":105,"status":"modified"},{"patch":"@@ -1,39 +0,0 @@\n-\/*\n- * Copyright (c) 2001, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package sun.net.www.protocol.jar;\n-\n-import java.io.*;\n-import java.net.*;\n-import java.util.jar.*;\n-\n-\n-\/*\n- * This interface is used to call back to sun.plugin package.\n- *\/\n-public interface URLJarFileCallBack\n-{\n-        public JarFile retrieve (URL url) throws IOException;\n-}\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/jar\/URLJarFileCallBack.java","additions":0,"deletions":39,"binary":false,"changes":39,"status":"deleted"},{"patch":"@@ -1156,1 +1156,1 @@\n-    private sealed abstract static class Unmapper\n+    private abstract static sealed class Unmapper\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/FileChannelImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-public sealed abstract class AbstractCalendar extends CalendarSystem\n+public abstract sealed class AbstractCalendar extends CalendarSystem\n","filename":"src\/java.base\/share\/classes\/sun\/util\/calendar\/AbstractCalendar.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n-public sealed abstract class BaseCalendar extends AbstractCalendar\n+public abstract sealed class BaseCalendar extends AbstractCalendar\n@@ -144,1 +144,1 @@\n-    public sealed abstract static class Date extends CalendarDate\n+    public abstract static sealed class Date extends CalendarDate\n","filename":"src\/java.base\/share\/classes\/sun\/util\/calendar\/BaseCalendar.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-public sealed abstract class CalendarDate implements Cloneable\n+public abstract sealed class CalendarDate implements Cloneable\n","filename":"src\/java.base\/share\/classes\/sun\/util\/calendar\/CalendarDate.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-public sealed abstract class CalendarSystem permits AbstractCalendar {\n+public abstract sealed class CalendarSystem permits AbstractCalendar {\n","filename":"src\/java.base\/share\/classes\/sun\/util\/calendar\/CalendarSystem.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,2 +48,2 @@\n- * This table covers transitions from 1900 until 2037 (as of version\n- * 1.4), Before 1900, it assumes that there was no daylight saving\n+ * This table covers transitions from 1900 until 2100 (as of version\n+ * 23), Before 1900, it assumes that there was no daylight saving\n@@ -53,1 +53,1 @@\n- * supposed to observe daylight saving time in 2037, it delegates\n+ * supposed to observe daylight saving time in 2100, it delegates\n@@ -55,1 +55,1 @@\n- * object created using the daylight saving time schedule as of 2037.\n+ * object created using the daylight saving time schedule as of 2100.\n","filename":"src\/java.base\/share\/classes\/sun\/util\/calendar\/ZoneInfo.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -409,3 +409,3 @@\n-    \/\/ ZoneInfo ends with   UTC2037\n-    \/\/ LocalDateTime.of(2038, 1, 1, 0, 0, 0).toEpochSecond(ZoneOffset.UTC) - 1;\n-    private static final long UTC2037 = 2145916799L;\n+    \/\/ ZoneInfo ends with   UTC2100\n+    \/\/ LocalDateTime.of(2101, 1, 1, 0, 0, 0).toEpochSecond(ZoneOffset.UTC) - 1;\n+    private static final long UTC2100 = 4133980799L;\n@@ -413,1 +413,1 @@\n-    \/\/ ZoneInfo has an ending entry for 2037, this need to be offset by\n+    \/\/ ZoneInfo has an ending entry for 2100, this need to be offset by\n@@ -415,2 +415,2 @@\n-    \/\/ LocalDateTime.of(2037, 1, 1, 0, 0, 0).toEpochSecond(ZoneOffset.UTC));\n-    private static final long LDT2037 = 2114380800L;\n+    \/\/ LocalDateTime.of(2100, 1, 1, 0, 0, 0).toEpochSecond(ZoneOffset.UTC);\n+    private static final long LDT2100 = 4102444800L;\n@@ -418,1 +418,1 @@\n-    \/\/Current time. Used to determine future GMToffset transitions\n+    \/\/Current time. Used to determine future GMT offset transitions\n@@ -485,1 +485,1 @@\n-                if (trans > UTC2037) {\n+                if (trans > UTC2100) {\n@@ -632,1 +632,1 @@\n-                    \/\/ ZoneInfo has an ending entry for 2037\n+                    \/\/ ZoneInfo has an ending entry for 2100\n@@ -636,1 +636,1 @@\n-                    long trans = LDT2037 - rawOffset\/1000;\n+                    long trans = LDT2100 - rawOffset\/1000;\n@@ -817,1 +817,3 @@\n-    private static final int  LASTYEAR = 2037;\n+    \/\/ The `last` year that transitions are accounted for. If there are\n+    \/\/ rules that go beyond this LASTYEAR, the value needs to be expanded.\n+    private static final int  LASTYEAR = 2100;\n","filename":"src\/java.base\/share\/classes\/sun\/util\/calendar\/ZoneInfoFile.java","additions":14,"deletions":12,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1512,25 +1512,1 @@\n-        int width = r.getWidth();\n-        int height = r.getHeight();\n-        int startX = r.getMinX();\n-        int startY = r.getMinY();\n-\n-        int[] tdata = null;\n-\n-        \/\/ Clip to the current Raster\n-        Rectangle rclip = new Rectangle(startX, startY, width, height);\n-        Rectangle bclip = new Rectangle(0, 0, raster.width, raster.height);\n-        Rectangle intersect = rclip.intersection(bclip);\n-        if (intersect.isEmpty()) {\n-            return;\n-        }\n-        width = intersect.width;\n-        height = intersect.height;\n-        startX = intersect.x;\n-        startY = intersect.y;\n-\n-        \/\/ remind use get\/setDataElements for speed if Rasters are\n-        \/\/ compatible\n-        for (int i = startY; i < startY+height; i++)  {\n-            tdata = r.getPixels(startX,i,width,1,tdata);\n-            raster.setPixels(startX,i,width,1, tdata);\n-        }\n+        raster.setRect(r);\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/image\/BufferedImage.java","additions":2,"deletions":26,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -425,2 +425,0 @@\n-        int width  = srcRaster.getWidth();\n-        int height = srcRaster.getHeight();\n@@ -429,24 +427,3 @@\n-        int dstOffX = dx+srcOffX;\n-        int dstOffY = dy+srcOffY;\n-\n-        \/\/ Clip to this raster\n-        if (dstOffX < this.minX) {\n-            int skipX = this.minX - dstOffX;\n-            width -= skipX;\n-            srcOffX += skipX;\n-            dstOffX = this.minX;\n-        }\n-        if (dstOffY < this.minY) {\n-            int skipY = this.minY - dstOffY;\n-            height -= skipY;\n-            srcOffY += skipY;\n-            dstOffY = this.minY;\n-        }\n-        if (dstOffX+width > this.minX+this.width) {\n-            width = this.minX + this.width - dstOffX;\n-        }\n-        if (dstOffY+height > this.minY+this.height) {\n-            height = this.minY + this.height - dstOffY;\n-        }\n-\n-        if (width <= 0 || height <= 0) {\n+        Rectangle bsrc = new Rectangle(dx+srcOffX, dy+srcOffY, srcRaster.getWidth(), srcRaster.getHeight());\n+        Rectangle clip = bsrc.intersection(new Rectangle(minX, minY, width, height));\n+        if (clip.isEmpty()) {\n@@ -455,0 +432,6 @@\n+        srcOffX += clip.x - bsrc.x;\n+        srcOffY += clip.y - bsrc.y;\n+        final int dstOffX = clip.x;\n+        final int dstOffY = clip.y;\n+        final int width   = clip.width;\n+        final int height  = clip.height;\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/image\/WritableRaster.java","additions":10,"deletions":27,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1128,1 +1128,4 @@\n-                            newIcon = getIcon(size, size);\n+                            newIcon2 = getIcon(size, size);\n+                            if (newIcon2 != null) {\n+                                newIcon = newIcon2;\n+                            }\n@@ -1195,0 +1198,3 @@\n+                    if (newIcon == null) {\n+                        return null;\n+                    }\n","filename":"src\/java.desktop\/windows\/classes\/sun\/awt\/shell\/Win32ShellFolder2.java","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -468,14 +468,0 @@\n-\n-    @Override @DefinedBy(Api.LANGUAGE_MODEL)\n-    public <A extends Annotation> A getAnnotation(Class<A> annotationType) {\n-        return null;\n-    }\n-\n-\n-    @Override @DefinedBy(Api.LANGUAGE_MODEL)\n-    public <A extends Annotation> A[] getAnnotationsByType(Class<A> annotationType) {\n-        @SuppressWarnings(\"unchecked\")\n-        A[] tmp = (A[]) java.lang.reflect.Array.newInstance(annotationType, 0);\n-        return tmp;\n-    }\n-\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Type.java","additions":1,"deletions":15,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+import static com.sun.tools.javac.tree.JCTree.Tag.LITERAL;\n@@ -419,1 +420,1 @@\n-                    if (arg.type == syms.botType) {\n+                    if (arg.type == syms.botType && arg.hasTag(LITERAL)) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/jvm\/StringConcat.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -173,0 +173,8 @@\n+        \/\/ Initially, determine existing directory from class name.\n+        \/\/ [pack$age . ] na$me [ $ enclo$ed [$ dee$per] ]\n+        var lastDot = name.lastIndexOf(\".\");\n+        var packageName = lastDot == -1 ? \"\" : name.substring(0, lastDot);\n+        var packagePath = descriptor.sourceRootPath().resolve(packageName.replace('.', '\/'));\n+        \/\/ Trivial case: no matching directory exists\n+        if (!Files.isDirectory(packagePath)) return null;\n+\n@@ -174,4 +182,7 @@\n-        var firstDollarSign = name.indexOf('$'); \/\/ [package . ] name [ $ enclosed [$ deeper] ]\n-        var packageAndClassName = firstDollarSign == -1 ? name : name.substring(0, firstDollarSign);\n-        var path = packageAndClassName.replace('.', '\/') + \".java\";\n-        var file = descriptor.sourceRootPath().resolve(path);\n+        var candidate = name.substring(lastDot + 1, name.length()); \/\/ \"na$me$enclo$ed$dee$per\"\n+        \/\/ For each `$` in the name try to find the first matching compilation unit.\n+        while (candidate.contains(\"$\")) {\n+            if (Files.exists(packagePath.resolve(candidate + \".java\"))) break;\n+            candidate = candidate.substring(0, candidate.lastIndexOf(\"$\"));\n+        }\n+        var file = packagePath.resolve(candidate + \".java\");\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/launcher\/MemoryContext.java","additions":15,"deletions":4,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-import java.util.Collections;\n+import java.util.Comparator;\n@@ -44,0 +44,1 @@\n+import java.util.function.ToIntFunction;\n@@ -989,4 +990,1 @@\n-            if (deferredDiagnosticHandler != null) {\n-                deferredDiagnosticHandler.reportDeferredDiagnostics();\n-                log.popDiagnosticHandler(deferredDiagnosticHandler);\n-            }\n+            reportDeferredDiagnosticAndClearHandler();\n@@ -1199,2 +1197,1 @@\n-                deferredDiagnosticHandler.reportDeferredDiagnostics();\n-                log.popDiagnosticHandler(deferredDiagnosticHandler);\n+                reportDeferredDiagnosticAndClearHandler();\n@@ -1236,2 +1233,1 @@\n-                    deferredDiagnosticHandler.reportDeferredDiagnostics();\n-                    log.popDiagnosticHandler(deferredDiagnosticHandler);\n+                    reportDeferredDiagnosticAndClearHandler();\n@@ -1271,2 +1267,1 @@\n-                        deferredDiagnosticHandler.reportDeferredDiagnostics();\n-                        log.popDiagnosticHandler(deferredDiagnosticHandler);\n+                        reportDeferredDiagnosticAndClearHandler();\n@@ -1289,4 +1284,1 @@\n-            if (deferredDiagnosticHandler != null) {\n-                deferredDiagnosticHandler.reportDeferredDiagnostics();\n-                log.popDiagnosticHandler(deferredDiagnosticHandler);\n-            }\n+            reportDeferredDiagnosticAndClearHandler();\n@@ -1862,0 +1854,12 @@\n+    public void reportDeferredDiagnosticAndClearHandler() {\n+        if (deferredDiagnosticHandler != null) {\n+            ToIntFunction<JCDiagnostic> diagValue =\n+                    d -> d.isFlagSet(RECOVERABLE) ? 1 : 0;\n+            Comparator<JCDiagnostic> compareDiags =\n+                    (d1, d2) -> diagValue.applyAsInt(d1) - diagValue.applyAsInt(d2);\n+            deferredDiagnosticHandler.reportDeferredDiagnostics(compareDiags);\n+            log.popDiagnosticHandler(deferredDiagnosticHandler);\n+            deferredDiagnosticHandler = null;\n+        }\n+    }\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/main\/JavaCompiler.java","additions":19,"deletions":15,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -1271,3 +1271,1 @@\n-                deferredDiagnosticHandler.reportDeferredDiagnostics();\n-                log.popDiagnosticHandler(deferredDiagnosticHandler);\n-                compiler.setDeferredDiagnosticHandler(null);\n+                compiler.reportDeferredDiagnosticAndClearHandler();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/processing\/JavacProcessingEnvironment.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+import java.util.Comparator;\n@@ -175,0 +176,10 @@\n+\n+        \/** Report selected deferred diagnostics. *\/\n+        public void reportDeferredDiagnostics(Comparator<JCDiagnostic> order) {\n+            JCDiagnostic[] diags = deferred.toArray(s -> new JCDiagnostic[s]);\n+            Arrays.sort(diags, order);\n+            for (JCDiagnostic d : diags) {\n+                prev.report(d);\n+            }\n+            deferred = null; \/\/ prevent accidental ongoing use\n+        }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/util\/Log.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -65,4 +65,0 @@\n-  public Generation.Name kind() {\n-    return Generation.Name.DEF_NEW;\n-  }\n-\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/gc\/serial\/DefNewGeneration.java","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,4 +90,0 @@\n-  public Generation.Name kind() {\n-    return Generation.Name.MARK_SWEEP_COMPACT;\n-  }\n-\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/gc\/serial\/TenuredGeneration.java","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,6 +56,0 @@\n-  \/\/ constants from Name enum\n-  private static int NAME_DEF_NEW;\n-  private static int NAME_PAR_NEW;\n-  private static int NAME_MARK_SWEEP_COMPACT;\n-  private static int NAME_OTHER;\n-\n@@ -79,5 +73,0 @@\n-\n-    \/\/ constants from Generation::Name\n-    NAME_DEF_NEW = db.lookupIntConstant(\"Generation::DefNew\").intValue();\n-    NAME_MARK_SWEEP_COMPACT = db.lookupIntConstant(\"Generation::MarkSweepCompact\").intValue();\n-    NAME_OTHER = db.lookupIntConstant(\"Generation::Other\").intValue();\n@@ -90,31 +79,0 @@\n-  public static class Name {\n-    public static final Name DEF_NEW = new Name(\"DefNew\");\n-    public static final Name MARK_SWEEP_COMPACT = new Name(\"MarkSweepCompact\");\n-    public static final Name OTHER = new Name(\"Other\");\n-\n-    private Name(String value) {\n-      this.value = value;\n-    }\n-\n-    private String value;\n-    public String toString() {\n-      return value;\n-    }\n-  }\n-\n-  public Generation.Name kind() {\n-    return Generation.Name.OTHER;\n-  }\n-\n-  static Generation.Name nameForEnum(int value) {\n-     if (value == NAME_DEF_NEW) {\n-        return Name.DEF_NEW;\n-     } else if (value == NAME_MARK_SWEEP_COMPACT) {\n-        return Name.MARK_SWEEP_COMPACT;\n-     } else if (value == NAME_OTHER) {\n-        return Name.OTHER;\n-     } else {\n-        throw new RuntimeException(\"should not reach here\");\n-     }\n-  }\n-\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/gc\/shared\/Generation.java","additions":1,"deletions":43,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -223,0 +223,1 @@\n+            writer.tableOfContents.addLink(HtmlIds.forMemberSummary(kind), getSummaryLabel());\n@@ -309,0 +310,14 @@\n+    private Content getSummaryLabel() {\n+        return switch (kind) {\n+            case FIELDS -> contents.fieldSummaryLabel;\n+            case METHODS -> contents.methodSummary;\n+            case CONSTRUCTORS -> contents.constructorSummaryLabel;\n+            case ENUM_CONSTANTS -> contents.enumConstantSummary;\n+            case NESTED_CLASSES -> contents.nestedClassSummary;\n+            case PROPERTIES -> contents.propertySummaryLabel;\n+            case ANNOTATION_TYPE_MEMBER_OPTIONAL -> contents.annotateTypeOptionalMemberSummaryLabel;\n+            case ANNOTATION_TYPE_MEMBER_REQUIRED -> contents.annotateTypeRequiredMemberSummaryLabel;\n+            default -> throw new IllegalArgumentException(kind.toString());\n+        };\n+    }\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/AbstractMemberWriter.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -93,0 +93,2 @@\n+            writer.tableOfContents.addLink(HtmlIds.ANNOTATION_TYPE_ELEMENT_DETAIL, contents.annotationTypeDetailsLabel);\n+            writer.tableOfContents.pushNestedList();\n@@ -101,0 +103,2 @@\n+                writer.tableOfContents.addLink(htmlIds.forMember(typeElement, (ExecutableElement) member),\n+                        Text.of(name(member)));\n@@ -104,0 +108,1 @@\n+            writer.tableOfContents.popNestedList();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/AnnotationTypeMemberWriter.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,0 +37,1 @@\n+import javax.lang.model.element.ModuleElement;\n@@ -45,0 +46,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.Text;\n@@ -421,9 +423,13 @@\n-        Content mdleLinkContent = getModuleLink(utils.elementUtils.getModuleOf(typeElement),\n-                contents.moduleLabel);\n-        Content classLinkContent = getLink(new HtmlLinkInfo(\n-                configuration, HtmlLinkInfo.Kind.PLAIN, typeElement)\n-                .label(resources.getText(\"doclet.Class\"))\n-                .skipPreview(true));\n-        return super.getNavBar(pageMode, element)\n-                .setNavLinkModule(mdleLinkContent)\n-                .setNavLinkClass(classLinkContent);\n+        List<Content> subnavLinks = new ArrayList<>();\n+        if (configuration.showModules) {\n+            ModuleElement mdle = utils.elementUtils.getModuleOf(typeElement);\n+            subnavLinks.add(getModuleLink(mdle, Text.of(mdle.getQualifiedName())));\n+        }\n+        PackageElement pkg = utils.containingPackage(typeElement);\n+        subnavLinks.add(getPackageLink(pkg, getLocalizedPackageName(pkg)));\n+        subnavLinks.add(getLink(\n+                new HtmlLinkInfo(configuration, HtmlLinkInfo.Kind.PLAIN, typeElement)\n+                        .style(HtmlStyle.currentSelection)\n+                        .skipPreview(true)));\n+\n+        return super.getNavBar(pageMode, element).setSubNavLinks(subnavLinks);\n@@ -432,0 +438,1 @@\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/ClassUseWriter.java","additions":17,"deletions":10,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,1 +51,0 @@\n-import jdk.javadoc.internal.doclets.formats.html.markup.Entity;\n@@ -64,1 +63,0 @@\n-import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable;\n@@ -438,18 +436,0 @@\n-        if (configuration.showModules) {\n-            ModuleElement mdle = configuration.docEnv.getElementUtils().getModuleOf(typeElement);\n-            var classModuleLabel = HtmlTree.SPAN(HtmlStyle.moduleLabelInType, contents.moduleLabel);\n-            var moduleNameDiv = HtmlTree.DIV(HtmlStyle.subTitle, classModuleLabel);\n-            moduleNameDiv.add(Entity.NO_BREAK_SPACE);\n-            moduleNameDiv.add(getModuleLink(mdle,\n-                    Text.of(mdle.getQualifiedName())));\n-            div.add(moduleNameDiv);\n-        }\n-        PackageElement pkg = utils.containingPackage(typeElement);\n-        if (!pkg.isUnnamed()) {\n-            var classPackageLabel = HtmlTree.SPAN(HtmlStyle.packageLabelInType, contents.packageLabel);\n-            var pkgNameDiv = HtmlTree.DIV(HtmlStyle.subTitle, classPackageLabel);\n-            pkgNameDiv.add(Entity.NO_BREAK_SPACE);\n-            Content pkgNameContent = getPackageLink(pkg, getLocalizedPackageName(pkg));\n-            pkgNameDiv.add(pkgNameContent);\n-            div.add(pkgNameDiv);\n-        }\n@@ -475,15 +455,11 @@\n-        Content linkContent = getModuleLink(utils.elementUtils.getModuleOf(element),\n-                contents.moduleLabel);\n-        return super.getNavBar(pageMode, element)\n-                .setNavLinkModule(linkContent)\n-                .setSubNavLinks(() -> {\n-                    List<Content> list = new ArrayList<>();\n-                    VisibleMemberTable vmt = configuration.getVisibleMemberTable(typeElement);\n-                    Set<VisibleMemberTable.Kind> summarySet =\n-                            VisibleMemberTable.Kind.forSummariesOf(element.getKind());\n-                    for (VisibleMemberTable.Kind kind : summarySet) {\n-                        list.add(links.createLink(HtmlIds.forMemberSummary(kind),\n-                                contents.getNavLinkLabelContent(kind), vmt.hasVisibleMembers(kind)));\n-                    }\n-                    return list;\n-                });\n+        List<Content> subnavLinks = new ArrayList<>();\n+        if (configuration.showModules) {\n+            ModuleElement mdle = configuration.docEnv.getElementUtils().getModuleOf(typeElement);\n+            subnavLinks.add(getModuleLink(mdle, Text.of(mdle.getQualifiedName())));\n+        }\n+        PackageElement pkg = utils.containingPackage(typeElement);\n+        subnavLinks.add(getPackageLink(pkg, getLocalizedPackageName(pkg)));\n+        subnavLinks.add(getLink(new HtmlLinkInfo(configuration, HtmlLinkInfo.Kind.PLAIN, typeElement)\n+                        .style(HtmlStyle.currentSelection)\n+                        .skipPreview(true)));\n+        return super.getNavBar(pageMode, element).setSubNavLinks(subnavLinks);\n@@ -523,0 +499,1 @@\n+        tableOfContents.addLink(HtmlIds.TOP_OF_PAGE, contents.descriptionLabel);\n@@ -526,0 +503,1 @@\n+                tableOfContents.pushNestedList();\n@@ -527,0 +505,1 @@\n+                tableOfContents.popNestedList();\n@@ -538,0 +517,1 @@\n+            tableOfContents.pushNestedList();\n@@ -539,0 +519,1 @@\n+            tableOfContents.popNestedList();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/ClassWriter.java","additions":17,"deletions":36,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,1 +53,0 @@\n-import jdk.javadoc.internal.doclets.toolkit.util.DocLink;\n@@ -147,1 +146,2 @@\n-        Content contentList = getContentsHeader();\n+        tableOfContents.addLink(HtmlIds.TOP_OF_PAGE, Text.of(resources.getText(\"doclet.Constants_Summary\")))\n+                .pushNestedList();\n@@ -152,1 +152,1 @@\n-                addLinkToPackageContent(abbrevPackageName, contentList);\n+                addLinkToTableOfContents(abbrevPackageName);\n@@ -156,1 +156,2 @@\n-        addContentsList(contentList);\n+        tableOfContents.popNestedList();\n+        bodyContents.setSideContent(tableOfContents.toContent(true));\n@@ -325,4 +326,9 @@\n-        String label = resources.getText(\"doclet.Constants_Summary\");\n-        HtmlTree body = getBody(getWindowTitle(label));\n-        bodyContents.setHeader(getHeader(PageMode.CONSTANT_VALUES));\n-        return body;\n+         String label = resources.getText(\"doclet.Constants_Summary\");\n+         HtmlTree body = getBody(getWindowTitle(label));\n+         bodyContents.setHeader(getHeader(PageMode.CONSTANT_VALUES));\n+         Content titleContent = contents.constantsSummaryTitle;\n+         var pHeading = HtmlTree.HEADING_TITLE(Headings.PAGE_TITLE_HEADING,\n+                 HtmlStyle.title, titleContent);\n+         var div = HtmlTree.DIV(HtmlStyle.header, pHeading);\n+         bodyContents.addMainContent(div);\n+         return body;\n@@ -331,1 +337,1 @@\n-     Content getContentsHeader() {\n+    Content getContentsHeader() {\n@@ -335,3 +341,1 @@\n-     void addLinkToPackageContent(String abbrevPackageName, Content content) {\n-        \/\/add link to summary\n-        Content link;\n+    void addLinkToTableOfContents(String abbrevPackageName) {\n@@ -339,2 +343,1 @@\n-            link = links.createLink(HtmlIds.UNNAMED_PACKAGE_ANCHOR,\n-                    contents.defaultPackageLabel, \"\");\n+            tableOfContents.addLink(HtmlIds.UNNAMED_PACKAGE_ANCHOR, contents.defaultPackageLabel);\n@@ -342,3 +345,1 @@\n-            Content packageNameContent = Text.of(abbrevPackageName + \".*\");\n-            link = links.createLink(DocLink.fragment(abbrevPackageName),\n-                    packageNameContent, \"\");\n+            tableOfContents.addLink(HtmlId.of(abbrevPackageName), Text.of(abbrevPackageName + \".*\"));\n@@ -346,15 +347,0 @@\n-        content.add(HtmlTree.LI(link));\n-    }\n-\n-     void addContentsList(Content content) {\n-        Content titleContent = contents.constantsSummaryTitle;\n-        var pHeading = HtmlTree.HEADING_TITLE(Headings.PAGE_TITLE_HEADING,\n-                HtmlStyle.title, titleContent);\n-        var div = HtmlTree.DIV(HtmlStyle.header, pHeading);\n-        bodyContents.addMainContent(div);\n-        Content headingContent = contents.contentsHeading;\n-        var heading = HtmlTree.HEADING_TITLE(Headings.CONTENT_HEADING,\n-                headingContent);\n-        var section = HtmlTree.SECTION(HtmlStyle.packages, heading);\n-        section.add(content);\n-        bodyContents.addMainContent(section);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/ConstantsSummaryWriter.java","additions":19,"deletions":33,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -105,0 +105,2 @@\n+            writer.tableOfContents.addLink(HtmlIds.CONSTRUCTOR_DETAIL, contents.constructorDetailsLabel);\n+            writer.tableOfContents.pushNestedList();\n@@ -117,0 +119,3 @@\n+                writer.tableOfContents.addLink(htmlIds.forMember(currentConstructor),\n+                        Text.of(utils.getSimpleName(constructor)\n+                                + utils.makeSignature(currentConstructor, typeElement, false, true)));\n@@ -120,0 +125,1 @@\n+            writer.tableOfContents.popNestedList();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/ConstructorWriter.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -107,0 +107,1 @@\n+    public final Content hideSidebar;\n@@ -172,0 +173,1 @@\n+    public final Content searchLabel;\n@@ -175,0 +177,1 @@\n+    public final Content showSidebar;\n@@ -182,0 +185,1 @@\n+    public final Content tableOfContentsLabel;\n@@ -256,0 +260,1 @@\n+        hideSidebar = getContent(\"doclet.hide_sidebar\");\n@@ -321,0 +326,1 @@\n+        searchLabel = getContent(\"doclet.search\");\n@@ -324,0 +330,1 @@\n+        showSidebar = getContent(\"doclet.show_sidebar\");\n@@ -331,0 +338,1 @@\n+        tableOfContentsLabel = getContent(\"doclet.table_of_contents\");\n@@ -437,1 +445,1 @@\n-    public Content join(Content separator, Collection<Content> items) {\n+    public Content join(Content separator, Collection<? extends Content> items) {\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/Contents.java","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -110,1 +110,1 @@\n-                        HtmlTree.INPUT(\"checkbox\", htmlId)\n+                        HtmlTree.INPUT(HtmlAttr.InputType.CHECKBOX, htmlId)\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/DeprecatedListWriter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;\n@@ -34,0 +35,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.Text;\n@@ -218,0 +220,1 @@\n+            List<Content> subnavLinks = new ArrayList<>();\n@@ -219,6 +222,11 @@\n-            Content mdleLinkContent = getModuleLink(utils.elementUtils.getModuleOf(element),\n-                    contents.moduleLabel);\n-            Content pkgLinkContent = getPackageLink(pkg, contents.packageLabel);\n-            return super.getNavBar(pageMode, element)\n-                    .setNavLinkModule(mdleLinkContent)\n-                    .setNavLinkPackage(pkgLinkContent);\n+            if (configuration.showModules) {\n+                var mdle = utils.elementUtils.getModuleOf(element);\n+                subnavLinks.add(links.createLink(pathToRoot.resolve(docPaths.moduleSummary(mdle)),\n+                        Text.of(mdle.getQualifiedName()),\n+                        pkg.isUnnamed() ? HtmlStyle.currentSelection : null, \"\"));\n+            }\n+            if (!pkg.isUnnamed()) {\n+                subnavLinks.add(links.createLink(pathString(pkg, DocPaths.PACKAGE_SUMMARY),\n+                        getLocalizedPackageName(pkg), HtmlStyle.currentSelection, \"\"));\n+            }\n+            return super.getNavBar(pageMode, element).setSubNavLinks(subnavLinks);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/DocFilesHandler.java","additions":15,"deletions":7,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,0 +72,2 @@\n+            writer.tableOfContents.addLink(HtmlIds.ENUM_CONSTANT_DETAIL, contents.enumConstantDetailLabel);\n+            writer.tableOfContents.pushNestedList();\n@@ -84,0 +86,1 @@\n+                writer.tableOfContents.addLink(htmlIds.forMember(currentElement), Text.of(name(currentElement)));\n@@ -88,0 +91,1 @@\n+            writer.tableOfContents.popNestedList();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/EnumConstantWriter.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -82,0 +82,2 @@\n+            writer.tableOfContents.addLink(HtmlIds.FIELD_DETAIL, contents.fieldDetailsLabel);\n+            writer.tableOfContents.pushNestedList();\n@@ -94,0 +96,1 @@\n+                writer.tableOfContents.addLink(htmlIds.forMember(currentElement), Text.of(name(element)));\n@@ -97,0 +100,1 @@\n+            writer.tableOfContents.popNestedList();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/FieldWriter.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,10 +125,0 @@\n-\n-    \/**\n-     * Headings for index frames pages.\n-     *\/\n-    static class IndexFrames {\n-        \/** Heading for a list of module names in an index frame. *\/\n-        static final TagName MODULE_HEADING = TagName.H2;\n-        \/** Heading for a list of package names in an index frame. *\/\n-        static final TagName PACKAGE_HEADING = TagName.H2;\n-    }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/Headings.java","additions":1,"deletions":11,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,0 @@\n-import javax.lang.model.element.Element;\n@@ -40,1 +39,0 @@\n-import jdk.javadoc.internal.doclets.toolkit.util.DocLink;\n@@ -88,0 +86,1 @@\n+                .setSideContent(tableOfContents.toContent(false))\n@@ -104,5 +103,4 @@\n-        var mainTOC = HtmlTree.UL(HtmlStyle.helpTOC);\n-\n-        content.add(HtmlTree.HEADING(Headings.PAGE_TITLE_HEADING, HtmlStyle.title,\n-                                        getContent(\"doclet.help.main_heading\")))\n-                .add(mainTOC)\n+        var mainHeading = getContent(\"doclet.help.main_heading\");\n+        tableOfContents.addLink(HtmlIds.TOP_OF_PAGE, mainHeading);\n+        tableOfContents.pushNestedList();\n+        content.add(HtmlTree.HEADING(Headings.PAGE_TITLE_HEADING, HtmlStyle.title, mainHeading))\n@@ -110,1 +108,1 @@\n-                .add(getNavigationSection(mainTOC))\n+                .add(getNavigationSection())\n@@ -112,1 +110,1 @@\n-                .add(getPageKindSection(mainTOC))\n+                .add(getPageKindSection())\n@@ -116,9 +114,1 @@\n-    }\n-\n-    @Override\n-    protected Navigation getNavBar(PageMode pageMode, Element element) {\n-        return super.getNavBar(pageMode, element)\n-                .setSubNavLinks(() -> List.of(\n-                        links.createLink(HtmlIds.HELP_NAVIGATION, contents.navHelpNavigation),\n-                        links.createLink(HtmlIds.HELP_PAGES, contents.navHelpPages))\n-                );\n+        tableOfContents.popNestedList();\n@@ -136,2 +126,0 @@\n-     * @param mainTOC the main table-of-contents\n-     *\n@@ -140,1 +128,1 @@\n-    private Content getNavigationSection(HtmlTree mainTOC) {\n+    private Content getNavigationSection() {\n@@ -159,1 +147,2 @@\n-        var subTOC = HtmlTree.UL(HtmlStyle.helpSubTOC);\n+        tableOfContents.addLink(HtmlIds.HELP_NAVIGATION, navHeading);\n+        tableOfContents.pushNestedList();\n@@ -165,1 +154,1 @@\n-            section = newHelpSection(getContent(\"doclet.help.search.head\"), PageMode.SEARCH, subTOC);\n+            section = newHelpSection(getContent(\"doclet.help.search.head\"), PageMode.SEARCH);\n@@ -167,1 +156,1 @@\n-            var searchExamples = HtmlTree.UL(HtmlStyle.helpSectionList);\n+            var searchExamples = HtmlTree.OL(HtmlStyle.tocList);\n@@ -182,4 +171,1 @@\n-\n-        mainTOC.add(HtmlTree.LI(new ContentBuilder(\n-                links.createLink(DocLink.fragment(HtmlIds.HELP_NAVIGATION.name()), navHeading),\n-                Text.of(\": \"), subTOC)));\n+        tableOfContents.popNestedList();\n@@ -203,2 +189,0 @@\n-     * @param mainTOC the main table-of-contents\n-     *\n@@ -207,1 +191,1 @@\n-    private Content getPageKindSection(HtmlTree mainTOC) {\n+    private Content getPageKindSection() {\n@@ -213,1 +197,2 @@\n-        var subTOC = HtmlTree.UL(HtmlStyle.helpSubTOC);\n+        tableOfContents.addLink(HtmlIds.HELP_PAGES, pageKindsHeading);\n+        tableOfContents.pushNestedList();\n@@ -219,1 +204,1 @@\n-            section = newHelpSection(contents.overviewLabel, PageMode.OVERVIEW, subTOC);\n+            section = newHelpSection(contents.overviewLabel, PageMode.OVERVIEW);\n@@ -229,1 +214,1 @@\n-            section = newHelpSection(contents.moduleLabel, PageMode.MODULE, subTOC);\n+            section = newHelpSection(contents.moduleLabel, PageMode.MODULE);\n@@ -241,1 +226,1 @@\n-        section = newHelpSection(contents.packageLabel, PageMode.PACKAGE, subTOC)\n+        section = newHelpSection(contents.packageLabel, PageMode.PACKAGE)\n@@ -263,1 +248,1 @@\n-        section = newHelpSection(getContent(\"doclet.help.class_interface.head\"), PageMode.CLASS, subTOC)\n+        section = newHelpSection(getContent(\"doclet.help.class_interface.head\"), PageMode.CLASS)\n@@ -294,1 +279,1 @@\n-        section = newHelpSection(getContent(\"doclet.help.other_files.head\"), PageMode.DOC_FILE, subTOC)\n+        section = newHelpSection(getContent(\"doclet.help.other_files.head\"), PageMode.DOC_FILE)\n@@ -300,1 +285,1 @@\n-            section = newHelpSection(getContent(\"doclet.help.use.head\"), PageMode.USE, subTOC)\n+            section = newHelpSection(getContent(\"doclet.help.use.head\"), PageMode.USE)\n@@ -307,1 +292,1 @@\n-            section = newHelpSection(getContent(\"doclet.help.tree.head\"), PageMode.TREE, subTOC);\n+            section = newHelpSection(getContent(\"doclet.help.tree.head\"), PageMode.TREE);\n@@ -320,1 +305,1 @@\n-            section = newHelpSection(contents.previewAPI, PageMode.PREVIEW, subTOC);\n+            section = newHelpSection(contents.previewAPI, PageMode.PREVIEW);\n@@ -329,1 +314,1 @@\n-            section = newHelpSection(contents.newAPI, PageMode.NEW, subTOC);\n+            section = newHelpSection(contents.newAPI, PageMode.NEW);\n@@ -338,1 +323,1 @@\n-            section = newHelpSection(contents.deprecatedAPI, PageMode.DEPRECATED, subTOC);\n+            section = newHelpSection(contents.deprecatedAPI, PageMode.DEPRECATED);\n@@ -347,1 +332,1 @@\n-            section = newHelpSection(contents.restrictedMethods, PageMode.RESTRICTED, subTOC);\n+            section = newHelpSection(contents.restrictedMethods, PageMode.RESTRICTED);\n@@ -356,1 +341,1 @@\n-            section = newHelpSection(contents.constantsSummaryTitle, PageMode.CONSTANT_VALUES, subTOC);\n+            section = newHelpSection(contents.constantsSummaryTitle, PageMode.CONSTANT_VALUES);\n@@ -365,1 +350,1 @@\n-            section = newHelpSection(contents.serializedForm, PageMode.SERIALIZED_FORM, subTOC)\n+            section = newHelpSection(contents.serializedForm, PageMode.SERIALIZED_FORM)\n@@ -372,1 +357,1 @@\n-            section = newHelpSection(contents.systemPropertiesLabel, PageMode.SYSTEM_PROPERTIES, subTOC);\n+            section = newHelpSection(contents.systemPropertiesLabel, PageMode.SYSTEM_PROPERTIES);\n@@ -381,1 +366,1 @@\n-            section = newHelpSection(contents.externalSpecifications, PageMode.EXTERNAL_SPECS, subTOC);\n+            section = newHelpSection(contents.externalSpecifications, PageMode.EXTERNAL_SPECS);\n@@ -391,1 +376,1 @@\n-                section = newHelpSection(getContent(\"doclet.help.all_packages.head\"), PageMode.ALL_PACKAGES, subTOC)\n+                section = newHelpSection(getContent(\"doclet.help.all_packages.head\"), PageMode.ALL_PACKAGES)\n@@ -396,1 +381,1 @@\n-            section = newHelpSection(getContent(\"doclet.help.all_classes.head\"), PageMode.ALL_CLASSES, subTOC)\n+            section = newHelpSection(getContent(\"doclet.help.all_classes.head\"), PageMode.ALL_CLASSES)\n@@ -406,1 +391,1 @@\n-            section = newHelpSection(getContent(\"doclet.help.index.head\"), PageMode.INDEX, subTOC)\n+            section = newHelpSection(getContent(\"doclet.help.index.head\"), PageMode.INDEX)\n@@ -410,4 +395,1 @@\n-\n-        mainTOC.add(HtmlTree.LI(new ContentBuilder(\n-                links.createLink(DocLink.fragment(HtmlIds.HELP_PAGES.name()), pageKindsHeading),\n-                Text.of(\": \"), subTOC)));\n+        tableOfContents.popNestedList();\n@@ -430,3 +412,2 @@\n-    private HtmlTree newHelpSection(Content headingContent, HtmlTree toc, HtmlId id) {\n-        Content link = links.createLink(DocLink.fragment(id.name()), headingContent);\n-        toc.add(HtmlTree.LI(link));\n+    private HtmlTree newHelpSection(Content headingContent, HtmlId id) {\n+        tableOfContents.addLink(id, headingContent);\n@@ -439,2 +420,2 @@\n-    private HtmlTree newHelpSection(Content headingContent, Navigation.PageMode pm, HtmlTree toc) {\n-        return newHelpSection(headingContent, toc, htmlIds.forPage(pm));\n+    private HtmlTree newHelpSection(Content headingContent, Navigation.PageMode pm) {\n+        return newHelpSection(headingContent, htmlIds.forPage(pm));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HelpWriter.java","additions":41,"deletions":60,"binary":false,"changes":101,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -236,1 +236,0 @@\n-        boolean nodeprecated = options.noDeprecated();\n@@ -312,1 +311,1 @@\n-        copyResource(DocPaths.SCRIPT_JS, DocPaths.SCRIPT_FILES.resolve(DocPaths.SCRIPT_JS), true);\n+        copyResource(DocPaths.SCRIPT_JS_TEMPLATE, DocPaths.SCRIPT_FILES.resolve(DocPaths.SCRIPT_JS), true);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDoclet.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,1 @@\n+import java.util.LinkedHashMap;\n@@ -73,0 +74,1 @@\n+import com.sun.source.doctree.IndexTree;\n@@ -85,0 +87,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.HtmlAttr;\n@@ -90,0 +93,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.ListBuilder;\n@@ -165,0 +169,2 @@\n+    protected final TableOfContents tableOfContents;\n+\n@@ -220,0 +226,1 @@\n+        this.tableOfContents = new TableOfContents(this);\n@@ -1468,0 +1475,9 @@\n+            } else if (docTree instanceof IndexTree index) {\n+                DocTree searchTerm = index.getSearchTerm();\n+                String tagText = (searchTerm instanceof TextTree tt) ? tt.getBody() : \"\";\n+                if (tagText.charAt(0) == '\"' && tagText.charAt(tagText.length() - 1) == '\"') {\n+                    tagText = tagText.substring(1, tagText.length() - 1);\n+                }\n+                sb.append(tagText);\n+            } else if (docTree instanceof EntityTree entity) {\n+                sb.append(utils.docTrees.getCharacters(entity));\n@@ -1486,0 +1502,2 @@\n+        } else {\n+            headingIds.add(id);\n@@ -1496,0 +1514,4 @@\n+        \/\/ Record second-level headings for use in table of contents\n+        if (tableOfContents != null && node.getName().toString().equalsIgnoreCase(\"h2\")) {\n+            tableOfContents.addLink(HtmlId.of(id), Text.of(headingContent));\n+        }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDocletWriter.java","additions":23,"deletions":1,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,0 +70,1 @@\n+    static final HtmlId TOP_OF_PAGE = HtmlId.of(\"\"); \/\/ empty fragment\/id indicates top of page\n@@ -93,1 +94,0 @@\n-    static final HtmlId NAVBAR_SUB_LIST = HtmlId.of(\"navbar-sub-list\");\n@@ -104,1 +104,1 @@\n-    static final HtmlId RESET_BUTTON = HtmlId.of(\"reset-button\");\n+    static final HtmlId RESET_SEARCH = HtmlId.of(\"reset-search\");\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlIds.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,0 @@\n-import java.util.function.Consumer;\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlLinkFactory.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -88,1 +88,1 @@\n-    private String fragment = \"\";\n+    private String fragment = null;\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlLinkInfo.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -288,1 +288,1 @@\n-            List<? extends DeprecatedTree> tags = utils.getDeprecatedTrees(element);\n+            var tags = utils.getDeprecatedTrees(element);\n@@ -290,1 +290,1 @@\n-                addInlineDeprecatedComment(element, tags.get(0), div);\n+                addInlineDeprecatedComment(element, tags.getFirst(), div);\n@@ -353,1 +353,1 @@\n-        List<Content> pageLinks = Stream.of(IndexItem.Category.values())\n+        var pageLinks = Stream.of(IndexItem.Category.values())\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/IndexWriter.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -104,0 +104,2 @@\n+            writer.tableOfContents.addLink(HtmlIds.METHOD_DETAIL, contents.methodDetailLabel);\n+            writer.tableOfContents.pushNestedList();\n@@ -117,0 +119,3 @@\n+                writer.tableOfContents.addLink(htmlIds.forMember(currentMethod),\n+                        Text.of(utils.getSimpleName(method)\n+                                + utils.makeSignature(currentMethod, typeElement, false, true)));\n@@ -120,0 +125,1 @@\n+            writer.tableOfContents.popNestedList();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/MethodWriter.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -254,0 +254,1 @@\n+        tableOfContents.addLink(HtmlIds.TOP_OF_PAGE, contents.navDescription);\n@@ -255,0 +256,1 @@\n+            tableOfContents.pushNestedList();\n@@ -256,0 +258,1 @@\n+            tableOfContents.popNestedList();\n@@ -277,10 +280,4 @@\n-                .setSubNavLinks(() -> List.of(\n-                        links.createLink(HtmlIds.MODULE_DESCRIPTION, contents.navDescription,\n-                            !utils.getFullBody(mdle).isEmpty() && !options.noComment()),\n-                        links.createLink(HtmlIds.MODULES, contents.navModules,\n-                            display(requires) || display(indirectModules)),\n-                        links.createLink(HtmlIds.PACKAGES, contents.navPackages,\n-                            display(packages) || display(indirectPackages) || display(indirectOpenPackages)),\n-                        links.createLink(HtmlIds.SERVICES, contents.navServices,\n-                            displayServices(uses, usesTrees) || displayServices(provides.keySet(), providesTrees))\n-                ));\n+                .setSubNavLinks(List.of(\n+                    links.createLink(pathToRoot.resolve(docPaths.moduleSummary(mdle)),\n+                            Text.of(mdle.getQualifiedName()),\n+                            HtmlStyle.currentSelection, \"\")));\n@@ -539,0 +536,1 @@\n+            tableOfContents.addLink(HtmlIds.MODULES, contents.navModules);\n@@ -583,0 +581,1 @@\n+            tableOfContents.addLink(HtmlIds.PACKAGES, contents.navPackages);\n@@ -753,0 +752,1 @@\n+            tableOfContents.addLink(HtmlIds.SERVICES, contents.navServices);\n@@ -892,0 +892,1 @@\n+        bodyContents.setSideContent(tableOfContents.toContent(false));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/ModuleWriter.java","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,0 @@\n-import java.util.Set;\n@@ -70,3 +69,0 @@\n-    private Content navLinkModule;\n-    private Content navLinkPackage;\n-    private Content navLinkClass;\n@@ -75,3 +71,1 @@\n-    private final Content searchLabel;\n-    private final String searchPlaceholder;\n-    private SubNavLinks subNavLinks;\n+    private List<Content> subNavLinks = List.of();\n@@ -102,12 +96,0 @@\n-    \/**\n-     * An interface to provide links for the subnavigation area.\n-     *\/\n-    public interface SubNavLinks {\n-        \/**\n-         * {@return a list of links to display in the subnavigation area}\n-         * Links should be wrapped in {@code HtmlTree.LI} elements as they are\n-         * displayed within an unordered list.\n-         *\/\n-        List<Content> getSubNavLinks();\n-    }\n-\n@@ -134,17 +116,0 @@\n-        this.searchLabel = contents.getContent(\"doclet.search\");\n-        this.searchPlaceholder = configuration.getDocResources().getText(\"doclet.search_placeholder\");\n-    }\n-\n-    public Navigation setNavLinkModule(Content navLinkModule) {\n-        this.navLinkModule = navLinkModule;\n-        return this;\n-    }\n-\n-    public Navigation setNavLinkPackage(Content navLinkPackage) {\n-        this.navLinkPackage = navLinkPackage;\n-        return this;\n-    }\n-\n-    public Navigation setNavLinkClass(Content navLinkClass) {\n-        this.navLinkClass = navLinkClass;\n-        return this;\n@@ -158,1 +123,1 @@\n-    public Navigation setSubNavLinks(SubNavLinks subNavLinks) {\n+    public Navigation setSubNavLinks(List<Content> subNavLinks) {\n@@ -172,4 +137,0 @@\n-                addModuleLink(target);\n-                addPackageLink(target);\n-                addPageLabel(target, contents.classLabel, true);\n-                addPageLabel(target, contents.useLabel, options.classUse());\n@@ -181,0 +142,1 @@\n+                addSearchLink(target);\n@@ -186,3 +148,0 @@\n-                addPackageLink(target);\n-                addPageLabel(target, contents.classLabel, true);\n-                addPageLabel(target, contents.useLabel, options.classUse());\n@@ -194,0 +153,1 @@\n+                addSearchLink(target);\n@@ -198,1 +158,0 @@\n-                addModuleOfElementLink(target);\n@@ -200,1 +159,0 @@\n-                addPageLabel(target, contents.classLabel, true);\n@@ -213,0 +171,1 @@\n+                addSearchLink(target);\n@@ -217,2 +176,0 @@\n-                addModuleOfElementLink(target);\n-                addPackageSummaryLink(target);\n@@ -232,0 +189,1 @@\n+                addSearchLink(target);\n@@ -236,7 +194,4 @@\n-                addModuleOfElementLink(target);\n-                if (element instanceof PackageElement) {\n-                    addPackageSummaryLink(target);\n-                    addPageLabel(target, contents.classLabel, true);\n-                } else {\n-                    addPackageOfElementLink(target);\n-                    addItemToList(target, navLinkClass);\n+                \/\/ Class-use page is still generated for deprecated classes with\n+                \/\/ -nodeprecated option, make sure not to link to non-existent page.\n+                if (!options.noDeprecated() || !configuration.utils.isDeprecated(element)) {\n+                    addPageElementLink(target);\n@@ -245,6 +200,8 @@\n-                if (element instanceof PackageElement) {\n-                    addItemToList(target, links.createLink(DocPaths.PACKAGE_TREE, contents.treeLabel));\n-                } else {\n-                    addItemToList(target, configuration.utils.isEnclosingPackageIncluded((TypeElement) element)\n-                            ? links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_TREE), contents.treeLabel)\n-                            : links.createLink(pathToRoot.resolve(DocPaths.OVERVIEW_TREE), contents.treeLabel));\n+                if (options.createTree()) {\n+                    if (configuration.utils.isPackage(element)) {\n+                        addItemToList(target, links.createLink(DocPaths.PACKAGE_TREE, contents.treeLabel));\n+                    } else {\n+                        addItemToList(target, configuration.utils.isEnclosingPackageIncluded((TypeElement) element)\n+                                ? links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_TREE), contents.treeLabel)\n+                                : links.createLink(pathToRoot.resolve(DocPaths.OVERVIEW_TREE), contents.treeLabel));\n+                    }\n@@ -256,0 +213,1 @@\n+                addSearchLink(target);\n@@ -260,6 +218,7 @@\n-                if (element == null) {\n-                    addPageLabel(target, contents.moduleLabel, configuration.showModules);\n-                    addPageLabel(target, contents.packageLabel, true);\n-                } else {\n-                    addModuleOfElementLink(target);\n-                    addPackageSummaryLink(target);\n+                if (element != null && !configuration.utils.isModule(element)) {\n+                    addPageElementLink(target);\n+                    if (options.classUse()) {\n+                        if (configuration.utils.isPackage(element) || configuration.utils.isTypeElement(element)) {\n+                            addItemToList(target, links.createLink(DocPaths.PACKAGE_USE, contents.useLabel));\n+                        }\n+                    }\n@@ -267,2 +226,0 @@\n-                addPageLabel(target, contents.classLabel, true);\n-                addPageLabel(target, contents.useLabel, options.classUse());\n@@ -274,0 +231,1 @@\n+                addSearchLink(target);\n@@ -281,0 +239,1 @@\n+            case SEARCH:\n@@ -282,4 +241,0 @@\n-                addModuleLink(target);\n-                addPackageLink(target);\n-                addPageLabel(target, contents.classLabel, true);\n-                addPageLabel(target, contents.useLabel, options.classUse());\n@@ -310,0 +265,5 @@\n+                if (documentedPage == PageMode.SEARCH) {\n+                    addActivePageLink(target, contents.searchLabel, options.createIndex());\n+                } else {\n+                    addSearchLink(target);\n+                }\n@@ -322,1 +282,0 @@\n-            case SEARCH:\n@@ -325,4 +284,0 @@\n-                addModuleLink(target);\n-                addPackageLink(target);\n-                addPageLabel(target, contents.classLabel, true);\n-                addPageLabel(target, contents.useLabel, options.classUse());\n@@ -334,0 +289,1 @@\n+                addSearchLink(target);\n@@ -338,5 +294,17 @@\n-                addModuleOfElementLink(target);\n-                addItemToList(target, navLinkPackage);\n-                addPageLabel(target, contents.classLabel, true);\n-                addPageLabel(target, contents.useLabel, options.classUse());\n-                addTreeLink(target);\n+                if (element != null) {\n+                    addPageElementLink(target);\n+                    if (options.classUse()) {\n+                        if (configuration.utils.isPackage(element)) {\n+                            addItemToList(target, links.createLink(pathToRoot.resolve(\n+                                    configuration.docPaths.forPackage((PackageElement) element)\n+                                            .resolve(DocPaths.PACKAGE_USE)), contents.useLabel));\n+                        }\n+                    }\n+                    if (options.createTree() && configuration.utils.isPackage(element)) {\n+                        addItemToList(target, links.createLink(pathToRoot.resolve(\n+                                configuration.docPaths.forPackage((PackageElement) element)\n+                                        .resolve(DocPaths.PACKAGE_TREE)), contents.treeLabel));\n+                    } else {\n+                        addTreeLink(target);\n+                    }\n+                }\n@@ -347,0 +315,1 @@\n+                addSearchLink(target);\n@@ -358,32 +327,0 @@\n-     * @param nested whether to create a flat or nested list\n-     *\/\n-    private void addSummaryLinks(Content target, boolean nested) {\n-        switch (documentedPage) {\n-            case MODULE, PACKAGE, CLASS, HELP -> {\n-                List<? extends Content> listContents = subNavLinks.getSubNavLinks()\n-                        .stream().map(HtmlTree::LI).toList();\n-                if (!listContents.isEmpty()) {\n-                Content label = switch (documentedPage) {\n-                        case MODULE -> contents.moduleSubNavLabel;\n-                        case PACKAGE -> contents.packageSubNavLabel;\n-                        case CLASS -> contents.summaryLabel;\n-                        case HELP -> contents.helpSubNavLabel;\n-                        default -> Text.EMPTY;\n-                    };\n-                    if (nested) {\n-                        target.add(HtmlTree.LI(HtmlTree.P(label))\n-                                .add(new HtmlTree(TagName.UL).add(listContents)));\n-                    } else {\n-                        target.add(HtmlTree.LI(label).add(Entity.NO_BREAK_SPACE));\n-                        addListToNav(listContents, target);\n-                    }\n-                }\n-            }\n-        }\n-    }\n-\n-    \/**\n-     * Adds the detail links to subnavigation.\n-     *\n-     * @param target the content to which the links will be added\n-     * @param nested whether to create a flat or nested list\n@@ -391,20 +328,4 @@\n-    private void addDetailLinks(Content target, boolean nested) {\n-        if (documentedPage == PageMode.CLASS) {\n-            List<Content> listContents = new ArrayList<>();\n-            VisibleMemberTable vmt = configuration.getVisibleMemberTable((TypeElement) element);\n-            Set<VisibleMemberTable.Kind> detailSet = VisibleMemberTable.Kind.forDetailsOf(element.getKind());\n-            for (VisibleMemberTable.Kind kind : detailSet) {\n-                addTypeDetailLink(kind, !vmt.getVisibleMembers(kind).isEmpty(), listContents);\n-            }\n-            if (!listContents.isEmpty()) {\n-                if (nested) {\n-                    var li = HtmlTree.LI(HtmlTree.P(contents.detailLabel));\n-                    li.add(new HtmlTree(TagName.UL).add(listContents));\n-                    target.add(li);\n-                } else {\n-                    var li = HtmlTree.LI(contents.detailLabel);\n-                    li.add(Entity.NO_BREAK_SPACE);\n-                    target.add(li);\n-                    addListToNav(listContents, target);\n-                }\n-            }\n+    private void addSummaryLinks(Content target) {\n+        List<? extends Content> listContents = subNavLinks.stream().map(HtmlTree::LI).toList();\n+        if (!listContents.isEmpty()) {\n+            addListToNav(listContents, target);\n@@ -423,6 +344,6 @@\n-            case CONSTRUCTORS -> links.createLink(HtmlIds.CONSTRUCTOR_DETAIL, contents.navConstructor, link);\n-            case ENUM_CONSTANTS -> links.createLink(HtmlIds.ENUM_CONSTANT_DETAIL, contents.navEnum, link);\n-            case FIELDS -> links.createLink(HtmlIds.FIELD_DETAIL, contents.navField, link);\n-            case METHODS -> links.createLink(HtmlIds.METHOD_DETAIL, contents.navMethod, link);\n-            case PROPERTIES -> links.createLink(HtmlIds.PROPERTY_DETAIL, contents.navProperty, link);\n-            case ANNOTATION_TYPE_MEMBER -> links.createLink(HtmlIds.ANNOTATION_TYPE_ELEMENT_DETAIL,\n+            case CONSTRUCTORS -> links.createLinkOrLabel(HtmlIds.CONSTRUCTOR_DETAIL, contents.navConstructor, link);\n+            case ENUM_CONSTANTS -> links.createLinkOrLabel(HtmlIds.ENUM_CONSTANT_DETAIL, contents.navEnum, link);\n+            case FIELDS -> links.createLinkOrLabel(HtmlIds.FIELD_DETAIL, contents.navField, link);\n+            case METHODS -> links.createLinkOrLabel(HtmlIds.METHOD_DETAIL, contents.navMethod, link);\n+            case PROPERTIES -> links.createLinkOrLabel(HtmlIds.PROPERTY_DETAIL, contents.navProperty, link);\n+            case ANNOTATION_TYPE_MEMBER -> links.createLinkOrLabel(HtmlIds.ANNOTATION_TYPE_ELEMENT_DETAIL,\n@@ -444,5 +365,4 @@\n-        for (Content liContent : listContents) {\n-            if (count < listContents.size() - 1) {\n-                liContent.add(Entity.NO_BREAK_SPACE);\n-                liContent.add(\"|\");\n-                liContent.add(Entity.NO_BREAK_SPACE);\n+        for (Content item : listContents) {\n+            target.add(item);\n+            if (count++ < listContents.size() - 1) {\n+                target.add(Entity.NO_BREAK_SPACE).add(Entity.of(\"gt\")).add(Entity.NO_BREAK_SPACE);\n@@ -450,2 +370,0 @@\n-            target.add(liContent);\n-            count++;\n@@ -461,6 +379,6 @@\n-    private void addPageLabel(Content target, Content label, boolean display) {\n-        if (display) {\n-            target.add(HtmlTree.LI(label));\n-        }\n-    }\n-\n+    \/**\n+     * Adds a link to the overview page if indicated by the configuration.\n+     * Otherwise a link to the first module or package is added.\n+     *\n+     * @param target content to add the link to\n+     *\/\n@@ -471,7 +389,3 @@\n-        }\n-    }\n-\n-    private void addModuleLink(Content target) {\n-        if (configuration.showModules) {\n-            if (configuration.modules.size() == 1) {\n-                ModuleElement mdle = configuration.modules.first();\n+        } else if (configuration.showModules && configuration.modules.size() > 0) {\n+            ModuleElement mdle = configuration.modules.first();\n+            if (!mdle.equals(element)) {\n@@ -482,2 +396,0 @@\n-            } else if (!configuration.modules.isEmpty()) {\n-                addPageLabel(target, contents.moduleLabel, true);\n@@ -485,11 +397,1 @@\n-        }\n-    }\n-\n-    private void addModuleOfElementLink(Content target) {\n-        if (configuration.showModules) {\n-            target.add(HtmlTree.LI(navLinkModule));\n-        }\n-    }\n-\n-    private void addPackageLink(Content target) {\n-        if (configuration.packages.size() == 1) {\n+        } else if (configuration.packages.size() > 0 && !(element instanceof PackageElement)) {\n@@ -515,2 +417,0 @@\n-                } else {\n-                    target.add(HtmlTree.LI(contents.packageLabel));\n@@ -519,2 +419,0 @@\n-        } else if (!configuration.packages.isEmpty()) {\n-            addPageLabel(target, contents.packageLabel, true);\n@@ -524,4 +422,0 @@\n-    private void addPackageOfElementLink(Content target) {\n-        target.add(HtmlTree.LI(links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_SUMMARY),\n-                contents.packageLabel)));\n-    }\n@@ -529,2 +423,11 @@\n-    private void addPackageSummaryLink(Content target) {\n-        target.add(HtmlTree.LI(links.createLink(DocPaths.PACKAGE_SUMMARY, contents.packageLabel)));\n+    private void addPageElementLink(Content list) {\n+        Content link = switch (element) {\n+            case ModuleElement mdle -> links.createLink(pathToRoot.resolve(\n+                    configuration.docPaths.moduleSummary(mdle)), contents.moduleLabel);\n+            case PackageElement pkg -> links.createLink(pathToRoot.resolve(\n+                    configuration.docPaths.forPackage(pkg).resolve(DocPaths.PACKAGE_SUMMARY)), contents.packageLabel);\n+            case TypeElement type -> links.createLink(pathToRoot.resolve(\n+                    configuration.docPaths.forClass(type)), contents.classLabel);\n+            default -> throw new RuntimeException();\n+        };\n+        list.add(HtmlTree.LI(link));\n@@ -574,0 +477,7 @@\n+    private void addSearchLink(Content target) {\n+        if (options.createIndex()) {\n+            target.add(HtmlTree.LI(links.createLink(\n+                    pathToRoot.resolve(DocPaths.SEARCH_PAGE), contents.searchLabel, \"\")));\n+        }\n+    }\n+\n@@ -591,10 +501,11 @@\n-        String reset = \"reset\";\n-        var inputText = HtmlTree.INPUT(\"text\", HtmlIds.SEARCH_INPUT)\n-                .put(HtmlAttr.PLACEHOLDER, searchPlaceholder);\n-        var inputReset = HtmlTree.INPUT(reset, HtmlIds.RESET_BUTTON)\n-                .put(HtmlAttr.VALUE, reset);\n-        var searchDiv = HtmlTree.DIV(HtmlStyle.navListSearch,\n-                links.createLink(pathToRoot.resolve(DocPaths.SEARCH_PAGE),\n-                        searchLabel, \"\"));\n-        searchDiv.add(inputText);\n-        searchDiv.add(inputReset);\n+        var resources = configuration.getDocResources();\n+        var inputText = HtmlTree.INPUT(HtmlAttr.InputType.TEXT, HtmlIds.SEARCH_INPUT)\n+                .put(HtmlAttr.PLACEHOLDER, resources.getText(\"doclet.search_placeholder\"))\n+                .put(HtmlAttr.ARIA_LABEL, resources.getText(\"doclet.search_in_documentation\"))\n+                .put(HtmlAttr.AUTOCOMPLETE, \"off\")\n+                .put(HtmlAttr.AUTOCAPITALIZE, \"off\");\n+        var inputReset = HtmlTree.INPUT(HtmlAttr.InputType.RESET, HtmlIds.RESET_SEARCH)\n+                .put(HtmlAttr.VALUE, resources.getText(\"doclet.search_reset\"));\n+        var searchDiv = HtmlTree.DIV(HtmlStyle.navListSearch)\n+                .add(inputText)\n+                .add(inputReset);\n@@ -615,1 +526,1 @@\n-        var navDiv = new HtmlTree(TagName.DIV);\n+        var navContent = new HtmlTree(TagName.DIV);\n@@ -621,9 +532,8 @@\n-        navDiv.setStyle(HtmlStyle.topNav)\n-                .setId(HtmlIds.NAVBAR_TOP)\n-                .add(new HtmlTree(TagName.BUTTON).setId(HtmlIds.NAVBAR_TOGGLE_BUTTON)\n-                        .put(HtmlAttr.ARIA_CONTROLS, HtmlIds.NAVBAR_TOP.name())\n-                        .put(HtmlAttr.ARIA_EXPANDED, String.valueOf(false))\n-                        .put(HtmlAttr.ARIA_LABEL, toggleNavLinks)\n-                        .add(iconSpan)\n-                        .add(iconSpan)\n-                        .add(iconSpan))\n+        navContent.setStyle(HtmlStyle.navContent).add(HtmlTree.DIV(HtmlStyle.navMenuButton,\n+                        new HtmlTree(TagName.BUTTON).setId(HtmlIds.NAVBAR_TOGGLE_BUTTON)\n+                                .put(HtmlAttr.ARIA_CONTROLS, HtmlIds.NAVBAR_TOP.name())\n+                                .put(HtmlAttr.ARIA_EXPANDED, String.valueOf(false))\n+                                .put(HtmlAttr.ARIA_LABEL, toggleNavLinks)\n+                                .add(iconSpan)\n+                                .add(iconSpan)\n+                                .add(iconSpan)))\n@@ -634,1 +544,0 @@\n-        boolean addSearch = options.createIndex() && documentedPage != PageMode.SEARCH;\n@@ -636,2 +545,0 @@\n-        var aboutDiv = HtmlTree.DIV(HtmlStyle.aboutLanguage, aboutContent);\n-        navDiv.add(aboutDiv);\n@@ -643,22 +550,14 @@\n-        navDiv.add(navList);\n-        var ulNavSummaryRight = HtmlTree.UL(HtmlStyle.subNavListSmall);\n-        addSummaryLinks(ulNavSummaryRight, true);\n-        addDetailLinks(ulNavSummaryRight, true);\n-        navDiv.add(ulNavSummaryRight);\n-        navigationBar.add(navDiv);\n-\n-        var subDiv = HtmlTree.DIV(HtmlStyle.subNav);\n-\n-        var div = new HtmlTree(TagName.DIV).setId(HtmlIds.NAVBAR_SUB_LIST);\n-        \/\/ Add the summary links if present.\n-        var ulNavSummary = HtmlTree.UL(HtmlStyle.subNavList);\n-        addSummaryLinks(ulNavSummary, false);\n-        div.add(ulNavSummary);\n-        \/\/ Add the detail links if present.\n-        var ulNavDetail = HtmlTree.UL(HtmlStyle.subNavList);\n-        addDetailLinks(ulNavDetail, false);\n-        div.add(ulNavDetail);\n-        subDiv.add(div);\n-\n-        if (addSearch) {\n-            addSearch(subDiv);\n+        navContent.add(navList);\n+        var aboutDiv = HtmlTree.DIV(HtmlStyle.aboutLanguage, aboutContent);\n+        navContent.add(aboutDiv);\n+        navigationBar.add(HtmlTree.DIV(HtmlStyle.topNav, navContent).setId(HtmlIds.NAVBAR_TOP));\n+\n+        var subNavContent = HtmlTree.DIV(HtmlStyle.navContent);\n+\n+        \/\/ Add the breadcrumb navigation links if present.\n+        var ulBreadcrumbNav = HtmlTree.OL(HtmlStyle.subNavList);\n+        addSummaryLinks(ulBreadcrumbNav);\n+        subNavContent.addUnchecked(ulBreadcrumbNav);\n+\n+        if (options.createIndex() && documentedPage != PageMode.SEARCH) {\n+            addSearch(subNavContent);\n@@ -666,1 +565,1 @@\n-        navigationBar.add(subDiv);\n+        navigationBar.add(HtmlTree.DIV(HtmlStyle.subNav, subNavContent));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/Navigation.java","additions":130,"deletions":231,"binary":false,"changes":361,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -91,1 +91,1 @@\n-                                HtmlTree.INPUT(\"checkbox\", htmlId)\n+                                HtmlTree.INPUT(HtmlAttr.InputType.CHECKBOX, htmlId)\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/NewAPIListWriter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,0 +36,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.Text;\n@@ -40,0 +41,3 @@\n+import java.util.ArrayList;\n+import java.util.List;\n+\n@@ -131,4 +135,8 @@\n-        Content linkContent = getModuleLink(utils.elementUtils.getModuleOf(packageElement),\n-                contents.moduleLabel);\n-        return super.getNavBar(pageMode, element)\n-                .setNavLinkModule(linkContent);\n+        List<Content> subnavLinks = new ArrayList<>();\n+        if (configuration.showModules) {\n+            var mdle = utils.elementUtils.getModuleOf(packageElement);\n+            subnavLinks.add(getModuleLink(mdle, Text.of(mdle.getQualifiedName())));\n+        }\n+        subnavLinks.add(links.createLink(pathString(packageElement, DocPaths.PACKAGE_SUMMARY),\n+                getLocalizedPackageName(packageElement), HtmlStyle.currentSelection, \"\"));\n+        return super.getNavBar(pageMode, element).setSubNavLinks(subnavLinks);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PackageTreeWriter.java","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import java.util.ArrayList;\n+import java.util.List;\n@@ -219,4 +221,8 @@\n-        Content linkContent = getModuleLink(utils.elementUtils.getModuleOf(element),\n-                contents.moduleLabel);\n-        return super.getNavBar(pageMode, element)\n-                .setNavLinkModule(linkContent);\n+        List<Content> subnavLinks = new ArrayList<>();\n+        if (configuration.showModules) {\n+            var mdle = utils.elementUtils.getModuleOf(packageElement);\n+            subnavLinks.add(getModuleLink(mdle, Text.of(mdle.getQualifiedName())));\n+        }\n+        subnavLinks.add(links.createLink(pathString(packageElement, DocPaths.PACKAGE_SUMMARY),\n+                getLocalizedPackageName(packageElement), HtmlStyle.currentSelection, \"\"));\n+        return super.getNavBar(pageMode, element).setSubNavLinks(subnavLinks);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PackageUseWriter.java","additions":11,"deletions":5,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -45,1 +45,0 @@\n-import jdk.javadoc.internal.doclets.formats.html.markup.Entity;\n@@ -75,1 +74,1 @@\n-    private final HtmlTree section = HtmlTree.SECTION(HtmlStyle.packageDescription);\n+    private final HtmlTree section = HtmlTree.SECTION(HtmlStyle.packageDescription, new ContentBuilder());\n@@ -182,2 +181,3 @@\n-        if (!options.noComment()) {\n-            addPackageDescription(packageContent);\n+        tableOfContents.addLink(HtmlIds.TOP_OF_PAGE, contents.navDescription);\n+        if (options.noComment()) {\n+            return;\n@@ -185,0 +185,3 @@\n+        tableOfContents.pushNestedList();\n+        addPackageDescription(packageContent);\n+        tableOfContents.popNestedList();\n@@ -193,2 +196,2 @@\n-        if (!options.noComment()) {\n-            addPackageTags(packageContent);\n+        if (options.noComment()) {\n+            return;\n@@ -196,0 +199,1 @@\n+        addPackageTags(packageContent);\n@@ -202,9 +206,0 @@\n-        if (configuration.showModules) {\n-            ModuleElement mdle = configuration.docEnv.getElementUtils().getModuleOf(packageElement);\n-            var classModuleLabel = HtmlTree.SPAN(HtmlStyle.moduleLabelInPackage, contents.moduleLabel);\n-            var moduleNameDiv = HtmlTree.DIV(HtmlStyle.subTitle, classModuleLabel);\n-            moduleNameDiv.add(Entity.NO_BREAK_SPACE);\n-            moduleNameDiv.add(getModuleLink(mdle,\n-                    Text.of(mdle.getQualifiedName().toString())));\n-            div.add(moduleNameDiv);\n-        }\n@@ -278,11 +273,9 @@\n-        Content linkContent = getModuleLink(utils.elementUtils.getModuleOf(packageElement),\n-                contents.moduleLabel);\n-        return super.getNavBar(pageMode, element)\n-                .setNavLinkModule(linkContent)\n-                .setSubNavLinks(() -> List.of(\n-                        links.createLink(HtmlIds.PACKAGE_DESCRIPTION, contents.navDescription,\n-                                !utils.getFullBody(packageElement).isEmpty() && !options.noComment()),\n-                        links.createLink(HtmlIds.RELATED_PACKAGE_SUMMARY, contents.relatedPackages,\n-                                relatedPackages != null && !relatedPackages.isEmpty()),\n-                        links.createLink(HtmlIds.CLASS_SUMMARY, contents.navClassesAndInterfaces,\n-                                allClasses != null && !allClasses.isEmpty())));\n+        List<Content> subnavLinks = new ArrayList<>();\n+        if (configuration.showModules) {\n+            ModuleElement mdle = configuration.docEnv.getElementUtils().getModuleOf(packageElement);\n+            subnavLinks.add(links.createLink(pathToRoot.resolve(docPaths.moduleSummary(mdle)),\n+                    Text.of(mdle.getQualifiedName())));\n+        }\n+        subnavLinks.add(links.createLink(pathString(packageElement, DocPaths.PACKAGE_SUMMARY),\n+                getLocalizedPackageName(packageElement), HtmlStyle.currentSelection, \"\"));\n+        return super.getNavBar(pageMode, element).setSubNavLinks(subnavLinks);\n@@ -322,2 +315,1 @@\n-        addPackageSummary(relatedPackages, contents.relatedPackages, tableHeader,\n-                summaryContent, showModules);\n+        addRelatedPackageSummary(tableHeader, summaryContent, showModules);\n@@ -362,0 +354,1 @@\n+            tableOfContents.addLink(HtmlIds.CLASS_SUMMARY, contents.navClassesAndInterfaces);\n@@ -366,4 +359,4 @@\n-    protected void addPackageSummary(List<PackageElement> packages, Content label,\n-                                  TableHeader tableHeader, Content summaryContent,\n-                                  boolean showModules) {\n-        if (!packages.isEmpty()) {\n+    protected void addRelatedPackageSummary(TableHeader tableHeader, Content summaryContent,\n+                                     boolean showModules) {\n+        if (!relatedPackages.isEmpty()) {\n+            tableOfContents.addLink(HtmlIds.RELATED_PACKAGE_SUMMARY, contents.relatedPackages);\n@@ -372,1 +365,1 @@\n-                    .setCaption(label)\n+                    .setCaption(contents.relatedPackages)\n@@ -380,1 +373,1 @@\n-            for (PackageElement pkg : packages) {\n+            for (PackageElement pkg : relatedPackages) {\n@@ -430,0 +423,1 @@\n+        bodyContents.setSideContent(tableOfContents.toContent(false));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PackageWriter.java","additions":29,"deletions":35,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -91,1 +91,1 @@\n-                                HtmlTree.INPUT(\"checkbox\", htmlId)\n+                                HtmlTree.INPUT(HtmlAttr.InputType.CHECKBOX, htmlId)\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PreviewListWriter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -77,0 +77,2 @@\n+            writer.tableOfContents.addLink(HtmlIds.PROPERTY_DETAIL, contents.propertyDetailsLabel);\n+            writer.tableOfContents.pushNestedList();\n@@ -89,0 +91,2 @@\n+                writer.tableOfContents.addLink(htmlIds.forProperty(currentProperty),\n+                        Text.of(utils.getPropertyLabel(name(property))));\n@@ -92,0 +96,1 @@\n+            writer.tableOfContents.popNestedList();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PropertyWriter.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -84,3 +84,6 @@\n-                .add(HtmlTree.DIV(HtmlTree.INPUT(\"text\", HtmlId.of(\"page-search-input\"))\n-                                .put(HtmlAttr.PLACEHOLDER, resources.getText(\"doclet.search_placeholder\")))\n-                        .add(HtmlTree.INPUT(\"reset\", HtmlId.of(\"page-search-reset\"))\n+                .add(HtmlTree.DIV(HtmlTree.INPUT(HtmlAttr.InputType.TEXT, HtmlId.of(\"page-search-input\"))\n+                                .put(HtmlAttr.PLACEHOLDER, resources.getText(\"doclet.search_placeholder\"))\n+                                .put(HtmlAttr.ARIA_LABEL, resources.getText(\"doclet.search_in_documentation\"))\n+                                .put(HtmlAttr.AUTOCOMPLETE, \"off\")\n+                                .put(HtmlAttr.AUTOCAPITALIZE, \"off\"))\n+                        .add(HtmlTree.INPUT(HtmlAttr.InputType.RESET, HtmlId.of(\"page-search-reset\"))\n@@ -107,1 +110,1 @@\n-                        .add(HtmlTree.P(HtmlTree.INPUT(\"checkbox\", HtmlId.of(\"search-redirect\")))\n+                        .add(HtmlTree.P(HtmlTree.INPUT(HtmlAttr.InputType.CHECKBOX, HtmlId.of(\"search-redirect\")))\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/SearchWriter.java","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -190,1 +190,1 @@\n-     * @param source class content which will be added to the documentation\n+     * @param classContent class content which will be added to the documentation\n@@ -192,2 +192,3 @@\n-    public void addClassContent(Content source) {\n-        bodyContents.addMainContent(source);\n+    public void addClassContent(Content classContent) {\n+        bodyContents.addMainContent(classContent);\n+        bodyContents.setSideContent(tableOfContents.toContent(true));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/SubWriterHolderWriter.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import java.util.Arrays;\n@@ -157,3 +156,2 @@\n-                document.addEventListener(\"DOMContentLoaded\", function(e) {\n-                    document.querySelectorAll('input[type=\"checkbox\"]').forEach(\n-                        function(c) {\n+                document.addEventListener(\"DOMContentLoaded\", (e) => {\n+                    document.querySelectorAll('main input[type=\"checkbox\"]').forEach((c) => {\n@@ -165,2 +163,1 @@\n-                    document.querySelectorAll('input[type=\"checkbox\"]').forEach(\n-                        function(c) {\n+                    document.querySelectorAll('main input[type=\"checkbox\"]').forEach((c) => {\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/SummaryListWriter.java","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -0,0 +1,113 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package jdk.javadoc.internal.doclets.formats.html;\n+\n+import jdk.javadoc.internal.doclets.formats.html.markup.Entity;\n+import jdk.javadoc.internal.doclets.formats.html.markup.HtmlAttr;\n+import jdk.javadoc.internal.doclets.formats.html.markup.HtmlId;\n+import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;\n+import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;\n+import jdk.javadoc.internal.doclets.formats.html.markup.ListBuilder;\n+import jdk.javadoc.internal.doclets.formats.html.markup.TagName;\n+import jdk.javadoc.internal.doclets.formats.html.markup.Text;\n+\n+\/**\n+ * A class used by various {@link HtmlDocletWriter} subclasses to build tables of contents.\n+ *\/\n+public class TableOfContents {\n+    private final ListBuilder listBuilder;\n+    private final HtmlDocletWriter writer;\n+\n+    \/**\n+     * Constructor\n+     * @param writer the writer\n+     *\/\n+    public TableOfContents(HtmlDocletWriter writer) {\n+        this.writer = writer;\n+        listBuilder = new ListBuilder(HtmlTree.OL(HtmlStyle.tocList));\n+    }\n+\n+    \/**\n+     * Adds a link to the table of contents.\n+     * @param id the link fragment\n+     * @param label the link label\n+     * @return this object\n+     *\/\n+    public TableOfContents addLink(HtmlId id, Content label) {\n+        listBuilder.add(writer.links.createLink(id, label).put(HtmlAttr.TABINDEX, \"0\"));\n+        return this;\n+    }\n+\n+    \/**\n+     * Adds a new nested list to add new items to.\n+     *\/\n+    public void pushNestedList() {\n+        listBuilder.pushNestedList(HtmlTree.OL(HtmlStyle.tocList));\n+    }\n+\n+    \/**\n+     * Closes the current nested list and go back to the parent list.\n+     *\/\n+    public void popNestedList() {\n+        listBuilder.popNestedList();\n+    }\n+\n+    \/**\n+     * Returns a content object containing the table of contents, consisting\n+     * of a header and the contents list itself. If the contents list is empty,\n+     * an empty content object is returned.\n+     *\n+     * @param hasFilterInput whether to add a filter text input\n+     * @return a content object\n+     *\/\n+    protected Content toContent(boolean hasFilterInput) {\n+        if (listBuilder.isEmpty()) {\n+            return Text.EMPTY;\n+        }\n+        var content = HtmlTree.NAV()\n+                .setStyle(HtmlStyle.toc)\n+                .put(HtmlAttr.ARIA_LABEL, writer.resources.getText(\"doclet.table_of_contents\"));\n+        var header = HtmlTree.DIV(HtmlStyle.tocHeader, writer.contents.contentsHeading);\n+        if (hasFilterInput) {\n+            header.add(Entity.NO_BREAK_SPACE)\n+                    .add(HtmlTree.INPUT(HtmlAttr.InputType.TEXT, HtmlStyle.filterInput)\n+                            .put(HtmlAttr.PLACEHOLDER, writer.resources.getText(\"doclet.filter_label\"))\n+                            .put(HtmlAttr.ARIA_LABEL, writer.resources.getText(\"doclet.filter_table_of_contents\"))\n+                            .put(HtmlAttr.AUTOCOMPLETE, \"off\")\n+                            .put(HtmlAttr.AUTOCAPITALIZE, \"off\"))\n+                    .add(HtmlTree.INPUT(HtmlAttr.InputType.RESET, HtmlStyle.resetFilter)\n+                            .put(HtmlAttr.VALUE, writer.resources.getText(\"doclet.filter_reset\")));\n+        }\n+        content.add(header);\n+        content.add(new HtmlTree(TagName.BUTTON).addStyle(HtmlStyle.hideSidebar)\n+                .add(HtmlTree.SPAN(writer.contents.hideSidebar).add(Entity.NO_BREAK_SPACE))\n+                .add(Entity.LEFT_POINTING_ANGLE));\n+        content.add(new HtmlTree(TagName.BUTTON).addStyle(HtmlStyle.showSidebar)\n+                .add(Entity.RIGHT_POINTING_ANGLE)\n+                .add(HtmlTree.SPAN(Entity.NO_BREAK_SPACE).add(writer.contents.showSidebar)));\n+        return content.add(listBuilder);\n+    }\n+\n+}\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/TableOfContents.java","additions":113,"deletions":0,"binary":false,"changes":113,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,2 +40,3 @@\n- * header that is always visible, and main content that\n- * can be scrolled if necessary.\n+ * header that is always visible, main content that\n+ * can be scrolled if necessary, and optional side and footer\n+ * contents that are only rendered if available.\n@@ -46,0 +47,1 @@\n+    private Content side = null;\n@@ -54,0 +56,5 @@\n+    public BodyContents setSideContent(Content side) {\n+        this.side = Objects.requireNonNull(side);\n+        return this;\n+    }\n+\n@@ -92,2 +99,5 @@\n-                .add(HtmlTree.MAIN().add(mainContents))\n-                .add(footer == null ? Text.EMPTY : footer);\n+                .add(HtmlTree.DIV(HtmlStyle.mainGrid)\n+                        .add(side == null ? Text.EMPTY : side)\n+                        .add(HtmlTree.MAIN()\n+                                .add(mainContents)\n+                                .add(footer == null ? Text.EMPTY : footer)));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/BodyContents.java","additions":15,"deletions":5,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,0 +41,2 @@\n+    public static final Entity LEFT_POINTING_ANGLE = new Entity(\"&#10094;\");\n+    public static final Entity RIGHT_POINTING_ANGLE = new Entity(\"&#10095;\");\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/Entity.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -354,1 +354,1 @@\n-                mainBodyScript.append(\"var pathtoroot = \")\n+                mainBodyScript.append(\"const pathtoroot = \")\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/Head.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,0 +41,2 @@\n+    AUTOCOMPLETE,\n+    AUTOCAPITALIZE,\n@@ -94,0 +96,17 @@\n+    public enum InputType {\n+\n+        CHECKBOX,\n+        RESET,\n+        TEXT;\n+\n+        private final String type;\n+\n+        InputType() {\n+            type = Utils.toLowerCase(name());\n+        }\n+\n+        public String toString() {\n+            return type;\n+        }\n+    }\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/HtmlAttr.java","additions":20,"deletions":1,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -57,1 +57,7 @@\n-    \/\/ {@code header} and {@code footer} elements on each page.\n+    \/\/ {@code header} element on each page, as well as the side navigation bar that displays\n+    \/\/ the table of contents on some pages.\n+\n+    \/**\n+     * The class for the link representing the current element in breadcrumb navigation and table of contents.\n+     *\/\n+    currentSelection,\n@@ -70,0 +76,15 @@\n+    \/**\n+     * The class for the {@code input} element to filter items in the table of contents.\n+     *\/\n+    filterInput,\n+\n+    \/**\n+     * The class for the {@code button} element to hide the sidebar.\n+     *\/\n+    hideSidebar,\n+\n+    \/**\n+     * The class for the {@code div} element containing the sidebar and main content.\n+     *\/\n+    mainGrid,\n+\n@@ -82,0 +103,10 @@\n+    \/**\n+     * The class for the {@code div} element containing navigation elements.\n+     *\/\n+    navContent,\n+\n+    \/**\n+     * The class for the {@code div} element containing the button to show or hide the menu.\n+     *\/\n+    navMenuButton,\n+\n@@ -92,0 +123,10 @@\n+    \/**\n+     * The class for the reset button in the sidebar filter input element.\n+     *\/\n+    resetFilter,\n+\n+    \/**\n+     * The class for the {@code button} element to show the sidebar.\n+     *\/\n+    showSidebar,\n+\n@@ -110,1 +151,11 @@\n-     * The class for the list of subsidiary navigation links for smaller displays.\n+     * The class for a {@code nav} element containing a table of contents.\n+     *\/\n+    toc,\n+\n+    \/**\n+     * The class for the {@code div} element representing the header of the table of contents.\n+     *\/\n+    tocHeader,\n+\n+    \/**\n+     * The class used for list elements in the table of contents.\n@@ -112,1 +163,1 @@\n-    subNavListSmall,\n+    tocList,\n@@ -127,15 +178,0 @@\n-    \/**\n-     * The class for the \"module\" label in the heading for a package declaration.\n-     *\/\n-    moduleLabelInPackage,\n-\n-    \/**\n-     * The class for the \"module\" label in the heading for a type declaration.\n-     *\/\n-    moduleLabelInType,\n-\n-    \/**\n-     * The class for the \"package\" label in the heading for a type declaration.\n-     *\/\n-    packageLabelInType,\n-\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/HtmlStyle.java","additions":55,"deletions":19,"binary":false,"changes":74,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -589,1 +589,1 @@\n-    public static HtmlTree INPUT(String type, HtmlId id) {\n+    public static HtmlTree INPUT(HtmlAttr.InputType type, HtmlId id) {\n@@ -591,1 +591,1 @@\n-                .put(HtmlAttr.TYPE, type)\n+                .put(HtmlAttr.TYPE, type.toString())\n@@ -596,0 +596,13 @@\n+    \/**\n+     * Creates an HTML {@code INPUT} element with the given type\n+     * and style. The element is marked as initially disabled.\n+     * @param type  the input type\n+     * @param style the input style\n+     * @return      the element\n+     *\/\n+    public static HtmlTree INPUT(HtmlAttr.InputType type, HtmlStyle style) {\n+        return new HtmlTree(TagName.INPUT)\n+                .put(HtmlAttr.TYPE, type.toString())\n+                .setStyle(style)\n+                .put(HtmlAttr.DISABLED, \"\");\n+    }\n@@ -721,0 +734,11 @@\n+    \/**\n+     * Creates an HTML {@code OL} element with the given style.\n+     *\n+     * @param style the style\n+     * @return the element\n+     *\/\n+    public static HtmlTree OL(HtmlStyle style) {\n+        return new HtmlTree(TagName.OL)\n+                .setStyle(style);\n+    }\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/HtmlTree.java","additions":27,"deletions":3,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,1 @@\n-    public Content createLink(HtmlId id, Content label) {\n+    public HtmlTree createLink(HtmlId id, Content label) {\n@@ -70,1 +70,1 @@\n-    public Content createLink(HtmlId id, Content label, boolean link) {\n+    public Content createLinkOrLabel(HtmlId id, Content label, boolean link) {\n@@ -83,1 +83,1 @@\n-    public Content createLink(HtmlId id, Content label, String title) {\n+    public HtmlTree createLink(HtmlId id, Content label, String title) {\n@@ -95,1 +95,1 @@\n-    public Content createLink(DocPath path, String label) {\n+    public HtmlTree createLink(DocPath path, String label) {\n@@ -106,1 +106,1 @@\n-    public Content createLink(DocPath path, Content label) {\n+    public HtmlTree createLink(DocPath path, Content label) {\n@@ -120,1 +120,1 @@\n-    public Content createLink(DocPath path, Content label, HtmlStyle style, String title) {\n+    public HtmlTree createLink(DocPath path, Content label, HtmlStyle style, String title) {\n@@ -132,1 +132,1 @@\n-    public Content createLink(DocPath path, Content label, String title) {\n+    public HtmlTree createLink(DocPath path, Content label, String title) {\n@@ -155,1 +155,1 @@\n-    public Content createLink(DocLink link, Content label, String title) {\n+    public HtmlTree createLink(DocLink link, Content label, String title) {\n@@ -173,1 +173,1 @@\n-    public Content createLink(DocLink link, Content label, HtmlStyle style,\n+    public HtmlTree createLink(DocLink link, Content label, HtmlStyle style,\n@@ -189,1 +189,1 @@\n-    public Content createLink(DocLink link, Content label, HtmlStyle style,\n+    public HtmlTree createLink(DocLink link, Content label, HtmlStyle style,\n@@ -212,1 +212,1 @@\n-    public Content createExternalLink(DocLink link, Content label) {\n+    public HtmlTree createExternalLink(DocLink link, Content label) {\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/Links.java","additions":12,"deletions":12,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -0,0 +1,115 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.javadoc.internal.doclets.formats.html.markup;\n+\n+import java.io.IOException;\n+import java.io.Writer;\n+import java.util.ArrayDeque;\n+import java.util.Deque;\n+import java.util.NoSuchElementException;\n+import java.util.Objects;\n+\n+import jdk.javadoc.internal.doclets.formats.html.Content;\n+\n+\/**\n+ * A utility class for building nested HTML lists. This class is implemented as a\n+ * stack of nested list\/item pairs where list items are added to the inner-most\n+ * list and nested lists are added to the current list item of the inner-most list.\n+ * Lists can be added to and removed from the stack using the {@link #pushNestedList}\n+ * and {@link #popNestedList} methods.\n+ *\/\n+public class ListBuilder extends Content {\n+\n+    private final HtmlTree root;\n+    private record Pair(HtmlTree list, HtmlTree item) {}\n+    private final Deque<Pair> stack = new ArrayDeque<>();\n+    private HtmlTree currentList;\n+    private HtmlTree currentItem;\n+\n+    \/**\n+     * Creates a new list builder.\n+     *\n+     * @param list the root list element\n+     *\/\n+    public ListBuilder(HtmlTree list) {\n+        Objects.requireNonNull(list, \"Root list element is required\");\n+        root = currentList = list;\n+    }\n+\n+    \/**\n+     * Adds a new list item with the given content to the current list. The last added list item\n+     * will also be used as container when pushing a new nested list.\n+     *\n+     * @param listItemContent the content for the new list item.\n+     * @return this list builder\n+     *\/\n+    public ListBuilder add(Content listItemContent) {\n+        currentItem = HtmlTree.LI(listItemContent);\n+        currentList.addUnchecked(currentItem);\n+        return this;\n+    }\n+\n+    \/**\n+     * Adds a new nested list to the current list item and makes it the recipient for new list items.\n+     * Note that the nested list is added even if empty; use {@code addNested} to avoid adding empty\n+     * lists.\n+     *\n+     * @param list the nested list\n+     * @return this list builder\n+     *\/\n+    public ListBuilder pushNestedList(HtmlTree list) {\n+        Objects.requireNonNull(currentItem, \"List item required for nested list\");\n+        stack.push(new Pair(currentList, currentItem));\n+        currentList = list;\n+        currentItem = null;\n+        return this;\n+    }\n+\n+    \/**\n+     * Pops the current list from the stack and returns to adding list items to the parent list.\n+     *\n+     * @return this list builder\n+     * @throws NoSuchElementException if the stack is empty\n+     *\/\n+    public ListBuilder popNestedList() {\n+        Pair pair = stack.pop();\n+        \/\/ First restore currentItem and add nested list to it before restoring currentList to outer list.\n+        currentItem = pair.item;\n+        currentItem.add(currentList);\n+        currentList = pair.list;\n+        return this;\n+    }\n+\n+    @Override\n+    public boolean write(Writer writer, String newline, boolean atNewline) throws IOException {\n+        return root.write(writer, newline, atNewline);\n+    }\n+\n+    @Override\n+    public boolean isEmpty() {\n+        return root.isEmpty();\n+    }\n+}\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/ListBuilder.java","additions":115,"deletions":0,"binary":false,"changes":115,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,1 @@\n+    ASIDE,\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/TagName.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1,236 +0,0 @@\n-\/*\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-var moduleSearchIndex;\n-var packageSearchIndex;\n-var typeSearchIndex;\n-var memberSearchIndex;\n-var tagSearchIndex;\n-\n-var oddRowColor = \"odd-row-color\";\n-var evenRowColor = \"even-row-color\";\n-var sortAsc = \"sort-asc\";\n-var sortDesc = \"sort-desc\";\n-var tableTab = \"table-tab\";\n-var activeTableTab = \"active-table-tab\";\n-\n-function loadScripts(doc, tag) {\n-    createElem(doc, tag, 'script-files\/search.js');\n-\n-    createElem(doc, tag, 'module-search-index.js');\n-    createElem(doc, tag, 'package-search-index.js');\n-    createElem(doc, tag, 'type-search-index.js');\n-    createElem(doc, tag, 'member-search-index.js');\n-    createElem(doc, tag, 'tag-search-index.js');\n-}\n-\n-function createElem(doc, tag, path) {\n-    var script = doc.createElement(tag);\n-    var scriptElement = doc.getElementsByTagName(tag)[0];\n-    script.src = pathtoroot + path;\n-    scriptElement.parentNode.insertBefore(script, scriptElement);\n-}\n-\n-\/\/ Helper for  making content containing release names comparable lexicographically\n-function makeComparable(s) {\n-    return s.toLowerCase().replace(\/(\\d+)\/g,\n-        function(n, m) {\n-            return (\"000\" + m).slice(-4);\n-        });\n-}\n-\n-\/\/ Switches between two styles depending on a condition\n-function toggleStyle(classList, condition, trueStyle, falseStyle) {\n-    if (condition) {\n-        classList.remove(falseStyle);\n-        classList.add(trueStyle);\n-    } else {\n-        classList.remove(trueStyle);\n-        classList.add(falseStyle);\n-    }\n-}\n-\n-\/\/ Sorts the rows in a table lexicographically by the content of a specific column\n-function sortTable(header, columnIndex, columns) {\n-    var container = header.parentElement;\n-    var descending = header.classList.contains(sortAsc);\n-    container.querySelectorAll(\"div.table-header\").forEach(\n-        function(header) {\n-            header.classList.remove(sortAsc);\n-            header.classList.remove(sortDesc);\n-        }\n-    )\n-    var cells = container.children;\n-    var rows = [];\n-    for (var i = columns; i < cells.length; i += columns) {\n-        rows.push(Array.prototype.slice.call(cells, i, i + columns));\n-    }\n-    var comparator = function(a, b) {\n-        var ka = makeComparable(a[columnIndex].textContent);\n-        var kb = makeComparable(b[columnIndex].textContent);\n-        if (ka < kb)\n-            return descending ? 1 : -1;\n-        if (ka > kb)\n-            return descending ? -1 : 1;\n-        return 0;\n-    };\n-    var sorted = rows.sort(comparator);\n-    var visible = 0;\n-    sorted.forEach(function(row) {\n-        if (row[0].style.display !== 'none') {\n-            var isEvenRow = visible++ % 2 === 0;\n-        }\n-        row.forEach(function(cell) {\n-            toggleStyle(cell.classList, isEvenRow, evenRowColor, oddRowColor);\n-            container.appendChild(cell);\n-        })\n-    });\n-    toggleStyle(header.classList, descending, sortDesc, sortAsc);\n-}\n-\n-\/\/ Toggles the visibility of a table category in all tables in a page\n-function toggleGlobal(checkbox, selected, columns) {\n-    var display = checkbox.checked ? '' : 'none';\n-    document.querySelectorAll(\"div.table-tabs\").forEach(function(t) {\n-        var id = t.parentElement.getAttribute(\"id\");\n-        var selectedClass = id + \"-tab\" + selected;\n-        \/\/ if selected is empty string it selects all uncategorized entries\n-        var selectUncategorized = !Boolean(selected);\n-        var visible = 0;\n-        document.querySelectorAll('div.' + id)\n-            .forEach(function(elem) {\n-                if (selectUncategorized) {\n-                    if (elem.className.indexOf(selectedClass) === -1) {\n-                        elem.style.display = display;\n-                    }\n-                } else if (elem.classList.contains(selectedClass)) {\n-                    elem.style.display = display;\n-                }\n-                if (elem.style.display === '') {\n-                    var isEvenRow = visible++ % (columns * 2) < columns;\n-                    toggleStyle(elem.classList, isEvenRow, evenRowColor, oddRowColor);\n-                }\n-            });\n-        var displaySection = visible === 0 ? 'none' : '';\n-        t.parentElement.style.display = displaySection;\n-        document.querySelector(\"li#contents-\" + id).style.display = displaySection;\n-    })\n-}\n-\n-\/\/ Shows the elements of a table belonging to a specific category\n-function show(tableId, selected, columns) {\n-    if (tableId !== selected) {\n-        document.querySelectorAll('div.' + tableId + ':not(.' + selected + ')')\n-            .forEach(function(elem) {\n-                elem.style.display = 'none';\n-            });\n-    }\n-    document.querySelectorAll('div.' + selected)\n-        .forEach(function(elem, index) {\n-            elem.style.display = '';\n-            var isEvenRow = index % (columns * 2) < columns;\n-            toggleStyle(elem.classList, isEvenRow, evenRowColor, oddRowColor);\n-        });\n-    updateTabs(tableId, selected);\n-}\n-\n-function updateTabs(tableId, selected) {\n-    document.querySelector('div#' + tableId +' .summary-table')\n-        .setAttribute('aria-labelledby', selected);\n-    document.querySelectorAll('button[id^=\"' + tableId + '\"]')\n-        .forEach(function(tab, index) {\n-            if (selected === tab.id || (tableId === selected && index === 0)) {\n-                tab.className = activeTableTab;\n-                tab.setAttribute('aria-selected', true);\n-                tab.setAttribute('tabindex',0);\n-            } else {\n-                tab.className = tableTab;\n-                tab.setAttribute('aria-selected', false);\n-                tab.setAttribute('tabindex',-1);\n-            }\n-        });\n-}\n-\n-function switchTab(e) {\n-    var selected = document.querySelector('[aria-selected=true]');\n-    if (selected) {\n-        if ((e.keyCode === 37 || e.keyCode === 38) && selected.previousSibling) {\n-            \/\/ left or up arrow key pressed: move focus to previous tab\n-            selected.previousSibling.click();\n-            selected.previousSibling.focus();\n-            e.preventDefault();\n-        } else if ((e.keyCode === 39 || e.keyCode === 40) && selected.nextSibling) {\n-            \/\/ right or down arrow key pressed: move focus to next tab\n-            selected.nextSibling.click();\n-            selected.nextSibling.focus();\n-            e.preventDefault();\n-        }\n-    }\n-}\n-\n-var updateSearchResults = function() {};\n-\n-function indexFilesLoaded() {\n-    return moduleSearchIndex\n-        && packageSearchIndex\n-        && typeSearchIndex\n-        && memberSearchIndex\n-        && tagSearchIndex;\n-}\n-\/\/ Copy the contents of the local snippet to the clipboard\n-function copySnippet(button) {\n-    copyToClipboard(button.nextElementSibling.innerText);\n-    switchCopyLabel(button, button.firstElementChild);\n-}\n-function copyToClipboard(content) {\n-    var textarea = document.createElement(\"textarea\");\n-    textarea.style.height = 0;\n-    document.body.appendChild(textarea);\n-    textarea.value = content;\n-    textarea.select();\n-    document.execCommand(\"copy\");\n-    document.body.removeChild(textarea);\n-}\n-function switchCopyLabel(button, span) {\n-    var copied = span.getAttribute(\"data-copied\");\n-    button.classList.add(\"visible\");\n-    var initialLabel = span.innerHTML;\n-    span.innerHTML = copied;\n-    setTimeout(function() {\n-        button.classList.remove(\"visible\");\n-        setTimeout(function() {\n-            if (initialLabel !== copied) {\n-                span.innerHTML = initialLabel;\n-            }\n-        }, 100);\n-    }, 1900);\n-}\n-\/\/ Dynamically set scroll margin to accomodate for draft header\n-document.addEventListener(\"DOMContentLoaded\", function(e) {\n-    document.querySelectorAll(':not(input)[id]').forEach(\n-        function(c) {\n-            c.style[\"scroll-margin-top\"] = Math.ceil(document.querySelector(\"header\").offsetHeight) + \"px\"\n-        });\n-});\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/script.js","additions":0,"deletions":236,"binary":false,"changes":236,"status":"deleted"},{"patch":"@@ -0,0 +1,481 @@\n+\/*\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+var moduleSearchIndex;\n+var packageSearchIndex;\n+var typeSearchIndex;\n+var memberSearchIndex;\n+var tagSearchIndex;\n+\n+var oddRowColor = \"odd-row-color\";\n+var evenRowColor = \"even-row-color\";\n+var sortAsc = \"sort-asc\";\n+var sortDesc = \"sort-desc\";\n+var tableTab = \"table-tab\";\n+var activeTableTab = \"active-table-tab\";\n+\n+const linkIcon = \"##REPLACE:doclet.Link_icon##\";\n+const linkToSection = \"##REPLACE:doclet.Link_to_section##\";\n+\n+function loadScripts(doc, tag) {\n+    createElem(doc, tag, 'script-files\/search.js');\n+\n+    createElem(doc, tag, 'module-search-index.js');\n+    createElem(doc, tag, 'package-search-index.js');\n+    createElem(doc, tag, 'type-search-index.js');\n+    createElem(doc, tag, 'member-search-index.js');\n+    createElem(doc, tag, 'tag-search-index.js');\n+}\n+\n+function createElem(doc, tag, path) {\n+    var script = doc.createElement(tag);\n+    var scriptElement = doc.getElementsByTagName(tag)[0];\n+    script.src = pathtoroot + path;\n+    scriptElement.parentNode.insertBefore(script, scriptElement);\n+}\n+\n+\/\/ Helper for  making content containing release names comparable lexicographically\n+function makeComparable(s) {\n+    return s.toLowerCase().replace(\/(\\d+)\/g,\n+        function(n, m) {\n+            return (\"000\" + m).slice(-4);\n+        });\n+}\n+\n+\/\/ Switches between two styles depending on a condition\n+function toggleStyle(classList, condition, trueStyle, falseStyle) {\n+    if (condition) {\n+        classList.remove(falseStyle);\n+        classList.add(trueStyle);\n+    } else {\n+        classList.remove(trueStyle);\n+        classList.add(falseStyle);\n+    }\n+}\n+\n+\/\/ Sorts the rows in a table lexicographically by the content of a specific column\n+function sortTable(header, columnIndex, columns) {\n+    var container = header.parentElement;\n+    var descending = header.classList.contains(sortAsc);\n+    container.querySelectorAll(\"div.table-header\").forEach(\n+        function(header) {\n+            header.classList.remove(sortAsc);\n+            header.classList.remove(sortDesc);\n+        }\n+    )\n+    var cells = container.children;\n+    var rows = [];\n+    for (var i = columns; i < cells.length; i += columns) {\n+        rows.push(Array.prototype.slice.call(cells, i, i + columns));\n+    }\n+    var comparator = function(a, b) {\n+        var ka = makeComparable(a[columnIndex].textContent);\n+        var kb = makeComparable(b[columnIndex].textContent);\n+        if (ka < kb)\n+            return descending ? 1 : -1;\n+        if (ka > kb)\n+            return descending ? -1 : 1;\n+        return 0;\n+    };\n+    var sorted = rows.sort(comparator);\n+    var visible = 0;\n+    sorted.forEach(function(row) {\n+        if (row[0].style.display !== 'none') {\n+            var isEvenRow = visible++ % 2 === 0;\n+        }\n+        row.forEach(function(cell) {\n+            toggleStyle(cell.classList, isEvenRow, evenRowColor, oddRowColor);\n+            container.appendChild(cell);\n+        })\n+    });\n+    toggleStyle(header.classList, descending, sortDesc, sortAsc);\n+}\n+\n+\/\/ Toggles the visibility of a table category in all tables in a page\n+function toggleGlobal(checkbox, selected, columns) {\n+    var display = checkbox.checked ? '' : 'none';\n+    document.querySelectorAll(\"div.table-tabs\").forEach(function(t) {\n+        var id = t.parentElement.getAttribute(\"id\");\n+        var selectedClass = id + \"-tab\" + selected;\n+        \/\/ if selected is empty string it selects all uncategorized entries\n+        var selectUncategorized = !Boolean(selected);\n+        var visible = 0;\n+        document.querySelectorAll('div.' + id)\n+            .forEach(function(elem) {\n+                if (selectUncategorized) {\n+                    if (elem.className.indexOf(selectedClass) === -1) {\n+                        elem.style.display = display;\n+                    }\n+                } else if (elem.classList.contains(selectedClass)) {\n+                    elem.style.display = display;\n+                }\n+                if (elem.style.display === '') {\n+                    var isEvenRow = visible++ % (columns * 2) < columns;\n+                    toggleStyle(elem.classList, isEvenRow, evenRowColor, oddRowColor);\n+                }\n+            });\n+        var displaySection = visible === 0 ? 'none' : '';\n+        t.parentElement.style.display = displaySection;\n+        document.querySelector(\"li#contents-\" + id).style.display = displaySection;\n+    })\n+}\n+\n+\/\/ Shows the elements of a table belonging to a specific category\n+function show(tableId, selected, columns) {\n+    if (tableId !== selected) {\n+        document.querySelectorAll('div.' + tableId + ':not(.' + selected + ')')\n+            .forEach(function(elem) {\n+                elem.style.display = 'none';\n+            });\n+    }\n+    document.querySelectorAll('div.' + selected)\n+        .forEach(function(elem, index) {\n+            elem.style.display = '';\n+            var isEvenRow = index % (columns * 2) < columns;\n+            toggleStyle(elem.classList, isEvenRow, evenRowColor, oddRowColor);\n+        });\n+    updateTabs(tableId, selected);\n+}\n+\n+function updateTabs(tableId, selected) {\n+    document.querySelector('div#' + tableId +' .summary-table')\n+        .setAttribute('aria-labelledby', selected);\n+    document.querySelectorAll('button[id^=\"' + tableId + '\"]')\n+        .forEach(function(tab, index) {\n+            if (selected === tab.id || (tableId === selected && index === 0)) {\n+                tab.className = activeTableTab;\n+                tab.setAttribute('aria-selected', true);\n+                tab.setAttribute('tabindex',0);\n+            } else {\n+                tab.className = tableTab;\n+                tab.setAttribute('aria-selected', false);\n+                tab.setAttribute('tabindex',-1);\n+            }\n+        });\n+}\n+\n+function switchTab(e) {\n+    var selected = document.querySelector('[aria-selected=true]');\n+    if (selected) {\n+        if ((e.keyCode === 37 || e.keyCode === 38) && selected.previousSibling) {\n+            \/\/ left or up arrow key pressed: move focus to previous tab\n+            selected.previousSibling.click();\n+            selected.previousSibling.focus();\n+            e.preventDefault();\n+        } else if ((e.keyCode === 39 || e.keyCode === 40) && selected.nextSibling) {\n+            \/\/ right or down arrow key pressed: move focus to next tab\n+            selected.nextSibling.click();\n+            selected.nextSibling.focus();\n+            e.preventDefault();\n+        }\n+    }\n+}\n+\n+var updateSearchResults = function() {};\n+\n+function indexFilesLoaded() {\n+    return moduleSearchIndex\n+        && packageSearchIndex\n+        && typeSearchIndex\n+        && memberSearchIndex\n+        && tagSearchIndex;\n+}\n+\/\/ Copy the contents of the local snippet to the clipboard\n+function copySnippet(button) {\n+    copyToClipboard(button.nextElementSibling.innerText);\n+    switchCopyLabel(button, button.firstElementChild);\n+}\n+function copyToClipboard(content) {\n+    var textarea = document.createElement(\"textarea\");\n+    textarea.style.height = 0;\n+    document.body.appendChild(textarea);\n+    textarea.value = content;\n+    textarea.select();\n+    document.execCommand(\"copy\");\n+    document.body.removeChild(textarea);\n+}\n+function switchCopyLabel(button, span) {\n+    var copied = span.getAttribute(\"data-copied\");\n+    button.classList.add(\"visible\");\n+    var initialLabel = span.innerHTML;\n+    span.innerHTML = copied;\n+    setTimeout(function() {\n+        button.classList.remove(\"visible\");\n+        setTimeout(function() {\n+            if (initialLabel !== copied) {\n+                span.innerHTML = initialLabel;\n+            }\n+        }, 100);\n+    }, 1900);\n+}\n+function setTopMargin() {\n+    \/\/ Dynamically set scroll margin to accomodate for draft header\n+    var headerHeight = Math.ceil(document.querySelector(\"header\").offsetHeight);\n+    document.querySelector(\":root\")\n+        .style.setProperty(\"--nav-height\", headerHeight + \"px\");\n+}\n+document.addEventListener(\"readystatechange\", (e) => {\n+    if (document.readyState === \"interactive\") {\n+        setTopMargin();\n+    }\n+    if (sessionStorage.getItem(\"sidebar\") === \"hidden\") {\n+        const sidebar = document.querySelector(\".main-grid nav.toc\");\n+        if (sidebar) sidebar.classList.add(\"hide-sidebar\");\n+    }\n+});\n+document.addEventListener(\"DOMContentLoaded\", function(e) {\n+    setTopMargin();\n+    \/\/ Make sure current element is visible in breadcrumb navigation on small displays\n+    const subnav = document.querySelector(\"ol.sub-nav-list\");\n+    if (subnav && subnav.lastElementChild) {\n+        subnav.lastElementChild.scrollIntoView({ behavior: \"instant\", inline: \"start\", block: \"nearest\" });\n+    }\n+    \/\/ Clone TOC sidebar to header for mobile navigation\n+    const navbar = document.querySelector(\"div#navbar-top\");\n+    const sidebar = document.querySelector(\".main-grid nav.toc\");\n+    const main = document.querySelector(\".main-grid main\");\n+    const mainnav = navbar.querySelector(\"ul.nav-list\");\n+    const toggleButton = document.querySelector(\"button#navbar-toggle-button\");\n+    const toc = sidebar ? sidebar.cloneNode(true) : null;\n+    if (toc) {\n+        navbar.appendChild(toc);\n+    }\n+    document.querySelectorAll(\"input.filter-input\").forEach(function(input) {\n+        input.removeAttribute(\"disabled\");\n+        input.value = \"\";\n+        input.addEventListener(\"input\", function(e) {\n+            const pattern = input.value ? input.value.trim()\n+                .replace(\/[\\[\\]{}()*+?.\\\\^$|]\/g, '\\\\$&')\n+                .replace(\/\\s+\/g, \".*\") : \"\";\n+            input.nextElementSibling.style.display = pattern ? \"inline\" : \"none\";\n+            const filter = new RegExp(pattern, \"i\");\n+            input.parentNode.parentNode.querySelectorAll(\"ol.toc-list li\").forEach((li) => {\n+                if (filter.test(li.innerText)) {\n+                    li.removeAttribute(\"style\");\n+                } else {\n+                    li.style.display = \"none\";\n+                }\n+            });\n+            if (expanded) {\n+                expand();\n+            }\n+        });\n+    });\n+    document.querySelectorAll(\"input.reset-filter\").forEach((button) => {\n+        button.removeAttribute(\"disabled\");\n+        button.addEventListener(\"click\", (e) => {\n+            const input = button.previousElementSibling;\n+            input.value = \"\";\n+            input.dispatchEvent(new InputEvent(\"input\"));\n+            input.focus();\n+            if (expanded) {\n+                expand();\n+            } else {\n+                prevHash = null;\n+                handleScroll();\n+            }\n+        })\n+    });\n+    var expanded = false;\n+    var windowWidth;\n+    function collapse() {\n+        if (expanded) {\n+            mainnav.removeAttribute(\"style\");\n+            if (toc) {\n+                toc.removeAttribute(\"style\");\n+            }\n+            toggleButton.classList.remove(\"expanded\")\n+            toggleButton.setAttribute(\"aria-expanded\", \"false\");\n+            expanded = false;\n+        }\n+    }\n+    function expand() {\n+        expanded = true;\n+        mainnav.style.display = \"block\";\n+        mainnav.style.removeProperty(\"height\");\n+        var maxHeight = window.innerHeight - subnav.offsetTop + 4;\n+        var expandedHeight = Math.min(maxHeight, mainnav.scrollHeight + 10);\n+        if (toc) {\n+            toc.style.display = \"flex\";\n+            expandedHeight = Math.min(maxHeight,\n+                Math.max(expandedHeight, toc.querySelector(\"div.toc-header\").offsetHeight\n+                                       + toc.querySelector(\"ol.toc-list\").scrollHeight + 10));\n+            toc.style.height = expandedHeight + \"px\";\n+        }\n+        mainnav.style.height = expandedHeight + \"px\";\n+        toggleButton.classList.add(\"expanded\");\n+        toggleButton.setAttribute(\"aria-expanded\", \"true\");\n+        windowWidth = window.innerWidth;\n+    }\n+    toggleButton.addEventListener(\"click\", (e) => {\n+        if (expanded) {\n+            collapse();\n+        } else {\n+            expand();\n+        }\n+    });\n+    if (toc) {\n+        toc.querySelectorAll(\"a\").forEach((link) => {\n+            link.addEventListener(\"click\", collapse);\n+        });\n+    }\n+    document.addEventListener('keydown', (e) => {\n+        if (e.key === \"Escape\") collapse();\n+    });\n+    document.querySelector(\"main\").addEventListener(\"click\", collapse);\n+    const searchInput = document.getElementById(\"search-input\");\n+    if (searchInput) searchInput.addEventListener(\"focus\", collapse);\n+    document.querySelectorAll(\"h1, h2, h3, h4, h5, h6\")\n+        .forEach((hdr, idx) => {\n+            \/\/ Create anchor links for headers with an associated id attribute\n+            var id = hdr.getAttribute(\"id\") || hdr.parentElement.getAttribute(\"id\")\n+                || (hdr.querySelector(\"a\") && hdr.querySelector(\"a\").getAttribute(\"id\"));\n+            if (id) {\n+                var template = document.createElement('template');\n+                template.innerHTML =\" <a href='#\" + encodeURI(id) + \"' class='anchor-link' aria-label='\" + linkToSection\n+                    + \"'><img src='\" + pathtoroot + \"resource-files\/link.svg' alt='\" + linkIcon +\"' tabindex='0'\"\n+                    + \" width='16' height='16'><\/a>\";\n+                hdr.append(...template.content.childNodes);\n+            }\n+        });\n+    var sections;\n+    var scrollTimeout;\n+    var scrollTimeoutNeeded;\n+    var prevHash;\n+    function initSectionData() {\n+        sections = [{ id: \"\", top: 0 }].concat(Array.from(main.querySelectorAll(\"section[id], h2[id], h2 a[id], div[id]\"))\n+            .filter((e) => {\n+                return sidebar.querySelector(\"a[href=\\\"#\" + encodeURI(e.getAttribute(\"id\")) + \"\\\"]\") !== null\n+            }).map((e) => {\n+                return {\n+                    id: e.getAttribute(\"id\"),\n+                    top: e.offsetTop\n+                };\n+            }));\n+    }\n+    function setScrollTimeout() {\n+        clearTimeout(scrollTimeout);\n+        scrollTimeoutNeeded = false;\n+        scrollTimeout = setTimeout(() => {\n+            scrollTimeout = null;\n+            handleScroll();\n+        }, 50);\n+    }\n+    function handleScroll() {\n+        if (!sidebar || !sidebar.offsetParent || sidebar.classList.contains(\"hide-sidebar\")) {\n+            return;\n+        }\n+        if (scrollTimeout || scrollTimeoutNeeded) {\n+            setScrollTimeout();\n+            return;\n+        }\n+        var scrollTop = document.documentElement.scrollTop;\n+        var scrollHeight = document.documentElement.scrollHeight;\n+        var currHash = null;\n+        if (scrollHeight - scrollTop < window.innerHeight + 10) {\n+            \/\/ Select last item if at bottom of the page\n+            currHash = \"#\" + encodeURI(sections.at(-1).id);\n+        } else {\n+            for (var i = 0; i < sections.length; i++) {\n+                var top = sections[i].top;\n+                var bottom = sections[i + 1] ? sections[i + 1].top : scrollHeight;\n+                if (top + ((bottom - top) \/ 2) > scrollTop || bottom > scrollTop + (window.innerHeight \/ 3)) {\n+                    currHash = \"#\" + encodeURI(sections[i].id);\n+                    break;\n+                }\n+            }\n+        }\n+        if (currHash !== prevHash) {\n+            setSelected(currHash);\n+        }\n+    }\n+    function setSelected(hash) {\n+        var prev = sidebar.querySelector(\"a.current-selection\");\n+        if (prev)\n+            prev.classList.remove(\"current-selection\");\n+        prevHash = hash;\n+        if (hash) {\n+            var curr = sidebar.querySelector(\"ol.toc-list a[href=\\\"\" + hash + \"\\\"]\");\n+            if (curr) {\n+                curr.classList.add(\"current-selection\");\n+                curr.scrollIntoView({ behavior: \"instant\", block: \"nearest\" });\n+            }\n+        }\n+    }\n+    if (sidebar) {\n+        initSectionData();\n+        document.querySelectorAll(\"a[href^='#']\").forEach((link) => {\n+            link.addEventListener(\"click\", (e) => {\n+                scrollTimeoutNeeded = true;\n+                setSelected(link.getAttribute(\"href\"));\n+            })\n+        });\n+        sidebar.querySelector(\"button.hide-sidebar\").addEventListener(\"click\", () => {\n+            sidebar.classList.add(\"hide-sidebar\");\n+            sessionStorage.setItem(\"sidebar\", \"hidden\");\n+        });\n+        sidebar.querySelector(\"button.show-sidebar\").addEventListener(\"click\", () => {\n+            sidebar.classList.remove(\"hide-sidebar\");\n+            sessionStorage.removeItem(\"sidebar\");\n+            initSectionData();\n+            handleScroll();\n+        });\n+        window.addEventListener(\"hashchange\", (e) => {\n+            scrollTimeoutNeeded = true;\n+        });\n+        if (document.location.hash) {\n+            scrollTimeoutNeeded = true;\n+            setSelected(document.location.hash);\n+        } else {\n+            handleScroll();\n+        }\n+        window.addEventListener(\"scroll\", handleScroll);\n+        window.addEventListener(\"scrollend\", () => {\n+            if (scrollTimeout) {\n+                clearTimeout(scrollTimeout);\n+                scrollTimeout = null;\n+                handleScroll();\n+            }\n+        })\n+    }\n+    \/\/ Resize handler\n+    function handleResize(e) {\n+        if (expanded) {\n+            if (windowWidth != window.innerWidth) {\n+                collapse();\n+            } else {\n+                expand();\n+            }\n+        }\n+        if (sections) {\n+            initSectionData();\n+            prevHash = null;\n+            handleScroll();\n+        }\n+        setTopMargin();\n+    }\n+    window.addEventListener(\"orientationchange\", handleResize);\n+    window.addEventListener(\"resize\", handleResize);\n+});\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/script.js.template","additions":481,"deletions":0,"binary":false,"changes":481,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,2 +34,0 @@\n-    linkIcon: \"##REPLACE:doclet.Link_icon##\",\n-    linkToSection: \"##REPLACE:doclet.Link_to_section##\"\n@@ -258,3 +256,0 @@\n-    if (term.length === 0) {\n-        return this.close();\n-    }\n@@ -410,40 +405,0 @@\n-    var expanded = false;\n-    var windowWidth;\n-    function collapse() {\n-        if (expanded) {\n-            $(\"div#navbar-top\").removeAttr(\"style\");\n-            $(\"button#navbar-toggle-button\")\n-                .removeClass(\"expanded\")\n-                .attr(\"aria-expanded\", \"false\");\n-            expanded = false;\n-        }\n-    }\n-    $(\"button#navbar-toggle-button\").click(function (e) {\n-        if (expanded) {\n-            collapse();\n-        } else {\n-            var navbar = $(\"div#navbar-top\");\n-            navbar.height(navbar.prop(\"scrollHeight\"));\n-            $(\"button#navbar-toggle-button\")\n-                .addClass(\"expanded\")\n-                .attr(\"aria-expanded\", \"true\");\n-            expanded = true;\n-            windowWidth = window.innerWidth;\n-        }\n-    });\n-    $(\"ul.sub-nav-list-small li a\").click(collapse);\n-    $(\"input#search-input\").focus(collapse);\n-    $(\"main\").click(collapse);\n-    $(\"section[id] > :header, :header[id], :header:has(a[id])\").each(function(idx, el) {\n-        \/\/ Create anchor links for headers with an associated id attribute\n-        var hdr = $(el);\n-        var id = hdr.attr(\"id\") || hdr.parent(\"section\").attr(\"id\") || hdr.children(\"a\").attr(\"id\");\n-        if (id) {\n-            hdr.append(\" <a href='#\" + id + \"' class='anchor-link' aria-label='\" + messages.linkToSection\n-                + \"'><img src='\" + pathtoroot + \"resource-files\/link.svg' alt='\" + messages.linkIcon +\"' tabindex='0'\"\n-                + \" width='16' height='16'><\/a>\");\n-        }\n-    });\n-    $(window).on(\"orientationchange\", collapse).on(\"resize\", function(e) {\n-        if (expanded && windowWidth !== window.innerWidth) collapse();\n-    });\n@@ -451,1 +406,1 @@\n-    var reset = $(\"#reset-button\");\n+    var reset = $(\"#reset-search\");\n@@ -455,1 +410,7 @@\n-        source: doSearch,\n+        source: function(request, response) {\n+            reset.css(\"display\", \"inline\");\n+            if (request.term.trim() === \"\") {\n+                return this.close();\n+            }\n+            return doSearch(request, response);\n+        },\n@@ -463,0 +424,6 @@\n+        close: function(event, ui) {\n+            reset.css(\"display\", search.val() ? \"inline\" : \"none\");\n+        },\n+        change: function(event, ui) {\n+            reset.css(\"display\", search.val() ? \"inline\" : \"none\");\n+        },\n@@ -483,0 +450,1 @@\n+        reset.css(\"display\", \"none\");\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/search.js.template","additions":16,"deletions":48,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -18,0 +18,1 @@\n+    --block-font-size: 14px;\n@@ -19,0 +20,3 @@\n+    --nav-font-size: 13.2px;\n+    \/* Line height for continuous text blocks *\/\n+    --block-line-height: 1.4em;\n@@ -62,0 +66,5 @@\n+    \/* Navigation bar dimensions *\/\n+    --top-nav-height: 44px;\n+    --sub-nav-height: 34px;\n+    --nav-height: calc(var(--top-nav-height) + var(--sub-nav-height));\n+    scroll-behavior: smooth;\n@@ -79,10 +88,2 @@\n-iframe {\n-    margin:0;\n-    padding:0;\n-    height:100%;\n-    width:100%;\n-    overflow-y:scroll;\n-    border:none;\n-}\n-:not(input)[id] {\n-    scroll-margin-top: 78px;\n+main [id] {\n+    scroll-margin-top: calc(var(--nav-height) + 6px);\n@@ -94,1 +95,1 @@\n-a[href]:hover, a[href]:focus {\n+a[href]:hover, a[href]:active {\n@@ -100,1 +101,1 @@\n-    font-size:1em;\n+    font-size:var(--code-font-size);\n@@ -133,2 +134,0 @@\n-    padding-top:4px;\n-    margin-top:8px;\n@@ -155,0 +154,3 @@\n+hr {\n+    border-color: #aaa;\n+}\n@@ -165,2 +167,3 @@\n-    float:right;\n-    padding:0 21px 8px 8px;\n+    flex: 0 0 auto;\n+    padding:0 20px;\n+    margin:0;\n@@ -168,2 +171,2 @@\n-    margin-top:-9px;\n-    height:2.9em;\n+    max-width: 50%;\n+    white-space: nowrap;\n@@ -172,1 +175,0 @@\n-    margin-left:.5em;\n@@ -181,1 +183,1 @@\n-        z-index:1;\n+        z-index:2;\n@@ -185,0 +187,7 @@\n+.nav-content {\n+    display:flex;\n+    flex-direction: row;\n+    align-items: center;\n+    width: 100%;\n+    height: 100%;\n+}\n@@ -188,1 +197,0 @@\n-    float:left;\n@@ -190,4 +198,2 @@\n-    clear:right;\n-    min-height:2.8em;\n-    padding:10px 0 0 0;\n-    overflow:hidden;\n+    height:var(--top-nav-height);\n+    overflow:visible;\n@@ -195,0 +201,9 @@\n+    position:relative;\n+}\n+.top-nav nav.toc {\n+    display: none;\n+    flex-direction: column;\n+}\n+.top-nav nav.toc button.show-sidebar,\n+.top-nav nav.toc button.hide-sidebar {\n+    display: none;\n@@ -199,2 +214,12 @@\n-ul.sub-nav-list-small {\n-    display: none;\n+ul.nav-list {\n+    display:inline-flex;\n+    margin:0;\n+    padding-left:4px;\n+    flex: 1 1 auto;\n+    white-space: nowrap;\n+}\n+ul.nav-list li {\n+    list-style:none;\n+    padding: 5px 6px;\n+    text-transform:uppercase;\n+    height: 1.2em;\n@@ -202,1 +227,1 @@\n-.sub-nav {\n+div.sub-nav {\n@@ -204,1 +229,0 @@\n-    float:left;\n@@ -207,1 +231,2 @@\n-    font-size:0.857em;\n+    font-size:var(--nav-font-size);\n+    height: var(--sub-nav-height);\n@@ -209,5 +234,11 @@\n-.sub-nav div {\n-    clear:left;\n-    float:left;\n-    padding:6px;\n-    text-transform:uppercase;\n+ol.sub-nav-list {\n+    flex: 1 1 90%;\n+    line-height: 1.8em;\n+    display: inline-flex;\n+    overflow: auto;\n+    scroll-snap-type: x mandatory;\n+    scroll-padding-left: 13px;\n+    scrollbar-width: none;\n+    padding-left:6px;\n+    white-space: nowrap;\n+    margin:0;\n@@ -215,2 +246,2 @@\n-.sub-nav .sub-nav-list {\n-    padding-top:4px;\n+ol.sub-nav-list::-webkit-scrollbar {\n+    display: none;\n@@ -218,4 +249,3 @@\n-ul.nav-list {\n-    display:block;\n-    margin:0 25px 0 0;\n-    padding:0;\n+ol.sub-nav-list li {\n+    list-style:none;\n+    scroll-snap-align: start;\n@@ -223,4 +253,2 @@\n-ul.sub-nav-list {\n-    float:left;\n-    margin:0 25px 0 0;\n-    padding:0;\n+ol.sub-nav-list a {\n+    padding: 3px;\n@@ -228,5 +256,3 @@\n-ul.nav-list li {\n-    list-style:none;\n-    float:left;\n-    padding: 5px 6px;\n-    text-transform:uppercase;\n+ol.sub-nav-list a.current-selection {\n+    background-color: var(--section-background-color);\n+    border-radius: 4px;\n@@ -235,1 +261,1 @@\n-    float:right;\n+    flex: 1 1 10%;\n@@ -238,2 +264,0 @@\n-    clear:none;\n-    text-align:right;\n@@ -241,0 +265,1 @@\n+    white-space: nowrap;\n@@ -242,5 +267,1 @@\n-ul.sub-nav-list li {\n-    list-style:none;\n-    float:left;\n-}\n-.top-nav a:link, .top-nav a:active, .top-nav a:visited {\n+.top-nav .nav-list a:link, .top-nav .nav-list a:active, .top-nav .nav-list a:visited {\n@@ -251,1 +272,1 @@\n-.top-nav a:hover {\n+.top-nav .nav-list a:hover {\n@@ -257,1 +278,1 @@\n-    margin: auto 5px;\n+    margin: 0 5px;\n@@ -301,0 +322,1 @@\n+    overflow-x:auto;\n@@ -313,0 +335,12 @@\n+.main-grid {\n+    display: flex;\n+    flex-direction: row;\n+}\n+.main-grid main {\n+    flex: 2.6 1 0;\n+    min-width: 240px\n+}\n+.main-grid nav.toc {\n+    flex: 1 1 0;\n+    min-width: 240px;\n+}\n@@ -331,1 +365,1 @@\n-    font-size:1em;\n+    font-size:var(--block-font-size);\n@@ -345,0 +379,114 @@\n+\/*\n+ * Styles for table of contents.\n+ *\/\n+.main-grid nav.toc {\n+    background-color: var(--section-background-color);\n+    border-right: 1px solid var(--border-color);\n+    position: sticky;\n+    top: calc(var(--nav-height));\n+    max-height: calc(100vh - var(--nav-height));\n+    display: flex;\n+    flex-direction: column;\n+    font-family: var(--body-font-family);\n+    z-index: 1;\n+}\n+.main-grid nav.toc div.toc-header {\n+    background-color: var(--section-background-color);\n+    border-right: 1px solid var(--border-color);\n+    top: var(--nav-height);\n+    z-index: 1;\n+    padding: 15px 20px;\n+}\n+.main-grid nav.toc > ol.toc-list {\n+    max-height: calc(100vh - var(--nav-height) - 100px);\n+    padding-left: 12px;\n+}\n+.main-grid nav.toc button {\n+    position: absolute;\n+    bottom: 16px;\n+    z-index: 3;\n+    background-color: var(--section-background-color);\n+    color: #666666;\n+    font-size: 0.76rem;\n+    border: none;\n+    cursor: pointer;\n+    padding: 6px 10px;\n+    white-space: nowrap;\n+}\n+.main-grid nav.toc button.hide-sidebar {\n+    right: 0;\n+}\n+.main-grid nav.toc button.show-sidebar {\n+    left: 0;\n+    display: none;\n+}\n+.main-grid nav.toc button span {\n+    display: none;\n+}\n+.main-grid nav.toc button:hover {\n+    color: var(--body-text-color);\n+    border: 1px solid var(--subnav-background-color);\n+}\n+.main-grid nav.toc button:active {\n+    background-color: var(--subnav-background-color);\n+    color: var(--link-color-active);\n+}\n+.main-grid nav.toc button:hover span,\n+.main-grid nav.toc button:active span  {\n+    display: inline;\n+}\n+.main-grid nav.toc button:hover {\n+    box-shadow: 1px 1px 5px rgba(0,0,0,0.2);\n+}\n+.main-grid nav.toc.hide-sidebar {\n+    min-width: revert;\n+    max-width: 28px;\n+}\n+.main-grid nav.toc.hide-sidebar div.toc-header,\n+.main-grid nav.toc.hide-sidebar ol.toc-list,\n+.main-grid nav.toc.hide-sidebar button.hide-sidebar {\n+    display: none;\n+}\n+.main-grid nav.toc.hide-sidebar button.show-sidebar {\n+    display: inline;\n+}\n+nav.toc div.toc-header {\n+    padding: 15px;\n+    display: inline-flex;\n+    align-items: center;\n+    color: var(--body-text-color);\n+    background-color: var(--body-background-color);\n+    font-size: 0.856em;\n+    font-weight: bold;\n+    white-space: nowrap;\n+    overflow-x: hidden;\n+    position: sticky;\n+    min-height: 20px;\n+}\n+nav.toc > ol.toc-list {\n+    overflow: hidden auto;\n+    overscroll-behavior: contain;\n+}\n+nav.toc ol.toc-list {\n+    list-style: none;\n+    padding-left: 8px;\n+    margin: 0;\n+}\n+nav.toc ol.toc-list ol.toc-list {\n+    margin-left: 8px;\n+}\n+nav.toc ol.toc-list li {\n+    margin: 0;\n+    font-size: var(--nav-font-size);\n+    overflow-x: hidden;\n+}\n+a.current-selection {\n+    font-weight: bold;\n+}\n+nav.toc a {\n+    display: block;\n+    padding: 8px;\n+}\n+nav.toc a.current-selection {\n+    background-color: var(--subnav-background-color);\n+}\n@@ -362,0 +510,3 @@\n+main > div.inheritance {\n+    overflow-x:auto;\n+}\n@@ -366,1 +517,1 @@\n-    margin:10px 0 10px 0;\n+    margin:4px 0 10px 0;\n@@ -602,1 +753,1 @@\n-    font-size:var(--body-font-size);\n+    font-size:var(--block-font-size);\n@@ -604,0 +755,1 @@\n+    line-height:var(--block-line-height);\n@@ -649,1 +801,0 @@\n-.module-label-in-package, .module-label-in-type, .package-label-in-type,\n@@ -689,3 +840,0 @@\n-nav {\n-    overflow:hidden;\n-}\n@@ -715,2 +863,1 @@\n-    overflow-y:auto;\n-    overflow-x:auto;\n+    overflow:auto;\n@@ -723,1 +870,1 @@\n-    z-index:1;\n+    z-index:10;\n@@ -741,1 +888,1 @@\n-    z-index: 2;\n+    z-index: 10;\n@@ -759,1 +906,5 @@\n-#search-input, #page-search-input {\n+.ui-menu .ui-menu-item-wrapper {\n+    padding-top: 5px;\n+    padding-bottom: 5px;\n+}\n+input[type=\"text\"] {\n@@ -767,0 +918,1 @@\n+    border-radius: 4px;\n@@ -768,1 +920,5 @@\n-    width: 250px;\n+    font-size: var(--nav-font-size);\n+    height: 17px;\n+}\n+input#search-input, input#page-search-input {\n+    width: calc(180px + 10vw);\n@@ -771,2 +927,4 @@\n-#search-input {\n-    margin-left: 4px;\n+input#search-input {\n+    margin: 0 4px;\n+    padding-right: 18px;\n+    max-width: 340px;\n@@ -774,1 +932,7 @@\n-#reset-button {\n+input.filter-input {\n+    width: 40%;\n+    max-width: 140px;\n+    margin: 0 4px;\n+    padding-right: 18px;\n+}\n+input#reset-search, input.reset-filter {\n@@ -783,3 +947,0 @@\n-    position:absolute;\n-    right:12px;\n-    top:10px;\n@@ -787,0 +948,1 @@\n+    display:none;\n@@ -788,1 +950,11 @@\n-::placeholder {\n+input#reset-search {\n+    position:absolute;\n+    right:15px;\n+    top:11px;\n+}\n+input.reset-filter {\n+    position: relative;\n+    right: 20px;\n+    top: 0;\n+}\n+input::placeholder {\n@@ -852,1 +1024,1 @@\n-    z-index: 1;\n+    z-index: 5;\n@@ -877,0 +1049,4 @@\n+.help-section {\n+    font-size: var(--block-font-size);\n+    line-height: var(--block-line-height);\n+}\n@@ -1103,4 +1279,4 @@\n-@media screen and (max-width: 920px) {\n-    header {\n-        max-height: 100vh;\n-        overflow-y: auto;\n+@media screen and (max-width: 1050px) {\n+    .summary section[class$=\"-summary\"], .details section[class$=\"-details\"],\n+    .class-uses .detail, .serialized-class-details {\n+        padding: 0 10px 5px 8px;\n@@ -1108,3 +1284,2 @@\n-    div#navbar-top {\n-        height: 2.8em;\n-        transition: height 0.35s ease;\n+    input#search-input {\n+        width: 22vw;\n@@ -1112,7 +1287,4 @@\n-    ul.nav-list {\n-        display: block;\n-        width: 40%;\n-        float:left;\n-        clear: left;\n-        margin: 10px 0 0 0;\n-        padding: 0;\n+}\n+@media screen and (max-width: 920px) {\n+    .main-grid nav.toc {\n+        display: none;\n@@ -1120,5 +1292,9 @@\n-    ul.nav-list li {\n-        float: none;\n-        padding: 6px;\n-        margin-left: 10px;\n-        margin-top: 2px;\n+    .top-nav nav.toc {\n+        display: none;\n+        position: absolute;\n+        top: var(--top-nav-height);\n+        left: 40vw;\n+        width: 60vw;\n+        z-index: 7;\n+        background-color: var(--section-background-color);\n+        box-sizing: border-box;\n@@ -1126,10 +1302,5 @@\n-    ul.sub-nav-list-small {\n-        display:block;\n-        height: 100%;\n-        width: 50%;\n-        float: right;\n-        clear: right;\n-        background-color: var(--subnav-background-color);\n-        color: var(--body-text-color);\n-        margin: 6px 0 0 0;\n-        padding: 0;\n+    .top-nav nav.toc div.toc-header {\n+        padding: 6px 15px;\n+        font-size: 0.94em;\n+        background-color: var(--section-background-color);\n+        top: calc(var(--top-nav-height) + 10px);\n@@ -1137,2 +1308,2 @@\n-    ul.sub-nav-list-small ul {\n-        padding-left: 20px;\n+    .top-nav nav.toc ol.toc-list li {\n+        font-size: 1.04em;\n@@ -1140,1 +1311,2 @@\n-    ul.sub-nav-list-small a:link, ul.sub-nav-list-small a:visited {\n+    nav.toc a:link, nav.toc a:visited {\n+        text-decoration:none;\n@@ -1143,1 +1315,2 @@\n-    ul.sub-nav-list-small a:hover {\n+    nav.toc a[href]:hover, nav.toc a[href]:focus {\n+        text-decoration:none;\n@@ -1146,6 +1319,2 @@\n-    ul.sub-nav-list-small li {\n-        list-style:none;\n-        float:none;\n-        padding: 6px;\n-        margin-top: 1px;\n-        text-transform:uppercase;\n+    :root {\n+        scroll-behavior: auto;\n@@ -1153,2 +1322,4 @@\n-    ul.sub-nav-list-small > li {\n-        margin-left: 10px;\n+    header {\n+        max-height: 100vh;\n+        overflow-y: visible;\n+        overscroll-behavior: contain;\n@@ -1156,2 +1327,2 @@\n-    ul.sub-nav-list-small li p {\n-        margin: 5px 0;\n+    nav {\n+        overflow: visible;\n@@ -1159,1 +1330,1 @@\n-    div#navbar-sub-list {\n+    ul.nav-list {\n@@ -1161,0 +1332,14 @@\n+        position: absolute;\n+        top: var(--top-nav-height);\n+        overflow: auto;\n+        z-index: 7;\n+        background-color: var(--navbar-background-color);\n+        width: 40%;\n+        padding: 0;\n+        box-sizing: border-box;\n+    }\n+    ul.nav-list li {\n+        float: none;\n+        padding: 6px;\n+        margin-left: 10px;\n+        margin-top: 2px;\n@@ -1165,0 +1350,7 @@\n+    .top-nav div.nav-menu-button {\n+        flex: 1 1 auto;\n+    }\n+    .sub-nav ol.sub-nav-list {\n+        margin-left: 4px;\n+        padding-left: 4px;\n+    }\n@@ -1170,1 +1362,0 @@\n-        float: left;\n@@ -1180,1 +1371,1 @@\n-        margin: 1px 0 4px 0;\n+        margin: 4px 0;\n@@ -1182,1 +1373,0 @@\n-        transition: all 0.1s;\n@@ -1202,0 +1392,1 @@\n+        max-width: 90%;\n@@ -1206,3 +1397,0 @@\n-    ul.sub-nav-list-small > li {\n-        margin-left: 5px;\n-    }\n@@ -1210,5 +1398,1 @@\n-        padding: 10px;\n-    }\n-    .summary section[class$=\"-summary\"], .details section[class$=\"-details\"],\n-    .class-uses .detail, .serialized-class-details {\n-        padding: 0 8px 5px 8px;\n+        padding: 10px 12px;\n@@ -1220,16 +1404,2 @@\n-@media screen and (max-width: 400px) {\n-    .about-language {\n-        font-size: 10px;\n-        padding-right: 12px;\n-    }\n-}\n-@media screen and (max-width: 400px) {\n-    .nav-list-search {\n-        width: 94%;\n-    }\n-    #search-input, #page-search-input {\n-        width: 70%;\n-    }\n-}\n-@media screen and (max-width: 320px) {\n-    .nav-list-search > label {\n+@media screen and (max-width: 600px) {\n+    .nav-list-search > a {\n@@ -1238,2 +1408,2 @@\n-    .nav-list-search {\n-        width: 90%;\n+    input#search-input {\n+        width: 18vw;\n@@ -1241,2 +1411,3 @@\n-    #search-input, #page-search-input {\n-        width: 80%;\n+    .summary section[class$=\"-summary\"], .details section[class$=\"-details\"],\n+    .class-uses .detail, .serialized-class-details {\n+        padding: 0;\n@@ -1245,1 +1416,0 @@\n-\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/stylesheet.css","additions":327,"deletions":157,"binary":false,"changes":484,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2010, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -235,1 +235,1 @@\n-doclet.search=SEARCH\n+doclet.search=Search\n@@ -237,0 +237,1 @@\n+doclet.search_in_documentation=Search in documentation\n@@ -250,0 +251,6 @@\n+doclet.table_of_contents=Table of contents\n+doclet.hide_sidebar=Hide sidebar\n+doclet.show_sidebar=Show sidebar\n+doclet.filter_label=Filter\n+doclet.filter_table_of_contents=Filter table of contents\n+doclet.filter_reset=Reset\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/resources\/doclets.properties","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -93,1 +93,1 @@\n-        if (newPath.isEmpty() && isEmpty(fragment)) {\n+        if (newPath.isEmpty() && fragment == null) {\n@@ -124,1 +124,1 @@\n-        if (path != null && isEmpty(fragment))\n+        if (path != null && fragment == null)\n@@ -130,1 +130,1 @@\n-        if (!isEmpty(fragment))\n+        if (fragment != null)\n@@ -134,4 +134,0 @@\n-\n-    private static boolean isEmpty(String s) {\n-        return (s == null) || s.isEmpty();\n-    }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/DocLink.java","additions":4,"deletions":8,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -97,0 +97,3 @@\n+    \/** The name of the template of the default javascript file. *\/\n+    public static final DocPath SCRIPT_JS_TEMPLATE = DocPath.create(\"script.js.template\");\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/DocPaths.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -257,2 +257,7 @@\n-\\f[I]filename\\f[R]: (Optional) The name of the map file (STRING, no\n-default value)\n+\\f[I]filename\\f[R]: (Optional) The name of the map file (STRING,\n+\/tmp\/perf-<pid>.map)\n+.PP\n+If \\f[V]filename\\f[R] is not specified, a default file name is chosen\n+using the pid of the target JVM process.\n+For example, if the pid is \\f[V]12345\\f[R], then the default\n+\\f[V]filename\\f[R] will be \\f[V]\/tmp\/perf-12345.map\\f[R].\n@@ -883,1 +888,1 @@\n-\\f[V]filepath\\f[R]: The file path to the output file (STRING, no default\n+\\f[I]filepath\\f[R]: The file path to the output file (STRING, no default\n@@ -916,1 +921,1 @@\n-\\f[V]subcmd\\f[R]: must be either \\f[V]static_dump\\f[R] or\n+\\f[I]subcmd\\f[R]: must be either \\f[V]static_dump\\f[R] or\n@@ -919,2 +924,2 @@\n-\\f[V]filename\\f[R]: (Optional) Name of the shared archive to be dumped\n-(STRING, no default value)\n+\\f[I]filename\\f[R]: (Optional) Name of the shared archive to be dumped\n+(STRING, java_pid<pid>_<subcmd>.jsa)\n","filename":"src\/jdk.jcmd\/share\/man\/jcmd.1","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,53 @@\n+\/*\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jfr.events;\n+\n+import jdk.jfr.Category;\n+import jdk.jfr.Description;\n+import jdk.jfr.Label;\n+import jdk.jfr.Name;\n+import jdk.jfr.internal.MirrorEvent;\n+import jdk.jfr.internal.RemoveFields;\n+import jdk.jfr.internal.Type;\n+\n+@Name(Type.EVENT_NAME_PREFIX + \"SerializationMisdeclaration\")\n+@Label(\"Serialization Misdeclaration\")\n+@Category({\"Java Development Kit\", \"Serialization\"})\n+@Description(\"Methods and fields misdeclarations.\" +\n+        \" The checks are usually performed just once per serializable class,\" +\n+        \" the first time it is used by serialization.\" +\n+        \" Under high memory pressure, a class might be re-checked again.\")\n+@MirrorEvent(className = \"jdk.internal.event.SerializationMisdeclarationEvent\")\n+@RemoveFields({\"duration\", \"stackTrace\", \"eventThread\"})\n+public final class SerializationMisdeclarationEvent extends AbstractJDKEvent {\n+\n+    @Label(\"Misdeclared Class\")\n+    public Class<?> misdeclaredClass;\n+\n+    @Label(\"Message\")\n+    public String message;\n+\n+}\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/events\/SerializationMisdeclarationEvent.java","additions":53,"deletions":0,"binary":false,"changes":53,"status":"added"},{"patch":"@@ -38,0 +38,1 @@\n+import jdk.jfr.events.SerializationMisdeclarationEvent;\n@@ -55,0 +56,1 @@\n+        SerializationMisdeclarationEvent.class,\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/MirrorEvents.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -80,1 +80,2 @@\n-                assert false : msg;\n+                \/\/ Disable assertion until JDK-8323883 is fixed\n+                \/\/ assert false : msg;\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/ConstantMap.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -78,0 +78,1 @@\n+        jdk.internal.event.SerializationMisdeclarationEvent.class,\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/instrument\/JDKEvents.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -757,0 +757,4 @@\n+    <\/event>\n+\n+    <event name=\"jdk.SerializationMisdeclaration\">\n+        <setting name=\"enabled\">false<\/setting>\n","filename":"src\/jdk.jfr\/share\/conf\/jfr\/default.jfc","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -758,0 +758,4 @@\n+\n+    <event name=\"jdk.SerializationMisdeclaration\">\n+        <setting name=\"enabled\">true<\/setting>\n+    <\/event>\n","filename":"src\/jdk.jfr\/share\/conf\/jfr\/profile.jfc","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n- Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -89,0 +89,5 @@\n+        <dependency>\n+            <groupId>org.openjdk.nashorn<\/groupId>\n+            <artifactId>nashorn-core<\/artifactId>\n+            <version>15.3<\/version>\n+        <\/dependency>\n@@ -90,14 +95,0 @@\n-    <profiles>\n-        <profile>\n-            <activation>\n-                <jdk>[15,)<\/jdk>\n-            <\/activation>\n-            <dependencies>\n-                <dependency>\n-                    <groupId>org.openjdk.nashorn<\/groupId>\n-                    <artifactId>nashorn-core<\/artifactId>\n-                    <version>15.3<\/version>\n-                <\/dependency>\n-            <\/dependencies>\n-        <\/profile>\n-    <\/profiles>\n","filename":"src\/utils\/IdealGraphVisualizer\/Filter\/pom.xml","additions":6,"deletions":15,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n- Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -80,2 +80,2 @@\n-                                      <version>[11,18)<\/version>\n-                                      <message>IGV requires a JDK version between 11 and 17<\/message>\n+                                      <version>[17,22)<\/version>\n+                                      <message>IGV requires a JDK version between 17 and 21<\/message>\n@@ -112,1 +112,1 @@\n-        <netbeans.version>RELEASE150<\/netbeans.version>\n+        <netbeans.version>RELEASE200<\/netbeans.version>\n@@ -114,4 +114,4 @@\n-        <nbmmvnplugin.version>4.8<\/nbmmvnplugin.version>\n-        <mvncompilerplugin.version>3.10.1<\/mvncompilerplugin.version>\n-        <mvnjarplugin.version>3.2.2<\/mvnjarplugin.version>\n-        <mvnenforcerplugin.version>3.1.0<\/mvnenforcerplugin.version>\n+        <nbmmvnplugin.version>14.0<\/nbmmvnplugin.version>\n+        <mvncompilerplugin.version>3.11.0<\/mvncompilerplugin.version>\n+        <mvnjarplugin.version>3.3.0<\/mvnjarplugin.version>\n+        <mvnenforcerplugin.version>3.4.1<\/mvnenforcerplugin.version>\n@@ -119,3 +119,3 @@\n-        <batik.version>1.14<\/batik.version>\n-        <openpdf.version>1.3.29<\/openpdf.version>\n-        <wala.version>1.5.8<\/wala.version>\n+        <batik.version>1.17<\/batik.version>\n+        <openpdf.version>1.3.34<\/openpdf.version>\n+        <wala.version>1.6.2<\/wala.version>\n","filename":"src\/utils\/IdealGraphVisualizer\/pom.xml","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -325,1 +325,1 @@\n-  CustomTestTable* cht = new CustomTestTable(&mem_allocator);\n+  CustomTestTable* cht = new CustomTestTable(Mutex::nosafepoint-2, &mem_allocator);\n","filename":"test\/hotspot\/gtest\/utilities\/test_concurrentHashtable.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -24,0 +24,5 @@\n+# All tests\n+\n+all = \\\n+  :hotspot_all\n+\n@@ -31,0 +36,2 @@\n+# Component test groups\n+\n","filename":"test\/hotspot\/jtreg\/TEST.groups","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,49 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package compiler.c2;\n+\n+\/*\n+ * @test\n+ * @bug 8323154\n+ * @summary Long counted loop exit check should not be transformed into an unsigned check\n+ *\n+ * @run main\/othervm -Xbatch -XX:CompileCommand=compileonly,compiler.c2.TestMinValueStrideLongCountedLoop::test\n+ *                   compiler.c2.TestMinValueStrideLongCountedLoop\n+ *\/\n+\n+public class TestMinValueStrideLongCountedLoop {\n+    static long limit = 0;\n+    static long res = 0;\n+\n+    public static void main(String[] args) {\n+        for (int i = 0; i < 10000; i++) {\n+            test();\n+        }\n+    }\n+\n+    static void test() {\n+        for (long i = 0; i >= limit + (Long.MIN_VALUE + 1); i += Long.MIN_VALUE) {\n+            res += 42;\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/TestMinValueStrideLongCountedLoop.java","additions":49,"deletions":0,"binary":false,"changes":49,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -120,1 +120,1 @@\n-        Asserts.assertEQ(testLoadAfterLoopAlias_Interp(cond1, x, y),                testLoadAfterLoopAlias_C2(cond1, x, y));\n+        Asserts.assertEQ(testLoadAfterLoopAlias_Interp(x, y),                       testLoadAfterLoopAlias_C2(x, y));\n@@ -417,1 +417,1 @@\n-    int testLoadAfterLoopAlias(boolean cond, int x, int y) {\n+    int testLoadAfterLoopAlias(int x, int y) {\n@@ -420,1 +420,1 @@\n-        Point c = a;\n+        int acc = 0;\n@@ -423,3 +423,2 @@\n-            if (i == x) {\n-                c = b;\n-            }\n+            Point c = (i % 2 == 0) ? a : b;\n+            acc += c.x + c.y;\n@@ -428,1 +427,1 @@\n-        return cond ? c.x : c.y;\n+        return acc;\n@@ -434,1 +433,1 @@\n-    int testLoadAfterLoopAlias_C2(boolean cond, int x, int y) { return testLoadAfterLoopAlias(cond, x, y); }\n+    int testLoadAfterLoopAlias_C2(int x, int y) { return testLoadAfterLoopAlias(x, y); }\n@@ -437,1 +436,1 @@\n-    int testLoadAfterLoopAlias_Interp(boolean cond, int x, int y) { return testLoadAfterLoopAlias(cond, x, y); }\n+    int testLoadAfterLoopAlias_Interp(int x, int y) { return testLoadAfterLoopAlias(x, y); }\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/scalarReplacement\/AllocationMergesTests.java","additions":9,"deletions":10,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,1 @@\n- * @run junit\/othervm -XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI -XX:-UseJVMCICompiler jdk.vm.ci.runtime.test.TestResolvedJavaMethod\n+ * @run junit\/othervm\/timeout=240 -XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI -XX:-UseJVMCICompiler jdk.vm.ci.runtime.test.TestResolvedJavaMethod\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/jdk.vm.ci.runtime.test\/src\/jdk\/vm\/ci\/runtime\/test\/TestResolvedJavaMethod.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -44,0 +44,2 @@\n+import java.util.concurrent.TimeoutException;\n+import java.util.concurrent.CompletionException;\n@@ -110,1 +112,6 @@\n-    private static boolean waitForSubPids(File commFile) throws Exception {\n+    enum Result {\n+        FOUND_LEAKS_FD,\n+        FOUND_RETAINS_FD,\n+        FOUND_NONE \/\/ Unexpected.\n+    };\n+    private static Result waitForSubPids(File commFile) throws Exception {\n@@ -217,2 +224,7 @@\n-\n-        return out.contains(RETAINS_FD);\n+        if (out.contains(RETAINS_FD)) {\n+            return Result.FOUND_RETAINS_FD;\n+        } else if (out.contains(LEAKS_FD)) {\n+            return Result.FOUND_LEAKS_FD;\n+        } else {\n+            return Result.FOUND_NONE;\n+        }\n@@ -241,1 +253,2 @@\n-        if (waitForSubPids(commFile)) {\n+        Result result = waitForSubPids(commFile);\n+        if (result == Result.FOUND_RETAINS_FD) {\n@@ -243,1 +256,1 @@\n-        } else {\n+        } else if (result == Result.FOUND_LEAKS_FD) {\n@@ -245,0 +258,2 @@\n+        } else {\n+            throw new RuntimeException(\"Found neither message, test failed to run correctly\");\n@@ -293,0 +308,7 @@\n+            } catch (CompletionException e) {\n+                if (e.getCause() instanceof TimeoutException) {\n+                    System.out.println(\"(Third VM) Timed out waiting for second VM: \" + e.toString());\n+                } else {\n+                    System.out.println(\"(Third VM) Exception was thrown: \" + e.toString());\n+                }\n+                throw e;\n@@ -294,1 +316,1 @@\n-                System.out.println(\"Exception was thrown: \" + e.toString());\n+                System.out.println(\"(Third VM) Exception was thrown: \" + e.toString());\n@@ -364,1 +386,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/runtime\/8176717\/TestInheritFD.java","additions":28,"deletions":7,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -1,44 +0,0 @@\n-\/*\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-import jdk.test.lib.process.ProcessTools;\n-import jdk.test.lib.process.OutputAnalyzer;\n-\n-\/*\n- * @test PrintStringTableStatsTest\n- * @bug 8211821\n- * @requires vm.flagless\n- * @library \/test\/lib\n- * @run driver PrintStringTableStatsTest\n- *\/\n-\n-public class PrintStringTableStatsTest {\n-    public static void main(String... args) throws Exception {\n-        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-            \"-XX:+PrintStringTableStatistics\",\n-            \"--version\");\n-        OutputAnalyzer output = new OutputAnalyzer(pb.start());\n-        output.shouldContain(\"Number of buckets\");\n-        output.shouldHaveExitValue(0);\n-    }\n-}\n","filename":"test\/hotspot\/jtreg\/runtime\/PrintStringTableStats\/PrintStringTableStatsTest.java","additions":0,"deletions":44,"binary":false,"changes":44,"status":"deleted"},{"patch":"@@ -0,0 +1,69 @@\n+\/*\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import jdk.test.lib.process.ProcessTools;\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.Platform;\n+\n+\/*\n+ * @test\n+ * @summary Test various printing functions in classfile directory\n+ * @bug 8211821 8323685\n+ * @requires vm.flagless\n+ * @library \/test\/lib\n+ * @run driver ClassfilePrintingTests\n+ *\/\n+\n+class SampleClass {\n+    public static void main(java.lang.String[] unused) {\n+        System.out.println(\"Hello from the sample class\");\n+    }\n+}\n+\n+public class ClassfilePrintingTests {\n+    private static void printStringTableStatsTest() throws Exception {\n+        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n+            \"-XX:+PrintStringTableStatistics\",\n+            \"--version\");\n+        OutputAnalyzer output = new OutputAnalyzer(pb.start());\n+        output.shouldContain(\"Number of buckets\");\n+        output.shouldHaveExitValue(0);\n+    }\n+\n+    private static void printSystemDictionaryAtExitTest() throws Exception {\n+        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n+            \"-XX:+PrintSystemDictionaryAtExit\",\n+            \"SampleClass\");\n+        OutputAnalyzer output = new OutputAnalyzer(pb.start());\n+        output.shouldContain(SampleClass.class.getName());\n+        output.shouldContain(\"jdk\/internal\/loader\/ClassLoaders$AppClassLoader\");\n+        output.shouldHaveExitValue(0);\n+    }\n+\n+    public static void main(String... args) throws Exception {\n+        printStringTableStatsTest();\n+        if (Platform.isDebugBuild()) {\n+            printSystemDictionaryAtExitTest();\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/runtime\/PrintingTests\/ClassfilePrintingTests.java","additions":69,"deletions":0,"binary":false,"changes":69,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+ * @requires os.family != \"aix\"\n@@ -31,0 +32,8 @@\n+\/**\n+ * @test\n+ * @summary Stress test that reaches the process limit for thread count, or time limit.\n+ * @requires os.family == \"aix\"\n+ * @key stress\n+ * @run main\/othervm -Xmx1g -XX:MaxExpectedDataSegmentSize=16g ThreadCountLimit\n+ *\/\n+\n","filename":"test\/hotspot\/jtreg\/runtime\/Thread\/ThreadCountLimit.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,1 +41,4 @@\n-        final String versionPattern = \"java.[0-9][0-9][-].*\";\n+        \/\/ Pattern of a module version string.\n+        \/\/ e.g. JDK 22:     \"java 22\"\n+        \/\/      JDK 22.0.1: \"java 22.0.1\"\n+        final String versionPattern = \"java.[0-9][0-9].*\";\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jigsaw\/module\/ModuleOption.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-        Assert.assertTrue(Files.exists(path));\n+        Assert.assertTrue(Files.exists(path), \"File must exist: \" + path);\n@@ -97,0 +97,11 @@\n+\n+    @Test\n+    public void specifiedDefaultMapFile() {\n+        \/\/ This is a special case of specifiedMapFile() where the filename specified\n+        \/\/ is the same as the default filename as given in the help output. The dcmd\n+        \/\/ should treat this literally as the filename and not expand <pid> into\n+        \/\/ the actual PID of the process.\n+        String test_dir = System.getProperty(\"test.dir\", \".\");\n+        Path path = Paths.get(\"\/tmp\/perf-<pid>.map\");\n+        run(new JMXExecutor(), \"Compiler.perfmap \" + path.toString(), path);\n+    }\n","filename":"test\/hotspot\/jtreg\/serviceability\/dcmd\/compiler\/PerfMapTest.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,1 +62,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=300\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/gc\/gctests\/LargeObjects\/large001\/large001.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -63,1 +63,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=300\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/gc\/gctests\/LargeObjects\/large002\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=300\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/gc\/gctests\/LargeObjects\/large003\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=300\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/gc\/gctests\/LargeObjects\/large004\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=300\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/gc\/gctests\/LargeObjects\/large005\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=180\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load002\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=180\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load003\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n- * @run main\/othervm\/timeout=180\n+ * @run main\/othervm\/timeout=360\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load007\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n- * @run main\/othervm\/timeout=180\n+ * @run main\/othervm\/timeout=420\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load008\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n- * @run main\/othervm\/timeout=180\n+ * @run main\/othervm\/timeout=420\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load009\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=300\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load010\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n- * @run main\/othervm\/timeout=180\n+ * @run main\/othervm\/timeout=360\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load011\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n- * @run main\/othervm\/timeout=180\n+ * @run main\/othervm\/timeout=300\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/load012\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=180\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/unload003\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -52,1 +52,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=180\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/unload007\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=180\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/classload\/unload009\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -65,1 +65,1 @@\n- * @run main\/othervm nsk.monitoring.stress.thread.cmon001 -threadCount=400\n+ * @run main\/othervm\/timeout=240 nsk.monitoring.stress.thread.cmon001 -threadCount=400\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/thread\/cmon001\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,1 +66,1 @@\n- * @run main\/othervm nsk.monitoring.stress.thread.cmon001 -testMode=server -threadCount=400\n+ * @run main\/othervm\/timeout=240 nsk.monitoring.stress.thread.cmon001 -testMode=server -threadCount=400\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/thread\/cmon002\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,1 +66,1 @@\n- * @run main\/othervm\n+ * @run main\/othervm\/timeout=240\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/monitoring\/stress\/thread\/cmon003\/TestDescription.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -23,0 +23,8 @@\n+# All tests\n+\n+all = \\\n+    :jaxp_all\n+\n+jaxp_all = \\\n+    \/\n+\n@@ -37,3 +45,0 @@\n-\n-jaxp_all = \\\n-    javax\/xml\/jaxp\n","filename":"test\/jaxp\/TEST.groups","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -23,0 +23,11 @@\n+###############################################################################\n+#\n+# All tests\n+#\n+\n+all = \\\n+    :jdk_all\n+\n+jdk_all = \\\n+    \/\n+\n","filename":"test\/jdk\/TEST.groups","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,8 +24,0 @@\n-\/*\n-  @test\n-  @key headful\n-  @bug 6988428\n-  @summary Tests whether shape is always set\n-  @author anthony.petrov@oracle.com: area=awt.toplevel\n-  @run main ShapeNotSetSometimes\n-*\/\n@@ -35,0 +27,1 @@\n+import java.awt.Dimension;\n@@ -41,0 +34,1 @@\n+import java.awt.Toolkit;\n@@ -44,0 +38,3 @@\n+import java.io.File;\n+import java.io.IOException;\n+import javax.imageio.ImageIO;\n@@ -45,0 +42,7 @@\n+\/*\n+ * @test\n+ * @key headful\n+ * @bug 6988428\n+ * @summary Tests whether shape is always set\n+ * @run main ShapeNotSetSometimes\n+ *\/\n@@ -50,2 +54,1 @@\n-    private static final Color BACKGROUND_COLOR = Color.GREEN;\n-    private static final Color SHAPE_COLOR = Color.WHITE;\n+\n@@ -55,1 +58,0 @@\n-\n@@ -59,0 +61,2 @@\n+    private static final Color BACKGROUND_COLOR = Color.GREEN;\n+    private static final Color SHAPE_COLOR = Color.WHITE;\n@@ -63,0 +67,1 @@\n+        robot.delay(1000);\n@@ -127,1 +132,1 @@\n-        for(int i = 0; i < 50; i++) {\n+        for (int i = 1; i <= 50; i++) {\n@@ -139,1 +144,0 @@\n-\n@@ -176,0 +180,1 @@\n+            captureScreen();\n@@ -177,1 +182,0 @@\n-\n@@ -188,0 +192,14 @@\n+\n+    private static void captureScreen() {\n+        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();\n+        Rectangle screenBounds = new Rectangle(0, 0, screenSize.width, screenSize.height);\n+        try {\n+            ImageIO.write(\n+                    robot.createScreenCapture(screenBounds),\n+                    \"png\",\n+                    new File(\"Screenshot.png\")\n+            );\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+    }\n","filename":"test\/jdk\/java\/awt\/Frame\/ShapeNotSetSometimes\/ShapeNotSetSometimes.java","additions":33,"deletions":15,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,5 +32,26 @@\n-import java.awt.*;\n-import java.awt.datatransfer.*;\n-import java.awt.dnd.*;\n-import java.awt.event.*;\n-import java.io.*;\n+import java.awt.AWTEvent;\n+import java.awt.Component;\n+import java.awt.Dimension;\n+import java.awt.EventQueue;\n+import java.awt.Frame;\n+import java.awt.Point;\n+import java.awt.Robot;\n+import java.awt.Toolkit;\n+import java.awt.datatransfer.StringSelection;\n+import java.awt.datatransfer.Transferable;\n+import java.awt.dnd.DnDConstants;\n+import java.awt.dnd.DragGestureEvent;\n+import java.awt.dnd.DragGestureListener;\n+import java.awt.dnd.DragGestureRecognizer;\n+import java.awt.dnd.DragSource;\n+import java.awt.dnd.DragSourceAdapter;\n+import java.awt.dnd.DragSourceDropEvent;\n+import java.awt.dnd.DropTarget;\n+import java.awt.dnd.DropTargetAdapter;\n+import java.awt.dnd.DropTargetDropEvent;\n+import java.awt.dnd.DropTargetListener;\n+import java.awt.event.AWTEventListener;\n+import java.awt.event.InputEvent;\n+import java.awt.event.MouseEvent;\n+import java.io.File;\n+import java.io.InputStream;\n@@ -41,1 +62,1 @@\n-    private boolean successCodes[] = { true, false };\n+    private final boolean[] successCodes = { true, false };\n@@ -71,1 +92,3 @@\n-            Thread.sleep(Util.FRAME_ACTIVATION_TIMEOUT);\n+            Robot robot = new Robot();\n+            robot.waitForIdle();\n+            robot.delay(Util.FRAME_ACTIVATION_TIMEOUT);\n@@ -139,1 +162,1 @@\n-    public static final int FRAME_ACTIVATION_TIMEOUT = 3000;\n+    public static final int FRAME_ACTIVATION_TIMEOUT = 1000;\n@@ -142,1 +165,0 @@\n-    static final int MOUSE_RELEASE_TIMEOUT = 1000;\n@@ -161,6 +183,0 @@\n-    private Component clickedComponent = null;\n-\n-    private void reset() {\n-        clickedComponent = null;\n-    }\n-\n@@ -169,1 +185,0 @@\n-            clickedComponent = (Component)e.getSource();\n@@ -175,25 +190,0 @@\n-\n-    public static boolean pointInComponent(Robot robot, Point p, Component comp)\n-      throws InterruptedException {\n-        return theInstance.pointInComponentImpl(robot, p, comp);\n-    }\n-\n-    private boolean pointInComponentImpl(Robot robot, Point p, Component comp)\n-      throws InterruptedException {\n-        robot.waitForIdle();\n-        reset();\n-        robot.mouseMove(p.x, p.y);\n-        robot.mousePress(InputEvent.BUTTON1_MASK);\n-        synchronized (SYNC_LOCK) {\n-            robot.mouseRelease(InputEvent.BUTTON1_MASK);\n-            SYNC_LOCK.wait(MOUSE_RELEASE_TIMEOUT);\n-        }\n-\n-        Component c = clickedComponent;\n-\n-        while (c != null && c != comp) {\n-            c = c.getParent();\n-        }\n-\n-        return c == comp;\n-    }\n@@ -229,0 +219,3 @@\n+    private volatile boolean success1 = false;\n+    private volatile boolean success2 = false;\n+\n@@ -261,1 +254,3 @@\n-            Thread.sleep(Util.FRAME_ACTIVATION_TIMEOUT);\n+            Robot robot = new Robot();\n+            robot.waitForIdle();\n+            robot.delay(Util.FRAME_ACTIVATION_TIMEOUT);\n@@ -264,1 +259,0 @@\n-\n@@ -267,1 +261,0 @@\n-            Robot robot = new Robot();\n@@ -269,1 +262,3 @@\n-            robot.mousePress(InputEvent.BUTTON1_MASK);\n+            robot.waitForIdle();\n+            robot.delay(50);\n+            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n@@ -271,2 +266,2 @@\n-                 p.translate(Util.sign(targetPoint.x - p.x),\n-                             Util.sign(targetPoint.y - p.y))) {\n+                p.translate(Util.sign(targetPoint.x - p.x),\n+                            Util.sign(targetPoint.y - p.y))) {\n@@ -274,1 +269,1 @@\n-                Thread.sleep(50);\n+                robot.delay(5);\n@@ -278,1 +273,1 @@\n-                robot.mouseRelease(InputEvent.BUTTON1_MASK);\n+                robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n@@ -282,3 +277,7 @@\n-            if (!dragSourceListener.isDropFinished()) {\n-                throw new RuntimeException(\"Drop not finished\");\n-            }\n+            EventQueue.invokeAndWait(() -> {\n+                if (!dragSourceListener.isDropFinished()) {\n+                    throw new RuntimeException(\"Drop not finished\");\n+                }\n+                success1 = dragSourceListener.getDropSuccess();\n+                dragSourceListener.reset();\n+            });\n@@ -286,1 +285,0 @@\n-            boolean success1 = dragSourceListener.getDropSuccess();\n@@ -288,1 +286,0 @@\n-            dragSourceListener.reset();\n@@ -290,1 +287,3 @@\n-            robot.mousePress(InputEvent.BUTTON1_MASK);\n+            robot.waitForIdle();\n+            robot.delay(50);\n+            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n@@ -292,2 +291,2 @@\n-                 p.translate(Util.sign(targetPoint.x - p.x),\n-                             Util.sign(targetPoint.y - p.y))) {\n+                p.translate(Util.sign(targetPoint.x - p.x),\n+                            Util.sign(targetPoint.y - p.y))) {\n@@ -295,1 +294,1 @@\n-                Thread.sleep(50);\n+                robot.delay(5);\n@@ -299,1 +298,1 @@\n-                robot.mouseRelease(InputEvent.BUTTON1_MASK);\n+                robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n@@ -303,3 +302,7 @@\n-            if (!dragSourceListener.isDropFinished()) {\n-                throw new RuntimeException(\"Drop not finished\");\n-            }\n+            EventQueue.invokeAndWait(() -> {\n+                if (!dragSourceListener.isDropFinished()) {\n+                    throw new RuntimeException(\"Drop not finished\");\n+                }\n+                success2 = dragSourceListener.getDropSuccess();\n+                dragSourceListener.reset();\n+            });\n@@ -307,1 +310,0 @@\n-            boolean success2 = dragSourceListener.getDropSuccess();\n","filename":"test\/jdk\/java\/awt\/dnd\/InterJVMGetDropSuccessTest\/InterJVMGetDropSuccessTest.java","additions":66,"deletions":64,"binary":false,"changes":130,"status":"modified"},{"patch":"@@ -0,0 +1,114 @@\n+\/*\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.awt.Point;\n+import java.awt.Transparency;\n+import java.awt.color.ColorSpace;\n+import java.awt.image.BandedSampleModel;\n+import java.awt.image.BufferedImage;\n+import java.awt.image.ComponentColorModel;\n+import java.awt.image.DataBuffer;\n+import java.awt.image.DataBufferByte;\n+import java.awt.image.DataBufferFloat;\n+import java.awt.image.DataBufferInt;\n+import java.awt.image.Raster;\n+import java.awt.image.WritableRaster;\n+import java.util.Arrays;\n+\n+\/**\n+ * @test\n+ * @author Martin Desruisseaux\n+ *\/\n+public final class SetData {\n+    private static final int WIDTH = 3, HEIGHT = 2;\n+\n+    private static final int TRANSLATE_X = -2, TRANSLATE_Y = -3;\n+\n+    public static void main(final String[] args) {\n+        testWithIntegers();\n+        testWithFloats();\n+        testTranslatedSource();\n+    }\n+\n+    private static void testWithIntegers() {\n+        var data   = new int[] {4, 8, 2, 7, 9, 1};\n+        var empty  = new DataBufferInt(WIDTH*HEIGHT);\n+        var buffer = new DataBufferInt(data, WIDTH*HEIGHT);\n+        buffer = (DataBufferInt) writeAndRead(buffer, empty);\n+        if (!Arrays.equals(data, buffer.getData())) {\n+            throw new AssertionError(\"Pixel values are not equal.\");\n+        }\n+    }\n+\n+    private static void testWithFloats() {\n+        var data   = new float[] {0.4f, 0.8f, 0.2f, 0.7f, 0.9f, 0.1f};\n+        var empty  = new DataBufferFloat(WIDTH*HEIGHT);\n+        var buffer = new DataBufferFloat(data, WIDTH*HEIGHT);\n+        buffer = (DataBufferFloat) writeAndRead(buffer, empty);\n+        if (!Arrays.equals(data, buffer.getData())) {\n+            throw new AssertionError(\"Pixel values are not equal.\");\n+        }\n+    }\n+\n+    private static DataBuffer writeAndRead(DataBuffer buffer, DataBuffer empty) {\n+        \/*\n+         * Prepare an image with all pixels initialized to zero.\n+         *\/\n+        var dt = buffer.getDataType();\n+        var cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);\n+        var cm = new ComponentColorModel(cs, false, false, Transparency.OPAQUE, dt);\n+        var sm = new BandedSampleModel(dt, WIDTH, HEIGHT, 1);\n+        var wr = Raster.createWritableRaster(sm, empty, null);\n+        var im = new BufferedImage(cm, wr, false, null);\n+        \/*\n+         * Write data provided by the data buffer.\n+         *\/\n+        wr = Raster.createWritableRaster(sm, buffer, null);\n+        im.setData(wr);\n+        return im.getRaster().getDataBuffer();\n+    }\n+\n+    private static void testTranslatedSource() {\n+        var source = WritableRaster.createBandedRaster(\n+                DataBuffer.TYPE_BYTE,\n+                WIDTH  - TRANSLATE_X + 2,\n+                HEIGHT - TRANSLATE_Y + 1, 1,\n+                new Point(TRANSLATE_X, TRANSLATE_Y));\n+\n+        for (int y=0; y<HEIGHT; y++) {\n+            for (int x=0; x<WIDTH; x++) {\n+                source.setSample(x, y, 0, (y+1)*10 + (x+1));\n+            }\n+        }\n+        var expected = new byte[] {\n+            11, 12, 13,\n+            21, 22, 23\n+        };\n+        var im = new BufferedImage(WIDTH, HEIGHT, BufferedImage.TYPE_BYTE_GRAY);\n+        im.setData(source);\n+        var actual = ((DataBufferByte) im.getRaster().getDataBuffer()).getData();\n+        if (!Arrays.equals(expected, actual)) {\n+            throw new AssertionError(\"Pixel values are not equal.\");\n+        }\n+    }\n+}\n","filename":"test\/jdk\/java\/awt\/image\/BufferedImage\/SetData.java","additions":114,"deletions":0,"binary":false,"changes":114,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,1 @@\n+import java.util.List;\n@@ -46,1 +47,1 @@\n-        runInNewProcess(Runner.class, true)\n+        runInNewProcess(Runner.class, true, List.of(\"-XX:-CreateCoredumpOnCrash\"), List.of())\n","filename":"test\/jdk\/java\/foreign\/critical\/TestCriticalUpcall.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -434,1 +434,0 @@\n-        connection.setConnectTimeout(1000);\n","filename":"test\/jdk\/java\/net\/HttpURLConnection\/HttpURLConnectionExpectContinueTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,55 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8321545\n+ * @summary Ensure value returned by overridden toString method is as expected\n+ * @run junit ToStringTest\n+ *\/\n+\n+import java.text.ChoiceFormat;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class ToStringTest {\n+\n+    \/\/ Check a normal expected value. There is no null locale test as\n+    \/\/ ChoiceFormat is not localized.\n+    @Test\n+    public void normalValueTest() {\n+        String expectedStr = \"ChoiceFormat [pattern: \\\"1.0#foo\\\"]\\n\";\n+        var c = new ChoiceFormat(\"1.0#foo\");\n+        assertEquals(expectedStr, c.toString());\n+    }\n+\n+    \/\/ Ensure toString throws no exception when ChoiceFormat is created\n+    \/\/ with empty arrays\n+    @Test\n+    public void oddValueTest() {\n+        var c2 = new ChoiceFormat(new double[]{}, new String[]{});\n+        System.out.println(c2);\n+    }\n+}\n","filename":"test\/jdk\/java\/text\/Format\/ChoiceFormat\/ToStringTest.java","additions":55,"deletions":0,"binary":false,"changes":55,"status":"added"},{"patch":"@@ -0,0 +1,58 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8321545\n+ * @summary Ensure value returned by overridden toString method is as expected\n+ * @run junit ToStringTest\n+ *\/\n+\n+import java.text.CompactNumberFormat;\n+import java.text.DecimalFormatSymbols;\n+import java.text.NumberFormat;\n+import java.util.Locale;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class ToStringTest {\n+\n+    \/\/ Check a normal expected value. There is no null test as the getInstance\n+    \/\/ methods and constructor (which takes DFS) throw NPE if the locale param is null.\n+    @Test\n+    public void expectedValueTest() {\n+        String expectedStr = \"CompactNumberFormat [locale: \\\"English (Canada)\\\", decimal pattern: \\\"#,##0.###\\\", compact patterns: \\\"[, , , {one:0' 'thousand other:0' 'thousand}, {one:00' 'thousand other:00' 'thousand}, {one:000' 'thousand other:000' 'thousand}, {one:0' 'million other:0' 'million}, {one:00' 'million other:00' 'million}, {one:000' 'million other:000' 'million}, {one:0' 'billion other:0' 'billion}, {one:00' 'billion other:00' 'billion}, {one:000' 'billion other:000' 'billion}, {one:0' 'trillion other:0' 'trillion}, {one:00' 'trillion other:00' 'trillion}, {one:000' 'trillion other:000' 'trillion}]\\\"]\\n\";\n+        var c = NumberFormat.getCompactNumberInstance(Locale.CANADA, NumberFormat.Style.LONG);\n+        assertEquals(expectedStr, c.toString());\n+    }\n+\n+    \/\/ Check an odd value with empty decimal pattern and compact patterns.\n+    @Test\n+    public void oddValueTest() {\n+        String expectedStr = \"CompactNumberFormat [locale: \\\"English (Canada)\\\", decimal pattern: \\\"\\\", compact patterns: \\\"[]\\\"]\\n\";\n+        var c = new CompactNumberFormat(\"\", new DecimalFormatSymbols(Locale.CANADA), new String[]{});\n+        assertEquals(expectedStr, c.toString());\n+    }\n+}\n","filename":"test\/jdk\/java\/text\/Format\/CompactNumberFormat\/ToStringTest.java","additions":58,"deletions":0,"binary":false,"changes":58,"status":"added"},{"patch":"@@ -0,0 +1,82 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8321545\n+ * @library \/java\/text\/testlib\n+ * @summary Ensure value returned by overridden toString method is as expected\n+ * @run junit ToStringTest\n+ *\/\n+\n+import java.io.InputStream;\n+import java.io.ObjectInputStream;\n+import java.text.DateFormat;\n+import java.text.DateFormatSymbols;\n+import java.text.SimpleDateFormat;\n+import java.util.Locale;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class ToStringTest {\n+\n+    \/\/ Check a normal expected value\n+    @Test\n+    public void normalValueTest() {\n+        String expectedStr =\n+                \"SimpleDateFormat [locale: \\\"English (Canada)\\\", pattern: \\\"MMM d, y\\\"]\\n\";\n+        var s = DateFormat.getDateInstance(DateFormat.DEFAULT, Locale.CANADA);\n+        assertEquals(expectedStr, s.toString());\n+    }\n+\n+    \/\/ Check an odd value. SimpleDateFormat constructor that takes DFS, will use\n+    \/\/ the default locale, not the locale from the DFS.\n+    @Test\n+    public void oddValueTest() {\n+        String expectedStr =\n+                \"SimpleDateFormat [locale: \\\"\" + Locale.getDefault().getDisplayName() + \"\\\", pattern: \\\"MMM d, y\\\"]\\n\";\n+        var s = new SimpleDateFormat(\"MMM d, y\", new DateFormatSymbols(Locale.JAPAN));\n+        assertEquals(expectedStr, s.toString());\n+    }\n+\n+\n+    \/\/ Check the expected value when the locale is null. This is only possible\n+    \/\/ via an older SimpleDateFormat that was deserialized. The current constructor\n+    \/\/ will throw NPE if locale is null.\n+    @Test\n+    public void nullLocaleTest() {\n+        String expectedStr =\n+                \"SimpleDateFormat [locale: null, pattern: \\\"yyyy.MM.dd E hh.mm.ss zzz\\\"]\\n\";\n+        \/\/ Borrowed from DateFormatSymbolsSerializationTest\n+        SimpleDateFormat s;\n+        try (InputStream is = HexDumpReader.getStreamFromHexDump(\"SDFserialized.ser.txt\");\n+             ObjectInputStream iStream = new ObjectInputStream(is)) {\n+            s = (SimpleDateFormat)iStream.readObject();\n+            assertEquals(expectedStr, s.toString());\n+        } catch (Exception e) {\n+            System.out.println(\"Error building stream from deserialized simple date format\");\n+        }\n+    }\n+}\n","filename":"test\/jdk\/java\/text\/Format\/DateFormat\/ToStringTest.java","additions":82,"deletions":0,"binary":false,"changes":82,"status":"added"},{"patch":"@@ -0,0 +1,56 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8321545\n+ * @summary Ensure value returned by overridden toString method is as expected\n+ * @run junit ToStringTest\n+ *\/\n+\n+import java.text.DecimalFormat;\n+import java.text.DecimalFormatSymbols;\n+import java.text.NumberFormat;\n+import java.util.Locale;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class ToStringTest {\n+\n+    \/\/ Check a normal expected value. There is no null locale test as\n+    \/\/ DecimalFormatSymbols will throw an exception when created with a null locale.\n+    @Test\n+    public void expectedValueTest() {\n+        String expectedStr =\n+                \"DecimalFormat [locale: \\\"English (Canada)\\\", pattern: \\\"foo#00.00bar\\\"]\\n\";\n+        var d = new DecimalFormat(\"foo#00.00bar\", new DecimalFormatSymbols(Locale.CANADA));\n+        assertEquals(expectedStr, d.toString());\n+\n+        String expectedStr2 =\n+                \"DecimalFormat [locale: \\\"English (Canada)\\\", pattern: \\\"#,##0.###\\\"]\\n\";\n+        var d2 = NumberFormat.getInstance(Locale.CANADA);\n+        assertEquals(expectedStr2, d2.toString());\n+    }\n+}\n","filename":"test\/jdk\/java\/text\/Format\/DecimalFormat\/ToStringTest.java","additions":56,"deletions":0,"binary":false,"changes":56,"status":"added"},{"patch":"@@ -0,0 +1,49 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8321545\n+ * @summary Ensure value returned by overridden toString method is as expected\n+ * @run junit ToStringTest\n+ *\/\n+\n+import java.text.ListFormat;\n+import java.util.Locale;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class ToStringTest {\n+\n+    \/\/ Check a normal expected value. There is no null test as the getInstance\n+    \/\/ methods throw NPE if any arguments are null.\n+    @Test\n+    public void expectedValueTest() {\n+        String expectedStr =\n+                \"ListFormat [locale: \\\"English (Canada)\\\", start: \\\"{0}, {1}\\\", middle: \\\"{0}, {1}\\\", end: \\\"{0} and {1}\\\", two: \\\"{0} and {1}\\\", three: \\\"{0}, {1} and {2}\\\"]\\n\";\n+        var l = ListFormat.getInstance(Locale.CANADA, ListFormat.Type.STANDARD, ListFormat.Style.FULL);\n+        assertEquals(expectedStr, l.toString());\n+    }\n+}\n","filename":"test\/jdk\/java\/text\/Format\/ListFormat\/ToStringTest.java","additions":49,"deletions":0,"binary":false,"changes":49,"status":"added"},{"patch":"@@ -0,0 +1,57 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8321545\n+ * @summary Ensure value returned by overridden toString method is as expected\n+ * @run junit ToStringTest\n+ *\/\n+\n+import java.text.MessageFormat;\n+import java.util.Locale;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class ToStringTest {\n+\n+    \/\/ Check a normal expected value\n+    @Test\n+    public void expectedValueTest() {\n+        String expectedStr =\n+                \"MessageFormat [locale: \\\"English (Canada)\\\", pattern: \\\"foo {0}\\\"]\\n\";\n+        var m = new MessageFormat(\"foo {0}\", Locale.CANADA);\n+        assertEquals(expectedStr, m.toString());\n+    }\n+\n+    \/\/ Check the expected value when the locale is null\n+    @Test\n+    public void nullLocaleTest() {\n+        String expectedStr =\n+                \"MessageFormat [locale: null, pattern: \\\"foo {0}\\\"]\\n\";\n+        var m = new MessageFormat(\"foo {0}\", null);\n+        assertEquals(expectedStr, m.toString());\n+    }\n+}\n","filename":"test\/jdk\/java\/text\/Format\/MessageFormat\/ToStringTest.java","additions":57,"deletions":0,"binary":false,"changes":57,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,1 +40,1 @@\n- * @bug 8212970\n+ * @bug 8212970 8324065\n@@ -84,0 +84,1 @@\n+            {CASABLANCA, LocalDate.of(2038, 9, 27), 0, false},\n@@ -85,0 +86,2 @@\n+            {CASABLANCA, LocalDate.of(2087, 3, 31), 0, false},\n+            {CASABLANCA, LocalDate.of(2087, 5, 12), ONE_HOUR, true},\n","filename":"test\/jdk\/java\/util\/TimeZone\/NegativeDSTTest.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,274 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.io.OutputStream;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+\n+import javax.swing.Icon;\n+import javax.swing.UIManager;\n+import javax.swing.filechooser.FileSystemView;\n+\n+\/*\n+ * @test\n+ * @bug 8320692\n+ * @requires (os.family == \"windows\")\n+ * @summary NullPointerException is thrown for .exe file without icon\n+ * @run main\/othervm NoIconExeNPE\n+ *\/\n+public class NoIconExeNPE {\n+\n+    \/**\n+     * Bytes of a short {@code Hello.exe} which has no icon.\n+     *\/\n+    private static final byte[] bytes = {\n+            (byte) 0x4d, (byte) 0x5a, (byte) 0x80, (byte) 0x00, (byte) 0x01,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x04, (byte) 0x00,\n+            (byte) 0x10, (byte) 0x00, (byte) 0xff, (byte) 0xff, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x40, (byte) 0x01, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x40,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x80, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x0e,\n+            (byte) 0x1f, (byte) 0xba, (byte) 0x0e, (byte) 0x00, (byte) 0xb4,\n+            (byte) 0x09, (byte) 0xcd, (byte) 0x21, (byte) 0xb8, (byte) 0x01,\n+            (byte) 0x4c, (byte) 0xcd, (byte) 0x21, (byte) 0x54, (byte) 0x68,\n+            (byte) 0x69, (byte) 0x73, (byte) 0x20, (byte) 0x70, (byte) 0x72,\n+            (byte) 0x6f, (byte) 0x67, (byte) 0x72, (byte) 0x61, (byte) 0x6d,\n+            (byte) 0x20, (byte) 0x63, (byte) 0x61, (byte) 0x6e, (byte) 0x6e,\n+            (byte) 0x6f, (byte) 0x74, (byte) 0x20, (byte) 0x62, (byte) 0x65,\n+            (byte) 0x20, (byte) 0x72, (byte) 0x75, (byte) 0x6e, (byte) 0x20,\n+            (byte) 0x69, (byte) 0x6e, (byte) 0x20, (byte) 0x44, (byte) 0x4f,\n+            (byte) 0x53, (byte) 0x20, (byte) 0x6d, (byte) 0x6f, (byte) 0x64,\n+            (byte) 0x65, (byte) 0x2e, (byte) 0x0d, (byte) 0x0a, (byte) 0x24,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x50, (byte) 0x45,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x4c, (byte) 0x01, (byte) 0x01,\n+            (byte) 0x00, (byte) 0x55, (byte) 0x96, (byte) 0x96, (byte) 0x65,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0xe0, (byte) 0x00,\n+            (byte) 0x0f, (byte) 0x01, (byte) 0x0b, (byte) 0x01, (byte) 0x01,\n+            (byte) 0x49, (byte) 0x00, (byte) 0x02, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x10,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x10, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x40, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x10, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x02,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x01, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x04, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x20,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x02, (byte) 0x00,\n+            (byte) 0x00, (byte) 0xac, (byte) 0xa3, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x02, (byte) 0x00, (byte) 0x00, (byte) 0x01, (byte) 0x00,\n+            (byte) 0x10, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x10,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x01,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x10,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x40, (byte) 0x10, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x86, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x2e, (byte) 0x74, (byte) 0x65, (byte) 0x78,\n+            (byte) 0x74, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0xc6,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x10,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x02, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x02, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x20, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x60, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x6a, (byte) 0x00, (byte) 0x68,\n+            (byte) 0x29, (byte) 0x10, (byte) 0x40, (byte) 0x00, (byte) 0x68,\n+            (byte) 0x1c, (byte) 0x10, (byte) 0x40, (byte) 0x00, (byte) 0x6a,\n+            (byte) 0x00, (byte) 0xff, (byte) 0x15, (byte) 0x88, (byte) 0x10,\n+            (byte) 0x40, (byte) 0x00, (byte) 0x6a, (byte) 0x00, (byte) 0xff,\n+            (byte) 0x15, (byte) 0x80, (byte) 0x10, (byte) 0x40, (byte) 0x00,\n+            (byte) 0x48, (byte) 0x65, (byte) 0x6c, (byte) 0x6c, (byte) 0x6f,\n+            (byte) 0x20, (byte) 0x57, (byte) 0x6f, (byte) 0x72, (byte) 0x6c,\n+            (byte) 0x64, (byte) 0x21, (byte) 0x00, (byte) 0x48, (byte) 0x65,\n+            (byte) 0x6c, (byte) 0x6c, (byte) 0x6f, (byte) 0x20, (byte) 0x66,\n+            (byte) 0x61, (byte) 0x73, (byte) 0x6d, (byte) 0x00, (byte) 0x90,\n+            (byte) 0x90, (byte) 0x90, (byte) 0x90, (byte) 0x90, (byte) 0x90,\n+            (byte) 0x90, (byte) 0x90, (byte) 0x90, (byte) 0x90, (byte) 0x90,\n+            (byte) 0x90, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x90, (byte) 0x10,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x80, (byte) 0x10, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x9d, (byte) 0x10,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x88, (byte) 0x10, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x90, (byte) 0x90, (byte) 0x90, (byte) 0x90,\n+            (byte) 0xa8, (byte) 0x10, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0xb8, (byte) 0x10,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x6b, (byte) 0x65, (byte) 0x72, (byte) 0x6e,\n+            (byte) 0x65, (byte) 0x6c, (byte) 0x33, (byte) 0x32, (byte) 0x2e,\n+            (byte) 0x64, (byte) 0x6c, (byte) 0x6c, (byte) 0x00, (byte) 0x75,\n+            (byte) 0x73, (byte) 0x65, (byte) 0x72, (byte) 0x33, (byte) 0x32,\n+            (byte) 0x2e, (byte) 0x64, (byte) 0x6c, (byte) 0x6c, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x45, (byte) 0x78, (byte) 0x69,\n+            (byte) 0x74, (byte) 0x50, (byte) 0x72, (byte) 0x6f, (byte) 0x63,\n+            (byte) 0x65, (byte) 0x73, (byte) 0x73, (byte) 0x00, (byte) 0x90,\n+            (byte) 0x90, (byte) 0x00, (byte) 0x00, (byte) 0x4d, (byte) 0x65,\n+            (byte) 0x73, (byte) 0x73, (byte) 0x61, (byte) 0x67, (byte) 0x65,\n+            (byte) 0x42, (byte) 0x6f, (byte) 0x78, (byte) 0x41, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00,\n+            (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00\n+    };\n+\n+    public static void main(String[] args) throws Exception {\n+        final Path temp = Files.createTempDirectory(\"no-icon\");\n+        final Path hello = temp.resolve(\"Hello.exe\");\n+\n+        try {\n+            try (OutputStream out = Files.newOutputStream(hello)) {\n+                out.write(bytes);\n+            }\n+\n+            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());\n+\n+            FileSystemView fsv = FileSystemView.getFileSystemView();\n+            \/\/ No NullPointerException is expected\n+            Icon icon = fsv.getSystemIcon(hello.toFile());\n+            if (icon == null) {\n+                throw new RuntimeException(\"Null icon returned by FileSystemView.getSystemIcon()\");\n+            }\n+        } finally {\n+            Files.deleteIfExists(hello);\n+            Files.delete(temp);\n+        }\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/JFileChooser\/FileSystemView\/NoIconExeNPE.java","additions":274,"deletions":0,"binary":false,"changes":274,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import java.awt.Toolkit;\n@@ -212,1 +213,5 @@\n-        frame = new JFrame();\n+        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();\n+\n+        int xPos = (int) screenSize.getWidth() \/ 2;\n+        int yPos = (int) screenSize.getHeight() \/ 2;\n+        frame = new JFrame(\"FileChooser set location test\");\n@@ -241,0 +246,1 @@\n+        frame.setLocation(xPos, yPos - 200);\n@@ -283,1 +289,0 @@\n-\n@@ -292,1 +297,0 @@\n-\n","filename":"test\/jdk\/javax\/swing\/JFileChooser\/JFileChooserSetLocationTest.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -75,2 +75,2 @@\n-            \/\/ Allocate 512M of data\n-            byte[][] bytes = new byte[64][];\n+            \/\/ Allocate 512M of data in 1M chunks per iteration\n+            byte[][] bytes = new byte[64 * 8][];\n@@ -78,1 +78,1 @@\n-            for (int i = 0; i < 64; i++) {\n+            for (int i = 0; i < 64 * 8; i++) {\n@@ -80,1 +80,1 @@\n-                    bytes[i] = new byte[8 * 1024 * 1024];\n+                    bytes[i] = new byte[1024 * 1024];\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/MetricsMemoryTester.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -0,0 +1,343 @@\n+\/*\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jfr.event.io;\n+\n+import jdk.jfr.Recording;\n+import jdk.jfr.consumer.RecordedEvent;\n+import jdk.test.lib.jfr.Events;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import java.io.IOException;\n+import java.io.ObjectInputStream;\n+import java.io.ObjectOutputStream;\n+import java.io.ObjectStreamClass;\n+import java.io.ObjectStreamField;\n+import java.io.Serial;\n+import java.io.Serializable;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static jdk.test.lib.jfr.EventNames.SerializationMisdeclaration;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.params.provider.Arguments.arguments;\n+\n+\/*\n+ * @test\n+ * @bug 8275338 8324220\n+ * @summary Check generation of JFR events for misdeclared fields and methods\n+ *          relevant to serialization\n+ * @key jfr\n+ * @requires vm.hasJFR\n+ * @library \/test\/lib\n+ * @run junit\/othervm jdk.jfr.event.io.TestSerializationMisdeclarationEvent\n+ *\/\n+public class TestSerializationMisdeclarationEvent {\n+\n+    private static List<RecordedEvent> events;\n+\n+    @BeforeAll\n+    static void recordEvents() throws IOException {\n+        try (Recording r = new Recording()) {\n+            r.enable(SerializationMisdeclaration);\n+            r.start();\n+            doLookups();\n+            r.stop();\n+            events = Events.fromRecording(r);\n+        }\n+    }\n+\n+    static Arguments[] testSingleClassMisdeclarations() {\n+        return new Arguments[] {\n+                arguments(NoSUID.class, new String[] {\"serialVersionUID\", \"should\", \"explicitly\"}),\n+                arguments(NoSUID.class, new String[] {\"serialPersistentFields\", \"should\", \"non-null\"}),\n+\n+                arguments(BadClass.class, new String[] {\"serialVersionUID\", \"should\", \"private\"}),\n+                arguments(BadClass.class, new String[] {\"serialVersionUID\", \"must\", \"type\", \"long\"}),\n+                arguments(BadClass.class, new String[] {\"serialVersionUID\", \"must\", \"final\"}),\n+                arguments(BadClass.class, new String[] {\"serialVersionUID\", \"must\", \"static\"}),\n+                arguments(BadClass.class, new String[] {\"serialPersistentFields\", \"must\", \"private\"}),\n+                arguments(BadClass.class, new String[] {\"serialPersistentFields\", \"must\", \"static\"}),\n+                arguments(BadClass.class, new String[] {\"serialPersistentFields\", \"must\", \"final\"}),\n+                arguments(BadClass.class, new String[] {\"serialPersistentFields\", \"should\", \"type\", \"ObjectStreamField[]\"}),\n+                arguments(BadClass.class, new String[] {\"method\", \"writeObject\", \"must\", \"private\"}),\n+                arguments(BadClass.class, new String[] {\"method\", \"writeObject\", \"must\", \"non-static\"}),\n+                arguments(BadClass.class, new String[] {\"method\", \"writeObject\", \"must\", \"return\"}),\n+                arguments(BadClass.class, new String[] {\"method\", \"writeObject\", \"must\", \"parameter\"}),\n+                arguments(BadClass.class, new String[] {\"method\", \"readObject(\", \"must\", \"parameter\"}),\n+                arguments(BadClass.class, new String[] {\"method\", \"readObjectNoData\", \"must\", \"parameter\"}),\n+\n+                arguments(EnumClass.class, new String[] {\"serialVersionUID\", \"enum\"}),\n+                arguments(EnumClass.class, new String[] {\"serialPersistentFields\", \"enum\"}),\n+                arguments(EnumClass.class, new String[] {\"method\", \"writeObject\", \"enum\"}),\n+                arguments(EnumClass.class, new String[] {\"method\", \"readResolve\", \"enum\"}),\n+\n+                arguments(RecordClass.class, new String[] {\"serialPersistentFields\", \"record\"}),\n+                arguments(RecordClass.class, new String[] {\"method\", \"record\"}),\n+\n+                arguments(C.class, new String[] {\"method\", \"not\", \"accessible\"}),\n+\n+                arguments(Acc.class, new String[] {\"serialPersistentFields\", \"should\", \"type\", \"ObjectStreamField[]\"}),\n+                arguments(Acc.class, new String[] {\"serialPersistentFields\", \"must\", \"instance\", \"ObjectStreamField[]\"}),\n+                arguments(Acc.class, new String[] {\"method\", \"readResolve\", \"must\", \"non-abstract\"}),\n+                arguments(Acc.class, new String[] {\"method\", \"writeReplace\", \"must\", \"non-static\"}),\n+                arguments(Acc.class, new String[] {\"method\", \"writeReplace\", \"must\", \"return\"}),\n+                arguments(Acc.class, new String[] {\"method\", \"writeReplace\", \"must\", \"parameter\"}),\n+        };\n+    }\n+\n+    static Arguments[] testGoodClass() {\n+        return new Arguments[] {\n+                arguments(A.class),\n+                arguments(B.class),\n+        };\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource\n+    public void testSingleClassMisdeclarations(Class<?> cls, String[] keywords) {\n+        singleClassEvent(cls, keywords);\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource\n+    public void testGoodClass(Class<?> cls) {\n+        assertEquals(0, getEventsFor(cls).size(), cls.getName());\n+    }\n+\n+    private static void doLookups() {\n+        ObjectStreamClass.lookup(NoSUID.class);\n+        ObjectStreamClass.lookup(BadClass.class);\n+        ObjectStreamClass.lookup(EnumClass.class);\n+        ObjectStreamClass.lookup(RecordClass.class);\n+        ObjectStreamClass.lookup(Acc.class);\n+\n+        ObjectStreamClass.lookup(A.class);\n+        ObjectStreamClass.lookup(B.class);\n+        ObjectStreamClass.lookup(C.class);\n+    }\n+\n+    private static void singleClassEvent(Class<?> cls, String[] keywords) {\n+        assertEquals(1, getEventsFor(cls, keywords).size(), cls.getName());\n+    }\n+\n+    private static List<RecordedEvent> getEventsFor(Class<?> cls, String[] keywords) {\n+        return events.stream()\n+                .filter(e -> e.getClass(\"misdeclaredClass\").getName().equals(cls.getName())\n+                        && matchesAllKeywords(e.getString(\"message\"), keywords))\n+                .toList();\n+    }\n+\n+    private static boolean matchesAllKeywords(String msg, String[] keywords) {\n+        return Arrays.stream(keywords).allMatch(msg::contains);\n+    }\n+\n+    private static List<RecordedEvent> getEventsFor(Class<?> cls) {\n+        return events.stream()\n+                .filter(e -> e.getClass(\"misdeclaredClass\").getName().equals(cls.getName()))\n+                .toList();\n+    }\n+\n+    private static class A implements Serializable {\n+\n+        @Serial\n+        private static final long serialVersionUID = 0xAAAAL;\n+\n+        @Serial\n+        private static final ObjectStreamField[] serialPersistentFields = new ObjectStreamField[0];\n+\n+        @Serial\n+        private void writeObject(ObjectOutputStream oos) {\n+        }\n+\n+        @Serial\n+        private void readObject(ObjectInputStream ois) {\n+        }\n+\n+        @Serial\n+        private void readObjectNoData() {\n+        }\n+\n+        @Serial\n+        Object writeReplace() {\n+            return null;\n+        }\n+\n+    }\n+\n+    private static class B extends A {\n+\n+        @Serial\n+        private static final long serialVersionUID = 0xBBBBL;\n+\n+        @Serial\n+        private Object readResolve() {\n+            return null;\n+        }\n+\n+    }\n+\n+    private static final class C extends B {\n+\n+        @Serial\n+        private static final long serialVersionUID = 0xCCCCL;\n+\n+        \/*\n+         * readResolve() in superclass is not accessible\n+         *\/\n+\n+    }\n+\n+    private static final class NoSUID implements Serializable {\n+\n+        \/*\n+         * should declare serialVersionUID\n+         *\/\n+\n+        \/*\n+         * value should be non-null\n+         *\/\n+        private static final ObjectStreamField[] serialPersistentFields = null;\n+\n+    }\n+\n+    private static final class BadClass implements Serializable {\n+        \/*\n+         * should be private\n+         * must be long\n+         * must be final\n+         *\/\n+        Object serialVersionUID = 1.2;\n+\n+        \/*\n+         * must be private\n+         * must be static\n+         * must be final\n+         * should be ObjectStreamField[]\n+         *\/\n+        Object serialPersistentFields = new String[0];\n+\n+        \/*\n+         * must be private\n+         * must be non-static\n+         * must return void\n+         * must accept ObjectOutputStream\n+         *\/\n+        static int writeObject(int i) {\n+            return 0;\n+        }\n+\n+        \/*\n+         * must accept ObjectInputStream\n+         *\/\n+        private void readObject(ObjectOutputStream oos) {\n+        }\n+\n+        \/*\n+         * must not accept parameters\n+         *\/\n+        private void readObjectNoData(ObjectInputStream ois) {\n+        }\n+\n+    }\n+\n+    private enum EnumClass implements Serializable {\n+        __;  \/\/ ignored constant\n+\n+        \/*\n+         * non-effective on enum\n+         *\/\n+        private static final long serialVersionUID = 0xABCDL;\n+\n+        \/*\n+         * non-effective on enum\n+         *\/\n+        private static final ObjectStreamField[] serialPersistentFields = new ObjectStreamField[0];\n+\n+        \/*\n+         * non-effective on enum\n+         *\/\n+        private void writeObject(ObjectOutputStream oos) {\n+        }\n+\n+        \/*\n+         * non-effective on enum\n+         *\/\n+        public Object readResolve() {\n+            return null;\n+        }\n+\n+    }\n+\n+    private record RecordClass() implements Serializable {\n+\n+        \/*\n+         * allowed on records\n+         *\/\n+        private static final long serialVersionUID = 0x1234L;\n+\n+        \/*\n+         * non-effective on records\n+         *\/\n+        private static final ObjectStreamField[] serialPersistentFields = new ObjectStreamField[0];\n+\n+        \/*\n+         * non-effective on records\n+         *\/\n+        static int writeObject(int i) {\n+            return 0;\n+        }\n+\n+    }\n+\n+    private abstract static class Acc implements Serializable {\n+\n+        private static final long serialVersionUID = 0x5678L;\n+\n+        private static final Object serialPersistentFields = new String[0];\n+        \/*\n+         * must be non-abstract\n+         *\/\n+        abstract Object readResolve();\n+\n+        \/*\n+         * must be non-static\n+         *\/\n+        static Object writeReplace() {\n+            return null;\n+        }\n+\n+        \/*\n+         * must return Object\n+         * must have empty parameter types\n+         *\/\n+        String writeReplace(String s) {\n+            return null;\n+        }\n+\n+    }\n+\n+}\n","filename":"test\/jdk\/jdk\/jfr\/event\/io\/TestSerializationMisdeclarationEvent.java","additions":343,"deletions":0,"binary":false,"changes":343,"status":"added"},{"patch":"@@ -0,0 +1,76 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8159927\n+ * @modules java.base\/jdk.internal.util\n+ * @run main JmodExcludedFiles\n+ * @summary Test that JDK JMOD files do not include native debug symbols\n+ *\/\n+\n+import java.nio.file.DirectoryStream;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipFile;\n+import jdk.internal.util.OperatingSystem;\n+\n+public class JmodExcludedFiles {\n+    public static void main(String[] args) throws Exception {\n+        String javaHome = System.getProperty(\"java.home\");\n+        Path jmods = Path.of(javaHome, \"jmods\");\n+        try (DirectoryStream<Path> stream = Files.newDirectoryStream(jmods, \"*.jmod\")) {\n+            for (Path jmodFile : stream) {\n+                try (ZipFile zip = new ZipFile(jmodFile.toFile())) {\n+                    if (zip.stream().map(ZipEntry::getName)\n+                                    .anyMatch(JmodExcludedFiles::isNativeDebugSymbol)) {\n+                        throw new RuntimeException(jmodFile + \" is expected not to include native debug symbols\");\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private static boolean isNativeDebugSymbol(String name) {\n+        int index = name.indexOf(\"\/\");\n+        if (index < 0) {\n+            throw new RuntimeException(\"unexpected entry name: \" + name);\n+        }\n+        String section = name.substring(0, index);\n+        if (section.equals(\"lib\") || section.equals(\"bin\")) {\n+            if (OperatingSystem.isMacOS()) {\n+                String n = name.substring(index+1);\n+                int i = n.indexOf(\"\/\");\n+                if (i != -1) {\n+                    return n.substring(0, i).endsWith(\".dSYM\");\n+                }\n+            }\n+            return name.endsWith(\".diz\")\n+                    || name.endsWith(\".debuginfo\")\n+                    || name.endsWith(\".map\")\n+                    || name.endsWith(\".pdb\");\n+        }\n+        return false;\n+    }\n+}\n","filename":"test\/jdk\/jdk\/modules\/etc\/JmodExcludedFiles.java","additions":76,"deletions":0,"binary":false,"changes":76,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.security.SecureRandom;\n@@ -38,1 +39,3 @@\n-\n+        SecureRandom random = new SecureRandom();\n+        String alias = Integer.toString(random.nextInt(1000, 8192));\n+        String newAlias = alias + \"1\";\n@@ -43,1 +46,1 @@\n-            ks.setCertificateEntry(\"246810\", CertUtils.getCertFromFile(\"246810.cer\"));\n+            ks.setCertificateEntry(alias, CertUtils.getCertFromFile(\"246810.cer\"));\n@@ -45,2 +48,2 @@\n-            if (ks.containsAlias(\"13579\")) {\n-                ks.deleteEntry(\"13579\");\n+            if (ks.containsAlias(newAlias)) {\n+                ks.deleteEntry(newAlias);\n@@ -55,2 +58,2 @@\n-                    \"-alias\", \"246810\",\n-                    \"-destalias\", \"13579\").shouldHaveExitValue(0);\n+                    \"-alias\", alias,\n+                    \"-destalias\", newAlias).shouldHaveExitValue(0);\n@@ -66,1 +69,1 @@\n-            if (!ks.containsAlias(\"13579\")) {\n+            if (!ks.containsAlias(newAlias)) {\n@@ -71,2 +74,12 @@\n-            ks.deleteEntry(\"13579\");\n-            ks.deleteEntry(\"246810\");\n+            try {\n+                ks.deleteEntry(newAlias);\n+            } catch (Exception e) {\n+                System.err.println(\"Couldn't delete alias \" + newAlias);\n+                e.printStackTrace(System.err);\n+            }\n+            try {\n+                ks.deleteEntry(alias);\n+            } catch (Exception e) {\n+                System.err.println(\"Couldn't delete alias \" + alias);\n+                e.printStackTrace(System.err);\n+            }\n","filename":"test\/jdk\/sun\/security\/mscapi\/KeytoolChangeAlias.java","additions":23,"deletions":10,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8007572 8008161 8157792 8212970 8224560\n+ * @bug 8007572 8008161 8157792 8212970 8224560 8324065\n@@ -174,3 +174,3 @@\n-             * Temporary ignoring the failing TimeZones which are having zone\n-             * rules defined till year 2037 and\/or above and have negative DST\n-             * save time in IANA tzdata. This bug is tracked via JDK-8223388.\n+             * Ignoring the failing TimeZones which have negative DST\n+             * save time in IANA tzdata, as javazic\/ZoneInfoOld cannot\n+             * handle the negative DST.\n@@ -186,5 +186,0 @@\n-             *\n-             * Tehran\/Iran rule has rules beyond 2037, in which javazic assumes\n-             * to be the last year. Thus javazic's rule is based on year 2037\n-             * (Mar 20th\/Sep 20th are the cutover dates), while the real rule\n-             * has year 2087 where Mar 21st\/Sep 21st are the cutover dates.\n@@ -199,1 +194,0 @@\n-                zid.equals(\"Asia\/Tehran\") || \/\/ last rule mismatch\n@@ -201,2 +195,1 @@\n-                zid.equals(\"Asia\/Hebron\") || \/\/ uses \"Palestine\" rule\n-                zid.equals(\"Iran\")) { \/\/ last rule mismatch\n+                zid.equals(\"Asia\/Hebron\")) { \/\/ uses \"Palestine\" rule\n","filename":"test\/jdk\/sun\/util\/calendar\/zi\/TestZoneInfo310.java","additions":6,"deletions":13,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -54,2 +54,2 @@\n- * This table covers transitions from 1900 until 2037 (as of version\n- * 1.4), Before 1900, it assumes that there was no daylight saving\n+ * This table covers transitions from 1900 until 2100 (as of version\n+ * 23), Before 1900, it assumes that there was no daylight saving\n@@ -59,1 +59,1 @@\n- * supposed to observe daylight saving time in 2037, it delegates\n+ * supposed to observe daylight saving time in 2100, it delegates\n@@ -61,1 +61,1 @@\n- * object created using the daylight saving time schedule as of 2037.\n+ * object created using the daylight saving time schedule as of 2100.\n","filename":"test\/jdk\/sun\/util\/calendar\/zi\/ZoneInfoOld.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,1 +40,1 @@\n-    private static final int maxYear = 2037;\n+    private static final int maxYear = 2100;\n","filename":"test\/jdk\/sun\/util\/calendar\/zi\/Zoneinfo.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -66,0 +66,5 @@\n+# All tests\n+\n+all = \\\n+    :langtools_all\n+\n@@ -67,3 +72,1 @@\n-    jdk \\\n-    lib \\\n-    tools\n+    \/\n","filename":"test\/langtools\/TEST.groups","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,1 +71,1 @@\n-                \"<a href=\\\"#nested-class-summary\\\">\",\n+                \"<a href=\\\"#nested-class-summary\\\" tabindex=\\\"0\\\">\",\n@@ -75,1 +75,1 @@\n-                \"<a href=\\\"#method-summary\\\">\",\n+                \"<a href=\\\"#method-summary\\\" tabindex=\\\"0\\\">\",\n@@ -79,1 +79,1 @@\n-                \"<a href=\\\"#field-detail\\\">\",\n+                \"<a href=\\\"#field-detail\\\" tabindex=\\\"0\\\">\",\n@@ -83,1 +83,1 @@\n-                \"<a href=\\\"#constructor-detail\\\">\");\n+                \"<a href=\\\"#constructor-detail\\\" tabindex=\\\"0\\\">\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testAnchorNames\/TestAnchorNames.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,2 +55,1 @@\n-                    <li>Summary:&nbsp;<\/li>\n-                    <li><a href=\"#field-summary\">Field<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n+                    <li><a href=\"#field-summary\" tabindex=\"0\">Field Summary<\/a><\/li>\"\"\",\n@@ -58,2 +57,3 @@\n-                    <li>Detail:&nbsp;<\/li>\n-                    <li><a href=\"#field-detail\">Field<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n+                    <li><a href=\"#field-detail\" tabindex=\"0\">Field Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#DEFAULT_NAME\" tabindex=\"0\">DEFAULT_NAME<\/a><\/li>\"\"\",\n@@ -76,12 +76,11 @@\n-                    <ul class=\"sub-nav-list\">\n-                    <li>Summary:&nbsp;<\/li>\n-                    <li>Field&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#annotation-interface-required-element-summary\">Required<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#annotation-interface-optional-element-summary\">Optional<\/a><\/li>\n-                    <\/ul>\"\"\",\n-                \"\"\"\n-                    <ul class=\"sub-nav-list\">\n-                    <li>Detail:&nbsp;<\/li>\n-                    <li>Field&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#annotation-interface-element-detail\">Element<\/a><\/li>\n-                    <\/ul>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#annotation-interface-required-element-summary\" tabindex=\"0\">Required Element Summary<\/a><\/li>\n+                    <li><a href=\"#annotation-interface-optional-element-summary\" tabindex=\"0\">Optional Element Summary<\/a><\/li>\n+                    <li><a href=\"#annotation-interface-element-detail\" tabindex=\"0\">Element Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#value()\" tabindex=\"0\">value<\/a><\/li>\n+                    <li><a href=\"#optional()\" tabindex=\"0\">optional<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testAnnotationTypes\/TestAnnotationTypes.java","additions":16,"deletions":17,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -110,7 +110,11 @@\n-                    <section class=\"packages\">\n-                    <h2 title=\"Contents\">Contents<\/h2>\n-                    <ul class=\"contents-list\">\n-                    <li><a href=\"#p1.p2a\">p1.p2a.*<\/a><\/li>\n-                    <li><a href=\"#p1.p2b\">p1.p2b.*<\/a><\/li>\n-                    <\/ul>\n-                    <\/section>\"\"\");\n+                    <nav role=\"navigation\" class=\"toc\" aria-label=\"Table of contents\">\n+                    <div class=\"toc-header\">Contents&nbsp;\"\"\",\n+                \"\"\"\n+                    <li><a href=\"#\" tabindex=\"0\">Constant Field Values<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#p1.p2a\" tabindex=\"0\">p1.p2a.*<\/a><\/li>\n+                    <li><a href=\"#p1.p2b\" tabindex=\"0\">p1.p2b.*<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\n+                    <\/nav>\"\"\");\n@@ -143,6 +147,10 @@\n-                    <section class=\"packages\">\n-                    <h2 title=\"Contents\">Contents<\/h2>\n-                    <ul class=\"contents-list\">\n-                    <li><a href=\"#unnamed-package\">Unnamed Package<\/a><\/li>\n-                    <\/ul>\n-                    <\/section>\"\"\");\n+                    <nav role=\"navigation\" class=\"toc\" aria-label=\"Table of contents\">\n+                    <div class=\"toc-header\">Contents&nbsp;\"\"\",\n+                \"\"\"\n+                    <li><a href=\"#\" tabindex=\"0\">Constant Field Values<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#unnamed-package\" tabindex=\"0\">Unnamed Package<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\n+                    <\/nav>\"\"\");\n@@ -182,7 +190,11 @@\n-                    <section class=\"packages\">\n-                    <h2 title=\"Contents\">Contents<\/h2>\n-                    <ul class=\"contents-list\">\n-                    <li><a href=\"#unnamed-package\">Unnamed Package<\/a><\/li>\n-                    <li><a href=\"#p1.p2a\">p1.p2a.*<\/a><\/li>\n-                    <\/ul>\n-                    <\/section>\"\"\");\n+                    <nav role=\"navigation\" class=\"toc\" aria-label=\"Table of contents\">\n+                    <div class=\"toc-header\">Contents&nbsp;\"\"\",\n+                \"\"\"\n+                   <li><a href=\"#\" tabindex=\"0\">Constant Field Values<\/a>\n+                   <ol class=\"toc-list\">\n+                   <li><a href=\"#unnamed-package\" tabindex=\"0\">Unnamed Package<\/a><\/li>\n+                   <li><a href=\"#p1.p2a\" tabindex=\"0\">p1.p2a.*<\/a><\/li>\n+                   <\/ol>\n+                   <\/li>\n+                   <\/ol>\n+                   <\/nav>\"\"\");\n@@ -248,8 +260,12 @@\n-                    <section class=\"packages\">\n-                    <h2 title=\"Contents\">Contents<\/h2>\n-                    <ul class=\"contents-list\">\n-                    <li><a href=\"#p.a\">p.a.*<\/a><\/li>\n-                    <li><a href=\"#p.b\">p.b.*<\/a><\/li>\n-                    <li><a href=\"#p.q\">p.q.*<\/a><\/li>\n-                    <\/ul>\n-                    <\/section>\"\"\");\n+                    <nav role=\"navigation\" class=\"toc\" aria-label=\"Table of contents\">\n+                    <div class=\"toc-header\">Contents&nbsp;\"\"\",\n+                \"\"\"\n+                    <li><a href=\"#\" tabindex=\"0\">Constant Field Values<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#p.a\" tabindex=\"0\">p.a.*<\/a><\/li>\n+                    <li><a href=\"#p.b\" tabindex=\"0\">p.b.*<\/a><\/li>\n+                    <li><a href=\"#p.q\" tabindex=\"0\">p.q.*<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\n+                    <\/nav>\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testConstantValuesPage\/TestConstantValuesPage.java","additions":45,"deletions":29,"binary":false,"changes":74,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -59,5 +59,0 @@\n-                \"phi-HEADER-phi\",\n-                \"\"\"\n-                    <a href=\"..\/..\/module-summary.html\">Module<\/a>\"\"\",\n-                \"\"\"\n-                    <a href=\"..\/package-summary.html\">Package<\/a>\"\"\",\n@@ -65,1 +60,1 @@\n-                    <a href=\"..\/..\/..\/overview-tree.html\">Tree<\/a>\"\"\",\n+                    <a href=\"..\/package-tree.html\">Tree<\/a>\"\"\",\n@@ -70,0 +65,5 @@\n+                \"phi-HEADER-phi\",\n+                \"\"\"\n+                    <a href=\"..\/..\/module-summary.html\">acme.mdle<\/a>\"\"\",\n+                \"\"\"\n+                    <a href=\"..\/package-summary.html\" class=\"current-selection\">p<\/a>\"\"\",\n@@ -96,5 +96,0 @@\n-                \"phi-HEADER-phi\",\n-                \"\"\"\n-                    <a href=\"..\/..\/module-summary.html\">Module<\/a>\"\"\",\n-                \"\"\"\n-                    <a href=\"..\/package-summary.html\">Package<\/a>\"\"\",\n@@ -102,1 +97,1 @@\n-                    <a href=\"..\/..\/..\/overview-tree.html\">Tree<\/a>\"\"\",\n+                    <a href=\"..\/package-tree.html\">Tree<\/a>\"\"\",\n@@ -107,0 +102,5 @@\n+                \"phi-HEADER-phi\",\n+                \"\"\"\n+                    <a href=\"..\/..\/module-summary.html\">acme.mdle<\/a>\"\"\",\n+                \"\"\"\n+                    <a href=\"..\/package-summary.html\" class=\"current-selection\">p<\/a>\"\"\",\n@@ -120,3 +120,0 @@\n-                \"phi-HEADER-phi\",\n-                \"\"\"\n-                    <a href=\"..\/..\/..\/..\/module-summary.html\">Module<\/a>\"\"\",\n@@ -124,3 +121,1 @@\n-                    <a href=\"..\/..\/..\/package-summary.html\">Package<\/a>\"\"\",\n-                \"\"\"\n-                    <a href=\"..\/..\/..\/..\/..\/overview-tree.html\">Tree<\/a>\"\"\",\n+                    <a href=\"..\/..\/..\/package-tree.html\">Tree<\/a>\"\"\",\n@@ -131,0 +126,5 @@\n+                \"phi-HEADER-phi\",\n+                \"\"\"\n+                    <a href=\"..\/..\/..\/..\/module-summary.html\">acme2.mdle<\/a>\"\"\",\n+                \"\"\"\n+                    <a href=\"..\/..\/..\/package-summary.html\" class=\"current-selection\">p2<\/a>\"\"\",\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testCopyFiles\/TestCopyFiles.java","additions":19,"deletions":19,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -191,0 +191,3 @@\n+                \"\"\"\n+                    <nav role=\"navigation\" class=\"toc\" aria-label=\"Table of contents\">\n+                    <div class=\"toc-header\">Contents&nbsp;\"\"\",\n@@ -194,4 +197,0 @@\n-                \"\"\"\n-                    <section class=\"packages\">\n-                    <h2 title=\"Contents\">Contents<\/h2>\n-                    \"\"\",\n@@ -300,0 +299,1 @@\n+                    <div class=\"main-grid\">\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testHtmlVersion\/TestHtmlVersion.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -154,1 +154,5 @@\n-                    <div class=\"sub-title\"><span class=\"module-label-in-package\">Module<\/span>&nbsp;<a href=\"..\/module-summary.html\">m<\/a><\/div>\n+                    <ol class=\"sub-nav-list\">\n+                    <li><a href=\"..\/module-summary.html\">m<\/a><\/li>\n+                    &nbsp;&gt;&nbsp;\n+                    <li><a href=\"package-summary.html\" class=\"current-selection\">p<\/a><\/li>\n+                    <\/ol>\n@@ -158,1 +162,5 @@\n-                    <div class=\"sub-title\"><span class=\"module-label-in-package\">Module<\/span>&nbsp;<a href=\"..\/module-summary.html\">o<\/a><\/div>\n+                    <ol class=\"sub-nav-list\">\n+                    <li><a href=\"..\/module-summary.html\">o<\/a><\/li>\n+                    &nbsp;&gt;&nbsp;\n+                    <li><a href=\"package-summary.html\" class=\"current-selection\">p<\/a><\/li>\n+                    <\/ol>\n@@ -162,2 +170,7 @@\n-                    <div class=\"sub-title\"><span class=\"module-label-in-type\">Module<\/span>&nbsp;<a href=\"..\/module-summary.html\">m<\/a><\/div>\n-                    <div class=\"sub-title\"><span class=\"package-label-in-type\">Package<\/span>&nbsp;<a href=\"package-summary.html\">p<\/a><\/div>\n+                    <ol class=\"sub-nav-list\">\n+                    <li><a href=\"..\/module-summary.html\">m<\/a><\/li>\n+                    &nbsp;&gt;&nbsp;\n+                    <li><a href=\"package-summary.html\">p<\/a><\/li>\n+                    &nbsp;&gt;&nbsp;\n+                    <li><a href=\"C.html\" class=\"current-selection\" title=\"class in p\">C<\/a><\/li>\n+                    <\/ol>\n@@ -167,2 +180,7 @@\n-                    <div class=\"sub-title\"><span class=\"module-label-in-type\">Module<\/span>&nbsp;<a href=\"..\/module-summary.html\">o<\/a><\/div>\n-                    <div class=\"sub-title\"><span class=\"package-label-in-type\">Package<\/span>&nbsp;<a href=\"package-summary.html\">p<\/a><\/div>\n+                    <ol class=\"sub-nav-list\">\n+                    <li><a href=\"..\/module-summary.html\">o<\/a><\/li>\n+                    &nbsp;&gt;&nbsp;\n+                    <li><a href=\"package-summary.html\">p<\/a><\/li>\n+                    &nbsp;&gt;&nbsp;\n+                    <li><a href=\"C.html\" class=\"current-selection\" title=\"class in p\">C<\/a><\/li>\n+                    <\/ol>\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testModules\/TestModulePackages.java","additions":25,"deletions":7,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -75,4 +75,5 @@\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Modules&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#services-summary\">Services<\/a><\/li>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#services-summary\" tabindex=\"0\">Services<\/a><\/li>\n+                    <\/ol>\"\"\");\n@@ -100,4 +101,5 @@\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Modules&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#services-summary\">Services<\/a><\/li>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#services-summary\" tabindex=\"0\">Services<\/a><\/li>\n+                    <\/ol>\"\"\");\n@@ -123,4 +125,4 @@\n-                    <li>Description&nbsp;|&nbsp;<\/li>\n-                    <li>Modules&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Services<\/li>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <\/ol>\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testModules\/TestModuleServicesLink.java","additions":15,"deletions":13,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -524,0 +524,1 @@\n+                    <div class=\"main-grid\">\n@@ -579,1 +580,1 @@\n-        checkOutput(\"index.html\", true,\n+        checkOutput(\"index.html\", false,\n@@ -589,1 +590,1 @@\n-                    <li><a href=\"..\/..\/module-summary.html\">Module<\/a><\/li>\"\"\");\n+                    <li><a href=\"..\/..\/module-summary.html\">moduleA<\/a><\/li>\"\"\");\n@@ -592,2 +593,2 @@\n-                    <li><a href=\"..\/module-summary.html\">Module<\/a><\/li>\"\"\");\n-        checkOutput(\"moduleB\/testpkgmdlB\/TestClassInModuleB.html\", true,\n+                    <li><a href=\"..\/module-summary.html\">moduleB<\/a><\/li>\"\"\");\n+        checkOutput(\"moduleB\/testpkgmdlB\/TestClassInModuleB.html\", false,\n@@ -598,1 +599,1 @@\n-                    <li><a href=\"..\/..\/module-summary.html\">Module<\/a><\/li>\"\"\");\n+                    <li><a href=\"..\/..\/module-summary.html\">moduleB<\/a><\/li>\"\"\");\n@@ -713,0 +714,1 @@\n+                    <div class=\"main-grid\">\n@@ -723,7 +725,5 @@\n-                    <ul class=\"sub-nav-list\">\n-                    <li>Module:&nbsp;<\/li>\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#modules-summary\">Modules<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Services<\/li>\n-                    <\/ul>\"\"\",\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#modules-summary\" tabindex=\"0\">Modules<\/a><\/li>\n+                    <\/ol>\"\"\",\n@@ -751,4 +751,5 @@\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Modules&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#services-summary\">Services<\/a><\/li>\"\"\",\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#services-summary\" tabindex=\"0\">Services<\/a><\/li>\n+                    <\/ol>\"\"\",\n@@ -825,1 +826,1 @@\n-                    <li><a href=\"..\/module-summary.html\">Module<\/a><\/li>\"\"\",\n+                    <li><a href=\"..\/module-summary.html\">moduleA<\/a><\/li>\"\"\",\n@@ -827,2 +828,1 @@\n-                    <div class=\"sub-title\"><span class=\"module-label-in-package\">Module<\/span>&nbsp;\\\n-                    <a href=\"..\/module-summary.html\">moduleA<\/a><\/div>\"\"\");\n+                    <li><a href=\"..\/module-summary.html\">moduleA<\/a><\/li>\"\"\");\n@@ -831,1 +831,1 @@\n-                    <li><a href=\"..\/module-summary.html\">Module<\/a><\/li>\"\"\",\n+                    <li><a href=\"..\/module-summary.html\">moduleA<\/a><\/li>\"\"\",\n@@ -833,2 +833,1 @@\n-                    <div class=\"sub-title\"><span class=\"module-label-in-type\">Module<\/span>&nbsp;<a \\\n-                    href=\"..\/module-summary.html\">moduleA<\/a><\/div>\"\"\");\n+                    <li><a href=\"..\/module-summary.html\">moduleA<\/a><\/li>\"\"\");\n@@ -837,2 +836,1 @@\n-                    <div class=\"sub-title\"><span class=\"module-label-in-type\">Module<\/span>&nbsp;<a \\\n-                    href=\"..\/module-summary.html\">moduleB<\/a><\/div>\"\"\",\n+                    <li><a href=\"..\/module-summary.html\">moduleB<\/a><\/li>\"\"\",\n@@ -840,2 +838,1 @@\n-                    <div class=\"sub-title\"><span class=\"package-label-in-type\">Package<\/span>&nbsp;<\\\n-                    a href=\"package-summary.html\">testpkgmdlB<\/a><\/div>\"\"\");\n+                    <li><a href=\"package-summary.html\">testpkgmdlB<\/a><\/li>\"\"\");\n@@ -903,4 +900,5 @@\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#modules-summary\">Modules<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Services<\/li>\"\"\",\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#modules-summary\" tabindex=\"0\">Modules<\/a><\/li>\n+                    <\/ol>\"\"\",\n@@ -917,4 +915,5 @@\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#modules-summary\">Modules<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Services<\/li>\"\"\",\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#modules-summary\" tabindex=\"0\">Modules<\/a><\/li>\n+                    <\/ol>\"\"\",\n@@ -964,4 +963,5 @@\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li>Modules&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#services-summary\">Services<\/a><\/li>\"\"\",\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#services-summary\" tabindex=\"0\">Services<\/a><\/li>\n+                    <\/ol>\"\"\",\n@@ -1040,4 +1040,6 @@\n-                    <li><a href=\"#module-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#modules-summary\">Modules<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#packages-summary\">Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#services-summary\">Services<\/a><\/li>\"\"\",\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#packages-summary\" tabindex=\"0\">Packages<\/a><\/li>\n+                    <li><a href=\"#modules-summary\" tabindex=\"0\">Modules<\/a><\/li>\n+                    <li><a href=\"#services-summary\" tabindex=\"0\">Services<\/a><\/li>\n+                    <\/ol>\"\"\",\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testModules\/TestModules.java","additions":45,"deletions":43,"binary":false,"changes":88,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8196027 8196202\n+ * @bug 8196027 8196202 8320458\n@@ -57,0 +57,116 @@\n+    @Test\n+    public void testSingleModule(Path base) throws Exception {\n+        Path src = Files.createDirectories(base.resolve(\"src\"));\n+        ModuleBuilder mb = new ModuleBuilder(tb, \"m\")\n+                .comment(\"Module m.\")\n+                .exports(\"p1\")\n+                .classes(\"package p1; @Deprecated public class A {}\")\n+                .classes(\"package p1; public class B {}\");\n+        mb.write(src);\n+\n+        javadoc(\"-d\", base.resolve(\"out-single-module\").toString(),\n+                \"--module-source-path\", src.toString(),\n+                \"--module\", \"m\");\n+        checkExit(Exit.OK);\n+\n+        checkOutput(\"index.html\", true,\n+                \"\"\"\n+                    <script type=\"text\/javascript\">window.location.replace('m\/module-summary.html')<\/script>\n+                    <noscript>\n+                    <meta http-equiv=\"Refresh\" content=\"0;m\/module-summary.html\">\n+                    <\/noscript>\"\"\",\n+                \"\"\"\n+                    <p><a href=\"m\/module-summary.html\">m\/module-summary.html<\/a><\/p>\"\"\");\n+\n+        checkOutput(\"m\/module-summary.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li class=\"nav-bar-cell1-rev\">Module<\/li>\n+                    <li><a href=\"..\/overview-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/deprecated-list.html\">Deprecated<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#module\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"overview-tree.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"m\/module-summary.html\">Module<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Tree<\/li>\n+                    <li><a href=\"deprecated-list.html\">Deprecated<\/a><\/li>\n+                    <li><a href=\"index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n+                    <li><a href=\"help-doc.html#tree\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"deprecated-list.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"m\/module-summary.html\">Module<\/a><\/li>\n+                    <li><a href=\"overview-tree.html\">Tree<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Deprecated<\/li>\n+                    <li><a href=\"index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n+                    <li><a href=\"help-doc.html#deprecated\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"index-all.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"m\/module-summary.html\">Module<\/a><\/li>\n+                    <li><a href=\"overview-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"deprecated-list.html\">Deprecated<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Index<\/li>\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n+                    <li><a href=\"help-doc.html#index\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"search.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"m\/module-summary.html\">Module<\/a><\/li>\n+                    <li><a href=\"overview-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"deprecated-list.html\">Deprecated<\/a><\/li>\n+                    <li><a href=\"index-all.html\">Index<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Search<\/li>\n+                    <li><a href=\"help-doc.html#search\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"help-doc.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"m\/module-summary.html\">Module<\/a><\/li>\n+                    <li><a href=\"overview-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"deprecated-list.html\">Deprecated<\/a><\/li>\n+                    <li><a href=\"index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Help<\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"m\/p1\/package-summary.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"..\/module-summary.html\">Module<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Package<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/..\/deprecated-list.html\">Deprecated<\/a><\/li>\n+                    <li><a href=\"..\/..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/..\/help-doc.html#package\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"m\/p1\/A.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"..\/module-summary.html\">Module<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/..\/deprecated-list.html\">Deprecated<\/a><\/li>\n+                    <li><a href=\"..\/..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/..\/help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+    }\n+\n+\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testNavigation\/TestModuleNavigation.java","additions":118,"deletions":2,"binary":false,"changes":120,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,2 +26,2 @@\n- * @bug      4131628 4664607 7025314 8023700 7198273 8025633 8026567 8081854 8150188 8151743 8196027 8182765\n- *           8196200 8196202 8223378 8258659 8261976\n+ * @bug      7025314 8023700 7198273 8025633 8026567 8081854 8196027 8182765\n+ *           8196200 8196202 8223378 8258659 8261976 8320458\n@@ -32,1 +32,1 @@\n- * @build    toolbox.ToolBox javadoc.tester.*\n+ * @build    toolbox.ToolBox javadoc.tester.* builder.ClassBuilder\n@@ -37,0 +37,1 @@\n+import java.nio.file.Files;\n@@ -38,1 +39,0 @@\n-import java.nio.file.Paths;\n@@ -41,0 +41,1 @@\n+import builder.ClassBuilder;\n@@ -56,2 +57,2 @@\n-    public void test(Path ignore) {\n-        javadoc(\"-d\", \"out\",\n+    public void testOverview(Path base) {\n+        javadoc(\"-d\", base.resolve(\"api\").toString(),\n@@ -64,0 +65,21 @@\n+        checkOutput(\"index.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li class=\"nav-bar-cell1-rev\">Overview<\/li>\n+                    <li><a href=\"pkg\/package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n+                    <li><a href=\"help-doc.html#overview\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"pkg\/package-summary.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"..\/index.html\">Overview<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Package<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#package\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n@@ -67,1 +89,7 @@\n-                    <li><a href=\"..\/index.html\">Overview<\/a><\/li>\"\"\");\n+                    <li><a href=\"..\/index.html\">Overview<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n@@ -72,1 +100,7 @@\n-                    <li><a href=\"..\/index.html\">Overview<\/a><\/li>\"\"\");\n+                    <li><a href=\"..\/index.html\">Overview<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n@@ -77,1 +111,7 @@\n-                    <li><a href=\"..\/index.html\">Overview<\/a><\/li>\"\"\");\n+                    <li><a href=\"..\/index.html\">Overview<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n@@ -87,42 +127,0 @@\n-\n-        \/\/ Remaining tests check for additional padding to offset the fixed navigation bar.\n-        checkOutput(\"pkg\/A.html\", true,\n-                \"\"\"\n-                    <!-- ========= END OF TOP NAVBAR ========= -->\n-                    <span class=\"skip-nav\" id=\"skip-navbar-top\"><\/span><\/nav>\n-                    <\/header>\n-                    <main role=\"main\">\n-                    <!-- ======== START OF CLASS DATA ======== -->\"\"\");\n-\n-        checkOutput(\"pkg\/package-summary.html\", true,\n-                \"\"\"\n-                    <!-- ========= END OF TOP NAVBAR ========= -->\n-                    <span class=\"skip-nav\" id=\"skip-navbar-top\"><\/span><\/nav>\n-                    <\/header>\n-                    <main role=\"main\">\n-                    <div class=\"header\">\"\"\");\n-    }\n-\n-    \/\/ Test for checking additional padding to offset the fixed navigation bar in HTML5.\n-    @Test\n-    public void test1(Path ignore) {\n-        javadoc(\"-d\", \"out-1\",\n-                \"-html5\",\n-                \"-sourcepath\", testSrc,\n-                \"pkg\");\n-        checkExit(Exit.OK);\n-        checkSubNav();\n-\n-        checkOutput(\"pkg\/A.html\", true,\n-                \"\"\"\n-                    <!-- ========= END OF TOP NAVBAR ========= -->\n-                    <span class=\"skip-nav\" id=\"skip-navbar-top\"><\/span><\/nav>\n-                    <\/header>\n-                    <main role=\"main\">\n-                    <!-- ======== START OF CLASS DATA ======== -->\"\"\");\n-\n-        checkOutput(\"pkg\/package-summary.html\", true,\n-                \"\"\"\n-                    <!-- ========= END OF TOP NAVBAR ========= -->\n-                    <span class=\"skip-nav\" id=\"skip-navbar-top\"><\/span><\/nav>\n-                    \"\"\");\n@@ -131,1 +129,0 @@\n-    \/\/ Test to make sure that no extra padding for nav bar gets generated if -nonavbar is specified.\n@@ -133,27 +130,1 @@\n-    public void test2(Path ignore) {\n-        javadoc(\"-d\", \"out-2\",\n-                \"-nonavbar\",\n-                \"-sourcepath\", testSrc,\n-                \"pkg\");\n-        checkExit(Exit.OK);\n-        checkSubNav();\n-\n-        checkOutput(\"pkg\/A.html\", false,\n-                \"\"\"\n-                    <!-- ========= END OF TOP NAVBAR ========= -->\n-                    <\/div>\n-                    <div class=\"skip-nav\"><a id=\"skip-navbar-top\"><\/a><\/div>\n-                    <\/nav>\n-                    <\/header>\n-                    <!-- ======== START OF CLASS DATA ======== -->\"\"\");\n-\n-        checkOutput(\"pkg\/package-summary.html\", false,\n-                \"\"\"\n-                    <!-- ========= END OF TOP NAVBAR ========= -->\n-                    <\/div>\n-                    <div class=\"skip-nav\"><a id=\"skip-navbar-top\"><\/a><\/div>\n-                    <\/nav>\"\"\");\n-    }\n-\n-    @Test\n-    public void test3(Path base) throws IOException {\n+    public void testNavLinks(Path base) throws IOException {\n@@ -204,1 +175,1 @@\n-        javadoc(\"-d\", \"out-3\",\n+        javadoc(\"-d\", base.resolve(\"api\").toString(),\n@@ -210,5 +181,0 @@\n-                \"Summary\",\n-                \"\"\"\n-                    <li><a href=\"#nested-class-summary\">Nested<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n-                \"\"\"\n-                    <li><a href=\"#field-summary\">Field<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n@@ -216,3 +182,22 @@\n-                    <li><a href=\"#constructor-summary\">Constr<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n-                \"\"\"\n-                    <li><a href=\"#method-summary\">Method<\/a><\/li>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#nested-class-summary\" tabindex=\"0\">Nested Class Summary<\/a><\/li>\n+                    <li><a href=\"#field-summary\" tabindex=\"0\">Field Summary<\/a><\/li>\n+                    <li><a href=\"#constructor-summary\" tabindex=\"0\">Constructor Summary<\/a><\/li>\n+                    <li><a href=\"#method-summary\" tabindex=\"0\">Method Summary<\/a><\/li>\n+                    <li><a href=\"#field-detail\" tabindex=\"0\">Field Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#field\" tabindex=\"0\">field<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <li><a href=\"#constructor-detail\" tabindex=\"0\">Constructor Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#%3Cinit%3E()\" tabindex=\"0\">X()<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <li><a href=\"#method-detail\" tabindex=\"0\">Method Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#method()\" tabindex=\"0\">method()<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\"\"\");\n@@ -221,5 +206,0 @@\n-                \"Summary\",\n-                \"\"\"\n-                    <li><a href=\"#nested-class-summary\">Nested<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n-                \"\"\"\n-                    <li><a href=\"#field-summary\">Field<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n@@ -227,3 +207,12 @@\n-                    <li><a href=\"#constructor-summary\">Constr<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n-                \"\"\"\n-                    <li><a href=\"#method-summary\">Method<\/a><\/li>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#nested-class-summary\" tabindex=\"0\">Nested Class Summary<\/a><\/li>\n+                    <li><a href=\"#field-summary\" tabindex=\"0\">Field Summary<\/a><\/li>\n+                    <li><a href=\"#constructor-summary\" tabindex=\"0\">Constructor Summary<\/a><\/li>\n+                    <li><a href=\"#method-summary\" tabindex=\"0\">Method Summary<\/a><\/li>\n+                    <li><a href=\"#constructor-detail\" tabindex=\"0\">Constructor Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#%3Cinit%3E()\" tabindex=\"0\">Y()<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\"\"\");\n@@ -232,5 +221,0 @@\n-                \"Summary\",\n-                \"<li>Nested&nbsp;|&nbsp;<\/li>\",\n-                \"<li>Field&nbsp;|&nbsp;<\/li>\",\n-                \"\"\"\n-                    <li><a href=\"#constructor-summary\">Constr<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n@@ -238,1 +222,10 @@\n-                    <li><a href=\"#method-summary\">Method<\/a><\/li>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#constructor-summary\" tabindex=\"0\">Constructor Summary<\/a><\/li>\n+                    <li><a href=\"#method-summary\" tabindex=\"0\">Method Summary<\/a><\/li>\n+                    <li><a href=\"#constructor-detail\" tabindex=\"0\">Constructor Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#%3Cinit%3E()\" tabindex=\"0\">IC()<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\"\"\");\n@@ -241,5 +234,0 @@\n-                \"Summary\",\n-                \"<li>Nested&nbsp;|&nbsp;<\/li>\",\n-                \"<li>Field&nbsp;|&nbsp;<\/li>\",\n-                \"\"\"\n-                    <li><a href=\"#constructor-summary\">Constr<\/a>&nbsp;|&nbsp;<\/li>\"\"\",\n@@ -247,1 +235,10 @@\n-                    <li><a href=\"#method-summary\">Method<\/a><\/li>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#constructor-summary\" tabindex=\"0\">Constructor Summary<\/a><\/li>\n+                    <li><a href=\"#method-summary\" tabindex=\"0\">Method Summary<\/a><\/li>\n+                    <li><a href=\"#constructor-detail\" tabindex=\"0\">Constructor Details<\/a>\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#%3Cinit%3E()\" tabindex=\"0\">C()<\/a><\/li>\n+                    <\/ol>\n+                    <\/li>\n+                    <\/ol>\"\"\");\n@@ -250,5 +247,4 @@\n-                \"Summary\",\n-                \"<li>Nested&nbsp;|&nbsp;<\/li>\",\n-                \"<li>Field&nbsp;|&nbsp;<\/li>\",\n-                \"<li>Constr&nbsp;|&nbsp;<\/li>\",\n-                \"<li>Method<\/li>\");\n+                \"\"\"\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <\/ol>\"\"\");\n@@ -304,0 +300,119 @@\n+\n+    @Test\n+    public void testSinglePackage(Path base) {\n+        javadoc(\"-d\", base.resolve(\"api\").toString(),\n+                \"-sourcepath\", testSrc,\n+                \"pkg\");\n+        checkExit(Exit.OK);\n+        checkSubNav();\n+\n+        checkOutput(\"index.html\", true,\n+                \"\"\"\n+                    <meta http-equiv=\"Refresh\" content=\"0;pkg\/package-summary.html\">\"\"\",\n+                \"\"\"\n+                 <p><a href=\"pkg\/package-summary.html\">pkg\/package-summary.html<\/a><\/p>\"\"\");\n+\n+        checkOutput(\"pkg\/package-summary.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li class=\"nav-bar-cell1-rev\">Package<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#package\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"pkg\/A.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"package-summary.html\">Package<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"pkg\/C.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"package-summary.html\">Package<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"pkg\/E.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"package-summary.html\">Package<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"..\/index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"..\/search.html\">Search<\/a><\/li>\n+                    <li><a href=\"..\/help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\");\n+\n+        checkOutput(\"pkg\/I.html\", true,\n+                \/\/ Test for 4664607\n+                \"\"\"\n+                    <div class=\"skip-nav\"><a href=\"#skip-navbar-top\" title=\"Skip navigation links\">Skip navigation links<\/a><\/div>\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    \"\"\",\n+                \"\"\"\n+                    <li><a href=\"package-summary.html\">Package<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\"\"\");\n+    }\n+\n+    @Test\n+    public void testUnnamedPackage(Path base) throws Exception {\n+        Path src = Files.createDirectories(base.resolve(\"src\"));\n+        new ClassBuilder(tb, \"C\")\n+                .setModifiers(\"public\", \"class\")\n+                .write(src);\n+\n+        javadoc(\"-d\", base.resolve(\"api\").toString(),\n+                src.resolve(\"C.java\").toString());\n+        checkExit(Exit.OK);\n+\n+        checkOutput(\"index.html\", true,\n+                \"\"\"\n+                    <script type=\"text\/javascript\">window.location.replace('package-summary.html')<\/script>\n+                    <noscript>\n+                    <meta http-equiv=\"Refresh\" content=\"0;package-summary.html\">\n+                    <\/noscript>\"\"\");\n+\n+        checkOutput(\"package-summary.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li class=\"nav-bar-cell1-rev\">Package<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n+                    <li><a href=\"help-doc.html#package\">Help<\/a><\/li>\n+                    <\/ul>\"\"\",\n+                \"\"\"\n+                    <ol class=\"sub-nav-list\">\n+                    <li><a href=\"package-summary.html\" class=\"current-selection\">Unnamed Package<\/a><\/li>\n+                    <\/ol>\"\"\");\n+\n+        checkOutput(\"C.html\", true,\n+                \"\"\"\n+                    <ul id=\"navbar-top-firstrow\" class=\"nav-list\" title=\"Navigation\">\n+                    <li><a href=\"package-summary.html\">Package<\/a><\/li>\n+                    <li class=\"nav-bar-cell1-rev\">Class<\/li>\n+                    <li><a href=\"package-tree.html\">Tree<\/a><\/li>\n+                    <li><a href=\"index-all.html\">Index<\/a><\/li>\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n+                    <li><a href=\"help-doc.html#class\">Help<\/a><\/li>\n+                    <\/ul>\"\"\",\n+                \"\"\"\n+                    <ol class=\"sub-nav-list\">\n+                    <li><a href=\"package-summary.html\">Unnamed Package<\/a><\/li>\n+                    &nbsp;&gt;&nbsp;\n+                    <li><a href=\"C.html\" class=\"current-selection\" title=\"class in Unnamed Package\">C<\/a><\/li>\n+                    <\/ol>\"\"\");\n+    }\n+\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testNavigation\/TestNavigation.java","additions":229,"deletions":114,"binary":false,"changes":343,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -81,1 +81,1 @@\n-        checkOutput(\"deprecated-list.html\", true,\n+        checkOutput(\"deprecated-list.html\", false,\n@@ -83,1 +83,1 @@\n-        checkOutput(\"index-all.html\", true,\n+        checkOutput(\"index-all.html\", false,\n@@ -85,1 +85,1 @@\n-        checkOutput(\"help-doc.html\", true,\n+        checkOutput(\"help-doc.html\", false,\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testPackagePage\/TestPackagePage.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,1 @@\n- * @bug 8189841 8253117 8263507\n+ * @bug 8189841 8253117 8263507 8320458\n@@ -54,9 +54,5 @@\n-                    <div class=\"sub-nav\">\n-                    <div id=\"navbar-sub-list\">\n-                    <ul class=\"sub-nav-list\">\n-                    <li>Package:&nbsp;<\/li>\n-                    <li>Description&nbsp;|&nbsp;<\/li>\n-                    <li>Related Packages&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#class-summary\">Classes and Interfaces<\/a><\/li>\n-                    <\/ul>\n-                    <\/div>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#class-summary\" tabindex=\"0\">Classes and Interfaces<\/a><\/li>\n+                    <\/ol>\n+                    \"\"\");\n@@ -65,9 +61,6 @@\n-                    <div class=\"sub-nav\">\n-                    <div id=\"navbar-sub-list\">\n-                    <ul class=\"sub-nav-list\">\n-                    <li>Package:&nbsp;<\/li>\n-                    <li><a href=\"#package-description\">Description<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#related-package-summary\">Related Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#class-summary\">Classes and Interfaces<\/a><\/li>\n-                    <\/ul>\n-                    <\/div>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#related-package-summary\" tabindex=\"0\">Related Packages<\/a><\/li>\n+                    <li><a href=\"#class-summary\" tabindex=\"0\">Classes and Interfaces<\/a><\/li>\n+                    <\/ol>\n+                    \"\"\");\n@@ -76,9 +69,6 @@\n-                    <div class=\"sub-nav\">\n-                    <div id=\"navbar-sub-list\">\n-                    <ul class=\"sub-nav-list\">\n-                    <li>Package:&nbsp;<\/li>\n-                    <li>Description&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#related-package-summary\">Related Packages<\/a>&nbsp;|&nbsp;<\/li>\n-                    <li><a href=\"#class-summary\">Classes and Interfaces<\/a><\/li>\n-                    <\/ul>\n-                    <\/div>\"\"\");\n+                    <ol class=\"toc-list\">\n+                    <li><a href=\"#\" tabindex=\"0\">Description<\/a><\/li>\n+                    <li><a href=\"#related-package-summary\" tabindex=\"0\">Related Packages<\/a><\/li>\n+                    <li><a href=\"#class-summary\" tabindex=\"0\">Classes and Interfaces<\/a><\/li>\n+                    <\/ol>\n+                    \"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testPackageSummary\/TestPackageSummary.java","additions":19,"deletions":29,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -429,1 +429,1 @@\n-                    var pathtoroot = \".\/\";\n+                    const pathtoroot = \".\/\";\n@@ -433,4 +433,7 @@\n-                    <div class=\"nav-list-search\"><a href=\"search.html\">SEARCH<\/a>\n-                    <input type=\"text\" id=\"search-input\" disabled placeholder=\"Search\">\n-                    <input type=\"reset\" id=\"reset-button\" disabled value=\"reset\">\n-                    \"\"\");\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\"\"\",\n+                \"\"\"\n+                    <div class=\"nav-list-search\">\n+                    <input type=\"text\" id=\"search-input\" disabled placeholder=\"Search\" aria-label=\"S\\\n+                    earch in documentation\" autocomplete=\"off\" autocapitalize=\"off\">\n+                    <input type=\"reset\" id=\"reset-search\" disabled value=\"Reset\">\n+                    <\/div>\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSearch\/TestSearch.java","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,0 +44,1 @@\n+import java.util.Set;\n@@ -228,1 +229,1 @@\n-        private boolean inSeeList;\n+        private int inSeeOrTocList = 0;\n@@ -273,2 +274,3 @@\n-                    if (\"tag-list\".equals(attrs.get(\"class\"))) {\n-                        inSeeList = true;\n+                    String classAttr = attrs.get(\"class\");\n+                    if (classAttr != null && Set.of(\"tag-list\", \"toc-list\", \"sub-nav-list\").contains(classAttr)) {\n+                        inSeeOrTocList++;\n@@ -291,1 +293,1 @@\n-                    if (inSeeList) {\n+                    if (inSeeOrTocList > 0) {\n@@ -293,2 +295,2 @@\n-                        inSeeList = false;\n-                    } else if (c.get(\"li\") == 0) {\n+                        inSeeOrTocList--;\n+                    } else if (!c.containsKey(\"li\")) {\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSingletonLists\/TestSingletonLists.java","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -115,2 +115,8 @@\n-                    <div class=\"top-nav\" id=\"navbar-top\"><button id=\"navbar-toggle-button\" aria-controls=\"navbar-top\" aria-expanded=\"false\" aria-label=\"Toggle navigation links\"><span class=\"nav-bar-toggle-icon\">&nbsp;<\/span><span class=\"nav-bar-toggle-icon\">&nbsp;<\/span><span class=\"nav-bar-toggle-icon\">&nbsp;<\/span><\/button>\n-                    <div class=\"skip-nav\"><a href=\"#skip-navbar-top\" title=\"Skip navigation links\">Skip navigation links<\/a><\/div>\n+                    <div class=\"top-nav\" id=\"navbar-top\">\n+                    <div class=\"nav-content\">\n+                    <div class=\"nav-menu-button\"><button id=\"navbar-toggle-button\" aria-controls=\"na\\\n+                    vbar-top\" aria-expanded=\"false\" aria-label=\"Toggle navigation links\"><span class\\\n+                    =\"nav-bar-toggle-icon\">&nbsp;<\/span><span class=\"nav-bar-toggle-icon\">&nbsp;<\/sp\\\n+                    an><span class=\"nav-bar-toggle-icon\">&nbsp;<\/span><\/button><\/div>\n+                    <div class=\"skip-nav\"><a href=\"#skip-navbar-top\" title=\"Skip navigation links\">S\\\n+                    kip navigation links<\/a><\/div>\n@@ -119,1 +125,0 @@\n-                    <li>Class<\/li>\n@@ -122,0 +127,1 @@\n+                    <li><a href=\"search.html\">Search<\/a><\/li>\n@@ -125,0 +131,1 @@\n+                    <\/div>\n@@ -126,4 +133,7 @@\n-                    <div id=\"navbar-sub-list\"><\/div>\n-                    <div class=\"nav-list-search\"><a href=\"search.html\">SEARCH<\/a>\n-                    <input type=\"text\" id=\"search-input\" disabled placeholder=\"Search\">\n-                    <input type=\"reset\" id=\"reset-button\" disabled value=\"reset\">\n+                    <div class=\"nav-content\">\n+                    <ol class=\"sub-nav-list\"><\/ol>\n+                    <div class=\"nav-list-search\">\n+                    <input type=\"text\" id=\"search-input\" disabled placeholder=\"Search\" aria-label=\"S\\\n+                    earch in documentation\" autocomplete=\"off\" autocapitalize=\"off\">\n+                    <input type=\"reset\" id=\"reset-search\" disabled value=\"Reset\">\n+                    <\/div>\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSpecTag\/TestSpecTag.java","additions":18,"deletions":8,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -80,9 +80,0 @@\n-                \"\"\"\n-                    iframe {\n-                        margin:0;\n-                        padding:0;\n-                        height:100%;\n-                        width:100%;\n-                        overflow-y:scroll;\n-                        border:none;\n-                    }\"\"\",\n@@ -150,1 +141,1 @@\n-                    a[href]:hover, a[href]:focus {\n+                    a[href]:hover, a[href]:active {\n@@ -176,1 +167,1 @@\n-                    #reset-button {\n+                    input#reset-search, input.reset-filter {\n@@ -185,3 +176,0 @@\n-                        position:absolute;\n-                        right:12px;\n-                        top:10px;\n@@ -189,0 +177,1 @@\n+                        display:none;\n@@ -355,1 +344,0 @@\n-                \"help-section\",     \/\/ part of the help page\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testStylesheet\/TestStylesheet.java","additions":4,"deletions":16,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -1,68 +0,0 @@\n-\/*\n- * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @bug 7010342 8150000 8174974\n- * @summary Test for correct sub title generation.\n- * @library ..\/..\/lib\n- * @modules jdk.javadoc\/jdk.javadoc.internal.tool\n- * @build javadoc.tester.*\n- * @run main TestSubTitle\n- *\/\n-\n-import javadoc.tester.JavadocTester;\n-\n-public class TestSubTitle extends JavadocTester {\n-\n-    public static void main(String... args) throws Exception {\n-        var tester = new TestSubTitle();\n-        tester.runTests();\n-    }\n-\n-    @Test\n-    public void test() {\n-        javadoc(\"-d\", \"out\",\n-                \"-sourcepath\", testSrc,\n-                \"pkg\");\n-        checkExit(Exit.OK);\n-\n-        checkOutput(\"pkg\/package-summary.html\", true,\n-            \"\"\"\n-                <div class=\"block\">This is the description of package pkg.<\/div>\"\"\");\n-\n-        checkOutput(\"pkg\/C.html\", true,\n-                \"\"\"\n-                    <div class=\"sub-title\"><span class=\"package-label-in-type\">Package<\/span>&nbsp;<\\\n-                    a href=\"package-summary.html\">pkg<\/a><\/div>\"\"\");\n-\n-        checkOutput(\"pkg\/package-summary.html\", false,\n-            \"\"\"\n-                <p class=\"sub-title\">\n-                <div class=\"block\">This is the description of package pkg.<\/div>\n-                <\/p>\"\"\");\n-\n-        checkOutput(\"pkg\/C.html\", false,\n-            \"<p class=\\\"sub-title\\\">pkg<\/p>\");\n-    }\n-}\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSubTitle\/TestSubTitle.java","additions":0,"deletions":68,"binary":false,"changes":68,"status":"deleted"},{"patch":"@@ -1,30 +0,0 @@\n-\/*\n- * Copyright (c) 2011, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package pkg;\n-\n-\/**\n- * Source file for C\n- *\/\n-public class C {\n-}\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSubTitle\/pkg\/C.java","additions":0,"deletions":30,"binary":false,"changes":30,"status":"deleted"},{"patch":"@@ -1,8 +0,0 @@\n-<html lang=\"en\">\n-<head>\n-    <title>Package Summary<\/title>\n-<\/head>\n-<body>\n-This is the description of package pkg.\n-<\/body>\n-<\/html>\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSubTitle\/pkg\/package.html","additions":0,"deletions":8,"binary":false,"changes":8,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testValueTag\/TestValueTagInModule.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -332,0 +332,1 @@\n+            addID(0, \"\"); \/\/ Register empty anchor as top of page\n","filename":"test\/langtools\/jdk\/javadoc\/lib\/javadoc\/tester\/LinkChecker.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -208,9 +208,11 @@\n-            \/\/ special handling for strings in search.js.template\n-            FileObject fo = fm.getFileForInput(javadocLoc,\n-                    \"jdk.javadoc.internal.doclets.formats.html\",\n-                    \"resources\/search.js.template\");\n-            CharSequence search_js = fo.getCharContent(true);\n-            Pattern p = Pattern.compile(\"##REPLACE:(?<key>[A-Za-z0-9._]+)##\");\n-            Matcher m = p.matcher(search_js);\n-            while (m.find()) {\n-                results.add(m.group(\"key\"));\n+            \/\/ special handling for strings in .js.template files\n+            for (String fileName : List.of(\"resources\/search.js.template\", \"resources\/script.js.template\")) {\n+                FileObject fo = fm.getFileForInput(javadocLoc,\n+                        \"jdk.javadoc.internal.doclets.formats.html\",\n+                        fileName);\n+                CharSequence search_js = fo.getCharContent(true);\n+                Pattern p = Pattern.compile(\"##REPLACE:(?<key>[A-Za-z0-9._]+)##\");\n+                Matcher m = p.matcher(search_js);\n+                while (m.find()) {\n+                    results.add(m.group(\"key\"));\n+                }\n","filename":"test\/langtools\/jdk\/javadoc\/tool\/CheckResourceKeys.java","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -0,0 +1,63 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @compile StringConcatWithAssignments.java\n+ * @run main StringConcatWithAssignments\n+ * @compile -XDstringConcat=inline StringConcatWithAssignments.java\n+ * @run main StringConcatWithAssignments\n+ * @compile -XDstringConcat=indy StringConcatWithAssignments.java\n+ * @run main StringConcatWithAssignments\n+ * @compile -XDstringConcat=indyWithConstants StringConcatWithAssignments.java\n+ * @run main StringConcatWithAssignments\n+ *\/\n+\n+import java.util.Objects;\n+import java.util.function.Supplier;\n+\n+public class StringConcatWithAssignments {\n+    public static void main(String[] args) {\n+        StringConcatWithAssignments instance = new StringConcatWithAssignments();\n+        assertEquals(\"nulltrue\", instance.assignment());\n+        assertEquals(\"nulltrue\", instance.invocation());\n+    }\n+    private String assignment() {\n+        boolean b;\n+        return ((((b = true) ? null : null) + \"\") + b);\n+    }\n+    private String invocation() {\n+        StringBuilder sideEffect = new StringBuilder();\n+        Supplier<Boolean> provider = () -> {\n+            sideEffect.append(true);\n+            return true;\n+        };\n+        return (((provider.get() ? null : null) + \"\") + sideEffect.toString());\n+    }\n+    private static void assertEquals(Object o1, Object o2) {\n+        if (!Objects.equals(o1, o2)) {\n+            throw new AssertionError(\"Expected that '\" + o1 + \"' and \" +\n+                                     \"'\" + o2 + \"' are equal.\");\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/StringConcat\/StringConcatWithAssignments.java","additions":63,"deletions":0,"binary":false,"changes":63,"status":"added"},{"patch":"@@ -78,1 +78,3 @@\n-                        System.out.println(Class.forName(\"p.q.Unit$First$Second\"));\n+                        System.out.println(Class.forName(\"p.q.Unit$Fir$t\"));\n+                        System.out.println(Class.forName(\"p.q.Unit$123$Fir$t$$econd\"));\n+                        System.out.println(Class.forName(\"$.$.$\"));\n@@ -93,2 +95,2 @@\n-                      record First() {\n-                        record Second() {}\n+                      record Fir$t() {\n+                        record $econd() {}\n@@ -98,0 +100,15 @@\n+        Files.writeString(pq.resolve(\"Unit$123.java\"),\n+                    \"\"\"\n+                    package p.q;\n+                    record Unit$123() {\n+                      record Fir$t() {\n+                        record $econd() {}\n+                      }\n+                    }\n+                    \"\"\");\n+        var $$ = Files.createDirectories(base.resolve(\"$\/$\"));\n+        Files.writeString($$.resolve(\"$.java\"),\n+                    \"\"\"\n+                    package $.$;\n+                    record $($ $) {}\n+                    \"\"\");\n@@ -104,1 +121,3 @@\n-                        class p.q.Unit$First$Second\n+                        class p.q.Unit$Fir$t\n+                        class p.q.Unit$123$Fir$t$$econd\n+                        class $.$.$\n","filename":"test\/langtools\/tools\/javac\/launcher\/MultiFileSourceLauncherTests.java","additions":23,"deletions":4,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -0,0 +1,110 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8323057\n+ * @summary javac should print not-recoverable errors before recoverable errors\n+ * @library \/tools\/lib\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ * @build toolbox.TestRunner toolbox.ToolBox TestErrorOrder\n+ * @run main TestErrorOrder\n+ *\/\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.Set;\n+\n+import javax.annotation.processing.AbstractProcessor;\n+import javax.annotation.processing.RoundEnvironment;\n+import javax.annotation.processing.SupportedAnnotationTypes;\n+import javax.lang.model.SourceVersion;\n+import javax.lang.model.element.TypeElement;\n+\n+import toolbox.JavacTask;\n+import toolbox.Task;\n+import toolbox.Task.Expect;\n+import toolbox.TestRunner;\n+import toolbox.TestRunner.Test;\n+import toolbox.ToolBox;\n+\n+public class TestErrorOrder extends TestRunner {\n+    public static void main(String... args) throws Exception {\n+        new TestErrorOrder().runTests(m -> new Object[] { Paths.get(m.getName()) });\n+    }\n+\n+    private final ToolBox tb = new ToolBox();\n+\n+    public TestErrorOrder() {\n+        super(System.err);\n+    }\n+\n+    @Test\n+    public void testErrorsAfter(Path outerBase) throws Exception {\n+        Path src = outerBase.resolve(\"src\");\n+        tb.writeJavaFiles(src,\n+                          \"package t;\\n\" +\n+                          \"public class T {\\n\" +\n+                          \"    public void test(Undefined u) { }\\n\" +\n+                          \"    \\n\" +\n+                          \"    @SuppressWarnings(\\\"\\\")\\n\" +\n+                          \"    @SuppressWarnings(\\\"\\\")\\n\" +\n+                          \"    public void test() { }\\n\" +\n+                          \"}\");\n+        Path classes = outerBase.resolve(\"classes\");\n+        Files.createDirectories(classes);\n+        List<String> actual = new JavacTask(tb)\n+                .outdir(classes.toString())\n+                .options(\"-XDrawDiagnostics\",\n+                         \"-processor\", \"TestErrorOrder$P\",\n+                         \"-processorpath\", System.getProperty(\"test.classes\"))\n+                .files(tb.findJavaFiles(src))\n+                .run(Expect.FAIL)\n+                .writeAll()\n+                .getOutputLines(Task.OutputKind.DIRECT);\n+        List<String> expected = List.of(\n+                \"T.java:6:5: compiler.err.duplicate.annotation.missing.container: java.lang.SuppressWarnings\",\n+                \"T.java:3:22: compiler.err.cant.resolve.location: kindname.class, Undefined, , , (compiler.misc.location: kindname.class, t.T, null)\",\n+                \"2 errors\"\n+        );\n+\n+        tb.checkEqual(expected, actual);\n+    }\n+\n+    @SupportedAnnotationTypes(\"*\")\n+    public static class P extends AbstractProcessor {\n+        @Override\n+        public boolean process(Set<? extends TypeElement> annotations, RoundEnvironment roundEnv) {\n+            return false;\n+        }\n+\n+        @Override\n+        public SourceVersion getSupportedSourceVersion() {\n+            return SourceVersion.latest();\n+        }\n+    }\n+\n+}\n","filename":"test\/langtools\/tools\/javac\/processing\/errors\/TestErrorOrder.java","additions":110,"deletions":0,"binary":false,"changes":110,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8013852 8031744 8225377\n+ * @bug 8013852 8031744 8225377 8323684\n@@ -45,0 +45,1 @@\n+import java.lang.reflect.Method;\n@@ -47,0 +48,1 @@\n+import java.util.AbstractMap;\n@@ -49,0 +51,1 @@\n+import java.util.Objects;\n@@ -89,0 +92,17 @@\n+    \/\/ Use a compile-time mapping to avoid repeated runtime reflective lookups.\n+    private static final Map<String, Class<? extends Annotation>> nameToAnnotation =\n+        Map.ofEntries(new NameToAnnotationEntry(\"java.lang.Override\", Override.class),\n+                      new NameToAnnotationEntry(\"java.lang.annotation.Repeatable\", Repeatable.class),\n+                      new NameToAnnotationEntry(\"java.lang.annotation.Target\", Target.class),\n+                      new NameToAnnotationEntry(\"BasicAnnoTests.Test\", BasicAnnoTests.Test.class),\n+                      new NameToAnnotationEntry(\"BasicAnnoTests.Tests\",BasicAnnoTests.Tests.class),\n+                      new NameToAnnotationEntry(\"BasicAnnoTests.TA\",   BasicAnnoTests.TA.class),\n+                      new NameToAnnotationEntry(\"BasicAnnoTests.TB\",   BasicAnnoTests.TB.class),\n+                      new NameToAnnotationEntry(\"BasicAnnoTests.TC\",   BasicAnnoTests.TC.class),\n+                      new NameToAnnotationEntry(\"BasicAnnoTests.TCs\",  BasicAnnoTests.TCs.class));\n+\n+    static class NameToAnnotationEntry extends  AbstractMap.SimpleEntry<String, Class<? extends Annotation>> {\n+        public NameToAnnotationEntry(String key, Class<? extends Annotation> entry) {\n+            super(key, entry);\n+        }\n+    }\n@@ -107,1 +127,1 @@\n-        messager.printMessage(Kind.ERROR, msg, e);\n+        messager.printError(msg, e);\n@@ -266,0 +286,1 @@\n+            checkAnnotatedConstructConsistency(e, m);\n@@ -279,0 +300,1 @@\n+            checkAnnotatedConstructConsistency(e, m);\n@@ -293,0 +315,79 @@\n+    \/**\n+     * Verify that an annotation mirror returned by\n+     * getAnnotationMirrors() has a matching annotation from\n+     * getAnnotation and appropriate values are returned by\n+     * getAnnotationsByType.\n+     *\/\n+    static void checkAnnotatedConstructConsistency(AnnotatedConstruct ac, AnnotationMirror m) {\n+        \/\/ For each annotation mirror present, an annotation of the\n+        \/\/ same annotation type should be directly present as well.\n+        String annotationTypeName = ((TypeElement)m.getAnnotationType().asElement()).getQualifiedName().toString();\n+        var annotationClass = Objects.requireNonNull(nameToAnnotation.get(annotationTypeName));\n+        Annotation a = ac.getAnnotation(annotationClass);\n+        Objects.requireNonNull(a, \"Annotation \" + m + \" not found from getAnnotation(\" + annotationTypeName + \")\");\n+\n+        \/\/ For non-repeating annotation types, getAnnotationsByType should\n+        \/\/ wrap a single annotation in an one-element array.\n+        Annotation[] aArray = ac.getAnnotationsByType(annotationClass);\n+        if (aArray.length != 1) {\n+            throw new RuntimeException(\"Annotation \" + m +\n+                                       \" not found from getAnnotationsByType(\" + annotationTypeName + \")\");\n+        }\n+\n+        \/\/ For a container annotation, getAnnotationsByType should\n+        \/\/ \"look through\" and return the contained annotations by\n+        \/\/ their annotation class.\n+        var containedAnnotationClass = containerFor(annotationClass);\n+        if (containedAnnotationClass != null) {\n+            Object wrappedAnnotationValue = extractAnnotationValue(a);\n+            int wrappedCount = -1;\n+            if (wrappedAnnotationValue instanceof Annotation[] wrapped) {\n+                wrappedCount = wrapped.length;\n+            }\n+\n+            Annotation[] containedAnnotations = ac.getAnnotationsByType(containedAnnotationClass);\n+            \/\/ Check number of contained annotations for consistency\n+            \/\/ Given annotation type A and container annotation type As, the result of\n+            \/\/ annotatedConstruct.getAnnotaton(As.class).value().length ==\n+            \/\/ annotatedConstruct.getAnnotationsByType(A.class).length\n+            \/\/ More thorough checking could be done as well, checking\n+            \/\/ the types or value of the constituent annotations\/AnnotationMirrors.\n+            Object annotationValue = extractAnnotationValue(a);\n+            if (annotationValue instanceof Annotation[] objects\n+                && objects.length != wrappedCount) {\n+                throw new RuntimeException(\"\\t\\t\\tmismatched array length : \" + objects.length +\n+                                           \"\\twrapped count\" + wrappedCount);\n+            }\n+        }\n+    }\n+\n+    static Object extractAnnotationValue(Annotation annotation) {\n+        var annotationClass = annotation.annotationType();\n+        try {\n+            \/\/ Call value method of the annotation; expected to return\n+            \/\/ an array of the contained annotation type.\n+            Method valueMethod = annotationClass.getMethod(\"value\", null);\n+            return valueMethod.invoke(annotation);\n+        } catch (ReflectiveOperationException roe) {\n+            throw new RuntimeException(roe);\n+        }\n+    }\n+\n+    static int wrappedAnnotationCount(Annotation a) {\n+        Object value = extractAnnotationValue(a);\n+        if (value instanceof Annotation[] annotationValueArray) {\n+            return annotationValueArray.length;\n+        } else {\n+            return -1;\n+        }\n+    }\n+\n+    static Class<? extends Annotation> containerFor(Class<? extends Annotation> possibleContainer) {\n+        \/\/ Could write this more generally; for now, hard-code particular cases\n+        if (possibleContainer == TCs.class)\n+            return TC.class;\n+        if (possibleContainer == Tests.class)\n+            return Tests.class;\n+        return null;\n+    }\n+\n@@ -405,0 +506,1 @@\n+\n@@ -410,0 +512,11 @@\n+    @Target(ElementType.TYPE_USE)\n+    @Repeatable(TCs.class)\n+    public @interface TC {\n+        int value();\n+    }\n+\n+    @Target(ElementType.TYPE_USE)\n+    @interface TCs {\n+        TC[] value();\n+    }\n+\n@@ -476,0 +589,15 @@\n+    @Test(posn=0, annoType=TC.class, expect=\"1\")\n+    public @TC(1) int f1_repeat0;\n+\n+    \/\/ Containter annotation @TCs({@TC(2), @TC(3)}) created by the compiler\n+    @Test(posn=0, annoType=TCs.class, expect=\"{@BasicAnnoTests.TC(2), @BasicAnnoTests.TC(3)}\")\n+    public @TC(2) @TC(3) int f1_repeat1;\n+\n+    \/\/ Use container explicitly\n+    @Test(posn=0, annoType=TCs.class, expect=\"{@BasicAnnoTests.TC(4)}\")\n+    public @TCs(@TC(4)) int f1_repeat2;\n+\n+    \/\/ Explicit empty container\n+    @Test(posn=0, annoType=TCs.class, expect=\"{}\")\n+    public @TCs({}) int f1_repeat3;\n+\n","filename":"test\/langtools\/tools\/javac\/processing\/model\/type\/BasicAnnoTests.java","additions":131,"deletions":3,"binary":false,"changes":134,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,12 @@\n-tier1 = .\n+# All tests\n+\n+all = \\\n+    :libtest_all\n+\n+libtest_all = \\\n+    \/\n+\n+# Tiered testing definitions\n+\n+tier1 = \\\n+    :all\n","filename":"test\/lib-test\/TEST.groups","additions":13,"deletions":2,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -212,0 +212,1 @@\n+    public static final String SerializationMisdeclaration = PREFIX + \"SerializationMisdeclaration\";\n","filename":"test\/lib\/jdk\/test\/lib\/jfr\/EventNames.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import org.openjdk.jmh.annotations.Param;\n@@ -51,0 +52,1 @@\n+    private Map<Integer, Integer> staticMap;\n@@ -58,0 +60,3 @@\n+    @Param(\"10000\")\n+    private int nkeys;\n+\n@@ -60,1 +65,0 @@\n-        int nkeys = 10000;\n@@ -68,0 +72,1 @@\n+        staticMap = new ConcurrentHashMap<>();\n@@ -72,0 +77,1 @@\n+            staticMap.put(rng.next(), rng.next());\n@@ -109,0 +115,15 @@\n+    @Benchmark\n+    public ConcurrentHashMap<Integer, Integer> testConcurrentHashMapCopyConstructor() {\n+        return new ConcurrentHashMap<>(staticMap);\n+    }\n+\n+    @Benchmark\n+    public ConcurrentHashMap<Integer, Integer> testConcurrentHashMapPutAll() {\n+        ConcurrentHashMap<Integer, Integer> map = new ConcurrentHashMap<>(nkeys);\n+        for (int i = 0; i < nkeys; ++i) {\n+            map.put(rng.next(), rng.next());\n+        }\n+        map.putAll(staticMap);\n+        return map;\n+    }\n+\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/util\/concurrent\/Maps.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -0,0 +1,185 @@\n+\/*\n+ *  Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ *  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ *  This code is free software; you can redistribute it and\/or modify it\n+ *  under the terms of the GNU General Public License version 2 only, as\n+ *  published by the Free Software Foundation.\n+ *\n+ *  This code is distributed in the hope that it will be useful, but WITHOUT\n+ *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ *  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ *  version 2 for more details (a copy is included in the LICENSE file that\n+ *  accompanied this code).\n+ *\n+ *  You should have received a copy of the GNU General Public License version\n+ *  2 along with this work; if not, write to the Free Software Foundation,\n+ *  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ *  Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ *  or visit www.oracle.com if you need additional information or have any\n+ *  questions.\n+ *\n+ *\/\n+\n+package org.openjdk.bench.jdk.incubator.vector;\n+\n+import java.util.concurrent.TimeUnit;\n+import java.util.Random;\n+import jdk.incubator.vector.*;\n+import org.openjdk.jmh.annotations.*;\n+import org.openjdk.jmh.infra.Blackhole;\n+\n+@OutputTimeUnit(TimeUnit.MILLISECONDS)\n+@State(Scope.Thread)\n+@Fork(jvmArgsPrepend = {\"--add-modules=jdk.incubator.vector\", \"-XX:UseAVX=2\"})\n+public class ColumnFilterBenchmark {\n+    @Param({\"1024\", \"2047\", \"4096\"})\n+    int size;\n+\n+    float [] floatinCol;\n+    float [] floatoutCol;\n+    float fpivot;\n+\n+    double [] doubleinCol;\n+    double [] doubleoutCol;\n+    double dpivot;\n+\n+    int [] intinCol;\n+    int [] intoutCol;\n+    int ipivot;\n+\n+    long [] longinCol;\n+    long [] longoutCol;\n+    long lpivot;\n+\n+    static final VectorSpecies<Float> fspecies = FloatVector.SPECIES_256;\n+    static final VectorSpecies<Double> dspecies = DoubleVector.SPECIES_256;\n+    static final VectorSpecies<Integer> ispecies = IntVector.SPECIES_256;\n+    static final VectorSpecies<Long> lspecies = LongVector.SPECIES_256;\n+\n+    @Setup(Level.Trial)\n+    public void BmSetup() {\n+        Random r = new Random(2048);\n+\n+        floatinCol = new float[size];\n+        floatoutCol = new float[size];\n+        fpivot = (float) (size \/ 2);\n+        doubleinCol = new double[size];\n+        doubleoutCol = new double[size];\n+        dpivot = (double) (size \/ 2);\n+        intinCol = new int[size];\n+        intoutCol = new int[size];\n+        ipivot = size \/ 2;\n+        longinCol = new long[size];\n+        longoutCol = new long[size];\n+        lpivot = size \/ 2;\n+\n+        for (int i = 4; i < size; i++) {\n+            floatinCol[i] = r.nextFloat() * size;\n+            doubleinCol[i] = r.nextDouble() * size;\n+            intinCol[i] = r.nextInt(size);\n+            longinCol[i] = (long)intinCol[i];\n+        }\n+    }\n+\n+    @Benchmark\n+    public void fuzzyFilterIntColumn() {\n+       int i = 0;\n+       int j = 0;\n+       long maskctr = 1;\n+       int endIndex = ispecies.loopBound(size);\n+       for (; i < endIndex; i += ispecies.length()) {\n+           IntVector vec = IntVector.fromArray(ispecies, intinCol, i);\n+           VectorMask<Integer> pred = VectorMask.fromLong(ispecies, maskctr++);\n+           vec.compress(pred).intoArray(intoutCol, j);\n+           j += pred.trueCount();\n+       }\n+   }\n+\n+   @Benchmark\n+   public void fuzzyFilterLongColumn() {\n+       int i = 0;\n+       int j = 0;\n+       long maskctr = 1;\n+       int endIndex = lspecies.loopBound(size);\n+       for (; i < endIndex; i += lspecies.length()) {\n+           LongVector vec = LongVector.fromArray(lspecies, longinCol, i);\n+           VectorMask<Long> pred = VectorMask.fromLong(lspecies, maskctr++);\n+           vec.compress(pred).intoArray(longoutCol, j);\n+           j += pred.trueCount();\n+       }\n+   }\n+\n+    @Benchmark\n+    public void filterIntColumn() {\n+       int i = 0;\n+       int j = 0;\n+       int endIndex = ispecies.loopBound(size);\n+       for (; i < endIndex; i += ispecies.length()) {\n+           IntVector vec = IntVector.fromArray(ispecies, intinCol, i);\n+           VectorMask<Integer> pred = vec.compare(VectorOperators.GT, ipivot);\n+           vec.compress(pred).intoArray(intoutCol, j);\n+           j += pred.trueCount();\n+       }\n+       for (; i < endIndex; i++) {\n+           if (intinCol[i] > ipivot) {\n+               intoutCol[j++] = intinCol[i];\n+           }\n+       }\n+   }\n+\n+   @Benchmark\n+   public void filterLongColumn() {\n+       int i = 0;\n+       int j = 0;\n+       int endIndex = lspecies.loopBound(size);\n+       for (; i < endIndex; i += lspecies.length()) {\n+           LongVector vec = LongVector.fromArray(lspecies, longinCol, i);\n+           VectorMask<Long> pred = vec.compare(VectorOperators.GT, lpivot);\n+           vec.compress(pred).intoArray(longoutCol, j);\n+           j += pred.trueCount();\n+       }\n+       for (; i < endIndex; i++) {\n+           if (longinCol[i] > lpivot) {\n+               longoutCol[j++] = longinCol[i];\n+           }\n+       }\n+   }\n+\n+   @Benchmark\n+   public void filterFloatColumn() {\n+       int i = 0;\n+       int j = 0;\n+       int endIndex = fspecies.loopBound(size);\n+       for (; i < endIndex; i += fspecies.length()) {\n+           FloatVector vec = FloatVector.fromArray(fspecies, floatinCol, i);\n+           VectorMask<Float> pred = vec.compare(VectorOperators.GT, fpivot);\n+           vec.compress(pred).intoArray(floatoutCol, j);\n+           j += pred.trueCount();\n+       }\n+       for (; i < endIndex; i++) {\n+           if (floatinCol[i] > fpivot) {\n+               floatoutCol[j++] = floatinCol[i];\n+           }\n+       }\n+   }\n+\n+   @Benchmark\n+   public void filterDoubleColumn() {\n+       int i = 0;\n+       int j = 0;\n+       int endIndex = dspecies.loopBound(size);\n+       for (; i < endIndex; i += dspecies.length()) {\n+           DoubleVector vec = DoubleVector.fromArray(dspecies, doubleinCol, i);\n+           VectorMask<Double> pred = vec.compare(VectorOperators.GT, dpivot);\n+           vec.compress(pred).intoArray(doubleoutCol, j);\n+           j += pred.trueCount();\n+       }\n+       for (; i < endIndex; i++) {\n+           if (doubleinCol[i] > dpivot) {\n+               doubleoutCol[j++] = doubleinCol[i];\n+           }\n+       }\n+   }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/jdk\/incubator\/vector\/ColumnFilterBenchmark.java","additions":185,"deletions":0,"binary":false,"changes":185,"status":"added"}]}