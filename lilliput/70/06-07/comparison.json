{"files":[{"patch":"@@ -223,2 +223,7 @@\n-    narrowKlass nk = ArchiveBuilder::current()->get_requested_narrow_klass(k);\n-    oopDesc::release_set_mark(mem, markWord::prototype().set_narrow_klass(nk));\n+    if (UseCompactObjectHeaders) {\n+      narrowKlass nk = ArchiveBuilder::current()->get_requested_narrow_klass(k);\n+      oopDesc::release_set_mark(mem, markWord::prototype().set_narrow_klass(nk));\n+    } else {\n+      oopDesc::set_mark(mem, markWord::prototype());\n+      oopDesc::release_set_klass(mem, k);\n+    }\n@@ -304,1 +309,6 @@\n-  oopDesc::set_mark(mem, markWord::prototype().set_narrow_klass(nk));\n+  if (UseCompactObjectHeaders) {\n+    oopDesc::release_set_mark(mem, markWord::prototype().set_narrow_klass(nk));\n+  } else {\n+    oopDesc::set_mark(mem, markWord::prototype());\n+    cast_to_oop(mem)->set_narrow_klass(nk);\n+  }\n@@ -486,0 +496,1 @@\n+  fake_oop->set_narrow_klass(nk);\n@@ -493,1 +504,5 @@\n-    fake_oop->set_mark(markWord::prototype().set_narrow_klass(nk).copy_set_hash(src_hash));\n+    if (UseCompactObjectHeaders) {\n+      fake_oop->set_mark(markWord::prototype().set_narrow_klass(nk).copy_set_hash(src_hash));\n+    } else {\n+      fake_oop->set_mark(markWord::prototype().copy_set_hash(src_hash));\n+    }\n","filename":"src\/hotspot\/share\/cds\/archiveHeapWriter.cpp","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"}]}