{"files":[{"patch":"@@ -844,1 +844,1 @@\n-    if (menuBar == nil) {\n+    if (menuBar == nil && [ApplicationDelegate sharedDelegate] != nil) {\n@@ -1233,1 +1233,1 @@\n-        if (actualMenuBar == nil) {\n+        if (actualMenuBar == nil && [ApplicationDelegate sharedDelegate] != nil) {\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/AWTWindow.m","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -119,0 +119,1 @@\n+    BOOL overrideDelegate = (getenv(\"AWT_OVERRIDE_NSDELEGATE\") != NULL);\n@@ -120,1 +121,1 @@\n-        if ([NSApp isMemberOfClass:[NSApplication class]]) shouldInstall = YES;\n+        if ([NSApp isMemberOfClass:[NSApplication class]] && overrideDelegate) shouldInstall = YES;\n@@ -412,0 +413,13 @@\n+- (BOOL)applicationSupportsSecureRestorableState:(NSApplication *)app {\n+    static BOOL checked = NO;\n+    static BOOL supportsSecureState = YES;\n+\n+    if (checked == NO) {\n+        checked = YES;\n+        if (getenv(\"AWT_DISABLE_NSDELEGATE_SECURE_SAVE\") != NULL) {\n+            supportsSecureState = NO;\n+        }\n+    }\n+    return supportsSecureState;\n+}\n+\n@@ -509,2 +523,4 @@\n-    [[ApplicationDelegate sharedDelegate].fProgressIndicator removeFromSuperview];\n-    [dockImageView addSubview:[ApplicationDelegate sharedDelegate].fProgressIndicator];\n+    if ([ApplicationDelegate sharedDelegate] != nil) {\n+        [[ApplicationDelegate sharedDelegate].fProgressIndicator removeFromSuperview];\n+        [dockImageView addSubview:[ApplicationDelegate sharedDelegate].fProgressIndicator];\n+    }\n@@ -523,5 +539,8 @@\n-    if ([value doubleValue] >= 0 && [value doubleValue] <=100) {\n-        [delegate.fProgressIndicator setDoubleValue:[value doubleValue]];\n-        [delegate.fProgressIndicator setHidden:NO];\n-    } else {\n-        [delegate.fProgressIndicator setHidden:YES];\n+    if (delegate != nil) {\n+        if ([value doubleValue] >= 0 && [value doubleValue] <=100) {\n+            [delegate.fProgressIndicator setDoubleValue:[value doubleValue]];\n+            [delegate.fProgressIndicator setHidden:NO];\n+        } else {\n+            [delegate.fProgressIndicator setHidden:YES];\n+        }\n+        [[NSApp dockTile] display];\n@@ -529,2 +548,0 @@\n-\n-    [[NSApp dockTile] display];\n@@ -641,1 +658,3 @@\n-        [ApplicationDelegate sharedDelegate].fDockMenu = menu;\n+        if ([ApplicationDelegate sharedDelegate] != nil) {\n+            [ApplicationDelegate sharedDelegate].fDockMenu = menu;\n+        }\n@@ -821,7 +840,9 @@\n-        switch (menuID) {\n-            case com_apple_eawt__AppMenuBarHandler_MENU_ABOUT:\n-                [delegate _updateAboutMenu:visible enabled:enabled];\n-                break;\n-            case com_apple_eawt__AppMenuBarHandler_MENU_PREFS:\n-                [delegate _updatePreferencesMenu:visible enabled:enabled];\n-                break;\n+        if (delegate != nil) {\n+            switch (menuID) {\n+                case com_apple_eawt__AppMenuBarHandler_MENU_ABOUT:\n+                    [delegate _updateAboutMenu:visible enabled:enabled];\n+                    break;\n+                case com_apple_eawt__AppMenuBarHandler_MENU_PREFS:\n+                    [delegate _updatePreferencesMenu:visible enabled:enabled];\n+                    break;\n+            }\n@@ -846,1 +867,3 @@\n-        [ApplicationDelegate sharedDelegate].fDefaultMenuBar = menu;\n+        if ([ApplicationDelegate sharedDelegate] != nil) {\n+            [ApplicationDelegate sharedDelegate].fDefaultMenuBar = menu;\n+        }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/ApplicationDelegate.m","additions":42,"deletions":19,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -213,3 +213,5 @@\n-        CMenuBar* defaultMenu = [[ApplicationDelegate sharedDelegate] defaultMenuBar];\n-        if (defaultMenu != nil) {\n-            [CMenuBar activate:defaultMenu modallyDisabled:NO];\n+        if ([ApplicationDelegate sharedDelegate] != nil) {\n+            CMenuBar* defaultMenu = [[ApplicationDelegate sharedDelegate] defaultMenuBar];\n+            if (defaultMenu != nil) {\n+                [CMenuBar activate:defaultMenu modallyDisabled:NO];\n+            }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CMenuBar.m","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -203,0 +203,15 @@\n+\n+- (BOOL)applicationSupportsSecureRestorableState:(NSApplication *)app\n+{\n+    static BOOL checked = NO;\n+    static BOOL supportsSecureState = YES;\n+\n+    if (checked == NO) {\n+        checked = YES;\n+        if (getenv(\"AWT_DISABLE_NSDELEGATE_SECURE_SAVE\") != NULL) {\n+            supportsSecureState = NO;\n+        }\n+    }\n+    return supportsSecureState;\n+}\n+\n","filename":"src\/java.desktop\/macosx\/native\/libosxapp\/QueuingApplicationDelegate.m","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"}]}