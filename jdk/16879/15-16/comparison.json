{"files":[{"patch":"@@ -39,1 +39,0 @@\n-    private static final int LENGTH = 128;\n@@ -63,1 +62,2 @@\n-        byte[] buf = new byte[LENGTH];\n+        final int length = 128;\n+        byte[] buf = new byte[length];\n@@ -70,3 +70,8 @@\n-        byteArrayOutputStream(bis, buf);\n-        fileOutputStream(bis, buf);\n-        pipedOutputStream(bis, buf);\n+        var tempFile = File.createTempFile(TransferToTrusted.class.getName(), null);\n+        try {\n+            var outputStreams = new OutputStream[]{\n+                    new ByteArrayOutputStream(),\n+                    new FileOutputStream(tempFile),\n+                    new PipedOutputStream(new PipedInputStream(length)),\n+                    new UntrustedOutputStream()\n+            };\n@@ -74,26 +79,2 @@\n-        bis.reset();\n-        var out = new UntrustedOutputStream();\n-        bis.transferTo(out);\n-        bis.reset();\n-        if (!Arrays.equals(buf, bis.readAllBytes())) {\n-            throw new RuntimeException(\"Internal buffer has been modified\");\n-        }\n-    }\n-\n-    private static void byteArrayOutputStream(BufferedInputStream bis, byte[] buf) throws IOException {\n-        var baos = new ByteArrayOutputStream();\n-        bis.transferTo(baos);\n-        bis.reset();\n-        if (!Arrays.equals(buf, bis.readAllBytes())) {\n-            throw new RuntimeException(\"Internal buffer has been modified\");\n-        }\n-    }\n-\n-    private static void fileOutputStream(BufferedInputStream bis, byte[] buf) throws IOException {\n-        var fos = new FileOutputStream(File.createTempFile(TransferToTrusted.class.getName(), null));\n-        bis.transferTo(fos);\n-        bis.reset();\n-        if (!Arrays.equals(buf, bis.readAllBytes())) {\n-            throw new RuntimeException(\"Internal buffer has been modified\");\n-        }\n-    }\n+            for (var out : outputStreams) {\n+                System.err.println(\"out: \" + out.getClass().getName());\n@@ -101,6 +82,11 @@\n-    private static void pipedOutputStream(BufferedInputStream bis, byte[] buf) throws IOException {\n-        var pos = new PipedOutputStream(new PipedInputStream(LENGTH));\n-        bis.transferTo(pos);\n-        bis.reset();\n-        if (!Arrays.equals(buf, bis.readAllBytes())) {\n-            throw new RuntimeException(\"Internal buffer has been modified\");\n+                bis.transferTo(out);\n+                bis.reset();\n+                try (out) {\n+                    if (!Arrays.equals(buf, bis.readAllBytes())) {\n+                        throw new RuntimeException(\"Internal buffer was modified\");\n+                    }\n+                }\n+                bis.reset();\n+            }\n+        } finally {\n+            tempFile.delete();\n","filename":"test\/jdk\/java\/io\/BufferedInputStream\/TransferToTrusted.java","additions":23,"deletions":37,"binary":false,"changes":60,"status":"modified"}]}