{"files":[{"patch":"@@ -28,0 +28,2 @@\n+import java.util.zip.CRC32;\n+import java.util.zip.CheckedOutputStream;\n@@ -39,0 +41,1 @@\n+    private static final int LENGTH = 128;\n@@ -41,1 +44,1 @@\n-    private static class UntrustedOutputStream extends OutputStream {\n+    private static final class UntrustedOutputStream extends OutputStream {\n@@ -62,1 +65,1 @@\n-        byte[] buf = new byte[128];\n+        byte[] buf = new byte[LENGTH];\n@@ -69,0 +72,14 @@\n+        byteArrayOutputStream(bis, buf);\n+        fileOutputStream(bis, buf);\n+        pipedOutputStream(bis, buf);\n+\n+        bis.reset();\n+        var out = new UntrustedOutputStream();\n+        bis.transferTo(out);\n+        bis.reset();\n+        if (!Arrays.equals(buf, bis.readAllBytes())) {\n+            throw new RuntimeException(\"Internal buffer has been modified\");\n+        }\n+    }\n+\n+    private static void byteArrayOutputStream(BufferedInputStream bis, byte[] buf) throws IOException {\n@@ -75,0 +92,1 @@\n+    }\n@@ -76,0 +94,3 @@\n+    private static void fileOutputStream(BufferedInputStream bis, byte[] buf) throws IOException {\n+        var fos = new FileOutputStream(File.createTempFile(TransferToTrusted.class.getName(), null));\n+        bis.transferTo(fos);\n@@ -77,2 +98,17 @@\n-        var out = new UntrustedOutputStream();\n-        bis.transferTo(out);\n+        if (!Arrays.equals(buf, bis.readAllBytes())) {\n+            throw new RuntimeException(\"Internal buffer has been modified\");\n+        }\n+    }\n+\n+    private static void pipedOutputStream(BufferedInputStream bis, byte[] buf) throws IOException {\n+        var pos = new PipedOutputStream(new PipedInputStream(LENGTH));\n+        bis.transferTo(pos);\n+        bis.reset();\n+        if (!Arrays.equals(buf, bis.readAllBytes())) {\n+            throw new RuntimeException(\"Internal buffer has been modified\");\n+        }\n+    }\n+\n+    private static void checkedOutputStream(BufferedInputStream bis, byte[] buf) throws IOException {\n+        var cos = new CheckedOutputStream(new ByteArrayOutputStream(LENGTH), new CRC32());\n+        bis.transferTo(cos);\n","filename":"test\/jdk\/java\/io\/BufferedInputStream\/TransferToTrusted.java","additions":40,"deletions":4,"binary":false,"changes":44,"status":"modified"}]}