{"files":[{"patch":"@@ -53,1 +53,2 @@\n-    private static boolean dateTimeFormatInitialized;\n+    private static final String TIMESTAMP_OPTION = \"+timestamp\";\n+    private static final String THREAD_OPTION = \"+thread\";\n@@ -80,2 +81,2 @@\n-                threadInfoAll = args.substring(beginIndex, commaIndex).contains(\"+thread\");\n-                timeStampInfoAll = args.substring(beginIndex, commaIndex).contains(\"+timestamp\");\n+                threadInfoAll = args.substring(beginIndex, commaIndex).contains(THREAD_OPTION);\n+                timeStampInfoAll = args.substring(beginIndex, commaIndex).contains(TIMESTAMP_OPTION);\n@@ -86,2 +87,1 @@\n-    public static void Help()\n-    {\n+    public static void Help() {\n@@ -165,2 +165,1 @@\n-    public static Debug getInstance(String option)\n-    {\n+    public static Debug getInstance(String option) {\n@@ -174,2 +173,1 @@\n-    public static Debug getInstance(String option, String prefix)\n-    {\n+    public static Debug getInstance(String option, String prefix) {\n@@ -178,1 +176,2 @@\n-            d.configureOptions(option, prefix, false);\n+            d.prefix = prefix;\n+            d.configureExtras(option);\n@@ -185,12 +184,0 @@\n-    private void configureOptions(String option, String prefix, boolean ofInstance){\n-        this.prefix = prefix;\n-        printThreadDetails = getConfigInfo(option, \"+thread\", ofInstance);\n-        printDateTime = getConfigInfo(option, \"+timestamp\", ofInstance);\n-        if (printDateTime && !dateTimeFormatInitialized) {\n-            \/\/ trigger loading of Locale service impl now to avoid\n-            \/\/ possible bootstrap recursive class load issue\n-            FormatHolder.DATE_TIME_FORMATTER.format(Instant.now());\n-            dateTimeFormatInitialized = true;\n-        }\n-    }\n-\n@@ -205,8 +192,3 @@\n-    \/\/ parse an option string to determine if extra details\n-    \/\/ (like thread and timestamp) should be printed\n-    private static boolean getConfigInfo(String option,\n-                                         String extraInfoOption,\n-                                         boolean ofInstance) {\n-        \/\/ args is converted to lower case for the most part via marshal method\n-        int beginIndex;\n-        String subOpt;\n+    \/\/ parse an option string to determine if extra details,\n+    \/\/ like thread and timestamp, should be printed\n+    private void configureExtras(String option) {\n@@ -214,8 +196,2 @@\n-        if (!ofInstance) {\n-            if (timeStampInfoAll && extraInfoOption.equals(\"+timestamp\")) {\n-                return true;\n-            }\n-            if (threadInfoAll && extraInfoOption.equals(\"+thread\")) {\n-                return true;\n-            }\n-        }\n+        this.printDateTime = timeStampInfoAll;\n+        this.printThreadDetails = threadInfoAll;\n@@ -223,4 +199,3 @@\n-        \/\/ for Debug instances derived from the 'of' method, simply check\n-        \/\/ the option string for occurrence of the extra option\n-        if (ofInstance) {\n-            return option.contains(extraInfoOption);\n+        if (printDateTime && printThreadDetails) {\n+            \/\/ nothing left to configure\n+            return;\n@@ -229,1 +204,2 @@\n-        \/\/ for java.security.debug mode, use the args string.\n+        \/\/ args is converted to lower case for the most part via marshal method\n+        String subOpt = \"\";\n@@ -231,1 +207,1 @@\n-            beginIndex = args.lastIndexOf(option) + option.length();\n+            int beginIndex = args.lastIndexOf(option) + option.length();\n@@ -237,1 +213,0 @@\n-            return false;\n@@ -239,1 +214,2 @@\n-        return subOpt.contains(extraInfoOption);\n+        printDateTime = printDateTime || subOpt.contains(TIMESTAMP_OPTION);\n+        printThreadDetails = printThreadDetails || subOpt.contains(THREAD_OPTION);\n@@ -256,0 +232,6 @@\n+     *\n+     * +timestamp string can be appended to property value\n+     * to print timestamp information. (e.g. true+timestamp)\n+     * +thread string can be appended to property value\n+     * to print thread and caller information. (e.g. true+thread)\n+     *\n@@ -263,1 +245,3 @@\n-            d.configureOptions(property, prefix, true);\n+            d.prefix = prefix;\n+            d.printThreadDetails = property.contains(THREAD_OPTION);\n+            d.printDateTime = property.contains(TIMESTAMP_OPTION);\n@@ -273,2 +257,1 @@\n-    public static boolean isOn(String option)\n-    {\n+    public static boolean isOn(String option) {\n@@ -297,2 +280,1 @@\n-    public void println(String message)\n-    {\n+    public void println(String message) {\n@@ -306,2 +288,1 @@\n-    public void println(Object obj, String message)\n-    {\n+    public void println(Object obj, String message) {\n@@ -316,2 +297,1 @@\n-    public void println()\n-    {\n+    public void println() {\n@@ -325,2 +305,1 @@\n-    public void println(String prefix, String message)\n-    {\n+    public void println(String prefix, String message) {\n@@ -469,1 +448,1 @@\n-        private static final String PATTERN = \"yyyy-MM-dd kk:mm:ss.SSS z\";\n+        private static final String PATTERN = \"yyyy-MM-dd kk:mm:ss.SSS\";\n@@ -474,1 +453,0 @@\n-\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/Debug.java","additions":37,"deletions":59,"binary":false,"changes":96,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+    static final String DATE_REGEX = \"\\\\d{4}-\\\\d{2}-\\\\d{2}\";\n@@ -65,1 +66,1 @@\n-                        \"UTC]\"),\n+                        \"\\\\|\" + DATE_REGEX + \".*\\\\]:\"),\n@@ -69,1 +70,1 @@\n-                        \"krb5loginmodule\\\\[.*UTC\\\\]\",\n+                        \"krb5loginmodule\\\\[\" + DATE_REGEX + \".*\\\\]\",\n@@ -74,1 +75,1 @@\n-                        \"krb5loginmodule\\\\[.*\\\\|main\\\\|.*UTC\\\\]:\",\n+                        \"krb5loginmodule\\\\[.*\\\\|main|\" + DATE_REGEX + \".*\\\\]:\",\n@@ -83,1 +84,8 @@\n-                \"-Duser.timezone=UTC\",\n+                \"LoginModuleDebug\",\n+                value, key);\n+        outputAnalyzer.shouldHaveExitValue(0)\n+                .shouldMatch(expected)\n+                .shouldNotMatch(notExpected);\n+        \/\/ let's also run with java debug property enabled\n+        outputAnalyzer = ProcessTools.executeTestJava(\n+                \"-Djava.security.debug=all\",\n","filename":"test\/jdk\/sun\/security\/krb5\/auto\/LoginModuleDebug.java","additions":12,"deletions":4,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -45,0 +45,2 @@\n+    static final String DATE_REGEX = \"\\\\d{4}-\\\\d{2}-\\\\d{2}\";\n+\n@@ -53,2 +55,2 @@\n-                        \"properties\\\\[.*\\\\|main|\\\\.*java.*]:\",\n-                        \"UTC]\"),\n+                        \"properties\\\\[.*\\\\|main\\\\|.*java.*]:\",\n+                        \"properties\\\\[\" + DATE_REGEX),\n@@ -57,1 +59,1 @@\n-                        \"properties\\\\[.*UTC\\\\]\",\n+                        \"properties\\\\[\" + DATE_REGEX + \".*\\\\]\",\n@@ -61,1 +63,1 @@\n-                        \"properties\\\\[.*\\\\|main\\\\|.*UTC\\\\]:\",\n+                        \"properties\\\\[.*\\\\|main|\" + DATE_REGEX + \".*\\\\]:\",\n@@ -65,1 +67,1 @@\n-                        \"properties\\\\[.*\\\\|main\\\\|.*UTC\\\\]:\",\n+                        \"properties\\\\[.*\\\\|main|\" + DATE_REGEX + \".*\\\\]:\",\n@@ -70,1 +72,1 @@\n-                        \"properties\\\\[.*\\\\|main\\\\|.*UTC\\\\]:\"),\n+                        \"properties\\\\[.*\\\\|main|\" + DATE_REGEX + \".*\\\\]:\"),\n@@ -73,1 +75,1 @@\n-                        \"properties\\\\[.*\\\\|main\\\\|.*UTC\\\\]:\",\n+                        \"properties\\\\[.*\\\\|main|\" + DATE_REGEX + \".*\\\\]:\",\n@@ -77,1 +79,1 @@\n-                        \"properties\\\\[.*\\\\|main\\\\|.*UTC\\\\]:\",\n+                        \"properties\\\\[.*\\\\|main|\" + DATE_REGEX + \".*\\\\]:\",\n@@ -81,2 +83,2 @@\n-                        \"properties\\\\[.*\\\\|main.*\\\\Rkeystore\\\\[.*\\\\|main|.*\\\\]:\",\n-                        \"UTC]\"),\n+                        \"properties\\\\[.*\\\\|main|.*\\\\Rkeystore\\\\[.*\\\\|main|.*\\\\]:\",\n+                        \"\\\\|\" + DATE_REGEX + \".*\\\\]:\"),\n@@ -85,2 +87,2 @@\n-                        \"properties\\\\[.*\\\\|main.*\\\\Rkeystore\\\\[.*\\\\|main|.*\\\\]:\",\n-                        \"UTC]\"),\n+                        \"properties\\\\[.*\\\\|main|.*\\\\Rkeystore\\\\[.*\\\\|main|.*\\\\]:\",\n+                        \"\\\\|\" + DATE_REGEX + \".*\\\\]:\"),\n@@ -89,2 +91,2 @@\n-                        \"properties\\\\[.*\\\\|main|.*\\\\Rkeystore\\\\[.*UTC\\\\]:\",\n-                        \"properties\\\\[.*UTC\\\\]:\"),\n+                        \"properties\\\\[.*\\\\|main|.*\\\\Rkeystore\\\\[\" + DATE_REGEX + \".*\\\\]:\",\n+                        \"properties\\\\[.*\\\\|\" + DATE_REGEX + \".*\\\\]:\"),\n@@ -94,1 +96,1 @@\n-                        \"properties\\\\[.*UTC\\\\]:\"),\n+                        \"properties\\\\[\" + DATE_REGEX + \".*\\\\]:\"),\n@@ -97,1 +99,2 @@\n-                        \"properties\\\\[.*\\\\|main.*UTC\\\\]((.*\\\\R)*)keystore\\\\[.*\\\\|main.*UTC\\\\]:\",\n+                        \"properties\\\\[.*\\\\|main.*\\\\|\" + DATE_REGEX +\n+                                \".*\\\\]((.*\\\\R)*)keystore\\\\[.*\\\\|main.*\\\\|\" + DATE_REGEX + \".*\\\\]:\",\n@@ -101,1 +104,2 @@\n-                        \"properties\\\\[.*\\\\|main.*UTC\\\\]((.*\\\\R)*)keystore\\\\[.*\\\\|main.*UTC\\\\]:\",\n+                        \"properties\\\\[.*\\\\|main.*\\\\|\" + DATE_REGEX +\n+                                \".*\\\\]((.*\\\\R)*)keystore\\\\[.*\\\\|main.*\\\\|\" + DATE_REGEX + \".*\\\\]:\",\n@@ -110,1 +114,0 @@\n-                \"-Duser.timezone=UTC\",\n","filename":"test\/jdk\/sun\/security\/util\/Debug\/DebugOptions.java","additions":21,"deletions":18,"binary":false,"changes":39,"status":"modified"}]}