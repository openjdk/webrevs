{"files":[{"patch":"@@ -0,0 +1,68 @@\n+#\n+# Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.  Oracle designates this\n+# particular file as subject to the \"Classpath\" exception as provided\n+# by Oracle in the LICENSE file that accompanied this code.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+name: 'Build JTReg'\n+description: 'Build JTReg'\n+\n+runs:\n+  using: composite\n+  steps:\n+    - name: 'Get JTReg version configuration'\n+      id: version\n+      uses: .\/.github\/actions\/config\n+      with:\n+        var: JTREG_VERSION\n+\n+    - name: 'Check cache for already built JTReg'\n+      id: get-cached\n+      uses: actions\/cache@v4\n+      with:\n+        path: jtreg\/installed\n+        key: jtreg-${{ steps.version.outputs.value }}\n+\n+    - name: 'Checkout the JTReg source'\n+      uses: actions\/checkout@v4\n+      with:\n+        repository: openjdk\/jtreg\n+        ref: jtreg-${{ steps.version.outputs.value }}\n+        path: jtreg\/src\n+      if: (steps.get-cached.outputs.cache-hit != 'true')\n+\n+    - name: 'Build JTReg'\n+      run: |\n+        # Build JTReg and move files to the proper locations\n+        bash make\/build.sh --jdk \"$JAVA_HOME_17_X64\"\n+        mkdir ..\/installed\n+        mv build\/images\/jtreg\/* ..\/installed\n+      working-directory: jtreg\/src\n+      shell: bash\n+      if: (steps.get-cached.outputs.cache-hit != 'true')\n+\n+    - name: 'Upload JTReg artifact'\n+      uses: actions\/upload-artifact@v4\n+      with:\n+        name: bundles-jtreg-${{ steps.version.outputs.value }}\n+        path: jtreg\/installed\n+        retention-days: 1\n","filename":".github\/actions\/build-jtreg\/action.yml","additions":68,"deletions":0,"binary":false,"changes":68,"status":"added"},{"patch":"@@ -27,1 +27,1 @@\n-description: 'Download JTReg from cache or source location'\n+description: 'Get JTReg'\n@@ -42,3 +42,3 @@\n-    - name: 'Check cache for JTReg'\n-      id: get-cached-jtreg\n-      uses: actions\/cache@v4\n+    - name: 'Download JTReg artifact'\n+      id: download-jtreg\n+      uses: actions\/download-artifact@v4\n@@ -46,0 +46,1 @@\n+        name: bundles-jtreg-${{ steps.version.outputs.value }}\n@@ -47,25 +48,0 @@\n-        key: jtreg-${{ steps.version.outputs.value }}\n-\n-    - name: 'Checkout the JTReg source'\n-      uses: actions\/checkout@v4\n-      with:\n-        repository: openjdk\/jtreg\n-        ref: jtreg-${{ steps.version.outputs.value }}\n-        path: jtreg\/src\n-      if: steps.get-cached-jtreg.outputs.cache-hit != 'true'\n-\n-    - name: 'Build JTReg'\n-      run: |\n-        # If runner architecture is x64 set JAVA_HOME_17_X64 otherwise set to JAVA_HOME_17_arm64\n-        if [[ '${{ runner.arch }}' == 'X64' ]]; then\n-          JDK=\"$JAVA_HOME_17_X64\"\n-        else\n-          JDK=\"$JAVA_HOME_17_arm64\"\n-        fi\n-        # Build JTReg and move files to the proper locations\n-        bash make\/build.sh --jdk \"$JDK\"\n-        mkdir ..\/installed\n-        mv build\/images\/jtreg\/* ..\/installed\n-      working-directory: jtreg\/src\n-      shell: bash\n-      if: steps.get-cached-jtreg.outputs.cache-hit != 'true'\n","filename":".github\/actions\/get-jtreg\/action.yml","additions":5,"deletions":29,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -57,2 +57,2 @@\n-  select:\n-    name: 'Select platforms'\n+  prepare:\n+    name: 'Prepare the run'\n@@ -76,1 +76,13 @@\n-        # This function must be inlined in main.yml, or we'd be forced to checkout the repo\n+      - name: 'Checkout the scripts'\n+        uses: actions\/checkout@v4\n+        with:\n+          sparse-checkout: |\n+            .github\n+            make\/conf\/github-actions.conf\n+\n+      - name: 'Build JTReg'\n+        id: jtreg\n+        uses: .\/.github\/actions\/build-jtreg\n+\n+      # TODO: Now that we are checking out the repo scripts, we can put the following code\n+      # into a separate file\n@@ -152,1 +164,1 @@\n-    needs: select\n+    needs: prepare\n@@ -159,1 +171,1 @@\n-    if: needs.select.outputs.linux-x64 == 'true'\n+    if: needs.prepare.outputs.linux-x64 == 'true'\n@@ -163,1 +175,1 @@\n-    needs: select\n+    needs: prepare\n@@ -177,1 +189,1 @@\n-    if: needs.select.outputs.linux-x86-hs == 'true'\n+    if: needs.prepare.outputs.linux-x86-hs == 'true'\n@@ -181,1 +193,1 @@\n-    needs: select\n+    needs: prepare\n@@ -191,1 +203,1 @@\n-    if: needs.select.outputs.linux-x64-variants == 'true'\n+    if: needs.prepare.outputs.linux-x64-variants == 'true'\n@@ -195,1 +207,1 @@\n-    needs: select\n+    needs: prepare\n@@ -205,1 +217,1 @@\n-    if: needs.select.outputs.linux-x64-variants == 'true'\n+    if: needs.prepare.outputs.linux-x64-variants == 'true'\n@@ -209,1 +221,1 @@\n-    needs: select\n+    needs: prepare\n@@ -219,1 +231,1 @@\n-    if: needs.select.outputs.linux-x64-variants == 'true'\n+    if: needs.prepare.outputs.linux-x64-variants == 'true'\n@@ -223,1 +235,1 @@\n-    needs: select\n+    needs: prepare\n@@ -234,1 +246,1 @@\n-    if: needs.select.outputs.linux-x64-variants == 'true'\n+    if: needs.prepare.outputs.linux-x64-variants == 'true'\n@@ -238,2 +250,1 @@\n-    needs:\n-      - select\n+    needs: prepare\n@@ -245,1 +256,1 @@\n-    if: needs.select.outputs.linux-cross-compile == 'true'\n+    if: needs.prepare.outputs.linux-cross-compile == 'true'\n@@ -249,1 +260,1 @@\n-    needs: select\n+    needs: prepare\n@@ -255,1 +266,1 @@\n-    if: needs.select.outputs.alpine-linux-x64 == 'true'\n+    if: needs.prepare.outputs.alpine-linux-x64 == 'true'\n@@ -259,1 +270,1 @@\n-    needs: select\n+    needs: prepare\n@@ -267,1 +278,1 @@\n-    if: needs.select.outputs.macos-x64 == 'true'\n+    if: needs.prepare.outputs.macos-x64 == 'true'\n@@ -271,1 +282,1 @@\n-    needs: select\n+    needs: prepare\n@@ -279,1 +290,1 @@\n-    if: needs.select.outputs.macos-aarch64 == 'true'\n+    if: needs.prepare.outputs.macos-aarch64 == 'true'\n@@ -283,1 +294,1 @@\n-    needs: select\n+    needs: prepare\n@@ -291,1 +302,1 @@\n-    if: needs.select.outputs.windows-x64 == 'true'\n+    if: needs.prepare.outputs.windows-x64 == 'true'\n@@ -295,1 +306,1 @@\n-    needs: select\n+    needs: prepare\n@@ -305,1 +316,1 @@\n-    if: needs.select.outputs.windows-aarch64 == 'true'\n+    if: needs.prepare.outputs.windows-aarch64 == 'true'\n@@ -309,1 +320,1 @@\n-    needs: select\n+    needs: prepare\n@@ -321,1 +332,1 @@\n-    if: needs.select.outputs.docs == 'true'\n+    if: needs.prepare.outputs.docs == 'true'\n","filename":".github\/workflows\/main.yml","additions":41,"deletions":30,"binary":false,"changes":71,"status":"modified"}]}