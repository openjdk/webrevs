{"files":[{"patch":"@@ -765,16 +765,33 @@\n-void PhaseGVN::dead_loop_check( Node *n ) {\n-  \/\/ Phi may reference itself in a loop\n-  if (n != nullptr && !n->is_dead_loop_safe() && !n->is_CFG()) {\n-    \/\/ Do 2 levels check and only data inputs.\n-    bool no_dead_loop = true;\n-    uint cnt = n->req();\n-    for (uint i = 1; i < cnt && no_dead_loop; i++) {\n-      Node *in = n->in(i);\n-      if (in == n) {\n-        no_dead_loop = false;\n-      } else if (in != nullptr && !in->is_dead_loop_safe()) {\n-        uint icnt = in->req();\n-        for (uint j = 1; j < icnt && no_dead_loop; j++) {\n-          if (in->in(j) == n || in->in(j) == in)\n-            no_dead_loop = false;\n-        }\n+void PhaseGVN::dead_loop_check(Node* n) {\n+  \/\/ Phi may reference itself in a loop.\n+  if (n == nullptr || n->is_dead_loop_safe() || n->is_CFG()) {\n+    return;\n+  }\n+\n+  \/\/ Do 2 levels check and only data inputs.\n+  for (uint i = 1; i < n->req(); i++) {\n+    Node* in = n->in(i);\n+    if (in == n) {\n+      n->dump_bfs(100, nullptr, \"\");\n+\n+      stringStream ss;\n+      ss.print_cr(\"Dead loop detected, node references itself\");\n+      ss.print(\"#\\n#  Node: \");\n+      n->dump(\"\", false, &ss);\n+      fatal(\"%s\", ss.as_string());\n+    }\n+\n+    if (in == nullptr || in->is_dead_loop_safe()) {\n+      continue;\n+    }\n+    for (uint j = 1; j < in->req(); j++) {\n+      if (in->in(j) == n || in->in(j) == in) {\n+        n->dump_bfs(100, nullptr, \"\");\n+\n+        stringStream ss;\n+        ss.print_cr(\"Dead loop detected, node input references current node or itself\");\n+        ss.print(\"#\\n#  Input: \");\n+        in->dump(\"\", false, &ss);\n+        ss.print(\"#\\n#  Node: \");\n+        n->dump(\"\", false, &ss);\n+        fatal(\"%s\", ss.as_string());\n@@ -783,2 +800,0 @@\n-    if (!no_dead_loop) { n->dump_bfs(100, nullptr, \"\"); }\n-    assert(no_dead_loop, \"dead loop detected\");\n","filename":"src\/hotspot\/share\/opto\/phaseX.cpp","additions":33,"deletions":18,"binary":false,"changes":51,"status":"modified"}]}