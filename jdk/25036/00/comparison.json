{"files":[{"patch":"@@ -550,1 +550,0 @@\n-  uint shrink_count = 0;\n@@ -562,0 +561,7 @@\n+  uint max_shrink_count = 0;\n+  if (capacity() > MinHeapSize) {\n+    size_t max_shrink_bytes = capacity() - MinHeapSize;\n+    max_shrink_count = (uint)(max_shrink_bytes \/ G1HeapRegion::GrainBytes);\n+  }\n+\n+  uint shrink_count = 0;\n@@ -568,2 +574,6 @@\n-    _hrm.shrink_at(r->hrm_index(), 1);\n-    shrink_count++;\n+    if (shrink_count < max_shrink_count) {\n+      _hrm.shrink_at(r->hrm_index(), 1);\n+      shrink_count++;\n+    } else {\n+      _hrm.insert_into_free_list(r);\n+    }\n@@ -575,2 +585,2 @@\n-    log_debug(gc, ergo, heap)(\"Attempt heap shrinking (CDS archive regions). Total size: %zuB\",\n-                              G1HeapRegion::GrainWords * HeapWordSize * shrink_count);\n+    log_debug(gc, ergo, heap)(\"Attempt heap shrinking (CDS archive regions). Total size: %zuB (%u Regions)\",\n+                              G1HeapRegion::GrainWords * HeapWordSize * shrink_count, shrink_count);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":15,"deletions":5,"binary":false,"changes":20,"status":"modified"}]}