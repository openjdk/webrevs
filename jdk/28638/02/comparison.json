{"files":[{"patch":"@@ -97,1 +97,0 @@\n-gc\/cslocker\/TestCSLocker.java 8373025 generic-all\n","filename":"test\/hotspot\/jtreg\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,6 +36,0 @@\n- * @comment This test assumes that no allocation happens during the sleep loop,\n- *          which is something that we can't guarantee. With ZGC we see test\n- *          timeouts because the main thread allocates and waits for the GC,\n- *          which waits for the CSLocker, which waits for the main thread.\n- * @requires vm.gc != \"Z\"\n- *\n@@ -47,1 +41,0 @@\n-    static int timeoutMillis = 5000;\n@@ -56,7 +49,0 @@\n-        \/\/ After the CSLocker thread has started, any operation such as an allocation,\n-        \/\/ which could rely on the GC to make progress, will cause a deadlock that will\n-        \/\/ make the test time out. That includes printing. Please don't use any such\n-        \/\/ code until unlock() is called below.\n-\n-        \/\/ check timeout to success deadlocking\n-        sleep(timeoutMillis);\n@@ -64,1 +50,2 @@\n-        csLocker.unlock();\n+        \/\/ Wait for the csLocker thread to finish its critical section\n+        csLocker.join();\n@@ -100,1 +87,1 @@\n-        if (!lock(a)) {\n+        if (!criticalSection(a)) {\n@@ -105,2 +92,1 @@\n-    native boolean lock(int[] array);\n-    native void unlock();\n+    native boolean criticalSection(int[] array);\n","filename":"test\/hotspot\/jtreg\/gc\/cslocker\/TestCSLocker.java","additions":5,"deletions":19,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,6 @@\n+#ifdef WINDOWS\n+#include <windows.h>\n+#else\n+#include <unistd.h>\n+#endif\n+\n@@ -28,1 +34,1 @@\n-JNIEXPORT jboolean JNICALL Java_gc_cslocker_CSLocker_lock\n+JNIEXPORT jboolean JNICALL Java_gc_cslocker_CSLocker_criticalSection\n@@ -36,0 +42,7 @@\n+    } else {\n+      \/\/ Wait for 5 seconds\n+#ifdef WINDOWS\n+      Sleep(5000);\n+#else\n+      sleep(5);\n+#endif\n@@ -38,3 +51,0 @@\n-    \/\/ deadblock\n-    while (!release_critical) \/* empty *\/;\n-\n@@ -44,6 +54,0 @@\n-\n-JNIEXPORT void JNICALL Java_gc_cslocker_CSLocker_unlock\n-  (JNIEnv *env, jobject obj)\n-{\n-    release_critical = 1;\n-}\n","filename":"test\/hotspot\/jtreg\/gc\/cslocker\/libTestCSLocker.c","additions":15,"deletions":11,"binary":false,"changes":26,"status":"modified"}]}