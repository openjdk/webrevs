{"files":[{"patch":"@@ -48,0 +48,2 @@\n+#include \"utilities\/debug.hpp\"\n+#include \"utilities\/ostream.hpp\"\n@@ -2982,5 +2984,2 @@\n-  if( _ptr == Null ) st->print(\"null\");\n-  else st->print(\"%s *\", ptr_msg[_ptr]);\n-  if( _offset == OffsetTop ) st->print(\"+top\");\n-  else if( _offset == OffsetBot ) st->print(\"+bot\");\n-  else if( _offset ) st->print(\"+%d\", _offset);\n+  st->print(\"ptr:%s\", ptr_msg[_ptr]);\n+  dump_offset(st);\n@@ -2991,0 +2990,10 @@\n+void TypePtr::dump_offset(outputStream* st) const {\n+  if (_offset == OffsetBot) {\n+    st->print(\"+bot\");\n+  } else if (_offset == OffsetTop) {\n+    st->print(\"+top\");\n+  } else {\n+    st->print(\"+%d\", _offset);\n+  }\n+}\n+\n@@ -3162,4 +3171,4 @@\n-void TypeRawPtr::dump2( Dict &d, uint depth, outputStream *st ) const {\n-  if( _ptr == Constant )\n-    st->print(INTPTR_FORMAT, p2i(_bits));\n-  else\n+void TypeRawPtr::dump2(Dict& d, uint depth, outputStream* st) const {\n+  if (_ptr == Constant) {\n+    st->print(\"rawptr:Constant:\" INTPTR_FORMAT, p2i(_bits));\n+  } else {\n@@ -3167,0 +3176,1 @@\n+  }\n@@ -3801,1 +3811,1 @@\n-void TypeOopPtr::dump2( Dict &d, uint depth, outputStream *st ) const {\n+void TypeOopPtr::dump2(Dict& d, uint depth, outputStream* st) const {\n@@ -3803,13 +3813,8 @@\n-  if( _klass_is_exact ) st->print(\":exact\");\n-  if( const_oop() ) st->print(INTPTR_FORMAT, p2i(const_oop()));\n-  switch( _offset ) {\n-  case OffsetTop: st->print(\"+top\"); break;\n-  case OffsetBot: st->print(\"+any\"); break;\n-  case         0: break;\n-  default:        st->print(\"+%d\",_offset); break;\n-  }\n-  if (_instance_id == InstanceTop)\n-    st->print(\",iid=top\");\n-  else if (_instance_id != InstanceBot)\n-    st->print(\",iid=%d\",_instance_id);\n-\n+  if (_klass_is_exact) {\n+    st->print(\":exact\");\n+  }\n+  if (const_oop() != nullptr) {\n+    st->print(\":\" INTPTR_FORMAT, p2i(const_oop()));\n+  }\n+  dump_offset(st);\n+  dump_instance_id(st);\n@@ -3819,0 +3824,10 @@\n+\n+void TypeOopPtr::dump_instance_id(outputStream* st) const {\n+  if (_instance_id == InstanceTop) {\n+    st->print(\",iid=top\");\n+  } else if (_instance_id == InstanceBot) {\n+    st->print(\",iid=bot\");\n+  } else {\n+    st->print(\",iid=%d\", _instance_id);\n+  }\n+}\n@@ -4456,0 +4471,1 @@\n+  st->print(\"instptr:\");\n@@ -4459,28 +4475,3 @@\n-  switch( _ptr ) {\n-  case Constant:\n-    if (WizardMode || Verbose) {\n-      ResourceMark rm;\n-      stringStream ss;\n-\n-      st->print(\" \");\n-      const_oop()->print_oop(&ss);\n-      \/\/ 'const_oop->print_oop()' may emit newlines('\\n') into ss.\n-      \/\/ suppress newlines from it so -XX:+Verbose -XX:+PrintIdeal dumps one-liner for each node.\n-      char* buf = ss.as_string(\/* c_heap= *\/false);\n-      StringUtils::replace_no_expand(buf, \"\\n\", \"\");\n-      st->print_raw(buf);\n-    }\n-  case BotPTR:\n-    if (!WizardMode && !Verbose) {\n-      if( _klass_is_exact ) st->print(\":exact\");\n-      break;\n-    }\n-  case TopPTR:\n-  case AnyNull:\n-  case NotNull:\n-    st->print(\":%s\", ptr_msg[_ptr]);\n-    if( _klass_is_exact ) st->print(\":exact\");\n-    break;\n-  default:\n-    break;\n-  }\n+  if (_ptr == Constant && (WizardMode || Verbose)) {\n+    ResourceMark rm;\n+    stringStream ss;\n@@ -4488,4 +4479,7 @@\n-  if( _offset ) {               \/\/ Dump offset, if any\n-    if( _offset == OffsetBot )      st->print(\"+any\");\n-    else if( _offset == OffsetTop ) st->print(\"+unknown\");\n-    else st->print(\"+%d\", _offset);\n+    st->print(\" \");\n+    const_oop()->print_oop(&ss);\n+    \/\/ 'const_oop->print_oop()' may emit newlines('\\n') into ss.\n+    \/\/ suppress newlines from it so -XX:+Verbose -XX:+PrintIdeal dumps one-liner for each node.\n+    char* buf = ss.as_string(\/* c_heap= *\/false);\n+    StringUtils::replace_no_expand(buf, \"\\n\", \"\");\n+    st->print_raw(buf);\n@@ -4494,5 +4488,4 @@\n-  st->print(\" *\");\n-  if (_instance_id == InstanceTop)\n-    st->print(\",iid=top\");\n-  else if (_instance_id != InstanceBot)\n-    st->print(\",iid=%d\",_instance_id);\n+  st->print(\":%s\", ptr_msg[_ptr]);\n+  if (_klass_is_exact) {\n+    st->print(\":exact\");\n+  }\n@@ -4500,0 +4493,2 @@\n+  dump_offset(st);\n+  dump_instance_id(st);\n@@ -5092,1 +5087,2 @@\n-  _ary->dump2(d,depth,st);\n+  st->print(\"aryptr:\");\n+  _ary->dump2(d, depth, st);\n@@ -5095,2 +5091,1 @@\n-  switch( _ptr ) {\n-  case Constant:\n+  if (_ptr == Constant) {\n@@ -5098,14 +5093,5 @@\n-    break;\n-  case BotPTR:\n-    if (!WizardMode && !Verbose) {\n-      if( _klass_is_exact ) st->print(\":exact\");\n-      break;\n-    }\n-  case TopPTR:\n-  case AnyNull:\n-  case NotNull:\n-    st->print(\":%s\", ptr_msg[_ptr]);\n-    if( _klass_is_exact ) st->print(\":exact\");\n-    break;\n-  default:\n-    break;\n+  }\n+\n+  st->print(\":%s\", ptr_msg[_ptr]);\n+  if (_klass_is_exact) {\n+    st->print(\":exact\");\n@@ -5129,5 +5115,0 @@\n-  st->print(\" *\");\n-  if (_instance_id == InstanceTop)\n-    st->print(\",iid=top\");\n-  else if (_instance_id != InstanceBot)\n-    st->print(\",iid=%d\",_instance_id);\n@@ -5135,0 +5116,1 @@\n+  dump_instance_id(st);\n@@ -5493,6 +5475,2 @@\n-  if( metadata() ) st->print(INTPTR_FORMAT, p2i(metadata()));\n-  switch( _offset ) {\n-  case OffsetTop: st->print(\"+top\"); break;\n-  case OffsetBot: st->print(\"+any\"); break;\n-  case         0: break;\n-  default:        st->print(\"+%d\",_offset); break;\n+  if (metadata() != nullptr) {\n+    st->print(\":\" INTPTR_FORMAT, p2i(metadata()));\n@@ -5500,0 +5478,1 @@\n+  dump_offset(st);\n@@ -5647,38 +5626,0 @@\n-\/\/------------------------------dump2------------------------------------------\n-\/\/ Dump Klass Type\n-#ifndef PRODUCT\n-void TypeKlassPtr::dump2(Dict & d, uint depth, outputStream *st) const {\n-  switch(_ptr) {\n-  case Constant:\n-    st->print(\"precise \");\n-  case NotNull:\n-    {\n-      const char *name = klass()->name()->as_utf8();\n-      if (name) {\n-        st->print(\"%s: \" INTPTR_FORMAT, name, p2i(klass()));\n-      } else {\n-        ShouldNotReachHere();\n-      }\n-      _interfaces->dump(st);\n-    }\n-  case BotPTR:\n-    if (!WizardMode && !Verbose && _ptr != Constant) break;\n-  case TopPTR:\n-  case AnyNull:\n-    st->print(\":%s\", ptr_msg[_ptr]);\n-    if (_ptr == Constant) st->print(\":exact\");\n-    break;\n-  default:\n-    break;\n-  }\n-\n-  if (_offset) {               \/\/ Dump offset, if any\n-    if (_offset == OffsetBot)      { st->print(\"+any\"); }\n-    else if (_offset == OffsetTop) { st->print(\"+unknown\"); }\n-    else                            { st->print(\"+%d\", _offset); }\n-  }\n-\n-  st->print(\" *\");\n-}\n-#endif\n-\n@@ -6039,0 +5980,9 @@\n+#ifndef PRODUCT\n+void TypeInstKlassPtr::dump2(Dict& d, uint depth, outputStream* st) const {\n+  st->print(\"instklassptr:\");\n+  klass()->print_name_on(st);\n+  _interfaces->dump(st);\n+  st->print(\":%s\", ptr_msg[_ptr]);\n+  dump_offset(st);\n+}\n+#endif \/\/ PRODUCT\n@@ -6510,28 +6460,5 @@\n-  switch( _ptr ) {\n-  case Constant:\n-    st->print(\"precise \");\n-  case NotNull:\n-    {\n-      st->print(\"[\");\n-      _elem->dump2(d, depth, st);\n-      _interfaces->dump(st);\n-      st->print(\": \");\n-    }\n-  case BotPTR:\n-    if( !WizardMode && !Verbose && _ptr != Constant ) break;\n-  case TopPTR:\n-  case AnyNull:\n-    st->print(\":%s\", ptr_msg[_ptr]);\n-    if( _ptr == Constant ) st->print(\":exact\");\n-    break;\n-  default:\n-    break;\n-  }\n-\n-  if( _offset ) {               \/\/ Dump offset, if any\n-    if( _offset == OffsetBot )      { st->print(\"+any\"); }\n-    else if( _offset == OffsetTop ) { st->print(\"+unknown\"); }\n-    else                            { st->print(\"+%d\", _offset); }\n-  }\n-\n-  st->print(\" *\");\n+  st->print(\"aryklassptr:[\");\n+  _elem->dump2(d, depth, st);\n+  _interfaces->dump(st);\n+  st->print(\":%s\", ptr_msg[_ptr]);\n+  dump_offset(st);\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":81,"deletions":154,"binary":false,"changes":235,"status":"modified"},{"patch":"@@ -1179,3 +1179,0 @@\n-#ifndef PRODUCT\n-  void dump_speculative(outputStream *st) const;\n-#endif\n@@ -1186,0 +1183,1 @@\n+\n@@ -1187,1 +1185,3 @@\n-  void dump_inline_depth(outputStream *st) const;\n+  void dump_speculative(outputStream* st) const;\n+  void dump_inline_depth(outputStream* st) const;\n+  void dump_offset(outputStream* st) const;\n@@ -1367,0 +1367,4 @@\n+#ifndef PRODUCT\n+  void dump_instance_id(outputStream* st) const;\n+#endif \/\/ PRODUCT\n+\n@@ -1835,3 +1839,0 @@\n-#ifndef PRODUCT\n-  virtual void dump2( Dict &d, uint depth, outputStream *st ) const; \/\/ Specialized per-Type dumping\n-#endif\n@@ -1917,0 +1918,5 @@\n+\n+#ifndef PRODUCT\n+  virtual void dump2(Dict& d, uint depth, outputStream* st) const;\n+#endif \/\/ PRODUCT\n+\n","filename":"src\/hotspot\/share\/opto\/type.hpp","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -3201,1 +3201,3 @@\n-    \/\/ @fully\/qualified\/package\/name\/to\/TheClass+12 *\n+    \/\/ @ptrtype:fully\/qualified\/package\/name\/to\/TheClass:ptrlattice+12\n+    \/\/ with ptrtype being the kind of the type such as instptr, aryptr, etc, and ptrlattice being\n+    \/\/ the kind of the value such as BotPTR, NotNull, etc.\n@@ -3203,2 +3205,2 @@\n-    \/\/ - after @, we can have \"stable:\" or other labels, with optional space after ':'\n-    \/\/ - the class can actually be a subclass, with $ separator (and it must be ok to give only the deepest one\n+    \/\/ - after ptrtype, we can have \"stable:\" or other labels, with optional space after ':'\n+    \/\/ - the class can actually be a nested class, with $ separator (and it must be ok to give only the deepest one\n@@ -3206,1 +3208,0 @@\n-    \/\/ - before the offset, we can have something like \":NotNull\", either way, seeing \"+\" or \":\" means the end of the type\n@@ -3208,3 +3209,12 @@\n-    \/\/ @bla: bli:a\/b\/c$d$e (f\/g,h\/i\/j):NotNull+24 *\n-    private static final String LOAD_STORE_PREFIX = \"@(\\\\w+: ?)*[\\\\w\/\\\\$]*\\\\b\";\n-    private static final String LOAD_STORE_SUFFIX = \"( \\\\([^\\\\)]+\\\\))?(:|\\\\+)\\\\S* \\\\*\";\n+    \/\/ @bla: bli:a\/b\/c$d$e (f\/g,h\/i\/j):NotNull+24\n+\n+    \/\/ @ matches the start character of the pattern\n+    \/\/ (\\w+: ?)+ tries to match the pattern 'ptrtype:' or 'stable:' with optional trailing whitespaces\n+    \/\/ (\\w\/)* tries to match the pattern 'a\/b\/`\n+    \/\/ (\\w$)* tries to match the pattern 'c$d$'\n+    \/\/ \\b asserts that the next character is a word character\n+    private static final String LOAD_STORE_PREFIX = \"@(\\\\w+: ?)+(\\\\w\/)*(\\\\w$)*\\\\b\";\n+    \/\/ ( \\([^\\)]+\\))? tries to match the pattern ' (f\/g,h\/i\/j)'\n+    \/\/ :\\w+ tries to match the pattern ':NotNull'\n+    \/\/ .* tries to match the remaining of the pattern\n+    private static final String LOAD_STORE_SUFFIX = \"( \\\\([^\\\\)]+\\\\))?:\\\\w+.*\";\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/ir_framework\/IRNode.java","additions":17,"deletions":7,"binary":false,"changes":24,"status":"modified"}]}