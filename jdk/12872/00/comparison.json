{"files":[{"patch":"@@ -58,1 +58,0 @@\n-\n@@ -103,2 +102,2 @@\n-     * need to be set so that the settings are effective for IPv4 multicast\n-     * datagrams sent using the socket.\n+     * need to be set so that the settings are effective for IPv4 connections\n+     * and datagrams.\n@@ -451,0 +450,17 @@\n+    \/**\n+     * Sets a IPPROTO_IPV6\/IPPROTO level socket. Some platforms require both\n+     * IPPROTO_IPV6 and IPPROTO socket options to be set when the socket is IPv6.\n+     * In that case, the IPPROTO socket option is set on a best effort basis.\n+     *\/\n+    static <T> void setIpSocketOption(FileDescriptor fd, ProtocolFamily family,\n+                                      SocketOption<T> opt, T value)\n+        throws IOException\n+    {\n+        setSocketOption(fd, family, opt, value);\n+        if (family == StandardProtocolFamily.INET6 && shouldSetBothIPv4AndIPv6Options()) {\n+            try {\n+                setSocketOption(fd, StandardProtocolFamily.INET, opt, value);\n+            } catch (IOException ignore) { }\n+        }\n+    }\n+\n@@ -486,1 +502,1 @@\n-    public static boolean isFastTcpLoopbackRequested() {\n+    private static boolean isFastTcpLoopbackRequested() {\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/Net.java","additions":20,"deletions":4,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -960,2 +960,2 @@\n-                \/\/ maps to IP_TOS or IPV6_TCLASS\n-                Net.setSocketOption(fd, family(), opt, value);\n+                \/\/ maps to IPV6_TCLASS and\/or IP_TOS\n+                Net.setIpSocketOption(fd, family(), opt, value);\n@@ -1035,1 +1035,1 @@\n-                    Net.setSocketOption(fd, family(), StandardSocketOptions.IP_TOS, i);\n+                    Net.setIpSocketOption(fd, family(), StandardSocketOptions.IP_TOS, i);\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/NioSocketImpl.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -275,2 +275,2 @@\n-                    \/\/ special handling for IP_TOS\n-                    Net.setSocketOption(fd, family, name, value);\n+                    \/\/ maps to IPV6_TCLASS and\/or IP_TOS\n+                    Net.setIpSocketOption(fd, family, name, value);\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/SocketChannelImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}