{"files":[{"patch":"@@ -646,2 +646,2 @@\n-                int sourceLevel = detectSourceLevel(options.valuesOf(argC)\n-                                                           .toArray(String[]::new));\n+                String sourceLevel = detectSourceLevel(options.valuesOf(argC)\n+                                                              .toArray(String[]::new));\n@@ -2315,1 +2315,1 @@\n-            int sourceLevel = detectSourceLevel(options.compilerOptions());\n+            String sourceLevel = detectSourceLevel(options.compilerOptions());\n@@ -2334,1 +2334,1 @@\n-            int sourceLevel = detectSourceLevel(options.compilerOptions());\n+            String sourceLevel = detectSourceLevel(options.compilerOptions());\n@@ -2352,1 +2352,1 @@\n-    private int detectSourceLevel(String[] compilerOptions) {\n+    private String detectSourceLevel(String[] compilerOptions) {\n@@ -2357,1 +2357,1 @@\n-                        return Integer.parseInt(compilerOptions[i + 1]);\n+                        return compilerOptions[i + 1];\n@@ -2362,1 +2362,1 @@\n-        return SourceVersion.latest().runtimeVersion().feature();\n+        return Integer.toString(SourceVersion.latest().runtimeVersion().feature());\n","filename":"src\/jdk.jshell\/share\/classes\/jdk\/internal\/jshell\/tool\/JShellTool.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+import com.sun.tools.javac.code.Source;\n+import com.sun.tools.javac.code.Source.Feature;\n@@ -121,1 +123,1 @@\n-    private static final String DEFAULT_24_STARTUP_NAME = \"DEFAULT_24\";\n+    private static final String DEFAULT_STARTUP_NAME_NO_MODULE_IMPORTS = \"DEFAULT_NO_MODULE_IMPORTS\";\n@@ -176,1 +178,1 @@\n-                                  sue.name.equals(DEFAULT_24_STARTUP_NAME) ||\n+                                  sue.name.equals(DEFAULT_STARTUP_NAME_NO_MODULE_IMPORTS) ||\n@@ -228,1 +230,1 @@\n-    static Startup unpack(String storedForm, int sourceLevel, boolean preview, MessageHandler mh) {\n+    static Startup unpack(String storedForm, String sourceLevel, boolean preview, MessageHandler mh) {\n@@ -339,3 +341,5 @@\n-    static Startup defaultStartup(int sourceLevel, boolean preview, MessageHandler mh) {\n-        boolean startup24 = sourceLevel < 25;\n-        int idx = preview ? 2 : startup24 ? 1 : 0;\n+    static Startup defaultStartup(String sourceLevel, boolean preview, MessageHandler mh) {\n+        Source source = Source.lookup(sourceLevel);\n+        boolean hasModuleImports = source == null ||\n+                                   Feature.MODULE_IMPORTS.allowedInSource(source);\n+        int idx = preview ? 2 : !hasModuleImports ? 1 : 0;\n@@ -347,2 +351,2 @@\n-                                      : startup24 ? DEFAULT_24_STARTUP_NAME\n-                                                  : DEFAULT_STARTUP_NAME;\n+                                      : !hasModuleImports ? DEFAULT_STARTUP_NAME_NO_MODULE_IMPORTS\n+                                                          : DEFAULT_STARTUP_NAME;\n","filename":"src\/jdk.jshell\/share\/classes\/jdk\/internal\/jshell\/tool\/Startup.java","additions":12,"deletions":8,"binary":false,"changes":20,"status":"modified"},{"patch":"","filename":"src\/jdk.jshell\/share\/classes\/jdk\/jshell\/tool\/resources\/DEFAULT_NO_MODULE_IMPORTS.jsh","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"src\/jdk.jshell\/share\/classes\/jdk\/jshell\/tool\/resources\/DEFAULT_24.jsh","status":"renamed"}]}