{"files":[{"patch":"@@ -245,1 +245,7 @@\n-class ClassLoaderDataGraph::ClassLoaderDataGraphIterator : public StackObj {\n+\/\/ This iterator does not keep the CLD alive.\n+\/\/ Any CLD OopHandles (modules, mirrors, resolved refs)\n+\/\/ resolved must be treated as no keepalive. And requires\n+\/\/ that its CLD's holder is kept alive if they escape the\n+\/\/ caller's safepoint or ClassLoaderDataGraph_lock\n+\/\/ critical section.\n+class ClassLoaderDataGraph::ClassLoaderDataGraphNoKeepAliveIterator : public StackObj {\n@@ -253,1 +259,1 @@\n-  ClassLoaderDataGraphIterator() : _next(ClassLoaderDataGraph::_head), _thread(Thread::current()), _hm(_thread) {\n+  ClassLoaderDataGraphNoKeepAliveIterator() : _next(ClassLoaderDataGraph::_head), _thread(Thread::current()), _hm(_thread) {\n@@ -273,1 +279,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -282,1 +288,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -289,1 +295,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -296,1 +302,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -304,1 +310,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -314,1 +320,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -322,1 +328,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -329,1 +335,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -342,1 +348,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -351,1 +357,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -364,1 +370,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -548,1 +554,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n@@ -564,1 +570,1 @@\n-  ClassLoaderDataGraphIterator iter;\n+  ClassLoaderDataGraphNoKeepAliveIterator iter;\n","filename":"src\/hotspot\/share\/classfile\/classLoaderDataGraph.cpp","additions":21,"deletions":15,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-  class ClassLoaderDataGraphIterator;\n+  class ClassLoaderDataGraphNoKeepAliveIterator;\n@@ -74,0 +74,6 @@\n+  \/\/ All the do_no_keepalive suffixed functions do not keep the CLD alive. Any\n+  \/\/ CLD OopHandles (modules, mirrors, resolved refs) resolved must be treated\n+  \/\/ as no keepalive. And requires that its CLD's holder is kept alive if they\n+  \/\/ escape the caller's safepoint or ClassLoaderDataGraph_lock critical\n+  \/\/ section.\n+  \/\/ The do_keepalive suffixed functions will keep all CLDs alive.\n","filename":"src\/hotspot\/share\/classfile\/classLoaderDataGraph.hpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}