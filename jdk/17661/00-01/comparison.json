{"files":[{"patch":"@@ -406,4 +406,0 @@\n-  \/\/ Adds instance fields of the class and all superclasses (superclass fields first).\n-  \/\/ Returns total number of the fields in the class and its superclasses (static and instance).\n-  int add_instance_fields(InstanceKlass* ik, int start_index);\n-\n@@ -449,18 +445,0 @@\n-int ClassFieldMap::add_instance_fields(InstanceKlass* ik, int start_index) {\n-  \/\/ add super fields first\n-  InstanceKlass* super_klass = ik->java_super();\n-  if (super_klass != nullptr) {\n-    start_index += add_instance_fields(super_klass, start_index);\n-  }\n-\n-  int count = 0;\n-  for (FilteredJavaFieldStream fld(ik); !fld.done(); fld.next(), count++) {\n-    \/\/ ignore static fields\n-    if (fld.access_flags().is_static()) {\n-      continue;\n-    }\n-    add(start_index + count, fld.signature()->char_at(0), fld.offset());\n-  }\n-  return count;\n-}\n-\n@@ -469,1 +447,0 @@\n-\/\/\n@@ -504,2 +481,20 @@\n-  int index = interfaces_field_count(ik);\n-  field_map->add_instance_fields(ik, index);\n+  \/\/ fields of the superclasses are reported first, so need to know total field number to calculate field indices\n+  int total_field_number = interfaces_field_count(ik);\n+  for (InstanceKlass* klass = ik; klass != nullptr; klass = klass->java_super()) {\n+    FilteredJavaFieldStream fld(klass);\n+    total_field_number += fld.field_count();\n+  }\n+\n+  for (InstanceKlass* klass = ik; klass != nullptr; klass = klass->java_super()) {\n+    FilteredJavaFieldStream fld(klass);\n+    int start_index = total_field_number - fld.field_count();\n+    for (int index = 0; !fld.done(); fld.next(), index++) {\r\n+      \/\/ ignore static fields\r\n+      if (fld.access_flags().is_static()) {\r\n+        continue;\r\n+      }\r\n+      field_map->add(start_index + index, fld.signature()->char_at(0), fld.offset());\n+    }\n+    \/\/ update total_field_number for superclass\n+    total_field_number = start_index;\n+  }\n","filename":"src\/hotspot\/share\/prims\/jvmtiTagMap.cpp","additions":20,"deletions":25,"binary":false,"changes":45,"status":"modified"}]}