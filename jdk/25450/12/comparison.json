{"files":[{"patch":"@@ -172,1 +172,1 @@\n-julong    os::Aix::_physical_memory = 0;\n+size_t    os::Aix::_physical_memory = 0;\n@@ -257,2 +257,2 @@\n-julong os::free_memory() {\n-  return Aix::available_memory();\n+bool os::free_memory(size_t& value) {\n+  return Aix::available_memory(value);\n@@ -261,2 +261,2 @@\n-julong os::available_memory() {\n-  return Aix::available_memory();\n+bool os::available_memory(size_t& value) {\n+  return Aix::available_memory(value);\n@@ -265,1 +265,1 @@\n-julong os::Aix::available_memory() {\n+bool os::Aix::available_memory(size_t& value) {\n@@ -268,1 +268,2 @@\n-    return mi.real_free;\n+    value = static_cast<size_t>(mi.real_free);\n+    return true;\n@@ -270,1 +271,1 @@\n-    return ULONG_MAX;\n+    return false;\n@@ -274,1 +275,1 @@\n-jlong os::total_swap_space() {\n+bool os::total_swap_space(size_t& value) {\n@@ -277,1 +278,1 @@\n-    return -1;\n+    return false;\n@@ -279,1 +280,2 @@\n-  return (jlong)(memory_info.pgsp_total * 4 * K);\n+  value = static_cast<size_t>(memory_info.pgsp_total * 4 * K);\n+  return true;\n@@ -282,1 +284,1 @@\n-jlong os::free_swap_space() {\n+bool os::free_swap_space(size_t& value) {\n@@ -285,1 +287,1 @@\n-    return -1;\n+    return false;\n@@ -287,1 +289,2 @@\n-  return (jlong)(memory_info.pgsp_free * 4 * K);\n+  value = static_cast<size_t>(memory_info.pgsp_free * 4 * K);\n+  return true;\n@@ -290,2 +293,9 @@\n-julong os::physical_memory() {\n-  return Aix::physical_memory();\n+bool os::physical_memory(size_t& value) {\n+  size_t phys_mem = Aix::physical_memory();\n+  if (phys_mem == std::numeric_limits<size_t>::max())\n+  {\n+    \/\/ os::Aix::get_meminfo failed\n+    return false;\n+  }\n+  value = phys_mem;\n+  return true;\n@@ -328,0 +338,4 @@\n+    \/\/ to propagate error\n+    _physical_memory = std::numeric_limits<size_t>::max();\n+  } else {\n+    _physical_memory = static_cast<size_t>(mi.real_total);\n@@ -329,1 +343,0 @@\n-  _physical_memory = (julong) mi.real_total;\n@@ -2207,1 +2220,1 @@\n-  trcVerbose(\"physical memory: %lu\", Aix::_physical_memory);\n+  trcVerbose(\"physical memory: %zu\", Aix::_physical_memory);\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":31,"deletions":18,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-  static julong _physical_memory;\n+  static size_t _physical_memory;\n@@ -57,3 +57,3 @@\n-  static julong available_memory();\n-  static julong free_memory();\n-  static julong physical_memory() { return _physical_memory; }\n+  static bool available_memory(size_t& value);\n+  static bool free_memory(size_t& value);\n+  static size_t physical_memory() { return _physical_memory; }\n","filename":"src\/hotspot\/os\/aix\/os_aix.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -117,1 +117,1 @@\n-julong os::Bsd::_physical_memory = 0;\n+size_t os::Bsd::_physical_memory = 0;\n@@ -136,2 +136,2 @@\n-julong os::available_memory() {\n-  return Bsd::available_memory();\n+bool os::available_memory(size_t& value) {\n+  return Bsd::available_memory(value);\n@@ -140,2 +140,2 @@\n-julong os::free_memory() {\n-  return Bsd::available_memory();\n+bool os::free_memory(size_t& value) {\n+  return Bsd::available_memory(value);\n@@ -147,2 +147,2 @@\n-julong os::Bsd::available_memory() {\n-  uint64_t available = physical_memory() >> 2;\n+bool os::Bsd::available_memory(size_t& value) {\n+  uint64_t available = static_cast<uint64_t>(physical_memory() >> 2);\n@@ -159,0 +159,2 @@\n+  } else {\n+    return false;\n@@ -161,1 +163,2 @@\n-  return available;\n+  value = static_cast<size_t>(available);\n+  return true;\n@@ -180,1 +183,1 @@\n-jlong os::total_swap_space() {\n+bool os::total_swap_space(size_t& value) {\n@@ -185,1 +188,1 @@\n-    return -1;\n+    return false;\n@@ -187,1 +190,2 @@\n-  return (jlong)vmusage.xsu_total;\n+  value = static_cast<size_t>(vmusage.xsu_total);\n+  return true;\n@@ -189,1 +193,1 @@\n-  return -1;\n+  return false;\n@@ -193,1 +197,1 @@\n-jlong os::free_swap_space() {\n+bool os::free_swap_space(size_t& value) {\n@@ -198,1 +202,1 @@\n-    return -1;\n+    return false;\n@@ -200,1 +204,2 @@\n-  return (jlong)vmusage.xsu_avail;\n+  value = static_cast<size_t>(vmusage.xsu_avail);\n+  return true;\n@@ -202,1 +207,1 @@\n-  return -1;\n+  return false;\n@@ -206,2 +211,3 @@\n-julong os::physical_memory() {\n-  return Bsd::physical_memory();\n+bool os::physical_memory(size_t& value) {\n+  value = Bsd::physical_memory();\n+  return true;\n@@ -284,1 +290,1 @@\n-    _physical_memory = mem_val;\n+    _physical_memory = static_cast<size_t>(mem_val);\n@@ -1468,5 +1474,13 @@\n-\n-  st->print(\", physical \" UINT64_FORMAT \"k\",\n-            os::physical_memory() >> 10);\n-  st->print(\"(\" UINT64_FORMAT \"k free)\",\n-            os::available_memory() >> 10);\n+  size_t phys_mem = 0;\n+  if (!os::physical_memory(phys_mem)) {\n+    log_debug(os, thread)(\"os::physical_memory() failed\");\n+  }\n+  st->print(\", physical %zuk\",\n+            phys_mem >> 10);\n+  size_t avail_mem = 0;\n+  if (!os::available_memory(avail_mem))\n+  {\n+    log_debug(os, thread)(\"os::available_memory() failed\");\n+  }\n+  st->print(\"(%zuk free)\",\n+            avail_mem >> 10);\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":38,"deletions":24,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-  static julong _physical_memory;\n+  static size_t _physical_memory;\n@@ -48,3 +48,3 @@\n-  static julong available_memory();\n-  static julong free_memory();\n-  static julong physical_memory() { return _physical_memory; }\n+  static bool available_memory(size_t& value);\n+  static bool free_memory(size_t& value);\n+  static size_t physical_memory() { return _physical_memory; }\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -672,2 +672,2 @@\n-  jlong phys_mem = os::Linux::physical_memory();\n-  log_trace(os, container)(\"total physical memory: \" JLONG_FORMAT, phys_mem);\n+  julong phys_mem = static_cast<julong>(os::Linux::physical_memory());\n+  log_trace(os, container)(\"total physical memory: \" JULONG_FORMAT, phys_mem);\n@@ -843,1 +843,1 @@\n-  julong phys_mem = os::Linux::physical_memory();\n+  julong phys_mem = static_cast<julong>(os::Linux::physical_memory());\n@@ -849,1 +849,1 @@\n-  julong phys_mem = os::Linux::physical_memory();\n+  julong phys_mem = static_cast<julong>(os::Linux::physical_memory());\n@@ -855,1 +855,1 @@\n-  julong phys_mem = os::Linux::physical_memory();\n+  julong phys_mem = static_cast<julong>(os::Linux::physical_memory());\n@@ -888,1 +888,1 @@\n-  julong phys_mem = os::Linux::physical_memory();\n+  julong phys_mem = static_cast<julong>(os::Linux::physical_memory());\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-  julong phys_mem = os::Linux::physical_memory();\n+  julong phys_mem = static_cast<julong>(os::Linux::physical_memory());\n","filename":"src\/hotspot\/os\/linux\/cgroupUtil_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -160,1 +160,1 @@\n-julong os::Linux::_physical_memory = 0;\n+size_t os::Linux::_physical_memory = 0;\n@@ -235,2 +235,2 @@\n-julong os::available_memory() {\n-  return Linux::available_memory();\n+bool os::available_memory(size_t& value) {\n+  return Linux::available_memory(value);\n@@ -239,1 +239,1 @@\n-julong os::Linux::available_memory() {\n+bool os::Linux::available_memory(size_t& value) {\n@@ -243,1 +243,2 @@\n-    return avail_mem;\n+    value = static_cast<size_t>(avail_mem);\n+    return true;\n@@ -258,1 +259,5 @@\n-    avail_mem = free_memory();\n+    size_t free_mem = 0;\n+    if (!free_memory(free_mem)) {\n+      return false;\n+    }\n+    avail_mem = static_cast<julong>(free_mem);\n@@ -261,1 +266,2 @@\n-  return avail_mem;\n+  value = static_cast<size_t>(avail_mem);\n+  return true;\n@@ -264,2 +270,2 @@\n-julong os::free_memory() {\n-  return Linux::free_memory();\n+bool os::free_memory(size_t& value) {\n+  return Linux::free_memory(value);\n@@ -268,1 +274,1 @@\n-julong os::Linux::free_memory() {\n+bool os::Linux::free_memory(size_t& value) {\n@@ -274,1 +280,2 @@\n-    return free_mem;\n+    value = static_cast<size_t>(free_mem);\n+    return true;\n@@ -277,1 +284,4 @@\n-  sysinfo(&si);\n+  int ret = sysinfo(&si);\n+  if (ret != 0) {\n+    return false;\n+  }\n@@ -280,1 +290,2 @@\n-  return free_mem;\n+  value = static_cast<size_t>(free_mem);\n+  return true;\n@@ -283,1 +294,1 @@\n-jlong os::total_swap_space() {\n+bool os::total_swap_space(size_t& value) {\n@@ -286,1 +297,2 @@\n-      return (jlong)(OSContainer::memory_and_swap_limit_in_bytes() - OSContainer::memory_limit_in_bytes());\n+      value = static_cast<size_t>(OSContainer::memory_and_swap_limit_in_bytes() - OSContainer::memory_limit_in_bytes());\n+      return true;\n@@ -292,1 +304,1 @@\n-    return -1;\n+    return false;\n@@ -294,1 +306,2 @@\n-  return  (jlong)(si.totalswap * si.mem_unit);\n+  value = static_cast<size_t>(si.totalswap * si.mem_unit);\n+  return true;\n@@ -297,1 +310,1 @@\n-static jlong host_free_swap() {\n+static bool host_free_swap_f(size_t& value) {\n@@ -301,1 +314,1 @@\n-    return -1;\n+    return false;\n@@ -303,1 +316,2 @@\n-  return (jlong)(si.freeswap * si.mem_unit);\n+  value = static_cast<size_t>(si.freeswap * si.mem_unit);\n+  return true;\n@@ -306,1 +320,1 @@\n-jlong os::free_swap_space() {\n+bool os::free_swap_space(size_t& value) {\n@@ -309,2 +323,9 @@\n-  jlong host_free_swap_val = MIN2(os::total_swap_space(), host_free_swap());\n-  assert(host_free_swap_val >= 0, \"sysinfo failed?\");\n+  size_t total_swap_space = 0;\n+  bool total_swap_space_ok = os::total_swap_space(total_swap_space);\n+  size_t host_free_swap = 0;\n+  bool host_free_swap_ok = host_free_swap_f(host_free_swap);\n+  if (!total_swap_space_ok || !host_free_swap_ok) {\n+    assert(false, \"sysinfo failed ? \");\n+    return false;\n+  }\n+  size_t host_free_swap_val = MIN2(total_swap_space, host_free_swap);\n@@ -317,1 +338,2 @@\n-        return 0;\n+        value = 0;\n+        return true;\n@@ -325,1 +347,2 @@\n-          return free_swap >= 0 ? free_swap : 0;\n+          value = free_swap >= 0 ? static_cast<size_t>(free_swap) : 0;\n+          return true;\n@@ -331,1 +354,1 @@\n-                            \" container_mem_limit=\" JLONG_FORMAT \" returning host value: \" JLONG_FORMAT,\n+                            \" container_mem_limit=\" JLONG_FORMAT \" returning host value: %zu\",\n@@ -334,1 +357,2 @@\n-  return host_free_swap_val;\n+  value = host_free_swap_val;\n+  return true;\n@@ -337,2 +361,1 @@\n-julong os::physical_memory() {\n-  jlong phys_mem = 0;\n+bool os::physical_memory(size_t& value) {\n@@ -343,1 +366,2 @@\n-      return mem_limit;\n+      value = static_cast<size_t>(mem_limit);\n+      return true;\n@@ -347,3 +371,4 @@\n-  phys_mem = Linux::physical_memory();\n-  log_trace(os)(\"total system memory: \" JLONG_FORMAT, phys_mem);\n-  return phys_mem;\n+  size_t phys_mem = Linux::physical_memory();\n+  log_trace(os)(\"total system memory: %zu\", phys_mem);\n+  value = phys_mem;\n+  return true;\n@@ -523,1 +548,1 @@\n-  _physical_memory = (julong)sysconf(_SC_PHYS_PAGES) * (julong)sysconf(_SC_PAGESIZE);\n+  _physical_memory = static_cast<size_t>(sysconf(_SC_PHYS_PAGES)) * static_cast<size_t>(sysconf(_SC_PAGESIZE));\n@@ -2547,5 +2572,12 @@\n-\n-  st->print(\", physical \" UINT64_FORMAT \"k\",\n-            os::physical_memory() >> 10);\n-  st->print(\"(\" UINT64_FORMAT \"k free)\",\n-            os::available_memory() >> 10);\n+  size_t phys_mem = 0;\n+  if (!os::physical_memory(phys_mem)) {\n+    log_debug(os)(\"os::physical_memory() failed\");\n+  }\n+  st->print(\", physical %zuk\",\n+            phys_mem >> 10);\n+  size_t avail_mem = 0;\n+  if (!os::available_memory(avail_mem)) {\n+    log_debug(os)(\"os::available_memory() failed\");\n+  }\n+  st->print(\"(%zuk free)\",\n+            avail_mem >> 10);\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":71,"deletions":39,"binary":false,"changes":110,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-  static julong _physical_memory;\n+  static size_t _physical_memory;\n@@ -56,2 +56,2 @@\n-  static julong available_memory();\n-  static julong free_memory();\n+  static bool available_memory(size_t& value);\n+  static bool free_memory(size_t& value);\n@@ -120,1 +120,1 @@\n-  static julong physical_memory() { return _physical_memory; }\n+  static size_t physical_memory() { return _physical_memory; }\n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -851,2 +851,2 @@\n-julong os::available_memory() {\n-  return win32::available_memory();\n+bool os::available_memory(size_t& value) {\n+  return win32::available_memory(value);\n@@ -855,2 +855,2 @@\n-julong os::free_memory() {\n-  return win32::available_memory();\n+bool os::free_memory(size_t& value) {\n+  return win32::available_memory(value);\n@@ -859,1 +859,1 @@\n-julong os::win32::available_memory() {\n+bool os::win32::available_memory(size_t& value) {\n@@ -864,3 +864,7 @@\n-  GlobalMemoryStatusEx(&ms);\n-\n-  return (julong)ms.ullAvailPhys;\n+  BOOL res = GlobalMemoryStatusEx(&ms);\n+  if (res) {\n+    value = static_cast<size_t>(ms.ullAvailPhys);\n+    return true;\n+  } else {\n+    return false;\n+  }\n@@ -869,1 +873,1 @@\n-jlong os::total_swap_space() {\n+bool os::total_swap_space(size_t& value) {\n@@ -872,2 +876,7 @@\n-  GlobalMemoryStatusEx(&ms);\n-  return (jlong) ms.ullTotalPageFile;\n+  BOOL res = GlobalMemoryStatusEx(&ms);\n+  if (res) {\n+    value = static_cast<size_t>(ms.ullTotalPageFile);\n+    return true;\n+  } else {\n+    return false;\n+  }\n@@ -876,1 +885,1 @@\n-jlong os::free_swap_space() {\n+bool os::free_swap_space(size_t& value) {\n@@ -879,2 +888,7 @@\n-  GlobalMemoryStatusEx(&ms);\n-  return (jlong) ms.ullAvailPageFile;\n+  BOOL res = GlobalMemoryStatusEx(&ms);\n+  if (res) {\n+    value = static_cast<size_t>(ms.ullAvailPageFile);\n+    return true;\n+  } else {\n+    return false;\n+  }\n@@ -883,2 +897,9 @@\n-julong os::physical_memory() {\n-  return win32::physical_memory();\n+bool os::physical_memory(size_t& value) {\n+  size_t phys_mem = win32::physical_memory();\n+  if (phys_mem == std::numeric_limits<size_t>::max())\n+  {\n+    \/\/ indication that GlobalMemoryStatusEx failed\n+    return false;\n+  }\n+  value = phys_mem;\n+  return true;\n@@ -3903,1 +3924,1 @@\n-julong os::win32::_physical_memory           = 0;\n+size_t os::win32::_physical_memory           = 0;\n@@ -4133,2 +4154,7 @@\n-  GlobalMemoryStatusEx(&ms);\n-  _physical_memory = ms.ullTotalPhys;\n+  BOOL res = GlobalMemoryStatusEx(&ms);\n+  if (!res) {\n+    \/\/ to indicate that GlobalMemoryStatusEx failed\n+    _physical_memory = std::numeric_limits<size_t>::max();\n+  } else {\n+    _physical_memory = static_cast<size_t>(ms.ullTotalPhys);\n+  }\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":45,"deletions":19,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-  static julong _physical_memory;\n+  static size_t _physical_memory;\n@@ -105,3 +105,3 @@\n-  static julong available_memory();\n-  static julong free_memory();\n-  static julong physical_memory() { return _physical_memory; }\n+  static bool available_memory(size_t& value);\n+  static bool free_memory(size_t& value);\n+  static size_t physical_memory() { return _physical_memory; }\n","filename":"src\/hotspot\/os\/windows\/os_windows.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1061,1 +1061,2 @@\n-  julong free_memory = os::free_memory();\n+  size_t free_memory = 0;\n+  os::free_memory(free_memory);\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -65,1 +65,6 @@\n-  julong memory = os::physical_memory();\n+  size_t phys_mem = 0;\n+  if (!os::physical_memory(phys_mem))\n+  {\n+    log_debug_p(gc, init)(\"os::physical_memory() failed\");\n+  }\n+  julong memory = static_cast<julong>(phys_mem);\n","filename":"src\/hotspot\/share\/gc\/shared\/gcInitLogger.cpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -33,2 +33,5 @@\n-\n-  log_info_p(gc, init)(\"Memory: \" JULONG_FORMAT \"M\", os::physical_memory() \/ M);\n+  size_t phys_mem = 0;\n+  if (!os::physical_memory(phys_mem)) {\n+    log_debug_p(gc, init)(\"os::physical_memory() failed\");\n+  }\n+  log_info_p(gc, init)(\"Memory: %zuM\", phys_mem \/ M);\n","filename":"src\/hotspot\/share\/gc\/z\/zLargePages.cpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -406,0 +406,1 @@\n+  size_t phys_mem = 0;\n@@ -411,1 +412,2 @@\n-  return os::physical_memory();\n+  os::physical_memory(phys_mem);\n+  return static_cast<jlong>(phys_mem);\n@@ -420,1 +422,3 @@\n-  return os::total_swap_space();\n+  size_t total_swap_space = 0;\n+  os::total_swap_space(total_swap_space);\n+  return static_cast<jlong>(total_swap_space);\n","filename":"src\/hotspot\/share\/jfr\/jni\/jfrJniMethod.cpp","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -531,1 +531,5 @@\n-  u8 totalPhysicalMemory = os::physical_memory();\n+  size_t phys_mem = 0;\n+  if (!os::physical_memory(phys_mem)) {\n+    log_debug(jfr, system)(\"os::physical_memory() failed\");\n+  }\n+  u8 totalPhysicalMemory = static_cast<u8>(phys_mem);\n@@ -534,1 +538,5 @@\n-  event.set_usedSize(totalPhysicalMemory - os::available_memory());\n+  size_t avail_mem = 0;\n+  if (!os::available_memory(avail_mem)) {\n+    log_debug(jfr, system)(\"os::available_memory() failed\");\n+  }\n+  event.set_usedSize(totalPhysicalMemory - static_cast<u8>(avail_mem));\n@@ -540,2 +548,10 @@\n-  event.set_totalSize(os::total_swap_space());\n-  event.set_freeSize(os::free_swap_space());\n+  size_t total_swap_space = 0;\n+  if (!os::total_swap_space(total_swap_space)) {\n+    log_debug(jfr, system)(\"os::total_swap_space() failed\");\n+  }\n+  event.set_totalSize(static_cast<s8>(total_swap_space));\n+  size_t free_swap_space = 0;\n+  if (!os::free_swap_space(free_swap_space)) {\n+    log_debug(jfr, system)(\"os::free_swap_space() failed\");\n+  }\n+  event.set_freeSize(static_cast<s8>(free_swap_space));\n","filename":"src\/hotspot\/share\/jfr\/periodic\/jfrPeriodic.cpp","additions":20,"deletions":4,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -1359,1 +1359,4 @@\n-\n+    size_t avail_mem = 0;\n+    if (!os::available_memory(avail_mem)) {\n+      log_debug(redefine, class, load)(\"os::available_memory() failed\");\n+    }\n@@ -1361,2 +1364,2 @@\n-      (\"loading name=%s kind=%d (avail_mem=\" UINT64_FORMAT \"K)\",\n-       the_class->external_name(), _class_load_kind, os::available_memory() >> 10);\n+      (\"loading name=%s kind=%d (avail_mem=%zuK)\",\n+       the_class->external_name(), _class_load_kind, avail_mem >> 10);\n@@ -1526,1 +1529,3 @@\n-\n+    if (!os::available_memory(avail_mem)) {\n+      log_debug(redefine, class, load)(\"os::available_memory() failed\");\n+    }\n@@ -1528,1 +1533,1 @@\n-      (\"loaded name=%s (avail_mem=\" UINT64_FORMAT \"K)\", the_class->external_name(), os::available_memory() >> 10);\n+      (\"loaded name=%s (avail_mem=%zuK)\", the_class->external_name(), avail_mem >> 10);\n@@ -4429,0 +4434,4 @@\n+    size_t avail_mem = 0;\n+    if (!os::available_memory(avail_mem)) {\n+      log_debug(redefine, class, load)(\"os::available_memory() failed\");\n+    }\n@@ -4430,2 +4439,2 @@\n-      (\"redefined name=%s, count=%d (avail_mem=\" UINT64_FORMAT \"K)\",\n-       the_class->external_name(), java_lang_Class::classRedefinedCount(the_class->java_mirror()), os::available_memory() >> 10);\n+      (\"redefined name=%s, count=%d (avail_mem=%zuK)\",\n+       the_class->external_name(), java_lang_Class::classRedefinedCount(the_class->java_mirror()), avail_mem >> 10);\n","filename":"src\/hotspot\/share\/prims\/jvmtiRedefineClasses.cpp","additions":16,"deletions":7,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2512,0 +2512,1 @@\n+  size_t phys_mem = 0;\n@@ -2513,1 +2514,2 @@\n-  return os::physical_memory();\n+  os::physical_memory(phys_mem);\n+  return static_cast<jlong>(phys_mem);\n@@ -2518,1 +2520,3 @@\n-  return os::available_memory();\n+  size_t avail_mem = 0;\n+  os::available_memory(avail_mem);\n+  return static_cast<jlong>(avail_mem);\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1492,1 +1492,1 @@\n-\n+  size_t physical_mem_val = 0;\n@@ -1505,1 +1505,5 @@\n-      phys_mem = os::physical_memory();\n+      if (!os::physical_memory(physical_mem_val)) {\n+        log_debug(os)(\"os::physical_memory() failed\");\n+      }\n+\n+      phys_mem = static_cast<julong>(physical_mem_val);\n@@ -1511,1 +1515,4 @@\n-    phys_mem = FLAG_IS_DEFAULT(MaxRAM) ? MIN2(os::physical_memory(), (julong)MaxRAM)\n+    if (!os::physical_memory(physical_mem_val)) {\n+      log_debug(os)(\"os::physical_memory() failed\");\n+    }\n+    phys_mem = FLAG_IS_DEFAULT(MaxRAM) ? MIN2(static_cast<julong>(physical_mem_val), (julong)MaxRAM)\n@@ -1633,1 +1640,3 @@\n-  julong total_memory = os::physical_memory();\n+  size_t phys_mem = 0;\n+  os::physical_memory(phys_mem);\n+  julong total_memory = static_cast<julong>(phys_mem);\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":13,"deletions":4,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -1186,1 +1186,5 @@\n-  size_t mem = physical_memory()\/G;\n+  size_t phys_mem = 0;\n+  if (!physical_memory(phys_mem)) {\n+    log_debug(os)(\"os::physical_memory() failed\");\n+  }\n+  size_t mem = phys_mem\/G;\n@@ -1188,1 +1192,1 @@\n-    mem = physical_memory()\/M;\n+    mem = phys_mem\/M;\n@@ -1943,1 +1947,4 @@\n-\n+  size_t phys_mem = 0;\n+  if (!os::physical_memory(phys_mem)) {\n+    log_debug(os)(\"os::physical_memory() failed\");\n+  }\n@@ -1946,1 +1953,1 @@\n-      (os::physical_memory() >= (server_memory - missing_memory))) {\n+      (phys_mem >= (server_memory - missing_memory))) {\n@@ -2205,1 +2212,1 @@\n-julong os::used_memory() {\n+bool os::used_memory(size_t& value) {\n@@ -2210,1 +2217,4 @@\n-      return mem_usage;\n+      value = static_cast<size_t>(mem_usage);\n+      return true;\n+    } else {\n+      return false;\n@@ -2214,1 +2224,6 @@\n-  return os::physical_memory() - os::available_memory();\n+  size_t avail_mem = 0;\n+  os::available_memory(avail_mem);\n+  size_t phys_mem = 0;\n+  os::physical_memory(phys_mem);\n+  value = phys_mem - avail_mem;\n+  return true;\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":22,"deletions":7,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -340,3 +340,3 @@\n-  static julong available_memory();\n-  static julong used_memory();\n-  static julong free_memory();\n+  static bool available_memory(size_t& value);\n+  static bool used_memory(size_t& value);\n+  static bool free_memory(size_t& value);\n@@ -344,2 +344,2 @@\n-  static jlong total_swap_space();\n-  static jlong free_swap_space();\n+  static bool total_swap_space(size_t& value);\n+  static bool free_swap_space(size_t& value);\n@@ -347,1 +347,4 @@\n-  static julong physical_memory();\n+  \/\/ This method can return false on Windows and AIX. On Linux and BSD the reported value is\n+  \/\/ obtained by a system call in initialize_system_info() after a proper check. If that check\n+  \/\/ fails, a fatal VM error is reported.\n+  static bool physical_memory(size_t& value);\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2615,1 +2615,5 @@\n-    julong max_threads = os::free_memory() \/ (20 * M);\n+    size_t free_memory = 0;\n+    if (!os::free_memory(free_memory)) {\n+      log_debug(heapdump)(\"os::free_memory() failed\");\n+    }\n+    julong max_threads = free_memory \/ (20 * M);\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -978,1 +978,5 @@\n-    return os::physical_memory();\n+    {\n+      size_t phys_mem = 0;\n+      os::physical_memory(phys_mem);\n+      return phys_mem;\n+    }\n","filename":"src\/hotspot\/share\/services\/management.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"}]}