{"files":[{"patch":"@@ -27,1 +27,0 @@\n-import java.io.ByteArrayInputStream;\n@@ -29,1 +28,0 @@\n-import java.io.InputStream;\n@@ -42,0 +40,2 @@\n+\n+import jdk.internal.jimage.BasicImageReader.ImageError.Reason;\n@@ -147,1 +147,2 @@\n-                throw new IOException(\"\\\"\" + name + \"\\\" is not an image file\");\n+                throw new ImageError(Reason.INVALID_JIMAGE,\n+                        \"\\\"\" + name + \"\\\" is not an image file\");\n@@ -150,1 +151,2 @@\n-            throw new IOException(\"\\\"\" + name + \"\\\" is not an image file\");\n+            throw new ImageError(Reason.INVALID_JIMAGE,\n+                    \"\\\"\" + name + \"\\\" is not an image file\");\n@@ -167,1 +169,2 @@\n-            throw new IOException(\"The image file \\\"\" + name + \"\\\" is corrupted\");\n+            throw new ImageError(Reason.CORRUPT_JIMAGE,\n+                    \"The image file \\\"\" + name + \"\\\" is corrupted\");\n@@ -194,1 +197,2 @@\n-            throw new IOException(\"\\\"\" + name + \"\\\" is not an image file\");\n+            throw new ImageError(Reason.INVALID_JIMAGE,\n+                    \"\\\"\" + name + \"\\\" is not an image file\");\n@@ -198,4 +202,5 @@\n-            result.getMinorVersion() != ImageHeader.MINOR_VERSION) {\n-            throw new IOException(\"The image file \\\"\" + name + \"\\\" is not \" +\n-                \"the correct version. Major: \" + result.getMajorVersion() +\n-                \". Minor: \" + result.getMinorVersion());\n+                result.getMinorVersion() != ImageHeader.MINOR_VERSION) {\n+            throw new ImageError(Reason.BAD_VERSION,\n+                    \"The image file \\\"\" + name + \"\\\" is not the correct version.\\n\"\n+                            + \"Major: \" + result.getMajorVersion()\n+                            + \". Minor: \" + result.getMinorVersion());\n@@ -460,3 +465,17 @@\n-    public InputStream getResourceStream(ImageLocation loc) {\n-        Objects.requireNonNull(loc);\n-        byte[] bytes = getResource(loc);\n+    \/**\n+     * Specialized {@link IOException} thrown during construction to provide a\n+     * semantic reason for failure and allow better user-facing error messages.\n+     *\/\n+    public final static class ImageError extends IOException {\n+        private static final long serialVersionUID = 6002259582237888214L;\n+\n+        public enum Reason {\n+            \/** The file being opened does not appear to be a jimage file. *\/\n+            INVALID_JIMAGE,\n+            \/** The jimage file being opened is corrupted. *\/\n+            CORRUPT_JIMAGE,\n+            \/** The jimage file being opened has the wrong version. *\/\n+            BAD_VERSION,\n+        }\n+\n+        private final Reason reason;\n@@ -464,1 +483,8 @@\n-        return new ByteArrayInputStream(bytes);\n+        public ImageError(Reason reason, String message) {\n+            super(message);\n+            this.reason = reason;\n+        }\n+\n+        public Reason getReason() {\n+            return reason;\n+        }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/BasicImageReader.java","additions":40,"deletions":14,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+import java.nio.file.Path;\n@@ -47,0 +48,1 @@\n+import jdk.internal.jimage.BasicImageReader.ImageError.Reason;\n@@ -438,0 +440,6 @@\n+                \/\/ Handle specific errors for which better advice can be given.\n+                if (ioe instanceof BasicImageReader.ImageError err\n+                        && err.getReason() == Reason.BAD_VERSION) {\n+                    throw TASK_HELPER.newBadArgs(\"err.bad.version\", file);\n+                }\n+                \/\/ Non-specific error during processing.\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jimage\/JImageTask.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-\\             by the --dir=<directory> (default='.') option.\\n\\\n+\\             by the --dir=<directory> (default=''.'') option.\\n\\\n@@ -41,1 +41,1 @@\n-\\  verify   - Reports on any .class entries that don't verify as classes.\\n\\\n+\\  verify   - Reports on any .class entries that don''t verify as classes.\\n\\\n@@ -47,1 +47,1 @@\n-\\             by the --dir=<directory> (default='.') option.\n+\\             by the --dir=<directory> (default=''.'') option.\n@@ -57,1 +57,1 @@\n-\\  verify   - Reports errors on any .class entries that don't verify as classes.\n+\\  verify   - Reports errors on any .class entries that don''t verify as classes.\n@@ -104,0 +104,2 @@\n+err.bad.version=Unable to open {0}: mismatched file and tool version\\n\\\n+Use ''<JAVA_HOME>\/bin\/jimage'' for the JDK associated with this jimage file.\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jimage\/resources\/jimage.properties","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"}]}