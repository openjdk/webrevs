{"files":[{"patch":"@@ -578,5 +578,11 @@\n-  \/\/ Record top_frame_sp, because the callee might modify it, if it's compiled.\n-  assert_different_registers(Z_R1, method);\n-  z_sgrk(Z_R1, Z_SP, Z_fp);\n-  z_srag(Z_R1, Z_R1, Interpreter::logStackElementSize);\n-  z_stg(Z_R1, _z_ijava_state_neg(top_frame_sp), Z_fp);\n+#ifdef ASSERT\n+  NearLabel ok;\n+  Register tmp = Z_R1;\n+  z_lg(tmp, Address(Z_fp, _z_ijava_state_neg(top_frame_sp)));\n+  z_slag(tmp, tmp, Interpreter::logStackElementSize);\n+  z_agr(tmp, Z_fp);\n+  z_cgr(tmp, Z_SP);\n+  z_bre(ok);\n+  stop(\"corrupted top_frame_sp\");\n+  bind(ok);\n+#endif\n@@ -1921,0 +1927,5 @@\n+  \/\/ Rtemp3 is free at this point, use it to store top_frame_sp\n+  z_sgrk(Rtemp3, Z_SP, Z_fp);\n+  z_srag(Rtemp3, Rtemp3, Interpreter::logStackElementSize);\n+  reg2mem_opt(Rtemp3, Address(Z_fp, _z_ijava_state_neg(top_frame_sp)));\n+\n","filename":"src\/hotspot\/cpu\/s390\/interp_masm_s390.cpp","additions":16,"deletions":5,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -1103,0 +1103,5 @@\n+\n+  __ z_lcgr(top_frame_size);  \/\/ negate\n+  __ z_srag(top_frame_size, top_frame_size, Interpreter::logStackElementSize);\n+  \/\/ Store relativized top_frame_sp\n+  __ z_stg(top_frame_size, _z_ijava_state_neg(top_frame_sp), fp);\n@@ -2071,0 +2076,8 @@\n+  {\n+    Register top_frame_sp = Z_R1_scratch; \/\/ anyway going to load it with correct value\n+    __ z_lg(top_frame_sp, Address(Z_fp, _z_ijava_state_neg(top_frame_sp)));\n+    __ z_slag(top_frame_sp, top_frame_sp, Interpreter::logStackElementSize);\n+    __ z_agr(top_frame_sp, Z_fp);\n+\n+    __ resize_frame_absolute(top_frame_sp, \/* temp = *\/ Z_R0, \/* load_fp = *\/ true);\n+  }\n@@ -2178,0 +2191,8 @@\n+  {\n+    Register top_frame_sp = Z_R1_scratch;\n+    __ z_lg(top_frame_sp, Address(Z_fp, _z_ijava_state_neg(top_frame_sp)));\n+    __ z_slag(top_frame_sp, top_frame_sp, Interpreter::logStackElementSize);\n+    __ z_agr(top_frame_sp, Z_fp);\n+\n+    __ resize_frame_absolute(top_frame_sp, \/* temp = *\/ Z_R0, \/* load_fp = *\/ true);\n+  }\n","filename":"src\/hotspot\/cpu\/s390\/templateInterpreterGenerator_s390.cpp","additions":21,"deletions":0,"binary":false,"changes":21,"status":"modified"}]}