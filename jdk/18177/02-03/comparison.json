{"files":[{"patch":"@@ -544,1 +544,9 @@\n-        this(CharBuffer.wrap(in, offset, len), mc);\n+        this(wrap(in, offset, len), mc);\n+    }\n+\n+    private static CharSequence wrap(char[] in, int offset, int len) {\n+        try {\n+            return CharBuffer.wrap(in, offset, len);\n+        } catch (IndexOutOfBoundsException ignored) {\n+            throw new NumberFormatException();\n+        }\n@@ -776,0 +784,1 @@\n+            int digit;\n@@ -780,1 +789,1 @@\n-                    if ((c == '0')) { \/\/ have zero\n+                    if (c == '0') { \/\/ have zero\n@@ -789,2 +798,1 @@\n-                    } else if ((c >= '1' && c <= '9')) { \/\/ have digit\n-                        int digit = c - '0';\n+                    } else if (c >= '1' && c <= '9') { \/\/ have digit\n@@ -793,1 +801,1 @@\n-                        rs = rs * 10 + digit;\n+                        rs = rs * 10 + c - '0';\n@@ -802,2 +810,4 @@\n-                    } else if (Character.isDigit(c)) { \/\/ slow path\n-                        int digit = Character.digit(c, 10);\n+                    } else if (c == 'e' || c == 'E') {\n+                        scl -= parseExp(val, offset, len);\n+                        break; \/\/ [saves a test]\n+                    } else if ((digit = Character.digit(c, 10)) != -1) { \/\/ slow path\n@@ -818,3 +828,0 @@\n-                    } else if (c == 'e' || c == 'E') {\n-                        scl -= parseExp(val, offset, len);\n-                        break; \/\/ [saves a test]\n@@ -849,1 +856,31 @@\n-                    if ((c >= '0' && c <= '9') || Character.isDigit(c)) {\n+                    if (c == '0') {\n+                        if (prec == 0) {\n+                            start = offset;\n+                            prec = 1;\n+                        } else if (idx != 0) {\n+                            ++idx;\n+                            ++prec;\n+                        } else\n+                            start = offset + 1;\n+                        if (dot)\n+                            ++scl;\n+                    } else if (c >= '1' && c <= '9') {\n+                        \/\/ First compact case, we need not to preserve the character\n+                        \/\/ and we can just compute the value in place.\n+                        if (prec != 1 || idx != 0)\n+                            ++prec; \/\/ prec unchanged if preceded by 0s\n+                        ++idx;\n+                        if (dot)\n+                            ++scl;\n+                    } else if (c == '.') {\n+                        \/\/ have dot\n+                        if (dot) \/\/ two dots\n+                            throw new NumberFormatException(\"Character array\"\n+                                + \" contains more than one decimal point.\");\n+                        dot = true;\n+                        if (idx == 0 && prec == 1)\n+                            start = offset;\n+                    } else if (c == 'e' || c == 'E') {\n+                        scl -= parseExp(val, offset, len);\n+                        break; \/\/ [saves a test]\n+                    } else if ((digit = Character.digit(c, 10)) != -1) {\n@@ -852,1 +889,1 @@\n-                        if (c == '0' || Character.digit(c, 10) == 0) {\n+                        if (digit == 0) {\n@@ -868,16 +905,3 @@\n-                    } else if (c == '.') {\n-                        \/\/ have dot\n-                        if (dot) \/\/ two dots\n-                            throw new NumberFormatException(\"Character array\"\n-                                + \" contains more than one decimal point.\");\n-                        dot = true;\n-                        if (idx == 0 && prec == 1)\n-                            start = offset;\n-                    } else {\n-                        \/\/ exponent expected\n-                        if ((c != 'e') && (c != 'E'))\n-                            throw new NumberFormatException(\"Character array\"\n-                                + \" is missing \\\"e\\\" notation exponential mark.\");\n-                        scl -= parseExp(val, offset, len);\n-                        break; \/\/ [saves a test]\n-                    }\n+                    } else\n+                        throw new NumberFormatException(\"Character array\"\n+                            + \" is missing \\\"e\\\" notation exponential mark.\");\n@@ -924,1 +948,1 @@\n-        } catch (StringIndexOutOfBoundsException e) {\n+        } catch (IndexOutOfBoundsException e) {\n","filename":"src\/java.base\/share\/classes\/java\/math\/BigDecimal.java","additions":53,"deletions":29,"binary":false,"changes":82,"status":"modified"}]}