{"files":[{"patch":"@@ -76,0 +76,2 @@\n+import jtreg.SkippedException;\n+\n@@ -87,22 +89,2 @@\n-    \/\/ Returns false if the COH archive already exists.\n-    private static boolean createCOHArchive(char coops, char coh,\n-                                         String archiveSuffix) throws Exception {\n-        Path archive= archivePath(archiveSuffix);\n-        if (Files.exists(archive)) {\n-            return false;\n-        }\n-\n-        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-                \"-XX:+UnlockExperimentalVMOptions\",\n-                \"-XX:\" + coh + \"UseCompactObjectHeaders\",\n-                \"-XX:\" + coops + \"UseCompressedOops\",\n-                \"-Xlog:cds\",\n-                \"-Xshare:dump\");\n-\n-        OutputAnalyzer output = new OutputAnalyzer(pb.start());\n-        output.shouldHaveExitValue(0)\n-              .shouldContain(archiveName(archiveSuffix));\n-        return true;\n-    }\n-\n-    private static void deleteArchive(String archiveSuffix) throws Exception {\n+    private static boolean isCOHArchiveAvailable(char coops, char coh,\n+                                                 String archiveSuffix) throws Exception {\n@@ -110,2 +92,1 @@\n-        Files.deleteIfExists(archive);\n-        System.out.println(\"Deleted archive: \" + archive.toString());\n+        return Files.exists(archive);\n@@ -122,1 +103,0 @@\n-        boolean needsCleanup = false;;\n@@ -133,1 +113,4 @@\n-                needsCleanup = createCOHArchive(coops, coh, archiveSuffix);\n+                if (!isCOHArchiveAvailable(coops, coh, archiveSuffix)) {\n+                    throw new SkippedException(\"Skipping test due to \" +\n+                                               archivePath(archiveSuffix).toString() + \" not available\");\n+                }\n@@ -143,1 +126,4 @@\n-                needsCleanup = createCOHArchive(coops, coh, archiveSuffix);\n+                if (!isCOHArchiveAvailable(coops, coh, archiveSuffix)) {\n+                    throw new SkippedException(\"Skipping test due to \" +\n+                                               archivePath(archiveSuffix).toString() + \" not available\");\n+                }\n@@ -160,5 +146,0 @@\n-\n-        if (needsCleanup) {\n-            deleteArchive(archiveSuffix);\n-        }\n-\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/TestDefaultArchiveLoading.java","additions":13,"deletions":32,"binary":false,"changes":45,"status":"modified"}]}