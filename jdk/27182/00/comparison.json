{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,0 @@\n-import java.awt.BorderLayout;\n@@ -35,0 +34,1 @@\n+import java.awt.EventQueue;\n@@ -42,0 +42,2 @@\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -46,0 +48,2 @@\n+    static Robot robot;\n+    static final CountDownLatch latch = new CountDownLatch(1);\n@@ -48,0 +52,1 @@\n+        robot = new Robot();\n@@ -49,5 +54,22 @@\n-            KeyStrokeTest test = new KeyStrokeTest();\n-            test.doTest();\n-        } finally {\n-            if (frame != null) {\n-                frame.dispose();\n+            EventQueue.invokeAndWait(() -> {\n+                KeyStrokeTest test = new KeyStrokeTest();\n+                test.initTest();\n+            });\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+            robot.keyPress(KeyEvent.VK_TAB);\n+            robot.keyRelease(KeyEvent.VK_TAB);\n+\n+            robot.delay(1000);\n+            robot.keyPress(KeyEvent.VK_SPACE);\n+            robot.keyRelease(KeyEvent.VK_SPACE);\n+\n+            robot.delay(1000);\n+            robot.keyPress(KeyEvent.VK_A);\n+            robot.keyRelease(KeyEvent.VK_A);\n+            try {\n+                latch.await(3, TimeUnit.SECONDS);\n+            } catch (InterruptedException e) {}\n+            if (!keyTyped) {\n+                throw new\n+                RuntimeException(\"First keystroke after JDialog is closed is lost\");\n@@ -55,0 +77,7 @@\n+            System.out.println(\"Test passed\");\n+        } finally {\n+            EventQueue.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n@@ -58,3 +87,2 @@\n-    private static void doTest() throws Exception {\n-        final Object monitor = new Object();\n-        frame = new Frame();\n+    private static void initTest() {\n+        frame = new Frame(\"KeyStrokeTest\");\n@@ -74,0 +102,1 @@\n+                    dialog.setLocationRelativeTo(null);\n@@ -84,4 +113,1 @@\n-\n-                    synchronized (monitor) {\n-                        monitor.notifyAll();\n-                    }\n+                    latch.countDown();\n@@ -92,0 +118,1 @@\n+        frame.setLocationRelativeTo(null);\n@@ -93,23 +120,0 @@\n-\n-        Robot robot = new Robot();\n-        robot.waitForIdle();\n-        robot.delay(1000);\n-        robot.keyPress(KeyEvent.VK_TAB);\n-        robot.keyRelease(KeyEvent.VK_TAB);\n-\n-        robot.delay(1000);\n-        robot.keyPress(KeyEvent.VK_SPACE);\n-        robot.keyRelease(KeyEvent.VK_SPACE);\n-\n-        robot.delay(1000);\n-        synchronized (monitor) {\n-            robot.keyPress(KeyEvent.VK_A);\n-            robot.keyRelease(KeyEvent.VK_A);\n-            monitor.wait(3000);\n-        }\n-\n-        if (!keyTyped) {\n-            throw new RuntimeException(\"TEST FAILED\");\n-        }\n-\n-        System.out.println(\"Test passed\");\n@@ -117,1 +121,0 @@\n-\n","filename":"test\/jdk\/java\/awt\/Focus\/KeyStrokeTest.java","additions":41,"deletions":38,"binary":false,"changes":79,"status":"modified"}]}