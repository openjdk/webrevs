{"files":[{"patch":"@@ -294,0 +294,4 @@\n+  ifneq ($$($1_HEADERS_FROM_SRC), false)\n+    $1_SRC_HEADER_FLAGS := $$(addprefix -I, $$(wildcard $$($1_SRC)))\n+  endif\n+\n","filename":"make\/common\/JdkNativeCompilation.gmk","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -29,1 +29,2 @@\n-################################################################################\n+JPACKAGE_OUTPUT_DIR := \\\n+    $(JDK_OUTPUTDIR)\/modules\/$(MODULE)\/jdk\/jpackage\/internal\/resources\n@@ -31,0 +32,6 @@\n+JPACKAGE_CFLAGS_windows := -DUNICODE -D_UNICODE\n+JPACKAGE_CXXFLAGS_windows := -EHsc $(JPACKAGE_CFLAGS_windows)\n+\n+################################################################################\n+## Build jpackageapplauncher\n+################################################################################\n@@ -33,4 +40,2 @@\n-  JPACKAGE_APPLAUNCHER_SRC := \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, applauncher)\n-  JPACKAGE_APPLAUNCHER_LINK_TYPE := C\n-  JPACKAGE_APPLAUNCHER_INCLUDE_FILES := %.c\n+  JPACKAGEAPPLAUNCHER_LINK_TYPE := C\n+  JPACKAGEAPPLAUNCHER_INCLUDE_FILES := %.c\n@@ -38,4 +43,1 @@\n-  JPACKAGE_APPLAUNCHER_SRC := \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, applauncher) \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, common)\n-  JPACKAGE_APPLAUNCHER_LINK_TYPE := C++\n+  JPACKAGEAPPLAUNCHER_LINK_TYPE := C++\n@@ -44,5 +46,0 @@\n-JPACKAGE_OUTPUT_DIR := $(JDK_OUTPUTDIR)\/modules\/$(MODULE)\/jdk\/jpackage\/internal\/resources\n-JPACKAGE_CXXFLAGS_windows := -EHsc -DUNICODE -D_UNICODE\n-JPACKAGE_CFLAGS_windows := -DUNICODE -D_UNICODE\n-JPACKAGE_APPLAUNCHER_INCLUDES := $(addprefix -I, $(JPACKAGE_APPLAUNCHER_SRC))\n-\n@@ -50,1 +47,1 @@\n-$(eval $(call SetupJdkExecutable, BUILD_JPACKAGE_APPLAUNCHEREXE, \\\n+$(eval $(call SetupJdkExecutable, BUILD_JPACKAGEAPPLAUNCHER, \\\n@@ -52,1 +49,1 @@\n-    LINK_TYPE := $(JPACKAGE_APPLAUNCHER_LINK_TYPE), \\\n+    LINK_TYPE := $(JPACKAGEAPPLAUNCHER_LINK_TYPE), \\\n@@ -55,2 +52,3 @@\n-    SRC := $(JPACKAGE_APPLAUNCHER_SRC), \\\n-    INCLUDE_FILES := $(JPACKAGE_APPLAUNCHER_INCLUDE_FILES), \\\n+    SRC := applauncher, \\\n+    EXTRA_SRC := common, \\\n+    INCLUDE_FILES := $(JPACKAGEAPPLAUNCHER_INCLUDE_FILES), \\\n@@ -62,2 +60,0 @@\n-    CXXFLAGS := $(JPACKAGE_APPLAUNCHER_INCLUDES), \\\n-    CFLAGS := $(JPACKAGE_APPLAUNCHER_INCLUDES), \\\n@@ -65,1 +61,0 @@\n-    CXXFLAGS_windows := -MT $(JPACKAGE_CXXFLAGS_windows), \\\n@@ -67,0 +62,1 @@\n+    CXXFLAGS_windows := -MT $(JPACKAGE_CXXFLAGS_windows), \\\n@@ -68,4 +64,5 @@\n-    LIBS_macosx := -framework Cocoa  -rpath @executable_path\/..\/Frameworks\/ -rpath @executable_path\/..\/PlugIns\/, \\\n-    LIBS_windows := user32.lib ole32.lib msi.lib shlwapi.lib \\\n-        Shell32.lib, \\\n-    LIBS_linux := -ldl, \\\n+    LDFLAGS_macosx := -rpath @executable_path\/..\/Frameworks\/ \\\n+        -rpath @executable_path\/..\/PlugIns\/, \\\n+    LIBS_macosx := -framework Cocoa, \\\n+    LIBS_windows := msi.lib ole32.lib shell32.lib shlwapi.lib user32.lib, \\\n+    LIBS_linux := $(LIBDL), \\\n@@ -76,4 +73,1 @@\n-JPACKAGE_TARGETS += $(BUILD_JPACKAGE_APPLAUNCHEREXE)\n-\n-\n-################################################################################\n+TARGETS += $(BUILD_JPACKAGEAPPLAUNCHER)\n@@ -82,0 +76,3 @@\n+  ##############################################################################\n+  ## Build libjpackageapplauncheraux\n+  ##############################################################################\n@@ -83,8 +80,1 @@\n-  JPACKAGE_LIBAPPLAUNCHER_SRC := \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, applauncher) \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, libapplauncher) \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, common)\n-\n-  JPACKAGE_LIBAPPLAUNCHER_INCLUDES := $(addprefix -I, $(JPACKAGE_LIBAPPLAUNCHER_SRC))\n-\n-  $(eval $(call SetupJdkLibrary, BUILD_JPACKAGE_LIBAPPLAUNCHER, \\\n+  $(eval $(call SetupJdkLibrary, BUILD_LIBJPACKAGEAPPLAUNCHERAUX, \\\n@@ -93,2 +83,6 @@\n-      SYMBOLS_DIR := $(SUPPORT_OUTPUTDIR)\/native\/$(MODULE)\/libjpackageapplauncheraux, \\\n-      SRC := $(JPACKAGE_LIBAPPLAUNCHER_SRC), \\\n+      SYMBOLS_DIR := \\\n+          $(SUPPORT_OUTPUTDIR)\/native\/$(MODULE)\/libjpackageapplauncheraux, \\\n+      SRC := libapplauncher, \\\n+      EXTRA_SRC := \\\n+          applauncher \\\n+          common, \\\n@@ -100,2 +94,0 @@\n-      CXXFLAGS := $(JPACKAGE_LIBAPPLAUNCHER_INCLUDES), \\\n-      CFLAGS := $(JPACKAGE_LIBAPPLAUNCHER_INCLUDES), \\\n@@ -103,1 +95,1 @@\n-      LIBS := -ldl, \\\n+      LIBS_linux := $(LIBDL), \\\n@@ -106,2 +98,1 @@\n-  JPACKAGE_TARGETS += $(BUILD_JPACKAGE_LIBAPPLAUNCHER)\n-\n+  TARGETS += $(BUILD_LIBJPACKAGEAPPLAUNCHERAUX)\n@@ -110,3 +101,0 @@\n-\n-################################################################################\n-\n@@ -114,0 +102,3 @@\n+  ##############################################################################\n+  ## Build libjpackage\n+  ##############################################################################\n@@ -115,1 +106,1 @@\n-  $(eval $(call SetupJdkLibrary, BUILD_LIB_JPACKAGE, \\\n+  $(eval $(call SetupJdkLibrary, BUILD_LIBJPACKAGE, \\\n@@ -118,1 +109,1 @@\n-      EXTRA_SRC := jdk.jpackage:common, \\\n+      EXTRA_SRC := common, \\\n@@ -121,2 +112,2 @@\n-      LIBS := advapi32.lib ole32.lib msi.lib user32.lib \\\n-          shlwapi.lib Shell32.lib, \\\n+      LIBS_windows := advapi32.lib msi.lib ole32.lib shell32.lib shlwapi.lib \\\n+          user32.lib, \\\n@@ -125,1 +116,1 @@\n-  JPACKAGE_TARGETS += $(BUILD_LIB_JPACKAGE)\n+  TARGETS += $(BUILD_LIBJPACKAGE)\n@@ -127,3 +118,3 @@\n-  JPACKAGE_WIXHELPER_SRC := \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, libwixhelper) \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, common)\n+  ##############################################################################\n+  ## Build libwixhelper\n+  ##############################################################################\n@@ -133,1 +124,1 @@\n-  $(eval $(call SetupJdkLibrary, BUILD_LIB_WIXHELPER, \\\n+  $(eval $(call SetupJdkLibrary, BUILD_LIBWIXHELPER, \\\n@@ -138,1 +129,1 @@\n-      SRC := $(JPACKAGE_WIXHELPER_SRC), \\\n+      EXTRA_SRC := common, \\\n@@ -140,1 +131,0 @@\n-      CXXFLAGS := $(addprefix -I, $(JPACKAGE_WIXHELPER_SRC)), \\\n@@ -143,2 +133,1 @@\n-      LIBS := ole32.lib msi.lib User32.lib shlwapi.lib \\\n-          Shell32.lib, \\\n+      LIBS_windows := msi.lib ole32.lib shell32.lib shlwapi.lib user32.lib, \\\n@@ -147,1 +136,1 @@\n-  JPACKAGE_TARGETS += $(BUILD_LIB_WIXHELPER)\n+  TARGETS += $(BUILD_LIBWIXHELPER)\n@@ -149,3 +138,3 @@\n-  JPACKAGE_MSIWRAPPER_SRC := \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, msiwrapper) \\\n-      $(call FindSrcDirsForComponent, jdk.jpackage, common)\n+  ##############################################################################\n+  ## Build msiwrapper\n+  ##############################################################################\n@@ -154,1 +143,1 @@\n-  $(eval $(call SetupJdkExecutable, BUILD_JPACKAGE_MSIWRAPPER, \\\n+  $(eval $(call SetupJdkExecutable, BUILD_MSIWRAPPER, \\\n@@ -158,1 +147,1 @@\n-      SRC := $(JPACKAGE_MSIWRAPPER_SRC), \\\n+      EXTRA_SRC := common, \\\n@@ -160,1 +149,0 @@\n-      CXXFLAGS := $(addprefix -I, $(JPACKAGE_MSIWRAPPER_SRC)), \\\n@@ -162,1 +150,1 @@\n-      LIBS := ole32.lib msi.lib user32.lib shlwapi.lib Shell32.lib, \\\n+      LIBS_windows := msi.lib ole32.lib shell32.lib shlwapi.lib user32.lib, \\\n@@ -165,1 +153,5 @@\n-  JPACKAGE_TARGETS += $(BUILD_JPACKAGE_MSIWRAPPER)\n+  TARGETS += $(BUILD_MSIWRAPPER)\n+\n+  ##############################################################################\n+  ## Build jpackageapplauncherw\n+  ##############################################################################\n@@ -168,1 +160,1 @@\n-  $(eval $(call SetupJdkExecutable, BUILD_JPACKAGE_APPLAUNCHERWEXE, \\\n+  $(eval $(call SetupJdkExecutable, BUILD_JPACKAGEAPPLAUNCHERW, \\\n@@ -170,1 +162,0 @@\n-      LINK_TYPE := $(BUILD_JPACKAGE_APPLAUNCHEREXE_LINK_TYPE), \\\n@@ -172,11 +163,13 @@\n-      SYMBOLS_DIR := $(SUPPORT_OUTPUTDIR)\/native\/$(MODULE)\/jpackageapplauncherw, \\\n-      SRC := $(BUILD_JPACKAGE_APPLAUNCHEREXE_SRC), \\\n-      OPTIMIZATION := $(BUILD_JPACKAGE_APPLAUNCHEREXE_OPTIMIZATION), \\\n-      CXXFLAGS := $(BUILD_JPACKAGE_APPLAUNCHEREXE_CXXFLAGS), \\\n-      CXXFLAGS_windows := $(BUILD_JPACKAGE_APPLAUNCHEREXE_CXXFLAGS_windows) -DJP_LAUNCHERW, \\\n-      CFLAGS := $(BUILD_JPACKAGE_APPLAUNCHEREXE_CFLAGS), \\\n-      CFLAGS_windows := $(BUILD_JPACKAGE_APPLAUNCHEREXE_CFLAGS_windows) -DJP_LAUNCHERW, \\\n-      LD_SET_ORIGIN := $(BUILD_JPACKAGE_APPLAUNCHEREXE_LD_SET_ORIGIN), \\\n-      LDFLAGS := $(BUILD_JPACKAGE_APPLAUNCHEREXE_LDFLAGS), \\\n-      LIBS := $(BUILD_JPACKAGE_APPLAUNCHEREXE_LIBS), \\\n-      LIBS_windows := $(BUILD_JPACKAGE_APPLAUNCHEREXE_LIBS_windows), \\\n+      SYMBOLS_DIR := \\\n+          $(SUPPORT_OUTPUTDIR)\/native\/$(MODULE)\/jpackageapplauncherw, \\\n+      SRC := applauncher, \\\n+      EXTRA_SRC := common, \\\n+      OPTIMIZATION := LOW, \\\n+      CFLAGS_FILTER_OUT := -MD, \\\n+      CXXFLAGS_FILTER_OUT := -MD, \\\n+      CFLAGS := -DJP_LAUNCHERW, \\\n+      CXXFLAGS := -DJP_LAUNCHERW, \\\n+      CFLAGS_windows := -MT $(JPACKAGE_CFLAGS_windows), \\\n+      CXXFLAGS_windows := -MT $(JPACKAGE_CXXFLAGS_windows), \\\n+      LD_SET_ORIGIN := false, \\\n+      LIBS_windows := msi.lib ole32.lib shell32.lib shlwapi.lib user32.lib, \\\n@@ -187,2 +180,1 @@\n-  JPACKAGE_TARGETS += $(BUILD_JPACKAGE_APPLAUNCHERWEXE)\n-\n+  TARGETS += $(BUILD_JPACKAGEAPPLAUNCHERW)\n@@ -190,5 +182,0 @@\n-\n-\n-TARGETS += $(JPACKAGE_TARGETS)\n-\n-$(JPACKAGE_TARGETS): $(call FindLib, java.base, java)\n","filename":"make\/modules\/jdk.jpackage\/Lib.gmk","additions":76,"deletions":89,"binary":false,"changes":165,"status":"modified"}]}