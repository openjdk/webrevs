{"files":[{"patch":"@@ -1116,1 +1116,1 @@\n-  ttyLocker ttyl;\n+  stringStream ss; \/\/ Print as a block without tty lock.\n@@ -1119,2 +1119,2 @@\n-    tty->print(\"igvn.worklist[%d] \", j);\n-    n->dump();\n+    ss.print(\"igvn.worklist[%d] \", j);\n+    n->dump(\"\\n\", false, &ss);\n@@ -1123,2 +1123,2 @@\n-    tty->print_cr(\"Previously optimized:\");\n-    node->dump();\n+    ss.print_cr(\"Previously optimized:\");\n+    node->dump(\"\\n\", false, &ss);\n@@ -1126,0 +1126,1 @@\n+  tty->print_cr(\"%s\", ss.as_string());\n@@ -1180,10 +1181,11 @@\n-  ttyLocker ttyl;\n-  tty->cr();\n-  tty->print_cr(\"Missed Value optimization:\");\n-  n->dump_bfs(1, nullptr, \"\");\n-  tty->print_cr(\"Current type:\");\n-  told->dump_on(tty);\n-  tty->cr();\n-  tty->print_cr(\"Optimized type:\");\n-  tnew->dump_on(tty);\n-  tty->cr();\n+  stringStream ss; \/\/ Print as a block without tty lock.\n+  ss.cr();\n+  ss.print_cr(\"Missed Value optimization:\");\n+  n->dump_bfs(1, nullptr, \"\", &ss);\n+  ss.print_cr(\"Current type:\");\n+  told->dump_on(&ss);\n+  ss.cr();\n+  ss.print_cr(\"Optimized type:\");\n+  tnew->dump_on(&ss);\n+  ss.cr();\n+  tty->print_cr(\"%s\", ss.as_string());\n@@ -1811,5 +1813,6 @@\n-      ttyLocker ttyl;\n-      tty->cr();\n-      tty->print_cr(\"Ideal optimization did not make progress but created new unused nodes.\");\n-      tty->print_cr(\"  old_unique = %d, unique = %d\", old_unique, C->unique());\n-      n->dump_bfs(1, nullptr, \"\");\n+      stringStream ss; \/\/ Print as a block without tty lock.\n+      ss.cr();\n+      ss.print_cr(\"Ideal optimization did not make progress but created new unused nodes.\");\n+      ss.print_cr(\"  old_unique = %d, unique = %d\", old_unique, C->unique());\n+      n->dump_bfs(1, nullptr, \"\", &ss);\n+      tty->print_cr(\"%s\", ss.as_string());\n@@ -1826,3 +1829,3 @@\n-  ttyLocker ttyl;\n-  tty->cr();\n-  tty->print_cr(\"Missed Ideal optimization (can_reshape=%s):\", can_reshape ? \"true\": \"false\");\n+  stringStream ss; \/\/ Print as a block without tty lock.\n+  ss.cr();\n+  ss.print_cr(\"Missed Ideal optimization (can_reshape=%s):\", can_reshape ? \"true\": \"false\");\n@@ -1830,1 +1833,1 @@\n-    tty->print_cr(\"The node was reshaped by Ideal.\");\n+    ss.print_cr(\"The node was reshaped by Ideal.\");\n@@ -1832,3 +1835,3 @@\n-    tty->print_cr(\"The node was replaced by Ideal.\");\n-    tty->print_cr(\"Old node:\");\n-    n->dump_bfs(1, nullptr, \"\");\n+    ss.print_cr(\"The node was replaced by Ideal.\");\n+    ss.print_cr(\"Old node:\");\n+    n->dump_bfs(1, nullptr, \"\", &ss);\n@@ -1836,2 +1839,3 @@\n-  tty->print_cr(\"The result after Ideal:\");\n-  i->dump_bfs(1, nullptr, \"\");\n+  ss.print_cr(\"The result after Ideal:\");\n+  i->dump_bfs(1, nullptr, \"\", &ss);\n+  tty->print_cr(\"%s\", ss.as_string());\n@@ -2022,7 +2026,8 @@\n-  ttyLocker ttyl;\n-  tty->cr();\n-  tty->print_cr(\"Missed Identity optimization:\");\n-  tty->print_cr(\"Old node:\");\n-  n->dump_bfs(1, nullptr, \"\");\n-  tty->print_cr(\"New node:\");\n-  i->dump_bfs(1, nullptr, \"\");\n+  stringStream ss; \/\/ Print as a block without tty lock.\n+  ss.cr();\n+  ss.print_cr(\"Missed Identity optimization:\");\n+  ss.print_cr(\"Old node:\");\n+  n->dump_bfs(1, nullptr, \"\", &ss);\n+  ss.print_cr(\"New node:\");\n+  i->dump_bfs(1, nullptr, \"\", &ss);\n+  tty->print_cr(\"%s\", ss.as_string());\n","filename":"src\/hotspot\/share\/opto\/phaseX.cpp","additions":41,"deletions":36,"binary":false,"changes":77,"status":"modified"}]}