{"files":[{"patch":"@@ -3606,5 +3606,3 @@\n-  \/\/ make sure klass is initialized & doesn't have finalizer\n-  \/\/ make sure klass is fully initialized\n-  __ ldrb(rscratch1, Address(r4, InstanceKlass::init_state_offset()));\n-  __ cmp(rscratch1, (u1)InstanceKlass::fully_initialized);\n-  __ br(Assembler::NE, slow_case);\n+  \/\/ make sure klass is initialized\n+  assert(VM_Version::supports_fast_class_init_checks(), \"Optimization requires support for fast class initialization checks\");\n+  __ clinit_barrier(r4, rscratch1, nullptr \/*L_fast_path*\/, &slow_case);\n","filename":"src\/hotspot\/cpu\/aarch64\/templateTable_aarch64.cpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -4051,4 +4051,9 @@\n-  \/\/ make sure klass is initialized & doesn't have finalizer\n-  \/\/ make sure klass is fully initialized\n-  __ cmpb(Address(rcx, InstanceKlass::init_state_offset()), InstanceKlass::fully_initialized);\n-  __ jcc(Assembler::notEqual, slow_case);\n+  \/\/ make sure klass is initialized\n+  if (VM_Version::supports_fast_class_init_checks()) {\n+    const Register thread = LP64_ONLY(r15_thread) NOT_LP64(noreg);\n+    assert(thread != noreg, \"x86_32 not supported\");\n+    __ clinit_barrier(rcx, thread, nullptr \/*L_fast_path*\/, &slow_case);\n+  } else {\n+    __ cmpb(Address(rcx, InstanceKlass::init_state_offset()), InstanceKlass::fully_initialized);\n+    __ jcc(Assembler::notEqual, slow_case);\n+  }\n@@ -4056,0 +4061,1 @@\n+  \/\/ make sure klass doesn't have finalizer\n","filename":"src\/hotspot\/cpu\/x86\/templateTable_x86.cpp","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"}]}