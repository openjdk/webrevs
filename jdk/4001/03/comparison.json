{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -301,3 +301,3 @@\n-     * Writes the given array of bytes to the <code>BLOB<\/code> value that\n-     * this <code>Blob<\/code> object represents, starting at position\n-     * <code>pos<\/code>, and returns the number of bytes written.\n+     * Writes the given array of bytes to the {@code BLOB} value that\n+     * this {@code Blob} object represents, starting at position\n+     * {@code pos}, and returns the number of bytes written.\n@@ -305,6 +305,6 @@\n-     * @param pos the position in the SQL <code>BLOB<\/code> value at which\n-     *     to start writing. The first position is <code>1<\/code>;\n-     *     must not be less than <code>1<\/code> nor greater than\n-     *     the length of this <code>SerialBlob<\/code> object.\n-     * @param bytes the array of bytes to be written to the <code>BLOB<\/code>\n-     *        value that this <code>Blob<\/code> object represents\n+     * @param pos the position in the SQL {@code BLOB} value at which\n+     *     to start writing. The first position is {@code 1};\n+     *     must not be less than {@code 1} nor greater than\n+     *     the length+1 of this {@code SerialBlob} object.\n+     * @param bytes the array of bytes to be written to the {@code BLOB}\n+     *        value that this {@code Blob} object represents\n@@ -313,2 +313,1 @@\n-     *     <code>BLOB<\/code> value; or if an invalid position is set; if an\n-     *     invalid offset value is set;\n+     *     {@code BLOB} value; or if an invalid position is set;\n@@ -316,1 +315,1 @@\n-     * @throws SQLException if there is an error accessing the <code>BLOB<\/code>\n+     * @throws SQLException if there is an error accessing the {@code BLOB}\n@@ -326,2 +325,2 @@\n-     * Writes all or part of the given <code>byte<\/code> array to the\n-     * <code>BLOB<\/code> value that this <code>Blob<\/code> object represents\n+     * Writes all or part of the given {@code byte} array to the\n+     * {@code BLOB} value that this {@code Blob} object represents\n@@ -329,2 +328,2 @@\n-     * Writing starts at position <code>pos<\/code> in the <code>BLOB<\/code>\n-     * value; <i>len<\/i> bytes from the given byte array are written.\n+     * Writing starts at position {@code pos} in the {@code BLOB}\n+     * value; {@code length} bytes from the given byte array are written.\n@@ -332,5 +331,5 @@\n-     * @param pos the position in the <code>BLOB<\/code> object at which\n-     *     to start writing. The first position is <code>1<\/code>;\n-     *     must not be less than <code>1<\/code> nor greater than\n-     *     the length of this <code>SerialBlob<\/code> object.\n-     * @param bytes the array of bytes to be written to the <code>BLOB<\/code>\n+     * @param pos the position in the {@code BLOB} object at which\n+     *     to start writing. The first position is {@code 1};\n+     *     must not be less than {@code 1} nor greater than\n+     *     the length+1 of this {@code SerialBlob} object.\n+     * @param bytes the array of bytes to be written to the {@code BLOB}\n@@ -338,4 +337,4 @@\n-     * @param offset the offset in the <code>byte<\/code> array at which\n-     *     to start reading the bytes. The first offset position is\n-     *     <code>0<\/code>; must not be less than <code>0<\/code> nor greater\n-     *     than the length of the <code>byte<\/code> array\n+     * @param offset the offset into the array {@code bytes} at which\n+     *     to start reading the bytes to be set. The first offset position is\n+     *     {@code 0}; must not be less than {@code 0} nor greater\n+     *     than the length of the array {@code bytes}\n@@ -343,1 +342,1 @@\n-     *     <code>BLOB<\/code> value from the array of bytes <i>bytes<\/i>.\n+     *     {@code BLOB} value from the array of bytes {@code bytes}\n@@ -347,4 +346,4 @@\n-     *     <code>BLOB<\/code> value; if an invalid position is set; if an\n-     *     invalid offset value is set; if number of bytes to be written\n-     *     is greater than the <code>SerialBlob<\/code> length; or the combined\n-     *     values of the length and offset is greater than the Blob buffer;\n+     *     {@code BLOB} value; if an invalid position is set; if an\n+     *     invalid offset value is set; or the combined values of the\n+     *     {@code length} and {@code offset} is greater than the length of\n+     *     {@code bytes};\n@@ -352,1 +351,1 @@\n-     * @throws SQLException if there is an error accessing the <code>BLOB<\/code>\n+     * @throws SQLException if there is an error accessing the {@code BLOB}\n@@ -364,2 +363,3 @@\n-        if (pos < 1 || pos > this.length()) {\n-            throw new SerialException(\"Invalid position in BLOB object set\");\n+        if (length < 0) {\n+            throw new SerialException(\"Invalid arguments: length cannot be \"\n+                    + \"negative\");\n@@ -368,2 +368,2 @@\n-        if ((long)(length) > origLen) {\n-            throw new SerialException(\"Buffer is not sufficient to hold the value\");\n+        if (pos < 1 || pos > len + 1) {\n+            throw new SerialException(\"Invalid position in BLOB object set\");\n@@ -372,1 +372,1 @@\n-        if ((length + offset) > bytes.length) {\n+        if (length > bytes.length - offset) {\n@@ -374,1 +374,6 @@\n-                    \"and length that is greater that the Blob buffer\");\n+                    \"and length that is greater than the length of bytes\");\n+        }\n+\n+        if (pos - 1 + length > Integer.MAX_VALUE) {\n+            throw new SerialException(\"Invalid length. Cannot have combined pos \" +\n+                    \"and length that is greater than Integer.MAX_VALUE\");\n@@ -377,1 +382,0 @@\n-        int i = 0;\n@@ -379,3 +383,5 @@\n-        while ( i < length || (offset + i +1) < (bytes.length-offset) ) {\n-            this.buf[(int)pos + i] = bytes[offset + i ];\n-            i++;\n+        if (pos + length > len) {\n+            len = pos + length;\n+            byte[] newbuf = new byte[(int)len];\n+            System.arraycopy(buf, 0, newbuf, 0, (int)pos);\n+            buf = newbuf;\n@@ -383,1 +389,2 @@\n-        return i;\n+        System.arraycopy(bytes, offset, buf, (int)pos, length);\n+        return length;\n","filename":"src\/java.sql.rowset\/share\/classes\/javax\/sql\/rowset\/serial\/SerialBlob.java","additions":50,"deletions":43,"binary":false,"changes":93,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -364,3 +364,3 @@\n-     * Writes the given Java <code>String<\/code> to the <code>CLOB<\/code>\n-     * value that this <code>SerialClob<\/code> object represents, at the position\n-     * <code>pos<\/code>.\n+     * Writes the given Java {@code String} to the {@code CLOB}\n+     * value that this {@code SerialClob} object represents, at the position\n+     * {@code pos}.\n@@ -368,6 +368,6 @@\n-     * @param pos the position at which to start writing to the <code>CLOB<\/code>\n-     *         value that this <code>SerialClob<\/code> object represents; the first\n-     *         position is <code>1<\/code>; must not be less than <code>1<\/code> nor\n-     *         greater than the length of this <code>SerialClob<\/code> object\n-     * @param str the string to be written to the <code>CLOB<\/code>\n-     *        value that this <code>SerialClob<\/code> object represents\n+     * @param pos the position at which to start writing to the {@code CLOB}\n+     *         value that this {@code SerialClob} object represents; the first\n+     *         position is {@code 1}; must not be less than {@code 1} nor\n+     *         greater than the length+1 of this {@code SerialClob} object\n+     * @param str the string to be written to the {@code CLOB}\n+     *        value that this {@code SerialClob} object represents\n@@ -376,4 +376,1 @@\n-     *     <code>CLOB<\/code> value; if an invalid position is set; if an\n-     *     invalid offset value is set; if number of bytes to be written\n-     *     is greater than the <code>SerialClob<\/code> length; or the combined\n-     *     values of the length and offset is greater than the Clob buffer;\n+     *     {@code CLOB} value; if an invalid position is set;\n@@ -387,3 +384,3 @@\n-     * Writes <code>len<\/code> characters of <code>str<\/code>, starting\n-     * at character <code>offset<\/code>, to the <code>CLOB<\/code> value\n-     * that this <code>Clob<\/code> represents.\n+     * Writes {@code len} characters of {@code str}, starting\n+     * at character {@code offset}, to the {@code CLOB} value\n+     * that this {@code Clob} represents.\n@@ -391,7 +388,7 @@\n-     * @param pos the position at which to start writing to the <code>CLOB<\/code>\n-     *         value that this <code>SerialClob<\/code> object represents; the first\n-     *         position is <code>1<\/code>; must not be less than <code>1<\/code> nor\n-     *         greater than the length of this <code>SerialClob<\/code> object\n-     * @param str the string to be written to the <code>CLOB<\/code>\n-     *        value that this <code>Clob<\/code> object represents\n-     * @param offset the offset into <code>str<\/code> to start reading\n+     * @param pos the position at which to start writing to the {@code CLOB}\n+     *         value that this {@code SerialClob} object represents; the first\n+     *         position is {@code 1}; must not be less than {@code 1} nor\n+     *         greater than the length+1 of this {@code SerialClob} object\n+     * @param str the string to be written to the {@code CLOB}\n+     *        value that this {@code Clob} object represents\n+     * @param offset the offset into {@code str} to start reading\n@@ -402,4 +399,4 @@\n-     *     <code>CLOB<\/code> value; if an invalid position is set; if an\n-     *     invalid offset value is set; if number of bytes to be written\n-     *     is greater than the <code>SerialClob<\/code> length; or the combined\n-     *     values of the length and offset is greater than the Clob buffer;\n+     *     {@code CLOB} value; if an invalid position is set; if an\n+     *     invalid offset value is set; or the combined values of the\n+     *     {@code length} and {@code offset} is greater than the length of\n+     *     {@code str};\n@@ -411,3 +408,0 @@\n-        String temp = str.substring(offset);\n-        char cPattern[] = temp.toCharArray();\n-\n@@ -415,1 +409,1 @@\n-            throw new SerialException(\"Invalid offset in byte array set\");\n+            throw new SerialException(\"Invalid offset in String object set\");\n@@ -418,2 +412,3 @@\n-        if (pos < 1 || pos > this.length()) {\n-            throw new SerialException(\"Invalid position in Clob object set\");\n+        if (length < 0) {\n+            throw new SerialException(\"Invalid arguments: length cannot be \"\n+                    + \"negative\");\n@@ -422,2 +417,2 @@\n-        if ((long)(length) > origLen) {\n-            throw new SerialException(\"Buffer is not sufficient to hold the value\");\n+        if (pos < 1 || pos > len + 1) {\n+            throw new SerialException(\"Invalid position in Clob object set\");\n@@ -426,2 +421,2 @@\n-        if ((length + offset) > str.length()) {\n-            \/\/ need check to ensure length + offset !> bytes.length\n+        if (length > str.length() - offset) {\n+            \/\/ need check to ensure length + offset !> str.length\n@@ -429,1 +424,6 @@\n-                \" and length that is greater that the Blob buffer\");\n+                \" and length that is greater than the length of str\");\n+        }\n+\n+        if (pos - 1 + length > Integer.MAX_VALUE) {\n+            throw new SerialException(\"Invalid length. Cannot have combined pos \" +\n+                    \"and length that is greater than Integer.MAX_VALUE\");\n@@ -432,1 +432,0 @@\n-        int i = 0;\n@@ -434,3 +433,5 @@\n-        while ( i < length || (offset + i +1) < (str.length() - offset ) ) {\n-            this.buf[(int)pos + i ] = cPattern[offset + i ];\n-            i++;\n+        if (pos + length > len) {\n+            len = pos + length;\n+            char[] newbuf = new char[(int)len];\n+            System.arraycopy(buf, 0, newbuf, 0, (int)pos);\n+            buf = newbuf;\n@@ -438,1 +439,5 @@\n-        return i;\n+\n+        String temp = str.substring(offset, offset + length);\n+        char cPattern[] = temp.toCharArray();\n+        System.arraycopy(cPattern, 0, buf, (int)pos, length);\n+        return length;\n","filename":"src\/java.sql.rowset\/share\/classes\/javax\/sql\/rowset\/serial\/SerialClob.java","additions":49,"deletions":44,"binary":false,"changes":93,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -399,0 +399,74 @@\n+\n+    \/*\n+     * Validate that setBytes will properly write a set of bytes to the\n+     * specified location in the SerialBlob and the correct count is returned\n+     * for bytes written (writePos - 1 + diff.length > sb.length() &&\n+     * writePos - 1 + bytesToWrite <= sb.length())\n+     *\/\n+    @Test\n+    public void test31() throws Exception {\n+        int writePos = 5;\n+        int bytesToWrite = 1;\n+        byte[] diff = new byte[]{7, 8, 9};\n+        byte[] expected = new byte[]{1, 2, 3, 4, 7};\n+        SerialBlob sb = new SerialBlob(bytes);\n+        int written = sb.setBytes(writePos, diff, 0, bytesToWrite);\n+        assertEquals(written, bytesToWrite);\n+        assertEquals(sb.getBytes(1, (int) sb.length()), expected);\n+    }\n+\n+    \/*\n+     * Validate that setBytes will properly write a set of bytes to the\n+     * specified location in the SerialBlob and the correct count is returned\n+     * for bytes written (writePos - 1 + bytesToWrite > sb.length())\n+     *\/\n+    @Test\n+    public void test32() throws Exception {\n+        int writePos = 5;\n+        int bytesToWrite = 2;\n+        byte[] diff = new byte[]{7, 8, 9, 0};\n+        byte[] expected = new byte[]{1, 2, 3, 4, 8, 9};\n+        SerialBlob sb = new SerialBlob(bytes);\n+        int written = sb.setBytes(writePos, diff, 1, bytesToWrite);\n+        assertEquals(written, bytesToWrite);\n+        assertEquals(sb.getBytes(1, (int) sb.length()), expected);\n+    }\n+\n+    \/*\n+     * Validate that setBytes will properly write a set of bytes to the\n+     * specified location in the SerialBlob and the correct count is returned\n+     * for bytes written (writePos == sb.length() + 1)\n+     *\/\n+    @Test\n+    public void test33() throws Exception {\n+        int writePos = 6;\n+        int bytesToWrite = 3;\n+        byte[] diff = new byte[]{7, 8, 9, 0};\n+        byte[] expected = new byte[]{1, 2, 3, 4, 5, 8, 9, 0};\n+        SerialBlob sb = new SerialBlob(bytes);\n+        int written = sb.setBytes(writePos, diff, 1, bytesToWrite);\n+        assertEquals(written, bytesToWrite);\n+        assertEquals(sb.getBytes(1, (int) sb.length()), expected);\n+    }\n+\n+    \/*\n+     * Validate a SerialException is thrown if length < 0 for setBytes\n+     *\/\n+    @Test(expectedExceptions = SerialException.class)\n+    public void test34() throws Exception {\n+        int length = -1;\n+        SerialBlob sb = new SerialBlob(bytes);\n+        int written = sb.setBytes(1, new byte[]{1}, 1, length);\n+    }\n+\n+    \/*\n+     * Validate a SerialException is thrown if length + offset >\n+     * Integer.MAX_VALUE for setBytes\n+     *\/\n+    @Test(expectedExceptions = SerialException.class)\n+    public void test35() throws Exception {\n+        int offset = 1;\n+        int length = Integer.MAX_VALUE;\n+        SerialBlob sb = new SerialBlob(bytes);\n+        int written = sb.setBytes(1, new byte[]{1, 2, 3}, offset, length);\n+    }\n","filename":"test\/jdk\/javax\/sql\/testng\/test\/rowset\/serial\/SerialBlobTests.java","additions":75,"deletions":1,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -410,1 +410,2 @@\n-     * SerialClob\n+     * SerialClob (writePos - 1 + val1.length() - offset > sc.length() &&\n+     * writePos - 1 + expectedWritten <= sc.length())\n@@ -412,1 +413,1 @@\n-    @Test(enabled = false)\n+    @Test\n@@ -414,0 +415,2 @@\n+        int writePos = 10;\n+        int offset = 7;\n@@ -417,1 +420,1 @@\n-        String expected = \"Hi, I am the Joker!\";\n+        String expected = \"Hi, I am the Joker!!!!!\";\n@@ -419,1 +422,1 @@\n-        int written = sc.setString(10, val1, 8, expectedWritten+1);\n+        int written = sc.setString(writePos, val1, offset, expectedWritten);\n@@ -421,1 +424,1 @@\n-\n+        assertEquals(sc.getSubString(1, (int) sc.length()), expected);\n@@ -499,0 +502,70 @@\n+\n+    \/*\n+     * Check calling setString() with offset > val1.length() throws a\n+     * SerialException\n+     *\/\n+    @Test(expectedExceptions = SerialException.class)\n+    public void test39() throws Exception {\n+        String val1 = \"hello\";\n+        int offset = val1.length() + 1;\n+        SerialClob sc = new SerialClob(chars);\n+        sc.setString(1, val1, offset, 0);\n+    }\n+\n+    \/*\n+     * Check that setString() updates the appropriate characters in the\n+     * SerialClob (writePos - 1 + expectedWritten > sc.length())\n+     *\/\n+    @Test\n+    public void test40() throws Exception {\n+        int writePos = 13;\n+        int offset = 7;\n+        int expectedWritten = 24;\n+        String val = \"Hello, I am Bruce Wayne\";\n+        String val1 = \"Hahaha the Joker, who are you?!\";\n+        String expected = \"Hello, I am the Joker, who are you?!\";\n+        SerialClob sc = new SerialClob(val.toCharArray());\n+        int written = sc.setString(writePos, val1, offset, expectedWritten);\n+        assertEquals(written, expectedWritten);\n+        assertEquals(sc.getSubString(1, (int) sc.length()), expected);\n+    }\n+\n+    \/*\n+     * Check that setString() updates the appropriate characters in the\n+     * SerialClob (writePos == sc.length() + 1)\n+     *\/\n+    @Test\n+    public void test41() throws Exception {\n+        int writePos = 10;\n+        int offset = 7;\n+        int expectedWritten = 10;\n+        String val = \"Hi, I am \";\n+        String val1 = \"Hahaha the Joker!\";\n+        String expected = \"Hi, I am the Joker!\";\n+        SerialClob sc = new SerialClob(val.toCharArray());\n+        int written = sc.setString(writePos, val1, offset, expectedWritten);\n+        assertEquals(written, expectedWritten);\n+        assertEquals(sc.getSubString(1, (int) sc.length()), expected);\n+    }\n+\n+    \/*\n+     * Validate a SerialException is thrown if length < 0 for setString\n+     *\/\n+    @Test(expectedExceptions = SerialException.class)\n+    public void test42() throws Exception {\n+        int length = -1;\n+        SerialClob sc = new SerialClob(chars);\n+        int written = sc.setString(1, \"hello\", 1, length);\n+    }\n+\n+    \/*\n+     * Validate a SerialException is thrown if length + offset >\n+     * Integer.MAX_VALUE for setString\n+     *\/\n+    @Test(expectedExceptions = SerialException.class)\n+    public void test43() throws Exception {\n+        int offset = 1;\n+        int length = Integer.MAX_VALUE;\n+        SerialClob sc = new SerialClob(chars);\n+        int written = sc.setString(1, \"hello\", offset, length);\n+    }\n","filename":"test\/jdk\/javax\/sql\/testng\/test\/rowset\/serial\/SerialClobTests.java","additions":79,"deletions":6,"binary":false,"changes":85,"status":"modified"}]}