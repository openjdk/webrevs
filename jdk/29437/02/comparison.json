{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,0 +62,1 @@\n+import sun.swing.SwingAccessor;\n@@ -236,0 +237,1 @@\n+    private static final LAFState LAF_STATE = new LAFState();\n@@ -237,1 +239,1 @@\n-     * Return the <code>LAFState<\/code> object, lazily create one if necessary.\n+     * Return the <code>LAFState<\/code> object.\n@@ -245,12 +247,2 @@\n-        LAFState rv = (LAFState)SwingUtilities.appContextGet(\n-                SwingUtilities2.LAF_STATE_KEY);\n-        if (rv == null) {\n-            synchronized (classLock) {\n-                rv = (LAFState)SwingUtilities.appContextGet(\n-                        SwingUtilities2.LAF_STATE_KEY);\n-                if (rv == null) {\n-                    SwingUtilities.appContextPut(\n-                            SwingUtilities2.LAF_STATE_KEY,\n-                            (rv = new LAFState()));\n-                }\n-            }\n+        synchronized (classLock) {\n+            return LAF_STATE;\n@@ -258,1 +250,0 @@\n-        return rv;\n@@ -261,0 +252,7 @@\n+    static {\n+        SwingAccessor.setLAFStateAccessor(UIManager::isLafStateInitialized);\n+    }\n+\n+    private static boolean isLafStateInitialized() {\n+        return LAF_STATE.initialized;\n+    }\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/UIManager.java","additions":13,"deletions":15,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n-import sun.awt.AppContext;\n+import sun.swing.SwingAccessor;\n@@ -156,2 +156,1 @@\n-            if (AppContext.getAppContext().get(\n-                    SwingUtilities2.LAF_STATE_KEY) != null) {\n+            if (SwingAccessor.getLAFStateAccessor().lafStateIsInitialized()) {\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/metal\/DefaultMetalTheme.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -136,0 +136,27 @@\n+    \/**\n+     * An accessor for the LAFState class state.\n+     *\/\n+    public interface LAFStateAccessor {\n+        boolean lafStateIsInitialized();\n+    }\n+\n+    private static LAFStateAccessor lafStateAccessor;\n+    \/**\n+     * Set an accessor object for the LAFState class.\n+     *\/\n+    public static void setLAFStateAccessor(LAFStateAccessor accessor) {\n+        lafStateAccessor = accessor;\n+    }\n+\n+    \/**\n+     * Retrieve the accessor object for the LAFState class.\n+     *\/\n+    public static LAFStateAccessor getLAFStateAccessor() {\n+        var access = lafStateAccessor;\n+        if (access == null) {\n+            ensureClassInitialized(UIManager.class);\n+            access = lafStateAccessor;\n+        }\n+        return access;\n+    }\n+\n","filename":"src\/java.desktop\/share\/classes\/sun\/swing\/SwingAccessor.java","additions":28,"deletions":1,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -123,6 +123,0 @@\n-    \/**\n-     * The {@code AppContext} key for our one {@code LAFState}\n-     * instance.\n-     *\/\n-    public static final Object LAF_STATE_KEY =\n-            new StringBuffer(\"LookAndFeel State\");\n","filename":"src\/java.desktop\/share\/classes\/sun\/swing\/SwingUtilities2.java","additions":1,"deletions":7,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1,60 +0,0 @@\n-\/*\n- * Copyright (c) 2009, 2015, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @bug 6657026\n- * @summary Tests shared UIManager in different application contexts\n- * @author Sergey Malenkov\n- * @modules java.desktop\/sun.awt\n- *\/\n-\n-import sun.awt.SunToolkit;\n-\n-import javax.swing.UIManager;\n-import javax.swing.UIManager.LookAndFeelInfo;\n-\n-public class Test6657026 implements Runnable {\n-\n-    public static void main(String[] args) throws Exception {\n-        if (UIManager.getInstalledLookAndFeels().length == 0) {\n-            throw new Error(\"unexpected amount of look&feels\");\n-        }\n-        UIManager.setInstalledLookAndFeels(new LookAndFeelInfo[0]);\n-        if (UIManager.getInstalledLookAndFeels().length != 0) {\n-            throw new Error(\"unexpected amount of look&feels\");\n-        }\n-\n-        ThreadGroup group = new ThreadGroup(\"$$$\");\n-        Thread thread = new Thread(group, new Test6657026());\n-        thread.start();\n-        thread.join();\n-    }\n-\n-    public void run() {\n-        SunToolkit.createNewAppContext();\n-        if (UIManager.getInstalledLookAndFeels().length == 0) {\n-            throw new Error(\"shared look&feels\");\n-        }\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/UIManager\/Test6657026.java","additions":0,"deletions":60,"binary":false,"changes":60,"status":"deleted"},{"patch":"@@ -1,112 +0,0 @@\n-\/*\n- * Copyright (c) 2005, 2018, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-import java.awt.Graphics;\n-import java.awt.image.BufferedImage;\n-import java.util.concurrent.CyclicBarrier;\n-\n-import javax.swing.JButton;\n-import javax.swing.SwingUtilities;\n-import javax.swing.UIManager;\n-import javax.swing.UnsupportedLookAndFeelException;\n-\n-import sun.awt.AppContext;\n-import sun.awt.SunToolkit;\n-\n-import static javax.swing.UIManager.getInstalledLookAndFeels;\n-\n-\/**\n- * @test\n- * @bug 6190373\n- * @summary Tests 6190373\n- * @author Scott Violet\n- * @modules java.desktop\/sun.awt\n- *\/\n-public final class bug6190373 {\n-\n-    private static AppContext app1;\n-    private static AppContext app2;\n-    private static final int LOOP_COUNT = 10000;\n-    private static final CyclicBarrier barrier = new CyclicBarrier(2);\n-\n-    public static void main(final String[] args) throws Exception {\n-        final Thread t1 = new Thread(new ThreadGroup(\"firstGroup\"), () -> {\n-            app1 = SunToolkit.createNewAppContext();\n-            test(true);\n-        });\n-        final Thread t2 = new Thread(new ThreadGroup(\"secondGroup\"), () -> {\n-            app2 = SunToolkit.createNewAppContext();\n-            test(false);\n-        });\n-\n-        t1.start();\n-        t2.start();\n-        t1.join();\n-        t2.join();\n-        app1.dispose();\n-        app2.dispose();\n-    }\n-\n-    private static void test(final boolean lock) {\n-        for (final UIManager.LookAndFeelInfo laf : getInstalledLookAndFeels()) {\n-            try {\n-                SwingUtilities.invokeAndWait(() -> setLookAndFeel(laf));\n-                barrier.await();\n-                SwingUtilities.invokeAndWait(() -> slam(lock));\n-                barrier.await();\n-            } catch (final Exception e) {\n-                throw new RuntimeException(e);\n-            }\n-        }\n-    }\n-\n-    private static void slam(final boolean lock) {\n-        JButton button = new JButton(\"HI\");\n-        button.setSize(100, 100);\n-        BufferedImage image = new BufferedImage(100, 100,\n-                                                BufferedImage.TYPE_INT_RGB);\n-        for (int i = 0; i < LOOP_COUNT; i++) {\n-            Graphics g = image.getGraphics();\n-            if (lock) {\n-                synchronized (button.getTreeLock()) {\n-                    button.paint(g);\n-                }\n-            } else {\n-                button.paint(g);\n-            }\n-            g.dispose();\n-        }\n-    }\n-\n-    private static void setLookAndFeel(final UIManager.LookAndFeelInfo laf) {\n-        try {\n-            UIManager.setLookAndFeel(laf.getClassName());\n-            System.out.println(\"LookAndFeel: \" + laf.getClassName());\n-        } catch (final UnsupportedLookAndFeelException ignored){\n-            System.out.println(\"Unsupported LookAndFeel: \" + laf.getClassName());\n-        } catch (ClassNotFoundException | InstantiationException |\n-                IllegalAccessException e) {\n-            throw new RuntimeException(e);\n-        }\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/plaf\/metal\/MetalUtils\/bug6190373.java","additions":0,"deletions":112,"binary":false,"changes":112,"status":"deleted"}]}