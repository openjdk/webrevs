{"files":[{"patch":"@@ -64,4 +64,0 @@\n-oop Klass::java_mirror_no_keepalive() const {\n-  return _java_mirror.peek();\n-}\n-\n","filename":"src\/hotspot\/share\/oops\/klass.cpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -59,0 +59,4 @@\n+inline oop Klass::java_mirror_no_keepalive() const {\n+  return _java_mirror.peek();\n+}\n+\n","filename":"src\/hotspot\/share\/oops\/klass.inline.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -781,2 +781,2 @@\n-  static oop mask_dormant_archived_object(oop o) {\n-    if (o != nullptr && o->klass()->java_mirror() == nullptr) {\n+  static oop mask_dormant_archived_object(oop o, oop ref_obj) {\n+    if (o != nullptr && o->klass()->java_mirror_no_keepalive() == nullptr) {\n@@ -785,0 +785,1 @@\n+      report_dormant_archived_object(o, ref_obj);\n@@ -790,0 +791,14 @@\n+\n+  static void report_dormant_archived_object(oop o, oop ref_obj) {\n+    if (log_is_enabled(Debug, cds, heap)) {\n+      ResourceMark rm;\n+      if (ref_obj != nullptr) {\n+        log_debug(cds, heap)(\"skipped dormant archived object \" INTPTR_FORMAT \" (%s) referenced by \" INTPTR_FORMAT \" (%s)\",\n+                  p2i(o), o->klass()->external_name(),\n+                  p2i(ref_obj), ref_obj->klass()->external_name());\n+      } else {\n+        log_debug(cds, heap)(\"skipped dormant archived object \" INTPTR_FORMAT \" (%s)\",\n+                  p2i(o), o->klass()->external_name());\n+      }\n+    }\n+  }\n@@ -977,7 +992,1 @@\n-      if (o != nullptr && log_is_enabled(Debug, cds, heap) && mask_dormant_archived_object(o) == nullptr) {\n-        ResourceMark rm;\n-        log_debug(cds, heap)(\"skipped dormant archived object \" INTPTR_FORMAT \" (%s) referenced by \" INTPTR_FORMAT \" (%s)\",\n-                             p2i(o), o->klass()->external_name(),\n-                             p2i(obj), obj->klass()->external_name());\n-      }\n-      o = mask_dormant_archived_object(o);\n+      o = mask_dormant_archived_object(o, obj);\n@@ -1315,7 +1324,1 @@\n-    if (o != nullptr && log_is_enabled(Debug, cds, heap) && mask_dormant_archived_object(o) == nullptr) {\n-      ResourceMark rm;\n-      log_debug(cds, heap)(\"skipped dormant archived object \" INTPTR_FORMAT \" (%s) referenced by \" INTPTR_FORMAT \" (%s)\",\n-                           p2i(o), o->klass()->external_name(),\n-                           p2i(array), array->klass()->external_name());\n-    }\n-    o = mask_dormant_archived_object(o);\n+    o = mask_dormant_archived_object(o, array);\n@@ -1888,2 +1891,1 @@\n-  if (DumperSupport::mask_dormant_archived_object(o) == nullptr) {\n-    log_debug(cds, heap)(\"skipped dormant archived object \" INTPTR_FORMAT \" (%s)\", p2i(o), o->klass()->external_name());\n+  if (DumperSupport::mask_dormant_archived_object(o, nullptr) == nullptr) {\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":20,"deletions":18,"binary":false,"changes":38,"status":"modified"}]}