{"files":[{"patch":"@@ -3806,4 +3806,4 @@\n-const InstanceKlass* ClassFileParser::parse_super_class(ConstantPool* const cp,\n-                                                        const int super_class_index,\n-                                                        const bool need_verify,\n-                                                        TRAPS) {\n+void ClassFileParser::check_super_class(ConstantPool* const cp,\n+                                        const int super_class_index,\n+                                        const bool need_verify,\n+                                        TRAPS) {\n@@ -3811,1 +3811,0 @@\n-  const Klass* super_klass = nullptr;\n@@ -3817,1 +3816,1 @@\n-                       CHECK_NULL);\n+                       CHECK);\n@@ -3822,1 +3821,5 @@\n-                       CHECK_NULL);\n+                       CHECK);\n+\n+    \/\/ Ioi note: remove this in final commit.\n+    assert(!cp->tag_at(super_class_index).is_klass(), \"should not have been resolved\");\n+\n@@ -3825,8 +3828,0 @@\n-    bool is_array = false;\n-    if (cp->tag_at(super_class_index).is_klass()) {\n-      super_klass = cp->resolved_klass_at(super_class_index);\n-      if (need_verify)\n-        is_array = super_klass->is_array_klass();\n-    } else if (need_verify) {\n-      is_array = (cp->klass_name_at(super_class_index)->char_at(0) == JVM_SIGNATURE_ARRAY);\n-    }\n@@ -3834,2 +3829,2 @@\n-      guarantee_property(!is_array,\n-                        \"Bad superclass name in class file %s\", CHECK_NULL);\n+      guarantee_property(cp->klass_name_at(super_class_index)->char_at(0) != JVM_SIGNATURE_ARRAY,\n+                        \"Bad superclass name in class file %s\", CHECK);\n@@ -3838,1 +3833,0 @@\n-  return super_klass == nullptr ? nullptr : InstanceKlass::cast(super_klass);\n@@ -5670,4 +5664,4 @@\n-  _super_klass = parse_super_class(cp,\n-                                   _super_class_index,\n-                                   _need_verify,\n-                                   CHECK);\n+  check_super_class(cp,\n+                    _super_class_index,\n+                    _need_verify,\n+                    CHECK);\n@@ -5780,2 +5774,2 @@\n-  \/\/ We check super class after class file is parsed and format is checked\n-  if (_super_class_index > 0 && nullptr == _super_klass) {\n+  \/\/ Set _super_klass after class file is parsed and format is checked\n+  if (_super_class_index > 0) {\n@@ -5792,0 +5786,1 @@\n+      \/\/ fast path to avoid lookup\n@@ -5801,0 +5796,3 @@\n+  } else {\n+    assert(_class_name == vmSymbols::java_lang_Object(), \"already checked\");\n+    _super_klass = nullptr;\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":22,"deletions":24,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -245,4 +245,4 @@\n-  const InstanceKlass* parse_super_class(ConstantPool* const cp,\n-                                         const int super_class_index,\n-                                         const bool need_verify,\n-                                         TRAPS);\n+  void check_super_class(ConstantPool* const cp,\n+                         const int super_class_index,\n+                         const bool need_verify,\n+                         TRAPS);\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}