{"files":[{"patch":"@@ -47,0 +47,2 @@\n+import sun.java2d.Disposer;\n+import sun.java2d.DisposerRecord;\n@@ -127,0 +129,2 @@\n+        disposerRecord = new ContextDisposerRecord(context);\n+        Disposer.addRecord(this, disposerRecord);\n@@ -135,8 +139,16 @@\n-    @Override\n-    @SuppressWarnings(\"removal\")\n-    protected void finalize() throws Throwable\n-    {\n-        \/\/ Release the resources used by the native input context.\n-        if (context!=0) {\n-            destroyNativeContext(context);\n-            context=0;\n+    private final ContextDisposerRecord disposerRecord;\n+\n+    private static final class ContextDisposerRecord implements DisposerRecord {\n+\n+        private final int context;\n+        private volatile boolean disposed;\n+\n+        ContextDisposerRecord(int c) {\n+            context = c;\n+        }\n+\n+        public synchronized void dispose() {\n+            if (!disposed) {\n+                destroyNativeContext(context);\n+            }\n+            disposed = true;\n@@ -144,1 +156,0 @@\n-        super.finalize();\n@@ -154,3 +165,1 @@\n-        \/\/ Due to a memory management problem in Windows 98, we should retain\n-        \/\/ the native input context until this object is finalized. So do\n-        \/\/ nothing here.\n+        disposerRecord.dispose();\n@@ -661,2 +670,2 @@\n-    private native int createNativeContext();\n-    private native void destroyNativeContext(int context);\n+    private static native int createNativeContext();\n+    private static native void destroyNativeContext(int context);\n","filename":"src\/java.desktop\/windows\/classes\/sun\/awt\/windows\/WInputMethod.java","additions":23,"deletions":14,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -55,1 +55,1 @@\n-Java_sun_awt_windows_WInputMethod_createNativeContext(JNIEnv *env, jobject self)\n+Java_sun_awt_windows_WInputMethod_createNativeContext(JNIEnv *env, jclass cls)\n@@ -72,1 +72,1 @@\n-Java_sun_awt_windows_WInputMethod_destroyNativeContext(JNIEnv *env, jobject self, jint context)\n+Java_sun_awt_windows_WInputMethod_destroyNativeContext(JNIEnv *env, jclass cls, jint context)\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_InputMethod.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}