{"files":[{"patch":"@@ -1448,0 +1448,1 @@\n+  assert(!free_code_cache_data, \"must be\");\n","filename":"src\/hotspot\/share\/code\/nmethod.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2970,25 +2970,0 @@\n-class UnregisterNMethodOopClosure: public OopClosure {\n-  G1CollectedHeap* _g1h;\n-  nmethod* _nm;\n-\n-public:\n-  UnregisterNMethodOopClosure(G1CollectedHeap* g1h, nmethod* nm) :\n-    _g1h(g1h), _nm(nm) {}\n-\n-  void do_oop(oop* p) {\n-    oop heap_oop = RawAccess<>::oop_load(p);\n-    if (!CompressedOops::is_null(heap_oop)) {\n-      oop obj = CompressedOops::decode_not_null(heap_oop);\n-      HeapRegion* hr = _g1h->heap_region_containing(obj);\n-      assert(!hr->is_continues_humongous(),\n-             \"trying to remove code root \" PTR_FORMAT \" in continuation of humongous region \" HR_FORMAT\n-             \" starting at \" HR_FORMAT,\n-             p2i(_nm), HR_FORMAT_PARAMS(hr), HR_FORMAT_PARAMS(hr->humongous_start_region()));\n-\n-      hr->remove_code_root(_nm);\n-    }\n-  }\n-\n-  void do_oop(narrowOop* p) { ShouldNotReachHere(); }\n-};\n-\n@@ -3002,3 +2977,2 @@\n-  guarantee(nm != nullptr, \"sanity\");\n-  UnregisterNMethodOopClosure reg_cl(this, nm);\n-  nm->oops_do(&reg_cl, true);\n+  \/\/ We always unregister nmethods in bulk during code unloading only.\n+  ShouldNotReachHere();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":2,"deletions":28,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -62,12 +62,2 @@\n-  assert_locked_or_safepoint(CodeCache_lock);\n-\n-  if (gc_data(nm).on_list()) {\n-    nmethod* prev = nullptr;\n-    for (nmethod* cur = _head; cur != nullptr; cur = gc_data(cur).next()) {\n-      if (cur == nm) {\n-        unlist_nmethod(cur, prev);\n-        return;\n-      }\n-      prev = cur;\n-    }\n-  }\n+  \/\/ All users of this method only unregister in bulk during code unloading.\n+  ShouldNotReachHere();\n","filename":"src\/hotspot\/share\/gc\/shared\/scavengableNMethods.cpp","additions":2,"deletions":12,"binary":false,"changes":14,"status":"modified"}]}