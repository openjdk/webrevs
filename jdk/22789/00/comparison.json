{"files":[{"patch":"@@ -1348,0 +1348,4 @@\n+    if (dbgsysPlatformInit() != 0) {\n+      return JNI_ERR;\n+    }\n+\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libdt_socket\/socketTransport.c","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,0 +41,1 @@\n+int dbgsysPlatformInit();\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libdt_socket\/sysSocket.h","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,0 +42,9 @@\n+\/* Perform platform specific initialization.\n+ * Returns 0 on success, non-0 on failure *\/\n+int\n+dbgsysPlatformInit()\n+{\n+    \/\/ Not needed on unix\n+    return 0;\n+}\n+\n","filename":"src\/jdk.jdwp.agent\/unix\/native\/libdt_socket\/socket_md.c","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,0 +25,1 @@\n+#include <stdlib.h>\n@@ -91,0 +92,4 @@\n+static void dbgsysAtExitCallback(void)\n+{\n+    WSACleanup();\n+}\n@@ -92,5 +97,4 @@\n-\/*\n- * Initialize Windows Sockets API support\n- *\/\n-BOOL WINAPI\n-DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved)\n+\/* Perform platform specific initialization.\n+ * Returns 0 on success, non-0 on failure *\/\n+int\n+dbgsysPlatformInit()\n@@ -100,10 +104,1 @@\n-    switch (reason) {\n-        case DLL_PROCESS_ATTACH:\n-            if (WSAStartup(MAKEWORD(2,2), &wsadata) != 0) {\n-                return FALSE;\n-            }\n-            break;\n-\n-        case DLL_PROCESS_DETACH:\n-            WSACleanup();\n-            break;\n+    atexit(dbgsysAtExitCallback);\n@@ -111,4 +106,1 @@\n-        default:\n-            break;\n-    }\n-    return TRUE;\n+    return WSAStartup(MAKEWORD(2,2), &wsadata);\n","filename":"src\/jdk.jdwp.agent\/windows\/native\/libdt_socket\/socket_md.c","additions":12,"deletions":20,"binary":false,"changes":32,"status":"modified"}]}