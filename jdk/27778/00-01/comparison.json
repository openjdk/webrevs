{"files":[{"patch":"@@ -1150,1 +1150,1 @@\n-    + align_up(ImmutableDataReferencesCounterSize, oopSize);\n+    + ImmutableDataReferencesCounterSize;\n@@ -1325,0 +1325,1 @@\n+    _immutable_data_reference_counter_offset = 0;\n@@ -1423,9 +1424,0 @@\n-  \/\/ Increment number of references to immutable data to share it between nmethods\n-  _immutable_data_size          = nm._immutable_data_size;\n-  if (_immutable_data_size > 0) {\n-    _immutable_data             = nm._immutable_data;\n-    set_immutable_data_references_counter(get_immutable_data_references_counter() + 1);\n-  } else {\n-    _immutable_data             = blob_end();\n-  }\n-\n@@ -1447,0 +1439,1 @@\n+  _immutable_data_size          = nm._immutable_data_size;\n@@ -1465,0 +1458,9 @@\n+  _immutable_data_reference_counter_offset = nm._immutable_data_reference_counter_offset;\n+\n+  \/\/ Increment number of references to immutable data to share it between nmethods\n+  if (_immutable_data_size > 0) {\n+    _immutable_data             = nm._immutable_data;\n+    set_immutable_data_references_counter(get_immutable_data_references_counter() + 1);\n+  } else {\n+    _immutable_data             = blob_end();\n+  }\n@@ -1754,1 +1756,2 @@\n-    DEBUG_ONLY( int immutable_data_end_offset = _speculations_offset + align_up(speculations_len, oopSize) + align_up(ImmutableDataReferencesCounterSize, oopSize); )\n+    _immutable_data_reference_counter_offset = _speculations_offset + align_up(speculations_len, oopSize);\n+    DEBUG_ONLY( int immutable_data_end_offset = _immutable_data_reference_counter_offset + ImmutableDataReferencesCounterSize; )\n@@ -1756,1 +1759,2 @@\n-    DEBUG_ONLY( int immutable_data_end_offset = _scopes_data_offset + align_up(debug_info->data_size(), oopSize) + align_up(ImmutableDataReferencesCounterSize, oopSize); )\n+    _immutable_data_reference_counter_offset =  _scopes_data_offset + align_up(debug_info->data_size(), oopSize);\n+    DEBUG_ONLY( int immutable_data_end_offset = _immutable_data_reference_counter_offset + ImmutableDataReferencesCounterSize; )\n","filename":"src\/hotspot\/share\/code\/nmethod.cpp","additions":16,"deletions":12,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -253,0 +253,1 @@\n+  int      _immutable_data_reference_counter_offset;\n@@ -649,1 +650,1 @@\n-  address speculations_end      () const { return           immutable_data_end() - align_up(ImmutableDataReferencesCounterSize, oopSize) ; }\n+  address speculations_end      () const { return           _immutable_data + _immutable_data_reference_counter_offset ; }\n@@ -651,1 +652,1 @@\n-  address scopes_data_end       () const { return           immutable_data_end() - align_up(ImmutableDataReferencesCounterSize, oopSize) ; }\n+  address scopes_data_end       () const { return           _immutable_data + _immutable_data_reference_counter_offset ; }\n@@ -653,2 +654,1 @@\n-\n-  address immutable_data_references_counter_begin () const { return immutable_data_end() - align_up(ImmutableDataReferencesCounterSize, oopSize) ; }\n+  address immutable_data_references_counter_begin () const { return _immutable_data + _immutable_data_reference_counter_offset ; }\n","filename":"src\/hotspot\/share\/code\/nmethod.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}