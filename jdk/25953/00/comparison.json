{"files":[{"patch":"@@ -3931,2 +3931,4 @@\n-  load_const_optimized(t0, VM_Version::_dscr_val | 7);\n-  mtdscr(t0);\n+  if (VM_Version::has_mfdscr()) {\n+    load_const_optimized(t0, VM_Version::_dscr_val | 7);\n+    mtdscr(t0);\n+  }\n@@ -4076,2 +4078,4 @@\n-  load_const_optimized(t0, VM_Version::_dscr_val);\n-  mtdscr(t0);\n+  if (VM_Version::has_mfdscr()) {\n+    load_const_optimized(t0, VM_Version::_dscr_val);\n+    mtdscr(t0);\n+  }\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.cpp","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -955,2 +955,4 @@\n-    __ load_const_optimized(tmp1, VM_Version::_dscr_val);\n-    __ mtdscr(tmp1);\n+    if (VM_Version::has_mfdscr()) {\n+      __ load_const_optimized(tmp1, VM_Version::_dscr_val);\n+      __ mtdscr(tmp1);\n+    }\n@@ -1073,3 +1075,4 @@\n-        __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n-        __ mtdscr(tmp2);\n-\n+        if (VM_Version::has_mfdscr()) {\n+          __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n+          __ mtdscr(tmp2);\n+        }\n@@ -1095,2 +1098,4 @@\n-        __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n-        __ mtdscr(tmp2);\n+        if (VM_Version::has_mfdscr()) {\n+          __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n+          __ mtdscr(tmp2);\n+        }\n@@ -1347,2 +1352,4 @@\n-          __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n-          __ mtdscr(tmp2);\n+          if (VM_Version::has_mfdscr()) {\n+            __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n+            __ mtdscr(tmp2);\n+          }\n@@ -1368,2 +1375,4 @@\n-          __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n-          __ mtdscr(tmp2);\n+          if (VM_Version::has_mfdscr()) {\n+            __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n+            __ mtdscr(tmp2);\n+          }\n@@ -1530,3 +1539,4 @@\n-    __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n-    __ mtdscr(tmp2);\n-\n+    if (VM_Version::has_mfdscr()) {\n+      __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n+      __ mtdscr(tmp2);\n+    }\n@@ -1552,3 +1562,4 @@\n-    __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n-    __ mtdscr(tmp2);\n-\n+    if (VM_Version::has_mfdscr()) {\n+      __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n+      __ mtdscr(tmp2);\n+    }\n@@ -1675,3 +1686,4 @@\n-      __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n-      __ mtdscr(tmp2);\n-\n+      if (VM_Version::has_mfdscr()) {\n+        __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n+        __ mtdscr(tmp2);\n+      }\n@@ -1697,2 +1709,4 @@\n-      __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n-      __ mtdscr(tmp2);\n+      if (VM_Version::has_mfdscr()) {\n+        __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n+        __ mtdscr(tmp2);\n+      }\n@@ -1791,3 +1805,4 @@\n-      __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n-      __ mtdscr(tmp2);\n-\n+      if (VM_Version::has_mfdscr()) {\n+        __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n+        __ mtdscr(tmp2);\n+      }\n@@ -1813,2 +1828,4 @@\n-      __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n-      __ mtdscr(tmp2);\n+      if (VM_Version::has_mfdscr()) {\n+        __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n+        __ mtdscr(tmp2);\n+      }\n@@ -1913,3 +1930,4 @@\n-      __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n-      __ mtdscr(tmp2);\n-\n+      if (VM_Version::has_mfdscr()) {\n+        __ load_const_optimized(tmp2, VM_Version::_dscr_val | 7);\n+        __ mtdscr(tmp2);\n+      }\n@@ -1935,2 +1953,4 @@\n-      __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n-      __ mtdscr(tmp2);\n+      if (VM_Version::has_mfdscr()) {\n+        __ load_const_optimized(tmp2, VM_Version::_dscr_val);\n+        __ mtdscr(tmp2);\n+      }\n","filename":"src\/hotspot\/cpu\/ppc\/stubGenerator_ppc.cpp","additions":52,"deletions":32,"binary":false,"changes":84,"status":"modified"},{"patch":"@@ -83,1 +83,3 @@\n-  config_dscr();\n+  if (VM_Version::has_mfdscr()) {\n+    config_dscr();\n+  }\n@@ -173,1 +175,2 @@\n-               \"ppc64 sha aes%s%s\",\n+               \"ppc64 sha aes%s%s%s\",\n+               (has_mfdscr()  ? \" mfdscr\"  : \"\"),\n@@ -491,0 +494,1 @@\n+  a->mfdscr(R0);\n@@ -527,0 +531,1 @@\n+  if (code[feature_cntr++]) features |= mfdscr_m;\n","filename":"src\/hotspot\/cpu\/ppc\/vm_version_ppc.cpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+    mfdscr,\n@@ -41,0 +42,1 @@\n+    mfdscr_m              = (1 << mfdscr ),\n@@ -70,0 +72,1 @@\n+  static bool has_mfdscr()  { return (_features & mfdscr_m) != 0; }\n","filename":"src\/hotspot\/cpu\/ppc\/vm_version_ppc.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}