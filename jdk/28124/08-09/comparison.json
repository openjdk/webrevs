{"files":[{"patch":"@@ -402,1 +402,7 @@\n-        checkBounds(offset, length, BoundPolicy.SLICE);\n+        try {\n+            checkBounds(offset, length);\n+        } catch (IndexOutOfBoundsException e) {\n+            String msg = String.format(\"Out of bound access on segment %s; attempting to get slice of length %d at offset %d \" +\n+                    \"which is outside the valid range 0 <= offset+length < byteSize (=%d)\", this, length, offset, this.length);\n+            throw new IndexOutOfBoundsException(msg);\n+        }\n@@ -407,1 +413,7 @@\n-        checkBounds(offset, length, BoundPolicy.ACCESS);\n+        try {\n+            checkBounds(offset, length);\n+        } catch (IndexOutOfBoundsException e) {\n+            String msg = String.format(\"Out of bound access on segment %s; attempting to access an element of length %d at offset %d \" +\n+                    \"which is outside the valid range 0 <= offset+length < byteSize (=%d)\", this, length, offset, this.length);\n+            throw new IndexOutOfBoundsException(msg);\n+        }\n@@ -411,1 +423,1 @@\n-    private void checkBounds(long offset, long length, BoundPolicy policy) {\n+    private void checkBounds(long offset, long length) {\n@@ -413,3 +425,4 @@\n-            Preconditions.checkIndex(offset, this.length - length + 1, new BoundsCheckHandler(this, policy));\n-        } else if (length < 0 || offset < 0 || offset > this.length - length) {\n-            throw policy.outOfBoundException(this, offset, length, this.length);\n+            Preconditions.checkIndex(offset, this.length - length + 1, null);\n+        } else if (length < 0 || offset < 0 ||\n+                offset > this.length - length) {\n+            throw new IndexOutOfBoundsException();\n@@ -506,27 +519,0 @@\n-    }\n-\n-    private enum BoundPolicy {\n-        ACCESS, SLICE;\n-\n-        private IndexOutOfBoundsException outOfBoundException(AbstractMemorySegmentImpl segment, long offset, long size,\n-                                                              long length) {\n-            String formatString = switch (this) {\n-                case ACCESS -> \"Out of bound access on segment %s; attempting to access an element of length %d at offset %d \" +\n-                        \"which is outside the valid range 0 <= offset+length < byteSize (=%d)\";\n-                case SLICE -> \"Out of bound access on segment %s; attempting to get slice of length %d at offset %d \" +\n-                        \"which is outside the valid range 0 <= offset+length < byteSize (=%d)\";\n-            };\n-            String message = formatString.formatted(segment, size, offset, length);\n-            return new IndexOutOfBoundsException(message);\n-        }\n-    }\n-\n-    private record BoundsCheckHandler(AbstractMemorySegmentImpl segment, BoundPolicy policy)\n-            implements BiFunction<String, List<Number>, IndexOutOfBoundsException> {\n-        @Override\n-        public IndexOutOfBoundsException apply(String s, List<Number> numbers) {\n-            long offset = numbers.get(0).longValue();\n-            long length = segment.byteSize() - numbers.get(1).longValue() + 1;\n-\n-            return policy.outOfBoundException(segment, offset, length, segment.byteSize());\n-        }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/AbstractMemorySegmentImpl.java","additions":19,"deletions":33,"binary":false,"changes":52,"status":"modified"}]}