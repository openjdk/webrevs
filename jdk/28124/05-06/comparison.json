{"files":[{"patch":"@@ -402,1 +402,1 @@\n-        Preconditions.checkFromIndexSize(offset, length, this.length, this::sliceOutOfBoundException);\n+        Preconditions.checkFromIndexSize(offset, length, this.length, new BoundsCheckHandler(this, BoundPolicy.SLICE));\n@@ -407,1 +407,1 @@\n-        Preconditions.checkFromIndexSize(offset, length, this.length, this::accessOutOfBoundException);\n+        Preconditions.checkFromIndexSize(offset, length, this.length, new BoundsCheckHandler(this, BoundPolicy.ACCESS));\n@@ -425,24 +425,0 @@\n-    private IndexOutOfBoundsException sliceOutOfBoundException(String s, List<Number> numbers) {\n-        return outOfBoundException(BoundPolicy.SLICE, numbers);\n-    }\n-\n-    private IndexOutOfBoundsException accessOutOfBoundException(String s, List<Number> numbers) {\n-        return outOfBoundException(BoundPolicy.ACCESS, numbers);\n-    }\n-\n-    private IndexOutOfBoundsException outOfBoundException(BoundPolicy policy, List<Number> numbers) {\n-        long offset = numbers.get(0).longValue();\n-        long length = numbers.get(1).longValue();\n-        long totalLength = numbers.get(2).longValue();\n-\n-        String msg = switch (policy) {\n-            case BoundPolicy.SLICE  -> \"attempting to get slice of length\";\n-            case BoundPolicy.ACCESS -> \"attempting to access an element of length\";\n-        };\n-\n-        return new IndexOutOfBoundsException(String.format(\"Out of bound access on segment %s; \" +\n-                        \"%s %d at offset %d \" +\n-                        \"which is outside the valid range 0 <= offset+length < byteSize (=%d)\",\n-                this, msg, length, offset, totalLength));\n-    }\n-\n@@ -524,1 +500,42 @@\n-        SLICE, ACCESS\n+        SLICE {\n+            @Override\n+            String format(AbstractMemorySegmentImpl segment, long offset, long size, long length) {\n+                return String.format(\n+                        \"Out of bound access on segment %s; attempting to get slice of length %d at offset %d \" +\n+                                \"which is outside the valid range 0 <= offset+length < byteSize (=%d)\",\n+                        segment, size, offset, length\n+                );\n+            }\n+        },\n+        ACCESS {\n+            @Override\n+            String format(AbstractMemorySegmentImpl segment, long offset, long size, long length) {\n+                return String.format(\n+                        \"Out of bound access on segment %s; attempting to access an element of length %d at offset %d \" +\n+                                \"which is outside the valid range 0 <= offset+length < byteSize (=%d)\",\n+                        segment, size, offset, length\n+                );\n+            }\n+        };\n+\n+        abstract String format(AbstractMemorySegmentImpl segment, long offset, long size, long length);\n+    }\n+\n+    private static final class BoundsCheckHandler implements BiFunction<String, List<Number>, IndexOutOfBoundsException> {\n+        final AbstractMemorySegmentImpl segment;\n+        final BoundPolicy policy;\n+\n+        BoundsCheckHandler(AbstractMemorySegmentImpl segment, BoundPolicy policy) {\n+            this.segment = segment;\n+            this.policy = policy;\n+        }\n+\n+        @Override\n+        public IndexOutOfBoundsException apply(String s, List<Number> args) {\n+            long offset = args.get(0).longValue();\n+            long size   = args.get(1).longValue();\n+            long length = args.get(2).longValue();\n+\n+            String msg = policy.format(segment, offset, size, length);\n+            return new IndexOutOfBoundsException(msg);\n+        }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/AbstractMemorySegmentImpl.java","additions":44,"deletions":27,"binary":false,"changes":71,"status":"modified"}]}