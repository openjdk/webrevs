{"files":[{"patch":"@@ -55,1 +55,1 @@\n-instruct xLoadP(iRegPNoSp dst, memory mem, iRegINoSp tmp)\n+instruct xLoadP(iRegPNoSp dst, memory mem, iRegPNoSp tmp)\n@@ -74,1 +74,1 @@\n-instruct xCompareAndSwapP(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n+instruct xCompareAndSwapP(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp tmp) %{\n@@ -78,1 +78,1 @@\n-  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n+  effect(TEMP_DEF res, TEMP tmp);\n@@ -108,1 +108,1 @@\n-instruct xCompareAndSwapPAcq(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n+instruct xCompareAndSwapPAcq(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp tmp) %{\n@@ -112,1 +112,1 @@\n-  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n+  effect(TEMP_DEF res, TEMP tmp);\n@@ -142,1 +142,1 @@\n-instruct xCompareAndExchangeP(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n+instruct xCompareAndExchangeP(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp tmp) %{\n@@ -145,1 +145,1 @@\n-  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n+  effect(TEMP_DEF res, TEMP tmp);\n@@ -170,1 +170,1 @@\n-instruct xCompareAndExchangePAcq(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n+instruct xCompareAndExchangePAcq(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp tmp) %{\n@@ -173,1 +173,1 @@\n-  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n+  effect(TEMP_DEF res, TEMP tmp);\n@@ -198,1 +198,1 @@\n-instruct xGetAndSetP(indirect mem, iRegP newv, iRegPNoSp prev, iRegINoSp tmp, rFlagsReg cr) %{\n+instruct xGetAndSetP(indirect mem, iRegP newv, iRegPNoSp prev, iRegPNoSp tmp) %{\n@@ -201,1 +201,1 @@\n-  effect(TEMP_DEF prev, KILL cr, TEMP tmp);\n+  effect(TEMP_DEF prev, TEMP tmp);\n@@ -215,1 +215,1 @@\n-instruct xGetAndSetPAcq(indirect mem, iRegP newv, iRegPNoSp prev, iRegINoSp tmp, rFlagsReg cr) %{\n+instruct xGetAndSetPAcq(indirect mem, iRegP newv, iRegPNoSp prev, iRegPNoSp tmp) %{\n@@ -218,1 +218,1 @@\n-  effect(TEMP_DEF prev, KILL cr, TEMP tmp);\n+  effect(TEMP_DEF prev, TEMP tmp);\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/x\/x_riscv.ad","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -93,1 +93,1 @@\n-instruct zLoadP(iRegPNoSp dst, memory mem)\n+instruct zLoadP(iRegPNoSp dst, memory mem, iRegPNoSp tmp)\n@@ -97,1 +97,1 @@\n-  effect(TEMP dst);\n+  effect(TEMP dst, TEMP tmp);\n@@ -106,1 +106,1 @@\n-    z_load_barrier(_masm, this, ref_addr, $dst$$Register, t0);\n+    z_load_barrier(_masm, this, ref_addr, $dst$$Register, $tmp$$Register);\n@@ -113,1 +113,1 @@\n-instruct zStoreP(memory mem, iRegP src, iRegPNoSp tmp, rFlagsReg cr)\n+instruct zStoreP(memory mem, iRegP src, iRegPNoSp tmp1, iRegPNoSp tmp2)\n@@ -117,1 +117,1 @@\n-  effect(TEMP tmp, KILL cr);\n+  effect(TEMP tmp1, TEMP tmp2);\n@@ -123,2 +123,2 @@\n-    z_store_barrier(_masm, this, ref_addr, $src$$Register, $tmp$$Register, t1, false \/* is_atomic *\/);\n-    __ sd($tmp$$Register, ref_addr);\n+    z_store_barrier(_masm, this, ref_addr, $src$$Register, $tmp1$$Register, $tmp2$$Register, false \/* is_atomic *\/);\n+    __ sd($tmp1$$Register, ref_addr);\n@@ -129,1 +129,2 @@\n-instruct zCompareAndSwapP(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, rFlagsReg cr) %{\n+instruct zCompareAndSwapP(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval,\n+                          iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, iRegPNoSp tmp1) %{\n@@ -133,1 +134,1 @@\n-  effect(TEMP oldval_tmp, TEMP newval_tmp, KILL cr, TEMP_DEF res);\n+  effect(TEMP oldval_tmp, TEMP newval_tmp, TEMP tmp1, TEMP_DEF res);\n@@ -143,2 +144,2 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n-    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, t1, true \/* is_atomic *\/);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $tmp1$$Register);\n+    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, $tmp1$$Register, true \/* is_atomic *\/);\n@@ -151,1 +152,2 @@\n-instruct zCompareAndSwapPAcq(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, rFlagsReg cr) %{\n+instruct zCompareAndSwapPAcq(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval,\n+                             iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, iRegPNoSp tmp1) %{\n@@ -155,1 +157,1 @@\n-  effect(TEMP oldval_tmp, TEMP newval_tmp, KILL cr, TEMP_DEF res);\n+  effect(TEMP oldval_tmp, TEMP newval_tmp, TEMP tmp1, TEMP_DEF res);\n@@ -165,2 +167,2 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n-    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, t1, true \/* is_atomic *\/);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $tmp1$$Register);\n+    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, $tmp1$$Register, true \/* is_atomic *\/);\n@@ -173,1 +175,2 @@\n-instruct zCompareAndExchangeP(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, rFlagsReg cr) %{\n+instruct zCompareAndExchangeP(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval,\n+                              iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, iRegPNoSp tmp1) %{\n@@ -176,1 +179,1 @@\n-  effect(TEMP oldval_tmp, TEMP newval_tmp, KILL cr, TEMP_DEF res);\n+  effect(TEMP oldval_tmp, TEMP newval_tmp, TEMP tmp1, TEMP_DEF res);\n@@ -185,2 +188,2 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n-    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, t1, true \/* is_atomic *\/);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $tmp1$$Register);\n+    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, $tmp1$$Register, true \/* is_atomic *\/);\n@@ -194,1 +197,2 @@\n-instruct zCompareAndExchangePAcq(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, rFlagsReg cr) %{\n+instruct zCompareAndExchangePAcq(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval,\n+                                 iRegPNoSp oldval_tmp, iRegPNoSp newval_tmp, iRegPNoSp tmp1) %{\n@@ -197,1 +201,1 @@\n-  effect(TEMP oldval_tmp, TEMP newval_tmp, KILL cr, TEMP_DEF res);\n+  effect(TEMP oldval_tmp, TEMP newval_tmp, TEMP tmp1, TEMP_DEF res);\n@@ -206,2 +210,2 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n-    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, t1, true \/* is_atomic *\/);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $tmp1$$Register);\n+    z_store_barrier(_masm, this, ref_addr, $newval$$Register, $newval_tmp$$Register, $tmp1$$Register, true \/* is_atomic *\/);\n@@ -215,1 +219,1 @@\n-instruct zGetAndSetP(indirect mem, iRegP newv, iRegPNoSp prev, rFlagsReg cr) %{\n+instruct zGetAndSetP(indirect mem, iRegP newv, iRegPNoSp prev, iRegPNoSp tmp) %{\n@@ -218,1 +222,1 @@\n-  effect(TEMP_DEF prev, KILL cr);\n+  effect(TEMP_DEF prev, TEMP tmp);\n@@ -225,1 +229,1 @@\n-    z_store_barrier(_masm, this, Address($mem$$Register), $newv$$Register, $prev$$Register, t1, true \/* is_atomic *\/);\n+    z_store_barrier(_masm, this, Address($mem$$Register), $newv$$Register, $prev$$Register, $tmp$$Register, true \/* is_atomic *\/);\n@@ -233,1 +237,1 @@\n-instruct zGetAndSetPAcq(indirect mem, iRegP newv, iRegPNoSp prev, rFlagsReg cr) %{\n+instruct zGetAndSetPAcq(indirect mem, iRegP newv, iRegPNoSp prev, iRegPNoSp tmp) %{\n@@ -236,1 +240,1 @@\n-  effect(TEMP_DEF prev, KILL cr);\n+  effect(TEMP_DEF prev, TEMP tmp);\n@@ -243,1 +247,1 @@\n-    z_store_barrier(_masm, this, Address($mem$$Register), $newv$$Register, $prev$$Register, t1, true \/* is_atomic *\/);\n+    z_store_barrier(_masm, this, Address($mem$$Register), $newv$$Register, $prev$$Register, $tmp$$Register, true \/* is_atomic *\/);\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/z\/z_riscv.ad","additions":33,"deletions":29,"binary":false,"changes":62,"status":"modified"}]}