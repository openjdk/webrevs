{"files":[{"patch":"@@ -55,1 +55,1 @@\n-instruct xLoadP(iRegPNoSp dst, memory mem)\n+instruct xLoadP(iRegPNoSp dst, memory mem, iRegINoSp tmp)\n@@ -59,1 +59,1 @@\n-  effect(TEMP dst);\n+  effect(TEMP dst, TEMP tmp);\n@@ -68,1 +68,1 @@\n-    x_load_barrier(_masm, this, ref_addr, $dst$$Register, t0 \/* tmp *\/, barrier_data());\n+    x_load_barrier(_masm, this, ref_addr, $dst$$Register, $tmp$$Register \/* tmp *\/, barrier_data());\n@@ -74,1 +74,1 @@\n-instruct xCompareAndSwapP(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, rFlagsReg cr) %{\n+instruct xCompareAndSwapP(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n@@ -78,1 +78,1 @@\n-  effect(KILL cr, TEMP_DEF res);\n+  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n@@ -89,5 +89,3 @@\n-               Assembler::relaxed \/* acquire *\/, Assembler::rl \/* release *\/, $res$$Register,\n-               true \/* result_as_bool *\/);\n-    __ beqz($res$$Register, failed);\n-    __ mv(t0, $oldval$$Register);\n-    __ bind(failed);\n+               Assembler::relaxed \/* acquire *\/, Assembler::rl \/* release *\/, $tmp$$Register);\n+    __ sub(t0, $tmp$$Register, $oldval$$Register);\n+    __ seqz($res$$Register, t0);\n@@ -96,4 +94,4 @@\n-      __ ld(t1, Address(xthread, XThreadLocalData::address_bad_mask_offset()), t1 \/* tmp *\/);\n-      __ andr(t1, t1, t0);\n-      __ beqz(t1, good);\n-      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), t0 \/* ref *\/, t1 \/* tmp *\/);\n+      __ ld(t0, Address(xthread, XThreadLocalData::address_bad_mask_offset()));\n+      __ andr(t0, t0, $tmp$$Register);\n+      __ beqz(t0, good);\n+      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), $tmp$$Register \/* ref *\/, $res$$Register \/* tmp *\/);\n@@ -110,1 +108,1 @@\n-instruct xCompareAndSwapPAcq(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, rFlagsReg cr) %{\n+instruct xCompareAndSwapPAcq(iRegINoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n@@ -114,1 +112,1 @@\n-  effect(KILL cr, TEMP_DEF res);\n+  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n@@ -125,5 +123,3 @@\n-               Assembler::aq \/* acquire *\/, Assembler::rl \/* release *\/, $res$$Register,\n-               true \/* result_as_bool *\/);\n-    __ beqz($res$$Register, failed);\n-    __ mv(t0, $oldval$$Register);\n-    __ bind(failed);\n+               Assembler::aq \/* acquire *\/, Assembler::rl \/* release *\/, $tmp$$Register);\n+    __ sub(t0, $tmp$$Register, $oldval$$Register);\n+    __ seqz($res$$Register, t0);\n@@ -132,4 +128,4 @@\n-      __ ld(t1, Address(xthread, XThreadLocalData::address_bad_mask_offset()), t1 \/* tmp *\/);\n-      __ andr(t1, t1, t0);\n-      __ beqz(t1, good);\n-      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), t0 \/* ref *\/, t1 \/* tmp *\/);\n+      __ ld(t0, Address(xthread, XThreadLocalData::address_bad_mask_offset()));\n+      __ andr(t0, t0, $tmp$$Register);\n+      __ beqz(t0, good);\n+      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), $tmp$$Register \/* ref *\/, $res$$Register \/* tmp *\/);\n@@ -146,1 +142,1 @@\n-instruct xCompareAndExchangeP(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval) %{\n+instruct xCompareAndExchangeP(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n@@ -149,1 +145,1 @@\n-  effect(TEMP_DEF res);\n+  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n@@ -164,1 +160,1 @@\n-      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), $res$$Register \/* ref *\/, t0 \/* tmp *\/);\n+      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), $res$$Register \/* ref *\/, $tmp$$Register \/* tmp *\/);\n@@ -174,1 +170,1 @@\n-instruct xCompareAndExchangePAcq(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval) %{\n+instruct xCompareAndExchangePAcq(iRegPNoSp res, indirect mem, iRegP oldval, iRegP newval, iRegINoSp tmp, rFlagsReg cr) %{\n@@ -177,1 +173,1 @@\n-  effect(TEMP_DEF res);\n+  effect(KILL cr, TEMP_DEF res, TEMP tmp);\n@@ -192,1 +188,1 @@\n-      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), $res$$Register \/* ref *\/, t0 \/* tmp *\/);\n+      x_load_barrier_slow_path(_masm, this, Address($mem$$Register), $res$$Register \/* ref *\/, $tmp$$Register \/* tmp *\/);\n@@ -202,1 +198,1 @@\n-instruct xGetAndSetP(indirect mem, iRegP newv, iRegPNoSp prev, rFlagsReg cr) %{\n+instruct xGetAndSetP(indirect mem, iRegP newv, iRegPNoSp prev, iRegINoSp tmp, rFlagsReg cr) %{\n@@ -205,1 +201,1 @@\n-  effect(TEMP_DEF prev, KILL cr);\n+  effect(TEMP_DEF prev, KILL cr, TEMP tmp);\n@@ -213,1 +209,1 @@\n-    x_load_barrier(_masm, this, Address(noreg, 0), $prev$$Register, t0 \/* tmp *\/, barrier_data());\n+    x_load_barrier(_masm, this, Address(noreg, 0), $prev$$Register, $tmp$$Register \/* tmp *\/, barrier_data());\n@@ -219,1 +215,1 @@\n-instruct xGetAndSetPAcq(indirect mem, iRegP newv, iRegPNoSp prev, rFlagsReg cr) %{\n+instruct xGetAndSetPAcq(indirect mem, iRegP newv, iRegPNoSp prev, iRegINoSp tmp, rFlagsReg cr) %{\n@@ -222,1 +218,1 @@\n-  effect(TEMP_DEF prev, KILL cr);\n+  effect(TEMP_DEF prev, KILL cr, TEMP tmp);\n@@ -230,1 +226,1 @@\n-    x_load_barrier(_masm, this, Address(noreg, 0), $prev$$Register, t0 \/* tmp *\/, barrier_data());\n+    x_load_barrier(_masm, this, Address(noreg, 0), $prev$$Register, $tmp$$Register \/* tmp *\/, barrier_data());\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/x\/x_riscv.ad","additions":33,"deletions":37,"binary":false,"changes":70,"status":"modified"},{"patch":"@@ -82,1 +82,1 @@\n-    z_color(_masm, node, rnew_zpointer, rnew_zaddress, t0);\n+    z_color(_masm, node, rnew_zpointer, rnew_zaddress, tmp);\n@@ -143,1 +143,1 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, t0);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n@@ -165,1 +165,1 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, t0);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n@@ -185,1 +185,1 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, t0);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n@@ -206,1 +206,1 @@\n-    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, t0);\n+    z_color(_masm, this, $oldval_tmp$$Register, $oldval$$Register, $newval_tmp$$Register);\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/z\/z_riscv.ad","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -780,1 +780,1 @@\n-      cmpxchg_obj_header(swap_reg, lock_reg, obj_reg, t0, count, \/*fallthrough*\/nullptr);\n+      cmpxchg_obj_header(swap_reg, lock_reg, obj_reg, tmp, count, \/*fallthrough*\/nullptr);\n@@ -894,1 +894,1 @@\n-      cmpxchg_obj_header(swap_reg, header_reg, obj_reg, t0, count, \/*fallthrough*\/nullptr);\n+      cmpxchg_obj_header(swap_reg, header_reg, obj_reg, tmp_reg, count, \/*fallthrough*\/nullptr);\n","filename":"src\/hotspot\/cpu\/riscv\/interp_masm_riscv.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2706,3 +2706,3 @@\n-  assert_different_registers(addr, tmp);\n-  assert_different_registers(newv, tmp);\n-  assert_different_registers(oldv, tmp);\n+  assert_different_registers(addr, tmp, t0);\n+  assert_different_registers(newv, tmp, t0);\n+  assert_different_registers(oldv, tmp, t0);\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1683,1 +1683,1 @@\n-      __ cmpxchg_obj_header(x10, lock_reg, obj_reg, t0, count, \/*fallthrough*\/nullptr);\n+      __ cmpxchg_obj_header(x10, lock_reg, obj_reg, lock_tmp, count, \/*fallthrough*\/nullptr);\n@@ -1823,1 +1823,1 @@\n-      __ cmpxchg_obj_header(x10, old_hdr, obj_reg, t0, count, &slow_path_unlock);\n+      __ cmpxchg_obj_header(x10, old_hdr, obj_reg, lock_tmp, count, &slow_path_unlock);\n","filename":"src\/hotspot\/cpu\/riscv\/sharedRuntime_riscv.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}