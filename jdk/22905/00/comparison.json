{"files":[{"patch":"@@ -46,0 +46,1 @@\n+import java.util.ServiceLoader;\n@@ -1923,0 +1924,14 @@\n+    \/**\n+     * Register a module layer to search for service providers when\n+     * {@linkplain ServiceLoader#load(Class, ClassLoader) loading services by class loader}.\n+     * The layer will then be searched in addition to any layers defined to this\n+     * class loader.\n+     *\n+     * @param layer the module layer to register (must not be {@code null})\n+     *\n+     * @since 25\n+     *\/\n+    protected void registerModuleLayer(ModuleLayer layer) {\n+        layer.bindToLoader(this);\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ClassLoader.java","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-import java.util.concurrent.CopyOnWriteArrayList;\n+import java.util.concurrent.CopyOnWriteArraySet;\n@@ -945,5 +945,5 @@\n-        List<ModuleLayer> list = CLV.get(loader);\n-        if (list == null) {\n-            list = new CopyOnWriteArrayList<>();\n-            List<ModuleLayer> previous = CLV.putIfAbsent(loader, list);\n-            if (previous != null) list = previous;\n+        Set<ModuleLayer> set = CLV.get(loader);\n+        if (set == null) {\n+            set = new CopyOnWriteArraySet<>();\n+            Set<ModuleLayer> previous = CLV.putIfAbsent(loader, set);\n+            if (previous != null) set = previous;\n@@ -951,1 +951,1 @@\n-        list.add(this);\n+        set.add(this);\n@@ -959,3 +959,3 @@\n-        List<ModuleLayer> list = CLV.get(loader);\n-        if (list != null) {\n-            return list.stream();\n+        Set<ModuleLayer> set = CLV.get(loader);\n+        if (set != null) {\n+            return set.stream();\n@@ -968,1 +968,1 @@\n-    private static final ClassLoaderValue<List<ModuleLayer>> CLV = new ClassLoaderValue<>();\n+    private static final ClassLoaderValue<Set<ModuleLayer>> CLV = new ClassLoaderValue<>();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ModuleLayer.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"}]}