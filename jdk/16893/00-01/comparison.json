{"files":[{"patch":"@@ -211,1 +211,2 @@\n-            if (\"java.io\".equals(out.getClass().getPackageName()))\n+            if (out.getClass().getPackageName().startsWith(\"java.\") &&\n+                !(out instanceof FilterOutputStream))\n","filename":"src\/java.base\/share\/classes\/java\/io\/ByteArrayInputStream.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+import java.io.DataOutputStream;\n@@ -64,1 +65,2 @@\n-        byte[] buf = new byte[128];\n+        byte[] buf = new byte[RND.nextInt(1025)];\n+        System.out.println(\"buf.length: \" + buf.length);\n@@ -71,5 +73,5 @@\n-        OutputStream baos = new ByteArrayOutputStream();\n-        bais.transferTo(baos);\n-        bais.reset();\n-        if (!Arrays.equals(buf, bais.readAllBytes()))\n-            throw new RuntimeException(\"Internal buffer has been modified\");\n+        OutputStream[] outputStreams = new OutputStream[] {\n+            new ByteArrayOutputStream(),\n+            new UntrustedOutputStream(),\n+            new DataOutputStream(new UntrustedOutputStream())\n+        };\n@@ -77,6 +79,13 @@\n-        bais.reset();\n-        OutputStream out = new UntrustedOutputStream();\n-        bais.transferTo(out);\n-        bais.reset();\n-        if (!Arrays.equals(buf, bais.readAllBytes()))\n-            throw new RuntimeException(\"Internal buffer has been modified\");\n+        for (OutputStream out : outputStreams) {\n+            System.err.println(\"out: \" + out.getClass().getName());\n+\n+            bais.transferTo(out);\n+            bais.reset();\n+            try {\n+                if (!Arrays.equals(buf, bais.readAllBytes()))\n+                    throw new RuntimeException(\"Internal buffer was modified\");\n+            } finally {\n+                out.close();\n+            }\n+            bais.reset();\n+        }\n","filename":"test\/jdk\/java\/io\/ByteArrayInputStream\/TransferToTrusted.java","additions":21,"deletions":12,"binary":false,"changes":33,"status":"modified"}]}