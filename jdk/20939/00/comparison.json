{"files":[{"patch":"@@ -161,1 +161,1 @@\n-    boolean hasTrailingSlash(byte[] a, int end) {\n+    protected boolean hasTrailingSlash(byte[] a, int end) {\n@@ -301,1 +301,1 @@\n-        boolean hasTrailingSlash(byte[] a, int end) {\n+        protected boolean hasTrailingSlash(byte[] a, int end) {\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipCoder.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -350,3 +350,3 @@\n-            int pos = res.zsrc.getEntryPos(name, true);\n-            if (pos != -1) {\n-                entry = getZipEntry(name, pos);\n+            EntryPos pos = res.zsrc.getEntryPos(name, true);\n+            if (pos != null) {\n+                entry = getZipEntry(pos);\n@@ -390,1 +390,6 @@\n-                pos = zsrc.getEntryPos(entry.name, false);\n+                EntryPos entryPos = zsrc.getEntryPos(entry.name, false);\n+                if (entryPos != null) {\n+                    pos = entryPos.pos;\n+                } else {\n+                    pos = -1;\n+                }\n@@ -543,1 +548,2 @@\n-                return (T)getZipEntry(null, res.zsrc.getEntryPos(i++ * 3));\n+                int pos = res.zsrc.getEntryPos(i++ * 3);\n+                return (T)getZipEntry(new EntryPos(getEntryName(pos), pos));\n@@ -615,1 +621,1 @@\n-                pos -> getZipEntry(null, pos)), false);\n+                pos -> getZipEntry(new EntryPos(getEntryName(pos), pos))), false);\n@@ -658,1 +664,1 @@\n-                pos -> (JarEntry)getZipEntry(null, pos)), false);\n+                pos -> (JarEntry)getZipEntry(new EntryPos(getEntryName(pos), pos))), false);\n@@ -666,1 +672,3 @@\n-    private ZipEntry getZipEntry(String name, int pos) {\n+    private ZipEntry getZipEntry(EntryPos entryPos) {\n+        String name = entryPos.name;\n+        int pos  = entryPos.pos;\n@@ -668,3 +676,3 @@\n-        int nlen = CENNAM(cen, pos);\n-        int elen = CENEXT(cen, pos);\n-        int clen = CENCOM(cen, pos);\n+        ZipEntry e = this instanceof JarFile jarFile\n+                ? Source.JUJA.entryFor(jarFile, name)\n+                : new ZipEntry(name);\n@@ -672,20 +680,0 @@\n-        ZipCoder zc = res.zsrc.zipCoderForPos(pos);\n-        if (name != null) {\n-            \/\/ only need to check for mismatch of trailing slash\n-            if (nlen > 0 &&\n-                !name.isEmpty() &&\n-                zc.hasTrailingSlash(cen, pos + CENHDR + nlen) &&\n-                !name.endsWith(\"\/\"))\n-            {\n-                name += '\/';\n-            }\n-        } else {\n-            \/\/ invoked from iterator, use the entry name stored in cen\n-            name = zc.toString(cen, pos + CENHDR, nlen);\n-        }\n-        ZipEntry e;\n-        if (this instanceof JarFile) {\n-            e = Source.JUJA.entryFor((JarFile)this, name);\n-        } else {\n-            e = new ZipEntry(name);\n-        }\n@@ -693,0 +681,1 @@\n+        e.method = CENHOW(cen, pos);\n@@ -695,1 +684,0 @@\n-        e.size = CENLEN(cen, pos);\n@@ -697,1 +685,1 @@\n-        e.method = CENHOW(cen, pos);\n+        e.size = CENLEN(cen, pos);\n@@ -703,0 +691,3 @@\n+        int elen = CENEXT(cen, pos);\n+        int clen = CENCOM(cen, pos);\n+\n@@ -704,0 +695,1 @@\n+            int nlen = CENNAM(cen, pos);\n@@ -708,0 +700,1 @@\n+            int nlen = CENNAM(cen, pos);\n@@ -709,0 +702,1 @@\n+            ZipCoder zc = res.zsrc.zipCoderForPos(pos);\n@@ -1179,0 +1173,2 @@\n+    \/\/ Represents the resolved name and position of a CEN record\n+    static record EntryPos(String name, int pos) {}\n@@ -1852,2 +1848,2 @@\n-         * Returns the {@code pos} of the ZIP cen entry corresponding to the\n-         * specified entry name, or -1 if not found.\n+         * Returns the resolved name and position of the ZIP cen entry corresponding\n+         *  to the specified entry name, or {@code null} if not found.\n@@ -1855,1 +1851,1 @@\n-        private int getEntryPos(String name, boolean addSlash) {\n+        private EntryPos getEntryPos(String name, boolean addSlash) {\n@@ -1857,1 +1853,1 @@\n-                return -1;\n+                return null;\n@@ -1880,1 +1876,1 @@\n-                            return pos;\n+                            return new EntryPos(name, pos);\n@@ -1895,1 +1891,1 @@\n-                return dirPos;\n+                return new EntryPos(name +\"\/\", dirPos);\n@@ -1898,1 +1894,1 @@\n-            return -1;\n+            return null;\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipFile.java","additions":36,"deletions":40,"binary":false,"changes":76,"status":"modified"}]}