{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,0 +85,10 @@\n+#define EXCEPTION_CHECK_WITH_RELEASE(situationDescription, returnVal, js, stringBytes)          \\\n+    if (exception = jniEnv->ExceptionOccurred()) {                                              \\\n+        PrintDebugString(\"[ERROR]: *** Exception occured while doing: %s; returning %d\", situationDescription, returnVal);   \\\n+        jniEnv->ExceptionDescribe();                                                            \\\n+        jniEnv->ExceptionClear();                                                               \\\n+        jniEnv->ReleaseStringChars(js, stringBytes);                                            \\\n+        return (returnVal);                                                                     \\\n+    }                                                                                           \\\n+    jniEnv->ReleaseStringChars(js, stringBytes);\n+\n@@ -1218,2 +1228,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleName - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleName - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -1383,2 +1392,1 @@\n-                EXCEPTION_CHECK(\"Getting AccessibleAttributesAtIndex - call to GetStringLength()\", FALSE);\n-                jniEnv->ReleaseStringChars(js, stringBytes);\n+                EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleAttributesAtIndex - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -1738,0 +1746,2 @@\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleName - call to GetStringLength()\", FALSE, js, stringBytes);\n+            EXCEPTION_CHECK(\"Getting AccessibleName - call to ReleaseStringChars()\", FALSE);\n@@ -1740,3 +1750,0 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleName - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n-            EXCEPTION_CHECK(\"Getting AccessibleName - call to ReleaseStringChars()\", FALSE);\n@@ -1770,0 +1777,2 @@\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleName - call to GetStringLength()\", FALSE, js, stringBytes);\n+            EXCEPTION_CHECK(\"Getting AccessibleName - call to ReleaseStringChars()\", FALSE);\n@@ -1772,3 +1781,0 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleName - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n-            EXCEPTION_CHECK(\"Getting AccessibleName - call to ReleaseStringChars()\", FALSE);\n@@ -1802,0 +1808,2 @@\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleRole - call to GetStringLength()\", FALSE, js, stringBytes);\n+            EXCEPTION_CHECK(\"Getting AccessibleRole - call to ReleaseStringChars()\", FALSE);\n@@ -1804,3 +1812,0 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleRole - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n-            EXCEPTION_CHECK(\"Getting AccessibleRole - call to ReleaseStringChars()\", FALSE);\n@@ -1834,0 +1839,2 @@\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleRole_en_US - call to GetStringLength()\", FALSE, js, stringBytes);\n+            EXCEPTION_CHECK(\"Getting AccessibleRole_en_US - call to ReleaseStringChars()\", FALSE);\n@@ -1836,3 +1843,0 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleRole_en_US - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n-            EXCEPTION_CHECK(\"Getting AccessibleRole_en_US - call to ReleaseStringChars()\", FALSE);\n@@ -1865,0 +1869,2 @@\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleState - call to GetStringLength()\", FALSE, js, stringBytes);\n+            EXCEPTION_CHECK(\"Getting AccessibleState - call to ReleaseStringChars()\", FALSE);\n@@ -1867,3 +1873,0 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleState - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n-            EXCEPTION_CHECK(\"Getting AccessibleState - call to ReleaseStringChars()\", FALSE);\n@@ -1896,0 +1899,2 @@\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleState_en_US - call to GetStringLength()\", FALSE, js, stringBytes);\n+            EXCEPTION_CHECK(\"Getting AccessibleState_en_US - call to ReleaseStringChars()\", FALSE);\n@@ -1898,3 +1903,0 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleState_en_US - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n-            EXCEPTION_CHECK(\"Getting AccessibleState_en_US - call to ReleaseStringChars()\", FALSE);\n@@ -2812,0 +2814,2 @@\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleRelation key - call to GetStringLength()\", FALSE, js, stringBytes);\n+            EXCEPTION_CHECK(\"Getting AccessibleRelation key - call to ReleaseStringChars()\", FALSE);\n@@ -2814,3 +2818,0 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleRelation key - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n-            EXCEPTION_CHECK(\"Getting AccessibleRelation key - call to ReleaseStringChars()\", FALSE);\n@@ -2918,2 +2919,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleHyperlink text - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleHyperlink text - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3055,2 +3055,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleHyperlink text - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleHyperlink text - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3174,2 +3173,1 @@\n-        EXCEPTION_CHECK(\"Getting AccessibleHyperlink text - call to GetStringLength()\", FALSE);\n-        jniEnv->ReleaseStringChars(js, stringBytes);\n+        EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleHyperlink text - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3303,2 +3301,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleIcon description - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleIcon description - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3382,2 +3379,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleAction name  - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleAction name  - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3564,2 +3560,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleWordAtIndex - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleWordAtIndex - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3600,2 +3595,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleSentenceAtIndex - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleSentenceAtIndex - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3676,2 +3670,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleTextSelectedText - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleTextSelectedText - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3893,2 +3886,1 @@\n-            EXCEPTION_CHECK(\"Getting BackgroundColorFromAttributeSet - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting BackgroundColorFromAttributeSet - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3930,2 +3922,1 @@\n-            EXCEPTION_CHECK(\"Getting ForegroundColorFromAttributeSet - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting ForegroundColorFromAttributeSet - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -3967,2 +3958,1 @@\n-            EXCEPTION_CHECK(\"Getting FontFamilyFromAttributeSet - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting FontFamilyFromAttributeSet - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -4173,2 +4163,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleAttributesAtIndex - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleAttributesAtIndex - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -4416,2 +4405,1 @@\n-            EXCEPTION_CHECK(\"Getting AccessibleTextRange - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting AccessibleTextRange - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -4461,2 +4449,1 @@\n-            EXCEPTION_CHECK(\"Getting CurrentAccessibleValue - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting CurrentAccessibleValue - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -4504,2 +4491,1 @@\n-            EXCEPTION_CHECK(\"Getting MaximumAccessibleValue - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting MaximumAccessibleValue - call to GetStringLength()\", FALSE, js, stringBytes);\n@@ -4547,2 +4533,1 @@\n-            EXCEPTION_CHECK(\"Getting MinimumAccessibleValue - call to GetStringLength()\", FALSE);\n-            jniEnv->ReleaseStringChars(js, stringBytes);\n+            EXCEPTION_CHECK_WITH_RELEASE(\"Getting MinimumAccessibleValue - call to GetStringLength()\", FALSE, js, stringBytes);\n","filename":"src\/jdk.accessibility\/windows\/native\/libjavaaccessbridge\/AccessBridgeJavaEntryPoints.cpp","additions":43,"deletions":58,"binary":false,"changes":101,"status":"modified"}]}