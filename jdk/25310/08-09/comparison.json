{"files":[{"patch":"@@ -409,1 +409,1 @@\n-            Set<Integer> certCheckSums = new HashSet<>(len);\n+            int[] certCheckSums = new int[len];\n@@ -413,1 +413,1 @@\n-                certCheckSums.add(Record.getInt32(buf));\n+                certCheckSums[i] = Record.getInt32(buf);\n@@ -418,1 +418,1 @@\n-            List<X509Certificate> tmpCerts = new ArrayList<>(len);\n+            boolean same = false;\n@@ -422,2 +422,2 @@\n-                    && x509Pos.popCerts.length >= len) {\n-\n+                    && x509Pos.popCerts.length == len) {\n+                \/\/ Make sure we got the exact same cert chain.\n@@ -427,1 +427,5 @@\n-                        if (certCheckSums.contains(getChecksum(encoded))) {\n+                        String popAlg = x509Pos.popCerts[i]\n+                                .getPublicKey().getAlgorithm();\n+\n+                        if (certCheckSums[i] == getChecksum(encoded)\n+                                && certAlgs[i].equals(popAlg)) {\n@@ -429,2 +433,6 @@\n-                            tmpCerts.add(\n-                                    X509Factory.cachedGetX509Cert(encoded));\n+                            x509Pos.popCerts[i] =\n+                                    X509Factory.cachedGetX509Cert(encoded);\n+                            same = true;\n+                        } else {\n+                            same = false;\n+                            break;\n@@ -438,2 +446,2 @@\n-            if (tmpCerts.size() == len) {\n-                this.localCerts = tmpCerts.toArray(new X509Certificate[len]);\n+            if (same) {\n+                this.localCerts = ((X509Possession) pos).popCerts;\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLSessionImpl.java","additions":18,"deletions":10,"binary":false,"changes":28,"status":"modified"}]}