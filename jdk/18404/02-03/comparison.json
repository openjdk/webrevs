{"files":[{"patch":"@@ -1282,10 +1282,0 @@\n-static size_t format_message_fixup(char* buf, size_t end) {\n-  if (end > 3) {\n-    if (buf[end - 1] == '\\n') end--;\n-    if (buf[end - 1] == '\\r') end--;\n-    if (buf[end - 1] == '.')  end--;\n-    buf[end] = '\\0';\n-  }\n-  return end;\n-}\n-\n@@ -1293,0 +1283,1 @@\n+  GetLastError(); \/\/ Clear old pending errors\n@@ -1294,2 +1285,1 @@\n-  DWORD errval;\n-  if ((errval = GetLastError()) != 0) {\n+  if (ret == nullptr) {\n@@ -1297,10 +1287,3 @@\n-    size_t n = (size_t)FormatMessage(\n-                                     FORMAT_MESSAGE_FROM_SYSTEM|FORMAT_MESSAGE_IGNORE_INSERTS,\n-                                     nullptr,\n-                                     errval,\n-                                     0,\n-                                     buf,\n-                                     (DWORD)sizeof(buf),\n-                                     nullptr);\n-    format_message_fixup(buf, n);\n-    log_debug(os)(\"Symbol %s not found in dll: %s\", name, buf);\n+    if (os::lasterror(buf, sizeof(buf)) > 0) {\n+      log_debug(os)(\"Symbol %s not found in dll: %s\", name, buf);\n+    }\n@@ -2193,1 +2176,8 @@\n-    return format_message_fixup(buf, n);\n+    if (n > 3) {\n+      \/\/ Drop final '.', CR, LF\n+      if (buf[n - 1] == '\\n') n--;\n+      if (buf[n - 1] == '\\r') n--;\n+      if (buf[n - 1] == '.') n--;\n+      buf[n] = '\\0';\n+    }\n+    return n;\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":13,"deletions":23,"binary":false,"changes":36,"status":"modified"}]}