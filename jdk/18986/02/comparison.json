{"files":[{"patch":"@@ -161,1 +161,1 @@\n-    jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+    jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -189,1 +189,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -191,1 +191,1 @@\n-    JvmtiThreadState* state = current_thread->jvmti_thread_state();\n+    JvmtiThreadState* state = current->jvmti_thread_state();\n@@ -200,3 +200,3 @@\n-    MACOS_AARCH64_ONLY(ThreadWXEnable __wx(WXWrite, current_thread));\n-    ThreadInVMfromNative __tiv(current_thread);\n-    VM_ENTRY_BASE(jvmtiError, JvmtiEnv::GetThreadLocalStorage , current_thread)\n+    MACOS_AARCH64_ONLY(ThreadWXEnable __wx(WXWrite, current));\n+    ThreadInVMfromNative __tiv(current);\n+    VM_ENTRY_BASE(jvmtiError, JvmtiEnv::GetThreadLocalStorage , current)\n@@ -206,1 +206,1 @@\n-    ThreadsListHandle tlh(current_thread);\n+    ThreadsListHandle tlh(current);\n@@ -210,1 +210,1 @@\n-    jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+    jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -215,2 +215,2 @@\n-    HandleMark hm(current_thread);\n-    Handle thread_handle(current_thread, thread_obj);\n+    HandleMark hm(current);\n+    Handle thread_handle(current, thread_obj);\n@@ -589,1 +589,2 @@\n-    ThreadsListHandle tlh;\n+    JavaThread* current = JavaThread::current();\n+    ThreadsListHandle tlh(current);\n@@ -593,1 +594,1 @@\n-    jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), event_thread, &java_thread, &thread_obj);\n+    jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), event_thread, current, &java_thread, &thread_obj);\n@@ -858,1 +859,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -860,1 +861,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -864,1 +865,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_oop);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_oop);\n@@ -936,1 +937,1 @@\n-    err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_oop);\n+    err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_oop);\n@@ -1078,1 +1079,2 @@\n-  ThreadsListHandle tlh;\n+  JavaThread* current = JavaThread::current();\n+  ThreadsListHandle tlh(current);\n@@ -1082,1 +1084,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_oop);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_oop);\n@@ -1177,1 +1179,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -1180,1 +1182,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -1186,1 +1188,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_oop);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_oop);\n@@ -1214,2 +1216,2 @@\n-  JavaThread* current_thread  = JavaThread::current();\n-  HandleMark hm(current_thread);\n+  JavaThread* current = JavaThread::current();\n+  HandleMark hm(current);\n@@ -1218,1 +1220,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -1222,1 +1224,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -1229,1 +1231,1 @@\n-    Handle obj(current_thread, thread_obj);\n+    Handle obj(current, thread_obj);\n@@ -1236,1 +1238,1 @@\n-                            current_thread);\n+                            current);\n@@ -1348,2 +1350,2 @@\n-  JavaThread* calling_thread = JavaThread::current();\n-  HandleMark hm(calling_thread);\n+  JavaThread* current = JavaThread::current();\n+  HandleMark hm(current);\n@@ -1356,1 +1358,1 @@\n-  ThreadsListHandle tlh(calling_thread);\n+  ThreadsListHandle tlh(current);\n@@ -1360,1 +1362,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_oop);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_oop);\n@@ -1367,2 +1369,2 @@\n-    Handle thread_handle(calling_thread, thread_oop);\n-    EscapeBarrier eb(true, calling_thread, java_thread);\n+    Handle thread_handle(current, thread_oop);\n+    EscapeBarrier eb(true, current, java_thread);\n@@ -1374,1 +1376,1 @@\n-    GetOwnedMonitorInfoClosure op(this, calling_thread, owned_monitors_list);\n+    GetOwnedMonitorInfoClosure op(this, current, owned_monitors_list);\n@@ -1406,2 +1408,2 @@\n-  JavaThread* calling_thread = JavaThread::current();\n-  HandleMark hm(calling_thread);\n+  JavaThread* current = JavaThread::current();\n+  HandleMark hm(current);\n@@ -1414,1 +1416,1 @@\n-  ThreadsListHandle tlh(calling_thread);\n+  ThreadsListHandle tlh(current);\n@@ -1418,1 +1420,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_oop);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_oop);\n@@ -1425,2 +1427,2 @@\n-    Handle thread_handle(calling_thread, thread_oop);\n-    EscapeBarrier eb(true, calling_thread, java_thread);\n+    Handle thread_handle(current, thread_oop);\n+    EscapeBarrier eb(true, current, java_thread);\n@@ -1432,1 +1434,1 @@\n-    GetOwnedMonitorInfoClosure op(this, calling_thread, owned_monitors_list);\n+    GetOwnedMonitorInfoClosure op(this, current, owned_monitors_list);\n@@ -1722,2 +1724,2 @@\n-  JavaThread* current_thread = JavaThread::current();\n-  HandleMark hm(current_thread);\n+  JavaThread* current = JavaThread::current();\n+  HandleMark hm(current);\n@@ -1729,1 +1731,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -1733,2 +1735,2 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n-  Handle thread_handle(current_thread, thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n+  Handle thread_handle(current, thread_obj);\n@@ -1739,1 +1741,1 @@\n-  bool self = java_thread == current_thread;\n+  bool self = java_thread == current;\n@@ -1753,1 +1755,1 @@\n-  EscapeBarrier eb(true, current_thread, java_thread);\n+  EscapeBarrier eb(true, current, java_thread);\n@@ -1784,1 +1786,2 @@\n-  ThreadsListHandle tlh;\n+  JavaThread* current = JavaThread::current();\n+  ThreadsListHandle tlh(current);\n@@ -1788,1 +1791,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -1793,1 +1796,0 @@\n-  JavaThread* current = JavaThread::current();\n@@ -2040,1 +2042,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2043,2 +2045,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2046,1 +2048,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2050,1 +2052,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2057,2 +2059,2 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n-                                     current_thread, depth, slot, self);\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n+                                     current, depth, slot, self);\n@@ -2066,1 +2068,1 @@\n-    VM_GetOrSetLocal op(java_thread, current_thread, depth, slot, self);\n+    VM_GetOrSetLocal op(java_thread, current, depth, slot, self);\n@@ -2081,1 +2083,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2084,2 +2086,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2087,1 +2089,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2091,1 +2093,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2098,2 +2100,2 @@\n-    VM_VirtualThreadGetReceiver op(this, Handle(current_thread, thread_obj),\n-                                   current_thread, depth, self);\n+    VM_VirtualThreadGetReceiver op(this, Handle(current, thread_obj),\n+                                   current, depth, self);\n@@ -2107,1 +2109,1 @@\n-    VM_GetReceiver op(java_thread, current_thread, depth, self);\n+    VM_GetReceiver op(java_thread, current, depth, self);\n@@ -2123,1 +2125,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2126,2 +2128,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2129,1 +2131,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2133,1 +2135,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2140,1 +2142,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2165,1 +2167,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2168,2 +2170,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2171,1 +2173,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2175,1 +2177,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2182,1 +2184,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2207,1 +2209,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2210,2 +2212,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2213,1 +2215,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2217,1 +2219,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2224,1 +2226,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2249,1 +2251,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2252,2 +2254,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2255,1 +2257,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2259,1 +2261,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2266,1 +2268,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2290,1 +2292,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2293,2 +2295,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2296,1 +2298,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2300,1 +2302,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2309,1 +2311,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2327,1 +2329,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2330,2 +2332,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2333,1 +2335,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2337,1 +2339,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2346,1 +2348,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2364,1 +2366,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2367,2 +2369,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2370,1 +2372,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2374,1 +2376,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2383,1 +2385,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2401,1 +2403,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2404,2 +2406,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2407,1 +2409,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2411,1 +2413,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2420,1 +2422,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -2438,1 +2440,1 @@\n-  JavaThread* current_thread = JavaThread::current();\n+  JavaThread* current = JavaThread::current();\n@@ -2441,2 +2443,2 @@\n-  ResourceMark rm(current_thread);\n-  HandleMark hm(current_thread);\n+  ResourceMark rm(current);\n+  HandleMark hm(current);\n@@ -2444,1 +2446,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2448,1 +2450,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2457,1 +2459,1 @@\n-    VM_VirtualThreadGetOrSetLocal op(this, Handle(current_thread, thread_obj),\n+    VM_VirtualThreadGetOrSetLocal op(this, Handle(current, thread_obj),\n@@ -3712,2 +3714,2 @@\n-  JavaThread* current_thread = JavaThread::current();\n-  ThreadsListHandle tlh(current_thread);\n+  JavaThread* current = JavaThread::current();\n+  ThreadsListHandle tlh(current);\n@@ -3717,1 +3719,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_oop);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_oop);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnv.cpp","additions":126,"deletions":124,"binary":false,"changes":250,"status":"modified"},{"patch":"@@ -1424,8 +1424,0 @@\n-jvmtiError\n-JvmtiEnvBase::get_threadOop_and_JavaThread(ThreadsList* t_list, jthread thread,\n-                                           JavaThread** jt_pp, oop* thread_oop_p) {\n-  JavaThread* cur_thread = JavaThread::current();\n-  jvmtiError err = get_threadOop_and_JavaThread(t_list, thread, cur_thread, jt_pp, thread_oop_p);\n-  return err;\n-}\n-\n@@ -1984,1 +1976,1 @@\n-  jvmtiError err = JvmtiEnvBase::get_threadOop_and_JavaThread(tlh.list(), target, &java_thread, &thread_obj);\n+  jvmtiError err = JvmtiEnvBase::get_threadOop_and_JavaThread(tlh.list(), target, current, &java_thread, &thread_obj);\n@@ -2172,2 +2164,2 @@\n-  JavaThread* current_thread = JavaThread::current();\n-  HandleMark hm(current_thread);\n+  JavaThread* current = JavaThread::current();\n+  HandleMark hm(current);\n@@ -2176,1 +2168,1 @@\n-  ThreadsListHandle tlh(current_thread);\n+  ThreadsListHandle tlh(current);\n@@ -2180,1 +2172,1 @@\n-  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, &java_thread, &thread_obj);\n+  jvmtiError err = get_threadOop_and_JavaThread(tlh.list(), thread, current, &java_thread, &thread_obj);\n@@ -2185,2 +2177,2 @@\n-  Handle thread_handle(current_thread, thread_obj);\n-  bool self = java_thread == current_thread;\n+  Handle thread_handle(current, thread_obj);\n+  bool self = java_thread == current;\n@@ -2200,1 +2192,1 @@\n-  EscapeBarrier eb(true, current_thread, java_thread);\n+  EscapeBarrier eb(true, current, java_thread);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":8,"deletions":16,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -219,2 +219,0 @@\n-  static jvmtiError get_threadOop_and_JavaThread(ThreadsList* t_list, jthread thread,\n-                                                 JavaThread** jt_pp, oop* thread_oop_p);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"}]}