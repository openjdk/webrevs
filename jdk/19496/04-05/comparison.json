{"files":[{"patch":"@@ -430,8 +430,3 @@\n-bool MemNode::all_controls_dominate(Node* dom, Node* sub, bool *dead_code) {\n-  bool dummy_flag, &dead_code_flag = dead_code != nullptr ? *dead_code : dummy_flag;\n-  dead_code_flag = false;\n-\n-  if (dom == nullptr || dom->is_top() || sub == nullptr || sub->is_top()) {\n-    dead_code_flag = true;\n-    return false; \/\/ Conservative answer for dead code\n-  }\n+Node::DomResult MemNode::all_controls_dominate(Node* dom, Node* sub) {\n+  if (dom == nullptr || dom->is_top() || sub == nullptr || sub->is_top())\n+    return DomResult::EncounteredDeadCode; \/\/ Conservative answer for dead code\n@@ -441,4 +436,2 @@\n-  if (dom == nullptr || dom->is_top()) {\n-    dead_code_flag = true;\n-    return false; \/\/ Conservative answer for dead code\n-  }\n+  if (dom == nullptr || dom->is_top())\n+    return DomResult::EncounteredDeadCode; \/\/ Conservative answer for dead code\n@@ -449,1 +442,1 @@\n-    return false;\n+    return DomResult::NotDominate;\n@@ -453,1 +446,1 @@\n-    return true;\n+    return DomResult::Dominate;\n@@ -467,4 +460,2 @@\n-  if (sub == nullptr || sub->is_top()) {\n-    dead_code_flag = true;\n-    return false; \/\/ Conservative answer for dead code\n-  }\n+  if (sub == nullptr || sub->is_top())\n+    return DomResult::EncounteredDeadCode; \/\/ Conservative answer for dead code\n@@ -475,1 +466,1 @@\n-    return true;\n+    return DomResult::Dominate;\n@@ -478,1 +469,1 @@\n-    return false;\n+    return DomResult::NotDominate;\n@@ -493,1 +484,1 @@\n-        return false; \/\/ One of dom's inputs dominated by sub.\n+        return DomResult::NotDominate; \/\/ One of dom's inputs dominated by sub.\n@@ -497,4 +488,2 @@\n-        if (n == nullptr || n->is_top()) {\n-          dead_code_flag = true;\n-          return false; \/\/ Conservative answer for dead code\n-        }\n+        if (n == nullptr || n->is_top())\n+          return DomResult::EncounteredDeadCode; \/\/ Conservative answer for dead code\n@@ -506,2 +495,2 @@\n-        bool dead_code;\n-        if (n->dominates(sub, nlist, dead_code)) {\n+        DomResult dom_result = n->dominates(sub, nlist);\n+        if (dom_result == DomResult::Dominate)\n@@ -509,4 +498,2 @@\n-        } else {\n-          if (dead_code) dead_code_flag = true;\n-          return false;\n-        }\n+        else\n+          return dom_result;\n@@ -517,4 +504,2 @@\n-          if (m->is_top()) {\n-            dead_code_flag = true;\n-            return false; \/\/ Conservative answer for dead code\n-          }\n+          if (m->is_top())\n+            return DomResult::EncounteredDeadCode; \/\/ Conservative answer for dead code\n@@ -533,1 +518,1 @@\n-    return only_dominating_controls;\n+    return only_dominating_controls ? DomResult::Dominate : DomResult::NotDominate;\n@@ -555,1 +540,1 @@\n-    return all_controls_dominate(p2, a1);\n+    return all_controls_dominate(p2, a1) == DomResult::Dominate;\n@@ -557,1 +542,1 @@\n-    return all_controls_dominate(p1, a2);\n+    return all_controls_dominate(p1, a2) == DomResult::Dominate;\n@@ -753,1 +738,1 @@\n-      else if (all_controls_dominate(this, st_alloc))\n+      else if (all_controls_dominate(this, st_alloc) == DomResult::Dominate)\n@@ -1585,1 +1570,1 @@\n-    if (!MemNode::all_controls_dominate(mem, base->in(0)))\n+    if (MemNode::all_controls_dominate(mem, base->in(0)) != DomResult::Dominate)\n@@ -1588,1 +1573,1 @@\n-    if (!MemNode::all_controls_dominate(mem, base->in(0))) {\n+    if (MemNode::all_controls_dominate(mem, base->in(0)) != DomResult::Dominate) {\n@@ -1677,1 +1662,1 @@\n-  bool dead_code, can_not_split = false;\n+  DomResult dom_result = DomResult::Dominate;\n@@ -1683,2 +1668,2 @@\n-    if (!MemNode::all_controls_dominate(address, region, &dead_code))\n-      can_not_split = true;\n+    \/\/ We will check `dom_result` later.\n+    dom_result = MemNode::all_controls_dominate(address, region);\n@@ -1689,2 +1674,2 @@\n-    if (!MemNode::all_controls_dominate(mem, region, &dead_code))\n-      can_not_split = true;\n+    \/\/ We will check `dom_result` later.\n+    dom_result = MemNode::all_controls_dominate(mem, region);\n@@ -1693,1 +1678,2 @@\n-    if (MemNode::all_controls_dominate(mem, base->in(0))) {\n+    dom_result = MemNode::all_controls_dominate(mem, base->in(0));\n+    if (dom_result == DomResult::Dominate) {\n@@ -1695,2 +1681,0 @@\n-    } else if (MemNode::all_controls_dominate(address, mem->in(0), &dead_code)) {\n-      region = mem->in(0);\n@@ -1698,1 +1682,5 @@\n-      can_not_split = true; \/\/ complex graph\n+      dom_result = MemNode::all_controls_dominate(address, mem->in(0));\n+      if (dom_result == DomResult::Dominate) {\n+        region = mem->in(0);\n+      }\n+      \/\/ Otherwise we encounter a complex graph.\n@@ -1704,3 +1692,5 @@\n-  if (can_not_split) {\n-    \/\/ Wait for the dead code to be removed.\n-    if (dead_code) igvn->_worklist.push(this);\n+  if (dom_result != DomResult::Dominate) {\n+    if (dom_result == DomResult::EncounteredDeadCode) {\n+      \/\/ Wait for the dead code to be removed.\n+      igvn->_worklist.push(this);\n+    }\n@@ -1857,1 +1847,1 @@\n-        && all_controls_dominate(base, phase->C->start())) {\n+        && all_controls_dominate(base, phase->C->start()) == DomResult::Dominate) {\n@@ -4591,1 +4581,1 @@\n-      if (!MemNode::all_controls_dominate(n, this))\n+      if (MemNode::all_controls_dominate(n, this) != DomResult::Dominate)\n","filename":"src\/hotspot\/share\/opto\/memnode.cpp","additions":45,"deletions":55,"binary":false,"changes":100,"status":"modified"},{"patch":"@@ -109,1 +109,1 @@\n-  static bool all_controls_dominate(Node* dom, Node* sub, bool *dead_code = nullptr);\n+  static DomResult all_controls_dominate(Node* dom, Node* sub);\n","filename":"src\/hotspot\/share\/opto\/memnode.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1252,1 +1252,1 @@\n-bool Node::dominates(Node* sub, Node_List &nlist, bool &dead_code) {\n+Node::DomResult Node::dominates(Node* sub, Node_List &nlist) {\n@@ -1262,1 +1262,0 @@\n-  dead_code      = false;\n@@ -1275,2 +1274,1 @@\n-      dead_code = true;\n-      break;\n+      return DomResult::EncounteredDeadCode;\n@@ -1282,1 +1280,1 @@\n-        return true;\n+        return DomResult::Dominate;\n@@ -1296,1 +1294,1 @@\n-      return met_dom;\n+      return met_dom ? DomResult::Dominate : DomResult::NotDominate;\n@@ -1327,1 +1325,1 @@\n-            return false;\n+            return DomResult::NotDominate;\n@@ -1370,2 +1368,1 @@\n-  \/\/ Conservative answer for dead code.\n-  return false;\n+  return DomResult::NotDominate;\n","filename":"src\/hotspot\/share\/opto\/node.cpp","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -1108,0 +1108,6 @@\n+  \/\/ Results of the dominance analysis.\n+  enum class DomResult {\n+    NotDominate,         \/\/ 'this' node does not dominate 'sub'.\n+    Dominate,            \/\/ 'this' node dominates or is equal to 'sub'.\n+    EncounteredDeadCode, \/\/ Result is undefined due to encountering dead code.\n+  };\n@@ -1109,1 +1115,1 @@\n-  bool dominates(Node* sub, Node_List &nlist, bool &dead_code);\n+  DomResult dominates(Node* sub, Node_List &nlist);\n","filename":"src\/hotspot\/share\/opto\/node.hpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}