{"files":[{"patch":"@@ -461,0 +461,1 @@\n+  assert(!thread->is_Java_thread() || JavaThread::cast(thread)->thread_state() == _thread_in_vm, \"invariant\");\n@@ -522,1 +523,1 @@\n-  JavaThread* const _jt;\n+  JavaThread* _jt;\n@@ -526,1 +527,1 @@\n-  JavaThreadInVMAndNative(Thread* t) : _jt(t->is_Java_thread() ? JavaThread::cast(t) : nullptr),\n+  JavaThreadInVMAndNative(Thread* t) : _jt(nullptr),\n@@ -528,1 +529,2 @@\n-    if (_jt != nullptr) {\n+    if (t != nullptr && t->is_Java_thread()) {\n+      _jt = JavaThread::cast(t);\n@@ -538,0 +540,1 @@\n+      assert(_jt != nullptr, \"invariant\");\n@@ -577,0 +580,1 @@\n+      JavaThreadInVMAndNative jtivm(thread);\n@@ -578,1 +582,0 @@\n-        JavaThreadInVMAndNative jtivm(thread);\n@@ -582,0 +585,2 @@\n+      \/\/ Transition to a safe safepoint state for the infinite sleep. A nop for non-java threads.\n+      jtivm.transition_to_native();\n","filename":"src\/hotspot\/share\/jfr\/recorder\/repository\/jfrEmergencyDump.cpp","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"}]}