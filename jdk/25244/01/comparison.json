{"files":[{"patch":"@@ -37,0 +37,1 @@\n+import java.lang.reflect.InvocationTargetException;\n@@ -48,1 +49,1 @@\n-public class RootPaneDefaultButtonTest extends JDialog {\n+public class RootPaneDefaultButtonTest {\n@@ -53,0 +54,75 @@\n+    static class TestDialog extends JDialog {\n+        JRadioButton radioButton1 = new JRadioButton(\n+                \"\\\"Button 1\\\" is the default button\");\n+        JRadioButton radioButton2 = new JRadioButton(\n+                \"\\\"Button 2\\\" is the default button\");\n+        JRadioButton radioButton3 = new JRadioButton(\"No default button\");\n+\n+        JButton button1 = new JButton(\"Button 1\");\n+        JButton button2 = new JButton(\"Button 2\");\n+\n+        TestDialog() {\n+            getContentPane().setLayout(new BorderLayout());\n+            getContentPane().add(createRadioButtonPanel(), BorderLayout.NORTH);\n+            getContentPane().add(createPushButtonRow(), BorderLayout.SOUTH);\n+            pack();\n+\n+            radioButton1.addActionListener(new ActionListener() {\n+                @Override\n+                public void actionPerformed(ActionEvent e) {\n+                    getRootPane().setDefaultButton(button1);\n+                }\n+            });\n+\n+            radioButton2.addActionListener(new ActionListener() {\n+                @Override\n+                public void actionPerformed(ActionEvent e) {\n+                    getRootPane().setDefaultButton(button2);\n+                }\n+            });\n+\n+            radioButton3.addActionListener(new ActionListener() {\n+                @Override\n+                public void actionPerformed(ActionEvent e) {\n+                    getRootPane().setDefaultButton(null);\n+                }\n+            });\n+\n+            ButtonGroup g = new ButtonGroup();\n+            g.add(radioButton1);\n+            g.add(radioButton2);\n+            g.add(radioButton3);\n+            radioButton1.doClick();\n+        }\n+\n+        private JPanel createPushButtonRow() {\n+            JPanel p = new JPanel(new GridLayout(1, 2));\n+            p.add(button1);\n+            p.add(button2);\n+            p.setBorder(new EmptyBorder(5,5,5,5));\n+            return p;\n+        }\n+\n+        private JPanel createRadioButtonPanel() {\n+            JPanel p = new JPanel(new GridLayout(3, 1));\n+            p.add(radioButton1);\n+            p.add(radioButton2);\n+            p.add(radioButton3);\n+            p.setBorder(new EmptyBorder(5,5,5,5));\n+            return p;\n+        }\n+    }\n+\n+    private static boolean isSimilar(Color c1, Color c2) {\n+        if (Math.abs(c1.getRed() - c2.getRed()) > 15) {\n+            return false;\n+        }\n+        if (Math.abs(c1.getGreen() - c2.getGreen()) > 15) {\n+            return false;\n+        }\n+        if (Math.abs(c1.getBlue() - c2.getBlue()) > 15) {\n+            return false;\n+        }\n+        return true;\n+    }\n+\n@@ -59,2 +135,3 @@\n-        RootPaneDefaultButtonTest window1 = new RootPaneDefaultButtonTest();\n-        RootPaneDefaultButtonTest window2 = new RootPaneDefaultButtonTest();\n+        RootPaneDefaultButtonTest test = new RootPaneDefaultButtonTest();\n+        test.run();\n+    }\n@@ -62,6 +139,2 @@\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            @Override\n-            public void run() {\n-                Rectangle r1 = new Rectangle(0, 20,\n-                        window1.getWidth(), window1.getHeight());\n-                window1.setBounds(r1);\n+    TestDialog window1, window2;\n+    Robot robot;\n@@ -69,3 +142,4 @@\n-                Rectangle r2 = new Rectangle((int) (r1.getMaxX() + 10), 20,\n-                        window2.getWidth(), window2.getHeight());\n-                window2.setBounds(r2);\n+    public RootPaneDefaultButtonTest() throws Exception {\n+        SwingUtilities.invokeAndWait(() -> {\n+            window1 = new TestDialog();\n+            window2 = new TestDialog();\n@@ -73,3 +147,10 @@\n-                window1.setVisible(true);\n-                window2.setVisible(true);\n-            }\n+            Rectangle r1 = new Rectangle(0, 20,\n+                    window1.getWidth(), window1.getHeight());\n+            window1.setBounds(r1);\n+\n+            Rectangle r2 = new Rectangle((int) (r1.getMaxX() + 10), 20,\n+                    window2.getWidth(), window2.getHeight());\n+            window2.setBounds(r2);\n+\n+            window1.setVisible(true);\n+            window2.setVisible(true);\n@@ -77,0 +158,3 @@\n+        robot = new Robot();\n+    }\n+\n@@ -78,1 +162,5 @@\n-        Robot robot = new Robot();\n+    \/**\n+     * This is not run on the EDT; once it finishes this test is complete.\n+     *\/\n+    private void run() throws Exception {\n+        robot.delay(1000);\n@@ -119,2 +207,2 @@\n-    private static void test(Robot robot, AbstractButton buttonToClick,\n-                             ButtonRenderingExpectation... expectations)\n+    private void test(Robot robot, AbstractButton buttonToClick,\n+                      ButtonRenderingExpectation... expectations)\n@@ -131,1 +219,1 @@\n-        robot.delay(100);\n+        robot.delay(1000);\n@@ -142,12 +230,18 @@\n-        for (ButtonRenderingExpectation expectation : expectations) {\n-            int x = expectation.button.getLocationOnScreen().x + 20;\n-            int y = expectation.button.getLocationOnScreen().y + 10;\n-\n-            \/\/ this mouseMove is optional, but it helps debug this test to see\n-            \/\/ where we're sampling the pixel color from:\n-            robot.mouseMove(x, y);\n-\n-            Color c = robot.getPixelColor(x, y);\n-            if (expectation.appearAsDefault) {\n-                if (defaultColor == null) {\n-                    defaultColor = c;\n+        for (int a = 0; a < expectations.length; a++) {\n+            try {\n+                ButtonRenderingExpectation expectation = expectations[a];\n+                int x = expectation.button.getLocationOnScreen().x + 20;\n+                int y = expectation.button.getLocationOnScreen().y + 10;\n+\n+                \/\/ this mouseMove is optional, but it helps debug this test to see\n+                \/\/ where we're sampling the pixel color from:\n+                robot.mouseMove(x, y);\n+\n+                Color c = robot.getPixelColor(x, y);\n+                if (expectation.appearAsDefault) {\n+                    if (defaultColor == null) {\n+                        defaultColor = c;\n+                    } else {\n+                        throw new IllegalStateException(\n+                                \"there should only be at most 1 default button\");\n+                    }\n@@ -155,2 +249,7 @@\n-                    throw new IllegalStateException(\n-                            \"there should only be at most 1 default button\");\n+                    if (nonDefaultColor == null) {\n+                        nonDefaultColor = c;\n+                    } else if (!isSimilar(nonDefaultColor, c)) {\n+                        throw new IllegalStateException(\n+                                \"these two colors should match: \" + c + \", \" +\n+                                        nonDefaultColor);\n+                    }\n@@ -158,4 +257,3 @@\n-            } else {\n-                if (nonDefaultColor == null) {\n-                    nonDefaultColor = c;\n-                } else if (!isSimilar(nonDefaultColor, c)) {\n+\n+                if (defaultColor != null && nonDefaultColor != null &&\n+                        isSimilar(defaultColor, nonDefaultColor)) {\n@@ -163,1 +261,2 @@\n-                            \"these two colors should match: \" + c + \", \" +\n+                            \"The default button and non-default buttons should \" +\n+                                    \"look different: \" + defaultColor + \" matches \" +\n@@ -166,0 +265,4 @@\n+            } catch(Exception e) {\n+                System.err.println(\"a = \" + a + \" defaultColor = \" +\n+                        defaultColor + \" nonDefaultColor = \" + nonDefaultColor);\n+                throw e;\n@@ -168,80 +271,0 @@\n-\n-        if (defaultColor != null && isSimilar(defaultColor, nonDefaultColor)) {\n-            throw new IllegalStateException(\n-                    \"The default button and non-default buttons should \" +\n-                            \"look different: \" + defaultColor + \" matches \" +\n-                            nonDefaultColor);\n-        }\n-    }\n-\n-    private static boolean isSimilar(Color c1, Color c2) {\n-        if (Math.abs(c1.getRed() - c2.getRed()) > 15) {\n-            return false;\n-        }\n-        if (Math.abs(c1.getGreen() - c2.getGreen()) > 15) {\n-            return false;\n-        }\n-        if (Math.abs(c1.getBlue() - c2.getBlue()) > 15) {\n-            return false;\n-        }\n-        return true;\n-    }\n-\n-    JRadioButton radioButton1 = new JRadioButton(\n-            \"\\\"Button 1\\\" is the default button\");\n-    JRadioButton radioButton2 = new JRadioButton(\n-            \"\\\"Button 2\\\" is the default button\");\n-    JRadioButton radioButton3 = new JRadioButton(\"No default button\");\n-\n-    JButton button1 = new JButton(\"Button 1\");\n-    JButton button2 = new JButton(\"Button 2\");\n-\n-    public RootPaneDefaultButtonTest() {\n-        getContentPane().setLayout(new BorderLayout());\n-        getContentPane().add(createRadioButtonPanel(), BorderLayout.NORTH);\n-        getContentPane().add(createPushButtonRow(), BorderLayout.SOUTH);\n-        pack();\n-\n-        radioButton1.addActionListener(new ActionListener() {\n-            @Override\n-            public void actionPerformed(ActionEvent e) {\n-                getRootPane().setDefaultButton(button1);\n-            }\n-        });\n-\n-        radioButton2.addActionListener(new ActionListener() {\n-            @Override\n-            public void actionPerformed(ActionEvent e) {\n-                getRootPane().setDefaultButton(button2);\n-            }\n-        });\n-\n-        radioButton3.addActionListener(new ActionListener() {\n-            @Override\n-            public void actionPerformed(ActionEvent e) {\n-                getRootPane().setDefaultButton(null);\n-            }\n-        });\n-\n-        ButtonGroup g = new ButtonGroup();\n-        g.add(radioButton1);\n-        g.add(radioButton2);\n-        g.add(radioButton3);\n-        radioButton1.doClick();\n-    }\n-\n-    private JPanel createPushButtonRow() {\n-        JPanel p = new JPanel(new GridLayout(1, 2));\n-        p.add(button1);\n-        p.add(button2);\n-        p.setBorder(new EmptyBorder(5,5,5,5));\n-        return p;\n-    }\n-\n-    private JPanel createRadioButtonPanel() {\n-        JPanel p = new JPanel(new GridLayout(3, 1));\n-        p.add(radioButton1);\n-        p.add(radioButton2);\n-        p.add(radioButton3);\n-        p.setBorder(new EmptyBorder(5,5,5,5));\n-        return p;\n","filename":"test\/jdk\/com\/apple\/laf\/RootPane\/RootPaneDefaultButtonTest.java","additions":141,"deletions":118,"binary":false,"changes":259,"status":"modified"}]}