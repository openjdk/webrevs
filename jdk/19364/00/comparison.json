{"files":[{"patch":"@@ -26,1 +26,0 @@\n-#include \"gc\/g1\/g1CollectedHeap.inline.hpp\"\n@@ -60,4 +59,0 @@\n-  guarantee(_surv_rate_predictors[0] != nullptr, \"invariant\" );\n-  const double initial_surv_rate = 0.4;\n-  _surv_rate_predictors[0]->add(initial_surv_rate);\n-  _last_pred = _accum_surv_rate_pred[0] = initial_surv_rate;\n@@ -78,0 +73,1 @@\n+      \/\/ Initialize predictors and accumulated survivor rate predictions.\n@@ -79,0 +75,2 @@\n+      _surv_rate_predictors[i]->add(InitialSurvivorRate);\n+      _accum_surv_rate_pred[i] = ((i == 0) ? 0.0 : _accum_surv_rate_pred[i-1]) + InitialSurvivorRate;\n@@ -80,0 +78,1 @@\n+    _last_pred = InitialSurvivorRate;\n@@ -99,0 +98,13 @@\n+double G1SurvRateGroup::accum_surv_rate_pred(uint age) const {\n+  assert(_stats_arrays_length > 0, \"invariant\" );\n+  double result;\n+  if (age < _stats_arrays_length) {\n+    result = _accum_surv_rate_pred[age];\n+  } else {\n+    double diff = (double)(age - _stats_arrays_length + 1);\n+    result = _accum_surv_rate_pred[_stats_arrays_length - 1] + diff * _last_pred;\n+  }\n+  assert(result <= (age + 1.0), \"Accumulated survivor rate %.2f must be smaller than age+1 %u\", result, age + 1);\n+  return result;\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1SurvRateGroup.cpp","additions":17,"deletions":5,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -55,0 +55,3 @@\n+  \/\/ The initial survivor rate for predictors. Somewhat random value.\n+  const double InitialSurvivorRate = 0.4;\n+\n@@ -76,9 +79,1 @@\n-  double accum_surv_rate_pred(uint age) const {\n-    assert(_stats_arrays_length > 0, \"invariant\" );\n-    if (age < _stats_arrays_length)\n-      return _accum_surv_rate_pred[age];\n-    else {\n-      double diff = (double)(age - _stats_arrays_length + 1);\n-      return _accum_surv_rate_pred[_stats_arrays_length - 1] + diff * _last_pred;\n-    }\n-  }\n+  double accum_surv_rate_pred(uint age) const;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1SurvRateGroup.hpp","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"}]}