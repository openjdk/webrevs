{"files":[{"patch":"@@ -28,6 +28,5 @@\n-import com.sun.net.httpserver.Headers;\n-import com.sun.net.httpserver.HttpExchange;\n-import com.sun.net.httpserver.HttpHandler;\n-import com.sun.net.httpserver.HttpHandlers;\n-\n-import java.io.*;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.io.RandomAccessFile;\n+import java.io.UncheckedIOException;\n@@ -41,0 +40,1 @@\n+import java.util.Comparator;\n@@ -45,1 +45,4 @@\n-\n+import com.sun.net.httpserver.Headers;\n+import com.sun.net.httpserver.HttpExchange;\n+import com.sun.net.httpserver.HttpHandler;\n+import com.sun.net.httpserver.HttpHandlers;\n@@ -365,1 +368,22 @@\n-        return ranges;\n+        return normalizeRanges(ranges);\n+    }\n+\n+    private static List<RangeEntry> normalizeRanges(List<RangeEntry> ranges) {\n+        if (ranges.isEmpty()) {\n+            return List.of();\n+        }\n+        List<RangeEntry> sorted = new ArrayList<>(ranges);\n+        sorted.sort(Comparator.comparingLong(r -> r.start));\n+        List<RangeEntry> normalized = new ArrayList<>();\n+        RangeEntry current = sorted.get(0);\n+        for (int i = 1; i < sorted.size(); i++) {\n+            RangeEntry range = sorted.get(i);\n+            if (range.start <= current.end + 1) {\n+                current = new RangeEntry(current.start, Math.max(current.end, range.end));\n+            } else {\n+                normalized.add(current);\n+                current = range;\n+            }\n+        }\n+        normalized.add(current);\n+        return normalized;\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/simpleserver\/FileServerHandler.java","additions":32,"deletions":8,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -112,2 +112,2 @@\n-                        1000L, \"bytes=0-499,500-999\",\n-                        new FileServerHandler.RangeEntry(0, 499),\n+                        1000L, \"bytes=0-400,500-999\",\n+                        new FileServerHandler.RangeEntry(0, 400),\n@@ -125,1 +125,22 @@\n-                }\n+                },\n+                \/\/ merging overlapping or contiguous ranges\n+                {\n+                        1000L, \"bytes=0-499,400-599,600-999\",\n+                        new FileServerHandler.RangeEntry(0, 999)\n+                },\n+                {\n+                        1000L, \"bytes=0-499,500-699,550-999\",\n+                        new FileServerHandler.RangeEntry(0, 999)\n+                },\n+                {\n+                        1000L, \"bytes=0-499,500-999\",\n+                        new FileServerHandler.RangeEntry(0,999)\n+                },\n+                {\n+                        1000L, \"bytes=100-199,50-149\",\n+                        new FileServerHandler.RangeEntry(50,199)\n+                },\n+                {\n+                        1000L, \"bytes=100-199,300-399,150-350\",\n+                        new FileServerHandler.RangeEntry(100,399)\n+                },\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/simpleserver\/FileServerHandlerTest.java","additions":24,"deletions":3,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -177,1 +177,1 @@\n-                    .header(\"Range\", \"bytes=2-,3-4,-3\")\n+                    .header(\"Range\", \"bytes=1-2,4-5,7-\")\n@@ -190,2 +190,2 @@\n-                assertEquals(firstPartLines[1], \"Content-Range: bytes 2-9\/10\");\n-                assertEquals(firstPartLines[3], \"23456789\");\n+                assertEquals(firstPartLines[1], \"Content-Range: bytes 1-2\/10\");\n+                assertEquals(firstPartLines[3], \"12\");\n@@ -196,2 +196,2 @@\n-                assertEquals(secondPartLines[1], \"Content-Range: bytes 3-4\/10\");\n-                assertEquals(secondPartLines[3], \"34\");\n+                assertEquals(secondPartLines[1], \"Content-Range: bytes 4-5\/10\");\n+                assertEquals(secondPartLines[3], \"45\");\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/simpleserver\/SimpleFileServerTest.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"}]}