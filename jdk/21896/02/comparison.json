{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,3 @@\n+import java.io.File;\n+import java.awt.image.BufferedImage;\n+import static java.awt.image.BufferedImage.TYPE_INT_RGB;\n@@ -29,0 +32,1 @@\n+import javax.imageio.ImageIO;\n@@ -43,0 +47,1 @@\n+ * @run main\/othervm\/timeout=360 CloseOnMouseClickPropertyTest\n@@ -54,0 +59,2 @@\n+    private static Robot robot;\n+    private static boolean isShowing;\n@@ -89,1 +96,2 @@\n-\n+        robot = new Robot();\n+        robot.setAutoDelay(100);\n@@ -92,0 +100,1 @@\n+            System.out.println(\"L&F \" + info.getClassName());\n@@ -93,0 +102,1 @@\n+                System.out.println(\"testItem \" + testItem);\n@@ -99,22 +109,21 @@\n-\n-        Robot robot = new Robot();\n-        robot.setAutoDelay(50);\n-        SwingUtilities.invokeAndWait(() -> createAndShowGUI(item));\n-        robot.waitForIdle();\n-\n-        Point point = getClickPoint(true);\n-        robot.mouseMove(point.x, point.y);\n-        robot.mousePress(InputEvent.BUTTON1_MASK);\n-        robot.mouseRelease(InputEvent.BUTTON1_MASK);\n-        robot.waitForIdle();\n-\n-        point = getClickPoint(false);\n-        robot.mouseMove(point.x, point.y);\n-        robot.mousePress(InputEvent.BUTTON1_MASK);\n-        robot.mouseRelease(InputEvent.BUTTON1_MASK);\n-        robot.waitForIdle();\n-\n-        SwingUtilities.invokeAndWait(() -> {\n-            JMenuItem menuItem = menu.getItem(0);\n-            boolean isShowing = menuItem.isShowing();\n-            frame.dispose();\n+        try {\n+            SwingUtilities.invokeAndWait(() -> createAndShowGUI(item));\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+\n+            Point point = getClickPoint(true);\n+            robot.mouseMove(point.x, point.y);\n+            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            robot.waitForIdle();\n+\n+            point = getClickPoint(false);\n+            robot.mouseMove(point.x, point.y);\n+            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            robot.waitForIdle();\n+\n+            SwingUtilities.invokeAndWait(() -> {\n+                JMenuItem menuItem = menu.getItem(0);\n+                isShowing = menuItem.isShowing();\n+            });\n@@ -122,0 +131,3 @@\n+                Rectangle bounds = frame.getBounds();\n+                BufferedImage img = new BufferedImage(bounds.width, bounds.height, TYPE_INT_RGB);\n+                ImageIO.write(img, \"png\", new File(\"CloseOnMouseClickPropertyTest.png\"));\n@@ -124,1 +136,7 @@\n-        });\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n+        }\n@@ -131,1 +149,0 @@\n-        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n@@ -141,0 +158,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/javax\/swing\/JMenuItem\/8158566\/CloseOnMouseClickPropertyTest.java","additions":44,"deletions":26,"binary":false,"changes":70,"status":"modified"}]}