{"files":[{"patch":"@@ -26,0 +26,1 @@\n+import java.util.concurrent.Semaphore;\n@@ -713,4 +714,3 @@\n-        Context con = null;\n-        synchronized (this.context) {\n-            con = this.context.inuse ? new Context() : this.context;\n-            con.reset(target, start, end, this.numberOfClosures);\n+        Context con = this.context;\n+        if (!con.claim()) {\n+            con = new Context();\n@@ -718,0 +718,1 @@\n+        con.reset(target, start, end, this.numberOfClosures);\n@@ -737,1 +738,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -755,1 +756,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -758,1 +759,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -771,1 +772,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -842,1 +843,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -845,1 +846,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -898,4 +899,3 @@\n-        Context con = null;\n-        synchronized (this.context) {\n-            con = this.context.inuse ? new Context() : this.context;\n-            con.reset(target, start, end, this.numberOfClosures);\n+        Context con = this.context;\n+        if (!con.claim()) {\n+            con = new Context();\n@@ -903,0 +903,1 @@\n+        con.reset(target, start, end, this.numberOfClosures);\n@@ -928,1 +929,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -946,1 +947,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -949,1 +950,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -962,1 +963,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1033,1 +1034,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1036,1 +1037,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1578,4 +1579,3 @@\n-        Context con = null;\n-        synchronized (this.context) {\n-            con = this.context.inuse ? new Context() : this.context;\n-            con.reset(target, start, end, this.numberOfClosures);\n+        Context con = this.context;\n+        if (!con.claim()) {\n+            con = new Context();\n@@ -1583,0 +1583,1 @@\n+        con.reset(target, start, end, this.numberOfClosures);\n@@ -1602,1 +1603,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1620,1 +1621,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1623,1 +1624,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1636,1 +1637,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1707,1 +1708,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1710,1 +1711,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -2018,1 +2019,1 @@\n-        boolean inuse = false;\n+        private final Semaphore inuse = new Semaphore(1);\n@@ -2032,1 +2033,0 @@\n-            setInUse(true);\n@@ -2085,2 +2085,7 @@\n-        synchronized void setInUse(boolean inUse) {\n-            this.inuse = inUse;\n+\n+        boolean claim() {\n+            return inuse.tryAcquire();\n+        }\n+\n+        void release() {\n+            inuse.release();\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/xpath\/regex\/RegularExpression.java","additions":39,"deletions":34,"binary":false,"changes":73,"status":"modified"}]}