{"files":[{"patch":"@@ -713,4 +713,3 @@\n-        Context con = null;\n-        synchronized (this.context) {\n-            con = this.context.inuse ? new Context() : this.context;\n-            con.reset(target, start, end, this.numberOfClosures);\n+        Context con = this.context;\n+        if (!con.claim()) {\n+            con = new Context();\n@@ -718,0 +717,1 @@\n+        con.reset(target, start, end, this.numberOfClosures);\n@@ -737,1 +737,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -755,1 +755,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -758,1 +758,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -771,1 +771,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -842,1 +842,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -845,1 +845,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -898,4 +898,3 @@\n-        Context con = null;\n-        synchronized (this.context) {\n-            con = this.context.inuse ? new Context() : this.context;\n-            con.reset(target, start, end, this.numberOfClosures);\n+        Context con = this.context;\n+        if (!con.claim()) {\n+            con = new Context();\n@@ -903,0 +902,1 @@\n+        con.reset(target, start, end, this.numberOfClosures);\n@@ -928,1 +928,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -946,1 +946,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -949,1 +949,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -962,1 +962,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1033,1 +1033,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1036,1 +1036,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1578,4 +1578,3 @@\n-        Context con = null;\n-        synchronized (this.context) {\n-            con = this.context.inuse ? new Context() : this.context;\n-            con.reset(target, start, end, this.numberOfClosures);\n+        Context con = this.context;\n+        if (!con.claim()) {\n+            con = new Context();\n@@ -1583,0 +1582,1 @@\n+        con.reset(target, start, end, this.numberOfClosures);\n@@ -1602,1 +1602,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1620,1 +1620,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1623,1 +1623,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1636,1 +1636,1 @@\n-                con.setInUse(false);\n+                con.release();\n@@ -1707,1 +1707,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -1710,1 +1710,1 @@\n-            con.setInUse(false);\n+            con.release();\n@@ -2018,1 +2018,1 @@\n-        boolean inuse = false;\n+        private volatile boolean inuse = true;\n@@ -2031,0 +2031,2 @@\n+            assert (inuse == true);\n+\n@@ -2032,1 +2034,0 @@\n-            setInUse(true);\n@@ -2085,2 +2086,13 @@\n-        synchronized void setInUse(boolean inUse) {\n-            this.inuse = inUse;\n+\n+        boolean claim() {\n+            if (inuse) {\n+                return false;\n+            }\n+            synchronized (this) {\n+                if (inuse) {\n+                    return false;\n+                } else {\n+                    inuse = true;\n+                    return true;\n+                }\n+            }\n@@ -2088,0 +2100,7 @@\n+\n+        void release() {\n+            assert (inuse == true);\n+            inuse = false;\n+        }\n+\n+        boolean inUse() { return inuse; }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/xpath\/regex\/RegularExpression.java","additions":53,"deletions":34,"binary":false,"changes":87,"status":"modified"}]}