{"files":[{"patch":"@@ -373,4 +373,0 @@\n-    Set<Long> getDisabledMechanisms() {\n-        return disabledMechanisms;\n-    }\n-\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/Config.java","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1257,11 +1257,0 @@\n-\n-        long[] supportedMechanisms = p11.C_GetMechanismList(slotID);\n-        \/\/ start w\/ the supported mechanisms, then remove the config disabled\n-        \/\/ and known broken ones\n-        Set<Long> enabledMechSet =\n-                Arrays.stream(supportedMechanisms).boxed().collect\n-                (Collectors.toCollection(HashSet::new));\n-        if (config.getDisabledMechanisms() != null) {\n-            enabledMechSet.removeAll(config.getDisabledMechanisms());\n-        }\n-\n@@ -1285,1 +1274,0 @@\n-            enabledMechSet.removeAll(brokenMechanisms);\n@@ -1288,0 +1276,5 @@\n+        long[] supportedMechanisms = p11.C_GetMechanismList(slotID);\n+        Set<Long> supportedMechSet =\n+                Arrays.stream(supportedMechanisms).boxed().collect\n+                (Collectors.toCollection(HashSet::new));\n+\n@@ -1344,1 +1337,1 @@\n-                    \/\/ first time; check all required mechs are supported\n+                    \/\/ check all required mechs are supported\n@@ -1348,1 +1341,3 @@\n-                            if (!enabledMechSet.contains(longReqMech)) {\n+                            if (!config.isEnabled(longReqMech) ||\n+                                    !supportedMechSet.contains(longReqMech) ||\n+                                    brokenMechanisms.contains(longReqMech)) {\n@@ -1352,1 +1347,1 @@\n-                                        \" due to no support for \" +\n+                                        \" due to no support for req'd mech \" +\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/SunPKCS11.java","additions":10,"deletions":15,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n-#showInfo = true\n+showInfo = true\n","filename":"test\/jdk\/sun\/security\/pkcs11\/Provider\/RequiredMechCheck.cfg","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}