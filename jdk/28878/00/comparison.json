{"files":[{"patch":"@@ -96,0 +96,1 @@\n+# -XDaccessInternalAPI is a temporary workaround, see 8373909\n@@ -99,1 +100,2 @@\n-    --override-methods=summary\n+    --override-methods=summary \\\n+    -XDaccessInternalAPI\n","filename":"make\/Docs.gmk","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -36,2 +36,0 @@\n-import javax.lang.model.element.PackageElement;\n-import javax.lang.model.element.TypeElement;\n@@ -163,0 +161,1 @@\n+                String rootParent = currentPath().replaceAll(\"[^\/]+\", \"..\");\n@@ -164,2 +163,2 @@\n-                String url = String.format(\"%1$s\/..\/specs\/%2$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n-                        docRoot(elem), idPrefix, chapter, section);\n+                String url = String.format(\"%1$s\/specs\/%2$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n+                        rootParent, idPrefix, chapter, section);\n@@ -186,0 +185,9 @@\n+    private String currentPath() {\n+        try {\n+            Class<?> c = Class.forName(\"jdk.javadoc.internal.doclets.formats.html.HtmlDocletWriter\");\n+            ThreadLocal<?> tl = (ThreadLocal<?>) c.getField(\"CURRENT_PATH\").get(null);\n+            return (String) tl.get();\n+        } catch (ReflectiveOperationException e) {\n+            throw new RuntimeException(\"Cannot determine current path\", e);\n+        }\n+    }\n@@ -212,30 +220,0 @@\n-    private String docRoot(Element elem) {\n-        switch (elem.getKind()) {\n-            case MODULE:\n-                return \"..\";\n-\n-            case PACKAGE:\n-                PackageElement pe = (PackageElement)elem;\n-                String pkgPart = pe.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-                return pe.getEnclosingElement() != null\n-                        ? \"..\/\" + pkgPart\n-                        : pkgPart;\n-\n-            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n-                TypeElement te = (TypeElement)elem;\n-                return te.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-\n-            default:\n-                var enclosing = elem.getEnclosingElement();\n-                if (enclosing == null)\n-                    throw new IllegalArgumentException(elem.getKind().toString());\n-                return docRoot(enclosing);\n-        }\n-    }\n-\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/JSpec.java","additions":12,"deletions":34,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -36,2 +36,0 @@\n-import javax.lang.model.element.PackageElement;\n-import javax.lang.model.element.TypeElement;\n@@ -71,1 +69,1 @@\n-    static final String BASE_URL = \"..\/specs\/man\";\n+    static final String BASE_URL = \"specs\/man\";\n@@ -122,0 +120,1 @@\n+                String rootParent = currentPath().replaceAll(\"[^\/]+\", \"..\");\n@@ -124,1 +123,1 @@\n-                        docRoot(elem), BASE_URL, name);\n+                        rootParent, BASE_URL, name);\n@@ -145,27 +144,7 @@\n-    private String docRoot(Element elem) {\n-        switch (elem.getKind()) {\n-            case MODULE:\n-                return \"..\";\n-\n-            case PACKAGE:\n-                PackageElement pe = (PackageElement)elem;\n-                String pkgPart = pe.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-                return pe.getEnclosingElement() != null\n-                        ? \"..\/\" + pkgPart\n-                        : pkgPart;\n-\n-            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n-                TypeElement te = (TypeElement)elem;\n-                return te.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-\n-            default:\n-                var enclosing = elem.getEnclosingElement();\n-                if (enclosing == null)\n-                    throw new IllegalArgumentException(elem.getKind().toString());\n-                return docRoot(enclosing);\n+    private String currentPath() {\n+        try {\n+            Class<?> c = Class.forName(\"jdk.javadoc.internal.doclets.formats.html.HtmlDocletWriter\");\n+            ThreadLocal<?> tl = (ThreadLocal<?>) c.getField(\"CURRENT_PATH\").get(null);\n+            return (String) tl.get();\n+        } catch (ReflectiveOperationException e) {\n+            throw new RuntimeException(\"Cannot determine current path\", e);\n@@ -174,0 +153,1 @@\n+\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/ToolGuide.java","additions":11,"deletions":31,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -246,0 +246,1 @@\n+        CURRENT_PATH.set(path.getPath());\n@@ -248,0 +249,3 @@\n+    \/** Temporary workaround to share current path with taglets, see 8373909 *\/\n+    public static final ThreadLocal<String> CURRENT_PATH = new ThreadLocal<>();\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDocletWriter.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}