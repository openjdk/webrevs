{"files":[{"patch":"@@ -698,0 +698,7 @@\n+    \/\/ Verify before mark is done before swapping card tables.\n+    \/\/ Therefore, the write card table will be verified before being taken snapshot.\n+    if (ShenandoahVerify) {\n+      ShenandoahTimingsTracker v(ShenandoahPhaseTimings::init_mark_verify);\n+      heap->verifier()->verify_before_concmark();\n+    }\n+\n@@ -704,1 +711,1 @@\n-  if (ShenandoahVerify) {\n+  if (ShenandoahVerify && heap->mode()->is_generational()) {\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahConcurrentGC.cpp","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -1060,1 +1060,2 @@\n-      _heap->gc_generation()->is_global()) {\n+      !_heap->old_generation()->is_mark_complete() &&\n+      !_heap->old_generation()->is_parsable()) {\n@@ -1124,0 +1125,8 @@\n+  VerifyRememberedSet verify_remembered_set = _verify_remembered_before_updating_references;\n+  if (_heap->mode()->is_generational() &&\n+      !_heap->old_generation()->is_mark_complete() &&\n+      !_heap->old_generation()->is_parsable()) {\n+    \/\/ Before marking, remembered set can't be verified in global GC, because,\n+    \/\/ we don't know whether old gen is parseable or not.\n+    verify_remembered_set = _verify_remembered_disable;\n+  }\n@@ -1126,1 +1135,1 @@\n-          _verify_remembered_before_updating_references,  \/\/ verify read-write remembered set\n+          verify_remembered_set,        \/\/ verify read-write remembered set\n@@ -1274,2 +1283,4 @@\n-      oop obj = CompressedOops::decode_not_null(o);\n-      if (_heap->is_in_young(obj) && !_scanner->is_card_dirty((HeapWord*) p)) {\n+      oop obj = CompressedOops::decode_raw(o);\n+      assert(is_object_aligned(obj), \"address not aligned: \" PTR_FORMAT, p2i(obj));\n+      ShenandoahHeapRegion* region = _heap->heap_region_containing(obj);\n+      if (region->is_active() && region->is_young() && !_scanner->is_card_dirty((HeapWord*) p)) {\n@@ -1367,1 +1378,1 @@\n-  ShenandoahScanRemembered* scanner = old_generation->card_scan();\n+  ShenandoahWriteTableScanner scanner(ShenandoahGenerationalHeap::heap()->old_generation()->card_scan());\n@@ -1371,1 +1382,1 @@\n-      help_verify_region_rem_set(scanner, r, r->end(), \"Verify init-mark remembered set violation\");\n+      help_verify_region_rem_set(&scanner, r, r->end(), \"Verify init-mark remembered set violation\");\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahVerifier.cpp","additions":17,"deletions":6,"binary":false,"changes":23,"status":"modified"}]}