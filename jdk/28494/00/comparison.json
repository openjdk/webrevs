{"files":[{"patch":"@@ -548,1 +548,22 @@\n-        exchange.start();\n+        \/\/ It's possible that the connection will have been closed\n+        \/\/ by the time we reach here.\n+        \/\/ We need to double-check that the connection is still opened\n+        \/\/ after having put the exchange to the exchanges map.\n+        if (isOpen()) {\n+            \/\/ only start the exchange if the connection is\n+            \/\/ still open\n+            exchange.start();\n+        } else {\n+            \/\/ Otherwise mark the exchange as unprocessed since we haven't\n+            \/\/ sent the headers yet and the connection got closed\n+            \/\/ before we started the exchange.\n+            TerminationCause tc = quicConnection.terminationCause();\n+            if (Log.http3()) {\n+                Log.logHttp3(\"HTTP\/3 exchange for {0}\/streamId={1} unprocessed due to {2}\",\n+                        quicConnectionTag(), Long.toString(streamId), tc.getCloseCause());\n+            }\n+            exchange.exchange.markUnprocessedByPeer();\n+            exchange.cancelImpl(tc.getCloseCause(),\n+                    Http3Error.fromCode(tc.getCloseCode()).orElse(H3_NO_ERROR));\n+        }\n+        \/\/ OK to return the exchange even if already closed\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http3Connection.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8087112\n+ * @bug 8087112 8372409\n@@ -49,1 +49,1 @@\n- * @bug 8087112\n+ * @bug 8087112 8372409\n@@ -74,1 +74,1 @@\n- * @bug 8087112\n+ * @bug 8087112 8372409\n@@ -99,1 +99,1 @@\n- * @bug 8087112\n+ * @bug 8087112 8372409\n","filename":"test\/jdk\/java\/net\/httpclient\/http3\/H3MultipleConnectionsToSameHost.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}