{"files":[{"patch":"@@ -32,1 +32,0 @@\n-import java.util.concurrent.atomic.AtomicBoolean;\n@@ -35,4 +34,1 @@\n-import static org.junit.jupiter.api.Assertions.assertEquals;\n-import static org.junit.jupiter.api.Assertions.assertFalse;\n-import static org.junit.jupiter.api.Assertions.assertNotNull;\n-import static org.junit.jupiter.api.Assertions.assertThrows;\n+import org.opentest4j.TestAbortedException;\n@@ -40,0 +36,3 @@\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static org.junit.jupiter.api.Assumptions.assumeFalse;\n+import static org.junit.jupiter.api.Assumptions.assumeTrue;\n@@ -63,4 +62,3 @@\n-        \/\/ we don't want to skip the test, because we expect at least one port\n-        \/\/ which would result in a connection refused\n-        assertNotNull(destAddr, \"couldn't find a suitable port which will generate\" +\n-                \" a connection refused error\");\n+        \/\/ skip the test if we couldn't find a port which would raise a connection refused error\n+        assumeTrue(destAddr != null,\n+                \"couldn't find a suitable port which will generate a connection refused error\");\n@@ -76,1 +74,3 @@\n-            assertFalse(connected, \"unexpectedly connected to \" + destAddr);\n+            \/\/ this test checks the exception message of a ConnectException, so it's\n+            \/\/ OK to skip the test if something unexpectedly accepted the connection\n+            assumeFalse(connected, \"unexpectedly connected to \" + destAddr);\n@@ -85,10 +85,16 @@\n-\n-                AtomicBoolean success = new AtomicBoolean();\n-                \/\/ expect SocketChannel.finishConnect() to throw a ConnectException\n-                ConnectException ce = assertThrows(ConnectException.class, () -> {\n-                    success.set(sc.finishConnect());\n-                }, \"finishConnect() was expected to fail but didn't, connected = \"\n-                        + success.get());\n-                System.err.println(\"got expected exception - \" + ce);\n-                \/\/ verify exception message\n-                assertEquals(\"Connection refused\", ce.getMessage());\n+                try {\n+                    boolean success = sc.finishConnect();\n+                    if (success) {\n+                        \/\/ this test checks the exception message of a ConnectException, so it's\n+                        \/\/ OK to skip the test if something unexpectedly accepted the connection\n+                        throw new TestAbortedException(\"unexpectedly connected to \" + destAddr);\n+                    }\n+                    fail(\"ConnectException was not thrown\");\n+                } catch (ConnectException ce) {\n+                    System.err.println(\"got (expected) ConnectException - \" + ce);\n+                    \/\/ verify exception message\n+                    if (!\"Connection refused\".equals(ce.getMessage())) {\n+                        \/\/ propagate the original exception\n+                        fail(\"unexpected exception message: \" + ce.getMessage(), ce);\n+                    }\n+                }\n","filename":"test\/jdk\/java\/nio\/channels\/Selector\/ConnectionRefusedMessage.java","additions":26,"deletions":20,"binary":false,"changes":46,"status":"modified"}]}