{"files":[{"patch":"@@ -352,1 +352,10 @@\n-  HandshakeOperation cto(hs_cl, nullptr, Thread::current());\n+  Thread* current_thread = Thread::current();\n+\n+  \/\/ The current thread must not belong to the SuspendibleThreadSet, because an\n+  \/\/ on-the-fly safepoint can be waiting for the current thread, and the\n+  \/\/ current thread will be blocked in VMThread::execute, resulting in\n+  \/\/ deadlock.\n+  assert(!current_thread->is_suspendible_thread(), \"precondition\");\n+  assert(!current_thread->is_indirectly_suspendible_thread(), \"precondition\");\n+\n+  HandshakeOperation cto(hs_cl, nullptr, current_thread);\n","filename":"src\/hotspot\/share\/runtime\/handshake.cpp","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"}]}