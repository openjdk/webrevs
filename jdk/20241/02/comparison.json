{"files":[{"patch":"@@ -288,1 +288,5 @@\n-            codeAttribute = (CodeImpl) enclosing;\n+            if (enclosing instanceof CodeImpl ci) {\n+                this.codeAttribute = ci;\n+            } else {\n+                throw new IllegalArgumentException(\"Invalid LocalVariableTable attribute location\");\n+            }\n@@ -315,1 +319,5 @@\n-            this.codeAttribute = (CodeImpl) enclosing;\n+            if (enclosing instanceof CodeImpl ci) {\n+                this.codeAttribute = ci;\n+            } else {\n+                throw new IllegalArgumentException(\"Invalid LocalVariableTypeTable attribute location\");\n+            }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/BoundAttribute.java","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -135,1 +135,5 @@\n-        return VerifierImpl.verify(model, classHierarchyResolverOption().classHierarchyResolver(), null);\n+        try {\n+            return VerifierImpl.verify(model, classHierarchyResolverOption().classHierarchyResolver(), null);\n+        } catch (IllegalArgumentException verifierInitializationError) {\n+            return List.of(new VerifyError(verifierInitializationError.getMessage()));\n+        }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/ClassFileImpl.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -117,2 +117,2 @@\n-        var klass = new VerificationWrapper(classModel);\n-        log_info(logger, \"Start class verification for: %s\", klass.thisClassName());\n+        String clsName = classModel.thisClass().asInternalName();\n+        log_info(logger, \"Start class verification for: %s\", clsName);\n@@ -120,0 +120,1 @@\n+            var klass = new VerificationWrapper(classModel);\n@@ -137,1 +138,1 @@\n-            log_info(logger, \"End class verification for: %s\", klass.thisClassName());\n+            log_info(logger, \"End class verification for: %s\", clsName);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/verifier\/VerifierImpl.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+ * @bug 8333812\n@@ -49,0 +50,2 @@\n+import jdk.internal.classfile.impl.DirectClassBuilder;\n+import jdk.internal.classfile.impl.UnboundAttribute;\n@@ -50,1 +53,1 @@\n-import static org.junit.jupiter.api.Assertions.fail;\n+import static org.junit.jupiter.api.Assertions.*;\n@@ -97,0 +100,21 @@\n+    @Test\n+    void testInvalidAttrLocation() {\n+        var cc = ClassFile.of();\n+        var bytes = cc.build(ClassDesc.of(\"InvalidAttrLocationClass\"), cb ->\n+            ((DirectClassBuilder)cb).writeAttribute(new UnboundAttribute.AdHocAttribute<LocalVariableTableAttribute>(Attributes.localVariableTable()) {\n+                @Override\n+                public void writeBody(BufWriter b) {\n+                    b.writeU2(0);\n+                }\n+            }));\n+        assertTrue(cc.verify(bytes).stream().anyMatch(e -> e.getMessage().contains(\"Invalid LocalVariableTable attribute location\")));\n+    }\n+\n+    @Test\n+    void testInvalidClassNameEntry() {\n+        var cc = ClassFile.of();\n+        var bytes = cc.parse(new byte[]{(byte)0xCA, (byte)0xFE, (byte)0xBA, (byte)0xBE,\n+            0, 0, 0, 0, 0, 2, ClassFile.TAG_INTEGER, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0});\n+        assertTrue(cc.verify(bytes).stream().anyMatch(e -> e.getMessage().contains(\"expected ClassEntry\")));\n+    }\n+\n","filename":"test\/jdk\/jdk\/classfile\/VerifierSelfTest.java","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"}]}