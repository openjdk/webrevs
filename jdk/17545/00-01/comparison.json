{"files":[{"patch":"@@ -138,1 +138,1 @@\n-  static bool supports_thp()                    { return (thp_mode() == THPMode::madvise || thp_mode() == THPMode::always) && thp_pagesize() != 0; }\n+  static bool supports_thp()                    { return thp_mode() == THPMode::madvise || thp_mode() == THPMode::always; }\n","filename":"src\/hotspot\/os\/linux\/hugepages.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3877,1 +3877,0 @@\n-    assert(HugePages::thp_pagesize() > 0, \"Missing OS info\");\n@@ -3879,0 +3878,9 @@\n+    if (_large_page_size == 0) {\n+        \/\/ Unknown THP page size => falback to default static hugepage size\n+        if (!HugePages::supports_static_hugepages()) {\n+            warn_no_large_pages_configured();\n+            UseLargePages = false;\n+            return;\n+        }\n+        _large_page_size = MIN2(HugePages::default_static_hugepage_size(), 16 * M);\n+    }\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -91,1 +91,1 @@\n-        return (_thpMode == THPMode.always || _thpMode == THPMode.madvise) && _thpPageSize != 0;\n+        return _thpMode == THPMode.always || _thpMode == THPMode.madvise;\n","filename":"test\/hotspot\/jtreg\/runtime\/os\/HugePageConfiguration.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -128,1 +128,10 @@\n-            String thpPageSizeString = buildSizeString(configuration.getThpPageSize());\n+            long thpPageSize = configuration.getThpPageSize();\n+            if (thpPageSize == 0) {\n+                thpPageSize = configuration.getStaticDefaultHugePageSize();\n+                if (thpPageSize == 0) {\n+                    out.shouldContain(\"[info][pagesize] Large page support disabled\");\n+                    return;\n+                }\n+\t\tthpPageSize = Math.min(thpPageSize, 16 * 1024 * 1024);\n+            }\n+            String thpPageSizeString = buildSizeString(thpPageSize);\n","filename":"test\/hotspot\/jtreg\/runtime\/os\/TestHugePageDecisionsAtVMStartup.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"}]}