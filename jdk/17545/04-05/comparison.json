{"files":[{"patch":"@@ -314,0 +314,13 @@\n+size_t HugePages::thp_pagesize_fallback() {\n+    \/\/ Older kernels won't publish the THP page size. Fall back to default static huge page size,\n+    \/\/ since that is likely to be the THP page size as well. Don't do it if the page size is considered\n+    \/\/ too large to avoid large alignment waste. If static huge page size is unknown, use educated guess.\n+    if (thp_pagesize() != 0) {\n+        return thp_pagesize();\n+    }\n+    if (supports_static_hugepages()) {\n+        return MIN2(default_static_hugepage_size(), 16 * M);\n+    }\n+    return 2 * M;\n+}\n+\n","filename":"src\/hotspot\/os\/linux\/hugepages.cpp","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -141,0 +141,1 @@\n+  static size_t thp_pagesize_fallback();\n","filename":"src\/hotspot\/os\/linux\/hugepages.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -3818,14 +3818,0 @@\n-static void thp_pagesize_fallback() {\n-    \/\/ Older kernels won't publish the THP page size. Fall back to default static huge page size,\n-    \/\/ since that is likely to be the THP page size as well. Don't do it if the page size is considered\n-    \/\/ too large to avoid large alignment waste. If static huge page size is unknown, use educated guess.\n-    log_info(pagesize) (\"Cannot determine THP page size (kernel < 4.10 ?)\");\n-    if (HugePages::supports_static_hugepages()) {\n-        log_info(pagesize) (\"Assuming THP page size to be same as default static hugepage size (limit 16M)\");\n-        _large_page_size = MIN2(HugePages::default_static_hugepage_size(), 16 * M);\n-        return;\n-    }\n-    log_info(pagesize) (\"Assuming THP page size to be 2M\");\n-    _large_page_size = 2 * M;\n-}\n-\n@@ -3893,1 +3879,3 @@\n-        thp_pagesize_fallback();\n+        log_info(pagesize) (\"Cannot determine THP page size (kernel < 4.10 ?)\");\n+        _large_page_size = HugePages::thp_pagesize_fallback();\n+        log_info(pagesize) (\"Assuming THP page size to be: \" EXACTFMT \" (heuristics)\", EXACTFMTARGS(_large_page_size));\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":3,"deletions":15,"binary":false,"changes":18,"status":"modified"}]}