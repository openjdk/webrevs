{"files":[{"patch":"@@ -26,0 +26,1 @@\n+ * @bug 8372039\n@@ -31,0 +32,1 @@\n+ * @run main\/othervm\/native -agentlib:SamplingDuringInit SamplingDuringInit\n@@ -36,0 +38,1 @@\n+    public static Object[] tmp = new Object[1000];\n@@ -37,0 +40,5 @@\n+        \/\/ Allocate some objects to trigger Sampling even if\n+        \/\/ all JDK classes are preloaded.\n+        for (int i = 0; i < tmp.length; i++) {\n+            tmp[i] = new String(\"tmp\" + i);\n+        }\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/events\/SampledObjectAlloc\/SamplingDuringInit\/SamplingDuringInit.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -27,0 +27,2 @@\n+#include <atomic>\n+\n@@ -29,0 +31,3 @@\n+\/\/ SampledObjectAlloc event might be triggered on any thread\n+static std::atomic<int> events_counter(0);\n+\n@@ -31,1 +36,9 @@\n-  LOG(\"Sampled object\\n\");\n+  events_counter++;\n+  LOG(\"Sampled object, events_counter = %d\\n\", events_counter.load());\n+}\n+\n+void JNICALL\n+VMDeath(jvmtiEnv *jvmti, JNIEnv* jni) {\n+  if (events_counter == 0) {\n+    fatal(jni, \"SampledObjectAlloc events counter shouldn't be zero\");\n+  }\n@@ -56,0 +69,1 @@\n+  callbacks.VMDeath = &VMDeath;\n@@ -65,0 +79,3 @@\n+  err = jvmti->SetEventNotificationMode(JVMTI_ENABLE, JVMTI_EVENT_VM_DEATH, nullptr);\n+  check_jvmti_error(err, \"SetEventNotificationMode\");\n+\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/events\/SampledObjectAlloc\/SamplingDuringInit\/libSamplingDuringInit.cpp","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"}]}