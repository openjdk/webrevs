{"files":[{"patch":"@@ -45,0 +45,1 @@\n+#include \"utilities\/deferredStatic.hpp\"\n@@ -170,1 +171,1 @@\n-  static OSXSemaphore sr_semaphore;\n+static DeferredStatic<OSXSemaphore> sr_semaphore;\n@@ -172,1 +173,1 @@\n-  static PosixSemaphore sr_semaphore;\n+static DeferredStatic<PosixSemaphore> sr_semaphore;\n@@ -180,1 +181,1 @@\n-static Semaphore* sig_semaphore = nullptr;\n+static DeferredStatic<Semaphore> sig_semaphore;\n@@ -354,1 +355,2 @@\n-  sig_semaphore = new Semaphore();\n+  int sem_count = 0;\n+  sig_semaphore.initialize(sem_count);\n@@ -358,1 +360,4 @@\n-  if (sig_semaphore != nullptr) {\n+    \/\/ Signal thread is not created with ReduceSignalUsage and jdk_misc_signal_init\n+    \/\/ initialization isn't called. This code is also never called.\n+    assert(!ReduceSignalUsage, \"Should not reach here if ReduceSignalUsage is set\");\n+\n@@ -361,5 +366,0 @@\n-  } else {\n-    \/\/ Signal thread is not created with ReduceSignalUsage and jdk_misc_signal_init\n-    \/\/ initialization isn't called.\n-    assert(ReduceSignalUsage, \"signal semaphore should be created\");\n-  }\n@@ -1699,1 +1699,1 @@\n-      sr_semaphore.signal();\n+      sr_semaphore->signal();\n@@ -1708,1 +1708,1 @@\n-          sr_semaphore.signal();\n+          sr_semaphore->signal();\n@@ -1734,0 +1734,3 @@\n+  int sem_count = 0;\n+  sr_semaphore.initialize(sem_count);\n+\n@@ -1781,1 +1784,1 @@\n-  assert(!sr_semaphore.trywait(), \"semaphore has invalid state\");\n+  assert(!sr_semaphore->trywait(), \"semaphore has invalid state\");\n@@ -1796,1 +1799,1 @@\n-    if (sr_semaphore.timedwait(2)) {\n+    if (sr_semaphore->timedwait(2)) {\n@@ -1805,1 +1808,1 @@\n-        sr_semaphore.wait();\n+        sr_semaphore->wait();\n@@ -1820,1 +1823,1 @@\n-  assert(!sr_semaphore.trywait(), \"invalid semaphore state\");\n+  assert(!sr_semaphore->trywait(), \"invalid semaphore state\");\n@@ -1830,1 +1833,1 @@\n-      if (sr_semaphore.timedwait(2)) {\n+      if (sr_semaphore->timedwait(2)) {\n","filename":"src\/hotspot\/os\/posix\/signals_posix.cpp","additions":20,"deletions":17,"binary":false,"changes":37,"status":"modified"}]}