{"files":[{"patch":"@@ -129,0 +129,1 @@\n+    @SuppressWarnings(\"removal\")\n@@ -130,7 +131,20 @@\n-        File seedFile;\n-        File nextFile;\n-\n-        switch(v) {\n-            case MIXED:\n-                URL egdUrl;\n-                File egdFile = null;\n+        return AccessController.doPrivileged(\n+            new PrivilegedAction<>() {\n+                @Override\n+                public RandomIO run() {\n+\n+                    File seedFile;\n+                    File nextFile;\n+\n+                    switch(v) {\n+                    case MIXED:\n+                        URL egdUrl;\n+                        File egdFile = null;\n+\n+                        if ((egdUrl = getEgdUrl()) != null) {\n+                            try {\n+                                egdFile = SunEntries.getDeviceFile(egdUrl);\n+                            } catch (IOException e) {\n+                                \/\/ Swallow, seedFile is still null\n+                            }\n+                        }\n@@ -138,5 +152,23 @@\n-                if ((egdUrl = getEgdUrl()) != null) {\n-                    try {\n-                        egdFile = SunEntries.getDeviceFile(egdUrl);\n-                    } catch (IOException e) {\n-                        \/\/ Swallow, seedFile is still null\n+                        \/\/ Try egd first.\n+                        if ((egdFile != null) && egdFile.canRead()) {\n+                            seedFile = egdFile;\n+                        } else {\n+                            \/\/ fall back to \/dev\/random.\n+                            seedFile = new File(NAME_RANDOM);\n+                        }\n+                        nextFile = new File(NAME_URANDOM);\n+                        break;\n+\n+                    case BLOCKING:\n+                        seedFile = new File(NAME_RANDOM);\n+                        nextFile = new File(NAME_RANDOM);\n+                        break;\n+\n+                    case NONBLOCKING:\n+                        seedFile = new File(NAME_URANDOM);\n+                        nextFile = new File(NAME_URANDOM);\n+                        break;\n+\n+                    default:\n+                        \/\/ Shouldn't happen!\n+                        return null;\n@@ -144,21 +176,0 @@\n-                }\n-\n-                \/\/ Try egd first.\n-                if ((egdFile != null) && egdFile.canRead()) {\n-                    seedFile = egdFile;\n-                } else {\n-                    \/\/ fall back to \/dev\/random.\n-                    seedFile = new File(NAME_RANDOM);\n-                }\n-                nextFile = new File(NAME_URANDOM);\n-                break;\n-\n-            case BLOCKING:\n-                seedFile = new File(NAME_RANDOM);\n-                nextFile = new File(NAME_RANDOM);\n-                break;\n-\n-            case NONBLOCKING:\n-                seedFile = new File(NAME_URANDOM);\n-                nextFile = new File(NAME_URANDOM);\n-                break;\n@@ -166,10 +177,5 @@\n-            default:\n-                \/\/ Shouldn't happen!\n-                return null;\n-        }\n-\n-        if (debug != null) {\n-            debug.println(\"NativePRNG.\" + v +\n-                    \" seedFile: \" + seedFile +\n-                    \" nextFile: \" + nextFile);\n-        }\n+                    if (debug != null) {\n+                        debug.println(\"NativePRNG.\" + v +\n+                            \" seedFile: \" + seedFile +\n+                            \" nextFile: \" + nextFile);\n+                    }\n@@ -177,7 +183,7 @@\n-        if (!seedFile.canRead() || !nextFile.canRead()) {\n-            if (debug != null) {\n-                debug.println(\"NativePRNG.\" + v +\n-                        \" Couldn't read Files.\");\n-            }\n-            return null;\n-        }\n+                    if (!seedFile.canRead() || !nextFile.canRead()) {\n+                        if (debug != null) {\n+                            debug.println(\"NativePRNG.\" + v +\n+                                \" Couldn't read Files.\");\n+                        }\n+                        return null;\n+                    }\n@@ -185,5 +191,7 @@\n-        try {\n-            return new RandomIO(seedFile, nextFile);\n-        } catch (Exception e) {\n-            return null;\n-        }\n+                    try {\n+                        return new RandomIO(seedFile, nextFile);\n+                    } catch (Exception e) {\n+                        return null;\n+                    }\n+                }\n+        });\n@@ -452,0 +460,1 @@\n+        @SuppressWarnings(\"removal\")\n@@ -456,5 +465,11 @@\n-                    try {\n-                        seedOut = new FileOutputStream(seedFile, true);\n-                    } catch (Exception e) {\n-                        seedOut = null;\n-                    }\n+                    seedOut = AccessController.doPrivileged(\n+                            new PrivilegedAction<>() {\n+                        @Override\n+                        public OutputStream run() {\n+                            try {\n+                                return new FileOutputStream(seedFile, true);\n+                            } catch (Exception e) {\n+                                return null;\n+                            }\n+                        }\n+                    });\n","filename":"src\/java.base\/unix\/classes\/sun\/security\/provider\/NativePRNG.java","additions":75,"deletions":60,"binary":false,"changes":135,"status":"modified"}]}