{"files":[{"patch":"@@ -2627,8 +2627,0 @@\n-\n-void\n-VirtualThreadGetThreadClosure::do_thread(Thread *target) {\n-  assert(target->is_Java_thread(), \"just checking\");\n-  JavaThread *jt = JavaThread::cast(target);\n-  oop carrier_thread = java_lang_VirtualThread::carrier_thread(_vthread_h());\n-  *_carrier_thread_ptr = (jthread)JNIHandles::make_local(jt, carrier_thread);\n-}\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -787,18 +787,0 @@\n-\/\/ HandshakeClosure to get virtual thread thread at safepoint.\n-class VirtualThreadGetThreadClosure : public HandshakeClosure {\n-private:\n-  Handle _vthread_h;\n-  jthread* _carrier_thread_ptr;\n-  jvmtiError _result;\n-\n-public:\n-  VirtualThreadGetThreadClosure(Handle vthread_h, jthread* carrier_thread_ptr)\n-    : HandshakeClosure(\"VirtualThreadGetThread\"),\n-      _vthread_h(vthread_h),\n-      _carrier_thread_ptr(carrier_thread_ptr),\n-      _result(JVMTI_ERROR_NONE) {}\n-\n-  void do_thread(Thread *target);\n-  jvmtiError result() { return _result; }\n-};\n-\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.hpp","additions":0,"deletions":18,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -133,0 +133,4 @@\n+  if (thread_ptr == nullptr) {\n+    return JVMTI_ERROR_NULL_POINTER;\n+  }\n+\n@@ -159,6 +163,5 @@\n-  if (thread_ptr == nullptr) {\n-    return JVMTI_ERROR_NULL_POINTER;\n-  }\n-  VirtualThreadGetThreadClosure op(Handle(current_thread, vthread_oop), thread_ptr);\n-  Handshake::execute(&op, &tlh, current_thread);\n-  return op.result();\n+\n+  oop carrier_thread = java_lang_VirtualThread::carrier_thread(vthread_oop);\n+  *thread_ptr = (jthread)JNIHandles::make_local(current_thread, carrier_thread);\n+\n+  return JVMTI_ERROR_NONE;\n","filename":"src\/hotspot\/share\/prims\/jvmtiExtensions.cpp","additions":10,"deletions":7,"binary":false,"changes":17,"status":"modified"}]}