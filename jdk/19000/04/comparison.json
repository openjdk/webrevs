{"files":[{"patch":"@@ -519,0 +519,11 @@\n+#if defined(AIX)\n+    \/* at least on AIX try also the LD_LIBRARY_PATH \/ LIBPATH *\/\n+    if (GetApplicationHomeFromLibpath(path, pathsize)) {\n+        JLI_Snprintf(libjava, sizeof(libjava), \"%s\/lib\/\" JAVA_DLL, path);\n+        if (stat(libjava, &s) == 0) {\n+            JLI_TraceLauncher(\"JRE path is %s\\n\", path);\n+            return JNI_TRUE;\n+        }\n+    }\n+#endif\n+\n","filename":"src\/java.base\/unix\/native\/libjli\/java_md.c","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -63,0 +63,1 @@\n+jboolean GetApplicationHomeFromLibpath(char *buf, jint bufsize);\n","filename":"src\/java.base\/unix\/native\/libjli\/java_md.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+#define JAVA_DLL \"libjava.so\"\n+\n@@ -111,0 +113,41 @@\n+#if defined(AIX)\n+static jboolean\n+LibjavaExists(const char *path)\n+{\n+    char tmp[PATH_MAX + 1];\n+    struct stat statbuf;\n+    JLI_Snprintf(tmp, PATH_MAX, \"%s\/%s\", path, JAVA_DLL);\n+    if (stat(tmp, &statbuf) == 0) {\n+        return JNI_TRUE;\n+    }\n+    return JNI_FALSE;\n+}\n+\n+\/*\n+ * Retrieves the path to the JRE home by locating libjava.so in\n+ * LIBPATH and then truncating the path to it.\n+ *\/\n+jboolean\n+GetApplicationHomeFromLibpath(char *buf, jint bufsize)\n+{\n+    char *env = getenv(\"LIBPATH\");\n+    char *tmp;\n+    char *save_ptr = NULL;\n+    char *envpath = JLI_StringDup(env);\n+    for (tmp = strtok_r(envpath, \":\", &save_ptr); tmp != NULL; tmp = strtok_r(NULL, \":\", &save_ptr)) {\n+        if (LibjavaExists(tmp)) {\n+            char *path = realpath(tmp, buf);\n+            if (path == buf) {\n+                JLI_StrCat(buf, \"\/\");\n+                if (JNI_TRUE == TruncatePath(buf, JNI_TRUE)) {\n+                    JLI_MemFree(envpath);\n+                    return JNI_TRUE;\n+                }\n+            }\n+        }\n+    }\n+    JLI_MemFree(envpath);\n+    return JNI_FALSE;\n+}\n+#endif\n+\n","filename":"src\/java.base\/unix\/native\/libjli\/java_md_common.c","additions":43,"deletions":0,"binary":false,"changes":43,"status":"modified"}]}