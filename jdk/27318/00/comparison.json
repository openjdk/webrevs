{"files":[{"patch":"@@ -33,1 +33,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -38,1 +38,1 @@\n-#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type)\n+#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type)\n","filename":"src\/hotspot\/cpu\/aarch64\/vmStructs_aarch64.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -42,1 +42,1 @@\n-#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type)\n+#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type)\n","filename":"src\/hotspot\/cpu\/arm\/vmStructs_arm.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field)\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field)\n@@ -35,1 +35,1 @@\n-#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type)\n+#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type)\n","filename":"src\/hotspot\/cpu\/ppc\/vmStructs_ppc.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -36,1 +36,1 @@\n-#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type)\n+#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type)\n","filename":"src\/hotspot\/cpu\/riscv\/vmStructs_riscv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field)\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field)\n@@ -35,1 +35,1 @@\n-#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type)\n+#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type)\n","filename":"src\/hotspot\/cpu\/s390\/vmStructs_s390.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -38,1 +38,1 @@\n-#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type) \\\n+#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type) \\\n","filename":"src\/hotspot\/cpu\/x86\/vmStructs_x86.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field)\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field)\n@@ -35,1 +35,1 @@\n-#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type)\n+#define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type)\n","filename":"src\/hotspot\/cpu\/zero\/vmStructs_zero.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -39,1 +39,1 @@\n-#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type) \\\n+#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type) \\\n","filename":"src\/hotspot\/os\/aix\/vmStructs_aix.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -42,1 +42,1 @@\n-#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type) \\\n+#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type) \\\n","filename":"src\/hotspot\/os\/bsd\/vmStructs_bsd.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -42,1 +42,1 @@\n-#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type) \\\n+#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type) \\\n","filename":"src\/hotspot\/os\/linux\/vmStructs_linux.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -41,1 +41,1 @@\n-#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type) \\\n+#define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c2_toplevel_type) \\\n","filename":"src\/hotspot\/os\/windows\/vmStructs_windows.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -83,0 +83,1 @@\n+friend class VMStructs;                \\\n","filename":"src\/hotspot\/share\/ci\/ciClassList.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1019,1 +1019,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -1033,1 +1033,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field) \\\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field) \\\n@@ -1056,1 +1056,1 @@\n-#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field)\n+#define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field)\n@@ -1091,1 +1091,2 @@\n-                 GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY)\n+                 GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,\n+                 GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY)\n@@ -1199,1 +1200,2 @@\n-                 CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY)\n+                 CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,\n+                 CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY)\n","filename":"src\/hotspot\/share\/jvmci\/vmStructs_jvmci.cpp","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -224,0 +224,1 @@\n+  friend class VMStructs;\n","filename":"src\/hotspot\/share\/opto\/compile.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -108,0 +108,1 @@\n+#include \"opto\/compile.hpp\"\n@@ -151,0 +152,1 @@\n+                   c2_nonstatic_field,                                                                                               \\\n@@ -669,0 +671,8 @@\n+  \/**************\/                                                                                                                   \\\n+  \/* CI *\/                                                                                                                           \\\n+  \/************\/                                                                                                                     \\\n+                                                                                                                                     \\\n+  nonstatic_field(CompilerThread,              _env,                                          ciEnv*)                                \\\n+  nonstatic_field(ciEnv,                       _task,                                         CompileTask*)                          \\\n+  c2_nonstatic_field(Compile,                  _method,                                       ciMethod*)                             \\\n+                                                                                                                                     \\\n@@ -836,1 +846,2 @@\n-                 declare_unsigned_integer_type)                           \\\n+                 declare_unsigned_integer_type,                           \\\n+                 declare_c2_toplevel_type)                                \\\n@@ -1151,0 +1162,10 @@\n+  \/*********************\/                                                 \\\n+  \/* CI *\/                                                                \\\n+  \/*********************\/                                                 \\\n+                                                                          \\\n+  declare_c2_toplevel_type(Compile)                                       \\\n+  declare_toplevel_type(ciEnv)                                            \\\n+  declare_toplevel_type(ciBaseObject)                                     \\\n+  declare_type(ciMetadata, ciBaseObject)                                  \\\n+  declare_type(ciMethod, ciMetadata)                                      \\\n+                                                                          \\\n@@ -1858,0 +1879,30 @@\n+\/\/ Generate and check a nonstatic field in C2 builds\n+#ifdef COMPILER2\n+# define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)\n+# define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)\n+# define ENSURE_C2_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)\n+#else\n+# define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)\n+# define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)\n+# define ENSURE_C2_FIELD_TYPE_PRESENT(a, b, c)\n+#endif \/* COMPILER2 *\/\n+\n+\/\/ Generate but do not check a static field in C2 builds\n+#ifdef COMPILER2\n+# define GENERATE_C2_UNCHECKED_STATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_UNCHECKED_STATIC_VM_STRUCT_ENTRY(a, b, c)\n+#else\n+# define GENERATE_C2_UNCHECKED_STATIC_VM_STRUCT_ENTRY(a, b, c)\n+#endif \/* COMPILER2 *\/\n+\n+\/\/--------------------------------------------------------------------------------\n+\/\/ VMTypeEntry build-specific macros\n+\/\/\n+\n+#ifdef COMPILER2\n+# define GENERATE_C2_TOPLEVEL_VM_TYPE_ENTRY(a)               GENERATE_TOPLEVEL_VM_TYPE_ENTRY(a)\n+# define CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY(a)\n+#else\n+# define GENERATE_C2_TOPLEVEL_VM_TYPE_ENTRY(a)\n+# define CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY(a)\n+#endif \/* COMPILER2 *\/\n+\n@@ -1871,1 +1922,2 @@\n-             GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY)\n+             GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,\n+             GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY)\n@@ -1878,1 +1930,2 @@\n-                GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY)\n+                GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,\n+                GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY)\n@@ -1884,1 +1937,2 @@\n-                 GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY)\n+                 GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,\n+                 GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY)\n@@ -1899,1 +1953,2 @@\n-           GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY)\n+           GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY,\n+           GENERATE_C2_TOPLEVEL_VM_TYPE_ENTRY)\n@@ -1905,1 +1960,2 @@\n-              GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY)\n+              GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY,\n+              GENERATE_C2_TOPLEVEL_VM_TYPE_ENTRY)\n@@ -1911,1 +1967,2 @@\n-               GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY)\n+               GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY,\n+               GENERATE_C2_TOPLEVEL_VM_TYPE_ENTRY)\n@@ -2007,1 +2064,2 @@\n-             CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY)\n+             CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,\n+             CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY)\n@@ -2013,1 +2071,2 @@\n-                 CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY)\n+                 CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,\n+                 CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY)\n@@ -2019,1 +2078,2 @@\n-           CHECK_SINGLE_ARG_VM_TYPE_NO_OP)\n+           CHECK_SINGLE_ARG_VM_TYPE_NO_OP,\n+           CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY)\n@@ -2026,1 +2086,2 @@\n-               CHECK_SINGLE_ARG_VM_TYPE_NO_OP)\n+               CHECK_SINGLE_ARG_VM_TYPE_NO_OP,\n+               CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY)\n@@ -2050,0 +2111,1 @@\n+             CHECK_NO_OP,\n@@ -2057,1 +2119,2 @@\n-             ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT)\n+             ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,\n+             ENSURE_C2_FIELD_TYPE_PRESENT)\n@@ -2063,1 +2126,2 @@\n-                 ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT)\n+                 ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,\n+                 ENSURE_C2_FIELD_TYPE_PRESENT)\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":77,"deletions":13,"binary":false,"changes":90,"status":"modified"}]}