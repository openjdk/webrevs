{"files":[{"patch":"@@ -101,0 +101,3 @@\n+        if (paramNo == 0) {\n+            return ((flags & ClassFile.ACC_STATIC) != 0) ? 0 : 1;\n+        }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/DirectMethodBuilder.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -59,0 +59,4 @@\n+import static jdk.internal.constant.PrimitiveClassDescImpl.CD_double;\n+import static jdk.internal.constant.PrimitiveClassDescImpl.CD_long;\n+import static jdk.internal.constant.PrimitiveClassDescImpl.CD_void;\n+\n@@ -109,3 +113,5 @@\n-        int count = 0;\n-        for (int i = 0; i < mDesc.parameterCount(); i++) {\n-            count += slotSize(mDesc.parameterType(i));\n+        int count = mDesc.parameterCount();\n+        for (int i = count - 1; i >= 0; i--) {\n+            if (isDoubleSlot(mDesc.parameterType(i))) {\n+                count++;\n+            }\n@@ -121,1 +127,1 @@\n-            count += slotSize(mDesc.parameterType(i));\n+            count += paramSlotSize(mDesc.parameterType(i));\n@@ -127,5 +133,1 @@\n-        int count = ((flags & ACC_STATIC) != 0) ? 0 : 1;\n-        for (int i = 0; i < mDesc.parameterCount(); i++) {\n-            count += slotSize(mDesc.parameterType(i));\n-        }\n-        return count;\n+        return parameterSlots(mDesc) + ((flags & ACC_STATIC) == 0 ? 1 : 0) ;\n@@ -256,5 +258,5 @@\n-        return switch (desc.descriptorString().charAt(0)) {\n-            case 'V' -> 0;\n-            case 'D','J' -> 2;\n-            default -> 1;\n-        };\n+        return desc == CD_void ? 0 : isDoubleSlot(desc) ? 2 : 1;\n+    }\n+\n+    public static int paramSlotSize(ClassDesc desc) {\n+        return isDoubleSlot(desc) ? 2 : 1;\n@@ -264,2 +266,1 @@\n-        char ch = desc.descriptorString().charAt(0);\n-        return ch == 'D' || ch == 'J';\n+        return desc == CD_double || desc == CD_long;\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/Util.java","additions":17,"deletions":16,"binary":false,"changes":33,"status":"modified"}]}