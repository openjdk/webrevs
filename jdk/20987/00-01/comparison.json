{"files":[{"patch":"@@ -438,0 +438,1 @@\n+ -runtime\/cds\/appcds\/complexURI \\\n","filename":"test\/hotspot\/jtreg\/TEST.groups","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -39,0 +39,1 @@\n+import jdk.test.lib.Platform;\n@@ -45,2 +46,0 @@\n-    final static String listFileName = \"test-classlist.txt\";\n-    final static String archiveName  = \"test-dynamic.jsa\";\n@@ -48,0 +47,1 @@\n+\n@@ -58,0 +58,5 @@\n+        final String listFileName = \"test-classlist.txt\";\n+        final String staticArchiveName = \"test-static.jsa\";\n+        final String dynamicArchiveName = \"test-dynamic.jsa\";\n+\n+        \/\/ Verify static archive creation and use\n@@ -59,3 +64,3 @@\n-        Files.deleteIfExists(fileList.toPath());\n-        File fileArchive = new File(archiveName);\n-        Files.deleteIfExists(fileArchive.toPath());\n+        delete(fileList.toPath());\n+        File staticArchive = new File(staticArchiveName);\n+        delete(staticArchive.toPath());\n@@ -63,1 +68,1 @@\n-        createClassList(jarFile);\n+        createClassList(jarFile, listFileName);\n@@ -68,3 +73,3 @@\n-        createArchive(jarFile);\n-        if (!fileArchive.exists()) {\n-            throw new RuntimeException(\"No shared classes archive created at \" + fileArchive);\n+        createArchive(jarFile, listFileName, staticArchiveName);\n+        if (!staticArchive.exists()) {\n+            throw new RuntimeException(\"No shared classes archive created at \" + staticArchive);\n@@ -73,2 +78,13 @@\n-        useArchive(jarFile);\n-        Files.deleteIfExists(fileArchive.toPath());\n+        useArchive(jarFile, staticArchiveName);\n+\n+        \/\/ Verify dynamic archive creation and use\n+        File dynamicArchive = new File(dynamicArchiveName);\n+        delete(dynamicArchive.toPath());\n+\n+        createDynamicArchive(jarFile, dynamicArchiveName);\n+        if (!dynamicArchive.exists()) {\n+            throw new RuntimeException(\"No dynamic archive created at \" + dynamicArchive);\n+        }\n+\n+        testDynamicArchive(jarFile, dynamicArchiveName);\n+    }\n@@ -76,3 +92,6 @@\n-        createDynamicArchive(jarFile);\n-        if (!fileArchive.exists()) {\n-            throw new RuntimeException(\"No dynamic archive created at \" + fileArchive);\n+    private static void delete(Path path) throws Exception {\n+        if (Files.exists(path)) {\n+            if (Platform.isWindows()) {\n+                Files.setAttribute(path, \"dos:readonly\", false);\n+            }\n+            Files.delete(path);\n@@ -80,1 +99,0 @@\n-        testDynamicArchive(jarFile);\n@@ -83,1 +101,1 @@\n-    private static void createClassList(String jarFile) throws Exception {\n+    private static void createClassList(String jarFile, String list) throws Exception {\n@@ -85,1 +103,1 @@\n-                \"-XX:DumpLoadedClassList=\" + listFileName,\n+                \"-XX:DumpLoadedClassList=\" + list,\n@@ -95,1 +113,1 @@\n-    private static void createArchive(String jarFile) throws Exception {\n+    private static void createArchive(String jarFile, String list, String archive) throws Exception {\n@@ -98,2 +116,2 @@\n-                \"-XX:SharedClassListFile=\" + listFileName,\n-                \"-XX:SharedArchiveFile=\" + archiveName,\n+                \"-XX:SharedClassListFile=\" + list,\n+                \"-XX:SharedArchiveFile=\" + archive,\n@@ -109,1 +127,1 @@\n-    private static void useArchive(String jarFile) throws Exception {\n+    private static void useArchive(String jarFile, String archive) throws Exception {\n@@ -112,1 +130,1 @@\n-                \"-XX:SharedArchiveFile=\" + archiveName,\n+                \"-XX:SharedArchiveFile=\" + archive,\n@@ -122,1 +140,1 @@\n-    private static void createDynamicArchive(String jarFile) throws Exception {\n+    private static void createDynamicArchive(String jarFile, String archive) throws Exception {\n@@ -124,1 +142,1 @@\n-                \"-XX:ArchiveClassesAtExit=\" + archiveName,\n+                \"-XX:ArchiveClassesAtExit=\" + archive,\n@@ -134,1 +152,1 @@\n-    private static void testDynamicArchive(String jarFile) throws Exception {\n+    private static void testDynamicArchive(String jarFile, String archive) throws Exception {\n@@ -136,1 +154,1 @@\n-                \"-XX:SharedArchiveFile=\" + archiveName,\n+                \"-XX:SharedArchiveFile=\" + archive,\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/complexURI\/ComplexURITest.java","additions":44,"deletions":26,"binary":false,"changes":70,"status":"modified"}]}