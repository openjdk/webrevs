{"files":[{"patch":"@@ -1606,2 +1606,1 @@\n-      const address encoding_base = (address)mapped_base_address;\n-      const address klass_range_start = encoding_base + prot_zone_size;\n+      const address klass_range_start = (address)mapped_base_address;\n@@ -1618,1 +1617,1 @@\n-          encoding_base, ArchiveBuilder::precomputed_narrow_klass_shift() \/\/ precomputed encoding, see ArchiveBuilder\n+          klass_range_start, ArchiveBuilder::precomputed_narrow_klass_shift() \/\/ precomputed encoding, see ArchiveBuilder\n@@ -1620,0 +1619,1 @@\n+        assert(CompressedKlassPointers::base() == klass_range_start, \"must be\");\n@@ -1623,0 +1623,6 @@\n+        assert(CompressedKlassPointers::base() == nullptr ||\n+               CompressedKlassPointers::base() == klass_range_start, \"must be\");\n+      }\n+      \/\/ Establish protection zone, but only if we need one\n+      if (CompressedKlassPointers::base() == klass_range_start) {\n+        CompressedKlassPointers::establish_protection_zone(klass_range_start, prot_zone_size);\n@@ -1624,1 +1630,0 @@\n-      CompressedKlassPointers::establish_protection_zone(encoding_base, prot_zone_size);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-  static void ensure_module_entry_table_exists(oop class_loader);\n+  CDS_JAVA_HEAP_ONLY(static void ensure_module_entry_table_exists(oop class_loader);)\n@@ -40,0 +40,1 @@\n+#if INCLUDE_CDS_JAVA_HEAP\n@@ -52,0 +53,1 @@\n+#endif \/\/ INCLUDE_CDS_JAVA_HEAP\n","filename":"src\/hotspot\/share\/classfile\/classLoaderDataShared.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -912,0 +912,1 @@\n+#if INCLUDE_CDS_JAVA_HEAP\n@@ -915,0 +916,1 @@\n+#endif \/\/ INCLUDE_CDS_JAVA_HEAP\n","filename":"src\/hotspot\/share\/memory\/universe.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -144,1 +144,2 @@\n-  \/\/ is disallowed. Note that both Metaspace and CDS prvent allocation at the first address for this reason.\n+  \/\/ is disallowed. If the encoding range starts at the klass range start, both Metaspace and CDS establish an\n+  \/\/ mprotected zone for this reason (see establish_protection_zone).\n","filename":"src\/hotspot\/share\/oops\/compressedKlass.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -127,1 +127,1 @@\n-  \/\/ Start and end of the Klass Range.\n+  \/\/ Start and end of the Klass Range. Start includes the protection zone if one exists.\n","filename":"src\/hotspot\/share\/oops\/compressedKlass.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}