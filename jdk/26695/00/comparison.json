{"files":[{"patch":"@@ -2448,0 +2448,11 @@\n+  assert(policy()->collector_state()->in_full_gc() ||\n+         young_regions_cardset()->occupied() == policy()->num_young_rem_set_cards_at_start(),\n+         \"Should not add cards to young gen remembered set during young GC, but \"\n+         \"changed from %zu at start to %zu now.\",\n+         policy()->num_young_rem_set_cards_at_start(), young_regions_cardset()->occupied());\n+  \/\/ Clear current young only collection set. As cards will be refined, they will\n+  \/\/ be added to the remembered set.\n+  \/\/ It is fine to clear it this late - evacuation does not add any remembered sets\n+  \/\/ by itself, but only mark cards.\n+  young_regions_cset_group()->clear();\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-  _card_rs_length(0),\n+  DEBUG_ONLY(_num_young_rem_set_cards_at_start(0) COMMA)\n@@ -933,1 +933,1 @@\n-    _analytics->report_card_rs_length((double)_card_rs_length, is_young_only_pause);\n+    _analytics->report_card_rs_length((double)_g1h->young_regions_cardset()->occupied(), is_young_only_pause);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -104,1 +104,1 @@\n-  size_t _card_rs_length;\n+  DEBUG_ONLY(size_t _num_young_rem_set_cards_at_start;)\n@@ -132,2 +132,3 @@\n-  void record_card_rs_length(size_t card_rs_length) {\n-    _card_rs_length = card_rs_length;\n+#ifdef ASSERT\n+  void record_young_rem_set_cards_at_start(size_t num_cards) {\n+    _num_young_rem_set_cards_at_start = num_cards;\n@@ -136,0 +137,3 @@\n+  size_t num_young_rem_set_cards_at_start() const { return _num_young_rem_set_cards_at_start; }\n+#endif\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1443,10 +1443,0 @@\n-  {\n-    size_t young_rs_length = g1h->young_regions_cardset()->occupied();\n-    \/\/ We only use young_rs_length statistics to estimate young regions length.\n-    g1h->policy()->record_card_rs_length(young_rs_length);\n-\n-    \/\/ Clear current young only collection set. Survivor regions will be added\n-    \/\/ to the set during evacuation.\n-    g1h->young_regions_cset_group()->clear();\n-  }\n-\n","filename":"src\/hotspot\/share\/gc\/g1\/g1RemSet.cpp","additions":0,"deletions":10,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -522,1 +522,0 @@\n-\n@@ -525,0 +524,2 @@\n+    DEBUG_ONLY(_g1h->policy()->record_young_rem_set_cards_at_start(_g1h->young_regions_cardset()->occupied()));\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1YoungCollector.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}