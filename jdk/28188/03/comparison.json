{"files":[{"patch":"@@ -944,0 +944,1 @@\n+     * @param rounds [in] the number rounds for generating the round keys.\n@@ -945,1 +946,1 @@\n-     * @return w the cipher round keys.\n+     * @return the cipher round keys.\n@@ -973,1 +974,4 @@\n-     * @return w1 the inverse cipher round keys.\n+     * @param w [in] the targeted word for substitution.\n+     * @param rounds [in] the number of rounds for generating the round keys.\n+     *\n+     * @return the inverse cipher round keys.\n@@ -976,3 +980,1 @@\n-        int kLen = w.length;;\n-        int[] temp = new int[WB];\n-        int[] dw = new int[kLen];\n+        int[] dw = new int[w.length];\n@@ -984,10 +986,17 @@\n-            System.arraycopy(w, i * WB, temp, 0, WB);\n-            temp[0] = TMI0[temp[0] >>> 24] ^ TMI1[(temp[0] >> 16) & 0xFF]\n-                    ^ TMI2[(temp[0] >> 8) & 0xFF] ^ TMI3[temp[0] & 0xFF];\n-            temp[1] = TMI0[temp[1] >>> 24] ^ TMI1[(temp[1] >> 16) & 0xFF]\n-                    ^ TMI2[(temp[1] >> 8) & 0xFF] ^ TMI3[temp[1] & 0xFF];\n-            temp[2] = TMI0[temp[2] >>> 24] ^ TMI1[(temp[2] >> 16) & 0xFF]\n-                    ^ TMI2[(temp[2] >> 8) & 0xFF] ^ TMI3[temp[2] & 0xFF];\n-            temp[3] = TMI0[temp[3] >>> 24] ^ TMI1[(temp[3] >> 16) & 0xFF]\n-                    ^ TMI2[(temp[3] >> 8) & 0xFF] ^ TMI3[temp[3] & 0xFF];\n-            System.arraycopy(temp, 0, dw, kLen - (i * WB), WB);\n+            int widx = i * WB;\n+            int idx = w.length - widx;\n+\n+            dw[idx] = TMI0[w[widx] >>> 24] ^ TMI1[(w[widx] >> 16) & 0xFF]\n+                    ^ TMI2[(w[widx] >> 8) & 0xFF] ^ TMI3[w[widx] & 0xFF];\n+            dw[idx + 1] = TMI0[w[widx + 1] >>> 24]\n+                    ^ TMI1[(w[widx + 1] >> 16) & 0xFF]\n+                    ^ TMI2[(w[widx + 1] >> 8) & 0xFF]\n+                    ^ TMI3[w[widx + 1] & 0xFF];\n+            dw[idx + 2] = TMI0[w[widx + 2] >>> 24]\n+                    ^ TMI1[(w[widx + 2] >> 16) & 0xFF]\n+                    ^ TMI2[(w[widx + 2] >> 8) & 0xFF]\n+                    ^ TMI3[w[widx + 2] & 0xFF];\n+            dw[idx + 3] = TMI0[w[widx + 3] >>> 24]\n+                    ^ TMI1[(w[widx + 3] >> 16) & 0xFF]\n+                    ^ TMI2[(w[widx + 3] >> 8) & 0xFF]\n+                    ^ TMI3[w[widx + 3] & 0xFF];\n@@ -995,1 +1004,1 @@\n-        System.arraycopy(w, kLen - WB, dw, WB, WB);\n+        System.arraycopy(w, w.length - WB, dw, WB, WB);\n@@ -997,1 +1006,0 @@\n-        Arrays.fill(temp, 0);\n@@ -1003,1 +1011,1 @@\n-     * Subtitute the word as a step of key expansion.\n+     * Substitute the word as a step of key expansion.\n@@ -1005,2 +1013,1 @@\n-     * @param state [in] the targeted word for substituion.\n-     * @param sub [in] the substitute table for cipher and inverse cipher.\n+     * @param word [in] the targeted word for substitution.\n@@ -1011,4 +1018,3 @@\n-        byte b0 = (byte) (word >>> 24);\n-        byte b1 = (byte) ((word >> 16) & 0xFF);\n-        byte b2 = (byte) ((word >> 8) & 0xFF);\n-        byte b3 = (byte) (word & 0xFF);\n+        byte b0 = (byte) (word >> 24);\n+        byte b1 = (byte) (word >> 16);\n+        byte b2 = (byte) (word >> 8);\n@@ -1019,1 +1025,1 @@\n-                | (SBOX[(b3 & 0xF0) >> 4][b3 & 0x0F] & 0xFF);\n+                | (SBOX[(word & 0xF0) >> 4][word & 0x0F] & 0xFF);\n","filename":"src\/java.base\/share\/classes\/com\/sun\/crypto\/provider\/AES_Crypt.java","additions":31,"deletions":25,"binary":false,"changes":56,"status":"modified"}]}