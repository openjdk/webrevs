{"files":[{"patch":"@@ -113,0 +113,6 @@\n+    CDSConfig::set_is_at_cds_safepoint(true);\n+    doit_inner();\n+    CDSConfig::set_is_at_cds_safepoint(false);\n+  }\n+\n+  void doit_inner() {\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -903,0 +903,9 @@\n+      \/\/ When called within the CDS safepoint, the correctness of this function\n+      \/\/ relies on the call to MetaspaceShared::link_all_loaded_classes()\n+      \/\/ that happened right before we enter the CDS safepoint.\n+      \/\/\n+      \/\/ Do not call this function in other types of safepoints. For example, if this\n+      \/\/ is called in a GC safepoint, a klass may be improperly excluded because some\n+      \/\/ of its verifyer dependencies have not yet been linked.\n+      assert(CDSConfig::is_at_cds_safepoint(), \"Do not call this function in any other safepoint\");\n+\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"}]}