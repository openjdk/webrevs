{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -444,0 +444,1 @@\n+                            exch.exchImpl.cancel(e);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/MultiExchange.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8203882\n+ * @bug 8203882 8352623\n@@ -39,3 +39,0 @@\n-import com.sun.net.httpserver.HttpServer;\n-import com.sun.net.httpserver.HttpsConfigurator;\n-import com.sun.net.httpserver.HttpsServer;\n@@ -52,0 +49,1 @@\n+import java.lang.ref.WeakReference;\n@@ -53,2 +51,0 @@\n-import java.net.InetAddress;\n-import java.net.InetSocketAddress;\n@@ -63,1 +59,0 @@\n-import jdk.httpclient.test.lib.http2.Http2TestServer;\n@@ -98,0 +93,4 @@\n+    static WeakReference<HttpClient> ref(HttpClient client) {\n+        return new WeakReference<>(client);\n+    }\n+\n@@ -101,32 +100,32 @@\n-                { httpURI   + \"\/server\", UNAUTHORIZED, true, authClient},\n-                { httpsURI  + \"\/server\", UNAUTHORIZED, true, authClient},\n-                { http2URI  + \"\/server\", UNAUTHORIZED, true, authClient},\n-                { https2URI + \"\/server\", UNAUTHORIZED, true, authClient},\n-                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, true, authClient},\n-                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, authClient},\n-                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, authClient},\n-                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, true, authClient},\n-                { httpURI   + \"\/server\", UNAUTHORIZED, false, authClient},\n-                { httpsURI  + \"\/server\", UNAUTHORIZED, false, authClient},\n-                { http2URI  + \"\/server\", UNAUTHORIZED, false, authClient},\n-                { https2URI + \"\/server\", UNAUTHORIZED, false, authClient},\n-                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, false, authClient},\n-                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, authClient},\n-                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, authClient},\n-                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, false, authClient},\n-                { httpURI   + \"\/server\", UNAUTHORIZED, true, noAuthClient},\n-                { httpsURI  + \"\/server\", UNAUTHORIZED, true, noAuthClient},\n-                { http2URI  + \"\/server\", UNAUTHORIZED, true, noAuthClient},\n-                { https2URI + \"\/server\", UNAUTHORIZED, true, noAuthClient},\n-                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, true, noAuthClient},\n-                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, noAuthClient},\n-                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, noAuthClient},\n-                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, true, noAuthClient},\n-                { httpURI   + \"\/server\", UNAUTHORIZED, false, noAuthClient},\n-                { httpsURI  + \"\/server\", UNAUTHORIZED, false, noAuthClient},\n-                { http2URI  + \"\/server\", UNAUTHORIZED, false, noAuthClient},\n-                { https2URI + \"\/server\", UNAUTHORIZED, false, noAuthClient},\n-                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, false, noAuthClient},\n-                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, noAuthClient},\n-                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, noAuthClient},\n-                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, false, noAuthClient},\n+                { httpURI   + \"\/server\", UNAUTHORIZED, true, ref(authClient)},\n+                { httpsURI  + \"\/server\", UNAUTHORIZED, true, ref(authClient)},\n+                { http2URI  + \"\/server\", UNAUTHORIZED, true, ref(authClient)},\n+                { https2URI + \"\/server\", UNAUTHORIZED, true, ref(authClient)},\n+                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(authClient)},\n+                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(authClient)},\n+                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(authClient)},\n+                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(authClient)},\n+                { httpURI   + \"\/server\", UNAUTHORIZED, false, ref(authClient)},\n+                { httpsURI  + \"\/server\", UNAUTHORIZED, false, ref(authClient)},\n+                { http2URI  + \"\/server\", UNAUTHORIZED, false, ref(authClient)},\n+                { https2URI + \"\/server\", UNAUTHORIZED, false, ref(authClient)},\n+                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(authClient)},\n+                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(authClient)},\n+                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(authClient)},\n+                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(authClient)},\n+                { httpURI   + \"\/server\", UNAUTHORIZED, true, ref(noAuthClient)},\n+                { httpsURI  + \"\/server\", UNAUTHORIZED, true, ref(noAuthClient)},\n+                { http2URI  + \"\/server\", UNAUTHORIZED, true, ref(noAuthClient)},\n+                { https2URI + \"\/server\", UNAUTHORIZED, true, ref(noAuthClient)},\n+                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(noAuthClient)},\n+                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(noAuthClient)},\n+                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(noAuthClient)},\n+                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, true, ref(noAuthClient)},\n+                { httpURI   + \"\/server\", UNAUTHORIZED, false, ref(noAuthClient)},\n+                { httpsURI  + \"\/server\", UNAUTHORIZED, false, ref(noAuthClient)},\n+                { http2URI  + \"\/server\", UNAUTHORIZED, false, ref(noAuthClient)},\n+                { https2URI + \"\/server\", UNAUTHORIZED, false, ref(noAuthClient)},\n+                { httpURI   + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(noAuthClient)},\n+                { httpsURI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(noAuthClient)},\n+                { http2URI  + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(noAuthClient)},\n+                { https2URI + \"\/proxy\",  PROXY_UNAUTHORIZED, false, ref(noAuthClient)},\n@@ -142,1 +141,2 @@\n-    void test(String uriString, int code, boolean async, HttpClient client) throws Throwable {\n+    void test(String uriString, int code, boolean async, WeakReference<HttpClient> clientRef) throws Throwable {\n+        HttpClient client = clientRef.get();\n@@ -226,0 +226,9 @@\n+        \/\/ authClient.close();\n+        \/\/ noAuthClient.close();\n+        var TRACKER = ReferenceTracker.INSTANCE;\n+        TRACKER.track(authClient);\n+        TRACKER.track(noAuthClient);\n+        authClient = noAuthClient = null;\n+        System.gc();\n+        var error = TRACKER.check(1000);\n+\n@@ -230,0 +239,1 @@\n+        if (error != null) throw error;\n","filename":"test\/jdk\/java\/net\/httpclient\/UnauthorizedTest.java","additions":51,"deletions":41,"binary":false,"changes":92,"status":"modified"}]}