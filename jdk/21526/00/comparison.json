{"files":[{"patch":"@@ -63,0 +63,7 @@\n+\n+    \/**\n+     * {@return whether this class entry describes the same class as the provided symbol}\n+     *\n+     * @param symbol the symbol to compare to\n+     *\/\n+    boolean equalsSymbol(ClassDesc symbol);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/classfile\/constantpool\/ClassEntry.java","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -602,0 +602,26 @@\n+        @Override\n+        public boolean equalsSymbol(ClassDesc symbol) {\n+            if (symbol.isPrimitive()) \/\/ implicit null check\n+                return false;\n+\n+            var mySym = this.sym;\n+            if (mySym != null)\n+                return mySym.equals(symbol);\n+\n+            boolean equals;\n+            if (isArrayDescriptor(ref1)) {\n+                if (!symbol.isArray())\n+                    return false;\n+                equals = ref1.equalsString(symbol.descriptorString());\n+            } else {\n+                if (!symbol.isClassOrInterface())\n+                    return false;\n+                var desc = symbol.descriptorString();\n+                equals = ref1.equalsRegion(desc, 1, desc.length() - 1);\n+            }\n+\n+            if (equals)\n+                this.sym = symbol;\n+            return equals;\n+        }\n+\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/AbstractPoolEntry.java","additions":26,"deletions":0,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8304031 8338406 8338546\n+ * @bug 8304031 8338406 8338546 8342206\n@@ -33,0 +33,1 @@\n+import java.lang.classfile.constantpool.ClassEntry;\n@@ -49,0 +50,1 @@\n+import org.junit.jupiter.params.provider.Arguments;\n@@ -168,0 +170,39 @@\n+\n+    @Test\n+    void testClassEntryEqualsSymbolContract() {\n+        var cp = ConstantPoolBuilder.of();\n+        var ce = cp.classEntry(CD_Object);\n+        assertThrows(NullPointerException.class, () -> ce.equalsSymbol(null));\n+    }\n+\n+    static Stream<Arguments> equalsSymbolProvider() {\n+        var cp = ConstantPoolBuilder.of();\n+        return Stream.of(\n+                Arguments.of(true, cp.classEntry(CD_Object), CD_Object),\n+                Arguments.of(true, cp.classEntry(CD_Object.arrayType()), CD_Object.arrayType()),\n+                Arguments.of(true, cp.classEntry(cp.utf8Entry(\"java\/lang\/Thread\")), ClassDesc.of(\"java.lang.Thread\")),\n+                Arguments.of(true, cp.classEntry(cp.utf8Entry(\"[[Ljava\/lang\/invoke\/MethodHandle;\")), ClassDesc.of(\"java.lang.invoke.MethodHandle\").arrayType(2)),\n+                Arguments.of(false, cp.classEntry(CD_Object), CD_String),\n+                Arguments.of(false, cp.classEntry(cp.utf8Entry(\"\")), CD_Object),\n+                Arguments.of(false, cp.classEntry(cp.utf8Entry(\"&*$#@;;))\")), CD_String),\n+                Arguments.of(false, cp.classEntry(CD_Object.arrayType()), CD_String.arrayType()),\n+                Arguments.of(false, cp.classEntry(cp.utf8Entry(\"Ljava\/lang\/Object;\")), CD_String.arrayType()),\n+                Arguments.of(false, cp.classEntry(cp.utf8Entry(\"java\/lang\/Object\")), CD_String.arrayType()),\n+                Arguments.of(false, cp.classEntry(cp.utf8Entry(\"Ljava\/lang\/Object;\")), CD_String),\n+                Arguments.of(false, cp.classEntry(CD_Object), CD_int)\n+        );\n+    }\n+\n+    @MethodSource(\"equalsSymbolProvider\")\n+    @ParameterizedTest\n+    void testClassEntryEqualsSymbolCase(boolean result, ClassEntry ce, ClassDesc cd) {\n+        boolean noCache = accessCachedClassDesc(ce) == null;\n+        assertEquals(result, ce.equalsSymbol(cd));\n+        if (noCache) {\n+            assertEquals(result, accessCachedClassDesc(ce) != null, () -> \"cache presence after test with result \" + result);\n+        }\n+    }\n+\n+    static ClassDesc accessCachedClassDesc(ClassEntry ce) {\n+        return ((AbstractPoolEntry.ClassEntryImpl) ce).sym;\n+    }\n","filename":"test\/jdk\/jdk\/classfile\/ConstantDescSymbolsTest.java","additions":42,"deletions":1,"binary":false,"changes":43,"status":"modified"}]}