{"files":[{"patch":"@@ -391,0 +391,1 @@\n+  bool stack_slot_is_s2 = true;\n@@ -439,0 +440,6 @@\n+    case STACK_SLOT4_PRIMITIVE:\n+    case STACK_SLOT4_NARROW_OOP:\n+    case STACK_SLOT4_OOP:\n+    case STACK_SLOT4_VECTOR:\n+      stack_slot_is_s2 = false;\n+      \/\/ fall through\n@@ -443,1 +450,1 @@\n-      jint offset = (jshort) stream->read_s2(\"offset\");\n+      jint offset = stack_slot_is_s2 ? (jshort) stream->read_s2(\"offset\") : stream->read_s4(\"offset4\");\n@@ -857,1 +864,1 @@\n-    _orig_pc_offset = stream->read_s2(\"offset\");\n+    _orig_pc_offset = stream->read_s4(\"offset\");\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCodeInstaller.cpp","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -210,0 +210,4 @@\n+    STACK_SLOT4_PRIMITIVE,\n+    STACK_SLOT4_OOP,\n+    STACK_SLOT4_NARROW_OOP,\n+    STACK_SLOT4_VECTOR,\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCodeInstaller.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -582,0 +582,4 @@\n+  declare_constant(CodeInstaller::STACK_SLOT4_PRIMITIVE)                  \\\n+  declare_constant(CodeInstaller::STACK_SLOT4_OOP)                        \\\n+  declare_constant(CodeInstaller::STACK_SLOT4_NARROW_OOP)                 \\\n+  declare_constant(CodeInstaller::STACK_SLOT4_VECTOR)                     \\\n","filename":"src\/hotspot\/share\/jvmci\/vmStructs_jvmci.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -66,0 +66,4 @@\n+import static jdk.vm.ci.hotspot.HotSpotCompiledCodeStream.Tag.STACK_SLOT4_NARROW_OOP;\n+import static jdk.vm.ci.hotspot.HotSpotCompiledCodeStream.Tag.STACK_SLOT4_OOP;\n+import static jdk.vm.ci.hotspot.HotSpotCompiledCodeStream.Tag.STACK_SLOT4_PRIMITIVE;\n+import static jdk.vm.ci.hotspot.HotSpotCompiledCodeStream.Tag.STACK_SLOT4_VECTOR;\n@@ -181,0 +185,4 @@\n+        STACK_SLOT4_PRIMITIVE,\n+        STACK_SLOT4_OOP,\n+        STACK_SLOT4_NARROW_OOP,\n+        STACK_SLOT4_VECTOR,\n@@ -460,0 +468,4 @@\n+    private static boolean isS2(int value) {\n+        return value >= Short.MIN_VALUE && value <= Short.MAX_VALUE;\n+    }\n+\n@@ -461,1 +473,1 @@\n-        if (value < Short.MIN_VALUE || value > Short.MAX_VALUE) {\n+        if (!isS2(value)) {\n@@ -584,1 +596,2 @@\n-            writeS2(\"offset\", deoptRescueSlot.getRawOffset());\n+            int offset = deoptRescueSlot.getRawOffset();\n+            writeInt(\"offset\", offset);\n@@ -1066,0 +1079,2 @@\n+            int offset = slot.getRawOffset();\n+            boolean s2 = isS2(offset);\n@@ -1068,1 +1083,3 @@\n-                    tag = STACK_SLOT_VECTOR;\n+                    tag = s2 ? STACK_SLOT_VECTOR : STACK_SLOT4_VECTOR;\n+                } else if (isNarrowOop(slot)) {\n+                    tag = s2 ? STACK_SLOT_NARROW_OOP : STACK_SLOT4_NARROW_OOP;\n@@ -1070,1 +1087,1 @@\n-                    tag = isNarrowOop(slot) ? STACK_SLOT_NARROW_OOP : STACK_SLOT_OOP;\n+                    tag = s2 ? STACK_SLOT_OOP : STACK_SLOT4_OOP;\n@@ -1073,1 +1090,1 @@\n-                tag = STACK_SLOT_PRIMITIVE;\n+                tag = s2 ? STACK_SLOT_PRIMITIVE : STACK_SLOT4_PRIMITIVE;\n@@ -1076,1 +1093,5 @@\n-            writeS2(\"offset\", slot.getRawOffset());\n+            if (s2) {\n+                writeS2(\"offset\", slot.getRawOffset());\n+            } else {\n+                writeInt(\"offset4\", slot.getRawOffset());\n+            }\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk\/vm\/ci\/hotspot\/HotSpotCompiledCodeStream.java","additions":27,"deletions":6,"binary":false,"changes":33,"status":"modified"}]}