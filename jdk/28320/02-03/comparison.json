{"files":[{"patch":"@@ -2609,0 +2609,36 @@\n+  void cipherBlockChaining_encryptAESCrypt(int round, Register from, Register to, Register key,\n+                                          Register iv, Register input_len) {\n+    const Register len        = x29;\n+\n+    VectorRegister working_vregs[] = {\n+      v1, v2, v3, v4, v5, v6, v7, v8,\n+      v9, v10, v11, v12, v13, v14, v15\n+    };\n+\n+    const unsigned int BLOCK_SIZE = 16;\n+\n+    __ mv(len, input_len);\n+    \/\/ load init iv\n+    __ vsetivli(x0, 4, Assembler::e32, Assembler::m1);\n+    __ vle32_v(v16, iv);\n+\n+    generate_aes_loadkeys(key, working_vregs, round);\n+    Label L_enc_loop;\n+    __ bind(L_enc_loop);\n+    \/\/ Encrypt from source by block size\n+      __ vle32_v(v17, from);\n+      __ addi(from, from, BLOCK_SIZE);\n+      __ vxor_vv(v16, v16, v17);\n+      generate_aes_encrypt(v16, working_vregs, round);\n+      __ vse32_v(v16, to);\n+      __ addi(to, to, BLOCK_SIZE);\n+      __ subi(len, len, BLOCK_SIZE);\n+      __ bnez(len, L_enc_loop);\n+\n+    \/\/ save current iv and return\n+    __ vse32_v(v16, iv);\n+    __ mv(x10, input_len);\n+    __ leave();\n+    __ ret();\n+  }\n+\n@@ -2635,8 +2671,0 @@\n-    const Register len        = x29;\n-\n-    const unsigned int BLOCK_SIZE = 16;\n-\n-    VectorRegister working_vregs[] = {\n-      v1, v2, v3, v4, v5, v6, v7, v8,\n-      v9, v10, v11, v12, v13, v14, v15\n-    };\n@@ -2646,4 +2674,0 @@\n-    __ mv(len, input_len);\n-    \/\/ load init iv\n-    __ vsetivli(x0, 4, Assembler::e32, Assembler::m1);\n-    __ vle32_v(v16, iv);\n@@ -2651,1 +2675,1 @@\n-    Label L_aes128, L_aes192, L_aes128_loop, L_aes192_loop, L_aes256_loop;\n+    Label L_aes128, L_aes192;\n@@ -2660,16 +2684,1 @@\n-    generate_aes_loadkeys(key, working_vregs, 15);\n-    \/\/ Encrypt from source by block size\n-    __ bind(L_aes256_loop);\n-      __ vle32_v(v17, from);\n-      __ addi(from, from, BLOCK_SIZE);\n-      __ vxor_vv(v16, v16, v17);\n-      generate_aes_encrypt(v16, working_vregs, 15);\n-      __ vse32_v(v16, to);\n-      __ addi(to, to, BLOCK_SIZE);\n-      __ subi(len, len, BLOCK_SIZE);\n-      __ bnez(len, L_aes256_loop);\n-      \/\/ save current iv and return\n-      __ vse32_v(v16, iv);\n-      __ mv(x10, input_len);\n-      __ leave();\n-      __ ret();\n+    cipherBlockChaining_encryptAESCrypt(15, from, to, key, iv, input_len);\n@@ -2679,16 +2688,1 @@\n-    generate_aes_loadkeys(key, working_vregs, 11);\n-    \/\/ Encrypt from source by block size\n-    __ bind(L_aes128_loop);\n-      __ vle32_v(v17, from);\n-      __ addi(from, from, BLOCK_SIZE);\n-      __ vxor_vv(v16, v16, v17);\n-      generate_aes_encrypt(v16, working_vregs, 11);\n-      __ vse32_v(v16, to);\n-      __ addi(to, to, BLOCK_SIZE);\n-      __ subi(len, len, BLOCK_SIZE);\n-      __ bnez(len, L_aes128_loop);\n-      \/\/ save current iv and return\n-      __ vse32_v(v16, iv);\n-      __ mv(x10, input_len);\n-      __ leave();\n-      __ ret();\n+    cipherBlockChaining_encryptAESCrypt(11, from, to, key, iv, input_len);\n@@ -2698,3 +2692,25 @@\n-    generate_aes_loadkeys(key, working_vregs, 13);\n-    \/\/ Encrypt from source by block size\n-    __ bind(L_aes192_loop);\n+    cipherBlockChaining_encryptAESCrypt(13, from, to, key, iv, input_len);\n+\n+    return start;\n+  }\n+\n+  void cipherBlockChaining_decryptAESCrypt(int round, Register from, Register to, Register key,\n+                                        Register iv, Register input_len) {\n+    const Register len         = x29;\n+\n+    VectorRegister working_vregs[] = {\n+      v1, v2, v3, v4, v5, v6, v7, v8,\n+      v9, v10, v11, v12, v13, v14, v15\n+    };\n+\n+    const unsigned int BLOCK_SIZE = 16;\n+\n+    __ mv(len, input_len);\n+    \/\/ load init iv\n+    __ vsetivli(x0, 4, Assembler::e32, Assembler::m1);\n+    __ vle32_v(v16, iv);\n+\n+    generate_aes_loadkeys(key, working_vregs, round);\n+    Label L_dec_loop;\n+    \/\/ Decrypt from source by block size\n+    __ bind(L_dec_loop);\n@@ -2703,3 +2719,5 @@\n-      __ vxor_vv(v16, v16, v17);\n-      generate_aes_encrypt(v16, working_vregs, 13);\n-      __ vse32_v(v16, to);\n+      __ vmv_v_v(v18, v17);\n+      generate_aes_decrypt(v17, working_vregs, round);\n+      __ vxor_vv(v17, v17, v16);\n+      __ vse32_v(v17, to);\n+      __ vmv_v_v(v16, v18);\n@@ -2708,6 +2726,1 @@\n-      __ bnez(len, L_aes192_loop);\n-      \/\/ save current iv and return\n-      __ vse32_v(v16, iv);\n-      __ mv(x10, input_len);\n-      __ leave();\n-      __ ret();\n+      __ bnez(len, L_dec_loop);\n@@ -2715,1 +2728,5 @@\n-    return start;\n+    \/\/ save current iv and return\n+    __ vse32_v(v16, iv);\n+    __ mv(x10, input_len);\n+    __ leave();\n+    __ ret();\n@@ -2744,8 +2761,0 @@\n-    const Register len         = x29;\n-\n-    const unsigned int BLOCK_SIZE = 16;\n-\n-    VectorRegister working_vregs[] = {\n-      v1, v2, v3, v4, v5, v6, v7, v8,\n-      v9, v10, v11, v12, v13, v14, v15\n-    };\n@@ -2755,4 +2764,0 @@\n-    __ mv(len, input_len);\n-    \/\/ load init iv\n-    __ vsetivli(x0, 4, Assembler::e32, Assembler::m1);\n-    __ vle32_v(v16, iv);\n@@ -2769,18 +2774,1 @@\n-    generate_aes_loadkeys(key, working_vregs, 15);\n-    \/\/ Decrypt from source by block size\n-    __ bind(L_aes256_loop);\n-      __ vle32_v(v17, from);\n-      __ addi(from, from, BLOCK_SIZE);\n-      __ vmv_v_v(v18, v17);\n-      generate_aes_decrypt(v17, working_vregs, 15);\n-      __ vxor_vv(v17, v17, v16);\n-      __ vse32_v(v17, to);\n-      __ vmv_v_v(v16, v18);\n-      __ addi(to, to, BLOCK_SIZE);\n-      __ subi(len, len, BLOCK_SIZE);\n-      __ bnez(len, L_aes256_loop);\n-      \/\/ save current iv and return\n-      __ vse32_v(v16, iv);\n-      __ mv(x10, input_len);\n-      __ leave();\n-      __ ret();\n+    cipherBlockChaining_decryptAESCrypt(15, from, to, key, iv, input_len);\n@@ -2790,18 +2778,1 @@\n-    generate_aes_loadkeys(key, working_vregs, 11);\n-    \/\/ Decrypt from source by block size\n-    __ bind(L_aes128_loop);\n-      __ vle32_v(v17, from);\n-      __ addi(from, from, BLOCK_SIZE);\n-      __ vmv_v_v(v18, v17);\n-      generate_aes_decrypt(v17, working_vregs, 11);\n-      __ vxor_vv(v17, v17, v16);\n-      __ vse32_v(v17, to);\n-      __ vmv_v_v(v16, v18);\n-      __ addi(to, to, BLOCK_SIZE);\n-      __ subi(len, len, BLOCK_SIZE);\n-      __ bnez(len, L_aes128_loop);\n-      \/\/ save current iv and return\n-      __ vse32_v(v16, iv);\n-      __ mv(x10, input_len);\n-      __ leave();\n-      __ ret();\n+    cipherBlockChaining_decryptAESCrypt(11, from, to, key, iv, input_len);\n@@ -2811,18 +2782,1 @@\n-    generate_aes_loadkeys(key, working_vregs, 13);\n-    \/\/ Decrypt from source by block size\n-    __ bind(L_aes192_loop);\n-      __ vle32_v(v17, from);\n-      __ addi(from, from, BLOCK_SIZE);\n-      __ vmv_v_v(v18, v17);\n-      generate_aes_decrypt(v17, working_vregs, 13);\n-      __ vxor_vv(v17, v17, v16);\n-      __ vse32_v(v17, to);\n-      __ vmv_v_v(v16, v18);\n-      __ addi(to, to, BLOCK_SIZE);\n-      __ subi(len, len, BLOCK_SIZE);\n-      __ bnez(len, L_aes192_loop);\n-      \/\/ save current iv and return\n-      __ vse32_v(v16, iv);\n-      __ mv(x10, input_len);\n-      __ leave();\n-      __ ret();\n+    cipherBlockChaining_decryptAESCrypt(13, from, to, key, iv, input_len);\n","filename":"src\/hotspot\/cpu\/riscv\/stubGenerator_riscv.cpp","additions":78,"deletions":124,"binary":false,"changes":202,"status":"modified"}]}