{"files":[{"patch":"@@ -272,1 +272,9 @@\n-    Metadata* klass = obj->metadata_field(java_lang_Class::klass_offset());\n+    \/\/ During class redefinition the old Klass gets reclaimed and the old mirror oop's Klass reference\n+    \/\/ nulled out (hence the \"klass != nullptr\" condition below). However, the mirror oop may have been\n+    \/\/ forwarded if we are in the mids of an evacuation. In that case, the forwardee's Klass reference\n+    \/\/ is nulled out. The old, forwarded, still still carries the old invalid Klass pointer. It will be\n+    \/\/ eventually collected.\n+    \/\/ This checking code may encounter the old copy of the mirror, and its referee Klass pointer may\n+    \/\/ already be reclaimed and therefore be invalid. We must therefore check the forwardee's Klass\n+    \/\/ reference.\n+    const Metadata* klass = fwd->metadata_field(java_lang_Class::klass_offset());\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahAsserts.cpp","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -250,1 +250,9 @@\n-      Metadata* klass = obj->metadata_field(java_lang_Class::klass_offset());\n+      \/\/ During class redefinition the old Klass gets reclaimed and the old mirror oop's Klass reference\n+      \/\/ nulled out (hence the \"klass != nullptr\" condition below). However, the mirror oop may have been\n+      \/\/ forwarded if we are in the mids of an evacuation. In that case, the forwardee's Klass reference\n+      \/\/ is nulled out. The old, forwarded, still still carries the old invalid Klass pointer. It will be\n+      \/\/ eventually collected.\n+      \/\/ This checking code may encounter the old copy of the mirror, and its referee Klass pointer may\n+      \/\/ already be reclaimed and therefore be invalid. We must therefore check the forwardee's Klass\n+      \/\/ reference.\n+      Metadata* klass = fwd->metadata_field(java_lang_Class::klass_offset());\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahVerifier.cpp","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"}]}