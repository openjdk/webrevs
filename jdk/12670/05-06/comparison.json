{"files":[{"patch":"@@ -699,0 +699,73 @@\n+  \/\/ Helper object to reduce noise when telling the GC barriers how to perform loads and stores\n+  \/\/ for arraycopy stubs.\n+  class ArrayCopyBarrierSetHelper : StackObj {\n+    BarrierSetAssembler* _bs_asm;\n+    MacroAssembler* _masm;\n+    DecoratorSet _decorators;\n+    BasicType _type;\n+    Register _gct1;\n+    Register _gct2;\n+    Register _gct3;\n+    FloatRegister _gcvt1;\n+    FloatRegister _gcvt2;\n+    FloatRegister _gcvt3;\n+\n+  public:\n+    ArrayCopyBarrierSetHelper(MacroAssembler* masm,\n+                              DecoratorSet decorators,\n+                              BasicType type,\n+                              Register gct1,\n+                              Register gct2,\n+                              Register gct3,\n+                              FloatRegister gcvt1,\n+                              FloatRegister gcvt2,\n+                              FloatRegister gcvt3)\n+      : _bs_asm(BarrierSet::barrier_set()->barrier_set_assembler()),\n+        _masm(masm),\n+        _decorators(decorators),\n+        _type(type),\n+        _gct1(gct1),\n+        _gct2(gct2),\n+        _gct3(gct3),\n+        _gcvt1(gcvt1),\n+        _gcvt2(gcvt2),\n+        _gcvt3(gcvt3) {\n+    }\n+\n+    void copy_load_at_32(FloatRegister dst1, FloatRegister dst2, Address src) {\n+      _bs_asm->copy_load_at(_masm, _decorators, _type, 32,\n+                            dst1, dst2, src,\n+                            _gct1, _gct2, _gcvt1);\n+    }\n+\n+    void copy_store_at_32(Address dst, FloatRegister src1, FloatRegister src2) {\n+      _bs_asm->copy_store_at(_masm, _decorators, _type, 32,\n+                             dst, src1, src2,\n+                             _gct1, _gct2, _gct3, _gcvt1, _gcvt2, _gcvt3);\n+    }\n+\n+    void copy_load_at_16(Register dst1, Register dst2, Address src) {\n+      _bs_asm->copy_load_at(_masm, _decorators, _type, 16,\n+                            dst1, dst2, src,\n+                            _gct1);\n+    }\n+\n+    void copy_store_at_16(Address dst, Register src1, Register src2) {\n+      _bs_asm->copy_store_at(_masm, _decorators, _type, 16,\n+                             dst, src1, src2,\n+                             _gct1, _gct2, _gct3);\n+    }\n+\n+    void copy_load_at_8(Register dst, Address src) {\n+      _bs_asm->copy_load_at(_masm, _decorators, _type, 8,\n+                            dst, noreg, src,\n+                            _gct1);\n+    }\n+\n+    void copy_store_at_8(Address dst, Register src) {\n+      _bs_asm->copy_store_at(_masm, _decorators, _type, 8,\n+                             dst, src, noreg,\n+                             _gct1, _gct2, _gct3);\n+    }\n+  };\n+\n@@ -722,1 +795,1 @@\n-    BarrierSetAssembler* bs_asm = BarrierSet::barrier_set()->barrier_set_assembler();\n+    ArrayCopyBarrierSetHelper bs(_masm, decorators, type, gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n@@ -763,6 +836,2 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v0, v1, Address(s, 4 * unit),\n-                           gct1, gct2, gcvt1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v2, v3, Address(__ pre(s, 8 * unit)),\n-                           gct1, gct2, gcvt1);\n+      bs.copy_load_at_32(v0, v1, Address(s, 4 * unit));\n+      bs.copy_load_at_32(v2, v3, Address(__ pre(s, 8 * unit)));\n@@ -770,12 +839,4 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t0, t1, Address(s, 2 * unit),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t2, t3, Address(s, 4 * unit),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t4, t5, Address(s, 6 * unit),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t6, t7, Address(__ pre(s, 8 * unit)),\n-                           gct1);\n+      bs.copy_load_at_16(t0, t1, Address(s, 2 * unit));\n+      bs.copy_load_at_16(t2, t3, Address(s, 4 * unit));\n+      bs.copy_load_at_16(t4, t5, Address(s, 6 * unit));\n+      bs.copy_load_at_16(t6, t7, Address(__ pre(s, 8 * unit)));\n@@ -801,12 +862,4 @@\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(d, 4 * unit), v0, v1,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v0, v1, Address(s, 4 * unit),\n-                           gct1, gct2, gcvt1);\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(__ pre(d, 8 * unit)), v2, v3,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v2, v3, Address(__ pre(s, 8 * unit)),\n-                           gct1, gct2, gcvt1);\n+      bs.copy_store_at_32(Address(d, 4 * unit), v0, v1);\n+      bs.copy_load_at_32(v0, v1, Address(s, 4 * unit));\n+      bs.copy_store_at_32(Address(__ pre(d, 8 * unit)), v2, v3);\n+      bs.copy_load_at_32(v2, v3, Address(__ pre(s, 8 * unit)));\n@@ -814,24 +867,8 @@\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 2 * unit), t0, t1,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t0, t1, Address(s, 2 * unit),\n-                           gct1);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 4 * unit), t2, t3,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t2, t3, Address(s, 4 * unit),\n-                           gct1);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 6 * unit), t4, t5,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t4, t5, Address(s, 6 * unit),\n-                           gct1);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(__ pre(d, 8 * unit)), t6, t7,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t6, t7, Address(__ pre(s, 8 * unit)),\n-                           gct1);\n+      bs.copy_store_at_16(Address(d, 2 * unit), t0, t1);\n+      bs.copy_load_at_16(t0, t1, Address(s, 2 * unit));\n+      bs.copy_store_at_16(Address(d, 4 * unit), t2, t3);\n+      bs.copy_load_at_16(t2, t3, Address(s, 4 * unit));\n+      bs.copy_store_at_16(Address(d, 6 * unit), t4, t5);\n+      bs.copy_load_at_16(t4, t5, Address(s, 6 * unit));\n+      bs.copy_store_at_16(Address(__ pre(d, 8 * unit)), t6, t7);\n+      bs.copy_load_at_16(t6, t7, Address(__ pre(s, 8 * unit)));\n@@ -846,6 +883,2 @@\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(d, 4 * unit), v0, v1,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(__ pre(d, 8 * unit)), v2, v3,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n+      bs.copy_store_at_32(Address(d, 4 * unit), v0, v1);\n+      bs.copy_store_at_32(Address(__ pre(d, 8 * unit)), v2, v3);\n@@ -853,12 +886,4 @@\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 2 * unit), t0, t1,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 4 * unit), t2, t3,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 6 * unit), t4, t5,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(__ pre(d, 8 * unit)), t6, t7,\n-                            gct1, gct2, gct3);\n+      bs.copy_store_at_16(Address(d, 2 * unit), t0, t1);\n+      bs.copy_store_at_16(Address(d, 4 * unit), t2, t3);\n+      bs.copy_store_at_16(Address(d, 6 * unit), t4, t5);\n+      bs.copy_store_at_16(Address(__ pre(d, 8 * unit)), t6, t7);\n@@ -871,6 +896,2 @@\n-        bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                             v0, v1, Address(__ pre(s, 4 * unit)),\n-                             gct1, gct2, gcvt1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                              Address(__ pre(d, 4 * unit)), v0, v1,\n-                              gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n+        bs.copy_load_at_32(v0, v1, Address(__ pre(s, 4 * unit)));\n+        bs.copy_store_at_32(Address(__ pre(d, 4 * unit)), v0, v1);\n@@ -878,12 +899,4 @@\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t0, t1, Address(s, 2 * unit),\n-                             gct1);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t2, t3, Address(__ pre(s, 4 * unit)),\n-                             gct1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 2 * unit), t0, t1,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(__ pre(d, 4 * unit)), t2, t3,\n-                              gct1, gct2, gct3);\n+        bs.copy_load_at_16(t0, t1, Address(s, 2 * unit));\n+        bs.copy_load_at_16(t2, t3, Address(__ pre(s, 4 * unit)));\n+        bs.copy_store_at_16(Address(d, 2 * unit), t0, t1);\n+        bs.copy_store_at_16(Address(__ pre(d, 4 * unit)), t2, t3);\n@@ -899,6 +912,2 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t0, t1, Address(__ adjust(s, 2 * unit, direction == copy_backwards)),\n-                           gct1);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(__ adjust(d, 2 * unit, direction == copy_backwards)), t0, t1,\n-                            gct1, gct2, gct3);\n+      bs.copy_load_at_16(t0, t1, Address(__ adjust(s, 2 * unit, direction == copy_backwards)));\n+      bs.copy_store_at_16(Address(__ adjust(d, 2 * unit, direction == copy_backwards)), t0, t1);\n@@ -963,12 +972,4 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t0, t1, Address(s, 2 * unit),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t2, t3, Address(s, 4 * unit),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t4, t5, Address(s, 6 * unit),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t6, t7, Address(__ pre(s, 8 * unit)),\n-                           gct1);\n+      bs.copy_load_at_16(t0, t1, Address(s, 2 * unit));\n+      bs.copy_load_at_16(t2, t3, Address(s, 4 * unit));\n+      bs.copy_load_at_16(t4, t5, Address(s, 6 * unit));\n+      bs.copy_load_at_16(t6, t7, Address(__ pre(s, 8 * unit)));\n@@ -1003,27 +1004,9 @@\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(d, 1 * unit), t0, noreg,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 2 * unit), t1, t2,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t0, t1, Address(s, 2 * unit),\n-                             gct1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 4 * unit), t3, t4,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t2, t3, Address(s, 4 * unit),\n-                             gct1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 6 * unit), t5, t6,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t4, t5, Address(s, 6 * unit),\n-                             gct1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(__ pre(d, 8 * unit)), t7, noreg,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t6, t7, Address(__ pre(s, 8 * unit)),\n-                             gct1);\n+        bs.copy_store_at_8(Address(d, 1 * unit), t0);\n+        bs.copy_store_at_16(Address(d, 2 * unit), t1, t2);\n+        bs.copy_load_at_16(t0, t1, Address(s, 2 * unit));\n+        bs.copy_store_at_16(Address(d, 4 * unit), t3, t4);\n+        bs.copy_load_at_16(t2, t3, Address(s, 4 * unit));\n+        bs.copy_store_at_16(Address(d, 6 * unit), t5, t6);\n+        bs.copy_load_at_16(t4, t5, Address(s, 6 * unit));\n+        bs.copy_store_at_8(Address(__ pre(d, 8 * unit)), t7);\n+        bs.copy_load_at_16(t6, t7, Address(__ pre(s, 8 * unit)));\n@@ -1044,27 +1027,9 @@\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(d, 1 * unit), t1, noreg,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 3 * unit), t3, t0,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t0, t1, Address(s, 2 * unit),\n-                             gct1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 5 * unit), t5, t2,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t2, t3, Address(s, 4 * unit),\n-                             gct1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 7 * unit), t7, t4,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t4, t5, Address(s, 6 * unit),\n-                             gct1);\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(__ pre(d, 8 * unit)), t6, noreg,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t6, t7, Address(__ pre(s, 8 * unit)),\n-                             gct1);\n+        bs.copy_store_at_8(Address(d, 1 * unit), t1);\n+        bs.copy_store_at_16(Address(d, 3 * unit), t3, t0);\n+        bs.copy_load_at_16(t0, t1, Address(s, 2 * unit));\n+        bs.copy_store_at_16(Address(d, 5 * unit), t5, t2);\n+        bs.copy_load_at_16(t2, t3, Address(s, 4 * unit));\n+        bs.copy_store_at_16(Address(d, 7 * unit), t7, t4);\n+        bs.copy_load_at_16(t4, t5, Address(s, 6 * unit));\n+        bs.copy_store_at_8(Address(__ pre(d, 8 * unit)), t6);\n+        bs.copy_load_at_16(t6, t7, Address(__ pre(s, 8 * unit)));\n@@ -1082,15 +1047,5 @@\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(d, 1 * unit), t0, noreg,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 2 * unit), t1, t2,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 4 * unit), t3, t4,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 6 * unit), t5, t6,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(__ pre(d, 8 * unit)), t7, noreg,\n-                              gct1, gct2, gct3);\n+        bs.copy_store_at_8(Address(d, 1 * unit), t0);\n+        bs.copy_store_at_16(Address(d, 2 * unit), t1, t2);\n+        bs.copy_store_at_16(Address(d, 4 * unit), t3, t4);\n+        bs.copy_store_at_16(Address(d, 6 * unit), t5, t6);\n+        bs.copy_store_at_8(Address(__ pre(d, 8 * unit)), t7);\n@@ -1098,15 +1053,5 @@\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(d, 1 * unit), t1, noreg,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 3 * unit), t3, t0,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 5 * unit), t5, t2,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(d, 7 * unit), t7, t4,\n-                              gct1, gct2, gct3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                              Address(__ pre(d, 8 * unit)), t6, noreg,\n-                              gct1, gct2, gct3);\n+        bs.copy_store_at_8(Address(d, 1 * unit), t1);\n+        bs.copy_store_at_16(Address(d, 3 * unit), t3, t0);\n+        bs.copy_store_at_16(Address(d, 5 * unit), t5, t2);\n+        bs.copy_store_at_16(Address(d, 7 * unit), t7, t4);\n+        bs.copy_store_at_8(Address(__ pre(d, 8 * unit)), t6);\n@@ -1125,6 +1070,2 @@\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t0, t1, Address(s, 2 * unit),\n-                             gct1);\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t2, t3, Address(__ pre(s, 4 * unit)),\n-                             gct1);\n+        bs.copy_load_at_16(t0, t1, Address(s, 2 * unit));\n+        bs.copy_load_at_16(t2, t3, Address(__ pre(s, 4 * unit)));\n@@ -1132,9 +1073,3 @@\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(d, 1 * unit), t0, noreg,\n-                                gct1, gct2, gct3);\n-          bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                                Address(d, 2 * unit), t1, t2,\n-                                gct1, gct2, gct3);\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(__ pre(d, 4 * unit)), t3, noreg,\n-                                gct1, gct2, gct3);\n+          bs.copy_store_at_8(Address(d, 1 * unit), t0);\n+          bs.copy_store_at_16(Address(d, 2 * unit), t1, t2);\n+          bs.copy_store_at_8(Address(__ pre(d, 4 * unit)), t3);\n@@ -1142,9 +1077,3 @@\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(d, 1 * unit), t1, noreg,\n-                                gct1, gct2, gct3);\n-          bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                                Address(d, 3 * unit), t3, t0,\n-                                gct1, gct2, gct3);\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(__ pre(d, 4 * unit)), t2, noreg,\n-                                gct1, gct2, gct3);\n+          bs.copy_store_at_8(Address(d, 1 * unit), t1);\n+          bs.copy_store_at_16(Address(d, 3 * unit), t3, t0);\n+          bs.copy_store_at_8(Address(__ pre(d, 4 * unit)), t2);\n@@ -1159,3 +1088,1 @@\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t0, t1, Address(__ pre(s, 2 * unit)),\n-                             gct1);\n+        bs.copy_load_at_16(t0, t1, Address(__ pre(s, 2 * unit)));\n@@ -1163,6 +1090,2 @@\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(d, 1 * unit), t0, noreg,\n-                                gct1, gct2, gct3);\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(__ pre(d, 2 * unit)), t1, noreg,\n-                                gct1, gct2, gct3);\n+          bs.copy_store_at_8(Address(d, 1 * unit), t0);\n+          bs.copy_store_at_8(Address(__ pre(d, 2 * unit)), t1);\n@@ -1170,6 +1093,2 @@\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(d, 1 * unit), t1, noreg,\n-                                gct1, gct2, gct3);\n-          bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                                Address(__ pre(d, 2 * unit)), t0, noreg,\n-                                gct1, gct2, gct3);\n+          bs.copy_store_at_8(Address(d, 1 * unit), t1);\n+          bs.copy_store_at_8(Address(__ pre(d, 2 * unit)), t0);\n@@ -1210,1 +1129,1 @@\n-    BarrierSetAssembler* bs_asm = BarrierSet::barrier_set()->barrier_set_assembler();\n+    ArrayCopyBarrierSetHelper bs(_masm, decorators, type, gct1, gct2, gct3, fnoreg, fnoreg, fnoreg);\n@@ -1218,6 +1137,2 @@\n-    bs_asm->copy_load_at(_masm, decorators, type, 8,\n-                         t0, noreg, Address(__ adjust(s, direction * wordSize, is_backwards)),\n-                         gct1);\n-    bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                          Address(__ adjust(d, direction * wordSize, is_backwards)), t0, noreg,\n-                          gct1, gct2, gct3);\n+    bs.copy_load_at_8(t0, Address(__ adjust(s, direction * wordSize, is_backwards)));\n+    bs.copy_store_at_8(Address(__ adjust(d, direction * wordSize, is_backwards)), t0);\n@@ -1274,1 +1189,1 @@\n-    BarrierSetAssembler* bs_asm = BarrierSet::barrier_set()->barrier_set_assembler();\n+    ArrayCopyBarrierSetHelper bs(_masm, decorators, type, gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n@@ -1295,12 +1210,4 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v0, v1, Address(s, 0),\n-                           gct1, gct2, gcvt1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v2, v3, Address(send, -32),\n-                           gct1, gct2, gcvt1);\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(d, 0), v0, v1,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(dend, -32), v2, v3,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n+      bs.copy_load_at_32(v0, v1, Address(s, 0));\n+      bs.copy_load_at_32(v2, v3, Address(send, -32));\n+      bs.copy_store_at_32(Address(d, 0), v0, v1);\n+      bs.copy_store_at_32(Address(dend, -32), v2, v3);\n@@ -1308,25 +1215,9 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t0, t1, Address(s, 0),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t2, t3, Address(s, 16),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t4, t5, Address(send, -32),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t6, t7, Address(send, -16),\n-                           gct1);\n-\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 0), t0, t1,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 16), t2, t3,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(dend, -32), t4, t5,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(dend, -16), t6, t7,\n-                            gct1, gct2, gct3);\n+      bs.copy_load_at_16(t0, t1, Address(s, 0));\n+      bs.copy_load_at_16(t2, t3, Address(s, 16));\n+      bs.copy_load_at_16(t4, t5, Address(send, -32));\n+      bs.copy_load_at_16(t6, t7, Address(send, -16));\n+\n+      bs.copy_store_at_16(Address(d, 0), t0, t1);\n+      bs.copy_store_at_16(Address(d, 16), t2, t3);\n+      bs.copy_store_at_16(Address(dend, -32), t4, t5);\n+      bs.copy_store_at_16(Address(dend, -16), t6, t7);\n@@ -1338,13 +1229,5 @@\n-    bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                         t0, t1, Address(s, 0),\n-                         gct1);\n-    bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                         t6, t7, Address(send, -16),\n-                         gct1);\n-\n-    bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                          Address(d, 0), t0, t1,\n-                          gct1, gct2, gct3);\n-    bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                          Address(dend, -16), t6, t7,\n-                          gct1, gct2, gct3);\n+    bs.copy_load_at_16(t0, t1, Address(s, 0));\n+    bs.copy_load_at_16(t6, t7, Address(send, -16));\n+\n+    bs.copy_store_at_16(Address(d, 0), t0, t1);\n+    bs.copy_store_at_16(Address(dend, -16), t6, t7);\n@@ -1357,6 +1240,2 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v0, v1, Address(s, 0),\n-                           gct1, gct2, gcvt1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v2, v3, Address(s, 32),\n-                           gct1, gct2, gcvt1);\n+      bs.copy_load_at_32(v0, v1, Address(s, 0));\n+      bs.copy_load_at_32(v2, v3, Address(s, 32));\n@@ -1374,14 +1253,6 @@\n-        bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                             t0, t1, Address(send, -16),\n-                             gct1);\n-\n-        bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                              Address(d, 0), v0, v1,\n-                              gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-        bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                              Address(d, 32), v2, v3,\n-                              gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-\n-        bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                              Address(dend, -16), t0, t1,\n-                              gct1, gct2, gct3);\n+        bs.copy_load_at_16(t0, t1, Address(send, -16));\n+\n+        bs.copy_store_at_32(Address(d, 0), v0, v1);\n+        bs.copy_store_at_32(Address(d, 32), v2, v3);\n+\n+        bs.copy_store_at_16(Address(dend, -16), t0, t1);\n@@ -1392,14 +1263,6 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 32,\n-                           v4, v5, Address(send, -32),\n-                           gct1, gct2, gcvt1);\n-\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(d, 0), v0, v1,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(d, 32), v2, v3,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n-\n-      bs_asm->copy_store_at(_masm, decorators, type, 32,\n-                            Address(dend, -32), v4, v5,\n-                            gct1, gct2, gct3, gcvt1, gcvt2, gcvt3);\n+      bs.copy_load_at_32(v4, v5, Address(send, -32));\n+\n+      bs.copy_store_at_32(Address(d, 0), v0, v1);\n+      bs.copy_store_at_32(Address(d, 32), v2, v3);\n+\n+      bs.copy_store_at_32(Address(dend, -32), v4, v5);\n@@ -1407,31 +1270,11 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t0, t1, Address(s, 0),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t2, t3, Address(s, 16),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t4, t5, Address(s, 32),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t6, t7, Address(s, 48),\n-                           gct1);\n-      bs_asm->copy_load_at(_masm, decorators, type, 16,\n-                           t8, t9, Address(send, -16),\n-                           gct1);\n-\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 0), t0, t1,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 16), t2, t3,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 32), t4, t5,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(d, 48), t6, t7,\n-                            gct1, gct2, gct3);\n-      bs_asm->copy_store_at(_masm, decorators, type, 16,\n-                            Address(dend, -16), t8, t9,\n-                            gct1, gct2, gct3);\n+      bs.copy_load_at_16(t0, t1, Address(s, 0));\n+      bs.copy_load_at_16(t2, t3, Address(s, 16));\n+      bs.copy_load_at_16(t4, t5, Address(s, 32));\n+      bs.copy_load_at_16(t6, t7, Address(s, 48));\n+      bs.copy_load_at_16(t8, t9, Address(send, -16));\n+\n+      bs.copy_store_at_16(Address(d, 0), t0, t1);\n+      bs.copy_store_at_16(Address(d, 16), t2, t3);\n+      bs.copy_store_at_16(Address(d, 32), t4, t5);\n+      bs.copy_store_at_16(Address(d, 48), t6, t7);\n+      bs.copy_store_at_16(Address(dend, -16), t8, t9);\n@@ -1447,12 +1290,4 @@\n-    bs_asm->copy_load_at(_masm, decorators, type, 8,\n-                         t0, noreg, Address(s, 0),\n-                         gct1);\n-    bs_asm->copy_load_at(_masm, decorators, type, 8,\n-                         t1, noreg, Address(send, -8),\n-                         gct1);\n-    bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                          Address(d, 0), t0, noreg,\n-                          gct1, gct2, gct3);\n-    bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                          Address(dend, -8), t1, noreg,\n-                          gct1, gct2, gct3);\n+    bs.copy_load_at_8(t0, Address(s, 0));\n+    bs.copy_load_at_8(t1, Address(send, -8));\n+    bs.copy_store_at_8(Address(d, 0), t0);\n+    bs.copy_store_at_8(Address(dend, -8), t1);\n@@ -1510,6 +1345,2 @@\n-      bs_asm->copy_load_at(_masm, decorators, type, 8,\n-                           t0, noreg, Address(__ adjust(s, direction * wordSize, is_backwards)),\n-                           gct1);\n-      bs_asm->copy_store_at(_masm, decorators, type, 8,\n-                            Address(__ adjust(d, direction * wordSize, is_backwards)), t0, noreg,\n-                            gct1, gct2, gct3);\n+      bs.copy_load_at_8(t0, Address(__ adjust(s, direction * wordSize, is_backwards)));\n+      bs.copy_store_at_8(Address(__ adjust(d, direction * wordSize, is_backwards)), t0);\n","filename":"src\/hotspot\/cpu\/aarch64\/stubGenerator_aarch64.cpp","additions":204,"deletions":373,"binary":false,"changes":577,"status":"modified"}]}