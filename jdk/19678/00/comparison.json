{"files":[{"patch":"@@ -412,0 +412,3 @@\n+    if (endpos < ZIP64_LOCHDR) {\n+        return -1;\n+    }\n@@ -574,0 +577,2 @@\n+    jlong cenlen64, cenoff64, centot64;\n+    unsigned char end64buf[ZIP64_ENDHDR];\n@@ -601,7 +606,13 @@\n-    if (cenlen == ZIP64_MAGICVAL || cenoff == ZIP64_MAGICVAL ||\n-        total == ZIP64_MAGICCOUNT) {\n-        unsigned char end64buf[ZIP64_ENDHDR];\n-        if ((end64pos = findEND64(zip, end64buf, endpos)) != -1) {\n-            cenlen = ZIP64_ENDSIZ(end64buf);\n-            cenoff = ZIP64_ENDOFF(end64buf);\n-            total = (jint)ZIP64_ENDTOT(end64buf);\n+    if ((end64pos = findEND64(zip, end64buf, endpos)) != -1) {\n+        \/\/ end64 candidate found,\n+        cenlen64 = ZIP64_ENDSIZ(end64buf);\n+        cenoff64 = ZIP64_ENDOFF(end64buf);\n+        centot64 = ZIP64_ENDTOT(end64buf);\n+        \/\/ double-check\n+        if ((cenlen64 == cenlen || cenlen == ZIP64_MAGICVAL) &&\n+            (cenoff64 == cenoff || cenoff == ZIP64_MAGICVAL) &&\n+            (centot64 == total || total == ZIP64_MAGICCOUNT)) {\n+            \/\/ to use the end64 values\n+            cenlen = cenlen64;\n+            cenoff = cenoff64;\n+            total = (jint)centot64;\n","filename":"src\/java.base\/share\/native\/libzip\/zip_util.c","additions":18,"deletions":7,"binary":false,"changes":25,"status":"modified"}]}