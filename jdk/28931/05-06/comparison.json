{"files":[{"patch":"@@ -124,2 +124,2 @@\n-        \/\/ Fail immediately on Windows to avoid cygwin-like functions being\n-        \/\/ loaded, which are not supported and could have a different `size_t`.\n+        \/\/ Fail immediately on Windows to avoid cygwin-like functions\n+        \/\/ being loaded, which are not supported.\n@@ -134,4 +134,0 @@\n-            \/\/ The FFM code has only been tested on macOS and Linux and\n-            \/\/ might fail on other *nix systems. Especially, the `passwd`\n-            \/\/ struct could be defined differently. I've checked several\n-            \/\/ and an extra 100 chars at the end seems enough.\n@@ -152,4 +148,1 @@\n-        if (ss.getUsername() != null) {\n-            \/\/ When getpwuid_r fails, username will not be available.\n-            userPrincipal = new UnixPrincipal(ss.getUsername());\n-        }\n+        userPrincipal = new UnixPrincipal(ss.getUsername());\n@@ -175,3 +168,0 @@\n-            if (ss.getpwuid_r_error != null) {\n-                System.out.println(\"\\t\\t\\t\\t[Reason: \" + ss.getpwuid_r_error + \"]\");\n-            }\n@@ -222,1 +212,1 @@\n-            if (userPrincipal != null && !subject.getPrincipals().contains(userPrincipal)) {\n+            if (!subject.getPrincipals().contains(userPrincipal))\n@@ -224,2 +214,1 @@\n-            }\n-            if (!subject.getPrincipals().contains(UIDPrincipal)) {\n+            if (!subject.getPrincipals().contains(UIDPrincipal))\n@@ -227,2 +216,1 @@\n-            }\n-            if (!subject.getPrincipals().contains(GIDPrincipal)) {\n+            if (!subject.getPrincipals().contains(GIDPrincipal))\n@@ -230,1 +218,0 @@\n-            }\n","filename":"src\/jdk.security.auth\/share\/classes\/com\/sun\/security\/auth\/module\/UnixLoginModule.java","additions":6,"deletions":19,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -74,4 +74,0 @@\n-    \/\/ Record the reason why getpwuid_r failed. UnixLoginModule\n-    \/\/ will display the message when debug is on.\n-    String getpwuid_r_error = null;\n-\n@@ -107,3 +103,0 @@\n-    private static final MethodHandle getgid = LINKER\n-            .downcallHandle(SYMBOL_LOOKUP.findOrThrow(\"getgid\"),\n-                    FunctionDescriptor.of(C_INT));\n@@ -158,0 +151,5 @@\n+        \/\/ The FFM code has only been tested on multiple platforms\n+        \/\/ (including macOS, Linux, AIX, etc) and might fail on other\n+        \/\/ *nix systems. Especially, the `passwd` struct could be defined\n+        \/\/ differently. I've checked several and an extra 100 chars at the\n+        \/\/ end seems enough.\n@@ -187,12 +185,7 @@\n-            if (out != 0 || result.get(ValueLayout.ADDRESS, 0).equals(MemorySegment.NULL)) {\n-                if (out != 0) {\n-                    \/\/ If ERANGE (Result too large) is detected in a new platform,\n-                    \/\/ consider adjusting GETPW_R_SIZE_MAX.\n-                    var err = (MemorySegment) strerror.invokeExact(out);\n-                    getpwuid_r_error = err.reinterpret(Long.MAX_VALUE).getString(0);\n-                } else {\n-                    getpwuid_r_error = \"the requested entry is not found\";\n-                }\n-                uid = Integer.toUnsignedLong(tmpUid);\n-                gid = Integer.toUnsignedLong((int)getgid.invokeExact());\n-                username = null;\n+            if (out != 0) {\n+                \/\/ If ERANGE (Result too large) is detected in a new platform,\n+                \/\/ consider adjusting GETPW_R_SIZE_MAX.\n+                var err = (MemorySegment) strerror.invokeExact(out);\n+                throw new RuntimeException(err.reinterpret(Long.MAX_VALUE).getString(0));\n+            } else if (result.get(ValueLayout.ADDRESS, 0).equals(MemorySegment.NULL)) {\n+                throw new RuntimeException(\"the requested entry is not found\");\n","filename":"src\/jdk.security.auth\/share\/classes\/com\/sun\/security\/auth\/module\/UnixSystem.java","additions":12,"deletions":19,"binary":false,"changes":31,"status":"modified"}]}