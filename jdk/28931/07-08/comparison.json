{"files":[{"patch":"@@ -28,0 +28,1 @@\n+import jdk.internal.util.Architecture;\n@@ -82,0 +83,2 @@\n+    private static final ValueLayout.OfLong C_LONG\n+            = (ValueLayout.OfLong) LINKER.canonicalLayouts().get(\"long\");\n@@ -105,0 +108,5 @@\n+    \/\/ Some architectures require appropriate zero or sign extension to 64 bit.\n+    \/\/ Use long directly before https:\/\/bugs.openjdk.org\/browse\/JDK-8336664 is resolved.\n+    private static final boolean calling_convention_requires_int_as_long\n+            = Architecture.isPPC64() || Architecture.isPPC64LE() || Architecture.isS390();\n+\n@@ -110,1 +118,3 @@\n-                    FunctionDescriptor.of(C_INT, C_INT, C_POINTER, C_POINTER,\n+                    FunctionDescriptor.of(C_INT,\n+                            calling_convention_requires_int_as_long ? C_LONG : C_INT,\n+                            C_POINTER, C_POINTER,\n@@ -175,1 +185,3 @@\n-            var tmpUid = (int) MH_getuid.invokeExact();\n+\n+            long tmpUid = Integer.toUnsignedLong((int) MH_getuid.invokeExact());\n+\n@@ -178,2 +190,8 @@\n-            int out = (int) MH_getpwuid_r.invoke(\n-                    tmpUid, pwd, buffer, GETPW_R_SIZE_MAX, result);\n+            int out = 0;\n+            if (calling_convention_requires_int_as_long) {\n+                out = (int) MH_getpwuid_r.invoke(\n+                        tmpUid, pwd, buffer, GETPW_R_SIZE_MAX, result);\n+            } else {\n+                out = (int) MH_getpwuid_r.invoke(\n+                        (int) tmpUid, pwd, buffer, GETPW_R_SIZE_MAX, result);\n+            }\n","filename":"src\/jdk.security.auth\/share\/classes\/com\/sun\/security\/auth\/module\/UnixSystem.java","additions":22,"deletions":4,"binary":false,"changes":26,"status":"modified"}]}