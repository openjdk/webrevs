{"files":[{"patch":"@@ -88,2 +88,3 @@\n-    private static final StructLayout capturedStateLayout = Linker.Option.captureStateLayout();\n-    private static final VarHandle errnoHandle = capturedStateLayout.varHandle(\n+    private static final StructLayout CAPTURE_STATE_LAYOUT\n+            = Linker.Option.captureStateLayout();\n+    private static final VarHandle VH_errno = CAPTURE_STATE_LAYOUT.varHandle(\n@@ -92,2 +93,2 @@\n-    private static final MethodHandle strerror = LINKER\n-            .downcallHandle(SYMBOL_LOOKUP.findOrThrow(\"strerror\"),\n+    private static final MethodHandle MH_strerror\n+            = LINKER.downcallHandle(SYMBOL_LOOKUP.findOrThrow(\"strerror\"),\n@@ -96,2 +97,2 @@\n-    private static final MethodHandle getgroups = LINKER\n-            .downcallHandle(SYMBOL_LOOKUP.findOrThrow(\"getgroups\"),\n+    private static final MethodHandle MH_getgroups\n+            = LINKER.downcallHandle(SYMBOL_LOOKUP.findOrThrow(\"getgroups\"),\n@@ -100,2 +101,2 @@\n-    private static final MethodHandle getuid = LINKER\n-            .downcallHandle(SYMBOL_LOOKUP.findOrThrow(\"getuid\"),\n+    private static final MethodHandle MH_getuid\n+            = LINKER.downcallHandle(SYMBOL_LOOKUP.findOrThrow(\"getuid\"),\n@@ -106,2 +107,2 @@\n-    private static final MethodHandle getpwuid_r = LINKER\n-            .downcallHandle(SYMBOL_LOOKUP.findOrThrow(\n+    private static final MethodHandle MH_getpwuid_r\n+            = LINKER.downcallHandle(SYMBOL_LOOKUP.findOrThrow(\n@@ -113,1 +114,1 @@\n-    private static final GroupLayout passwd_layout = MemoryLayout.structLayout(\n+    private static final GroupLayout ML_passwd = MemoryLayout.structLayout(\n@@ -123,12 +124,6 @@\n-    private static final ValueLayout.OfInt pw_uid_layout\n-            = (ValueLayout.OfInt) passwd_layout.select(groupElement(\"pw_uid\"));\n-    private static final long pw_uid_offset\n-            = passwd_layout.byteOffset(groupElement(\"pw_uid\"));\n-    private static final ValueLayout.OfInt pw_gid_layout\n-            = (ValueLayout.OfInt) passwd_layout.select(groupElement(\"pw_gid\"));\n-    private static final long pw_gid_offset\n-            = passwd_layout.byteOffset(groupElement(\"pw_gid\"));\n-    private static final AddressLayout pw_name_layout\n-            = (AddressLayout) passwd_layout.select(groupElement(\"pw_name\"));\n-    private static final long pw_name_offset\n-            = passwd_layout.byteOffset(groupElement(\"pw_name\"));\n+    private static final VarHandle VH_pw_uid\n+            = ML_passwd.varHandle(groupElement(\"pw_uid\"));\n+    private static final VarHandle VH_pw_gid\n+            = ML_passwd.varHandle(groupElement(\"pw_gid\"));\n+    private static final VarHandle VH_pw_name\n+            = ML_passwd.varHandle(groupElement(\"pw_name\"));\n@@ -157,2 +152,2 @@\n-            MemorySegment capturedState = scope.allocate(capturedStateLayout);\n-            int groupnum = (int) getgroups.invokeExact(capturedState, 0, MemorySegment.NULL);\n+            MemorySegment capturedState = scope.allocate(CAPTURE_STATE_LAYOUT);\n+            int groupnum = (int) MH_getgroups.invokeExact(capturedState, 0, MemorySegment.NULL);\n@@ -164,1 +159,1 @@\n-            groupnum = (int) getgroups.invokeExact(capturedState, groupnum, gs);\n+            groupnum = (int) MH_getgroups.invokeExact(capturedState, groupnum, gs);\n@@ -166,2 +161,2 @@\n-                var errno = (int) errnoHandle.get(capturedState, 0L);\n-                var errMsg = (MemorySegment) strerror.invokeExact(errno);\n+                var errno = (int) VH_errno.get(capturedState, 0L);\n+                var errMsg = (MemorySegment) MH_strerror.invokeExact(errno);\n@@ -177,1 +172,1 @@\n-            var pwd = scope.allocate(passwd_layout);\n+            var pwd = scope.allocate(ML_passwd);\n@@ -180,1 +175,1 @@\n-            var tmpUid = (int)getuid.invokeExact();\n+            var tmpUid = (int) MH_getuid.invokeExact();\n@@ -183,1 +178,1 @@\n-            int out = (int) getpwuid_r.invoke(\n+            int out = (int) MH_getpwuid_r.invoke(\n@@ -188,1 +183,1 @@\n-                var err = (MemorySegment) strerror.invokeExact(out);\n+                var err = (MemorySegment) MH_strerror.invokeExact(out);\n@@ -194,3 +189,3 @@\n-                uid = Integer.toUnsignedLong(pwd.get(pw_uid_layout, pw_uid_offset));\n-                gid = Integer.toUnsignedLong(pwd.get(pw_gid_layout, pw_gid_offset));\n-                username = pwd.get(pw_name_layout, pw_name_offset).getString(0);\n+                uid = Integer.toUnsignedLong((int) VH_pw_uid.get(pwd, 0L));\n+                gid = Integer.toUnsignedLong((int) VH_pw_gid.get(pwd, 0L));\n+                username = ((MemorySegment) VH_pw_name.get(pwd, 0L)).getString(0);\n","filename":"src\/jdk.security.auth\/share\/classes\/com\/sun\/security\/auth\/module\/UnixSystem.java","additions":30,"deletions":35,"binary":false,"changes":65,"status":"modified"}]}