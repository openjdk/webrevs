{"files":[{"patch":"@@ -352,1 +352,0 @@\n-            var labelContext = this.labelContext;\n@@ -394,4 +393,3 @@\n-                var gen = StackMapGenerator.this;\n-                b.writeU2(gen.framesCount);\n-                Frame prevFrame = gen.new Frame(gen.classHierarchy);\n-                prevFrame.setLocalsFromArg(gen.methodName, gen.methodDesc, gen.isStatic, gen.thisType);\n+                b.writeU2(framesCount);\n+                Frame prevFrame =  new Frame(classHierarchy);\n+                prevFrame.setLocalsFromArg(methodName, methodDesc, isStatic, thisType);\n@@ -399,2 +397,2 @@\n-                for (int i = 0; i < gen.framesCount; i++) {\n-                    var fr = gen.frames[i];\n+                for (int i = 0; i < framesCount; i++) {\n+                    var fr = frames[i];\n@@ -402,1 +400,1 @@\n-                    fr.writeTo(b, prevFrame, gen.cp);\n+                    fr.writeTo(b, prevFrame, cp);\n@@ -465,1 +463,0 @@\n-        var currentFrame = this.currentFrame;\n@@ -506,1 +503,1 @@\n-                currentFrame.decStack2PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.INTEGER_TYPE);\n@@ -508,1 +505,1 @@\n-                currentFrame.decStack2PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n@@ -510,1 +507,1 @@\n-                currentFrame.decStack2PushStack(Type.FLOAT_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.FLOAT_TYPE);\n@@ -512,1 +509,1 @@\n-                currentFrame.decStack2PushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n@@ -514,1 +511,1 @@\n-                currentFrame.pushStack((type1 = currentFrame.decStack().popStack()) == Type.NULL_TYPE ? Type.NULL_TYPE : type1.getComponent());\n+                currentFrame.pushStack((type1 = currentFrame.decStack(1).popStack()) == Type.NULL_TYPE ? Type.NULL_TYPE : type1.getComponent());\n@@ -516,1 +513,1 @@\n-                currentFrame.decStack().setLocal(bcs.getIndex(), Type.INTEGER_TYPE);\n+                currentFrame.decStack(1).setLocal(bcs.getIndex(), Type.INTEGER_TYPE);\n@@ -518,1 +515,1 @@\n-                currentFrame.decStack().setLocal(opcode - ISTORE_0, Type.INTEGER_TYPE);\n+                currentFrame.decStack(1).setLocal(opcode - ISTORE_0, Type.INTEGER_TYPE);\n@@ -524,1 +521,1 @@\n-                currentFrame.decStack().setLocal(bcs.getIndex(), Type.FLOAT_TYPE);\n+                currentFrame.decStack(1).setLocal(bcs.getIndex(), Type.FLOAT_TYPE);\n@@ -526,1 +523,1 @@\n-                currentFrame.decStack().setLocal(opcode - FSTORE_0, Type.FLOAT_TYPE);\n+                currentFrame.decStack(1).setLocal(opcode - FSTORE_0, Type.FLOAT_TYPE);\n@@ -540,1 +537,1 @@\n-                currentFrame.decStack();\n+                currentFrame.decStack(1);\n@@ -544,13 +541,36 @@\n-                currentFrame.dup();\n-            case DUP_X1 ->\n-                currentFrame.dup_x1();\n-            case DUP_X2 ->\n-                currentFrame.dup_x2();\n-            case DUP2 ->\n-                currentFrame.dup2();\n-            case DUP2_X1 ->\n-                currentFrame.dup2_x1();\n-            case DUP2_X2 ->\n-                currentFrame.dup2_x2();\n-            case SWAP ->\n-                currentFrame.swap();\n+                currentFrame.pushStack(type1 = currentFrame.popStack()).pushStack(type1);\n+            case DUP_X1 -> {\n+                type1 = currentFrame.popStack();\n+                type2 = currentFrame.popStack();\n+                currentFrame.pushStack(type1).pushStack(type2).pushStack(type1);\n+            }\n+            case DUP_X2 -> {\n+                type1 = currentFrame.popStack();\n+                type2 = currentFrame.popStack();\n+                type3 = currentFrame.popStack();\n+                currentFrame.pushStack(type1).pushStack(type3).pushStack(type2).pushStack(type1);\n+            }\n+            case DUP2 -> {\n+                type1 = currentFrame.popStack();\n+                type2 = currentFrame.popStack();\n+                currentFrame.pushStack(type2).pushStack(type1).pushStack(type2).pushStack(type1);\n+            }\n+            case DUP2_X1 -> {\n+                type1 = currentFrame.popStack();\n+                type2 = currentFrame.popStack();\n+                type3 = currentFrame.popStack();\n+                currentFrame.pushStack(type2).pushStack(type1).pushStack(type3).pushStack(type2).pushStack(type1);\n+            }\n+            case DUP2_X2 -> {\n+                type1 = currentFrame.popStack();\n+                type2 = currentFrame.popStack();\n+                type3 = currentFrame.popStack();\n+                type4 = currentFrame.popStack();\n+                currentFrame.pushStack(type2).pushStack(type1).pushStack(type4).pushStack(type3).pushStack(type2).pushStack(type1);\n+            }\n+            case SWAP -> {\n+                type1 = currentFrame.popStack();\n+                type2 = currentFrame.popStack();\n+                currentFrame.pushStack(type1);\n+                currentFrame.pushStack(type2);\n+            }\n@@ -558,1 +578,1 @@\n-                currentFrame.decStack2PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.INTEGER_TYPE);\n@@ -560,1 +580,1 @@\n-                currentFrame.decStack1PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.INTEGER_TYPE);\n@@ -562,1 +582,1 @@\n-                currentFrame.decStack4PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n+                currentFrame.decStack(4).pushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n@@ -564,1 +584,1 @@\n-                currentFrame.decStack2PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n@@ -566,1 +586,1 @@\n-                currentFrame.decStack3PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n+                currentFrame.decStack(3).pushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n@@ -568,1 +588,1 @@\n-                currentFrame.decStack2PushStack(Type.FLOAT_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.FLOAT_TYPE);\n@@ -570,1 +590,1 @@\n-                currentFrame.decStack1PushStack(Type.FLOAT_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.FLOAT_TYPE);\n@@ -572,1 +592,1 @@\n-                currentFrame.decStack4PushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n+                currentFrame.decStack(4).pushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n@@ -574,1 +594,1 @@\n-                currentFrame.decStack2PushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n@@ -578,1 +598,1 @@\n-                currentFrame.decStack1PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n@@ -580,1 +600,1 @@\n-                currentFrame.decStack2PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.INTEGER_TYPE);\n@@ -582,1 +602,1 @@\n-                currentFrame.decStack1PushStack(Type.FLOAT_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.FLOAT_TYPE);\n@@ -584,1 +604,1 @@\n-                currentFrame.decStack1PushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n@@ -586,1 +606,1 @@\n-                currentFrame.decStack2PushStack(Type.FLOAT_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.FLOAT_TYPE);\n@@ -588,1 +608,1 @@\n-                currentFrame.decStack2PushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n@@ -590,1 +610,1 @@\n-                currentFrame.decStack1PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.INTEGER_TYPE);\n@@ -592,1 +612,1 @@\n-                currentFrame.decStack1PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n@@ -594,1 +614,1 @@\n-                currentFrame.decStack1PushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n@@ -596,1 +616,1 @@\n-                currentFrame.decStack2PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n@@ -598,1 +618,1 @@\n-                currentFrame.decStack2PushStack(Type.FLOAT_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.FLOAT_TYPE);\n@@ -600,1 +620,1 @@\n-                currentFrame.decStack1PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(1).pushStack(Type.INTEGER_TYPE);\n@@ -602,1 +622,1 @@\n-                currentFrame.decStack4PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(4).pushStack(Type.INTEGER_TYPE);\n@@ -604,1 +624,1 @@\n-                currentFrame.decStack2PushStack(Type.INTEGER_TYPE);\n+                currentFrame.decStack(2).pushStack(Type.INTEGER_TYPE);\n@@ -608,1 +628,1 @@\n-                checkJumpTarget(currentFrame.decStack(), bcs.dest());\n+                checkJumpTarget(currentFrame.decStack(1), bcs.dest());\n@@ -626,1 +646,1 @@\n-                currentFrame.decStack();\n+                currentFrame.decStack(1);\n@@ -636,1 +656,1 @@\n-                currentFrame.decStack1PushStack(getNewarrayType(bcs.getIndex()));\n+                currentFrame.decStack(1).pushStack(getNewarrayType(bcs.getIndex()));\n@@ -640,1 +660,1 @@\n-                currentFrame.decStack1PushStack(cpIndexToType(bcs.getIndexU2(), cp));\n+                currentFrame.decStack(1).pushStack(cpIndexToType(bcs.getIndexU2(), cp));\n@@ -643,3 +663,4 @@\n-                currentFrame.decStack(\n-                        bcs.getU1Unchecked(bcs.bci() + 3) \/* dim *\/\n-                );\n+                int dim = bcs.getU1Unchecked(bcs.bci() + 3);\n+                for (int i = 0; i < dim; i++) {\n+                    currentFrame.popStack();\n+                }\n@@ -660,1 +681,0 @@\n-        var currentFrame = this.currentFrame;\n@@ -673,4 +693,1 @@\n-        var e = cp.entryByIndex(index);\n-        byte tag = e.tag();\n-        var currentFrame = this.currentFrame;\n-        switch (tag) {\n+        switch (cp.entryByIndex(index).tag()) {\n@@ -696,1 +713,1 @@\n-                currentFrame.pushStack(ClassReaderImpl.checkType(e, index, ConstantDynamicEntry.class).asSymbol().constantType());\n+                currentFrame.pushStack(cp.entryByIndex(index, ConstantDynamicEntry.class).asSymbol().constantType());\n@@ -698,1 +715,1 @@\n-                throw generatorError(\"CP entry #%d %s is not loadable constant\".formatted(index, tag));\n+                throw generatorError(\"CP entry #%d %s is not loadable constant\".formatted(index, cp.entryByIndex(index).tag()));\n@@ -707,1 +724,1 @@\n-        currentFrame.decStack();\n+        currentFrame.popStack();\n@@ -751,1 +768,2 @@\n-                currentFrame.dec1PushStack(desc);\n+                currentFrame.decStack(1);\n+                currentFrame.pushStack(desc);\n@@ -789,1 +807,1 @@\n-                currentFrame.decStack();\n+                currentFrame.decStack(1);\n@@ -802,1 +820,1 @@\n-        currentFrame.decStack();\n+        currentFrame.popStack();\n@@ -806,7 +824,0 @@\n-    \/**\n-     * {@return the generator error with stack underflow}\n-     *\/\n-    private IllegalArgumentException stackUnderflow() {\n-        return generatorError(\"Operand stack underflow\");\n-    }\n-\n@@ -892,1 +903,0 @@\n-\n@@ -961,95 +971,0 @@\n-        Frame dup() {\n-            int stackSize = this.stackSize;\n-            if (stackSize < 1) throw stackUnderflow();\n-            checkStack(stackSize + 1);\n-            stack[stackSize] = stack[stackSize - 1];\n-            this.stackSize = stackSize + 1;\n-            return this;\n-        }\n-\n-        Frame dup_x1() {\n-            int stackSize = this.stackSize;\n-            if (stackSize < 2) throw stackUnderflow();\n-            checkStack(stackSize + 1);\n-            var stack = this.stack;\n-            Type type0 = stack[stackSize - 2];\n-            Type type1 = stack[stackSize - 1];\n-            stack[stackSize - 2] = type1;\n-            stack[stackSize - 1] = type0;\n-            stack[stackSize    ] = type1;\n-            this.stackSize = stackSize + 1;\n-            return this;\n-        }\n-\n-        Frame dup_x2() {\n-            int stackSize = this.stackSize;\n-            if (stackSize < 3) throw stackUnderflow();\n-            checkStack(stackSize + 1);\n-            var stack = this.stack;\n-            Type type0 = stack[stackSize - 3];\n-            Type type1 = stack[stackSize - 2];\n-            Type type2 = stack[stackSize - 1];\n-            stack[stackSize - 3] = type2;\n-            stack[stackSize - 2] = type0;\n-            stack[stackSize - 1] = type1;\n-            stack[stackSize    ] = type2;\n-            this.stackSize = stackSize + 1;\n-            return this;\n-        }\n-\n-        Frame dup2() {\n-            int stackSize = this.stackSize;\n-            if (stackSize < 2) throw stackUnderflow();\n-            checkStack(stackSize + 2);\n-            stack[stackSize    ] = stack[stackSize - 2];\n-            stack[stackSize + 1] = stack[stackSize - 1];\n-            this.stackSize = stackSize + 2;\n-            return this;\n-        }\n-\n-        Frame dup2_x1() {\n-            int stackSize = this.stackSize;\n-            if (stackSize < 3) throw stackUnderflow();\n-            checkStack(stackSize + 2);\n-            var stack = this.stack;\n-            Type type0 = stack[stackSize - 3];\n-            Type type1 = stack[stackSize - 2];\n-            Type type2 = stack[stackSize - 1];\n-            stack[stackSize - 3] = type1;\n-            stack[stackSize - 2] = type2;\n-            stack[stackSize - 1] = type0;\n-            stack[stackSize    ] = type1;\n-            stack[stackSize + 1] = type2;\n-            this.stackSize = stackSize + 2;\n-            return this;\n-        }\n-\n-        Frame dup2_x2() {\n-            int stackSize = this.stackSize;\n-            if (stackSize < 4) throw stackUnderflow();\n-            checkStack(stackSize + 2);\n-            var stack = this.stack;\n-            Type type0 = stack[stackSize - 4];\n-            Type type1 = stack[stackSize - 3];\n-            Type type2 = stack[stackSize - 2];\n-            Type type3 = stack[stackSize - 1];\n-            stack[stackSize - 4] = type2;\n-            stack[stackSize - 3] = type3;\n-            stack[stackSize - 2] = type0;\n-            stack[stackSize - 1] = type1;\n-            stack[stackSize    ] = type2;\n-            stack[stackSize + 1] = type3;\n-            this.stackSize = stackSize + 4;\n-            return this;\n-        }\n-\n-        Frame swap() {\n-            int stackSize = this.stackSize - 2;\n-            if (stackSize < 0) throw stackUnderflow();\n-            var stack = this.stack;\n-            Type type = stack[stackSize];\n-            stack[stackSize] = stack[stackSize + 1];\n-            stack[stackSize + 1] = type;\n-            return this;\n-        }\n-\n@@ -1066,10 +981,0 @@\n-        Frame dec1PushStack(ClassDesc desc) {\n-            if (desc == CD_long)   return decStack1PushStack(Type.LONG_TYPE, Type.LONG2_TYPE);\n-            if (desc == CD_double) return decStack1PushStack(Type.DOUBLE_TYPE, Type.DOUBLE2_TYPE);\n-            return desc == CD_void ? this\n-                    : decStack1PushStack(\n-                    desc.isPrimitive()\n-                            ? (desc == CD_float ? Type.FLOAT_TYPE : Type.INTEGER_TYPE)\n-                            : Type.referenceType(desc));\n-        }\n-\n@@ -1077,1 +982,0 @@\n-            int stackSize = this.stackSize;\n@@ -1079,2 +983,1 @@\n-            stack[stackSize] = type;\n-            this.stackSize = stackSize + 1;\n+            stack[stackSize++] = type;\n@@ -1085,1 +988,0 @@\n-            int stackSize = this.stackSize;\n@@ -1087,3 +989,2 @@\n-            stack[stackSize] = type1;\n-            stack[stackSize + 1] = type2;\n-            this.stackSize = stackSize + 2;\n+            stack[stackSize++] = type1;\n+            stack[stackSize++] = type2;\n@@ -1094,9 +995,2 @@\n-            int stackSize = this.stackSize - 1;\n-            if (stackSize < 0) throw stackUnderflow();\n-            this.stackSize = stackSize;\n-            return stack[stackSize];\n-        }\n-\n-        Frame decStack() {\n-            if (--stackSize < 0) throw stackUnderflow();\n-            return this;\n+            if (stackSize < 1) throw generatorError(\"Operand stack underflow\");\n+            return stack[--stackSize];\n@@ -1107,62 +1001,1 @@\n-            if (stackSize < 0) throw stackUnderflow();\n-            return this;\n-        }\n-\n-        Frame decStack1PushStack(Type type1, Type type2) {\n-            int stackSize = this.stackSize - 1;\n-            if (stackSize < 0) throw stackUnderflow();\n-            checkStack(stackSize + 2);\n-            stack[stackSize    ] = type1;\n-            stack[stackSize + 1] = type2;\n-            this.stackSize = stackSize + 2;\n-            return this;\n-        }\n-\n-        Frame decStack1PushStack(Type type) {\n-            int stackSize = this.stackSize - 1;\n-            if (stackSize < 0) throw stackUnderflow();\n-            stack[stackSize] = type;\n-            return this;\n-        }\n-\n-        Frame decStack2PushStack(Type type) {\n-            int stackSize = this.stackSize - 2;\n-            if (stackSize < 0) throw stackUnderflow();\n-            stack[stackSize] = type;\n-            this.stackSize = stackSize + 1;\n-            return this;\n-        }\n-\n-        Frame decStack2PushStack(Type type1, Type type2) {\n-            int stackSize = this.stackSize - 2;\n-            if (stackSize < 0) throw stackUnderflow();\n-            var stack = this.stack;\n-            stack[stackSize   ] = type1;\n-            stack[stackSize + 1] = type2;\n-            return this;\n-        }\n-\n-        Frame decStack3PushStack(Type type1, Type type2) {\n-            int stackSize = this.stackSize - 3;\n-            if (stackSize < 0) throw stackUnderflow();\n-            stack[stackSize   ] = type1;\n-            stack[stackSize + 1] = type2;\n-            this.stackSize = stackSize + 2;\n-            return this;\n-        }\n-\n-        Frame decStack4PushStack(Type type) {\n-            int stackSize = this.stackSize - 4;\n-            if (stackSize < 0) throw stackUnderflow();\n-            stack[stackSize] = type;\n-            this.stackSize = stackSize + 1;\n-            return this;\n-        }\n-\n-        Frame decStack4PushStack(Type type1, Type type2) {\n-            int stackSize = this.stackSize - 4;\n-            if (stackSize < 0) throw stackUnderflow();\n-            var stack = this.stack;\n-            stack[stackSize   ] = type1;\n-            stack[stackSize + 1] = type2;\n-            this.stackSize = stackSize + 2;\n+            if (stackSize < 0) throw generatorError(\"Operand stack underflow\");\n@@ -1197,1 +1030,2 @@\n-                initLocals(index);\n+                locals = new Type[index + FRAME_DEFAULT_CAPACITY];\n+                Arrays.fill(locals, Type.TOP_TYPE);\n@@ -1199,1 +1033,3 @@\n-                growLocals(index);\n+                int current = locals.length;\n+                locals = Arrays.copyOf(locals, index + FRAME_DEFAULT_CAPACITY);\n+                Arrays.fill(locals, current, locals.length, Type.TOP_TYPE);\n@@ -1204,11 +1040,0 @@\n-        private void initLocals(int index) {\n-            locals = new Type[index + FRAME_DEFAULT_CAPACITY];\n-            Arrays.fill(locals, Type.TOP_TYPE);\n-        }\n-\n-        private void growLocals(int index) {\n-            int current = locals.length;\n-            locals = Arrays.copyOf(locals, index + FRAME_DEFAULT_CAPACITY);\n-            Arrays.fill(locals, current, locals.length, Type.TOP_TYPE);\n-        }\n-\n@@ -1218,1 +1043,2 @@\n-                initStack(index);\n+                stack = new Type[index + FRAME_DEFAULT_CAPACITY];\n+                Arrays.fill(stack, Type.TOP_TYPE);\n@@ -1220,1 +1046,3 @@\n-                growStack(index);\n+                int current = stack.length;\n+                stack = Arrays.copyOf(stack, index + FRAME_DEFAULT_CAPACITY);\n+                Arrays.fill(stack, current, stack.length, Type.TOP_TYPE);\n@@ -1224,11 +1052,0 @@\n-        private void initStack(int index) {\n-            stack = new Type[index + FRAME_DEFAULT_CAPACITY];\n-            Arrays.fill(stack, Type.TOP_TYPE);\n-        }\n-\n-        private void growStack(int index) {\n-            int current = stack.length;\n-            stack = Arrays.copyOf(stack, index + FRAME_DEFAULT_CAPACITY);\n-            Arrays.fill(stack, current, stack.length, Type.TOP_TYPE);\n-        }\n-\n@@ -1237,1 +1054,0 @@\n-            var locals = this.locals;\n@@ -1242,8 +1058,0 @@\n-        private void setLocalRawInternal(int index, Type type1, Type type2) {\n-            checkLocal(index + 1);\n-            var locals = this.locals;\n-            localsChanged |= !type1.equals(locals[index]) || !type2.equals(locals[index + 1]);\n-            locals[index    ] = type1;\n-            locals[index + 1] = type2;\n-        }\n-\n@@ -1350,1 +1158,2 @@\n-            } else if (old == Type.DOUBLE2_TYPE || old == Type.LONG2_TYPE) {\n+            }\n+            if (old == Type.DOUBLE2_TYPE || old == Type.LONG2_TYPE) {\n@@ -1368,1 +1177,2 @@\n-            setLocalRawInternal(index, type1, type2);\n+            setLocalRawInternal(index, type1);\n+            setLocalRawInternal(index + 1, type2);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/StackMapGenerator.java","additions":111,"deletions":301,"binary":false,"changes":412,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n- * @bug 8305990 8320222 8320618 8335475 8338623 8338661\n+ * @bug 8305990 8320222 8320618 8335475 8338623 8338661 8343436\n@@ -347,0 +347,18 @@\n+    @ParameterizedTest\n+    @EnumSource(ClassFile.StackMapsOption.class)\n+    void testI2LCounters(ClassFile.StackMapsOption option) {\n+        var cf = ClassFile.of(option);\n+        var bytes = cf.build(ClassDesc.of(\"Test\"), clb -> clb\n+            .withMethodBody(\"a\", MTD_long_int, ACC_STATIC, cob ->\n+                    cob.iload(0)\n+                       .i2l()\n+                       .lreturn()));\n+\n+        var cm = ClassFile.of().parse(bytes);\n+        for (var method : cm.methods()) {\n+            var code = (CodeAttribute) method.code().orElseThrow();\n+            assertEquals(1, code.maxLocals());\n+            assertEquals(2, code.maxStack());\n+        }\n+    }\n+\n@@ -349,0 +367,1 @@\n+    private static final MethodTypeDesc MTD_long_int = MethodTypeDesc.of(CD_long, CD_int);\n","filename":"test\/jdk\/jdk\/classfile\/StackMapsTest.java","additions":20,"deletions":1,"binary":false,"changes":21,"status":"modified"}]}