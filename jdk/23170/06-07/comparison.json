{"files":[{"patch":"@@ -43,6 +43,0 @@\n-#if INCLUDE_SHENANDOAHGC\n-  if (UseShenandoahGC) {\n-    _card_table_base = nullptr;\n-    return;\n-  }\n-#endif\n@@ -50,1 +44,2 @@\n-  if (bs->is_a(BarrierSet::CardTableBarrierSet)) {\n+  if (bs->is_a(BarrierSet::CardTableBarrierSet) &&\n+    !bs->is_a(BarrierSet::ShenandoahBarrierSet)) {\n","filename":"src\/hotspot\/os_cpu\/linux_arm\/javaThread_linux_arm.cpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-#include \"gc\/shenandoah\/shenandoahThreadLocalData.hpp\"\n@@ -57,0 +56,2 @@\n+  assert(byte_for(low_bound) == &_byte_map[0], \"Checking start of map\");\n+  assert(byte_for(high_bound-1) <= &_byte_map[last_valid_index()], \"Checking end of map\");\n@@ -66,0 +67,2 @@\n+  assert(read_byte_for(low_bound) == &_read_byte_map[0], \"Checking start of map\");\n+  assert(read_byte_for(high_bound-1) <= &_read_byte_map[last_valid_index()], \"Checking end of map\");\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahCardTable.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -249,10 +249,1 @@\n-  ShenandoahBarrierSet* bs = new ShenandoahBarrierSet(this, _heap_region);\n-  BarrierSet::set_barrier_set(bs);\n-\n-  \/\/ Every thread always have a pointer to the _current_ _write_ version of the card table.\n-  \/\/ The JIT'ed code will use this address (+card entry offset) to mark card's as dirty.\n-  \/\/\n-  \/\/ Now that ThreadLocalData's are created we can set byte_map_base on it.\n-  if (ShenandoahCardBarrier) {\n-    ShenandoahThreadLocalData::set_card_table(Thread::current(), bs->card_table()->write_byte_map_base());\n-  }\n+  BarrierSet::set_barrier_set(new ShenandoahBarrierSet(this, _heap_region));\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":1,"deletions":10,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -636,4 +636,2 @@\n-    CardTable::CardValue* new_ptr;\n-    SwapTLSCardTable(CardTable::CardValue* np) {\n-      this->new_ptr = np;\n-    }\n+    CardTable::CardValue* _new_ptr;\n+    SwapTLSCardTable(CardTable::CardValue* np) : _new_ptr(np) {}\n@@ -641,1 +639,1 @@\n-      ShenandoahThreadLocalData::set_card_table(t, new_ptr);\n+      ShenandoahThreadLocalData::set_card_table(t, _new_ptr);\n@@ -648,1 +646,1 @@\n-  log_info(gc, barrier)(\"Current write_card_table: \" PTR_FORMAT, p2i(swap_it.new_ptr));\n+  log_info(gc, barrier)(\"Current write_card_table: \" PTR_FORMAT, p2i(swap_it._new_ptr));\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahScanRemembered.cpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"}]}