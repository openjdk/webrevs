{"files":[{"patch":"@@ -33,1 +33,1 @@\n-\/\/ The event counters are used to check events from differen threads.\n+\/\/ The event counters are used to check events from different threads.\n@@ -41,1 +41,0 @@\n-static const char* ACCESS_FIELD_VALUE = \"accessFieldValue\";\n@@ -44,1 +43,0 @@\n-static const char* MODIFY_FIELD_VALUE = \"modifyFieldValue\";\n@@ -116,1 +114,1 @@\n-  jint res = vm->GetEnv((void **) &jvmti, JVMTI_VERSION_21);\n+  jint res = vm->GetEnv((void **)&jvmti, JVMTI_VERSION_21);\n@@ -122,1 +120,1 @@\n-  (void) memset(&capabilities, 0, sizeof (capabilities));\n+  (void)memset(&capabilities, 0, sizeof (capabilities));\n@@ -128,1 +126,1 @@\n-  (void) memset(&callbacks, 0, sizeof (callbacks));\n+  (void)memset(&callbacks, 0, sizeof (callbacks));\n@@ -131,1 +129,1 @@\n-  err = jvmti->SetEventCallbacks(&callbacks, (int) sizeof (jvmtiEventCallbacks));\n+  err = jvmti->SetEventCallbacks(&callbacks, (int)sizeof (jvmtiEventCallbacks));\n@@ -160,1 +158,1 @@\n-  jstring jname = (jstring)jni->GetObjectField(self, fieldToRead);\n+  jstring jvalue = (jstring)jni->GetObjectField(self, fieldToRead);\n@@ -167,5 +165,1 @@\n-  const char* name_str = jni->GetStringUTFChars(jname, nullptr);\n-  LOG(\"The field %s\\n\", name_str);\n-  if (strcmp(name_str, ACCESS_FIELD_VALUE) != 0) {\n-    fatal(jni, \"The field value is incorrect.\");\n-  }\n+  const char* value_str = jni->GetStringUTFChars(jvalue, nullptr);\n@@ -174,1 +168,5 @@\n-    fatal(jni, \"The field access count is incorrect.\");\n+    char buffer[100];\n+    snprintf(buffer, sizeof(buffer),\n+        \"Incorrect field access count: %d. Should be %d.\",\n+        (int)access_cnt, numOfEventsExpected);\n+    fatal(jni, buffer);\n@@ -176,1 +174,1 @@\n-  jni->ReleaseStringUTFChars(jname, name_str);\n+  jni->ReleaseStringUTFChars(jvalue, value_str);\n@@ -197,1 +195,1 @@\n-  jstring jval = jni->NewStringUTF(\"newValue\");\n+  jstring jvalue = jni->NewStringUTF(\"newValue\");\n@@ -199,1 +197,1 @@\n-  jni->SetObjectField(self, fieldToModify, jval);\n+  jni->SetObjectField(self, fieldToModify, jvalue);\n@@ -207,1 +205,5 @@\n-    fatal(jni, \"The field access count should be 1.\");\n+    char buffer[100];\n+    snprintf(buffer, sizeof(buffer),\n+        \"Incorrect field modification count: %d. Should be %d.\",\n+        (int)modify_cnt, numOfEventsExpected);\n+    fatal(jni, buffer);\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/events\/FieldAccess\/FieldEventsFromJNI\/libFieldEventsFromJNI.cpp","additions":20,"deletions":18,"binary":false,"changes":38,"status":"modified"}]}