{"files":[{"patch":"@@ -31,0 +31,1 @@\n+using testing::ContainsRegex;\n@@ -38,3 +39,7 @@\n-  stringStream ss;\n-  ClassPrinter::print_classes(\"java\/lang\/Object\", 0x03, &ss);\n-  const char* output = ss.freeze();\n+  stringStream s1;\n+  ClassPrinter::print_classes(\"java\/lang\/Object\", 0x03, &s1);\n+  const char* o1 = s1.freeze();\n+\n+  ASSERT_THAT(o1, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n+  ASSERT_THAT(o1, HasSubstr(\"method wait : (J)V\")) << \"must find java\/lang\/Object::wait\";\n+  ASSERT_THAT(o1, HasSubstr(\"method finalize : ()V\\n   0 return\")) << \"must find java\/lang\/Object::finalize and disasm\";\n@@ -42,3 +47,14 @@\n-  ASSERT_THAT(output, HasSubstr(\"class java\/lang\/Object loader data:\")) << \"must find java\/lang\/Object\";\n-  ASSERT_THAT(output, HasSubstr(\"method wait : (J)V\")) << \"must find java\/lang\/Object::wait\";\n-  ASSERT_THAT(output, HasSubstr(\"method finalize : ()V\\n   0 return\")) << \"must find java\/lang\/Object::finalize and disasm\";\n+  \/\/ \".\" should also work as separator in class name\n+  stringStream s2;\n+  ClassPrinter::print_classes(\"java.lang.Object\", 0x03, &s2);\n+  const char* o2 = s2.freeze();\n+  ASSERT_THAT(o2, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n+\n+  \/\/ 0x20 is PRINT_CLASS_DETAILS\n+  stringStream s3;\n+  ClassPrinter::print_classes(\"java.lang.Integer\", 0x20, &s3);\n+  const char* o3 = s3.freeze();\n+  ASSERT_THAT(o3, HasSubstr(\"class: java\/lang\/Integer mirror:\")) << \"must find java\/lang\/Integer\";\n+  ASSERT_THAT(o3, HasSubstr(\"InstanceKlass: java.lang.Integer {0x\")) << \"must print InstanceKlass\";\n+  ASSERT_THAT(o3, HasSubstr(\"Java mirror oop for java\/lang\/Integer:\")) << \"must print mirror oop\";\n+  ASSERT_THAT(o3, ContainsRegex(\"public static final 'MIN_VALUE' 'I'.* -2147483648 [(]0x80000000[)]\")) << \"must print static fields\";\n@@ -55,1 +71,1 @@\n-  ASSERT_THAT(o1, HasSubstr(\"class java\/lang\/Object loader data:\")) << \"must find java\/lang\/Object\";\n+  ASSERT_THAT(o1, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n@@ -63,1 +79,1 @@\n-  ASSERT_THAT(o2, HasSubstr(\"class java\/lang\/Object loader data:\")) << \"must find java\/lang\/Object\";\n+  ASSERT_THAT(o2, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n@@ -67,0 +83,21 @@\n+\n+#ifndef PRODUCT\n+  \/\/ These are available only in debug builds\n+  \/\/\n+  \/\/ 0x02 is PRINT_BYTECODE\n+  \/\/ 0x04 is PRINT_BYTECODE_ADDRESS\n+  \/\/ 0x40 is PRINT_METHOD_DETAILS\n+  stringStream s3;\n+  ClassPrinter::print_methods(\"java.lang.Object\", \"wait:()V\", 0x46, &s3);\n+  const char* o3 = s3.freeze();\n+  ASSERT_THAT(o3, HasSubstr(\"method wait : ()V\")) << \"must find java\/lang\/Object::wait()\";\n+  ASSERT_THAT(o3, HasSubstr(\"{method}\")) << \"must print Method metadata\";\n+  ASSERT_THAT(o3, ContainsRegex(\"method holder:.*'java\/lang\/Object'\")) << \"must print Method metadata\";\n+  ASSERT_THAT(o3, ContainsRegex(\"name: *'wait'\")) << \"must print Method metadata\";\n+\n+  \/\/ Bytecodes: we should have at least one 'return' bytecide for Object.wait()\n+  \/\/ The print out should look like this:\n+  \/\/ 0x000000004adf73ad    5 return\n+  ASSERT_THAT(o3, ContainsRegex(\"0x[0-9a-f]+ +[0-9]+ +return\")) << \"must print return bytecode\";\n+#endif\n+\n","filename":"test\/hotspot\/gtest\/runtime\/test_classPrinter.cpp","additions":45,"deletions":8,"binary":false,"changes":53,"status":"modified"}]}