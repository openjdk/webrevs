{"files":[{"patch":"@@ -1392,1 +1392,1 @@\n-nmethod::nmethod(nmethod* nm) : CodeBlob(nm->_name, nm->_kind, nm->_size, nm->_header_size)\n+nmethod::nmethod(const nmethod &nm) : CodeBlob(nm._name, nm._kind, nm._size, nm._header_size)\n@@ -1395,2 +1395,2 @@\n-  if (nm->_oop_maps != nullptr) {\n-    _oop_maps                   = nm->_oop_maps->clone();\n+  if (nm._oop_maps != nullptr) {\n+    _oop_maps                   = nm._oop_maps->clone();\n@@ -1401,6 +1401,6 @@\n-  _size                         = nm->_size;\n-  _relocation_size              = nm->_relocation_size;\n-  _content_offset               = nm->_content_offset;\n-  _code_offset                  = nm->_code_offset;\n-  _data_offset                  = nm->_data_offset;\n-  _frame_size                   = nm->_frame_size;\n+  _size                         = nm._size;\n+  _relocation_size              = nm._relocation_size;\n+  _content_offset               = nm._content_offset;\n+  _code_offset                  = nm._code_offset;\n+  _data_offset                  = nm._data_offset;\n+  _frame_size                   = nm._frame_size;\n@@ -1408,1 +1408,1 @@\n-  S390_ONLY( _ctable_offset     = nm->_ctable_offset; )\n+  S390_ONLY( _ctable_offset     = nm._ctable_offset; )\n@@ -1410,2 +1410,2 @@\n-  _header_size                  = nm->_header_size;\n-  _frame_complete_offset        = nm->_frame_complete_offset;\n+  _header_size                  = nm._header_size;\n+  _frame_complete_offset        = nm._frame_complete_offset;\n@@ -1413,1 +1413,1 @@\n-  _kind                         = nm->_kind;\n+  _kind                         = nm._kind;\n@@ -1415,1 +1415,1 @@\n-  _caller_must_gc_arguments     = nm->_caller_must_gc_arguments;\n+  _caller_must_gc_arguments     = nm._caller_must_gc_arguments;\n@@ -1418,2 +1418,2 @@\n-  _asm_remarks.share(nm->_asm_remarks);\n-  _dbg_strings.share(nm->_dbg_strings);\n+  _asm_remarks.share(nm._asm_remarks);\n+  _dbg_strings.share(nm._dbg_strings);\n@@ -1423,1 +1423,1 @@\n-  _mutable_data_size            = nm->_mutable_data_size;\n+  _mutable_data_size            = nm._mutable_data_size;\n@@ -1429,1 +1429,1 @@\n-    memcpy(mutable_data_begin(), nm->mutable_data_begin(), nm->mutable_data_size());\n+    memcpy(mutable_data_begin(), nm.mutable_data_begin(), nm.mutable_data_size());\n@@ -1436,1 +1436,1 @@\n-  _method                       = nm->_method;\n+  _method                       = nm._method;\n@@ -1440,1 +1440,1 @@\n-  _immutable_data_size          = nm->_immutable_data_size;\n+  _immutable_data_size          = nm._immutable_data_size;\n@@ -1442,1 +1442,1 @@\n-    _immutable_data             = nm->_immutable_data;\n+    _immutable_data             = nm._immutable_data;\n@@ -1454,2 +1454,2 @@\n-  if (nm->_osr_entry_point != nullptr) {\n-    _osr_entry_point            = (nm->_osr_entry_point - (address) nm) + (address) this;\n+  if (nm._osr_entry_point != nullptr) {\n+    _osr_entry_point            = (nm._osr_entry_point - (address) &nm) + (address) this;\n@@ -1460,3 +1460,3 @@\n-  _entry_offset                 = nm->_entry_offset;\n-  _verified_entry_offset        = nm->_verified_entry_offset;\n-  _entry_bci                    = nm->_entry_bci;\n+  _entry_offset                 = nm._entry_offset;\n+  _verified_entry_offset        = nm._verified_entry_offset;\n+  _entry_bci                    = nm._entry_bci;\n@@ -1464,8 +1464,8 @@\n-  _skipped_instructions_size    = nm->_skipped_instructions_size;\n-  _stub_offset                  = nm->_stub_offset;\n-  _exception_offset             = nm->_exception_offset;\n-  _deopt_handler_offset         = nm->_deopt_handler_offset;\n-  _deopt_mh_handler_offset      = nm->_deopt_mh_handler_offset;\n-  _unwind_handler_offset        = nm->_unwind_handler_offset;\n-  _num_stack_arg_slots          = nm->_num_stack_arg_slots;\n-  _oops_size                    = nm->_oops_size;\n+  _skipped_instructions_size    = nm._skipped_instructions_size;\n+  _stub_offset                  = nm._stub_offset;\n+  _exception_offset             = nm._exception_offset;\n+  _deopt_handler_offset         = nm._deopt_handler_offset;\n+  _deopt_mh_handler_offset      = nm._deopt_mh_handler_offset;\n+  _unwind_handler_offset        = nm._unwind_handler_offset;\n+  _num_stack_arg_slots          = nm._num_stack_arg_slots;\n+  _oops_size                    = nm._oops_size;\n@@ -1473,1 +1473,1 @@\n-  _metadata_size                = nm->_metadata_size;\n+  _metadata_size                = nm._metadata_size;\n@@ -1475,4 +1475,4 @@\n-  _nul_chk_table_offset         = nm->_nul_chk_table_offset;\n-  _handler_table_offset         = nm->_handler_table_offset;\n-  _scopes_pcs_offset            = nm->_scopes_pcs_offset;\n-  _scopes_data_offset           = nm->_scopes_data_offset;\n+  _nul_chk_table_offset         = nm._nul_chk_table_offset;\n+  _handler_table_offset         = nm._handler_table_offset;\n+  _scopes_pcs_offset            = nm._scopes_pcs_offset;\n+  _scopes_data_offset           = nm._scopes_data_offset;\n@@ -1480,1 +1480,1 @@\n-  _speculations_offset          = nm->_speculations_offset;\n+  _speculations_offset          = nm._speculations_offset;\n@@ -1483,5 +1483,5 @@\n-  _orig_pc_offset               = nm->_orig_pc_offset;\n-  _compile_id                   = nm->_compile_id;\n-  _comp_level                   = nm->_comp_level;\n-  _compiler_type                = nm->_compiler_type;\n-  _is_unloading_state           = nm->_is_unloading_state;\n+  _orig_pc_offset               = nm._orig_pc_offset;\n+  _compile_id                   = nm._compile_id;\n+  _comp_level                   = nm._comp_level;\n+  _compiler_type                = nm._compiler_type;\n+  _is_unloading_state           = nm._is_unloading_state;\n@@ -1490,8 +1490,8 @@\n-  _has_unsafe_access            = nm->_has_unsafe_access;\n-  _has_method_handle_invokes    = nm->_has_method_handle_invokes;\n-  _has_wide_vectors             = nm->_has_wide_vectors;\n-  _has_monitors                 = nm->_has_monitors;\n-  _has_scoped_access            = nm->_has_scoped_access;\n-  _has_flushed_dependencies     = nm->_has_flushed_dependencies;\n-  _is_unlinked                  = nm->_is_unlinked;\n-  _load_reported                = nm->_load_reported;\n+  _has_unsafe_access            = nm._has_unsafe_access;\n+  _has_method_handle_invokes    = nm._has_method_handle_invokes;\n+  _has_wide_vectors             = nm._has_wide_vectors;\n+  _has_monitors                 = nm._has_monitors;\n+  _has_scoped_access            = nm._has_scoped_access;\n+  _has_flushed_dependencies     = nm._has_flushed_dependencies;\n+  _is_unlinked                  = nm._is_unlinked;\n+  _load_reported                = nm._load_reported;\n@@ -1499,1 +1499,1 @@\n-  _deoptimization_status        = nm->_deoptimization_status;\n+  _deoptimization_status        = nm._deoptimization_status;\n@@ -1501,1 +1501,1 @@\n-  if (nm->_pc_desc_container != nullptr) {\n+  if (nm._pc_desc_container != nullptr) {\n@@ -1514,1 +1514,1 @@\n-  memcpy(consts_begin(), nm->consts_begin(), nm->data_end() - nm->consts_begin());\n+  memcpy(consts_begin(), nm.consts_begin(), nm.data_end() - nm.consts_begin());\n@@ -1528,1 +1528,1 @@\n-  nmethod* nm_copy = new (size(), code_blob_type) nmethod(this);\n+  nmethod* nm_copy = new (size(), code_blob_type) nmethod(*this);\n@@ -1640,19 +1640,0 @@\n-#ifdef AARCH64\n-  \/\/ Ensure all call instructions that might require trampolines include them.\n-  \/\/ In debug builds, HotSpot intentionally reduces the maximum branch range\n-  \/\/ to stress-test trampoline generation. This constraint may not be honored\n-  \/\/ by JVMCI, so we explicitly verify compliance here before relocation.\n-  RelocIterator iter(this);\n-  while (iter.next()) {\n-    if (iter.reloc()->is_call()) {\n-      CallRelocation* call_reloc = (CallRelocation*) iter.reloc();\n-      if (NativeCall::is_call_at(call_reloc->addr())) {\n-        NativeCall* call = nativeCall_at(call_reloc->addr());\n-        if (!MacroAssembler::is_always_within_branch_range(Address(call->destination())) && call->get_trampoline() == nullptr) {\n-          return false;\n-        }\n-      }\n-    }\n-  }\n-#endif\n-\n","filename":"src\/hotspot\/share\/code\/nmethod.cpp","additions":57,"deletions":76,"binary":false,"changes":133,"status":"modified"},{"patch":"@@ -341,1 +341,1 @@\n-  nmethod(nmethod* nm);\n+  nmethod(const nmethod &nm);\n","filename":"src\/hotspot\/share\/code\/nmethod.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}