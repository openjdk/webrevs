{"files":[{"patch":"@@ -230,1 +230,5 @@\n-        OutputAnalyzer out;\n+        Common.logNewTestCase(\"Memory: --memory = \" + memValueToSet + \" --memory-swap = \" + swapValueToSet);\n+        DockerRunOptions opts = commonDockerOpts();\n+        opts.addDockerOpts(\"--memory=\" + memValueToSet)\n+            .addDockerOpts(\"--memory-swap=\" + swapValueToSet)\n+            .addClassOptions(\"jdk.SwapSpace\");\n@@ -232,15 +236,2 @@\n-            Common.logNewTestCase(\"Memory: --memory = \" + memValueToSet + \" --memory-swap = \" + swapValueToSet + \" --memory-swappiness = 60\");\n-            out = DockerTestUtils.dockerRunJava(\n-                                          commonDockerOpts()\n-                                          .addDockerOpts(\"--memory=\" + memValueToSet)\n-                                          .addDockerOpts(\"--memory-swap=\" + swapValueToSet)\n-                                          \/\/ With Cgroupv1, The default memory-swappiness vaule is inherited from the host machine, which maybe 0\n-                                          .addDockerOpts(\"--memory-swappiness=60\")\n-                                          .addClassOptions(\"jdk.SwapSpace\"));\n-        } else {\n-            Common.logNewTestCase(\"Memory: --memory = \" + memValueToSet + \" --memory-swap = \" + swapValueToSet);\n-            out = DockerTestUtils.dockerRunJava(\n-                                          commonDockerOpts()\n-                                          .addDockerOpts(\"--memory=\" + memValueToSet)\n-                                          .addDockerOpts(\"--memory-swap=\" + swapValueToSet)\n-                                          .addClassOptions(\"jdk.SwapSpace\"));\n+            \/\/ With Cgroupv1, The default memory-swappiness vaule is inherited from the host machine, which maybe 0\n+            opts.addDockerOpts(\"--memory-swappiness=60\");\n@@ -248,1 +239,2 @@\n-         out.shouldHaveExitValue(0)\n+        OutputAnalyzer out = DockerTestUtils.dockerRunJava(opts);\n+        out.shouldHaveExitValue(0)\n@@ -251,18 +243,18 @@\n-         List<String> ls = out.asLinesWithoutVMWarnings();\n-         for (String cur : ls) {\n-             int idx = cur.indexOf(\"freeSize = \");\n-             if (idx != -1) {\n-                 int startNbr = idx+11;\n-                 int endNbr = cur.indexOf(' ', startNbr);\n-                 if (endNbr == -1) endNbr = cur.length();\n-                 String freeSizeStr = cur.substring(startNbr, endNbr);\n-                 long freeval = Long.parseLong(freeSizeStr);\n-                 long totalval = Long.parseLong(expectedTotalValue);\n-                 if (0 <= freeval && freeval <= totalval) {\n-                     System.out.println(\"Found freeSize value \" + freeval + \" is fine\");\n-                 } else {\n-                     System.out.println(\"Found freeSize value \" + freeval + \" is bad\");\n-                     throw new Exception(\"Found free size value is bad\");\n-                 }\n-             }\n-         }\n+        List<String> ls = out.asLinesWithoutVMWarnings();\n+        for (String cur : ls) {\n+            int idx = cur.indexOf(\"freeSize = \");\n+            if (idx != -1) {\n+                int startNbr = idx+11;\n+                int endNbr = cur.indexOf(' ', startNbr);\n+                if (endNbr == -1) endNbr = cur.length();\n+                String freeSizeStr = cur.substring(startNbr, endNbr);\n+                long freeval = Long.parseLong(freeSizeStr);\n+                long totalval = Long.parseLong(expectedTotalValue);\n+                if (0 <= freeval && freeval <= totalval) {\n+                    System.out.println(\"Found freeSize value \" + freeval + \" is fine\");\n+                } else {\n+                    System.out.println(\"Found freeSize value \" + freeval + \" is bad\");\n+                    throw new Exception(\"Found free size value is bad\");\n+                }\n+            }\n+        }\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestJFREvents.java","additions":27,"deletions":35,"binary":false,"changes":62,"status":"modified"}]}