{"files":[{"patch":"@@ -33,0 +33,1 @@\n+ * @modules java.base\/jdk.internal.platform\n@@ -47,0 +48,1 @@\n+import jdk.internal.platform.Metrics;\n@@ -55,0 +57,1 @@\n+    private static boolean isCgroupV1 = false;\n@@ -62,0 +65,8 @@\n+        \/\/ If cgroups is not configured, report success.\n+        Metrics metrics = Metrics.systemMetrics();\n+        if (metrics == null) {\n+            System.out.println(\"TEST PASSED!!!\");\n+            return;\n+        }\n+        isCgroupV1 = \"cgroupv1\".equals(metrics.getProvider());\n+\n@@ -219,6 +230,18 @@\n-        Common.logNewTestCase(\"Memory: --memory = \" + memValueToSet + \" --memory-swap = \" + swapValueToSet);\n-         OutputAnalyzer out = DockerTestUtils.dockerRunJava(\n-                                      commonDockerOpts()\n-                                      .addDockerOpts(\"--memory=\" + memValueToSet)\n-                                      .addDockerOpts(\"--memory-swap=\" + swapValueToSet)\n-                                      .addClassOptions(\"jdk.SwapSpace\"));\n+        OutputAnalyzer out;\n+        if (isCgroupV1) {\n+            Common.logNewTestCase(\"Memory: --memory = \" + memValueToSet + \" --memory-swap = \" + swapValueToSet + \" --memory-swappiness = 60\");\n+            out = DockerTestUtils.dockerRunJava(\n+                                          commonDockerOpts()\n+                                          .addDockerOpts(\"--memory=\" + memValueToSet)\n+                                          .addDockerOpts(\"--memory-swap=\" + swapValueToSet)\n+                                          \/\/ With Cgroupv1, The default memory-swappiness vaule is inherited from the host machine, which maybe 0\n+                                          .addDockerOpts(\"--memory-swappiness=60\")\n+                                          .addClassOptions(\"jdk.SwapSpace\"));\n+        } else {\n+            Common.logNewTestCase(\"Memory: --memory = \" + memValueToSet + \" --memory-swap = \" + swapValueToSet);\n+            out = DockerTestUtils.dockerRunJava(\n+                                          commonDockerOpts()\n+                                          .addDockerOpts(\"--memory=\" + memValueToSet)\n+                                          .addDockerOpts(\"--memory-swap=\" + swapValueToSet)\n+                                          .addClassOptions(\"jdk.SwapSpace\"));\n+        }\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestJFREvents.java","additions":29,"deletions":6,"binary":false,"changes":35,"status":"modified"}]}