{"files":[{"patch":"@@ -70,0 +70,4 @@\n+#if !defined(_AIX)\n+  \/* The \/proc file system on AIX does not contain open system files\n+   * like \/dev\/random. Therefore we use a different approach and do\n+   * not need isAsciiDigit() or FD_DIR *\/\n@@ -76,7 +80,5 @@\n-#if defined(_AIX)\n-  \/* AIX does not understand '\/proc\/self' - it requires the real process ID *\/\n-  #define FD_DIR aix_fd_dir\n-#elif defined(_ALLBSD_SOURCE)\n-  #define FD_DIR \"\/dev\/fd\"\n-#else\n-  #define FD_DIR \"\/proc\/self\/fd\"\n+  #if defined(_ALLBSD_SOURCE)\n+    #define FD_DIR \"\/dev\/fd\"\n+  #else\n+    #define FD_DIR \"\/proc\/self\/fd\"\n+  #endif\n@@ -88,0 +90,13 @@\n+#if defined(_AIX)\n+    \/* On AIX, we cannot rely on proc file system iteration to find all open files. Since\n+     * iteration over all possible file descriptors, and subsequently closing them, can\n+     * take a very long time, we use a bulk close via `ioctl` that is available on AIX.\n+     * Since we hard-close, we need to make sure to keep the fail pipe file descriptor\n+     * alive until the exec call. Therefore we mark the fail pipe fd with close on exec\n+     * like the other OSes do, but then proceed to hard-close file descriptors beyond that.\n+     *\/\n+    if (fcntl(FAIL_FILENO + 1, F_CLOSEM, 0) == -1 ||\n+        (markCloseOnExec(FAIL_FILENO) == -1 && errno != EBADF)) {\n+        return -1;\n+    }\n+#else\n@@ -96,6 +111,0 @@\n-#if defined(_AIX)\n-    \/* AIX does not understand '\/proc\/self' - it requires the real process ID *\/\n-    char aix_fd_dir[32];     \/* the pid has at most 19 digits *\/\n-    snprintf(aix_fd_dir, 32, \"\/proc\/%d\/fd\", getpid());\n-#endif\n-\n@@ -117,0 +126,1 @@\n+#endif\n@@ -409,0 +419,4 @@\n+    \/* For AIX: The code in markDescriptorsCloseOnExec() relies on the current\n+     * semantic of this function. When this point here is reached only the\n+     * FDs 0,1,2 and 3 are further used until the exec() or the exit(-1). *\/\n+\n","filename":"src\/java.base\/unix\/native\/libjava\/childproc.c","additions":27,"deletions":13,"binary":false,"changes":40,"status":"modified"}]}