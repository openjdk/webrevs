{"files":[{"patch":"@@ -70,0 +70,4 @@\n+#if !defined(_AIX)\n+  \/* The \/proc file System on AIX does not contain open system files\n+   * like \/dev\/random. Therefore we use a different approach and do\n+   * not need isAsciiDigit() or FD_DIR *\/\n@@ -76,7 +80,5 @@\n-#if defined(_AIX)\n-  \/* AIX does not understand '\/proc\/self' - it requires the real process ID *\/\n-  #define FD_DIR aix_fd_dir\n-#elif defined(_ALLBSD_SOURCE)\n-  #define FD_DIR \"\/dev\/fd\"\n-#else\n-  #define FD_DIR \"\/proc\/self\/fd\"\n+  #if defined(_ALLBSD_SOURCE)\n+    #define FD_DIR \"\/dev\/fd\"\n+  #else\n+    #define FD_DIR \"\/proc\/self\/fd\"\n+  #endif\n@@ -88,0 +90,15 @@\n+#if defined(_AIX)\n+    \/* We rely on the current childProcess() functions semantic.\n+     * When the parent childProcess() function reaches the call of this function\n+     * only the FDs 0,1,2 and 3 are further used until the exec() or the exit(-1).\n+     * So we can close all FDs beginning with 4 (with fcntl(x, F_CLOSEM, 0); AIX\n+     * provides a special fcntl call to close all open FDs greater equal x in one call).\n+     * FD 3 is only used if the exec fails to report the reason to the JVM.\n+     * It should not survive a passing exec(). So we can set the close_on_exec\n+     * flag for FD 3. FDs 0,1 and 2 should survive the exec(), we do not change them.\n+     *\/\n+    if (fcntl(STDERR_FILENO + 2, F_CLOSEM, 0) == -1 ||\n+        (markCloseOnExec(STDERR_FILENO + 1) == -1 && errno != EBADF)) {\n+        return -1;\n+    }\n+#else\n@@ -96,6 +113,0 @@\n-#if defined(_AIX)\n-    \/* AIX does not understand '\/proc\/self' - it requires the real process ID *\/\n-    char aix_fd_dir[32];     \/* the pid has at most 19 digits *\/\n-    snprintf(aix_fd_dir, 32, \"\/proc\/%d\/fd\", getpid());\n-#endif\n-\n@@ -117,0 +128,1 @@\n+#endif\n@@ -409,0 +421,4 @@\n+    \/* For AIX: The code in markDescriptorsCloseOnExec() relies on the current\n+     * semantic of this function. When this point here is reached only the\n+     * FDs 0,1,2 and 3 are further used until the exec() or the exit(-1). *\/\n+\n","filename":"src\/java.base\/unix\/native\/libjava\/childproc.c","additions":29,"deletions":13,"binary":false,"changes":42,"status":"modified"}]}