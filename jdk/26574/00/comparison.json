{"files":[{"patch":"@@ -1224,1 +1224,1 @@\n-    void reclaim_empty_humongous_region(G1HeapRegion* hr) {\n+    void reclaim_empty_region(G1HeapRegion* hr) {\n@@ -1226,0 +1226,10 @@\n+      assert(hr->used() > 0, \"precondition\");\n+\n+      _freed_bytes += hr->used();\n+      hr->set_containing_set(nullptr);\n+      hr->clear_cardtable();\n+      _cm->clear_statistics(hr);\n+      G1HeapRegionPrinter::mark_reclaim(hr);\n+    }\n+\n+    void reclaim_empty_humongous_region(G1HeapRegion* hr) {\n@@ -1229,2 +1239,0 @@\n-        assert(hr->used() > 0, \"precondition\");\n-        assert(!hr->has_pinned_objects(), \"precondition\");\n@@ -1233,0 +1241,1 @@\n+        reclaim_empty_region(hr);\n@@ -1234,5 +1243,0 @@\n-        _freed_bytes += hr->used();\n-        hr->set_containing_set(nullptr);\n-        hr->clear_cardtable();\n-        _g1h->concurrent_mark()->clear_statistics(hr);\n-        G1HeapRegionPrinter::mark_reclaim(hr);\n@@ -1246,2 +1250,0 @@\n-      assert(hr->used() > 0, \"precondition\");\n-      assert(!hr->has_pinned_objects(), \"precondition\");\n@@ -1250,0 +1252,1 @@\n+      reclaim_empty_region(hr);\n@@ -1251,5 +1254,0 @@\n-      _freed_bytes += hr->used();\n-      hr->set_containing_set(nullptr);\n-      hr->clear_cardtable();\n-      _g1h->concurrent_mark()->clear_statistics(hr);\n-      G1HeapRegionPrinter::mark_reclaim(hr);\n@@ -1259,0 +1257,7 @@\n+    void update_live_region(G1HeapRegion* hr, bool selected_for_rebuild) {\n+      if (selected_for_rebuild) {\n+        _num_selected_for_rebuild++;\n+      }\n+      _cm->update_top_at_rebuild_start(hr);\n+    }\n+\n@@ -1269,8 +1274,3 @@\n-          auto on_humongous_region = [&] (G1HeapRegion* hr) {\n-            if (selected_for_rebuild) {\n-              _num_selected_for_rebuild++;\n-            }\n-            _cm->update_top_at_rebuild_start(hr);\n-          };\n-\n-          _g1h->humongous_obj_regions_iterate(hr, on_humongous_region);\n+          _g1h->humongous_obj_regions_iterate(hr, [&] (G1HeapRegion* hr) {\n+                                                    update_live_region(hr, selected_for_rebuild);\n+                                                  });\n@@ -1287,4 +1287,2 @@\n-          if (tracker->update_old_before_rebuild(hr)) {\n-            _num_selected_for_rebuild++;\n-          }\n-          _cm->update_top_at_rebuild_start(hr);\n+          bool selected_for_rebuild = tracker->update_old_before_rebuild(hr);\n+          update_live_region(hr, selected_for_rebuild);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentMark.cpp","additions":25,"deletions":27,"binary":false,"changes":52,"status":"modified"}]}