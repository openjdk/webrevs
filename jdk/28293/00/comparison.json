{"files":[{"patch":"@@ -86,1 +86,2 @@\n-const char *IdealGraphPrinter::BLOCK_DOMINATOR_PROPERTY = \"dom\";\n+const char *IdealGraphPrinter::BLOCK_IMMEDIATE_DOMINATOR_PROPERTY = \"idom\";\n+const char *IdealGraphPrinter::BLOCK_DOMINATOR_DEPTH_PROPERTY = \"domDepth\";\n@@ -472,4 +473,2 @@\n-        if (node == block->head()) {\n-          if (block->_idom != nullptr) {\n-            print_prop(\"idom\", block->_idom->_pre_order);\n-          }\n+        if (block->_idom != nullptr) {\n+          print_prop(\"idom\", block->_idom->_pre_order);\n@@ -1044,0 +1043,4 @@\n+      if (block->_idom != nullptr) {\n+        print_attr(BLOCK_IMMEDIATE_DOMINATOR_PROPERTY, block->_idom->_pre_order);\n+      }\n+      print_attr(BLOCK_DOMINATOR_DEPTH_PROPERTY, block->_dom_depth);\n","filename":"src\/hotspot\/share\/opto\/idealGraphPrinter.cpp","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -80,1 +80,2 @@\n-  static const char *BLOCK_DOMINATOR_PROPERTY;\n+  static const char *BLOCK_IMMEDIATE_DOMINATOR_PROPERTY;\n+  static const char *BLOCK_DOMINATOR_DEPTH_PROPERTY;\n","filename":"src\/hotspot\/share\/opto\/idealGraphPrinter.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -36,0 +36,2 @@\n+    private String iDom;\n+    private int domDepth;\n@@ -86,1 +88,1 @@\n-    InputBlock(InputGraph graph, String name) {\n+    InputBlock(InputGraph graph, String name, String iDom) {\n@@ -89,0 +91,1 @@\n+        this.iDom = iDom;\n@@ -93,0 +96,1 @@\n+        domDepth = 1;\n@@ -98,0 +102,2 @@\n+    public String getIDom() { return iDom; }\n+    public int getDomDepth() { return domDepth; }\n@@ -145,0 +151,8 @@\n+\n+    public void setIDom(String iDom) {\n+        this.iDom = iDom;\n+    }\n+\n+    public void setDomDepth(int domDepth) {\n+        this.domDepth = domDepth;\n+    }\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/InputBlock.java","additions":15,"deletions":1,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+    private final List<InputBlockEdge> blockDominatorEdges;\n@@ -50,0 +51,1 @@\n+    private boolean isScheduled;\n@@ -72,0 +74,1 @@\n+        blockDominatorEdges = new ArrayList<>();\n@@ -80,0 +83,1 @@\n+        this.isScheduled = false;\n@@ -117,0 +121,6 @@\n+    public InputBlockEdge addDominatorBlockEdge(InputBlock dominator, InputBlock dominated) {\n+        InputBlockEdge edge = new InputBlockEdge(dominator, dominated, null);\n+        blockDominatorEdges.add(edge);\n+        return edge;\n+    }\n+\n@@ -194,0 +204,1 @@\n+        blockDominatorEdges.clear();\n@@ -402,1 +413,5 @@\n-        final InputBlock b = new InputBlock(this, name);\n+        return addBlock(name, null);\n+    }\n+\n+    public InputBlock addBlock(String name, String iDom) {\n+        final InputBlock b = new InputBlock(this, name, iDom);\n@@ -415,0 +430,4 @@\n+    public Collection<InputBlockEdge> getBlockDominatorEdges() {\n+        return Collections.unmodifiableList(blockDominatorEdges);\n+    }\n+\n@@ -419,0 +438,8 @@\n+\n+    public void setScheduled(boolean isScheduled) {\n+        this.isScheduled = isScheduled;\n+    }\n+\n+    public boolean isScheduled() {\n+        return isScheduled;\n+    }\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/InputGraph.java","additions":28,"deletions":1,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -93,0 +93,1 @@\n+    public static final String BLOCK_DOMINATOR_PROPERTY = \"idom\";\n@@ -211,1 +212,2 @@\n-            InputBlock b = graph.addBlock(name);\n+            String iDom = readAttribute(BLOCK_DOMINATOR_PROPERTY);\n+            InputBlock b = graph.addBlock(name, iDom);\n@@ -436,1 +438,5 @@\n-                    if (!b.getNodes().isEmpty()) {\n+                    \/\/ Add block immediate dominator edge\n+                    if (b.getIDom() != null) {\n+                        graph.addDominatorBlockEdge(graph.getBlock(b.getIDom()), b);\n+                    }\n+                    if (!blocksContainNodes && !b.getNodes().isEmpty()) {\n@@ -438,1 +444,0 @@\n-                        break;\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/serialization\/Parser.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -155,1 +155,5 @@\n-            writer.startTag(Parser.BLOCK_ELEMENT, new Properties(Parser.BLOCK_NAME_PROPERTY, b.getName()));\n+            Properties properties = new Properties(Parser.BLOCK_NAME_PROPERTY, b.getName());\n+            if (b.getIDom() != null) {\n+                properties.setProperty(Parser.BLOCK_DOMINATOR_PROPERTY, b.getIDom());\n+            }\n+            writer.startTag(Parser.BLOCK_ELEMENT, properties);\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/serialization\/Printer.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -160,0 +160,27 @@\n+        \/\/ Difference between dominator block edges\n+        aEdges.clear();\n+        for (InputBlockEdge edge : a.getBlockDominatorEdges()) {\n+            aEdges.add(new Pair<>(edge.getFrom().getName(), edge.getTo().getName()));\n+        }\n+        for (InputBlockEdge bEdge : b.getBlockDominatorEdges()) {\n+            InputBlock from = bEdge.getFrom();\n+            InputBlock to = bEdge.getTo();\n+            Pair<String, String> pair = new Pair<>(from.getName(), to.getName());\n+            if (aEdges.contains(pair)) {\n+                \/\/ same\n+                graph.addDominatorBlockEdge(blocksMap.get(from), blocksMap.get(to));\n+                aEdges.remove(pair);\n+            } else {\n+                \/\/ added\n+                InputBlockEdge edge = graph.addDominatorBlockEdge(blocksMap.get(from), blocksMap.get(to));\n+                edge.setState(InputBlockEdge.State.NEW);\n+            }\n+        }\n+        for (Pair<String, String> deleted : aEdges) {\n+            \/\/ removed\n+            InputBlock from = graph.getBlock(deleted.getLeft());\n+            InputBlock to = graph.getBlock(deleted.getRight());\n+            InputBlockEdge edge = graph.addDominatorBlockEdge(from, to);\n+            edge.setState(InputBlockEdge.State.DELETED);\n+        }\n+\n","filename":"src\/utils\/IdealGraphVisualizer\/Difference\/src\/main\/java\/com\/sun\/hotspot\/igv\/difference\/Difference.java","additions":27,"deletions":0,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,2 @@\n+    private ConnectionStyle style;\n+    private Color color;\n@@ -43,0 +45,2 @@\n+        this.style = ConnectionStyle.NORMAL;\n+        this.color = Color.BLUE;\n@@ -46,1 +50,5 @@\n-        return Color.BLUE;\n+        return color;\n+    }\n+\n+    public void setColor(Color color) {\n+         this.color = color;\n@@ -50,1 +58,5 @@\n-        return ConnectionStyle.BOLD;\n+        return style;\n+    }\n+\n+    public void setStyle(ConnectionStyle s) {\n+        style = s;\n","filename":"src\/utils\/IdealGraphVisualizer\/Graph\/src\/main\/java\/com\/sun\/hotspot\/igv\/graph\/BlockConnection.java","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import java.awt.Font;\n+import java.awt.*;\n@@ -30,0 +30,1 @@\n+import java.util.List;\n@@ -53,0 +54,1 @@\n+    private final Set<BlockConnection> blockDominatorConnections;\n@@ -74,0 +76,1 @@\n+        this.blockDominatorConnections = new HashSet<>();\n@@ -130,3 +133,16 @@\n-            Block p = getBlock(e.getFrom());\n-            Block s = getBlock(e.getTo());\n-            blockConnections.add(new BlockConnection(p, s, e.getLabel()));\n+            BlockConnection c = createBlockConnection(e);\n+            blockConnections.add(c);\n+        }\n+\n+        Collection<InputBlockEdge> dominatorEdges = graph.getBlockDominatorEdges();\n+        for (InputBlockEdge e : dominatorEdges) {\n+            BlockConnection c = createBlockConnection(e);\n+            if (e.getState() == InputBlockEdge.State.NEW) {\n+                c.setStyle(Connection.ConnectionStyle.BOLD);\n+            } else if (e.getState() == InputBlockEdge.State.DELETED) {\n+                c.setStyle(Connection.ConnectionStyle.DASHED);\n+            }\n+            if (graph.isScheduled()) {\n+                c.setColor(Color.RED);\n+            }\n+            blockDominatorConnections.add(c);\n@@ -244,0 +260,12 @@\n+    private BlockConnection createBlockConnection(InputBlockEdge e) {\n+        Block p = getBlock(e.getFrom());\n+        Block s = getBlock(e.getTo());\n+        BlockConnection c = new BlockConnection(p, s, e.getLabel());\n+        if (e.getState() == InputBlockEdge.State.NEW) {\n+            c.setStyle(Connection.ConnectionStyle.BOLD);\n+        } else if (e.getState() == InputBlockEdge.State.DELETED) {\n+            c.setStyle(Connection.ConnectionStyle.DASHED);\n+        }\n+        return c;\n+    }\n+\n@@ -368,0 +396,11 @@\n+    public Set<BlockConnection> getBlockDominatorConnections() {\n+        Set<BlockConnection> connections = new HashSet<>();\n+        for (BlockConnection bc : blockDominatorConnections) {\n+            if (blocks.containsKey(bc.getFromCluster().getInputBlock()) &&\n+                    blocks.containsKey(bc.getToCluster().getInputBlock())) {\n+                connections.add(bc);\n+            }\n+        }\n+        return connections;\n+    }\n+\n","filename":"src\/utils\/IdealGraphVisualizer\/Graph\/src\/main\/java\/com\/sun\/hotspot\/igv\/graph\/Diagram.java","additions":43,"deletions":4,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -532,0 +532,8 @@\n+        \/\/ Add dominator properties to nodes\n+        for (InputBlock block : blocks) {\n+            for (InputNode node : block.getNodes()) {\n+                node.getProperties().setProperty(\"block\", block.getName());\n+                node.getProperties().setProperty(\"idom\", block.getIDom());\n+                node.getProperties().setProperty(\"dom_depth\", String.valueOf(block.getDomDepth()));\n+            }\n+        }\n@@ -666,0 +674,15 @@\n+            if (idom != null) {\n+                graph.addDominatorBlockEdge(idom, b);\n+                b.setIDom(idom.getName());\n+            }\n+        }\n+        if (root != null) {\n+            setBlockDepth(D.dominatorTree(), root, 1);\n+        }\n+    }\n+\n+    private void setBlockDepth(Graph<InputBlock> domTree, InputBlock block, int depth) {\n+        block.setDomDepth(depth);\n+        for (Iterator<InputBlock> it = domTree.getSuccNodes(block); it.hasNext(); ) {\n+            InputBlock child = it.next();\n+            setBlockDepth(domTree, child, depth + 1);\n","filename":"src\/utils\/IdealGraphVisualizer\/ServerCompiler\/src\/main\/java\/com\/sun\/hotspot\/igv\/servercompiler\/ServerCompilerScheduler.java","additions":23,"deletions":0,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -1554,1 +1554,4 @@\n-            for (BlockConnection blockConnection : getModel().getDiagram().getBlockConnections()) {\n+            Set<BlockConnection> connections = getModel().getShowDominatorTree() ?\n+                    getModel().getDiagram().getBlockDominatorConnections() :\n+                    getModel().getDiagram().getBlockConnections();\n+            for (BlockConnection blockConnection : connections) {\n@@ -1782,1 +1785,6 @@\n-        for (BlockConnection c : getModel().getDiagram().getBlockConnections()) {\n+        DiagramViewModel model = getModel();\n+        Diagram diagram = model.getDiagram();\n+        Set<BlockConnection> connections = model.getShowDominatorTree() ?\n+                diagram.getBlockDominatorConnections() :\n+                diagram.getBlockConnections();\n+        for (BlockConnection c : connections) {\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/DiagramScene.java","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -78,0 +78,1 @@\n+    private boolean showDominatorTree;\n@@ -203,0 +204,9 @@\n+    public boolean getShowDominatorTree() {\n+        return showDominatorTree;\n+    }\n+\n+    public void setShowDominatorTree(boolean b) {\n+        showDominatorTree = b;\n+        diagramChangedEvent.fire();\n+    }\n+\n@@ -243,0 +253,1 @@\n+        showDominatorTree = model.getShowDominatorTree();\n@@ -270,0 +281,1 @@\n+        showDominatorTree = false;\n@@ -444,0 +456,1 @@\n+            graph.setScheduled(true);\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/DiagramViewModel.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -218,0 +218,1 @@\n+        toolBar.add(new JToggleButton(new ShowDominatorTreeAction(cfgLayoutAction, diagramViewModel.getShowDominatorTree())));\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/EditorTopComponent.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -0,0 +1,85 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+package com.sun.hotspot.igv.view.actions;\n+\n+import com.sun.hotspot.igv.view.EditorTopComponent;\n+import org.openide.util.ImageUtilities;\n+\n+import javax.swing.*;\n+import java.awt.event.ActionEvent;\n+import java.beans.PropertyChangeEvent;\n+import java.beans.PropertyChangeListener;\n+\n+public class ShowDominatorTreeAction extends AbstractAction implements PropertyChangeListener {\n+\n+    private boolean selected;\n+    private AbstractAction parentAction;\n+\n+    public ShowDominatorTreeAction(AbstractAction action, boolean select) {\n+        this.parentAction = action;\n+        this.selected = select;\n+        this.parentAction.addPropertyChangeListener(this);\n+        putValue(SELECTED_KEY, this.selected);\n+        putValue(SMALL_ICON, new ImageIcon(ImageUtilities.loadImage(iconResource())));\n+        putValue(SHORT_DESCRIPTION, \"Toggle dominator tree \/ control-flow graph view\");\n+        enableIfParentSelected();\n+    }\n+\n+    @Override\n+    public void actionPerformed(ActionEvent ev) {\n+        this.selected = isSelected();\n+        EditorTopComponent editor = EditorTopComponent.getActive();\n+        if (editor != null) {\n+            editor.getModel().setShowDominatorTree(this.selected);\n+        }\n+    }\n+\n+    protected String iconResource() {\n+        return \"com\/sun\/hotspot\/igv\/view\/images\/domtree.svg\";\n+    }\n+\n+    private boolean isSelected() {\n+        return (Boolean)getValue(SELECTED_KEY);\n+    }\n+\n+    private void enableIfParentSelected() {\n+        boolean enable = parentAction.isEnabled() && (Boolean)parentAction.getValue(SELECTED_KEY);\n+        if (enable != this.isEnabled()) {\n+            if (enable) {\n+                putValue(SELECTED_KEY, this.selected);\n+            } else {\n+                this.selected = isSelected();\n+                putValue(SELECTED_KEY, false);\n+            }\n+        }\n+        this.setEnabled(enable);\n+    }\n+\n+    @Override\n+    public void propertyChange(PropertyChangeEvent evt) {\n+        if (evt.getSource() == this.parentAction) {\n+            enableIfParentSelected();\n+        }\n+    }\n+}\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/actions\/ShowDominatorTreeAction.java","additions":85,"deletions":0,"binary":false,"changes":85,"status":"added"},{"patch":"@@ -0,0 +1,10 @@\n+<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#0000FF\" stroke-width=\"0.75\"\n+     stroke-linecap=\"round\" stroke-linejoin=\"round\" role=\"img\" aria-labelledby=\"title desc\">\n+    <path d=\"M12 5.5 L12 8.5 M12 5.5 L20.9 8.5 M12 12.5 L3.1 18 M12 12.5 L12 18 M20.9 12.5 L20.9 18\" \/>\n+    <rect x=\"10.4\" y=\"1.5\" width=\"3.2\" height=\"4.0\" fill=\"#D0D0FF\" \/>\n+    <rect x=\"10.4\" y=\"8.5\" width=\"3.2\" height=\"4.0\" fill=\"#D0D0FF\" \/>\n+    <rect x=\"19.3\" y=\"8.5\" width=\"3.2\" height=\"4.0\" fill=\"#D0D0FF\" \/>\n+    <rect x=\"1.5\" y=\"18.0\" width=\"3.2\" height=\"4.0\" fill=\"#D0D0FF\" \/>\n+    <rect x=\"10.4\" y=\"18.0\" width=\"3.2\" height=\"4.0\" fill=\"#D0D0FF\" \/>\n+    <rect x=\"19.3\" y=\"18.0\" width=\"3.2\" height=\"4.0\" fill=\"#D0D0FF\" \/>\n+<\/svg>\n\\ No newline at end of file\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/resources\/com\/sun\/hotspot\/igv\/view\/images\/domtree.svg","additions":10,"deletions":0,"binary":false,"changes":10,"status":"added"}]}