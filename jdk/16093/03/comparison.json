{"files":[{"patch":"@@ -812,1 +812,1 @@\n-    _features = feature_flags(); \/\/ These can be changed by VM settings\n+    _features = _cpuid_info.feature_flags(); \/\/ These can be changed by VM settings\n@@ -2894,1 +2894,1 @@\n-uint64_t VM_Version::feature_flags() {\n+uint64_t VM_Version::CpuidInfo::feature_flags() const {\n@@ -2896,1 +2896,1 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.cmpxchg8 != 0)\n+  if (std_cpuid1_edx.bits.cmpxchg8 != 0)\n@@ -2898,1 +2898,1 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.cmov != 0)\n+  if (std_cpuid1_edx.bits.cmov != 0)\n@@ -2900,1 +2900,1 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.clflush != 0)\n+  if (std_cpuid1_edx.bits.clflush != 0)\n@@ -2908,2 +2908,2 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.fxsr != 0 || (is_amd_family() &&\n-      _cpuid_info.ext_cpuid1_edx.bits.fxsr != 0))\n+  if (std_cpuid1_edx.bits.fxsr != 0 || (is_amd_family() &&\n+      ext_cpuid1_edx.bits.fxsr != 0))\n@@ -2914,2 +2914,2 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.mmx != 0 || (is_amd_family() &&\n-      _cpuid_info.ext_cpuid1_edx.bits.mmx != 0))\n+  if (std_cpuid1_edx.bits.mmx != 0 || (is_amd_family() &&\n+      ext_cpuid1_edx.bits.mmx != 0))\n@@ -2917,1 +2917,1 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.sse != 0)\n+  if (std_cpuid1_edx.bits.sse != 0)\n@@ -2919,1 +2919,1 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.sse2 != 0)\n+  if (std_cpuid1_edx.bits.sse2 != 0)\n@@ -2921,1 +2921,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.sse3 != 0)\n+  if (std_cpuid1_ecx.bits.sse3 != 0)\n@@ -2923,1 +2923,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.ssse3 != 0)\n+  if (std_cpuid1_ecx.bits.ssse3 != 0)\n@@ -2925,1 +2925,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.sse4_1 != 0)\n+  if (std_cpuid1_ecx.bits.sse4_1 != 0)\n@@ -2927,1 +2927,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.sse4_2 != 0)\n+  if (std_cpuid1_ecx.bits.sse4_2 != 0)\n@@ -2929,1 +2929,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.popcnt != 0)\n+  if (std_cpuid1_ecx.bits.popcnt != 0)\n@@ -2931,4 +2931,4 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.avx != 0 &&\n-      _cpuid_info.std_cpuid1_ecx.bits.osxsave != 0 &&\n-      _cpuid_info.xem_xcr0_eax.bits.sse != 0 &&\n-      _cpuid_info.xem_xcr0_eax.bits.ymm != 0) {\n+  if (std_cpuid1_ecx.bits.avx != 0 &&\n+      std_cpuid1_ecx.bits.osxsave != 0 &&\n+      xem_xcr0_eax.bits.sse != 0 &&\n+      xem_xcr0_eax.bits.ymm != 0) {\n@@ -2937,1 +2937,1 @@\n-    if (_cpuid_info.std_cpuid1_ecx.bits.f16c != 0)\n+    if (std_cpuid1_ecx.bits.f16c != 0)\n@@ -2939,1 +2939,1 @@\n-    if (_cpuid_info.sef_cpuid7_ebx.bits.avx2 != 0)\n+    if (sef_cpuid7_ebx.bits.avx2 != 0)\n@@ -2941,4 +2941,4 @@\n-    if (_cpuid_info.sef_cpuid7_ebx.bits.avx512f != 0 &&\n-        _cpuid_info.xem_xcr0_eax.bits.opmask != 0 &&\n-        _cpuid_info.xem_xcr0_eax.bits.zmm512 != 0 &&\n-        _cpuid_info.xem_xcr0_eax.bits.zmm32 != 0) {\n+    if (sef_cpuid7_ebx.bits.avx512f != 0 &&\n+        xem_xcr0_eax.bits.opmask != 0 &&\n+        xem_xcr0_eax.bits.zmm512 != 0 &&\n+        xem_xcr0_eax.bits.zmm32 != 0) {\n@@ -2946,1 +2946,1 @@\n-      if (_cpuid_info.sef_cpuid7_ebx.bits.avx512cd != 0)\n+      if (sef_cpuid7_ebx.bits.avx512cd != 0)\n@@ -2948,1 +2948,1 @@\n-      if (_cpuid_info.sef_cpuid7_ebx.bits.avx512dq != 0)\n+      if (sef_cpuid7_ebx.bits.avx512dq != 0)\n@@ -2950,1 +2950,1 @@\n-      if (_cpuid_info.sef_cpuid7_ebx.bits.avx512ifma != 0)\n+      if (sef_cpuid7_ebx.bits.avx512ifma != 0)\n@@ -2952,1 +2952,1 @@\n-      if (_cpuid_info.sef_cpuid7_ebx.bits.avx512pf != 0)\n+      if (sef_cpuid7_ebx.bits.avx512pf != 0)\n@@ -2954,1 +2954,1 @@\n-      if (_cpuid_info.sef_cpuid7_ebx.bits.avx512er != 0)\n+      if (sef_cpuid7_ebx.bits.avx512er != 0)\n@@ -2956,1 +2956,1 @@\n-      if (_cpuid_info.sef_cpuid7_ebx.bits.avx512bw != 0)\n+      if (sef_cpuid7_ebx.bits.avx512bw != 0)\n@@ -2958,1 +2958,1 @@\n-      if (_cpuid_info.sef_cpuid7_ebx.bits.avx512vl != 0)\n+      if (sef_cpuid7_ebx.bits.avx512vl != 0)\n@@ -2960,1 +2960,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.avx512_vpopcntdq != 0)\n+      if (sef_cpuid7_ecx.bits.avx512_vpopcntdq != 0)\n@@ -2962,1 +2962,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.avx512_vpclmulqdq != 0)\n+      if (sef_cpuid7_ecx.bits.avx512_vpclmulqdq != 0)\n@@ -2964,1 +2964,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.vaes != 0)\n+      if (sef_cpuid7_ecx.bits.vaes != 0)\n@@ -2966,1 +2966,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.gfni != 0)\n+      if (sef_cpuid7_ecx.bits.gfni != 0)\n@@ -2968,1 +2968,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.avx512_vnni != 0)\n+      if (sef_cpuid7_ecx.bits.avx512_vnni != 0)\n@@ -2970,1 +2970,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.avx512_bitalg != 0)\n+      if (sef_cpuid7_ecx.bits.avx512_bitalg != 0)\n@@ -2972,1 +2972,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.avx512_vbmi != 0)\n+      if (sef_cpuid7_ecx.bits.avx512_vbmi != 0)\n@@ -2974,1 +2974,1 @@\n-      if (_cpuid_info.sef_cpuid7_ecx.bits.avx512_vbmi2 != 0)\n+      if (sef_cpuid7_ecx.bits.avx512_vbmi2 != 0)\n@@ -2978,1 +2978,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.hv != 0)\n+  if (std_cpuid1_ecx.bits.hv != 0)\n@@ -2980,1 +2980,1 @@\n-  if (_cpuid_info.sef_cpuid7_ebx.bits.bmi1 != 0)\n+  if (sef_cpuid7_ebx.bits.bmi1 != 0)\n@@ -2982,1 +2982,1 @@\n-  if (_cpuid_info.std_cpuid1_edx.bits.tsc != 0)\n+  if (std_cpuid1_edx.bits.tsc != 0)\n@@ -2984,1 +2984,1 @@\n-  if (_cpuid_info.ext_cpuid7_edx.bits.tsc_invariance != 0)\n+  if (ext_cpuid7_edx.bits.tsc_invariance != 0)\n@@ -2986,1 +2986,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.aes != 0)\n+  if (std_cpuid1_ecx.bits.aes != 0)\n@@ -2988,1 +2988,1 @@\n-  if (_cpuid_info.sef_cpuid7_ebx.bits.erms != 0)\n+  if (sef_cpuid7_ebx.bits.erms != 0)\n@@ -2990,1 +2990,1 @@\n-  if (_cpuid_info.sef_cpuid7_edx.bits.fast_short_rep_mov != 0)\n+  if (sef_cpuid7_edx.bits.fast_short_rep_mov != 0)\n@@ -2992,1 +2992,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.clmul != 0)\n+  if (std_cpuid1_ecx.bits.clmul != 0)\n@@ -2994,1 +2994,1 @@\n-  if (_cpuid_info.sef_cpuid7_ebx.bits.rtm != 0)\n+  if (sef_cpuid7_ebx.bits.rtm != 0)\n@@ -2996,1 +2996,1 @@\n-  if (_cpuid_info.sef_cpuid7_ebx.bits.adx != 0)\n+  if (sef_cpuid7_ebx.bits.adx != 0)\n@@ -2998,1 +2998,1 @@\n-  if (_cpuid_info.sef_cpuid7_ebx.bits.bmi2 != 0)\n+  if (sef_cpuid7_ebx.bits.bmi2 != 0)\n@@ -3000,1 +3000,1 @@\n-  if (_cpuid_info.sef_cpuid7_ebx.bits.sha != 0)\n+  if (sef_cpuid7_ebx.bits.sha != 0)\n@@ -3002,1 +3002,1 @@\n-  if (_cpuid_info.std_cpuid1_ecx.bits.fma != 0)\n+  if (std_cpuid1_ecx.bits.fma != 0)\n@@ -3004,1 +3004,1 @@\n-  if (_cpuid_info.sef_cpuid7_ebx.bits.clflushopt != 0)\n+  if (sef_cpuid7_ebx.bits.clflushopt != 0)\n@@ -3006,1 +3006,1 @@\n-  if (_cpuid_info.ext_cpuid1_edx.bits.rdtscp != 0)\n+  if (ext_cpuid1_edx.bits.rdtscp != 0)\n@@ -3008,1 +3008,1 @@\n-  if (_cpuid_info.sef_cpuid7_ecx.bits.rdpid != 0)\n+  if (sef_cpuid7_ecx.bits.rdpid != 0)\n@@ -3013,2 +3013,2 @@\n-    if ((_cpuid_info.ext_cpuid1_edx.bits.tdnow != 0) ||\n-        (_cpuid_info.ext_cpuid1_ecx.bits.prefetchw != 0))\n+    if ((ext_cpuid1_edx.bits.tdnow != 0) ||\n+        (ext_cpuid1_ecx.bits.prefetchw != 0))\n@@ -3016,1 +3016,1 @@\n-    if (_cpuid_info.ext_cpuid1_ecx.bits.lzcnt != 0)\n+    if (ext_cpuid1_ecx.bits.lzcnt != 0)\n@@ -3018,1 +3018,1 @@\n-    if (_cpuid_info.ext_cpuid1_ecx.bits.sse4a != 0)\n+    if (ext_cpuid1_ecx.bits.sse4a != 0)\n@@ -3024,1 +3024,1 @@\n-    if (_cpuid_info.ext_cpuid1_ecx.bits.lzcnt != 0) {\n+    if (ext_cpuid1_ecx.bits.lzcnt != 0) {\n@@ -3027,1 +3027,1 @@\n-    if (_cpuid_info.ext_cpuid1_ecx.bits.prefetchw != 0) {\n+    if (ext_cpuid1_ecx.bits.prefetchw != 0) {\n@@ -3030,1 +3030,1 @@\n-    if (_cpuid_info.sef_cpuid7_ebx.bits.clwb != 0) {\n+    if (sef_cpuid7_ebx.bits.clwb != 0) {\n@@ -3033,1 +3033,1 @@\n-    if (_cpuid_info.sef_cpuid7_edx.bits.serialize != 0)\n+    if (sef_cpuid7_edx.bits.serialize != 0)\n@@ -3039,1 +3039,1 @@\n-    if (_cpuid_info.ext_cpuid1_ecx.bits.lzcnt != 0) {\n+    if (ext_cpuid1_ecx.bits.lzcnt != 0) {\n@@ -3042,1 +3042,1 @@\n-    if (_cpuid_info.ext_cpuid1_ecx.bits.prefetchw != 0) {\n+    if (ext_cpuid1_ecx.bits.prefetchw != 0) {\n@@ -3048,1 +3048,1 @@\n-  if (_cpuid_info.sef_cpuid7_ecx.bits.pku != 0) {\n+  if (sef_cpuid7_ecx.bits.pku != 0) {\n@@ -3051,1 +3051,1 @@\n-  if (_cpuid_info.sef_cpuid7_ecx.bits.ospke != 0) {\n+  if (sef_cpuid7_ecx.bits.ospke != 0) {\n@@ -3056,1 +3056,1 @@\n-  if (_cpuid_info.sef_cpuid7_ecx.bits.cet_ss != 0) {\n+  if (sef_cpuid7_ecx.bits.cet_ss != 0) {\n@@ -3059,1 +3059,1 @@\n-  if (_cpuid_info.sef_cpuid7_edx.bits.cet_ibt != 0) {\n+  if (sef_cpuid7_edx.bits.cet_ibt != 0) {\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp","additions":71,"deletions":71,"binary":false,"changes":142,"status":"modified"},{"patch":"@@ -431,1 +431,2 @@\n-  struct CpuidInfo {\n+  class CpuidInfo {\n+  public:\n@@ -525,0 +526,25 @@\n+\n+    uint64_t feature_flags() const;\n+\n+    \/\/ Asserts\n+    void assert_is_initialized() const {\n+      assert(std_cpuid1_eax.bits.family != 0, \"VM_Version not initialized\");\n+    }\n+\n+    \/\/ Extractors\n+    uint32_t extended_cpu_family() const {\n+      uint32_t result = std_cpuid1_eax.bits.family;\n+      result += std_cpuid1_eax.bits.ext_family;\n+      return result;\n+    }\n+\n+    uint32_t extended_cpu_model() const {\n+      uint32_t result = std_cpuid1_eax.bits.model;\n+      result |= std_cpuid1_eax.bits.ext_model << 4;\n+      return result;\n+    }\n+\n+    uint32_t cpu_stepping() const {\n+      uint32_t result = std_cpuid1_eax.bits.stepping;\n+      return result;\n+    }\n@@ -532,17 +558,0 @@\n-  static uint32_t extended_cpu_family() {\n-    uint32_t result = _cpuid_info.std_cpuid1_eax.bits.family;\n-    result += _cpuid_info.std_cpuid1_eax.bits.ext_family;\n-    return result;\n-  }\n-\n-  static uint32_t extended_cpu_model() {\n-    uint32_t result = _cpuid_info.std_cpuid1_eax.bits.model;\n-    result |= _cpuid_info.std_cpuid1_eax.bits.ext_model << 4;\n-    return result;\n-  }\n-\n-  static uint32_t cpu_stepping() {\n-    uint32_t result = _cpuid_info.std_cpuid1_eax.bits.stepping;\n-    return result;\n-  }\n-\n@@ -556,1 +565,0 @@\n-  static uint64_t feature_flags();\n@@ -597,5 +605,0 @@\n-  \/\/ Asserts\n-  static void assert_is_initialized() {\n-    assert(_cpuid_info.std_cpuid1_eax.bits.family != 0, \"VM_Version not initialized\");\n-  }\n-\n@@ -617,0 +620,4 @@\n+  static void     assert_is_initialized() { _cpuid_info.assert_is_initialized(); }\n+  static uint32_t extended_cpu_family()   { return _cpuid_info.extended_cpu_family(); }\n+  static uint32_t extended_cpu_model()    { return _cpuid_info.extended_cpu_model(); }\n+  static uint32_t cpu_stepping()          { return _cpuid_info.cpu_stepping(); }\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.hpp","additions":31,"deletions":24,"binary":false,"changes":55,"status":"modified"}]}