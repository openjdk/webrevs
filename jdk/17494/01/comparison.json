{"files":[{"patch":"@@ -88,3 +88,20 @@\n-    if (heap instanceof SerialHeap) {\n-      SerialHeap sh = (SerialHeap) heap;\n-      if (sh.isIn(a)) {\n+    if (heap.isIn(a)) {\n+      loc.heap = heap;\n+\n+      \/\/ See if the address is in a TLAB\n+      if (VM.getVM().getUseTLAB()) {\n+        \/\/ Try to find thread containing it\n+        for (int i = 0; i < threads.getNumberOfThreads(); i++) {\n+          JavaThread t = threads.getJavaThreadAt(i);\n+          ThreadLocalAllocBuffer tlab = t.tlab();\n+          if (tlab.contains(a)) {\n+            loc.tlabThread = t;\n+            loc.tlab = tlab;\n+            break;\n+          }\n+        }\n+      }\n+\n+      \/\/ If we are using the SerialHeap, find out which generation the address is in\n+      if (heap instanceof SerialHeap) {\n+        SerialHeap sh = (SerialHeap) heap;\n@@ -101,1 +118,1 @@\n-          Assert.that(loc.gen != null, \"Should have found this in a generation\");\n+          Assert.that(loc.gen != null, \"Should have found this address in a generation\");\n@@ -103,21 +120,0 @@\n-\n-        if (VM.getVM().getUseTLAB()) {\n-          \/\/ Try to find thread containing it\n-          for (int i = 0; i < threads.getNumberOfThreads(); i++) {\n-            JavaThread t = threads.getJavaThreadAt(i);\n-            ThreadLocalAllocBuffer tlab = t.tlab();\n-            if (tlab.contains(a)) {\n-              loc.inTLAB = true;\n-              loc.tlabThread = t;\n-              loc.tlab = tlab;\n-              break;\n-            }\n-          }\n-        }\n-\n-        return loc;\n-      }\n-    } else {\n-      if (heap.isIn(a)) {\n-        loc.heap = heap;\n-        return loc;\n@@ -125,0 +121,2 @@\n+\n+      return loc;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/utilities\/PointerFinder.java","additions":23,"deletions":25,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -64,1 +64,0 @@\n-  boolean inTLAB;\n@@ -132,1 +131,1 @@\n-    return inTLAB;\n+    return (tlab != null);\n@@ -272,4 +271,10 @@\n-        tty.print(\"In thread-local allocation buffer for thread (\");\n-        getTLABThread().printThreadInfoOn(tty);\n-        tty.print(\") \");\n-        getTLAB().printOn(tty); \/\/ includes \"\\n\"\n+        tty.print(\"In TLAB for thread \");\n+        JavaThread thread = getTLABThread();\n+        if (verbose) {\n+          tty.print(\"(\");\n+          thread.printThreadInfoOn(tty);\n+          tty.print(\") \");\n+          getTLAB().printOn(tty); \/\/ includes \"\\n\"\n+        } else {\n+          tty.format(\"\\\"%s\\\" %s\\n\", thread.getThreadName(), thread);\n+        }\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/utilities\/PointerLocation.java","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"}]}