{"files":[{"patch":"@@ -491,8 +491,0 @@\n-    private String getFinalPath(String path) throws IOException {\n-        return getFinalPath0(path);\n-    }\n-\n-    private native String getFinalPath0(String path)\n-            throws IOException;\n-\n-\n","filename":"src\/java.base\/windows\/classes\/java\/io\/WinNTFileSystem.java","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -291,1 +291,1 @@\n-            rv = (*env)->NewString(env, fp, (jsize)wcslen(canonicalPath));\n+            rv = (*env)->NewString(env, fp, (jsize)wcslen(fp));\n@@ -302,20 +302,0 @@\n-\n-JNIEXPORT jstring JNICALL\n-Java_java_io_WinNTFileSystem_getFinalPath0(JNIEnv* env, jobject this, jstring pathname) {\n-    jstring rv = NULL;\n-\n-    WITH_UNICODE_STRING(env, pathname, path) {\n-        WCHAR* finalPath = getFinalPath(env, path);\n-        if (finalPath != NULL) {\n-            rv = (*env)->NewString(env, finalPath, (jsize)wcslen(finalPath));\n-            free(finalPath);\n-        }\n-    } END_UNICODE_STRING(env, path);\n-\n-    if (rv == NULL && !(*env)->ExceptionCheck(env)) {\n-        JNU_ThrowIOExceptionWithLastError(env, \"Bad pathname\");\n-    }\n-\n-    return rv;\n-}\n-\n","filename":"src\/java.base\/windows\/native\/libjava\/WinNTFileSystem_md.c","additions":1,"deletions":21,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -335,0 +335,1 @@\n+    wchar_t* wcanon = NULL;\n@@ -358,1 +359,1 @@\n-    if (wcanonicalize(wpath, wresult, len) != 0) {\n+    if ((wcanon = wcanonicalize(wpath, wresult, len)) == NULL) {\n@@ -363,1 +364,1 @@\n-                            wresult, -1, out, len, NULL, NULL) == 0) {\n+                            wcanon, -1, out, len, NULL, NULL) == 0) {\n@@ -371,2 +372,6 @@\n-    free(wresult);\n-    free(wpath);\n+    if (wcanon != NULL && wcanon != wresult)\n+        free(wcanon);\n+    if (wresult != NULL)\n+        free(wresult);\n+    if (wpath != NULL)\n+        free(wpath);\n","filename":"src\/java.base\/windows\/native\/libjava\/canonicalize_md.c","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"}]}