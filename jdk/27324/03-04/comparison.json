{"files":[{"patch":"@@ -490,1 +490,1 @@\n-            finalPath = getFinalPath(canonicalPath);\n+            String fp = getFinalPath(canonicalPath);\n@@ -493,4 +493,5 @@\n-            \/\/ then obtain the mapping for the drive and replace it in the\n-            \/\/ final path with the original drive letter\n-            if (finalPath.charAt(0) == '\\\\' &&\n-                finalPath.charAt(1) == '\\\\' &&\n+            \/\/ then fall back to using the result of canonicalize0 because\n+            \/\/ there does not appear to be a reliable way to map the prefix\n+            \/\/ of the result of getFinalPath back to a drive letter\n+            if (fp.charAt(0) == '\\\\' &&\n+                fp.charAt(1) == '\\\\' &&\n@@ -500,12 +501,3 @@\n-                char driveLetter = canonicalPath.charAt(0);\n-                String uncPath = queryUNCPath(driveLetter);\n-                if (uncPath != null &&\n-                    finalPath.substring(0, uncPath.length()).equalsIgnoreCase(uncPath)) {\n-                    int fpLen = finalPath.length();\n-                    int uncLen = uncPath.length();\n-                    StringBuilder sb = new StringBuilder(fpLen - uncLen + 2);\n-                    sb.append(driveLetter);\n-                    sb.append(':');\n-                    sb.append(finalPath, uncLen, fpLen);\n-                    finalPath = sb.toString();\n-                }\n+                finalPath = canonicalPath;\n+            } else {\n+                finalPath = fp;\n","filename":"src\/java.base\/windows\/classes\/java\/io\/WinNTFileSystem.java","additions":9,"deletions":17,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -353,39 +353,0 @@\n-\/**\n- * Returns the value of the registry key\n- *\n- * HKEY_CURRENT_USER\\Network\\<drive>\\RemotePath\n- *\n- * which contains the UNC path to which \"drive\" is mapped. If there is no\n- * such registry key, or an error occurs, then NULL is returned.\n- *\/\n-JNIEXPORT jstring JNICALL\n-Java_java_io_WinNTFileSystem_queryUNCPath0(JNIEnv* env, jclass this,\n-    jchar drive)\n-{\n-    WCHAR subKey[10];\n-    swprintf(subKey, 10, L\"Network\\\\%c\", drive);\n-\n-    HKEY hKey;\n-    LSTATUS errorCode = RegOpenKeyExW(HKEY_CURRENT_USER,\n-                                      subKey, 0, KEY_READ, &hKey);\n-\n-    jstring remotePath = NULL;\n-    if (errorCode == ERROR_SUCCESS) {\n-        DWORD type;\n-        BYTE data[MAX_PATH_LENGTH + 1];\n-        DWORD size = sizeof(data);\n-\n-        errorCode = RegQueryValueExW(hKey, L\"RemotePath\", NULL, &type,\n-                                     (LPBYTE)&data, &size);\n-\n-        if (errorCode == ERROR_SUCCESS && type == REG_SZ) {\n-            jsize len = (jsize)wcslen((WCHAR*)data);\n-            remotePath = (*env)->NewString(env, (const jchar*)&data, len);\n-        }\n-    }\n-\n-    RegCloseKey(hKey);\n-\n-    return remotePath;\n-}\n-\n","filename":"src\/java.base\/windows\/native\/libjava\/WinNTFileSystem_md.c","additions":0,"deletions":39,"binary":false,"changes":39,"status":"modified"}]}