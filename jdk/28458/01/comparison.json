{"files":[{"patch":"@@ -28,2 +28,0 @@\n-import java.io.BufferedInputStream;\n-import java.io.DataInputStream;\n@@ -34,0 +32,1 @@\n+import java.lang.classfile.constantpool.ClassEntry;\n@@ -41,1 +40,0 @@\n-import static java.lang.classfile.constantpool.PoolEntry.*;\n@@ -167,25 +165,6 @@\n-            try (var in = new DataInputStream(new BufferedInputStream(ci))) {\n-                in.skipBytes(8);\n-                int cpLength = in.readUnsignedShort();\n-                String[] cpStrings = new String[cpLength];\n-                int[] cpClasses = new int[cpLength];\n-                for (int i = 1; i < cpLength; i++) {\n-                    int tag;\n-                    switch (tag = in.readUnsignedByte()) {\n-                        case TAG_UTF8 -> cpStrings[i] = in.readUTF();\n-                        case TAG_CLASS -> cpClasses[i] = in.readUnsignedShort();\n-                        case TAG_STRING, TAG_METHOD_TYPE, TAG_MODULE, TAG_PACKAGE -> in.skipBytes(2);\n-                        case TAG_METHOD_HANDLE -> in.skipBytes(3);\n-                        case TAG_INTEGER, TAG_FLOAT, TAG_FIELDREF, TAG_METHODREF, TAG_INTERFACE_METHODREF,\n-                             TAG_NAME_AND_TYPE, TAG_DYNAMIC, TAG_INVOKE_DYNAMIC -> in.skipBytes(4);\n-                        case TAG_LONG, TAG_DOUBLE -> {\n-                            in.skipBytes(8);\n-                            i++;\n-                        }\n-                        default -> throw new IllegalStateException(\"Bad tag (\" + tag + \") at index (\" + i + \")\");\n-                    }\n-                }\n-                boolean isInterface = (in.readUnsignedShort() & ACC_INTERFACE) != 0;\n-                in.skipBytes(2);\n-                int superIndex = in.readUnsignedShort();\n-                var superClass = superIndex > 0 ? ClassDesc.ofInternalName(cpStrings[cpClasses[superIndex]]) : null;\n+            try (ci) {\n+                var reader = new ClassReaderImpl(ci.readAllBytes(), ClassFileImpl.DEFAULT_CONTEXT);\n+                boolean isInterface = (reader.flags() & ACC_INTERFACE) != 0;\n+                ClassDesc superClass = reader.superclassEntry()\n+                        .map(ClassEntry::asSymbol)\n+                        .orElse(null);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/ClassHierarchyImpl.java","additions":7,"deletions":28,"binary":false,"changes":35,"status":"modified"}]}