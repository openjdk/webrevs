{"files":[{"patch":"@@ -27,0 +27,1 @@\n+ * @key headful\n@@ -29,3 +30,1 @@\n- * @library \/java\/awt\/regtesthelpers\n- * @build PassFailJFrame\n- * @run main\/manual TestNimbusProgressBarBorder\n+ * @run main TestNimbusProgressBarBorder\n@@ -34,0 +33,2 @@\n+import java.io.File;\n+\n@@ -36,0 +37,1 @@\n+import java.awt.Graphics2D;\n@@ -37,0 +39,5 @@\n+import java.awt.image.BufferedImage;\n+import java.awt.Rectangle;\n+import java.awt.Robot;\n+\n+import javax.imageio.ImageIO;\n@@ -38,1 +45,0 @@\n-import javax.swing.JCheckBox;\n@@ -42,1 +48,0 @@\n-import javax.swing.JSlider;\n@@ -44,0 +49,1 @@\n+import javax.swing.SwingUtilities;\n@@ -47,15 +53,4 @@\n-    static final String INSTRUCTIONS = \"\"\"\n-        A frame containing progress bar will be shown with 50% value\n-        and \"ProgressBar setBorder\" checkbox at the top\n-        and a slider at bottom.\n-\n-        Please check if 50% progress is rendered in the progress bar\n-        and rest 50% is rendered as blank bar\n-        with Nimbus default background color which is light gray.\n-\n-        Please verify if \"ProgressBar setBorder\" checkbox is unchecked,\n-        the 50% blank bar should not disappear.\n-        Also, now if you use slider to set progress value to 0%,\n-        a blank progress bar with 0% value should be rendered and\n-        the progress bar should not disappear.\n-        If this verification is met,  press Pass else press Fail.\"\"\";\n+    private static JFrame frame;\n+    private static JProgressBar progressBar;\n+    private static boolean failure = true;\n+    private static volatile Rectangle rect;\n@@ -64,9 +59,13 @@\n-        \/\/ Set Nimbus L&F\n-        UIManager.setLookAndFeel(\"javax.swing.plaf.nimbus.NimbusLookAndFeel\");\n-        PassFailJFrame.builder()\n-                .instructions(INSTRUCTIONS)\n-                .columns(35)\n-                .testUI(TestNimbusProgressBarBorder::createUI)\n-                .build()\n-                .awaitAndCheck();\n-    }\n+        int width = 200;\n+        int height = 100;\n+        try {\n+            Robot robot = new Robot();\n+            SwingUtilities.invokeAndWait(() -> {\n+                try {\n+                    \/\/ Set Nimbus L&F\n+                    UIManager.setLookAndFeel(\"javax.swing.plaf.nimbus.NimbusLookAndFeel\");\n+                } catch (Exception e) {\n+                    throw new RuntimeException(e);\n+                }\n+                frame = new JFrame(\"Nimbus JProgressBar Test\");\n+                frame.setSize(width, height);\n@@ -74,3 +73,4 @@\n-    static JFrame createUI() {\n-        JFrame frame = new JFrame(\"Synth JProgressBar Test\");\n-        frame.setSize(400, 200);\n+                \/\/ ProgressBar setup\n+                progressBar = new JProgressBar(0, 100);\n+                progressBar.setValue(0);\n+                progressBar.setBorderPainted(false);\n@@ -78,5 +78,3 @@\n-        \/\/ ProgressBar setup\n-        JProgressBar progressBar = new JProgressBar(0, 100);\n-        progressBar.setValue(50);\n-        progressBar.setStringPainted(true);\n-        progressBar.setBorderPainted(true);\n+                JPanel center = new JPanel(new GridBagLayout());\n+                center.setBackground(Color.WHITE);\n+                center.add(progressBar);\n@@ -84,6 +82,9 @@\n-        final JCheckBox checkBox = new JCheckBox(\"ProgressBar setBorder\", true);\n-        checkBox.addActionListener((e)->{\n-            boolean isSelected = checkBox.isSelected();\n-            progressBar.setBorderPainted(isSelected);\n-            checkBox.setText(\"ProgressBar setBorder: \" + isSelected);\n-        });\n+                frame.add(center, BorderLayout.CENTER);\n+                frame.setLocationRelativeTo(null);\n+                frame.setVisible(true);\n+            });\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+            SwingUtilities.invokeAndWait(() -> {\n+                rect = progressBar.getBounds();\n+            });\n@@ -91,3 +92,6 @@\n-        JPanel center = new JPanel(new GridBagLayout());\n-        center.setBackground(Color.CYAN);\n-        center.add(progressBar);\n+            BufferedImage img = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);\n+            Graphics2D g2d = (Graphics2D) img.getGraphics();\n+            g2d.setColor(Color.WHITE);\n+            g2d.fillRect(0, 0, rect.width, rect.height);\n+            progressBar.paint(g2d);\n+            g2d.dispose();\n@@ -95,3 +99,2 @@\n-        \/\/ Slider to adjust progress bar\n-        JSlider slider = new JSlider(0, 100, 50);\n-        slider.addChangeListener(e -> progressBar.setValue(slider.getValue()));\n+            robot.waitForIdle();\n+            robot.delay(100);\n@@ -99,4 +102,20 @@\n-        frame.add(checkBox, BorderLayout.NORTH);\n-        frame.add(center, BorderLayout.CENTER);\n-        frame.add(slider, BorderLayout.SOUTH);\n-        return frame;\n+            for (int x = 10; x < (10 + rect.width \/ 2); x++) {\n+                for (int y = 10; y < (10 + rect.height \/ 2); y++) {\n+                    Color col = new Color(img.getRGB(x, y));\n+                    if (!col.equals(Color.WHITE)) {\n+                        failure = false;\n+                        break;\n+                    }\n+                }\n+            }\n+            if (failure) {\n+                ImageIO.write(img, \"png\", new File(\"ProgressBarTest.png\"));\n+                throw new RuntimeException(\"ProgressBar background not drawn\");\n+            }\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n+        }\n@@ -104,1 +123,0 @@\n-\n","filename":"test\/jdk\/javax\/swing\/plaf\/nimbus\/TestNimbusProgressBarBorder.java","additions":72,"deletions":54,"binary":false,"changes":126,"status":"modified"}]}