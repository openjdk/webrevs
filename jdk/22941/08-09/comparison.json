{"files":[{"patch":"@@ -35,1 +35,0 @@\n-import compiler.lib.ir_framework.*;\n@@ -41,0 +40,2 @@\n+    static class FakeException extends RuntimeException {}\n+\n@@ -44,1 +45,0 @@\n-        private final String name;\n@@ -47,4 +47,0 @@\n-        UnderTest(String name) {\n-            this.name = name;\n-        }\n-\n@@ -56,1 +52,1 @@\n-                    if (x == (1 << 4)) throw new RuntimeException(\"Assert triggered for \" + name);\n+                    if (x == (1 << 4)) throw new FakeException();\n@@ -64,9 +60,13 @@\n-        TestFramework.run();\n-    }\n-\n-    @Run(test = {\"test\"})\n-    public void run() {\n-        \/\/ Usually, we will fail with \"Assert triggered for special\" as uniform is unlikely to input the triggering\n-        \/\/ sequence to UnderTest but special has a good chance of doing so.\n-        test(G.uniformInts(), \"uniform\");\n-        test(G.specialInts(3), \"special\");\n+        \/\/ This test should print \"Assertion triggered by special\" (see the math below) but almost never\n+        \/\/ \"Assertion triggered by uniform\" as the chance of triggering is about 2^-96.\n+        try {\n+            test(G.uniformInts());\n+        } catch (FakeException e) {\n+            System.out.println(\"Assertion triggered by uniform\");\n+        }\n+        try {\n+            \/\/ 408 ints => 1\/408 * 1\/408 * 1\/408 => 1\/67_917_312 => with 70_000_000 loop iterations we should trigger\n+            test(G.specialInts(3));\n+        } catch (FakeException e) {\n+            System.out.println(\"Assertion triggered by special\");\n+        }\n@@ -75,4 +75,3 @@\n-    @Test\n-    public void test(Generator<Integer> g, String name) {\n-        UnderTest underTest = new UnderTest(name);\n-        for (int i = 0; i < 10_000; i++) {\n+    public static void test(Generator<Integer> g) {\n+        UnderTest underTest = new UnderTest();\n+        for (int i = 0; i < 70_000_000; i++) {\n","filename":"test\/hotspot\/jtreg\/testlibrary_tests\/generators\/tests\/ExampleTest.java","additions":19,"deletions":20,"binary":false,"changes":39,"status":"modified"}]}