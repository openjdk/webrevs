{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -1343,4 +1343,5 @@\n-  if (supports_evex() && supports_avx512bw()) {\n-      if (FLAG_IS_DEFAULT(UseSHA3Intrinsics)) {\n-          UseSHA3Intrinsics = true;\n-      }\n+  if (UseSHA && supports_evex() && supports_avx512bw()) {\n+    if (FLAG_IS_DEFAULT(UseSHA3Intrinsics)) {\n+      FLAG_SET_DEFAULT(UseSHA3Intrinsics, true);\n+      UseSHA3Intrinsics = true;\n+    }\n@@ -1348,2 +1349,2 @@\n-      warning(\"Intrinsics for SHA3-224, SHA3-256, SHA3-384 and SHA3-512 crypto hash functions not available on this CPU.\");\n-      FLAG_SET_DEFAULT(UseSHA3Intrinsics, false);\n+    warning(\"Intrinsics for SHA3-224, SHA3-256, SHA3-384 and SHA3-512 crypto hash functions not available on this CPU.\");\n+    FLAG_SET_DEFAULT(UseSHA3Intrinsics, false);\n@@ -1352,1 +1353,1 @@\n-  if (!(UseSHA1Intrinsics || UseSHA256Intrinsics || UseSHA512Intrinsics)) {\n+  if (!(UseSHA1Intrinsics || UseSHA256Intrinsics || UseSHA512Intrinsics || UseSHA3Intrinsics)) {\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp","additions":9,"deletions":8,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,145 @@\n+\/*\n+ * Copyright (c) 2026, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8375443\n+ * @summary Verify that UseSHA3Intrinsics is properly disabled when UseSHA is disabled\n+ *          on systems with AVX-512 support\n+ * @library \/test\/lib \/\n+ * @requires vm.flagless\n+ * @requires os.arch == \"amd64\" | os.arch == \"x86_64\"\n+ * @requires vm.cpu.features ~= \".*avx512f.*\" & vm.cpu.features ~= \".*avx512bw.*\"\n+ *\n+ * @build jdk.test.whitebox.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions\n+ *                   -XX:+WhiteBoxAPI\n+ *                   compiler.arguments.TestUseSHA3IntrinsicsWithUseSHADisabled\n+ *\/\n+\n+package compiler.arguments;\n+\n+import jdk.test.lib.cli.CommandLineOptionTest;\n+import jdk.test.lib.process.ExitCode;\n+\n+public class TestUseSHA3IntrinsicsWithUseSHADisabled {\n+    private static final String OPTION_NAME = \"UseSHA3Intrinsics\";\n+    private static final String MASTER_OPTION = \"UseSHA\";\n+    private static final String WARNING_MESSAGE =\n+        \"Intrinsics for SHA3-224, SHA3-256, SHA3-384 and SHA3-512 crypto hash functions not available on this CPU\\\\.\";\n+    private static final String UNLOCK_DIAGNOSTIC = \"-XX:+UnlockDiagnosticVMOptions\";\n+\n+    public static void main(String[] args) throws Throwable {\n+        \/\/ Verify that UseSHA3Intrinsics can be explicitly enabled when UseSHA is enabled (default)\n+        testExplicitEnableWithUseSHAEnabled();\n+\n+        \/\/ Verify that UseSHA3Intrinsics is forced to false when UseSHA is disabled,\n+        \/\/ even if explicitly set to true\n+        testForcedDisableWhenUseSHADisabled();\n+\n+        \/\/ Verify that a warning is printed when trying to enable UseSHA3Intrinsics\n+        \/\/ while UseSHA is disabled\n+        testWarningWhenEnablingWithUseSHADisabled();\n+\n+        \/\/ Verify that UseSHA3Intrinsics can be explicitly disabled even when UseSHA is enabled\n+        testExplicitDisableWithUseSHAEnabled();\n+    }\n+\n+    private static void testExplicitEnableWithUseSHAEnabled() throws Throwable {\n+        \/\/ Verify the option value is true when explicitly enabled (with UseSHA enabled by default)\n+        CommandLineOptionTest.verifyOptionValueForSameVM(\n+            OPTION_NAME,\n+            \"true\",\n+            \"UseSHA3Intrinsics should be enabled when explicitly set to true with UseSHA enabled\",\n+            UNLOCK_DIAGNOSTIC,\n+            CommandLineOptionTest.prepareBooleanFlag(OPTION_NAME, true)\n+        );\n+\n+        \/\/ Verify no warning is printed when enabling UseSHA3Intrinsics with UseSHA enabled\n+        CommandLineOptionTest.verifySameJVMStartup(\n+            null,  \/\/ No specific output expected\n+            new String[] { WARNING_MESSAGE },  \/\/ Warning should not appear\n+            \"No warning should be printed when enabling UseSHA3Intrinsics with UseSHA enabled\",\n+            \"UseSHA3Intrinsics should be enabled without warnings when UseSHA is enabled\",\n+            ExitCode.OK,\n+            UNLOCK_DIAGNOSTIC,\n+            CommandLineOptionTest.prepareBooleanFlag(OPTION_NAME, true)\n+        );\n+    }\n+\n+    private static void testForcedDisableWhenUseSHADisabled() throws Throwable {\n+        \/\/ When -XX:-UseSHA is set, UseSHA3Intrinsics should be forced to false\n+        \/\/ even if +UseSHA3Intrinsics is explicitly passed\n+        CommandLineOptionTest.verifyOptionValueForSameVM(\n+            OPTION_NAME,\n+            \"false\",\n+            String.format(\"UseSHA3Intrinsics should be forced to false when %s is set, \" +\n+                         \"even if explicitly enabled\",\n+                         CommandLineOptionTest.prepareBooleanFlag(MASTER_OPTION, false)),\n+            UNLOCK_DIAGNOSTIC,\n+            CommandLineOptionTest.prepareBooleanFlag(OPTION_NAME, true),\n+            CommandLineOptionTest.prepareBooleanFlag(MASTER_OPTION, false)\n+        );\n+    }\n+\n+    private static void testWarningWhenEnablingWithUseSHADisabled() throws Throwable {\n+        \/\/ A warning should be printed when trying to enable UseSHA3Intrinsics with -UseSHA\n+        CommandLineOptionTest.verifySameJVMStartup(\n+            new String[] { WARNING_MESSAGE },  \/\/ Warning should appear\n+            null,  \/\/ No unexpected output\n+            \"JVM should start successfully\",\n+            String.format(\"A warning should be printed when trying to enable %s while %s is disabled\",\n+                         OPTION_NAME,\n+                         MASTER_OPTION),\n+            ExitCode.OK,\n+            UNLOCK_DIAGNOSTIC,\n+            CommandLineOptionTest.prepareBooleanFlag(MASTER_OPTION, false),\n+            CommandLineOptionTest.prepareBooleanFlag(OPTION_NAME, true)\n+        );\n+    }\n+\n+    private static void testExplicitDisableWithUseSHAEnabled() throws Throwable {\n+        \/\/ Verify that UseSHA3Intrinsics can be explicitly disabled even when UseSHA is enabled\n+        CommandLineOptionTest.verifyOptionValueForSameVM(\n+            OPTION_NAME,\n+            \"false\",\n+            \"UseSHA3Intrinsics should be disabled when explicitly set to false\",\n+            UNLOCK_DIAGNOSTIC,\n+            CommandLineOptionTest.prepareBooleanFlag(MASTER_OPTION, true),\n+            CommandLineOptionTest.prepareBooleanFlag(OPTION_NAME, false)\n+        );\n+\n+        \/\/ Verify no warning is printed when explicitly disabling UseSHA3Intrinsics\n+        CommandLineOptionTest.verifySameJVMStartup(\n+            null,  \/\/ No specific output expected\n+            new String[] { WARNING_MESSAGE },  \/\/ Warning should not appear\n+            \"No warning should be printed when explicitly disabling UseSHA3Intrinsics\",\n+            \"UseSHA3Intrinsics should be disabled without warnings\",\n+            ExitCode.OK,\n+            UNLOCK_DIAGNOSTIC,\n+            CommandLineOptionTest.prepareBooleanFlag(MASTER_OPTION, true),\n+            CommandLineOptionTest.prepareBooleanFlag(OPTION_NAME, false)\n+        );\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/arguments\/TestUseSHA3IntrinsicsWithUseSHADisabled.java","additions":145,"deletions":0,"binary":false,"changes":145,"status":"added"}]}