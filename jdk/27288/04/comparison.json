{"files":[{"patch":"@@ -514,2 +514,2 @@\n-  \/\/ Want a pattern to quickly diff against layout header in register\n-  \/\/ find something less clever!\n+  \/\/ Return a value containing a single set bit that is in the bitset difference between the\n+  \/\/ layout helpers for array-of-boolean and array-of-byte.\n@@ -517,9 +517,13 @@\n-    jint zlh = array_layout_helper(T_BOOLEAN);\n-    jint blh = array_layout_helper(T_BYTE);\n-    assert(zlh != blh, \"array layout helpers must differ\");\n-    int diffbit = 1;\n-    while ((diffbit & (zlh ^ blh)) == 0 && (diffbit & zlh) == 0) {\n-      diffbit <<= 1;\n-      assert(diffbit != 0, \"make sure T_BOOLEAN has a different bit than T_BYTE\");\n-    }\n-    return diffbit;\n+    uint zlh = static_cast<uint>(array_layout_helper(T_BOOLEAN));\n+    uint blh = static_cast<uint>(array_layout_helper(T_BYTE));\n+    \/\/ get all the bits that are set in zlh and clear in blh\n+    uint candidates = (zlh & ~blh);\n+    assert(candidates != 0, \"must be\"); \/\/ must be some if there is a solution.\n+    \/\/ Use well known bit hack to isolate the low bit of candidates.\n+    \/\/ The usual form is (x & -x), but VS warns (C4146) about unary minus of unsigned.\n+    \/\/ So use alternate form of negation to avoid warning.\n+    uint result = candidates & (~candidates + 1);\n+    assert(is_power_of_2(result), \"must be power of 2\");\n+    assert((result & zlh) != 0, \"must be set in alh of T_BOOLEAN\");\n+    assert((result & blh) == 0, \"must be clear in alh of T_BYTE\");\n+    return static_cast<int>(result);\n","filename":"src\/hotspot\/share\/oops\/klass.hpp","additions":15,"deletions":11,"binary":false,"changes":26,"status":"modified"}]}