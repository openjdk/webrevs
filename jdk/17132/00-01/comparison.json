{"files":[{"patch":"@@ -182,17 +182,1 @@\n-    private record AttributeInfo(Byte[] valueTags, Class<?> valueClass, boolean singleValued) {}\n-\n-    \/**\n-     * Array of attribute OIDs defined in PKCS9, by number.\n-     *\/\n-    static final ObjectIdentifier[] PKCS9_OIDS = new ObjectIdentifier[19];\n-\n-    private static final Class<?> BYTE_ARRAY_CLASS;\n-\n-    static {\n-        try {\n-            BYTE_ARRAY_CLASS = Class.forName(\"[B\");\n-        } catch (ClassNotFoundException e) {\n-            throw new ExceptionInInitializerError(e.toString());\n-        }\n-    }\n-\n+    \/* OID Constants *\/\n@@ -219,2 +203,0 @@\n-    \/\/ [11], [12] are RSA DSI proprietary\n-    \/\/ [13] ==> signingDescription, S\/MIME, not used anymore\n@@ -230,1 +212,4 @@\n-    private static final Map<ObjectIdentifier,AttributeInfo> oidMap = new LinkedHashMap<>();\n+    private record AttributeInfo(byte[] valueTags, Class<?> valueClass, boolean singleValued) {}\n+\n+    private static final Map<ObjectIdentifier,AttributeInfo> oidMap = new HashMap<>();\n+\n@@ -232,1 +217,1 @@\n-                            Class<?> valueClass, Byte[] valueTags) {\n+                            Class<?> valueClass, byte... valueTags) {\n@@ -243,2 +228,1 @@\n-            add(EMAIL_ADDRESS_OID, false, str,\n-                new Byte[]{DerValue.tag_IA5String});\n+            add(EMAIL_ADDRESS_OID, false, str, DerValue.tag_IA5String);\n@@ -246,1 +230,1 @@\n-            add(UNSTRUCTURED_NAME_OID, false, str, new Byte[]{\n+            add(UNSTRUCTURED_NAME_OID, false, str,\n@@ -252,1 +236,1 @@\n-                DerValue.tag_UTF8String});\n+                DerValue.tag_UTF8String);\n@@ -256,1 +240,1 @@\n-                new Byte[]{DerValue.tag_ObjectId});\n+                DerValue.tag_ObjectId);\n@@ -258,2 +242,2 @@\n-            add(MESSAGE_DIGEST_OID, true, BYTE_ARRAY_CLASS,\n-                new Byte[]{DerValue.tag_OctetString});\n+            add(MESSAGE_DIGEST_OID, true, byte[].class,\n+                DerValue.tag_OctetString);\n@@ -262,1 +246,1 @@\n-                new Byte[]{DerValue.tag_UtcTime, DerValue.tag_GeneralizedTime});\n+                DerValue.tag_UtcTime, DerValue.tag_GeneralizedTime);\n@@ -266,1 +250,1 @@\n-                new Byte[] {DerValue.tag_Sequence});\n+                DerValue.tag_Sequence);\n@@ -269,1 +253,1 @@\n-                Class.forName(\"java.lang.String\"), new Byte[]{\n+                Class.forName(\"java.lang.String\"),\n@@ -274,1 +258,1 @@\n-                    DerValue.tag_UTF8String});\n+                    DerValue.tag_UTF8String);\n@@ -276,1 +260,1 @@\n-            add(UNSTRUCTURED_ADDRESS_OID, false, str, new Byte[]{\n+            add(UNSTRUCTURED_ADDRESS_OID, false, str,\n@@ -281,1 +265,1 @@\n-                DerValue.tag_UTF8String});\n+                DerValue.tag_UTF8String);\n@@ -285,1 +269,1 @@\n-                new Byte[]{DerValue.tag_Sequence});\n+                DerValue.tag_Sequence);\n@@ -287,2 +271,3 @@\n-            add(SIGNING_CERTIFICATE_OID, true, null,\n-                new Byte[]{DerValue.tag_Sequence});\n+            add(SIGNING_CERTIFICATE_OID, true,\n+                Class.forName(\"sun.security.pkcs.SigningCertificateInfo\"),\n+                DerValue.tag_Sequence);\n@@ -290,2 +275,2 @@\n-            add(SIGNATURE_TIMESTAMP_TOKEN_OID, true, BYTE_ARRAY_CLASS,\n-                new Byte[]{DerValue.tag_Sequence});\n+            add(SIGNATURE_TIMESTAMP_TOKEN_OID, true, byte[].class,\n+                DerValue.tag_Sequence);\n@@ -293,2 +278,2 @@\n-            add(CMS_ALGORITHM_PROTECTION_OID, true, BYTE_ARRAY_CLASS,\n-                new Byte[]{DerValue.tag_Sequence});\n+            add(CMS_ALGORITHM_PROTECTION_OID, true, byte[].class,\n+                DerValue.tag_Sequence);\n@@ -304,1 +289,1 @@\n-    private ObjectIdentifier oid;\n+    private final ObjectIdentifier oid;\n@@ -307,2 +292,1 @@\n-     * The index of the OID of this attribute in <code>PKCS9_OIDS<\/code>,\n-     * or -1 if it's unknown.\n+     * The AttributeInfo of this attribute\n@@ -310,1 +294,1 @@\n-    private AttributeInfo info;\n+    private final AttributeInfo info;\n@@ -314,1 +298,1 @@\n-     * <code>VALUE_CLASSES[index]<\/code>. The SET itself\n+     * <code>AttributeInfo.valueClass<\/code>. The SET itself\n@@ -317,1 +301,1 @@\n-    private Object value;\n+    private final Object value;\n@@ -334,5 +318,0 @@\n-    throws IllegalArgumentException {\n-        init(oid, value);\n-    }\n-\n-    private void init(ObjectIdentifier oid, Object value)\n@@ -343,1 +322,1 @@\n-        Class<?> clazz = (info == null) ? BYTE_ARRAY_CLASS : info.valueClass();\n+        Class<?> clazz = info.valueClass();\n@@ -346,3 +325,3 @@\n-                    \"No value class supported \" +\n-                            \" for attribute \" + oid +\n-                            \" constructing PKCS9Attribute\");\n+                \"No value class supported \" +\n+                    \" for attribute \" + oid +\n+                    \" constructing PKCS9Attribute\");\n@@ -351,6 +330,6 @@\n-                throw new IllegalArgumentException(\n-                           \"Wrong value class \" +\n-                           \" for attribute \" + oid +\n-                           \" constructing PKCS9Attribute; was \" +\n-                           value.getClass().toString() + \", should be \" +\n-                           clazz.toString());\n+            throw new IllegalArgumentException(\n+                \"Wrong value class \" +\n+                    \" for attribute \" + oid +\n+                    \" constructing PKCS9Attribute; was \" +\n+                    value.getClass().toString() + \", should be \" +\n+                    clazz.toString());\n@@ -398,1 +377,1 @@\n-        Byte tag;\n+        byte tag;\n@@ -405,1 +384,0 @@\n-        \/\/should the behavior be different for RSA\/smime\n@@ -462,1 +440,2 @@\n-        default: \/\/ Can't happen\n+        default:\n+            throw new IOException(\"Unsupported signer attribute: \" + oid);\n@@ -479,2 +458,1 @@\n-        KnownOIDs knownOID = KnownOIDs.findMatch(oid.toString());\n-        if (knownOID == null) {\n+        if (info == null) {\n@@ -486,0 +464,1 @@\n+        KnownOIDs knownOID = KnownOIDs.findMatch(oid.toString());\n@@ -574,1 +553,4 @@\n-        default: \/\/ Can't happen\n+        default: \/\/Should never happen\n+            temp.writeBytes((byte[])value);\n+            out.write(DerValue.tag_Sequence, temp.toByteArray());\n+            return;\n@@ -616,0 +598,2 @@\n+    public static Set<ObjectIdentifier> getOIDs() { return oidMap.keySet(); }\n+\n@@ -691,3 +675,3 @@\n-    static int indexOf(Object obj, Object[] a, int start) {\n-        for (int i=start; i < a.length; i++) {\n-            if (obj.equals(a[i])) return i;\n+    static int indexOf(byte b, byte[] bs, int start) {\n+        for (int i=start; i < bs.length; i++) {\n+            if (b == bs[i]) return i;\n@@ -713,1 +697,1 @@\n-    private void throwTagException(Byte tag)\n+    private void throwTagException(byte tag)\n@@ -715,1 +699,1 @@\n-        Byte[] expectedTags = info.valueTags();\n+        byte[] expectedTags = info.valueTags();\n@@ -722,1 +706,1 @@\n-        msg.append(tag.toString());\n+        msg.append(tag);\n@@ -725,1 +709,1 @@\n-        msg.append(expectedTags[0].toString());\n+        msg.append(expectedTags[0]);\n@@ -729,1 +713,1 @@\n-            msg.append(expectedTags[i].toString());\n+            msg.append(expectedTags[i]);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/pkcs\/PKCS9Attribute.java","additions":60,"deletions":76,"binary":false,"changes":136,"status":"modified"},{"patch":"@@ -270,21 +270,0 @@\n-\n-    \/**\n-     * Get an array of all attributes in this set, in order of OID.\n-     *\/\n-    public PKCS9Attribute[] getAttributes() {\n-        PKCS9Attribute[] attribs = new PKCS9Attribute[attributes.size()];\n-\n-        int j = 0;\n-        for (int i=1; i < PKCS9Attribute.PKCS9_OIDS.length &&\n-                      j < attribs.length; i++) {\n-            if (PKCS9Attribute.PKCS9_OIDS[i] == null) {\n-                continue;\n-            }\n-            attribs[j] = getAttribute(PKCS9Attribute.PKCS9_OIDS[i]);\n-\n-            if (attribs[j] != null)\n-                j++;\n-        }\n-        return attribs;\n-    }\n-\n@@ -328,5 +307,2 @@\n-        for (int i = 1; i < PKCS9Attribute.PKCS9_OIDS.length; i++) {\n-            if (PKCS9Attribute.PKCS9_OIDS[i] == null) {\n-                continue;\n-            }\n-            value = getAttribute(PKCS9Attribute.PKCS9_OIDS[i]);\n+        for (ObjectIdentifier oid : PKCS9Attribute.getOIDs()) {\n+            if (oid == null) continue;\n@@ -334,0 +310,1 @@\n+            value = getAttribute(oid);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/pkcs\/PKCS9Attributes.java","additions":3,"deletions":26,"binary":false,"changes":29,"status":"modified"}]}