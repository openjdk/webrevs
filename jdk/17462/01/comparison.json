{"files":[{"patch":"@@ -32,0 +32,1 @@\n+import java.util.Iterator;\n@@ -344,14 +345,16 @@\n-                    int newSize = newFileCache.size();\n-                    int oldSize = fileCache.size();\n-\n-                    if (newSize > oldSize) {\n-                        \/\/see if interval is added\n-                        int start = oldSize;\n-                        int end = newSize;\n-                        for (int i = 0; i < oldSize; i++) {\n-                            if (!newFileCache.get(i).equals(fileCache.get(i))) {\n-                                start = i;\n-                                for (int j = i; j < newSize; j++) {\n-                                    if (newFileCache.get(j).equals(fileCache.get(i))) {\n-                                        end = j;\n-                                        break;\n+                    synchronized (fileCache) {\n+                        int newSize = newFileCache.size();\n+                        int oldSize = fileCache.size();\n+\n+                        if (newSize > oldSize) {\n+                            \/\/see if interval is added\n+                            int start = oldSize;\n+                            int end = newSize;\n+                            for (int i = 0; i < oldSize; i++) {\n+                                if (!newFileCache.get(i).equals(fileCache.get(i))) {\n+                                    start = i;\n+                                    for (int j = i; j < newSize; j++) {\n+                                        if (newFileCache.get(j).equals(fileCache.get(i))) {\n+                                            end = j;\n+                                            break;\n+                                        }\n@@ -359,0 +362,1 @@\n+                                    break;\n@@ -360,1 +364,0 @@\n-                                break;\n@@ -362,1 +365,0 @@\n-                        }\n@@ -364,3 +366,2 @@\n-                        if (start >= 0 && end > start) {\n-                            List<File> listStart_OldSize = new Vector<>(fileCache.subList(start, oldSize));\n-                            if (newFileCache.subList(end, newSize).equals(listStart_OldSize)) {\n+                            if (start >= 0 && end > start && newFileCache.subList(end, newSize)\n+                                    .equals(fileCache.subList(start, oldSize))) {\n@@ -370,1 +371,2 @@\n-                                return new DoChangeContents(newFileCache.subList(start, end), start, null, 0, fid);\n+                                return new DoChangeContents(newFileCache\n+                                        .subList(start, end), start, null, 0, fid);\n@@ -372,10 +374,10 @@\n-                        }\n-                    } else if (newSize < oldSize) {\n-                        \/\/see if interval is removed\n-                        int start = -1;\n-                        int end = -1;\n-                        for (int i = 0; i < newSize; i++) {\n-                            if (!newFileCache.get(i).equals(fileCache.get(i))) {\n-                                start = i;\n-                                end = i + oldSize - newSize;\n-                                break;\n+                        } else if (newSize < oldSize) {\n+                            \/\/see if interval is removed\n+                            int start = -1;\n+                            int end = -1;\n+                            for (int i = 0; i < newSize; i++) {\n+                                if (!newFileCache.get(i).equals(fileCache.get(i))) {\n+                                    start = i;\n+                                    end = i + oldSize - newSize;\n+                                    break;\n+                                }\n@@ -383,1 +385,0 @@\n-                        }\n@@ -385,3 +386,2 @@\n-                        if (start >= 0 && end > start) {\n-                            List<File> listEnd_OldSize = new Vector<>(fileCache.subList(end, oldSize));\n-                            if (listEnd_OldSize.equals(newFileCache.subList(start, newSize))) {\n+                            if (start >= 0 && end > start && fileCache.subList(end, oldSize)\n+                                    .equals(newFileCache.subList(start, newSize))) {\n@@ -391,1 +391,2 @@\n-                                return new DoChangeContents(null, 0, new Vector<>(fileCache.subList(start, end)), start, fid);\n+                                return new DoChangeContents(null, 0, new Vector<>(fileCache\n+                                        .subList(start, end)), start, fid);\n@@ -394,4 +395,5 @@\n-                    }\n-                    if (!fileCache.equals(newFileCache)) {\n-                        if (loadThread.isInterrupted()) {\n-                            cancelRunnables();\n+                        if (!fileCache.equals(newFileCache)) {\n+                            if (loadThread.isInterrupted()) {\n+                                cancelRunnables();\n+                            }\n+                            return new DoChangeContents(newFileCache, 0, fileCache, 0, fid);\n@@ -399,1 +401,1 @@\n-                        return new DoChangeContents(newFileCache, 0, fileCache, 0, fid);\n+                        return null;\n@@ -401,1 +403,0 @@\n-                    return null;\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/basic\/BasicDirectoryModel.java","additions":42,"deletions":41,"binary":false,"changes":83,"status":"modified"}]}