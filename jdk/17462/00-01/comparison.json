{"files":[{"patch":"@@ -345,14 +345,16 @@\n-                    int newSize = newFileCache.size();\n-                    int oldSize = fileCache.size();\n-\n-                    if (newSize > oldSize) {\n-                        \/\/see if interval is added\n-                        int start = oldSize;\n-                        int end = newSize;\n-                        for (int i = 0; i < oldSize; i++) {\n-                            if (!newFileCache.get(i).equals(fileCache.get(i))) {\n-                                start = i;\n-                                for (int j = i; j < newSize; j++) {\n-                                    if (newFileCache.get(j).equals(fileCache.get(i))) {\n-                                        end = j;\n-                                        break;\n+                    synchronized (fileCache) {\n+                        int newSize = newFileCache.size();\n+                        int oldSize = fileCache.size();\n+\n+                        if (newSize > oldSize) {\n+                            \/\/see if interval is added\n+                            int start = oldSize;\n+                            int end = newSize;\n+                            for (int i = 0; i < oldSize; i++) {\n+                                if (!newFileCache.get(i).equals(fileCache.get(i))) {\n+                                    start = i;\n+                                    for (int j = i; j < newSize; j++) {\n+                                        if (newFileCache.get(j).equals(fileCache.get(i))) {\n+                                            end = j;\n+                                            break;\n+                                        }\n@@ -360,0 +362,1 @@\n+                                    break;\n@@ -361,1 +364,0 @@\n-                                break;\n@@ -363,1 +365,0 @@\n-                        }\n@@ -365,3 +366,2 @@\n-                        if (start >= 0 && end > start) {\n-                            if (compareIterators(newFileCache.subList(end, newSize).iterator(),\n-                                    fileCache.subList(start, oldSize).iterator())) {\n+                            if (start >= 0 && end > start && newFileCache.subList(end, newSize)\n+                                    .equals(fileCache.subList(start, oldSize))) {\n@@ -371,1 +371,2 @@\n-                                return new DoChangeContents(newFileCache.subList(start, end), start, null, 0, fid);\n+                                return new DoChangeContents(newFileCache\n+                                        .subList(start, end), start, null, 0, fid);\n@@ -373,10 +374,10 @@\n-                        }\n-                    } else if (newSize < oldSize) {\n-                        \/\/see if interval is removed\n-                        int start = -1;\n-                        int end = -1;\n-                        for (int i = 0; i < newSize; i++) {\n-                            if (!newFileCache.get(i).equals(fileCache.get(i))) {\n-                                start = i;\n-                                end = i + oldSize - newSize;\n-                                break;\n+                        } else if (newSize < oldSize) {\n+                            \/\/see if interval is removed\n+                            int start = -1;\n+                            int end = -1;\n+                            for (int i = 0; i < newSize; i++) {\n+                                if (!newFileCache.get(i).equals(fileCache.get(i))) {\n+                                    start = i;\n+                                    end = i + oldSize - newSize;\n+                                    break;\n+                                }\n@@ -384,1 +385,0 @@\n-                        }\n@@ -386,3 +386,2 @@\n-                        if (start >= 0 && end > start) {\n-                            if (compareIterators(newFileCache.subList(start, newSize).iterator(),\n-                                    fileCache.subList(end, oldSize).iterator())) {\n+                            if (start >= 0 && end > start && fileCache.subList(end, oldSize)\n+                                    .equals(newFileCache.subList(start, newSize))) {\n@@ -392,1 +391,2 @@\n-                                return new DoChangeContents(null, 0, new Vector<>(fileCache.subList(start, end)), start, fid);\n+                                return new DoChangeContents(null, 0, new Vector<>(fileCache\n+                                        .subList(start, end)), start, fid);\n@@ -395,4 +395,5 @@\n-                    }\n-                    if (!fileCache.equals(newFileCache)) {\n-                        if (loadThread.isInterrupted()) {\n-                            cancelRunnables();\n+                        if (!fileCache.equals(newFileCache)) {\n+                            if (loadThread.isInterrupted()) {\n+                                cancelRunnables();\n+                            }\n+                            return new DoChangeContents(newFileCache, 0, fileCache, 0, fid);\n@@ -400,1 +401,1 @@\n-                        return new DoChangeContents(newFileCache, 0, fileCache, 0, fid);\n+                        return null;\n@@ -402,1 +403,0 @@\n-                    return null;\n@@ -416,12 +416,0 @@\n-\n-        private synchronized <T> boolean compareIterators(Iterator<T> iterator1, Iterator<T> iterator2) {\n-            while(iterator1.hasNext() && iterator2.hasNext()) {\n-                T element1 = iterator1.next();\n-                T element2 = iterator2.next();\n-\n-                if(!element1.equals(element2)) {\n-                    return false;\n-                }\n-            }\n-            return !iterator1.hasNext() && !iterator2.hasNext();\n-        }\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/basic\/BasicDirectoryModel.java","additions":41,"deletions":53,"binary":false,"changes":94,"status":"modified"}]}