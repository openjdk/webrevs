{"files":[{"patch":"@@ -28,0 +28,1 @@\n+import java.util.ArrayDeque;\n@@ -104,1 +105,0 @@\n-                int currentDepth = 0;\n@@ -107,9 +107,12 @@\n-                    \/\/ keep track of the dimension depth and replace the last dimension\n-                    \/\/ specifier with varargs, when the stack is fully unwound.\n-                    currentDepth++;\n-                    var componentType = type.getComponentType();\n-                    visit(componentType, linkInfo.forType(componentType));\n-                    currentDepth--;\n-                    if (utils.isAnnotated(type)) {\n-                        link.add(\" \");\n-                        link.add(getTypeAnnotationLinks(linkInfo));\n+                    \/\/ int @A [] @B [] has @A on int[][] and @B on int[],\n+                    \/\/ encounter order is @A @B so print in FIFO order\n+                    var deque = new ArrayDeque<ArrayType>(1);\n+                    while (true) {\n+                        deque.add(type);\n+                        var component = type.getComponentType();\n+                        if (component instanceof ArrayType arrayType) {\n+                            type = arrayType;\n+                        } else {\n+                            visit(component, linkInfo.forType(component));\n+                            break;\n+                        }\n@@ -117,5 +120,14 @@\n-                    \/\/ use vararg if required\n-                    if (linkInfo.isVarArg() && currentDepth == 0) {\n-                        link.add(\"...\");\n-                    } else {\n-                        link.add(\"[]\");\n+\n+                    while (!deque.isEmpty()) {\n+                        var currentType = deque.remove();\n+                        if (utils.isAnnotated(currentType)) {\n+                            link.add(\" \");\n+                            link.add(getTypeAnnotationLinks(linkInfo.forType(currentType)));\n+                        }\n+\n+                        \/\/ use vararg if required\n+                        if (linkInfo.isVarArg() && deque.isEmpty()) {\n+                            link.add(\"...\");\n+                        } else {\n+                            link.add(\"[]\");\n+                        }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlLinkFactory.java","additions":27,"deletions":15,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -136,2 +136,2 @@\n-                    <div class=\"member-signature\"><span class=\"return-type\">java.lang.String <a href\\\n-                    =\"FldB.html\" title=\"annotation interface in typeannos\">@FldB<\/a> [][]<\/span>&nbs\\\n+                    <div class=\"member-signature\"><span class=\"return-type\">java.lang.String[] <a hr\\\n+                    ef=\"FldB.html\" title=\"annotation interface in typeannos\">@FldB<\/a> []<\/span>&nbs\\\n@@ -143,4 +143,4 @@\n-                    tml\" title=\"annotation interface in typeannos\">@FldC<\/a> <a href=\"FldB.html\" tit\\\n-                    le=\"annotation interface in typeannos\">@FldB<\/a> [] <a href=\"FldC.html\" title=\"a\\\n-                    nnotation interface in typeannos\">@FldC<\/a> <a href=\"FldA.html\" title=\"annotatio\\\n-                    n interface in typeannos\">@FldA<\/a> []<\/span>&nbsp;<span class=\"element-name\">ar\\\n+                    tml\" title=\"annotation interface in typeannos\">@FldC<\/a> <a href=\"FldA.html\" tit\\\n+                    le=\"annotation interface in typeannos\">@FldA<\/a> [] <a href=\"FldC.html\" title=\"a\\\n+                    nnotation interface in typeannos\">@FldC<\/a> <a href=\"FldB.html\" title=\"annotatio\\\n+                    n interface in typeannos\">@FldB<\/a> []<\/span>&nbsp;<span class=\"element-name\">ar\\\n@@ -188,2 +188,2 @@\n-                    B.html\" title=\"annotation interface in typeannos\">@MRtnB<\/a> [] <a href=\"MRtnA.h\\\n-                    tml\" title=\"annotation interface in typeannos\">@MRtnA<\/a> []<\/span>&nbsp;<span c\\\n+                    A.html\" title=\"annotation interface in typeannos\">@MRtnA<\/a> [] <a href=\"MRtnB.h\\\n+                    tml\" title=\"annotation interface in typeannos\">@MRtnB<\/a> []<\/span>&nbsp;<span c\\\n@@ -277,2 +277,2 @@\n-                     <a href=\"ParamB.html\" title=\"annotation interface in typeannos\">@ParamB<\/a> [] \\\n-                    <a href=\"ParamA.html\" title=\"annotation interface in typeannos\">@ParamA<\/a> []&n\\\n+                     <a href=\"ParamA.html\" title=\"annotation interface in typeannos\">@ParamA<\/a> [] \\\n+                    <a href=\"ParamB.html\" title=\"annotation interface in typeannos\">@ParamB<\/a> []&n\\\n@@ -865,0 +865,40 @@\n+\n+        checkOutput(\"typeannos\/DeepArrays.html\", true,\n+                \"\"\"\n+                    <div class=\"member-signature\"><span class=\"return-type\"><a href=\"ArrA.html\" title=\"annotat\\\n+                    ion interface in typeannos\">@ArrA<\/a> java.lang.String <a href=\"ArrB.html\" title=\"annotati\\\n+                    on interface in typeannos\">@ArrB<\/a> [] <a href=\"ArrC.html\" title=\"annotation interface in \\\n+                    typeannos\">@ArrC<\/a> []<\/span>&nbsp;<span class=\"element-name\">array2<\/span>()<\/div>\"\"\",\n+\n+                \"\"\"\n+                    <div class=\"member-signature\"><span class=\"return-type\">java.lang.String <a href=\"ArrA.htm\\\n+                    l\" title=\"annotation interface in typeannos\">@ArrA<\/a> [] <a href=\"ArrB.html\" title=\"annot\\\n+                    ation interface in typeannos\">@ArrB<\/a> [] <a href=\"ArrC.html\" title=\"annotation interface \\\n+                    in typeannos\">@ArrC<\/a> [] <a href=\"ArrD.html\" title=\"annotation interface in typeannos\">@\\\n+                    ArrD<\/a> []<\/span>&nbsp;<span class=\"element-name\">array4<\/span>()<\/div>\"\"\",\n+\n+                \"\"\"\n+                    <div class=\"member-signature\"><span class=\"return-type\"><a href=\"ArrA.html\" title=\"annotat\\\n+                    ion interface in typeannos\">@ArrA<\/a> <a href=\"ArrParameterized.html\" title=\"class in type\\\n+                    annos\">ArrParameterized<\/a>&lt;<a href=\"ArrC.html\" title=\"annotation interface in typeanno\\\n+                    s\">@ArrC<\/a> java.lang.String <a href=\"ArrA.html\" title=\"annotation interface in typeannos\\\n+                    \">@ArrA<\/a> [] <a href=\"ArrB.html\" title=\"annotation interface in typeannos\">@ArrB<\/a> []&\\\n+                    gt; <a href=\"ArrC.html\" title=\"annotation interface in typeannos\">@ArrC<\/a> [] <a href=\"Ar\\\n+                    rD.html\" title=\"annotation interface in typeannos\">@ArrD<\/a> []<\/span>&nbsp;<span class=\"e\\\n+                    lement-name\">manyNested<\/span>()<\/div>\"\"\",\n+\n+                \"\"\"\n+                    <div class=\"member-signature\"><span class=\"return-type\">void<\/span>&nbsp;<span class=\"elem\\\n+                    ent-name\">varargs<\/span><wbr><span class=\"parameters\">(<a href=\"ArrA.html\" title=\"annotati\\\n+                    on interface in typeannos\">@ArrA<\/a> java.lang.String <a href=\"ArrB.html\" title=\"annotatio\\\n+                    n interface in typeannos\">@ArrB<\/a> [] <a href=\"ArrC.html\" title=\"annotation interface in \\\n+                    typeannos\">@ArrC<\/a> [] <a href=\"ArrD.html\" title=\"annotation interface in typeannos\">@Arr\\\n+                    D<\/a> ...&nbsp;arg)<\/span><\/div>\"\"\",\n+\n+                \"\"\"\n+                    <div class=\"member-signature\"><span class=\"return-type\">int <a href=\"ArrB.html\" title=\"ann\\\n+                    otation interface in typeannos\">@ArrB<\/a> [] <a href=\"ArrA.html\" title=\"annotation interfa\\\n+                    ce in typeannos\">@ArrA<\/a> []<\/span>&nbsp;<span class=\"element-name\">mixedStyles<\/span><wb\\\n+                    r><span class=\"parameters\">(int <a href=\"ArrB.html\" title=\"annotation interface in typeann\\\n+                    os\">@ArrB<\/a> [] <a href=\"ArrA.html\" title=\"annotation interface in typeannos\">@ArrA<\/a> [\\\n+                    ]&nbsp;arg)<\/span><\/div>\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testTypeAnnotations\/TestTypeAnnotations.java","additions":50,"deletions":10,"binary":false,"changes":60,"status":"modified"},{"patch":"@@ -0,0 +1,50 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package typeannos;\n+\n+import java.lang.annotation.Documented;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Target;\n+\n+public class DeepArrays {\n+    @ArrA String @ArrB [] @ArrC [] array2() { return null; }\n+    String @ArrA [] @ArrB [] @ArrC [] @ArrD [] array4() { return null; }\n+    @ArrA ArrParameterized<@ArrC String @ArrA [] @ArrB []> @ArrC [] @ArrD [] manyNested() { return null; }\n+    void varargs(@ArrA String @ArrB [] @ArrC [] @ArrD ... arg) {}\n+    int @ArrA [] mixedStyles(int @ArrB [] @ArrA [] arg) @ArrB [] { return null; } \/\/ JLS example 10.2-2\n+}\n+\n+class ArrParameterized<T> {}\n+\n+@Target(ElementType.TYPE_USE)\n+@Documented\n+@interface ArrA { }\n+@Target(ElementType.TYPE_USE)\n+@Documented\n+@interface ArrB { }\n+@Target(ElementType.TYPE_USE)\n+@Documented\n+@interface ArrC { }\n+@Target(ElementType.TYPE_USE)\n+@Documented\n+@interface ArrD { }\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testTypeAnnotations\/typeannos\/DeepArrays.java","additions":50,"deletions":0,"binary":false,"changes":50,"status":"added"}]}