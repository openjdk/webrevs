{"files":[{"patch":"@@ -644,1 +644,2 @@\n-                    builder.append(\"d\", escapeQuotes(description));\n+                    String normalizedDescription = description.replaceAll(\"\\\\s+\", \" \");\n+                    builder.append(\"d\", escapeQuotes(normalizedDescription));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/IndexItem.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,83 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8351332\n+ * @summary Line breaks in the description of `{@index}` tags may corrupt JSON search index\n+ * @library \/tools\/lib ..\/..\/lib\n+ * @modules jdk.javadoc\/jdk.javadoc.internal.tool\n+ * @build toolbox.ToolBox javadoc.tester.*\n+ * @run main TestIndexLineBreaks\n+ *\/\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+\n+import javadoc.tester.JavadocTester;\n+import toolbox.ToolBox;\n+\n+public class TestIndexLineBreaks extends JavadocTester {\n+\n+    public static void main(String... args) throws Exception {\n+        var tester = new TestIndexLineBreaks ();\n+        tester.runTests();\n+    }\n+\n+    ToolBox tb = new ToolBox();\n+\n+    @Test\n+    public void test() throws IOException {\n+        Path src = Path.of(\"src\");\n+        tb.writeJavaFiles(src,\n+                \"\"\"\n+                            package p;\n+                            public interface I {\n+                                \/**\n+                                 *\n+                                 * The {@index \"phrase1\n+                                 * phrase2\" description1\n+                                 * description2 }\n+                                 *\/\n+                                int a();\n+                            }\n+                        \"\"\");\n+\n+        javadoc(\"-d\",\n+                \"out\",\n+                \"-sourcepath\",\n+                src.toString(),\n+                \"p\");\n+\n+        checkExit(Exit.OK);\n+\n+        checkOutput(\"tag-search-index.js\", true,\n+                \"\"\"\n+                        {\"l\":\"phrase1 phrase2\",\"h\":\"p.I.a()\",\"d\":\"description1 description2 \",\"u\":\"p\/I.html#phrase1phrase2\"},{\"l\":\"Search Tags\",\"h\":\"\",\"k\":\"18\",\"u\":\"search-tags.html\"}\"\"\");\n+\n+        checkOutput(\"tag-search-index.js\", false,\n+                \"\"\"\n+                        {\"l\":\"phrase1 phrase2\",\"h\":\"p.I.a()\",\"d\":\"description1\n+                        description2 \",\"u\":\"p\/I.html#phrase1phrase2\"},{\"l\":\"Search Tags\",\"h\":\"\",\"k\":\"18\",\"u\":\"search-tags.html\"}\"\"\");\n+    }\n+}\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testIndexLineBreaks\/TestIndexLineBreaks.java","additions":83,"deletions":0,"binary":false,"changes":83,"status":"added"}]}