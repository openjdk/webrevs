{"files":[{"patch":"@@ -28,0 +28,2 @@\n+import java.lang.invoke.MethodHandles;\n+import java.lang.invoke.VarHandle;\n@@ -37,0 +39,1 @@\n+import jdk.internal.invoke.MhUtil;\n@@ -386,0 +389,2 @@\n+        private static final VarHandle RELEASED = MhUtil.findVarHandle(MethodHandles.lookup(),\n+                \"released\", boolean.class);\n@@ -390,0 +395,1 @@\n+        private volatile boolean released;\n@@ -408,1 +414,1 @@\n-            if (buf != dst)\n+            if (buf != dst && RELEASED.compareAndSet(this, false, true)) {\n@@ -410,0 +416,1 @@\n+            }\n@@ -572,0 +579,2 @@\n+        private static final VarHandle RELEASED = MhUtil.findVarHandle(MethodHandles.lookup(),\n+                \"released\", boolean.class);\n@@ -576,0 +585,1 @@\n+        private volatile boolean released;\n@@ -594,1 +604,1 @@\n-            if (buf != src)\n+            if (buf != src && RELEASED.compareAndSet(this, false, true)) {\n@@ -596,0 +606,1 @@\n+            }\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/ch\/WindowsAsynchronousFileChannelImpl.java","additions":13,"deletions":2,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+import java.lang.invoke.MethodHandles;\n+import java.lang.invoke.VarHandle;\n@@ -34,0 +36,1 @@\n+import jdk.internal.invoke.MhUtil;\n@@ -370,0 +373,2 @@\n+        private static final VarHandle RELEASED = MhUtil.findVarHandle(MethodHandles.lookup(),\n+                \"released\", boolean.class);\n@@ -374,0 +379,1 @@\n+        private volatile boolean released;\n@@ -464,3 +470,5 @@\n-            for (int i=0; i<numBufs; i++) {\n-                if (!(bufs[i] instanceof DirectBuffer)) {\n-                    Util.releaseTemporaryDirectBuffer(shadow[i]);\n+            if (RELEASED.compareAndSet(this, false, true)) {\n+                for (int i = 0; i < numBufs; i++) {\n+                    if (!(bufs[i] instanceof DirectBuffer)) {\n+                        Util.releaseTemporaryDirectBuffer(shadow[i]);\n+                    }\n@@ -468,0 +476,1 @@\n+                IOUtil.releaseScopes(scopeHandleReleasers);\n@@ -469,1 +478,0 @@\n-            IOUtil.releaseScopes(scopeHandleReleasers);\n@@ -644,0 +652,2 @@\n+        private static final VarHandle RELEASED = MhUtil.findVarHandle(MethodHandles.lookup(),\n+                \"released\", boolean.class);\n@@ -648,0 +658,1 @@\n+        private volatile boolean released;\n@@ -731,3 +742,5 @@\n-            for (int i=0; i<numBufs; i++) {\n-                if (!(bufs[i] instanceof DirectBuffer)) {\n-                    Util.releaseTemporaryDirectBuffer(shadow[i]);\n+            if (RELEASED.compareAndSet(this, false, true)) {\n+                for (int i = 0; i < numBufs; i++) {\n+                    if (!(bufs[i] instanceof DirectBuffer)) {\n+                        Util.releaseTemporaryDirectBuffer(shadow[i]);\n+                    }\n@@ -735,0 +748,1 @@\n+                IOUtil.releaseScopes(scopeHandleReleasers);\n@@ -736,1 +750,0 @@\n-            IOUtil.releaseScopes(scopeHandleReleasers);\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/ch\/WindowsAsynchronousSocketChannelImpl.java","additions":21,"deletions":8,"binary":false,"changes":29,"status":"modified"}]}