{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,0 @@\n-import java.security.PrivilegedActionException;\n@@ -193,1 +192,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -197,2 +196,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -211,1 +209,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -240,1 +242,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -244,2 +246,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -260,1 +261,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -303,1 +308,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -307,2 +312,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -321,1 +325,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -369,1 +377,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -373,2 +381,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -389,1 +396,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -406,1 +417,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -410,2 +421,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -418,1 +428,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -439,1 +453,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -443,2 +457,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -449,1 +462,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -477,1 +494,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -481,2 +498,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -485,1 +501,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -513,1 +533,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -517,2 +537,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -521,1 +540,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -531,1 +554,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -535,2 +558,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -539,1 +561,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -553,1 +579,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -557,2 +583,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -561,1 +586,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -583,1 +612,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -587,2 +616,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -599,1 +627,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -620,1 +652,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -624,2 +656,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -632,1 +663,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -668,1 +703,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -672,2 +707,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -686,1 +720,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -721,1 +759,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -725,2 +763,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -733,1 +770,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -777,1 +818,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -781,2 +822,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -791,1 +831,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -805,1 +849,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -809,2 +853,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -813,1 +856,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -826,1 +873,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -830,2 +877,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -834,1 +880,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -856,1 +906,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -860,2 +910,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -870,1 +919,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -891,1 +944,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -895,2 +948,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -901,1 +953,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -963,1 +1019,1 @@\n-                    doPrivilegedOperation(ADD_NOTIFICATION_LISTENERS,\n+                    doOperation(ADD_NOTIFICATION_LISTENERS,\n@@ -981,4 +1037,0 @@\n-            if (e instanceof PrivilegedActionException) {\n-                e = extractException(e);\n-            }\n-\n@@ -993,0 +1045,4 @@\n+            } else if (e instanceof SecurityException) {\n+                throw (SecurityException) e;\n+            } else if (e instanceof RuntimeException) {\n+                throw (RuntimeException) e;\n@@ -994,1 +1050,1 @@\n-                throw newIOException(\"Got unexpected server exception: \"+e,e);\n+                throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1045,1 +1101,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1049,2 +1105,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1055,1 +1110,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1085,1 +1144,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1089,2 +1148,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1097,1 +1155,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1122,1 +1184,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1126,2 +1188,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1134,1 +1195,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1187,1 +1252,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1191,2 +1256,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1199,1 +1263,5 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof SecurityException)\n+                throw (SecurityException) e;\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1296,4 +1364,4 @@\n-    private Object doPrivilegedOperation(final int operation,\n-                                         final Object[] params,\n-                                         final Subject delegationSubject)\n-        throws PrivilegedActionException, IOException {\n+    private Object doOperation(final int operation,\n+                               final Object[] params,\n+                               final Subject delegationSubject)\n+        throws Exception {\n@@ -1309,9 +1377,1 @@\n-                try {\n-                    return doOperation(operation, params);\n-                } catch (Exception e) {\n-                    if (e instanceof RuntimeException) {\n-                        throw (RuntimeException) e;\n-                    } else {\n-                        throw new PrivilegedActionException(e);\n-                    }\n-                }\n+                return doOperationInner(operation, params);\n@@ -1320,1 +1380,1 @@\n-                    return Subject.callAs(subject, () -> doOperation(operation, params));\n+                    return Subject.callAs(subject, () -> doOperationInner(operation, params));\n@@ -1323,6 +1383,2 @@\n-                    if (thr instanceof SecurityException se) {\n-                        throw se;\n-                    } else if (thr instanceof IOException ioe) {\n-                        throw ioe;\n-                    } else if (thr instanceof Exception e1) {\n-                        throw new PrivilegedActionException(e1);\n+                    if (thr instanceof Exception e) {\n+                        throw e;\n@@ -1341,1 +1397,1 @@\n-    private Object doOperation(int operation, Object[] params)\n+    private Object doOperationInner(int operation, Object[] params)\n@@ -1344,0 +1400,3 @@\n+        \/\/ Renamed this method to ensure nothing accidentally calls it.\n+        \/\/ All calls are to the 3-argument doOperation(), except those from that method.\n+\n@@ -1542,20 +1601,0 @@\n-    \/**\n-     * Construct a new IOException with a nested exception.\n-     * The nested exception is set only if JDK {@literal >= 1.4}\n-     *\/\n-    private static IOException newIOException(String message,\n-                                              Throwable cause) {\n-        return new IOException(message, cause);\n-    }\n-\n-    \/**\n-     * Iterate until we extract the real exception\n-     * from a stack of PrivilegedActionExceptions.\n-     *\/\n-    private static Exception extractException(Exception e) {\n-        while (e instanceof PrivilegedActionException) {\n-            e = ((PrivilegedActionException)e).getException();\n-        }\n-        return e;\n-    }\n-\n","filename":"src\/java.management.rmi\/share\/classes\/javax\/management\/remote\/rmi\/RMIConnectionImpl.java","additions":180,"deletions":141,"binary":false,"changes":321,"status":"modified"}]}