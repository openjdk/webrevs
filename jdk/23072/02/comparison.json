{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,0 @@\n-import java.security.PrivilegedActionException;\n@@ -193,1 +192,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -197,2 +196,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -211,1 +209,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -240,1 +240,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -244,2 +244,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -260,1 +259,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -303,1 +304,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -307,2 +308,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -321,1 +321,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -369,1 +371,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -373,2 +375,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -389,1 +390,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -406,1 +409,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -410,2 +413,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -418,1 +420,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -439,1 +443,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -443,2 +447,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -449,1 +452,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -477,1 +482,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -481,2 +486,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -485,1 +489,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -513,1 +519,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -517,2 +523,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -521,1 +526,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -531,1 +538,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -535,2 +542,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -539,1 +545,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -553,1 +561,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -557,2 +565,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -561,1 +568,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -583,1 +592,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -587,2 +596,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -599,1 +607,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -620,1 +630,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -624,2 +634,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -632,1 +641,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -668,1 +679,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -672,2 +683,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -686,1 +696,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -721,1 +733,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -725,2 +737,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -733,1 +744,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -777,1 +790,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -781,2 +794,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -791,1 +803,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -805,1 +819,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -809,2 +823,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -813,1 +826,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -826,1 +841,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -830,2 +845,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -834,1 +848,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -856,1 +872,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -860,2 +876,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -870,1 +885,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -891,1 +908,1 @@\n-                doPrivilegedOperation(\n+                doOperation(\n@@ -895,2 +912,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -901,1 +917,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -963,1 +981,1 @@\n-                    doPrivilegedOperation(ADD_NOTIFICATION_LISTENERS,\n+                    doOperation(ADD_NOTIFICATION_LISTENERS,\n@@ -981,4 +999,0 @@\n-            if (e instanceof PrivilegedActionException) {\n-                e = extractException(e);\n-            }\n-\n@@ -994,1 +1008,1 @@\n-                throw newIOException(\"Got unexpected server exception: \"+e,e);\n+                throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1045,1 +1059,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1049,2 +1063,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1055,1 +1068,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1085,1 +1100,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1089,2 +1104,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1097,1 +1111,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1122,1 +1138,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1126,2 +1142,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1134,1 +1149,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1187,1 +1204,1 @@\n-            doPrivilegedOperation(\n+            doOperation(\n@@ -1191,2 +1208,1 @@\n-        } catch (PrivilegedActionException pe) {\n-            Exception e = extractException(pe);\n+        } catch (Exception e) {\n@@ -1199,1 +1215,3 @@\n-            throw newIOException(\"Got unexpected server exception: \" + e, e);\n+            if (e instanceof RuntimeException)\n+                throw (RuntimeException) e;\n+            throw new IOException(\"Got unexpected server exception: \" + e, e);\n@@ -1296,4 +1314,4 @@\n-    private Object doPrivilegedOperation(final int operation,\n-                                         final Object[] params,\n-                                         final Subject delegationSubject)\n-        throws PrivilegedActionException, IOException {\n+    private Object doOperation(final int operation,\n+                               final Object[] params,\n+                               final Subject delegationSubject)\n+        throws Exception {\n@@ -1309,9 +1327,1 @@\n-                try {\n-                    return doOperation(operation, params);\n-                } catch (Exception e) {\n-                    if (e instanceof RuntimeException) {\n-                        throw (RuntimeException) e;\n-                    } else {\n-                        throw new PrivilegedActionException(e);\n-                    }\n-                }\n+                return doOperationInner(operation, params);\n@@ -1320,1 +1330,1 @@\n-                    return Subject.callAs(subject, () -> doOperation(operation, params));\n+                    return Subject.callAs(subject, () -> doOperationInner(operation, params));\n@@ -1323,6 +1333,2 @@\n-                    if (thr instanceof SecurityException se) {\n-                        throw se;\n-                    } else if (thr instanceof IOException ioe) {\n-                        throw ioe;\n-                    } else if (thr instanceof Exception e1) {\n-                        throw new PrivilegedActionException(e1);\n+                    if (thr instanceof Exception e) {\n+                        throw e;\n@@ -1341,1 +1347,1 @@\n-    private Object doOperation(int operation, Object[] params)\n+    private Object doOperationInner(int operation, Object[] params)\n@@ -1344,0 +1350,3 @@\n+        \/\/ Renamed this method to ensure nothing accidentally calls it.\n+        \/\/ All calls are to the 3-argument doOperation(), except those from that method.\n+\n@@ -1542,20 +1551,0 @@\n-    \/**\n-     * Construct a new IOException with a nested exception.\n-     * The nested exception is set only if JDK {@literal >= 1.4}\n-     *\/\n-    private static IOException newIOException(String message,\n-                                              Throwable cause) {\n-        return new IOException(message, cause);\n-    }\n-\n-    \/**\n-     * Iterate until we extract the real exception\n-     * from a stack of PrivilegedActionExceptions.\n-     *\/\n-    private static Exception extractException(Exception e) {\n-        while (e instanceof PrivilegedActionException) {\n-            e = ((PrivilegedActionException)e).getException();\n-        }\n-        return e;\n-    }\n-\n","filename":"src\/java.management.rmi\/share\/classes\/javax\/management\/remote\/rmi\/RMIConnectionImpl.java","additions":130,"deletions":141,"binary":false,"changes":271,"status":"modified"}]}