{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -43,2 +43,2 @@\n-    _shared_small_page(nullptr),\n-    _shared_medium_page(nullptr),\n+    _shared_small_page(),\n+    _shared_medium_page(),\n@@ -47,2 +47,2 @@\n-ZPage** ZObjectAllocator::PerAge::shared_small_page_addr() {\n-  return _use_per_cpu_shared_small_pages ? _shared_small_page.addr() : _shared_small_page.addr(0);\n+Atomic<ZPage*>& ZObjectAllocator::PerAge::shared_small_page() {\n+  return _use_per_cpu_shared_small_pages ? _shared_small_page.get() : _shared_small_page.get(0);\n@@ -51,2 +51,2 @@\n-ZPage* const* ZObjectAllocator::PerAge::shared_small_page_addr() const {\n-  return _use_per_cpu_shared_small_pages ? _shared_small_page.addr() : _shared_small_page.addr(0);\n+const Atomic<ZPage*>& ZObjectAllocator::PerAge::shared_small_page() const {\n+  return _use_per_cpu_shared_small_pages ? _shared_small_page.get() : _shared_small_page.get(0);\n@@ -63,1 +63,1 @@\n-zaddress ZObjectAllocator::PerAge::alloc_object_in_shared_page(ZPage** shared_page,\n+zaddress ZObjectAllocator::PerAge::alloc_object_in_shared_page(Atomic<ZPage*>& shared_page,\n@@ -69,1 +69,1 @@\n-  ZPage* page = AtomicAccess::load_acquire(shared_page);\n+  ZPage* page = shared_page.load_acquire();\n@@ -84,1 +84,1 @@\n-      ZPage* const prev_page = AtomicAccess::cmpxchg(shared_page, page, new_page);\n+      ZPage* const prev_page = shared_page.compare_exchange(page, new_page);\n@@ -115,2 +115,2 @@\n-  ZPage** shared_medium_page = _shared_medium_page.addr();\n-  ZPage* page = AtomicAccess::load_acquire(shared_medium_page);\n+  Atomic<ZPage*>& shared_medium_page = _shared_medium_page.get();\n+  ZPage* page = shared_medium_page.load_acquire();\n@@ -180,1 +180,1 @@\n-  return alloc_object_in_shared_page(shared_small_page_addr(), ZPageType::small, ZPageSizeSmall, size, flags);\n+  return alloc_object_in_shared_page(shared_small_page(), ZPageType::small, ZPageSizeSmall, size, flags);\n@@ -200,2 +200,5 @@\n-  _shared_medium_page.set(nullptr);\n-  _shared_small_page.set_all(nullptr);\n+  _shared_medium_page.get().store_relaxed(nullptr);\n+  ZValueIterator iter(&_shared_small_page);\n+  for (Atomic<ZPage*>* shared_small_page; iter.next(&shared_small_page);) {\n+    shared_small_page->store_relaxed(nullptr);\n+  }\n@@ -229,2 +232,2 @@\n-  ZPage* const* const shared_addr = allocator(age)->shared_small_page_addr();\n-  const ZPage* const page = AtomicAccess::load_acquire(shared_addr);\n+  const Atomic<ZPage*>& shared_addr = allocator(age)->shared_small_page();\n+  const ZPage* const page = shared_addr.load_acquire();\n","filename":"src\/hotspot\/share\/gc\/z\/zObjectAllocator.cpp","additions":21,"deletions":18,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -39,5 +40,5 @@\n-    const ZPageAge     _age;\n-    const bool         _use_per_cpu_shared_small_pages;\n-    ZPerCPU<ZPage*>    _shared_small_page;\n-    ZContended<ZPage*> _shared_medium_page;\n-    ZLock              _medium_page_alloc_lock;\n+    const ZPageAge             _age;\n+    const bool                 _use_per_cpu_shared_small_pages;\n+    ZPerCPU<Atomic<ZPage*>>    _shared_small_page;\n+    ZContended<Atomic<ZPage*>> _shared_medium_page;\n+    ZLock                      _medium_page_alloc_lock;\n@@ -48,2 +49,2 @@\n-    ZPage** shared_small_page_addr();\n-    ZPage* const* shared_small_page_addr() const;\n+    Atomic<ZPage*>& shared_small_page();\n+    const Atomic<ZPage*>& shared_small_page() const;\n@@ -56,1 +57,1 @@\n-    zaddress alloc_object_in_shared_page(ZPage** shared_page,\n+    zaddress alloc_object_in_shared_page(Atomic<ZPage*>& shared_page,\n","filename":"src\/hotspot\/share\/gc\/z\/zObjectAllocator.hpp","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"}]}