{"files":[{"patch":"@@ -25,0 +25,1 @@\n+import compiler.lib.generators.Generators;\n@@ -27,3 +28,0 @@\n-import jdk.test.lib.Utils;\n-\n-import java.util.Random;\n@@ -54,2 +52,2 @@\n-    @Run(test = {\"testInt1\", \"testInt2\", \"testInt3\", \"testInt4\",\n-                 \"testLong1\", \"testLong2\", \"testLong3\", \"testLong4\", \"testLong5\"})\n+    @Run(test = {\"testIntControl\", \"testIntLT\", \"testIntLE\", \"testIntGT\", \"testIntGE\", \"testIntEQ\", \"testIntNE\",\n+                 \"testLongControl\", \"testLongLT\", \"testLongLE\", \"testLongGT\", \"testLongGE\", \"testLongEQ\", \"testLongNE\"})\n@@ -57,26 +55,52 @@\n-        Random r = Utils.getRandomInstance();\n-        long x = r.nextLong();\n-        long y = r.nextLong();\n-\n-        Asserts.assertEQ(0, testInt1(false, false));\n-        Asserts.assertEQ(0, testInt1(false, true));\n-        Asserts.assertEQ(0, testInt1(true, false));\n-        Asserts.assertEQ(0, testInt1(true, true));\n-        Asserts.assertEQ(0, testInt2(false, false));\n-        Asserts.assertEQ(0, testInt2(false, true));\n-        Asserts.assertEQ(0, testInt2(true, false));\n-        Asserts.assertEQ(0, testInt2(true, true));\n-        Asserts.assertEQ(0, testInt3((int) x, (int) y));\n-        Asserts.assertEQ(0, testInt4());\n-        Asserts.assertEQ(0, testLong1(false, false));\n-        Asserts.assertEQ(0, testLong1(false, true));\n-        Asserts.assertEQ(0, testLong1(true, false));\n-        Asserts.assertEQ(0, testLong1(true, true));\n-        Asserts.assertEQ(0, testLong2(false, false));\n-        Asserts.assertEQ(0, testLong2(false, true));\n-        Asserts.assertEQ(0, testLong2(true, false));\n-        Asserts.assertEQ(0, testLong2(true, true));\n-        Asserts.assertEQ(0, testLong3(x, y));\n-        Asserts.assertEQ(0, testLong4());\n-        Asserts.assertEQ(0, testLong5((int) x, false));\n-        Asserts.assertEQ(0, testLong5((int) x, true));\n+        var stream = Generators.G.longs();\n+        long x = stream.next();\n+        long y = stream.next();\n+\n+        Asserts.assertEQ(0, testIntControl(false, false));\n+        Asserts.assertEQ(0, testIntControl(false, true));\n+        Asserts.assertEQ(0, testIntControl(true, false));\n+        Asserts.assertEQ(1, testIntControl(true, true));\n+        Asserts.assertEQ(0, testIntLT((int) x));\n+        Asserts.assertEQ(0, testIntLE(false, false));\n+        Asserts.assertEQ(0, testIntLE(false, true));\n+        Asserts.assertEQ(0, testIntLE(true, false));\n+        Asserts.assertEQ(0, testIntLE(true, true));\n+        Asserts.assertEQ(0, testIntGT(false, false));\n+        Asserts.assertEQ(0, testIntGT(false, true));\n+        Asserts.assertEQ(0, testIntGT(true, false));\n+        Asserts.assertEQ(0, testIntGT(true, true));\n+        Asserts.assertEQ(0, testIntGE((int) x, (int) y));\n+        Asserts.assertEQ(0, testIntEQ());\n+        Asserts.assertEQ(0, testIntNE(false, false));\n+        Asserts.assertEQ(0, testIntNE(false, true));\n+        Asserts.assertEQ(0, testIntNE(true, false));\n+        Asserts.assertEQ(0, testIntNE(true, true));\n+\n+        Asserts.assertEQ(0, testLongControl(false, false));\n+        Asserts.assertEQ(0, testLongControl(false, true));\n+        Asserts.assertEQ(0, testLongControl(true, false));\n+        Asserts.assertEQ(1, testLongControl(true, true));\n+        Asserts.assertEQ(0, testLongLT((int) x, false));\n+        Asserts.assertEQ(0, testLongLT((int) x, true));\n+        Asserts.assertEQ(0, testLongLE(false, false));\n+        Asserts.assertEQ(0, testLongLE(false, true));\n+        Asserts.assertEQ(0, testLongLE(true, false));\n+        Asserts.assertEQ(0, testLongLE(true, true));\n+        Asserts.assertEQ(0, testLongGT(false, false));\n+        Asserts.assertEQ(0, testLongGT(false, true));\n+        Asserts.assertEQ(0, testLongGT(true, false));\n+        Asserts.assertEQ(0, testLongGT(true, true));\n+        Asserts.assertEQ(0, testLongGE((int) x, (int) y));\n+        Asserts.assertEQ(0, testLongEQ());\n+        Asserts.assertEQ(0, testLongNE(false, false));\n+        Asserts.assertEQ(0, testLongNE(false, true));\n+        Asserts.assertEQ(0, testLongNE(true, false));\n+        Asserts.assertEQ(0, testLongNE(true, true));\n+    }\n+\n+    @Test\n+    @IR(applyIfPlatformOr = {\"x64\", \"true\", \"aarch64\", \"true\"}, counts = {IRNode.CMP_U, \"1\"})\n+    int testIntControl(boolean b1, boolean b2) {\n+        int v1 = b1 ? 1 : -1;\n+        int v2 = b2 ? 1 : 0;\n+        return Integer.compareUnsigned(v1, v2) > 0 ? 0 : one();\n@@ -87,4 +111,4 @@\n-    int testInt1(boolean b1, boolean b2) {\n-        int v1 = b1 ? Integer.MIN_VALUE : Integer.MAX_VALUE;\n-        int v2 = b2 ? 0 : 2;\n-        return Integer.compareUnsigned(v1, v2) <= 0 ? one() : 0;\n+    int testIntLT(int x) {\n+        int v1 = x & Integer.MAX_VALUE; \/\/ Unset the highest bit, make v1 non-negative\n+        int v2 = Integer.MIN_VALUE;\n+        return Integer.compareUnsigned(v1, v2) < 0 ? 0 : one();\n@@ -95,1 +119,1 @@\n-    int testInt2(boolean b1, boolean b2) {\n+    int testIntLE(boolean b1, boolean b2) {\n@@ -98,1 +122,9 @@\n-        return Integer.compareUnsigned(v1, v2) > 0 ? one() : 0;\n+        return Integer.compareUnsigned(v1, v2) <= 0 ? 0 : one();\n+    }\n+\n+    @Test\n+    @IR(applyIfPlatformOr = {\"x64\", \"true\", \"aarch64\", \"true\"}, failOn = {IRNode.CMP_U, IRNode.CALL})\n+    int testIntGT(boolean b1, boolean b2) {\n+        int v1 = b1 ? Integer.MIN_VALUE : Integer.MAX_VALUE;\n+        int v2 = b2 ? 0 : 2;\n+        return Integer.compareUnsigned(v1, v2) > 0 ? 0 : one();\n@@ -103,1 +135,1 @@\n-    int testInt3(int x, int y) {\n+    int testIntGE(int x, int y) {\n@@ -106,1 +138,7 @@\n-        return Integer.compareUnsigned(v1, v2) <= 0 ? one() : 0;\n+        return Integer.compareUnsigned(v1, v2) >= 0 ? 0 : one();\n+    }\n+\n+    @Test\n+    @IR(applyIfPlatformOr = {\"x64\", \"true\", \"aarch64\", \"true\"}, failOn = {IRNode.CMP_U, IRNode.CALL})\n+    int testIntEQ() {\n+        return Integer.compareUnsigned(oneInline(), 1) == 0 ? 0 : one();\n@@ -111,2 +149,12 @@\n-    int testInt4() {\n-        return Integer.compareUnsigned(oneInline(), 1) != 0 ? one() : 0;\n+    int testIntNE(boolean b1, boolean b2) {\n+        int v1 = b1 ? 1 : -1;\n+        int v2 = b2 ? 0 : 2;\n+        return Integer.compareUnsigned(v1, v2) != 0 ? 0 : one();\n+    }\n+\n+    @Test\n+    @IR(applyIfPlatformOr = {\"x64\", \"true\", \"aarch64\", \"true\"}, counts = {IRNode.CMP_UL, \"1\"})\n+    int testLongControl(boolean b1, boolean b2) {\n+        long v1 = b1 ? 1 : -1;\n+        long v2 = b2 ? 1 : 0;\n+        return Long.compareUnsigned(v1, v2) > 0 ? 0 : one();\n@@ -115,0 +163,1 @@\n+\n@@ -117,4 +166,4 @@\n-    int testLong1(boolean b1, boolean b2) {\n-        long v1 = b1 ? Long.MIN_VALUE : Long.MAX_VALUE;\n-        long v2 = b2 ? 0 : 2;\n-        return Long.compareUnsigned(v1, v2) <= 0 ? one() : 0;\n+    int testLongLT(int x, boolean b2) {\n+        long v1 = Integer.toUnsignedLong(x);\n+        long v2 = Integer.MIN_VALUE;\n+        return Long.compareUnsigned(v1, v2) < 0 ? 0 : one();\n@@ -125,1 +174,1 @@\n-    int testLong2(boolean b1, boolean b2) {\n+    int testLongLE(boolean b1, boolean b2) {\n@@ -128,1 +177,1 @@\n-        return Long.compareUnsigned(v1, v2) > 0 ? one() : 0;\n+        return Long.compareUnsigned(v1, v2) <= 0 ? 0 : one();\n@@ -133,1 +182,9 @@\n-    int testLong3(long x, long y) {\n+    int testLongGT(boolean b1, boolean b2) {\n+        long v1 = b1 ? Long.MIN_VALUE : Long.MAX_VALUE;\n+        long v2 = b2 ? 0 : 2;\n+        return Long.compareUnsigned(v1, v2) > 0 ? 0 : one();\n+    }\n+\n+    @Test\n+    @IR(applyIfPlatformOr = {\"x64\", \"true\", \"aarch64\", \"true\"}, failOn = {IRNode.CMP_UL, IRNode.CALL})\n+    int testLongGE(int x, int y) {\n@@ -136,1 +193,1 @@\n-        return Long.compareUnsigned(v1, v2) <= 0 ? one() : 0;\n+        return Long.compareUnsigned(v1, v2) >= 0 ? 0 : one();\n@@ -141,2 +198,2 @@\n-    int testLong4() {\n-        return Long.compareUnsigned(oneInline(), 1L) != 0 ? one() : 0;\n+    int testLongEQ() {\n+        return Long.compareUnsigned(oneInline(), 1L) == 0 ? 0 : one();\n@@ -147,4 +204,4 @@\n-    int testLong5(int x, boolean b2) {\n-        long v1 = Integer.toUnsignedLong(x);\n-        long v2 = b2 ? Integer.toUnsignedLong(-1) : -1L;\n-        return Long.compareUnsigned(v1, v2) > 0 ? one() : 0;\n+    int testLongNE(boolean b1, boolean b2) {\n+        long v1 = b1 ? 1 : -1;\n+        long v2 = b2 ? 0 : 2;\n+        return Long.compareUnsigned(v1, v2) != 0 ? 0 : one();\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/gvn\/CmpUNodeValueTests.java","additions":112,"deletions":55,"binary":false,"changes":167,"status":"modified"}]}