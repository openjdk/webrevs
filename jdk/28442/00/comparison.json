{"files":[{"patch":"@@ -9203,0 +9203,4 @@\n+    Label L32, L_exit;\n+    \/\/ Check if size > 32B\n+    cmpq(length, 32 >> shift);\n+    jcc(Assembler::lessEqual, L32);\n@@ -9206,0 +9210,5 @@\n+    jmp(L_exit);\n+    \/\/ Size <= 32B\n+    bind(L32);\n+    fill32_masked(shift, dst, disp, xmm, mask, length, temp);\n+    bind(L_exit);\n@@ -9245,0 +9254,78 @@\n+void MacroAssembler::fill32_unmasked(uint shift, Register dst, int disp, XMMRegister xmm,\n+                                          Register length,\n+                                          Register temp) {\n+  \/\/ This stub assumes that fill size <= 32 bytes (i.e. length <= (32 >> shift))\n+  assert(MaxVectorSize >= 32, \"vector length should be >= 32\");\n+  Label L16, L8, L4, L2, L1, L_done;\n+  \/\/ Fastpath for fill size <= 4 bytes\n+  cmpq(length, 4 >> shift);\n+  jcc(Assembler::lessEqual, L4);\n+\n+  \/\/ 32-byte store\n+  cmpq(length, 32 >> shift);\n+  jcc(Assembler::less, L16);\n+  vmovdqu(Address(dst, disp), xmm);\n+  addq(dst, 32);\n+  subq(length, 32 >> shift);\n+\n+  \/\/ 16-byte store\n+  bind(L16);\n+  cmpq(length, 16 >> shift);\n+  jcc(Assembler::less, L8);\n+  movdqu(Address(dst, disp), xmm);\n+  addq(dst, 16);\n+  subq(length, 16 >> shift);\n+\n+  \/\/ 8-byte store\n+  bind(L8);\n+  cmpq(length, 8 >> shift);\n+  jcc(Assembler::less, L4);\n+  movq(Address(dst, disp), xmm);\n+  addq(dst, 8);\n+  subq(length, 8 >> shift);\n+\n+  \/\/ 4-byte store\n+  bind(L4);\n+  \/\/ temp holds low 8 bytes of xmm for 4\/2\/1B stores\n+  movq(temp, xmm);\n+  cmpq(length, 4 >> shift);\n+  jcc(Assembler::less, L2);\n+  movl(Address(dst, disp), temp);\n+  addq(dst, 4);\n+  subq(length, 4 >> shift);\n+\n+  \/\/ 2-byte store\n+  bind(L2);\n+  cmpq(length, 2 >> shift);\n+  jcc(Assembler::less, L1);\n+  movw(Address(dst, disp), temp);\n+  addq(dst, 2);\n+  subq(length, 2 >> shift);\n+\n+  \/\/ 1-byte store\n+  bind(L1);\n+  testq(length, length);\n+  jcc(Assembler::zero, L_done);\n+  movb(Address(dst, disp), temp);\n+\n+  bind(L_done);\n+}\n+\n+void MacroAssembler::fill64_unmasked(uint shift, Register dst, int disp,\n+                                     XMMRegister xmm, Register length,\n+                                     Register temp) {\n+  assert(MaxVectorSize >= 32, \"vector length should be >= 32\");\n+  Label L32, L_exit;\n+  \/\/ Check if size > 32B\n+  cmpq(length, 32 >> shift);\n+  jcc(Assembler::lessEqual, L32);\n+  fill32(dst, disp, xmm);\n+  subq(length, 32 >> shift);\n+  fill32_unmasked(shift, dst, disp + 32, xmm, length, temp);\n+  jmp(L_exit);\n+  \/\/ Size <= 32B\n+  bind(L32);\n+  fill32_unmasked(shift, dst, disp, xmm, length, temp);\n+  bind(L_exit);\n+}\n+\n@@ -9277,5 +9364,0 @@\n-    if (MaxVectorSize == 64) {\n-      cmpq(count, avx3threshold >> shift);\n-      jcc(Assembler::greater, L_fill_zmm_sequence);\n-    }\n-\n@@ -9287,2 +9369,2 @@\n-    jccb(Assembler::greater, L_fill_64_bytes);\n-    fill32_masked(shift, to, 0, xtmp, k2, count, rtmp);\n+    jcc(Assembler::greater, L_fill_64_bytes);\n+    fill32_unmasked(shift, to, 0, xtmp, count, rtmp);\n@@ -9292,0 +9374,6 @@\n+\n+    if (MaxVectorSize == 64) {\n+      cmpq(count, avx3threshold >> shift);\n+      jcc(Assembler::greater, L_fill_zmm_sequence);\n+    }\n+\n@@ -9293,2 +9381,4 @@\n-    jccb(Assembler::greater, L_fill_96_bytes);\n-    fill64_masked(shift, to, 0, xtmp, k2, count, rtmp);\n+    jcc(Assembler::greater, L_fill_96_bytes);\n+    fill32(to, 0, xtmp);\n+    subq(count, 32 >> shift);\n+    fill32_unmasked(shift, to, 32, xtmp, count, rtmp);\n@@ -9299,1 +9389,1 @@\n-    jccb(Assembler::greater, L_fill_128_bytes);\n+    jcc(Assembler::greater, L_fill_128_bytes);\n@@ -9302,1 +9392,1 @@\n-    fill32_masked(shift, to, 64, xtmp, k2, count, rtmp);\n+    fill32_unmasked(shift, to, 64, xtmp, count, rtmp);\n@@ -9307,1 +9397,1 @@\n-    jccb(Assembler::greater, L_fill_128_bytes_loop_pre_header);\n+    jcc(Assembler::greater, L_fill_128_bytes_loop_pre_header);\n@@ -9311,1 +9401,1 @@\n-    fill32_masked(shift, to, 96, xtmp, k2, count, rtmp);\n+    fill32_unmasked(shift, to, 96, xtmp, count, rtmp);\n@@ -9363,2 +9453,2 @@\n-    jccb(Assembler::greater, L_fill_128_bytes_zmm);\n-    fill64_masked(shift, to, 0, xtmp, k2, count, rtmp, true);\n+    jcc(Assembler::greater, L_fill_128_bytes_zmm);\n+    fill64_unmasked(shift, to, 0, xtmp, count, rtmp);\n@@ -9369,1 +9459,1 @@\n-    jccb(Assembler::greater, L_fill_192_bytes_zmm);\n+    jcc(Assembler::greater, L_fill_192_bytes_zmm);\n@@ -9372,1 +9462,1 @@\n-    fill64_masked(shift, to, 64, xtmp, k2, count, rtmp, true);\n+    fill64_unmasked(shift, to, 64, xtmp, count, rtmp);\n@@ -9377,1 +9467,1 @@\n-    jccb(Assembler::greater, L_fill_192_bytes_loop_pre_header_zmm);\n+    jcc(Assembler::greater, L_fill_192_bytes_loop_pre_header_zmm);\n@@ -9381,1 +9471,1 @@\n-    fill64_masked(shift, to, 128, xtmp, k2, count, rtmp, true);\n+    fill64_unmasked(shift, to, 128, xtmp, count, rtmp);\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":109,"deletions":19,"binary":false,"changes":128,"status":"modified"},{"patch":"@@ -2026,0 +2026,3 @@\n+  void fill64_unmasked(uint shift, Register dst, int disp,\n+                         XMMRegister xmm, Register length, Register temp);\n+\n@@ -2030,0 +2033,3 @@\n+  void fill32_unmasked(uint shift, Register dst, int disp,\n+                         XMMRegister xmm, Register length, Register temp);\n+\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.hpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"}]}