{"files":[{"patch":"@@ -365,8 +365,8 @@\n-    private static final int LIMIT_1 = G.next();\n-    private static final int LIMIT_2 = G.next();\n-    private static final int LIMIT_3 = G.next();\n-    private static final int LIMIT_4 = G.next();\n-    private static final int LIMIT_5 = G.next();\n-    private static final int LIMIT_6 = G.next();\n-    private static final int LIMIT_7 = G.next();\n-    private static final int LIMIT_8 = G.next();\n+    private static final long LIMIT_1 = G.next();\n+    private static final long LIMIT_2 = G.next();\n+    private static final long LIMIT_3 = G.next();\n+    private static final long LIMIT_4 = G.next();\n+    private static final long LIMIT_5 = G.next();\n+    private static final long LIMIT_6 = G.next();\n+    private static final long LIMIT_7 = G.next();\n+    private static final long LIMIT_8 = G.next();\n@@ -404,1 +404,1 @@\n-    private int testRandomLimitsInterpreted(int x,int y) {\n+    private int testRandomLimitsInterpreted(int x, int y) {\n@@ -408,1 +408,1 @@\n-        int z = x ^ y;\n+        var z = x ^ y;\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/XorINodeIdealizationTests.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -251,1 +251,2 @@\n-            \"testFoldableXorDifferingLength\", \"testXorMax\"\n+            \"testFoldableXorDifferingLength\", \"testXorMax\",\n+            \"testFoldableRange\",\"testRandomLimits\"\n@@ -273,0 +274,2 @@\n+        Asserts.assertEQ(testRandomLimitsInterpreted(a, b), testRandomLimits(a, b));\n+        Asserts.assertEQ(true, testFoldableRange(a, b));\n@@ -277,1 +280,1 @@\n-    @IR(counts = {IRNode.CON_I, \"1\"})\n+    @IR(counts = {IRNode.CON_I, \"1\"})  \/\/ boolean is a CON_I\n@@ -290,1 +293,1 @@\n-    @IR(counts = {IRNode.CON_I, \"1\"}) \/\/ note boolean is a CON_I\n+    @IR(counts = {IRNode.CON_I, \"1\"}) \/\/ boolean is a CON_I\n@@ -298,1 +301,1 @@\n-    @IR(counts = {IRNode.CON_I, \"1\"})\n+    @IR(counts = {IRNode.CON_I, \"1\"}) \/\/ boolean is a CON_I\n@@ -310,0 +313,86 @@\n+\n+    private static final Range RANGE_1 = Range.generate(G.restricted(0L, MAX_VALUE));\n+    private static final Range RANGE_2 = Range.generate(G.restricted(0L, MAX_VALUE));\n+    private static final long UPPER_BOUND = Math.max(0, Long.highestOneBit(RANGE_1.hi() | RANGE_2.hi()) * 2 - 1);\n+\n+    private static final long LIMIT_1 = G.next();\n+    private static final long LIMIT_2 = G.next();\n+    private static final long LIMIT_3 = G.next();\n+    private static final long LIMIT_4 = G.next();\n+    private static final long LIMIT_5 = G.next();\n+    private static final long LIMIT_6 = G.next();\n+    private static final long LIMIT_7 = G.next();\n+    private static final long LIMIT_8 = G.next();\n+\n+\n+    @Test\n+    @IR(failOn = {IRNode.XOR})\n+    @IR(counts = {IRNode.CON_I, \"1\"}) \/\/ Boolean is CON_I\n+    public boolean testFoldableRange(long x, long y) {\n+        return (RANGE_1.clamp(x) ^ RANGE_2.clamp(y)) <= UPPER_BOUND;\n+    }\n+\n+    @Test\n+    public int testRandomLimits(long x, long y) {\n+        x = RANGE_1.clamp(x);\n+        y = RANGE_2.clamp(y);\n+\n+        var z = x ^ y;\n+        \/\/ This should now have a new range, possibly some [0, max]\n+        \/\/ Now let's test the range with some random if branches.\n+        int sum = 0;\n+        if (z > LIMIT_1) { sum += 1; }\n+        if (z > LIMIT_2) { sum += 2; }\n+        if (z > LIMIT_3) { sum += 4; }\n+        if (z > LIMIT_4) { sum += 8; }\n+        if (z > LIMIT_5) { sum += 16; }\n+        if (z > LIMIT_6) { sum += 32; }\n+        if (z > LIMIT_7) { sum += 64; }\n+        if (z > LIMIT_8) { sum += 128; }\n+\n+        return sum;\n+    }\n+\n+    @DontCompile\n+    private int testRandomLimitsInterpreted(long x, long y) {\n+        x = RANGE_1.clamp(x);\n+        y = RANGE_2.clamp(y);\n+\n+        var z = x ^ y;\n+        \/\/ This should now have a new range, possibly some [0, max]\n+        \/\/ Now let's test the range with some random if branches.\n+        int sum = 0;\n+        if (z > LIMIT_1) { sum += 1; }\n+        if (z > LIMIT_2) { sum += 2; }\n+        if (z > LIMIT_3) { sum += 4; }\n+        if (z > LIMIT_4) { sum += 8; }\n+        if (z > LIMIT_5) { sum += 16; }\n+        if (z > LIMIT_6) { sum += 32; }\n+        if (z > LIMIT_7) { sum += 64; }\n+        if (z > LIMIT_8) { sum += 128; }\n+\n+        return sum;\n+    }\n+\n+    record Range(long lo, long hi) {\n+        Range {\n+            if (lo > hi) {\n+                throw new IllegalArgumentException(\"lo > hi\");\n+            }\n+        }\n+\n+        long clamp(long v) {\n+            return Math.min(hi, Math.max(v, lo));\n+        }\n+\n+        static Range generate(Generator<Long> g) {\n+            var a = g.next();\n+            var b = g.next();\n+            if (a > b) {\n+                var tmp = a;\n+                a = b;\n+                b = tmp;\n+            }\n+            return new Range(a, b);\n+        }\n+    }\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/XorLNodeIdealizationTests.java","additions":93,"deletions":4,"binary":false,"changes":97,"status":"modified"}]}