{"files":[{"patch":"@@ -0,0 +1,115 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8326666\n+ * @summary Test that Subject Delegation is removed.\n+ * @modules java.management.rmi\n+ *          java.management\/com.sun.jmx.remote.security\n+ * @run main\/othervm RemovedSubjectDelegation\n+ *\/\n+\n+import java.lang.management.ManagementFactory;\n+import java.rmi.RemoteException;\n+import java.rmi.registry.LocateRegistry;\n+import java.rmi.registry.Registry;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Properties;\n+import javax.management.MBeanServer;\n+import javax.management.MBeanServerConnection;\n+import javax.management.remote.JMXConnector;\n+import javax.management.remote.JMXConnectorFactory;\n+import javax.management.remote.JMXConnectorServer;\n+import javax.management.remote.JMXConnectorServerFactory;\n+import javax.management.remote.JMXPrincipal;\n+import javax.management.remote.JMXServiceURL;\n+import javax.security.auth.Subject;\n+\n+public class RemovedSubjectDelegation {\n+\n+    public static void main(String[] args) throws Exception {\n+        JMXConnectorServer jmxcs = null;\n+        JMXConnector jmxc = null;\n+        try {\n+            \/\/ Create an RMI registry\n+            \/\/\n+            System.out.println(\"Start RMI registry...\");\n+            Registry reg = null;\n+            int port = 5900;\n+            while (port++ < 5920) {\n+                try {\n+                    reg = LocateRegistry.createRegistry(port);\n+                    System.out.println(\"RMI registry running on port \" + port);\n+                    break;\n+                } catch (RemoteException e) {\n+                    \/\/ Failed to create RMI registry...\n+                    System.out.println(\"Failed to create RMI registry \" +\n+                                       \"on port \" + port);\n+                }\n+            }\n+            if (reg == null) {\n+                throw new RuntimeException(\"Failed to create RMI registry.\");\n+            }\n+            \/\/ Instantiate the MBean server\n+            \/\/\n+            System.out.println(\"Create the MBean server\");\n+            MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();\n+            \/\/ Create an RMI connector server\n+            \/\/\n+            System.out.println(\"Create an RMI connector server\");\n+            JMXServiceURL url = new JMXServiceURL(\"rmi\", null, 0);\n+            HashMap env = new HashMap();\n+            jmxcs = JMXConnectorServerFactory.newJMXConnectorServer(url, env, mbs);\n+            jmxcs.start();\n+            \/\/ Create an RMI connector client\n+            \/\/\n+            System.out.println(\"Create an RMI connector client\");\n+            \/\/ Not setting env with \"jmx.remote.credentials\", should not get as far as verifying:\n+            jmxc = JMXConnectorFactory.connect(jmxcs.getAddress());\n+            Subject delegationSubject =\n+                new Subject(true,\n+                            Collections.singleton(new JMXPrincipal(\"delegate\")),\n+                            Collections.EMPTY_SET,\n+                            Collections.EMPTY_SET);\n+\n+            MBeanServerConnection mbsc = null;\n+            try {\n+                mbsc = jmxc.getMBeanServerConnection(delegationSubject);\n+                throw new RuntimeException(\"FAIL: delegationSubject was accepted. mbsc=\" + mbsc);\n+            } catch (Exception e) {\n+                System.out.println(\"PASS: \" + e);\n+            }\n+        } catch (Exception e) {\n+            System.out.println(\"Unexpected exception caught = \" + e);\n+            e.printStackTrace();\n+            throw e;\n+        } finally {\n+            if (jmxc != null)\n+                jmxc.close();\n+            if (jmxcs != null)\n+                jmxcs.stop();\n+        }\n+    }\n+}\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/RemovedSubjectDelegation.java","additions":115,"deletions":0,"binary":false,"changes":115,"status":"added"}]}