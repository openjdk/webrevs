{"files":[{"patch":"@@ -2896,1 +2896,1 @@\n-    if (!thread->sleep_nanos(nanos)) { \/\/ interrupted\n+    if (!thread->sleep_nanos(nanos)) { \/\/ interrupted or async exception was installed\n@@ -2901,4 +2901,5 @@\n-\n-        \/\/ TODO-FIXME: THROW_MSG returns which means we will not call set_state()\n-        \/\/ to properly restore the thread state.  That's likely wrong.\n-        THROW_MSG(vmSymbols::java_lang_InterruptedException(), \"sleep interrupted\");\n+        if (!has_async_exception_condition()) {\n+          \/\/ TODO-FIXME: THROW_MSG returns which means we will not call set_state()\n+          \/\/ to properly restore the thread state.  That's likely wrong.\n+          THROW_MSG(vmSymbols::java_lang_InterruptedException(), \"sleep interrupted\");\n+        }\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -1149,1 +1149,0 @@\n-    java_lang_Thread::set_interrupted(threadObj(), true);\n@@ -2101,1 +2100,1 @@\n-\/\/ if the thread was interrupted.\n+\/\/ if the thread was interrupted or async exception was installed.\n@@ -2121,0 +2120,3 @@\n+    if (has_async_exception_condition()) {\n+      return false;\n+    }\n","filename":"src\/hotspot\/share\/runtime\/javaThread.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -214,1 +214,0 @@\n-            Thread.interrupted();\n@@ -227,1 +226,0 @@\n-            Thread.interrupted();\n@@ -240,1 +238,0 @@\n-            Thread.interrupted();\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/vthread\/StopThreadTest\/StopThreadTest.java","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"}]}