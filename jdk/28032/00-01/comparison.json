{"files":[{"patch":"@@ -263,2 +263,2 @@\n-                    String result = null;\n-                    IOException suppressed = null;\n+                    long handle = INVALID_HANDLE_VALUE;\n+                    boolean reparsePointOpened = false;\n@@ -266,3 +266,34 @@\n-                        result = getFinalPath(input);\n-                    } catch (IOException e) {\n-                        suppressed = e;\n+                        \/\/ first try opening while following links\n+                        handle = input.openForReadAttributeAccess(true);\n+                    } catch (WindowsException x) {\n+                        try {\n+                            \/\/ fall back to opening the reparse point itself\n+                            handle = input.openForReadAttributeAccess(false);\n+                            CloseHandle(handle);\n+                            handle = INVALID_HANDLE_VALUE;\n+\n+                            \/\/ set flag to suppress the IOException below\n+                            reparsePointOpened = true;\n+                        } catch (WindowsException y) {\n+                            \/\/ suppress exception from opening reparse point\n+                            x.addSuppressed(y);\n+                        }\n+                        \/\/ fail if opening failed, following or not following\n+                        if (!reparsePointOpened)\n+                            x.rethrowAsIOException(input);\n+                    }\n+\n+                    \/\/ attempt to get the final path if the handle is valid\n+                    String result = null;\n+                    if (handle != INVALID_HANDLE_VALUE) {\n+                        try {\n+                            result = stripPrefix(GetFinalPathNameByHandle(handle));\n+                        } catch (WindowsException x) {\n+                            \/\/ ERROR_INVALID_LEVEL is the error returned when\n+                            \/\/ not supported (a symlink to file on FAT32 or\n+                            \/\/ Samba server for example)\n+                            if (x.lastError() != ERROR_INVALID_LEVEL)\n+                                x.rethrowAsIOException(input);\n+                        } finally {\n+                            CloseHandle(handle);\n+                        }\n@@ -270,0 +301,4 @@\n+\n+                    \/\/ if the final path is null or is the UNC version of\n+                    \/\/ a drive path, then derive the final path by stepping\n+                    \/\/ through the elements of the path\n@@ -277,11 +312,4 @@\n-                        \/\/ link to a file system that doesn't support sym links,\n-                        \/\/ or a drive path was converted to a UNC path.\n-                        try {\n-                            WindowsPath resolved = resolveAllLinks(\n-                                WindowsPath.createFromNormalizedPath(fs, path));\n-                            result = getRealPath(resolved, false);\n-                        } catch (IOException e) {\n-                            if (suppressed != null)\n-                                e.addSuppressed(suppressed);\n-                            throw e;\n-                        }\n+                        \/\/ link to a file system that doesn't support sym links.\n+                        WindowsPath resolved = resolveAllLinks(\n+                            WindowsPath.createFromNormalizedPath(fs, path));\n+                        result = getRealPath(resolved, false);\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsLinkSupport.java","additions":44,"deletions":16,"binary":false,"changes":60,"status":"modified"}]}