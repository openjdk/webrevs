{"files":[{"patch":"@@ -32,0 +32,1 @@\n+import static jdk.jpackage.internal.cli.StandardAppImageFileOption.DESCRIPTION;\n@@ -325,0 +326,1 @@\n+            standardProps.add(Map.entry(DESCRIPTION.getName(), launcher.description()));\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/AppImageFile.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-import static jdk.jpackage.internal.cli.StandardOption.DESCRIPTION;\n@@ -63,12 +62,2 @@\n-                                PREDEFINED_APP_IMAGE, PREDEFINED_APP_IMAGE.getFrom(mainOptions),\n-                                \/\/\n-                                \/\/ For backward compatibility, descriptions of the additional\n-                                \/\/ launchers in the predefined app image will be set to\n-                                \/\/ the application description, if available, or to the name\n-                                \/\/ of the main launcher in the predefined app image.\n-                                \/\/\n-                                \/\/ All launchers in the predefined app image will have the same description.\n-                                \/\/ This is wrong and should be revised.\n-                                \/\/\n-                                DESCRIPTION, DESCRIPTION.findIn(mainOptions).orElseGet(ea::appName)\n-                            )));\n+                                PREDEFINED_APP_IMAGE, PREDEFINED_APP_IMAGE.getFrom(mainOptions)\n+                        )));\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/OptionsTransformer.java","additions":2,"deletions":13,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -102,0 +102,8 @@\n+    \/**\n+     * The description of a launcher.\n+     *\/\n+    public static final OptionValue<String> DESCRIPTION = stringOption(\"description\")\n+            .inScope(AppImageFileOptionScope.LAUNCHER)\n+            .inScope(MandatoryOption.VALUE)\n+            .toOptionValueBuilder().id(StandardOption.DESCRIPTION.id()).create();\n+\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/StandardAppImageFileOption.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+import static jdk.jpackage.internal.util.function.ThrowingConsumer.toConsumer;\n@@ -28,1 +29,0 @@\n-import static jdk.jpackage.internal.util.function.ThrowingConsumer.toConsumer;\n@@ -40,0 +40,2 @@\n+import javax.xml.stream.XMLStreamException;\n+import javax.xml.stream.XMLStreamWriter;\n@@ -78,2 +80,2 @@\n-        }).collect(toMap(Map.Entry::getKey, Map.Entry::getValue, (k, _) -> {\n-            throw new IllegalStateException(String.format(\"Duplicate key %s\", k));\n+        }).collect(toMap(Map.Entry::getKey, Map.Entry::getValue, (v, _) -> {\n+            throw new IllegalStateException(String.format(\"Duplicate value [%s]\", v));\n@@ -96,0 +98,1 @@\n+            writeLauncherDescription(xml, mainLauncherName);\n@@ -116,0 +119,3 @@\n+                if (!props.containsKey(\"description\")) {\n+                    writeLauncherDescription(xml, al);\n+                }\n@@ -161,2 +167,2 @@\n-            }, (k, _) -> {\n-                throw new IllegalStateException(String.format(\"Duplicate key %s\", k));\n+            }, (v, _) -> {\n+                throw new IllegalStateException(String.format(\"Duplicate value [%s]\", v));\n@@ -176,0 +182,6 @@\n+    private static void writeLauncherDescription(XMLStreamWriter xml, String description) throws XMLStreamException {\n+        xml.writeStartElement(\"description\");\n+        xml.writeCharacters(Objects.requireNonNull(description));\n+        xml.writeEndElement();\n+    }\n+\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/AppImageFile.java","additions":17,"deletions":5,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -447,1 +447,1 @@\n-                PropertyFinder.nop()\n+                PropertyFinder.appImageFileLauncher(cmd, launcherName, \"description\")\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/LauncherVerifier.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+import static jdk.jpackage.internal.cli.StandardAppImageFileOption.DESCRIPTION;\n@@ -261,0 +262,5 @@\n+            LauncherBuilder description(String v) {\n+                description = v;\n+                return this;\n+            }\n+\n@@ -284,1 +290,1 @@\n-                        null,\n+                        description(),\n@@ -298,0 +304,4 @@\n+            private String description() {\n+                return Optional.ofNullable(description).orElseGet(this::name);\n+            }\n+\n@@ -308,0 +318,1 @@\n+                allProps.add(DESCRIPTION, description());\n@@ -313,0 +324,1 @@\n+            private String description;\n@@ -438,1 +450,3 @@\n-                            \"<main-launcher name='D'\/>\",\n+                            \"<main-launcher name='D'>\",\n+                            \"  <description>Foo<\/description>\",\n+                            \"<\/main-launcher>\",\n@@ -441,0 +455,18 @@\n+                }),\n+                createWithHeader(AppImageFile.getPlatform(os), AppImageFile.getVersion(), () -> {\n+                    \/\/ Missing 'description' element in the main launcher.\n+                    return List.of(\n+                            \"<app-version>321<\/app-version>\",\n+                            \"<main-launcher name='B'\/>\"\n+                    );\n+                }),\n+                createWithHeader(AppImageFile.getPlatform(os), AppImageFile.getVersion(), () -> {\n+                    \/\/ Missing 'description' element in the additional launcher.\n+                    return List.of(\n+                            \"<app-version>123<\/app-version>\",\n+                            \"<main-launcher name='B'>\",\n+                            \"  <description>Foo<\/description>\",\n+                            \"<\/main-launcher>\",\n+                            \"<main-class>Hello<\/main-class>\",\n+                            \"<add-launcher name='C'\/>\"\n+                    );\n@@ -454,1 +486,3 @@\n-                    \"<main-launcher name='D'\/>\",\n+                    \"<main-launcher name='D'>\",\n+                    \"  <description>Blah-Blah-Blah<\/description>\",\n+                    \"<\/main-launcher>\",\n@@ -486,0 +520,1 @@\n+                \"  <description>Quick brown fox<\/description>\",\n@@ -491,1 +526,3 @@\n-                \"<main-launcher name='Bar'\/>\"\n+                \"<main-launcher name='Bar'>\",\n+                \"  <description>Bar launcher description<\/description>\",\n+                \"<\/main-launcher>\"\n@@ -495,1 +532,6 @@\n-            return build().mainClass(\"Foo\").version(\"1.34\").appName(\"Bar\").addlauncher(\"add-launcher\").service(true);\n+            return build()\n+                    .mainClass(\"Foo\")\n+                    .version(\"1.34\")\n+                    .appName(\"Bar\")\n+                    .mainlauncher().description(\"Bar launcher description\").commit()\n+                    .addlauncher(\"add-launcher\").service(true).description(\"Quick brown fox\");\n@@ -516,1 +558,1 @@\n-                        build().version(\"72\").appName(\"Y\").mainClass(\"main.Class\")\n+                        build().version(\"72\").mainlauncher().description(\"Blah-Blah-Blah\").commit().appName(\"Y\").mainClass(\"main.Class\")\n@@ -518,1 +560,3 @@\n-                        \"<main-launcher name='Y'\/>\",\n+                        \"<main-launcher name='Y'>\",\n+                        \"  <description>Blah-Blah-Blah<\/description>\",\n+                        \"<\/main-launcher>\",\n@@ -524,0 +568,1 @@\n+                        .mainlauncher().description(\"Main launcher description\").commit()\n@@ -526,0 +571,1 @@\n+                                .description(\"another-launcher description\")\n@@ -529,0 +575,1 @@\n+                                .description(\"service-launcher description\")\n@@ -539,0 +586,1 @@\n+                        \"  <description>service-launcher description<\/description>\",\n@@ -543,0 +591,1 @@\n+                        \"  <description>another-launcher description<\/description>\",\n@@ -545,1 +594,3 @@\n-                        \"<main-launcher name='Foo'\/>\"\n+                        \"<main-launcher name='Foo'>\",\n+                        \"  <description>Main launcher description<\/description>\",\n+                        \"<\/main-launcher>\"\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/AppImageFileTest.java","additions":59,"deletions":8,"binary":false,"changes":67,"status":"modified"}]}