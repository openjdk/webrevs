{"files":[{"patch":"@@ -41,1 +41,0 @@\n-import javax.swing.JButton;\n@@ -51,1 +50,0 @@\n-    private static JButton getSelectedFilesButton;\n@@ -53,3 +51,3 @@\n-    private static boolean passed;\n-    private static File[] testDir;\n-    private static File[] tempFile;\n+    private static volatile Point frameLocation;\n+    private static volatile int frameWidth;\n+    private static volatile int frameHeight;\n@@ -61,20 +59,4 @@\n-\n-        try {\n-            \/\/ create test directory\n-            String tmpDir = System.getProperty(\"user.home\");\n-            testDir = new File[1];\n-            testDir[0] = new File(tmpDir, \"testDir\");\n-            if (!testDir[0].exists())\n-                testDir[0].mkdir();\n-            testDir[0].deleteOnExit();\n-\n-            \/\/ create temporary files inside testDir\n-            tempFile = new File[5];\n-            for (int i = 0; i < 5; ++i) {\n-                tempFile[i] = File.createTempFile(\"temp\", \".txt\",\n-                        new File(testDir[0].getAbsolutePath()));\n-                tempFile[i].deleteOnExit();\n-            }\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-        }\n+        File testDirDirs = createFoldersOnlyDir();\n+        File testDirFiles = createFilesOnlyDir();\n+        populateDirs(testDirDirs);\n+        populateFiles(testDirFiles);\n@@ -82,1 +64,1 @@\n-                        UIManager.getInstalledLookAndFeels()) {\n+                UIManager.getInstalledLookAndFeels()) {\n@@ -85,3 +67,3 @@\n-            checkFileOnlyTest(laf);\n-            checkDirectoriesOnlyTest(laf);\n-            checkFilesAndDirectoriesTest(laf);\n+            checkFileOnlyTest(laf, testDirFiles);\n+            checkDirectoriesOnlyTest(laf, testDirDirs);\n+            checkFilesAndDirectoriesTest(laf, testDirDirs);\n@@ -92,2 +74,38 @@\n-    private static void checkFileOnlyTest(UIManager.LookAndFeelInfo laf)\n-            throws Exception {\n+    private static File createFoldersOnlyDir() {\n+        String tmpDir = System.getProperty(\"java.io.tmpdir\");\n+        File dirsDir = new File(tmpDir, \"dirsDir\");\n+        if (!dirsDir.exists()) {\n+            dirsDir.mkdir();\n+        }\n+        dirsDir.deleteOnExit();\n+        return dirsDir;\n+    }\n+\n+    private static void populateDirs(File dirsDir) {\n+        for (int i = 0; i < 10; ++i) {\n+            File SubDirs = new File(dirsDir, \"subDir_\" + (i+1));\n+            SubDirs.mkdir();\n+            SubDirs.deleteOnExit();\n+        }\n+    }\n+\n+    private static File createFilesOnlyDir() {\n+        String tmpDir = System.getProperty(\"java.io.tmpdir\");\n+        File filesDir = new File(tmpDir, \"filesDir\");\n+        if (!filesDir.exists()) {\n+            filesDir.mkdir();\n+        }\n+        filesDir.deleteOnExit();\n+        return filesDir;\n+    }\n+\n+    private static void populateFiles(File filesDir) throws Exception {\n+        for (int i = 0; i < 10; ++i) {\n+            File subFile = new File(filesDir, \"subFiles_\" + (i+1));\n+            subFile.createNewFile();\n+            subFile.deleteOnExit();\n+        }\n+    }\n+\n+    private static void checkFileOnlyTest(UIManager.LookAndFeelInfo laf,\n+                                          File crntDir) throws Exception {\n@@ -98,1 +116,2 @@\n-                fileChooser.setCurrentDirectory(testDir[0]);\n+                fileChooser.setCurrentDirectory(crntDir);\n+                fileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);\n@@ -103,2 +122,6 @@\n-            fileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);\n-            doTesting(laf, 230);\n+            if (laf.getClassName().contains(\"Motif\")\n+                || laf.getClassName().contains(\"GTK\")) {\n+                doTesting(laf, 230);\n+            } else {\n+                doTesting(laf, 50);\n+            }\n@@ -106,5 +129,1 @@\n-            SwingUtilities.invokeAndWait(() -> {\n-                if (frame != null) {\n-                    frame.dispose();\n-                }\n-            });\n+            disposeFrame();\n@@ -114,2 +133,2 @@\n-    private static void checkDirectoriesOnlyTest(UIManager.LookAndFeelInfo laf)\n-            throws Exception {\n+    private static void checkDirectoriesOnlyTest(UIManager.LookAndFeelInfo laf,\n+                                             File crntDir) throws Exception {\n@@ -120,0 +139,2 @@\n+                fileChooser.setCurrentDirectory(crntDir);\n+                fileChooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);\n@@ -123,1 +144,0 @@\n-            fileChooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);\n@@ -126,5 +146,1 @@\n-            SwingUtilities.invokeAndWait(() -> {\n-                if (frame != null) {\n-                    frame.dispose();\n-                }\n-            });\n+            disposeFrame();\n@@ -134,2 +150,2 @@\n-    private static void checkFilesAndDirectoriesTest(UIManager.LookAndFeelInfo laf)\n-            throws Exception {\n+    private static void checkFilesAndDirectoriesTest(UIManager.LookAndFeelInfo laf,\n+                                               File crntDir) throws Exception {\n@@ -140,0 +156,2 @@\n+                fileChooser.setCurrentDirectory(crntDir);\n+                fileChooser.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);\n@@ -143,1 +161,0 @@\n-            fileChooser.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);\n@@ -146,5 +163,1 @@\n-            SwingUtilities.invokeAndWait(() -> {\n-                if (frame != null) {\n-                    frame.dispose();\n-                }\n-            });\n+            disposeFrame();\n@@ -157,1 +170,1 @@\n-        fileChooser = new JFileChooser(\"user.home\");\n+        fileChooser = new JFileChooser();\n@@ -160,13 +173,0 @@\n-\n-        getSelectedFilesButton = new JButton();\n-        getSelectedFilesButton.setText(\"Print selected Files\");\n-        getSelectedFilesButton.addActionListener(new ActionListener() {\n-            public void actionPerformed(ActionEvent evt) {\n-                passed = false;\n-                File files[] = fileChooser.getSelectedFiles();\n-                if (files.length != 0) {\n-                    passed = true;\n-                }\n-            }\n-        });\n-\n@@ -174,1 +174,0 @@\n-        frame.getContentPane().add(getSelectedFilesButton, BorderLayout.SOUTH);\n@@ -192,8 +191,7 @@\n-    private static void doTesting(UIManager.LookAndFeelInfo laf, int xOffset) {\n-        Point frameLocation = fileChooser.getLocationOnScreen();\n-        int frameWidth = frame.getWidth();\n-        int frameHeight = frame.getHeight();\n-\n-        Point btnLocation = getSelectedFilesButton.getLocationOnScreen();\n-        int btnWidth = getSelectedFilesButton.getWidth();\n-        int btnHeight = getSelectedFilesButton.getHeight();\n+    private static void doTesting(UIManager.LookAndFeelInfo laf, int xOffset)\n+                                    throws Exception {\n+        SwingUtilities.invokeAndWait(() -> {\n+            frameLocation = fileChooser.getLocationOnScreen();\n+            frameWidth = frame.getWidth();\n+            frameHeight = frame.getHeight();\n+        });\n@@ -201,1 +199,0 @@\n-        clickMouse(btnLocation, btnWidth, btnHeight, 0);\n@@ -211,0 +208,1 @@\n+        robot.waitForIdle();\n@@ -214,1 +212,2 @@\n-        if (!passed)\n+        File files[] = fileChooser.getSelectedFiles();\n+        if (files.length == 0) {\n@@ -216,1 +215,10 @@\n-                    \"empty array for LAF: \"+laf.getClassName());\n+                    \"empty array for LAF: \" + laf.getClassName());\n+        }\n+    }\n+\n+    private static void disposeFrame() throws Exception {\n+        SwingUtilities.invokeAndWait(() -> {\n+            if (frame != null) {\n+                frame.dispose();\n+            }\n+        });\n","filename":"test\/jdk\/com\/sun\/java\/swing\/plaf\/gtk\/TestFileChooserSingleDirectorySelection.java","additions":89,"deletions":81,"binary":false,"changes":170,"status":"modified"}]}