{"files":[{"patch":"@@ -3300,4 +3300,22 @@\n-  MEMORYSTATUSEX ms;\n-  ms.dwLength = sizeof(ms);\n-  GlobalMemoryStatusEx(&ms);\n-  return (size_t)ms.ullAvailVirtual;\n+  JOBOBJECT_EXTENDED_LIMIT_INFORMATION jeli = {};\n+  BOOL res = QueryInformationJobObject(nullptr, JobObjectExtendedLimitInformation, &jeli, sizeof(jeli), nullptr);\n+\n+  if (!res) {\n+    char buf[512];\n+    size_t buf_len = os::lasterror(buf, sizeof(buf));\n+    warning(\"Attempt to query job object information failed: %s\", buf_len != 0 ? buf : \"<unknown error>\");\n+\n+    \/\/ Conservatively assume no limit when there was an error calling QueryInformationJobObject.\n+    return SIZE_MAX;\n+  }\n+\n+  if (jeli.BasicLimitInformation.LimitFlags & JOB_OBJECT_LIMIT_PROCESS_MEMORY) {\n+    return jeli.ProcessMemoryLimit;\n+  }\n+\n+  if (jeli.BasicLimitInformation.LimitFlags & JOB_OBJECT_LIMIT_JOB_MEMORY) {\n+    return jeli.JobMemoryLimit;\n+  }\n+\n+  \/\/ No limit\n+  return SIZE_MAX;\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":22,"deletions":4,"binary":false,"changes":26,"status":"modified"}]}