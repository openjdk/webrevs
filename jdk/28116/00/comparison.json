{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -753,0 +753,16 @@\n+        if (c.getClass() == ArrayList.class) {\n+            ArrayList<?> src = (ArrayList<?>) c;\n+            Object[] a = src.elementData;\n+            int numNew = src.size;\n+            if (numNew == 0)\n+                return false;\n+            modCount++;\n+            Object[] elementData;\n+            final int s;\n+            if (numNew > (elementData = this.elementData).length - (s = size))\n+                elementData = grow(s + numNew);\n+            System.arraycopy(a, 0, elementData, s, numNew);\n+            size = s + numNew;\n+            return true;\n+        }\n+\n","filename":"src\/java.base\/share\/classes\/java\/util\/ArrayList.java","additions":17,"deletions":1,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -5256,0 +5256,12 @@\n+        public Object[] toArray() {\n+            return new Object[] {element};\n+        }\n+        @SuppressWarnings(\"unchecked\")\n+        public <T> T[] toArray(T[] a) {\n+            if (a.length < 1)\n+                a = (T[])java.lang.reflect.Array.newInstance(a.getClass().getComponentType(), 1);\n+            a[0] = (T)element;\n+            if (a.length > 1)\n+                a[1] = null;\n+            return a;\n+        }\n","filename":"src\/java.base\/share\/classes\/java\/util\/Collections.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -0,0 +1,179 @@\n+\/*\n+ * Copyright Amazon.com Inc. or its affiliates. All Rights Reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.bench.java.util;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.LinkedList;\n+import java.util.Set;\n+import java.util.TreeSet;\n+import java.util.WeakHashMap;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.openjdk.jmh.annotations.Benchmark;\n+import org.openjdk.jmh.annotations.BenchmarkMode;\n+import org.openjdk.jmh.annotations.Fork;\n+import org.openjdk.jmh.annotations.Level;\n+import org.openjdk.jmh.annotations.Measurement;\n+import org.openjdk.jmh.annotations.Mode;\n+import org.openjdk.jmh.annotations.OutputTimeUnit;\n+import org.openjdk.jmh.annotations.Param;\n+import org.openjdk.jmh.annotations.Scope;\n+import org.openjdk.jmh.annotations.Setup;\n+import org.openjdk.jmh.annotations.State;\n+import org.openjdk.jmh.annotations.Warmup;\n+import org.openjdk.jmh.infra.Blackhole;\n+\n+\/**\n+ * Benchmark measuring ArrayList addAll() performance.\n+ *\n+ * Tests the performance of ArrayList.addAll() when copying from another ArrayList.\n+ *\/\n+@BenchmarkMode(Mode.AverageTime)\n+@OutputTimeUnit(TimeUnit.NANOSECONDS)\n+@State(Scope.Benchmark)\n+@Warmup(iterations = 3, time = 1, timeUnit = TimeUnit.SECONDS)\n+@Measurement(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS)\n+@Fork(value = 1, jvmArgs = { \"-XX:+UseParallelGC\", \"-Xmx3g\" })\n+public class ArrayListBulkOpsBenchmark {\n+\n+    @Param({ \"false\", \"true\" })\n+    private boolean enablePoisoning;\n+\n+    private ArrayList<String> arrayListSource0;\n+    private ArrayList<String> arrayListSource5;\n+    private ArrayList<String> arrayListSource75;\n+    private LinkedList<String> linkedListSource0;\n+    private LinkedList<String> linkedListSource5;\n+    private LinkedList<String> linkedListSource75;\n+    private Set<String> singletonSetSource;\n+    private HashMap<String, String> hashMapSource;\n+    private TreeSet<String> treeSetSource;\n+    private WeakHashMap<String, String> weakHashMapSource;\n+\n+    @Benchmark\n+    public ArrayList<String> addAllArrayList0(Blackhole bh) {\n+        ArrayList<String> result = new ArrayList<>(0);\n+        result.addAll(arrayListSource0);\n+        bh.consume(result);\n+        return result;\n+    }\n+\n+    @Benchmark\n+    public ArrayList<String> addAllArrayList5(Blackhole bh) {\n+        ArrayList<String> result = new ArrayList<>(5);\n+        result.addAll(arrayListSource5);\n+        bh.consume(result);\n+        return result;\n+    }\n+\n+    @Benchmark\n+    public ArrayList<String> addAllArrayList75(Blackhole bh) {\n+        ArrayList<String> result = new ArrayList<>(75);\n+        result.addAll(arrayListSource75);\n+        bh.consume(result);\n+        return result;\n+    }\n+\n+    @Benchmark\n+    public ArrayList<String> addAllLinkedList0(Blackhole bh) {\n+        ArrayList<String> result = new ArrayList<>(0);\n+        result.addAll(linkedListSource0);\n+        bh.consume(result);\n+        return result;\n+    }\n+\n+    @Benchmark\n+    public ArrayList<String> addAllLinkedList5(Blackhole bh) {\n+        ArrayList<String> result = new ArrayList<>(5);\n+        result.addAll(linkedListSource5);\n+        bh.consume(result);\n+        return result;\n+    }\n+\n+    @Benchmark\n+    public ArrayList<String> addAllLinkedList75(Blackhole bh) {\n+        ArrayList<String> result = new ArrayList<>(75);\n+        result.addAll(linkedListSource75);\n+        bh.consume(result);\n+        return result;\n+    }\n+\n+    @Benchmark\n+    public ArrayList<String> addAllSingletonSet(Blackhole bh) {\n+        ArrayList<String> result = new ArrayList<>(1);\n+        result.addAll(singletonSetSource);\n+        bh.consume(result);\n+        return result;\n+    }\n+\n+    @Setup(Level.Trial)\n+    public void setup() {\n+        \/\/ Create source collections of different sizes\n+        arrayListSource0 = new ArrayList<>();\n+        arrayListSource5 = new ArrayList<>();\n+        arrayListSource75 = new ArrayList<>();\n+        linkedListSource0 = new LinkedList<>();\n+        linkedListSource5 = new LinkedList<>();\n+        linkedListSource75 = new LinkedList<>();\n+\n+        for (int i = 0; i < 5; i++) {\n+            arrayListSource5.add(\"key\" + i);\n+            linkedListSource5.add(\"key\" + i);\n+        }\n+\n+        for (int i = 0; i < 75; i++) {\n+            arrayListSource75.add(\"key\" + i);\n+            linkedListSource75.add(\"key\" + i);\n+        }\n+\n+        \/\/ SingletonSet always contains exactly one element\n+        singletonSetSource = Collections.singleton(\"key0\");\n+\n+        \/\/ Create poisoning collections\n+        hashMapSource = new HashMap<>();\n+        treeSetSource = new TreeSet<>();\n+        weakHashMapSource = new WeakHashMap<>();\n+        for (int i = 0; i < 75; i++) {\n+            hashMapSource.put(\"key\" + i, \"value\" + i);\n+            treeSetSource.add(\"key\" + i);\n+            weakHashMapSource.put(\"key\" + i, \"value\" + i);\n+        }\n+\n+        if (enablePoisoning) {\n+            poisonCallSites();\n+        }\n+    }\n+\n+    private void poisonCallSites() {\n+        \/\/ Poison ArrayList.addAll() with different Collection types\n+        for (int i = 0; i < 40000; i++) {\n+            ArrayList<Object> temp = new ArrayList<>();\n+            temp.addAll(hashMapSource.entrySet());\n+            temp.addAll(treeSetSource);\n+            temp.addAll(weakHashMapSource.keySet());\n+        }\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/util\/ArrayListBulkOpsBenchmark.java","additions":179,"deletions":0,"binary":false,"changes":179,"status":"added"}]}