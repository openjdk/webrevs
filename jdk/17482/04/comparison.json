{"files":[{"patch":"@@ -190,0 +190,23 @@\n+\/\/ This encoding is similar (but not quite identical) to the encoding used\n+\/\/ by literal ld\/st. see JDK-8324123.\n+\/\/ PRFM does not support writeback or pre\/post index.\n+void Assembler::prfm(const Address &adr, prfop pfop) {\n+  Address::mode mode = adr.getMode();\n+  \/\/ PRFM does not support pre\/post index\n+  \/\/ Passing Address with pre\/post mode to ld_st2 will generate an undefined instruction.\n+  \/\/ So use guarantee to avoid pre\/post mode Address operand\n+  guarantee((mode != Address::pre), \"prfm does not support pre index\");\n+  guarantee((mode != Address::post), \"prfm does not support post index\");\n+  if (mode == Address::literal) {\n+    starti;\n+    f(0b11, 31, 30), f(0b011, 29, 27), f(0b000, 26, 24);\n+    f(pfop, 4, 0);\n+    int64_t offset = (adr.target() - pc()) >> 2;\n+    sf(offset, 23, 5);\n+  } else {\n+    assert((mode == Address::base_plus_offset)\n+            || (mode == Address::base_plus_offset_reg), \"must be base_plus_offset\/base_plus_offset_reg\");\n+    ld_st2(as_Register(pfop), adr, 0b11, 0b10);\n+  }\n+}\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/assembler_aarch64.cpp","additions":23,"deletions":0,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -800,0 +800,2 @@\n+  void prfm(const Address &adr, prfop pfop = PLDL1KEEP);\n+\n@@ -1577,11 +1579,0 @@\n-#define INSN(NAME, size, op)                                    \\\n-  void NAME(const Address &adr, prfop pfop = PLDL1KEEP) {       \\\n-    ld_st2(as_Register(pfop), adr, size, op);                   \\\n-  }\n-\n-  INSN(prfm, 0b11, 0b10); \/\/ FIXME: PRFM should not be used with\n-                          \/\/ writeback modes, but the assembler\n-                          \/\/ doesn't enfore that.\n-\n-#undef INSN\n-\n","filename":"src\/hotspot\/cpu\/aarch64\/assembler_aarch64.hpp","additions":2,"deletions":11,"binary":false,"changes":13,"status":"modified"}]}