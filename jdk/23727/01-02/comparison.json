{"files":[{"patch":"@@ -24,4 +24,0 @@\n-\/*\n- * This test is called by certreplace.sh\n- *\/\n-\n@@ -43,0 +39,1 @@\n+import jdk.test.lib.security.CertUtils;\n@@ -72,0 +69,1 @@\n+    private static final char[] PASSWORD_CHAR_ARR = PASSWORD.toCharArray();\n@@ -80,6 +78,0 @@\n-        final String intAliase = \"int\";\n-        final String userAlias = \"user\";\n-        final String caAlias = \"ca\";\n-\n-        final String certplaceCerts = \"certreplace.certs\";\n-\n@@ -96,1 +88,1 @@\n-                              \"-genkeypair -alias \" + caAlias + \" -dname CN=CA -keyalg rsa -sigalg md2withrsa -ext bc\");\n+                              \"-genkeypair -alias ca -dname CN=CA -keyalg rsa -sigalg md2withrsa -ext bc\");\n@@ -98,1 +90,1 @@\n-                              \"-genkeypair -alias \" + intAliase + \" -dname CN=Int -keyalg rsa\");\n+                              \"-genkeypair -alias int -dname CN=Int -keyalg rsa\");\n@@ -100,1 +92,1 @@\n-                              \"-genkeypair -alias \" + userAlias + \" -dname CN=User -keyalg rsa\");\n+                              \"-genkeypair -alias user -dname CN=User -keyalg rsa\");\n@@ -105,2 +97,0 @@\n-        final String intReqFile = intAliase + \".req\";\n-        final String intCertFileName = intAliase + \".cert\";\n@@ -109,1 +99,1 @@\n-                              \"-certreq -alias \" + intAliase + \" -file \" + intReqFile);\n+                              \"-certreq -alias int -file int.req\");\n@@ -111,2 +101,2 @@\n-                              \"-gencert -rfc -alias \" + caAlias + \" -ext bc -infile \" + intReqFile + \" \" +\n-                              \"-outfile \" + intCertFileName);\n+                              \"-gencert -rfc -alias ca -ext bc -infile int.req \" +\n+                              \"-outfile int.cert\");\n@@ -116,0 +106,2 @@\n+\n+        final FileInputStream certInputStream = new FileInputStream(\"int.cert\");\n@@ -117,2 +109,2 @@\n-                certificateFactory.generateCertificate(\n-                        new FileInputStream(intCertFileName)\n+                CertUtils.getCertFromStream(\n+                        certInputStream\n@@ -121,3 +113,5 @@\n-        final PrivateKey privateKey = (PrivateKey) keyStore.getKey(intAliase, PASSWORD.toCharArray());\n-        keyStore.setKeyEntry(intAliase, privateKey, PASSWORD.toCharArray(), certs);\n-        keyStore.store(new FileOutputStream(CERTREPLACE_JKS), PASSWORD.toCharArray());\n+        certInputStream.close();\n+\n+        final PrivateKey privateKey = (PrivateKey) keyStore.getKey(\"int\", PASSWORD_CHAR_ARR);\n+        keyStore.setKeyEntry(\"int\", privateKey, PASSWORD_CHAR_ARR, certs);\n+        keyStore.store(new FileOutputStream(CERTREPLACE_JKS), PASSWORD_CHAR_ARR);\n@@ -126,1 +120,0 @@\n-        final String userReqFile = userAlias + \".req\";\n@@ -128,1 +121,1 @@\n-                              \"-certreq -alias \" + userAlias + \" -file \" + userReqFile);\n+                              \"-certreq -alias user -file user.req\");\n@@ -130,3 +123,3 @@\n-                              \"-gencert -rfc -alias \" + intAliase + \" \" +\n-                              \"-infile \" + userReqFile + \" \" +\n-                              \"-outfile \" + certplaceCerts); \/\/ this will create certreplace.certs which is later appended\n+                              \"-gencert -rfc -alias int \" +\n+                              \"-infile user.req \" +\n+                              \"-outfile certreplace.certs\"); \/\/ this will create certreplace.certs which is later appended\n@@ -135,1 +128,1 @@\n-        final Path certPath = Paths.get(certplaceCerts);\n+        final Path certPath = Paths.get(\"certreplace.certs\");\n@@ -137,1 +130,1 @@\n-        Files.write(certPath, Files.readAllBytes(Path.of(intCertFileName)), StandardOpenOption.APPEND);\n+        Files.write(certPath, Files.readAllBytes(Path.of(\"int.cert\")), StandardOpenOption.APPEND);\n@@ -140,1 +133,1 @@\n-                                                      \"-export -rfc -alias \" + caAlias).getOutput();\n+                                                      \"-export -rfc -alias ca\").getOutput();\n@@ -144,0 +137,4 @@\n+        keyStore.deleteEntry(\"int\");\n+        keyStore.deleteEntry(\"user\");\n+        keyStore.store(new FileOutputStream(CERTREPLACE_JKS), PASSWORD_CHAR_ARR);\n+\n@@ -145,3 +142,1 @@\n-                              \"-selfcert -alias \" + caAlias);\n-        keyStore.deleteEntry(intAliase);\n-        keyStore.deleteEntry(userAlias);\n+                              \"-selfcert -alias ca\");\n@@ -157,4 +152,0 @@\n-        final String ca1Alias = \"ca1\";\n-        final String ca2Alias = \"ca2\";\n-        final String userAlias = \"user\";\n-\n@@ -172,1 +163,1 @@\n-                              \"-genkeypair -alias \" + ca1Alias + \" -dname CN=CA -keyalg rsa \" +\n+                              \"-genkeypair -alias ca1 -dname CN=CA -keyalg rsa \" +\n@@ -175,1 +166,1 @@\n-                              \"-genkeypair -alias \" + ca2Alias + \" -dname CN=CA -keyalg rsa \" +\n+                              \"-genkeypair -alias ca2 -dname CN=CA -keyalg rsa \" +\n@@ -178,1 +169,1 @@\n-                              \"-genkeypair -alias \" + userAlias + \" -dname CN=User -keyalg rsa\");\n+                              \"-genkeypair -alias user -dname CN=User -keyalg rsa\");\n@@ -186,1 +177,0 @@\n-        final String userReqFile = userAlias + \".req\";\n@@ -188,1 +178,1 @@\n-                              \"-certreq -alias \" + userAlias + \" -file \" + userReqFile);\n+                              \"-certreq -alias user -file user.req\");\n@@ -190,2 +180,2 @@\n-                              \"-gencert -rfc -alias \" + ca1Alias + \" \" +\n-                              \"-startdate -1M -infile \" + userReqFile + \" -outfile samedn1.certs\");\n+                              \"-gencert -rfc -alias ca1 \" +\n+                              \"-startdate -1M -infile user.req -outfile samedn1.certs\");\n@@ -193,2 +183,2 @@\n-                              \"-gencert -rfc -alias \" + ca2Alias + \" \" +\n-                              \"-startdate -1M -infile \" + userReqFile + \" -outfile samedn2.certs\");\n+                              \"-gencert -rfc -alias ca2 \" +\n+                              \"-startdate -1M -infile user.req -outfile samedn2.certs\");\n@@ -197,1 +187,2 @@\n-        keyStore.deleteEntry(userAlias);\n+        keyStore.deleteEntry(\"user\");\n+        keyStore.store(new FileOutputStream(CERTREPLACE_JKS), PASSWORD_CHAR_ARR);\n","filename":"test\/jdk\/sun\/security\/validator\/CertReplace.java","additions":39,"deletions":48,"binary":false,"changes":87,"status":"modified"}]}