{"files":[{"patch":"@@ -44,0 +44,1 @@\n+import jdk.jpackage.internal.model.ExecutableAttributesWithCapturedOutput;\n@@ -214,7 +215,0 @@\n-        PrintableOutputBuilder printableOutputBuilder;\n-        if (dumpOutput()) {\n-            printableOutputBuilder = new PrintableOutputBuilder(coc);\n-        } else {\n-            printableOutputBuilder = null;\n-        }\n-\n@@ -225,0 +219,1 @@\n+        var printableOutputBuilder = new PrintableOutputBuilder(coc);\n@@ -236,0 +231,1 @@\n+        var printableOutput = printableOutputBuilder.create();\n@@ -237,1 +233,1 @@\n-            log(result, printableOutputBuilder.create());\n+            log(result, printableOutput);\n@@ -240,1 +236,1 @@\n-        return result;\n+        return ExecutableAttributesWithCapturedOutput.augmentResultWithOutput(result, printableOutput);\n@@ -312,1 +308,1 @@\n-        sb.append(\":\\n    \").append(result.execAttrs());\n+        sb.append(\":\\n    \").append(result.execAttrs().printableCommandLine());\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/Executor.java","additions":6,"deletions":10,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+import java.io.BufferedReader;\n@@ -36,0 +37,1 @@\n+import java.io.StringReader;\n@@ -51,0 +53,1 @@\n+import jdk.jpackage.internal.model.ExecutableAttributesWithCapturedOutput;\n@@ -52,0 +55,3 @@\n+import jdk.jpackage.internal.model.SelfContainedException;\n+import jdk.jpackage.internal.util.CommandOutputControl.UnexpectedExitCodeException;\n+import jdk.jpackage.internal.util.CommandOutputControl.UnexpectedResultException;\n@@ -242,0 +248,2 @@\n+            } else if (t instanceof UnexpectedResultException ex) {\n+                printExternalCommandError(ex);\n@@ -247,0 +255,27 @@\n+        private void printExternalCommandError(UnexpectedResultException ex) {\n+            var result = ex.getResult();\n+            var commandOutput = ((ExecutableAttributesWithCapturedOutput)result.execAttrs()).printableOutput();\n+            var printableCommandLine = result.execAttrs().printableCommandLine();\n+\n+            if (verbose) {\n+                stackTracePrinter.accept(ex);\n+            }\n+\n+            String msg;\n+            if (ex instanceof UnexpectedExitCodeException) {\n+                msg = I18N.format(\"error.command-failed-unexpected-exit-code\", result.getExitCode(), printableCommandLine);\n+            } else if (result.exitCode().isPresent()) {\n+                msg = I18N.format(\"error.command-failed-unexpected-output\", printableCommandLine);\n+            } else {\n+                msg = I18N.format(\"error.command-failed-timed-out\", printableCommandLine);\n+            }\n+\n+            messagePrinter.accept(I18N.format(\"message.error-header\", msg));\n+            if (!verbose) {\n+                messagePrinter.accept(I18N.format(\"message.failed-command-output-header\"));\n+                try (var lines = new BufferedReader(new StringReader(commandOutput)).lines()) {\n+                    lines.forEach(messagePrinter);\n+                }\n+            }\n+        }\n+\n@@ -248,1 +283,1 @@\n-            var isAlienException = isAlienExceptionType(t);\n+            var isSelfContained = isSelfContained(t);\n@@ -250,1 +285,1 @@\n-            if (isAlienException || verbose) {\n+            if (!isSelfContained || verbose) {\n@@ -255,3 +290,1 @@\n-            if (isAlienException) {\n-                msg = t.toString();\n-            } else {\n+            if (isSelfContained) {\n@@ -259,0 +292,2 @@\n+            } else {\n+                msg = t.toString();\n@@ -265,15 +300,2 @@\n-        private static boolean isAlienExceptionType(Throwable t) {\n-            switch (t) {\n-                case JPackageException _ -> {\n-                    return false;\n-                }\n-                case Utils.ParseException _ -> {\n-                    return false;\n-                }\n-                case StandardOption.AddLauncherIllegalArgumentException _ -> {\n-                    return false;\n-                }\n-                default -> {\n-                    return true;\n-                }\n-            }\n+        private static boolean isSelfContained(Throwable t) {\n+            return t.getClass().getAnnotation(SelfContainedException.class) != null;\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/Main.java","additions":42,"deletions":20,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -63,0 +63,1 @@\n+import jdk.jpackage.internal.model.SelfContainedException;\n@@ -686,0 +687,1 @@\n+    @SelfContainedException\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/StandardOption.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,0 +35,1 @@\n+import jdk.jpackage.internal.model.SelfContainedException;\n@@ -101,0 +102,1 @@\n+    @SelfContainedException\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/Utils.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,53 @@\n+\/*\n+ * Copyright (c) 2026, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jpackage.internal.model;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import jdk.jpackage.internal.util.CommandOutputControl.ExecutableAttributes;\n+import jdk.jpackage.internal.util.CommandOutputControl.Result;\n+\n+\/**\n+ * {@link ExecutableAttributes} augmented with printable command output.\n+ *\/\n+public record ExecutableAttributesWithCapturedOutput(ExecutableAttributes execAttrs, String printableOutput)\n+        implements ExecutableAttributes {\n+\n+    public ExecutableAttributesWithCapturedOutput {\n+        Objects.requireNonNull(execAttrs);\n+        Objects.requireNonNull(printableOutput);\n+    }\n+\n+    @Override\n+    public List<String> commandLine() {\n+        return execAttrs.commandLine();\n+    }\n+\n+    public static Result augmentResultWithOutput(Result result, String output) {\n+        var execAttrs = new ExecutableAttributesWithCapturedOutput(result.execAttrs(), output);\n+        return result.copyWithExecutableAttributes(execAttrs);\n+    }\n+}\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/model\/ExecutableAttributesWithCapturedOutput.java","additions":53,"deletions":0,"binary":false,"changes":53,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+@SelfContainedException\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/model\/JPackageException.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,42 @@\n+\/*\n+ * Copyright (c) 2026, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jpackage.internal.model;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Inherited;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+\/**\n+ * Annotation for exceptions with self-contained error messages that don't\n+ * require an additional context, like exception class name or a stack trace.\n+ *\/\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.TYPE)\n+@Inherited\n+public @interface SelfContainedException {\n+}\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/model\/SelfContainedException.java","additions":42,"deletions":0,"binary":false,"changes":42,"status":"added"},{"patch":"@@ -53,0 +53,5 @@\n+message.failed-command-output-header=Command output:\n+\n+error.command-failed-unexpected-output=Unexpected output from executing the command {0}\n+error.command-failed-unexpected-exit-code=Unexpected exit code {0} from executing the command {1}\n+error.command-failed-timed-out=Timed-out command {0}\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources.properties","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -799,0 +799,4 @@\n+\n+        default String printableCommandLine() {\n+            return CommandLineFormat.DEFAULT.apply(commandLine());\n+        }\n@@ -815,5 +819,0 @@\n-\n-        @Override\n-        public String toString() {\n-            return CommandLineFormat.DEFAULT.apply(commandLine());\n-        }\n@@ -828,5 +827,0 @@\n-        @Override\n-        public String toString() {\n-            return CommandLineFormat.DEFAULT.apply(commandLine());\n-        }\n-\n@@ -840,5 +834,0 @@\n-        @Override\n-        public String toString() {\n-            return \"<unknown>\";\n-        }\n-\n@@ -847,1 +836,1 @@\n-            return List.of();\n+            return List.of(\"<unknown>\");\n@@ -872,0 +861,45 @@\n+        public static Builder build() {\n+            return new Builder();\n+        }\n+\n+        public static final class Builder {\n+\n+            public Result create() {\n+                return new Result(\n+                        exitCode,\n+                        Optional.ofNullable(content).map(List::copyOf).map(StringListContent::new).map(c -> {\n+                            return new CommandOutput<List<String>>(Optional.of(c), c.size(), true);\n+                        }),\n+                        Optional.empty(),\n+                        Optional.ofNullable(execAttrs).orElse(EMPTY_EXECUTABLE_ATTRIBUTES));\n+            }\n+\n+            public Builder exitCode(int v) {\n+                exitCode = Optional.of(v);\n+                return this;\n+            }\n+\n+            public Builder noExitCode() {\n+                exitCode = Optional.empty();\n+                return this;\n+            }\n+\n+            public Builder execAttrs(ExecutableAttributes v) {\n+                execAttrs = v;\n+                return this;\n+            }\n+\n+            public Builder content(List<String> v) {\n+                content = v;\n+                return this;\n+            }\n+\n+            public Builder content(String... v) {\n+                return content(List.of(v));\n+            }\n+\n+            private ExecutableAttributes execAttrs;\n+            private List<String> content;\n+            private Optional<Integer> exitCode = Optional.empty();\n+        }\n+\n@@ -1022,1 +1056,2 @@\n-            this(value, String.format(\"Unexpected result from executing the command %s\", value.execAttrs()));\n+            this(value, String.format(\"Unexpected result from executing the command %s\",\n+                    value.execAttrs().printableCommandLine()));\n@@ -1037,1 +1072,1 @@\n-            super(value, message);\n+            super(requireExitCode(value), message);\n@@ -1041,1 +1076,11 @@\n-            this(value, String.format(\"Unexpected exit code %d from executing the command %s\", value.getExitCode(), value.execAttrs()));\n+            this(value, String.format(\"Unexpected exit code %d from executing the command %s\",\n+                    requireExitCode(value).getExitCode(), value.execAttrs().printableCommandLine()));\n+        }\n+\n+        private static Result requireExitCode(Result v) {\n+            Objects.requireNonNull(v);\n+            if (v.exitCode().isPresent()) {\n+                return v;\n+            } else {\n+                throw new IllegalArgumentException();\n+            }\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/CommandOutputControl.java","additions":64,"deletions":19,"binary":false,"changes":83,"status":"modified"},{"patch":"@@ -286,1 +286,1 @@\n-                            base.execAttrs(), expectedExitCode));\n+                            base.execAttrs().printableCommandLine(), expectedExitCode));\n@@ -290,1 +290,1 @@\n-                            base.execAttrs(), expectedExitCodes.stream().sorted().toList()));\n+                            base.execAttrs().printableCommandLine(), expectedExitCodes.stream().sorted().toList()));\n@@ -305,1 +305,1 @@\n-            return base.execAttrs().toString();\n+            return base.execAttrs().printableCommandLine();\n@@ -518,1 +518,1 @@\n-    private record ExecutableAttributes(CommandOutputControl.ExecutableAttributes base, String toStringValue)\n+    private record ExecutableAttributes(CommandOutputControl.ExecutableAttributes base, String printableCommandLine)\n@@ -523,1 +523,1 @@\n-            if (toStringValue.isBlank()) {\n+            if (printableCommandLine.isBlank()) {\n@@ -528,5 +528,0 @@\n-        @Override\n-        public String toString() {\n-            return toStringValue;\n-        }\n-\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/Executor.java","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -118,0 +118,7 @@\n+        public Builder argsListener(Consumer<List<String>> listener) {\n+            Objects.requireNonNull(listener);\n+            return action(CommandActionSpec.create(\"args-listener\", context -> {\n+                listener.accept(context.args());\n+            }));\n+        }\n+\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/mock\/CommandActionSpecs.java","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,0 +25,1 @@\n+import static jdk.jpackage.internal.model.ExecutableAttributesWithCapturedOutput.augmentResultWithOutput;\n@@ -46,0 +47,1 @@\n+import java.util.spi.ToolProvider;\n@@ -49,0 +51,2 @@\n+import jdk.jpackage.internal.Globals;\n+import jdk.jpackage.internal.MockUtils;\n@@ -50,0 +54,1 @@\n+import jdk.jpackage.internal.model.ExecutableAttributesWithCapturedOutput;\n@@ -51,0 +56,3 @@\n+import jdk.jpackage.internal.util.CommandOutputControl;\n+import jdk.jpackage.internal.util.CommandOutputControl.UnexpectedExitCodeException;\n+import jdk.jpackage.internal.util.CommandOutputControl.UnexpectedResultException;\n@@ -52,0 +60,2 @@\n+import jdk.jpackage.test.Annotations;\n+import jdk.jpackage.test.JPackageCommand;\n@@ -54,0 +64,3 @@\n+import jdk.jpackage.test.mock.CommandActionSpecs;\n+import jdk.jpackage.test.mock.Script;\n+import jdk.jpackage.test.mock.VerbatimCommandMock;\n@@ -58,1 +71,1 @@\n-public class MainTest extends JUnitAdapter.TestSrcInitializer {\n+public class MainTest extends JUnitAdapter {\n@@ -81,0 +94,65 @@\n+    \/**\n+     * Run app image packaging and simulate jlink failure.\n+     * <p>\n+     * The test verifies that jpackage prints an error message with jlink exit code,\n+     * command line, and output.\n+     *\/\n+    @Annotations.Test\n+    public void testFailedCommandOutput() {\n+\n+        var jlinkMockExitCode = 17;\n+\n+        var jlinkArgs = new ArrayList<String>();\n+\n+        var jlinkMock = CommandActionSpecs.build()\n+                .stdout(\"It\").stderr(\"fell\").stdout(\"apart\")\n+                .argsListener(jlinkArgs::addAll)\n+                .exit(jlinkMockExitCode).create().toCommandMockBuilder().name(\"jlink-mock\").create();\n+\n+        var script = Script.build()\n+                \/\/ Replace jlink with the mock.\n+                .map(Script.cmdlineStartsWith(\"jlink\"), jlinkMock)\n+                \/\/ Don't mock other external commands.\n+                .map(_ -> true, VerbatimCommandMock.INSTANCE)\n+                .createLoop();\n+\n+        var jpackageExitCode = 1;\n+\n+        var jpackageToolProviderMock = new ToolProvider() {\n+            @Override\n+            public int run(PrintWriter out, PrintWriter err, String... args) {\n+                var globalsMutator = MockUtils.buildJPackage().script(script).createGlobalsMutator();\n+                return Globals.main(() -> {\n+                    globalsMutator.accept(Globals.instance());\n+\n+                    var result = ExecutionResult.create(args);\n+\n+                    var jlinkMockAttrs = new CommandOutputControl.ToolProviderAttributes(jlinkMock.name(), jlinkArgs);\n+\n+                    result.stdout().forEach(out::println);\n+                    result.stderr().forEach(err::println);\n+\n+                    assertEquals(jpackageExitCode, result.exitCode());\n+                    assertEquals(List.of(), result.stdout());\n+                    assertEquals(List.of(\n+                            I18N.format(\"message.error-header\", I18N.format(\"error.command-failed-unexpected-exit-code\",\n+                                    jlinkMockExitCode, jlinkMockAttrs.printableCommandLine())),\n+                            I18N.format(\"message.failed-command-output-header\"),\n+                            \"It\", \"fell\", \"apart\"), result.stderr());\n+\n+                    return jpackageExitCode;\n+                });\n+            }\n+\n+            @Override\n+            public String name() {\n+                return \"jpackage-mock\";\n+            }\n+        };\n+\n+        JPackageCommand.helloAppImage()\n+                .ignoreDefaultVerbose(true)\n+                .useToolProvider(jpackageToolProviderMock)\n+                .execute(jpackageExitCode);\n+    }\n+\n@@ -168,0 +246,43 @@\n+\n+            var execAttrs = new CommandOutputControl.ProcessAttributes(Optional.of(12345L), List.of(\"foo\", \"--bar\"));\n+            for (var makeCause : List.<UnaryOperator<Exception>>of(\n+                    ex -> ex,\n+                    ExceptionBox::toUnchecked\n+            )) {\n+\n+                for (var expect : List.of(\n+                        Map.entry(\n+                                augmentResultWithOutput(\n+                                        CommandOutputControl.Result.build().exitCode(135).execAttrs(execAttrs).create(),\n+                                        \"The quick brown fox\\njumps over the lazy dog\"\n+                                ).unexpected(\"Kaput!\"),\n+                                ExceptionFormatter.FAILED_COMMAND_UNEXPECTED_OUTPUT_MESSAGE\n+                        ),\n+                        Map.entry(\n+                                new UnexpectedExitCodeException(augmentResultWithOutput(\n+                                        CommandOutputControl.Result.build().exitCode(135).create(),\n+                                        \"The quick brown fox\\njumps\"\n+                                )),\n+                                ExceptionFormatter.FAILED_COMMAND_UNEXPECTED_EXIT_CODE_MESSAGE\n+                        ),\n+                        Map.entry(\n+                                augmentResultWithOutput(\n+                                        CommandOutputControl.Result.build().create(),\n+                                        \"The quick brown fox\\njumps\"\n+                                ).unexpected(\"Timed out!\"),\n+                                ExceptionFormatter.FAILED_COMMAND_TIMEDOUT_MESSAGE\n+                        )\n+                )) {\n+                    var cause = makeCause.apply(expect.getKey());\n+                    var expectedOutput = new ArrayList<ExceptionFormatter>();\n+                    if (verbose) {\n+                        expectedOutput.add(ExceptionFormatter.STACK_TRACE);\n+                    }\n+                    expectedOutput.add(expect.getValue());\n+                    if (!verbose) {\n+                        expectedOutput.add(ExceptionFormatter.FAILED_COMMAND_OUTPUT);\n+                    }\n+                    data.add(new ErrorReporterTestSpec(cause, expect.getKey(), verbose, expectedOutput));\n+                }\n+            }\n+\n@@ -353,1 +474,18 @@\n-        })\n+        }),\n+        FAILED_COMMAND_OUTPUT(ex -> {\n+            var result = failedCommandResult(ex);\n+            var commandOutput = ((ExecutableAttributesWithCapturedOutput)result.execAttrs()).printableOutput();\n+\n+            var sink = new StringWriter();\n+            var pw = new PrintWriter(sink);\n+\n+            pw.println(I18N.format(\"message.failed-command-output-header\"));\n+            try (var lines = new BufferedReader(new StringReader(commandOutput)).lines()) {\n+                lines.forEach(pw::println);\n+            }\n+\n+            return sink.toString();\n+        }),\n+        FAILED_COMMAND_UNEXPECTED_OUTPUT_MESSAGE(errorMessage(CommandFailureType.UNEXPECTED_OUTPUT::getMessage)),\n+        FAILED_COMMAND_UNEXPECTED_EXIT_CODE_MESSAGE(errorMessage(CommandFailureType.UNEXPECTED_EXIT_CODE::getMessage)),\n+        FAILED_COMMAND_TIMEDOUT_MESSAGE(errorMessage(CommandFailureType.TIMEDOUT::getMessage)),\n@@ -372,0 +510,36 @@\n+        private static CommandOutputControl.Result failedCommandResult(Exception ex) {\n+            Objects.requireNonNull(ex);\n+            if (ex instanceof UnexpectedResultException urex) {\n+                return urex.getResult();\n+            } else {\n+                throw new IllegalArgumentException();\n+            }\n+        }\n+\n+        private enum CommandFailureType {\n+            UNEXPECTED_OUTPUT,\n+            UNEXPECTED_EXIT_CODE,\n+            TIMEDOUT,\n+            ;\n+\n+            String getMessage(Exception ex) {\n+                var result = failedCommandResult(ex);\n+                var printableCommandLine = result.execAttrs().printableCommandLine();\n+                switch (this) {\n+                    case TIMEDOUT -> {\n+                        return I18N.format(\"error.command-failed-timed-out\", printableCommandLine);\n+                    }\n+                    case UNEXPECTED_EXIT_CODE -> {\n+                        return I18N.format(\"error.command-failed-unexpected-exit-code\", result.getExitCode(), printableCommandLine);\n+                    }\n+                    case UNEXPECTED_OUTPUT -> {\n+                        return I18N.format(\"error.command-failed-unexpected-output\", printableCommandLine);\n+                    }\n+                    default -> {\n+                        \/\/ Unreachable\n+                        throw ExceptionBox.reachedUnreachable();\n+                    }\n+                }\n+            }\n+        }\n+\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/cli\/MainTest.java","additions":177,"deletions":3,"binary":false,"changes":180,"status":"modified"},{"patch":"@@ -206,1 +206,1 @@\n-        assertEquals(\"runme --foo --baz=10\", exec.attributes().toString());\n+        assertEquals(\"runme --foo --baz=10\", exec.attributes().printableCommandLine());\n@@ -210,1 +210,1 @@\n-    public void test_Result_no_args_ctor() {\n+    public void test_Result_single_arg_ctor() {\n@@ -219,0 +219,12 @@\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_Result_unexpected(boolean customMessage) throws IOException {\n+        var result = new CommandOutputControl.Result(7);\n+\n+        if (customMessage) {\n+            assertEquals(\"Kaput!\", result.unexpected(\"Kaput!\").getMessage());\n+        } else {\n+            assertEquals(\"Unexpected result from executing the command <unknown>\", result.unexpected().getMessage());\n+        }\n+    }\n+\n@@ -279,5 +291,0 @@\n-            @Override\n-            public String toString() {\n-                return \"foo\";\n-            }\n-\n@@ -286,1 +293,1 @@\n-                return List.of();\n+                return List.of(\"foo\");\n@@ -298,0 +305,14 @@\n+    @Test\n+    public void test_UnexpectedExitCodeException_no_exit_code() {\n+\n+        var resultWithoutExitCode = CommandOutputControl.Result.build().create();\n+\n+        assertThrowsExactly(IllegalArgumentException.class, () -> {\n+            new CommandOutputControl.UnexpectedExitCodeException(resultWithoutExitCode);\n+        });\n+\n+        assertThrowsExactly(IllegalArgumentException.class, () -> {\n+            new CommandOutputControl.UnexpectedExitCodeException(resultWithoutExitCode, \"Kaput!\");\n+        });\n+    }\n+\n@@ -1784,1 +1805,1 @@\n-    private final static class InterruptibleToolProvider implements ToolProvider {\n+    private static final class InterruptibleToolProvider implements ToolProvider {\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/util\/CommandOutputControlTest.java","additions":30,"deletions":9,"binary":false,"changes":39,"status":"modified"}]}