{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,4 @@\n+    if (NET_PlatformInit() != 0) {\n+      return JNI_ERR;\n+    }\n+\n","filename":"src\/java.base\/share\/native\/libnet\/net_util.c","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -158,0 +158,2 @@\n+int NET_PlatformInit();\n+\n","filename":"src\/java.base\/share\/native\/libnet\/net_util.h","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,0 +53,9 @@\n+\/* Perform platform specific initialization.\n+ * Returns 0 on success, non-0 on failure *\/\n+int\n+NET_PlatformInit()\n+{\n+    \/\/ Not needed on unix\n+    return 0;\n+}\n+\n","filename":"src\/java.base\/unix\/native\/libnet\/net_util_md.c","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -104,5 +104,1 @@\n-\/*\n- * Initialize Windows Sockets API support\n- *\/\n-BOOL WINAPI\n-DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved)\n+static void at_exit_callback(void)\n@@ -110,1 +106,2 @@\n-    WSADATA wsadata;\n+    WSACleanup();\n+}\n@@ -112,6 +109,6 @@\n-    switch (reason) {\n-        case DLL_PROCESS_ATTACH:\n-            if (WSAStartup(MAKEWORD(2,2), &wsadata) != 0) {\n-                return FALSE;\n-            }\n-            break;\n+\/* Perform platform specific initialization.\n+ * Returns 0 on success, non-0 on failure *\/\n+int\n+NET_PlatformInit()\n+{\n+    WSADATA wsadata;\n@@ -119,3 +116,1 @@\n-        case DLL_PROCESS_DETACH:\n-            WSACleanup();\n-            break;\n+    atexit(at_exit_callback);\n@@ -123,4 +118,1 @@\n-        default:\n-            break;\n-    }\n-    return TRUE;\n+    return WSAStartup(MAKEWORD(2,2), &wsadata);\n","filename":"src\/java.base\/windows\/native\/libnet\/net_util_md.c","additions":11,"deletions":19,"binary":false,"changes":30,"status":"modified"}]}