{"files":[{"patch":"@@ -6331,27 +6331,0 @@\n-\/\/ Special prefetch versions which use the dcbz instruction.\n-instruct prefetch_alloc_zero(indirectMemory mem, iRegLsrc src) %{\n-  match(PrefetchAllocation (AddP mem src));\n-  predicate(AllocatePrefetchStyle == 3);\n-  ins_cost(MEMORY_REF_COST);\n-\n-  format %{ \"PREFETCH $mem, 2, $src \\t\/\/ Prefetch write-many with zero\" %}\n-  size(4);\n-  ins_encode %{\n-    __ dcbz($src$$Register, $mem$$base$$Register);\n-  %}\n-  ins_pipe(pipe_class_memory);\n-%}\n-\n-instruct prefetch_alloc_zero_no_offset(indirectMemory mem) %{\n-  match(PrefetchAllocation mem);\n-  predicate(AllocatePrefetchStyle == 3);\n-  ins_cost(MEMORY_REF_COST);\n-\n-  format %{ \"PREFETCH $mem, 2 \\t\/\/ Prefetch write-many with zero\" %}\n-  size(4);\n-  ins_encode %{\n-    __ dcbz($mem$$base$$Register);\n-  %}\n-  ins_pipe(pipe_class_memory);\n-%}\n-\n@@ -6360,1 +6333,0 @@\n-  predicate(AllocatePrefetchStyle != 3);\n@@ -6373,1 +6345,0 @@\n-  predicate(AllocatePrefetchStyle != 3);\n","filename":"src\/hotspot\/cpu\/ppc\/ppc.ad","additions":0,"deletions":29,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -40,1 +40,0 @@\n-int          ThreadLocalAllocBuffer::_reserve_for_allocation_prefetch = 0;\n@@ -228,24 +227,0 @@\n-#ifdef COMPILER2\n-  \/\/ If the C2 compiler is present, extra space is needed at the end of\n-  \/\/ TLABs, otherwise prefetching instructions generated by the C2\n-  \/\/ compiler will fault (due to accessing memory outside of heap).\n-  \/\/ The amount of space is the max of the number of lines to\n-  \/\/ prefetch for array and for instance allocations. (Extra space must be\n-  \/\/ reserved to accommodate both types of allocations.)\n-  \/\/\n-  \/\/ Only SPARC-specific BIS instructions are known to fault. (Those\n-  \/\/ instructions are generated if AllocatePrefetchStyle==3 and\n-  \/\/ AllocatePrefetchInstr==1). To be on the safe side, however,\n-  \/\/ extra space is reserved for all combinations of\n-  \/\/ AllocatePrefetchStyle and AllocatePrefetchInstr.\n-  \/\/\n-  \/\/ If the C2 compiler is not present, no space is reserved.\n-\n-  \/\/ +1 for rounding up to next cache line, +1 to be safe\n-  if (CompilerConfig::is_c2_or_jvmci_compiler_enabled()) {\n-    int lines =  MAX2(AllocatePrefetchLines, AllocateInstancePrefetchLines) + 2;\n-    _reserve_for_allocation_prefetch = (AllocatePrefetchDistance + AllocatePrefetchStepSize * lines) \/\n-                                       (int)HeapWordSize;\n-  }\n-#endif\n-\n@@ -457,2 +432,1 @@\n-  size_t reserve_size = CollectedHeap::lab_alignment_reserve();\n-  return MAX2(reserve_size, (size_t)_reserve_for_allocation_prefetch);\n+  return CollectedHeap::lab_alignment_reserve();\n","filename":"src\/hotspot\/share\/gc\/shared\/threadLocalAllocBuffer.cpp","additions":1,"deletions":27,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -61,1 +61,0 @@\n-  static int      _reserve_for_allocation_prefetch;   \/\/ Reserve at the end of the TLAB\n","filename":"src\/hotspot\/share\/gc\/shared\/threadLocalAllocBuffer.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1917,2 +1917,1 @@\n-      \/\/ Address is aligned to execute prefetch to the beginning of cache line size\n-      \/\/ (it is important when BIS instruction is used on SPARC as prefetch).\n+      \/\/ Address is aligned to execute prefetch to the beginning of cache line size.\n","filename":"src\/hotspot\/share\/opto\/macro.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -353,1 +353,0 @@\n-     static_field(ThreadLocalAllocBuffer,      _reserve_for_allocation_prefetch,              int)                                   \\\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -79,1 +79,0 @@\n-    long reserveForAllocationPrefetch = VM.getVM().getReserveForAllocationPrefetch();\n@@ -82,1 +81,1 @@\n-    return Math.max(labAlignmentReserve, reserveForAllocationPrefetch) * heapWordSize;\n+    return labAlignmentReserve * heapWordSize;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/ThreadLocalAllocBuffer.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -126,1 +126,0 @@\n-  private int          reserveForAllocationPrefetch;\n@@ -450,2 +449,0 @@\n-    CIntegerField reserveForAllocationPrefetchField = threadLocalAllocBuffer.getCIntegerField(\"_reserve_for_allocation_prefetch\");\n-    reserveForAllocationPrefetch = (int)reserveForAllocationPrefetchField.getCInteger(intType);\n@@ -918,4 +915,0 @@\n-  public int getReserveForAllocationPrefetch() {\n-    return reserveForAllocationPrefetch;\n-  }\n-\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/VM.java","additions":0,"deletions":7,"binary":false,"changes":7,"status":"modified"}]}