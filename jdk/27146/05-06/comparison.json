{"files":[{"patch":"@@ -34,0 +34,1 @@\n+import sun.security.provider.certpath.AlgorithmChecker;\n@@ -228,0 +229,2 @@\n+\n+            constraintsCertChainCheck(constraints, trustedChain);\n@@ -271,0 +274,2 @@\n+\n+            constraintsCertChainCheck(constraints, trustedChain);\n@@ -455,0 +460,23 @@\n+\n+    \/\/ Additional certificate chain check to verify the signature\n+    \/\/ algorithms with the corresponding signing keys.\n+    private void constraintsCertChainCheck(\n+            AlgorithmConstraints constraints, X509Certificate[] chain)\n+            throws CertificateException {\n+\n+        \/\/ Omit checks if EE cert is also a trust anchor\n+        if (chain.length > 1) {\n+            AlgorithmChecker checker = new AlgorithmChecker(\n+                    new TrustAnchor(chain[chain.length - 1], null),\n+                    constraints, null, null);\n+            try {\n+                checker.init(false);\n+\n+                for (int i = chain.length - 2; i >= 0; i--) {\n+                    checker.check(chain[i], Collections.emptySet());\n+                }\n+            } catch (CertPathValidatorException e) {\n+                throw new CertificateException(e);\n+            }\n+        }\n+    }\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/X509TrustManagerImpl.java","additions":28,"deletions":0,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -139,0 +139,21 @@\n+\n+        \/\/ Disable KeyManager's algorithm constraints checking and\n+        \/\/ check against TrustManager's local supported signature\n+        \/\/ algorithms on the client side.\n+        System.setProperty(\n+                \"jdk.tls.SunX509KeyManager.certChecking\", \"false\");\n+\n+        for (String protocol : new String[]{\"TLSv1.3\", \"TLSv1.2\"}) {\n+            var test = new RsaSsaPssConstraints(protocol, keyAlg, certSigAlg);\n+\n+            if (fail) {\n+                runAndCheckException(test::run,\n+                        serverEx -> {\n+                            Throwable clientEx = serverEx.getSuppressed()[0];\n+                            assertTrue(\n+                                    clientEx instanceof SSLHandshakeException);\n+                        });\n+            } else {\n+                test.run();\n+            }\n+        }\n@@ -219,1 +240,1 @@\n-                \"O=Some-Org, L=Some-City, ST=Some-State, C=US\"));\n+                \"O=Trusted-Org, L=Some-City, ST=Some-State, C=US\"));\n","filename":"test\/jdk\/sun\/security\/ssl\/SignatureScheme\/RsaSsaPssConstraints.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"}]}