{"files":[{"patch":"@@ -375,2 +375,1 @@\n-            return supportedAlgorithms.contains(algorithm)\n-                    && checkRsaSsaPssParams(algorithm, parameters);\n+            return supportedAlgorithms.contains(algorithm);\n@@ -393,1 +392,2 @@\n-            return permits(primitives, algorithm, parameters);\n+            return permits(primitives, algorithm, parameters)\n+                    && checkRsaSsaPssParams(algorithm, key, parameters);\n@@ -396,1 +396,1 @@\n-        \/\/ Additional check for RSASSA-PSS algorithm parameters.\n+        \/\/ Additional check for RSASSA-PSS signature algorithm parameters.\n@@ -398,1 +398,1 @@\n-                String algorithm, AlgorithmParameters parameters) {\n+                String algorithm, Key key, AlgorithmParameters parameters) {\n@@ -401,0 +401,1 @@\n+                    || key == null\n@@ -407,1 +408,1 @@\n-                String paramKeyAlg = parameters.getAlgorithm();\n+                String keyAlg = key.getAlgorithm();\n@@ -413,1 +414,1 @@\n-                                && ss.keyAlgorithm.equalsIgnoreCase(paramKeyAlg)\n+                                && ss.keyAlgorithm.equalsIgnoreCase(keyAlg)\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLAlgorithmConstraints.java","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -65,11 +65,17 @@\n- * @run main\/othervm RsaSsaPssConstraints Rsa_pss_pss_Sha384 true\n- * @run main\/othervm RsaSsaPssConstraints RsaSsa-Pss true\n- * @run main\/othervm RsaSsaPssConstraints rsa_pss_pss_sha256 false\n- * @run main\/othervm RsaSsaPssConstraints rsa_pss_pss_sha512 false\n- * @run main\/othervm RsaSsaPssConstraints rsa_pss_rsae_sha256 false\n- * @run main\/othervm RsaSsaPssConstraints rsa_pss_rsae_sha384 false\n- * @run main\/othervm RsaSsaPssConstraints rsa_pss_rsae_sha512 false\n- * @run main\/othervm RsaSsaPssConstraints rsa_pkcs1_sha384 false\n- * @run main\/othervm RsaSsaPssConstraints SHA384withRSA false\n- * @run main\/othervm RsaSsaPssConstraints SHA384withECDSA false\n- * @run main\/othervm RsaSsaPssConstraints RSA false\n+ * @run main\/othervm RsaSsaPssConstraints RSASSA-PSS RSASSA-PSS Rsa_pss_pss_Sha384 true\n+ * @run main\/othervm RsaSsaPssConstraints RSASSA-PSS RSASSA-PSS RsaSsa-Pss true\n+ * @run main\/othervm RsaSsaPssConstraints RSA RSASSA-PSS rsa_pss_Rsae_sha384 true\n+ * @run main\/othervm RsaSsaPssConstraints RSA RSASSA-PSS Rsa true\n+ * @run main\/othervm RsaSsaPssConstraints RSA RSASSA-PSS RSASSA-pSS true\n+ * @run main\/othervm RsaSsaPssConstraints RSA SHA384withRSA rsa_pkcs1_Sha384 true\n+ * @run main\/othervm RsaSsaPssConstraints EC SHA384withECDSA Ecdsa_Secp384r1_sha384 true\n+ * @run main\/othervm RsaSsaPssConstraints RSA SHA384withRSA SHA384withRsA true\n+ * @run main\/othervm RsaSsaPssConstraints RSASSA-PSS RSASSA-PSS rsa_pss_rsae_sha384 false\n+ * @run main\/othervm RsaSsaPssConstraints RSA RSASSA-PSS rsa_pss_pss_sha384 false\n+ * @run main\/othervm RsaSsaPssConstraints RSASSA-PSS RSASSA-PSS rsa_pss_pss_sha256 false\n+ * @run main\/othervm RsaSsaPssConstraints RSASSA-PSS RSASSA-PSS rsa_pss_pss_sha512 false\n+ * @run main\/othervm RsaSsaPssConstraints RSASSA-PSS RSASSA-PSS RSA false\n+ * @run main\/othervm RsaSsaPssConstraints RSA RSASSA-PSS rsa_pss_rsae_sha512 false\n+ * @run main\/othervm RsaSsaPssConstraints RSA SHA384withRSA rsa_pkcs1_sha256 false\n+ * @run main\/othervm RsaSsaPssConstraints EC SHA384withECDSA ecdsa_secp256r1_sha256 false\n+ * @run main\/othervm RsaSsaPssConstraints EC SHA384withECDSA SHA512withECDSA false\n@@ -80,3 +86,0 @@\n-    private static final String KEY_ALGORITHM = \"RSASSA-PSS\";\n-    private static final String CERT_SIG_ALG = \"RSASSA-PSS\";\n-\n@@ -84,0 +87,2 @@\n+    private final String keyAlg;\n+    private final String certSigAlg;\n@@ -90,2 +95,3 @@\n-    protected RsaSsaPssConstraints(String protocol)\n-            throws Exception {\n+    protected RsaSsaPssConstraints(\n+            String protocol, String keyAlg,\n+            String certSigAlg) throws Exception {\n@@ -94,0 +100,2 @@\n+        this.keyAlg = keyAlg;\n+        this.certSigAlg = certSigAlg;\n@@ -98,1 +106,1 @@\n-        if (args.length != 2) {\n+        if (args.length != 4) {\n@@ -102,2 +110,4 @@\n-        String algo = args[0];\n-        boolean fail = Boolean.parseBoolean(args[1]);\n+        String keyAlg = args[0];\n+        String certSigAlg = args[1];\n+        String constraintAlgo = args[2];\n+        boolean fail = Boolean.parseBoolean(args[3]);\n@@ -108,1 +118,1 @@\n-                algo + \" usage CertificateSignature\");\n+                constraintAlgo + \" usage CertificateSignature\");\n@@ -110,2 +120,2 @@\n-        for (String protocol : new String[]{\"TLS\", \"TLSv1.2\"}) {\n-            var test = new RsaSsaPssConstraints(protocol);\n+        for (String protocol : new String[]{\"TLSv1.3\", \"TLSv1.2\"}) {\n+            var test = new RsaSsaPssConstraints(protocol, keyAlg, certSigAlg);\n@@ -181,1 +191,1 @@\n-        KeyPairGenerator kpg = KeyPairGenerator.getInstance(KEY_ALGORITHM);\n+        KeyPairGenerator kpg = KeyPairGenerator.getInstance(keyAlg);\n@@ -186,1 +196,1 @@\n-        this.trustedCert = createTrustedCert(caKeys);\n+        this.trustedCert = createTrustedCert(caKeys, certSigAlg);\n@@ -192,1 +202,1 @@\n-                .build(trustedCert, caKeys.getPrivate(), CERT_SIG_ALG);\n+                .build(trustedCert, caKeys.getPrivate(), certSigAlg);\n@@ -198,1 +208,1 @@\n-                .build(trustedCert, caKeys.getPrivate(), CERT_SIG_ALG);\n+                .build(trustedCert, caKeys.getPrivate(), certSigAlg);\n@@ -201,1 +211,2 @@\n-    private static X509Certificate createTrustedCert(KeyPair caKeys)\n+    private static X509Certificate createTrustedCert(\n+            KeyPair caKeys, String certSigAlg)\n@@ -219,1 +230,1 @@\n-                .build(null, caKeys.getPrivate(), CERT_SIG_ALG);\n+                .build(null, caKeys.getPrivate(), certSigAlg);\n","filename":"test\/jdk\/sun\/security\/ssl\/SignatureScheme\/RsaSsaPssConstraints.java","additions":39,"deletions":28,"binary":false,"changes":67,"status":"modified"}]}