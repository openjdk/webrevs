{"files":[{"patch":"@@ -59,0 +59,1 @@\n+@property (readwrite, atomic) int displayLinkFailCount;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLLayer.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+#define CV_DISPLAYLINK_FAIL_DELAY 1.0\n@@ -47,0 +48,1 @@\n+@synthesize displayLinkFailCount;\n@@ -49,3 +51,19 @@\n-    CVDisplayLinkCreateWithActiveCGDisplays(&displayLink);\n-    CVDisplayLinkSetOutputCallback(displayLink, &displayLinkCallback, (__bridge void*)self);\n-    self.displayLinkCount = 0;\n+    CVReturn r = CVDisplayLinkCreateWithActiveCGDisplays(&displayLink);\n+    if (r != kCVReturnSuccess) {\n+        if (self.displayLinkFailCount == 5) {\n+            \/\/ We have tried for 5 seconds to create CVDisplayLink\n+            J2dTraceLn(J2D_TRACE_ERROR,\n+                \"MTLLayer.createDisplayLink --- unable to create CVDisplayLink.\");\n+            self.displayLinkFailCount = 0;\n+            return;\n+        }\n+        self.displayLinkFailCount++;\n+        [self performSelector:@selector(createDisplayLink)\n+                   withObject:nil\n+                   afterDelay:CV_DISPLAYLINK_FAIL_DELAY];\n+        return;\n+    } else {\n+        CVDisplayLinkSetOutputCallback(displayLink, &displayLinkCallback, (__bridge void*)self);\n+        self.displayLinkCount = 0;\n+        self.displayLinkFailCount = 0;\n+    }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLLayer.m","additions":21,"deletions":3,"binary":false,"changes":24,"status":"modified"}]}