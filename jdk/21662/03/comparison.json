{"files":[{"patch":"@@ -94,0 +94,1 @@\n+     static_field(CollectedHeap,               _lab_alignment_reserve,                        size_t)                                \\\n","filename":"src\/hotspot\/share\/gc\/shared\/vmStructs_gc.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -78,1 +78,1 @@\n-    long minFillerArraySize = Array.baseOffsetInBytes(BasicType.T_INT);\n+    long labAlignmentReserve = VM.getVM().getLabAlignmentReserve();\n@@ -82,1 +82,1 @@\n-    return Math.max(minFillerArraySize, reserveForAllocationPrefetch * heapWordSize);\n+    return Math.max(labAlignmentReserve, reserveForAllocationPrefetch) * heapWordSize;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/ThreadLocalAllocBuffer.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -130,0 +130,1 @@\n+  private int          labAlignmentReserve;\n@@ -141,6 +142,6 @@\n-  private static Type intType;\n-  private static Type uintType;\n-  private static Type intxType;\n-  private static Type uintxType;\n-  private static Type sizetType;\n-  private static Type uint64tType;\n+  private static CIntegerType intType;\n+  private static CIntegerType uintType;\n+  private static CIntegerType intxType;\n+  private static CIntegerType uintxType;\n+  private static CIntegerType sizetType;\n+  private static CIntegerType uint64tType;\n@@ -435,5 +436,0 @@\n-\n-       Type threadLocalAllocBuffer = db.lookupType(\"ThreadLocalAllocBuffer\");\n-       CIntegerType intType = (CIntegerType) db.lookupType(\"int\");\n-       CIntegerField reserveForAllocationPrefetchField = threadLocalAllocBuffer.getCIntegerField(\"_reserve_for_allocation_prefetch\");\n-       reserveForAllocationPrefetch = (int)reserveForAllocationPrefetchField.getCInteger(intType);\n@@ -446,0 +442,17 @@\n+    \/\/ Initialize common primitive types\n+    intType = (CIntegerType) db.lookupType(\"int\");\n+    uintType = (CIntegerType) db.lookupType(\"uint\");\n+    intxType = (CIntegerType) db.lookupType(\"intx\");\n+    uintxType = (CIntegerType) db.lookupType(\"uintx\");\n+    sizetType = (CIntegerType) db.lookupType(\"size_t\");\n+    uint64tType = (CIntegerType) db.lookupType(\"uint64_t\");\n+    boolType = (CIntegerType) db.lookupType(\"bool\");\n+\n+    Type threadLocalAllocBuffer = db.lookupType(\"ThreadLocalAllocBuffer\");\n+    CIntegerField reserveForAllocationPrefetchField = threadLocalAllocBuffer.getCIntegerField(\"_reserve_for_allocation_prefetch\");\n+    reserveForAllocationPrefetch = (int)reserveForAllocationPrefetchField.getCInteger(intType);\n+\n+    Type collectedHeap = db.lookupType(\"CollectedHeap\");\n+    CIntegerField labAlignmentReserveField = collectedHeap.getCIntegerField(\"_lab_alignment_reserve\");\n+    labAlignmentReserve = (int)labAlignmentReserveField.getCInteger(sizetType);\n+\n@@ -496,8 +509,0 @@\n-    intType = db.lookupType(\"int\");\n-    uintType = db.lookupType(\"uint\");\n-    intxType = db.lookupType(\"intx\");\n-    uintxType = db.lookupType(\"uintx\");\n-    sizetType = db.lookupType(\"size_t\");\n-    uint64tType = db.lookupType(\"uint64_t\");\n-    boolType = (CIntegerType) db.lookupType(\"bool\");\n-\n@@ -932,0 +937,4 @@\n+  public int getLabAlignmentReserve() {\n+    return labAlignmentReserve;\n+  }\n+\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/VM.java","additions":28,"deletions":19,"binary":false,"changes":47,"status":"modified"}]}