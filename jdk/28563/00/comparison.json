{"files":[{"patch":"@@ -159,1 +159,2 @@\n-  if (JfrRecorder::is_recording()) {\n+  assert(!JfrRecorder::is_recording(), \"JFR should be stopped at error reporting\");\n+  if (JfrRecorder::is_recording_stopped_with_error()) {\n","filename":"src\/hotspot\/share\/jfr\/jfr.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -486,0 +486,4 @@\n+bool JfrRecorder::is_recording_stopped_with_error() {\n+  return JfrRecorderService::is_recording_stopped_with_error();\n+}\n+\n","filename":"src\/hotspot\/share\/jfr\/recorder\/jfrRecorder.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -73,0 +73,1 @@\n+  static bool is_recording_stopped_with_error();\n","filename":"src\/hotspot\/share\/jfr\/recorder\/jfrRecorder.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -53,0 +53,1 @@\n+static char _dumped_file[JVM_MAXPATHLEN] = { 0 };\n@@ -102,1 +103,6 @@\n-  return emergency_fd != invalid_fd;\n+  if (emergency_fd != invalid_fd) {\n+    strncpy(_dumped_file, path, JVM_MAXPATHLEN - 1);\n+    return true;\n+  } else {\n+    return false;\n+  }\n@@ -153,1 +159,1 @@\n-    st->print_raw_cr(_path_buffer);\n+    st->print_raw_cr(_dumped_file);\n@@ -185,1 +191,1 @@\n-    report(st, open_emergency_dump_file(), repository_path);\n+    report(st, *_dumped_file != '\\0', repository_path);\n","filename":"src\/hotspot\/share\/jfr\/recorder\/repository\/jfrEmergencyDump.cpp","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -400,0 +400,1 @@\n+  STOPPED_WITH_ERROR,\n@@ -428,0 +429,4 @@\n+bool JfrRecorderService::is_recording_stopped_with_error() {\n+  return recorder_state == STOPPED_WITH_ERROR;\n+}\n+\n@@ -512,0 +517,1 @@\n+    set_recorder_state(STOPPED, STOPPED_WITH_ERROR);\n","filename":"src\/hotspot\/share\/jfr\/recorder\/service\/jfrRecorderService.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -77,0 +77,1 @@\n+  static bool is_recording_stopped_with_error();\n","filename":"src\/hotspot\/share\/jfr\/recorder\/service\/jfrRecorderService.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1748,0 +1748,4 @@\n+    \/\/ Jfr::on_vm_shutdown should be called before installing crash handler for error reporting\n+    \/\/ because LeakProfiler::emit_events() would kick both VM Operation and long-running execution.\n+    JFR_ONLY(Jfr::on_vm_shutdown(static_cast<VMErrorType>(_id) == OOM_JAVA_HEAP_FATAL, true);)\n+\n@@ -1901,2 +1905,0 @@\n-  JFR_ONLY(Jfr::on_vm_shutdown(static_cast<VMErrorType>(_id) == OOM_JAVA_HEAP_FATAL, true);)\n-\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -751,1 +751,0 @@\n-jdk\/jfr\/event\/oldobject\/TestEmergencyDumpAtOOM.java             8371014 aix-ppc64,linux-ppc64le\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}