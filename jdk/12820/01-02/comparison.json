{"files":[{"patch":"@@ -84,1 +84,3 @@\n-        \/\/ agent.getTypeDataBase() returns HotSpotTypeDataBase (extends BasicTypeDataBase)\n+        \/\/ TypeDataBase knows nothing about vtables,\n+        \/\/ but actually agent.getTypeDataBase() returns HotSpotTypeDataBase (extends BasicTypeDataBase)\n+        \/\/ and BasicTypeDataBase has a method to get vtable for Types.\n@@ -87,2 +89,2 @@\n-        int no_vtable = 0;\n-        int no_vtable_with_super = 0;\n+        int vm_classes_with_vtable = 0;\n+        int vm_classes_without_vtable = 0;\n@@ -94,1 +96,1 @@\n-                no_vtable++;\n+                vm_classes_with_vtable++;\n@@ -105,8 +107,11 @@\n-            if (vtable == null && t.getSuperclass() != null) {\n-                no_vtable_with_super++;\n-                log(\"WARNING: vtable is null for \" + type2String(t)\n-                    + \", CInt: \" + t.isCIntegerType()\n-                    + \", CStr: \" + t.isCStringType()\n-                    + \", JPrimitive: \" + t.isJavaPrimitiveType()\n-                    + \", Oop: \" + t.isOopType()\n-                    + \", Ptr: \" + t.isPointerType());\n+            \/\/ IntegerType\/StringType\/JavaPrimitiveType\/OopType\/PointerType types\n+            \/\/ are expected to have no vtable.\n+            \/\/ Log classes which might need vtable.\n+            if (vtable == null\n+                    && !t.isCIntegerType()\n+                    && !t.isCStringType()\n+                    && !t.isJavaPrimitiveType()\n+                    && !t.isOopType()\n+                    && !t.isPointerType()) {\n+                vm_classes_without_vtable++;\n+                log(\"vtable is null for \" + type2String(t));\n@@ -115,2 +120,3 @@\n-        log(\"total: \" + total + \", no vtable: \" + no_vtable\n-            + \", no_vtable_with_super: \" + no_vtable_with_super);\n+        log(\"total: \" + total\n+            + \", vm_classes_with_vtable: \" + vm_classes_with_vtable\n+            + \", vm_classes_without_vtable: \" + vm_classes_without_vtable);\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/UniqueVtableTest.java","additions":20,"deletions":14,"binary":false,"changes":34,"status":"modified"}]}