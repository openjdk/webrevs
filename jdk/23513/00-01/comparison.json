{"files":[{"patch":"@@ -100,7 +100,24 @@\n-  bool is_async_log_thread = this_thread != nullptr && alw == this_thread;\n-  bool is_recursively_logging = this_thread != nullptr && holding_thread == this_thread;\n-  assert(!is_recursively_logging, \"Do not log while holding the Async log lock\");\n-  return is_async_log_thread    ||  \/\/ The async log producer is attempting to log, leading to recursive logging.\n-         is_recursively_logging ||  \/\/ A thread enqueuing a message has attempted to log something.\n-         alw == nullptr         ||  \/\/ There is no AsyncLogWriter instance yet.\n-         this_thread == nullptr;    \/\/ The current thread is unattached.\n+  if (this_thread == nullptr) {\n+    \/\/ The current thread is unattached.\n+    return true;\n+  }\n+  \n+  if (holding_thread == this_thread) {\n+    \/\/ A thread, while enqueuing a message, has attempted to log something.\n+    \/\/ Do not log while holding the Async log lock.\n+    \/\/ Try to catch possible occurrences in debug builds.\n+    DEBUG_ONLY(ShouldNotReachHere();)\n+    return true;\n+  }\n+  \n+  if (alw == nullptr) {\n+    \/\/ There is no AsyncLogWriter instance yet.\n+    return true;\n+  }\n+  \n+  if (this_thread == alw) {\n+    \/\/ The async log producer is attempting to log, leading to recursive logging.\n+    return true;\n+  }\n+  \n+  return false;\n@@ -125,0 +142,2 @@\n+  \n+  \/\/ If we get here we know the AsyncLogWriter is initialized.\n","filename":"src\/hotspot\/share\/logging\/logAsyncWriter.cpp","additions":26,"deletions":7,"binary":false,"changes":33,"status":"modified"}]}