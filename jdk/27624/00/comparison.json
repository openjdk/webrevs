{"files":[{"patch":"@@ -832,0 +832,13 @@\n+    private static void outdatedKeyStoreLog(String type) {\n+        if (type != null && kdebug != null &&\n+                (type.equalsIgnoreCase(\"JKS\") ||\n+                type.equalsIgnoreCase(\"JCEKS\"))) {\n+            kdebug.println(\"WARNING: \" + type.toUpperCase(Locale.ROOT) +\n+                    \" uses outdated cryptographic algorithm and\" +\n+                    \" will be removed in a future release.\" +\n+                    \" Migrate to PKCS12 using:\\n\" +\n+                    \"keytool -importkeystore -srckeystore <keystore>\" +\n+                    \" -destkeystore <keystore> -deststoretype pkcs12\");\n+        }\n+    }\n+\n@@ -889,0 +902,1 @@\n+            outdatedKeyStoreLog(type);\n@@ -954,0 +968,1 @@\n+            outdatedKeyStoreLog(type);\n@@ -1015,0 +1030,1 @@\n+            outdatedKeyStoreLog(type);\n@@ -1894,0 +1910,2 @@\n+\n+                outdatedKeyStoreLog(keystore.getType());\n","filename":"src\/java.base\/share\/classes\/java\/security\/KeyStore.java","additions":18,"deletions":0,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -324,1 +324,2 @@\n-jks.storetype.warning=The %1$s keystore uses a proprietary format. It is recommended to migrate to PKCS12 which is an industry standard format using \"keytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\".\n+jks.storetype.warning=%1$s uses outdated cryptographic algorithms and will be removed in a future release. Migrate to PKCS12 using:\\n\\\n+keytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/resources\/keytool.properties","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -170,0 +170,1 @@\n+    String realStoreType;\n@@ -243,0 +244,1 @@\n+    private boolean outdatedFormat = false;\n@@ -1485,0 +1487,6 @@\n+        if (outdatedFormat) {\n+            warnings.add(String.format(rb.getString(\n+                    \"outdated.storetype.warning\"),\n+                    realStoreType, keystore));\n+        }\n+\n@@ -2403,0 +2411,10 @@\n+            File storeFile = new File(keyStoreName);\n+            if (storeFile.isFile()) {\n+                KeyStore keyStore = KeyStore.getInstance(storeFile, storepass);\n+                realStoreType = keyStore.getType();\n+                if (realStoreType.equalsIgnoreCase(\"JKS\")\n+                        || realStoreType.equalsIgnoreCase(\"JCEKS\")) {\n+                    outdatedFormat = true;\n+                }\n+            }\n+\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/security\/tools\/jarsigner\/Main.java","additions":18,"deletions":0,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -225,0 +225,2 @@\n+outdated.storetype.warning=%1$s uses outdated cryptographic algorithms and will be removed in a future release. Migrate to PKCS12 using:\\n\\\n+keytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/security\/tools\/jarsigner\/resources\/jarsigner.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,152 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.PrintStream;\n+import java.security.KeyStore;\n+import java.security.Provider;\n+import java.security.Security;\n+import java.util.Locale;\n+\n+\/*\n+ * @test\n+ * @bug 8353749\n+ * @summary Check warnings for JKS and JCEKS KeyStore\n+ * @run main\/othervm -Djava.security.debug=keystore TestOutdatedKeyStore\n+ *\/\n+\n+public class TestOutdatedKeyStore {\n+\n+    private static final String[] KS_TYPES = {\n+            \"jks\", \"jceks\"\n+    };\n+\n+    private static final String KS_WARNING1 =\n+            \"uses outdated cryptographic algorithm and will be removed \" +\n+            \"in a future release. Migrate to PKCS12 using:\";\n+\n+    private static final String KS_WARNING2=\n+            \"keytool -importkeystore -srckeystore <keystore> \" +\n+            \"-destkeystore <keystore> -deststoretype pkcs12\";\n+\n+    public static void main(String[] args) throws Exception {\n+        for (String type : KS_TYPES) {\n+            testGetInstance1(type);\n+            testGetInstance2(type);\n+            testGetInstance3(type);\n+            testGetInstance4(type);\n+            testGetInstance5(type);\n+        }\n+        System.out.println(\"All tests completed.\");\n+    }\n+\n+    \/\/ Test getInstance(String type)\n+    private static void testGetInstance1(String type) throws Exception {\n+        System.out.println(\"Test getInstance(String type) with type: \"\n+                + type);\n+        checkWarnings(type, () -> {\n+            KeyStore ks = KeyStore.getInstance(type);\n+        });\n+    }\n+\n+    \/\/ Test getInstance(String type, String provider)\n+    private static void testGetInstance2(String type) throws Exception {\n+        System.out.println(\"Test getInstance(String type, String provider) with type: \"\n+                + type);\n+        String provider = Security.getProviders(\"KeyStore.\" + type)[0].getName();\n+        checkWarnings(type, () -> {\n+            KeyStore ks = KeyStore.getInstance(type, provider);\n+        });\n+    }\n+\n+    \/\/ Test getInstance(String type, Provider provider)\n+    private static void testGetInstance3(String type) throws Exception {\n+        System.out.println(\"Test getInstance(String type, Provider provider) with type: \"\n+                + type);\n+        Provider provider = Security.getProviders(\"KeyStore.\" + type)[0];\n+        checkWarnings(type, () -> {\n+            KeyStore ks = KeyStore.getInstance(type, provider);\n+        });\n+    }\n+\n+    \/\/ Test getInstance(File file, char[] password)\n+    private static void testGetInstance4(String type) throws Exception {\n+        System.out.println(\"Test getInstance(File file, char[] password) with type: \"\n+                + type);\n+        File ksFile = createKeystore(type);\n+        checkWarnings(type, () -> {\n+            KeyStore ks = KeyStore.getInstance(ksFile, \"changeit\".toCharArray());\n+        });\n+    }\n+\n+    \/\/ Test getInstance(File file, LoadStoreParameter param)\n+    private static void testGetInstance5(String type) throws Exception {\n+        System.out.println(\"Test getInstance(File file, LoadStoreParameter param) with type: \"\n+                + type);\n+        File ksFile = createKeystore(type);\n+        KeyStore.LoadStoreParameter param = new KeyStore.LoadStoreParameter() {\n+            @Override\n+            public KeyStore.ProtectionParameter getProtectionParameter() {\n+                return new KeyStore.PasswordProtection(\"changeit\".toCharArray());\n+            }\n+        };\n+        checkWarnings(type, () -> {\n+            KeyStore ks = KeyStore.getInstance(ksFile, param);\n+        });\n+    }\n+\n+    private static File createKeystore(String type) throws Exception {\n+        File ksFile = File.createTempFile(\"kstore\", \".tmp\");\n+        ksFile.deleteOnExit();\n+        KeyStore ks = KeyStore.getInstance(type);\n+        ks.load(null, null);\n+        try (FileOutputStream fos = new FileOutputStream(ksFile)) {\n+            ks.store(fos, \"changeit\".toCharArray());\n+        }\n+        return ksFile;\n+    }\n+\n+    private static void checkWarnings(String type, RunnableWithException r) throws Exception {\n+        ByteArrayOutputStream bOut = new ByteArrayOutputStream();\n+        PrintStream origErr = System.err;\n+        try {\n+            System.setErr(new PrintStream(bOut));\n+            r.run();\n+        } finally {\n+            System.setErr(origErr);\n+        }\n+\n+        String msg = bOut.toString();\n+        if (!msg.contains(\"WARNING: \" + type.toUpperCase(Locale.ROOT)) ||\n+                !msg.contains(KS_WARNING1) ||\n+                !msg.contains(KS_WARNING2)) {\n+            throw new RuntimeException(\"Expected warning not found for \" + type + \":\\n\" + msg);\n+        }\n+    }\n+\n+    interface RunnableWithException {\n+        void run() throws Exception;\n+    }\n+}\n","filename":"test\/jdk\/java\/security\/KeyStore\/TestOutdatedKeyStore.java","additions":152,"deletions":0,"binary":false,"changes":152,"status":"added"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8217375 8260286 8267319\n+ * @bug 8217375 8260286 8267319 8353749\n@@ -853,0 +853,3 @@\n+\n+            if (line.contains(Test.OUTDATED_KEYSTORE_WARNING1)) continue;\n+            if (line.contains(Test.OUTDATED_KEYSTORE_WARNING2)) continue;\n","filename":"test\/jdk\/sun\/security\/tools\/jarsigner\/compatibility\/Compatibility.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -154,0 +154,7 @@\n+    static final String OUTDATED_KEYSTORE_WARNING1\n+            = \"uses outdated cryptographic algorithms and will be \"\n+            + \"removed in a future release. Migrate to PKCS12 using:\";\n+\n+    static final String OUTDATED_KEYSTORE_WARNING2\n+            = \"keytool -importkeystore -srckeystore\";\n+\n","filename":"test\/jdk\/sun\/security\/tools\/jarsigner\/warnings\/Test.java","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,80 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8353749\n+ * @summary Validate that keytool and jarsigner emit warnings for\n+ *         JKS and JCEKS keystore\n+ * @library \/test\/lib\n+ *\/\n+\n+import java.nio.file.Path;\n+\n+import jdk.test.lib.SecurityTools;\n+import jdk.test.lib.util.JarUtils;\n+\n+public class OutdatedKeyStoreWarning {\n+\n+    public static void main(String[] args) throws Exception {\n+        String[] ksTypes = {\"JKS\", \"JCEKS\"};\n+\n+        for (String type : ksTypes) {\n+            String ksFile = type.toLowerCase() + \".ks\";\n+            String KS_WARNING = type + \" uses outdated cryptographic algorithms and \" +\n+                    \"will be removed in a future release. Migrate to PKCS12 using:\";\n+\n+            SecurityTools.keytool(String.format(\n+                    \"-genkeypair -keystore %s -storetype %s -storepass changeit \" +\n+                    \"-keypass changeit -keyalg ec -alias a1 -dname CN=me\",\n+                    ksFile, type.toLowerCase()))\n+                    .shouldContain(\"Warning:\")\n+                    .shouldContain(KS_WARNING)\n+                    .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                            \"*-destkeystore.*-deststoretype pkcs12\")\n+                    .shouldHaveExitValue(0);\n+\n+            JarUtils.createJarFile(Path.of(\"unsigned.jar\"), Path.of(\".\"),\n+                    Path.of(ksFile));\n+\n+            SecurityTools.jarsigner(String.format(\n+                    \"-keystore %s -storetype %s -storepass changeit -signedjar signed.jar \" +\n+                    \"unsigned.jar a1\",\n+                    ksFile, type.toLowerCase()))\n+                    .shouldContain(\"Warning:\")\n+                    .shouldContain(KS_WARNING)\n+                    .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                            \"*-destkeystore.*-deststoretype pkcs12\")\n+                    .shouldHaveExitValue(0);\n+\n+            SecurityTools.jarsigner(String.format(\n+                    \"-verify -keystore %s -storetype %s -storepass changeit signed.jar\",\n+                    ksFile, type.toLowerCase()))\n+                    .shouldContain(\"Warning:\")\n+                    .shouldContain(KS_WARNING)\n+                    .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                            \"*-destkeystore.*-deststoretype pkcs12\")\n+                    .shouldHaveExitValue(0);\n+        }\n+    }\n+}\n","filename":"test\/jdk\/sun\/security\/tools\/keytool\/OutdatedKeyStoreWarning.java","additions":80,"deletions":0,"binary":false,"changes":80,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8171319 8177569 8182879 8172404\n+ * @bug 8171319 8177569 8182879 8172404 8353749\n@@ -229,1 +229,2 @@\n-                .shouldNotContain(\"proprietary format\");\n+                .shouldNotContain(\"outdated cryptographic algorithms\")\n+                .shouldNotContain(\"keytool -importkeystore -srckeystore\");\n@@ -245,1 +246,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\");\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -255,1 +259,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\");\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -257,1 +264,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\");\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -259,1 +269,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\");\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -261,1 +274,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\");\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -263,1 +279,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\");\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -265,1 +284,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\");\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -279,1 +301,4 @@\n-                .shouldContain(\"JCEKS keystore uses a proprietary format\");\n+                .shouldContain(\"JCEKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -281,1 +306,4 @@\n-                .shouldContain(\"JCEKS keystore uses a proprietary format\");\n+                .shouldContain(\"JCEKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -283,1 +311,4 @@\n-                .shouldContain(\"JCEKS keystore uses a proprietary format\");\n+                .shouldContain(\"JCEKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -285,1 +316,4 @@\n-                .shouldContain(\"JCEKS keystore uses a proprietary format\");\n+                .shouldContain(\"JCEKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -287,1 +321,4 @@\n-                .shouldContain(\"JCEKS keystore uses a proprietary format\");\n+                .shouldContain(\"JCEKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -289,1 +326,4 @@\n-                .shouldContain(\"JCEKS keystore uses a proprietary format\");\n+                .shouldContain(\"JCEKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -293,1 +333,4 @@\n-                .shouldContain(\"JCEKS keystore uses a proprietary format\");\n+                .shouldContain(\"JCEKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\");\n@@ -339,1 +382,4 @@\n-                .shouldContain(\"JKS keystore uses a proprietary format\")\n+                .shouldContain(\"JKS uses outdated cryptographic algorithms\" +\n+                        \" and will be removed\")\n+                .shouldMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\")\n@@ -349,1 +395,3 @@\n-                .shouldNotContain(\"proprietary format\")\n+                .shouldNotContain(\"outdated cryptographic algorithms\")\n+                .shouldNotMatch(\"keytool -importkeystore -srckeystore.\" +\n+                        \"*-destkeystore.*-deststoretype pkcs12\")\n","filename":"test\/jdk\/sun\/security\/tools\/keytool\/WeakAlg.java","additions":67,"deletions":19,"binary":false,"changes":86,"status":"modified"}]}