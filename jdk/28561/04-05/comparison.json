{"files":[{"patch":"@@ -377,1 +377,2 @@\n-  _old_generation->set_live_bytes_after_last_mark(live_data);\n+  \/\/ TODO: subtract from live_data bytes promoted during concurrent GC.\n+  _old_generation->set_live_bytes_at_last_mark(live_data);\n@@ -705,1 +706,1 @@\n-      const size_t live_at_previous_old = _old_generation->get_live_bytes_after_last_mark();\n+      const size_t live_at_previous_old = _old_generation->get_live_bytes_at_last_mark();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -105,1 +105,9 @@\n-  \/\/ adapted value of ShenandoahOldGarbageThreshold\n+  \/\/ The value of command-line argument ShenandoahOldGarbageThreshold represents the percent of garbage that must\n+  \/\/ be present within an old-generation region before that region is considered a good candidate for inclusion in\n+  \/\/ the collection set under normal circumstances.  For our purposes, normal circustances are when the memory consumed\n+  \/\/ by the old generation is less than 50% of the soft heap capacity.  When the old generation grows beyond the 50%\n+  \/\/ threshold, we dynamically adjust the old garbage threshold, allowing us to invest in packing the old generation\n+  \/\/ more tightly so that more memory can be made available to the more frequent young GC cycles.  This variable\n+  \/\/ is used in place of ShenandoahOldGarbageThreshold.  Under normal circumstances, its value is equal to\n+  \/\/ ShenandoahOldGarbageThreshold.  When the GC is under duress, this value may be adjusted to a smaller value,\n+  \/\/ as scaled according to the severity of duress that we are experiencing.\n@@ -206,1 +214,2 @@\n-\n+  \/\/ Returns the current value of a dynamically adjusted threshold percentage of garbage above which an old region is\n+  \/\/ deemed eligible for evacuation.\n@@ -214,1 +223,1 @@\n-  \/\/ value 25, denoting that a region that has at least 25% garbage is eligible for compaction.  With default values for\n+  \/\/ value 25, denoting that a region that has at least 25% garbage is eligible for evacuation.  With default values for\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.hpp","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -508,4 +508,4 @@\n-\/\/ Preselect for inclusion into the collection set regions whose age is at or above tenure age which contain more than\n-\/\/ the old garbage threshold amount of garbage.  We identify these regions by setting the appropriate entry of\n-\/\/ the collection set's preselected regions array to true.  All entries are initialized to false before calling this\n-\/\/ function.\n+\/\/ Preselect for inclusion into the collection set all regions whose age is at or above tenure age and for which the\n+\/\/ garbage percentage exceeds a dynamically adjusted threshold (known as the old-garbage threshold percentage).  We\n+\/\/ identify these regions by setting the appropriate entry of the collection set's preselected regions array to true.  \n+\/\/ All entries are initialized to false before calling this function.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGeneration.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -86,1 +86,1 @@\n-  old->set_live_bytes_after_last_mark(old->used());\n+  old->set_live_bytes_at_last_mark(old->used());\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGenerationalFullGC.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -119,1 +119,1 @@\n-    _growth_percent_before_compaction(INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION)\n+    _growth_percent_before_collection(INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION)\n@@ -122,1 +122,1 @@\n-  _live_bytes_after_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n+  _live_bytes_at_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n@@ -223,2 +223,2 @@\n-size_t ShenandoahOldGeneration::get_live_bytes_after_last_mark() const {\n-  return _live_bytes_after_last_mark;\n+size_t ShenandoahOldGeneration::get_live_bytes_at_last_mark() const {\n+  return _live_bytes_at_last_mark;\n@@ -227,1 +227,1 @@\n-void ShenandoahOldGeneration::set_live_bytes_after_last_mark(size_t bytes) {\n+void ShenandoahOldGeneration::set_live_bytes_at_last_mark(size_t bytes) {\n@@ -230,2 +230,2 @@\n-    _live_bytes_after_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n-    _growth_percent_before_compaction = INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION;\n+    _live_bytes_at_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n+    _growth_percent_before_collection = INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION;\n@@ -233,4 +233,4 @@\n-    _live_bytes_after_last_mark = bytes;\n-    _growth_percent_before_compaction \/= 2;\n-    if (_growth_percent_before_compaction < ShenandoahMinOldGenGrowthPercent) {\n-      _growth_percent_before_compaction = ShenandoahMinOldGenGrowthPercent;\n+    _live_bytes_at_last_mark = bytes;\n+    _growth_percent_before_collection \/= 2;\n+    if (_growth_percent_before_collection < ShenandoahMinOldGenGrowthPercent) {\n+      _growth_percent_before_collection = ShenandoahMinOldGenGrowthPercent;\n@@ -247,1 +247,1 @@\n-    _live_bytes_after_last_mark + (_live_bytes_after_last_mark * _growth_percent_before_compaction) \/ 100;\n+    _live_bytes_at_last_mark + (_live_bytes_at_last_mark * _growth_percent_before_collection) \/ 100;\n@@ -250,1 +250,1 @@\n-  if (_live_bytes_after_last_mark < soft_max_capacity) {\n+  if (_live_bytes_at_last_mark < soft_max_capacity) {\n@@ -252,1 +252,1 @@\n-      (_live_bytes_after_last_mark + ((soft_max_capacity - _live_bytes_after_last_mark)\n+      (_live_bytes_at_last_mark + ((soft_max_capacity - _live_bytes_at_last_mark)\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGeneration.cpp","additions":14,"deletions":14,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -291,1 +291,1 @@\n-  \/\/ collection when old-gen usage is 50% more (INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION) than the initial old-gen size\n+  \/\/ collection when old-gen usage is 50% more (INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION) than the initial old-gen size\n@@ -294,1 +294,1 @@\n-  static const size_t INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION = 50;\n+  static const size_t INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION = 50;\n@@ -303,1 +303,1 @@\n-  size_t _live_bytes_after_last_mark;\n+  size_t _live_bytes_at_last_mark;\n@@ -306,1 +306,1 @@\n-  size_t _growth_percent_before_compaction;\n+  size_t _growth_percent_before_collection;\n@@ -321,2 +321,2 @@\n-  size_t get_live_bytes_after_last_mark() const;\n-  void set_live_bytes_after_last_mark(size_t new_live);\n+  size_t get_live_bytes_at_last_mark() const;\n+  void set_live_bytes_at_last_mark(size_t new_live);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGeneration.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -95,5 +95,6 @@\n-          \"(Generational mode only) Even if the usage of old generation \"   \\\n-          \"is below ShenandoahIgnoreOldGrowthBelowPercentage, \"             \\\n-          \"trigger an old-generation mark if old has grown and this \"       \\\n-          \"many consecutive young-gen collections have been \"               \\\n-          \"completed following the preceding old-gen collection.\")          \\\n+          \"(Generational mode only) Trigger an old-generation mark \"        \\\n+          \"if old has grown and this many consecutive young-gen \"           \\\n+          \"collections have been completed following the preceding \"        \\\n+          \"old-gen collection.  We perform this old-generation mark \"       \\\n+          \"evvort even if the usage of old generation is below \"            \\\n+          \"ShenandoahIgnoreOldGrowthBelowPercentage.\")                      \\\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoah_globals.hpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"}]}