{"files":[{"patch":"@@ -212,0 +212,14 @@\n+\n+  \/\/ The normal old_garbage_threshold is specified by ShenandoahOldGarbageThreshold command-line argument, with default\n+  \/\/ value 25, denoting that a region that has at least 25% garbage is eligible for compaction.  With default values for\n+  \/\/ all command-line arguments, we make the following adjustments:\n+  \/\/  1. If the old generation has grown to consume more than 80% of the soft max capacity, adjust threshold to 10%\n+  \/\/  2. Otherwise, if the old generation has grown to consume more than 65%, adjust threshold to 15%\n+  \/\/  3. Otherwise, if the old generation has grown to consume more than 50%, adjust threshold to 20%\n+  \/\/ The effect is to compact the old generation more aggressively as the old generation consumes larger percentages\n+  \/\/ of the available heap memory.  In these circumstances, we pack the old generation more tightly in order to make\n+  \/\/ more memory avaiable to the young generation so that the more frequent young collections can operate more\n+  \/\/ efficiently.\n+  \/\/\n+  \/\/ If the ShenandoahOldGarbageThreshold is specified on the command line, the effect of adjusting the old garbage\n+  \/\/ threshold is scaled linearly.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.hpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -119,2 +119,1 @@\n-    _growth_before_compaction(INITIAL_GROWTH_BEFORE_COMPACTION),\n-    _min_growth_before_compaction ((ShenandoahMinOldGenGrowthPercent * FRACTIONAL_DENOMINATOR) \/ 100)\n+    _growth_percent_before_compaction(INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION)\n@@ -123,1 +122,1 @@\n-  _live_bytes_after_last_mark = ShenandoahHeap::heap()->capacity() * INITIAL_LIVE_FRACTION \/ FRACTIONAL_DENOMINATOR;\n+  _live_bytes_after_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n@@ -231,2 +230,2 @@\n-    _live_bytes_after_last_mark = ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_FRACTION \/ FRACTIONAL_DENOMINATOR;\n-    _growth_before_compaction = INITIAL_GROWTH_BEFORE_COMPACTION;\n+    _live_bytes_after_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n+    _growth_percent_before_compaction = INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION;\n@@ -235,3 +234,3 @@\n-    _growth_before_compaction \/= 2;\n-    if (_growth_before_compaction < _min_growth_before_compaction) {\n-      _growth_before_compaction = _min_growth_before_compaction;\n+    _growth_percent_before_compaction \/= 2;\n+    if (_growth_percent_before_compaction < ShenandoahMinOldGenGrowthPercent) {\n+      _growth_percent_before_compaction = ShenandoahMinOldGenGrowthPercent;\n@@ -248,1 +247,1 @@\n-    _live_bytes_after_last_mark + (_live_bytes_after_last_mark * _growth_before_compaction) \/ FRACTIONAL_DENOMINATOR;\n+    _live_bytes_after_last_mark + (_live_bytes_after_last_mark * _growth_percent_before_compaction) \/ 100;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGeneration.cpp","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -293,9 +293,7 @@\n-  \/\/ collection when old-gen usage is 50% more (INITIAL_GROWTH_BEFORE_COMPACTION) than the initial old-gen size\n-  \/\/ estimate (3.125% of heap).  The next old-gen trigger occurs when old-gen grows 25% larger than its live\n-  \/\/ memory at the end of the first old-gen collection.  Then we trigger again when old-gen grows 12.5%\n-  \/\/ more than its live memory at the end of the previous old-gen collection.  Thereafter, we trigger each time\n-  \/\/ old-gen grows more than 12.5% following the end of its previous old-gen collection.\n-  static const size_t INITIAL_GROWTH_BEFORE_COMPACTION = FRACTIONAL_DENOMINATOR \/ 2;        \/\/  50.0%\n-\n-  \/\/ INITIAL_LIVE_FRACTION represents the initial guess of how large old-gen should be.  We estimate that old-gen\n-  \/\/ needs to consume 6.25% of the total heap size.  And we \"pretend\" that we start out with this amount of live\n+  \/\/ collection when old-gen usage is 50% more (INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION) than the initial old-gen size\n+  \/\/ estimate (16% of heap).  With each successive old-gen collection, we divide the growth trigger by two, but\n+  \/\/ never use a growth trigger smaller than ShenandoahMinOldGenGrowthPercent.\n+  static const size_t INITIAL_PERCENT_GROWTH_BEFORE_COMPACTION = 50;\n+\n+  \/\/ INITIAL_LIVE_PERCENT represents the initial guess of how large old-gen should be.  We estimate that old gen\n+  \/\/ needs to consume 16% of the total heap size.  And we \"pretend\" that we start out with this amount of live\n@@ -303,3 +301,3 @@\n-  \/\/ approximation of the old-gen memory requirement, in other words when old-gen usage is 150% of 6.25%, which\n-  \/\/ is 9.375% of the total heap size.\n-  static const uint16_t INITIAL_LIVE_FRACTION = FRACTIONAL_DENOMINATOR \/ 16;                \/\/   6.25%\n+  \/\/ approximation of the old-gen memory requirement, in other words when old-gen usage is 150% of 16%, which\n+  \/\/ is 24% of the heap size.\n+  static const size_t INITIAL_LIVE_PERCENT = 16;\n@@ -309,3 +307,2 @@\n-  \/\/ How much growth in usage before we trigger old collection, per FRACTIONAL_DENOMINATOR (65_536)\n-  size_t _growth_before_compaction;\n-  const size_t _min_growth_before_compaction;                                               \/\/ Default is 12.5%\n+  \/\/ How much growth in usage before we trigger old collection as a percent of soft_max_capacity\n+  size_t _growth_percent_before_compaction;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGeneration.hpp","additions":12,"deletions":15,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-          50, EXPERIMENTAL,                                                 \\\n+          35, EXPERIMENTAL,                                                 \\\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoah_globals.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}