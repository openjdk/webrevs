{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -178,1 +178,1 @@\n-        is.close(io);\n+        is.resetStream(io);\n","filename":"test\/jdk\/java\/net\/httpclient\/lib\/jdk\/httpclient\/test\/lib\/http3\/Http3ServerExchange.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -267,1 +267,1 @@\n-                en.is.close(new IOException(\"stopSendingRequested\"));\n+                en.is.resetStream(new IOException(\"stopSendingRequested\"));\n@@ -295,0 +295,1 @@\n+        \/\/ non-null if the QUIC stream was reset\n@@ -296,0 +297,1 @@\n+        \/\/ true if close() was called\n@@ -300,2 +302,0 @@\n-        \/\/ Use lock to avoid pinned threads on the blocking queue\n-        final ReentrantLock lock = new ReentrantLock();\n@@ -304,19 +304,10 @@\n-            lock.lock();\n-            try {\n-                while (true) {\n-                    if (current != null && current.hasRemaining()) {\n-                        return current;\n-                    }\n-                    if (current == QuicStreamReader.EOF) return current;\n-                    try {\n-                        if (debug.on())\n-                            debug.log(\"Taking buffer from queue\");\n-                        \/\/ Blocking call\n-                        current = requestBodyQueue.take();\n-                    } catch (InterruptedException e) {\n-                        var io = new InterruptedIOException();\n-                        Thread.currentThread().interrupt();\n-                        io.initCause(e);\n-                        close(io);\n-                        var error = this.error;\n-                        if (error != null) throw error;\n+            if (closed) {\n+                throw new IOException(\"Stream is closed\");\n+            }\n+            while (true) {\n+                if (current != null && current.hasRemaining()) {\n+                    return current;\n+                }\n+                if (current == QuicStreamReader.EOF) {\n+                    if (closed) {\n+                        throw new IOException(\"Stream is closed\");\n@@ -324,0 +315,14 @@\n+                    var error = this.error;\n+                    if (error != null) throw error;\n+                    return current;\n+                }\n+                try {\n+                    if (debug.on())\n+                        debug.log(\"Taking buffer from queue\");\n+                    \/\/ Blocking call\n+                    current = requestBodyQueue.take();\n+                } catch (InterruptedException e) {\n+                    var io = new InterruptedIOException();\n+                    Thread.currentThread().interrupt();\n+                    io.initCause(e);\n+                    throw io;\n@@ -325,2 +330,0 @@\n-            } finally {\n-                lock.unlock();\n@@ -334,3 +337,1 @@\n-                var error = this.error;\n-                if (error == null) return -1;\n-                throw error;\n+                return -1;\n@@ -344,0 +345,3 @@\n+            if (closed) {\n+                throw new IOException(\"Stream is closed\");\n+            }\n@@ -349,3 +353,1 @@\n-                        var error = this.error;\n-                        if (error == null) return -1;\n-                        throw error;\n+                        return -1;\n@@ -363,8 +365,2 @@\n-            lock.lock();\n-            try {\n-                if (closed) return;\n-                closed = true;\n-\n-            } finally {\n-                lock.unlock();\n-            }\n+            if (closed) return;\n+            closed = true;\n@@ -376,9 +372,3 @@\n-        void close(IOException io) {\n-            lock.lock();\n-            try {\n-                if (closed) return;\n-                closed = true;\n-                error = io;\n-            } finally {\n-                lock.unlock();\n-            }\n+        void resetStream(IOException io) {\n+            if (error != null) return;\n+            error = io;\n@@ -388,1 +378,0 @@\n-            requestBodyQueue.clear();\n","filename":"test\/jdk\/java\/net\/httpclient\/lib\/jdk\/httpclient\/test\/lib\/http3\/Http3ServerStreamImpl.java","additions":38,"deletions":49,"binary":false,"changes":87,"status":"modified"}]}