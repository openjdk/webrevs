{"files":[{"patch":"@@ -399,4 +399,1 @@\n-            g2d.setColor(Color.WHITE);\n-            g2d.fillRect(0, 0, im.getWidth(), im.getHeight());\n-\n-            g2d.setColor(Color.BLACK);\n+            g2d.setColor(Color.WHITE); \/\/ white over transparent black bg\n@@ -431,1 +428,1 @@\n-                    if (buf[i] != -1) {\n+                    if (buf[i] != 0) {\n@@ -444,1 +441,1 @@\n-                    if (buf[i] != -1) {\n+                    if (buf[i] != 0) {\n@@ -457,1 +454,1 @@\n-                    if (v != -1) {\n+                    if (v != 0) {\n@@ -469,1 +466,1 @@\n-                    if (v != -1) {\n+                    if (v != 0) {\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/font\/TextLine.java","additions":5,"deletions":8,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -0,0 +1,98 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 6562639\n+ * @summary Verify correct getPixelBounds() behavior regardless of text color.\n+ *\/\n+\n+import java.awt.Color;\n+import java.awt.Font;\n+import java.awt.Rectangle;\n+import java.awt.font.FontRenderContext;\n+import java.awt.font.TextAttribute;\n+import java.awt.font.TextLayout;\n+import java.awt.geom.Rectangle2D;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class TestGetPixelBoundsWithColors {\n+\n+    private static final Color TRANSPARENT_BLACK = new Color(0, 0, 0, 0);\n+    private static final Color TRANSPARENT_WHITE = new Color(255, 255, 255, 0);\n+\n+    public static void main(String[] args) throws Exception {\n+\n+        Color[] colors = new Color[] {\n+            Color.WHITE, Color.BLACK, Color.YELLOW, Color.RED, Color.GREEN,\n+            Color.GRAY, Color.LIGHT_GRAY, Color.DARK_GRAY, Color.PINK,\n+            Color.CYAN, Color.MAGENTA, Color.BLUE, null\n+        };\n+\n+        for (Color color : colors) {\n+            test(color);\n+        }\n+\n+        testTransparent(TRANSPARENT_BLACK);\n+        testTransparent(TRANSPARENT_WHITE);\n+    }\n+\n+    private static void test(Color c) {\n+        Map< TextAttribute, Object > underline = new HashMap<>();\n+        underline.put(TextAttribute.UNDERLINE, TextAttribute.UNDERLINE_ON);\n+        Font font1 = new Font(Font.DIALOG, Font.PLAIN, 60).deriveFont(underline);\n+        Map< TextAttribute, Object > foreground = new HashMap<>();\n+        foreground.put(TextAttribute.FOREGROUND, c);\n+        Font font2 = font1.deriveFont(foreground);\n+        FontRenderContext frc = new FontRenderContext(null, true, true);\n+        TextLayout layout1 = new TextLayout(\"TEST\", font1, frc);\n+        TextLayout layout2 = new TextLayout(\"TEST\", font2, frc);\n+        Rectangle r1 = layout1.getPixelBounds(frc, 0, 0);\n+        Rectangle r2 = layout2.getPixelBounds(frc, 0, 0);\n+        if (!r1.equals(r2)) {\n+            throw new RuntimeException(\"For color \" + c + \", \" + r1 + \" != \" + r2);\n+        }\n+        Rectangle2D bounds = layout1.getBounds();\n+        if (Math.abs(bounds.getX() - r1.x) > 3 ||\n+            Math.abs(bounds.getY() - r1.y) > 3 ||\n+            Math.abs(bounds.getWidth() - r1.width) > 6 ||\n+            Math.abs(bounds.getHeight() - r1.height) > 6) {\n+            throw new RuntimeException(\"For color \" + c + \", pixel bounds \" +\n+                r1 + \" not similar to \" + bounds);\n+        }\n+    }\n+\n+    private static void testTransparent(Color c) {\n+        Font font1 = new Font(Font.DIALOG, Font.PLAIN, 60);\n+        Map< TextAttribute, Object > attributes = new HashMap<>();\n+        attributes.put(TextAttribute.FOREGROUND, c);\n+        Font font2 = font1.deriveFont(attributes);\n+        FontRenderContext frc = new FontRenderContext(null, true, true);\n+        TextLayout layout = new TextLayout(\"TEST\", font2, frc);\n+        Rectangle r = layout.getPixelBounds(frc, 0, 0);\n+        if (!r.isEmpty()) {\n+            throw new RuntimeException(\"Expected empty pixel bounds for \" + c + \" but got \" + r);\n+        }\n+    }\n+}\n","filename":"test\/jdk\/java\/awt\/font\/TextLayout\/TestGetPixelBoundsWithColors.java","additions":98,"deletions":0,"binary":false,"changes":98,"status":"added"}]}