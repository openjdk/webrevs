{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/CPlatformResponder.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/NSEvent.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -24,0 +24,4 @@\n+import java.awt.Dimension;\n+import java.awt.Point;\n+import java.awt.Robot;\n+import java.awt.event.InputEvent;\n@@ -28,0 +32,3 @@\n+import javax.swing.SwingUtilities;\n+import javax.swing.event.PopupMenuEvent;\n+import javax.swing.event.PopupMenuListener;\n@@ -34,3 +41,1 @@\n- * @library \/java\/awt\/regtesthelpers\n- * @build PassFailJFrame\n- * @run main\/manual MouseDragPopupTest\n+ * @run main MouseDragPopupTest\n@@ -39,0 +44,1 @@\n+    static boolean failed;\n@@ -43,0 +49,2 @@\n+    static volatile Point srcPoint;\n+    static volatile Dimension d;\n@@ -45,18 +53,32 @@\n-        String instructions = \"\"\"\n-                1) Press and hold the right mouse button down on the JLabel with the text\n-                \"Right click and drag from here\"\n-\n-                2) Move the mouse to the JLabel with the text \"to here\"\n-\n-                3) Observe that the popup menu assigned to the inner JPanel appears\n-                (macOS) or does not appear (Windows, Linux)\n-                \"\"\";\n-\n-        PassFailJFrame.builder()\n-                .title(\"FocusablePopupDismissTest\")\n-                .instructions(instructions)\n-                .rows(10)\n-                .columns(45)\n-                .testUI(MouseDragPopupTest::createAndShowGUI)\n-                .build()\n-                .awaitAndCheck();\n+        SwingUtilities.invokeAndWait(() -> {\n+            createAndShowGUI();\n+            srcPoint = frame.getLocationOnScreen();\n+            d = frame.getSize();\n+        });\n+        srcPoint.translate(2*d.width\/3, 3*d.height\/4);\n+\n+        final Point dstPoint = new Point(srcPoint);\n+        dstPoint.translate(4*d.width\/15, 0);\n+\n+        failed = false;\n+        Robot robot = new Robot();\n+        robot.setAutoDelay(100);\n+\n+        robot.mouseMove(srcPoint.x, srcPoint.y);\n+        robot.waitForIdle();\n+\n+        robot.mousePress(InputEvent.BUTTON3_DOWN_MASK);\n+        robot.waitForIdle();\n+\n+        while (!srcPoint.equals(dstPoint)) {\n+            srcPoint.translate(sign(dstPoint.x - srcPoint.x), 0);\n+            robot.mouseMove(srcPoint.x, srcPoint.y);\n+        }\n+        robot.waitForIdle();\n+\n+        robot.mouseRelease(InputEvent.BUTTON3_DOWN_MASK);\n+        robot.waitForIdle();\n+\n+        if (failed) {\n+            throw new RuntimeException(\"Popup was shown, Test Failed.\");\n+        }\n@@ -65,1 +87,5 @@\n-    static JFrame createAndShowGUI() {\n+    public static int sign(int n) {\n+        return n < 0 ? -1 : n == 0 ? 0 : 1;\n+    }\n+\n+    static void createAndShowGUI() {\n@@ -71,1 +97,14 @@\n-        menu.add(\"This should not appear (and does not under Linux\/Windows)\");\n+        menu.addPopupMenuListener(new PopupMenuListener() {\n+            @Override\n+            public void popupMenuWillBecomeVisible(PopupMenuEvent e) {\n+                failed = true;\n+            }\n+\n+            @Override\n+            public void popupMenuWillBecomeInvisible(PopupMenuEvent e) {}\n+\n+            @Override\n+            public void popupMenuCanceled(PopupMenuEvent e) {}\n+        });\n+\n+        menu.add(\"This should not appear\");\n@@ -81,2 +120,2 @@\n-\n-        return frame;\n+        frame.setLocationRelativeTo(null);\n+        frame.setVisible(true);\n","filename":"test\/jdk\/javax\/swing\/JPopupMenu\/MouseDragPopupTest.java","additions":64,"deletions":25,"binary":false,"changes":89,"status":"modified"}]}