{"files":[{"patch":"@@ -1050,1 +1050,1 @@\n-            checkLocal(methodDesc.parameterCount() + (isStatic ? 0 : -1));\n+            checkLocal(methodDesc.parameterCount() + (isStatic ? -1 : 0));\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/StackMapGenerator.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,1 @@\n- * @bug 8305990 8320222 8320618\n+ * @bug 8305990 8320222 8320618 8335475\n@@ -39,0 +39,4 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.EnumSource;\n+\n+import static java.lang.constant.ConstantDescs.MTD_void;\n@@ -241,1 +245,1 @@\n-                -> clb.withMethodBody(\"test\", ConstantDescs.MTD_void, 0, cob\n+                -> clb.withMethodBody(\"test\", MTD_void, 0, cob\n@@ -315,0 +319,24 @@\n+\n+    @ParameterizedTest\n+    @EnumSource(ClassFile.StackMapsOption.class)\n+    void testEmptyCounters(ClassFile.StackMapsOption option) {\n+        var cf = ClassFile.of(option);\n+        var bytes = cf.build(ClassDesc.of(\"Test\"), clb -> clb\n+            .withMethodBody(\"a\", MTD_void, ACC_STATIC, CodeBuilder::return_)\n+            .withMethodBody(\"b\", MTD_void, 0, CodeBuilder::return_)\n+        );\n+\n+        var cm = ClassFile.of().parse(bytes);\n+        for (var method : cm.methods()) {\n+            var name = method.methodName();\n+            var code = method.code().orElseThrow();\n+            if (name.equalsString(\"a\")) {\n+                assertEquals(0, code.maxLocals()); \/\/ static method\n+                assertEquals(0, code.maxStack());\n+            } else {\n+                assertTrue(name.equalsString(\"b\"));\n+                assertEquals(1, code.maxLocals()); \/\/ instance method\n+                assertEquals(0, code.maxStack());\n+            }\n+        }\n+    }\n","filename":"test\/jdk\/jdk\/classfile\/StackMapsTest.java","additions":31,"deletions":3,"binary":false,"changes":34,"status":"modified"}]}