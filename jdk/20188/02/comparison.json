{"files":[{"patch":"@@ -3223,15 +3223,12 @@\n-\/\/ java_lang_reflect_Method\n-\n-int java_lang_reflect_Method::_clazz_offset;\n-int java_lang_reflect_Method::_name_offset;\n-int java_lang_reflect_Method::_returnType_offset;\n-int java_lang_reflect_Method::_parameterTypes_offset;\n-int java_lang_reflect_Method::_exceptionTypes_offset;\n-int java_lang_reflect_Method::_slot_offset;\n-int java_lang_reflect_Method::_modifiers_offset;\n-int java_lang_reflect_Method::_signature_offset;\n-int java_lang_reflect_Method::_annotations_offset;\n-int java_lang_reflect_Method::_parameter_annotations_offset;\n-int java_lang_reflect_Method::_annotation_default_offset;\n-\n-#define METHOD_FIELDS_DO(macro) \\\n+\/\/ java_lang_reflect_Executable\n+\n+int java_lang_reflect_Executable::_clazz_offset;\n+int java_lang_reflect_Executable::_slot_offset;\n+int java_lang_reflect_Executable::_parameterTypes_offset;\n+int java_lang_reflect_Executable::_exceptionTypes_offset;\n+int java_lang_reflect_Executable::_modifiers_offset;\n+int java_lang_reflect_Executable::_signature_offset;\n+int java_lang_reflect_Executable::_annotations_offset;\n+int java_lang_reflect_Executable::_parameter_annotations_offset;\n+\n+#define EXECUTABLE_FIELDS_DO(macro) \\\n@@ -3239,2 +3236,1 @@\n-  macro(_name_offset,           k, vmSymbols::name_name(),           string_signature,      false); \\\n-  macro(_returnType_offset,     k, vmSymbols::returnType_name(),     class_signature,       false); \\\n+  macro(_slot_offset,           k, vmSymbols::slot_name(),           int_signature,         false); \\\n@@ -3243,1 +3239,0 @@\n-  macro(_slot_offset,           k, vmSymbols::slot_name(),           int_signature,         false); \\\n@@ -3247,2 +3242,1 @@\n-  macro(_parameter_annotations_offset, k, vmSymbols::parameter_annotations_name(), byte_array_signature, false); \\\n-  macro(_annotation_default_offset,    k, vmSymbols::annotation_default_name(),    byte_array_signature, false);\n+  macro(_parameter_annotations_offset, k, vmSymbols::parameter_annotations_name(), byte_array_signature, false);\n@@ -3250,3 +3244,3 @@\n-void java_lang_reflect_Method::compute_offsets() {\n-  InstanceKlass* k = vmClasses::reflect_Method_klass();\n-  METHOD_FIELDS_DO(FIELD_COMPUTE_OFFSET);\n+void java_lang_reflect_Executable::compute_offsets() {\n+  InstanceKlass* k = vmClasses::reflect_Executable_klass();\n+  EXECUTABLE_FIELDS_DO(FIELD_COMPUTE_OFFSET);\n@@ -3256,2 +3250,2 @@\n-void java_lang_reflect_Method::serialize_offsets(SerializeClosure* f) {\n-  METHOD_FIELDS_DO(FIELD_SERIALIZE_OFFSET);\n+void java_lang_reflect_Executable::serialize_offsets(SerializeClosure* f) {\n+  EXECUTABLE_FIELDS_DO(FIELD_SERIALIZE_OFFSET);\n@@ -3261,7 +3255,2 @@\n-Handle java_lang_reflect_Method::create(TRAPS) {\n-  assert(Universe::is_fully_initialized(), \"Need to find another solution to the reflection problem\");\n-  Klass* klass = vmClasses::reflect_Method_klass();\n-  \/\/ This class is eagerly initialized during VM initialization, since we keep a reference\n-  \/\/ to one of the methods\n-  assert(InstanceKlass::cast(klass)->is_initialized(), \"must be initialized\");\n-  return InstanceKlass::cast(klass)->allocate_instance_handle(THREAD);\n+oop java_lang_reflect_Executable::clazz(oop executable) {\n+  return executable->obj_field(_clazz_offset);\n@@ -3270,2 +3259,2 @@\n-oop java_lang_reflect_Method::clazz(oop reflect) {\n-  return reflect->obj_field(_clazz_offset);\n+void java_lang_reflect_Executable::set_clazz(oop executable, oop value) {\n+   executable->obj_field_put(_clazz_offset, value);\n@@ -3274,2 +3263,2 @@\n-void java_lang_reflect_Method::set_clazz(oop reflect, oop value) {\n-   reflect->obj_field_put(_clazz_offset, value);\n+int java_lang_reflect_Executable::slot(oop executable) {\n+  return executable->int_field(_slot_offset);\n@@ -3278,2 +3267,2 @@\n-int java_lang_reflect_Method::slot(oop reflect) {\n-  return reflect->int_field(_slot_offset);\n+void java_lang_reflect_Executable::set_slot(oop executable, int value) {\n+  executable->int_field_put(_slot_offset, value);\n@@ -3282,14 +3271,2 @@\n-void java_lang_reflect_Method::set_slot(oop reflect, int value) {\n-  reflect->int_field_put(_slot_offset, value);\n-}\n-\n-void java_lang_reflect_Method::set_name(oop method, oop value) {\n-  method->obj_field_put(_name_offset, value);\n-}\n-\n-oop java_lang_reflect_Method::return_type(oop method) {\n-  return method->obj_field(_returnType_offset);\n-}\n-\n-void java_lang_reflect_Method::set_return_type(oop method, oop value) {\n-  method->obj_field_put(_returnType_offset, value);\n+oop java_lang_reflect_Executable::parameter_types(oop executable) {\n+  return executable->obj_field(_parameterTypes_offset);\n@@ -3298,2 +3275,2 @@\n-oop java_lang_reflect_Method::parameter_types(oop method) {\n-  return method->obj_field(_parameterTypes_offset);\n+void java_lang_reflect_Executable::set_parameter_types(oop executable, oop value) {\n+  executable->obj_field_put(_parameterTypes_offset, value);\n@@ -3302,2 +3279,2 @@\n-void java_lang_reflect_Method::set_parameter_types(oop method, oop value) {\n-  method->obj_field_put(_parameterTypes_offset, value);\n+void java_lang_reflect_Executable::set_exception_types(oop executable, oop value) {\n+  executable->obj_field_put(_exceptionTypes_offset, value);\n@@ -3306,2 +3283,2 @@\n-void java_lang_reflect_Method::set_exception_types(oop method, oop value) {\n-  method->obj_field_put(_exceptionTypes_offset, value);\n+void java_lang_reflect_Executable::set_modifiers(oop executable, int value) {\n+  executable->int_field_put(_modifiers_offset, value);\n@@ -3310,2 +3287,2 @@\n-void java_lang_reflect_Method::set_modifiers(oop method, int value) {\n-  method->int_field_put(_modifiers_offset, value);\n+void java_lang_reflect_Executable::set_signature(oop executable, oop value) {\n+  executable->obj_field_put(_signature_offset, value);\n@@ -3314,2 +3291,2 @@\n-void java_lang_reflect_Method::set_signature(oop method, oop value) {\n-  method->obj_field_put(_signature_offset, value);\n+void java_lang_reflect_Executable::set_annotations(oop executable, oop value) {\n+  executable->obj_field_put(_annotations_offset, value);\n@@ -3318,2 +3295,2 @@\n-void java_lang_reflect_Method::set_annotations(oop method, oop value) {\n-  method->obj_field_put(_annotations_offset, value);\n+void java_lang_reflect_Executable::set_parameter_annotations(oop executable, oop value) {\n+  executable->obj_field_put(_parameter_annotations_offset, value);\n@@ -3322,7 +3299,1 @@\n-void java_lang_reflect_Method::set_parameter_annotations(oop method, oop value) {\n-  method->obj_field_put(_parameter_annotations_offset, value);\n-}\n-\n-void java_lang_reflect_Method::set_annotation_default(oop method, oop value) {\n-  method->obj_field_put(_annotation_default_offset, value);\n-}\n+\/\/ java_lang_reflect_Method\n@@ -3330,8 +3301,3 @@\n-int java_lang_reflect_Constructor::_clazz_offset;\n-int java_lang_reflect_Constructor::_parameterTypes_offset;\n-int java_lang_reflect_Constructor::_exceptionTypes_offset;\n-int java_lang_reflect_Constructor::_slot_offset;\n-int java_lang_reflect_Constructor::_modifiers_offset;\n-int java_lang_reflect_Constructor::_signature_offset;\n-int java_lang_reflect_Constructor::_annotations_offset;\n-int java_lang_reflect_Constructor::_parameter_annotations_offset;\n+int java_lang_reflect_Method::_name_offset;\n+int java_lang_reflect_Method::_returnType_offset;\n+int java_lang_reflect_Method::_annotation_default_offset;\n@@ -3339,9 +3305,4 @@\n-#define CONSTRUCTOR_FIELDS_DO(macro) \\\n-  macro(_clazz_offset,          k, vmSymbols::clazz_name(),          class_signature,       false); \\\n-  macro(_parameterTypes_offset, k, vmSymbols::parameterTypes_name(), class_array_signature, false); \\\n-  macro(_exceptionTypes_offset, k, vmSymbols::exceptionTypes_name(), class_array_signature, false); \\\n-  macro(_slot_offset,           k, vmSymbols::slot_name(),           int_signature,         false); \\\n-  macro(_modifiers_offset,      k, vmSymbols::modifiers_name(),      int_signature,         false); \\\n-  macro(_signature_offset,             k, vmSymbols::signature_name(),             string_signature,     false); \\\n-  macro(_annotations_offset,           k, vmSymbols::annotations_name(),           byte_array_signature, false); \\\n-  macro(_parameter_annotations_offset, k, vmSymbols::parameter_annotations_name(), byte_array_signature, false);\n+#define METHOD_FIELDS_DO(macro) \\\n+  macro(_name_offset,           k, vmSymbols::name_name(),           string_signature,      false); \\\n+  macro(_returnType_offset,     k, vmSymbols::returnType_name(),     class_signature,       false); \\\n+  macro(_annotation_default_offset,    k, vmSymbols::annotation_default_name(),    byte_array_signature, false);\n@@ -3349,3 +3310,3 @@\n-void java_lang_reflect_Constructor::compute_offsets() {\n-  InstanceKlass* k = vmClasses::reflect_Constructor_klass();\n-  CONSTRUCTOR_FIELDS_DO(FIELD_COMPUTE_OFFSET);\n+void java_lang_reflect_Method::compute_offsets() {\n+  InstanceKlass* k = vmClasses::reflect_Method_klass();\n+  METHOD_FIELDS_DO(FIELD_COMPUTE_OFFSET);\n@@ -3355,2 +3316,2 @@\n-void java_lang_reflect_Constructor::serialize_offsets(SerializeClosure* f) {\n-  CONSTRUCTOR_FIELDS_DO(FIELD_SERIALIZE_OFFSET);\n+void java_lang_reflect_Method::serialize_offsets(SerializeClosure* f) {\n+  METHOD_FIELDS_DO(FIELD_SERIALIZE_OFFSET);\n@@ -3360,1 +3321,1 @@\n-Handle java_lang_reflect_Constructor::create(TRAPS) {\n+Handle java_lang_reflect_Method::create(TRAPS) {\n@@ -3362,22 +3323,5 @@\n-  Symbol* name = vmSymbols::java_lang_reflect_Constructor();\n-  Klass* k = SystemDictionary::resolve_or_fail(name, true, CHECK_NH);\n-  InstanceKlass* ik = InstanceKlass::cast(k);\n-  \/\/ Ensure it is initialized\n-  ik->initialize(CHECK_NH);\n-  return ik->allocate_instance_handle(THREAD);\n-}\n-\n-oop java_lang_reflect_Constructor::clazz(oop reflect) {\n-  return reflect->obj_field(_clazz_offset);\n-}\n-\n-void java_lang_reflect_Constructor::set_clazz(oop reflect, oop value) {\n-   reflect->obj_field_put(_clazz_offset, value);\n-}\n-\n-oop java_lang_reflect_Constructor::parameter_types(oop constructor) {\n-  return constructor->obj_field(_parameterTypes_offset);\n-}\n-\n-void java_lang_reflect_Constructor::set_parameter_types(oop constructor, oop value) {\n-  constructor->obj_field_put(_parameterTypes_offset, value);\n+  Klass* klass = vmClasses::reflect_Method_klass();\n+  \/\/ This class is eagerly initialized during VM initialization, since we keep a reference\n+  \/\/ to one of the methods\n+  assert(InstanceKlass::cast(klass)->is_initialized(), \"must be initialized\");\n+  return InstanceKlass::cast(klass)->allocate_instance_handle(THREAD);\n@@ -3386,2 +3330,2 @@\n-void java_lang_reflect_Constructor::set_exception_types(oop constructor, oop value) {\n-  constructor->obj_field_put(_exceptionTypes_offset, value);\n+void java_lang_reflect_Method::set_name(oop method, oop value) {\n+  method->obj_field_put(_name_offset, value);\n@@ -3390,2 +3334,2 @@\n-int java_lang_reflect_Constructor::slot(oop reflect) {\n-  return reflect->int_field(_slot_offset);\n+oop java_lang_reflect_Method::return_type(oop method) {\n+  return method->obj_field(_returnType_offset);\n@@ -3394,2 +3338,2 @@\n-void java_lang_reflect_Constructor::set_slot(oop reflect, int value) {\n-  reflect->int_field_put(_slot_offset, value);\n+void java_lang_reflect_Method::set_return_type(oop method, oop value) {\n+  method->obj_field_put(_returnType_offset, value);\n@@ -3398,2 +3342,2 @@\n-void java_lang_reflect_Constructor::set_modifiers(oop constructor, int value) {\n-  constructor->int_field_put(_modifiers_offset, value);\n+void java_lang_reflect_Method::set_annotation_default(oop method, oop value) {\n+  method->obj_field_put(_annotation_default_offset, value);\n@@ -3402,3 +3346,1 @@\n-void java_lang_reflect_Constructor::set_signature(oop constructor, oop value) {\n-  constructor->obj_field_put(_signature_offset, value);\n-}\n+\/\/ java_lang_reflect_Constructor\n@@ -3406,2 +3348,7 @@\n-void java_lang_reflect_Constructor::set_annotations(oop constructor, oop value) {\n-  constructor->obj_field_put(_annotations_offset, value);\n+Handle java_lang_reflect_Constructor::create(TRAPS) {\n+  assert(Universe::is_fully_initialized(), \"Need to find another solution to the reflection problem\");\n+  Klass* k = vmClasses::reflect_Constructor_klass();\n+  InstanceKlass* ik = InstanceKlass::cast(k);\n+  \/\/ Ensure it is initialized\n+  ik->initialize(CHECK_NH);\n+  return ik->allocate_instance_handle(THREAD);\n@@ -3410,3 +3357,1 @@\n-void java_lang_reflect_Constructor::set_parameter_annotations(oop method, oop value) {\n-  method->obj_field_put(_parameter_annotations_offset, value);\n-}\n+\/\/ java_lang_reflect_Field\n@@ -5336,0 +5281,1 @@\n+  f(java_lang_reflect_Executable) \\\n@@ -5337,1 +5283,0 @@\n-  f(java_lang_reflect_Constructor) \\\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.cpp","additions":78,"deletions":133,"binary":false,"changes":211,"status":"modified"},{"patch":"@@ -665,0 +665,1 @@\n+\/\/ Interface to java.lang.reflect.Executable objects\n@@ -666,3 +667,1 @@\n-\/\/ Interface to java.lang.reflect.Method objects\n-\n-class java_lang_reflect_Method : public java_lang_reflect_AccessibleObject {\n+class java_lang_reflect_Executable : public java_lang_reflect_AccessibleObject {\n@@ -673,2 +672,1 @@\n-  static int _name_offset;\n-  static int _returnType_offset;\n+  static int _slot_offset;\n@@ -677,1 +675,0 @@\n-  static int _slot_offset;\n@@ -682,0 +679,33 @@\n+\n+  static void compute_offsets();\n+ public:\n+  static void serialize_offsets(SerializeClosure* f) NOT_CDS_RETURN;\n+\n+  \/\/ Accessors\n+  static oop clazz(oop executable);\n+  static void set_clazz(oop executable, oop value);\n+\n+  static int slot(oop executable);\n+  static void set_slot(oop executable, int value);\n+\n+  static oop parameter_types(oop executable);\n+  static void set_parameter_types(oop executable, oop value);\n+\n+  static void set_exception_types(oop executable, oop value);\n+  static void set_modifiers(oop executable, int value);\n+  static void set_signature(oop executable, oop value);\n+  static void set_annotations(oop executable, oop value);\n+  static void set_parameter_annotations(oop executable, oop value);\n+\n+  \/\/ Debugging\n+  friend class JavaClasses;\n+};\n+\n+\/\/ Interface to java.lang.reflect.Method objects\n+\n+class java_lang_reflect_Method : public java_lang_reflect_Executable {\n+ private:\n+  \/\/ Note that to reduce dependencies on the JDK we compute these\n+  \/\/ offsets at run-time.\n+  static int _name_offset;\n+  static int _returnType_offset;\n@@ -692,3 +722,0 @@\n-  static oop clazz(oop reflect);\n-  static void set_clazz(oop reflect, oop value);\n-\n@@ -699,12 +726,0 @@\n-\n-  static oop parameter_types(oop method);\n-  static void set_parameter_types(oop method, oop value);\n-\n-  static int slot(oop reflect);\n-  static void set_slot(oop reflect, int value);\n-\n-  static void set_exception_types(oop method, oop value);\n-  static void set_modifiers(oop method, int value);\n-  static void set_signature(oop method, oop value);\n-  static void set_annotations(oop method, oop value);\n-  static void set_parameter_annotations(oop method, oop value);\n@@ -720,1 +735,1 @@\n-class java_lang_reflect_Constructor : public java_lang_reflect_AccessibleObject {\n+class java_lang_reflect_Constructor : public java_lang_reflect_Executable {\n@@ -724,9 +739,0 @@\n-  static int _clazz_offset;\n-  static int _parameterTypes_offset;\n-  static int _exceptionTypes_offset;\n-  static int _slot_offset;\n-  static int _modifiers_offset;\n-  static int _signature_offset;\n-  static int _annotations_offset;\n-  static int _parameter_annotations_offset;\n-\n@@ -735,1 +741,0 @@\n-  static void serialize_offsets(SerializeClosure* f) NOT_CDS_RETURN;\n@@ -740,16 +745,0 @@\n-  \/\/ Accessors\n-  static oop clazz(oop reflect);\n-  static void set_clazz(oop reflect, oop value);\n-\n-  static oop parameter_types(oop constructor);\n-  static void set_parameter_types(oop constructor, oop value);\n-\n-  static int slot(oop reflect);\n-  static void set_slot(oop reflect, int value);\n-\n-  static void set_exception_types(oop constructor, oop value);\n-  static void set_modifiers(oop constructor, int value);\n-  static void set_signature(oop constructor, oop value);\n-  static void set_annotations(oop constructor, oop value);\n-  static void set_parameter_annotations(oop method, oop value);\n-\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.hpp","additions":37,"deletions":48,"binary":false,"changes":85,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -98,0 +98,1 @@\n+  do_klass(reflect_Executable_klass,                    java_lang_reflect_Executable                          ) \\\n","filename":"src\/hotspot\/share\/classfile\/vmClassMacros.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -112,0 +112,1 @@\n+  template(java_lang_reflect_Executable,              \"java\/lang\/reflect\/Executable\")             \\\n","filename":"src\/hotspot\/share\/classfile\/vmSymbols.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -68,7 +68,0 @@\n-    private final Class<T>            clazz;\n-    private final int                 slot;\n-    private final Class<?>[]          parameterTypes;\n-    private final Class<?>[]          exceptionTypes;\n-    private final int                 modifiers;\n-    \/\/ Generics and annotations support\n-    private final transient String    signature;\n@@ -76,3 +69,1 @@\n-    private transient volatile ConstructorRepository genericInfo;\n-    private final byte[]              annotations;\n-    private final byte[]              parameterAnnotations;\n+    private volatile ConstructorRepository genericInfo;\n@@ -95,1 +86,1 @@\n-                ConstructorRepository.make(getSignature(),\n+                ConstructorRepository.make(signature,\n@@ -130,8 +121,2 @@\n-        this.clazz = declaringClass;\n-        this.parameterTypes = parameterTypes;\n-        this.exceptionTypes = checkedExceptions;\n-        this.modifiers = modifiers;\n-        this.slot = slot;\n-        this.signature = signature;\n-        this.annotations = annotations;\n-        this.parameterAnnotations = parameterAnnotations;\n+        super(declaringClass, parameterTypes, checkedExceptions, modifiers,\n+                slot, signature, annotations, parameterAnnotations);\n@@ -156,1 +141,1 @@\n-        Constructor<T> res = new Constructor<>(clazz,\n+        Constructor<T> res = new Constructor<>(getDeclaringClass(),\n@@ -170,1 +155,1 @@\n-        var res = new Constructor<>(clazz, parameterTypes, exceptionTypes, modifiers, slot,\n+        var res = new Constructor<>(getDeclaringClass(), parameterTypes, exceptionTypes, modifiers, slot,\n@@ -210,10 +195,0 @@\n-    @Override\n-    boolean hasGenericInformation() {\n-        return (getSignature() != null);\n-    }\n-\n-    @Override\n-    byte[] getAnnotationBytes() {\n-        return annotations;\n-    }\n-\n@@ -225,0 +200,1 @@\n+    @SuppressWarnings(\"unchecked\")\n@@ -226,1 +202,1 @@\n-        return clazz;\n+        return (Class<T>) super.getDeclaringClass();\n@@ -244,1 +220,1 @@\n-        return modifiers;\n+        return super.getModifiers();\n@@ -255,23 +231,5 @@\n-      if (getSignature() != null) {\n-        return (TypeVariable<Constructor<T>>[])getGenericInfo().getTypeParameters();\n-      } else\n-          return (TypeVariable<Constructor<T>>[])GenericDeclRepository.EMPTY_TYPE_VARS;\n-    }\n-\n-\n-    @Override\n-    Class<?>[] getSharedParameterTypes() {\n-        return parameterTypes;\n-    }\n-\n-    @Override\n-    Class<?>[] getSharedExceptionTypes() {\n-        return exceptionTypes;\n-    }\n-\n-    \/**\n-     * {@inheritDoc}\n-     *\/\n-    @Override\n-    public Class<?>[] getParameterTypes() {\n-        return parameterTypes.length == 0 ? parameterTypes : parameterTypes.clone();\n+        if (signature != null) {\n+            return (TypeVariable<Constructor<T>>[])getGenericInfo().getTypeParameters();\n+        } else {\n+            return (TypeVariable<Constructor<T>>[]) GenericDeclRepository.EMPTY_TYPE_VARS;\n+        }\n@@ -284,1 +242,1 @@\n-    public int getParameterCount() { return parameterTypes.length; }\n+    public int getParameterCount() { return super.getParameterCount(); }\n@@ -298,8 +256,0 @@\n-    \/**\n-     * {@inheritDoc}\n-     *\/\n-    @Override\n-    public Class<?>[] getExceptionTypes() {\n-        return exceptionTypes.length == 0 ? exceptionTypes : exceptionTypes.clone();\n-    }\n-\n@@ -384,1 +334,1 @@\n-        for (Class<?> parameterType : getSharedParameterTypes()) {\n+        for (Class<?> parameterType : parameterTypes) {\n@@ -582,17 +532,0 @@\n-    int getSlot() {\n-        return slot;\n-    }\n-\n-    String getSignature() {\n-        return signature;\n-    }\n-\n-    byte[] getRawAnnotations() {\n-        return annotations;\n-    }\n-\n-    byte[] getRawParameterAnnotations() {\n-        return parameterAnnotations;\n-    }\n-\n-\n@@ -625,1 +558,1 @@\n-        return sharedGetParameterAnnotations(parameterTypes, parameterAnnotations);\n+        return super.getParameterAnnotations();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/Constructor.java","additions":17,"deletions":84,"binary":false,"changes":101,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -54,0 +54,10 @@\n+    \/\/ all final fields are used by the VM\n+    final Class<?> clazz;\n+    final int slot;\n+    @Stable final Class<?>[] parameterTypes;\n+    @Stable final Class<?>[] exceptionTypes;\n+    final int modifiers;\n+    final String signature;\n+    @Stable final byte[] annotations;\n+    @Stable final byte[] parameterAnnotations;\n+\n@@ -58,6 +68,17 @@\n-    Executable() {}\n-\n-    \/**\n-     * Accessor method to allow code sharing\n-     *\/\n-    abstract byte[] getAnnotationBytes();\n+    Executable(Class<?> declaringClass,\n+               Class<?>[] parameterTypes,\n+               Class<?>[] checkedExceptions,\n+               int modifiers,\n+               int slot,\n+               String signature,\n+               byte[] annotations,\n+               byte[] parameterAnnotations) {\n+        this.clazz = declaringClass;\n+        this.parameterTypes = parameterTypes;\n+        this.exceptionTypes = checkedExceptions;\n+        this.modifiers = modifiers;\n+        this.slot = slot;\n+        this.signature = signature;\n+        this.annotations = annotations;\n+        this.parameterAnnotations = parameterAnnotations;\n+    }\n@@ -68,1 +89,3 @@\n-    abstract boolean hasGenericInformation();\n+    boolean hasGenericInformation() {\n+        return signature != null;\n+    }\n@@ -199,1 +222,3 @@\n-    public abstract Class<?> getDeclaringClass();\n+    public Class<?> getDeclaringClass() {\n+        return clazz;\n+    }\n@@ -211,1 +236,3 @@\n-    public abstract int getModifiers();\n+    public int getModifiers() {\n+        return modifiers;\n+    }\n@@ -244,8 +271,0 @@\n-    \/\/ returns shared array of parameter types - must never give it out\n-    \/\/ to the untrusted code...\n-    abstract Class<?>[] getSharedParameterTypes();\n-\n-    \/\/ returns shared array of exception types - must never give it out\n-    \/\/ to the untrusted code...\n-    abstract Class<?>[] getSharedExceptionTypes();\n-\n@@ -269,1 +288,3 @@\n-    public abstract Class<?>[] getParameterTypes();\n+    public Class<?>[] getParameterTypes() {\n+        return parameterTypes.length == 0 ? parameterTypes : parameterTypes.clone();\n+    }\n@@ -279,1 +300,3 @@\n-    public abstract int getParameterCount();\n+    public int getParameterCount() {\n+        return parameterTypes.length;\n+    }\n@@ -354,1 +377,1 @@\n-            final Type[] nonGenericParamTypes = getSharedParameterTypes();\n+            final Type[] nonGenericParamTypes = parameterTypes;\n@@ -510,1 +533,3 @@\n-    public abstract Class<?>[] getExceptionTypes();\n+    public Class<?>[] getExceptionTypes() {\n+        return exceptionTypes.length == 0 ? exceptionTypes : exceptionTypes.clone();\n+    }\n@@ -601,4 +626,1 @@\n-    public abstract Annotation[][] getParameterAnnotations();\n-\n-    Annotation[][] sharedGetParameterAnnotations(Class<?>[] parameterTypes,\n-                                                 byte[] parameterAnnotations) {\n+    public Annotation[][] getParameterAnnotations() {\n@@ -668,1 +690,1 @@\n-                                getAnnotationBytes(),\n+                                annotations,\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/Executable.java","additions":49,"deletions":27,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -73,16 +73,6 @@\n-    private final Class<?>            clazz;\n-    private final int                 slot;\n-    \/\/ This is guaranteed to be interned by the VM in the 1.4\n-    \/\/ reflection implementation\n-    private final String              name;\n-    private final Class<?>            returnType;\n-    private final Class<?>[]          parameterTypes;\n-    private final Class<?>[]          exceptionTypes;\n-    private final int                 modifiers;\n-    \/\/ Generics and annotations support\n-    private final transient String    signature;\n-    \/\/ generic info repository; lazily initialized\n-    private transient volatile MethodRepository genericInfo;\n-    private final byte[]              annotations;\n-    private final byte[]              parameterAnnotations;\n-    private final byte[]              annotationDefault;\n+    \/\/ all final fields are used by the VM\n+    private final String name; \/\/ interned in hotspot\n+    private final Class<?> returnType;\n+    private @Stable final byte[] annotationDefault;\n+\n+    private volatile MethodRepository genericInfo;\n@@ -138,1 +128,2 @@\n-        this.clazz = declaringClass;\n+        super(declaringClass, parameterTypes, checkedExceptions, modifiers,\n+                slot, signature, annotations, parameterAnnotations);\n@@ -140,1 +131,0 @@\n-        this.parameterTypes = parameterTypes;\n@@ -142,6 +132,0 @@\n-        this.exceptionTypes = checkedExceptions;\n-        this.modifiers = modifiers;\n-        this.slot = slot;\n-        this.signature = signature;\n-        this.annotations = annotations;\n-        this.parameterAnnotations = parameterAnnotations;\n@@ -198,10 +182,0 @@\n-    @Override\n-    boolean hasGenericInformation() {\n-        return (getGenericSignature() != null);\n-    }\n-\n-    @Override\n-    byte[] getAnnotationBytes() {\n-        return annotations;\n-    }\n-\n@@ -214,1 +188,1 @@\n-        return clazz;\n+        return super.getDeclaringClass();\n@@ -232,1 +206,1 @@\n-        return modifiers;\n+        return super.getModifiers();\n@@ -290,18 +264,0 @@\n-    @Override\n-    Class<?>[] getSharedParameterTypes() {\n-        return parameterTypes;\n-    }\n-\n-    @Override\n-    Class<?>[] getSharedExceptionTypes() {\n-        return exceptionTypes;\n-    }\n-\n-    \/**\n-     * {@inheritDoc}\n-     *\/\n-    @Override\n-    public Class<?>[] getParameterTypes() {\n-        return parameterTypes.length == 0 ? parameterTypes: parameterTypes.clone();\n-    }\n-\n@@ -312,1 +268,1 @@\n-    public int getParameterCount() { return parameterTypes.length; }\n+    public int getParameterCount() { return super.getParameterCount(); }\n@@ -327,8 +283,0 @@\n-    \/**\n-     * {@inheritDoc}\n-     *\/\n-    @Override\n-    public Class<?>[] getExceptionTypes() {\n-        return exceptionTypes.length == 0 ? exceptionTypes : exceptionTypes.clone();\n-    }\n-\n@@ -430,1 +378,1 @@\n-        for (Class<?> parameterType : getSharedParameterTypes()) {\n+        for (Class<?> parameterType : parameterTypes) {\n@@ -804,1 +752,1 @@\n-        return sharedGetParameterAnnotations(parameterTypes, parameterAnnotations);\n+        return super.getParameterAnnotations();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/Method.java","additions":13,"deletions":65,"binary":false,"changes":78,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -237,1 +237,1 @@\n-            tmp = executable.getSharedParameterTypes()[index];\n+            tmp = executable.parameterTypes[index];\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/Parameter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -732,2 +732,2 @@\n-                        addElementTypes(types, m.getSharedParameterTypes());\n-                        addElementTypes(types, m.getSharedExceptionTypes());\n+                        addElementTypes(types, m.parameterTypes);\n+                        addElementTypes(types, m.exceptionTypes);\n@@ -1257,1 +1257,1 @@\n-                        Method m = proxyIntf.getMethod(method.getName(), method.getSharedParameterTypes());\n+                        Method m = proxyIntf.getMethod(method.getName(), method.parameterTypes);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/Proxy.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -508,1 +508,1 @@\n-        Class<?>[] exceptionTypes = m.getSharedExceptionTypes();\n+        Class<?>[] exceptionTypes = m.exceptionTypes;\n@@ -529,1 +529,1 @@\n-        sigmethods.add(new ProxyMethod(m, sig, m.getSharedParameterTypes(), returnType,\n+        sigmethods.add(new ProxyMethod(m, sig, m.parameterTypes, returnType,\n@@ -680,2 +680,2 @@\n-                 method.getSharedParameterTypes(), method.getReturnType(),\n-                 method.getSharedExceptionTypes(), method.getDeclaringClass(), methodFieldName);\n+                 method.parameterTypes, method.getReturnType(),\n+                 method.exceptionTypes, method.getDeclaringClass(), methodFieldName);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/ProxyGenerator.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -44,1 +44,1 @@\n-        return ex.getSharedParameterTypes();\n+        return ex.parameterTypes;\n@@ -48,1 +48,1 @@\n-        return ex.getSharedExceptionTypes();\n+        return ex.exceptionTypes;\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/ReflectAccess.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}