{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -131,1 +131,1 @@\n-        private final Map<Class <? extends Annotation>, Annotation> annotations;\n+        private final Map<Class<? extends Annotation>, Annotation> annotations;\n@@ -165,0 +165,1 @@\n+            Objects.requireNonNull(annotation);\n@@ -170,0 +171,1 @@\n+            Objects.requireNonNull(annotation);\n","filename":"src\/java.base\/share\/classes\/sun\/reflect\/annotation\/AnnotatedTypeFactory.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,101 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8371953 8371960\n+ * @summary Null checks for AnnotatedElement APIs.\n+ * @run junit AnnotatedElementNullCheckTest\n+ *\/\n+\n+import java.lang.reflect.AnnotatedArrayType;\n+import java.lang.reflect.AnnotatedElement;\n+import java.lang.reflect.AnnotatedParameterizedType;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.Consumer;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+class AnnotatedElementNullCheckTest {\n+\n+    \/\/ Return a stream of instances, each of a different implementation class\n+    static AnnotatedElement[] implementations() throws Exception {\n+        var objectHashCodeMethod = Object.class.getMethod(\"hashCode\");\n+        var annotatedParameterizedType = (AnnotatedParameterizedType) Optional.class\n+                .getMethod(\"ifPresent\", Consumer.class)\n+                .getAnnotatedParameterTypes()[0];\n+        var annotatedGenericArrayType = (AnnotatedArrayType) List.class\n+                .getMethod(\"of\", Object[].class)\n+                .getAnnotatedParameterTypes()[0];\n+        record Rec(int a) {}\n+        return new AnnotatedElement[] {\n+                Object.class,\n+                objectHashCodeMethod,\n+                System.class.getField(\"out\"),\n+                Object.class.getConstructor(),\n+                Object.class.getPackage(),\n+                Optional.class.getTypeParameters()[0],\n+                \/\/ AnnotatedType (direct)\n+                objectHashCodeMethod.getAnnotatedReturnType(),\n+                \/\/ AnnotatedParameterizedType\n+                annotatedParameterizedType,\n+                \/\/ AnnotatedArrayType\n+                annotatedGenericArrayType,\n+                \/\/ AnnotatedTypeVariable\n+                annotatedGenericArrayType.getAnnotatedGenericComponentType(),\n+                \/\/ AnnotatedWildcardType\n+                annotatedParameterizedType.getAnnotatedActualTypeArguments()[0],\n+                Rec.class.getRecordComponents()[0],\n+                Object.class.getMethod(\"equals\", Object.class).getParameters()[0],\n+                Object.class.getModule(),\n+        };\n+    }\n+\n+    @Test\n+    void ensureImplementationsDistinct() throws Throwable {\n+        var set = new HashSet<Class<?>>();\n+        for (var impl : implementations()) {\n+            var clazz = impl.getClass();\n+            if (!set.add(clazz)) {\n+                fail(\"Duplicate implementation class %s in %s\".formatted(clazz, impl));\n+            }\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"implementations\")\n+    void nullChecks(AnnotatedElement impl) {\n+        assertThrows(NullPointerException.class, () -> impl.isAnnotationPresent(null));\n+        assertThrows(NullPointerException.class, () -> impl.getAnnotation(null));\n+        assertThrows(NullPointerException.class, () -> impl.getAnnotationsByType(null));\n+        assertThrows(NullPointerException.class, () -> impl.getDeclaredAnnotation(null));\n+        assertThrows(NullPointerException.class, () -> impl.getDeclaredAnnotationsByType(null));\n+    }\n+}\n","filename":"test\/jdk\/java\/lang\/reflect\/AnnotatedElement\/AnnotatedElementNullCheckTest.java","additions":101,"deletions":0,"binary":false,"changes":101,"status":"added"}]}