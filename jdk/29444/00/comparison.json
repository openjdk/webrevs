{"files":[{"patch":"@@ -88,11 +88,9 @@\n-void ShenandoahBarrierSetAssembler::shenandoah_write_barrier_pre(MacroAssembler* masm,\n-                                                                 Register obj,\n-                                                                 Register pre_val,\n-                                                                 Register thread,\n-                                                                 Register tmp,\n-                                                                 bool tosca_live,\n-                                                                 bool expand_call) {\n-  if (ShenandoahSATBBarrier) {\n-    satb_write_barrier_pre(masm, obj, pre_val, thread, tmp, rscratch1, tosca_live, expand_call);\n-  }\n-}\n+void ShenandoahBarrierSetAssembler::satb_barrier(MacroAssembler* masm,\n+                                                 Register obj,\n+                                                 Register pre_val,\n+                                                 Register thread,\n+                                                 Register tmp1,\n+                                                 Register tmp2,\n+                                                 bool tosca_live,\n+                                                 bool expand_call) {\n+  assert(ShenandoahSATBBarrier, \"Should be checked by caller\");\n@@ -100,8 +98,0 @@\n-void ShenandoahBarrierSetAssembler::satb_write_barrier_pre(MacroAssembler* masm,\n-                                                           Register obj,\n-                                                           Register pre_val,\n-                                                           Register thread,\n-                                                           Register tmp1,\n-                                                           Register tmp2,\n-                                                           bool tosca_live,\n-                                                           bool expand_call) {\n@@ -361,8 +351,8 @@\n-    satb_write_barrier_pre(masm \/* masm *\/,\n-                           noreg \/* obj *\/,\n-                           dst \/* pre_val *\/,\n-                           rthread \/* thread *\/,\n-                           tmp1 \/* tmp1 *\/,\n-                           tmp2 \/* tmp2 *\/,\n-                           true \/* tosca_live *\/,\n-                           true \/* expand_call *\/);\n+    satb_barrier(masm \/* masm *\/,\n+                 noreg \/* obj *\/,\n+                 dst \/* pre_val *\/,\n+                 rthread \/* thread *\/,\n+                 tmp1 \/* tmp1 *\/,\n+                 tmp2 \/* tmp2 *\/,\n+                 true \/* tosca_live *\/,\n+                 true \/* expand_call *\/);\n@@ -374,1 +364,1 @@\n-void ShenandoahBarrierSetAssembler::store_check(MacroAssembler* masm, Register obj) {\n+void ShenandoahBarrierSetAssembler::card_barrier(MacroAssembler* masm, Register obj) {\n@@ -397,2 +387,2 @@\n-  bool on_oop = is_reference_type(type);\n-  if (!on_oop) {\n+  \/\/ 1: non-reference types require no barriers\n+  if (!is_reference_type(type)) {\n@@ -403,1 +393,1 @@\n-  \/\/ flatten object address if needed\n+  \/\/ Flatten object address right away for simplicity: likely needed by barriers\n@@ -412,7 +402,13 @@\n-  shenandoah_write_barrier_pre(masm,\n-                               tmp3 \/* obj *\/,\n-                               tmp2 \/* pre_val *\/,\n-                               rthread \/* thread *\/,\n-                               tmp1  \/* tmp *\/,\n-                               val != noreg \/* tosca_live *\/,\n-                               false \/* expand_call *\/);\n+  bool storing_non_null = (val != noreg);\n+\n+  \/\/ 2: pre-barrier: SATB needs the previous value\n+  if (ShenandoahBarrierSet::need_satb_barrier(decorators, type)) {\n+    satb_barrier(masm,\n+                 tmp3 \/* obj *\/,\n+                 tmp2 \/* pre_val *\/,\n+                 rthread \/* thread *\/,\n+                 tmp1 \/* tmp *\/,\n+                 rscratch1 \/* tmp2 *\/,\n+                 storing_non_null \/* tosca_live *\/,\n+                 false \/* expand_call *\/);\n+  }\n@@ -420,0 +416,1 @@\n+  \/\/ Store!\n@@ -422,4 +419,3 @@\n-  bool in_heap = (decorators & IN_HEAP) != 0;\n-  bool needs_post_barrier = (val != noreg) && in_heap && ShenandoahCardBarrier;\n-  if (needs_post_barrier) {\n-    store_check(masm, tmp3);\n+  \/\/ 3: post-barrier: card barrier needs store address\n+  if (ShenandoahBarrierSet::need_card_barrier(decorators, type) && storing_non_null) {\n+    card_barrier(masm, tmp3);\n","filename":"src\/hotspot\/cpu\/aarch64\/gc\/shenandoah\/shenandoahBarrierSetAssembler_aarch64.cpp","additions":38,"deletions":42,"binary":false,"changes":80,"status":"modified"},{"patch":"@@ -43,15 +43,8 @@\n-  void satb_write_barrier_pre(MacroAssembler* masm,\n-                              Register obj,\n-                              Register pre_val,\n-                              Register thread,\n-                              Register tmp1,\n-                              Register tmp2,\n-                              bool tosca_live,\n-                              bool expand_call);\n-  void shenandoah_write_barrier_pre(MacroAssembler* masm,\n-                                    Register obj,\n-                                    Register pre_val,\n-                                    Register thread,\n-                                    Register tmp,\n-                                    bool tosca_live,\n-                                    bool expand_call);\n+  void satb_barrier(MacroAssembler* masm,\n+                    Register obj,\n+                    Register pre_val,\n+                    Register thread,\n+                    Register tmp1,\n+                    Register tmp2,\n+                    bool tosca_live,\n+                    bool expand_call);\n@@ -59,1 +52,1 @@\n-  void store_check(MacroAssembler* masm, Register obj);\n+  void card_barrier(MacroAssembler* masm, Register obj);\n","filename":"src\/hotspot\/cpu\/aarch64\/gc\/shenandoah\/shenandoahBarrierSetAssembler_aarch64.hpp","additions":9,"deletions":16,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -53,4 +53,4 @@\n-void ShenandoahBarrierSetAssembler::satb_write_barrier(MacroAssembler *masm,\n-                                                       Register base, RegisterOrConstant ind_or_offs,\n-                                                       Register tmp1, Register tmp2, Register tmp3,\n-                                                       MacroAssembler::PreservationLevel preservation_level) {\n+void ShenandoahBarrierSetAssembler::satb_barrier(MacroAssembler *masm,\n+                                                 Register base, RegisterOrConstant ind_or_offs,\n+                                                 Register tmp1, Register tmp2, Register tmp3,\n+                                                 MacroAssembler::PreservationLevel preservation_level) {\n@@ -58,3 +58,3 @@\n-    __ block_comment(\"satb_write_barrier (shenandoahgc) {\");\n-    satb_write_barrier_impl(masm, 0, base, ind_or_offs, tmp1, tmp2, tmp3, preservation_level);\n-    __ block_comment(\"} satb_write_barrier (shenandoahgc)\");\n+    __ block_comment(\"satb_barrier (shenandoahgc) {\");\n+    satb_barrier_impl(masm, 0, base, ind_or_offs, tmp1, tmp2, tmp3, preservation_level);\n+    __ block_comment(\"} satb_barrier (shenandoahgc)\");\n@@ -201,5 +201,6 @@\n-void ShenandoahBarrierSetAssembler::satb_write_barrier_impl(MacroAssembler *masm, DecoratorSet decorators,\n-                                                            Register base, RegisterOrConstant ind_or_offs,\n-                                                            Register pre_val,\n-                                                            Register tmp1, Register tmp2,\n-                                                            MacroAssembler::PreservationLevel preservation_level) {\n+void ShenandoahBarrierSetAssembler::satb_barrier_impl(MacroAssembler *masm, DecoratorSet decorators,\n+                                                      Register base, RegisterOrConstant ind_or_offs,\n+                                                      Register pre_val,\n+                                                      Register tmp1, Register tmp2,\n+                                                      MacroAssembler::PreservationLevel preservation_level) {\n+  assert(ShenandoahSATBBarrier, \"Should be checked by caller\");\n@@ -577,1 +578,1 @@\n-      satb_write_barrier_impl(masm, 0, noreg, noreg, dst, tmp1, tmp2, preservation_level);\n+      satb_barrier_impl(masm, 0, noreg, noreg, dst, tmp1, tmp2, preservation_level);\n@@ -583,1 +584,1 @@\n-void ShenandoahBarrierSetAssembler::store_check(MacroAssembler* masm, Register base, RegisterOrConstant ind_or_offs, Register tmp) {\n+void ShenandoahBarrierSetAssembler::card_barrier(MacroAssembler* masm, Register base, RegisterOrConstant ind_or_offs, Register tmp) {\n@@ -606,4 +607,14 @@\n-  if (is_reference_type(type)) {\n-    if (ShenandoahSATBBarrier) {\n-      satb_write_barrier(masm, base, ind_or_offs, tmp1, tmp2, tmp3, preservation_level);\n-    }\n+  \/\/ 1: non-reference types require no barriers\n+  if (!is_reference_type(type)) {\n+    BarrierSetAssembler::store_at(masm, decorators, type,\n+                                  base, ind_or_offs,\n+                                  val,\n+                                  tmp1, tmp2, tmp3,\n+                                  preservation_level);\n+  }\n+\n+  bool storing_non_null = (val != noreg);\n+\n+  \/\/ 2: pre-barrier: SATB needs the previous value\n+  if (ShenandoahBarrierSet::need_satb_barrier(decorators, type)) {\n+    satb_barrier(masm, base, ind_or_offs, tmp1, tmp2, tmp3, preservation_level);\n@@ -612,0 +623,1 @@\n+  \/\/ Store!\n@@ -618,3 +630,3 @@\n-  \/\/ No need for post barrier if storing null\n-  if (ShenandoahCardBarrier && is_reference_type(type) && val != noreg) {\n-    store_check(masm, base, ind_or_offs, tmp1);\n+  \/\/ 3: post-barrier: card barrier needs store address\n+  if (ShenandoahBarrierSet::need_card_barrier(decorators, type) && storing_non_null) {\n+    card_barrier(masm, base, ind_or_offs, tmp1);\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/shenandoah\/shenandoahBarrierSetAssembler_ppc.cpp","additions":33,"deletions":21,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -48,5 +48,5 @@\n-  void satb_write_barrier_impl(MacroAssembler* masm, DecoratorSet decorators,\n-                               Register base, RegisterOrConstant ind_or_offs,\n-                               Register pre_val,\n-                               Register tmp1, Register tmp2,\n-                               MacroAssembler::PreservationLevel preservation_level);\n+  void satb_barrier_impl(MacroAssembler* masm, DecoratorSet decorators,\n+                         Register base, RegisterOrConstant ind_or_offs,\n+                         Register pre_val,\n+                         Register tmp1, Register tmp2,\n+                         MacroAssembler::PreservationLevel preservation_level);\n@@ -54,3 +54,3 @@\n-  void store_check(MacroAssembler* masm,\n-                   Register base, RegisterOrConstant ind_or_offs,\n-                   Register tmp);\n+  void card_barrier(MacroAssembler* masm,\n+                    Register base, RegisterOrConstant ind_or_offs,\n+                    Register tmp);\n@@ -88,4 +88,4 @@\n-  void satb_write_barrier(MacroAssembler* masm,\n-                          Register base, RegisterOrConstant ind_or_offs,\n-                          Register tmp1, Register tmp2, Register tmp3,\n-                          MacroAssembler::PreservationLevel preservation_level);\n+  void satb_barrier(MacroAssembler* masm,\n+                    Register base, RegisterOrConstant ind_or_offs,\n+                    Register tmp1, Register tmp2, Register tmp3,\n+                    MacroAssembler::PreservationLevel preservation_level);\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/shenandoah\/shenandoahBarrierSetAssembler_ppc.hpp","additions":12,"deletions":12,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -91,11 +91,9 @@\n-void ShenandoahBarrierSetAssembler::shenandoah_write_barrier_pre(MacroAssembler* masm,\n-                                                                 Register obj,\n-                                                                 Register pre_val,\n-                                                                 Register thread,\n-                                                                 Register tmp,\n-                                                                 bool tosca_live,\n-                                                                 bool expand_call) {\n-  if (ShenandoahSATBBarrier) {\n-    satb_write_barrier_pre(masm, obj, pre_val, thread, tmp, t0, tosca_live, expand_call);\n-  }\n-}\n+void ShenandoahBarrierSetAssembler::satb_barrier(MacroAssembler* masm,\n+                                                 Register obj,\n+                                                 Register pre_val,\n+                                                 Register thread,\n+                                                 Register tmp1,\n+                                                 Register tmp2,\n+                                                 bool tosca_live,\n+                                                 bool expand_call) {\n+  assert(ShenandoahSATBBarrier, \"Should be checked by caller\");\n@@ -103,8 +101,0 @@\n-void ShenandoahBarrierSetAssembler::satb_write_barrier_pre(MacroAssembler* masm,\n-                                                           Register obj,\n-                                                           Register pre_val,\n-                                                           Register thread,\n-                                                           Register tmp1,\n-                                                           Register tmp2,\n-                                                           bool tosca_live,\n-                                                           bool expand_call) {\n@@ -379,8 +369,8 @@\n-    satb_write_barrier_pre(masm \/* masm *\/,\n-                           noreg \/* obj *\/,\n-                           dst \/* pre_val *\/,\n-                           xthread \/* thread *\/,\n-                           tmp1 \/* tmp1 *\/,\n-                           tmp2 \/* tmp2 *\/,\n-                           true \/* tosca_live *\/,\n-                           true \/* expand_call *\/);\n+    satb_barrier(masm \/* masm *\/,\n+                 noreg \/* obj *\/,\n+                 dst \/* pre_val *\/,\n+                 xthread \/* thread *\/,\n+                 tmp1 \/* tmp1 *\/,\n+                 tmp2 \/* tmp2 *\/,\n+                 true \/* tosca_live *\/,\n+                 true \/* expand_call *\/);\n@@ -392,2 +382,2 @@\n-void ShenandoahBarrierSetAssembler::store_check(MacroAssembler* masm, Register obj) {\n-  assert(ShenandoahCardBarrier, \"Did you mean to enable ShenandoahCardBarrier?\");\n+void ShenandoahBarrierSetAssembler::card_barrier(MacroAssembler* masm, Register obj) {\n+  assert(ShenandoahCardBarrier, \"Should have been checked by caller\");\n@@ -416,2 +406,2 @@\n-  bool on_oop = is_reference_type(type);\n-  if (!on_oop) {\n+  \/\/ 1: non-reference types require no barriers\n+  if (!is_reference_type(type)) {\n@@ -422,1 +412,1 @@\n-  \/\/ flatten object address if needed\n+  \/\/ Flatten object address right away for simplicity: likely needed by barriers\n@@ -431,7 +421,13 @@\n-  shenandoah_write_barrier_pre(masm,\n-                               tmp3 \/* obj *\/,\n-                               tmp2 \/* pre_val *\/,\n-                               xthread \/* thread *\/,\n-                               tmp1  \/* tmp *\/,\n-                               val != noreg \/* tosca_live *\/,\n-                               false \/* expand_call *\/);\n+  bool storing_non_null = (val != noreg);\n+\n+  \/\/ 2: pre-barrier: SATB needs the previous value\n+  if (ShenandoahBarrierSet::need_satb_barrier(decorators, type)) {\n+    satb_barrier(masm,\n+                 tmp3 \/* obj *\/,\n+                 tmp2 \/* pre_val *\/,\n+                 xthread \/* thread *\/,\n+                 tmp1 \/* tmp *\/,\n+                 t0 \/* tmp2 *\/,\n+                 storing_non_null \/* tosca_live *\/,\n+                 false \/* expand_call *\/);\n+  }\n@@ -439,0 +435,1 @@\n+  \/\/ Store!\n@@ -441,4 +438,3 @@\n-  bool in_heap = (decorators & IN_HEAP) != 0;\n-  bool needs_post_barrier = (val != noreg) && in_heap && ShenandoahCardBarrier;\n-  if (needs_post_barrier) {\n-    store_check(masm, tmp3);\n+  \/\/ 3: post-barrier: card barrier needs store address\n+  if (ShenandoahBarrierSet::need_card_barrier(decorators, type) && storing_non_null) {\n+    card_barrier(masm, tmp3);\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/shenandoah\/shenandoahBarrierSetAssembler_riscv.cpp","additions":39,"deletions":43,"binary":false,"changes":82,"status":"modified"},{"patch":"@@ -44,15 +44,8 @@\n-  void satb_write_barrier_pre(MacroAssembler* masm,\n-                              Register obj,\n-                              Register pre_val,\n-                              Register thread,\n-                              Register tmp1,\n-                              Register tmp2,\n-                              bool tosca_live,\n-                              bool expand_call);\n-  void shenandoah_write_barrier_pre(MacroAssembler* masm,\n-                                    Register obj,\n-                                    Register pre_val,\n-                                    Register thread,\n-                                    Register tmp,\n-                                    bool tosca_live,\n-                                    bool expand_call);\n+  void satb_barrier(MacroAssembler* masm,\n+                    Register obj,\n+                    Register pre_val,\n+                    Register thread,\n+                    Register tmp1,\n+                    Register tmp2,\n+                    bool tosca_live,\n+                    bool expand_call);\n@@ -60,1 +53,1 @@\n-  void store_check(MacroAssembler* masm, Register obj);\n+  void card_barrier(MacroAssembler* masm, Register obj);\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/shenandoah\/shenandoahBarrierSetAssembler_riscv.hpp","additions":9,"deletions":16,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -177,11 +177,7 @@\n-void ShenandoahBarrierSetAssembler::shenandoah_write_barrier_pre(MacroAssembler* masm,\n-                                                                 Register obj,\n-                                                                 Register pre_val,\n-                                                                 Register tmp,\n-                                                                 bool tosca_live,\n-                                                                 bool expand_call) {\n-\n-  if (ShenandoahSATBBarrier) {\n-    satb_write_barrier_pre(masm, obj, pre_val, tmp, tosca_live, expand_call);\n-  }\n-}\n+void ShenandoahBarrierSetAssembler::satb_barrier(MacroAssembler* masm,\n+                                                 Register obj,\n+                                                 Register pre_val,\n+                                                 Register tmp,\n+                                                 bool tosca_live,\n+                                                 bool expand_call) {\n+  assert(ShenandoahSATBBarrier, \"Should be checked by caller\");\n@@ -189,6 +185,0 @@\n-void ShenandoahBarrierSetAssembler::satb_write_barrier_pre(MacroAssembler* masm,\n-                                                           Register obj,\n-                                                           Register pre_val,\n-                                                           Register tmp,\n-                                                           bool tosca_live,\n-                                                           bool expand_call) {\n@@ -536,6 +526,6 @@\n-    shenandoah_write_barrier_pre(masm \/* masm *\/,\n-                                 noreg \/* obj *\/,\n-                                 dst \/* pre_val *\/,\n-                                 tmp1 \/* tmp *\/,\n-                                 true \/* tosca_live *\/,\n-                                 true \/* expand_call *\/);\n+    satb_barrier(masm \/* masm *\/,\n+                 noreg \/* obj *\/,\n+                 dst \/* pre_val *\/,\n+                 tmp1 \/* tmp *\/,\n+                 true \/* tosca_live *\/,\n+                 true \/* expand_call *\/);\n@@ -547,1 +537,1 @@\n-void ShenandoahBarrierSetAssembler::store_check(MacroAssembler* masm, Register obj) {\n+void ShenandoahBarrierSetAssembler::card_barrier(MacroAssembler* masm, Register obj) {\n@@ -578,14 +568,11 @@\n-  bool on_oop = is_reference_type(type);\n-  bool in_heap = (decorators & IN_HEAP) != 0;\n-  bool as_normal = (decorators & AS_NORMAL) != 0;\n-  if (on_oop && in_heap) {\n-    bool needs_pre_barrier = as_normal;\n-\n-    \/\/ flatten object address if needed\n-    \/\/ We do it regardless of precise because we need the registers\n-    if (dst.index() == noreg && dst.disp() == 0) {\n-      if (dst.base() != tmp1) {\n-        __ movptr(tmp1, dst.base());\n-      }\n-    } else {\n-      __ lea(tmp1, dst);\n+  \/\/ 1: non-reference types require no barriers\n+  if (!is_reference_type(type)) {\n+    BarrierSetAssembler::store_at(masm, decorators, type, dst, val, tmp1, tmp2, tmp3);\n+    return;\n+  }\n+\n+  \/\/ Flatten object address right away for simplicity: likely needed by barriers\n+  assert_different_registers(val, tmp1, tmp2, tmp3, r15_thread);\n+  if (dst.index() == noreg && dst.disp() == 0) {\n+    if (dst.base() != tmp1) {\n+      __ movptr(tmp1, dst.base());\n@@ -593,0 +580,3 @@\n+  } else {\n+    __ lea(tmp1, dst);\n+  }\n@@ -594,1 +584,1 @@\n-    assert_different_registers(val, tmp1, tmp2, tmp3, r15_thread);\n+  bool storing_non_null = (val != noreg);\n@@ -596,8 +586,9 @@\n-    if (needs_pre_barrier) {\n-      shenandoah_write_barrier_pre(masm \/*masm*\/,\n-                                   tmp1 \/* obj *\/,\n-                                   tmp2 \/* pre_val *\/,\n-                                   tmp3  \/* tmp *\/,\n-                                   val != noreg \/* tosca_live *\/,\n-                                   false \/* expand_call *\/);\n-    }\n+  \/\/ 2: pre-barrier: SATB needs the previous value\n+  if (ShenandoahBarrierSet::need_satb_barrier(decorators, type)) {\n+    satb_barrier(masm,\n+                 tmp1 \/* obj *\/,\n+                 tmp2 \/* pre_val *\/,\n+                 tmp3 \/* tmp *\/,\n+                 storing_non_null \/* tosca_live *\/,\n+                 false \/* expand_call *\/);\n+  }\n@@ -605,8 +596,6 @@\n-    BarrierSetAssembler::store_at(masm, decorators, type, Address(tmp1, 0), val, noreg, noreg, noreg);\n-    if (val != noreg) {\n-      if (ShenandoahCardBarrier) {\n-        store_check(masm, tmp1);\n-      }\n-    }\n-  } else {\n-    BarrierSetAssembler::store_at(masm, decorators, type, dst, val, tmp1, tmp2, tmp3);\n+  \/\/ Store!\n+  BarrierSetAssembler::store_at(masm, decorators, type, Address(tmp1, 0), val, noreg, noreg, noreg);\n+\n+  \/\/ 3: post-barrier: card barrier needs store address\n+  if (ShenandoahBarrierSet::need_card_barrier(decorators, type) && storing_non_null) {\n+    card_barrier(masm, tmp1);\n","filename":"src\/hotspot\/cpu\/x86\/gc\/shenandoah\/shenandoahBarrierSetAssembler_x86.cpp","additions":44,"deletions":55,"binary":false,"changes":99,"status":"modified"},{"patch":"@@ -44,6 +44,6 @@\n-  void satb_write_barrier_pre(MacroAssembler* masm,\n-                              Register obj,\n-                              Register pre_val,\n-                              Register tmp,\n-                              bool tosca_live,\n-                              bool expand_call);\n+  void satb_barrier(MacroAssembler* masm,\n+                    Register obj,\n+                    Register pre_val,\n+                    Register tmp,\n+                    bool tosca_live,\n+                    bool expand_call);\n@@ -51,8 +51,1 @@\n-  void shenandoah_write_barrier_pre(MacroAssembler* masm,\n-                                    Register obj,\n-                                    Register pre_val,\n-                                    Register tmp,\n-                                    bool tosca_live,\n-                                    bool expand_call);\n-\n-  void store_check(MacroAssembler* masm, Register obj);\n+  void card_barrier(MacroAssembler* masm, Register obj);\n","filename":"src\/hotspot\/cpu\/x86\/gc\/shenandoah\/shenandoahBarrierSetAssembler_x86.hpp","additions":7,"deletions":14,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -75,1 +75,0 @@\n-  \/\/ Only needed for references\n@@ -81,1 +80,0 @@\n-  \/\/ Only needed for references\n@@ -83,1 +81,0 @@\n-\n@@ -90,0 +87,15 @@\n+bool ShenandoahBarrierSet::need_satb_barrier(DecoratorSet decorators, BasicType type) {\n+  if (!ShenandoahSATBBarrier) return false;\n+  if (!is_reference_type(type)) return false;\n+  bool as_normal = (decorators & AS_NORMAL) != 0;\n+  bool dest_uninitialized = (decorators & IS_DEST_UNINITIALIZED) != 0;\n+  return as_normal && !dest_uninitialized;\n+}\n+\n+bool ShenandoahBarrierSet::need_card_barrier(DecoratorSet decorators, BasicType type) {\n+  if (!ShenandoahCardBarrier) return false;\n+  if (!is_reference_type(type)) return false;\n+  bool in_heap = (decorators & IN_HEAP) != 0;\n+  return in_heap;\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.cpp","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -63,0 +63,2 @@\n+  static bool need_satb_barrier(DecoratorSet decorators, BasicType type);\n+  static bool need_card_barrier(DecoratorSet decorators, BasicType type);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}