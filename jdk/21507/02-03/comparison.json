{"files":[{"patch":"@@ -1986,1 +1986,1 @@\n-                        for (int m = cap - 1, pb = -1, b; ; pb = b) {\n+                        for (int m = cap - 1, pb = -1, b; ;) {\n@@ -1995,7 +1995,8 @@\n-                                if (a[b & m] == null &&\n-                                    a[(b + 1) & m] == null &&\n-                                    a[(b + 2) & m] == null)\n-                                    break;                \/\/ probably empty\n-                                if (pb == b) {\n-                                    rescan = true;        \/\/ stalled; reorder scan\n-                                    break scan;\n+                                if (a[b & m] == null) {\n+                                    if (a[(b + 1) & m] == null &&\n+                                        a[(b + 2) & m] == null)\n+                                        break;            \/\/ probably empty\n+                                    if (pb == (pb = b)) {\n+                                        rescan = true;    \/\/ stalled; reorder scan\n+                                        break scan;\n+                                    }\n@@ -2005,1 +2006,1 @@\n-                                q.base = b + 1;\n+                                ForkJoinTask<?> next = a[(q.base = b + 1) & m];\n@@ -2013,1 +2014,1 @@\n-                                    a[q.base & m] != null) {\n+                                    next != null) {\n@@ -2053,1 +2054,1 @@\n-            WorkQueue q;                      \/\/ interleave spins and rechecks\n+            WorkQueue q; int cap; ForkJoinTask<?>[] a;\n@@ -2058,1 +2059,1 @@\n-            Thread.onSpinWait();\n+            Thread.onSpinWait();              \/\/ interleave spins and rechecks\n@@ -2060,1 +2061,2 @@\n-                q.top - q.base > 0 && --checks == 0)\n+                (a = q.array) != null && (cap = a.length) > 0 &&\n+                a[q.base & (cap - 1)] != null && --checks == 0)\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":15,"deletions":13,"binary":false,"changes":28,"status":"modified"}]}