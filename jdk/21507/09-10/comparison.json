{"files":[{"patch":"@@ -1294,3 +1294,6 @@\n-                else if ((room == 0 || a[m & (s - (internal? 1 : 2))] == null) &&\n-                         pool != null)\n-                    pool.signalWork(); \/\/ may have appeared empty\n+                if ((room == 0 ||        \/\/ pad for InterruptibleTasks\n+                     a[m & (s - ((internal || task == null ||\n+                                  task.getClass().getSuperclass() !=\n+                                  interruptibleTaskClass) ? 1 : 2))] == null) &&\n+                    pool != null)\n+                    pool.signalWork();   \/\/ may have appeared empty\n@@ -1994,1 +1997,1 @@\n-                            ForkJoinTask<?> t; int b; long k; Object o;\n+                            ForkJoinTask<?> t; int b; long k;\n@@ -2000,1 +2003,3 @@\n-                                if (a[b & m] == null) {\n+                                if (a[b & m] == null &&\n+                                    a[(b + 1) & m] == null &&\n+                                    a[(b + 2) & m] == null) {\n@@ -2003,7 +2008,5 @@\n-                                    if (a[(b + 1) & m] == null &&\n-                                        a[(b + 2) & m] == null)\n-                                        break;            \/\/ probably empty\n-                                    if (pb == (pb = b)) {\n-                                        rescan = true;    \/\/ stalled; reorder scan\n-                                        break scan;\n-                                    }\n+                                    break;                \/\/ probably empty\n+                                }\n+                                if (pb == (pb = b)) {\n+                                    rescan = true;        \/\/ stalled; reorder scan\n+                                    break scan;\n@@ -2012,2 +2015,1 @@\n-                            else if ((o = U.compareAndExchangeReference(\n-                                          a, k, t, null)) == t) {\n+                            else if (U.compareAndSetReference(a, k, t, null)) {\n@@ -2018,5 +2020,5 @@\n-                                if ((src != (src = j) ||\n-                                     t.getClass().getSuperclass() ==\n-                                     interruptibleTaskClass) &&\n-                                    a[nb & m] != null)\n-                                    signalWork();         \/\/ propagate\n+                                boolean propagate = (src != (src = j)) ||\n+                                    t.getClass().getSuperclass() ==\n+                                    interruptibleTaskClass;\n+                                if (propagate && a[nb & m] != null)\n+                                    signalWork();\n@@ -2024,6 +2026,2 @@\n-                                if (q.base != nb)         \/\/ reduce interference\n-                                    break scan;\n-                            }\n-                            else if (o == null) {\n-                                rescan = true;            \/\/ move on collision\n-                                break scan;\n+                                if (!propagate && q.base != nb)\n+                                    break scan;          \/\/ reduce interference\n@@ -2031,0 +2029,2 @@\n+                            else if (rescan)\n+                                break scan;              \/\/ collision during run\n@@ -2065,1 +2065,1 @@\n-        for (int k = Math.max(n + (n << 1), SPIN_WAITS);;) {\n+        for (int k = Math.max(n + (n << 1), SPIN_WAITS << 1);;) {\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":26,"deletions":26,"binary":false,"changes":52,"status":"modified"}]}