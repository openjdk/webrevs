{"files":[{"patch":"@@ -1810,1 +1810,1 @@\n-        if (w != null) {\n+        if (w != null && (runState & STOP) == 0L) {\n@@ -1861,4 +1861,4 @@\n-        WorkQueue w; int phase;\n-        if ((w = ((wt == null) ? null : wt.workQueue)) == null)\n-            phase = 0;\n-        else if ((phase = w.phase) != 0 && (phase & IDLE) != 0)\n+        WorkQueue w = null;                \/\/ null if not created\n+        int phase = 0;                     \/\/ 0 if not registered\n+        if (wt != null && (w = wt.workQueue) != null &&\n+            (phase = w.phase) != 0 && (phase & IDLE) != 0)\n@@ -1873,2 +1873,1 @@\n-        if (phase != 0 && w != null && (runState & STOP) == 0L) {\n-            WorkQueue[] qs; int n, i;      \/\/ remove index unless terminating\n+        if (phase != 0 && w != null) {     \/\/ remove index unless terminating\n@@ -1876,3 +1875,5 @@\n-            if ((lockRunState() & STOP) == 0L &&\n-                (qs = queues) != null && (n = qs.length) > 0 &&\n-                qs[i = phase & SMASK & (n - 1)] == w) {\n+            if ((runState & STOP) == 0L) {\n+                WorkQueue[] qs; int n, i;\n+                if ((lockRunState() & STOP) == 0L &&\n+                    (qs = queues) != null && (n = qs.length) > 0 &&\n+                    qs[i = phase & SMASK & (n - 1)] == w) {\n@@ -1881,0 +1882,2 @@\n+                }\n+                unlockRunState();\n@@ -1882,1 +1885,0 @@\n-            unlockRunState();\n@@ -2603,2 +2605,2 @@\n-                long stop = lockRunState() & STOP;\n-                if (stop == 0L && queues == qs && qs[i] == null) {\n+                long shutdown = lockRunState() & SHUTDOWN;\n+                if (shutdown == 0L && queues == qs && qs[i] == null) {\n@@ -2611,1 +2613,1 @@\n-                if (stop != 0L)\n+                if (shutdown != 0L)\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":16,"deletions":14,"binary":false,"changes":30,"status":"modified"}]}