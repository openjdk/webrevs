{"files":[{"patch":"@@ -30,0 +30,1 @@\n+import java.util.regex.Matcher;\n@@ -48,0 +49,7 @@\n+        \/\/ We are parsing patterns:\n+        \/\/   #name\n+        \/\/   #{name}\n+        \/\/   $name\n+        \/\/   ${name}\n+        \/\/ But the \"#\" or \"$\" have already been removed, and the String\n+        \/\/ starts at the character after that.\n@@ -331,1 +339,1 @@\n-        int count = 0;\n+        int count = 0; \/\/ First part needs special handling\n@@ -335,0 +343,1 @@\n+            \/\/ Find the next \"$\" or \"#\", after start.\n@@ -347,2 +356,7 @@\n-                \/\/ TODO: add verification if we do not match? Add tests?\n-                currentCodeFrame.addString(NAME_PATTERN.matcher(part).replaceFirst(\n+                Matcher matcher = NAME_PATTERN.matcher(part);\n+                if (!matcher.find()) {\n+                    String replacement = isDollar ? \"$\" : \"#\";\n+                    throw new RendererException(\"Is not a valid '\" + replacement + \"' replacement pattern: '\" +\n+                                                replacement + part + \"' in '\" + s + \"'.\");\n+                }\n+                currentCodeFrame.addString(matcher.replaceFirst(\n@@ -360,0 +374,4 @@\n+            if (next == s.length()) {\n+                \/\/ No new \"#\" or \"$\" was found, terminate now.\n+                return;\n+            }\n@@ -363,1 +381,1 @@\n-        } while (start < s.length());\n+        } while (true);\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/template_framework\/Renderer.java","additions":22,"deletions":4,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -168,0 +168,1 @@\n+        expectRendererException(() -> testFailingHashtagName5(), \"Is not a valid '#' replacement pattern: '#' in '#'.\");\n@@ -1862,1 +1863,1 @@\n-        \/\/ \"#\" character not allowed in let hashtag name\n+            \/\/ \"#\" character not allowed in let hashtag name\n@@ -1868,0 +1869,7 @@\n+    public static void testFailingHashtagName5() {\n+        var template1 = Template.make(() -> body(\n+            \"#\" \/\/ empty hashtag name\n+        ));\n+        String code = template1.render();\n+    }\n+\n","filename":"test\/hotspot\/jtreg\/testlibrary_tests\/template_framework\/tests\/TestTemplate.java","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"}]}