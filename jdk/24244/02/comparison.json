{"files":[{"patch":"@@ -1531,0 +1531,50 @@\n+static char* _image_release_file_content = nullptr;\n+\n+void os::read_image_release_file() {\n+  const char* home = Arguments::get_java_home();\n+  int rfile_len = (int)strlen(home) + 10;\n+\n+  char* release_file = (char*) os::malloc(rfile_len, mtInternal);\n+  if (release_file) {\n+    os::snprintf(release_file, rfile_len, \"%s\/release\", home);\n+\n+    if (_image_release_file_content == nullptr) {\n+      FILE *file = fopen(release_file, \"rb\");\n+      if (!file) {\n+        free(release_file);\n+        return;\n+      }\n+      fseek(file, 0, SEEK_END);\n+      long sz = ftell(file);\n+      if (sz == -1) {\n+        free(release_file);\n+        return;\n+      }\n+      fseek(file, 0, SEEK_SET);\n+\n+      _image_release_file_content = (char*) os::malloc(sz + 1, mtInternal);\n+      if (!_image_release_file_content) {\n+        fclose(file);\n+        free(release_file);\n+        return;\n+      }\n+\n+      size_t elements_read = fread(_image_release_file_content, 1, sz, file);\n+      if (elements_read < (size_t)sz) _image_release_file_content[elements_read] = '\\0';\n+      _image_release_file_content[sz] = '\\0';\n+      \/\/ issues with \\r in line endings on Windows, so better replace those\n+      for (size_t i=0; i < elements_read; i++) {\n+        if (_image_release_file_content[i] == '\\r') { _image_release_file_content[i] = ' '; }\n+      }\n+      fclose(file);\n+    }\n+    free(release_file);\n+  }\n+}\n+\n+void os::print_image_release_file(outputStream* st) {\n+  if (_image_release_file_content != nullptr) {\n+    st->print_cr(\"%s\", _image_release_file_content);\n+  }\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":50,"deletions":0,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -673,0 +673,5 @@\n+\n+  \/\/ read\/store and print the release file of the image\n+  static void read_image_release_file();\n+  static void print_image_release_file(outputStream* st);\n+\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -428,0 +428,13 @@\n+\/\/ One-shot PeriodicTask subclass for reading release file\n+class ReadReleaseFileTask : public PeriodicTask {\n+ public:\n+  ReadReleaseFileTask(size_t interval_time) : PeriodicTask(interval_time) {}\n+\n+  virtual void task() {\n+    os::read_image_release_file();\n+\n+    \/\/ Reclaim our storage and disenroll ourself\n+    delete this;\n+  }\n+};\n+\n@@ -583,0 +596,3 @@\n+  ReadReleaseFileTask* read_task = new ReadReleaseFileTask(100);\n+  read_task->enroll();\n+\n","filename":"src\/hotspot\/share\/runtime\/threads.cpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -1253,0 +1253,4 @@\n+  STEP_IF(\"printing release file content\", _verbose)\n+    st->print_cr(\"Release file:\");\n+    os::print_image_release_file(st);\n+\n@@ -1432,0 +1436,4 @@\n+  \/\/ printing release file content\n+  st->print_cr(\"Release file:\");\n+  os::print_image_release_file(st);\n+\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"}]}