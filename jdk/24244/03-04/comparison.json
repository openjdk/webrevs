{"files":[{"patch":"@@ -1534,0 +1534,1 @@\n+  assert(_image_release_file_content == nullptr, \"release file content must not be already set\")\n@@ -1538,11 +1539,10 @@\n-  if (_image_release_file_content == nullptr) {\n-    FILE* file = fopen(ss.base(), \"rb\");\n-    if (file == nullptr) {\n-      return;\n-    }\n-    fseek(file, 0, SEEK_END);\n-    long sz = ftell(file);\n-    if (sz == -1) {\n-      return;\n-    }\n-    fseek(file, 0, SEEK_SET);\n+  FILE* file = fopen(ss.base(), \"rb\");\n+  if (file == nullptr) {\n+    return;\n+  }\n+  fseek(file, 0, SEEK_END);\n+  long sz = ftell(file);\n+  if (sz == -1) {\n+    return;\n+  }\n+  fseek(file, 0, SEEK_SET);\n@@ -1550,5 +1550,5 @@\n-    _image_release_file_content = (char*) os::malloc(sz + 1, mtInternal);\n-    if (!_image_release_file_content) {\n-      fclose(file);\n-      return;\n-    }\n+  char* tmp = (char*) os::malloc(sz + 1, mtInternal);\n+  if (tmp == nullptr) {\n+    fclose(file);\n+    return;\n+  }\n@@ -1556,11 +1556,10 @@\n-    size_t elements_read = fread(_image_release_file_content, 1, sz, file);\n-    if (elements_read < (size_t)sz) {\n-      _image_release_file_content[elements_read] = '\\0';\n-    } else {\n-      _image_release_file_content[sz] = '\\0';\n-    }\n-    \/\/ issues with \\r in line endings on Windows, so better replace those\n-    for (size_t i = 0; i < elements_read; i++) {\n-      if (_image_release_file_content[i] == '\\r') {\n-        _image_release_file_content[i] = ' ';\n-      }\n+  size_t elements_read = fread(tmp, 1, sz, file);\n+  if (elements_read < (size_t)sz) {\n+    tmp[elements_read] = '\\0';\n+  } else {\n+    tmp[sz] = '\\0';\n+  }\n+  \/\/ issues with \\r in line endings on Windows, so better replace those\n+  for (size_t i = 0; i < elements_read; i++) {\n+    if (tmp[i] == '\\r') {\n+      tmp[i] = ' ';\n@@ -1568,1 +1567,0 @@\n-    fclose(file);\n@@ -1570,0 +1568,2 @@\n+  Atomic::release_store(&_image_release_file_content, tmp);\n+  fclose(file);\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":28,"deletions":28,"binary":false,"changes":56,"status":"modified"}]}