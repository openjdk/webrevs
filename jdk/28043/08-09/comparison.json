{"files":[{"patch":"@@ -2659,2 +2659,1 @@\n-     * @throws IndexOutOfBoundsException if the {@code numChars + srcIndex} is larger than the length of\n-     *         this {@code String} object.\n+     * @throws IndexOutOfBoundsException if {@code srcIndex > src.length() - numChars}\n@@ -2670,0 +2669,1 @@\n+        Objects.checkFromIndexSize(srcIndex, numChars, src.length());\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/MemorySegment.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -177,2 +177,1 @@\n-     * @throws IndexOutOfBoundsException if the {@code numChars + srcIndex} is larger than the length of\n-     *         this {@code String} object.\n+     * @throws IndexOutOfBoundsException if {@code srcIndex > str.length() - numChars}\n@@ -190,0 +189,1 @@\n+        Objects.checkFromIndexSize(srcIndex, numChars, str.length());\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/SegmentAllocator.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+import jdk.internal.util.Preconditions;\n@@ -36,0 +37,1 @@\n+import java.lang.reflect.Array;\n@@ -38,0 +40,1 @@\n+import java.util.Objects;\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/StringSupport.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -108,3 +108,1 @@\n-        Set<String> excluded = Set.of(\"yen\");\n-        \/\/ This test only works for strings that can round trip through the given charsets\n-        if (!testString.isEmpty() && excluded.stream().noneMatch(testString::startsWith)) {\n+        if (!testString.isEmpty()) {\n@@ -131,3 +129,1 @@\n-        Set<String> excluded = Set.of(\"yen\");\n-        \/\/ This test only works for strings that can round trip through the given charsets\n-        if (!testString.isEmpty() && excluded.stream().noneMatch(testString::startsWith)) {\n+        if (!testString.isEmpty()) {\n@@ -164,0 +160,1 @@\n+            String testString_notBytesCompatible = \"snowman \\u26C4\";\n@@ -165,0 +162,2 @@\n+            MemorySegment text_notBytesCompatible = arena.allocate(JAVA_BYTE,\n+                    testString_notBytesCompatible.getBytes(StandardCharsets.UTF_8).length);\n@@ -166,0 +165,3 @@\n+            MemorySegment.copy(testString_notBytesCompatible, StandardCharsets.UTF_8, 0,\n+                    text_notBytesCompatible, 0,\n+                    testString_notBytesCompatible.length());\n@@ -180,1 +182,1 @@\n-            \/\/ dstOffset > byteSize() + B\n+            \/\/ dstOffset > byteSize() - B\n@@ -183,0 +185,5 @@\n+            \/\/ srcIndex + numChars overflows\n+            assertThrows(IndexOutOfBoundsException.class, () ->\n+                    MemorySegment.copy(testString, StandardCharsets.UTF_8, Integer.MAX_VALUE, text, 0, Integer.MAX_VALUE + 3));\n+            assertThrows(IndexOutOfBoundsException.class, () ->\n+                    MemorySegment.copy(testString_notBytesCompatible, StandardCharsets.UTF_8, Integer.MAX_VALUE, text, 0, Integer.MAX_VALUE + 3));\n@@ -190,0 +197,1 @@\n+            String testString_notBytesCompatible = \"snowman \\u26C4\";\n@@ -203,0 +211,5 @@\n+            \/\/ srcIndex + numChars overflows\n+            assertThrows(IndexOutOfBoundsException.class, () ->\n+                    arena.allocateFrom(testString, StandardCharsets.UTF_8, 3, Integer.MAX_VALUE));\n+            assertThrows(IndexOutOfBoundsException.class, () -> arena.allocateFrom(\n+                    testString_notBytesCompatible, StandardCharsets.UTF_8, 3, Integer.MAX_VALUE));\n@@ -594,1 +607,1 @@\n-                {\"yen \\u00A5\"},\n+                {\"section \\u00A7\"},\n","filename":"test\/jdk\/java\/foreign\/TestStringEncoding.java","additions":21,"deletions":8,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -77,1 +77,1 @@\n-        MemorySegment.copy(str, UTF_8, 0, strSegment, str.length());\n+        MemorySegment.copy(str, UTF_8, 0, strSegment, 0, str.length());\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/foreign\/FromJavaStringTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}