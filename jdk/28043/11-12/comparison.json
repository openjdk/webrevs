{"files":[{"patch":"@@ -1336,0 +1336,3 @@\n+     * This differs from {@link #getString(long, Charset)}, which will only read up\n+     * to the first {@code '\\0'}, resulting in truncation for string data that contains\n+     * the {@code '\\0'} character.\n@@ -1394,1 +1397,2 @@\n-     * will appear truncated when read again.\n+     * will appear truncated when read again. The string can be read without\n+     * truncation using {@link #getString(long, Charset, long)}.\n@@ -2646,1 +2650,2 @@\n-     * will appear truncated when read again.\n+     * will appear truncated when read again. The string can be read without\n+     * truncation using {@link #getString(long, Charset, long)}.\n@@ -2665,0 +2670,1 @@\n+     * @return the number of copied bytes.\n@@ -2667,1 +2673,1 @@\n-    static void copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, long dstOffset, int numChars) {\n+    static long copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, long dstOffset, int numChars) {\n@@ -2673,1 +2679,1 @@\n-        AbstractMemorySegmentImpl.copy(src, dstEncoding, srcIndex, dst, dstOffset, numChars);\n+        return AbstractMemorySegmentImpl.copy(src, dstEncoding, srcIndex, dst, dstOffset, numChars);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/MemorySegment.java","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -114,1 +114,2 @@\n-     * will appear truncated when read again.\n+     * will appear truncated when read again. The string can be read without\n+     * truncation using {@link MemorySegment#getString(long, Charset, long)}.\n@@ -168,1 +169,2 @@\n-     * will appear truncated when read again.\n+     * will appear truncated when read again. The string can be read without\n+     * truncation using {@link MemorySegment#getString(long, Charset, long)}.\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/SegmentAllocator.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -697,1 +697,1 @@\n-    public static void copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, long dstOffset, int numChars) {\n+    public static long copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, long dstOffset, int numChars) {\n@@ -703,1 +703,1 @@\n-        StringSupport.copyBytes(src, destImpl, dstEncoding, dstOffset, srcIndex, numChars);\n+        return StringSupport.copyBytes(src, destImpl, dstEncoding, dstOffset, srcIndex, numChars);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/AbstractMemorySegmentImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -356,8 +356,1 @@\n-        if (bytesCompatible(string, charset, 0, string.length())) {\n-            copyToSegmentRaw(string, segment, offset, 0, string.length());\n-            return string.length();\n-        } else {\n-            byte[] bytes = string.getBytes(charset);\n-            MemorySegment.copy(bytes, 0, segment, JAVA_BYTE, offset, bytes.length);\n-            return bytes.length;\n-        }\n+        return copyBytes(string, segment, charset, offset, 0, string.length());\n@@ -369,1 +362,1 @@\n-            return string.length();\n+            return numChars;\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/StringSupport.java","additions":2,"deletions":9,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -416,1 +416,1 @@\n-                            MemorySegment.copy(testString, charset, srcIndex, text, 0, numChars);\n+                            long copied = MemorySegment.copy(testString, charset, srcIndex, text, 0, numChars);\n@@ -419,0 +419,1 @@\n+                            assertEquals(copied, length);\n","filename":"test\/jdk\/java\/foreign\/TestStringEncoding.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}