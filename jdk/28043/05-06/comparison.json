{"files":[{"patch":"@@ -1299,1 +1299,1 @@\n-     * known byte length can be done using {@link #getString(long, Charset, int)}.\n+     * known byte length can be done using {@link #getString(long, Charset, long)}.\n@@ -2654,0 +2654,1 @@\n+     * @param dstOffset the starting offset, in bytes, of the destination segment\n@@ -2659,2 +2660,3 @@\n-     * @throws IndexOutOfBoundsException if either {@code srcIndex} or {@code numChars} are {@code < 0}\n-     * @throws IndexOutOfBoundsException  if the {@code endIndex} is larger than the length of\n+     * @throws IndexOutOfBoundsException if either {@code srcIndex}, {@code numChars}, or {@code dstOffset}\n+     *         are {@code < 0}\n+     * @throws IndexOutOfBoundsException if the {@code endIndex} is larger than the length of\n@@ -2663,2 +2665,3 @@\n-     * @throws IllegalArgumentException if {@code charset} is not a\n-     *         {@linkplain StandardCharsets standard charset}\n+     * @throws IllegalArgumentException if {@code charset} is not a {@linkplain StandardCharsets standard charset}\n+     * @throws IndexOutOfBoundsException if {@code dstOffset > dstSegment.byteSize() - B} where {@code B} is the size,\n+     *         in bytes, of the string encoded using the given charset.\n@@ -2667,1 +2670,1 @@\n-    static void copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, int numChars) {\n+    static void copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, long dstOffset, int numChars) {\n@@ -2672,1 +2675,1 @@\n-        AbstractMemorySegmentImpl.copy(src, dstEncoding, srcIndex, dst, numChars);\n+        AbstractMemorySegmentImpl.copy(src, dstEncoding, srcIndex, dst, dstOffset, numChars);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/MemorySegment.java","additions":10,"deletions":7,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -34,2 +34,0 @@\n-import java.nio.ByteBuffer;\n-import java.nio.CharBuffer;\n@@ -198,2 +196,2 @@\n-        } else if (srcIndex == 0 && numChars == str.length()) {\n-            byte[] bytes = str.getBytes(charset);\n+        } else {\n+            byte[] bytes = str.substring(srcIndex, numChars).getBytes(charset);\n@@ -202,5 +200,0 @@\n-        } else {\n-            CharBuffer charBuffer = CharBuffer.wrap(str, srcIndex, numChars);\n-            ByteBuffer bytes = charset.encode(charBuffer);\n-            segment = allocateNoInit(bytes.limit());\n-            MemorySegment.copy(bytes, 0, segment, ValueLayout.JAVA_BYTE, 0, bytes.limit());\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/SegmentAllocator.java","additions":2,"deletions":9,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -699,1 +699,1 @@\n-    public static void copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, int numChars) {\n+    public static void copy(String src, Charset dstEncoding, int srcIndex, MemorySegment dst, long dstOffset, int numChars) {\n@@ -705,1 +705,1 @@\n-        StringSupport.copyBytes(src, destImpl, dstEncoding, 0, srcIndex, numChars);\n+        StringSupport.copyBytes(src, destImpl, dstEncoding, dstOffset, srcIndex, numChars);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/AbstractMemorySegmentImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -36,2 +36,0 @@\n-import java.nio.ByteBuffer;\n-import java.nio.CharBuffer;\n@@ -366,2 +364,2 @@\n-        } else if (srcIndex == 0 && numChars == string.length()) {\n-            byte[] bytes = string.getBytes();\n+        } else {\n+            byte[] bytes = string.substring(srcIndex, numChars).getBytes(charset);\n@@ -370,5 +368,0 @@\n-        } else {\n-            CharBuffer charBuffer = CharBuffer.wrap(string, srcIndex, numChars);\n-            ByteBuffer byteBuffer = segment.asByteBuffer().position((int) offset);\n-            charset.newEncoder().encode(charBuffer, byteBuffer, false);\n-            return byteBuffer.position();\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/StringSupport.java","additions":2,"deletions":9,"binary":false,"changes":11,"status":"modified"}]}