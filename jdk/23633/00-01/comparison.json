{"files":[{"patch":"@@ -1386,1 +1386,1 @@\n-void C2_MacroAssembler::string_compare_long_LL_UU(Register str1, Register str2,\n+void C2_MacroAssembler::string_compare_long_LL_UU(Register result, Register str1, Register str2,\n@@ -1390,2 +1390,2 @@\n-                                                  const int STUB_THRESHOLD, Label *DONE, Label *DIFFERENCE, Label *STUB) {\n-  Label TAIL_CHECK, TAIL, NEXT_WORD;\n+                                                  const int STUB_THRESHOLD, Label *DONE, Label *STUB) {\n+  Label TAIL_CHECK, TAIL, NEXT_WORD, DIFFERENCE;\n@@ -1399,1 +1399,1 @@\n-    bne(tmp1, tmp2, *DIFFERENCE);\n+    bne(tmp1, tmp2, DIFFERENCE);\n@@ -1430,1 +1430,1 @@\n-  bne(tmp1, tmp2, *DIFFERENCE);\n+  bne(tmp1, tmp2, DIFFERENCE);\n@@ -1442,1 +1442,1 @@\n-  bne(tmp1, tmp2, *DIFFERENCE);\n+  bne(tmp1, tmp2, DIFFERENCE);\n@@ -1451,0 +1451,20 @@\n+\n+\n+  \/\/ Find the first different characters in the longwords and\n+  \/\/ compute their difference.\n+  bind(DIFFERENCE);\n+  xorr(tmp3, tmp1, tmp2);\n+  \/\/ count bits of trailing zero chars\n+  ctzc_bits(result, tmp3, isLL);\n+  srl(tmp1, tmp1, result);\n+  srl(tmp2, tmp2, result);\n+  if (isLL) {\n+    zext(tmp1, tmp1, 8);\n+    zext(tmp2, tmp2, 8);\n+  } else {\n+    zext(tmp1, tmp1, 16);\n+    zext(tmp2, tmp2, 16);\n+  }\n+  sub(result, tmp1, tmp2);\n+\n+  j(*DONE);\n@@ -1454,6 +1474,6 @@\n-void C2_MacroAssembler::string_compare_long_LU(Register strL, Register strU,\n-                                                Register cnt1, Register cnt2,\n-                                                Register tmpL, Register tmpU, Register tmp3,\n-                                                const int base_offset2, const int STUB_THRESHOLD,\n-                                                Label *DONE, Label *DIFFERENCE, Label *STUB) {\n-  Label TAIL, NEXT_WORD;\n+void C2_MacroAssembler::string_compare_long_LU(Register result, Register strL, Register strU,\n+                                               Register cnt1, Register cnt2,\n+                                               Register tmpL, Register tmpU, Register tmp3,\n+                                               const int base_offset2, const int STUB_THRESHOLD,\n+                                               Label *DONE, Label *STUB) {\n+  Label TAIL, NEXT_WORD, DIFFERENCE;\n@@ -1477,1 +1497,1 @@\n-  bne(tmpL, tmpU, *DIFFERENCE);\n+  bne(tmpL, tmpU, DIFFERENCE);\n@@ -1491,1 +1511,1 @@\n-  bne(tmpL, tmpU, *DIFFERENCE);\n+  bne(tmpL, tmpU, DIFFERENCE);\n@@ -1501,0 +1521,15 @@\n+\n+\n+  \/\/ Find the first different characters in the longwords and\n+  \/\/ compute their difference.\n+  bind(DIFFERENCE);\n+  xorr(tmp3, tmpL, tmpU);\n+  \/\/ count bits of trailing zero chars\n+  ctzc_bits(result, tmp3);\n+  srl(tmpL, tmpL, result);\n+  srl(tmpU, tmpU, result);\n+  zext(tmpL, tmpL, 16);\n+  zext(tmpU, tmpU, 16);\n+  sub(result, tmpL, tmpU);\n+\n+  j(*DONE);\n@@ -1510,1 +1545,1 @@\n-        DIFFERENCE, SHORT_LOOP_TAIL, SHORT_LAST2, SHORT_LAST_INIT,\n+        SHORT_LOOP_TAIL, SHORT_LAST2, SHORT_LAST_INIT,\n@@ -1566,1 +1601,1 @@\n-      string_compare_long_LL_UU(str1, str2,\n+      string_compare_long_LL_UU(result, str1, str2,\n@@ -1569,1 +1604,1 @@\n-                                STUB_THRESHOLD, &DONE, &DIFFERENCE, &STUB);\n+                                STUB_THRESHOLD, &DONE, &STUB);\n@@ -1571,1 +1606,2 @@\n-      string_compare_long_LU(isLU ? str1 : str2,\n+      string_compare_long_LU(result,\n+                             isLU ? str1 : str2,\n@@ -1575,17 +1611,1 @@\n-                             &DONE, &DIFFERENCE, &STUB);\n-    }\n-\n-    \/\/ Find the first different characters in the longwords and\n-    \/\/ compute their difference.\n-    bind(DIFFERENCE);\n-    xorr(tmp3, tmp1, tmp2);\n-    \/\/ count bits of trailing zero chars\n-    ctzc_bits(result, tmp3, isLL);\n-    srl(tmp1, tmp1, result);\n-    srl(tmp2, tmp2, result);\n-    if (isLL) {\n-      zext(tmp1, tmp1, 8);\n-      zext(tmp2, tmp2, 8);\n-    } else {\n-      zext(tmp1, tmp1, 16);\n-      zext(tmp2, tmp2, 16);\n+                             &DONE, &STUB);\n@@ -1593,2 +1613,0 @@\n-    sub(result, tmp1, tmp2);\n-    j(DONE);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":55,"deletions":37,"binary":false,"changes":92,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-  void string_compare_long_LL_UU(Register str1, Register str2,\n+  void string_compare_long_LL_UU(Register result, Register str1, Register str2,\n@@ -46,2 +46,2 @@\n-                                  const int STUB_THRESHOLD, Label *DONE, Label *DIFFERENCE, Label *STUB);\n-  void string_compare_long_LU(Register str1, Register str2,\n+                                  const int STUB_THRESHOLD, Label *DONE, Label *STUB);\n+  void string_compare_long_LU(Register result, Register str1, Register str2,\n@@ -51,1 +51,1 @@\n-                                  Label *DONE, Label *DIFFERENCE, Label *STUB);\n+                                  Label *DONE, Label *STUB);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}