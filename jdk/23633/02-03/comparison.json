{"files":[{"patch":"@@ -1387,1 +1387,1 @@\n-                                                  Register cnt1, Register cnt2,\n+                                                  const bool isLL, Register cnt1, Register cnt2,\n@@ -1389,1 +1389,0 @@\n-                                                  const bool isLL, const int base_offset, const int minCharsInWord,\n@@ -1393,0 +1392,10 @@\n+  int base_offset1 = arrayOopDesc::base_offset_in_bytes(T_BYTE);\n+  int base_offset2 = arrayOopDesc::base_offset_in_bytes(T_CHAR);\n+  assert((base_offset1 % (UseCompactObjectHeaders ? 4 :\n+                          (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+  assert((base_offset2 % (UseCompactObjectHeaders ? 4 :\n+                          (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+  const int base_offset = isLL ? base_offset1 : base_offset2;\n+\n+  const int minCharsInWord = isLL ? wordSize : wordSize \/ 2;\n+\n@@ -1473,2 +1482,2 @@\n-void C2_MacroAssembler::string_compare_long_different_encoding(Register result, Register strL, Register strU,\n-                                               bool isUL, Register cnt1, Register cnt2,\n+void C2_MacroAssembler::string_compare_long_different_encoding(Register result, Register str1, Register str2,\n+                                               bool isLU, Register cnt1, Register cnt2,\n@@ -1476,2 +1485,1 @@\n-                                               const int base_offset2, const int STUB_THRESHOLD,\n-                                               Label *DONE, Label *STUB) {\n+                                               const int STUB_THRESHOLD, Label *DONE, Label *STUB) {\n@@ -1480,0 +1488,7 @@\n+  const int base_offset = arrayOopDesc::base_offset_in_bytes(T_CHAR);\n+  assert((base_offset % (UseCompactObjectHeaders ? 4 :\n+                          (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+\n+  Register strL = isLU ? str1 : str2;\n+  Register strU = isLU ? str2 : str1;\n+\n@@ -1484,1 +1499,1 @@\n-  load_long_misaligned(tmpU, Address(strU), tmp3, (base_offset2 % 8) != 0 ? 4 : 8);\n+  load_long_misaligned(tmpU, Address(strU), tmp3, (base_offset % 8) != 0 ? 4 : 8);\n@@ -1504,1 +1519,1 @@\n-    load_long_misaligned(tmpU, Address(t0), tmp3, (base_offset2 % 8) != 0 ? 4 : 8);\n+    load_long_misaligned(tmpU, Address(t0), tmp3, (base_offset % 8) != 0 ? 4 : 8);\n@@ -1531,3 +1546,1 @@\n-  if (isUL) {\n-    sub(result, tmpU, tmpL);\n-  } else {\n+  if (isLU) {\n@@ -1535,0 +1548,2 @@\n+  } else {\n+    sub(result, tmpU, tmpL);\n@@ -1567,8 +1582,0 @@\n-  int base_offset1 = arrayOopDesc::base_offset_in_bytes(T_BYTE);\n-  int base_offset2 = arrayOopDesc::base_offset_in_bytes(T_CHAR);\n-\n-  assert((base_offset1 % (UseCompactObjectHeaders ? 4 :\n-                          (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n-  assert((base_offset2 % (UseCompactObjectHeaders ? 4 :\n-                          (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n-\n@@ -1603,1 +1610,2 @@\n-      string_compare_long_same_encoding(result, str1, str2,\n+      string_compare_long_same_encoding(result,\n+                                str1, str2, isLL,\n@@ -1605,1 +1613,0 @@\n-                                isLL, isLL ? base_offset1 : base_offset2, minCharsInWord,\n@@ -1609,6 +1616,3 @@\n-                             isLU ? str1 : str2,\n-                             isLU ? str2 : str1,\n-                             isUL,\n-                             cnt1, cnt2, tmp1, tmp2, tmp3,\n-                             base_offset2, STUB_THRESHOLD,\n-                             &DONE, &STUB);\n+                                str1, str2, isLU,\n+                                cnt1, cnt2, tmp1, tmp2, tmp3,\n+                                STUB_THRESHOLD, &DONE, &STUB);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":31,"deletions":27,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-                                  Register cnt1, Register cnt2,\n+                                  const bool isLL, Register cnt1, Register cnt2,\n@@ -45,1 +45,0 @@\n-                                  const bool isLL, const int base_offset, const int minCharsInWord,\n@@ -48,1 +47,1 @@\n-                                  bool isUL, Register cnt1, Register cnt2,\n+                                  bool isLU, Register cnt1, Register cnt2,\n@@ -50,2 +49,1 @@\n-                                  const int base_offset2, const int STUB_THRESHOLD,\n-                                  Label *DONE, Label *STUB);\n+                                  const int STUB_THRESHOLD, Label *DONE, Label *STUB);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.hpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"}]}