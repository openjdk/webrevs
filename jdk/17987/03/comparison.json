{"files":[{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,0 +125,1 @@\n+    OPENJDK_TARGET_OS_TYPE := unix\n@@ -126,1 +127,0 @@\n-    LD_OUT_OPTION := -o$(SPACE)\n","filename":"make\/Hsdis.gmk","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,0 +43,1 @@\n+LIB := @BUILD_LIB@\n","filename":"make\/autoconf\/buildjdk-spec.gmk.template","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -96,1 +96,1 @@\n-    BASIC_LDFLAGS=\"-nologo -opt:ref\"\n+    BASIC_LDFLAGS=\"-opt:ref\"\n","filename":"make\/autoconf\/flags-ldflags.m4","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,3 +36,0 @@\n-  elif test \"x$OPENJDK_TARGET_OS\" = xwindows; then\n-    # lib.exe is used as AR to create static libraries.\n-    ARFLAGS=\"-nologo -NODEFAULTLIB:MSVCRT\"\n@@ -46,0 +43,12 @@\n+AC_DEFUN([FLAGS_SETUP_LIBFLAGS],\n+[\n+  # LIB is used to create static libraries on Windows\n+  if test \"x$OPENJDK_TARGET_OS\" = xwindows; then\n+    LIBFLAGS=\"-nodefaultlib:msvcrt\"\n+  else\n+    LIBFLAGS=\"\"\n+  fi\n+\n+  AC_SUBST(LIBFLAGS)\n+])\n+\n","filename":"make\/autoconf\/flags-other.m4","additions":13,"deletions":4,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -367,2 +367,0 @@\n-    LD_OUT_OPTION=-out:\n-    AR_OUT_OPTION=-out:\n@@ -373,8 +371,0 @@\n-    # When linking, how to specify the output\n-    LD_OUT_OPTION='-o$(SPACE)'\n-    # When archiving, how to specify the destination static archive.\n-    if test \"x$OPENJDK_TARGET_OS\" = xmacosx; then\n-      AR_OUT_OPTION='-r -cs$(SPACE)'\n-    else\n-      AR_OUT_OPTION='-rcs$(SPACE)'\n-    fi\n@@ -383,2 +373,0 @@\n-  AC_SUBST(LD_OUT_OPTION)\n-  AC_SUBST(AR_OUT_OPTION)\n@@ -426,0 +414,1 @@\n+  FLAGS_SETUP_LIBFLAGS\n","filename":"make\/autoconf\/flags.m4","additions":2,"deletions":13,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -501,2 +501,0 @@\n-LD_OUT_OPTION := @LD_OUT_OPTION@\n-AR_OUT_OPTION := @AR_OUT_OPTION@\n@@ -607,1 +605,0 @@\n-# AR is used to create a static library (is ar in unix, lib.exe in windows)\n@@ -610,1 +607,2 @@\n-\n+LIB := @LIB@\n+LIBFLAGS := @LIBFLAGS@\n","filename":"make\/autoconf\/spec.gmk.template","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -735,1 +735,1 @@\n-  # Setup the archiver (AR)\n+  # Setup tools for creating static libraries (AR\/LIB)\n@@ -738,2 +738,1 @@\n-    # The corresponding ar tool is lib.exe (used to create static libraries)\n-    UTIL_LOOKUP_TOOLCHAIN_PROGS(AR, lib)\n+    UTIL_LOOKUP_TOOLCHAIN_PROGS(LIB, lib)\n","filename":"make\/autoconf\/toolchain.m4","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+include native\/LinkMicrosoft.gmk\n@@ -75,1 +76,2 @@\n-#   ARFLAGS the archiver flags to be used\n+#   ARFLAGS the archiver flags to be used on unix platforms\n+#   LIBFLAGS the flags for the lib tool used on windows\n@@ -201,1 +203,5 @@\n-  $$(eval $$(call SetupLinking,$1))\n+  ifneq ($(TOOLCHAIN_TYPE), microsoft)\n+    $$(eval $$(call SetupLinking,$1))\n+  else\n+    $$(eval $$(call SetupLinkingMicrosoft,$1))\n+  endif\n@@ -206,1 +212,5 @@\n-  $$(eval $$(call CreateLinkedResult,$1))\n+  ifneq ($(TOOLCHAIN_TYPE), microsoft)\n+    $$(eval $$(call CreateLinkedResult,$1))\n+  else\n+    $$(eval $$(call CreateLinkedResultMicrosoft,$1))\n+  endif\n","filename":"make\/common\/NativeCompilation.gmk","additions":13,"deletions":3,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -65,5 +65,4 @@\n-    ifneq ($$($1_STRIP), )\n-      # Default to using the global STRIPFLAGS. Allow for overriding with an empty value\n-      $1_STRIPFLAGS ?= $(STRIPFLAGS)\n-      $1_STRIP_CMD := $$($1_STRIP) $$($1_STRIPFLAGS) $$($1_TARGET)\n-    endif\n+    # Default to using the global STRIPFLAGS. Allow for overriding with an\n+    # empty value\n+    $1_STRIPFLAGS ?= $(STRIPFLAGS)\n+    $1_STRIP_CMD := $$($1_STRIP) $$($1_STRIPFLAGS) $$($1_TARGET)\n@@ -84,1 +83,1 @@\n-  # Include partial linking when building the static library with clang on linux.\n+  # Include partial linking when building the static library with clang on linux\n@@ -106,1 +105,2 @@\n-  $1_TARGET_DEPS := $$($1_ALL_OBJS) $$($1_RES) $$($1_VARDEPS_FILE) $$(STATIC_MAPFILE_DEP)\n+  $1_TARGET_DEPS := $$($1_ALL_OBJS) $$($1_RES) $$($1_VARDEPS_FILE) \\\n+      $$(STATIC_MAPFILE_DEP)\n@@ -131,1 +131,1 @@\n-\t        $(LD_OUT_OPTION)$$($1_TARGET_RELOCATABLE) \\\n+\t        -o $$($1_TARGET_RELOCATABLE) \\\n@@ -136,2 +136,2 @@\n-\t    $$($1_AR) $$(ARFLAGS) $$($1_ARFLAGS) $(AR_OUT_OPTION)$$($1_TARGET) $$($1_AR_OBJ_ARG) \\\n-\t        $$($1_RES))\n+\t    $$($1_AR) $$(ARFLAGS) $$($1_ARFLAGS) -r -cs $$($1_TARGET) \\\n+\t        $$($1_AR_OBJ_ARG) $$($1_RES))\n@@ -177,28 +177,3 @@\n-  ifeq ($(call isTargetOs, windows), true)\n-    ifeq ($$($1_EMBED_MANIFEST), true)\n-      $1_EXTRA_LDFLAGS += -manifest:embed\n-    endif\n-\n-    $1_IMPORT_LIBRARY := $$($1_OBJECT_DIR)\/$$($1_NAME).lib\n-    $1_EXTRA_LDFLAGS += \"-implib:$$($1_IMPORT_LIBRARY)\"\n-    ifeq ($$($1_TYPE), LIBRARY)\n-      # To properly trigger downstream dependants of the import library, just as\n-      # for debug files, we must have a recipe in the rule. To avoid rerunning\n-      # the recipe every time have it touch the target. If an import library\n-      # file is deleted by something external, explicitly delete the target to\n-      # trigger a rebuild of both.\n-      ifneq ($$(wildcard $$($1_IMPORT_LIBRARY)), $$($1_IMPORT_LIBRARY))\n-        $$(call LogDebug, Deleting $$($1_BASENAME) because import library is missing)\n-        $$(shell $(RM) $$($1_TARGET))\n-      endif\n-      $$($1_IMPORT_LIBRARY): $$($1_TARGET)\n-\t$(TOUCH) $$@\n-\n-      $1 += $$($1_IMPORT_LIBRARY)\n-    endif\n-  endif\n-\n-  $1_VARDEPS := $$($1_LD) $$($1_SYSROOT_LDFLAGS) $$($1_LDFLAGS) $$($1_EXTRA_LDFLAGS) \\\n-      $$($1_LIBS) $$($1_EXTRA_LIBS) $$($1_MT) \\\n-      $$($1_CREATE_DEBUGINFO_CMDS) $$($1_MANIFEST_VERSION) \\\n-      $$($1_STRIP_CMD) $$($1_CREATE_DEBUGLINK_CMDS)\n+  $1_VARDEPS := $$($1_LD) $$($1_SYSROOT_LDFLAGS) $$($1_LDFLAGS) \\\n+      $$($1_EXTRA_LDFLAGS) $$($1_LIBS) $$($1_EXTRA_LIBS) \\\n+      $$($1_CREATE_DEBUGINFO_CMDS) $$($1_STRIP_CMD) $$($1_CREATE_DEBUGLINK_CMDS)\n@@ -208,2 +183,1 @@\n-  $1_TARGET_DEPS := $$($1_ALL_OBJS) $$($1_RES) $$($1_MANIFEST) \\\n-      $$($1_REAL_MAPFILE) $$($1_VARDEPS_FILE)\n+  $1_TARGET_DEPS := $$($1_ALL_OBJS) $$($1_REAL_MAPFILE) $$($1_VARDEPS_FILE)\n@@ -219,2 +193,0 @@\n-        # Keep as much as possible on one execution line for best performance\n-        # on Windows\n@@ -223,28 +195,8 @@\n-        ifeq ($(call isTargetOs, windows), true)\n-\t  $$(call ExecuteWithLog, $$($1_OBJECT_DIR)\/$$($1_SAFE_NAME)_link, \\\n-\t      $$($1_LD) $$($1_LDFLAGS) $$($1_EXTRA_LDFLAGS) $$($1_SYSROOT_LDFLAGS) \\\n-\t          $(LD_OUT_OPTION)$$($1_TARGET) $$($1_LD_OBJ_ARG) $$($1_RES) \\\n-\t          $$($1_LIBS) $$($1_EXTRA_LIBS)) \\\n-\t      | $(GREP) -v \"^   Creating library .*\\.lib and object .*\\.exp\" || \\\n-\t          test \"$$$$?\" = \"1\" ; \\\n-\t  $$($1_CREATE_DEBUGINFO_CMDS)\n-\t  $$($1_STRIP_CMD)\n-\t  $$($1_CREATE_DEBUGLINK_CMDS)\n-          ifeq ($(call isBuildOsEnv, windows.wsl2), true)\n-\t    $$(CHMOD) +x $$($1_TARGET)\n-          endif\n-        else\n-\t  $$(call ExecuteWithLog, $$($1_OBJECT_DIR)\/$$($1_SAFE_NAME)_link, \\\n-\t      $$(if $$($1_LINK_OBJS_RELATIVE), $$(CD) $$(OUTPUTDIR) ; ) \\\n-\t      $$($1_LD) $$($1_LDFLAGS) $$($1_EXTRA_LDFLAGS) $$($1_SYSROOT_LDFLAGS) \\\n-\t          $(LD_OUT_OPTION)$$($1_TARGET) $$($1_LD_OBJ_ARG) $$($1_RES) \\\n-\t          $$($1_LIBS) $$($1_EXTRA_LIBS)) ; \\\n-\t  $$($1_CREATE_DEBUGINFO_CMDS)\n-\t  $$($1_STRIP_CMD)\n-\t  $$($1_CREATE_DEBUGLINK_CMDS)\n-        endif\n-        ifeq ($(call isTargetOs, windows), true)\n-          ifneq ($$($1_MANIFEST), )\n-\t    $$($1_MT) -nologo -manifest $$($1_MANIFEST) -identity:\"$$($1_NAME).exe, version=$$($1_MANIFEST_VERSION)\" -outputresource:$$@;#1\n-          endif\n-        endif\n+\t$$(call ExecuteWithLog, $$($1_OBJECT_DIR)\/$$($1_SAFE_NAME)_link, \\\n+\t    $$(if $$($1_LINK_OBJS_RELATIVE), $$(CD) $$(OUTPUTDIR) ; ) \\\n+\t    $$($1_LD) $$($1_LDFLAGS) $$($1_EXTRA_LDFLAGS) \\\n+\t        $$($1_SYSROOT_LDFLAGS) -o $$($1_TARGET) $$($1_LD_OBJ_ARG) \\\n+\t        $$($1_LIBS) $$($1_EXTRA_LIBS))\n+\t$$($1_CREATE_DEBUGINFO_CMDS)\n+\t$$($1_STRIP_CMD)\n+\t$$($1_CREATE_DEBUGLINK_CMDS)\n@@ -256,2 +208,3 @@\n-\t  $(CODESIGN) -f -s \"$(MACOSX_CODESIGN_IDENTITY)\" --timestamp --options runtime \\\n-\t      --entitlements $$(call GetEntitlementsFile, $$@) $$@\n+\t  $(CODESIGN) -f -s \"$(MACOSX_CODESIGN_IDENTITY)\" --timestamp \\\n+\t      --options runtime --entitlements \\\n+\t      $$(call GetEntitlementsFile, $$@) $$@\n@@ -260,1 +213,2 @@\n-\t  $(CODESIGN) -f -s - --entitlements $$(call GetEntitlementsFile, $$@) $$@\n+\t  $(CODESIGN) -f -s - --entitlements \\\n+\t      $$(call GetEntitlementsFile, $$@) $$@\n","filename":"make\/common\/native\/Link.gmk","additions":27,"deletions":73,"binary":false,"changes":100,"status":"modified"},{"patch":"@@ -0,0 +1,124 @@\n+#\n+# Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.  Oracle designates this\n+# particular file as subject to the \"Classpath\" exception as provided\n+# by Oracle in the LICENSE file that accompanied this code.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+################################################################################\n+# This file contains functionality related to linking a native binary;\n+# creating either a dynamic library, a static library or an executable.\n+\n+\n+################################################################################\n+define SetupLinkingMicrosoft\n+  ifneq ($(DISABLE_MAPFILES), true)\n+    $1_REAL_MAPFILE := $$($1_MAPFILE)\n+  endif\n+\n+  ifneq ($$($1_REAL_MAPFILE), )\n+    $1_EXTRA_LDFLAGS += $(call SET_SHARED_LIBRARY_MAPFILE,$$($1_REAL_MAPFILE))\n+  endif\n+endef\n+\n+################################################################################\n+define CreateLinkedResultMicrosoft\n+  ifeq ($$($1_TYPE), STATIC_LIBRARY)\n+    $$(eval $$(call CreateStaticLibraryMicrosoft,$1))\n+  else\n+    $$(eval $$(call CreateDynamicLibraryOrExecutableMicrosoft,$1))\n+  endif\n+endef\n+\n+################################################################################\n+define CreateStaticLibraryMicrosoft\n+  $1_VARDEPS := $$($1_LIB) $$(LIBFLAGS) $$($1_LIBFLAGS) $$($1_LIBS) \\\n+      $$($1_EXTRA_LIBS)\n+  $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, \\\n+      $$($1_OBJECT_DIR)\/$$($1_NOSUFFIX).vardeps)\n+\n+  $$($1_TARGET): $$($1_ALL_OBJS) $$($1_RES) $$($1_VARDEPS_FILE)\n+        ifneq ($$($1_OBJ_FILE_LIST), )\n+\t  $$(eval $$(call ListPathsSafely, $1_ALL_OBJS, $$($1_OBJ_FILE_LIST)))\n+        endif\n+\t$$(call LogInfo, Building static library $$($1_BASENAME))\n+\t$$(call MakeDir, $$($1_OUTPUT_DIR) $$($1_SYMBOLS_DIR))\n+\t$$(call ExecuteWithLog, $$($1_OBJECT_DIR)\/$$($1_SAFE_NAME)_link, \\\n+\t    $$($1_LIB) -nologo $$(LIBFLAGS) $$($1_LIBFLAGS) -out:$$($1_TARGET) \\\n+\t        $$($1_LD_OBJ_ARG) $$($1_RES))\n+endef\n+\n+################################################################################\n+define CreateDynamicLibraryOrExecutableMicrosoft\n+  ifeq ($$($1_EMBED_MANIFEST), true)\n+    $1_EXTRA_LDFLAGS += -manifest:embed\n+  endif\n+\n+  $1_IMPORT_LIBRARY := $$($1_OBJECT_DIR)\/$$($1_NAME).lib\n+  $1_EXTRA_LDFLAGS += \"-implib:$$($1_IMPORT_LIBRARY)\"\n+\n+  ifeq ($$($1_TYPE), LIBRARY)\n+    # To properly trigger downstream dependants of the import library, just as\n+    # for debug files, we must have a recipe in the rule. To avoid rerunning\n+    # the recipe every time have it touch the target. If an import library\n+    # file is deleted by something external, explicitly delete the target to\n+    # trigger a rebuild of both.\n+    ifneq ($$(wildcard $$($1_IMPORT_LIBRARY)), $$($1_IMPORT_LIBRARY))\n+      $$(call LogDebug, Deleting $$($1_BASENAME) because import library is missing)\n+      $$(shell $(RM) $$($1_TARGET))\n+    endif\n+    $$($1_IMPORT_LIBRARY): $$($1_TARGET)\n+\t$(TOUCH) $$@\n+\n+    $1 += $$($1_IMPORT_LIBRARY)\n+  endif\n+\n+  $1_VARDEPS := $$($1_LD) $$($1_SYSROOT_LDFLAGS) $$($1_LDFLAGS) \\\n+      $$($1_EXTRA_LDFLAGS) $$($1_LIBS) $$($1_EXTRA_LIBS) $$($1_MT) \\\n+      $$($1_MANIFEST_VERSION)\n+\n+  $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, \\\n+      $$($1_OBJECT_DIR)\/$$($1_NOSUFFIX).vardeps)\n+\n+  $1_TARGET_DEPS := $$($1_ALL_OBJS) $$($1_RES) $$($1_MANIFEST) \\\n+      $$($1_REAL_MAPFILE) $$($1_VARDEPS_FILE)\n+\n+  $$($1_TARGET): $$($1_TARGET_DEPS)\n+        ifneq ($$($1_OBJ_FILE_LIST), )\n+\t  $$(eval $$(call ListPathsSafely, $1_ALL_OBJS, $$($1_OBJ_FILE_LIST)))\n+        endif\n+\t$$(call LogInfo, Linking $$($1_BASENAME))\n+\t$$(call MakeDir, $$($1_OUTPUT_DIR) $$($1_SYMBOLS_DIR))\n+\t$$(call ExecuteWithLog, $$($1_OBJECT_DIR)\/$$($1_SAFE_NAME)_link, \\\n+\t    $$($1_LD) -nologo $$($1_LDFLAGS) $$($1_EXTRA_LDFLAGS) \\\n+\t        $$($1_SYSROOT_LDFLAGS) -out:$$($1_TARGET) $$($1_LD_OBJ_ARG) \\\n+\t        $$($1_RES) $$($1_LIBS) $$($1_EXTRA_LIBS)) \\\n+\t    | $(GREP) -v \"^   Creating library .*\\.lib and object .*\\.exp\" || \\\n+\t        test \"$$$$?\" = \"1\"\n+        ifeq ($(call isBuildOsEnv, windows.wsl2), true)\n+\t  $$(CHMOD) +x $$($1_TARGET)\n+        endif\n+        ifneq ($$($1_MANIFEST), )\n+\t  $$($1_MT) -nologo -manifest $$($1_MANIFEST) \\\n+\t      -identity:\"$$($1_NAME).exe, version=$$($1_MANIFEST_VERSION)\" \\\n+\t      -outputresource:$$@;#1\n+        endif\n+endef\n","filename":"make\/common\/native\/LinkMicrosoft.gmk","additions":124,"deletions":0,"binary":false,"changes":124,"status":"added"},{"patch":"@@ -42,0 +42,1 @@\n+#   LIB - lib, a Windows for creating static libraries\n@@ -59,0 +60,1 @@\n+    $$(call SetIfEmpty, $1_LIB, $$($$($1_EXTENDS)_LIB))\n@@ -75,0 +77,1 @@\n+    LIB := $(LIB), \\\n@@ -97,0 +100,1 @@\n+    LIB := $(BUILD_LIB), \\\n@@ -118,0 +122,1 @@\n+  $$(call SetIfEmpty, $1_LIB, $$($$($1_TOOLCHAIN)_LIB))\n","filename":"make\/common\/native\/ToolchainDefinitions.gmk","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,0 @@\n-    ADLC_LDFLAGS += -nologo\n","filename":"make\/hotspot\/gensrc\/GensrcAdlc.gmk","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}