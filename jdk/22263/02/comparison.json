{"files":[{"patch":"@@ -39,0 +39,1 @@\n+import java.lang.Override;\n@@ -42,1 +43,2 @@\n-\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -61,0 +63,2 @@\n+    private final int serverReadTimeout;\n+    private final CountDownLatch serverLatch;\n@@ -68,0 +72,4 @@\n+        float timeoutFactor = Float.parseFloat(\n+                System.getProperty(\"test.timeout.factor\", \"1.0\"));\n+        serverReadTimeout = (int) (30000 * timeoutFactor);\n+        serverLatch = new CountDownLatch(1);\n@@ -87,1 +95,1 @@\n-                socket.setSoTimeout(2000);\n+                socket.setSoTimeout(serverReadTimeout);\n@@ -99,0 +107,1 @@\n+                serverLatch.countDown();\n@@ -103,0 +112,1 @@\n+                serverException.printStackTrace();\n@@ -128,1 +138,0 @@\n-                    clientSocketChannel.socket().setSoTimeout(500);\n@@ -165,3 +174,4 @@\n-                    \/\/ Give server a chance to read before we shutdown via\n-                    \/\/ the try-with-resources block.\n-                    Thread.sleep(2000);\n+                    if (!serverLatch.await(serverReadTimeout,\n+                                           TimeUnit.MILLISECONDS)) {\n+                        log(\"Client: server thread not done yet, timing out\");\n+                    }\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLCipher\/SSLSocketNoServerHelloClientShutdown.java","additions":16,"deletions":6,"binary":false,"changes":22,"status":"modified"}]}