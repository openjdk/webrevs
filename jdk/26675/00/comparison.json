{"files":[{"patch":"@@ -243,1 +243,1 @@\n-            if (oldTree.clazz.hasTag(TYPEAPPLY)) {\n+            if (oldTree.clazz.hasTag(TYPEAPPLY) && !oldTree.type.isErroneous()) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Analyzer.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8349132\n+ * @bug 8349132 8364987\n@@ -142,0 +142,39 @@\n+    @Test \/\/JDK-8364987:\n+    public void testNoCrashErroneousTypes(Path base) throws Exception {\n+        Path current = base.resolve(\".\");\n+        Path src = current.resolve(\"src\");\n+        Path classes = current.resolve(\"classes\");\n+        tb.writeJavaFiles(src,\n+                          \"\"\"\n+                          public class Test {\n+                              void t() {\n+                                  L<Object> l = new L<Test>();\n+                              }\n+                              static class L<T> { }\n+                          }\n+                          \"\"\");\n+\n+        Files.createDirectories(classes);\n+\n+        var out = new JavacTask(tb)\n+            .options(\"-XDfind=diamond\",\n+                     \"-XDshould-stop.at=FLOW\",\n+                     \"-XDrawDiagnostics\")\n+            .outdir(classes)\n+            .files(tb.findJavaFiles(src))\n+            .run(Task.Expect.FAIL)\n+            .writeAll()\n+            .getOutputLines(Task.OutputKind.DIRECT);\n+\n+        var expectedOut = List.of(\n+            \"Test.java:3:23: compiler.err.prob.found.req: (compiler.misc.inconvertible.types: Test.L<Test>, Test.L<java.lang.Object>)\",\n+            \"1 error\"\n+        );\n+\n+        if (!Objects.equals(expectedOut, out)) {\n+            throw new AssertionError(\"Incorrect Output, expected: \" + expectedOut +\n+                                      \", actual: \" + out);\n+\n+        }\n+    }\n+\n","filename":"test\/langtools\/tools\/javac\/analyzer\/Diamond.java","additions":40,"deletions":1,"binary":false,"changes":41,"status":"modified"}]}