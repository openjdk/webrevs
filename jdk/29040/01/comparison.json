{"files":[{"patch":"@@ -0,0 +1,150 @@\n+\/*\n+ * Copyright (c) 2026, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.io.IOException;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+import jdk.test.lib.Platform;\n+\n+\/*\n+ * @test\n+ * @summary Check for unwanted file (types\/extensions) in the jdk image\n+ * @library \/test\/lib\n+ * @run main CheckFiles\n+ *\/\n+public class CheckFiles {\n+\n+    \/\/ Set this property on command line to scan an alternate dir or file:\n+    \/\/ JTREG=JAVA_OPTIONS=-Djdk.test.build.CheckFiles.dir=\/path\/to\/dir\n+    public static final String DIR_PROPERTY = \"jdk.test.build.CheckFiles.dir\";\n+\n+    public static void main(String[] args) throws Exception {\n+        String jdkPathString = System.getProperty(\"test.jdk\");\n+        Path jdkHome = Paths.get(jdkPathString);\n+\n+        Path mainDirToScan = jdkHome;\n+        String overrideDir = System.getProperty(DIR_PROPERTY);\n+        if (overrideDir != null) {\n+            mainDirToScan = Paths.get(overrideDir);\n+        }\n+\n+        System.out.println(\"Main directory to scan:\" + mainDirToScan);\n+        Path binDir = mainDirToScan.resolve(\"bin\");\n+        Path libDir = mainDirToScan.resolve(\"lib\");\n+\n+        System.out.println(\"Bin directory to scan:\" + binDir);\n+        ArrayList<String> allowedEndingsBinDir = new ArrayList<>();\n+        \/\/ UNIX - no extensions are allowed; Windows : .dll, .exe, .pdb, .jsa\n+        if (Platform.isWindows()) {\n+            allowedEndingsBinDir.add(\".dll\");\n+            allowedEndingsBinDir.add(\".exe\");\n+            allowedEndingsBinDir.add(\".pdb\");\n+            allowedEndingsBinDir.add(\".jsa\");\n+        }\n+        boolean binDirRes = scanFiles(binDir, allowedEndingsBinDir);\n+\n+        System.out.println(\"Lib directory to scan:\" + libDir);\n+        ArrayList<String> allowedEndingsLibDir = new ArrayList<>();\n+        allowedEndingsLibDir.add(\".jfc\");  \/\/ jfr config files\n+        allowedEndingsLibDir.add(\"cacerts\");\n+        allowedEndingsLibDir.add(\"blocked.certs\");\n+        allowedEndingsLibDir.add(\"public_suffix_list.dat\");\n+        allowedEndingsLibDir.add(\"classlist\");\n+        allowedEndingsLibDir.add(\"fontconfig.bfc\");\n+        allowedEndingsLibDir.add(\"fontconfig.properties.src\");\n+        allowedEndingsLibDir.add(\"ct.sym\");\n+        allowedEndingsLibDir.add(\"jrt-fs.jar\");\n+        allowedEndingsLibDir.add(\"jvm.cfg\");\n+        allowedEndingsLibDir.add(\"modules\");\n+        allowedEndingsLibDir.add(\"psfontj2d.properties\");\n+        allowedEndingsLibDir.add(\"psfont.properties.ja\");\n+        allowedEndingsLibDir.add(\"src.zip\");\n+        allowedEndingsLibDir.add(\"tzdb.dat\");\n+        if (Platform.isWindows()) {\n+            allowedEndingsLibDir.add(\".lib\");\n+            allowedEndingsLibDir.add(\"tzmappings\");\n+        } else {\n+            allowedEndingsLibDir.add(\"jexec\");\n+            allowedEndingsLibDir.add(\"jspawnhelper\");\n+            allowedEndingsLibDir.add(\".jsa\");\n+            if (Platform.isOSX()) {\n+                allowedEndingsLibDir.add(\"shaders.metallib\");\n+                allowedEndingsLibDir.add(\".dylib\");\n+            } else {\n+                allowedEndingsLibDir.add(\".so\");\n+            }\n+            if (Platform.isAix()) {\n+                allowedEndingsLibDir.add(\"tzmappings\");\n+            }\n+        }\n+        boolean libDirRes = scanFiles(libDir, allowedEndingsLibDir);\n+\n+        if (!binDirRes) {\n+            throw new Error(\"bin dir scan failed\");\n+        }\n+\n+        if (!libDirRes) {\n+            throw new Error(\"lib dir scan failed\");\n+        }\n+    }\n+\n+    private static boolean scanFiles(Path root, ArrayList<String> allowedEndings) throws IOException {\n+        AtomicBoolean badFileFound = new AtomicBoolean(false);\n+\n+        Files.walkFileTree(root, new SimpleFileVisitor<>() {\n+            @Override\n+            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n+                String fullFileName = file.toString();\n+                String fileName = file.getFileName().toString();\n+                System.out.println(\"  visiting file:\" + fullFileName);\n+                checkFile(fileName, allowedEndings);\n+                return super.visitFile(file, attrs);\n+            }\n+\n+            private void checkFile(String name, ArrayList<String> allowedEndings) {\n+                if (allowedEndings.isEmpty()) {  \/\/ no file extensions allowed\n+                    int lastDot = name.lastIndexOf('.');\n+                    if (lastDot > 0) {\n+                        System.out.println(\"  --> ERROR this file is not allowed:\" + name);\n+                        badFileFound.set(true);\n+                    }\n+                } else {\n+                    boolean allowed = allowedEndings.stream().anyMatch(name::endsWith);\n+                    if (! allowed) {\n+                        System.out.println(\"  --> ERROR this file is not allowed:\" + name);\n+                        badFileFound.set(true);\n+                    }\n+                }\n+            }\n+        });\n+\n+        return !badFileFound.get();\n+    }\n+}\n","filename":"test\/jdk\/build\/CheckFiles.java","additions":150,"deletions":0,"binary":false,"changes":150,"status":"added"}]}