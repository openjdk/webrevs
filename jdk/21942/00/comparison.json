{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,1 @@\n+import java.awt.EventQueue;\n@@ -32,0 +33,2 @@\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -35,1 +38,1 @@\n- * @bug 8069361\n+ * @bug 8069362\n@@ -38,2 +41,1 @@\n- * @author Alexander Scherbatiy\n- * @run main ScaledTransform\n+ * @run main\/timeout=300 ScaledTransform\n@@ -43,0 +45,1 @@\n+    private static volatile CountDownLatch painted = null;\n@@ -44,0 +47,3 @@\n+    private static volatile Dialog dialog;\n+    private static volatile long startTime = 0;\n+    private static volatile long endTime = 0;\n@@ -45,1 +51,1 @@\n-    public static void main(String[] args) {\n+    public static void main(String[] args) throws Exception {\n@@ -54,2 +60,6 @@\n-            for (GraphicsConfiguration gc : gd.getConfigurations()) {\n-                testScaleFactor(gc);\n+            System.out.println(\"Screen = \" + gd);\n+            test(gd.getDefaultConfiguration());\n+            \/* Don't want to run too long. Test the default and up to 10 more *\/\n+            GraphicsConfiguration[] configs = gd.getConfigurations();\n+            for (int c = 0; c < configs.length && c < 10; c++) {\n+                test(configs[c]);\n@@ -60,3 +70,1 @@\n-    private static void testScaleFactor(final GraphicsConfiguration gc) {\n-        final Dialog dialog = new Dialog((Frame) null, \"Test\", true, gc);\n-\n+    static void test(GraphicsConfiguration gc) throws Exception {\n@@ -64,20 +72,11 @@\n-            dialog.setSize(100, 100);\n-            Panel panel = new Panel() {\n-\n-                @Override\n-                public void paint(Graphics g) {\n-                    if (g instanceof Graphics2D) {\n-                        AffineTransform gcTx = gc.getDefaultTransform();\n-                        AffineTransform gTx\n-                                = ((Graphics2D) g).getTransform();\n-                        passed = gcTx.getScaleX() == gTx.getScaleX()\n-                                && gcTx.getScaleY() == gTx.getScaleY();\n-                    } else {\n-                        passed = true;\n-                    }\n-                    dialog.setVisible(false);\n-                }\n-            };\n-            dialog.add(panel);\n-            dialog.setVisible(true);\n-\n+            \/* reset vars for each run *\/\n+            passed = false;\n+            dialog = null;\n+            painted = new CountDownLatch(1);\n+            EventQueue.invokeLater(() -> showDialog(gc));\n+            startTime = System.currentTimeMillis();\n+            endTime = startTime;\n+            if (!painted.await(5, TimeUnit.SECONDS)) {\n+                throw new RuntimeException(\"Panel is not painted!\");\n+            }\n+            System.out.println(\"Time to paint = \" + (endTime - startTime) + \"ms.\");\n@@ -88,1 +87,1 @@\n-            dialog.dispose();\n+            EventQueue.invokeAndWait(() -> disposeDialog());\n@@ -91,0 +90,38 @@\n+\n+    private static void showDialog(final GraphicsConfiguration gc) {\n+\n+        System.out.println(\"Creating dialog for gc=\"+gc+\" with tx=\"+gc.getDefaultTransform());\n+\n+        dialog = new Dialog((Frame) null, \"Test\", true, gc);\n+\n+        dialog.setSize(100, 100);\n+        Panel panel = new Panel() {\n+\n+            @Override\n+            public void paint(Graphics g) {\n+                System.out.println(\"Painting panel\");\n+                if (g instanceof Graphics2D g2d) {\n+                    AffineTransform gcTx = gc.getDefaultTransform();\n+                    AffineTransform gTx = g2d.getTransform();\n+                    System.out.println(\"GTX = \" + gTx);\n+                    passed = (gcTx.getScaleX() == gTx.getScaleX()) &&\n+                             (gcTx.getScaleY() == gTx.getScaleY());\n+                } else {\n+                    passed = true;\n+                }\n+                painted.countDown();\n+                endTime = System.currentTimeMillis();\n+                System.out.println(\"Painted panel\");\n+            }\n+        };\n+        dialog.add(panel);\n+        dialog.setVisible(true);\n+    }\n+\n+    private static void disposeDialog() {\n+       if (dialog != null) {\n+            System.out.println(\"Disposing dialog\");\n+            dialog.setVisible(false);\n+            dialog.dispose();\n+       }\n+    }\n","filename":"test\/jdk\/java\/awt\/Graphics2D\/ScaledTransform\/ScaledTransform.java","additions":68,"deletions":31,"binary":false,"changes":99,"status":"modified"}]}