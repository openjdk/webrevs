{"files":[{"patch":"@@ -188,1 +188,2 @@\n-  ijava_state_unchecked()->locals = (uint64_t)locs;\n+  \/\/ set relativized locals\n+  *addr_at(_z_ijava_idx(locals)) = (intptr_t) (locs - fp());\n@@ -343,1 +344,1 @@\n-  address locals = (address)(ijava_state_unchecked()->locals);\n+  address locals = (address)interpreter_frame_locals();\n","filename":"src\/hotspot\/cpu\/s390\/frame_s390.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -333,0 +333,4 @@\n+\/\/ Frame slot index relative to fp\n+#define _z_ijava_idx(_component) \\\n+        (_z_ijava_state_neg(_component) >> LogBytesPerWord)\n+\n","filename":"src\/hotspot\/cpu\/s390\/frame_s390.hpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -183,1 +183,2 @@\n-  return (intptr_t*) (ijava_state()->locals);\n+  intptr_t n = *addr_at(_z_ijava_idx(locals));\n+  return &fp()[n]; \/\/ return relativized locals\n","filename":"src\/hotspot\/cpu\/s390\/frame_s390.inline.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -109,1 +109,9 @@\n-    z_cg(Z_locals, _z_ijava_state_neg(locals), Z_fp);\n+\n+    \/\/ _z_ijava_state_neg(locals)) is fp relativized, so we need to\n+    \/\/ extract the pointer.\n+\n+    z_lg(Z_R1_scratch, Address(Z_fp, _z_ijava_state_neg(locals)));\n+    z_sllg(Z_R1_scratch, Z_R1_scratch, Interpreter::logStackElementSize);\n+    z_agr(Z_R1_scratch, Z_fp);\n+\n+    z_cgr(Z_locals, Z_R1_scratch);\n@@ -689,0 +697,2 @@\n+  z_sllg(Z_locals, Z_locals, Interpreter::logStackElementSize);\n+  z_agr(Z_locals, Z_fp);\n","filename":"src\/hotspot\/cpu\/s390\/interp_masm_s390.cpp","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -1137,1 +1137,9 @@\n-  __ z_stg(Z_locals, _z_ijava_state_neg(locals), fp);\n+\n+  __ z_lgr(Z_R0, Z_R1); \/\/ preserve Z_R1, holding cache offset\n+\n+  __ z_sgrk(Z_R1, Z_locals, fp); \/\/ Z_R1 = Z_locals - fp();\n+  __ z_srlg(Z_R1, Z_R1, Interpreter::logStackElementSize);\n+  \/\/ Store relativized Z_locals, see frame::interpreter_frame_locals().\n+  __ z_stg(Z_R1, _z_ijava_state_neg(locals), fp);\n+\n+  __ z_lgr(Z_R1, Z_R0); \/\/ restore R1\n","filename":"src\/hotspot\/cpu\/s390\/templateInterpreterGenerator_s390.cpp","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"}]}