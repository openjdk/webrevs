{"files":[{"patch":"@@ -479,2 +479,1 @@\n-        -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_DEPRECATE \\\n-        -D_WINSOCK_DEPRECATED_NO_WARNINGS\"\n+        -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_DEPRECATE\"\n","filename":"make\/autoconf\/flags-cflags.m4","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -174,1 +174,1 @@\n-        wsock32.lib winmm.lib version.lib psapi.lib\"\n+        ws2_32.lib winmm.lib version.lib psapi.lib\"\n","filename":"make\/autoconf\/libraries.m4","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -827,4 +827,0 @@\n-struct hostent* os::get_host_by_name(char* name) {\n-  return ::gethostbyname(name);\n-}\n-\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -5536,4 +5536,0 @@\n-struct hostent* os::get_host_by_name(char* name) {\n-  return (struct hostent*)gethostbyname(name);\n-}\n-\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -881,1 +881,0 @@\n-  static struct hostent* get_host_by_name(char* name);\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1092,1 +1092,1 @@\n-#include <winsock2.h>\n+#include <Ws2tcpip.h>\n@@ -1133,1 +1133,2 @@\n-bool networkStream::connect(const char *ip, short port) {\n+\/\/ host could be IP address, or a host name\n+bool networkStream::connect(const char *host, short port) {\n@@ -1135,3 +1136,3 @@\n-  struct sockaddr_in server;\n-  server.sin_family = AF_INET;\n-  server.sin_port = htons(port);\n+  char s_port[6]; \/\/ 5 digits max plus terminator\n+  int ret = os::snprintf(s_port, sizeof(s_port), \"%hu\", (unsigned short) port);\n+  assert(ret > 0, \"snprintf failed: %d\", ret);\n@@ -1139,9 +1140,2 @@\n-  server.sin_addr.s_addr = inet_addr(ip);\n-  if (server.sin_addr.s_addr == (uint32_t)-1) {\n-    struct hostent* host = os::get_host_by_name((char*)ip);\n-    if (host != nullptr) {\n-      memcpy(&server.sin_addr, host->h_addr_list[0], host->h_length);\n-    } else {\n-      return false;\n-    }\n-  }\n+  struct addrinfo* addr_info = nullptr;\n+  struct addrinfo hints;\n@@ -1149,0 +1143,11 @@\n+  memset(&hints, 0, sizeof(hints));\n+  hints.ai_family = AF_UNSPEC; \/\/ Allow IPv4 or IPv6\n+  hints.ai_socktype = SOCK_STREAM; \/\/ TCP only\n+\n+  \/\/ getaddrinfo can resolve both an IP address and a host name\n+  ret = getaddrinfo(host, s_port, &hints, &addr_info);\n+  if (ret != 0) {\n+    warning(\"networkStream::connect getaddrinfo for host %s and port %s failed: %s\",\n+            host, s_port, gai_strerror(ret));\n+    return false;\n+  }\n@@ -1150,2 +1155,3 @@\n-  int result = os::connect(_socket, (struct sockaddr*)&server, sizeof(struct sockaddr_in));\n-  return (result >= 0);\n+  ret = os::connect(_socket, addr_info->ai_addr, (socklen_t)addr_info->ai_addrlen);\n+  freeaddrinfo(addr_info);\n+  return (ret >= 0);\n","filename":"src\/hotspot\/share\/utilities\/ostream.cpp","additions":22,"deletions":16,"binary":false,"changes":38,"status":"modified"}]}