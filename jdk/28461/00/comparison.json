{"files":[{"patch":"@@ -30,3 +30,4 @@\n-  assert(_features & CPU_SVE, \"should not call this\");\n-  ShouldNotReachHere();\n-  return 0;\n+  assert(VM_Version::supports_sve(), \"should not call this\");\n+  \/\/ TODO: This is not available in the Windows SDK yet , so conservatively go with the lowest value (128 bits)\n+  \/\/ https:\/\/developer.arm.com\/documentation\/101427\/0102\/Register-descriptions\/Scalable-vector-extensions--SVE--registers\/ZCR-EL1--SVE-Control-Register--EL1\n+  return VM_Version::supports_sve() ? 128 \/ 8 : 0; \/\/ This value is in bytes\n@@ -36,3 +37,4 @@\n-  assert(_features & CPU_SVE, \"should not call this\");\n-  ShouldNotReachHere();\n-  return 0;\n+  assert(VM_Version::supports_sve(), \"should not call this\");\n+  \/\/ TODO: This is not available in the Windows SDK yet , so conservatively go with the lowest value (128 bits)\n+  \/\/ https:\/\/developer.arm.com\/documentation\/101427\/0102\/Register-descriptions\/Scalable-vector-extensions--SVE--registers\/ZCR-EL1--SVE-Control-Register--EL1\n+  return VM_Version::supports_sve() ? 128 \/ 8 : 0; \/\/ This value is in bytes\n@@ -43,4 +45,10 @@\n-  if (IsProcessorFeaturePresent(PF_ARM_V8_CRC32_INSTRUCTIONS_AVAILABLE))   _features |= CPU_CRC32;\n-  if (IsProcessorFeaturePresent(PF_ARM_V8_CRYPTO_INSTRUCTIONS_AVAILABLE))  _features |= CPU_AES | CPU_SHA1 | CPU_SHA2;\n-  if (IsProcessorFeaturePresent(PF_ARM_VFP_32_REGISTERS_AVAILABLE))        _features |= CPU_ASIMD;\n-  \/\/ No check for CPU_PMULL, CPU_SVE, CPU_SVE2\n+  if (IsProcessorFeaturePresent(PF_ARM_V8_CRC32_INSTRUCTIONS_AVAILABLE))   _features |= BIT_MASK(CPU_CRC32);\n+  if (IsProcessorFeaturePresent(PF_ARM_V8_CRYPTO_INSTRUCTIONS_AVAILABLE))  _features |= BIT_MASK(CPU_AES) | BIT_MASK(CPU_SHA1) | BIT_MASK(CPU_SHA2) | BIT_MASK(CPU_PMULL);\n+  if (IsProcessorFeaturePresent(PF_ARM_VFP_32_REGISTERS_AVAILABLE))        _features |= BIT_MASK(CPU_ASIMD);\n+  if (IsProcessorFeaturePresent(PF_ARM_V81_ATOMIC_INSTRUCTIONS_AVAILABLE)) _features |= BIT_MASK(CPU_LSE);\n+  if (IsProcessorFeaturePresent(PF_ARM_SVE_INSTRUCTIONS_AVAILABLE))        _features |= BIT_MASK(CPU_SVE);\n+  if (IsProcessorFeaturePresent(PF_ARM_SVE2_INSTRUCTIONS_AVAILABLE))       _features |= BIT_MASK(CPU_SVE2);\n+  if (IsProcessorFeaturePresent(PF_ARM_SVE_BITPERM_INSTRUCTIONS_AVAILABLE))  _features |= BIT_MASK(CPU_SVEBITPERM);\n+  if (IsProcessorFeaturePresent(PF_ARM_SHA3_INSTRUCTIONS_AVAILABLE))        _features |= BIT_MASK(CPU_SHA3);\n+  if (IsProcessorFeaturePresent(PF_ARM_SHA512_INSTRUCTIONS_AVAILABLE))      _features |= BIT_MASK(CPU_SHA512);\n+\n@@ -97,2 +105,2 @@\n-      _variant = si.wProcessorRevision \/ 0xFF;\n-      _revision = si.wProcessorRevision & 0xFF;\n+      _variant = (si.wProcessorRevision >> 8) & 0xFF; \/\/ Variant is the upper byte of wProcessorRevision\n+      _revision = si.wProcessorRevision & 0xFF; \/\/ Revision is the lower byte of wProcessorRevision\n","filename":"src\/hotspot\/os_cpu\/windows_aarch64\/vm_version_windows_aarch64.cpp","additions":20,"deletions":12,"binary":false,"changes":32,"status":"modified"}]}