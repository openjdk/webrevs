{"files":[{"patch":"@@ -123,1 +123,1 @@\n-\/\/ by transitioning from _thread_in_native to _thread_in_vm.\n+\/\/ by doing the commit while the thread is _thread_in_vm.\n@@ -126,2 +126,9 @@\n-  ThreadInVMfromNative transition(JavaThread::current());\n-  event.commit();\n+  JavaThread* thread = JavaThread::current();\n+  JavaThreadState state = thread->thread_state();\n+  if (state == _thread_in_native) {\n+    ThreadInVMfromNative transition(thread);\n+    event.commit();\n+  } else {\n+    assert(state == _thread_in_vm, \"coming from wrong thread state %d\", state);\n+    event.commit();\n+  }\n","filename":"src\/hotspot\/share\/compiler\/compilerEvent.cpp","additions":10,"deletions":3,"binary":false,"changes":13,"status":"modified"}]}