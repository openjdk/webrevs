{"files":[{"patch":"@@ -2,0 +2,1 @@\n+gtest\/CheckShuffledGtest.java                           8356201 generic-all\n","filename":"test\/hotspot\/jtreg\/ProblemList-StaticJdk.txt","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -84,0 +84,6 @@\n+# Used to check if there are dependencies between different gtests\n+hotspot_validate_gtest = \\\n+  gtest\/AllNotVMGtest.java \\\n+  gtest\/CheckGtestDependencies.java \\\n+  gtest\/CheckShuffledGtest.java\n+\n@@ -138,0 +144,2 @@\n+  gtest\/AllNotVMGtest.java \\\n+  gtest\/CheckShuffledGtest.java \\\n","filename":"test\/hotspot\/jtreg\/TEST.groups","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -0,0 +1,89 @@\n+\/*\n+ * Copyright (c) 2025, 2026, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* @test\n+ * @summary Runs all not VM GTests together\n+ * @comment Used to identify not VM GTests which may have a VM dependency.\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.misc\n+ *          java.xml\n+ * @requires vm.flagless\n+ * @run main\/native AllNotVMGtest\n+ *\/\n+\n+import java.util.Arrays;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import jdk.test.lib.Platform;\n+\n+public class AllNotVMGtest {\n+    static record TestFilter(String name, boolean enabled) {}\n+\n+    static TestFilter TF(String name, boolean enabled) {\n+        return new TestFilter(name, enabled);\n+    }\n+\n+    static final TestFilter TF(String name) {\n+        return TF(name, true);\n+    }\n+\n+    \/\/ List of tests which have dependencies, these should have bugs associated\n+    \/\/ with them, and should be removed once they are resolved.\n+    static TestFilter[] TEST_FILTERS = {\n+        \/\/ JDK-8374450\n+        TF(\"opto.canonicalize_constraints\"),\n+        \/\/ JDK-8372245\n+        TF(\"globalDefinitions.format_specifiers\"),\n+        \/\/ JDK-8372246\n+        TF(\"LogOutputList.is_level_multiple_outputs\"),\n+        TF(\"LogOutputList.is_level_single_output\"),\n+        TF(\"LogOutputList.level_for\"),\n+        \/\/ JDK-8372249\n+        TF(\"os_linux.addr_to_function_valid\"),\n+        \/\/ JDK-8372247\n+        TF(\"Semaphore.trywait\", Platform.isOSX()),\n+        \/\/ JDK-8372244\n+        TF(\"ZArrayTest.slice\"),\n+        TF(\"ZNUMATest.calculate_share\"),\n+    };\n+\n+    public static Stream<String> getFilteredTests() {\n+        return Arrays.stream(TEST_FILTERS)\n+                     .filter(testFilter -> testFilter.enabled)\n+                     .map(testFilter -> testFilter.name);\n+    }\n+\n+    public static void main(String[] args) throws Throwable {\n+        \/\/ Create a negative filter which matches all VM gtests\n+        \/\/ and append all test with known issues.\n+        var filter = Stream.concat(Stream.of(\"--gtest_filter=-*_vm:*_vm_assert\"),\n+                                   getFilteredTests())\n+                           .collect(Collectors.joining(\":\"));\n+\n+        \/\/ Delegate running the gtest to the GTestWrapper using this filter.\n+        GTestWrapper.main(Stream.concat(Arrays.stream(args),\n+                                        Stream.of(filter))\n+                                .toArray(String[]::new));\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/gtest\/AllNotVMGtest.java","additions":89,"deletions":0,"binary":false,"changes":89,"status":"added"},{"patch":"@@ -0,0 +1,123 @@\n+\/*\n+ * Copyright (c) 2025, 2026, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* @test\n+ * @summary Runs each GTests in separate gtestlauncher invocations\n+ * @comment Used to identify GTests which have dependencies on other GTests.\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.misc\n+ *          java.xml\n+ * @requires vm.flagless\n+ * @run main\/native\/timeout=1800 CheckGtestDependencies\n+ *\/\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+public class CheckGtestDependencies extends GTestWrapper {\n+    static record TestFilter(String name, boolean enabled) {}\n+\n+    static TestFilter TF(String name, boolean enabled) {\n+        return new TestFilter(name, enabled);\n+    }\n+\n+    static TestFilter TF(String name) {\n+        return TF(name, true);\n+    }\n+\n+    \/\/ List of tests which have dependencies, these should have bugs associated\n+    \/\/ with them, and should be removed once they are resolved.\n+    static final TestFilter[] TEST_FILTERS = {\n+        \/\/ JDK-8372248\n+        TF(\"istream.coverage_vm\"),\n+        \/\/ JDK-8372243\n+        TF(\"ZForwardingTest.find_every_other_vm\"),\n+    };\n+\n+    public static Stream<String> getFilteredTests() {\n+        return Stream.concat(\/\/ Not VM gtests which have VM dependencies\n+                             AllNotVMGtest.getFilteredTests(),\n+                             \/\/ VM gtests which have dependencies on other gtests\n+                             Arrays.stream(TEST_FILTERS)\n+                                   .filter(testFilter -> testFilter.enabled)\n+                                   .map(testFilter -> testFilter.name));\n+    }\n+\n+    private static List<String> getAllGTests() throws Throwable {\n+        \/\/ Run the gtestlauncher with \"--gtest_list_tests\" to list all tests\n+        var oa = runGTestLauncher(\"--gtest_list_tests\");\n+        if (oa.getExitValue() != 0) {\n+            throw new AssertionError(\"gtest list tests failed; exit code = \" + oa.getExitValue());\n+        }\n+\n+        \/\/ The expected format is:\n+        \/\/\n+        \/\/ testSuite1.\n+        \/\/   testX\n+        \/\/   testY\n+        \/\/ testSuite2.\n+        \/\/   testX\n+        \/\/\n+        \/\/ Which we transform into:\n+        \/\/ List.of(\"testSuite1.testX\", \"testSuite1.testY\", \"testSuite2.testX\")\n+        var lines = oa.stdoutAsLines();\n+        var tests = new ArrayList<String>(lines.size());\n+        for (int i = 0; i < lines.size();) {\n+            \/\/ Get the test suite.\n+            var testSuite = lines.get(i++).trim();\n+            if (!testSuite.endsWith(\".\")) {\n+                throw new AssertionError(\"gtest list tests failed; invalid test suite: \" + testSuite);\n+            }\n+\n+            \/\/ Get each test in the test suite.\n+            while (i < lines.size()) {\n+                var test = lines.get(i).trim();\n+                if (test.endsWith(\".\")) {\n+                    \/\/ New test suite\n+                    break;\n+                }\n+                tests.add(testSuite + test);\n+                i++;\n+            }\n+        }\n+        return tests;\n+    }\n+\n+    public static void main(String[] args) throws Throwable {\n+        \/\/ Run each of our gtests in its own gtestlauncher invocation,\n+        \/\/ ignoring test with known issues\n+        var filteredTests = getFilteredTests().toList();\n+        for (var test : getAllGTests()) {\n+            if (filteredTests.contains(test)) {\n+                \/\/ Skip filtered tests\n+                continue;\n+            }\n+            \/\/ Run specific test\n+            GTestWrapper.main(Stream.concat(Arrays.stream(args),\n+                                            Stream.of(\"--gtest_filter=\" + test))\n+                                    .toArray(String[]::new));\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/gtest\/CheckGtestDependencies.java","additions":123,"deletions":0,"binary":false,"changes":123,"status":"added"},{"patch":"@@ -0,0 +1,98 @@\n+\/*\n+ * Copyright (c) 2025, 2026, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* @test\n+ * @summary Runs all GTest with a random shuffle\n+ * @comment Used to identify GTests which have an order dependencies.\n+ * @key randomness\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.misc\n+ *          java.xml\n+ * @requires vm.flagless\n+ * @run main\/native\/timeout=480 CheckShuffledGtest\n+ *\/\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Random;\n+import java.util.stream.Collector;\n+import java.util.stream.Stream;\n+import java.util.StringJoiner;\n+\n+import jdk.test.lib.Utils;\n+\n+public class CheckShuffledGtest {\n+    static record TestFilter(String name, boolean enabled) {}\n+\n+    static TestFilter TF(String name, boolean enabled) {\n+        return new TestFilter(name, enabled);\n+    }\n+\n+    static TestFilter TF(String name) {\n+        return TF(name, true);\n+    }\n+\n+    \/\/ List of tests which have dependencies, these should have bugs associated\n+    \/\/ with them, and should be removed once they are resolved.\n+    static final TestFilter[] TEST_FILTERS = {\n+        \/\/ JDK-8372242\n+        TF(\"LogTagSet.defaults_vm\"),\n+    };\n+\n+    public static Stream<String> getFilteredTests() {\n+        return Stream.concat(\/\/ All tests which have known issues when ran alone\n+                             \/\/ These will have issues if shuffled before their\n+                             \/\/ dependency.\n+                             CheckGtestDependencies.getFilteredTests(),\n+                             \/\/ gtests which have an order dependency\n+                             Arrays.stream(TEST_FILTERS)\n+                                   .filter(testFilter -> testFilter.enabled)\n+                                   .map(testFilter -> testFilter.name));\n+    }\n+\n+    static final Random RANDOM = Utils.getRandomInstance();\n+\n+    public static void main(String[] args) throws Throwable {\n+        \/\/ Create a negative filter of all test with known issues.\n+        var filterCollector = Collector.of(\n+            () -> new StringJoiner(\":\", \"--gtest_filter=-\", \"\").setEmptyValue(\"\"),\n+            StringJoiner::add,\n+            StringJoiner::merge,\n+            StringJoiner::toString);\n+        var filter = getFilteredTests().collect(filterCollector);\n+\n+        \/\/ Generate a random gtest seed\n+        var gtestSeedLimit = 100_000;\n+        var seed = RANDOM.nextInt(gtestSeedLimit);\n+\n+        \/\/ Delegate running the gtest to the GTestWrapper using this filter\n+        \/\/ and a random seed with gtest shuffling.\n+        GTestWrapper.main(Stream.concat(Arrays.stream(args),\n+                                        Stream.of(\n+                                            filter,\n+                                            \"--gtest_shuffle\",\n+                                            \"--gtest_random_seed=\" + seed))\n+                                .filter(arg -> !arg.isEmpty())\n+                                .toArray(String[]::new));\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/gtest\/CheckShuffledGtest.java","additions":98,"deletions":0,"binary":false,"changes":98,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,0 +35,1 @@\n+import jdk.test.lib.process.OutputAnalyzer;\n@@ -42,0 +43,1 @@\n+import java.util.Arrays;\n@@ -45,0 +47,1 @@\n+import java.util.stream.Stream;\n@@ -47,1 +50,1 @@\n-    public static void main(String[] args) throws Throwable {\n+    protected static OutputAnalyzer runGTestLauncher(String... args) throws Throwable {\n@@ -79,2 +82,0 @@\n-        Path resultFile = Paths.get(\"test_result.xml\");\n-\n@@ -86,1 +87,0 @@\n-        command.add(\"--gtest_output=xml:\" + resultFile);\n@@ -92,1 +92,7 @@\n-        int exitCode = ProcessTools.executeCommand(pb).getExitValue();\n+        return ProcessTools.executeCommand(pb);\n+    }\n+\n+    public static void main(String[] args) throws Throwable {\n+        var resultFile = Paths.get(\"test_result.xml\");\n+        var gtestArgs = Stream.concat(Stream.of(\"--gtest_output=xml:\" + resultFile), Arrays.stream(args)).toArray(String[]::new);\n+        int exitCode = runGTestLauncher(gtestArgs).getExitValue();\n","filename":"test\/hotspot\/jtreg\/gtest\/GTestWrapper.java","additions":12,"deletions":6,"binary":false,"changes":18,"status":"modified"}]}