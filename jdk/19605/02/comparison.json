{"files":[{"patch":"@@ -4,1 +4,1 @@\n-# Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,2 @@\n-copyright=\"Copyright (c)\"\n+copyright=\"Copyright\"\n+copyright_symbol=\"(c)\"\n@@ -32,0 +33,1 @@\n+year=`date +%Y`\n@@ -52,14 +54,20 @@\n-# Default or supplied company name\n-if [ \"$3\" != \"\" ] ; then\n-  company=\"$3\"\n-fi\n-\n-# This year or supplied year\n-if [ \"$2\" != \"\" ] ; then\n-  year=\"$2\"\n-else\n-  year=`date +%Y`\n-fi\n-\n-# VCS select\n-vcs=\"$1\"\n+usage=\"Usage: `basename \"$0\"` [-c company] [-y year] [-h|f]\"\n+Help()\n+{\n+  # Display Help\n+  echo \"Updates the Copyright year range in Git sources.\"\n+  echo\n+  echo \"By default, the tool limits the processed changesets \"\n+  echo \"to those in the current branch and the current year.\"\n+  echo\n+  echo \"Note, cancelling the script will skip cleanup in \/tmp.\"\n+  echo\n+  echo $usage\n+  echo \"options:\"\n+  echo \"-c     Specifies the company. Set to Oracle by default.\"\n+  echo \"-y     Specifies the copyright year. Set to current year by default.\"\n+  echo \"-f     Updates the copyright for all change sets in a given year,\"\n+  echo \"       as specified by -y.\"\n+  echo \"-h     Print this help.\"\n+  echo\n+}\n@@ -67,3 +75,1 @@\n-if [ -z \"$vcs\" ] ; then\n-  git_found=false\n-  hg_found=false\n+full_year=false\n@@ -71,2 +77,22 @@\n-  [ -d \"${this_script_dir}\/..\/..\/.git\" ] && git_found=true\n-  [ -d \"${this_script_dir}\/..\/..\/.hg\" ] && hg_found=true\n+# Process options\n+while getopts \"c:fhy:\" option; do\n+  case $option in\n+    c) # supplied company year\n+      company=${OPTARG}\n+      ;;\n+    f) # update all change sets in a full year\n+      full_year=true\n+      ;;\n+    h) # display help\n+      Help\n+      exit 0\n+      ;;\n+    y) # supplied company year\n+      year=${OPTARG}\n+      ;;\n+    \\?) # illegal option\n+      echo \"$usage\"\n+      exit 1\n+      ;;\n+  esac\n+done\n@@ -74,4 +100,11 @@\n-  if [ \"$git_found\" == \"true\" ] && [ \"$hg_found\" == \"false\" ] ; then\n-    vcs=\"git\"\n-  elif [ \"$hg_found\" == \"true\" ] && [ \"$git_found\" == \"false\" ] ; then\n-    vcs=\"hg\"\n+# VCS check\n+git_found=false\n+[ -d \"${this_script_dir}\/..\/..\/.git\" ] && git_found=true\n+if [ \"$git_found\" != \"true\" ]; then\n+  echo \"Error: Please execute script from within make\/scripts.\"\n+  exit 1\n+else\n+  echo \"Using Git version control system\"\n+  vcs_status=(git ls-files -m)\n+  if [ \"$full_year\" = \"true\" ]; then\n+    vcs_list_changesets=(git log --no-merges --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n@@ -79,2 +112,1 @@\n-    echo \"Error: could not auto-detect version control system\"\n-    vcs=\"\"\n+    vcs_list_changesets=(git log --no-merges 'master..HEAD' --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n@@ -82,0 +114,2 @@\n+  vcs_changeset_message=(git log -1 --pretty=tformat:\"%B\") # followed by ${changeset}\n+  vcs_changeset_files=(git diff-tree --no-commit-id --name-only -r) # followed by ${changeset}\n@@ -84,23 +118,0 @@\n-case \"$vcs\" in\n-  \"git\")\n-    echo \"Using Git version control system\"\n-    vcs_status=(git ls-files -m)\n-    vcs_list_changesets=(git log --no-merges --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n-    vcs_changeset_message=(git log -1 --pretty=tformat:\"%B\") # followed by ${changeset}\n-    vcs_changeset_files=(git diff-tree --no-commit-id --name-only -r) # followed by ${changeset}\n-    ;;\n-\n-  \"hg\")\n-    echo \"Using Mercurial version control system\"\n-    vcs_status=(hg status)\n-    vcs_list_changesets=(hg log --no-merges -v -d \"${year}-01-01 to ${year}-12-31\" --template '{node}\\n')\n-    vcs_changeset_message=(hg log -l1 --template '{desc}\\n' --rev) # followed by ${changeset}\n-    vcs_changeset_files=(hg log -l1 -v --template '{files}\\n' --rev) # followed by ${changeset}\n-    ;;\n-\n-  *)\n-    echo \"Usage: `basename \"$0\"` <git|hg> [year [company]]\"\n-    exit 1\n-    ;;\n-esac\n-\n@@ -111,1 +122,1 @@\n-    isText=`file \"$1\" | egrep -i '(text|source)' | cat`\n+    isText=`file \"$1\" | grep -i -E '(text|source)' | cat`\n@@ -134,3 +145,7 @@\n-      sed -e \"s@\\(${copyright} [12][0-9][0-9][0-9],\\) [12][0-9][0-9][0-9], ${company}@\\1 ${year}, ${company}@\" | \\\n-      sed -e \"s@\\(${copyright} [12][0-9][0-9][0-9],\\) ${company}@\\1 ${year}, ${company}@\" | \\\n-      sed -e \"s@${copyright} ${year}, ${year}, ${company}@${copyright} ${year}, ${company}@\"  \\\n+      sed -e \"s@\\(${copyright} \\(${copyright_symbol} \\)\\{0,1\\}[12][0-9][0-9][0-9],\\) [12][0-9][0-9][0-9], ${company}@\\1 ${year}, ${company}@\" | \\\n+      sed -e \"s@\\(${copyright} \\(${copyright_symbol} \\)\\{0,1\\}[12][0-9][0-9][0-9],\\) [12][0-9][0-9][0-9] ${company}@\\1 ${year} ${company}@\" | \\\n+      sed -e \"s@\\(${copyright} \\(${copyright_symbol} \\)\\{0,1\\}[12][0-9][0-9][0-9],\\) ${company}@\\1 ${year}, ${company}@\" | \\\n+      sed -e \"s@\\(${copyright} \\(${copyright_symbol} \\)\\{0,1\\}[12][0-9][0-9][0-9],\\) ${company}@\\1, ${year}, ${company}@\" | \\\n+      sed -e \"s@\\(${copyright} \\(${copyright_symbol} \\)\\{0,1\\}[12][0-9][0-9][0-9]\\) ${company}@\\1, ${year} ${company}@\" | \\\n+      sed -e \"s@${copyright} ${year}, ${year}, ${company}@${copyright} ${year}, ${company}@\" | \\\n+      sed -e \"s@${copyright} ${copyright_symbol} ${year}, ${year}, ${company}@${copyright} ${copyright_symbol} ${year}, ${company}@\"  \\\n@@ -208,1 +223,1 @@\n-      if cat ${desc} | fgrep -i \"Added tag\" > \/dev\/null ; then\n+      if cat ${desc} | grep -i -F \"Added tag\" > \/dev\/null ; then\n@@ -210,1 +225,1 @@\n-      elif cat ${desc} | fgrep -i rebrand > \/dev\/null ; then\n+      elif cat ${desc} | grep -i -F rebrand > \/dev\/null ; then\n@@ -212,1 +227,1 @@\n-      elif cat ${desc} | fgrep -i copyright > \/dev\/null ; then\n+      elif cat ${desc} | grep -i -F copyright > \/dev\/null ; then\n@@ -218,1 +233,1 @@\n-      if cat ${desc} | fgrep -i \"Added tag\" > \/dev\/null ; then\n+      if cat ${desc} | grep -i -F \"Added tag\" > \/dev\/null ; then\n@@ -220,1 +235,1 @@\n-      elif cat ${desc} | fgrep -i \"copyright year\" > \/dev\/null ; then\n+      elif cat ${desc} | grep -i -F \"copyright year\" > \/dev\/null ; then\n","filename":"make\/scripts\/update_copyright_year.sh","additions":74,"deletions":59,"binary":false,"changes":133,"status":"modified"}]}