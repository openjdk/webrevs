{"files":[{"patch":"@@ -445,1 +445,1 @@\n-    BitMapView bm = r->ptrmap_view();\n+    BitMapView bm = FileMapInfo::current_info()->ptrmap_view(MetaspaceShared::hp);\n","filename":"src\/hotspot\/share\/cds\/archiveHeapLoader.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -297,2 +297,0 @@\n-  st->print_cr(\"- rw_ptrmap_size_in_bits:         \" SIZE_FORMAT, region_at(MetaspaceShared::rw)->ptrmap_size_in_bits());\n-  st->print_cr(\"- ro_ptrmap_size_in_bits:         \" SIZE_FORMAT, region_at(MetaspaceShared::ro)->ptrmap_size_in_bits());\n@@ -1457,2 +1455,2 @@\n-BitMapView FileMapRegion::bitmap_view(bool is_oopmap) {\n-  char* bitmap_base = FileMapInfo::current_info()->map_bitmap_region();\n+BitMapView FileMapRegion::bitmap_view(bool is_oopmap, const char* name, bool is_static) {\n+  char* bitmap_base = is_static ? FileMapInfo::current_info()->map_bitmap_region() : FileMapInfo::dynamic_info()->map_bitmap_region();\n@@ -1461,0 +1459,3 @@\n+  log_debug(cds, reloc)(\"mapped %s relocation %smap @ \" INTPTR_FORMAT \" (\" SIZE_FORMAT \" bits)\",\n+                        name, is_oopmap ? \"oop\" : \"ptr\",\n+                        p2i(bitmap_base), size_in_bits);\n@@ -1464,9 +1465,0 @@\n-BitMapView FileMapRegion::oopmap_view() {\n-  return bitmap_view(true);\n-}\n-\n-BitMapView FileMapRegion::ptrmap_view() {\n-  assert(has_ptrmap(), \"must be\");\n-  return bitmap_view(false);\n-}\n-\n@@ -1501,0 +1493,8 @@\n+BitMapView FileMapInfo::oopmap_view(int region_index) {\n+    return region_at(region_index)->bitmap_view(\/*is_oopmap*\/true, region_name(region_index), is_static());\n+  }\n+\n+BitMapView FileMapInfo::ptrmap_view(int region_index) {\n+  return region_at(region_index)->bitmap_view(\/*is_oopmap*\/false, region_name(region_index), is_static());\n+}\n+\n@@ -1514,0 +1514,2 @@\n+  st->print_cr(\"- ptrmap_offset:                  \" SIZE_FORMAT_X, _ptrmap_offset);\n+  st->print_cr(\"- ptrmap_size_in_bits:            \" SIZE_FORMAT, _ptrmap_size_in_bits);\n@@ -1913,8 +1915,2 @@\n-    BitMapView rw_ptrmap = region_at(MetaspaceShared::rw)->ptrmap_view();\n-    char* ro_bitmap_base = bitmap_base + rw_ptrmap.size_in_bytes();\n-    BitMapView ro_ptrmap = region_at(MetaspaceShared::ro)->ptrmap_view();\n-\n-    log_debug(cds, reloc)(\"mapped relocation rw bitmap @ \" INTPTR_FORMAT \" (\" SIZE_FORMAT \" bits)\",\n-                          p2i(bitmap_base), rw_ptrmap.size());\n-    log_debug(cds, reloc)(\"mapped relocation ro bitmap @ \" INTPTR_FORMAT \" (\" SIZE_FORMAT \" bits)\",\n-                          p2i(ro_bitmap_base), ro_ptrmap.size());\n+    BitMapView rw_ptrmap = ptrmap_view(MetaspaceShared::rw);\n+    BitMapView ro_ptrmap = ptrmap_view(MetaspaceShared::ro);\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":17,"deletions":21,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -134,1 +134,0 @@\n-  BitMapView bitmap_view(bool is_oopmap);\n@@ -136,0 +135,2 @@\n+  BitMapView bitmap_view(bool is_oopmap, const char* name, bool is_static);\n+\n@@ -527,0 +528,3 @@\n+  BitMapView oopmap_view(int region_index);\n+  BitMapView ptrmap_view(int region_index);\n+\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"}]}