{"files":[{"patch":"@@ -86,1 +86,2 @@\n-  \/\/       then ro_bottom - rw_bottom = (116 - 100) \/ sizeof(address) = 4;\n+  \/\/       then for 64-bit platform:\n+  \/\/          ro_start = ro_bottom - rw_bottom = (116 - 100) \/ sizeof(address) = 2;\n","filename":"src\/hotspot\/share\/cds\/archiveUtils.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1455,10 +1455,0 @@\n-BitMapView FileMapRegion::bitmap_view(bool is_oopmap, const char* name, bool is_static) {\n-  char* bitmap_base = is_static ? FileMapInfo::current_info()->map_bitmap_region() : FileMapInfo::dynamic_info()->map_bitmap_region();\n-  bitmap_base += is_oopmap ? _oopmap_offset : _ptrmap_offset;\n-  size_t size_in_bits = is_oopmap ? _oopmap_size_in_bits : _ptrmap_size_in_bits;\n-  log_debug(cds, reloc)(\"mapped %s relocation %smap @ \" INTPTR_FORMAT \" (\" SIZE_FORMAT \" bits)\",\n-                        name, is_oopmap ? \"oop\" : \"ptr\",\n-                        p2i(bitmap_base), size_in_bits);\n-  return BitMapView((BitMap::bm_word_t*)(bitmap_base), size_in_bits);\n-}\n-\n@@ -1493,0 +1483,13 @@\n+BitMapView FileMapInfo::bitmap_view(int region_index, bool is_oopmap) {\n+  FileMapRegion* r = region_at(region_index);\n+  char* bitmap_base = is_static() ? FileMapInfo::current_info()->map_bitmap_region() : FileMapInfo::dynamic_info()->map_bitmap_region();\n+  bitmap_base += is_oopmap ? r->oopmap_offset() : r->ptrmap_offset();\n+  size_t size_in_bits = is_oopmap ? r->oopmap_size_in_bits() : r->ptrmap_size_in_bits();\n+\n+  log_debug(cds, reloc)(\"mapped %s relocation %smap @ \" INTPTR_FORMAT \" (\" SIZE_FORMAT \" bits)\",\n+                        region_name(region_index), is_oopmap ? \"oop\" : \"ptr\",\n+                        p2i(bitmap_base), size_in_bits);\n+\n+  return BitMapView((BitMap::bm_word_t*)(bitmap_base), size_in_bits);\n+}\n+\n@@ -1494,1 +1497,1 @@\n-    return region_at(region_index)->bitmap_view(\/*is_oopmap*\/true, region_name(region_index), is_static());\n+    return bitmap_view(region_index, \/*is_oopmap*\/true);\n@@ -1498,1 +1501,1 @@\n-  return region_at(region_index)->bitmap_view(\/*is_oopmap*\/false, region_name(region_index), is_static());\n+  return bitmap_view(region_index, \/*is_oopmap*\/false);\n@@ -1609,2 +1612,2 @@\n-  \/\/ rw_ptrmap:              metaspace pointers inside the read-write region\n-  \/\/ ro_ptrmap:              metaspace pointers inside the read-only region\n+  \/\/ rw_ptrmap:           metaspace pointers inside the read-write region\n+  \/\/ ro_ptrmap:           metaspace pointers inside the read-only region\n@@ -1921,2 +1924,2 @@\n-    \/\/ Patch all pointers in the mapped region that are marked by ptrmap.\n-    address rw_patch_base = (address)mapped_base();\n+    \/\/ Patch all pointers inside the RW region\n+    address rw_patch_base = (address)rw_region->mapped_base();\n@@ -1924,0 +1927,2 @@\n+\n+    \/\/ Patch all pointers inside the RO region\n@@ -1925,1 +1930,1 @@\n-    address ro_patch_end  = (address)mapped_end();\n+    address ro_patch_end  = (address)ro_region->mapped_end();\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":22,"deletions":17,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -135,2 +135,0 @@\n-  BitMapView bitmap_view(bool is_oopmap, const char* name, bool is_static);\n-\n@@ -162,0 +160,1 @@\n+  size_t ptrmap_offset()            const { return _ptrmap_offset; }\n@@ -172,2 +171,0 @@\n-  BitMapView oopmap_view();\n-  BitMapView ptrmap_view();\n@@ -528,0 +525,1 @@\n+  BitMapView bitmap_view(int region_index, bool is_oopmap);\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"}]}