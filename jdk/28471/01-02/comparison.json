{"files":[{"patch":"@@ -1483,0 +1483,1 @@\n+     * @param onlyChronoField  flag indicating whether this formatter only uses ChronoField instances\n@@ -1487,1 +1488,1 @@\n-            Chronology chrono, ZoneId zone) {\n+            Chronology chrono, ZoneId zone, boolean onlyChronoField) {\n@@ -1495,1 +1496,1 @@\n-        this.onlyChronoField = printerParser.onlyChronoField();\n+        this.onlyChronoField = onlyChronoField;\n@@ -1533,1 +1534,1 @@\n-        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone);\n+        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone, onlyChronoField);\n@@ -1579,1 +1580,1 @@\n-            return new DateTimeFormatter(printerParser, locale, ds, resolverStyle, resolverFields, c, z);\n+            return new DateTimeFormatter(printerParser, locale, ds, resolverStyle, resolverFields, c, z, onlyChronoField);\n@@ -1605,1 +1606,1 @@\n-        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone);\n+        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone, onlyChronoField);\n@@ -1659,1 +1660,1 @@\n-        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone);\n+        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone, onlyChronoField);\n@@ -1716,1 +1717,1 @@\n-        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone);\n+        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone, onlyChronoField);\n@@ -1758,1 +1759,1 @@\n-        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone);\n+        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone, onlyChronoField);\n@@ -1824,1 +1825,1 @@\n-        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, fields, chrono, zone);\n+        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, fields, chrono, zone, onlyChronoField);\n@@ -1873,1 +1874,1 @@\n-        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone);\n+        return new DateTimeFormatter(printerParser, locale, decimalStyle, resolverStyle, resolverFields, chrono, zone, onlyChronoField);\n","filename":"src\/java.base\/share\/classes\/java\/time\/format\/DateTimeFormatter.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -203,0 +203,6 @@\n+    \/**\n+     * Flag indicating whether this builder only uses ChronoField instances.\n+     * This is used to optimize the storage of parsed field values in the Parsed class.\n+     *\/\n+    private boolean onlyChronoField = true;\n+\n@@ -2374,0 +2380,13 @@\n+\n+        \/\/ Update the onlyChronoField flag if the printer\/parser uses non-ChronoField instances\n+        TemporalField field = null;\n+        if (pp instanceof NumberPrinterParser npp) {\n+            field = npp.field;\n+        } else if (pp instanceof TextPrinterParser tpp) {\n+            field = tpp.field;\n+        } else if (pp instanceof DefaultValueParser dvp) {\n+            field = dvp.field;\n+        }\n+        if (field != null && !(field instanceof ChronoField)) {\n+            active.onlyChronoField = false;\n+        }\n@@ -2446,1 +2465,1 @@\n-                resolverStyle, null, chrono, null);\n+                resolverStyle, null, chrono, null, onlyChronoField);\n@@ -2583,18 +2602,0 @@\n-        \/**\n-         * Checks whether this composite printer parser only uses ChronoField instances.\n-         * This is used to optimize the storage of parsed field values in the Parsed class.\n-         *\n-         * @return true if all printer parsers in this composite only use ChronoField instances,\n-         *         false otherwise\n-         *\/\n-        boolean onlyChronoField() {\n-            for (DateTimePrinterParser pp : printerParsers) {\n-                if ((pp instanceof NumberPrinterParser    npp && !(npp.field instanceof ChronoField))\n-                 || (pp instanceof TextPrinterParser      tpp && !(tpp.field instanceof ChronoField))\n-                 || (pp instanceof CompositePrinterParser cpp && !cpp.onlyChronoField())) {\n-                    return false;\n-                }\n-            }\n-            return true;\n-        }\n-\n","filename":"src\/java.base\/share\/classes\/java\/time\/format\/DateTimeFormatterBuilder.java","additions":20,"deletions":19,"binary":false,"changes":39,"status":"modified"}]}