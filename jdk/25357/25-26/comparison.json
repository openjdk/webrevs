{"files":[{"patch":"@@ -71,3 +71,3 @@\n-void ShenandoahAdaptiveHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                                         RegionData* data, size_t size,\n-                                                                         size_t actual_free) {\n+size_t ShenandoahAdaptiveHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                                           RegionData* data, size_t size,\n+                                                                           size_t actual_free) {\n@@ -127,0 +127,1 @@\n+  return 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahAdaptiveHeuristics.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -111,3 +111,3 @@\n-  virtual void choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                     RegionData* data, size_t size,\n-                                                     size_t actual_free) override;\n+  virtual size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                       RegionData* data, size_t size,\n+                                                       size_t actual_free) override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahAdaptiveHeuristics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -42,3 +42,3 @@\n-void ShenandoahAggressiveHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                                           RegionData* data, size_t size,\n-                                                                           size_t free) {\n+size_t ShenandoahAggressiveHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                                             RegionData* data, size_t size,\n+                                                                             size_t free) {\n@@ -51,0 +51,1 @@\n+  return 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahAggressiveHeuristics.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -38,3 +38,3 @@\n-  virtual void choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                     RegionData* data, size_t size,\n-                                                     size_t free);\n+  virtual size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                       RegionData* data, size_t size,\n+                                                       size_t free);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahAggressiveHeuristics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -79,3 +79,3 @@\n-void ShenandoahCompactHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                                        RegionData* data, size_t size,\n-                                                                        size_t actual_free) {\n+size_t ShenandoahCompactHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                                          RegionData* data, size_t size,\n+                                                                          size_t actual_free) {\n@@ -100,0 +100,1 @@\n+  return 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahCompactHeuristics.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -40,3 +40,3 @@\n-  virtual void choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                     RegionData* data, size_t size,\n-                                                     size_t actual_free);\n+  virtual size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                       RegionData* data, size_t size,\n+                                                       size_t actual_free);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahCompactHeuristics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-ssize_t ShenandoahGenerationalHeuristics::choose_collection_set(ShenandoahCollectionSet* collection_set) {\n+size_t ShenandoahGenerationalHeuristics::choose_collection_set(ShenandoahCollectionSet* collection_set) {\n@@ -173,1 +173,1 @@\n-  ssize_t add_regions_to_old = 0;\n+  size_t add_regions_to_old = 0;\n@@ -175,6 +175,0 @@\n-    \/\/ Only young collections need to prime the collection set.\n-    bool need_to_finalize_mixed = false;\n-    if (_generation->is_young()) {\n-      need_to_finalize_mixed = heap->old_generation()->heuristics()->prime_collection_set(collection_set);\n-    }\n-\n@@ -182,12 +176,1 @@\n-    choose_collection_set_from_regiondata(collection_set, candidates, cand_idx, immediate_garbage + free);\n-\n-    if (_generation->is_young()) {\n-      \/\/ Especially when young-gen trigger is expedited in order to finish mixed evacuations, there may not be\n-      \/\/ enough consolidated garbage to make effective use of young-gen evacuation reserve.  If there is still\n-      \/\/ young-gen reserve available following selection of the young-gen collection set, see if we can use\n-      \/\/ this memory to expand the old-gen evacuation collection set.\n-      need_to_finalize_mixed |= heap->old_generation()->heuristics()->top_off_collection_set(add_regions_to_old);\n-      if (need_to_finalize_mixed) {\n-        heap->old_generation()->heuristics()->finalize_mixed_evacs();\n-      }\n-    }\n+    add_regions_to_old = choose_collection_set_from_regiondata(collection_set, candidates, cand_idx, immediate_garbage + free);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahGenerationalHeuristics.cpp","additions":3,"deletions":20,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-  ssize_t choose_collection_set(ShenandoahCollectionSet* collection_set) override;\n+  size_t choose_collection_set(ShenandoahCollectionSet* collection_set) override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahGenerationalHeuristics.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -39,3 +39,3 @@\n-void ShenandoahGlobalHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                                       RegionData* data, size_t size,\n-                                                                       size_t actual_free) {\n+size_t ShenandoahGlobalHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                                         RegionData* data, size_t size,\n+                                                                         size_t actual_free) {\n@@ -46,0 +46,1 @@\n+  return 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahGlobalHeuristics.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -42,3 +42,3 @@\n-  void choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                             RegionData* data, size_t size,\n-                                             size_t actual_free) override;\n+  size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                               RegionData* data, size_t size,\n+                                               size_t actual_free) override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahGlobalHeuristics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -75,1 +75,1 @@\n-ssize_t ShenandoahHeuristics::choose_collection_set(ShenandoahCollectionSet* collection_set) {\n+size_t ShenandoahHeuristics::choose_collection_set(ShenandoahCollectionSet* collection_set) {\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahHeuristics.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -179,3 +179,6 @@\n-  virtual void choose_collection_set_from_regiondata(ShenandoahCollectionSet* set,\n-                                                     RegionData* data, size_t data_size,\n-                                                     size_t free) = 0;\n+  \/\/ This is a helper function to choose_collection_set(), returning the number of regions that need to be transferred to\n+  \/\/ the old reserve from the young reserve in order to effectively evacuate the chosen collection set.  In non-generational\n+  \/\/ mode, the return value is 0.\n+  virtual size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* set,\n+                                                       RegionData* data, size_t data_size,\n+                                                       size_t free) = 0;\n@@ -230,2 +233,2 @@\n-  \/\/ reserve in order to effectively evacuate the chosen collection set.\n-  virtual ssize_t choose_collection_set(ShenandoahCollectionSet* collection_set);\n+  \/\/ reserve in order to effectively evacuate the chosen collection set.  In non-generational mode, the return value is 0.\n+  virtual size_t choose_collection_set(ShenandoahCollectionSet* collection_set);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahHeuristics.hpp","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -342,1 +342,1 @@\n-bool ShenandoahOldHeuristics::top_off_collection_set(ssize_t &add_regions_to_old) {\n+bool ShenandoahOldHeuristics::top_off_collection_set(size_t &add_regions_to_old) {\n@@ -865,3 +865,3 @@\n-void ShenandoahOldHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* set,\n-                                                                    ShenandoahHeuristics::RegionData* data,\n-                                                                    size_t data_size, size_t free) {\n+size_t ShenandoahOldHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* set,\n+                                                                      ShenandoahHeuristics::RegionData* data,\n+                                                                      size_t data_size, size_t free) {\n@@ -869,0 +869,1 @@\n+  return 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -158,1 +158,2 @@\n-  void choose_collection_set_from_regiondata(ShenandoahCollectionSet* set, RegionData* data, size_t data_size, size_t free) override;\n+  size_t\n+  choose_collection_set_from_regiondata(ShenandoahCollectionSet* set, RegionData* data, size_t data_size, size_t free) override;\n@@ -182,1 +183,1 @@\n-  bool top_off_collection_set(ssize_t &add_regions_to_old);\n+  bool top_off_collection_set(size_t &add_regions_to_old);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -53,3 +53,3 @@\n-void ShenandoahPassiveHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                                        RegionData* data, size_t size,\n-                                                                        size_t actual_free) {\n+size_t ShenandoahPassiveHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                                          RegionData* data, size_t size,\n+                                                                          size_t actual_free) {\n@@ -79,0 +79,1 @@\n+  return 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahPassiveHeuristics.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -49,3 +49,3 @@\n-  virtual void choose_collection_set_from_regiondata(ShenandoahCollectionSet* set,\n-                                                     RegionData* data, size_t data_size,\n-                                                     size_t free);\n+  virtual size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* set,\n+                                                       RegionData* data, size_t data_size,\n+                                                       size_t free);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahPassiveHeuristics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -62,3 +62,3 @@\n-void ShenandoahStaticHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                                       RegionData* data, size_t size,\n-                                                                       size_t free) {\n+size_t ShenandoahStaticHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                                         RegionData* data, size_t size,\n+                                                                         size_t free) {\n@@ -73,0 +73,1 @@\n+  return 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahStaticHeuristics.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -43,3 +43,3 @@\n-  virtual void choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                                     RegionData* data, size_t size,\n-                                                     size_t free);\n+  virtual size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                                       RegionData* data, size_t size,\n+                                                       size_t free);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahStaticHeuristics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-void ShenandoahYoungHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+size_t ShenandoahYoungHeuristics::choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n@@ -51,0 +51,2 @@\n+  ShenandoahGenerationalHeap* heap = ShenandoahGenerationalHeap::heap();\n+  bool need_to_finalize_mixed = heap->old_generation()->heuristics()->prime_collection_set(cset);\n@@ -58,0 +60,11 @@\n+\n+  \/\/ Especially when young-gen trigger is expedited in order to finish mixed evacuations, there may not be\n+  \/\/ enough consolidated garbage to make effective use of young-gen evacuation reserve.  If there is still\n+  \/\/ young-gen reserve available following selection of the young-gen collection set, see if we can use\n+  \/\/ this memory to expand the old-gen evacuation collection set.\n+  size_t add_regions_to_old;\n+  need_to_finalize_mixed |= heap->old_generation()->heuristics()->top_off_collection_set(add_regions_to_old);\n+  if (need_to_finalize_mixed) {\n+    heap->old_generation()->heuristics()->finalize_mixed_evacs();\n+  }\n+  return add_regions_to_old;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahYoungHeuristics.cpp","additions":14,"deletions":1,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -41,3 +41,3 @@\n-  void choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n-                                             RegionData* data, size_t size,\n-                                             size_t actual_free) override;\n+  size_t choose_collection_set_from_regiondata(ShenandoahCollectionSet* cset,\n+                                               RegionData* data, size_t size,\n+                                               size_t actual_free) override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahYoungHeuristics.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -373,1 +373,1 @@\n-                                                     ShenandoahCollectionSet* const collection_set, ssize_t add_regions_to_old) {\n+                                                     ShenandoahCollectionSet* const collection_set, size_t add_regions_to_old) {\n@@ -810,1 +810,1 @@\n-      ssize_t add_regions_to_old = _heuristics->choose_collection_set(collection_set);\n+      size_t add_regions_to_old = _heuristics->choose_collection_set(collection_set);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGeneration.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -69,1 +69,1 @@\n-                                 ShenandoahCollectionSet* collection_set, ssize_t regions_to_xfer);\n+                                 ShenandoahCollectionSet* collection_set, size_t regions_to_xfer);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGeneration.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}