{"files":[{"patch":"@@ -165,0 +165,2 @@\n+  assert(heap->is_concurrent_weak_root_in_progress(), \"Must be doing weak roots now\");\n+\n@@ -279,4 +281,0 @@\n-  \/\/ After an abbreviated cycle, we reclaim immediate garbage.  Rebuild the freeset in order to establish\n-  \/\/ reserves for the next GC cycle.\n-  assert(_abbreviated, \"Only rebuild free set for abbreviated and old-marking cycles\");\n-  heap->rebuild_free_set(true \/*concurrent*\/);\n@@ -539,0 +537,6 @@\n+  if (!heap->is_evacuation_in_progress()) {\n+    \/\/ This is an abbreviated cycle.  Rebuild the freeset in order to establish reserves for the next GC cycle.  Doing\n+    \/\/ the rebuild ASAP also expedites availability of immediate trash, reducing the likelihood that we will degenerate\n+    \/\/ during promote-in-place processing.\n+    heap->rebuild_free_set(true \/*concurrent*\/);\n+  }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahConcurrentGC.cpp","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"}]}