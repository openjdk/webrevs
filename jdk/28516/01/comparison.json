{"files":[{"patch":"@@ -162,1 +162,0 @@\n-int (*os::Linux::_pthread_getcpuclockid)(pthread_t, clockid_t *) = nullptr;\n@@ -164,1 +163,0 @@\n-bool os::Linux::_supports_fast_thread_cpu_time = false;\n@@ -1478,23 +1476,0 @@\n-void os::Linux::fast_thread_clock_init() {\n-  clockid_t clockid;\n-  struct timespec tp;\n-  int (*pthread_getcpuclockid_func)(pthread_t, clockid_t *) =\n-      (int(*)(pthread_t, clockid_t *)) dlsym(RTLD_DEFAULT, \"pthread_getcpuclockid\");\n-\n-  \/\/ Switch to using fast clocks for thread cpu time if\n-  \/\/ the clock_getres() returns 0 error code.\n-  \/\/ Note, that some kernels may support the current thread\n-  \/\/ clock (CLOCK_THREAD_CPUTIME_ID) but not the clocks\n-  \/\/ returned by the pthread_getcpuclockid().\n-  \/\/ If the fast POSIX clocks are supported then the clock_getres()\n-  \/\/ must return at least tp.tv_sec == 0 which means a resolution\n-  \/\/ better than 1 sec. This is extra check for reliability.\n-\n-  if (pthread_getcpuclockid_func &&\n-      pthread_getcpuclockid_func(_main_thread, &clockid) == 0 &&\n-      clock_getres(clockid, &tp) == 0 && tp.tv_sec == 0) {\n-    _supports_fast_thread_cpu_time = true;\n-    _pthread_getcpuclockid = pthread_getcpuclockid_func;\n-  }\n-}\n-\n@@ -4239,1 +4214,1 @@\n-jlong os::Linux::fast_thread_cpu_time(clockid_t clockid) {\n+jlong os::Linux::total_thread_cpu_time(clockid_t clockid) {\n@@ -4467,2 +4442,0 @@\n-  Linux::fast_thread_clock_init();\n-\n@@ -4896,1 +4869,1 @@\n-static jlong slow_thread_cpu_time(Thread *thread, bool user_sys_cpu_time);\n+static jlong user_thread_cpu_time(Thread *thread);\n@@ -4898,1 +4871,1 @@\n-static jlong fast_cpu_time(Thread *thread) {\n+static jlong total_thread_cpu_time(Thread *thread) {\n@@ -4900,1 +4873,1 @@\n-    int rc = os::Linux::pthread_getcpuclockid(thread->osthread()->pthread_id(),\n+    int rc = pthread_getcpuclockid(thread->osthread()->pthread_id(),\n@@ -4903,1 +4876,1 @@\n-      return os::Linux::fast_thread_cpu_time(clockid);\n+      return os::Linux::total_thread_cpu_time(clockid);\n@@ -4920,6 +4893,1 @@\n-  if (os::Linux::supports_fast_thread_cpu_time()) {\n-    return os::Linux::fast_thread_cpu_time(CLOCK_THREAD_CPUTIME_ID);\n-  } else {\n-    \/\/ return user + sys since the cost is the same\n-    return slow_thread_cpu_time(Thread::current(), true \/* user + sys *\/);\n-  }\n+  return os::Linux::total_thread_cpu_time(CLOCK_THREAD_CPUTIME_ID);\n@@ -4929,6 +4897,1 @@\n-  \/\/ consistent with what current_thread_cpu_time() returns\n-  if (os::Linux::supports_fast_thread_cpu_time()) {\n-    return fast_cpu_time(thread);\n-  } else {\n-    return slow_thread_cpu_time(thread, true \/* user + sys *\/);\n-  }\n+  return total_thread_cpu_time(thread);\n@@ -4938,2 +4901,2 @@\n-  if (user_sys_cpu_time && os::Linux::supports_fast_thread_cpu_time()) {\n-    return os::Linux::fast_thread_cpu_time(CLOCK_THREAD_CPUTIME_ID);\n+  if (user_sys_cpu_time) {\n+    return os::Linux::total_thread_cpu_time(CLOCK_THREAD_CPUTIME_ID);\n@@ -4941,1 +4904,1 @@\n-    return slow_thread_cpu_time(Thread::current(), user_sys_cpu_time);\n+    return user_thread_cpu_time(Thread::current());\n@@ -4946,2 +4909,2 @@\n-  if (user_sys_cpu_time && os::Linux::supports_fast_thread_cpu_time()) {\n-    return fast_cpu_time(thread);\n+  if (user_sys_cpu_time) {\n+    return total_thread_cpu_time(thread);\n@@ -4949,1 +4912,1 @@\n-    return slow_thread_cpu_time(thread, user_sys_cpu_time);\n+    return user_thread_cpu_time(thread);\n@@ -4954,1 +4917,1 @@\n-static jlong slow_thread_cpu_time(Thread *thread, bool user_sys_cpu_time) {\n+static jlong user_thread_cpu_time(Thread *thread) {\n@@ -4991,5 +4954,1 @@\n-  if (user_sys_cpu_time) {\n-    return ((jlong)sys_time + (jlong)user_time) * (1000000000 \/ os::Posix::clock_tics_per_second());\n-  } else {\n-    return (jlong)user_time * (1000000000 \/ os::Posix::clock_tics_per_second());\n-  }\n+  return (jlong)user_time * (1000000000 \/ os::Posix::clock_tics_per_second());\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":15,"deletions":56,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -35,2 +35,0 @@\n-  static int (*_pthread_getcpuclockid)(pthread_t, clockid_t *);\n-\n@@ -43,2 +41,0 @@\n-  static bool _supports_fast_thread_cpu_time;\n-\n@@ -145,12 +141,1 @@\n-  \/\/ fast POSIX clocks support\n-  static void fast_thread_clock_init(void);\n-\n-  static int pthread_getcpuclockid(pthread_t tid, clockid_t *clock_id) {\n-    return _pthread_getcpuclockid ? _pthread_getcpuclockid(tid, clock_id) : -1;\n-  }\n-\n-  static bool supports_fast_thread_cpu_time() {\n-    return _supports_fast_thread_cpu_time;\n-  }\n-\n-  static jlong fast_thread_cpu_time(clockid_t clockid);\n+  static jlong total_thread_cpu_time(clockid_t clockid);\n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":1,"deletions":16,"binary":false,"changes":17,"status":"modified"}]}