{"files":[{"patch":"@@ -276,1 +276,4 @@\n-                } catch (IOException ignore) {}\n+                } catch (IOException e) {\n+                    throw new InternalError(\"Failed to check cyclic \" +\n+                            \"inclusion of '\" + path + \"'\", e);\n+                }\n@@ -282,2 +285,1 @@\n-            boolean isRegularFile = Files.isRegularFile(path);\n-            if (!isRegularFile && Files.isDirectory(path)) {\n+            if (Files.isDirectory(path)) {\n@@ -290,1 +292,1 @@\n-                currentPath = isRegularFile ? path : null;\n+                currentPath = Files.isRegularFile(path) ? path : null;\n","filename":"src\/java.base\/share\/classes\/java\/security\/Security.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -47,0 +47,9 @@\n+    private static AutoCloseable restrictedAcl(Path path) throws IOException {\n+        AclFileAttributeView view =\n+                Files.getFileAttributeView(path, AclFileAttributeView.class);\n+        List<AclEntry> originalAcl = List.copyOf(view.getAcl());\n+        view.setAcl(List.of(AclEntry.newBuilder().setType(AclEntryType.DENY)\n+                .setPrincipal(Files.getOwner(path)).build()));\n+        return () -> view.setAcl(originalAcl);\n+    }\n+\n@@ -49,1 +58,1 @@\n-        try {\n+        try (AutoCloseable a1 = () -> FileUtils.deleteFileTreeUnchecked(temp)) {\n@@ -57,8 +66,1 @@\n-            Path parent = jdk.getParent();\n-            AclFileAttributeView view = Files.getFileAttributeView(parent,\n-                    AclFileAttributeView.class);\n-            List<AclEntry> originalAcl = List.copyOf(view.getAcl());\n-            view.setAcl(List.of(AclEntry.newBuilder().setType(AclEntryType.DENY)\n-                    .setPrincipal(Files.getOwner(parent)).build()));\n-\n-            try {\n+            try (AutoCloseable a2 = restrictedAcl(jdk.getParent())) {\n@@ -78,2 +80,0 @@\n-            } finally {\n-                view.setAcl(originalAcl);\n@@ -81,2 +81,0 @@\n-        } finally {\n-            FileUtils.deleteFileTreeUnchecked(temp);\n@@ -84,1 +82,0 @@\n-\n","filename":"test\/jdk\/java\/security\/Security\/ConfigFileTestDirPermissions.java","additions":11,"deletions":14,"binary":false,"changes":25,"status":"modified"}]}