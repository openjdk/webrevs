{"files":[{"patch":"@@ -756,0 +756,11 @@\n+$(eval $(call SetupTarget, build-test-setup-aot, \\\n+    MAKEFILE := test\/BuildJtregSetupAOT, \\\n+    DEPS := interim-langtools exploded-image build-test-lib, \\\n+))\n+\n+$(eval $(call SetupTarget, test-image-setup-aot, \\\n+    MAKEFILE := test\/BuildJtregSetupAOT, \\\n+    TARGET := images, \\\n+    DEPS :=  build-test-setup-aot, \\\n+))\n+\n@@ -1284,1 +1295,2 @@\n-    test-image-lib test-image-lib-native\n+    test-image-lib test-image-lib-native \\\n+    test-image-setup-aot\n","filename":"make\/Main.gmk","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -718,1 +718,0 @@\n-  $1_AOT_JDK_DIR   := $$($1_TEST_SUPPORT_DIR)\/aot\n@@ -721,5 +720,8 @@\n-\n-  # We first execute the training run with make\/test\/SetupAot.java to touch\n-  # a fair number of classes inside the JDK. Note that we don't specify a classpath,\n-  # but the Java launcher will use an implicit class path of \".\", so it can pick up the\n-  # SetupAot class from the current directory.\n+  $1_AOT_JDK_LOG   := $$($1_TEST_SUPPORT_DIR)\/aot\/ExerciseJDKClasses.log\n+\n+  # We execute the training run with $(TEST_IMAGE_DIR)\/jtreg_setup_aot\/ExerciseJDKClasses.class\n+  # to touch a fair number of classes inside the JDK. Note that we can't specify a classpath,\n+  # or else the AOT cache cannot be used with jtreg test cases that use a different value\n+  # for their classpaths. Instead, we run in the $(TEST_IMAGE_DIR)\/jtreg_setup_aot\/ directory.\n+  # The \"java\" launcher will have an implicit classpath of \".\", so it can pick up the ExerciseJDKClasses\n+  # class from the JVM's current directory.\n@@ -727,3 +729,3 @@\n-  # The SetupAot class (or any other classes that are loaded from \".\"\n-  # will be excluded from the the AOT cache as \".\" is an unsupported\n-  # location. As a result, the AOT cache will contain only classes from the JDK.\n+  # The ExerciseJDKClasses class (or any other classes that are loaded from \".\") will be excluded\n+  # from the the AOT cache as \".\" is an unsupported location. As a result, the AOT cache will contain\n+  # only classes from the JDK.\n@@ -734,1 +736,1 @@\n-\t$(info AOT: Create cache configuration) \\\n+\t$$(call LogWarn, AOT: Create cache configuration) \\\n@@ -736,2 +738,1 @@\n-\t    $(CD) $$($1_AOT_JDK_DIR); \\\n-\t    $(JDK_UNDER_TEST)\/bin\/javac -d . $(TOPDIR)\/make\/test\/SetupAot.java; \\\n+\t    $(CD) $(TEST_IMAGE_DIR)\/jtreg_setup_aot; \\\n@@ -739,3 +740,3 @@\n-\t                -Xlog:cds,cds+class=debug:file=$$($1_AOT_JDK_CONF).log \\\n-\t                -XX:AOTMode=record -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) \\\n-\t                SetupAot \\\n+\t        -Xlog:cds,cds+class=debug:file=$$($1_AOT_JDK_CONF).log  -Xlog:cds*=error \\\n+\t        -XX:AOTMode=record -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) \\\n+\t        ExerciseJDKClasses > $$($1_AOT_JDK_LOG) \\\n@@ -744,1 +745,1 @@\n-\t$$(info AOT: Generate AOT cache $$($1_AOT_JDK_CACHE) with flags: $$($1_VM_OPTIONS))\n+\t$$(call LogWarn, AOT: Generate AOT cache $$($1_AOT_JDK_CACHE) with flags: $$($1_VM_OPTIONS))\n@@ -746,1 +747,1 @@\n-\t\t$$(FIXPATH) $(JDK_UNDER_TEST)\/bin\/java \\\n+\t    $$(FIXPATH) $(JDK_UNDER_TEST)\/bin\/java \\\n@@ -749,1 +750,1 @@\n-\t\t-XX:AOTMode=create -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) -XX:AOTCache=$$($1_AOT_JDK_CACHE) \\\n+\t        -XX:AOTMode=create -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) -XX:AOTCache=$$($1_AOT_JDK_CACHE) \\\n@@ -948,1 +949,1 @@\n-    $$(info Add AOT target for $1)\n+    $$(call LogWarn, Add AOT target for $1)\n@@ -951,2 +952,2 @@\n-    $$(info AOT_TARGETS=$$($1_AOT_TARGETS))\n-    $$(info AOT_JDK_CACHE=$$($1_AOT_JDK_CACHE))\n+    $$(call LogWarn, AOT_TARGETS=$$($1_AOT_TARGETS))\n+    $$(call LogWarn, AOT_JDK_CACHE=$$($1_AOT_JDK_CACHE))\n","filename":"make\/RunTests.gmk","additions":22,"deletions":21,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -0,0 +1,68 @@\n+#\n+# Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.  Oracle designates this\n+# particular file as subject to the \"Classpath\" exception as provided\n+# by Oracle in the LICENSE file that accompanied this code.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+default: build\n+\n+include $(SPEC)\n+include MakeBase.gmk\n+\n+include CopyFiles.gmk\n+include JavaCompilation.gmk\n+\n+TARGETS :=\n+\n+################################################################################\n+\n+SETUP_AOT_BASEDIR := $(TOPDIR)\/test\/jtreg_setup_aot\n+SETUP_AOT_SUPPORT := $(SUPPORT_OUTPUTDIR)\/test\/jtreg_setup_aot\n+SETUP_AOT_JAR     := $(SETUP_AOT_SUPPORT)\/jtregSetupAOT.jar\n+SETUP_AOT_CLASS   := $(SETUP_AOT_SUPPORT)\/classes\/ExerciseJDKClasses.class\n+\n+$(eval $(call SetupJavaCompilation, BUILD_JTREG_SETUP_AOT, \\\n+    TARGET_RELEASE := $(TARGET_RELEASE_NEWJDK_UPGRADED), \\\n+    SRC := $(SETUP_AOT_BASEDIR), \\\n+    BIN := $(SETUP_AOT_SUPPORT)\/classes, \\\n+    JAR := $(SETUP_AOT_JAR), \\\n+))\n+\n+TARGETS += $(BUILD_JTREG_SETUP_AOT)\n+\n+################################################################################\n+# Targets for building test-image.\n+################################################################################\n+\n+# Copy to hotspot jtreg test image\n+$(eval $(call SetupCopyFiles, COPY_SETUP_AOT, \\\n+    SRC := $(SETUP_AOT_SUPPORT)\/classes, \\\n+    DEST := $(TEST_IMAGE_DIR)\/jtreg_setup_aot, \\\n+    FILES := ExerciseJDKClasses.class, \\\n+))\n+\n+IMAGES_TARGETS += $(COPY_SETUP_AOT)\n+\n+build: $(TARGETS)\n+images: $(IMAGES_TARGETS)\n+\n+.PHONY: all images\n","filename":"make\/test\/BuildJtregSetupAOT.gmk","additions":68,"deletions":0,"binary":false,"changes":68,"status":"added"},{"patch":"@@ -1,60 +0,0 @@\n-\/*\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-import java.util.spi.ToolProvider;\n-\n-\/\/ This program is executed by ..\/RunTests.gmk to support running HotSpot jtreg tests\n-\/\/ in the \"AOT mode\", for example:\n-\/\/\n-\/\/     make test JTREG_AOT_JDK=true open\/test\/hotspot\/jtreg\/runtime\/stringtable\n-\/\/\n-\/\/ All JDK classes touched by this program will be stored into a customized AOT cache.\n-\/\/ This is a larger set of classes than those stored in the JDK's default CDS archive.\n-\/\/ This customized cache can also have additional optimizations that are not\n-\/\/ enabled in the default CDS archive. For example, AOT-linked classes and lambda\n-\/\/ expressions. In the future, it can also contain AOT profiles and AOT compiled methods.\n-\/\/\n-\/\/ We can use this customized AOT cache to run various HotSpot tests to improve\n-\/\/ coverage on AOT.\n-\/\/\n-\/\/ Note that ..\/RunTests.gmk loads this class using an implicit classpath of \".\", so\n-\/\/ this class will be excluded from the customized AOT cache. Hence it will cause\n-\/\/ any class name conflicts with the HotSpot tests. The scripts in ..\/RunTests.gmk\n-\/\/ ensure that the customized AOT cache contains *only* classes from the JDK itself.\n-\n-public class SetupAot {\n-    public static void main(String[] args) throws Throwable {\n-        String[] tools = {\n-            \"javac\", \"javap\", \"jlink\", \"jar\",\n-        };\n-        \/\/ TODO: we should do more substantial work than just running with \"--help\".\n-        \/\/ E.g., use javac to compile a program.\n-        for (String tool : tools) {\n-            ToolProvider t  = ToolProvider.findFirst(tool)\n-                .orElseThrow(() -> new RuntimeException(tool + \" not found\"));\n-            t.run(System.out, System.out, \"--help\");\n-        }\n-    }\n-}\n","filename":"make\/test\/SetupAot.java","additions":0,"deletions":60,"binary":false,"changes":60,"status":"deleted"},{"patch":"@@ -0,0 +1,59 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.util.spi.ToolProvider;\n+\n+\/\/ This program is executed by make\/RunTests.gmk to support running HotSpot jtreg tests\n+\/\/ in the \"AOT mode\", for example:\n+\/\/\n+\/\/     make test JTREG_AOT_JDK=true open\/test\/hotspot\/jtreg\/runtime\/stringtable\n+\/\/\n+\/\/ All JDK classes touched by this program will be stored into a customized AOT cache.\n+\/\/ This is a larger set of classes than those stored in the JDK's default CDS archive.\n+\/\/ This customized cache can also have additional optimizations that are not\n+\/\/ enabled in the default CDS archive. For example, AOT-linked classes and lambda\n+\/\/ expressions. In the future, it can also contain AOT profiles and AOT compiled methods.\n+\/\/\n+\/\/ We can use this customized AOT cache to run various HotSpot tests to improve\n+\/\/ coverage on AOT.\n+\/\/\n+\/\/ Note that make\/RunTests.gmk loads this class using an implicit classpath of \".\", so\n+\/\/ this class will be excluded from the customized AOT cache. As a result,\n+\/\/ the customized AOT cache contains *only* classes from the JDK itself.\n+\n+public class ExerciseJDKClasses {\n+    public static void main(String[] args) throws Throwable {\n+        String[] tools = {\n+            \"javac\", \"javap\", \"jlink\", \"jar\",\n+        };\n+        \/\/ TODO: we should do more substantial work than just running with \"--help\".\n+        \/\/ E.g., use javac to compile a program.\n+        for (String tool : tools) {\n+            ToolProvider t  = ToolProvider.findFirst(tool)\n+                .orElseThrow(() -> new RuntimeException(tool + \" not found\"));\n+            t.run(System.out, System.out, \"--help\");\n+        }\n+    }\n+}\n","filename":"test\/jtreg_setup_aot\/ExerciseJDKClasses.java","additions":59,"deletions":0,"binary":false,"changes":59,"status":"added"}]}