{"files":[{"patch":"@@ -706,1 +706,53 @@\n-include $(TOPDIR)\/make\/test\/SetupAOT.gmk\n+################################################################################\n+# Helper function for creating a customized AOT cache for running tests\n+################################################################################\n+\n+# Parameter 1 is the name of the rule.\n+#\n+# Remaining parameters are named arguments.\n+#   VM_OPTIONS  List of JVM arguments to use when creating AOT cache\n+#\n+#  After calling this, the following variables are defined\n+#   $1_AOT_TARGETS   List of all targets that the test rule will need to depend on\n+#   $1_AOT_JDK_CACHE The AOT cache file to be used to run the test with\n+#\n+SetupAot = $(NamedParamsMacroTemplate)\n+define SetupAotBody\n+  $1_AOT_JDK_CONF  := $$($1_TEST_SUPPORT_DIR)\/aot\/jdk.aotconf\n+  $1_AOT_JDK_CACHE := $$($1_TEST_SUPPORT_DIR)\/aot\/jdk.aotcache\n+  $1_AOT_JDK_LOG   := $$($1_TEST_SUPPORT_DIR)\/aot\/ExerciseJDKClasses.log\n+\n+  # We execute the training run with $(TEST_IMAGE_DIR)\/jtreg_setup_aot\/ExerciseJDKClasses.class\n+  # to touch a fair number of classes inside the JDK. Note that we can't specify a classpath,\n+  # or else the AOT cache cannot be used with jtreg test cases that use a different value\n+  # for their classpaths. Instead, we run in the $(TEST_IMAGE_DIR)\/jtreg_setup_aot\/ directory.\n+  # The \"java\" launcher will have an implicit classpath of \".\", so it can pick up the ExerciseJDKClasses\n+  # class from the JVM's current directory.\n+  #\n+  # The ExerciseJDKClasses class (or any other classes that are loaded from \".\") will be excluded\n+  # from the the AOT cache as \".\" is an unsupported location. As a result, the AOT cache will contain\n+  # only classes from the JDK.\n+\n+  $$($1_AOT_JDK_CACHE): $$(JDK_IMAGE_DIR)\/release\n+\t$$(call MakeDir, $$($1_TEST_SUPPORT_DIR)\/aot)\n+\n+\t$$(call LogWarn, AOT: Create cache configuration) \\\n+\t$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)\/aot, ( \\\n+\t    $(CD) $(TEST_IMAGE_DIR)\/jtreg_setup_aot; \\\n+\t    $$(FIXPATH) $(JDK_UNDER_TEST)\/bin\/java $$($1_VM_OPTIONS) \\\n+\t        -Xlog:cds,cds+class=debug:file=$$($1_AOT_JDK_CONF).log  -Xlog:cds*=error \\\n+\t        -XX:AOTMode=record -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) \\\n+\t        ExerciseJDKClasses > $$($1_AOT_JDK_LOG) \\\n+\t))\n+\n+\t$$(call LogWarn, AOT: Generate AOT cache $$($1_AOT_JDK_CACHE) with flags: $$($1_VM_OPTIONS))\n+\t$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)\/aot, ( \\\n+\t    $$(FIXPATH) $(JDK_UNDER_TEST)\/bin\/java \\\n+\t        $$($1_VM_OPTIONS) -Xlog:cds,cds+class=debug:file=$$($1_AOT_JDK_CACHE).log -Xlog:cds*=error \\\n+\t        -XX:ExtraSharedClassListFile=$(JDK_UNDER_TEST)\/lib\/classlist \\\n+\t        -XX:AOTMode=create -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) -XX:AOTCache=$$($1_AOT_JDK_CACHE) \\\n+\t))\n+\n+  $1_AOT_TARGETS += $$($1_AOT_JDK_CACHE)\n+\n+endef\n","filename":"make\/RunTests.gmk","additions":53,"deletions":1,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -1,84 +0,0 @@\n-#\n-# Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.  Oracle designates this\n-# particular file as subject to the \"Classpath\" exception as provided\n-# by Oracle in the LICENSE file that accompanied this code.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-include MakeIncludeStart.gmk\n-ifeq ($(INCLUDE), true)\n-\n-################################################################################\n-# Helper function for creating a customized AOT cache for running tests\n-################################################################################\n-\n-# Parameter 1 is the name of the rule.\n-#\n-# Remaining parameters are named arguments.\n-#   VM_OPTIONS  List of JVM arguments to use when creating AOT cache\n-#\n-#  After calling this, the following variables are defined\n-#   $1_AOT_TARGETS   List of all targets that the test rule will need to depend on\n-#   $1_AOT_JDK_CACHE The AOT cache file to be used to run the test with\n-#\n-SetupAot = $(NamedParamsMacroTemplate)\n-define SetupAotBody\n-  $1_AOT_JDK_CONF  := $$($1_TEST_SUPPORT_DIR)\/aot\/jdk.aotconf\n-  $1_AOT_JDK_CACHE := $$($1_TEST_SUPPORT_DIR)\/aot\/jdk.aotcache\n-  $1_AOT_JDK_LOG   := $$($1_TEST_SUPPORT_DIR)\/aot\/ExerciseJDKClasses.log\n-\n-  # We execute the training run with $(TEST_IMAGE_DIR)\/jtreg_setup_aot\/ExerciseJDKClasses.class\n-  # to touch a fair number of classes inside the JDK. Note that we can't specify a classpath,\n-  # or else the AOT cache cannot be used with jtreg test cases that use a different value\n-  # for their classpaths. Instead, we run in the $(TEST_IMAGE_DIR)\/jtreg_setup_aot\/ directory.\n-  # The \"java\" launcher will have an implicit classpath of \".\", so it can pick up the ExerciseJDKClasses\n-  # class from the JVM's current directory.\n-  #\n-  # The ExerciseJDKClasses class (or any other classes that are loaded from \".\") will be excluded\n-  # from the the AOT cache as \".\" is an unsupported location. As a result, the AOT cache will contain\n-  # only classes from the JDK.\n-\n-  $$($1_AOT_JDK_CACHE): $$(JDK_IMAGE_DIR)\/release\n-\t$$(call MakeDir, $$($1_TEST_SUPPORT_DIR)\/aot)\n-\n-\t$$(call LogWarn, AOT: Create cache configuration) \\\n-\t$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)\/aot, ( \\\n-\t    $(CD) $(TEST_IMAGE_DIR)\/jtreg_setup_aot; \\\n-\t    $$(FIXPATH) $(JDK_UNDER_TEST)\/bin\/java $$($1_VM_OPTIONS) \\\n-\t        -Xlog:cds,cds+class=debug:file=$$($1_AOT_JDK_CONF).log  -Xlog:cds*=error \\\n-\t        -XX:AOTMode=record -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) \\\n-\t        ExerciseJDKClasses > $$($1_AOT_JDK_LOG) \\\n-\t))\n-\n-\t$$(call LogWarn, AOT: Generate AOT cache $$($1_AOT_JDK_CACHE) with flags: $$($1_VM_OPTIONS))\n-\t$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)\/aot, ( \\\n-\t    $$(FIXPATH) $(JDK_UNDER_TEST)\/bin\/java \\\n-\t        $$($1_VM_OPTIONS) -Xlog:cds,cds+class=debug:file=$$($1_AOT_JDK_CACHE).log -Xlog:cds*=error \\\n-\t        -XX:ExtraSharedClassListFile=$(JDK_UNDER_TEST)\/lib\/classlist \\\n-\t        -XX:AOTMode=create -XX:AOTConfiguration=$$($1_AOT_JDK_CONF) -XX:AOTCache=$$($1_AOT_JDK_CACHE) \\\n-\t))\n-\n-  $1_AOT_TARGETS += $$($1_AOT_JDK_CACHE)\n-\n-endef\n-\n-endif # include guard\n-include MakeIncludeEnd.gmk\n","filename":"make\/test\/SetupAOT.gmk","additions":0,"deletions":84,"binary":false,"changes":84,"status":"deleted"}]}