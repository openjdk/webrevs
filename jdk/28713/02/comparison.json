{"files":[{"patch":"@@ -3,0 +3,1 @@\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +44,1 @@\n-  public static void main(String args[]) {\n+  public static void main(String args[]) throws Throwable {\n@@ -47,4 +48,2 @@\n-    Runnable test = new Test(runLatch, startLatch);\n-\n-    Thread t1 = new Thread(test);\n-    Thread t2 = new Thread(test);\n+    TestThread t1 = new TestThread(runLatch, startLatch);\n+    TestThread t2 = new TestThread(runLatch, startLatch);\n@@ -62,0 +61,15 @@\n+\n+      Throwable threadException = t1.exception() != null ? t1.exception()\n+                                                         : t2.exception();\n+      if (threadException != null) {\n+        Throwable t = threadException;\n+        try {\n+          throw new Error(\"TestThread encountered unexpected exception\", t);\n+        }\n+        catch (OutOfMemoryError oome) {\n+          \/\/ If we encounter an OOME trying to create the wrapper Error,\n+          \/\/ then just re-throw the original exception so we report it and\n+          \/\/ not the secondary OOME.\n+          throw t;\n+        }\n+      }\n@@ -67,1 +81,1 @@\n-  static class Test implements Runnable {\n+  static class TestThread extends Thread {\n@@ -70,0 +84,5 @@\n+    private Throwable exception;\n+\n+    Throwable exception() {\n+      return exception;\n+    }\n@@ -71,1 +90,1 @@\n-    Test(CountDownLatch runLatch, CountDownLatch startLatch) {\n+    TestThread(CountDownLatch runLatch, CountDownLatch startLatch) {\n@@ -78,0 +97,2 @@\n+      \/\/ Don't allow any exceptions to escape - the main thread will\n+      \/\/ report them.\n@@ -79,12 +100,17 @@\n-        startLatch.countDown();\n-        \/\/ Try to have all threads trigger the nesthost check at the same time\n-        runLatch.await();\n-        HostNoNestMember h = new HostNoNestMember();\n-        h.test();\n-        throw new Error(\"IllegalAccessError was not thrown as expected\");\n-      } catch (IllegalAccessError expected) {\n-        String msg = \"current type is not listed as a nest member\";\n-        if (!expected.getMessage().contains(msg)) {\n-          throw new Error(\"Wrong \" + expected.getClass().getSimpleName() +\": \\\"\" +\n-                          expected.getMessage() + \"\\\" does not contain \\\"\" +\n-                          msg + \"\\\"\", expected);\n+        try {\n+          startLatch.countDown();\n+          \/\/ Try to have all threads trigger the nesthost check at the same time\n+          runLatch.await();\n+          HostNoNestMember h = new HostNoNestMember();\n+          h.test();\n+          throw new Error(\"IllegalAccessError was not thrown as expected\");\n+        } catch (IllegalAccessError expected) {\n+          String msg = \"current type is not listed as a nest member\";\n+          if (!expected.getMessage().contains(msg)) {\n+            throw new Error(\"Wrong \" + expected.getClass().getSimpleName() +\": \\\"\" +\n+                            expected.getMessage() + \"\\\" does not contain \\\"\" +\n+                            msg + \"\\\"\", expected);\n+          }\n+          System.out.println(\"OK - got expected exception: \" + expected);\n+        } catch (InterruptedException e) {\n+            throw new Error(\"Unexpected interrupt\", e);\n@@ -92,3 +118,2 @@\n-        System.out.println(\"OK - got expected exception: \" + expected);\n-      } catch (InterruptedException e) {\n-        throw new Error(\"Unexpected interrupt\");\n+      } catch (Throwable t) {\n+        exception = t;\n","filename":"test\/hotspot\/jtreg\/runtime\/Nestmates\/membership\/TestNestHostErrorWithMultiThread.java","additions":47,"deletions":22,"binary":false,"changes":69,"status":"modified"}]}