{"files":[{"patch":"@@ -28,1 +28,1 @@\n- * @build jdk.httpclient.test.lib.http2.Http2TestServer jdk.test.lib.net.SimpleSSLContext\n+ * @build jdk.httpclient.test.lib.common.HttpServerAdapters jdk.test.lib.net.SimpleSSLContext\n@@ -32,8 +32,0 @@\n-import com.sun.net.httpserver.HttpExchange;\n-import com.sun.net.httpserver.HttpHandler;\n-import com.sun.net.httpserver.HttpServer;\n-import com.sun.net.httpserver.HttpsConfigurator;\n-import com.sun.net.httpserver.HttpsServer;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStream;\n@@ -58,3 +50,2 @@\n-import jdk.httpclient.test.lib.http2.Http2TestServer;\n-import jdk.httpclient.test.lib.http2.Http2TestExchange;\n-import jdk.httpclient.test.lib.http2.Http2Handler;\n+\n+import jdk.httpclient.test.lib.common.HttpServerAdapters;\n@@ -75,1 +66,1 @@\n-public class CustomRequestPublisher {\n+public class CustomRequestPublisher implements HttpServerAdapters {\n@@ -78,4 +69,4 @@\n-    HttpServer httpTestServer;         \/\/ HTTP\/1.1    [ 4 servers ]\n-    HttpsServer httpsTestServer;       \/\/ HTTPS\/1.1\n-    Http2TestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n-    Http2TestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n+    HttpTestServer httpTestServer;    \/\/ HTTP\/1.1        [ 4 servers ]\n+    HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n+    HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n+    HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n@@ -314,5 +305,0 @@\n-    static String serverAuthority(HttpServer server) {\n-        return InetAddress.getLoopbackAddress().getHostName() + \":\"\n-                + server.getAddress().getPort();\n-    }\n-\n@@ -326,3 +312,3 @@\n-        httpTestServer = HttpServer.create(sa, 0);\n-        httpTestServer.createContext(\"\/http1\/echo\", new Http1EchoHandler());\n-        httpURI = \"http:\/\/\" + serverAuthority(httpTestServer) + \"\/http1\/echo\";\n+        httpTestServer = HttpTestServer.create(HTTP_1_1);\n+        httpTestServer.addHandler(new HttpTestEchoHandler(), \"\/http1\/echo\");\n+        httpURI = \"http:\/\/\" + httpTestServer.serverAuthority() + \"\/http1\/echo\";\n@@ -330,4 +316,3 @@\n-        httpsTestServer = HttpsServer.create(sa, 0);\n-        httpsTestServer.setHttpsConfigurator(new HttpsConfigurator(sslContext));\n-        httpsTestServer.createContext(\"\/https1\/echo\", new Http1EchoHandler());\n-        httpsURI = \"https:\/\/\" + serverAuthority(httpsTestServer) + \"\/https1\/echo\";\n+        httpsTestServer = HttpTestServer.create(HTTP_1_1, sslContext);\n+        httpsTestServer.addHandler(new HttpTestEchoHandler(), \"\/https1\/echo\");\n+        httpsURI = \"https:\/\/\" + httpsTestServer.serverAuthority() + \"\/https1\/echo\";\n@@ -335,2 +320,2 @@\n-        http2TestServer = new Http2TestServer(\"localhost\", false, 0);\n-        http2TestServer.addHandler(new Http2EchoHandler(), \"\/http2\/echo\");\n+        http2TestServer = HttpTestServer.create(HTTP_2);\n+        http2TestServer.addHandler(new HttpTestEchoHandler(), \"\/http2\/echo\");\n@@ -339,2 +324,2 @@\n-        https2TestServer = new Http2TestServer(\"localhost\", true, sslContext);\n-        https2TestServer.addHandler(new Http2EchoHandler(), \"\/https2\/echo\");\n+        https2TestServer = HttpTestServer.create(HTTP_2, sslContext);\n+        https2TestServer.addHandler(new HttpTestEchoHandler(), \"\/https2\/echo\");\n@@ -351,2 +336,2 @@\n-        httpTestServer.stop(0);\n-        httpsTestServer.stop(0);\n+        httpTestServer.stop();\n+        httpsTestServer.stop();\n@@ -357,23 +342,0 @@\n-    static class Http1EchoHandler implements HttpHandler {\n-        @Override\n-        public void handle(HttpExchange t) throws IOException {\n-            try (InputStream is = t.getRequestBody();\n-                 OutputStream os = t.getResponseBody()) {\n-                byte[] bytes = is.readAllBytes();\n-                t.sendResponseHeaders(200, bytes.length);\n-                os.write(bytes);\n-            }\n-        }\n-    }\n-\n-    static class Http2EchoHandler implements Http2Handler {\n-        @Override\n-        public void handle(Http2TestExchange t) throws IOException {\n-            try (InputStream is = t.getRequestBody();\n-                 OutputStream os = t.getResponseBody()) {\n-                byte[] bytes = is.readAllBytes();\n-                t.sendResponseHeaders(200, bytes.length);\n-                os.write(bytes);\n-            }\n-        }\n-    }\n","filename":"test\/jdk\/java\/net\/httpclient\/CustomRequestPublisher.java","additions":20,"deletions":58,"binary":false,"changes":78,"status":"modified"}]}