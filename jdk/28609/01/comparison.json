{"files":[{"patch":"@@ -30,1 +30,0 @@\n-import jdk.internal.misc.ThreadTracker;\n@@ -216,0 +215,3 @@\n+    \/\/ this will be set when the thread is initializing a JAR verifier\n+    private static final ScopedValue<Boolean> IN_VERIFIER_INIT = ScopedValue.newInstance();\n+\n@@ -1028,12 +1030,0 @@\n-    private static class ThreadTrackHolder {\n-        static final ThreadTracker TRACKER = new ThreadTracker();\n-    }\n-\n-    private static Object beginInit() {\n-        return ThreadTrackHolder.TRACKER.begin();\n-    }\n-\n-    private static void endInit(Object key) {\n-        ThreadTrackHolder.TRACKER.end(key);\n-    }\n-\n@@ -1046,3 +1036,8 @@\n-        if (jv != null && !jvInitialized) {\n-            Object key = beginInit();\n-            try {\n+        if (jv == null || jvInitialized) {\n+            return;\n+        }\n+        \/\/ mark the current thread as initializing\n+        \/\/ the JAR verifier\n+        ScopedValue.where(IN_VERIFIER_INIT, true).run(new Runnable() {\n+            @Override\n+            public void run() {\n@@ -1051,2 +1046,0 @@\n-            } finally {\n-                endInit(key);\n@@ -1054,1 +1047,1 @@\n-        }\n+        });\n@@ -1057,0 +1050,3 @@\n+    \/**\n+     * {@return true if the current thread is initializing a JAR verifier, false otherwise}\n+     *\/\n@@ -1058,1 +1054,1 @@\n-        return ThreadTrackHolder.TRACKER.contains(Thread.currentThread());\n+        return IN_VERIFIER_INIT.isBound();\n","filename":"src\/java.base\/share\/classes\/java\/util\/jar\/JarFile.java","additions":16,"deletions":20,"binary":false,"changes":36,"status":"modified"}]}