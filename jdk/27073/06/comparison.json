{"files":[{"patch":"@@ -948,0 +948,1 @@\n+      # check the compiler and binutils support sve or not\n@@ -949,1 +950,1 @@\n-      AC_COMPILE_IFELSE([AC_LANG_PROGRAM([#include <arm_sve.h>],\n+      AC_COMPILE_IFELSE([AC_LANG_PROGRAM(\n@@ -951,17 +952,2 @@\n-            svint32_t r = svdup_n_s32(1);\n-            return 0;\n-          ])],\n-          [\n-            AC_MSG_RESULT([yes])\n-            $2SVE_CFLAGS=\"-march=armv8-a+sve\"\n-            # Switching the initialization mode with gcc from 'pattern' to 'zero'\n-            # avoids the use of unsupported `__builtin_clear_padding` for variable\n-            # length aggregates\n-            if test \"x$DEBUG_LEVEL\" != xrelease && test \"x$TOOLCHAIN_TYPE\" = xgcc ; then\n-              INIT_ZERO_FLAG=\"-ftrivial-auto-var-init=zero\"\n-              FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$INIT_ZERO_FLAG],\n-                IF_TRUE: [\n-                  $2SVE_CFLAGS=\"${$2SVE_CFLAGS} $INIT_ZERO_FLAG\"\n-                ]\n-              )\n-            fi\n+            #include <arm_sve.h>\n+            svfloat64_t a() {}\n@@ -970,3 +956,4 @@\n-            AC_MSG_RESULT([no])\n-            $2SVE_CFLAGS=\"\"\n-          ]\n+            svint32_t r = svdup_n_s32(1)\n+          ])],\n+          [sve_supported=yes],\n+          [sve_supported=no]\n@@ -974,0 +961,25 @@\n+      AC_MSG_RESULT([$sve_supported])\n+      $2SVE_CFLAGS=\"\"\n+      if test \"x$AARCH64_SVE_ENABLED\" = \"xtrue\"; then\n+        if test \"x$sve_supported\" = \"xyes\"; then\n+          $2SVE_CFLAGS=\"-march=armv8-a+sve\"\n+        else\n+          AC_MSG_ERROR([--enable-aarch64-sve but compiler or binutils does not support SVE])\n+        fi\n+      elif test \"x$AARCH64_SVE_ENABLED\" = \"xfalse\"; then\n+        # disable sve explicitly\n+        if test \"x$sve_supported\" = \"xyes\"; then\n+          $2SVE_CFLAGS=\"\"\n+        fi\n+      fi\n+      # Switching the initialization mode with gcc from 'pattern' to 'zero'\n+      # avoids the use of unsupported `__builtin_clear_padding` for variable\n+      # length aggregates\n+      if test \"x$$2SVE_CFLAGS\" != \"x\" && test \"x$DEBUG_LEVEL\" != xrelease && test \"x$TOOLCHAIN_TYPE\" = xgcc ; then\n+        INIT_ZERO_FLAG=\"-ftrivial-auto-var-init=zero\"\n+        FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$INIT_ZERO_FLAG],\n+          IF_TRUE: [\n+            $2SVE_CFLAGS=\"${$2SVE_CFLAGS} $INIT_ZERO_FLAG\"\n+          ]\n+        )\n+      fi\n","filename":"make\/autoconf\/flags-cflags.m4","additions":33,"deletions":21,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -368,0 +368,4 @@\n+  UTIL_ARG_ENABLE(NAME: aarch64-sve, DEFAULT: auto,\n+    RESULT: AARCH64_SVE_ENABLED,\n+    DESC: [Use SVE when compile libsleef])\n+\n","filename":"make\/autoconf\/flags.m4","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}