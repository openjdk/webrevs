{"files":[{"patch":"@@ -39,0 +39,2 @@\n+import java.util.Optional;\n+import java.util.function.BiFunction;\n@@ -61,1 +63,3 @@\n-                build().args(\"foo\", \"bar\").expectErrors(I18N.format(\"error.non-option-arguments\", 2)),\n+                \/\/ Additional error messages may be printed if the default bundling operation\n+                \/\/ can not be identified; don't verify these errors in the output.\n+                build().args(\"foo\", \"bar\").stderrMatchType(OutputMatchType.STARTS_WITH).expectErrors(I18N.format(\"error.non-option-arguments\", 2)),\n@@ -71,1 +75,3 @@\n-                build().args(\"foo\", \"--version\").expectErrors(I18N.format(\"error.non-option-arguments\", 1))\n+                \/\/ Additional error messages may be printed if the default bundling operation\n+                \/\/ can not be identified; don't verify these errors in the output.\n+                build().args(\"foo\", \"--version\").stderrMatchType(OutputMatchType.STARTS_WITH).expectErrors(I18N.format(\"error.non-option-arguments\", 1))\n@@ -76,1 +82,1 @@\n-    record TestSpec(List<String> args, int expectedExitCode, List<String> expectedStdout, List<String> expectedStderr) {\n+    record TestSpec(List<String> args, int expectedExitCode, ExpectedOutput expectedStdout, ExpectedOutput expectedStderr) {\n@@ -87,2 +93,2 @@\n-            assertEquals(expectedStdout, result.stdout());\n-            assertEquals(expectedStderr, result.stderr());\n+            expectedStdout.test(result.stdout());\n+            expectedStderr.test(result.stderr());\n@@ -95,1 +101,5 @@\n-                return new TestSpec(args, expectedExitCode, expectedStdout, expectedStderr);\n+                return new TestSpec(\n+                        args,\n+                        expectedExitCode,\n+                        new ExpectedOutput(expectedStdout, Optional.ofNullable(stdoutMatchType).orElse(OutputMatchType.EQUALS)),\n+                        new ExpectedOutput(expectedStderr, Optional.ofNullable(stderrMatchType).orElse(OutputMatchType.EQUALS)));\n@@ -107,0 +117,10 @@\n+            Builder stdoutMatchType(OutputMatchType v) {\n+                stdoutMatchType = v;\n+                return this;\n+            }\n+\n+            Builder stderrMatchType(OutputMatchType v) {\n+                stderrMatchType = v;\n+                return this;\n+            }\n+\n@@ -167,0 +187,2 @@\n+            private OutputMatchType stdoutMatchType;\n+            private OutputMatchType stderrMatchType;\n@@ -191,0 +213,31 @@\n+    private enum OutputMatchType {\n+        EQUALS((_, actual) -> actual),\n+        STARTS_WITH((expected, actual) -> {\n+            if (expected.size() < actual.size()) {\n+                return actual.subList(0, expected.size());\n+            }\n+            return actual;\n+        }),\n+        ;\n+\n+        OutputMatchType(BiFunction<List<String>, List<String>, List<String>> mapper) {\n+            this.mapper = Objects.requireNonNull(mapper);\n+        }\n+\n+        private final BiFunction<List<String>, List<String>, List<String>> mapper;\n+    }\n+\n+\n+    private record ExpectedOutput(List<String> content, OutputMatchType type) {\n+        ExpectedOutput {\n+            Objects.requireNonNull(content);\n+            Objects.requireNonNull(type);\n+        }\n+\n+        void test(List<String> lines) {\n+            var filteredLines = type.mapper.apply(content, lines);\n+            assertEquals(content, filteredLines);\n+        }\n+    }\n+\n+\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/cli\/MainTest.java","additions":59,"deletions":6,"binary":false,"changes":65,"status":"modified"}]}