{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,3 @@\n+ * @key cgroups\n+ * @requires container.support\n+ * @requires !vm.asan\n@@ -48,0 +51,4 @@\n+import jdk.test.lib.Utils;\n+import jdk.test.lib.containers.docker.Common;\n+import jdk.test.lib.containers.docker.DockerRunOptions;\n+import jdk.test.lib.containers.docker.DockerTestUtils;\n@@ -78,3 +85,0 @@\n-        final String ULIMIT_CMD = \"ulimit -u 4096\";\n-        ProcessBuilder pb = ProcessTools.createTestJavaProcessBuilder(ThreadCountLimit.class.getName());\n-        String javaCmd = ProcessTools.getCommandLine(pb);\n@@ -82,2 +86,22 @@\n-        ProcessTools.executeCommand(\"bash\", \"-c\", ULIMIT_CMD + \" && \" + javaCmd + \" dummy\")\n-                    .shouldHaveExitValue(0);\n+        if (!DockerTestUtils.canTestDocker()) {\n+            return;\n+        }\n+\n+        String imageName = Common.imageName(\"threadCountLimit\");\n+        imageName.replace(\"#\", \"-\");\n+        System.out.println(\"Building Docker image: \" + imageName);\n+        DockerTestUtils.buildJdkContainerImage(imageName);\n+        \n+        try {\n+          Common.logNewTestCase(\"Test ThreadCountLimit\");\n+          DockerRunOptions opts =\n+                  new DockerRunOptions(imageName, \"\/jdk\/bin\/java\", ThreadCountLimit.class.getName());\n+          opts.addDockerOpts(\"--pids-limit\", \"4096\");\n+          opts.addDockerOpts(\"--volume\", Utils.TEST_CLASSES + \":\/test-classes\/\");\n+          opts.addJavaOpts(\"-cp\", \"\/test-classes\/\");\n+          opts.addClassOptions(\"dummy\");\n+          OutputAnalyzer out = DockerTestUtils.dockerRunJava(opts);\n+          out.shouldHaveExitValue(0);\n+        } finally {\n+            DockerTestUtils.removeDockerImage(imageName);\n+        }\n","filename":"test\/hotspot\/jtreg\/runtime\/Thread\/ThreadCountLimit.java","additions":30,"deletions":6,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,0 +61,1 @@\n+        testname = testname.replace('#', '-');\n","filename":"test\/lib\/jdk\/test\/lib\/containers\/docker\/Common.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}