{"files":[{"patch":"@@ -1002,0 +1002,1 @@\n+      MetaspaceShared::report_loading_error();\n","filename":"src\/hotspot\/share\/cds\/aotClassLocation.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -329,1 +329,1 @@\n-    log_info(cds)(\"optimized module handling: disabled because extra module path(s) are specified\");\n+    MetaspaceShared::report_loading_error(\"optimized module handling: disabled because extra module path(s) are specified\");\n@@ -1256,1 +1256,1 @@\n-    log_info(cds)(\"failed to map relocation bitmap\");\n+    MetaspaceShared::report_loading_error(\"failed to map relocation bitmap\");\n@@ -1418,1 +1418,1 @@\n-        log_info(cds)(\"Cannot use CDS heap data. Selected GC not compatible -XX:-UseCompressedOops\");\n+        MetaspaceShared::report_loading_error(\"Cannot use CDS heap data. Selected GC not compatible -XX:-UseCompressedOops\");\n@@ -1420,1 +1420,1 @@\n-        log_info(cds)(\"Cannot use CDS heap data. UseEpsilonGC, UseG1GC, UseSerialGC, UseParallelGC, or UseShenandoahGC are required.\");\n+        MetaspaceShared::report_loading_error(\"Cannot use CDS heap data. UseEpsilonGC, UseG1GC, UseSerialGC, UseParallelGC, or UseShenandoahGC are required.\");\n@@ -1599,1 +1599,1 @@\n-    log_info(cds)(\"UseSharedSpaces: Unable to allocate java heap region for archive heap.\");\n+    MetaspaceShared::report_loading_error(\"UseSharedSpaces: Unable to allocate java heap region for archive heap.\");\n@@ -1634,1 +1634,1 @@\n-      log_info(cds)(\"UseSharedSpaces: mapped heap region is corrupt\");\n+      MetaspaceShared::report_loading_error(\"UseSharedSpaces: mapped heap region is corrupt\");\n@@ -1658,1 +1658,1 @@\n-      log_info(cds)(\"CDS heap cannot be used because bitmap region cannot be mapped\");\n+      MetaspaceShared::report_loading_error(\"CDS heap cannot be used because bitmap region cannot be mapped\");\n@@ -1771,1 +1771,1 @@\n-    log_info(cds)(\"CDS is disabled because early JVMTI ClassFileLoadHook is in use.\");\n+    MetaspaceShared::report_loading_error(\"CDS is disabled because early JVMTI ClassFileLoadHook is in use.\");\n@@ -1777,1 +1777,1 @@\n-      log_info(cds)(\"Loading static archive failed.\");\n+      MetaspaceShared::report_loading_error(\"Loading static archive failed.\");\n@@ -1780,1 +1780,1 @@\n-      log_info(cds)(\"Loading dynamic archive failed.\");\n+      MetaspaceShared::report_loading_error(\"Loading dynamic archive failed.\");\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -1110,4 +1110,1 @@\n-  log_error(cds)(\"An error has occurred while processing the %s.\", CDSConfig::type_of_archive_being_loaded());\n-  if (message != nullptr) {\n-    log_error(cds)(\"%s\", message);\n-  }\n+  report_loading_error(message);\n@@ -1124,0 +1121,15 @@\n+void MetaspaceShared::report_loading_error(const char* message) {\n+\n+  if (SharedArchiveFile != nullptr) {\n+    log_error(cds)(\"An error has occurred while processing the %s.\", CDSConfig::type_of_archive_being_loaded());\n+    if (message != nullptr) {\n+      log_error(cds)(\"%s\", message);\n+    }\n+  } else {\n+    log_info(cds)(\"An error has occurred while processing the %s.\", CDSConfig::type_of_archive_being_loaded());\n+    if (message != nullptr) {\n+      log_info(cds)(\"%s\", message);\n+    }\n+  }\n+}\n+\n@@ -1185,1 +1197,0 @@\n-    log_info(cds)(\"Unable to map shared spaces\");\n@@ -1188,2 +1199,6 @@\n-    } else if (RequireSharedSpaces) {\n-      MetaspaceShared::unrecoverable_loading_error(\"Unable to map shared spaces\");\n+    } else {\n+      if (RequireSharedSpaces) {\n+        MetaspaceShared::unrecoverable_loading_error(\"Unable to map shared spaces\");\n+      } else {\n+        report_loading_error(\"Unable to map shared spaces\");\n+      }\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":22,"deletions":7,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -113,0 +113,1 @@\n+  static void report_loading_error(const char* message = nullptr);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -57,0 +57,1 @@\n+    public static final String errMsg = \"An error has occurred while processing the shared archive file.\";\n@@ -173,0 +174,1 @@\n+        output.shouldContain(errMsg);\n@@ -197,0 +199,1 @@\n+        output.shouldContain(errMsg);\n@@ -240,1 +243,1 @@\n-        testAndCheck(verifyExecArgs);\n+        testAndCheck(verifyExecArgs, errMsg);\n@@ -246,1 +249,1 @@\n-        testAndCheck(verifyExecArgs);\n+        testAndCheck(verifyExecArgs, errMsg);\n@@ -252,1 +255,1 @@\n-        testAndCheck(verifyExecArgs, \"The shared archive file has been truncated.\");\n+        testAndCheck(verifyExecArgs, \"The shared archive file has been truncated.\", errMsg);\n@@ -259,1 +262,1 @@\n-        testAndCheck(verifyExecArgs);\n+        testAndCheck(verifyExecArgs, errMsg);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/SharedArchiveConsistency.java","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -66,0 +66,1 @@\n+        String errMsg = \"An error has occurred while processing the shared archive file.\";\n@@ -78,1 +79,1 @@\n-          .assertNormalExit(topArchiveMsg);\n+          .assertNormalExit(topArchiveMsg, errMsg);\n@@ -87,1 +88,1 @@\n-          .assertNormalExit(topArchiveMsg, mismatchMsg, hintMsg);\n+          .assertNormalExit(topArchiveMsg, mismatchMsg, hintMsg, errMsg);\n@@ -99,0 +100,1 @@\n+                  .shouldContain(errMsg)\n@@ -114,0 +116,1 @@\n+              output.shouldContain(errMsg);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/WrongTopClasspath.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"}]}