{"files":[{"patch":"@@ -649,0 +649,14 @@\n+bool CDSConfig::is_using_only_default_archive() {\n+  if (!is_using_archive()) {\n+    \/\/ During JDK build when dumping a classlist (DumpLoadedClassList), exclude error\n+    \/\/ message from the classlist as it interferes with the default CDS archive creation.\n+    return true;\n+  }\n+\n+  return is_using_archive() &&\n+         input_static_archive_path() != nullptr &&\n+         default_archive_path() != nullptr &&\n+         strcmp(input_static_archive_path(), default_archive_path()) == 0 &&\n+         input_dynamic_archive_path() == nullptr;\n+}\n+\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.cpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -106,0 +106,1 @@\n+  static bool is_using_only_default_archive()                NOT_CDS_RETURN_(false);\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1122,11 +1122,12 @@\n-\n-  if (SharedArchiveFile != nullptr) {\n-    log_error(cds)(\"An error has occurred while processing the %s.\", CDSConfig::type_of_archive_being_loaded());\n-    if (message != nullptr) {\n-      log_error(cds)(\"%s\", message);\n-    }\n-  } else {\n-    log_info(cds)(\"An error has occurred while processing the %s.\", CDSConfig::type_of_archive_being_loaded());\n-    if (message != nullptr) {\n-      log_info(cds)(\"%s\", message);\n-    }\n+  \/\/ If the user doesn't specify any CDS options, we will try to load the default CDS archive, which\n+  \/\/ may fail due to incompatible VM options. Print at the info level to avoid excessive verbosity.\n+  \/\/ However, if the user has specified a CDS archive (or AOT cache), they would be interested in\n+  \/\/ knowing that the loading fails, so we print at the error level.\n+  Log(cds) log;\n+  LogStream ls_error(log.error());\n+  LogStream ls_info(log.info());\n+  LogStream& ls = CDSConfig::is_using_only_default_archive() ? ls_info : ls_error;\n+\n+  ls.print_cr(\"An error has occurred while processing the %s.\", CDSConfig::type_of_archive_being_loaded());\n+  if (message != nullptr) {\n+     ls.print(\"%s\", message);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"}]}