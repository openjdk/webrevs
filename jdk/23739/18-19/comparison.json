{"files":[{"patch":"@@ -216,3 +216,3 @@\n-  class G1SwapThreadCardTableClosure : public HandshakeClosure {\n-  public:\n-    G1SwapThreadCardTableClosure() : HandshakeClosure(\"G1 Swap JT card table\") { }\n+  {\n+    \/\/ Need to leave the STS to avoid potential deadlock in the handshake.\n+    SuspendibleThreadSetLeaver sts;\n@@ -220,6 +220,11 @@\n-    virtual void do_thread(Thread* thread) {\n-      G1BarrierSet* bs = G1BarrierSet::g1_barrier_set();\n-      bs->update_card_table_base(thread);\n-    }\n-  } cl;\n-  Handshake::execute(&cl);\n+    class G1SwapThreadCardTableClosure : public HandshakeClosure {\n+    public:\n+      G1SwapThreadCardTableClosure() : HandshakeClosure(\"G1 Swap JT card table\") { }\n+\n+      virtual void do_thread(Thread* thread) {\n+        G1BarrierSet* bs = G1BarrierSet::g1_barrier_set();\n+        bs->update_card_table_base(thread);\n+      }\n+    } cl;\n+    Handshake::execute(&cl);\n+  }\n@@ -228,1 +233,1 @@\n-}\n+  }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentRefine.cpp","additions":15,"deletions":10,"binary":false,"changes":25,"status":"modified"}]}