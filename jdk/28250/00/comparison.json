{"files":[{"patch":"@@ -98,0 +98,1 @@\n+        -DHOTSPOT_GTEST \\\n","filename":"make\/hotspot\/lib\/CompileGtest.gmk","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -40,2 +41,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/code\/relocInfo.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -35,2 +36,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/code\/relocInfo.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,130 @@\n+\/*\n+ * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+#ifndef SHARE_CPPSTDLIB_NEW_HPP\n+#define SHARE_CPPSTDLIB_NEW_HPP\n+\n+#include \"utilities\/compilerWarnings.hpp\"\n+\n+\/\/ HotSpot usage:\n+\/\/ Only the following may be used:\n+\/\/ * std::nothrow_t, std::nothrow\n+\/\/ * std::align_val_t\n+\/\/ * The non-allocating forms of `operator new` and `operator new[]` are\n+\/\/   implicitly used by the corresponding `new` and `new[]` expressions.\n+\/\/   - operator new(size_t, void*) noexcept\n+\/\/   - operator new[](size_t, void*) noexcept\n+\/\/   Note that the non-allocating forms of `operator delete` and `operator\n+\/\/   delete[]` are not used, since they are only invoked by a placement new\n+\/\/   expression that fails by throwing an exception. But they might still\n+\/\/   end up being referenced in such a situation.\n+\n+BEGIN_ALLOW_FORBIDDEN_FUNCTIONS\n+#include \"utilities\/vmassert_uninstall.hpp\"\n+\n+#include <new>\n+\n+#include \"utilities\/vmassert_reinstall.hpp\" \/\/ don't reorder\n+END_ALLOW_FORBIDDEN_FUNCTIONS\n+\n+\/\/ Deprecation declarations to forbid use of the default global allocator.\n+\/\/ See C++17 21.6.1 Header <new> synopsis.\n+\n+namespace std {\n+\n+#if 0\n+\/\/ We could deprecate exception types, for completeness, but don't bother.  We\n+\/\/ already have exceptions disabled, and run into compiler bugs when we try.\n+\/\/\n+\/\/ gcc -Wattributes => type attributes ignored after type is already defined\n+\/\/ See https:\/\/gcc.gnu.org\/bugzilla\/show_bug.cgi?id=122167\n+\/\/\n+\/\/ clang -Wignored-attributes => attribute declaration must precede definition\n+\/\/ The clang warning is https:\/\/github.com\/llvm\/llvm-project\/issues\/135481,\n+\/\/ which should be fixed in clang 21.\n+class [[deprecated]] bad_alloc;\n+class [[deprecated]] bad_array_new_length;\n+#endif \/\/ #if 0\n+\n+\/\/ Forbid new_handler manipulation by HotSpot code, leaving it untouched for\n+\/\/ use by application code.\n+[[deprecated]] new_handler get_new_handler() noexcept;\n+[[deprecated]] new_handler set_new_handler(new_handler) noexcept;\n+\n+\/\/ Prefer HotSpot mechanisms for padding.\n+\/\/\n+\/\/ Visual Studio => error C2370: '...': redefinition; different storage class\n+#ifndef TARGET_COMPILER_visCPP\n+[[deprecated]] extern const size_t hardware_destructive_interference_size;\n+[[deprecated]] extern const size_t hardware_constructive_interference_size;\n+#endif \/\/ not TARGET_COMPILER_visCPP\n+\n+} \/\/ namespace std\n+\n+\/\/ Forbid using the global allocator by HotSpot code.\n+\/\/ This doesn't provide complete coverage. Some global allocation and\n+\/\/ deallocation functions are implicitly declared in all translation units,\n+\/\/ without needing to include <new>; see C++17 6.7.4. So this doesn't remove\n+\/\/ the need for the link-time verification that these functions aren't used.\n+\/\/\n+\/\/ But don't poison them when compiling gtests. The gtest framework, the\n+\/\/ HotSpot wrapper around it (gtestMain.cpp), and even some tests, all have\n+\/\/ new\/new[] and delete\/delete[] expressions that use the default global\n+\/\/ allocator.  We also don't apply the link-time check for gtests, for the\n+\/\/ same reason.\n+#ifndef HOTSPOT_GTEST\n+\n+[[deprecated]] void* operator new(std::size_t);\n+[[deprecated]] void* operator new(std::size_t, std::align_val_t);\n+[[deprecated]] void* operator new(std::size_t, const std::nothrow_t&) noexcept;\n+[[deprecated]] void* operator new(std::size_t, std::align_val_t,\n+                                  const std::nothrow_t&) noexcept;\n+\n+[[deprecated]] void operator delete(void*) noexcept;\n+[[deprecated]] void operator delete(void*, std::size_t) noexcept;\n+[[deprecated]] void operator delete(void*, std::align_val_t) noexcept;\n+[[deprecated]] void operator delete(void*, std::size_t, std::align_val_t) noexcept;\n+[[deprecated]] void operator delete(void*, const std::nothrow_t&) noexcept;\n+[[deprecated]] void operator delete(void*, std::align_val_t,\n+                                    const std::nothrow_t&) noexcept;\n+\n+[[deprecated]] void* operator new[](std::size_t);\n+[[deprecated]] void* operator new[](std::size_t, std::align_val_t);\n+[[deprecated]] void* operator new[](std::size_t, const std::nothrow_t&) noexcept;\n+[[deprecated]] void* operator new[](std::size_t, std::align_val_t,\n+                                    const std::nothrow_t&) noexcept;\n+\n+[[deprecated]] void operator delete[](void*) noexcept;\n+[[deprecated]] void operator delete[](void*, std::size_t) noexcept;\n+[[deprecated]] void operator delete[](void*, std::align_val_t) noexcept;\n+[[deprecated]] void operator delete[](void*, std::size_t, std::align_val_t) noexcept;\n+[[deprecated]] void operator delete[](void*, const std::nothrow_t&) noexcept;\n+[[deprecated]] void operator delete[](void*, std::align_val_t,\n+                                      const std::nothrow_t&) noexcept;\n+\n+#endif \/\/ HOTSPOT_GTEST\n+\n+\/\/ Allow (don't poison) the non-allocating forms from [new.delete.placement].\n+\n+#endif \/\/ SHARE_CPPSTDLIB_NEW_HPP\n","filename":"src\/hotspot\/share\/cppstdlib\/new.hpp","additions":130,"deletions":0,"binary":false,"changes":130,"status":"added"},{"patch":"@@ -25,0 +25,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -29,2 +30,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/bufferNode.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -36,2 +37,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/partialArrayState.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -32,2 +33,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/gc\/z\/zDeferredConstructed.inline.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -34,2 +35,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/memory\/allocation.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"cppstdlib\/new.hpp\"\n","filename":"src\/hotspot\/share\/memory\/arena.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -34,2 +34,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/memory\/arena.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -66,1 +67,0 @@\n-#include <new>\n","filename":"src\/hotspot\/share\/utilities\/debug.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -31,2 +32,0 @@\n-#include <new>\n-\n","filename":"src\/hotspot\/share\/utilities\/deferredStatic.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -40,1 +41,0 @@\n-#include <new>\n","filename":"src\/hotspot\/share\/utilities\/elfFile.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -24,0 +24,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -31,2 +32,0 @@\n-#include <new>\n-\n","filename":"test\/hotspot\/gtest\/utilities\/test_lockFreeStack.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -24,0 +24,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -32,2 +33,0 @@\n-#include <new>\n-\n","filename":"test\/hotspot\/gtest\/utilities\/test_nonblockingQueue.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}