{"files":[{"patch":"@@ -765,2 +765,3 @@\n-    int limit = 3;\n-    do {\n+    int trials_remaining = 3;\n+    useconds_t next_delay = 1000;\n+    while (true) {\n@@ -768,1 +769,13 @@\n-    } while (ret == EAGAIN && limit-- > 0);\n+\n+      if (ret != EAGAIN) {\n+        break;\n+      }\n+\n+      if (trials_remaining-- <= 0) {\n+        break;\n+      }\n+\n+      log_warning(os, thread)(\"Failed to start native thread (%s), retrying after %dus.\", os::errno_name(ret), next_delay);\n+      ::usleep(next_delay);\n+      next_delay *= 2;\n+    }\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -650,4 +650,19 @@\n-    int limit = 3;\n-    do {\n-      ret = pthread_create(&tid, &attr, (void* (*)(void*)) thread_native_entry, thread);\n-    } while (ret == EAGAIN && limit-- > 0);\n+    {\n+      int trials_remaining = 3;\n+      useconds_t next_delay = 1000;\n+      while (true) {\n+        ret = pthread_create(&tid, &attr, (void* (*)(void*)) thread_native_entry, thread);\n+\n+        if (ret != EAGAIN) {\n+          break;\n+        }\n+\n+        if (trials_remaining-- <= 0) {\n+          break;\n+        }\n+\n+        log_warning(os, thread)(\"Failed to start native thread (%s), retrying after %dus.\", os::errno_name(ret), next_delay);\n+        ::usleep(next_delay);\n+        next_delay *= 2;\n+      }\n+    }\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -1067,4 +1067,19 @@\n-    int limit = 3;\n-    do {\n-      ret = pthread_create(&tid, &attr, (void* (*)(void*)) thread_native_entry, thread);\n-    } while (ret == EAGAIN && limit-- > 0);\n+    {\n+      int trials_remaining = 3;\n+      useconds_t next_delay = 1000;\n+      while (true) {\n+        ret = pthread_create(&tid, &attr, (void* (*)(void*)) thread_native_entry, thread);\n+\n+        if (ret != EAGAIN) {\n+          break;\n+        }\n+\n+        if (trials_remaining-- <= 0) {\n+          break;\n+        }\n+\n+        log_warning(os, thread)(\"Failed to start native thread (%s), retrying after %dus.\", os::errno_name(ret), next_delay);\n+        ::usleep(next_delay);\n+        next_delay *= 2;\n+      }\n+    }\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -763,10 +763,29 @@\n-  int limit = 3;\n-  do {\n-    thread_handle =\n-      (HANDLE)_beginthreadex(nullptr,\n-                             (unsigned)stack_size,\n-                             &thread_native_entry,\n-                             thread,\n-                             initflag,\n-                             &thread_id);\n-  } while (thread_handle == nullptr && errno == EAGAIN && limit-- > 0);\n+  {\n+    int trials_remaining = 3;\n+    DWORD next_delay_ms = 1;\n+    while (true) {\n+      thread_handle =\n+        (HANDLE)_beginthreadex(nullptr,\n+                              (unsigned)stack_size,\n+                              &thread_native_entry,\n+                              thread,\n+                              initflag,\n+                              &thread_id);\n+\n+      if (thread_handle != nullptr) {\n+        break;\n+      }\n+\n+      if (errno != EAGAIN) {\n+        break;\n+      }\n+\n+      if (trials_remaining-- <= 0) {\n+        break;\n+      }\n+\n+      log_warning(os, thread)(\"Failed to start native thread (%s), retrying after %dms.\", os::errno_name(errno), next_delay_ms);\n+      Sleep(next_delay_ms);\n+      next_delay_ms *= 2;\n+    }\n+  }\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":29,"deletions":10,"binary":false,"changes":39,"status":"modified"}]}