{"files":[{"patch":"@@ -1292,2 +1292,1 @@\n-      for (uint i = 0; i < num_workers; i++)\n-      {\n+      for (uint i = 0; i < num_workers; i++) {\n@@ -1299,1 +1298,6 @@\n-      BufferNode* cur = buffers._head;\n+\n+      size_t num_buffers = (buffers._entry_count \/ G1UpdateBufferSize);\n+      size_t buffers_per_thread = MAX2(num_buffers \/ num_workers, (size_t)1);\n+\n+      BufferNode* head = buffers._head;\n+      BufferNode* tail = head;\n@@ -1302,5 +1306,16 @@\n-      while (cur != nullptr) {\n-        BufferNode* next = cur->next();\n-        cur->set_next(nullptr);\n-        _dirty_card_buffers[worker++ % num_workers].push(*cur);\n-        cur = next;\n+      while (tail != nullptr) {\n+        size_t count = 0;\n+        BufferNode* cur = tail->next();\n+\n+        while (count < buffers_per_thread && cur != nullptr) {\n+          tail = cur;\n+          cur = tail->next();\n+          count++;\n+        }\n+\n+        tail->set_next(nullptr);\n+        _dirty_card_buffers[worker++ % num_workers].prepend(*head, *tail);\n+\n+        assert(cur != nullptr || tail == buffers._tail, \"Must be\");\n+        head = cur;\n+        tail = cur;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1RemSet.cpp","additions":23,"deletions":8,"binary":false,"changes":31,"status":"modified"}]}