{"files":[{"patch":"@@ -64,2 +64,1 @@\n-#if defined(LINUX)\n-#include <malloc.h>\n+#include <string.h>\n@@ -68,1 +67,3 @@\n-#include <sys\/mman.h>\n+\n+#if defined(LINUX)\n+#include <malloc.h>\n@@ -75,1 +76,0 @@\n-#include <string.h>\n@@ -77,1 +77,9 @@\n-#include <string.h>\n+#endif\n+\n+#if defined(_WIN64)\n+\/\/ TODO: suppress undefined errors for now\n+#define PROT_READ\n+#define PROT_WRITE\n+#define MAP_PRIVATE\n+#define STDERR_FILENO\n+#define STDOUT_FILENO\n@@ -126,1 +134,1 @@\n- \/\/ ???\n+ \/\/ TODO\n@@ -147,1 +155,1 @@\n- \/\/ ???\n+ \/\/ TODO\n@@ -155,1 +163,1 @@\n- \/\/ ???\n+  \/\/ TODO\n@@ -198,0 +206,10 @@\n+void *NMT_LogRecorder::mmap(void *addr, size_t len, int prot, int flags, int fd)\n+{\n+#if defined(LINUX) || defined(__APPLE__)\n+  return ::mmap(addr, len, prot, flags, fd, 0);\n+#elif defined(_WIN64)\n+  \/\/ TODO\n+  return nullptr;\n+#endif\n+}\n+\n@@ -319,1 +337,1 @@\n-  info.ptr = ::mmap(NULL, info.size, PROT_READ, MAP_PRIVATE, info.fd, 0);\n+  info.ptr = NMT_LogRecorder::mmap(NULL, info.size, PROT_READ, MAP_PRIVATE, info.fd);\n@@ -415,1 +433,1 @@\n-  address *pointers = (address*)::mmap(NULL, size_pointers, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_NORESERVE|MAP_ANONYMOUS, -1, 0);\n+  address *pointers = (address*)NMT_LogRecorder::mmap(NULL, size_pointers, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_NORESERVE|MAP_ANONYMOUS, -1);\n@@ -559,1 +577,1 @@\n-  fprintf(stderr, \"\\n\\n\\nmalloc summary [\\\"-XX:NativeMemoryTracking=%s\\\"]:\\n\\n\", NMTUtil::tracking_level_to_string(recorded_nmt_level));\n+  fprintf(stderr, \"\\n\\n\\nmalloc summary [recorded NMT mode \\\"%s\\\"]:\\n\\n\", NMTUtil::tracking_level_to_string(recorded_nmt_level));\n","filename":"src\/hotspot\/share\/nmt\/memLogRecorder.cpp","additions":29,"deletions":11,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -60,0 +60,1 @@\n+  static void *mmap(void *addr, size_t len, int prot, int flags, int fd);\n","filename":"src\/hotspot\/share\/nmt\/memLogRecorder.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}