{"files":[{"patch":"@@ -379,0 +379,8 @@\n+jlong histogramLimits[] = {32, 64, 128, 256, 512, 1024, 4096, 8192, 16896};\n+\/\/jlong histogramLimits[] = {16, 32, 48, 64, 80, 96, 112, 128, 256, 512, 1024, 4096, 8192, 16896, 65536};\n+const jlong histogramLimitsSize = sizeof(histogramLimits)\/sizeof(jlong);\n+const char *histogramChars[] = {\"▁\", \"▂\", \"▃\", \"▄\", \"▅\", \"▆\", \"▇\", \"█\"};\n+typedef struct HistogramBuckets {\n+  jlong buckets[histogramLimitsSize+1];\n+} HistogramBuckets;\n+\n@@ -425,0 +433,2 @@\n+  HistogramBuckets histogramByCategory[mt_number_of_tags] = {0};\n+  \n@@ -532,0 +542,8 @@\n+\n+    HistogramBuckets* histogram = &histogramByCategory[NMTUtil::tag_to_index(mem_tag)];\n+    for (int s = histogramLimitsSize; s >= 0; s--) {\n+      if (actual >= histogramLimits[s]) {\n+        histogram->buckets[s]++;\n+        break;\n+      }\n+    }\n@@ -534,0 +552,1 @@\n+  setlocale(LC_ALL, \"\");\n@@ -575,0 +594,20 @@\n+\n+    fprintf(stderr, \"    \");\n+\n+    HistogramBuckets* histogram = &histogramByCategory[i];\n+    jlong max = 0;\n+    for (int s = histogramLimitsSize; s >= 0; s--) {\n+      if (histogram->buckets[s] > max) {\n+        max = histogram->buckets[s];\n+      }\n+    }\n+\/\/    fprintf(stderr, \"max:%ld \", max);\n+\/\/    for (int s = histogramLimitsSize; s >= 0; s--) {\n+\/\/      double index = (100.0 * ((double)histogram->buckets[s] \/ (double)max));\n+\/\/      fprintf(stderr, \"%.1f,\", index);\n+\/\/    }\n+    for (int s = histogramLimitsSize; s >= 0; s--) {\n+      int index = (int)(100.0 * ((double)histogram->buckets[s] \/ (double)max)) % 8;\n+      fprintf(stderr, \"%s\", histogramChars[index]);\n+    }\n+\n","filename":"src\/hotspot\/share\/nmt\/memLogRecorder.cpp","additions":39,"deletions":0,"binary":false,"changes":39,"status":"modified"}]}