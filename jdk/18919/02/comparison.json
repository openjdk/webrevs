{"files":[{"patch":"@@ -6670,0 +6670,21 @@\n+\/\/ Combined Multiply-Add Shorts into Integer (dst = src1 * src2 + src3 * src4)\n+\/\/ It's not necessary to have this one, as there is no instructions on riscv to do a\n+\/\/ scalar muladd. But to enable MulAddVS2VI instrinsic, we need the scalar version first.\n+\n+instruct muladdS2I(iRegINoSp dst, iRegIorL2I src1, iRegIorL2I src2, iRegIorL2I src3, iRegIorL2I src4, iRegLNoSp tmp) %{\n+  match(Set dst (MulAddS2I (Binary src1 src2) (Binary src3 src4)));\n+  ins_cost(IMUL_COST * 2);\n+  effect(TEMP_DEF dst, TEMP tmp);\n+\n+  format %{ \"mulw  rscratch1, $src1, $src2\\n\\t\"\n+            \"maddw $dst, $src3, $src4, rscratch1\" %}\n+\n+  ins_encode %{\n+    __ mul(t0, as_Register($src1$$reg), as_Register($src2$$reg));\n+    __ mul(as_Register($tmp$$reg), as_Register($src3$$reg), as_Register($src4$$reg));\n+    __ add(as_Register($dst$$reg), t0, as_Register($tmp$$reg));\n+  %}\n+\n+  ins_pipe(imul_reg_reg);\n+%}\n+\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":21,"deletions":0,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -1510,0 +1510,26 @@\n+\/\/ MulAddVS2VI\n+\/\/ Vector Multiply-Add Shorts into Integer\n+\/\/ s1[0]*s2[0] + s1[1]*s2[1] => int[0]\n+\n+instruct vmuladdS2I(vReg dst, vReg src1, vReg src2, vReg tmp1, vReg tmp2, vReg tmp3) %{\n+  predicate(Matcher::vector_element_basic_type(n->in(1)) == T_SHORT);\n+  match(Set dst (MulAddVS2VI src1 src2));\n+  effect(TEMP_DEF dst, TEMP tmp1, TEMP tmp2, TEMP tmp3);\n+  format %{ \"vmuladdS2I $dst, $src1, $src2\\t\" %}\n+  ins_encode %{\n+    __ vsetvli_helper(T_INT, Matcher::vector_length(this));\n+\n+    __ vsll_vi(as_VectorRegister($dst$$reg), as_VectorRegister($src1$$reg), 16);\n+    __ vsra_vi(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), 16);\n+    __ vsra_vi(as_VectorRegister($tmp1$$reg), as_VectorRegister($src1$$reg), 16);\n+\n+    __ vsll_vi(as_VectorRegister($tmp2$$reg), as_VectorRegister($src2$$reg), 16);\n+    __ vsra_vi(as_VectorRegister($tmp2$$reg), as_VectorRegister($tmp2$$reg), 16);\n+    __ vsra_vi(as_VectorRegister($tmp3$$reg), as_VectorRegister($src2$$reg), 16);\n+\n+    __ vmul_vv(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), as_VectorRegister($tmp2$$reg));\n+    __ vmacc_vv(as_VectorRegister($dst$$reg), as_VectorRegister($tmp1$$reg), as_VectorRegister($tmp3$$reg));\n+  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":26,"deletions":0,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -103,0 +103,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n@@ -122,0 +125,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n@@ -141,0 +147,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n@@ -158,0 +167,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n@@ -177,0 +189,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n@@ -196,0 +211,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n@@ -215,0 +233,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n@@ -234,0 +255,3 @@\n+    @IR(applyIfPlatform = {\"riscv64\", \"true\"},\n+        applyIfCPUFeature = {\" v \", \"true\"},\n+        counts = {IRNode.MUL_ADD_S2I, \"> 0\", IRNode.MUL_ADD_VS2VI, \"> 0\"})\n","filename":"test\/hotspot\/jtreg\/compiler\/loopopts\/superword\/TestMulAddS2I.java","additions":24,"deletions":0,"binary":false,"changes":24,"status":"modified"}]}