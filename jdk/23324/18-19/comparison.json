{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import java.awt.Color;\n@@ -33,0 +34,2 @@\n+import java.awt.Insets;\n+import java.awt.Rectangle;\n@@ -40,0 +43,2 @@\n+import javax.swing.ButtonModel;\n+import javax.swing.Icon;\n@@ -41,0 +46,1 @@\n+import javax.swing.JMenu;\n@@ -45,0 +51,2 @@\n+import sun.swing.MenuItemLayoutHelper;\n+import sun.swing.SwingUtilities2;\n@@ -67,0 +75,4 @@\n+    private static Color disabledForeground;\n+    private static Color acceleratorSelectionForeground;\n+    private static Color acceleratorForeground;\n+\n@@ -146,0 +158,122 @@\n+    public static void applyInsets(Rectangle rect, Insets insets) {\n+        if(insets != null) {\n+            rect.x += insets.left;\n+            rect.y += insets.top;\n+            rect.width -= (insets.right + rect.x);\n+            rect.height -= (insets.bottom + rect.y);\n+        }\n+    }\n+\n+    public static void paintCheckIcon(Graphics g, MenuItemLayoutHelper lh,\n+                               MenuItemLayoutHelper.LayoutResult lr,\n+                               Color holdc, Color foreground) {\n+        if (lh.getCheckIcon() != null) {\n+            ButtonModel model = lh.getMenuItem().getModel();\n+            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu\n+                    && model.isSelected())) {\n+                g.setColor(foreground);\n+            } else {\n+                g.setColor(holdc);\n+            }\n+            if (lh.useCheckAndArrow()) {\n+                lh.getCheckIcon().paintIcon(lh.getMenuItem(), g,\n+                        lr.getCheckRect().x, lr.getCheckRect().y);\n+            }\n+            g.setColor(holdc);\n+        }\n+    }\n+\n+    public static void paintIcon(Graphics g, MenuItemLayoutHelper lh,\n+                          MenuItemLayoutHelper.LayoutResult lr, Color holdc) {\n+        if (lh.getIcon() != null) {\n+            Icon icon;\n+            ButtonModel model = lh.getMenuItem().getModel();\n+            if (!model.isEnabled()) {\n+                icon = lh.getMenuItem().getDisabledIcon();\n+            } else if (model.isPressed() && model.isArmed()) {\n+                icon = lh.getMenuItem().getPressedIcon();\n+                if (icon == null) {\n+                    \/\/ Use default icon\n+                    icon = lh.getMenuItem().getIcon();\n+                }\n+            } else {\n+                icon = lh.getMenuItem().getIcon();\n+            }\n+\n+            if (icon != null) {\n+                icon.paintIcon(lh.getMenuItem(), g, lr.getIconRect().x,\n+                        lr.getIconRect().y);\n+                g.setColor(holdc);\n+            }\n+        }\n+    }\n+\n+\n+    public static void paintAccText(Graphics g, MenuItemLayoutHelper lh,\n+                             MenuItemLayoutHelper.LayoutResult lr) {\n+        if (!lh.getAccText().isEmpty()) {\n+            ButtonModel model = lh.getMenuItem().getModel();\n+            g.setFont(lh.getAccFontMetrics().getFont());\n+            if (!model.isEnabled()) {\n+\n+                \/\/ *** paint the accText disabled\n+                if (disabledForeground != null) {\n+                    g.setColor(disabledForeground);\n+                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n+                            lh.getAccText(), lr.getAccRect().x,\n+                            lr.getAccRect().y + lh.getAccFontMetrics().getAscent());\n+                } else {\n+                    g.setColor(lh.getMenuItem().getBackground().brighter());\n+                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n+                            lh.getAccText(), lr.getAccRect().x,\n+                            lr.getAccRect().y + lh.getAccFontMetrics().getAscent());\n+                    g.setColor(lh.getMenuItem().getBackground().darker());\n+                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n+                            lh.getAccText(), lr.getAccRect().x - 1,\n+                            lr.getAccRect().y + lh.getFontMetrics().getAscent() - 1);\n+                }\n+            } else {\n+\n+                \/\/ *** paint the accText normally\n+                if (model.isArmed()\n+                        || (lh.getMenuItem() instanceof JMenu\n+                        && model.isSelected())) {\n+                    g.setColor(acceleratorSelectionForeground);\n+                } else {\n+                    g.setColor(acceleratorForeground);\n+                }\n+                SwingUtilities2.drawString(lh.getMenuItem(), g, lh.getAccText(),\n+                        lr.getAccRect().x, lr.getAccRect().y +\n+                                lh.getAccFontMetrics().getAscent());\n+            }\n+        }\n+    }\n+\n+    public static void setDisabledForeground(Color disabledFg) {\n+        disabledForeground = disabledFg;\n+    }\n+\n+    public static void setAcceleratorSelectionForeground(Color acceleratorSelectionFg) {\n+        acceleratorForeground = acceleratorSelectionFg;\n+    }\n+\n+    public static void setAcceleratorForeground(Color acceleratorFg) {\n+        acceleratorForeground = acceleratorFg;\n+    }\n+\n+    public static void paintArrowIcon(Graphics g, MenuItemLayoutHelper lh,\n+                               MenuItemLayoutHelper.LayoutResult lr,\n+                               Color foreground) {\n+        if (lh.getArrowIcon() != null) {\n+            ButtonModel model = lh.getMenuItem().getModel();\n+            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu\n+                    && model.isSelected())) {\n+                g.setColor(foreground);\n+            }\n+            if (lh.useCheckAndArrow()) {\n+                lh.getArrowIcon().paintIcon(lh.getMenuItem(), g,\n+                        lr.getArrowRect().x, lr.getArrowRect().y);\n+            }\n+        }\n+    }\n+\n@@ -255,0 +389,1 @@\n+\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/SwingUtilities3.java","additions":136,"deletions":1,"binary":false,"changes":137,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import com.sun.java.swing.SwingUtilities3;\n@@ -673,21 +674,1 @@\n-        if (lh.getIcon() != null) {\n-            Icon icon;\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            if (!model.isEnabled()) {\n-                icon = lh.getMenuItem().getDisabledIcon();\n-            } else if (model.isPressed() && model.isArmed()) {\n-                icon = lh.getMenuItem().getPressedIcon();\n-                if (icon == null) {\n-                    \/\/ Use default icon\n-                    icon = lh.getMenuItem().getIcon();\n-                }\n-            } else {\n-                icon = lh.getMenuItem().getIcon();\n-            }\n-\n-            if (icon != null) {\n-                icon.paintIcon(lh.getMenuItem(), g, lr.getIconRect().x,\n-                        lr.getIconRect().y);\n-                g.setColor(holdc);\n-            }\n-        }\n+        SwingUtilities3.paintIcon(g, lh, lr, holdc);\n@@ -699,14 +680,13 @@\n-        if (lh.getCheckIcon() != null) {\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu\n-                    && model.isSelected())) {\n-                g.setColor(foreground);\n-            } else {\n-                g.setColor(holdc);\n-            }\n-            if (lh.useCheckAndArrow()) {\n-                lh.getCheckIcon().paintIcon(lh.getMenuItem(), g,\n-                        lr.getCheckRect().x, lr.getCheckRect().y);\n-            }\n-            g.setColor(holdc);\n-        }\n+        SwingUtilities3.paintCheckIcon(g, lh, lr, holdc, foreground);\n+    }\n+\n+    private void setDisabledForeground() {\n+        SwingUtilities3.setDisabledForeground(disabledForeground);\n+    }\n+\n+    private void setAcceleratorSelectionForeground() {\n+        SwingUtilities3.setAcceleratorSelectionForeground(acceleratorSelectionForeground);\n+    }\n+\n+    private void setAcceleratorForeground() {\n+        SwingUtilities3.setAcceleratorForeground(acceleratorForeground);\n@@ -717,34 +697,4 @@\n-        if (!lh.getAccText().isEmpty()) {\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            g.setFont(lh.getAccFontMetrics().getFont());\n-            if (!model.isEnabled()) {\n-                \/\/ *** paint the accText disabled\n-                if (disabledForeground != null) {\n-                    g.setColor(disabledForeground);\n-                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n-                        lh.getAccText(), lr.getAccRect().x,\n-                        lr.getAccRect().y + lh.getAccFontMetrics().getAscent());\n-                } else {\n-                    g.setColor(lh.getMenuItem().getBackground().brighter());\n-                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n-                        lh.getAccText(), lr.getAccRect().x,\n-                        lr.getAccRect().y + lh.getAccFontMetrics().getAscent());\n-                    g.setColor(lh.getMenuItem().getBackground().darker());\n-                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n-                        lh.getAccText(), lr.getAccRect().x - 1,\n-                        lr.getAccRect().y + lh.getFontMetrics().getAscent() - 1);\n-                }\n-            } else {\n-                \/\/ *** paint the accText normally\n-                if (model.isArmed()\n-                        || (lh.getMenuItem() instanceof JMenu\n-                        && model.isSelected())) {\n-                    g.setColor(acceleratorSelectionForeground);\n-                } else {\n-                    g.setColor(acceleratorForeground);\n-                }\n-                SwingUtilities2.drawString(lh.getMenuItem(), g, lh.getAccText(),\n-                        lr.getAccRect().x, lr.getAccRect().y +\n-                        lh.getAccFontMetrics().getAscent());\n-            }\n-        }\n+        setDisabledForeground();\n+        setAcceleratorSelectionForeground();\n+        setAcceleratorForeground();\n+        SwingUtilities3.paintAccText(g, lh, lr);\n@@ -769,11 +719,1 @@\n-        if (lh.getArrowIcon() != null) {\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu\n-                                && model.isSelected())) {\n-                g.setColor(foreground);\n-            }\n-            if (lh.useCheckAndArrow()) {\n-                lh.getArrowIcon().paintIcon(lh.getMenuItem(), g,\n-                        lr.getArrowRect().x, lr.getArrowRect().y);\n-            }\n-        }\n+        SwingUtilities3.paintArrowIcon(g, lh, lr, foreground);\n@@ -783,6 +723,1 @@\n-        if(insets != null) {\n-            rect.x += insets.left;\n-            rect.y += insets.top;\n-            rect.width -= (insets.right + rect.x);\n-            rect.height -= (insets.bottom + rect.y);\n-        }\n+        SwingUtilities3.applyInsets(rect, insets);\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/basic\/BasicMenuItemUI.java","additions":21,"deletions":86,"binary":false,"changes":107,"status":"modified"},{"patch":"@@ -47,0 +47,1 @@\n+import com.sun.java.swing.SwingUtilities3;\n@@ -164,6 +165,1 @@\n-        if(insets != null) {\n-            rect.x += insets.left;\n-            rect.y += insets.top;\n-            rect.width -= (insets.right + rect.x);\n-            rect.height -= (insets.bottom + rect.y);\n-        }\n+        SwingUtilities3.applyInsets(rect, insets);\n@@ -175,14 +171,1 @@\n-        if (lh.getCheckIcon() != null) {\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu\n-                    && model.isSelected())) {\n-                g.setColor(foreground);\n-            } else {\n-                g.setColor(holdc);\n-            }\n-            if (lh.useCheckAndArrow()) {\n-                lh.getCheckIcon().paintIcon(lh.getMenuItem(), g,\n-                        lr.getCheckRect().x, lr.getCheckRect().y);\n-            }\n-            g.setColor(holdc);\n-        }\n+        SwingUtilities3.paintCheckIcon(g, lh, lr, holdc, foreground);\n@@ -193,14 +176,2 @@\n-        if (lh.getIcon() != null) {\n-            Icon icon;\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            if (!model.isEnabled()) {\n-                icon = lh.getMenuItem().getDisabledIcon();\n-            } else if (model.isPressed() && model.isArmed()) {\n-                icon = lh.getMenuItem().getPressedIcon();\n-                if (icon == null) {\n-                    \/\/ Use default icon\n-                    icon = lh.getMenuItem().getIcon();\n-                }\n-            } else {\n-                icon = lh.getMenuItem().getIcon();\n-            }\n+        SwingUtilities3.paintIcon(g, lh, lr, holdc);\n+    }\n@@ -208,6 +179,2 @@\n-            if (icon != null) {\n-                icon.paintIcon(lh.getMenuItem(), g, lr.getIconRect().x,\n-                        lr.getIconRect().y);\n-                g.setColor(holdc);\n-            }\n-        }\n+    private static void setDisabledForeground() {\n+        SwingUtilities3.setDisabledForeground(disabledForeground);\n@@ -216,6 +183,3 @@\n-    private static void paintAccText(Graphics g, MenuItemLayoutHelper lh,\n-                              MenuItemLayoutHelper.LayoutResult lr) {\n-        if (!lh.getAccText().isEmpty()) {\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            g.setFont(lh.getAccFontMetrics().getFont());\n-            if (!model.isEnabled()) {\n+    private static void setAcceleratorSelectionForeground() {\n+        SwingUtilities3.setAcceleratorSelectionForeground(acceleratorSelectionForeground);\n+    }\n@@ -223,17 +187,3 @@\n-                \/\/ *** paint the accText disabled\n-                if (disabledForeground != null) {\n-                    g.setColor(disabledForeground);\n-                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n-                            lh.getAccText(), lr.getAccRect().x,\n-                            lr.getAccRect().y + lh.getAccFontMetrics().getAscent());\n-                } else {\n-                    g.setColor(lh.getMenuItem().getBackground().brighter());\n-                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n-                            lh.getAccText(), lr.getAccRect().x,\n-                            lr.getAccRect().y + lh.getAccFontMetrics().getAscent());\n-                    g.setColor(lh.getMenuItem().getBackground().darker());\n-                    SwingUtilities2.drawString(lh.getMenuItem(), g,\n-                            lh.getAccText(), lr.getAccRect().x - 1,\n-                            lr.getAccRect().y + lh.getFontMetrics().getAscent() - 1);\n-                }\n-            } else {\n+    private static void setAcceleratorForeground() {\n+        SwingUtilities3.setAcceleratorForeground(acceleratorForeground);\n+    }\n@@ -241,13 +191,6 @@\n-                \/\/ *** paint the accText normally\n-                if (model.isArmed()\n-                        || (lh.getMenuItem() instanceof JMenu\n-                        && model.isSelected())) {\n-                    g.setColor(acceleratorSelectionForeground);\n-                } else {\n-                    g.setColor(acceleratorForeground);\n-                }\n-                SwingUtilities2.drawString(lh.getMenuItem(), g, lh.getAccText(),\n-                        lr.getAccRect().x, lr.getAccRect().y +\n-                                lh.getAccFontMetrics().getAscent());\n-            }\n-        }\n+    private static void paintAccText(Graphics g, MenuItemLayoutHelper lh,\n+                              MenuItemLayoutHelper.LayoutResult lr) {\n+        setDisabledForeground();\n+        setAcceleratorSelectionForeground();\n+        setAcceleratorForeground();\n+        SwingUtilities3.paintAccText(g, lh, lr);\n@@ -259,11 +202,1 @@\n-        if (lh.getArrowIcon() != null) {\n-            ButtonModel model = lh.getMenuItem().getModel();\n-            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu\n-                    && model.isSelected())) {\n-                g.setColor(foreground);\n-            }\n-            if (lh.useCheckAndArrow()) {\n-                lh.getArrowIcon().paintIcon(lh.getMenuItem(), g,\n-                        lr.getArrowRect().x, lr.getArrowRect().y);\n-            }\n-        }\n+        SwingUtilities3.paintArrowIcon(g, lh, lr, foreground);\n@@ -285,1 +218,0 @@\n-        return;\n","filename":"src\/java.desktop\/windows\/classes\/com\/sun\/java\/swing\/plaf\/windows\/WindowsMenuItemUI.java","additions":20,"deletions":88,"binary":false,"changes":108,"status":"modified"}]}