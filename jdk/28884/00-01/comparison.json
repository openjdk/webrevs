{"files":[{"patch":"@@ -966,6 +966,1 @@\n-    if (_jni_active_critical-- == 1) {\n-#if INCLUDE_JVMTI\n-      toggle_is_disable_suspend();\n-      assert(!is_disable_suspend(), \"must be\");\n-#endif\n-    }\n+    _jni_active_critical--;\n","filename":"src\/hotspot\/share\/runtime\/javaThread.hpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -192,6 +192,1 @@\n-  if (_jni_active_critical++ == 0) {\n-#if INCLUDE_JVMTI\n-    toggle_is_disable_suspend();\n-    assert(is_disable_suspend(), \"must be\");\n-#endif\n-  }\n+  _jni_active_critical++;\n","filename":"src\/hotspot\/share\/runtime\/javaThread.inline.hpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+#include \"utilities\/spinYield.hpp\"\n@@ -63,0 +64,1 @@\n+    assert(thr != Thread::current(), \"must be\");\n@@ -64,0 +66,10 @@\n+    \/\/ If the target is in a JNI critical region we can't allow it to be suspended\n+    \/\/ as it is not in a safe state. If the critical region never terminates then we\n+    \/\/ hang here. There is no way to time-out and abort the suspend request because\n+    \/\/ the API does not allow for that - if a thread is live then it can be suspended.\n+    if (target->in_critical_atomic()) {\n+      SpinYield sy;\n+      while (target->in_critical_atomic()) {\n+        sy.wait();\n+      }\n+    }\n","filename":"src\/hotspot\/share\/runtime\/suspendResumeManager.cpp","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"}]}