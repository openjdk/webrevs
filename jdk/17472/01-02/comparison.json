{"files":[{"patch":"@@ -28,0 +28,2 @@\n+import jdk.internal.access.SharedSecrets;\n+\n@@ -30,0 +32,1 @@\n+import java.security.AccessControlContext;\n@@ -302,0 +305,1 @@\n+    @SuppressWarnings(\"removal\")\n@@ -303,7 +307,11 @@\n-        @SuppressWarnings(\"removal\")\n-        final Subject s =\n-            AccessController.doPrivileged(new PrivilegedAction<>() {\n-                    public Subject run() {\n-                        return Subject.current();\n-                    }\n-                });\n+        final Subject s;\n+        if (!SharedSecrets.getJavaLangAccess().allowSecurityManager()) {\n+            s = Subject.current();\n+        } else {\n+            AccessControlContext acc = AccessController.getContext();\n+            s = AccessController.doPrivileged(new PrivilegedAction<>() {\n+                        public Subject run() {\n+                            return Subject.getSubject(acc);\n+                        }\n+                    });\n+        }\n","filename":"src\/java.management\/share\/classes\/com\/sun\/jmx\/remote\/security\/MBeanServerFileAccessController.java","additions":15,"deletions":7,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -32,3 +32,3 @@\n- * @run main\/othervm\/timeout=300 -DDEBUG_STANDARD -Dusername=username1 -Dpassword=password1 AuthorizationTest -server -mapType x.access.file;x.password.file -populate -client -mapType credentials\n- * @run main\/othervm\/timeout=300 -DDEBUG_STANDARD -Dusername=username2 -Dpassword=password2 AuthorizationTest -server -mapType x.access.file;x.password.file -populate -client -mapType credentials -expectedCreateException -expectedSetException -expectedInvokeException\n- * @run main\/othervm\/timeout=300 -DDEBUG_STANDARD -Dusername=username6 -Dpassword=password6 AuthorizationTest -server -mapType x.access.file;x.password.file -populate -client -mapType credentials -expectedCreateException -expectedGetException -expectedSetException -expectedInvokeException\n+ * @run main\/othervm\/timeout=300 -Djava.security.manager=allow -DDEBUG_STANDARD -Dusername=username1 -Dpassword=password1 AuthorizationTest -server -mapType x.access.file;x.password.file -populate -client -mapType credentials\n+ * @run main\/othervm\/timeout=300 -Djava.security.manager=allow -DDEBUG_STANDARD -Dusername=username2 -Dpassword=password2 AuthorizationTest -server -mapType x.access.file;x.password.file -populate -client -mapType credentials -expectedCreateException -expectedSetException -expectedInvokeException\n+ * @run main\/othervm\/timeout=300 -Djava.security.manager=allow -DDEBUG_STANDARD -Dusername=username6 -Dpassword=password6 AuthorizationTest -server -mapType x.access.file;x.password.file -populate -client -mapType credentials -expectedCreateException -expectedGetException -expectedSetException -expectedInvokeException\n","filename":"test\/jdk\/javax\/management\/security\/AuthorizationTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}