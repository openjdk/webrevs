{"files":[{"patch":"@@ -111,1 +111,1 @@\n- * <p><b><a id=\"sm-not-allowed\">These methods behave differently depending on\n+ * <p><b><a id=\"sm-allowed\">These methods behave differently depending on\n@@ -114,0 +114,5 @@\n+ * <li>If a security manager is allowed, which means it is either already set\n+ * or allowed to be set dynamically, a {@code Subject} object is associated\n+ * with an {@code AccessControlContext} through a {@code doAs} or\n+ * {@code callAs} call, and the subject can then be retrieved using the\n+ * {@code getSubject(AccessControlContext)} method.\n@@ -121,5 +126,0 @@\n- * <li>If a security manager is allowed, which means it is either already set\n- * or allowed to be set dynamically, a {@code Subject} object is associated\n- * with an {@code AccessControlContext} through a {@code doAs} or\n- * {@code callAs} call, and the subject can then be retrieved using the\n- * {@code getSubject(AccessControlContext)} method.\n@@ -296,3 +296,3 @@\n-     * {@code AccessControlContext}. When a security manager is\n-     * <a href=#sm-not-allowed>not allowed<\/a>, this method is not supported\n-     * and throws an {@code UnsupportedOperationException}.\n+     * {@code AccessControlContext}. This method is intended to be used with\n+     * a security manager. It throws an {@code UnsupportedOperationException}\n+     * if a security manager is not allowed.\n@@ -314,1 +314,1 @@\n-     *          <a href=#sm-not-allowed>not allowed<\/a>\n+     *          not allowed\n@@ -346,1 +346,2 @@\n-            throw new UnsupportedOperationException(\"getSubject is supported only if a security manager is allowed\");\n+            throw new UnsupportedOperationException(\n+                    \"getSubject is supported only if a security manager is allowed\");\n@@ -368,2 +369,2 @@\n-     * <p>\n-     * The current subject is installed by the {@link #callAs} method.\n+     *\n+     * <p> The current subject is installed by the {@link #callAs} method.\n@@ -375,4 +376,3 @@\n-     * <p>\n-     * If a security manager is <a href=#sm-not-allowed>not allowed<\/a>, the\n-     * current subject binds to the period of the execution of the current\n-     * thread. Otherwise, it is associated with the current\n+     *\n+     * <p> If a security manager is <a href=#sm-allowed>allowed<\/a>, this\n+     * method is equivalent to calling {@link #getSubject} with the current\n@@ -381,0 +381,4 @@\n+     * <p> If a security manager is not allowed, this method returns the\n+     * {@code Subject} bound to the period of the execution of the current\n+     * thread.\n+     *\n@@ -399,5 +403,3 @@\n-     * <p> If a security manager is <a href=#sm-not-allowed>not allowed<\/a>,\n-     * this method launches {@code action} and binds {@code subject} to the\n-     * period of its execution.\n-     * <p> Otherwise, this method first retrieves the\n-     * current Thread's {@code AccessControlContext} via\n+     * <p> If a security manager is <a href=#sm-allowed>allowed<\/a>,\n+     * this method first retrieves the current Thread's\n+     * {@code AccessControlContext} via\n@@ -413,0 +415,4 @@\n+     * <p> If a security manager is not allowed,\n+     * this method launches {@code action} and binds {@code subject} to the\n+     * period of its execution.\n+     *\n@@ -453,4 +459,2 @@\n-     * <p> If a security manager is <a href=#sm-not-allowed>not allowed<\/a>,\n-     * this method launches {@code action} and binds {@code subject} to the\n-     * period of its execution.\n-     * <p> Otherwise, this method first retrieves the current Thread's\n+     * <p> If a security manager is <a href=#sm-allowed>allowed<\/a>,\n+     * this method first retrieves the current Thread's\n@@ -467,0 +471,4 @@\n+     * <p> If a security manager is not allowed,\n+     * this method launches {@code action} and binds {@code subject} to the\n+     * period of its execution.\n+     *\n@@ -538,4 +546,2 @@\n-     * <p> If a security manager is <a href=#sm-not-allowed>not allowed<\/a>,\n-     * this method launches {@code action} and binds {@code subject} to the\n-     * period of its execution.\n-     * <p> Otherwise, this method first retrieves the current Thread's\n+     * <p> If a security manager is <a href=#sm-allowed>allowed<\/a>,\n+     * this method first retrieves the current Thread's\n@@ -552,0 +558,4 @@\n+     * <p> If a security manager is not allowed,\n+     * this method launches {@code action} and binds {@code subject} to the\n+     * period of its execution.\n+\n@@ -630,4 +640,2 @@\n-     * <p> If a security manager is <a href=#sm-not-allowed>not allowed<\/a>,\n-     * this method ignores the {@code acc} argument, launches {@code action},\n-     * and binds {@code subject} to the period of its execution.\n-     * <p> Otherwise, this method behaves exactly as {@code Subject.doAs},\n+     * <p> If a security manager is <a href=#sm-allowed>allowed<\/a>,\n+     * this method behaves exactly as {@code Subject.doAs},\n@@ -641,0 +649,4 @@\n+     * <p> If a security manager is not allowed,\n+     * this method ignores the {@code acc} argument, launches {@code action},\n+     * and binds {@code subject} to the period of its execution.\n+     *\n@@ -718,4 +730,2 @@\n-     * <p> If a security manager is <a href=#sm-not-allowed>not allowed<\/a>,\n-     * this method ignores the {@code acc} argument, launches {@code action},\n-     * and binds {@code subject} to the period of its execution.\n-     * <p> Otherwise, this method behaves exactly as {@code Subject.doAs},\n+     * <p> If a security manager is <a href=#sm-allowed>allowed<\/a>,\n+     * this method behaves exactly as {@code Subject.doAs},\n@@ -729,0 +739,4 @@\n+     * <p> If a security manager is not allowed,\n+     * this method ignores the {@code acc} argument, launches {@code action},\n+     * and binds {@code subject} to the period of its execution.\n+     *\n","filename":"src\/java.base\/share\/classes\/javax\/security\/auth\/Subject.java","additions":52,"deletions":38,"binary":false,"changes":90,"status":"modified"},{"patch":"@@ -349,1 +349,1 @@\n-        return Subject.current();\n+        return Subject.getSubject(AccessController.getContext());\n","filename":"src\/java.management\/share\/classes\/com\/sun\/jmx\/remote\/internal\/ServerNotifForwarder.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run main ThreadPoolAccTest\n+ * @run main\/othervm -Djava.security.manager=allow ThreadPoolAccTest\n","filename":"test\/jdk\/javax\/management\/monitor\/ThreadPoolAccTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main NotificationAccessControllerTest\n+ * @run main\/othervm -Djava.security.manager=allow NotificationAccessControllerTest\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/notif\/NotificationAccessControllerTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main NonJMXPrincipalsTest\n+ * @run main\/othervm -Djava.security.manager=allow NonJMXPrincipalsTest\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/passwordAccessFile\/NonJMXPrincipalsTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main RMIAltAuthTest\n+ * @run main\/othervm -Djava.security.manager=allow RMIAltAuthTest\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/passwordAuthenticator\/RMIAltAuthTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main RMIPasswdAuthTest\n+ * @run main\/othervm -Djava.security.manager=allow RMIPasswdAuthTest\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/passwordAuthenticator\/RMIPasswdAuthTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -43,0 +43,2 @@\n+import java.security.AccessControlContext;\n+import java.security.AccessController;\n@@ -153,1 +155,2 @@\n-        Subject subject = Subject.current();\n+        AccessControlContext acc = AccessController.getContext();\n+        Subject subject = Subject.getSubject(acc);\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/passwordAuthenticator\/SimpleStandard.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -43,0 +43,2 @@\n+import java.security.AccessControlContext;\n+import java.security.AccessController;\n@@ -151,1 +153,2 @@\n-        Subject subject = Subject.current();\n+        AccessControlContext acc = AccessController.getContext();\n+        Subject subject = Subject.getSubject(acc);\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/subjectDelegation\/SimpleStandard.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -34,6 +34,6 @@\n- * @run main SubjectDelegation1Test policy11 ok\n- * @run main SubjectDelegation1Test policy12 ko\n- * @run main SubjectDelegation1Test policy13 ko\n- * @run main SubjectDelegation1Test policy14 ko\n- * @run main SubjectDelegation1Test policy15 ok\n- * @run main SubjectDelegation1Test policy16 ko\n+ * @run main\/othervm -Djava.security.manager=allow SubjectDelegation1Test policy11 ok\n+ * @run main\/othervm -Djava.security.manager=allow SubjectDelegation1Test policy12 ko\n+ * @run main\/othervm -Djava.security.manager=allow SubjectDelegation1Test policy13 ko\n+ * @run main\/othervm -Djava.security.manager=allow SubjectDelegation1Test policy14 ko\n+ * @run main\/othervm -Djava.security.manager=allow SubjectDelegation1Test policy15 ok\n+ * @run main\/othervm -Djava.security.manager=allow SubjectDelegation1Test policy16 ko\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/subjectDelegation\/SubjectDelegation1Test.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"}]}