{"files":[{"patch":"@@ -2969,1 +2969,1 @@\n-  return nullptr;\n+  THROW_NULL(vmSymbols::java_lang_UnsupportedOperationException());\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1442,1 +1442,11 @@\n-  Handle thread_h(THREAD, JNIHandles::resolve(jthread));\n+\n+  JavaThread* java_thread = nullptr;\n+  oop thread_oop;\n+  bool has_javathread = tlh.cv_internal_thread_to_JavaThread(jthread, &java_thread, &thread_oop);\n+  assert((has_javathread && thread_oop != nullptr) || !has_javathread, \"Missing Thread oop\");\n+  Handle thread_h(THREAD, thread_oop);\n+  bool is_virtual = java_lang_VirtualThread::is_instance(thread_h());  \/\/ Deals with null\n+\n+  if (!has_javathread && !is_virtual) {\n+    return nullptr; \/\/ thread terminated so not of interest\n+  }\n@@ -1463,2 +1473,0 @@\n-  JavaThread* java_thread = nullptr;\n-  bool is_virtual = java_lang_VirtualThread::is_instance(thread_h());\n","filename":"src\/hotspot\/share\/services\/threadService.cpp","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -180,1 +180,1 @@\n-    private static void dumpThread(Thread thread, TextWriter writer) {\n+    private static boolean dumpThread(Thread thread, TextWriter writer) {\n@@ -182,0 +182,3 @@\n+        if (snapshot == null) {\n+            return false; \/\/ thread terminated\n+        }\n@@ -220,0 +223,1 @@\n+        return true;\n@@ -287,2 +291,3 @@\n-            dumpThread(thread, jsonWriter);\n-            threadCount++;\n+            if (dumpThread(thread, jsonWriter)) {\n+                threadCount++;\n+            }\n@@ -306,0 +311,1 @@\n+     * @return true if the thread dump was written, false otherwise\n@@ -308,1 +314,1 @@\n-    private static void dumpThread(Thread thread, JsonWriter jsonWriter) {\n+    private static boolean dumpThread(Thread thread, JsonWriter jsonWriter) {\n@@ -311,0 +317,3 @@\n+        if (snapshot == null) {\n+            return false; \/\/ thread terminated\n+        }\n@@ -372,0 +381,1 @@\n+        return true;\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/vm\/ThreadDumper.java","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -55,0 +55,2 @@\n+     * Return null if a ThreadSnapshot is not created, for example if the\n+     * thread has terminated.\n@@ -60,1 +62,1 @@\n-            throw new UnsupportedOperationException();\n+            return null; \/\/ thread terminated\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/vm\/ThreadSnapshot.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -171,1 +171,1 @@\n-}\n\\ No newline at end of file\n+}\n","filename":"test\/jdk\/com\/sun\/management\/HotSpotDiagnosticMXBean\/DumpThreadsWithEliminatedLock.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}