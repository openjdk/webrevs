{"files":[{"patch":"@@ -394,0 +394,1 @@\n+      __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodBeforeShl);\n@@ -395,1 +396,0 @@\n-      __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodAfterShX);\n@@ -972,0 +972,1 @@\n+  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodBeforeShl);\n@@ -973,2 +974,0 @@\n-  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodAfterShX);\n-  __ nop(1);\n@@ -978,0 +977,1 @@\n+  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodBeforeShl);\n@@ -979,1 +979,0 @@\n-  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodAfterShX);\n@@ -1282,2 +1281,2 @@\n-  case ZBarrierRelocationFormatLoadGoodAfterShX:\n-    return -1;\n+  case ZBarrierRelocationFormatLoadGoodBeforeShl:\n+    return 3;\n@@ -1304,1 +1303,1 @@\n-  case ZBarrierRelocationFormatLoadGoodAfterShX:\n+  case ZBarrierRelocationFormatLoadGoodBeforeShl:\n@@ -1331,2 +1330,8 @@\n-  if (format == ZBarrierRelocationFormatLoadGoodAfterShX) {\n-    *patch_addr = (uint8_t)value;\n+  if (format == ZBarrierRelocationFormatLoadGoodBeforeShl) {\n+    if (VM_Version::supports_apx_f()) {\n+      NativeInstruction* instruction = nativeInstruction_at(addr);\n+      uint8_t* const rex2_patch_addr = patch_addr + (instruction->has_rex2_prefix() ? 1 : 0);\n+      *rex2_patch_addr = (uint8_t)value;\n+    } else {\n+      *patch_addr = (uint8_t)value;\n+    }\n","filename":"src\/hotspot\/cpu\/x86\/gc\/z\/zBarrierSetAssembler_x86.cpp","additions":14,"deletions":9,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-const int ZBarrierRelocationFormatLoadGoodAfterShX  = 0;\n+const int ZBarrierRelocationFormatLoadGoodBeforeShl = 0;\n","filename":"src\/hotspot\/cpu\/x86\/gc\/z\/zBarrierSetAssembler_x86.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodBeforeShl);\n@@ -39,1 +40,0 @@\n-  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodAfterShX);\n@@ -45,0 +45,1 @@\n+  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodBeforeShl);\n@@ -46,2 +47,0 @@\n-  __ relocate(barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodAfterShX);\n-  __ nop(1);\n","filename":"src\/hotspot\/cpu\/x86\/gc\/z\/z_x86_64.ad","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -224,1 +224,1 @@\n-      _instructions->relocate(pc, barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodAfterShX);\n+      _instructions->relocate(pc, barrier_Relocation::spec(), ZBarrierRelocationFormatLoadGoodBeforeShl);\n","filename":"src\/hotspot\/cpu\/x86\/jvmciCodeInstaller_x86.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}