[{"commit":{"message":"Merge branch 'master' into JDK-8176501"},"files":[],"sha":"c3f26e9dbd025083405d1ae2f0a0ef99260cb936"},{"commit":{"message":"Merge pull request #3 from openjdk\/master\n\nMerge from openjdk\/jdk"},"files":[],"sha":"57346a421446d51192ceada277626ba1ae92d8d7"},{"commit":{"message":"Merge remote-tracking branch 'origin\/master' into JDK-8176501"},"files":[],"sha":"3d1cbc948f7cabd40d5a5b44331a1b5f2bc61bc4"},{"commit":{"message":"Merge pull request #2 from openjdk\/master\n\nMerge openjdk\/jdk"},"files":[],"sha":"333c87c2107262532815db6978c5e8f59c5a967e"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nRenaming \"moveX\"\/\"moveY\" to \"startX\"\/\"startY\" at Laurent's suggestion."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"88346f4df39e06b51f14c25b59e565b13ea4062a"},{"commit":{"message":"Merge branch 'master' into JDK-8176501\n\n# Conflicts:\n#\tsrc\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java\n#\ttest\/jdk\/java\/awt\/geom\/Path2D\/UnitTest.java"},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"5aebb1b7faceb0a47f57e60a4f8e2f971dfcbc58"},{"commit":{"message":"Merge pull request #1 from openjdk\/master\n\nMerge openjdk\/jdk into mickleness\/jdk"},"files":[],"sha":"5dbf0a67ad41a53e03f02c41b1b6364fc3a633ee"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nRestoring original behavior. The \"10_000_000 : 10_000_000\" line should never have been committed."},"files":[{"filename":"test\/jdk\/java\/awt\/geom\/Path2D\/UnitTest.java"}],"sha":"053ab9e3d70aa2543e3fc706ca6eb496f77f0fb4"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nThis resolves occasional unit test failures in java.awt.geom.Path2D.UnitTest. (For ex, see seeds 4603421469924484958L, 4596019360892069260L, 4604586530476373958L, 4603766396818608126L)\n\nThe problem appears to be that the UnitTest class randomly creates PathIterator segments in a way that can place lines\/quads\/cubics immediately after a SEG_CLOSE. That is: after a SEG_CLOSE there was no SEG_MOVETO as new segments followed.\n\nThe previous Path2D#getBounds2D(PathIterator) method assumed each subpath *always* started with a SEG_MOVETO. (I don't know if this is formally stated in a specification anywhere or not?) The unit test failures show this is a bad assumption.\n\nWith this change: when a SEG_CLOSE is encountered: we reset the cursor to the last (moveX, moveY) point. This appears to resolve the unit test failures, which suggests this is consistent with what existing awt.geom classes also do."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"544b5b43e1feb2a11e4e4e600128b83177ee88ab"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nTurn on \"verbose\" mode before running any tests"},"files":[{"filename":"test\/jdk\/java\/awt\/geom\/Path2D\/UnitTest.java"}],"sha":"448745d4ab1598212fc4538a4968a3c7da58b273"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nIsolating 4 test case failures to focus on."},"files":[{"filename":"test\/jdk\/java\/awt\/geom\/Path2D\/UnitTest.java"}],"sha":"c3451775f998f9f1f66a7410028d6df919cd55f8"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nModify the unit test so we log random seeds. Because these unit tests use random numbers: failures can appear randomly. With this commit: we'll log the random seeds so we can easily reproduce specific failures. Also we'll be able to say with certainty if we fixed a failure or not."},"files":[{"filename":"test\/jdk\/java\/awt\/geom\/Path2D\/UnitTest.java"}],"sha":"71688d5fcf7b723663c825c492db988f4388066d"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nThis is a second follow-up response to prrace's code review feedback about method modifiers.\n\nThis commit more carefully preserves the getBounds2D() method modifiers for all 3 classes: the Path2D.Double, the Path2D.Float, and the Path2D itself.\n\nIt is possible (if unlikely) that someone previously extended the Path2D class and overrode getBounds2D(), because the Path2D#getBounds2D() method was *not* final. So with this commit: any such existing code will not break. Meanwhile the subclasses (Double and Float) preserve their previous modifiers (final, synchronized).\n\nThis is in response to prrace's code review:\n\n>    You are changing the signature of public API\n>    src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java\n>    public final synchronized Rectangle2D getBounds2D() => public Rectangle2D getBounds2D() {\n>\n> So no longer final, and no longer synchronized.\n> This means a CSR is required and we need to think about it ..\n> the intention was that the subclass not over-ride.\n> And why remove synchronized ? I am fairly sure it was there to\n> make sure no one was mutating the Path whilst\n> bounds are being calculated.\n> And you are using getPathIterator(AffineTransform) and the docs\n> for that say it isn't thread safe.\n> So I think this implementation needs to be thought about very carefully."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"faeb24198480c94b682617523282daaff55f7fab"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nFixing compilation error now that Path2D#getBounds is not public"},"files":[],"sha":"d79f067d1c8747a83d05fdc2eee2441d747f7bcf"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nFixing unit test failures introduced with b3e84a5e4281c2bb9be1c7e1d751ef3593cc387c .\n\n(The likely explanation for why this went unaddressed previously is: I probably didn't correctly execute unit tests after this change. A less likely explanation might be: the Path2D\/UnitTest class uses random numbers each session, so it's possible results passed in that session and failed in others.)"},"files":[],"sha":"fcf9d3595e280f664f659d5362529d473f0825b6"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAdding missing @param tag.\n\nThis is in response to prrace's code review feedback:\n\n> For me it doesn't build because of a doclint error\n\n> src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java:2102:\n> warning: no @param for pi\n> public static Rectangle2D getBounds2D(final PathIterator pi) {\n> ^\n> error: warnings found and -Werror specified\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#issuecomment-995305817"},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"637c7690f2767858e767c3767a1e8d50b110b380"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nMake the new getBounds2D(PathIterator) method package private.\n\nThis is in response to prrace's code review feedback:\n\n> public static Rectangle2D getBounds2D(final PathIterator pi);\n>\n> Is this really necessary ? It is just for the benefit of the\n> public API caller so can be package private.\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#issuecomment-995305817\n\nPersonally (having written custom java.awt.Shape classes) I think this method would be of general use (so it could be public), but if that's the minority opinion: I'm happy to convert it to package private for now. If we ever want to discuss making it public then that could be a separate PR\/conversation."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"e346df02add585f76b3e17eaf5dca715e27af50f"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nRestore the \"final\" and \"synchronized\" modifiers for this method. I don't think these were removed on purpose; the intent behind this PR is not related to the modifiers of the method.\n\nThis is in response to prrace's code review comment:\n\n> So no longer final, and no longer synchronized.\n> This means a CSR is required and we need to think about it .. the\n> intention was that the subclass not over-ride.\n> And why remove synchronized ? I am fairly sure it was there to make\n> sure no one was mutating the Path whilst bounds are being calculated.\n> And you are using getPathIterator(AffineTransform) and the docs for\n> that say it isn't thread safe.\n> So I think this implementation needs to be thought about very carefully.\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#issuecomment-995305817"},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"2b7a132d8f305f9a9370342b40167763d8cbe856"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAddressing code review feedback: \"Use BigDecomal.setScale(40) to ascertain precision.\"\n\nThe geom.* unit tests passed before & after this change.\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#discussion_r752908494"},"files":[],"sha":"7680533005e34e6e8452426823427d89e4bf325d"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAddressing code review feedback: \"I would prefer having accumulate functions called twice (using offset)\"\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#issuecomment-970040098"},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"b3e84a5e4281c2bb9be1c7e1d751ef3593cc387c"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nThis is broadly addresses the code review feedback: \"I see many duplicated lines\". This commit does NOT include \"the previous unified solution\" that is also mentioned... so we'll try this on and see how we feel about it.\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#issuecomment-964020449"},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"0e2b52931bf0f3abc5b454f45be18e4aa9301335"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nApplying Laurent's implementation to address machine error.\n\nSee https:\/\/github.com\/openjdk\/jdk\/pull\/6227#discussion_r749672090"},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"8c5e772ec9623352c59fd9dfc2622ac1dd2fd02d"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nThis adds a new unit test that calculates a high-precision bounding box (using BigDecimals), and then makes sure our double-based logic contains that high-precision bounds.\n\nThis restores getBounds2D() to its original contract: it should only ever be *larger* than the actual bounds -- it should never be smaller.\n\nAlso we want to only apply this margin (aka \"padding\") when we deal with polynomial-based extrema. We should never apply it to line-based polygons. For ex: a Path2D that represents an int-based rectangle should return the same bounds as before 8176501 was addressed.\n\nThis test currently only addresses very small cubic curves.\n\nI experimented with very large cubic & quadratic curves, but I didn't come up with a unit test that failed before and after this commit. Adding unit tests for large curve segments is a possible area of improvement."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"40bda064f1e6ed81817dcc9bcbf33f325924f259"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAddressing code review comments: given current code structure we don't need separate data structures for x and y equations."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"af4c5f03b7c9687cde53ea6c3770846bbfcc8fbc"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nRemoving accidental leftover code. This should have been removed in a recent previous commit. The preceding code already defines these values."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"8db26a255d21584fd3f4462064d06f4e216f0f72"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nThis adds an exploratory algorithm that tries to identify how to expand the double-based bounding box. It is currently problematic, but I'm committing it for review\/feedback. Maybe this will look like a familiar problem to someone more familiar with this subject? Once we settle on how to address machine error: I'll either adapt this file into a more proper unit test or delete it.\n\nThis is an attempt to explore Laurent's comments here:\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#discussion_r746450132\n\nThe problem is our double-based approach can be a little bit too small because of machine error. We need it to only ever err on the side of being too large.\n\nCurrently in this class we're applying a `margin` as follows:\n```\n       double x = coeff[0] + t * (coeff[1] + t * coeff[2]);\n       double margin = marginMultiplier * Math.ulp(x);\n       if (x - margin < leftX) leftX = x - margin;\n       if (x + margin> rightX) rightX = x + margin;\n```\n\nThis class tests a million shapes and tries to identify the smallest constant `marginMultiplier` that always returns an appropriate bounding box.\n\nThe current problem is this constant is multiplied by the ulp of a value. So as the value (for ex: the left x-value) approaches zero the ulp becomes increasingly small, so the multiplier has to become extremely large. Currently this algorithm settles on a multiplier of: 7.864956084850002E10\n\nIf we treat the constant as a multiplier of the x-value itself (for ex: `margin = multiplier * Math.abs(x)``), then this algorithm settles on 0.000013173867835580114.\n\nWhat is a good way to evaluate `margin` in the code snippet above?\n\nOr at some point we could switch back to using the bezier control point: what fuzzy sliding scale logic do we use to determine when to use \"the old way\" and when to use \"the new way\"?"},"files":[],"sha":"4b9d87d6d03e923bb2663fc8f4f77b7549df6e70"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAddressing code review recommendation to calculate polynomial coefficients using differences \/ vector notation.\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/6227#discussion_r743534560\n\nI generally understand the intention of this change, but I don't know exactly how to test\/evaluate it.\n\nThe unit tests still pass. I ran some sample calculations involving a 100x100 Ellipse2D as it was rotated, and the two getBounds2D(..) implementations (before and after this commit) only differed by a few ulps (usually around 10^-15), as expected."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"b7ca69c85b1270af415d66db68c1c286e1e0d751"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAddressing code review recommendation to copy javafx's optimization: we can avoid looking at the derivative and polynomial if the control points are inside our existing bounds. This involved refactoring the method getBounds2D(PathIterator) more generally. It should now be a little more efficient (and perhaps a little less readable). Since we don't have concrete performance or readability goals this is a subjective trade-off that's hard to assess."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"e617c7229da285a00e108a62a22b997b48afe372"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAddressing more of Laurent's code review recommendations\/comments:\n\n1. solve the quadratic equation using QuadCurve2d.solveQuadratic() or like Helpers.quadraticRoots()\n\n(I was pleasantly surprised to see QuadCurve2D.solveQuadratic(..) does well for the unit test where the t^2 coefficient approaches zero. We still get an extra root, but it's greater than 10^13, so it is ignored by our (0,1) bounds check later.)\n\n2. determine the derivatives da \/ db\n\nWe now define x_deriv_coeff and y_deriv_coeff.\n\n3. remove the label pathIteratorLoop\n\n4. use `for (final PathIterator it = shape.getPathIterator(null); !it.isDone(); it.next()) {`\n\n(The initial statement is empty in this case because PathIterator is an argument.)\n\n5. make arrays final to be obvious\n\n6. add a shortcut test for better readability \/ close the shortcut test\n\n7. after computing coefficients (abcd), also compute (da db c) needed by root finding next\n\n8. useless with the shortcut test (re \"definedParametricEquations\" boolean)\n\n9. use if (t > 0.0 && t < 1.0)\n\n(Sorry, that got lost in the prev refactor.)\n\n10. add explicitely the SEG_CLOSE case (skip = continue) before the default case\n\nThis commit does not address comments about accuracy\/precision. I'll explore those separately later."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"410cd6ce0f25f4425803e8b61d10a0b85e86929e"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nAddressing some of Laurent's code review recommendations\/comments:\n\n1. use the convention t for the parametric variable x(t),y(t)\n2. solve the quadratic equation using QuadCurve2d.solveQuadratic() or like Helpers.quadraticRoots()\n3. always use braces for x = (a < b) ? ...\n4. always use double-precision constants in math or logical operations: (2 * x => 2.0 * x) and (coefficients[3] != 0) => (coefficients[3] != 0.0)\n\n(There are two additional recommendations not in this commit that I'll ask about shortly.)\n\nSee https:\/\/github.com\/openjdk\/jdk\/pull\/6227#issuecomment-959757954"},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"}],"sha":"5a0e2bd0f4ea36d877d087a1c7dd9ff1be684155"},{"commit":{"message":"8176501: Method Shape.getBounds2D() incorrectly includes Bezier control points in bounding box\n\nThe bug writeup indicated they wanted Path2D#getBounds2D() to be more accurate\/concise. They didn't explicitly say they wanted CubicCurve2D and QuadCurve2D to become more accurate too. But a preexisting unit test failed when Path2D#getBounds2D() was updated and those other classes weren't. At this point I considered either:\nA. Updating CubicCurve2D and QuadCurve2D to use the new more accurate getBounds2D() or\nB. Updating the unit test to forgive the discrepancy.\n\nI chose A. Which might technically be seen as scope creep, but it feels like a more holistic\/better approach.\n\nThis also includes a new unit test (in Path2D\/UnitTest.java) that fails without the changes in this commit."},"files":[{"filename":"src\/java.desktop\/share\/classes\/java\/awt\/geom\/Path2D.java"},{"filename":"test\/jdk\/java\/awt\/geom\/Path2D\/UnitTest.java"}],"sha":"0da9594d0c2349b24a635da23f1b81011c6139f3"}]