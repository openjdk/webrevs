{"files":[{"patch":"@@ -477,1 +477,2 @@\n-    \/\/ the future, this code will need to be re-examined.\n+    \/\/ the future, this code will need to be re-examined; see check in\n+    \/\/ ShenandoahCardBarrier::on_slowpath_allocation_exit().\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c2\/shenandoahBarrierSetC2.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -91,0 +91,8 @@\n+void ShenandoahBarrierSet::on_slowpath_allocation_exit(JavaThread* thread, oop new_obj) {\n+#if COMPILER2_OR_JVMCI\n+  assert(!(ReduceInitialCardMarks && ShenandoahCardBarrier) || ShenandoahGenerationalHeap::heap()->is_in_young(new_obj),\n+         \"Error: losing card mark on initialzing store to old gen\");\n+#endif \/\/ COMPILER2_OR_JVMCI\n+  assert(thread->deferred_card_mark().is_empty(), \"We don't use this\");\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.cpp","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -80,1 +80,1 @@\n-  void print_on(outputStream* st) const;\n+  void print_on(outputStream* st) const override;\n@@ -87,4 +87,8 @@\n-  virtual void on_thread_create(Thread* thread);\n-  virtual void on_thread_destroy(Thread* thread);\n-  virtual void on_thread_attach(Thread* thread);\n-  virtual void on_thread_detach(Thread* thread);\n+  \/\/ Support for optimizing compilers to call the barrier set on slow path allocations\n+  \/\/ that did not enter a TLAB. Used for e.g. ReduceInitialCardMarks to take any\n+  \/\/ compensating actions to restore card-marks that might otherwise be incorrectly elided.\n+  void on_slowpath_allocation_exit(JavaThread* thread, oop new_obj) override;\n+  void on_thread_create(Thread* thread) override;\n+  void on_thread_destroy(Thread* thread) override;\n+  void on_thread_attach(Thread* thread) override;\n+  void on_thread_detach(Thread* thread) override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.hpp","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"}]}