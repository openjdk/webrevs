{"files":[{"patch":"@@ -39,5 +39,1 @@\n-import java.security.cert.Certificate;\n-import java.security.cert.CertificateExpiredException;\n-import java.security.cert.CertificateNotYetValidException;\n-import java.security.cert.X509Certificate;\n-import java.util.Date;\n+import java.security.cert.*;\n@@ -254,1 +250,0 @@\n-    \/\/ Exception list to 90 days expiry policy\n@@ -274,3 +269,0 @@\n-    \/\/ Ninety days in milliseconds\n-    private static final long NINETY_DAYS = 7776000000L;\n-\n@@ -283,1 +275,0 @@\n-        md = MessageDigest.getInstance(\"SHA-256\");\n@@ -285,0 +276,2 @@\n+        \/\/ verify integrity of cacerts\n+        md = MessageDigest.getInstance(\"SHA-256\");\n@@ -289,2 +282,2 @@\n-            System.err.println(\"ERROR: wrong checksum\\n\" + checksum);\n-            System.err.println(\"Expected checksum\\n\" + CHECKSUM);\n+            System.err.println(\"ERROR: wrong checksum\" + checksum);\n+            System.err.println(\"Expected checksum\" + CHECKSUM);\n@@ -303,0 +296,9 @@\n+        System.out.println(\"Trusted CA Certificate count: \" + ks.size());\n+\n+        \/\/ also ensure FINGERPRINT_MAP lists correct count\n+        if(FINGERPRINT_MAP.size() != COUNT) {\n+            atLeastOneFailed = true;\n+            System.err.println(\"ERROR: \" + FINGERPRINT_MAP.size()\n+                    + \" FINGERPRINT_MAP entries, should be \" + COUNT);\n+        }\n+\n@@ -316,1 +318,3 @@\n-            System.out.println(\"\\nVerifying \" + alias);\n+            System.out.println(\"Verifying \" + alias);\n+\n+            \/\/ Is cert trusted?\n@@ -319,2 +323,1 @@\n-                System.err.println(\"ERROR: \" + alias\n-                        + \" is not a trusted cert entry\");\n+                System.err.println(\"ERROR: \" + alias + \" is not a trusted cert entry\");\n@@ -322,0 +325,2 @@\n+\n+            \/\/ Does fingerprint match?\n@@ -327,1 +332,2 @@\n-            \/\/ Make sure cert can be self-verified\n+\n+            \/\/ Can cert be self-verified?\n@@ -332,2 +338,1 @@\n-                System.err.println(\"ERROR: cert cannot be verified:\"\n-                        + e.getMessage());\n+                System.err.println(\"ERROR: cert cannot be verified:\" + e.getMessage());\n@@ -336,1 +341,1 @@\n-            \/\/ Make sure cert is not expired or not yet valid\n+            \/\/ Is cert expired?\n@@ -342,1 +347,1 @@\n-                    System.err.println(\"ERROR: cert is expired\");\n+                    System.err.println(\"ERROR: cert is expired but not in EXPIRY_EXC_ENTRIES\");\n@@ -348,11 +353,0 @@\n-\n-            \/\/ If cert is within 90 days of expiring, mark as failure so\n-            \/\/ that cert can be scheduled to be removed\/renewed.\n-            Date notAfter = cert.getNotAfter();\n-            if (notAfter.getTime() - System.currentTimeMillis() < NINETY_DAYS) {\n-                if (!EXPIRY_EXC_ENTRIES.contains(alias)) {\n-                    atLeastOneFailed = true;\n-                    System.err.println(\"ERROR: cert \\\"\" + alias + \"\\\" expiry \\\"\"\n-                            + notAfter.toString() + \"\\\" will expire within 90 days\");\n-                }\n-            }\n@@ -362,1 +356,1 @@\n-            throw new Exception(\"At least one cacert test failed\");\n+            throw new RuntimeException(\"At least one cacert test failed\");\n@@ -367,1 +361,1 @@\n-            throws Exception {\n+            throws CertificateEncodingException {\n@@ -371,1 +365,1 @@\n-            return true;\n+            return false;\n@@ -373,1 +367,0 @@\n-        System.out.println(\"Checking fingerprint of \" + alias);\n@@ -377,1 +370,0 @@\n-\n","filename":"test\/jdk\/sun\/security\/lib\/cacerts\/VerifyCACerts.java","additions":28,"deletions":36,"binary":false,"changes":64,"status":"modified"}]}