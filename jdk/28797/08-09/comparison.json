{"files":[{"patch":"@@ -1263,2 +1263,5 @@\n-                a[(m = cap - 1) & s] = task;\n-                if (!internal)\n+                long pos = slotOffset((m = cap - 1) & s);\n+                if (internal)\n+                    U.getAndSetReference(a, pos, task); \/\/ fully fenced\n+                else {\n+                    U.putReference(a, pos, task);       \/\/ inside lock\n@@ -1266,0 +1269,1 @@\n+                }\n@@ -2028,4 +2032,2 @@\n-                                    q.base = nb;\n-                                    U.storeFence();\n-                                    rescans = 1;\n-                                    if (taken++ == 0 || qid != src)\n+                                    q.updateBase(nb);\n+                                    if (qid != src)\n@@ -2033,0 +2035,2 @@\n+                                    rescans = 1;\n+                                    ++taken;\n@@ -2047,1 +2051,1 @@\n-                else if (awaitWork(w) == 0)\n+                else if (awaitWork(w) == 0) {\n@@ -2049,0 +2053,2 @@\n+                    src = -1;\n+                }\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"}]}