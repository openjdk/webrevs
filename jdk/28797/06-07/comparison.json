{"files":[{"patch":"@@ -1259,4 +1259,5 @@\n-            int size = s - base + 1, m;\n-            if (((a != null && a.length > size) || (a = growArray(a, s)) != null) &&\n-                (m = a.length - 1) >= 0) {\n-                a[m & s] = task;\n+            int size = s - base + 1, room, cap, m;\n+            if (a != null &&\n+                ((room = a.length - size) > 0 || (a = growArray(s)) != null) &&\n+                (cap = a.length) > 0) {\n+                a[(m = cap - 1) & s] = task;\n@@ -1265,2 +1266,2 @@\n-                if (U.getReferenceAcquire(a, slotOffset(m & (s - 1))) == null &&\n-                    pool != null)\n+                if ((U.getReferenceAcquire(a, slotOffset(m & (s - 1))) == null ||\n+                     room <= 0) && pool != null)\n@@ -1273,2 +1274,1 @@\n-         * @param a old array\n-         * @param s current top\n+         * @param s current (in-progress) top\n@@ -1277,3 +1277,3 @@\n-        private ForkJoinTask<?>[] growArray(ForkJoinTask<?>[] a, int s) {\n-            int cap, newCap;\n-            if (a != null && (cap = a.length) > 0 &&\n+        private ForkJoinTask<?>[] growArray(int s) {\n+            ForkJoinTask<?>[] a; int cap, newCap;\n+            if ((a = array) != null && (cap = a.length) > 0 &&\n@@ -2029,1 +2029,1 @@\n-                                    Object nt = U.getReferenceAcquire(a, np);\n+                                    U.storeFence();\n@@ -2033,1 +2033,1 @@\n-                                    if (nt != null && q.base == nb)\n+                                    if (U.getReferenceAcquire(a, np) != null)\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"}]}