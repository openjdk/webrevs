{"files":[{"patch":"@@ -1258,1 +1258,2 @@\n-                U.putReferenceVolatile(a, slotOffset(m & s), task);\n+                U.getAndSetReference(a, slotOffset(m & s), task);\n+                Object pred = U.getReferenceAcquire(a, slotOffset(m & (s - 1)));\n@@ -1260,3 +1261,2 @@\n-                    U.putInt(this, PHASE, unlock);\n-                if (U.getReferenceAcquire(a, slotOffset(m & (s - 1))) == null &&\n-                    pool != null)\n+                    phase = unlock;\n+                if (pred == null && pool != null)\n@@ -1319,1 +1319,1 @@\n-                             a, slotOffset((cap - 1) & s), null)) != null)\n+                             a, slotOffset((cap - 1) & s), null)) != null) {\n@@ -1321,0 +1321,2 @@\n+                        U.storeFence();\n+                    }\n@@ -1326,0 +1328,1 @@\n+                            U.storeFence();\n@@ -1342,4 +1345,1 @@\n-            U.loadFence();  \/\/ ensure ordering for external callers\n-            ForkJoinTask<?> t = nextLocalTask(config & FIFO);\n-            U.storeFence();\n-            return t;\n+            return nextLocalTask(config & FIFO);\n@@ -1362,1 +1362,2 @@\n-                    U.putIntOpaque(this, TOP, s);\n+                    top = s;\n+                    U.storeFence();\n@@ -1374,1 +1375,0 @@\n-            U.loadFence();  \/\/ ensure ordering for external callers\n@@ -1395,1 +1395,0 @@\n-            U.loadFence();  \/\/ ensure ordering for external callers\n@@ -1413,1 +1412,2 @@\n-                    U.putIntVolatile(this, BASE, nb);\n+                    base = nb;\n+                    U.storeFence();\n@@ -1511,2 +1511,4 @@\n-                         U.compareAndSetReference(a, k, t, null)))\n-                        U.putIntOpaque(this, TOP, s);\n+                         U.compareAndSetReference(a, k, t, null))) {\n+                        top = s;\n+                        U.storeFence();\n+                    }\n@@ -1550,0 +1552,1 @@\n+                    U.storeFence();\n@@ -2377,0 +2380,1 @@\n+                                        U.storeFence();\n@@ -2802,0 +2806,1 @@\n+                        U.storeFence();\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":20,"deletions":15,"binary":false,"changes":35,"status":"modified"}]}