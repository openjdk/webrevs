{"files":[{"patch":"@@ -47,1 +47,1 @@\n-public class DigestConformance {\n+public class MLDSADigestConformance {\n","filename":"test\/jdk\/sun\/security\/pkcs\/pkcs7\/MLDSADigestConformance.java","additions":1,"deletions":1,"binary":false,"changes":2,"previous_filename":"test\/jdk\/sun\/security\/pkcs\/pkcs7\/DigestConformance.java","status":"renamed"},{"patch":"@@ -48,1 +48,5 @@\n-        \/\/ See https:\/\/datatracker.ietf.org\/doc\/html\/rfc9882#name-examples\n+        \/\/ See RFC 9882, Section \"Examples\": https:\/\/datatracker.ietf.org\/doc\/html\/rfc9882#name-examples\n+        \/\/ The test vectors originate from the following GitHub releases:\n+        \/\/   https:\/\/github.com\/lamps-wg\/cms-ml-dsa\/releases\/tag\/draft-ietf-lamps-cms-ml-dsa-07\n+        \/\/   https:\/\/github.com\/lamps-wg\/dilithium-certificates\/releases\/tag\/draft-ietf-lamps-dilithium-certificates-13\n+        \/\/ Although the release tags include \"draft\", these values are the same as those in the final RFC 9882.\n","filename":"test\/jdk\/sun\/security\/provider\/pqc\/ML_DSA_CMS.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+import jdk.test.lib.process.Proc;\n@@ -42,0 +43,1 @@\n+import java.nio.file.Paths;\n@@ -52,3 +54,19 @@\n-        prepare();\n-        testAPI();\n-        testTool(); \/\/ call this last, it modified a.jar.\n+        if (args.length > 0) {\n+            \/\/ Launched by testDisabled() in a sub-process to count signers\n+            var expectedCount = Integer.parseInt(args[0]);\n+            try (var jf = new JarFile(\"a.jar\")) {\n+                var je = jf.getJarEntry(\"a\");\n+                jf.getInputStream(je).readAllBytes();\n+                var signers = je.getCodeSigners();\n+                var count = signers == null ? 0 : signers.length;\n+                if (expectedCount != count) {\n+                    throw new RuntimeException(\"Expected: \" + expectedCount\n+                            + \", actual \" + count);\n+                }\n+            }\n+        } else {\n+            prepare();\n+            testAPI();\n+            testTool(); \/\/ call this last, it modified a.jar.\n+            testDisabled();\n+        }\n@@ -80,1 +98,1 @@\n-                Asserts.assertEquals(1, je.getCertificates().length);\n+                Asserts.assertEquals(1, je.getCodeSigners().length);\n@@ -98,1 +116,1 @@\n-            Asserts.assertEquals(3, je.getCertificates().length);\n+            Asserts.assertEquals(3, je.getCodeSigners().length);\n@@ -105,0 +123,43 @@\n+    static void testDisabled() throws Exception {\n+\n+        \/\/ All disabled\n+        Files.writeString(Paths.get(\"my.security\"),\n+                \"jdk.jar.disabledAlgorithms=ML-DSA\");\n+        SecurityTools.jarsigner(\"-J-Djava.security.properties=my.security\" +\n+                        \" -keystore ks -storepass changeit\" +\n+                        \" -verify a.jar -verbose -certs -strict\")\n+                .shouldHaveExitValue(16)\n+                .shouldContain(\"ML-DSA-44 key (disabled)\")\n+                .shouldContain(\"ML-DSA-65 key (disabled)\")\n+                .shouldContain(\"ML-DSA-87 key (disabled)\")\n+                .shouldContain(\"The jar will be treated as unsigned\");\n+        \/\/ Need to launch in a new process because security property is\n+        \/\/ read at the beginning\n+        Proc.create(\"ML_DSA\")\n+                .secprop(\"jdk.jar.disabledAlgorithms\", \"ML-DSA\")\n+                .args(\"0\")\n+                .start()\n+                .waitFor(0);\n+\n+        \/\/ One disabled, one made weak\n+        Files.writeString(Paths.get(\"my.security\"), \"\"\"\n+                        jdk.jar.disabledAlgorithms=ML-DSA-44\n+                        jdk.security.legacyAlgorithms=ML-DSA-65\n+                        \"\"\");\n+        SecurityTools.jarsigner(\"-J-Djava.security.properties=my.security\" +\n+                        \" -keystore ks -storepass changeit\" +\n+                        \" -verify a.jar -verbose -certs -strict\")\n+                .shouldHaveExitValue(0)\n+                .shouldContain(\"ML-DSA-44 key (disabled)\")\n+                .shouldContain(\"ML-DSA-65 key (weak)\")\n+                .shouldContain(\"ML-DSA-87 key\")\n+                .shouldNotContain(\"ML-DSA-87 key (disabled)\")\n+                .shouldContain(\"jar verified.\");\n+        Proc.create(\"ML_DSA\")\n+                .secprop(\"jdk.jar.disabledAlgorithms\", \"ML-DSA-44\")\n+                .secprop(\"jdk.security.legacyAlgorithms\", \"ML-DSA-65\")\n+                .args(\"2\") \/\/ weak still considered signer, disabled not\n+                .start()\n+                .waitFor(0);\n+    }\n+\n","filename":"test\/jdk\/sun\/security\/tools\/jarsigner\/ML_DSA.java","additions":66,"deletions":5,"binary":false,"changes":71,"status":"modified"}]}