{"files":[{"patch":"@@ -87,1 +87,2 @@\n-      log_error(attach)(\"could not open (%d) pipe %s\", GetLastError(), pipe);\n+      log_error(attach)(\"could not open %s (%d) pipe %s\",\n+                        (write_only ? \"write-only\" : \"read-write\"), GetLastError(), pipe);\n@@ -109,1 +110,5 @@\n-    return fSuccess ? (int)nread : -1;\n+    if (!fSuccess) {\n+      log_error(attach)(\"pipe read error (%d)\", GetLastError());\n+      return -1;\n+    }\n+    return (int)nread;\n@@ -121,1 +126,5 @@\n-    return fSuccess ? (int)written : -1;\n+    if (!fSuccess) {\n+        log_error(attach)(\"pipe write error (%d)\", GetLastError());\n+        return -1;\n+    }\n+    return (int)written;\n@@ -141,2 +150,2 @@\n-  void open_pipe(const char* pipe_name, bool write_only) {\n-    _pipe.open(pipe_name, write_only);\n+  bool open_pipe(const char* pipe_name, bool write_only) {\n+    return _pipe.open(pipe_name, write_only);\n@@ -146,1 +155,1 @@\n-      return AttachOperation::read_request(&_pipe);\n+    return AttachOperation::read_request(&_pipe);\n@@ -393,1 +402,5 @@\n-        op->open_pipe(request->pipe(), true\/*write-only*\/);\n+        if (!op->open_pipe(request->pipe(), true\/*write-only*\/)) {\n+          \/\/ error is already logged\n+          delete op;\n+          op = nullptr;\n+        }\n@@ -397,3 +410,3 @@\n-        op->open_pipe(request->pipe(), false\/*write-only*\/);\n-        if (!op->read_request()) {\n-          log_error(attach)(\"AttachListener::dequeue, reading request ERROR\");\n+        if (!op->open_pipe(request->pipe(), false\/*write-only*\/)\n+            || !op->read_request()) {\n+          \/\/ error is already logged\n","filename":"src\/hotspot\/os\/windows\/attachListener_windows.cpp","additions":23,"deletions":10,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -631,1 +631,1 @@\n-  case ATTACH_API_V2: \/\/ <ver>0<size>0<cmd>0<arg>0<arg>0<arg>0\n+  case ATTACH_API_V2: \/\/ <ver>0<size>0<cmd>0(<arg>0)* (any number of arguments)\n@@ -633,1 +633,1 @@\n-        log_error(attach)(\"Failed to read request: v2 is unsupported ot disabled\");\n+        log_error(attach)(\"Failed to read request: v2 is unsupported or disabled\");\n@@ -640,0 +640,1 @@\n+      log_error(attach)(\"Failed to read request: negative request size (%d)\", buffer_size);\n@@ -649,1 +650,1 @@\n-    \/\/ Must contain exact 'buffer_size' bytes.\n+    \/\/ Must contain exactly 'buffer_size' bytes.\n","filename":"src\/hotspot\/share\/services\/attachListener.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"}]}