{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,1 +51,0 @@\n-    private static Frame f;\n@@ -53,0 +52,2 @@\n+    private static volatile int batchStart;\n+    private static volatile int batchEnd;\n@@ -61,30 +62,0 @@\n-        try {\n-            EventQueue.invokeAndWait(() -> {\n-                createAndShowUI();\n-            });\n-            robot.delay(1000);\n-            System.out.println(\"frames.length: \"+frames.length);\n-            for (index = 0; index < frames.length; index++) {\n-                EventQueue.invokeAndWait(() -> {\n-                    p = frames[index].getLocation();\n-                    d = frames[index].getSize();\n-                });\n-                Rectangle rect = new Rectangle(p, d);\n-                BufferedImage img = robot.createScreenCapture(rect);\n-                if (chkImgBackgroundColor(img)) {\n-                    try {\n-                        ImageIO.write(img, \"png\", new File(\"Frame_\" + index + \".png\"));\n-                    } catch (IOException ignored) {}\n-                    throw new RuntimeException(\"Frame visual test failed with non-white background color\");\n-                }\n-            }\n-        } finally {\n-            for (index = 0; index < frames.length; index++) {\n-                EventQueue.invokeAndWait(() -> {\n-                    if (frames[index] != null) {\n-                        frames[index].dispose();\n-                    }\n-                });\n-            }\n-        }\n-    }\n@@ -92,1 +63,0 @@\n-    private static void createAndShowUI() {\n@@ -94,6 +64,50 @@\n-        for (int i = 0; i < frames.length; i++) {\n-            frames[i] = new Frame(\"Frame w\/ gc \" + i, gcs[i]);\n-            frames[i].setSize(100, 100);\n-            frames[i].setUndecorated(true);\n-            frames[i].setBackground(Color.WHITE);\n-            frames[i].setVisible(true);\n+        System.out.println(\"frames.length: \" + frames.length);\n+\n+        \/\/ Iterate through gcs in batches of 20\n+        for (int i = 0; i < frames.length; i += 20) {\n+            try {\n+                batchEnd = Math.min(i + 20, frames.length);\n+                batchStart = i;\n+\n+                for (int j = i; j < batchEnd; j++) {\n+                    int finalJ = j;\n+                    EventQueue.invokeAndWait(() -> {\n+                        frames[finalJ] = new Frame(\"Frame w\/ gc \"\n+                                + finalJ, gcs[finalJ]);\n+                        frames[finalJ].setSize(100, 100);\n+                        frames[finalJ].setUndecorated(true);\n+                        frames[finalJ].setBackground(Color.WHITE);\n+                        frames[finalJ].setVisible(true);\n+                    });\n+\n+                    robot.delay(1000);\n+\n+                    for (index = i; index < batchEnd; index++) {\n+                        int finalIndex = index;\n+                        EventQueue.invokeAndWait(() -> {\n+                            p = frames[finalIndex].getLocation();\n+                            d = frames[finalIndex].getSize();\n+                        });\n+                        Rectangle rect = new Rectangle(p, d);\n+                        BufferedImage img = robot.createScreenCapture(rect);\n+                        if (chkImgBackgroundColor(img)) {\n+                            try {\n+                                ImageIO.write(img, \"png\",\n+                                        new File(\"Frame_\"\n+                                                + finalIndex + \".png\"));\n+                            } catch (IOException ignored) {}\n+                            throw new RuntimeException(\"Frame visual test \" +\n+                                    \"failed with non-white background color\");\n+                        }\n+                    }\n+                }\n+            } finally {\n+                \/\/ Dispose batch of frames\n+                for (index = batchStart; index < batchEnd; index++) {\n+                    EventQueue.invokeAndWait(() -> {\n+                        if (frames[index] != null) {\n+                            frames[index].dispose();\n+                        }\n+                    });\n+                }\n+            }\n@@ -104,1 +118,0 @@\n-\n","filename":"test\/jdk\/java\/awt\/Frame\/FrameVisualTest.java","additions":53,"deletions":40,"binary":false,"changes":93,"status":"modified"}]}