{"files":[{"patch":"@@ -49,1 +49,0 @@\n-    private static volatile int index;\n@@ -52,2 +51,0 @@\n-    private static volatile int batchStart;\n-    private static volatile int batchEnd;\n@@ -58,0 +55,1 @@\n+    private static final int MAX_FRAME_COUNT = 30;\n@@ -60,1 +58,2 @@\n-        gcs = GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice().getConfigurations();\n+        gcs = GraphicsEnvironment.getLocalGraphicsEnvironment()\n+                .getDefaultScreenDevice().getConfigurations();\n@@ -64,2 +63,8 @@\n-        frames = new Frame[gcs.length];\n-        System.out.println(\"frames.length: \" + frames.length);\n+        \/\/ Limit the number of frames tested if needed\n+        if (gcs.length > MAX_FRAME_COUNT) {\n+            frames = new Frame[MAX_FRAME_COUNT];\n+        } else {\n+            frames = new Frame[gcs.length];\n+        }\n+        System.out.println(gcs.length + \" gcs found. Testing \"\n+                + frames.length + \" frame(s).\");\n@@ -67,2 +72,1 @@\n-        \/\/ Iterate through gcs in batches of 20\n-        for (int i = 0; i < frames.length; i += 20) {\n+        for (frameNum = 0; frameNum < frames.length; frameNum++) {\n@@ -70,19 +74,9 @@\n-                batchEnd = Math.min(i + 20, frames.length);\n-                batchStart = i;\n-                frameNum = 0;\n-\n-                for (int j = i; j < batchEnd; j++) {\n-                    int finalJ = j;\n-                    EventQueue.invokeAndWait(() -> {\n-                        frames[finalJ] = new Frame(\"Frame w\/ gc \"\n-                                + finalJ, gcs[finalJ]);\n-                        frames[finalJ].setSize(100, 100);\n-                        frames[finalJ].setUndecorated(true);\n-                        frames[finalJ].setBackground(Color.WHITE);\n-                        frames[finalJ].setLocation(100 * (frameNum % 10),\n-                                100 + 100 * ((frameNum \/ 10) % 10));\n-                        frames[finalJ].setVisible(true);\n-                        System.out.println(\"Frame \" + finalJ + \" created\");\n-                    });\n-                    frameNum++;\n-                }\n+                EventQueue.invokeAndWait(() -> {\n+                    frames[frameNum] = new Frame(\"Frame w\/ gc \"\n+                            + frameNum, gcs[frameNum]);\n+                    frames[frameNum].setSize(100, 100);\n+                    frames[frameNum].setUndecorated(true);\n+                    frames[frameNum].setBackground(Color.WHITE);\n+                    frames[frameNum].setVisible(true);\n+                    System.out.println(\"Frame \" + frameNum + \" created\");\n+                });\n@@ -92,18 +86,15 @@\n-                for (index = i; index < batchEnd; index++) {\n-                    int finalIndex = index;\n-                    System.out.println(\"Frame \" + finalIndex + \" testing\");\n-                    EventQueue.invokeAndWait(() -> {\n-                        p = frames[finalIndex].getLocation();\n-                        d = frames[finalIndex].getSize();\n-                    });\n-                    Rectangle rect = new Rectangle(p, d);\n-                    BufferedImage img = robot.createScreenCapture(rect);\n-                    if (chkImgBackgroundColor(img)) {\n-                        try {\n-                            ImageIO.write(img, \"png\",\n-                                    new File(\"Frame_\"\n-                                            + finalIndex + \".png\"));\n-                        } catch (IOException ignored) {}\n-                        throw new RuntimeException(\"Frame visual test \" +\n-                                \"failed with non-white background color\");\n-                    }\n+                EventQueue.invokeAndWait(() -> {\n+                    p = frames[frameNum].getLocation();\n+                    d = frames[frameNum].getSize();\n+                });\n+\n+                Rectangle rect = new Rectangle(p, d);\n+                BufferedImage img = robot.createScreenCapture(rect);\n+                if (chkImgBackgroundColor(img)) {\n+                    try {\n+                        ImageIO.write(img, \"png\",\n+                                new File(\"Frame_\"\n+                                        + frameNum + \".png\"));\n+                    } catch (IOException ignored) {}\n+                    throw new RuntimeException(\"Frame visual test \" +\n+                            \"failed with non-white background color\");\n@@ -112,9 +103,6 @@\n-                \/\/ Dispose batch of frames\n-                for (index = batchStart; index < batchEnd; index++) {\n-                    EventQueue.invokeAndWait(() -> {\n-                        if (frames[index] != null) {\n-                            System.out.println(\"Frame \" + index + \" disposed\");\n-                            frames[index].dispose();\n-                        }\n-                    });\n-                }\n+                EventQueue.invokeAndWait(() -> {\n+                    if (frames[frameNum] != null) {\n+                        frames[frameNum].dispose();\n+                        System.out.println(\"Frame \" + frameNum + \" disposed\");\n+                    }\n+                });\n","filename":"test\/jdk\/java\/awt\/Frame\/FrameVisualTest.java","additions":42,"deletions":54,"binary":false,"changes":96,"status":"modified"}]}