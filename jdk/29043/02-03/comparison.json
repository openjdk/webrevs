{"files":[{"patch":"@@ -357,0 +357,1 @@\n+        int checkedOffset = (int) offset;\n@@ -359,1 +360,1 @@\n-            throw new IndexOutOfBoundsException(\"Bad size: \" + size);\n+            throw new IllegalArgumentException(\"Bad size: \" + size);\n@@ -361,0 +362,1 @@\n+        int checkedSize = (int) size;\n@@ -363,1 +365,1 @@\n-            ByteBuffer buffer = slice(memoryMap, (int)offset, (int)size);\n+            ByteBuffer buffer = slice(memoryMap, checkedOffset, checkedSize);\n@@ -371,2 +373,1 @@\n-\n-            ByteBuffer buffer = allocateBuffer(size);\n+            ByteBuffer buffer = ByteBuffer.allocate(checkedSize);\n@@ -375,1 +376,1 @@\n-                read = channel.read(buffer, offset);\n+                read = channel.read(buffer, checkedOffset);\n@@ -381,1 +382,1 @@\n-            if (read != size) {\n+            if (read != checkedSize) {\n@@ -383,1 +384,1 @@\n-                                           \" instead of \" + size + \" bytes\");\n+                        \" instead of \" + checkedSize + \" bytes\");\n@@ -390,9 +391,0 @@\n-    private static ByteBuffer allocateBuffer(long size) {\n-        if (size < 0 || Integer.MAX_VALUE < size) {\n-            throw new IndexOutOfBoundsException(\"size\");\n-        }\n-        ByteBuffer result = ByteBuffer.allocateDirect((int) ((size + 0xFFF) & ~0xFFF));\n-        result.limit((int) size);\n-        return result;\n-    }\n-\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/BasicImageReader.java","additions":8,"deletions":16,"binary":false,"changes":24,"status":"modified"}]}