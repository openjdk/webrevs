{"files":[{"patch":"@@ -223,8 +223,0 @@\n-    public static void releaseByteBuffer(ByteBuffer buffer) {\n-        Objects.requireNonNull(buffer);\n-\n-        if (!MAP_ALL) {\n-            ImageBufferCache.releaseBuffer(buffer);\n-        }\n-    }\n-\n@@ -380,1 +372,1 @@\n-            ByteBuffer buffer = ImageBufferCache.getBuffer(size);\n+            ByteBuffer buffer = allocateBuffer(size);\n@@ -386,1 +378,0 @@\n-                ImageBufferCache.releaseBuffer(buffer);\n@@ -391,1 +382,0 @@\n-                ImageBufferCache.releaseBuffer(buffer);\n@@ -400,0 +390,9 @@\n+    private static ByteBuffer allocateBuffer(long size) {\n+        if (size < 0 || Integer.MAX_VALUE < size) {\n+            throw new IndexOutOfBoundsException(\"size\");\n+        }\n+        ByteBuffer result = ByteBuffer.allocateDirect((int) ((size + 0xFFF) & ~0xFFF));\n+        result.limit((int) size);\n+        return result;\n+    }\n+\n@@ -409,9 +408,1 @@\n-\n-        if (buffer != null) {\n-            byte[] bytes = getBufferBytes(buffer);\n-            ImageBufferCache.releaseBuffer(buffer);\n-\n-            return bytes;\n-        }\n-\n-        return null;\n+        return buffer != null ? getBufferBytes(buffer) : null;\n@@ -420,0 +411,3 @@\n+    \/**\n+     * Returns the content of jimage location in a newly allocated byte buffer.\n+     *\/\n@@ -440,1 +434,0 @@\n-\n@@ -443,1 +436,0 @@\n-                ImageBufferCache.releaseBuffer(buffer);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/BasicImageReader.java","additions":14,"deletions":22,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -193,14 +193,1 @@\n-     * Releases a (possibly cached) {@link ByteBuffer} obtained via\n-     * {@link #getResourceBuffer(Node)}.\n-     *\n-     * <p>Note that no testing is performed to check whether the buffer about\n-     * to be released actually came from a call to {@code getResourceBuffer()}.\n-     *\/\n-    public static void releaseByteBuffer(ByteBuffer buffer) {\n-        BasicImageReader.releaseByteBuffer(buffer);\n-    }\n-\n-    \/**\n-     * Returns the content of a resource node in a possibly cached byte buffer.\n-     * Callers of this method must call {@link #releaseByteBuffer(ByteBuffer)}\n-     * when they are finished with it.\n+     * Returns the content of a resource node in a newly allocated byte buffer.\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ImageReader.java","additions":1,"deletions":14,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -468,6 +468,0 @@\n-        }\n-\n-        @Override\n-        public void release(ByteBuffer bb) {\n-            Objects.requireNonNull(bb);\n-            ImageReader.releaseByteBuffer(bb);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/SystemModuleFinders.java","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"}]}