{"files":[{"patch":"@@ -468,2 +468,1 @@\n-    private void writeLabelOffset(int nBytes, int instructionPc, Label label) {\n-        int targetBci = labelToBci(label);\n+    private void writeLabelOffset4(int instructionPc, Label label, int targetBci) {\n@@ -471,2 +470,2 @@\n-            int pc = bytecodesBufWriter.skip(nBytes);\n-            addLabel(new DeferredLabel(pc, nBytes, instructionPc, label));\n+            int pc = bytecodesBufWriter.skip(4);\n+            addLabel(new DeferredLabel(pc, 4, instructionPc, label));\n@@ -475,3 +474,1 @@\n-            int branchOffset = targetBci - instructionPc;\n-            if (nBytes == 2 && (short)branchOffset != branchOffset) throw new LabelOverflowException();\n-            bytecodesBufWriter.writeIntBytes(nBytes, branchOffset);\n+            bytecodesBufWriter.writeInt(targetBci - instructionPc);\n@@ -481,1 +478,1 @@\n-    private void writeLabelOffset(int nBytes, int instructionPc, Label label, int targetBci) {\n+    private void writeLabelOffset2(int instructionPc, Label label, int targetBci) {\n@@ -483,2 +480,2 @@\n-            int pc = bytecodesBufWriter.skip(nBytes);\n-            addLabel(new DeferredLabel(pc, nBytes, instructionPc, label));\n+            int pc = bytecodesBufWriter.skip(2);\n+            addLabel(new DeferredLabel(pc, 2, instructionPc, label));\n@@ -488,2 +485,2 @@\n-            if (nBytes == 2 && (short)branchOffset != branchOffset) throw new LabelOverflowException();\n-            bytecodesBufWriter.writeIntBytes(nBytes, branchOffset);\n+            if ((short)branchOffset != branchOffset) throw new LabelOverflowException();\n+            bytecodesBufWriter.writeU2(branchOffset);\n@@ -560,1 +557,1 @@\n-            writeLabelOffset(2, instructionPc, target, targetBci);\n+            writeLabelOffset2(instructionPc, target, targetBci);\n@@ -567,1 +564,1 @@\n-        writeLabelOffset(4, instructionPc, target, labelToBci(target));\n+        writeLabelOffset4(instructionPc, target, labelToBci(target));\n@@ -573,1 +570,1 @@\n-            writeLabelOffset(4, instructionPc, target, targetBci);\n+            writeLabelOffset4(instructionPc, target, targetBci);\n@@ -576,1 +573,1 @@\n-            writeLabelOffset(4, instructionPc, target, targetBci);\n+            writeLabelOffset4(instructionPc, target, targetBci);\n@@ -580,1 +577,1 @@\n-            writeLabelOffset(2, instructionPc, bypassJump);\n+            writeLabelOffset2(instructionPc, bypassJump, labelToBci(bypassJump));\n@@ -582,1 +579,1 @@\n-            writeLabelOffset(4, instructionPc + 3, target);\n+            writeLabelOffset4(instructionPc + 3, target, labelToBci(target));\n@@ -593,1 +590,1 @@\n-        writeLabelOffset(4, instructionPc, defaultTarget);\n+        writeLabelOffset4(instructionPc, defaultTarget, labelToBci(defaultTarget));\n@@ -604,1 +601,2 @@\n-            writeLabelOffset(4, instructionPc, c.target());\n+            var target = c.target();\n+            writeLabelOffset4(instructionPc, target, labelToBci(target));\n@@ -614,1 +612,1 @@\n-        writeLabelOffset(4, instructionPc, defaultTarget);\n+        writeLabelOffset4(instructionPc, defaultTarget, labelToBci(defaultTarget));\n@@ -622,1 +620,3 @@\n-            writeLabelOffset(4, instructionPc, caseMap.getOrDefault((int)l, defaultTarget));\n+            \/\/ writeLabelOffset(4, instructionPc, caseMap.getOrDefault((int)l, defaultTarget));\n+            var target = caseMap.getOrDefault((int)l, defaultTarget);\n+            writeLabelOffset4(instructionPc, target, labelToBci(target));\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/DirectCodeBuilder.java","additions":22,"deletions":22,"binary":false,"changes":44,"status":"modified"}]}