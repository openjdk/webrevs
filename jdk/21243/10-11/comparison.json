{"files":[{"patch":"@@ -43,2 +43,10 @@\n-        if (!am.allowMultiple() && isPresent(am)) {\n-            remove(am);\n+        int attributesCount = this.attributesCount;\n+        var attributes = this.attributes;\n+        if (!am.allowMultiple()) {\n+            \/\/ remove if\n+            for (int i = attributesCount - 1; i >= 0; i--) {\n+                if (attributes[i].attributeMapper() == am) {\n+                    attributesCount--;\n+                    System.arraycopy(attributes, i + 1, attributes, i, attributesCount - i);\n+                }\n+            }\n@@ -47,5 +55,1 @@\n-        addAttribute(a);\n-    }\n-\n-    private void addAttribute(Attribute<?> a) {\n-        int attributesCount = this.attributesCount;\n+        \/\/ add attribute\n@@ -53,2 +57,2 @@\n-            int newCapacity = attributesCount + 8;\n-            this.attributes = Arrays.copyOf(attributes, newCapacity);\n+            int newCapacity = attributesCount + 4;\n+            this.attributes = attributes = Arrays.copyOf(attributes, newCapacity);\n@@ -89,11 +93,0 @@\n-\n-    private void remove(AttributeMapper<?> am) {\n-        for (int i = 0; i < attributesCount; i++) {\n-            Attribute<?> a = attributes[i];\n-            if (a.attributeMapper() == am) {\n-                attributesCount--;\n-                System.arraycopy(attributes, i + 1, attributes, i, attributesCount - i);\n-                i--;\n-            }\n-        }\n-    }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/AttributeHolder.java","additions":13,"deletions":20,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -356,1 +356,5 @@\n-        throw new ConstantPoolException(\"Not a \" + cls.getSimpleName() + \" at index: \" + index);\n+        throw checkTypeError(index, cls);\n+    }\n+\n+    private static ConstantPoolException checkTypeError(int index, Class<?> cls) {\n+        return new ConstantPoolException(\"Not a \" + cls.getSimpleName() + \" at index: \" + index);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/ClassReaderImpl.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -748,3 +748,1 @@\n-        LabelContext context = lab.labelContext();\n-\n-        if (context == this) {\n+        if (lab.labelContext() == this) {\n@@ -754,0 +752,2 @@\n+        } else {\n+            setLabelTarget(lab, bci);\n@@ -755,1 +755,5 @@\n-        else if (context == mruParent) {\n+    }\n+\n+    private void setLabelTarget(LabelImpl lab, int bci) {\n+        LabelContext context = lab.labelContext();\n+        if (context == mruParent) {\n@@ -770,1 +774,1 @@\n-            mruParentTable[lab.getBCI()] = bci + 1;\n+            table[lab.getBCI()] = bci + 1;\n@@ -866,1 +870,1 @@\n-        ((LabelImpl) label).writeTo(this);\n+        setLabelTarget(label, curPc());\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/DirectCodeBuilder.java","additions":10,"deletions":6,"binary":false,"changes":16,"status":"modified"}]}