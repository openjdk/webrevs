{"files":[{"patch":"@@ -24,0 +24,2 @@\n+import java.io.*;\n+import java.util.*;\n@@ -30,0 +32,2 @@\n+import jdk.test.lib.compiler.InMemoryJavaCompiler;\n+import jdk.test.lib.util.JarUtils;\n@@ -39,1 +43,1 @@\n- * @library ..\/lib\n+ * @library ..\/lib \/test\/lib\n@@ -66,1 +70,0 @@\n-        Path mainModulePath = src.resolve(\"bug8321413x\");\n@@ -69,0 +72,1 @@\n+        Map<String, String> sources = new LinkedHashMap<>();\n@@ -74,2 +78,0 @@\n-            Path packagePath = Files.createDirectories(mainModulePath.resolve(packageName));\n-\n@@ -79,2 +81,1 @@\n-            Files.writeString(packagePath.resolve(className + \".java\"), classContent.toString());\n-\n+            sources.put(className, classContent.toString());\n@@ -83,9 +84,2 @@\n-\n-        \/\/ create module reading the generated modules\n-        Path mainModuleInfo = mainModulePath.resolve(\"module-info.java\");\n-        Files.writeString(mainModuleInfo, mainModuleInfoContent.toString());\n-\n-        Path mainClassDir = mainModulePath.resolve(\"testpackage\");\n-        Files.createDirectories(mainClassDir);\n-\n-        Files.writeString(mainClassDir.resolve(\"JLink20000PackagesTest.java\"), \"\"\"\n+        sources.put(\"module-info\", mainModuleInfoContent.toString());\n+        sources.put(\"JLink20000PackagesTest\", \"\"\"\n@@ -101,6 +95,6 @@\n-        String out = src.resolve(\"out\").toString();\n-        javac(new String[]{\n-                \"-d\", out,\n-                \"--module-source-path\", src.toString(),\n-                \"--module\", \"bug8321413x\"\n-        });\n+        var compiledClasses = InMemoryJavaCompiler.compile(sources);\n+\n+        \/\/ Create a jar file\n+        Files.createDirectories(src);\n+        Path jarPath = src.resolve(\"bug8321413x.jar\");\n+        JarUtils.createJarFromClasses(jarPath, compiledClasses);\n@@ -109,1 +103,0 @@\n-                .modulePath(out)\n@@ -111,0 +104,1 @@\n+                .addJars(jarPath)\n","filename":"test\/jdk\/tools\/jlink\/JLink20000Packages.java","additions":16,"deletions":22,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -426,1 +426,1 @@\n-            return linkableRuntime ? jars : jmods + File.pathSeparator + jars;\n+            return (linkableRuntime || jmods.isEmpty()) ? jars : jmods + File.pathSeparator + jars;\n@@ -657,1 +657,1 @@\n-            return jmods + File.pathSeparator + jars;\n+            return jmods.isEmpty() ? jars : jmods + File.pathSeparator + jars;\n","filename":"test\/jdk\/tools\/lib\/tests\/JImageGenerator.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}