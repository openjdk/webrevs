{"files":[{"patch":"@@ -2876,1 +2876,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (byte) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (byte) VectorMath.minUnsigned(a, b)));\n@@ -2878,1 +2878,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (byte) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (byte) VectorMath.maxUnsigned(a, b)));\n@@ -2893,0 +2893,2 @@\n+    private static final byte UMIN_VALUE = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMAX_VALUE = (byte)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/ByteVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2861,1 +2861,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (int) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (int) VectorMath.minUnsigned(a, b)));\n@@ -2863,1 +2863,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (int) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (int) VectorMath.maxUnsigned(a, b)));\n@@ -2878,0 +2878,2 @@\n+    private static final int UMIN_VALUE = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMAX_VALUE = (int)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/IntVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2727,1 +2727,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (long) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (long) VectorMath.minUnsigned(a, b)));\n@@ -2729,1 +2729,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (long) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (long) VectorMath.maxUnsigned(a, b)));\n@@ -2744,0 +2744,2 @@\n+    private static final long UMIN_VALUE = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMAX_VALUE = (long)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/LongVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2877,1 +2877,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (short) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (short) VectorMath.minUnsigned(a, b)));\n@@ -2879,1 +2879,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (short) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (short) VectorMath.maxUnsigned(a, b)));\n@@ -2894,0 +2894,2 @@\n+    private static final short UMIN_VALUE = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMAX_VALUE = (short)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/ShortVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -3451,1 +3451,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> ($type$) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> ($type$) VectorMath.minUnsigned(a, b)));\n@@ -3453,1 +3453,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> ($type$) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> ($type$) VectorMath.maxUnsigned(a, b)));\n@@ -3475,0 +3475,2 @@\n+    private static final $type$ UMIN_VALUE = ($type$)0;   \/\/ Minimum unsigned value\n+    private static final $type$ UMAX_VALUE = ($type$)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/X-Vector.java.template","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3569,1 +3582,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3578,1 +3591,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3590,1 +3603,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3593,0 +3606,1 @@\n+            ra = AND_IDENTITY;\n@@ -3596,8 +3610,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3612,1 +3619,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3622,1 +3629,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3636,1 +3643,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3639,0 +3646,1 @@\n+            ra = AND_IDENTITY;\n@@ -3642,8 +3650,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3658,1 +3659,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3667,1 +3668,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3682,0 +3683,1 @@\n+            ra = OR_IDENTITY;\n@@ -3685,8 +3687,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3701,1 +3696,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3711,1 +3706,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3728,0 +3723,1 @@\n+            ra = OR_IDENTITY;\n@@ -3731,8 +3727,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3747,1 +3736,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3756,1 +3745,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3771,0 +3760,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3774,8 +3764,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3790,1 +3773,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3800,1 +3783,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3817,0 +3800,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3820,8 +3804,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3836,1 +3813,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3845,1 +3822,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3860,0 +3837,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3863,8 +3841,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3879,1 +3850,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3889,1 +3860,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3906,0 +3877,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3909,8 +3881,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3925,1 +3890,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3934,1 +3899,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3946,1 +3911,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3949,0 +3914,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3952,8 +3918,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3968,1 +3927,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3978,1 +3937,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3992,1 +3951,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3995,0 +3954,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3998,8 +3958,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4014,1 +3967,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4023,1 +3976,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4035,1 +3988,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4038,0 +3991,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4041,8 +3995,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4057,1 +4004,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4067,1 +4014,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4081,1 +4028,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4084,0 +4031,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4087,8 +4035,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4103,1 +4044,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4112,1 +4053,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4124,1 +4065,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4127,0 +4068,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4130,8 +4072,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4146,1 +4081,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4156,1 +4091,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4170,1 +4105,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4173,0 +4108,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4176,8 +4112,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4192,1 +4121,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4201,1 +4130,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4213,1 +4142,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4216,0 +4145,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4219,8 +4149,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4235,1 +4158,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4245,1 +4168,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4259,1 +4182,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4262,0 +4185,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4265,8 +4189,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4281,1 +4198,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4290,1 +4207,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4302,1 +4219,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4305,0 +4222,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4308,8 +4226,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4324,1 +4235,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4334,1 +4245,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4348,1 +4259,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4351,0 +4262,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4354,8 +4266,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4370,1 +4275,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4379,1 +4284,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4391,1 +4296,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4394,0 +4299,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4397,8 +4303,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4413,1 +4312,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4322,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4437,1 +4336,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4440,0 +4339,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4443,8 +4343,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4507,1 +4400,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4516,1 +4409,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4531,0 +4424,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4534,8 +4428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4550,1 +4437,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4560,1 +4447,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4463,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4467,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6393,0 +6274,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3569,1 +3582,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3578,1 +3591,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3590,1 +3603,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3593,0 +3606,1 @@\n+            ra = AND_IDENTITY;\n@@ -3596,8 +3610,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3612,1 +3619,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3622,1 +3629,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3636,1 +3643,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3639,0 +3646,1 @@\n+            ra = AND_IDENTITY;\n@@ -3642,8 +3650,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3658,1 +3659,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3667,1 +3668,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3682,0 +3683,1 @@\n+            ra = OR_IDENTITY;\n@@ -3685,8 +3687,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3701,1 +3696,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3711,1 +3706,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3728,0 +3723,1 @@\n+            ra = OR_IDENTITY;\n@@ -3731,8 +3727,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3747,1 +3736,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3756,1 +3745,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3771,0 +3760,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3774,8 +3764,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3790,1 +3773,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3800,1 +3783,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3817,0 +3800,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3820,8 +3804,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3836,1 +3813,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3845,1 +3822,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3860,0 +3837,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3863,8 +3841,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3879,1 +3850,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3889,1 +3860,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3906,0 +3877,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3909,8 +3881,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3925,1 +3890,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3934,1 +3899,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3946,1 +3911,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3949,0 +3914,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3952,8 +3918,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3968,1 +3927,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3978,1 +3937,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3992,1 +3951,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3995,0 +3954,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3998,8 +3958,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4014,1 +3967,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4023,1 +3976,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4035,1 +3988,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4038,0 +3991,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4041,8 +3995,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4057,1 +4004,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4067,1 +4014,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4081,1 +4028,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4084,0 +4031,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4087,8 +4035,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4103,1 +4044,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4112,1 +4053,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4124,1 +4065,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4127,0 +4068,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4130,8 +4072,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4146,1 +4081,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4156,1 +4091,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4170,1 +4105,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4173,0 +4108,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4176,8 +4112,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4192,1 +4121,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4201,1 +4130,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4213,1 +4142,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4216,0 +4145,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4219,8 +4149,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4235,1 +4158,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4245,1 +4168,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4259,1 +4182,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4262,0 +4185,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4265,8 +4189,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4281,1 +4198,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4290,1 +4207,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4302,1 +4219,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4305,0 +4222,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4308,8 +4226,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4324,1 +4235,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4334,1 +4245,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4348,1 +4259,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4351,0 +4262,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4354,8 +4266,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4370,1 +4275,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4379,1 +4284,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4391,1 +4296,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4394,0 +4299,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4397,8 +4303,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4413,1 +4312,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4322,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4437,1 +4336,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4440,0 +4339,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4443,8 +4343,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4507,1 +4400,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4516,1 +4409,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4531,0 +4424,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4534,8 +4428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4550,1 +4437,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4560,1 +4447,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4463,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4467,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6393,0 +6274,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3569,1 +3582,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3578,1 +3591,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3590,1 +3603,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3593,0 +3606,1 @@\n+            ra = AND_IDENTITY;\n@@ -3596,8 +3610,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3612,1 +3619,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3622,1 +3629,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3636,1 +3643,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3639,0 +3646,1 @@\n+            ra = AND_IDENTITY;\n@@ -3642,8 +3650,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3658,1 +3659,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3667,1 +3668,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3682,0 +3683,1 @@\n+            ra = OR_IDENTITY;\n@@ -3685,8 +3687,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3701,1 +3696,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3711,1 +3706,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3728,0 +3723,1 @@\n+            ra = OR_IDENTITY;\n@@ -3731,8 +3727,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3747,1 +3736,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3756,1 +3745,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3771,0 +3760,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3774,8 +3764,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3790,1 +3773,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3800,1 +3783,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3817,0 +3800,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3820,8 +3804,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3836,1 +3813,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3845,1 +3822,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3860,0 +3837,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3863,8 +3841,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3879,1 +3850,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3889,1 +3860,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3906,0 +3877,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3909,8 +3881,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3925,1 +3890,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3934,1 +3899,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3946,1 +3911,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3949,0 +3914,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3952,8 +3918,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3968,1 +3927,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3978,1 +3937,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3992,1 +3951,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3995,0 +3954,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3998,8 +3958,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4014,1 +3967,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4023,1 +3976,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4035,1 +3988,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4038,0 +3991,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4041,8 +3995,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4057,1 +4004,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4067,1 +4014,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4081,1 +4028,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4084,0 +4031,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4087,8 +4035,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4103,1 +4044,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4112,1 +4053,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4124,1 +4065,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4127,0 +4068,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4130,8 +4072,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4146,1 +4081,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4156,1 +4091,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4170,1 +4105,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4173,0 +4108,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4176,8 +4112,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4192,1 +4121,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4201,1 +4130,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4213,1 +4142,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4216,0 +4145,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4219,8 +4149,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4235,1 +4158,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4245,1 +4168,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4259,1 +4182,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4262,0 +4185,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4265,8 +4189,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4281,1 +4198,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4290,1 +4207,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4302,1 +4219,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4305,0 +4222,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4308,8 +4226,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4324,1 +4235,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4334,1 +4245,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4348,1 +4259,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4351,0 +4262,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4354,8 +4266,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4370,1 +4275,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4379,1 +4284,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4391,1 +4296,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4394,0 +4299,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4397,8 +4303,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4413,1 +4312,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4322,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4437,1 +4336,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4440,0 +4339,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4443,8 +4343,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4507,1 +4400,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4516,1 +4409,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4531,0 +4424,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4534,8 +4428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4550,1 +4437,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4560,1 +4447,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4463,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4467,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6393,0 +6274,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3569,1 +3582,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3578,1 +3591,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3590,1 +3603,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3593,0 +3606,1 @@\n+            ra = AND_IDENTITY;\n@@ -3596,8 +3610,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3612,1 +3619,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3622,1 +3629,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3636,1 +3643,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3639,0 +3646,1 @@\n+            ra = AND_IDENTITY;\n@@ -3642,8 +3650,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3658,1 +3659,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3667,1 +3668,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3682,0 +3683,1 @@\n+            ra = OR_IDENTITY;\n@@ -3685,8 +3687,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3701,1 +3696,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3711,1 +3706,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3728,0 +3723,1 @@\n+            ra = OR_IDENTITY;\n@@ -3731,8 +3727,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3747,1 +3736,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3756,1 +3745,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3771,0 +3760,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3774,8 +3764,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3790,1 +3773,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3800,1 +3783,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3817,0 +3800,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3820,8 +3804,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3836,1 +3813,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3845,1 +3822,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3860,0 +3837,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3863,8 +3841,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3879,1 +3850,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3889,1 +3860,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3906,0 +3877,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3909,8 +3881,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3925,1 +3890,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3934,1 +3899,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3946,1 +3911,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3949,0 +3914,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3952,8 +3918,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3968,1 +3927,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3978,1 +3937,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3992,1 +3951,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3995,0 +3954,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3998,8 +3958,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4014,1 +3967,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4023,1 +3976,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4035,1 +3988,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4038,0 +3991,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4041,8 +3995,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4057,1 +4004,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4067,1 +4014,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4081,1 +4028,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4084,0 +4031,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4087,8 +4035,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4103,1 +4044,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4112,1 +4053,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4124,1 +4065,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4127,0 +4068,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4130,8 +4072,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4146,1 +4081,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4156,1 +4091,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4170,1 +4105,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4173,0 +4108,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4176,8 +4112,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4192,1 +4121,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4201,1 +4130,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4213,1 +4142,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4216,0 +4145,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4219,8 +4149,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4235,1 +4158,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4245,1 +4168,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4259,1 +4182,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4262,0 +4185,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4265,8 +4189,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4281,1 +4198,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4290,1 +4207,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4302,1 +4219,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4305,0 +4222,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4308,8 +4226,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4324,1 +4235,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4334,1 +4245,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4348,1 +4259,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4351,0 +4262,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4354,8 +4266,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4370,1 +4275,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4379,1 +4284,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4391,1 +4296,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4394,0 +4299,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4397,8 +4303,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4413,1 +4312,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4322,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4437,1 +4336,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4440,0 +4339,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4443,8 +4343,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4507,1 +4400,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4516,1 +4409,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4531,0 +4424,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4534,8 +4428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4550,1 +4437,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4560,1 +4447,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4463,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4467,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6393,0 +6274,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3574,1 +3587,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3583,1 +3596,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3595,1 +3608,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3598,0 +3611,1 @@\n+            ra = AND_IDENTITY;\n@@ -3601,8 +3615,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3617,1 +3624,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3627,1 +3634,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3641,1 +3648,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3644,0 +3651,1 @@\n+            ra = AND_IDENTITY;\n@@ -3647,8 +3655,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3663,1 +3664,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3672,1 +3673,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3687,0 +3688,1 @@\n+            ra = OR_IDENTITY;\n@@ -3690,8 +3692,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3706,1 +3701,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3716,1 +3711,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3733,0 +3728,1 @@\n+            ra = OR_IDENTITY;\n@@ -3736,8 +3732,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3752,1 +3741,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3761,1 +3750,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3776,0 +3765,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3779,8 +3769,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3795,1 +3778,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3805,1 +3788,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3822,0 +3805,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3825,8 +3809,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3841,1 +3818,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3850,1 +3827,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3865,0 +3842,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3868,8 +3846,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3884,1 +3855,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3894,1 +3865,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3911,0 +3882,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3914,8 +3886,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3930,1 +3895,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3939,1 +3904,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3951,1 +3916,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3954,0 +3919,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3957,8 +3923,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3973,1 +3932,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3983,1 +3942,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3997,1 +3956,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -4000,0 +3959,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4003,8 +3963,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4019,1 +3972,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4028,1 +3981,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4040,1 +3993,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4043,0 +3996,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4046,8 +4000,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4062,1 +4009,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4072,1 +4019,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4086,1 +4033,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4089,0 +4036,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4092,8 +4040,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4108,1 +4049,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4117,1 +4058,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4129,1 +4070,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4132,0 +4073,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4135,8 +4077,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4151,1 +4086,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4161,1 +4096,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4175,1 +4110,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4178,0 +4113,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4181,8 +4117,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4197,1 +4126,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4206,1 +4135,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4218,1 +4147,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4221,0 +4150,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4224,8 +4154,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4240,1 +4163,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4250,1 +4173,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4264,1 +4187,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4267,0 +4190,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4270,8 +4194,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4286,1 +4203,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4295,1 +4212,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4307,1 +4224,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4310,0 +4227,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4313,8 +4231,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4329,1 +4240,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4339,1 +4250,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4353,1 +4264,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4356,0 +4267,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4359,8 +4271,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4375,1 +4280,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4384,1 +4289,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4396,1 +4301,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4399,0 +4304,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4402,8 +4308,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4418,1 +4317,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4428,1 +4327,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4442,1 +4341,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4445,0 +4344,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4448,8 +4348,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4512,1 +4405,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4521,1 +4414,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4536,0 +4429,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4539,8 +4433,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4555,1 +4442,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4565,1 +4452,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4581,0 +4468,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4584,8 +4472,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6398,0 +6279,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/ByteMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2342,1 +2349,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2351,1 +2358,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2366,0 +2373,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2369,8 +2377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2385,1 +2386,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2395,1 +2396,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2412,0 +2413,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2415,8 +2417,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2431,1 +2426,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2440,1 +2435,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2452,1 +2447,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2455,0 +2450,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2458,8 +2454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2474,1 +2463,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2484,1 +2473,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2498,1 +2487,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2501,0 +2490,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2504,8 +2494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2520,1 +2503,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2529,1 +2512,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2541,1 +2524,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2544,0 +2527,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2547,8 +2531,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2563,1 +2540,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2573,1 +2550,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2587,1 +2564,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2590,0 +2567,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2593,8 +2571,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2609,1 +2580,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2618,1 +2589,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2630,1 +2601,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2633,0 +2604,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2636,8 +2608,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2652,1 +2617,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2662,1 +2627,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2676,1 +2641,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2679,0 +2644,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2682,8 +2648,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2698,1 +2657,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2707,1 +2666,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2719,1 +2678,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2722,0 +2681,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2725,8 +2685,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2741,1 +2694,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2751,1 +2704,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2765,1 +2718,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2768,0 +2721,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2771,8 +2725,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4809,0 +4756,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double128VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2342,1 +2349,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2351,1 +2358,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2366,0 +2373,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2369,8 +2377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2385,1 +2386,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2395,1 +2396,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2412,0 +2413,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2415,8 +2417,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2431,1 +2426,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2440,1 +2435,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2452,1 +2447,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2455,0 +2450,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2458,8 +2454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2474,1 +2463,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2484,1 +2473,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2498,1 +2487,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2501,0 +2490,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2504,8 +2494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2520,1 +2503,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2529,1 +2512,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2541,1 +2524,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2544,0 +2527,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2547,8 +2531,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2563,1 +2540,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2573,1 +2550,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2587,1 +2564,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2590,0 +2567,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2593,8 +2571,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2609,1 +2580,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2618,1 +2589,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2630,1 +2601,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2633,0 +2604,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2636,8 +2608,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2652,1 +2617,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2662,1 +2627,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2676,1 +2641,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2679,0 +2644,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2682,8 +2648,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2698,1 +2657,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2707,1 +2666,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2719,1 +2678,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2722,0 +2681,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2725,8 +2685,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2741,1 +2694,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2751,1 +2704,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2765,1 +2718,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2768,0 +2721,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2771,8 +2725,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4809,0 +4756,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double256VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2342,1 +2349,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2351,1 +2358,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2366,0 +2373,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2369,8 +2377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2385,1 +2386,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2395,1 +2396,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2412,0 +2413,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2415,8 +2417,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2431,1 +2426,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2440,1 +2435,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2452,1 +2447,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2455,0 +2450,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2458,8 +2454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2474,1 +2463,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2484,1 +2473,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2498,1 +2487,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2501,0 +2490,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2504,8 +2494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2520,1 +2503,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2529,1 +2512,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2541,1 +2524,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2544,0 +2527,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2547,8 +2531,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2563,1 +2540,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2573,1 +2550,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2587,1 +2564,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2590,0 +2567,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2593,8 +2571,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2609,1 +2580,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2618,1 +2589,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2630,1 +2601,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2633,0 +2604,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2636,8 +2608,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2652,1 +2617,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2662,1 +2627,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2676,1 +2641,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2679,0 +2644,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2682,8 +2648,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2698,1 +2657,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2707,1 +2666,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2719,1 +2678,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2722,0 +2681,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2725,8 +2685,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2741,1 +2694,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2751,1 +2704,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2765,1 +2718,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2768,0 +2721,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2771,8 +2725,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4809,0 +4756,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double512VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2342,1 +2349,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2351,1 +2358,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2366,0 +2373,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2369,8 +2377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2385,1 +2386,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2395,1 +2396,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2412,0 +2413,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2415,8 +2417,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2431,1 +2426,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2440,1 +2435,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2452,1 +2447,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2455,0 +2450,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2458,8 +2454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2474,1 +2463,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2484,1 +2473,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2498,1 +2487,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2501,0 +2490,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2504,8 +2494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2520,1 +2503,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2529,1 +2512,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2541,1 +2524,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2544,0 +2527,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2547,8 +2531,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2563,1 +2540,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2573,1 +2550,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2587,1 +2564,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2590,0 +2567,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2593,8 +2571,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2609,1 +2580,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2618,1 +2589,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2630,1 +2601,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2633,0 +2604,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2636,8 +2608,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2652,1 +2617,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2662,1 +2627,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2676,1 +2641,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2679,0 +2644,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2682,8 +2648,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2698,1 +2657,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2707,1 +2666,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2719,1 +2678,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2722,0 +2681,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2725,8 +2685,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2741,1 +2694,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2751,1 +2704,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2765,1 +2718,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2768,0 +2721,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2771,8 +2725,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4809,0 +4756,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double64VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,0 +71,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2347,1 +2354,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2356,1 +2363,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2371,0 +2378,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2374,8 +2382,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2390,1 +2391,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2400,1 +2401,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2417,0 +2418,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2420,8 +2422,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2436,1 +2431,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2445,1 +2440,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2457,1 +2452,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2460,0 +2455,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2463,8 +2459,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2479,1 +2468,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2489,1 +2478,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2503,1 +2492,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2506,0 +2495,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2509,8 +2499,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2525,1 +2508,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2534,1 +2517,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2546,1 +2529,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2549,0 +2532,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2552,8 +2536,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2568,1 +2545,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2578,1 +2555,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2592,1 +2569,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2595,0 +2572,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2598,8 +2576,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2614,1 +2585,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2623,1 +2594,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2635,1 +2606,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2638,0 +2609,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2641,8 +2613,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2657,1 +2622,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2667,1 +2632,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2681,1 +2646,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2684,0 +2649,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2687,8 +2653,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2703,1 +2662,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2712,1 +2671,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2724,1 +2683,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2727,0 +2686,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2730,8 +2690,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2746,1 +2699,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2756,1 +2709,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2770,1 +2723,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2773,0 +2726,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2776,8 +2730,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4814,0 +4761,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/DoubleMaxVectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2353,1 +2360,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2362,1 +2369,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2377,0 +2384,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2380,8 +2388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2396,1 +2397,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2406,1 +2407,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2423,0 +2424,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2426,8 +2428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2442,1 +2437,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2451,1 +2446,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2463,1 +2458,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2466,0 +2461,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2469,8 +2465,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2485,1 +2474,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2495,1 +2484,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2509,1 +2498,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2512,0 +2501,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2515,8 +2505,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2531,1 +2514,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2540,1 +2523,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2552,1 +2535,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2555,0 +2538,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2558,8 +2542,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2574,1 +2551,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2584,1 +2561,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2598,1 +2575,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2601,0 +2578,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2604,8 +2582,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2620,1 +2591,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2629,1 +2600,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2641,1 +2612,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2644,0 +2615,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2647,8 +2619,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2663,1 +2628,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2673,1 +2638,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2687,1 +2652,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2690,0 +2655,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2693,8 +2659,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2709,1 +2668,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2718,1 +2677,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2730,1 +2689,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2733,0 +2692,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2736,8 +2696,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2752,1 +2705,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2762,1 +2715,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2776,1 +2729,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2779,0 +2732,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2782,8 +2736,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4778,0 +4725,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float128VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2353,1 +2360,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2362,1 +2369,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2377,0 +2384,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2380,8 +2388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2396,1 +2397,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2406,1 +2407,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2423,0 +2424,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2426,8 +2428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2442,1 +2437,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2451,1 +2446,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2463,1 +2458,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2466,0 +2461,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2469,8 +2465,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2485,1 +2474,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2495,1 +2484,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2509,1 +2498,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2512,0 +2501,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2515,8 +2505,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2531,1 +2514,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2540,1 +2523,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2552,1 +2535,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2555,0 +2538,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2558,8 +2542,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2574,1 +2551,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2584,1 +2561,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2598,1 +2575,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2601,0 +2578,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2604,8 +2582,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2620,1 +2591,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2629,1 +2600,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2641,1 +2612,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2644,0 +2615,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2647,8 +2619,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2663,1 +2628,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2673,1 +2638,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2687,1 +2652,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2690,0 +2655,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2693,8 +2659,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2709,1 +2668,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2718,1 +2677,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2730,1 +2689,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2733,0 +2692,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2736,8 +2696,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2752,1 +2705,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2762,1 +2715,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2776,1 +2729,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2779,0 +2732,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2782,8 +2736,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4778,0 +4725,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float256VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2353,1 +2360,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2362,1 +2369,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2377,0 +2384,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2380,8 +2388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2396,1 +2397,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2406,1 +2407,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2423,0 +2424,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2426,8 +2428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2442,1 +2437,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2451,1 +2446,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2463,1 +2458,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2466,0 +2461,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2469,8 +2465,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2485,1 +2474,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2495,1 +2484,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2509,1 +2498,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2512,0 +2501,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2515,8 +2505,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2531,1 +2514,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2540,1 +2523,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2552,1 +2535,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2555,0 +2538,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2558,8 +2542,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2574,1 +2551,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2584,1 +2561,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2598,1 +2575,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2601,0 +2578,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2604,8 +2582,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2620,1 +2591,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2629,1 +2600,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2641,1 +2612,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2644,0 +2615,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2647,8 +2619,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2663,1 +2628,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2673,1 +2638,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2687,1 +2652,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2690,0 +2655,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2693,8 +2659,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2709,1 +2668,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2718,1 +2677,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2730,1 +2689,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2733,0 +2692,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2736,8 +2696,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2752,1 +2705,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2762,1 +2715,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2776,1 +2729,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2779,0 +2732,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2782,8 +2736,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4778,0 +4725,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float512VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2353,1 +2360,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2362,1 +2369,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2377,0 +2384,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2380,8 +2388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2396,1 +2397,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2406,1 +2407,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2423,0 +2424,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2426,8 +2428,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2442,1 +2437,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2451,1 +2446,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2463,1 +2458,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2466,0 +2461,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2469,8 +2465,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2485,1 +2474,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2495,1 +2484,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2509,1 +2498,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2512,0 +2501,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2515,8 +2505,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2531,1 +2514,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2540,1 +2523,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2552,1 +2535,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2555,0 +2538,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2558,8 +2542,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2574,1 +2551,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2584,1 +2561,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2598,1 +2575,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2601,0 +2578,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2604,8 +2582,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2620,1 +2591,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2629,1 +2600,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2641,1 +2612,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2644,0 +2615,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2647,8 +2619,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2663,1 +2628,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2673,1 +2638,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2687,1 +2652,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2690,0 +2655,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2693,8 +2659,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2709,1 +2668,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2718,1 +2677,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2730,1 +2689,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2733,0 +2692,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2736,8 +2696,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2752,1 +2705,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2762,1 +2715,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2776,1 +2729,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2779,0 +2732,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2782,8 +2736,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4778,0 +4725,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float64VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,0 +71,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2358,1 +2365,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2367,1 +2374,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2382,0 +2389,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2385,8 +2393,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2401,1 +2402,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2411,1 +2412,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2428,0 +2429,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2431,8 +2433,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2447,1 +2442,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2456,1 +2451,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2468,1 +2463,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2471,0 +2466,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2474,8 +2470,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2490,1 +2479,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2500,1 +2489,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2514,1 +2503,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2517,0 +2506,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2520,8 +2510,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2536,1 +2519,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2545,1 +2528,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2557,1 +2540,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2560,0 +2543,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2563,8 +2547,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2579,1 +2556,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2589,1 +2566,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2603,1 +2580,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2606,0 +2583,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2609,8 +2587,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2625,1 +2596,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2634,1 +2605,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2646,1 +2617,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2649,0 +2620,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2652,8 +2624,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2668,1 +2633,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2678,1 +2643,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2692,1 +2657,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2695,0 +2660,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2698,8 +2664,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2714,1 +2673,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2723,1 +2682,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2735,1 +2694,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2738,0 +2697,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2741,8 +2701,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2757,1 +2710,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2767,1 +2720,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2781,1 +2734,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2784,0 +2737,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2787,8 +2741,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4783,0 +4730,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/FloatMaxVectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3613,1 +3626,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3622,1 +3635,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3634,1 +3647,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3637,0 +3650,1 @@\n+            ra = AND_IDENTITY;\n@@ -3640,8 +3654,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3656,1 +3663,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3666,1 +3673,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3680,1 +3687,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3683,0 +3690,1 @@\n+            ra = AND_IDENTITY;\n@@ -3686,8 +3694,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3702,1 +3703,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3711,1 +3712,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3726,0 +3727,1 @@\n+            ra = OR_IDENTITY;\n@@ -3729,8 +3731,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3745,1 +3740,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3755,1 +3750,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3772,0 +3767,1 @@\n+            ra = OR_IDENTITY;\n@@ -3775,8 +3771,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3791,1 +3780,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3800,1 +3789,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3815,0 +3804,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3818,8 +3808,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3834,1 +3817,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3844,1 +3827,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3861,0 +3844,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3864,8 +3848,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3880,1 +3857,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3889,1 +3866,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3904,0 +3881,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3907,8 +3885,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3923,1 +3894,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3933,1 +3904,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3950,0 +3921,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3953,8 +3925,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3969,1 +3934,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3978,1 +3943,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3990,1 +3955,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -3993,0 +3958,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3996,8 +3962,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4012,1 +3971,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4022,1 +3981,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4036,1 +3995,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4039,0 +3998,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4042,8 +4002,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4058,1 +4011,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4067,1 +4020,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4079,1 +4032,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4082,0 +4035,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4085,8 +4039,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4101,1 +4048,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4111,1 +4058,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4125,1 +4072,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4128,0 +4075,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4131,8 +4079,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4147,1 +4088,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4156,1 +4097,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4168,1 +4109,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4171,0 +4112,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4174,8 +4116,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4190,1 +4125,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4200,1 +4135,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4214,1 +4149,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4217,0 +4152,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4220,8 +4156,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4236,1 +4165,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4245,1 +4174,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4257,1 +4186,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4260,0 +4189,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4263,8 +4193,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4279,1 +4202,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4289,1 +4212,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4303,1 +4226,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4306,0 +4229,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4309,8 +4233,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4325,1 +4242,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4334,1 +4251,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4346,1 +4263,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4349,0 +4266,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4352,8 +4270,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4368,1 +4279,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4378,1 +4289,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4392,1 +4303,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4395,0 +4306,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4398,8 +4310,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4414,1 +4319,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4328,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4435,1 +4340,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4438,0 +4343,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4441,8 +4347,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4457,1 +4356,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4467,1 +4366,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4481,1 +4380,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4484,0 +4383,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4487,8 +4387,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4551,1 +4444,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4560,1 +4453,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4575,0 +4468,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4578,8 +4472,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4594,1 +4481,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4604,1 +4491,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4507,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4511,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6437,0 +6318,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3613,1 +3626,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3622,1 +3635,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3634,1 +3647,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3637,0 +3650,1 @@\n+            ra = AND_IDENTITY;\n@@ -3640,8 +3654,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3656,1 +3663,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3666,1 +3673,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3680,1 +3687,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3683,0 +3690,1 @@\n+            ra = AND_IDENTITY;\n@@ -3686,8 +3694,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3702,1 +3703,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3711,1 +3712,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3726,0 +3727,1 @@\n+            ra = OR_IDENTITY;\n@@ -3729,8 +3731,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3745,1 +3740,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3755,1 +3750,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3772,0 +3767,1 @@\n+            ra = OR_IDENTITY;\n@@ -3775,8 +3771,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3791,1 +3780,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3800,1 +3789,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3815,0 +3804,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3818,8 +3808,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3834,1 +3817,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3844,1 +3827,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3861,0 +3844,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3864,8 +3848,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3880,1 +3857,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3889,1 +3866,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3904,0 +3881,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3907,8 +3885,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3923,1 +3894,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3933,1 +3904,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3950,0 +3921,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3953,8 +3925,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3969,1 +3934,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3978,1 +3943,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3990,1 +3955,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -3993,0 +3958,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3996,8 +3962,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4012,1 +3971,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4022,1 +3981,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4036,1 +3995,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4039,0 +3998,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4042,8 +4002,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4058,1 +4011,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4067,1 +4020,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4079,1 +4032,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4082,0 +4035,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4085,8 +4039,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4101,1 +4048,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4111,1 +4058,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4125,1 +4072,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4128,0 +4075,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4131,8 +4079,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4147,1 +4088,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4156,1 +4097,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4168,1 +4109,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4171,0 +4112,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4174,8 +4116,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4190,1 +4125,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4200,1 +4135,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4214,1 +4149,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4217,0 +4152,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4220,8 +4156,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4236,1 +4165,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4245,1 +4174,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4257,1 +4186,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4260,0 +4189,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4263,8 +4193,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4279,1 +4202,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4289,1 +4212,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4303,1 +4226,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4306,0 +4229,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4309,8 +4233,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4325,1 +4242,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4334,1 +4251,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4346,1 +4263,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4349,0 +4266,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4352,8 +4270,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4368,1 +4279,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4378,1 +4289,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4392,1 +4303,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4395,0 +4306,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4398,8 +4310,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4414,1 +4319,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4328,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4435,1 +4340,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4438,0 +4343,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4441,8 +4347,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4457,1 +4356,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4467,1 +4366,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4481,1 +4380,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4484,0 +4383,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4487,8 +4387,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4551,1 +4444,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4560,1 +4453,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4575,0 +4468,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4578,8 +4472,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4594,1 +4481,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4604,1 +4491,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4507,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4511,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6437,0 +6318,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3613,1 +3626,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3622,1 +3635,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3634,1 +3647,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3637,0 +3650,1 @@\n+            ra = AND_IDENTITY;\n@@ -3640,8 +3654,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3656,1 +3663,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3666,1 +3673,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3680,1 +3687,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3683,0 +3690,1 @@\n+            ra = AND_IDENTITY;\n@@ -3686,8 +3694,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3702,1 +3703,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3711,1 +3712,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3726,0 +3727,1 @@\n+            ra = OR_IDENTITY;\n@@ -3729,8 +3731,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3745,1 +3740,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3755,1 +3750,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3772,0 +3767,1 @@\n+            ra = OR_IDENTITY;\n@@ -3775,8 +3771,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3791,1 +3780,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3800,1 +3789,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3815,0 +3804,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3818,8 +3808,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3834,1 +3817,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3844,1 +3827,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3861,0 +3844,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3864,8 +3848,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3880,1 +3857,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3889,1 +3866,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3904,0 +3881,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3907,8 +3885,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3923,1 +3894,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3933,1 +3904,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3950,0 +3921,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3953,8 +3925,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3969,1 +3934,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3978,1 +3943,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3990,1 +3955,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -3993,0 +3958,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3996,8 +3962,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4012,1 +3971,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4022,1 +3981,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4036,1 +3995,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4039,0 +3998,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4042,8 +4002,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4058,1 +4011,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4067,1 +4020,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4079,1 +4032,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4082,0 +4035,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4085,8 +4039,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4101,1 +4048,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4111,1 +4058,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4125,1 +4072,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4128,0 +4075,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4131,8 +4079,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4147,1 +4088,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4156,1 +4097,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4168,1 +4109,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4171,0 +4112,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4174,8 +4116,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4190,1 +4125,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4200,1 +4135,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4214,1 +4149,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4217,0 +4152,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4220,8 +4156,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4236,1 +4165,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4245,1 +4174,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4257,1 +4186,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4260,0 +4189,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4263,8 +4193,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4279,1 +4202,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4289,1 +4212,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4303,1 +4226,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4306,0 +4229,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4309,8 +4233,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4325,1 +4242,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4334,1 +4251,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4346,1 +4263,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4349,0 +4266,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4352,8 +4270,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4368,1 +4279,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4378,1 +4289,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4392,1 +4303,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4395,0 +4306,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4398,8 +4310,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4414,1 +4319,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4328,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4435,1 +4340,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4438,0 +4343,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4441,8 +4347,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4457,1 +4356,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4467,1 +4366,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4481,1 +4380,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4484,0 +4383,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4487,8 +4387,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4551,1 +4444,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4560,1 +4453,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4575,0 +4468,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4578,8 +4472,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4594,1 +4481,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4604,1 +4491,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4507,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4511,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6437,0 +6318,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3613,1 +3626,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3622,1 +3635,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3634,1 +3647,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3637,0 +3650,1 @@\n+            ra = AND_IDENTITY;\n@@ -3640,8 +3654,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3656,1 +3663,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3666,1 +3673,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3680,1 +3687,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3683,0 +3690,1 @@\n+            ra = AND_IDENTITY;\n@@ -3686,8 +3694,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3702,1 +3703,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3711,1 +3712,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3726,0 +3727,1 @@\n+            ra = OR_IDENTITY;\n@@ -3729,8 +3731,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3745,1 +3740,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3755,1 +3750,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3772,0 +3767,1 @@\n+            ra = OR_IDENTITY;\n@@ -3775,8 +3771,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3791,1 +3780,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3800,1 +3789,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3815,0 +3804,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3818,8 +3808,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3834,1 +3817,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3844,1 +3827,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3861,0 +3844,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3864,8 +3848,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3880,1 +3857,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3889,1 +3866,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3904,0 +3881,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3907,8 +3885,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3923,1 +3894,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3933,1 +3904,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3950,0 +3921,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3953,8 +3925,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3969,1 +3934,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3978,1 +3943,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3990,1 +3955,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -3993,0 +3958,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3996,8 +3962,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4012,1 +3971,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4022,1 +3981,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4036,1 +3995,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4039,0 +3998,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4042,8 +4002,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4058,1 +4011,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4067,1 +4020,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4079,1 +4032,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4082,0 +4035,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4085,8 +4039,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4101,1 +4048,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4111,1 +4058,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4125,1 +4072,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4128,0 +4075,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4131,8 +4079,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4147,1 +4088,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4156,1 +4097,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4168,1 +4109,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4171,0 +4112,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4174,8 +4116,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4190,1 +4125,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4200,1 +4135,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4214,1 +4149,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4217,0 +4152,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4220,8 +4156,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4236,1 +4165,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4245,1 +4174,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4257,1 +4186,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4260,0 +4189,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4263,8 +4193,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4279,1 +4202,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4289,1 +4212,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4303,1 +4226,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4306,0 +4229,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4309,8 +4233,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4325,1 +4242,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4334,1 +4251,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4346,1 +4263,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4349,0 +4266,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4352,8 +4270,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4368,1 +4279,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4378,1 +4289,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4392,1 +4303,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4395,0 +4306,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4398,8 +4310,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4414,1 +4319,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4423,1 +4328,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4435,1 +4340,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4438,0 +4343,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4441,8 +4347,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4457,1 +4356,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4467,1 +4366,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4481,1 +4380,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4484,0 +4383,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4487,8 +4387,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4551,1 +4444,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4560,1 +4453,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4575,0 +4468,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4578,8 +4472,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4594,1 +4481,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4604,1 +4491,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4507,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4511,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6437,0 +6318,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3618,1 +3631,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3627,1 +3640,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3639,1 +3652,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3642,0 +3655,1 @@\n+            ra = AND_IDENTITY;\n@@ -3645,8 +3659,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3661,1 +3668,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3671,1 +3678,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3685,1 +3692,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3688,0 +3695,1 @@\n+            ra = AND_IDENTITY;\n@@ -3691,8 +3699,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3707,1 +3708,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3716,1 +3717,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3731,0 +3732,1 @@\n+            ra = OR_IDENTITY;\n@@ -3734,8 +3736,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3750,1 +3745,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3760,1 +3755,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3777,0 +3772,1 @@\n+            ra = OR_IDENTITY;\n@@ -3780,8 +3776,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3796,1 +3785,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3805,1 +3794,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3820,0 +3809,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3823,8 +3813,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3839,1 +3822,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3849,1 +3832,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3866,0 +3849,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3869,8 +3853,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3885,1 +3862,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3894,1 +3871,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3909,0 +3886,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3912,8 +3890,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3928,1 +3899,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3938,1 +3909,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3955,0 +3926,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3958,8 +3930,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3974,1 +3939,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3983,1 +3948,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -3995,1 +3960,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -3998,0 +3963,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4001,8 +3967,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4017,1 +3976,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4027,1 +3986,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4041,1 +4000,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4044,0 +4003,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4047,8 +4007,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4063,1 +4016,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4072,1 +4025,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4084,1 +4037,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4087,0 +4040,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4090,8 +4044,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4106,1 +4053,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4116,1 +4063,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4130,1 +4077,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4133,0 +4080,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4136,8 +4084,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4152,1 +4093,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4161,1 +4102,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4173,1 +4114,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4176,0 +4117,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4179,8 +4121,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4195,1 +4130,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4205,1 +4140,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4219,1 +4154,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4222,0 +4157,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4225,8 +4161,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4241,1 +4170,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4250,1 +4179,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4262,1 +4191,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4265,0 +4194,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4268,8 +4198,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4284,1 +4207,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4294,1 +4217,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4308,1 +4231,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4311,0 +4234,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4314,8 +4238,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4330,1 +4247,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4339,1 +4256,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4351,1 +4268,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4354,0 +4271,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4357,8 +4275,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4373,1 +4284,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4383,1 +4294,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4397,1 +4308,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4400,0 +4311,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4403,8 +4315,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4419,1 +4324,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4428,1 +4333,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4440,1 +4345,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4443,0 +4348,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4446,8 +4352,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4462,1 +4361,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4472,1 +4371,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4486,1 +4385,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4489,0 +4388,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4492,8 +4392,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4556,1 +4449,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4565,1 +4458,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4580,0 +4473,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4583,8 +4477,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4599,1 +4486,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4609,1 +4496,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4625,0 +4512,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4628,8 +4516,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6442,0 +6323,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/IntMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3635,1 +3648,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3644,1 +3657,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3656,1 +3669,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3659,0 +3672,1 @@\n+            ra = AND_IDENTITY;\n@@ -3662,8 +3676,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3678,1 +3685,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3688,1 +3695,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3702,1 +3709,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3705,0 +3712,1 @@\n+            ra = AND_IDENTITY;\n@@ -3708,8 +3716,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3724,1 +3725,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3733,1 +3734,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3748,0 +3749,1 @@\n+            ra = OR_IDENTITY;\n@@ -3751,8 +3753,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3767,1 +3762,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3777,1 +3772,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3794,0 +3789,1 @@\n+            ra = OR_IDENTITY;\n@@ -3797,8 +3793,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3813,1 +3802,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3822,1 +3811,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3837,0 +3826,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3840,8 +3830,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3856,1 +3839,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3866,1 +3849,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3883,0 +3866,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3886,8 +3870,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3902,1 +3879,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3911,1 +3888,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3926,0 +3903,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3929,8 +3907,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3945,1 +3916,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3955,1 +3926,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3972,0 +3943,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3975,8 +3947,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3991,1 +3956,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4000,1 +3965,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4012,1 +3977,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4015,0 +3980,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4018,8 +3984,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4034,1 +3993,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4044,1 +4003,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4058,1 +4017,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4061,0 +4020,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4064,8 +4024,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4080,1 +4033,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4089,1 +4042,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4101,1 +4054,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4104,0 +4057,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4107,8 +4061,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4123,1 +4070,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4133,1 +4080,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4147,1 +4094,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4150,0 +4097,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4153,8 +4101,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4169,1 +4110,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4178,1 +4119,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4190,1 +4131,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4193,0 +4134,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4196,8 +4138,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4212,1 +4147,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4222,1 +4157,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4236,1 +4171,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4239,0 +4174,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4242,8 +4178,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4258,1 +4187,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4267,1 +4196,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4279,1 +4208,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4282,0 +4211,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4285,8 +4215,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4301,1 +4224,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4311,1 +4234,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4325,1 +4248,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4328,0 +4251,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4331,8 +4255,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4347,1 +4264,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4356,1 +4273,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4368,1 +4285,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4371,0 +4288,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4374,8 +4292,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4390,1 +4301,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4400,1 +4311,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4414,1 +4325,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4417,0 +4328,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4420,8 +4332,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4436,1 +4341,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4445,1 +4350,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4457,1 +4362,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4460,0 +4365,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4463,8 +4369,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4479,1 +4378,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4489,1 +4388,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4503,1 +4402,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4506,0 +4405,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4509,8 +4409,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4573,1 +4466,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4582,1 +4475,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4597,0 +4490,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4600,8 +4494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4616,1 +4503,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4626,1 +4513,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4529,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4533,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6389,0 +6270,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3635,1 +3648,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3644,1 +3657,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3656,1 +3669,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3659,0 +3672,1 @@\n+            ra = AND_IDENTITY;\n@@ -3662,8 +3676,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3678,1 +3685,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3688,1 +3695,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3702,1 +3709,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3705,0 +3712,1 @@\n+            ra = AND_IDENTITY;\n@@ -3708,8 +3716,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3724,1 +3725,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3733,1 +3734,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3748,0 +3749,1 @@\n+            ra = OR_IDENTITY;\n@@ -3751,8 +3753,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3767,1 +3762,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3777,1 +3772,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3794,0 +3789,1 @@\n+            ra = OR_IDENTITY;\n@@ -3797,8 +3793,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3813,1 +3802,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3822,1 +3811,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3837,0 +3826,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3840,8 +3830,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3856,1 +3839,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3866,1 +3849,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3883,0 +3866,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3886,8 +3870,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3902,1 +3879,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3911,1 +3888,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3926,0 +3903,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3929,8 +3907,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3945,1 +3916,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3955,1 +3926,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3972,0 +3943,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3975,8 +3947,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3991,1 +3956,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4000,1 +3965,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4012,1 +3977,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4015,0 +3980,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4018,8 +3984,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4034,1 +3993,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4044,1 +4003,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4058,1 +4017,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4061,0 +4020,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4064,8 +4024,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4080,1 +4033,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4089,1 +4042,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4101,1 +4054,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4104,0 +4057,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4107,8 +4061,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4123,1 +4070,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4133,1 +4080,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4147,1 +4094,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4150,0 +4097,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4153,8 +4101,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4169,1 +4110,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4178,1 +4119,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4190,1 +4131,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4193,0 +4134,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4196,8 +4138,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4212,1 +4147,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4222,1 +4157,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4236,1 +4171,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4239,0 +4174,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4242,8 +4178,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4258,1 +4187,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4267,1 +4196,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4279,1 +4208,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4282,0 +4211,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4285,8 +4215,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4301,1 +4224,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4311,1 +4234,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4325,1 +4248,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4328,0 +4251,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4331,8 +4255,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4347,1 +4264,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4356,1 +4273,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4368,1 +4285,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4371,0 +4288,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4374,8 +4292,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4390,1 +4301,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4400,1 +4311,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4414,1 +4325,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4417,0 +4328,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4420,8 +4332,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4436,1 +4341,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4445,1 +4350,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4457,1 +4362,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4460,0 +4365,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4463,8 +4369,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4479,1 +4378,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4489,1 +4388,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4503,1 +4402,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4506,0 +4405,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4509,8 +4409,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4573,1 +4466,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4582,1 +4475,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4597,0 +4490,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4600,8 +4494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4616,1 +4503,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4626,1 +4513,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4529,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4533,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6389,0 +6270,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3635,1 +3648,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3644,1 +3657,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3656,1 +3669,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3659,0 +3672,1 @@\n+            ra = AND_IDENTITY;\n@@ -3662,8 +3676,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3678,1 +3685,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3688,1 +3695,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3702,1 +3709,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3705,0 +3712,1 @@\n+            ra = AND_IDENTITY;\n@@ -3708,8 +3716,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3724,1 +3725,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3733,1 +3734,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3748,0 +3749,1 @@\n+            ra = OR_IDENTITY;\n@@ -3751,8 +3753,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3767,1 +3762,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3777,1 +3772,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3794,0 +3789,1 @@\n+            ra = OR_IDENTITY;\n@@ -3797,8 +3793,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3813,1 +3802,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3822,1 +3811,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3837,0 +3826,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3840,8 +3830,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3856,1 +3839,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3866,1 +3849,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3883,0 +3866,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3886,8 +3870,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3902,1 +3879,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3911,1 +3888,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3926,0 +3903,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3929,8 +3907,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3945,1 +3916,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3955,1 +3926,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3972,0 +3943,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3975,8 +3947,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3991,1 +3956,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4000,1 +3965,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4012,1 +3977,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4015,0 +3980,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4018,8 +3984,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4034,1 +3993,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4044,1 +4003,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4058,1 +4017,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4061,0 +4020,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4064,8 +4024,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4080,1 +4033,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4089,1 +4042,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4101,1 +4054,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4104,0 +4057,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4107,8 +4061,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4123,1 +4070,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4133,1 +4080,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4147,1 +4094,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4150,0 +4097,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4153,8 +4101,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4169,1 +4110,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4178,1 +4119,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4190,1 +4131,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4193,0 +4134,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4196,8 +4138,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4212,1 +4147,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4222,1 +4157,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4236,1 +4171,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4239,0 +4174,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4242,8 +4178,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4258,1 +4187,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4267,1 +4196,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4279,1 +4208,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4282,0 +4211,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4285,8 +4215,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4301,1 +4224,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4311,1 +4234,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4325,1 +4248,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4328,0 +4251,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4331,8 +4255,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4347,1 +4264,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4356,1 +4273,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4368,1 +4285,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4371,0 +4288,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4374,8 +4292,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4390,1 +4301,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4400,1 +4311,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4414,1 +4325,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4417,0 +4328,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4420,8 +4332,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4436,1 +4341,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4445,1 +4350,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4457,1 +4362,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4460,0 +4365,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4463,8 +4369,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4479,1 +4378,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4489,1 +4388,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4503,1 +4402,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4506,0 +4405,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4509,8 +4409,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4573,1 +4466,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4582,1 +4475,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4597,0 +4490,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4600,8 +4494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4616,1 +4503,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4626,1 +4513,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4529,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4533,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6389,0 +6270,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3635,1 +3648,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3644,1 +3657,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3656,1 +3669,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3659,0 +3672,1 @@\n+            ra = AND_IDENTITY;\n@@ -3662,8 +3676,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3678,1 +3685,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3688,1 +3695,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3702,1 +3709,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3705,0 +3712,1 @@\n+            ra = AND_IDENTITY;\n@@ -3708,8 +3716,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3724,1 +3725,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3733,1 +3734,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3748,0 +3749,1 @@\n+            ra = OR_IDENTITY;\n@@ -3751,8 +3753,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3767,1 +3762,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3777,1 +3772,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3794,0 +3789,1 @@\n+            ra = OR_IDENTITY;\n@@ -3797,8 +3793,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3813,1 +3802,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3822,1 +3811,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3837,0 +3826,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3840,8 +3830,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3856,1 +3839,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3866,1 +3849,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3883,0 +3866,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3886,8 +3870,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3902,1 +3879,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3911,1 +3888,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3926,0 +3903,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3929,8 +3907,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3945,1 +3916,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3955,1 +3926,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3972,0 +3943,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3975,8 +3947,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3991,1 +3956,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4000,1 +3965,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4012,1 +3977,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4015,0 +3980,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4018,8 +3984,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4034,1 +3993,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4044,1 +4003,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4058,1 +4017,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4061,0 +4020,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4064,8 +4024,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4080,1 +4033,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4089,1 +4042,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4101,1 +4054,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4104,0 +4057,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4107,8 +4061,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4123,1 +4070,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4133,1 +4080,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4147,1 +4094,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4150,0 +4097,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4153,8 +4101,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4169,1 +4110,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4178,1 +4119,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4190,1 +4131,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4193,0 +4134,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4196,8 +4138,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4212,1 +4147,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4222,1 +4157,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4236,1 +4171,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4239,0 +4174,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4242,8 +4178,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4258,1 +4187,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4267,1 +4196,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4279,1 +4208,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4282,0 +4211,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4285,8 +4215,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4301,1 +4224,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4311,1 +4234,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4325,1 +4248,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4328,0 +4251,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4331,8 +4255,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4347,1 +4264,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4356,1 +4273,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4368,1 +4285,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4371,0 +4288,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4374,8 +4292,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4390,1 +4301,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4400,1 +4311,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4414,1 +4325,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4417,0 +4328,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4420,8 +4332,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4436,1 +4341,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4445,1 +4350,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4457,1 +4362,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4460,0 +4365,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4463,8 +4369,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4479,1 +4378,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4489,1 +4388,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4503,1 +4402,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4506,0 +4405,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4509,8 +4409,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4573,1 +4466,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4582,1 +4475,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4597,0 +4490,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4600,8 +4494,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4616,1 +4503,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4626,1 +4513,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4529,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4533,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6389,0 +6270,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3640,1 +3653,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3649,1 +3662,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3661,1 +3674,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3664,0 +3677,1 @@\n+            ra = AND_IDENTITY;\n@@ -3667,8 +3681,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3683,1 +3690,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3693,1 +3700,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3707,1 +3714,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3710,0 +3717,1 @@\n+            ra = AND_IDENTITY;\n@@ -3713,8 +3721,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3729,1 +3730,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3738,1 +3739,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3753,0 +3754,1 @@\n+            ra = OR_IDENTITY;\n@@ -3756,8 +3758,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3772,1 +3767,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3782,1 +3777,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3799,0 +3794,1 @@\n+            ra = OR_IDENTITY;\n@@ -3802,8 +3798,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3818,1 +3807,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3827,1 +3816,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3842,0 +3831,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3845,8 +3835,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3861,1 +3844,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3871,1 +3854,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3888,0 +3871,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3891,8 +3875,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3907,1 +3884,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3916,1 +3893,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3931,0 +3908,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3934,8 +3912,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3950,1 +3921,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3960,1 +3931,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3977,0 +3948,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3980,8 +3952,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3996,1 +3961,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4005,1 +3970,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4017,1 +3982,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4020,0 +3985,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4023,8 +3989,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4039,1 +3998,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4049,1 +4008,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4063,1 +4022,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4066,0 +4025,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4069,8 +4029,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4085,1 +4038,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4094,1 +4047,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4106,1 +4059,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4109,0 +4062,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4112,8 +4066,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4128,1 +4075,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4138,1 +4085,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4152,1 +4099,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4155,0 +4102,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4158,8 +4106,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4174,1 +4115,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4183,1 +4124,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4195,1 +4136,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4198,0 +4139,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4201,8 +4143,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4217,1 +4152,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4227,1 +4162,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4241,1 +4176,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4244,0 +4179,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4247,8 +4183,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4263,1 +4192,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4272,1 +4201,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4284,1 +4213,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4287,0 +4216,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4290,8 +4220,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4306,1 +4229,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4316,1 +4239,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4330,1 +4253,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4333,0 +4256,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4336,8 +4260,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4352,1 +4269,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4361,1 +4278,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4373,1 +4290,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4376,0 +4293,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4379,8 +4297,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4395,1 +4306,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4405,1 +4316,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4419,1 +4330,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4422,0 +4333,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4425,8 +4337,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4441,1 +4346,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4450,1 +4355,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4462,1 +4367,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4465,0 +4370,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4468,8 +4374,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4484,1 +4383,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4494,1 +4393,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4508,1 +4407,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4511,0 +4410,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4514,8 +4414,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4578,1 +4471,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4587,1 +4480,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4602,0 +4495,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4605,8 +4499,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4621,1 +4508,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4631,1 +4518,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4647,0 +4534,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4650,8 +4538,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6394,0 +6275,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/LongMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3560,1 +3573,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3569,1 +3582,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3581,1 +3594,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3584,0 +3597,1 @@\n+            ra = AND_IDENTITY;\n@@ -3587,8 +3601,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3603,1 +3610,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3613,1 +3620,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3627,1 +3634,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3630,0 +3637,1 @@\n+            ra = AND_IDENTITY;\n@@ -3633,8 +3641,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3649,1 +3650,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3658,1 +3659,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3673,0 +3674,1 @@\n+            ra = OR_IDENTITY;\n@@ -3676,8 +3678,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3692,1 +3687,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3702,1 +3697,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3719,0 +3714,1 @@\n+            ra = OR_IDENTITY;\n@@ -3722,8 +3718,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3738,1 +3727,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3747,1 +3736,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3762,0 +3751,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3765,8 +3755,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3781,1 +3764,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3791,1 +3774,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3808,0 +3791,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3811,8 +3795,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3827,1 +3804,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3836,1 +3813,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3851,0 +3828,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3854,8 +3832,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3870,1 +3841,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3880,1 +3851,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3897,0 +3868,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3900,8 +3872,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3916,1 +3881,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3925,1 +3890,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3937,1 +3902,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3940,0 +3905,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3943,8 +3909,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3959,1 +3918,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3969,1 +3928,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3983,1 +3942,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3986,0 +3945,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3989,8 +3949,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4005,1 +3958,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4014,1 +3967,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4026,1 +3979,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4029,0 +3982,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4032,8 +3986,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4048,1 +3995,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4058,1 +4005,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4072,1 +4019,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4075,0 +4022,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4078,8 +4026,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4094,1 +4035,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4103,1 +4044,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4115,1 +4056,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4118,0 +4059,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4121,8 +4063,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4137,1 +4072,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4147,1 +4082,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4161,1 +4096,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4164,0 +4099,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4167,8 +4103,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4183,1 +4112,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4192,1 +4121,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4204,1 +4133,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4207,0 +4136,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4210,8 +4140,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4226,1 +4149,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4236,1 +4159,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4250,1 +4173,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4253,0 +4176,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4256,8 +4180,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4272,1 +4189,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4281,1 +4198,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4293,1 +4210,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4296,0 +4213,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4299,8 +4217,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4315,1 +4226,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4325,1 +4236,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4339,1 +4250,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4342,0 +4253,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4345,8 +4257,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4361,1 +4266,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4370,1 +4275,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4382,1 +4287,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4385,0 +4290,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4388,8 +4294,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4404,1 +4303,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4414,1 +4313,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4428,1 +4327,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4431,0 +4330,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4434,8 +4334,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4498,1 +4391,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4507,1 +4400,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4522,0 +4415,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4525,8 +4419,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4541,1 +4428,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4551,1 +4438,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4454,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4458,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6384,0 +6265,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3560,1 +3573,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3569,1 +3582,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3581,1 +3594,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3584,0 +3597,1 @@\n+            ra = AND_IDENTITY;\n@@ -3587,8 +3601,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3603,1 +3610,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3613,1 +3620,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3627,1 +3634,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3630,0 +3637,1 @@\n+            ra = AND_IDENTITY;\n@@ -3633,8 +3641,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3649,1 +3650,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3658,1 +3659,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3673,0 +3674,1 @@\n+            ra = OR_IDENTITY;\n@@ -3676,8 +3678,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3692,1 +3687,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3702,1 +3697,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3719,0 +3714,1 @@\n+            ra = OR_IDENTITY;\n@@ -3722,8 +3718,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3738,1 +3727,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3747,1 +3736,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3762,0 +3751,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3765,8 +3755,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3781,1 +3764,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3791,1 +3774,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3808,0 +3791,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3811,8 +3795,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3827,1 +3804,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3836,1 +3813,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3851,0 +3828,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3854,8 +3832,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3870,1 +3841,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3880,1 +3851,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3897,0 +3868,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3900,8 +3872,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3916,1 +3881,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3925,1 +3890,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3937,1 +3902,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3940,0 +3905,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3943,8 +3909,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3959,1 +3918,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3969,1 +3928,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3983,1 +3942,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3986,0 +3945,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3989,8 +3949,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4005,1 +3958,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4014,1 +3967,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4026,1 +3979,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4029,0 +3982,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4032,8 +3986,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4048,1 +3995,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4058,1 +4005,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4072,1 +4019,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4075,0 +4022,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4078,8 +4026,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4094,1 +4035,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4103,1 +4044,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4115,1 +4056,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4118,0 +4059,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4121,8 +4063,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4137,1 +4072,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4147,1 +4082,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4161,1 +4096,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4164,0 +4099,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4167,8 +4103,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4183,1 +4112,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4192,1 +4121,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4204,1 +4133,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4207,0 +4136,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4210,8 +4140,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4226,1 +4149,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4236,1 +4159,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4250,1 +4173,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4253,0 +4176,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4256,8 +4180,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4272,1 +4189,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4281,1 +4198,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4293,1 +4210,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4296,0 +4213,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4299,8 +4217,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4315,1 +4226,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4325,1 +4236,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4339,1 +4250,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4342,0 +4253,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4345,8 +4257,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4361,1 +4266,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4370,1 +4275,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4382,1 +4287,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4385,0 +4290,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4388,8 +4294,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4404,1 +4303,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4414,1 +4313,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4428,1 +4327,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4431,0 +4330,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4434,8 +4334,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4498,1 +4391,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4507,1 +4400,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4522,0 +4415,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4525,8 +4419,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4541,1 +4428,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4551,1 +4438,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4454,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4458,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6384,0 +6265,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3560,1 +3573,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3569,1 +3582,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3581,1 +3594,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3584,0 +3597,1 @@\n+            ra = AND_IDENTITY;\n@@ -3587,8 +3601,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3603,1 +3610,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3613,1 +3620,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3627,1 +3634,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3630,0 +3637,1 @@\n+            ra = AND_IDENTITY;\n@@ -3633,8 +3641,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3649,1 +3650,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3658,1 +3659,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3673,0 +3674,1 @@\n+            ra = OR_IDENTITY;\n@@ -3676,8 +3678,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3692,1 +3687,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3702,1 +3697,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3719,0 +3714,1 @@\n+            ra = OR_IDENTITY;\n@@ -3722,8 +3718,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3738,1 +3727,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3747,1 +3736,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3762,0 +3751,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3765,8 +3755,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3781,1 +3764,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3791,1 +3774,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3808,0 +3791,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3811,8 +3795,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3827,1 +3804,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3836,1 +3813,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3851,0 +3828,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3854,8 +3832,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3870,1 +3841,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3880,1 +3851,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3897,0 +3868,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3900,8 +3872,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3916,1 +3881,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3925,1 +3890,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3937,1 +3902,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3940,0 +3905,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3943,8 +3909,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3959,1 +3918,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3969,1 +3928,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3983,1 +3942,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3986,0 +3945,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3989,8 +3949,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4005,1 +3958,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4014,1 +3967,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4026,1 +3979,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4029,0 +3982,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4032,8 +3986,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4048,1 +3995,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4058,1 +4005,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4072,1 +4019,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4075,0 +4022,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4078,8 +4026,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4094,1 +4035,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4103,1 +4044,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4115,1 +4056,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4118,0 +4059,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4121,8 +4063,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4137,1 +4072,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4147,1 +4082,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4161,1 +4096,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4164,0 +4099,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4167,8 +4103,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4183,1 +4112,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4192,1 +4121,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4204,1 +4133,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4207,0 +4136,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4210,8 +4140,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4226,1 +4149,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4236,1 +4159,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4250,1 +4173,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4253,0 +4176,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4256,8 +4180,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4272,1 +4189,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4281,1 +4198,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4293,1 +4210,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4296,0 +4213,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4299,8 +4217,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4315,1 +4226,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4325,1 +4236,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4339,1 +4250,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4342,0 +4253,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4345,8 +4257,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4361,1 +4266,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4370,1 +4275,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4382,1 +4287,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4385,0 +4290,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4388,8 +4294,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4404,1 +4303,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4414,1 +4313,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4428,1 +4327,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4431,0 +4330,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4434,8 +4334,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4498,1 +4391,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4507,1 +4400,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4522,0 +4415,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4525,8 +4419,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4541,1 +4428,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4551,1 +4438,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4454,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4458,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6384,0 +6265,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3560,1 +3573,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3569,1 +3582,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3581,1 +3594,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3584,0 +3597,1 @@\n+            ra = AND_IDENTITY;\n@@ -3587,8 +3601,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3603,1 +3610,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3613,1 +3620,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3627,1 +3634,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3630,0 +3637,1 @@\n+            ra = AND_IDENTITY;\n@@ -3633,8 +3641,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3649,1 +3650,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3658,1 +3659,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3673,0 +3674,1 @@\n+            ra = OR_IDENTITY;\n@@ -3676,8 +3678,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3692,1 +3687,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3702,1 +3697,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3719,0 +3714,1 @@\n+            ra = OR_IDENTITY;\n@@ -3722,8 +3718,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3738,1 +3727,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3747,1 +3736,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3762,0 +3751,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3765,8 +3755,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3781,1 +3764,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3791,1 +3774,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3808,0 +3791,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3811,8 +3795,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3827,1 +3804,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3836,1 +3813,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3851,0 +3828,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3854,8 +3832,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3870,1 +3841,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3880,1 +3851,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3897,0 +3868,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3900,8 +3872,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3916,1 +3881,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3925,1 +3890,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3937,1 +3902,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3940,0 +3905,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3943,8 +3909,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3959,1 +3918,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3969,1 +3928,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3983,1 +3942,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3986,0 +3945,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3989,8 +3949,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4005,1 +3958,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4014,1 +3967,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4026,1 +3979,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4029,0 +3982,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4032,8 +3986,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4048,1 +3995,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4058,1 +4005,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4072,1 +4019,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4075,0 +4022,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4078,8 +4026,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4094,1 +4035,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4103,1 +4044,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4115,1 +4056,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4118,0 +4059,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4121,8 +4063,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4137,1 +4072,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4147,1 +4082,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4161,1 +4096,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4164,0 +4099,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4167,8 +4103,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4183,1 +4112,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4192,1 +4121,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4204,1 +4133,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4207,0 +4136,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4210,8 +4140,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4226,1 +4149,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4236,1 +4159,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4250,1 +4173,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4253,0 +4176,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4256,8 +4180,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4272,1 +4189,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4281,1 +4198,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4293,1 +4210,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4296,0 +4213,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4299,8 +4217,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4315,1 +4226,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4325,1 +4236,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4339,1 +4250,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4342,0 +4253,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4345,8 +4257,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4361,1 +4266,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4370,1 +4275,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4382,1 +4287,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4385,0 +4290,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4388,8 +4294,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4404,1 +4303,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4414,1 +4313,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4428,1 +4327,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4431,0 +4330,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4434,8 +4334,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4498,1 +4391,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4507,1 +4400,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4522,0 +4415,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4525,8 +4419,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4541,1 +4428,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4551,1 +4438,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4454,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4458,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6384,0 +6265,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3565,1 +3578,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3574,1 +3587,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3586,1 +3599,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3589,0 +3602,1 @@\n+            ra = AND_IDENTITY;\n@@ -3592,8 +3606,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3608,1 +3615,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3618,1 +3625,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3632,1 +3639,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3635,0 +3642,1 @@\n+            ra = AND_IDENTITY;\n@@ -3638,8 +3646,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3654,1 +3655,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3663,1 +3664,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3678,0 +3679,1 @@\n+            ra = OR_IDENTITY;\n@@ -3681,8 +3683,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3697,1 +3692,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3707,1 +3702,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3724,0 +3719,1 @@\n+            ra = OR_IDENTITY;\n@@ -3727,8 +3723,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3743,1 +3732,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3752,1 +3741,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3767,0 +3756,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3770,8 +3760,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3786,1 +3769,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3796,1 +3779,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3813,0 +3796,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3816,8 +3800,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3832,1 +3809,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3841,1 +3818,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3856,0 +3833,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3859,8 +3837,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3875,1 +3846,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3885,1 +3856,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3902,0 +3873,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3905,8 +3877,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3921,1 +3886,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3930,1 +3895,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3942,1 +3907,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3945,0 +3910,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3948,8 +3914,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -3964,1 +3923,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3974,1 +3933,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3988,1 +3947,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3991,0 +3950,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3994,8 +3954,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4010,1 +3963,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4019,1 +3972,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4031,1 +3984,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4034,0 +3987,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4037,8 +3991,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4053,1 +4000,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4063,1 +4010,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4077,1 +4024,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4080,0 +4027,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4083,8 +4031,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4099,1 +4040,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4108,1 +4049,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4120,1 +4061,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4123,0 +4064,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4126,8 +4068,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4142,1 +4077,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4152,1 +4087,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4166,1 +4101,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4169,0 +4104,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4172,8 +4108,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4188,1 +4117,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4197,1 +4126,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4209,1 +4138,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4212,0 +4141,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4215,8 +4145,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4231,1 +4154,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4241,1 +4164,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4255,1 +4178,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4258,0 +4181,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4261,8 +4185,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4277,1 +4194,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4286,1 +4203,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4298,1 +4215,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4301,0 +4218,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4304,8 +4222,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4320,1 +4231,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4330,1 +4241,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4344,1 +4255,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4347,0 +4258,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4350,8 +4262,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4366,1 +4271,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4375,1 +4280,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4387,1 +4292,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4390,0 +4295,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4393,8 +4299,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4409,1 +4308,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4419,1 +4318,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4433,1 +4332,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4436,0 +4335,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4439,8 +4339,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4503,1 +4396,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4512,1 +4405,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4527,0 +4420,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4530,8 +4424,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4546,1 +4433,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4556,1 +4443,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4572,0 +4459,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4575,8 +4463,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6389,0 +6270,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/ShortMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n-# Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -510,10 +510,10 @@\n-gen_reduction_op \"AND\" \"\\&\" \"BITWISE\" \"-1\"\n-gen_reduction_op \"OR\" \"|\" \"BITWISE\" \"0\"\n-gen_reduction_op \"XOR\" \"^\" \"BITWISE\" \"0\"\n-gen_reduction_op \"ADD\" \"+\" \"\" \"0\"\n-gen_reduction_op \"MUL\" \"*\" \"\" \"1\"\n-gen_reduction_op_func \"MIN\" \"(\\$type\\$) Math.min\" \"\" \"\\$Wideboxtype\\$.\\$MaxValue\\$\"\n-gen_reduction_op_func \"MAX\" \"(\\$type\\$) Math.max\" \"\" \"\\$Wideboxtype\\$.\\$MinValue\\$\"\n-gen_reduction_op_func \"UMIN\" \"(\\$type\\$) VectorMath.minUnsigned\" \"BITWISE\" \"\\$Wideboxtype\\$.\\$MaxValue\\$\"\n-gen_reduction_op_func \"UMAX\" \"(\\$type\\$) VectorMath.maxUnsigned\" \"BITWISE\" \"\\$Wideboxtype\\$.\\$MinValue\\$\"\n-gen_reduction_op_func \"FIRST_NONZERO\" \"firstNonZero\" \"\" \"(\\$type\\$) 0\"\n+gen_reduction_op \"AND\" \"\\&\" \"BITWISE\" \"AND_IDENTITY\"\n+gen_reduction_op \"OR\" \"|\" \"BITWISE\" \"OR_IDENTITY\"\n+gen_reduction_op \"XOR\" \"^\" \"BITWISE\" \"XOR_IDENTITY\"\n+gen_reduction_op \"ADD\" \"+\" \"\" \"ADD_IDENTITY\"\n+gen_reduction_op \"MUL\" \"*\" \"\" \"MUL_IDENTITY\"\n+gen_reduction_op_func \"MIN\" \"(\\$type\\$) Math.min\" \"\" \"MIN_IDENTITY\"\n+gen_reduction_op_func \"MAX\" \"(\\$type\\$) Math.max\" \"\" \"MAX_IDENTITY\"\n+gen_reduction_op_func \"UMIN\" \"(\\$type\\$) VectorMath.minUnsigned\" \"BITWISE\" \"UMIN_IDENTITY\"\n+gen_reduction_op_func \"UMAX\" \"(\\$type\\$) VectorMath.maxUnsigned\" \"BITWISE\" \"UMAX_IDENTITY\"\n+gen_reduction_op_func \"FIRST_NONZERO\" \"firstNonZero\" \"\" \"FIRST_NONZERO_IDENTITY\"\n@@ -526,1 +526,1 @@\n-gen_saturating_reduction_op \"SUADD\" \"(\\$type\\$) VectorMath.addSaturatingUnsigned\" \"BITWISE\" \"0\"\n+gen_saturating_reduction_op \"SUADD\" \"(\\$type\\$) VectorMath.addSaturatingUnsigned\" \"BITWISE\" \"SUADD_IDENTITY\"\n@@ -628,0 +628,3 @@\n+# Identity value tests\n+gen_op_tmpl \"Identity-test\" \"Identity\" \"\" \"\"\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/gen-template.sh","additions":15,"deletions":12,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -5,8 +5,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -18,1 +11,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]], vmask));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-Masked-op-func.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -5,8 +5,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -18,1 +11,2 @@\n-                ra [[TEST_OP]]= av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                ra [[TEST_OP]]= r[i];\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-Masked-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -3,8 +3,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -16,1 +9,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]]));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-op-func.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -3,8 +3,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -16,1 +9,2 @@\n-                ra [[TEST_OP]]= av.reduceLanes(VectorOperators.[[TEST]]);\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n+                ra [[TEST_OP]]= r[i];\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -5,8 +5,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -18,1 +11,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]], vmask));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-SaturatingReduction-Masked-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -3,8 +3,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -16,1 +9,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]]));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-SaturatingReduction-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -0,0 +1,95 @@\n+\n+    @Test(dataProvider = \"$type$UnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<$type$[]> fa) {\n+        $type$[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            $type$ x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals(($type$)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+#if[BITWISE]\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals(($type$)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+#end[BITWISE]\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max($Wideboxtype$.$MinValue$, x) == x\n+            Assert.assertEquals(($type$) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min($Wideboxtype$.$MaxValue$, x) == x\n+            Assert.assertEquals(($type$) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals(($type$)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+#if[BITWISE]\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals(($type$)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals(($type$) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals(($type$) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals(($type$) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals(($type$)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+#end[BITWISE]\n+        }\n+    }\n+\n+    @Test(dataProvider = \"$type$UnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<$type$[]> fa) {\n+        $type$[] a = fa.apply(SPECIES.length());\n+        VectorMask<$Wideboxtype$> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+#if[BITWISE]\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+#end[BITWISE]\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+#if[BITWISE]\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+#end[BITWISE]\n+        }\n+    }\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Unit-Identity-test.template","additions":95,"deletions":0,"binary":false,"changes":95,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -101,0 +101,17 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final $type$ ADD_IDENTITY = ($type$)0;\n+#if[BITWISE]\n+    private static final $type$ AND_IDENTITY = ($type$)-1;\n+#end[BITWISE]\n+    private static final $type$ FIRST_NONZERO_IDENTITY = ($type$)0;\n+    private static final $type$ MAX_IDENTITY = $Wideboxtype$.$MinValue$;\n+    private static final $type$ MIN_IDENTITY = $Wideboxtype$.$MaxValue$;\n+    private static final $type$ MUL_IDENTITY = ($type$)1;\n+#if[BITWISE]\n+    private static final $type$ OR_IDENTITY = ($type$)0;\n+    private static final $type$ SUADD_IDENTITY = ($type$)0;\n+    private static final $type$ UMAX_IDENTITY = ($type$)0;   \/\/ Minimum unsigned value\n+    private static final $type$ UMIN_IDENTITY = ($type$)-1;  \/\/ Maximum unsigned value\n+    private static final $type$ XOR_IDENTITY = ($type$)0;\n+#end[BITWISE]\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Unit-header.template","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"}]}