{"files":[{"patch":"@@ -2876,1 +2876,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (byte) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (byte) VectorMath.minUnsigned(a, b)));\n@@ -2878,1 +2878,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (byte) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (byte) VectorMath.maxUnsigned(a, b)));\n@@ -2893,0 +2893,2 @@\n+    private static final byte UMIN_VALUE = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMAX_VALUE = (byte)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/ByteVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2861,1 +2861,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (int) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (int) VectorMath.minUnsigned(a, b)));\n@@ -2863,1 +2863,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (int) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (int) VectorMath.maxUnsigned(a, b)));\n@@ -2878,0 +2878,2 @@\n+    private static final int UMIN_VALUE = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMAX_VALUE = (int)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/IntVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2727,1 +2727,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (long) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (long) VectorMath.minUnsigned(a, b)));\n@@ -2729,1 +2729,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (long) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (long) VectorMath.maxUnsigned(a, b)));\n@@ -2744,0 +2744,2 @@\n+    private static final long UMIN_VALUE = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMAX_VALUE = (long)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/LongVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2877,1 +2877,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> (short) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> (short) VectorMath.minUnsigned(a, b)));\n@@ -2879,1 +2879,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> (short) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> (short) VectorMath.maxUnsigned(a, b)));\n@@ -2894,0 +2894,2 @@\n+    private static final short UMIN_VALUE = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMAX_VALUE = (short)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/ShortVector.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -3451,1 +3451,1 @@\n-                    toBits(v.rOp(MAX_OR_INF, m, (i, a, b) -> ($type$) VectorMath.minUnsigned(a, b)));\n+                    toBits(v.rOp(UMAX_VALUE, m, (i, a, b) -> ($type$) VectorMath.minUnsigned(a, b)));\n@@ -3453,1 +3453,1 @@\n-                    toBits(v.rOp(MIN_OR_INF, m, (i, a, b) -> ($type$) VectorMath.maxUnsigned(a, b)));\n+                    toBits(v.rOp(UMIN_VALUE, m, (i, a, b) -> ($type$) VectorMath.maxUnsigned(a, b)));\n@@ -3475,0 +3475,2 @@\n+    private static final $type$ UMIN_VALUE = ($type$)0;   \/\/ Minimum unsigned value\n+    private static final $type$ UMAX_VALUE = ($type$)-1;  \/\/ Maximum unsigned value\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/X-Vector.java.template","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3614,1 +3627,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3623,1 +3636,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3635,1 +3648,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3638,0 +3651,1 @@\n+            ra = AND_IDENTITY;\n@@ -3641,8 +3655,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3657,1 +3664,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3667,1 +3674,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3681,1 +3688,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3684,0 +3691,1 @@\n+            ra = AND_IDENTITY;\n@@ -3687,8 +3695,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3703,1 +3704,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3712,1 +3713,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3727,0 +3728,1 @@\n+            ra = OR_IDENTITY;\n@@ -3730,8 +3732,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3746,1 +3741,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3756,1 +3751,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3773,0 +3768,1 @@\n+            ra = OR_IDENTITY;\n@@ -3776,8 +3772,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3792,1 +3781,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3801,1 +3790,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3816,0 +3805,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3819,8 +3809,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3835,1 +3818,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3845,1 +3828,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3862,0 +3845,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3865,8 +3849,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3881,1 +3858,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3890,1 +3867,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3905,0 +3882,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3908,8 +3886,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3924,1 +3895,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3934,1 +3905,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3951,0 +3922,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3954,8 +3926,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3970,1 +3935,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3979,1 +3944,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3991,1 +3956,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3994,0 +3959,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3997,8 +3963,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4013,1 +3972,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4023,1 +3982,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4037,1 +3996,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -4040,0 +3999,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4043,8 +4003,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4059,1 +4012,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4068,1 +4021,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4080,1 +4033,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4083,0 +4036,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4086,8 +4040,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4102,1 +4049,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4112,1 +4059,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4126,1 +4073,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4129,0 +4076,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4132,8 +4080,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4148,1 +4089,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4157,1 +4098,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4169,1 +4110,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4172,0 +4113,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4175,8 +4117,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4191,1 +4126,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4201,1 +4136,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4215,1 +4150,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4218,0 +4153,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4221,8 +4157,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4237,1 +4166,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4246,1 +4175,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4258,1 +4187,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4261,0 +4190,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4264,8 +4194,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4280,1 +4203,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4290,1 +4213,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4304,1 +4227,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4307,0 +4230,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4310,8 +4234,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4326,1 +4243,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4335,1 +4252,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4347,1 +4264,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4350,0 +4267,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4353,8 +4271,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4369,1 +4280,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4379,1 +4290,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4393,1 +4304,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4396,0 +4307,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4399,8 +4311,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4415,1 +4320,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4424,1 +4329,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4436,1 +4341,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4439,0 +4344,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4442,8 +4348,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4458,1 +4357,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4367,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4482,1 +4381,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4485,0 +4384,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4488,8 +4388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4552,1 +4445,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4561,1 +4454,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4469,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4595,1 +4482,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4605,1 +4492,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4621,0 +4508,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4624,8 +4512,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6589,0 +6470,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3614,1 +3627,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3623,1 +3636,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3635,1 +3648,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3638,0 +3651,1 @@\n+            ra = AND_IDENTITY;\n@@ -3641,8 +3655,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3657,1 +3664,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3667,1 +3674,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3681,1 +3688,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3684,0 +3691,1 @@\n+            ra = AND_IDENTITY;\n@@ -3687,8 +3695,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3703,1 +3704,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3712,1 +3713,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3727,0 +3728,1 @@\n+            ra = OR_IDENTITY;\n@@ -3730,8 +3732,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3746,1 +3741,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3756,1 +3751,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3773,0 +3768,1 @@\n+            ra = OR_IDENTITY;\n@@ -3776,8 +3772,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3792,1 +3781,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3801,1 +3790,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3816,0 +3805,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3819,8 +3809,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3835,1 +3818,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3845,1 +3828,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3862,0 +3845,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3865,8 +3849,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3881,1 +3858,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3890,1 +3867,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3905,0 +3882,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3908,8 +3886,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3924,1 +3895,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3934,1 +3905,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3951,0 +3922,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3954,8 +3926,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3970,1 +3935,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3979,1 +3944,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3991,1 +3956,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3994,0 +3959,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3997,8 +3963,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4013,1 +3972,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4023,1 +3982,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4037,1 +3996,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -4040,0 +3999,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4043,8 +4003,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4059,1 +4012,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4068,1 +4021,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4080,1 +4033,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4083,0 +4036,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4086,8 +4040,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4102,1 +4049,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4112,1 +4059,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4126,1 +4073,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4129,0 +4076,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4132,8 +4080,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4148,1 +4089,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4157,1 +4098,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4169,1 +4110,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4172,0 +4113,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4175,8 +4117,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4191,1 +4126,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4201,1 +4136,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4215,1 +4150,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4218,0 +4153,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4221,8 +4157,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4237,1 +4166,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4246,1 +4175,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4258,1 +4187,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4261,0 +4190,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4264,8 +4194,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4280,1 +4203,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4290,1 +4213,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4304,1 +4227,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4307,0 +4230,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4310,8 +4234,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4326,1 +4243,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4335,1 +4252,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4347,1 +4264,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4350,0 +4267,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4353,8 +4271,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4369,1 +4280,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4379,1 +4290,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4393,1 +4304,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4396,0 +4307,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4399,8 +4311,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4415,1 +4320,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4424,1 +4329,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4436,1 +4341,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4439,0 +4344,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4442,8 +4348,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4458,1 +4357,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4367,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4482,1 +4381,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4485,0 +4384,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4488,8 +4388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4552,1 +4445,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4561,1 +4454,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4469,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4595,1 +4482,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4605,1 +4492,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4621,0 +4508,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4624,8 +4512,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6589,0 +6470,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3614,1 +3627,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3623,1 +3636,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3635,1 +3648,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3638,0 +3651,1 @@\n+            ra = AND_IDENTITY;\n@@ -3641,8 +3655,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3657,1 +3664,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3667,1 +3674,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3681,1 +3688,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3684,0 +3691,1 @@\n+            ra = AND_IDENTITY;\n@@ -3687,8 +3695,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3703,1 +3704,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3712,1 +3713,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3727,0 +3728,1 @@\n+            ra = OR_IDENTITY;\n@@ -3730,8 +3732,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3746,1 +3741,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3756,1 +3751,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3773,0 +3768,1 @@\n+            ra = OR_IDENTITY;\n@@ -3776,8 +3772,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3792,1 +3781,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3801,1 +3790,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3816,0 +3805,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3819,8 +3809,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3835,1 +3818,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3845,1 +3828,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3862,0 +3845,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3865,8 +3849,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3881,1 +3858,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3890,1 +3867,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3905,0 +3882,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3908,8 +3886,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3924,1 +3895,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3934,1 +3905,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3951,0 +3922,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3954,8 +3926,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3970,1 +3935,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3979,1 +3944,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3991,1 +3956,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3994,0 +3959,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3997,8 +3963,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4013,1 +3972,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4023,1 +3982,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4037,1 +3996,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -4040,0 +3999,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4043,8 +4003,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4059,1 +4012,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4068,1 +4021,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4080,1 +4033,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4083,0 +4036,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4086,8 +4040,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4102,1 +4049,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4112,1 +4059,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4126,1 +4073,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4129,0 +4076,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4132,8 +4080,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4148,1 +4089,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4157,1 +4098,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4169,1 +4110,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4172,0 +4113,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4175,8 +4117,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4191,1 +4126,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4201,1 +4136,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4215,1 +4150,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4218,0 +4153,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4221,8 +4157,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4237,1 +4166,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4246,1 +4175,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4258,1 +4187,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4261,0 +4190,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4264,8 +4194,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4280,1 +4203,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4290,1 +4213,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4304,1 +4227,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4307,0 +4230,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4310,8 +4234,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4326,1 +4243,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4335,1 +4252,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4347,1 +4264,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4350,0 +4267,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4353,8 +4271,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4369,1 +4280,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4379,1 +4290,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4393,1 +4304,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4396,0 +4307,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4399,8 +4311,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4415,1 +4320,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4424,1 +4329,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4436,1 +4341,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4439,0 +4344,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4442,8 +4348,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4458,1 +4357,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4367,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4482,1 +4381,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4485,0 +4384,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4488,8 +4388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4552,1 +4445,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4561,1 +4454,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4469,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4595,1 +4482,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4605,1 +4492,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4621,0 +4508,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4624,8 +4512,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6589,0 +6470,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3614,1 +3627,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3623,1 +3636,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3635,1 +3648,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3638,0 +3651,1 @@\n+            ra = AND_IDENTITY;\n@@ -3641,8 +3655,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3657,1 +3664,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3667,1 +3674,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3681,1 +3688,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3684,0 +3691,1 @@\n+            ra = AND_IDENTITY;\n@@ -3687,8 +3695,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3703,1 +3704,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3712,1 +3713,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3727,0 +3728,1 @@\n+            ra = OR_IDENTITY;\n@@ -3730,8 +3732,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3746,1 +3741,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3756,1 +3751,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3773,0 +3768,1 @@\n+            ra = OR_IDENTITY;\n@@ -3776,8 +3772,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3792,1 +3781,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3801,1 +3790,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3816,0 +3805,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3819,8 +3809,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3835,1 +3818,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3845,1 +3828,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3862,0 +3845,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3865,8 +3849,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3881,1 +3858,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3890,1 +3867,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3905,0 +3882,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3908,8 +3886,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3924,1 +3895,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3934,1 +3905,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3951,0 +3922,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3954,8 +3926,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3970,1 +3935,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3979,1 +3944,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3991,1 +3956,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3994,0 +3959,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3997,8 +3963,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4013,1 +3972,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4023,1 +3982,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4037,1 +3996,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -4040,0 +3999,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4043,8 +4003,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4059,1 +4012,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4068,1 +4021,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4080,1 +4033,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4083,0 +4036,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4086,8 +4040,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4102,1 +4049,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4112,1 +4059,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4126,1 +4073,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4129,0 +4076,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4132,8 +4080,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4148,1 +4089,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4157,1 +4098,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4169,1 +4110,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4172,0 +4113,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4175,8 +4117,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4191,1 +4126,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4201,1 +4136,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4215,1 +4150,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4218,0 +4153,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4221,8 +4157,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4237,1 +4166,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4246,1 +4175,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4258,1 +4187,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4261,0 +4190,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4264,8 +4194,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4280,1 +4203,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4290,1 +4213,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4304,1 +4227,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4307,0 +4230,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4310,8 +4234,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4326,1 +4243,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4335,1 +4252,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4347,1 +4264,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4350,0 +4267,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4353,8 +4271,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4369,1 +4280,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4379,1 +4290,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4393,1 +4304,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4396,0 +4307,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4399,8 +4311,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4415,1 +4320,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4424,1 +4329,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4436,1 +4341,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4439,0 +4344,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4442,8 +4348,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4458,1 +4357,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4367,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4482,1 +4381,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4485,0 +4384,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4488,8 +4388,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4552,1 +4445,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4561,1 +4454,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4576,0 +4469,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4579,8 +4473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4595,1 +4482,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4605,1 +4492,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4621,0 +4508,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4624,8 +4512,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6589,0 +6470,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Byte64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final byte ADD_IDENTITY = (byte)0;\n+    private static final byte AND_IDENTITY = (byte)-1;\n+    private static final byte FIRST_NONZERO_IDENTITY = (byte)0;\n+    private static final byte MAX_IDENTITY = Byte.MIN_VALUE;\n+    private static final byte MIN_IDENTITY = Byte.MAX_VALUE;\n+    private static final byte MUL_IDENTITY = (byte)1;\n+    private static final byte OR_IDENTITY = (byte)0;\n+    private static final byte SUADD_IDENTITY = (byte)0;\n+    private static final byte UMAX_IDENTITY = (byte)0;   \/\/ Minimum unsigned value\n+    private static final byte UMIN_IDENTITY = (byte)-1;  \/\/ Maximum unsigned value\n+    private static final byte XOR_IDENTITY = (byte)0;\n+\n@@ -3619,1 +3632,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3628,1 +3641,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3640,1 +3653,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3643,0 +3656,1 @@\n+            ra = AND_IDENTITY;\n@@ -3646,8 +3660,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3662,1 +3669,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3672,1 +3679,1 @@\n-        byte res = -1;\n+        byte res = AND_IDENTITY;\n@@ -3686,1 +3693,1 @@\n-        byte ra = -1;\n+        byte ra = 0;\n@@ -3689,0 +3696,1 @@\n+            ra = AND_IDENTITY;\n@@ -3692,8 +3700,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3708,1 +3709,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3717,1 +3718,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3732,0 +3733,1 @@\n+            ra = OR_IDENTITY;\n@@ -3735,8 +3737,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3751,1 +3746,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3761,1 +3756,1 @@\n-        byte res = 0;\n+        byte res = OR_IDENTITY;\n@@ -3778,0 +3773,1 @@\n+            ra = OR_IDENTITY;\n@@ -3781,8 +3777,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3797,1 +3786,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3806,1 +3795,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3821,0 +3810,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3824,8 +3814,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3840,1 +3823,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3850,1 +3833,1 @@\n-        byte res = 0;\n+        byte res = XOR_IDENTITY;\n@@ -3867,0 +3850,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3870,8 +3854,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3886,1 +3863,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3895,1 +3872,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3910,0 +3887,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3913,8 +3891,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3929,1 +3900,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3939,1 +3910,1 @@\n-        byte res = 0;\n+        byte res = ADD_IDENTITY;\n@@ -3956,0 +3927,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3959,8 +3931,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3975,1 +3940,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3984,1 +3949,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -3996,1 +3961,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -3999,0 +3964,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4002,8 +3968,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4018,1 +3977,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4028,1 +3987,1 @@\n-        byte res = 1;\n+        byte res = MUL_IDENTITY;\n@@ -4042,1 +4001,1 @@\n-        byte ra = 1;\n+        byte ra = 0;\n@@ -4045,0 +4004,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4048,8 +4008,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4064,1 +4017,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4073,1 +4026,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4085,1 +4038,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4088,0 +4041,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4091,8 +4045,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4107,1 +4054,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4117,1 +4064,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = MIN_IDENTITY;\n@@ -4131,1 +4078,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4134,0 +4081,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4137,8 +4085,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (byte) Math.min(ra, r[i]);\n@@ -4153,1 +4094,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4162,1 +4103,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4174,1 +4115,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4177,0 +4118,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4180,8 +4122,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4196,1 +4131,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4206,1 +4141,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = MAX_IDENTITY;\n@@ -4220,1 +4155,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4223,0 +4158,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4226,8 +4162,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (byte) Math.max(ra, r[i]);\n@@ -4242,1 +4171,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4251,1 +4180,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4263,1 +4192,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4266,0 +4195,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4269,8 +4199,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4285,1 +4208,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4295,1 +4218,1 @@\n-        byte res = Byte.MAX_VALUE;\n+        byte res = UMIN_IDENTITY;\n@@ -4309,1 +4232,1 @@\n-        byte ra = Byte.MAX_VALUE;\n+        byte ra = 0;\n@@ -4312,0 +4235,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4315,8 +4239,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (byte) VectorMath.minUnsigned(ra, r[i]);\n@@ -4331,1 +4248,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4340,1 +4257,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4352,1 +4269,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4355,0 +4272,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4358,8 +4276,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4374,1 +4285,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4384,1 +4295,1 @@\n-        byte res = Byte.MIN_VALUE;\n+        byte res = UMAX_IDENTITY;\n@@ -4398,1 +4309,1 @@\n-        byte ra = Byte.MIN_VALUE;\n+        byte ra = 0;\n@@ -4401,0 +4312,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4404,8 +4316,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Byte.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (byte) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4420,1 +4325,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4429,1 +4334,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4441,1 +4346,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4444,0 +4349,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4447,8 +4353,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4463,1 +4362,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4473,1 +4372,1 @@\n-        byte res = (byte) 0;\n+        byte res = FIRST_NONZERO_IDENTITY;\n@@ -4487,1 +4386,1 @@\n-        byte ra = (byte) 0;\n+        byte ra = 0;\n@@ -4490,0 +4389,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4493,8 +4393,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (byte) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4557,1 +4450,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4566,1 +4459,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4581,0 +4474,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4584,8 +4478,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4600,1 +4487,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4610,1 +4497,1 @@\n-        byte res = 0;\n+        byte res = SUADD_IDENTITY;\n@@ -4626,0 +4513,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4629,8 +4517,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n-                ra = (byte) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (byte) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6594,0 +6475,87 @@\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            byte x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((byte)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((byte)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Byte.MIN_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Byte.MAX_VALUE, x) == x\n+            Assert.assertEquals((byte) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((byte)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((byte)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((byte) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((byte) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((byte)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"byteUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<byte[]> fa) {\n+        byte[] a = fa.apply(SPECIES.length());\n+        VectorMask<Byte> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ByteVector av = ByteVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/ByteMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2387,1 +2394,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2396,1 +2403,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2411,0 +2418,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2414,8 +2422,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2430,1 +2431,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2440,1 +2441,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2457,0 +2458,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2460,8 +2462,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2476,1 +2471,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2485,1 +2480,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2497,1 +2492,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2500,0 +2495,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2503,8 +2499,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2519,1 +2508,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2529,1 +2518,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2543,1 +2532,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2546,0 +2535,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2549,8 +2539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2565,1 +2548,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2574,1 +2557,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2586,1 +2569,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2589,0 +2572,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2592,8 +2576,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2608,1 +2585,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2618,1 +2595,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2632,1 +2609,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2635,0 +2612,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2638,8 +2616,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2654,1 +2625,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2663,1 +2634,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2675,1 +2646,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2678,0 +2649,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2681,8 +2653,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2697,1 +2662,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2707,1 +2672,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2721,1 +2686,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2724,0 +2689,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2727,8 +2693,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2743,1 +2702,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2752,1 +2711,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2764,1 +2723,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2767,0 +2726,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2770,8 +2730,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2786,1 +2739,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2796,1 +2749,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2810,1 +2763,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2813,0 +2766,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2816,8 +2770,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -5005,0 +4952,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double128VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2387,1 +2394,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2396,1 +2403,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2411,0 +2418,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2414,8 +2422,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2430,1 +2431,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2440,1 +2441,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2457,0 +2458,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2460,8 +2462,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2476,1 +2471,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2485,1 +2480,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2497,1 +2492,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2500,0 +2495,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2503,8 +2499,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2519,1 +2508,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2529,1 +2518,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2543,1 +2532,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2546,0 +2535,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2549,8 +2539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2565,1 +2548,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2574,1 +2557,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2586,1 +2569,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2589,0 +2572,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2592,8 +2576,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2608,1 +2585,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2618,1 +2595,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2632,1 +2609,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2635,0 +2612,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2638,8 +2616,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2654,1 +2625,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2663,1 +2634,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2675,1 +2646,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2678,0 +2649,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2681,8 +2653,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2697,1 +2662,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2707,1 +2672,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2721,1 +2686,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2724,0 +2689,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2727,8 +2693,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2743,1 +2702,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2752,1 +2711,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2764,1 +2723,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2767,0 +2726,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2770,8 +2730,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2786,1 +2739,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2796,1 +2749,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2810,1 +2763,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2813,0 +2766,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2816,8 +2770,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -5005,0 +4952,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double256VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2387,1 +2394,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2396,1 +2403,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2411,0 +2418,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2414,8 +2422,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2430,1 +2431,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2440,1 +2441,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2457,0 +2458,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2460,8 +2462,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2476,1 +2471,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2485,1 +2480,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2497,1 +2492,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2500,0 +2495,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2503,8 +2499,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2519,1 +2508,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2529,1 +2518,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2543,1 +2532,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2546,0 +2535,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2549,8 +2539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2565,1 +2548,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2574,1 +2557,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2586,1 +2569,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2589,0 +2572,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2592,8 +2576,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2608,1 +2585,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2618,1 +2595,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2632,1 +2609,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2635,0 +2612,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2638,8 +2616,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2654,1 +2625,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2663,1 +2634,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2675,1 +2646,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2678,0 +2649,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2681,8 +2653,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2697,1 +2662,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2707,1 +2672,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2721,1 +2686,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2724,0 +2689,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2727,8 +2693,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2743,1 +2702,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2752,1 +2711,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2764,1 +2723,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2767,0 +2726,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2770,8 +2730,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2786,1 +2739,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2796,1 +2749,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2810,1 +2763,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2813,0 +2766,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2816,8 +2770,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -5005,0 +4952,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double512VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2387,1 +2394,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2396,1 +2403,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2411,0 +2418,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2414,8 +2422,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2430,1 +2431,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2440,1 +2441,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2457,0 +2458,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2460,8 +2462,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2476,1 +2471,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2485,1 +2480,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2497,1 +2492,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2500,0 +2495,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2503,8 +2499,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2519,1 +2508,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2529,1 +2518,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2543,1 +2532,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2546,0 +2535,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2549,8 +2539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2565,1 +2548,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2574,1 +2557,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2586,1 +2569,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2589,0 +2572,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2592,8 +2576,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2608,1 +2585,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2618,1 +2595,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2632,1 +2609,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2635,0 +2612,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2638,8 +2616,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2654,1 +2625,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2663,1 +2634,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2675,1 +2646,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2678,0 +2649,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2681,8 +2653,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2697,1 +2662,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2707,1 +2672,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2721,1 +2686,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2724,0 +2689,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2727,8 +2693,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2743,1 +2702,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2752,1 +2711,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2764,1 +2723,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2767,0 +2726,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2770,8 +2730,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2786,1 +2739,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2796,1 +2749,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2810,1 +2763,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2813,0 +2766,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2816,8 +2770,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -5005,0 +4952,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double64VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,0 +71,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final double ADD_IDENTITY = (double)0;\n+    private static final double FIRST_NONZERO_IDENTITY = (double)0;\n+    private static final double MAX_IDENTITY = Double.NEGATIVE_INFINITY;\n+    private static final double MIN_IDENTITY = Double.POSITIVE_INFINITY;\n+    private static final double MUL_IDENTITY = (double)1;\n@@ -2392,1 +2399,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2401,1 +2408,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2416,0 +2423,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2419,8 +2427,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2435,1 +2436,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2445,1 +2446,1 @@\n-        double res = 0;\n+        double res = ADD_IDENTITY;\n@@ -2462,0 +2463,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2465,8 +2467,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2481,1 +2476,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2490,1 +2485,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2502,1 +2497,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2505,0 +2500,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2508,8 +2504,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2524,1 +2513,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2534,1 +2523,1 @@\n-        double res = 1;\n+        double res = MUL_IDENTITY;\n@@ -2548,1 +2537,1 @@\n-        double ra = 1;\n+        double ra = 0;\n@@ -2551,0 +2540,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2554,8 +2544,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2570,1 +2553,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2579,1 +2562,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2591,1 +2574,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2594,0 +2577,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2597,8 +2581,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2613,1 +2590,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2623,1 +2600,1 @@\n-        double res = Double.POSITIVE_INFINITY;\n+        double res = MIN_IDENTITY;\n@@ -2637,1 +2614,1 @@\n-        double ra = Double.POSITIVE_INFINITY;\n+        double ra = 0;\n@@ -2640,0 +2617,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2643,8 +2621,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (double) Math.min(ra, r[i]);\n@@ -2659,1 +2630,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2668,1 +2639,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2680,1 +2651,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2683,0 +2654,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2686,8 +2658,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2702,1 +2667,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2712,1 +2677,1 @@\n-        double res = Double.NEGATIVE_INFINITY;\n+        double res = MAX_IDENTITY;\n@@ -2726,1 +2691,1 @@\n-        double ra = Double.NEGATIVE_INFINITY;\n+        double ra = 0;\n@@ -2729,0 +2694,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2732,8 +2698,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Double.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = (double) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (double) Math.max(ra, r[i]);\n@@ -2748,1 +2707,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2757,1 +2716,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2769,1 +2728,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2772,0 +2731,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2775,8 +2735,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2791,1 +2744,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2801,1 +2754,1 @@\n-        double res = (double) 0;\n+        double res = FIRST_NONZERO_IDENTITY;\n@@ -2815,1 +2768,1 @@\n-        double ra = (double) 0;\n+        double ra = 0;\n@@ -2818,0 +2771,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2821,8 +2775,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (double) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -5010,0 +4957,51 @@\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            double x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((double)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Double.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Double.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((double) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((double)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"doubleUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<double[]> fa) {\n+        double[] a = fa.apply(SPECIES.length());\n+        VectorMask<Double> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            DoubleVector av = DoubleVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/DoubleMaxVectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2398,1 +2405,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2407,1 +2414,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2422,0 +2429,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2425,8 +2433,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2441,1 +2442,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2451,1 +2452,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2468,0 +2469,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2471,8 +2473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2487,1 +2482,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2496,1 +2491,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2508,1 +2503,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2511,0 +2506,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2514,8 +2510,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2530,1 +2519,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2540,1 +2529,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2554,1 +2543,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2557,0 +2546,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2560,8 +2550,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2576,1 +2559,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2585,1 +2568,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2597,1 +2580,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2600,0 +2583,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2603,8 +2587,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2619,1 +2596,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2629,1 +2606,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2643,1 +2620,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2646,0 +2623,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2649,8 +2627,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2665,1 +2636,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2674,1 +2645,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2686,1 +2657,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2689,0 +2660,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2692,8 +2664,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2708,1 +2673,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2718,1 +2683,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2732,1 +2697,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2735,0 +2700,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2738,8 +2704,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2754,1 +2713,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2763,1 +2722,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2775,1 +2734,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2778,0 +2737,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2781,8 +2741,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2797,1 +2750,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2807,1 +2760,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2821,1 +2774,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2824,0 +2777,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2827,8 +2781,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4974,0 +4921,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float128VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2398,1 +2405,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2407,1 +2414,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2422,0 +2429,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2425,8 +2433,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2441,1 +2442,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2451,1 +2452,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2468,0 +2469,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2471,8 +2473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2487,1 +2482,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2496,1 +2491,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2508,1 +2503,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2511,0 +2506,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2514,8 +2510,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2530,1 +2519,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2540,1 +2529,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2554,1 +2543,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2557,0 +2546,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2560,8 +2550,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2576,1 +2559,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2585,1 +2568,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2597,1 +2580,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2600,0 +2583,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2603,8 +2587,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2619,1 +2596,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2629,1 +2606,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2643,1 +2620,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2646,0 +2623,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2649,8 +2627,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2665,1 +2636,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2674,1 +2645,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2686,1 +2657,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2689,0 +2660,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2692,8 +2664,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2708,1 +2673,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2718,1 +2683,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2732,1 +2697,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2735,0 +2700,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2738,8 +2704,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2754,1 +2713,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2763,1 +2722,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2775,1 +2734,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2778,0 +2737,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2781,8 +2741,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2797,1 +2750,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2807,1 +2760,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2821,1 +2774,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2824,0 +2777,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2827,8 +2781,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4974,0 +4921,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float256VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2398,1 +2405,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2407,1 +2414,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2422,0 +2429,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2425,8 +2433,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2441,1 +2442,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2451,1 +2452,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2468,0 +2469,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2471,8 +2473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2487,1 +2482,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2496,1 +2491,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2508,1 +2503,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2511,0 +2506,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2514,8 +2510,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2530,1 +2519,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2540,1 +2529,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2554,1 +2543,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2557,0 +2546,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2560,8 +2550,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2576,1 +2559,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2585,1 +2568,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2597,1 +2580,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2600,0 +2583,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2603,8 +2587,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2619,1 +2596,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2629,1 +2606,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2643,1 +2620,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2646,0 +2623,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2649,8 +2627,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2665,1 +2636,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2674,1 +2645,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2686,1 +2657,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2689,0 +2660,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2692,8 +2664,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2708,1 +2673,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2718,1 +2683,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2732,1 +2697,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2735,0 +2700,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2738,8 +2704,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2754,1 +2713,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2763,1 +2722,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2775,1 +2734,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2778,0 +2737,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2781,8 +2741,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2797,1 +2750,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2807,1 +2760,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2821,1 +2774,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2824,0 +2777,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2827,8 +2781,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4974,0 +4921,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float512VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2398,1 +2405,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2407,1 +2414,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2422,0 +2429,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2425,8 +2433,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2441,1 +2442,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2451,1 +2452,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2468,0 +2469,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2471,8 +2473,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2487,1 +2482,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2496,1 +2491,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2508,1 +2503,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2511,0 +2506,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2514,8 +2510,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2530,1 +2519,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2540,1 +2529,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2554,1 +2543,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2557,0 +2546,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2560,8 +2550,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2576,1 +2559,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2585,1 +2568,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2597,1 +2580,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2600,0 +2583,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2603,8 +2587,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2619,1 +2596,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2629,1 +2606,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2643,1 +2620,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2646,0 +2623,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2649,8 +2627,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2665,1 +2636,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2674,1 +2645,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2686,1 +2657,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2689,0 +2660,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2692,8 +2664,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2708,1 +2673,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2718,1 +2683,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2732,1 +2697,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2735,0 +2700,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2738,8 +2704,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2754,1 +2713,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2763,1 +2722,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2775,1 +2734,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2778,0 +2737,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2781,8 +2741,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2797,1 +2750,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2807,1 +2760,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2821,1 +2774,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2824,0 +2777,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2827,8 +2781,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4974,0 +4921,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float64VectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,0 +71,7 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final float ADD_IDENTITY = (float)0;\n+    private static final float FIRST_NONZERO_IDENTITY = (float)0;\n+    private static final float MAX_IDENTITY = Float.NEGATIVE_INFINITY;\n+    private static final float MIN_IDENTITY = Float.POSITIVE_INFINITY;\n+    private static final float MUL_IDENTITY = (float)1;\n@@ -2403,1 +2410,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2412,1 +2419,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2427,0 +2434,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2430,8 +2438,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -2446,1 +2447,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2456,1 +2457,1 @@\n-        float res = 0;\n+        float res = ADD_IDENTITY;\n@@ -2473,0 +2474,1 @@\n+            ra = ADD_IDENTITY;\n@@ -2476,8 +2478,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -2492,1 +2487,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2501,1 +2496,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2513,1 +2508,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2516,0 +2511,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2519,8 +2515,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -2535,1 +2524,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2545,1 +2534,1 @@\n-        float res = 1;\n+        float res = MUL_IDENTITY;\n@@ -2559,1 +2548,1 @@\n-        float ra = 1;\n+        float ra = 0;\n@@ -2562,0 +2551,1 @@\n+            ra = MUL_IDENTITY;\n@@ -2565,8 +2555,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -2581,1 +2564,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2590,1 +2573,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2602,1 +2585,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2605,0 +2588,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2608,8 +2592,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2624,1 +2601,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2634,1 +2611,1 @@\n-        float res = Float.POSITIVE_INFINITY;\n+        float res = MIN_IDENTITY;\n@@ -2648,1 +2625,1 @@\n-        float ra = Float.POSITIVE_INFINITY;\n+        float ra = 0;\n@@ -2651,0 +2628,1 @@\n+            ra = MIN_IDENTITY;\n@@ -2654,8 +2632,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.POSITIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (float) Math.min(ra, r[i]);\n@@ -2670,1 +2641,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2679,1 +2650,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2691,1 +2662,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2694,0 +2665,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2697,8 +2669,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2713,1 +2678,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2723,1 +2688,1 @@\n-        float res = Float.NEGATIVE_INFINITY;\n+        float res = MAX_IDENTITY;\n@@ -2737,1 +2702,1 @@\n-        float ra = Float.NEGATIVE_INFINITY;\n+        float ra = 0;\n@@ -2740,0 +2705,1 @@\n+            ra = MAX_IDENTITY;\n@@ -2743,8 +2709,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Float.NEGATIVE_INFINITY;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = (float) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (float) Math.max(ra, r[i]);\n@@ -2759,1 +2718,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2768,1 +2727,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2780,1 +2739,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2783,0 +2742,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2786,8 +2746,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -2802,1 +2755,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2812,1 +2765,1 @@\n-        float res = (float) 0;\n+        float res = FIRST_NONZERO_IDENTITY;\n@@ -2826,1 +2779,1 @@\n-        float ra = (float) 0;\n+        float ra = 0;\n@@ -2829,0 +2782,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -2832,8 +2786,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (float) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4979,0 +4926,51 @@\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            float x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((float)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Float.NEGATIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Float.POSITIVE_INFINITY, x) == x\n+            Assert.assertEquals((float) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((float)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"floatUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<float[]> fa) {\n+        float[] a = fa.apply(SPECIES.length());\n+        VectorMask<Float> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            FloatVector av = FloatVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/FloatMaxVectorTests.java","additions":107,"deletions":109,"binary":false,"changes":216,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3658,1 +3671,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3667,1 +3680,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3679,1 +3692,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3682,0 +3695,1 @@\n+            ra = AND_IDENTITY;\n@@ -3685,8 +3699,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3701,1 +3708,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3711,1 +3718,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3725,1 +3732,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3728,0 +3735,1 @@\n+            ra = AND_IDENTITY;\n@@ -3731,8 +3739,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3747,1 +3748,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3756,1 +3757,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3771,0 +3772,1 @@\n+            ra = OR_IDENTITY;\n@@ -3774,8 +3776,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3790,1 +3785,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3800,1 +3795,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3817,0 +3812,1 @@\n+            ra = OR_IDENTITY;\n@@ -3820,8 +3816,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3836,1 +3825,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3845,1 +3834,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3860,0 +3849,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3863,8 +3853,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3879,1 +3862,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3889,1 +3872,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3906,0 +3889,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3909,8 +3893,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3925,1 +3902,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3934,1 +3911,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3949,0 +3926,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3952,8 +3930,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3968,1 +3939,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3978,1 +3949,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3995,0 +3966,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3998,8 +3970,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4014,1 +3979,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4023,1 +3988,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4035,1 +4000,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4038,0 +4003,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4041,8 +4007,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4057,1 +4016,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4067,1 +4026,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4081,1 +4040,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4084,0 +4043,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4087,8 +4047,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4103,1 +4056,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4112,1 +4065,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4124,1 +4077,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4127,0 +4080,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4130,8 +4084,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4146,1 +4093,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4156,1 +4103,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4170,1 +4117,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4173,0 +4120,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4176,8 +4124,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4192,1 +4133,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4201,1 +4142,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4213,1 +4154,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4216,0 +4157,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4219,8 +4161,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4235,1 +4170,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4245,1 +4180,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4259,1 +4194,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4262,0 +4197,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4265,8 +4201,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4281,1 +4210,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4290,1 +4219,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4302,1 +4231,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4305,0 +4234,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4308,8 +4238,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4324,1 +4247,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4334,1 +4257,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4348,1 +4271,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4351,0 +4274,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4354,8 +4278,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4370,1 +4287,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4379,1 +4296,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4391,1 +4308,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4394,0 +4311,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4397,8 +4315,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4413,1 +4324,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4423,1 +4334,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4437,1 +4348,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4440,0 +4351,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4443,8 +4355,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4459,1 +4364,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4373,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4480,1 +4385,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4483,0 +4388,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4486,8 +4392,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4502,1 +4401,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4512,1 +4411,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4526,1 +4425,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4529,0 +4428,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4532,8 +4432,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4596,1 +4489,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4605,1 +4498,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4513,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4517,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4639,1 +4526,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4649,1 +4536,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4665,0 +4552,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4668,8 +4556,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6633,0 +6514,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3658,1 +3671,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3667,1 +3680,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3679,1 +3692,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3682,0 +3695,1 @@\n+            ra = AND_IDENTITY;\n@@ -3685,8 +3699,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3701,1 +3708,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3711,1 +3718,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3725,1 +3732,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3728,0 +3735,1 @@\n+            ra = AND_IDENTITY;\n@@ -3731,8 +3739,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3747,1 +3748,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3756,1 +3757,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3771,0 +3772,1 @@\n+            ra = OR_IDENTITY;\n@@ -3774,8 +3776,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3790,1 +3785,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3800,1 +3795,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3817,0 +3812,1 @@\n+            ra = OR_IDENTITY;\n@@ -3820,8 +3816,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3836,1 +3825,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3845,1 +3834,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3860,0 +3849,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3863,8 +3853,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3879,1 +3862,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3889,1 +3872,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3906,0 +3889,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3909,8 +3893,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3925,1 +3902,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3934,1 +3911,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3949,0 +3926,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3952,8 +3930,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3968,1 +3939,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3978,1 +3949,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3995,0 +3966,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3998,8 +3970,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4014,1 +3979,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4023,1 +3988,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4035,1 +4000,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4038,0 +4003,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4041,8 +4007,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4057,1 +4016,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4067,1 +4026,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4081,1 +4040,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4084,0 +4043,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4087,8 +4047,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4103,1 +4056,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4112,1 +4065,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4124,1 +4077,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4127,0 +4080,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4130,8 +4084,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4146,1 +4093,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4156,1 +4103,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4170,1 +4117,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4173,0 +4120,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4176,8 +4124,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4192,1 +4133,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4201,1 +4142,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4213,1 +4154,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4216,0 +4157,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4219,8 +4161,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4235,1 +4170,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4245,1 +4180,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4259,1 +4194,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4262,0 +4197,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4265,8 +4201,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4281,1 +4210,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4290,1 +4219,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4302,1 +4231,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4305,0 +4234,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4308,8 +4238,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4324,1 +4247,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4334,1 +4257,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4348,1 +4271,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4351,0 +4274,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4354,8 +4278,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4370,1 +4287,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4379,1 +4296,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4391,1 +4308,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4394,0 +4311,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4397,8 +4315,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4413,1 +4324,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4423,1 +4334,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4437,1 +4348,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4440,0 +4351,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4443,8 +4355,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4459,1 +4364,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4373,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4480,1 +4385,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4483,0 +4388,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4486,8 +4392,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4502,1 +4401,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4512,1 +4411,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4526,1 +4425,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4529,0 +4428,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4532,8 +4432,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4596,1 +4489,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4605,1 +4498,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4513,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4517,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4639,1 +4526,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4649,1 +4536,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4665,0 +4552,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4668,8 +4556,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6633,0 +6514,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3658,1 +3671,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3667,1 +3680,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3679,1 +3692,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3682,0 +3695,1 @@\n+            ra = AND_IDENTITY;\n@@ -3685,8 +3699,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3701,1 +3708,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3711,1 +3718,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3725,1 +3732,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3728,0 +3735,1 @@\n+            ra = AND_IDENTITY;\n@@ -3731,8 +3739,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3747,1 +3748,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3756,1 +3757,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3771,0 +3772,1 @@\n+            ra = OR_IDENTITY;\n@@ -3774,8 +3776,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3790,1 +3785,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3800,1 +3795,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3817,0 +3812,1 @@\n+            ra = OR_IDENTITY;\n@@ -3820,8 +3816,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3836,1 +3825,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3845,1 +3834,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3860,0 +3849,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3863,8 +3853,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3879,1 +3862,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3889,1 +3872,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3906,0 +3889,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3909,8 +3893,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3925,1 +3902,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3934,1 +3911,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3949,0 +3926,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3952,8 +3930,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3968,1 +3939,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3978,1 +3949,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3995,0 +3966,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3998,8 +3970,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4014,1 +3979,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4023,1 +3988,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4035,1 +4000,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4038,0 +4003,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4041,8 +4007,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4057,1 +4016,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4067,1 +4026,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4081,1 +4040,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4084,0 +4043,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4087,8 +4047,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4103,1 +4056,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4112,1 +4065,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4124,1 +4077,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4127,0 +4080,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4130,8 +4084,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4146,1 +4093,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4156,1 +4103,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4170,1 +4117,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4173,0 +4120,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4176,8 +4124,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4192,1 +4133,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4201,1 +4142,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4213,1 +4154,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4216,0 +4157,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4219,8 +4161,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4235,1 +4170,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4245,1 +4180,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4259,1 +4194,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4262,0 +4197,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4265,8 +4201,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4281,1 +4210,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4290,1 +4219,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4302,1 +4231,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4305,0 +4234,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4308,8 +4238,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4324,1 +4247,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4334,1 +4257,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4348,1 +4271,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4351,0 +4274,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4354,8 +4278,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4370,1 +4287,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4379,1 +4296,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4391,1 +4308,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4394,0 +4311,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4397,8 +4315,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4413,1 +4324,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4423,1 +4334,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4437,1 +4348,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4440,0 +4351,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4443,8 +4355,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4459,1 +4364,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4373,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4480,1 +4385,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4483,0 +4388,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4486,8 +4392,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4502,1 +4401,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4512,1 +4411,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4526,1 +4425,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4529,0 +4428,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4532,8 +4432,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4596,1 +4489,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4605,1 +4498,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4513,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4517,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4639,1 +4526,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4649,1 +4536,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4665,0 +4552,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4668,8 +4556,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6633,0 +6514,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3658,1 +3671,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3667,1 +3680,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3679,1 +3692,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3682,0 +3695,1 @@\n+            ra = AND_IDENTITY;\n@@ -3685,8 +3699,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3701,1 +3708,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3711,1 +3718,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3725,1 +3732,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3728,0 +3735,1 @@\n+            ra = AND_IDENTITY;\n@@ -3731,8 +3739,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3747,1 +3748,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3756,1 +3757,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3771,0 +3772,1 @@\n+            ra = OR_IDENTITY;\n@@ -3774,8 +3776,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3790,1 +3785,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3800,1 +3795,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3817,0 +3812,1 @@\n+            ra = OR_IDENTITY;\n@@ -3820,8 +3816,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3836,1 +3825,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3845,1 +3834,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3860,0 +3849,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3863,8 +3853,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3879,1 +3862,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3889,1 +3872,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3906,0 +3889,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3909,8 +3893,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3925,1 +3902,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3934,1 +3911,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3949,0 +3926,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3952,8 +3930,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3968,1 +3939,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3978,1 +3949,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3995,0 +3966,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3998,8 +3970,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4014,1 +3979,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4023,1 +3988,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4035,1 +4000,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4038,0 +4003,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4041,8 +4007,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4057,1 +4016,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4067,1 +4026,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4081,1 +4040,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4084,0 +4043,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4087,8 +4047,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4103,1 +4056,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4112,1 +4065,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4124,1 +4077,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4127,0 +4080,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4130,8 +4084,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4146,1 +4093,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4156,1 +4103,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4170,1 +4117,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4173,0 +4120,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4176,8 +4124,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4192,1 +4133,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4201,1 +4142,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4213,1 +4154,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4216,0 +4157,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4219,8 +4161,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4235,1 +4170,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4245,1 +4180,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4259,1 +4194,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4262,0 +4197,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4265,8 +4201,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4281,1 +4210,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4290,1 +4219,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4302,1 +4231,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4305,0 +4234,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4308,8 +4238,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4324,1 +4247,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4334,1 +4257,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4348,1 +4271,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4351,0 +4274,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4354,8 +4278,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4370,1 +4287,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4379,1 +4296,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4391,1 +4308,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4394,0 +4311,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4397,8 +4315,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4413,1 +4324,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4423,1 +4334,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4437,1 +4348,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4440,0 +4351,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4443,8 +4355,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4459,1 +4364,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4468,1 +4373,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4480,1 +4385,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4483,0 +4388,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4486,8 +4392,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4502,1 +4401,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4512,1 +4411,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4526,1 +4425,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4529,0 +4428,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4532,8 +4432,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4596,1 +4489,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4605,1 +4498,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4620,0 +4513,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4623,8 +4517,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4639,1 +4526,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4649,1 +4536,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4665,0 +4552,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4668,8 +4556,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6633,0 +6514,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Int64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final int ADD_IDENTITY = (int)0;\n+    private static final int AND_IDENTITY = (int)-1;\n+    private static final int FIRST_NONZERO_IDENTITY = (int)0;\n+    private static final int MAX_IDENTITY = Integer.MIN_VALUE;\n+    private static final int MIN_IDENTITY = Integer.MAX_VALUE;\n+    private static final int MUL_IDENTITY = (int)1;\n+    private static final int OR_IDENTITY = (int)0;\n+    private static final int SUADD_IDENTITY = (int)0;\n+    private static final int UMAX_IDENTITY = (int)0;   \/\/ Minimum unsigned value\n+    private static final int UMIN_IDENTITY = (int)-1;  \/\/ Maximum unsigned value\n+    private static final int XOR_IDENTITY = (int)0;\n+\n@@ -3663,1 +3676,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3672,1 +3685,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3684,1 +3697,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3687,0 +3700,1 @@\n+            ra = AND_IDENTITY;\n@@ -3690,8 +3704,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3706,1 +3713,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3716,1 +3723,1 @@\n-        int res = -1;\n+        int res = AND_IDENTITY;\n@@ -3730,1 +3737,1 @@\n-        int ra = -1;\n+        int ra = 0;\n@@ -3733,0 +3740,1 @@\n+            ra = AND_IDENTITY;\n@@ -3736,8 +3744,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3752,1 +3753,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3761,1 +3762,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3776,0 +3777,1 @@\n+            ra = OR_IDENTITY;\n@@ -3779,8 +3781,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3795,1 +3790,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3805,1 +3800,1 @@\n-        int res = 0;\n+        int res = OR_IDENTITY;\n@@ -3822,0 +3817,1 @@\n+            ra = OR_IDENTITY;\n@@ -3825,8 +3821,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3841,1 +3830,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3850,1 +3839,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3865,0 +3854,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3868,8 +3858,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3884,1 +3867,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3894,1 +3877,1 @@\n-        int res = 0;\n+        int res = XOR_IDENTITY;\n@@ -3911,0 +3894,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3914,8 +3898,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3930,1 +3907,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3939,1 +3916,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3954,0 +3931,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3957,8 +3935,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3973,1 +3944,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -3983,1 +3954,1 @@\n-        int res = 0;\n+        int res = ADD_IDENTITY;\n@@ -4000,0 +3971,1 @@\n+            ra = ADD_IDENTITY;\n@@ -4003,8 +3975,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4019,1 +3984,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4028,1 +3993,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4040,1 +4005,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4043,0 +4008,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4046,8 +4012,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4062,1 +4021,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4072,1 +4031,1 @@\n-        int res = 1;\n+        int res = MUL_IDENTITY;\n@@ -4086,1 +4045,1 @@\n-        int ra = 1;\n+        int ra = 0;\n@@ -4089,0 +4048,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4092,8 +4052,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4108,1 +4061,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4117,1 +4070,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4129,1 +4082,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4132,0 +4085,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4135,8 +4089,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4151,1 +4098,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4161,1 +4108,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = MIN_IDENTITY;\n@@ -4175,1 +4122,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4178,0 +4125,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4181,8 +4129,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (int) Math.min(ra, r[i]);\n@@ -4197,1 +4138,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4206,1 +4147,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4218,1 +4159,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4221,0 +4162,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4224,8 +4166,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4240,1 +4175,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4250,1 +4185,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = MAX_IDENTITY;\n@@ -4264,1 +4199,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4267,0 +4202,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4270,8 +4206,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (int) Math.max(ra, r[i]);\n@@ -4286,1 +4215,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4295,1 +4224,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4307,1 +4236,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4310,0 +4239,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4313,8 +4243,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4329,1 +4252,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4339,1 +4262,1 @@\n-        int res = Integer.MAX_VALUE;\n+        int res = UMIN_IDENTITY;\n@@ -4353,1 +4276,1 @@\n-        int ra = Integer.MAX_VALUE;\n+        int ra = 0;\n@@ -4356,0 +4279,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4359,8 +4283,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (int) VectorMath.minUnsigned(ra, r[i]);\n@@ -4375,1 +4292,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4384,1 +4301,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4396,1 +4313,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4399,0 +4316,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4402,8 +4320,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4418,1 +4329,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4428,1 +4339,1 @@\n-        int res = Integer.MIN_VALUE;\n+        int res = UMAX_IDENTITY;\n@@ -4442,1 +4353,1 @@\n-        int ra = Integer.MIN_VALUE;\n+        int ra = 0;\n@@ -4445,0 +4356,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4448,8 +4360,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Integer.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (int) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4464,1 +4369,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4473,1 +4378,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4485,1 +4390,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4488,0 +4393,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4491,8 +4397,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4507,1 +4406,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4517,1 +4416,1 @@\n-        int res = (int) 0;\n+        int res = FIRST_NONZERO_IDENTITY;\n@@ -4531,1 +4430,1 @@\n-        int ra = (int) 0;\n+        int ra = 0;\n@@ -4534,0 +4433,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4537,8 +4437,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (int) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4601,1 +4494,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4610,1 +4503,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4625,0 +4518,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4628,8 +4522,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4644,1 +4531,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4654,1 +4541,1 @@\n-        int res = 0;\n+        int res = SUADD_IDENTITY;\n@@ -4670,0 +4557,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4673,8 +4561,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                IntVector av = IntVector.fromArray(SPECIES, a, i);\n-                ra = (int) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (int) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6638,0 +6519,87 @@\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            int x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((int)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((int)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Integer.MIN_VALUE, x) == x\n+            Assert.assertEquals((int) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Integer.MAX_VALUE, x) == x\n+            Assert.assertEquals((int) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((int)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((int)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((int) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((int) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((int)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"intUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<int[]> fa) {\n+        int[] a = fa.apply(SPECIES.length());\n+        VectorMask<Integer> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            IntVector av = IntVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/IntMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3680,1 +3693,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3689,1 +3702,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3701,1 +3714,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3704,0 +3717,1 @@\n+            ra = AND_IDENTITY;\n@@ -3707,8 +3721,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3723,1 +3730,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3733,1 +3740,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3747,1 +3754,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3750,0 +3757,1 @@\n+            ra = AND_IDENTITY;\n@@ -3753,8 +3761,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3769,1 +3770,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3778,1 +3779,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3793,0 +3794,1 @@\n+            ra = OR_IDENTITY;\n@@ -3796,8 +3798,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3812,1 +3807,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3822,1 +3817,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3839,0 +3834,1 @@\n+            ra = OR_IDENTITY;\n@@ -3842,8 +3838,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3858,1 +3847,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3867,1 +3856,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3882,0 +3871,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3885,8 +3875,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3901,1 +3884,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3911,1 +3894,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3928,0 +3911,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3931,8 +3915,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3947,1 +3924,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3956,1 +3933,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3971,0 +3948,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3974,8 +3952,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3990,1 +3961,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4000,1 +3971,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4017,0 +3988,1 @@\n+            ra = ADD_IDENTITY;\n@@ -4020,8 +3992,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4036,1 +4001,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4045,1 +4010,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4057,1 +4022,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4060,0 +4025,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4063,8 +4029,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4079,1 +4038,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4089,1 +4048,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4103,1 +4062,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4106,0 +4065,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4109,8 +4069,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4125,1 +4078,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4134,1 +4087,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4146,1 +4099,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4149,0 +4102,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4152,8 +4106,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4168,1 +4115,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4178,1 +4125,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4192,1 +4139,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4195,0 +4142,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4198,8 +4146,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4214,1 +4155,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4223,1 +4164,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4235,1 +4176,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4238,0 +4179,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4241,8 +4183,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4257,1 +4192,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4267,1 +4202,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4281,1 +4216,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4284,0 +4219,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4287,8 +4223,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4303,1 +4232,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4312,1 +4241,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4324,1 +4253,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4327,0 +4256,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4330,8 +4260,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4346,1 +4269,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4356,1 +4279,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4370,1 +4293,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4373,0 +4296,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4376,8 +4300,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4392,1 +4309,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4401,1 +4318,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4413,1 +4330,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4416,0 +4333,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4419,8 +4337,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4435,1 +4346,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4445,1 +4356,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4459,1 +4370,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4462,0 +4373,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4465,8 +4377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4481,1 +4386,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4490,1 +4395,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4502,1 +4407,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4505,0 +4410,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4508,8 +4414,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4524,1 +4423,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4534,1 +4433,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4548,1 +4447,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4551,0 +4450,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4554,8 +4454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4618,1 +4511,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4627,1 +4520,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4535,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4661,1 +4548,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4671,1 +4558,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4687,0 +4574,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4690,8 +4578,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6585,0 +6466,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3680,1 +3693,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3689,1 +3702,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3701,1 +3714,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3704,0 +3717,1 @@\n+            ra = AND_IDENTITY;\n@@ -3707,8 +3721,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3723,1 +3730,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3733,1 +3740,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3747,1 +3754,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3750,0 +3757,1 @@\n+            ra = AND_IDENTITY;\n@@ -3753,8 +3761,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3769,1 +3770,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3778,1 +3779,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3793,0 +3794,1 @@\n+            ra = OR_IDENTITY;\n@@ -3796,8 +3798,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3812,1 +3807,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3822,1 +3817,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3839,0 +3834,1 @@\n+            ra = OR_IDENTITY;\n@@ -3842,8 +3838,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3858,1 +3847,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3867,1 +3856,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3882,0 +3871,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3885,8 +3875,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3901,1 +3884,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3911,1 +3894,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3928,0 +3911,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3931,8 +3915,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3947,1 +3924,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3956,1 +3933,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3971,0 +3948,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3974,8 +3952,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3990,1 +3961,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4000,1 +3971,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4017,0 +3988,1 @@\n+            ra = ADD_IDENTITY;\n@@ -4020,8 +3992,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4036,1 +4001,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4045,1 +4010,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4057,1 +4022,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4060,0 +4025,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4063,8 +4029,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4079,1 +4038,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4089,1 +4048,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4103,1 +4062,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4106,0 +4065,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4109,8 +4069,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4125,1 +4078,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4134,1 +4087,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4146,1 +4099,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4149,0 +4102,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4152,8 +4106,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4168,1 +4115,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4178,1 +4125,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4192,1 +4139,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4195,0 +4142,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4198,8 +4146,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4214,1 +4155,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4223,1 +4164,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4235,1 +4176,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4238,0 +4179,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4241,8 +4183,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4257,1 +4192,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4267,1 +4202,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4281,1 +4216,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4284,0 +4219,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4287,8 +4223,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4303,1 +4232,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4312,1 +4241,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4324,1 +4253,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4327,0 +4256,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4330,8 +4260,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4346,1 +4269,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4356,1 +4279,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4370,1 +4293,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4373,0 +4296,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4376,8 +4300,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4392,1 +4309,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4401,1 +4318,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4413,1 +4330,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4416,0 +4333,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4419,8 +4337,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4435,1 +4346,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4445,1 +4356,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4459,1 +4370,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4462,0 +4373,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4465,8 +4377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4481,1 +4386,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4490,1 +4395,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4502,1 +4407,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4505,0 +4410,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4508,8 +4414,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4524,1 +4423,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4534,1 +4433,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4548,1 +4447,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4551,0 +4450,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4554,8 +4454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4618,1 +4511,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4627,1 +4520,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4535,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4661,1 +4548,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4671,1 +4558,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4687,0 +4574,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4690,8 +4578,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6585,0 +6466,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3680,1 +3693,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3689,1 +3702,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3701,1 +3714,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3704,0 +3717,1 @@\n+            ra = AND_IDENTITY;\n@@ -3707,8 +3721,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3723,1 +3730,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3733,1 +3740,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3747,1 +3754,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3750,0 +3757,1 @@\n+            ra = AND_IDENTITY;\n@@ -3753,8 +3761,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3769,1 +3770,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3778,1 +3779,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3793,0 +3794,1 @@\n+            ra = OR_IDENTITY;\n@@ -3796,8 +3798,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3812,1 +3807,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3822,1 +3817,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3839,0 +3834,1 @@\n+            ra = OR_IDENTITY;\n@@ -3842,8 +3838,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3858,1 +3847,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3867,1 +3856,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3882,0 +3871,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3885,8 +3875,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3901,1 +3884,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3911,1 +3894,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3928,0 +3911,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3931,8 +3915,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3947,1 +3924,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3956,1 +3933,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3971,0 +3948,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3974,8 +3952,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3990,1 +3961,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4000,1 +3971,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4017,0 +3988,1 @@\n+            ra = ADD_IDENTITY;\n@@ -4020,8 +3992,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4036,1 +4001,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4045,1 +4010,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4057,1 +4022,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4060,0 +4025,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4063,8 +4029,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4079,1 +4038,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4089,1 +4048,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4103,1 +4062,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4106,0 +4065,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4109,8 +4069,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4125,1 +4078,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4134,1 +4087,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4146,1 +4099,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4149,0 +4102,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4152,8 +4106,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4168,1 +4115,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4178,1 +4125,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4192,1 +4139,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4195,0 +4142,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4198,8 +4146,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4214,1 +4155,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4223,1 +4164,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4235,1 +4176,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4238,0 +4179,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4241,8 +4183,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4257,1 +4192,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4267,1 +4202,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4281,1 +4216,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4284,0 +4219,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4287,8 +4223,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4303,1 +4232,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4312,1 +4241,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4324,1 +4253,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4327,0 +4256,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4330,8 +4260,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4346,1 +4269,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4356,1 +4279,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4370,1 +4293,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4373,0 +4296,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4376,8 +4300,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4392,1 +4309,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4401,1 +4318,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4413,1 +4330,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4416,0 +4333,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4419,8 +4337,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4435,1 +4346,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4445,1 +4356,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4459,1 +4370,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4462,0 +4373,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4465,8 +4377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4481,1 +4386,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4490,1 +4395,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4502,1 +4407,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4505,0 +4410,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4508,8 +4414,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4524,1 +4423,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4534,1 +4433,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4548,1 +4447,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4551,0 +4450,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4554,8 +4454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4618,1 +4511,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4627,1 +4520,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4535,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4661,1 +4548,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4671,1 +4558,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4687,0 +4574,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4690,8 +4578,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6585,0 +6466,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3680,1 +3693,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3689,1 +3702,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3701,1 +3714,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3704,0 +3717,1 @@\n+            ra = AND_IDENTITY;\n@@ -3707,8 +3721,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3723,1 +3730,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3733,1 +3740,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3747,1 +3754,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3750,0 +3757,1 @@\n+            ra = AND_IDENTITY;\n@@ -3753,8 +3761,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3769,1 +3770,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3778,1 +3779,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3793,0 +3794,1 @@\n+            ra = OR_IDENTITY;\n@@ -3796,8 +3798,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3812,1 +3807,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3822,1 +3817,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3839,0 +3834,1 @@\n+            ra = OR_IDENTITY;\n@@ -3842,8 +3838,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3858,1 +3847,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3867,1 +3856,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3882,0 +3871,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3885,8 +3875,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3901,1 +3884,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3911,1 +3894,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3928,0 +3911,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3931,8 +3915,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3947,1 +3924,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3956,1 +3933,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3971,0 +3948,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3974,8 +3952,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3990,1 +3961,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4000,1 +3971,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4017,0 +3988,1 @@\n+            ra = ADD_IDENTITY;\n@@ -4020,8 +3992,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4036,1 +4001,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4045,1 +4010,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4057,1 +4022,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4060,0 +4025,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4063,8 +4029,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4079,1 +4038,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4089,1 +4048,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4103,1 +4062,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4106,0 +4065,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4109,8 +4069,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4125,1 +4078,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4134,1 +4087,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4146,1 +4099,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4149,0 +4102,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4152,8 +4106,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4168,1 +4115,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4178,1 +4125,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4192,1 +4139,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4195,0 +4142,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4198,8 +4146,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4214,1 +4155,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4223,1 +4164,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4235,1 +4176,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4238,0 +4179,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4241,8 +4183,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4257,1 +4192,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4267,1 +4202,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4281,1 +4216,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4284,0 +4219,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4287,8 +4223,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4303,1 +4232,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4312,1 +4241,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4324,1 +4253,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4327,0 +4256,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4330,8 +4260,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4346,1 +4269,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4356,1 +4279,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4370,1 +4293,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4373,0 +4296,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4376,8 +4300,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4392,1 +4309,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4401,1 +4318,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4413,1 +4330,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4416,0 +4333,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4419,8 +4337,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4435,1 +4346,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4445,1 +4356,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4459,1 +4370,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4462,0 +4373,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4465,8 +4377,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4481,1 +4386,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4490,1 +4395,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4502,1 +4407,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4505,0 +4410,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4508,8 +4414,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4524,1 +4423,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4534,1 +4433,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4548,1 +4447,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4551,0 +4450,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4554,8 +4454,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4618,1 +4511,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4627,1 +4520,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4642,0 +4535,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4645,8 +4539,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4661,1 +4548,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4671,1 +4558,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4687,0 +4574,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4690,8 +4578,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6585,0 +6466,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Long64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final long ADD_IDENTITY = (long)0;\n+    private static final long AND_IDENTITY = (long)-1;\n+    private static final long FIRST_NONZERO_IDENTITY = (long)0;\n+    private static final long MAX_IDENTITY = Long.MIN_VALUE;\n+    private static final long MIN_IDENTITY = Long.MAX_VALUE;\n+    private static final long MUL_IDENTITY = (long)1;\n+    private static final long OR_IDENTITY = (long)0;\n+    private static final long SUADD_IDENTITY = (long)0;\n+    private static final long UMAX_IDENTITY = (long)0;   \/\/ Minimum unsigned value\n+    private static final long UMIN_IDENTITY = (long)-1;  \/\/ Maximum unsigned value\n+    private static final long XOR_IDENTITY = (long)0;\n+\n@@ -3685,1 +3698,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3694,1 +3707,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3706,1 +3719,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3709,0 +3722,1 @@\n+            ra = AND_IDENTITY;\n@@ -3712,8 +3726,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3728,1 +3735,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3738,1 +3745,1 @@\n-        long res = -1;\n+        long res = AND_IDENTITY;\n@@ -3752,1 +3759,1 @@\n-        long ra = -1;\n+        long ra = 0;\n@@ -3755,0 +3762,1 @@\n+            ra = AND_IDENTITY;\n@@ -3758,8 +3766,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3774,1 +3775,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3783,1 +3784,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3798,0 +3799,1 @@\n+            ra = OR_IDENTITY;\n@@ -3801,8 +3803,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3817,1 +3812,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3827,1 +3822,1 @@\n-        long res = 0;\n+        long res = OR_IDENTITY;\n@@ -3844,0 +3839,1 @@\n+            ra = OR_IDENTITY;\n@@ -3847,8 +3843,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3863,1 +3852,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3872,1 +3861,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3887,0 +3876,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3890,8 +3880,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3906,1 +3889,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3916,1 +3899,1 @@\n-        long res = 0;\n+        long res = XOR_IDENTITY;\n@@ -3933,0 +3916,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3936,8 +3920,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3952,1 +3929,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3961,1 +3938,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -3976,0 +3953,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3979,8 +3957,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3995,1 +3966,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4005,1 +3976,1 @@\n-        long res = 0;\n+        long res = ADD_IDENTITY;\n@@ -4022,0 +3993,1 @@\n+            ra = ADD_IDENTITY;\n@@ -4025,8 +3997,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -4041,1 +4006,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4050,1 +4015,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4062,1 +4027,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4065,0 +4030,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4068,8 +4034,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4084,1 +4043,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4094,1 +4053,1 @@\n-        long res = 1;\n+        long res = MUL_IDENTITY;\n@@ -4108,1 +4067,1 @@\n-        long ra = 1;\n+        long ra = 0;\n@@ -4111,0 +4070,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4114,8 +4074,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4130,1 +4083,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4139,1 +4092,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4151,1 +4104,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4154,0 +4107,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4157,8 +4111,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4173,1 +4120,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4183,1 +4130,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = MIN_IDENTITY;\n@@ -4197,1 +4144,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4200,0 +4147,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4203,8 +4151,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (long) Math.min(ra, r[i]);\n@@ -4219,1 +4160,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4228,1 +4169,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4240,1 +4181,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4243,0 +4184,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4246,8 +4188,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4262,1 +4197,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4272,1 +4207,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = MAX_IDENTITY;\n@@ -4286,1 +4221,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4289,0 +4224,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4292,8 +4228,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (long) Math.max(ra, r[i]);\n@@ -4308,1 +4237,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4317,1 +4246,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4329,1 +4258,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4332,0 +4261,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4335,8 +4265,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4351,1 +4274,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4361,1 +4284,1 @@\n-        long res = Long.MAX_VALUE;\n+        long res = UMIN_IDENTITY;\n@@ -4375,1 +4298,1 @@\n-        long ra = Long.MAX_VALUE;\n+        long ra = 0;\n@@ -4378,0 +4301,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4381,8 +4305,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (long) VectorMath.minUnsigned(ra, r[i]);\n@@ -4397,1 +4314,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4406,1 +4323,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4418,1 +4335,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4421,0 +4338,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4424,8 +4342,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4440,1 +4351,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4450,1 +4361,1 @@\n-        long res = Long.MIN_VALUE;\n+        long res = UMAX_IDENTITY;\n@@ -4464,1 +4375,1 @@\n-        long ra = Long.MIN_VALUE;\n+        long ra = 0;\n@@ -4467,0 +4378,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4470,8 +4382,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Long.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (long) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4486,1 +4391,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4495,1 +4400,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4507,1 +4412,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4510,0 +4415,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4513,8 +4419,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4529,1 +4428,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4539,1 +4438,1 @@\n-        long res = (long) 0;\n+        long res = FIRST_NONZERO_IDENTITY;\n@@ -4553,1 +4452,1 @@\n-        long ra = (long) 0;\n+        long ra = 0;\n@@ -4556,0 +4455,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4559,8 +4459,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (long) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4623,1 +4516,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4632,1 +4525,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4647,0 +4540,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4650,8 +4544,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4666,1 +4553,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4676,1 +4563,1 @@\n-        long res = 0;\n+        long res = SUADD_IDENTITY;\n@@ -4692,0 +4579,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4695,8 +4583,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                LongVector av = LongVector.fromArray(SPECIES, a, i);\n-                ra = (long) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (long) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6590,0 +6471,87 @@\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            long x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((long)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((long)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Long.MIN_VALUE, x) == x\n+            Assert.assertEquals((long) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Long.MAX_VALUE, x) == x\n+            Assert.assertEquals((long) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((long)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((long)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((long) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((long) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((long)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"longUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<long[]> fa) {\n+        long[] a = fa.apply(SPECIES.length());\n+        VectorMask<Long> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            LongVector av = LongVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/LongMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3605,1 +3618,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3614,1 +3627,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3626,1 +3639,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3629,0 +3642,1 @@\n+            ra = AND_IDENTITY;\n@@ -3632,8 +3646,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3648,1 +3655,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3658,1 +3665,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3672,1 +3679,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3675,0 +3682,1 @@\n+            ra = AND_IDENTITY;\n@@ -3678,8 +3686,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3694,1 +3695,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3703,1 +3704,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3718,0 +3719,1 @@\n+            ra = OR_IDENTITY;\n@@ -3721,8 +3723,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3737,1 +3732,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3747,1 +3742,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3764,0 +3759,1 @@\n+            ra = OR_IDENTITY;\n@@ -3767,8 +3763,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3783,1 +3772,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3792,1 +3781,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3807,0 +3796,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3810,8 +3800,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3826,1 +3809,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3836,1 +3819,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3853,0 +3836,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3856,8 +3840,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3872,1 +3849,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3881,1 +3858,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3896,0 +3873,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3899,8 +3877,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3915,1 +3886,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3925,1 +3896,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3942,0 +3913,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3945,8 +3917,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3961,1 +3926,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3970,1 +3935,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3982,1 +3947,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3985,0 +3950,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3988,8 +3954,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4004,1 +3963,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4014,1 +3973,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4028,1 +3987,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -4031,0 +3990,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4034,8 +3994,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4050,1 +4003,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4059,1 +4012,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4071,1 +4024,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4074,0 +4027,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4077,8 +4031,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4093,1 +4040,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4103,1 +4050,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4117,1 +4064,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4120,0 +4067,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4123,8 +4071,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4139,1 +4080,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4148,1 +4089,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4160,1 +4101,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4163,0 +4104,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4166,8 +4108,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4182,1 +4117,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4192,1 +4127,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4206,1 +4141,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4209,0 +4144,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4212,8 +4148,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4228,1 +4157,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4237,1 +4166,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4249,1 +4178,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4252,0 +4181,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4255,8 +4185,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4271,1 +4194,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4281,1 +4204,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4295,1 +4218,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4298,0 +4221,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4301,8 +4225,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4317,1 +4234,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4326,1 +4243,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4338,1 +4255,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4341,0 +4258,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4344,8 +4262,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4360,1 +4271,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4370,1 +4281,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4384,1 +4295,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4387,0 +4298,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4390,8 +4302,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4406,1 +4311,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4415,1 +4320,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4427,1 +4332,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4430,0 +4335,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4433,8 +4339,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4449,1 +4348,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4459,1 +4358,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4473,1 +4372,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4476,0 +4375,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4479,8 +4379,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4543,1 +4436,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4552,1 +4445,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4460,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4464,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4586,1 +4473,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4596,1 +4483,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4612,0 +4499,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4615,8 +4503,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6580,0 +6461,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short128VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3605,1 +3618,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3614,1 +3627,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3626,1 +3639,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3629,0 +3642,1 @@\n+            ra = AND_IDENTITY;\n@@ -3632,8 +3646,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3648,1 +3655,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3658,1 +3665,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3672,1 +3679,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3675,0 +3682,1 @@\n+            ra = AND_IDENTITY;\n@@ -3678,8 +3686,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3694,1 +3695,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3703,1 +3704,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3718,0 +3719,1 @@\n+            ra = OR_IDENTITY;\n@@ -3721,8 +3723,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3737,1 +3732,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3747,1 +3742,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3764,0 +3759,1 @@\n+            ra = OR_IDENTITY;\n@@ -3767,8 +3763,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3783,1 +3772,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3792,1 +3781,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3807,0 +3796,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3810,8 +3800,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3826,1 +3809,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3836,1 +3819,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3853,0 +3836,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3856,8 +3840,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3872,1 +3849,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3881,1 +3858,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3896,0 +3873,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3899,8 +3877,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3915,1 +3886,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3925,1 +3896,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3942,0 +3913,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3945,8 +3917,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3961,1 +3926,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3970,1 +3935,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3982,1 +3947,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3985,0 +3950,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3988,8 +3954,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4004,1 +3963,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4014,1 +3973,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4028,1 +3987,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -4031,0 +3990,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4034,8 +3994,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4050,1 +4003,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4059,1 +4012,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4071,1 +4024,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4074,0 +4027,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4077,8 +4031,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4093,1 +4040,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4103,1 +4050,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4117,1 +4064,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4120,0 +4067,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4123,8 +4071,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4139,1 +4080,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4148,1 +4089,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4160,1 +4101,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4163,0 +4104,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4166,8 +4108,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4182,1 +4117,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4192,1 +4127,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4206,1 +4141,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4209,0 +4144,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4212,8 +4148,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4228,1 +4157,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4237,1 +4166,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4249,1 +4178,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4252,0 +4181,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4255,8 +4185,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4271,1 +4194,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4281,1 +4204,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4295,1 +4218,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4298,0 +4221,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4301,8 +4225,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4317,1 +4234,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4326,1 +4243,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4338,1 +4255,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4341,0 +4258,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4344,8 +4262,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4360,1 +4271,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4370,1 +4281,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4384,1 +4295,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4387,0 +4298,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4390,8 +4302,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4406,1 +4311,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4415,1 +4320,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4427,1 +4332,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4430,0 +4335,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4433,8 +4339,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4449,1 +4348,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4459,1 +4358,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4473,1 +4372,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4476,0 +4375,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4479,8 +4379,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4543,1 +4436,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4552,1 +4445,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4460,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4464,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4586,1 +4473,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4596,1 +4483,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4612,0 +4499,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4615,8 +4503,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6580,0 +6461,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short256VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3605,1 +3618,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3614,1 +3627,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3626,1 +3639,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3629,0 +3642,1 @@\n+            ra = AND_IDENTITY;\n@@ -3632,8 +3646,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3648,1 +3655,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3658,1 +3665,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3672,1 +3679,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3675,0 +3682,1 @@\n+            ra = AND_IDENTITY;\n@@ -3678,8 +3686,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3694,1 +3695,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3703,1 +3704,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3718,0 +3719,1 @@\n+            ra = OR_IDENTITY;\n@@ -3721,8 +3723,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3737,1 +3732,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3747,1 +3742,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3764,0 +3759,1 @@\n+            ra = OR_IDENTITY;\n@@ -3767,8 +3763,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3783,1 +3772,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3792,1 +3781,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3807,0 +3796,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3810,8 +3800,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3826,1 +3809,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3836,1 +3819,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3853,0 +3836,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3856,8 +3840,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3872,1 +3849,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3881,1 +3858,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3896,0 +3873,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3899,8 +3877,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3915,1 +3886,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3925,1 +3896,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3942,0 +3913,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3945,8 +3917,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3961,1 +3926,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3970,1 +3935,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3982,1 +3947,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3985,0 +3950,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3988,8 +3954,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4004,1 +3963,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4014,1 +3973,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4028,1 +3987,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -4031,0 +3990,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4034,8 +3994,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4050,1 +4003,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4059,1 +4012,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4071,1 +4024,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4074,0 +4027,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4077,8 +4031,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4093,1 +4040,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4103,1 +4050,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4117,1 +4064,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4120,0 +4067,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4123,8 +4071,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4139,1 +4080,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4148,1 +4089,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4160,1 +4101,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4163,0 +4104,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4166,8 +4108,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4182,1 +4117,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4192,1 +4127,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4206,1 +4141,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4209,0 +4144,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4212,8 +4148,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4228,1 +4157,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4237,1 +4166,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4249,1 +4178,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4252,0 +4181,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4255,8 +4185,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4271,1 +4194,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4281,1 +4204,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4295,1 +4218,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4298,0 +4221,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4301,8 +4225,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4317,1 +4234,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4326,1 +4243,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4338,1 +4255,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4341,0 +4258,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4344,8 +4262,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4360,1 +4271,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4370,1 +4281,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4384,1 +4295,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4387,0 +4298,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4390,8 +4302,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4406,1 +4311,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4415,1 +4320,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4427,1 +4332,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4430,0 +4335,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4433,8 +4339,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4449,1 +4348,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4459,1 +4358,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4473,1 +4372,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4476,0 +4375,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4479,8 +4379,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4543,1 +4436,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4552,1 +4445,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4460,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4464,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4586,1 +4473,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4596,1 +4483,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4612,0 +4499,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4615,8 +4503,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6580,0 +6461,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short512VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,0 +69,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3605,1 +3618,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3614,1 +3627,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3626,1 +3639,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3629,0 +3642,1 @@\n+            ra = AND_IDENTITY;\n@@ -3632,8 +3646,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3648,1 +3655,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3658,1 +3665,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3672,1 +3679,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3675,0 +3682,1 @@\n+            ra = AND_IDENTITY;\n@@ -3678,8 +3686,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3694,1 +3695,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3703,1 +3704,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3718,0 +3719,1 @@\n+            ra = OR_IDENTITY;\n@@ -3721,8 +3723,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3737,1 +3732,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3747,1 +3742,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3764,0 +3759,1 @@\n+            ra = OR_IDENTITY;\n@@ -3767,8 +3763,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3783,1 +3772,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3792,1 +3781,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3807,0 +3796,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3810,8 +3800,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3826,1 +3809,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3836,1 +3819,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3853,0 +3836,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3856,8 +3840,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3872,1 +3849,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3881,1 +3858,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3896,0 +3873,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3899,8 +3877,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3915,1 +3886,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3925,1 +3896,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3942,0 +3913,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3945,8 +3917,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3961,1 +3926,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3970,1 +3935,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3982,1 +3947,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3985,0 +3950,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3988,8 +3954,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4004,1 +3963,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4014,1 +3973,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4028,1 +3987,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -4031,0 +3990,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4034,8 +3994,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4050,1 +4003,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4059,1 +4012,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4071,1 +4024,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4074,0 +4027,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4077,8 +4031,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4093,1 +4040,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4103,1 +4050,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4117,1 +4064,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4120,0 +4067,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4123,8 +4071,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4139,1 +4080,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4148,1 +4089,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4160,1 +4101,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4163,0 +4104,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4166,8 +4108,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4182,1 +4117,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4192,1 +4127,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4206,1 +4141,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4209,0 +4144,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4212,8 +4148,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4228,1 +4157,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4237,1 +4166,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4249,1 +4178,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4252,0 +4181,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4255,8 +4185,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4271,1 +4194,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4281,1 +4204,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4295,1 +4218,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4298,0 +4221,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4301,8 +4225,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4317,1 +4234,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4326,1 +4243,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4338,1 +4255,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4341,0 +4258,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4344,8 +4262,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4360,1 +4271,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4370,1 +4281,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4384,1 +4295,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4387,0 +4298,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4390,8 +4302,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4406,1 +4311,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4415,1 +4320,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4427,1 +4332,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4430,0 +4335,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4433,8 +4339,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4449,1 +4348,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4459,1 +4358,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4473,1 +4372,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4476,0 +4375,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4479,8 +4379,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4543,1 +4436,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4552,1 +4445,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4567,0 +4460,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4570,8 +4464,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4586,1 +4473,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4596,1 +4483,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4612,0 +4499,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4615,8 +4503,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6580,0 +6461,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Short64VectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,13 @@\n+    \/\/ Identity values for reduction operations\n+    private static final short ADD_IDENTITY = (short)0;\n+    private static final short AND_IDENTITY = (short)-1;\n+    private static final short FIRST_NONZERO_IDENTITY = (short)0;\n+    private static final short MAX_IDENTITY = Short.MIN_VALUE;\n+    private static final short MIN_IDENTITY = Short.MAX_VALUE;\n+    private static final short MUL_IDENTITY = (short)1;\n+    private static final short OR_IDENTITY = (short)0;\n+    private static final short SUADD_IDENTITY = (short)0;\n+    private static final short UMAX_IDENTITY = (short)0;   \/\/ Minimum unsigned value\n+    private static final short UMIN_IDENTITY = (short)-1;  \/\/ Maximum unsigned value\n+    private static final short XOR_IDENTITY = (short)0;\n+\n@@ -3610,1 +3623,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3619,1 +3632,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3631,1 +3644,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3634,0 +3647,1 @@\n+            ra = AND_IDENTITY;\n@@ -3637,8 +3651,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND);\n+                ra &= r[i];\n@@ -3653,1 +3660,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3663,1 +3670,1 @@\n-        short res = -1;\n+        short res = AND_IDENTITY;\n@@ -3677,1 +3684,1 @@\n-        short ra = -1;\n+        short ra = 0;\n@@ -3680,0 +3687,1 @@\n+            ra = AND_IDENTITY;\n@@ -3683,8 +3691,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = -1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra &= av.reduceLanes(VectorOperators.AND, vmask);\n+                ra &= r[i];\n@@ -3699,1 +3700,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3708,1 +3709,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3723,0 +3724,1 @@\n+            ra = OR_IDENTITY;\n@@ -3726,8 +3728,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR);\n+                ra |= r[i];\n@@ -3742,1 +3737,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3752,1 +3747,1 @@\n-        short res = 0;\n+        short res = OR_IDENTITY;\n@@ -3769,0 +3764,1 @@\n+            ra = OR_IDENTITY;\n@@ -3772,8 +3768,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra |= av.reduceLanes(VectorOperators.OR, vmask);\n+                ra |= r[i];\n@@ -3788,1 +3777,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3797,1 +3786,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3812,0 +3801,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3815,8 +3805,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR);\n+                ra ^= r[i];\n@@ -3831,1 +3814,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3841,1 +3824,1 @@\n-        short res = 0;\n+        short res = XOR_IDENTITY;\n@@ -3858,0 +3841,1 @@\n+            ra = XOR_IDENTITY;\n@@ -3861,8 +3845,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra ^= av.reduceLanes(VectorOperators.XOR, vmask);\n+                ra ^= r[i];\n@@ -3877,1 +3854,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3886,1 +3863,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3901,0 +3878,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3904,8 +3882,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD);\n+                ra += r[i];\n@@ -3920,1 +3891,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3930,1 +3901,1 @@\n-        short res = 0;\n+        short res = ADD_IDENTITY;\n@@ -3947,0 +3918,1 @@\n+            ra = ADD_IDENTITY;\n@@ -3950,8 +3922,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra += av.reduceLanes(VectorOperators.ADD, vmask);\n+                ra += r[i];\n@@ -3966,1 +3931,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3975,1 +3940,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -3987,1 +3952,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -3990,0 +3955,1 @@\n+            ra = MUL_IDENTITY;\n@@ -3993,8 +3959,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL);\n+                ra *= r[i];\n@@ -4009,1 +3968,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4019,1 +3978,1 @@\n-        short res = 1;\n+        short res = MUL_IDENTITY;\n@@ -4033,1 +3992,1 @@\n-        short ra = 1;\n+        short ra = 0;\n@@ -4036,0 +3995,1 @@\n+            ra = MUL_IDENTITY;\n@@ -4039,8 +3999,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 1;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra *= av.reduceLanes(VectorOperators.MUL, vmask);\n+                ra *= r[i];\n@@ -4055,1 +4008,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4064,1 +4017,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4076,1 +4029,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4079,0 +4032,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4082,8 +4036,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4098,1 +4045,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4108,1 +4055,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = MIN_IDENTITY;\n@@ -4122,1 +4069,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4125,0 +4072,1 @@\n+            ra = MIN_IDENTITY;\n@@ -4128,8 +4076,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.min(ra, av.reduceLanes(VectorOperators.MIN, vmask));\n+                ra = (short) Math.min(ra, r[i]);\n@@ -4144,1 +4085,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4153,1 +4094,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4165,1 +4106,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4168,0 +4109,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4171,8 +4113,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4187,1 +4122,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4197,1 +4132,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = MAX_IDENTITY;\n@@ -4211,1 +4146,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4214,0 +4149,1 @@\n+            ra = MAX_IDENTITY;\n@@ -4217,8 +4153,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) Math.max(ra, av.reduceLanes(VectorOperators.MAX, vmask));\n+                ra = (short) Math.max(ra, r[i]);\n@@ -4233,1 +4162,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4242,1 +4171,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4254,1 +4183,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4257,0 +4186,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4260,8 +4190,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4276,1 +4199,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4286,1 +4209,1 @@\n-        short res = Short.MAX_VALUE;\n+        short res = UMIN_IDENTITY;\n@@ -4300,1 +4223,1 @@\n-        short ra = Short.MAX_VALUE;\n+        short ra = 0;\n@@ -4303,0 +4226,1 @@\n+            ra = UMIN_IDENTITY;\n@@ -4306,8 +4230,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MAX_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.minUnsigned(ra, av.reduceLanes(VectorOperators.UMIN, vmask));\n+                ra = (short) VectorMath.minUnsigned(ra, r[i]);\n@@ -4322,1 +4239,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4331,1 +4248,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4343,1 +4260,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4346,0 +4263,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4349,8 +4267,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4365,1 +4276,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4375,1 +4286,1 @@\n-        short res = Short.MIN_VALUE;\n+        short res = UMAX_IDENTITY;\n@@ -4389,1 +4300,1 @@\n-        short ra = Short.MIN_VALUE;\n+        short ra = 0;\n@@ -4392,0 +4303,1 @@\n+            ra = UMAX_IDENTITY;\n@@ -4395,8 +4307,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = Short.MIN_VALUE;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.maxUnsigned(ra, av.reduceLanes(VectorOperators.UMAX, vmask));\n+                ra = (short) VectorMath.maxUnsigned(ra, r[i]);\n@@ -4411,1 +4316,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4420,1 +4325,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4432,1 +4337,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4435,0 +4340,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4438,8 +4344,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4454,1 +4353,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4464,1 +4363,1 @@\n-        short res = (short) 0;\n+        short res = FIRST_NONZERO_IDENTITY;\n@@ -4478,1 +4377,1 @@\n-        short ra = (short) 0;\n+        short ra = 0;\n@@ -4481,0 +4380,1 @@\n+            ra = FIRST_NONZERO_IDENTITY;\n@@ -4484,8 +4384,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = (short) 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = firstNonZero(ra, av.reduceLanes(VectorOperators.FIRST_NONZERO, vmask));\n+                ra = firstNonZero(ra, r[i]);\n@@ -4548,1 +4441,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4557,1 +4450,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4572,0 +4465,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4575,8 +4469,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -4591,1 +4478,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4601,1 +4488,1 @@\n-        short res = 0;\n+        short res = SUADD_IDENTITY;\n@@ -4617,0 +4504,1 @@\n+            ra = SUADD_IDENTITY;\n@@ -4620,8 +4508,1 @@\n-            }\n-        }\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            ra = 0;\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n-                ra = (short) VectorMath.addSaturatingUnsigned(ra, av.reduceLanes(VectorOperators.SUADD, vmask));\n+                ra = (short) VectorMath.addSaturatingUnsigned(ra, r[i]);\n@@ -6585,0 +6466,87 @@\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            short x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals((short)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals((short)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max(Short.MIN_VALUE, x) == x\n+            Assert.assertEquals((short) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min(Short.MAX_VALUE, x) == x\n+            Assert.assertEquals((short) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals((short)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals((short)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals((short) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals((short) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals((short)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"shortUnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<short[]> fa) {\n+        short[] a = fa.apply(SPECIES.length());\n+        VectorMask<Short> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            ShortVector av = ShortVector.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+        }\n+    }\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/ShortMaxVectorTests.java","additions":203,"deletions":235,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n-# Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -514,10 +514,10 @@\n-gen_reduction_op \"AND\" \"\\&\" \"BITWISE\" \"-1\"\n-gen_reduction_op \"OR\" \"|\" \"BITWISE\" \"0\"\n-gen_reduction_op \"XOR\" \"^\" \"BITWISE\" \"0\"\n-gen_reduction_op \"ADD\" \"+\" \"\" \"0\"\n-gen_reduction_op \"MUL\" \"*\" \"\" \"1\"\n-gen_reduction_op_func \"MIN\" \"(\\$type\\$) Math.min\" \"\" \"\\$Wideboxtype\\$.\\$MaxValue\\$\"\n-gen_reduction_op_func \"MAX\" \"(\\$type\\$) Math.max\" \"\" \"\\$Wideboxtype\\$.\\$MinValue\\$\"\n-gen_reduction_op_func \"UMIN\" \"(\\$type\\$) VectorMath.minUnsigned\" \"BITWISE\" \"\\$Wideboxtype\\$.\\$MaxValue\\$\"\n-gen_reduction_op_func \"UMAX\" \"(\\$type\\$) VectorMath.maxUnsigned\" \"BITWISE\" \"\\$Wideboxtype\\$.\\$MinValue\\$\"\n-gen_reduction_op_func \"FIRST_NONZERO\" \"firstNonZero\" \"\" \"(\\$type\\$) 0\"\n+gen_reduction_op \"AND\" \"\\&\" \"BITWISE\" \"AND_IDENTITY\"\n+gen_reduction_op \"OR\" \"|\" \"BITWISE\" \"OR_IDENTITY\"\n+gen_reduction_op \"XOR\" \"^\" \"BITWISE\" \"XOR_IDENTITY\"\n+gen_reduction_op \"ADD\" \"+\" \"\" \"ADD_IDENTITY\"\n+gen_reduction_op \"MUL\" \"*\" \"\" \"MUL_IDENTITY\"\n+gen_reduction_op_func \"MIN\" \"(\\$type\\$) Math.min\" \"\" \"MIN_IDENTITY\"\n+gen_reduction_op_func \"MAX\" \"(\\$type\\$) Math.max\" \"\" \"MAX_IDENTITY\"\n+gen_reduction_op_func \"UMIN\" \"(\\$type\\$) VectorMath.minUnsigned\" \"BITWISE\" \"UMIN_IDENTITY\"\n+gen_reduction_op_func \"UMAX\" \"(\\$type\\$) VectorMath.maxUnsigned\" \"BITWISE\" \"UMAX_IDENTITY\"\n+gen_reduction_op_func \"FIRST_NONZERO\" \"firstNonZero\" \"\" \"FIRST_NONZERO_IDENTITY\"\n@@ -530,1 +530,1 @@\n-gen_saturating_reduction_op \"SUADD\" \"(\\$type\\$) VectorMath.addSaturatingUnsigned\" \"BITWISE\" \"0\"\n+gen_saturating_reduction_op \"SUADD\" \"(\\$type\\$) VectorMath.addSaturatingUnsigned\" \"BITWISE\" \"SUADD_IDENTITY\"\n@@ -641,0 +641,3 @@\n+# Identity value tests\n+gen_op_tmpl \"Identity-test\" \"Identity\" \"\" \"\"\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/gen-template.sh","additions":15,"deletions":12,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -5,8 +5,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -18,1 +11,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]], vmask));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-Masked-op-func.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -5,8 +5,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -18,1 +11,2 @@\n-                ra [[TEST_OP]]= av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                ra [[TEST_OP]]= r[i];\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-Masked-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -3,8 +3,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -16,1 +9,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]]));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-op-func.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -3,8 +3,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -16,1 +9,2 @@\n-                ra [[TEST_OP]]= av.reduceLanes(VectorOperators.[[TEST]]);\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n+                ra [[TEST_OP]]= r[i];\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-Reduction-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -5,8 +5,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -18,1 +11,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]], vmask));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]], vmask);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-SaturatingReduction-Masked-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -3,8 +3,1 @@\n-        $type$ ra = [[TEST_INIT]];\n-\n-        for (int ic = 0; ic < INVOC_COUNT; ic++) {\n-            for (int i = 0; i < a.length; i += SPECIES.length()) {\n-                $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n-                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n-            }\n-        }\n+        $type$ ra = 0;\n@@ -16,1 +9,2 @@\n-                ra = [[TEST_OP]](ra, av.reduceLanes(VectorOperators.[[TEST]]));\n+                r[i] = av.reduceLanes(VectorOperators.[[TEST]]);\n+                ra = [[TEST_OP]](ra, r[i]);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Kernel-SaturatingReduction-op.template","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -0,0 +1,95 @@\n+\n+    @Test(dataProvider = \"$type$UnaryOpProvider\")\n+    static void testIdentityValues(IntFunction<$type$[]> fa) {\n+        $type$[] a = fa.apply(SPECIES.length());\n+\n+        for (int i = 0; i < a.length; i++) {\n+            $type$ x = a[i];\n+\n+            \/\/ ADD identity: 0 + x == x\n+            Assert.assertEquals(($type$)(ADD_IDENTITY + x), x,\n+                                \"ADD(ADD_IDENTITY, \" + x + \") != \" + x);\n+#if[BITWISE]\n+\n+            \/\/ AND identity: -1 & x == x\n+            Assert.assertEquals(($type$)(AND_IDENTITY & x), x,\n+                                \"AND(AND_IDENTITY, \" + x + \") != \" + x);\n+#end[BITWISE]\n+\n+            \/\/ FIRST_NONZERO identity: firstNonZero(0, x) == x\n+            Assert.assertEquals(firstNonZero(FIRST_NONZERO_IDENTITY, x), x,\n+                                \"FIRST_NONZERO(FIRST_NONZERO_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MAX identity: max($Wideboxtype$.$MinValue$, x) == x\n+            Assert.assertEquals(($type$) Math.max(MAX_IDENTITY, x), x,\n+                                \"MAX(MAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MIN identity: min($Wideboxtype$.$MaxValue$, x) == x\n+            Assert.assertEquals(($type$) Math.min(MIN_IDENTITY, x), x,\n+                                \"MIN(MIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ MUL identity: 1 * x == x\n+            Assert.assertEquals(($type$)(MUL_IDENTITY * x), x,\n+                                \"MUL(MUL_IDENTITY, \" + x + \") != \" + x);\n+#if[BITWISE]\n+\n+            \/\/ OR identity: 0 | x == x\n+            Assert.assertEquals(($type$)(OR_IDENTITY | x), x,\n+                                \"OR(OR_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ SUADD identity: addSaturatingUnsigned(0, x) == x\n+            Assert.assertEquals(($type$) VectorMath.addSaturatingUnsigned(SUADD_IDENTITY, x), x,\n+                                \"SUADD(SUADD_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMAX identity: maxUnsigned(0, x) == x\n+            Assert.assertEquals(($type$) VectorMath.maxUnsigned(UMAX_IDENTITY, x), x,\n+                                \"UMAX(UMAX_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ UMIN identity: minUnsigned(-1, x) == x\n+            Assert.assertEquals(($type$) VectorMath.minUnsigned(UMIN_IDENTITY, x), x,\n+                                \"UMIN(UMIN_IDENTITY, \" + x + \") != \" + x);\n+\n+            \/\/ XOR identity: 0 ^ x == x\n+            Assert.assertEquals(($type$)(XOR_IDENTITY ^ x), x,\n+                                \"XOR(XOR_IDENTITY, \" + x + \") != \" + x);\n+#end[BITWISE]\n+        }\n+    }\n+\n+    @Test(dataProvider = \"$type$UnaryOpProvider\")\n+    static void testMaskedReductionIdentityAllFalse(IntFunction<$type$[]> fa) {\n+        $type$[] a = fa.apply(SPECIES.length());\n+        VectorMask<$Wideboxtype$> allFalseMask = SPECIES.maskAll(false);\n+\n+        for (int i = 0; i < a.length; i += SPECIES.length()) {\n+            $abstractvectortype$ av = $abstractvectortype$.fromArray(SPECIES, a, i);\n+\n+            \/\/ When mask is all false, reduction should return identity value\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.ADD, allFalseMask), ADD_IDENTITY,\n+                                \"ADD with all-false mask should return ADD_IDENTITY\");\n+#if[BITWISE]\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.AND, allFalseMask), AND_IDENTITY,\n+                                \"AND with all-false mask should return AND_IDENTITY\");\n+#end[BITWISE]\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.FIRST_NONZERO, allFalseMask), FIRST_NONZERO_IDENTITY,\n+                                \"FIRST_NONZERO with all-false mask should return FIRST_NONZERO_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MAX, allFalseMask), MAX_IDENTITY,\n+                                \"MAX with all-false mask should return MAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MIN, allFalseMask), MIN_IDENTITY,\n+                                \"MIN with all-false mask should return MIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.MUL, allFalseMask), MUL_IDENTITY,\n+                                \"MUL with all-false mask should return MUL_IDENTITY\");\n+#if[BITWISE]\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.OR, allFalseMask), OR_IDENTITY,\n+                                \"OR with all-false mask should return OR_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.SUADD, allFalseMask), SUADD_IDENTITY,\n+                                \"SUADD with all-false mask should return SUADD_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMAX, allFalseMask), UMAX_IDENTITY,\n+                                \"UMAX with all-false mask should return UMAX_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.UMIN, allFalseMask), UMIN_IDENTITY,\n+                                \"UMIN with all-false mask should return UMIN_IDENTITY\");\n+            Assert.assertEquals(av.reduceLanes(VectorOperators.XOR, allFalseMask), XOR_IDENTITY,\n+                                \"XOR with all-false mask should return XOR_IDENTITY\");\n+#end[BITWISE]\n+        }\n+    }\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Unit-Identity-test.template","additions":95,"deletions":0,"binary":false,"changes":95,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -101,0 +101,17 @@\n+\n+    \/\/ Identity values for reduction operations\n+    private static final $type$ ADD_IDENTITY = ($type$)0;\n+#if[BITWISE]\n+    private static final $type$ AND_IDENTITY = ($type$)-1;\n+#end[BITWISE]\n+    private static final $type$ FIRST_NONZERO_IDENTITY = ($type$)0;\n+    private static final $type$ MAX_IDENTITY = $Wideboxtype$.$MinValue$;\n+    private static final $type$ MIN_IDENTITY = $Wideboxtype$.$MaxValue$;\n+    private static final $type$ MUL_IDENTITY = ($type$)1;\n+#if[BITWISE]\n+    private static final $type$ OR_IDENTITY = ($type$)0;\n+    private static final $type$ SUADD_IDENTITY = ($type$)0;\n+    private static final $type$ UMAX_IDENTITY = ($type$)0;   \/\/ Minimum unsigned value\n+    private static final $type$ UMIN_IDENTITY = ($type$)-1;  \/\/ Maximum unsigned value\n+    private static final $type$ XOR_IDENTITY = ($type$)0;\n+#end[BITWISE]\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Unit-header.template","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"}]}