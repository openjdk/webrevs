{"files":[{"patch":"@@ -94,7 +94,0 @@\n-                    if (lafName.contains(\"Mac\")) {\n-                        \/\/ By default, non-editable ComboBoxes don't appear\n-                        \/\/ underneath unless this is explicitly set\n-                        cb3.putClientProperty(\"JComboBox.isPopDown\", Boolean.TRUE);\n-                        cb4.putClientProperty(\"JComboBox.isPopDown\", Boolean.TRUE);\n-                    }\n-\n@@ -169,1 +162,2 @@\n-    private static void runTestOnComboBox(Point p, int width, int height) {\n+    private static void runTestOnComboBox(Point p, int width, int height)\n+            throws InterruptedException, InvocationTargetException {\n@@ -171,4 +165,6 @@\n-            robot.mouseMove(p.x + width - BUTTON_OFFSET,\n-                    p.y + (height \/ 2) + POPUP_OFFSET);\n-            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n-            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            if (p == cb3Point || p == cb4Point) {\n+                \/\/ Set isPopDown property to ensure popup matches native MacOS\n+                SwingUtilities.invokeAndWait(() -> {\n+                    cb3.putClientProperty(\"JComboBox.isPopDown\", Boolean.FALSE);\n+                    cb4.putClientProperty(\"JComboBox.isPopDown\", Boolean.FALSE);\n+                });\n@@ -176,4 +172,20 @@\n-            robot.mouseMove(p.x + (width \/ 2) - BUTTON_OFFSET,\n-                    p.y + height + POPUP_OFFSET - 8);\n-            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n-            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+                robot.mouseMove(p.x + width - BUTTON_OFFSET,\n+                        p.y + (height \/ 2) + POPUP_OFFSET);\n+                robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+                robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+\n+                robot.mouseMove(p.x + (width \/ 2) - BUTTON_OFFSET,\n+                        p.y + POPUP_OFFSET);\n+                robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+                robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            } else {\n+                robot.mouseMove(p.x + width - BUTTON_OFFSET,\n+                        p.y + (height \/ 2) + POPUP_OFFSET);\n+                robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+                robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+\n+                robot.mouseMove(p.x + (width \/ 2) - BUTTON_OFFSET,\n+                        p.y + height + POPUP_OFFSET - 8);\n+                robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+                robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            }\n","filename":"test\/jdk\/javax\/swing\/JComboBox\/EditableComboBoxPopupPos.java","additions":28,"deletions":16,"binary":false,"changes":44,"status":"modified"}]}