{"files":[{"patch":"@@ -461,0 +461,1 @@\n+    assert(if_node_profile->Opcode() == Op_RangeCheck, \"only IfNode or RangeCheckNode expected\");\n","filename":"src\/hotspot\/share\/opto\/ifnode.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -113,1 +113,1 @@\n-\/\/ This class creates an If node (i.e. loop selector) that selects if the true-path- or the false-path-loop should be\n+\/\/ This class creates an If node (i.e. loop selector) that selects if the true-path-loop or the false-path-loop should be\n@@ -142,1 +142,1 @@\n-    assert(unswitch_candidate != nullptr, \"must exist\");\n+    assert(unswitch_candidate != nullptr, \"guaranteed to exist by policy_unswitching\");\n@@ -159,6 +159,2 @@\n-    IfProjNode* proj_to_loop;\n-    if (path_to_loop == TRUE_PATH) {\n-      proj_to_loop = new IfTrueNode(_selector);\n-    } else {\n-      proj_to_loop = new IfFalseNode(_selector);\n-    }\n+    IfProjNode* proj_to_loop = (path_to_loop == TRUE_PATH) ? new IfTrueNode(_selector)\n+                                                             new IfFalseNode(_selector);\n@@ -359,1 +355,2 @@\n-  Node_List worklist;\n+  ResourceMark rm;\n+  GrowableArray<CheckCastPPNode*> loop_invariant_check_casts;\n@@ -364,3 +361,3 @@\n-      Node* use = proj->fast_out(j);\n-      if (use->Opcode() == Op_CheckCastPP && loop->is_invariant(use->in(1))) {\n-        worklist.push(use);\n+      Node* check_cast = proj->fast_out(j)->isa_CheckCastPP();\n+      if (check_cast != nullptr && loop->is_invariant(check_cast->in(1))) {\n+        loop_invariant_check_casts.push(check_cast);\n@@ -370,2 +367,2 @@\n-    while (worklist.size() > 0) {\n-      Node* cast = worklist.pop();\n+    while (loop_invariant_check_casts.size() > 0) {\n+      CheckCastPPNode* cast = loop_invariant_check_casts.pop();\n@@ -387,2 +384,2 @@\n-    Node *n = loop->_body[i];\n-    Node *n_clone = old_new[n->_idx];\n+    Node* n = loop->_body[i];\n+    Node* n_clone = old_new[n->_idx];\n","filename":"src\/hotspot\/share\/opto\/loopUnswitch.cpp","additions":13,"deletions":16,"binary":false,"changes":29,"status":"modified"}]}