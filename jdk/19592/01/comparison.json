{"files":[{"patch":"@@ -54,7 +54,1 @@\n-  _scale(scale), _output(out) {\n-  _output->set_autoindent(true);\n-}\n-\n-MemReporterBase::~MemReporterBase() {\n-  _output->set_autoindent(false);\n-}\n+  _scale(scale), _output(out), _auto_indentor(out) {}\n","filename":"src\/hotspot\/share\/nmt\/memReporter.cpp","additions":1,"deletions":7,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -41,0 +41,1 @@\n+  StreamAutoIndentor _auto_indentor;\n@@ -48,1 +49,0 @@\n-  ~MemReporterBase();\n","filename":"src\/hotspot\/share\/nmt\/memReporter.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -280,0 +280,6 @@\n+bool outputStream::set_autoindent(bool value) {\n+  const bool old = _autoindent;\n+  _autoindent = value;\n+  return old;\n+}\n+\n","filename":"src\/hotspot\/share\/utilities\/ostream.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -112,1 +112,2 @@\n-   void set_autoindent(bool value) { _autoindent = value; }\n+   \/\/ Returns old autoindent state.\n+   bool set_autoindent(bool value);\n@@ -178,5 +179,4 @@\n- private:\n-  outputStream* _str;\n-  int _amount;\n-\n- public:\n+  outputStream* const _str;\n+  const int _amount;\n+  NONCOPYABLE(streamIndentor);\n+public:\n@@ -189,0 +189,10 @@\n+class StreamAutoIndentor : public StackObj {\n+  outputStream* const _os;\n+  const bool _old;\n+  NONCOPYABLE(StreamAutoIndentor);\n+ public:\n+  StreamAutoIndentor(outputStream* os) :\n+    _os(os), _old(os->set_autoindent(true)) {}\n+  ~StreamAutoIndentor() { _os->set_autoindent(_old); }\n+};\n+\n","filename":"src\/hotspot\/share\/utilities\/ostream.hpp","additions":16,"deletions":6,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -109,1 +109,2 @@\n-  ss.set_autoindent(on);\n+  const bool prior = ss.set_autoindent(on);\n+  EXPECT_FALSE(prior);\n@@ -149,0 +150,2 @@\n+  bool prior2 = ss.set_autoindent(prior);\n+  EXPECT_EQ(prior2, on);\n","filename":"test\/hotspot\/gtest\/utilities\/test_ostream.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"}]}