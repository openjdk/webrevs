{"files":[{"patch":"@@ -37,1 +37,0 @@\n-import static jdk.internal.foreign.AbstractMemorySegmentImpl.AccessConstraint.*;\n@@ -101,1 +100,1 @@\n-    static AbstractMemorySegmentImpl checkAddress(Object obb, long offset, long length, AbstractMemorySegmentImpl.AccessConstraint constraint) {\n+    static AbstractMemorySegmentImpl checkAddress(Object obb, long offset, long length, boolean ro) {\n@@ -103,1 +102,1 @@\n-        oo.checkAccess(offset, length, constraint);\n+        oo.checkAccess(offset, length, ro);\n@@ -129,1 +128,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, true);\n@@ -153,1 +152,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -179,1 +178,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, true);\n@@ -189,1 +188,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -199,1 +198,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, true);\n@@ -209,1 +208,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -219,1 +218,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, true);\n@@ -229,1 +228,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -240,1 +239,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -250,1 +249,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -261,1 +260,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -272,1 +271,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -283,1 +282,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -293,1 +292,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -303,1 +302,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -313,1 +312,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -323,1 +322,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -334,1 +333,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -345,1 +344,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -358,1 +357,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -372,1 +371,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -386,1 +385,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -414,1 +413,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -428,1 +427,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -442,1 +441,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -468,1 +467,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -482,1 +481,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -496,1 +495,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -523,1 +522,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -537,1 +536,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n@@ -551,1 +550,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, false);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/X-VarHandleSegmentView.java.template","additions":33,"deletions":34,"binary":false,"changes":67,"status":"modified"},{"patch":"@@ -60,1 +60,0 @@\n-import static jdk.internal.foreign.AbstractMemorySegmentImpl.AccessConstraint.*;\n@@ -196,1 +195,1 @@\n-        checkAccess(0, length, ON_WRITE_IAE);\n+        checkAccess(0, length, false);\n@@ -362,4 +361,0 @@\n-    public enum AccessConstraint {\n-        NONE, ON_WRITE_UOE, ON_WRITE_IAE\n-    }\n-\n@@ -367,8 +362,3 @@\n-    public void checkAccess(long offset, long length, AccessConstraint access) {\n-        if (readOnly) {\n-            switch (access) {\n-                case ON_WRITE_UOE ->\n-                        throw new UnsupportedOperationException(\"Attempt to write a read-only segment\");\n-                case ON_WRITE_IAE ->\n-                        throw new IllegalArgumentException(\"Attempt to write a read-only segment\");\n-            }\n+    public void checkAccess(long offset, long length, boolean readOnly) {\n+        if (!readOnly && this.readOnly) {\n+            throw new IllegalArgumentException(\"Attempt to write a read-only segment\");\n@@ -621,2 +611,2 @@\n-        srcImpl.checkAccess(srcOffset, size, NONE);\n-        dstImpl.checkAccess(dstOffset, size, ON_WRITE_IAE);\n+        srcImpl.checkAccess(srcOffset, size, true);\n+        dstImpl.checkAccess(dstOffset, size, false);\n@@ -648,1 +638,1 @@\n-        srcImpl.checkAccess(srcOffset, elementCount * dstInfo.scale(), NONE);\n+        srcImpl.checkAccess(srcOffset, elementCount * dstInfo.scale(), true);\n@@ -676,1 +666,1 @@\n-        destImpl.checkAccess(dstOffset, elementCount * srcInfo.scale(), ON_WRITE_IAE);\n+        destImpl.checkAccess(dstOffset, elementCount * srcInfo.scale(), false);\n@@ -694,2 +684,2 @@\n-        srcImpl.checkAccess(srcFromOffset, srcBytes, NONE);\n-        dstImpl.checkAccess(dstFromOffset, dstBytes, NONE);\n+        srcImpl.checkAccess(srcFromOffset, srcBytes, true);\n+        dstImpl.checkAccess(dstFromOffset, dstBytes, true);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/AbstractMemorySegmentImpl.java","additions":10,"deletions":20,"binary":false,"changes":30,"status":"modified"}]}