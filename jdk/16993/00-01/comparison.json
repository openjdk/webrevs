{"files":[{"patch":"@@ -634,0 +634,3 @@\n+     *     <li>For write operations, the accessed memory segment must not be\n+     *     {@link MemorySegment#isReadOnly() read only}, or an\n+     *     {@link IllegalArgumentException} is thrown.<\/li>\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/MemoryLayout.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -872,1 +872,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -897,1 +897,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1272,0 +1272,2 @@\n+     * @throws IllegalArgumentException if this segment is\n+     *         {@linkplain #isReadOnly() read-only}\n@@ -1309,0 +1311,2 @@\n+     * @throws IllegalArgumentException if this segment is\n+     *         {@linkplain #isReadOnly() read-only}\n@@ -1608,1 +1612,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1646,1 +1650,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1684,1 +1688,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1722,1 +1726,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1760,1 +1764,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1798,1 +1802,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1836,1 +1840,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1874,1 +1878,1 @@\n-     * @throws UnsupportedOperationException if this segment is\n+     * @throws IllegalArgumentException if this segment is\n@@ -1926,0 +1930,2 @@\n+     * @throws IllegalArgumentException if this segment is\n+     *         {@linkplain #isReadOnly() read-only}\n@@ -2058,1 +2064,1 @@\n-     * @throws UnsupportedOperationException if this segment is {@linkplain #isReadOnly() read-only}\n+     * @throws IllegalArgumentException if this segment is {@linkplain #isReadOnly() read-only}\n@@ -2081,1 +2087,1 @@\n-     * @throws UnsupportedOperationException if this segment is {@linkplain #isReadOnly() read-only}\n+     * @throws IllegalArgumentException if this segment is {@linkplain #isReadOnly() read-only}\n@@ -2104,1 +2110,1 @@\n-     * @throws UnsupportedOperationException if this segment is {@linkplain #isReadOnly() read-only}\n+     * @throws IllegalArgumentException if this segment is {@linkplain #isReadOnly() read-only}\n@@ -2149,1 +2155,1 @@\n-     * @throws UnsupportedOperationException if this segment is {@linkplain #isReadOnly() read-only}\n+     * @throws IllegalArgumentException if this segment is {@linkplain #isReadOnly() read-only}\n@@ -2194,1 +2200,1 @@\n-     * @throws UnsupportedOperationException if this segment is {@linkplain #isReadOnly() read-only}\n+     * @throws IllegalArgumentException if this segment is {@linkplain #isReadOnly() read-only}\n@@ -2239,1 +2245,1 @@\n-     * @throws UnsupportedOperationException if this segment is {@linkplain #isReadOnly() read-only}\n+     * @throws IllegalArgumentException if this segment is {@linkplain #isReadOnly() read-only}\n@@ -2284,1 +2290,1 @@\n-     * @throws UnsupportedOperationException if this segment is {@linkplain #isReadOnly() read-only}\n+     * @throws IllegalArgumentException if this segment is {@linkplain #isReadOnly() read-only}\n@@ -2340,0 +2346,2 @@\n+     * @throws IllegalArgumentException if this segment is\n+     *         {@linkplain #isReadOnly() read-only}\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/MemorySegment.java","additions":25,"deletions":17,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -129,1 +129,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, READ_ONLY);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n@@ -153,1 +153,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -179,1 +179,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, READ_ONLY);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n@@ -189,1 +189,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -199,1 +199,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, READ_ONLY);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n@@ -209,1 +209,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -219,1 +219,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, READ_ONLY);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, NONE);\n@@ -229,1 +229,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -240,1 +240,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -250,1 +250,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -261,1 +261,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -272,1 +272,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -283,1 +283,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -293,1 +293,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -303,1 +303,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -313,1 +313,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -323,1 +323,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -334,1 +334,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -345,1 +345,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -358,1 +358,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -372,1 +372,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -386,1 +386,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -414,1 +414,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -428,1 +428,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -442,1 +442,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -468,1 +468,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -482,1 +482,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -496,1 +496,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -523,1 +523,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -537,1 +537,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n@@ -551,1 +551,1 @@\n-        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_UOE);\n+        AbstractMemorySegmentImpl bb = checkAddress(obb, base, handle.length, ON_WRITE_IAE);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/X-VarHandleSegmentView.java.template","additions":31,"deletions":31,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -196,1 +196,1 @@\n-        checkAccess(0, length, ON_WRITE_UOE);\n+        checkAccess(0, length, ON_WRITE_IAE);\n@@ -363,1 +363,1 @@\n-        READ_ONLY, ON_WRITE_UOE, ON_WRITE_IAE\n+        NONE, ON_WRITE_UOE, ON_WRITE_IAE\n@@ -621,1 +621,1 @@\n-        srcImpl.checkAccess(srcOffset, size, READ_ONLY);\n+        srcImpl.checkAccess(srcOffset, size, NONE);\n@@ -648,1 +648,1 @@\n-        srcImpl.checkAccess(srcOffset, elementCount * dstInfo.scale(), READ_ONLY);\n+        srcImpl.checkAccess(srcOffset, elementCount * dstInfo.scale(), NONE);\n@@ -694,2 +694,2 @@\n-        srcImpl.checkAccess(srcFromOffset, srcBytes, READ_ONLY);\n-        dstImpl.checkAccess(dstFromOffset, dstBytes, READ_ONLY);\n+        srcImpl.checkAccess(srcFromOffset, srcBytes, NONE);\n+        dstImpl.checkAccess(dstFromOffset, dstBytes, NONE);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/AbstractMemorySegmentImpl.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -90,1 +90,1 @@\n-            } catch (UnsupportedOperationException ex) {\n+            } catch (IllegalArgumentException ex) {\n@@ -124,1 +124,1 @@\n-            } catch (UnsupportedOperationException ex) {\n+            } catch (IllegalArgumentException ex) {\n@@ -188,1 +188,1 @@\n-            } catch (UnsupportedOperationException ex) {\n+            } catch (IllegalArgumentException ex) {\n","filename":"test\/jdk\/java\/foreign\/TestMemoryAccess.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -328,1 +328,1 @@\n-    @Test(dataProvider = \"segmentFactories\", expectedExceptions = UnsupportedOperationException.class)\n+    @Test(dataProvider = \"segmentFactories\", expectedExceptions = IllegalArgumentException.class)\n@@ -334,0 +334,6 @@\n+    @Test(dataProvider = \"segmentFactories\", expectedExceptions = IllegalArgumentException.class)\n+    public void testFromStringIllegalAccessMode(Supplier<MemorySegment> segmentSupplier) {\n+        MemorySegment segment = segmentSupplier.get();\n+        segment.asReadOnly().setString(0, \"a\");\n+    }\n+\n","filename":"test\/jdk\/java\/foreign\/TestSegments.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}