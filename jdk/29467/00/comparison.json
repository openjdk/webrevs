{"files":[{"patch":"@@ -26,1 +26,1 @@\n-# Script to update the Copyright YEAR range in Mercurial & Git sources.\n+# Script to update the Copyright YEAR range in Git sources.\n@@ -29,0 +29,4 @@\n+# To update Copyright years in for changes in a specific branch,\n+# you use a command along these lines:\n+# $ git diff upstream\/master...<branch-name> | lsdiff | cut -d '\/' -f 2-  | bash bin\/update_copyright_year.sh -m\n+\n@@ -50,1 +54,1 @@\n-usage=\"Usage: `basename \"$0\"` [-c company] [-y year] [-h|f]\"\n+usage=\"Usage: `basename \"$0\"` [-c company] [-y year] [-h|f|m]\"\n@@ -68,0 +72,1 @@\n+  echo \"-m     read the list of modified files from stdin\"\n@@ -74,0 +79,1 @@\n+modified_files_in_stdin=false;\n@@ -76,1 +82,1 @@\n-while getopts \"b:c:fhy:\" option; do\n+while getopts \"b:c:fhmy:\" option; do\n@@ -94,0 +100,3 @@\n+    m) # modified files will be read from stdin\n+      modified_files_in_stdin=true\n+      ;;\n@@ -113,10 +122,0 @@\n-else\n-  echo \"Using Git version control system\"\n-  vcs_status=(git ls-files -m)\n-  if [ \"$full_year\" = \"true\" ]; then\n-    vcs_list_changesets=(git log --no-merges --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n-  else\n-    vcs_list_changesets=(git log --no-merges \"${base_reference}..HEAD\" --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n-  fi\n-  vcs_changeset_message=(git log -1 --pretty=tformat:\"%B\") # followed by ${changeset}\n-  vcs_changeset_files=(git diff-tree --no-commit-id --name-only -r) # followed by ${changeset}\n@@ -125,0 +124,2 @@\n+echo \"Using Git version control system\"\n+\n@@ -171,0 +172,19 @@\n+# Update the copyright year on files sent in stdin\n+updateFiles() # stdin: list of files to update\n+{\n+  count=0\n+  fcount=0\n+  while read i; do\n+    fcount=`expr ${fcount} '+' 1`\n+    if [ `updateFile \"${i}\"` = \"true\" ] ; then\n+      count=`expr ${count} '+' 1`\n+    fi\n+  done\n+  if [ ${count} -gt 0 ] ; then\n+    printf \"  UPDATED year on %d of %d files.\\n\" ${count} ${fcount}\n+    total=`expr ${total} '+' ${count}`\n+   else\n+    printf \"  None of the %d files were changed.\\n\" ${fcount}\n+  fi\n+}\n+\n@@ -181,12 +201,1 @@\n-    fcount=`cat ${files}| wc -l`\n-    for i in `cat ${files}` ; do\n-      if [ `updateFile \"${i}\"` = \"true\" ] ; then\n-        count=`expr ${count} '+' 1`\n-      fi\n-    done\n-    if [ ${count} -gt 0 ] ; then\n-      printf \"  UPDATED year on %d of %d files.\\n\" ${count} ${fcount}\n-      total=`expr ${total} '+' ${count}`\n-    else\n-      printf \"  None of the %d files were changed.\\n\" ${fcount}\n-    fi\n+    cat ${files} | updateFiles\n@@ -207,0 +216,1 @@\n+vcs_status=(git ls-files -m)\n@@ -213,4 +223,11 @@\n-# Get all changesets this year\n-all_changesets=${tmp}\/all_changesets\n-rm -f ${all_changesets}\n-\"${vcs_list_changesets[@]}\" > ${all_changesets}\n+if [ \"$modified_files_in_stdin\" = \"true\" ]; then\n+  updateFiles\n+else\n+  # Get all changesets this year\n+  if [ \"$full_year\" = \"true\" ]; then\n+    vcs_list_changesets=(git log --no-merges --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n+  else\n+    vcs_list_changesets=(git log --no-merges \"${base_reference}..HEAD\" --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n+  fi\n+  vcs_changeset_message=(git log -1 --pretty=tformat:\"%B\") # followed by ${changeset}\n+  vcs_changeset_files=(git diff-tree --no-commit-id --name-only -r) # followed by ${changeset}\n@@ -218,26 +235,25 @@\n-# Check changeset to see if it is Copyright only changes, filter changesets\n-if [ -s ${all_changesets} ] ; then\n-  echo \"Changesets made in ${year}: `cat ${all_changesets} | wc -l`\"\n-  index=0\n-  cat ${all_changesets} | while read changeset ; do\n-    index=`expr ${index} '+' 1`\n-    desc=${tmp}\/desc.${changeset}\n-    rm -f ${desc}\n-    echo \"------------------------------------------------\"\n-    \"${vcs_changeset_message[@]}\" \"${changeset}\" > ${desc}\n-    printf \"%d: %s\\n%s\\n\" ${index} \"${changeset}\" \"`cat ${desc}|head -1`\"\n-    if [ \"${year}\" = \"2010\" ] ; then\n-      if cat ${desc} | grep -i -F \"Added tag\" > \/dev\/null ; then\n-        printf \"  EXCLUDED tag changeset.\\n\"\n-      elif cat ${desc} | grep -i -F rebrand > \/dev\/null ; then\n-        printf \"  EXCLUDED rebrand changeset.\\n\"\n-      elif cat ${desc} | grep -i -F copyright > \/dev\/null ; then\n-        printf \"  EXCLUDED copyright changeset.\\n\"\n-      else\n-        updateChangesetFiles ${changeset}\n-      fi\n-    else\n-      if cat ${desc} | grep -i -F \"Added tag\" > \/dev\/null ; then\n-        printf \"  EXCLUDED tag changeset.\\n\"\n-      elif cat ${desc} | grep -i -F \"copyright year\" > \/dev\/null ; then\n-        printf \"  EXCLUDED copyright year changeset.\\n\"\n+  all_changesets=${tmp}\/all_changesets\n+  rm -f ${all_changesets}\n+  \"${vcs_list_changesets[@]}\" > ${all_changesets}\n+\n+  # Check changeset to see if it is Copyright only changes, filter changesets\n+  if [ -s ${all_changesets} ] ; then\n+    echo \"Changesets made in ${year}: `cat ${all_changesets} | wc -l`\"\n+    index=0\n+    cat ${all_changesets} | while read changeset ; do\n+      index=`expr ${index} '+' 1`\n+      desc=${tmp}\/desc.${changeset}\n+      rm -f ${desc}\n+      echo \"------------------------------------------------\"\n+      \"${vcs_changeset_message[@]}\" \"${changeset}\" > ${desc}\n+      printf \"%d: %s\\n%s\\n\" ${index} \"${changeset}\" \"`cat ${desc}|head -1`\"\n+      if [ \"${year}\" = \"2010\" ] ; then\n+        if cat ${desc} | grep -i -F \"Added tag\" > \/dev\/null ; then\n+          printf \"  EXCLUDED tag changeset.\\n\"\n+        elif cat ${desc} | grep -i -F rebrand > \/dev\/null ; then\n+          printf \"  EXCLUDED rebrand changeset.\\n\"\n+        elif cat ${desc} | grep -i -F copyright > \/dev\/null ; then\n+          printf \"  EXCLUDED copyright changeset.\\n\"\n+        else\n+          updateChangesetFiles ${changeset}\n+        fi\n@@ -245,1 +261,7 @@\n-        updateChangesetFiles ${changeset}\n+        if cat ${desc} | grep -i -F \"Added tag\" > \/dev\/null ; then\n+          printf \"  EXCLUDED tag changeset.\\n\"\n+        elif cat ${desc} | grep -i -F \"copyright year\" > \/dev\/null ; then\n+          printf \"  EXCLUDED copyright year changeset.\\n\"\n+        else\n+          updateChangesetFiles ${changeset}\n+        fi\n@@ -247,4 +269,3 @@\n-    fi\n-    rm -f ${desc}\n-  done\n-fi\n+      rm -f ${desc}\n+    done\n+  fi\n@@ -252,16 +273,17 @@\n-if [ ${total} -gt 0 ] ; then\n-   echo \"---------------------------------------------\"\n-   echo \"Updated the copyright year on a total of ${total} files.\"\n-   if [ ${previous} -eq 0 ] ; then\n-     echo \"This count should match the count of modified files in the repository: ${vcs_status[*]}\"\n-   else\n-     echo \"WARNING: This repository contained previously edited working set files.\"\n-   fi\n-   echo \"  ${vcs_status[*]} | wc -l = `\"${vcs_status[@]}\" | wc -l`\"\n-else\n-   echo \"---------------------------------------------\"\n-   echo \"No files were changed\"\n-   if [ ${previous} -ne 0 ] ; then\n-     echo \"WARNING: This repository contained previously edited working set files.\"\n-   fi\n-   echo \"  ${vcs_status[*]} | wc -l = `\"${vcs_status[@]}\" | wc -l`\"\n+  if [ ${total} -gt 0 ] ; then\n+     echo \"---------------------------------------------\"\n+     echo \"Updated the copyright year on a total of ${total} files.\"\n+     if [ ${previous} -eq 0 ] ; then\n+       echo \"This count should match the count of modified files in the repository: ${vcs_status[*]}\"\n+     else\n+       echo \"WARNING: This repository contained previously edited working set files.\"\n+     fi\n+     echo \"  ${vcs_status[*]} | wc -l = `\"${vcs_status[@]}\" | wc -l`\"\n+  else\n+     echo \"---------------------------------------------\"\n+     echo \"No files were changed\"\n+     if [ ${previous} -ne 0 ] ; then\n+       echo \"WARNING: This repository contained previously edited working set files.\"\n+     fi\n+     echo \"  ${vcs_status[*]} | wc -l = `\"${vcs_status[@]}\" | wc -l`\"\n+  fi\n","filename":"bin\/update_copyright_year.sh","additions":98,"deletions":76,"binary":false,"changes":174,"status":"modified"}]}