{"files":[{"patch":"@@ -652,2 +652,0 @@\n-javax\/swing\/plaf\/basic\/BasicTextUI\/8001470\/bug8001470.java 8233177 linux-all,windows-all\n-\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,0 @@\n- * @author Semyon Sadetsky\n@@ -32,2 +31,7 @@\n-import javax.swing.*;\n-import java.awt.*;\n+import java.awt.Font;\n+import java.awt.GraphicsEnvironment;\n+import java.awt.GridLayout;\n+import javax.swing.JFrame;\n+import javax.swing.JTextField;\n+import javax.swing.SwingUtilities;\n+import javax.swing.JPanel;\n@@ -40,0 +44,4 @@\n+    private static boolean fontFound = false;\n+\n+    private static volatile int height1;\n+    private static volatile int height2;\n@@ -42,5 +50,17 @@\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            @Override\n-            public void run() {\n-                frame = new JFrame(\"JTextField Test\");\n-                frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n+        try {\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                @Override\n+                public void run() {\n+                    GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();\n+                    String[] names = ge.getAvailableFontFamilyNames();\n+                    Font[] allFonts = ge.getAllFonts();\n+                    for (int x = 0; x < allFonts.length; x++) {\n+                        if ((allFonts[x].canDisplay('\\u0e01')) && (allFonts[x].canDisplay('\\u0c01'))) {\n+                            fontFound = true;\n+                        }\n+                    }\n+                    if (!fontFound) {\n+                        return;\n+                    }\n+                    frame = new JFrame(\"JTextField Test\");\n+                    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n@@ -48,2 +68,2 @@\n-                JPanel container = (JPanel) frame.getContentPane();\n-                container.setLayout(new GridLayout(2,1));\n+                    JPanel container = (JPanel) frame.getContentPane();\n+                    container.setLayout(new GridLayout(2,1));\n@@ -51,2 +71,2 @@\n-                textField1 = new JTextField(\"\\u0e01\");\n-                textField2 = new JTextField(\"\\u0c01\");\n+                    textField1 = new JTextField(\"\\u0e01\");\n+                    textField2 = new JTextField(\"\\u0c01\");\n@@ -54,4 +74,10 @@\n-                container.add(textField1);\n-                container.add(textField2);\n-                frame.setVisible(true);\n-                frame.pack();\n+                    container.add(textField1);\n+                    container.add(textField2);\n+                    frame.setVisible(true);\n+                    frame.pack();\n+                }\n+            });\n+            Thread.sleep(1000);\n+            if (!fontFound) {\n+                System.out.println(\"system does not have Indic or Thai fonts\");\n+                return;\n@@ -59,8 +85,6 @@\n-        });\n-        if( textField1.getHeight() < 10 || textField2.getHeight() < 10 )\n-            throw new Exception(\"Wrong field height\");\n-        System.out.println(\"ok\");\n-        SwingUtilities.invokeLater(new Runnable() {\n-            @Override\n-            public void run() {\n-                frame.dispose();\n+            SwingUtilities.invokeAndWait(() -> {\n+                height1 = textField1.getHeight();\n+                height2 = textField2.getHeight();\n+            });\n+            if( height1 < 10 || height2 < 10 ) {\n+                throw new Exception(\"Wrong field height\");\n@@ -68,1 +92,8 @@\n-        });\n+            System.out.println(\"ok\");\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n+        }\n","filename":"test\/jdk\/javax\/swing\/plaf\/basic\/BasicTextUI\/8001470\/bug8001470.java","additions":57,"deletions":26,"binary":false,"changes":83,"status":"modified"}]}