{"files":[{"patch":"@@ -2389,1 +2389,1 @@\n-  \/\/ First, attempt to eliminate locks\n+  \/\/ Attempt to eliminate allocations and locks\n@@ -2391,21 +2391,0 @@\n-  while (progress) {\n-    progress = false;\n-    for (int i = C->macro_count(); i > 0; i = MIN2(i - 1, C->macro_count())) { \/\/ more than 1 element can be eliminated at once\n-      Node* n = C->macro_node(i - 1);\n-      bool success = false;\n-      DEBUG_ONLY(int old_macro_count = C->macro_count();)\n-      if (n->is_AbstractLock()) {\n-        success = eliminate_locking_node(n->as_AbstractLock());\n-#ifndef PRODUCT\n-        if (success && PrintOptoStatistics) {\n-          Atomic::inc(&PhaseMacroExpand::_monitor_objects_removed_counter);\n-        }\n-#endif\n-      }\n-      assert(success == (C->macro_count() < old_macro_count), \"elimination reduces macro count\");\n-      progress = progress || success;\n-    }\n-  }\n-  \/\/ Next, attempt to eliminate allocations\n-  _has_locks = false;\n-  progress = true;\n@@ -2433,2 +2412,6 @@\n-        assert(!n->as_AbstractLock()->is_eliminated(), \"sanity\");\n-        _has_locks = true;\n+          success = eliminate_locking_node(n->as_AbstractLock());\n+#ifndef PRODUCT\n+          if (success && PrintOptoStatistics) {\n+            Atomic::inc(&PhaseMacroExpand::_monitor_objects_removed_counter);\n+          }\n+#endif\n","filename":"src\/hotspot\/share\/opto\/macro.cpp","additions":7,"deletions":24,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -86,3 +86,0 @@\n-  \/\/ Additional data collected during macro expansion\n-  bool _has_locks;\n-\n@@ -202,1 +199,1 @@\n-  PhaseMacroExpand(PhaseIterGVN &igvn) : Phase(Macro_Expand), _igvn(igvn), _has_locks(false) {\n+  PhaseMacroExpand(PhaseIterGVN &igvn) : Phase(Macro_Expand), _igvn(igvn) {\n","filename":"src\/hotspot\/share\/opto\/macro.hpp","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"}]}