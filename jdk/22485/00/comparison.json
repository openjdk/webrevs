{"files":[{"patch":"@@ -2466,1 +2466,1 @@\n-void PhaseIdealLoop::do_range_check(IdealLoopTree *loop, Node_List &old_new) {\n+void PhaseIdealLoop::do_range_check(IdealLoopTree* loop) {\n@@ -2529,2 +2529,3 @@\n-  \/\/ not loop invariant).\n-  Node* new_limit_ctrl = dominated_node(pre_ctrl, pre_limit_ctrl);\n+  \/\/ not loop invariant). new_limit_ctrl is used for both the pre and main loops. Early control for the main limit may be\n+  \/\/ below the pre loop entry and the pre limit and must be taken into account when initializing new_limit_ctrl.\n+  Node* new_limit_ctrl = dominated_node(pre_ctrl, pre_limit_ctrl, compute_early_ctrl(main_limit, main_limit_ctrl));\n@@ -2781,2 +2782,2 @@\n-  set_ctrl(pre_end->cmp_node(), new_limit_ctrl);\n-  set_ctrl(pre_end->in(1), new_limit_ctrl);\n+  set_ctrl(pre_end->cmp_node(), pre_end->in(0));\n+  set_ctrl(pre_end->in(1), pre_end->in(0));\n@@ -2823,1 +2824,1 @@\n-  \/\/ invariant in the pre loop.\n+  \/\/ invariant in the pre loop).\n@@ -2825,2 +2826,1 @@\n-  set_ctrl(iffm->in(1)->in(1), new_limit_ctrl);\n-  set_ctrl(iffm->in(1), new_limit_ctrl);\n+  assert(is_dominator(new_limit_ctrl, get_ctrl(iffm->in(1)->in(1))), \"control of cmp should be below control of updated input\");\n@@ -3405,1 +3405,1 @@\n-      phase->do_range_check(this, old_new);\n+      phase->do_range_check(this);\n","filename":"src\/hotspot\/share\/opto\/loopTransform.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -1419,1 +1419,1 @@\n-  void do_range_check(IdealLoopTree *loop, Node_List &old_new);\n+  void do_range_check(IdealLoopTree* loop);\n","filename":"src\/hotspot\/share\/opto\/loopnode.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}