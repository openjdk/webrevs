{"files":[{"patch":"@@ -270,1 +270,1 @@\n-    VMError::report_java_out_of_memory(message, HeapDumpOnOutOfMemoryError);\n+    VMError::report_java_out_of_memory(message, HeapDumpOnOutOfMemoryError, CrashOnOutOfMemoryError);\n","filename":"src\/hotspot\/share\/utilities\/debug.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1914,0 +1914,2 @@\n+  bool _dumpHeap;\n+  bool _abort;\n@@ -1915,2 +1917,4 @@\n-  VM_ReportJavaOutOfMemory(const char* message, bool dumpHeap) {\n-     _message = message;\n+  VM_ReportJavaOutOfMemory(const char* message, bool dumpHeap, bool abort) {\n+     _message  = message;\n+     _dumpHeap = dumpHeap;\n+     _abort    = abort;\n@@ -1930,0 +1934,9 @@\n+  if (_dumpHeap) {\n+    HeapDumper::dump_heap_from_oome();\n+  }\n+\n+  if (_abort) {\n+    tty->print_cr(\"Aborting \");\n+    report_fatal(OOM_JAVA_HEAP_FATAL, __FILE__, __LINE__, \"OutOfMemory encountered: %s\", _message);\n+  }\n+\n@@ -1949,4 +1962,1 @@\n-void VMError::report_java_out_of_memory(const char* message, bool dumpHeap) {\n-  if(dumpHeap) {\n-    HeapDumper::dump_heap_from_oome();\n-  }\n+void VMError::report_java_out_of_memory(const char* message, bool dumpHeap, bool abort) {\n@@ -1955,1 +1965,1 @@\n-    VM_ReportJavaOutOfMemory op(message, dumpHeap);\n+    VM_ReportJavaOutOfMemory op(message, dumpHeap, abort);\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":17,"deletions":7,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -193,1 +193,1 @@\n-  static void report_java_out_of_memory(const char* message, bool dumpHeap);\n+  static void report_java_out_of_memory(const char* message, bool dumpHeap, bool abort);\n","filename":"src\/hotspot\/share\/utilities\/vmError.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-                for(int i = 0; i < oa.length; i++) {\n+                for (int i = 0; i < oa.length; i++) {\n@@ -52,0 +52,1 @@\n+                  \"-Xmx128m\",\n@@ -53,1 +54,1 @@\n-                  \"-Xlog:gc\",\n+                  \"-Xlog:safepoint=trace:file=safepoint.log\",\n@@ -57,1 +58,1 @@\n-        if(0 != exitValue) {\n+        if (exitValue != 0) {\n","filename":"test\/hotspot\/jtreg\/runtime\/ErrorHandling\/TestHeapDumpOnOutOfMemoryAndCrashOnOutOfMemory.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"}]}