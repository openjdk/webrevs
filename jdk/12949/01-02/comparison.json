{"files":[{"patch":"@@ -69,2 +69,9 @@\n-            if (currentIterator != null && !currentIterator.hasNext()) {\n-                update();\n+            \/\/ if there's no element currently available, advance until there\n+            \/\/ is one or the input is exhausted\n+            for (;;) {\n+                if (currentIterator.hasNext())\n+                    return true;\n+                else if (inputs.hasNext())\n+                    currentIterator = converter.apply(inputs.next());\n+                else\n+                    return false;\n@@ -72,1 +79,0 @@\n-            return currentIterator != null;\n@@ -77,8 +83,4 @@\n-            if (!hasNext()) {\n-                throw new NoSuchElementException();\n-            }\n-            return currentIterator.next();\n-        }\n-\n-        private void update() {\n-            while (inputs.hasNext()) {\n+            \/\/ next() cannot assume hasNext() was called immediately before:\n+            \/\/ next() must itself be able to find the next available element\n+            \/\/ if there is one\n+            while (!currentIterator.hasNext() && inputs.hasNext()) {\n@@ -86,1 +88,0 @@\n-                if (currentIterator.hasNext()) return; \/\/ implicit null check\n@@ -88,1 +89,1 @@\n-            currentIterator = null;\n+            return currentIterator.next();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/util\/Iterators.java","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n@@ -74,0 +75,7 @@\n+    @Test\n+    public void recursiveEmpty() {\n+        Iterable<Iterator<Object>> inner = () -> Iterators.createCompoundIterator(List.of(), i -> Collections.emptyIterator());\n+        Iterator<Object> outer = Iterators.createCompoundIterator(inner, Function.identity());\n+        assertFalse(outer.hasNext());\n+    }\n+\n","filename":"test\/langtools\/tools\/javac\/util\/IteratorsTest.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"}]}