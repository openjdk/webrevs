{"files":[{"patch":"@@ -32,0 +32,1 @@\n+import java.util.Comparator;\n@@ -61,0 +62,4 @@\n+    public void sortBy(List<String> order) {\n+        filters.sort(Comparator.comparingInt(f -> order.indexOf(f.getName())));\n+    }\n+\n@@ -85,0 +90,8 @@\n+    public void clearFilters() {\n+        for (Filter filter : filters) {\n+            filter.getChangedEvent().removeListener(changedListener);\n+        }\n+        filters.clear();\n+        changedEvent.fire();\n+    }\n+\n","filename":"src\/utils\/IdealGraphVisualizer\/Filter\/src\/main\/java\/com\/sun\/hotspot\/igv\/filter\/FilterChain.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-    FilterChain createNewDefaultFilterChain();\n+    FilterChain createNewCustomFilterChain();\n","filename":"src\/utils\/IdealGraphVisualizer\/Filter\/src\/main\/java\/com\/sun\/hotspot\/igv\/filter\/FilterChainProvider.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -50,2 +50,2 @@\n-    public FilterChain createNewDefaultFilterChain() {\n-        return FilterTopComponent.createNewDefaultFilterChain();\n+    public FilterChain createNewCustomFilterChain() {\n+        return FilterTopComponent.findInstance().createNewCustomFilterChain();\n","filename":"src\/utils\/IdealGraphVisualizer\/FilterWindow\/src\/main\/java\/com\/sun\/hotspot\/igv\/filterwindow\/FilterChainProviderImplementation.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -91,1 +91,1 @@\n-    public static FilterChain createNewDefaultFilterChain() {\n+    public FilterChain createNewCustomFilterChain() {\n@@ -93,1 +93,1 @@\n-        newCustomFilterChain.addFilters(defaultFilterChain.getFilters());\n+        newCustomFilterChain.addFilters(customFilterChain.getFilters());\n@@ -136,1 +136,0 @@\n-        customFilterChain = createNewDefaultFilterChain();\n@@ -139,0 +138,2 @@\n+        customFilterChain = new FilterChain(CUSTOM_LABEL);\n+        customFilterChain.addFilters(defaultFilterChain.getFilters());\n@@ -343,5 +344,1 @@\n-            allFiltersOrdered.addFilter(cf);\n-            FileObject fo = getFileObject(cf);\n-            FilterChangedListener listener = new FilterChangedListener(fo, cf);\n-            listener.changed(cf);\n-            cf.getChangedEvent().addListener(listener);\n+            addFilter(cf);\n@@ -351,2 +348,7 @@\n-    public void removeFilter(Filter f) {\n-        CustomFilter cf = (CustomFilter) f;\n+    public void addFilter(CustomFilter cf) {\n+        allFiltersOrdered.addFilter(cf);\n+        FileObject fo = getFileObject(cf);\n+        FilterChangedListener listener = new FilterChangedListener(fo, cf);\n+        listener.changed(cf);\n+        cf.getChangedEvent().addListener(listener);\n+    }\n@@ -354,0 +356,1 @@\n+    public void removeFilter(CustomFilter cf) {\n@@ -360,0 +363,1 @@\n+    }\n@@ -361,0 +365,10 @@\n+    private FileObject getFileObject(CustomFilter f) {\n+        FileObject fo = FileUtil.getConfigRoot().getFileObject(FOLDER_ID + \"\/\" + f.getName() + \".js\");\n+        if (fo == null) {\n+            try {\n+                fo = FileUtil.getConfigRoot().getFileObject(FOLDER_ID).createData(f.getName() + \".js\");\n+            } catch (IOException ex) {\n+                Exceptions.printStackTrace(ex);\n+            }\n+        }\n+        return fo;\n@@ -378,1 +392,1 @@\n-                    fileObject.move(lock, fileObject.getParent(), filter.getName(), \"\");\n+                    fileObject.move(lock, fileObject.getParent(), filter.getName(), \"js\");\n@@ -380,1 +394,1 @@\n-                    fileObject = fileObject.getParent().getFileObject(filter.getName());\n+                    fileObject = fileObject.getParent().getFileObject(filter.getName() + \".js\");\n@@ -440,0 +454,1 @@\n+            System.out.println(displayName + \" after \" + after);\n@@ -447,2 +462,0 @@\n-            cf.getChangedEvent().addListener(new FilterChangedListener(fo, cf));\n-\n@@ -474,1 +487,1 @@\n-            allFiltersOrdered.addFilter(cf);\n+            addFilter(cf);\n@@ -537,12 +550,0 @@\n-    private FileObject getFileObject(CustomFilter cf) {\n-        FileObject fo = FileUtil.getConfigRoot().getFileObject(FOLDER_ID + \"\/\" + cf.getName());\n-        if (fo == null) {\n-            try {\n-                fo = FileUtil.getConfigRoot().getFileObject(FOLDER_ID).createData(cf.getName());\n-            } catch (IOException ex) {\n-                Exceptions.printStackTrace(ex);\n-            }\n-        }\n-        return fo;\n-    }\n-\n@@ -572,1 +573,2 @@\n-        out.writeInt(comboBox.getItemCount()-1);\n+        out.writeUTF(getCurrentChain().getName());\n+        out.writeInt(comboBox.getItemCount());\n@@ -575,7 +577,5 @@\n-            if (filterChain != customFilterChain) {\n-                out.writeUTF(filterChain.getName());\n-                out.writeInt(filterChain.getFilters().size());\n-                for (Filter filter : filterChain.getFilters()) {\n-                    CustomFilter cf = (CustomFilter) filter;\n-                    out.writeUTF(cf.getName());\n-                }\n+            out.writeUTF(filterChain.getName());\n+            out.writeInt(filterChain.getFilters().size());\n+            for (Filter filter : filterChain.getFilters()) {\n+                CustomFilter cf = (CustomFilter) filter;\n+                out.writeUTF(cf.getName());\n@@ -584,1 +584,0 @@\n-    }\n@@ -586,6 +585,3 @@\n-    public CustomFilter findFilter(String name) {\n-        for (Filter f : allFiltersOrdered.getFilters()) {\n-            CustomFilter cf = (CustomFilter) f;\n-            if (cf.getName().equals(name)) {\n-                return cf;\n-            }\n+        out.writeInt(allFiltersOrdered.getFilters().size());\n+        for (Filter filter : allFiltersOrdered.getFilters()) {\n+            out.writeUTF(filter.getName());\n@@ -593,2 +589,0 @@\n-\n-        return null;\n@@ -601,0 +595,1 @@\n+        String selectedChainName = in.readUTF();\n@@ -613,4 +608,8 @@\n-            for (int cnt=0; cnt<comboBox.getItemCount(); cnt++) {\n-                FilterChain s = comboBox.getItemAt(cnt);\n-                if (s.getName().equals(name)) {\n-                    comboBox.removeItem(s);\n+            if (Objects.equals(filterChain.getName(), customFilterChain.getName())) {\n+                setCustomFilterChain(filterChain);\n+            } else {\n+                for (int cnt=0; cnt<comboBox.getItemCount(); cnt++) {\n+                    FilterChain s = comboBox.getItemAt(cnt);\n+                    if (s.getName().equals(name)) {\n+                        comboBox.removeItem(s);\n+                    }\n@@ -618,0 +617,23 @@\n+                comboBox.addItem(filterChain);\n+            }\n+            if (selectedChainName.equals(filterChain.getName())) {\n+                selectFilterChain(filterChain);\n+            }\n+        }\n+\n+        ArrayList<String> order = new ArrayList<>();\n+        int filterOrderCount = in.readInt();\n+        for (int i = 0; i < filterOrderCount; i++) {\n+            String name = in.readUTF();\n+            order.add(name);\n+        }\n+        allFiltersOrdered.sortBy(order);\n+\n+        System.out.println(\"readExternal\");\n+    }\n+\n+    public CustomFilter findFilter(String name) {\n+        for (Filter f : allFiltersOrdered.getFilters()) {\n+            CustomFilter cf = (CustomFilter) f;\n+            if (cf.getName().equals(name)) {\n+                return cf;\n@@ -619,1 +641,0 @@\n-            comboBox.addItem(filterChain);\n@@ -621,0 +642,2 @@\n+\n+        return null;\n","filename":"src\/utils\/IdealGraphVisualizer\/FilterWindow\/src\/main\/java\/com\/sun\/hotspot\/igv\/filterwindow\/FilterTopComponent.java","additions":72,"deletions":49,"binary":false,"changes":121,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+import com.sun.hotspot.igv.filter.CustomFilter;\n@@ -57,2 +58,2 @@\n-            for (int i = 0; i < activatedNodes.length; i++) {\n-                FilterTopComponent.findInstance().removeFilter(activatedNodes[i].getLookup().lookup(Filter.class));\n+            for (Node activatedNode : activatedNodes) {\n+                FilterTopComponent.findInstance().removeFilter(activatedNode.getLookup().lookup(CustomFilter.class));\n","filename":"src\/utils\/IdealGraphVisualizer\/FilterWindow\/src\/main\/java\/com\/sun\/hotspot\/igv\/filterwindow\/actions\/RemoveFilterAction.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -5,1 +5,1 @@\n-        <file name=\"Color by category\" url=\"filters\/color.filter\">\n+        <file name=\"Color by category.js\" url=\"filters\/color.filter\">\n@@ -8,1 +8,1 @@\n-        <file name=\"Color by execution frequency\" url=\"filters\/colorFrequency.filter\">\n+        <file name=\"Color by execution frequency.js\" url=\"filters\/colorFrequency.filter\">\n@@ -12,1 +12,1 @@\n-        <file name=\"Show node warnings\" url=\"filters\/showWarnings.filter\">\n+        <file name=\"Show node warnings.js\" url=\"filters\/showWarnings.filter\">\n@@ -16,1 +16,1 @@\n-        <file name=\"Simplify graph\" url=\"filters\/structural.filter\">\n+        <file name=\"Simplify graph.js\" url=\"filters\/structural.filter\">\n@@ -20,1 +20,1 @@\n-        <file name=\"Hide data subgraph\" url=\"filters\/hideData.filter\">\n+        <file name=\"Hide data subgraph.js\" url=\"filters\/hideData.filter\">\n@@ -24,1 +24,1 @@\n-        <file name=\"Hide memory subgraph\" url=\"filters\/hideMemory.filter\">\n+        <file name=\"Hide memory subgraph.js\" url=\"filters\/hideMemory.filter\">\n@@ -28,1 +28,1 @@\n-        <file name=\"Hide control subgraph\" url=\"filters\/hideControl.filter\">\n+        <file name=\"Hide control subgraph.js\" url=\"filters\/hideControl.filter\">\n@@ -32,1 +32,1 @@\n-        <file name=\"Hide mixed subgraph\" url=\"filters\/hideMixed.filter\">\n+        <file name=\"Hide mixed subgraph.js\" url=\"filters\/hideMixed.filter\">\n@@ -36,1 +36,1 @@\n-        <file name=\"Hide other subgraph\" url=\"filters\/hideOther.filter\">\n+        <file name=\"Hide other subgraph.js\" url=\"filters\/hideOther.filter\">\n@@ -40,1 +40,1 @@\n-        <file name=\"Show control flow only\" url=\"filters\/onlyControlFlow.filter\">\n+        <file name=\"Show control flow only.js\" url=\"filters\/onlyControlFlow.filter\">\n@@ -44,1 +44,1 @@\n-        <file name=\"Hide data edges\" url=\"filters\/hideDataEdges.filter\">\n+        <file name=\"Hide data edges.js\" url=\"filters\/hideDataEdges.filter\">\n@@ -48,1 +48,1 @@\n-        <file name=\"Hide memory edges\" url=\"filters\/hideMemoryEdges.filter\">\n+        <file name=\"Hide memory edges.js\" url=\"filters\/hideMemoryEdges.filter\">\n@@ -52,1 +52,1 @@\n-        <file name=\"Hide control edges\" url=\"filters\/hideControlEdges.filter\">\n+        <file name=\"Hide control edges.js\" url=\"filters\/hideControlEdges.filter\">\n@@ -56,1 +56,1 @@\n-        <file name=\"Hide mixed edges\" url=\"filters\/hideMixedEdges.filter\">\n+        <file name=\"Hide mixed edges.js\" url=\"filters\/hideMixedEdges.filter\">\n@@ -60,1 +60,1 @@\n-        <file name=\"Hide other edges\" url=\"filters\/hideOtherEdges.filter\">\n+        <file name=\"Hide other edges.js\" url=\"filters\/hideOtherEdges.filter\">\n@@ -64,1 +64,1 @@\n-        <file name=\"Hide root block\" url=\"filters\/hideRootBlock.filter\">\n+        <file name=\"Hide root block.js\" url=\"filters\/hideRootBlock.filter\">\n@@ -68,1 +68,1 @@\n-        <file name=\"Hide uncommon trap blocks\" url=\"filters\/hideUncommonTrapBlocks.filter\">\n+        <file name=\"Hide uncommon trap blocks.js\" url=\"filters\/hideUncommonTrapBlocks.filter\">\n@@ -72,1 +72,1 @@\n-        <file name=\"Hide exception blocks\" url=\"filters\/hideExceptionBlocks.filter\">\n+        <file name=\"Hide exception blocks.js\" url=\"filters\/hideExceptionBlocks.filter\">\n","filename":"src\/utils\/IdealGraphVisualizer\/ServerCompiler\/src\/main\/resources\/com\/sun\/hotspot\/igv\/servercompiler\/layer.xml","additions":18,"deletions":18,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -55,1 +55,0 @@\n-    private FilterChain customFilterChain;\n@@ -57,0 +56,1 @@\n+    private final FilterChain customFilterChain;\n@@ -154,3 +154,4 @@\n-        customFilterChain = (provider != null) ? provider.createNewDefaultFilterChain() : new FilterChain();\n-        filterChain = (provider != null) ? provider.getFilterChain() : customFilterChain;\n-        filtersOrder = (provider != null) ? provider.getAllFiltersOrdered() : customFilterChain;\n+        assert provider != null;\n+        customFilterChain = provider.createNewCustomFilterChain();\n+        setFilterChain(provider.getFilterChain(), customFilterChain);\n+        filtersOrder = provider.getAllFiltersOrdered();\n@@ -189,1 +190,0 @@\n-        filterChain.getChangedEvent().addListener(filterChainChangedListener);\n@@ -294,6 +294,6 @@\n-    public void initFiltersFromModel(DiagramViewModel other) {\n-        filterChain.getChangedEvent().removeListener(filterChainChangedListener);\n-        customFilterChain = new FilterChain(other.getCustomFilterChain().getName());\n-        customFilterChain.addFilters(other.getCustomFilterChain().getFilters());\n-        if (other.getFilterChain() == other.getCustomFilterChain()) {\n-            filterChain = customFilterChain;\n+    private void setFilterChain(FilterChain newFC, FilterChain customFC) {\n+        if (filterChain != null) {\n+            filterChain.getChangedEvent().removeListener(filterChainChangedListener);\n+        }\n+        if (newFC.getName().equals(customFC.getName())) {\n+            filterChain = customFC;\n@@ -301,1 +301,1 @@\n-            filterChain = other.getFilterChain();\n+            filterChain = newFC;\n@@ -306,0 +306,6 @@\n+    public void initFiltersFromModel(DiagramViewModel other) {\n+        customFilterChain.clearFilters();\n+        customFilterChain.addFilters(other.getCustomFilterChain().getFilters());\n+        setFilterChain(other.getFilterChain(), customFilterChain);\n+    }\n+\n@@ -312,3 +318,1 @@\n-                filterChain.getChangedEvent().removeListener(filterChainChangedListener);\n-                filterChain = provider.getFilterChain();\n-                filterChain.getChangedEvent().addListener(filterChainChangedListener);\n+                setFilterChain(provider.getFilterChain(), customFilterChain);\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/DiagramViewModel.java","additions":19,"deletions":15,"binary":false,"changes":34,"status":"modified"}]}