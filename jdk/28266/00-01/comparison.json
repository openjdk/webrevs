{"files":[{"patch":"@@ -205,2 +205,14 @@\n-  if (!Thread::current()->is_VM_thread()) {\n-    assert_lock_strong(PSOldGenExpand_lock);\n+  \/\/  During startup (is_init_completed() == false), expansion can occur for\n+  \/\/    1. java-threads invoking heap-allocation (using Heap_lock)\n+  \/\/    2. CDS construction by a single thread (using PSOldGenExpand_lock but not needed)\n+  \/\/\n+  \/\/  After startup (is_init_completed() == true), expansion can occur for\n+  \/\/    1. GC workers for promoting to old-gen (using PSOldGenExpand_lock)\n+  \/\/    2. VM thread to satisfy the pending allocation\n+  \/\/    Both cases are inside safepoint pause, but are never overlapping.\n+  \/\/\n+  if (is_init_completed()) {\n+    assert(SafepointSynchronize::is_at_safepoint(), \"precondition\");\n+    assert(Thread::current()->is_VM_thread() || PSOldGenExpand_lock->owned_by_self(), \"precondition\");\n+  } else {\n+    assert(Heap_lock->owned_by_self() || PSOldGenExpand_lock->owned_by_self(), \"precondition\");\n@@ -208,1 +220,0 @@\n-  assert_locked_or_safepoint(Heap_lock);\n","filename":"src\/hotspot\/share\/gc\/parallel\/psOldGen.cpp","additions":14,"deletions":3,"binary":false,"changes":17,"status":"modified"}]}