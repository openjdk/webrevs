{"files":[{"patch":"@@ -183,13 +183,0 @@\n-\/\/ Only used by oldgen allocation.\n-bool MutableSpace::needs_expand(size_t word_size) const {\n-  \/\/ This method can be invoked either outside of safepoint by java threads or\n-  \/\/ in safepoint by gc workers. Such accesses are synchronized by holding one\n-  \/\/ of the following locks.\n-  assert(Heap_lock->is_locked() || PSOldGenExpand_lock->is_locked(), \"precondition\");\n-\n-  \/\/ Holding the lock means end is stable.  So while top may be advancing\n-  \/\/ via concurrent allocations, there is no need to order the reads of top\n-  \/\/ and end here, unlike in cas_allocate.\n-  return pointer_delta(end(), top()) < word_size;\n-}\n-\n","filename":"src\/hotspot\/share\/gc\/parallel\/mutableSpace.cpp","additions":0,"deletions":13,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -130,5 +130,0 @@\n-  \/\/ Return true if this space needs to be expanded in order to satisfy an\n-  \/\/ allocation request of the indicated size.  Concurrent allocations and\n-  \/\/ resizes may change the result of a later call.  Used by oldgen allocator.\n-  \/\/ precondition: holding PSOldGenExpand_lock if not VM thread\n-  bool needs_expand(size_t word_size) const;\n","filename":"src\/hotspot\/share\/gc\/parallel\/mutableSpace.hpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -406,0 +406,1 @@\n+#ifdef ASSERT\n@@ -407,0 +408,8 @@\n+  if (is_init_completed()) {\n+    assert(SafepointSynchronize::is_at_safepoint(), \"precondition\");\n+    assert(Thread::current()->is_VM_thread(), \"precondition\");\n+  } else {\n+    assert(Thread::current()->is_Java_thread(), \"precondition\");\n+    assert(Heap_lock->owned_by_self(), \"precondition\");\n+  }\n+#endif\n","filename":"src\/hotspot\/share\/gc\/parallel\/parallelScavengeHeap.cpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+#include \"runtime\/init.hpp\"\n@@ -121,0 +122,1 @@\n+#ifdef ASSERT\n@@ -122,0 +124,8 @@\n+  if (is_init_completed()) {\n+    assert(SafepointSynchronize::is_at_safepoint(), \"precondition\");\n+    assert(Thread::current()->is_VM_thread(), \"precondition\");\n+  } else {\n+    assert(Thread::current()->is_Java_thread(), \"precondition\");\n+    assert(Heap_lock->owned_by_self(), \"precondition\");\n+  }\n+#endif\n@@ -123,1 +133,1 @@\n-  if (object_space()->needs_expand(word_size)) {\n+  if (pointer_delta(object_space()->end(), object_space()->top()) < word_size) {\n@@ -127,1 +137,1 @@\n-  \/\/ Reuse the CAS API even though this is VM thread in safepoint. This method\n+  \/\/ Reuse the CAS API even though this is in a critical section. This method\n@@ -171,1 +181,1 @@\n-    if (object_space()->needs_expand(word_size)) {\n+    if (pointer_delta(object_space()->end(), object_space()->top()) < word_size) {\n","filename":"src\/hotspot\/share\/gc\/parallel\/psOldGen.cpp","additions":13,"deletions":3,"binary":false,"changes":16,"status":"modified"}]}