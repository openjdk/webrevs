{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,0 +37,1 @@\n+import jdk.jfr.consumer.EventStream;\n@@ -38,1 +39,1 @@\n-import jdk.jfr.consumer.RecordingStream;\n+import jdk.test.lib.jfr.TestClassLoader;\n@@ -55,0 +56,1 @@\n+    public static Object OBJECT;\n@@ -57,4 +59,4 @@\n-        Set<Instant> threadDumps = Collections.synchronizedSet(new LinkedHashSet<>());\n-        Set<Instant> classLoaderStatistics = Collections.synchronizedSet(new LinkedHashSet<>());\n-        Set<Instant> physicalMemory = Collections.synchronizedSet(new LinkedHashSet<>());\n-\n+        TestClassLoader loader = new TestClassLoader();\n+        Class<?> clazz = loader.loadClass(TestBackToBackSensitive.class.getName());\n+        String classLoaderName = loader.getClass().getName();\n+        OBJECT = clazz.getDeclaredConstructor().newInstance();\n@@ -62,13 +64,1 @@\n-        try (RecordingStream r1 = new RecordingStream(configuration)) {\n-            r1.setMaxSize(Long.MAX_VALUE);\n-            r1.onEvent(\"jdk.ThreadDump\", e -> threadDumps.add(e.getStartTime()));\n-            r1.onEvent(\"jdk.ClassLoaderStatistics\", e -> {\n-                RecordedClassLoader cl = e.getValue(\"classLoader\");\n-                if (cl != null) {\n-                    if (cl.getType().getName().contains(\"PlatformClassLoader\")) {\n-                        classLoaderStatistics.add(e.getStartTime());\n-                        System.out.println(\"Class loader\" + e);\n-                    }\n-                }\n-            });\n-            r1.onEvent(\"jdk.PhysicalMemory\", e -> physicalMemory.add(e.getStartTime()));\n+        try (Recording r1 = new Recording(configuration)) {\n@@ -76,1 +66,1 @@\n-            r1.startAsync();\n+            r1.start();\n@@ -89,0 +79,19 @@\n+            Path file = Path.of(\"file.jfr\");\n+            r1.dump(file);\n+            Set<Instant> threadDumps = new LinkedHashSet<>();\n+            Set<Instant> classLoaderStatistics = new LinkedHashSet<>();\n+            Set<Instant> physicalMemory = new LinkedHashSet<>();\n+            try (EventStream es = EventStream.openFile(file)) {\n+                es.onEvent(\"jdk.ThreadDump\", e -> threadDumps.add(e.getStartTime()));\n+                es.onEvent(\"jdk.ClassLoaderStatistics\", e -> {\n+                    RecordedClassLoader cl = e.getValue(\"classLoader\");\n+                    if (cl != null) {\n+                        if (cl.getType().getName().equals(classLoaderName)) {\n+                            classLoaderStatistics.add(e.getStartTime());\n+                            System.out.println(\"Class loader\" + e);\n+                        }\n+                    }\n+                });\n+                es.onEvent(\"jdk.PhysicalMemory\", e -> physicalMemory.add(e.getStartTime()));\n+                es.start();\n+            }\n@@ -96,1 +105,1 @@\n-            assertCount(r1, \"jdk.PhysicalMemory\", physicalMemory, 2 * chunkFiles);\n+            assertCount(\"jdk.PhysicalMemory\", physicalMemory, 2 * chunkFiles);\n@@ -103,2 +112,2 @@\n-            assertCount(r1, \"jdk.ThreadDump\", threadDumps, 2 + 2 + (chunkFiles - 2));\n-            assertCount(r1, \"jdk.ClassLoaderStatistics\", classLoaderStatistics, 2 + 2 + (chunkFiles - 2));\n+            assertCount(\"jdk.ThreadDump\", threadDumps, 2 + 2 + (chunkFiles - 2));\n+            assertCount(\"jdk.ClassLoaderStatistics\", classLoaderStatistics, 2 + 2 + (chunkFiles - 2));\n@@ -113,1 +122,1 @@\n-    private static void assertCount(RecordingStream stream, String eventName, Set<Instant> timestamps, long expected) throws Exception {\n+    private static void assertCount(String eventName, Set<Instant> timestamps, long expected) throws Exception {\n@@ -120,2 +129,0 @@\n-            System.out.println(\"Dumping failure file.\");\n-            stream.dump(Path.of(\"failure.jfr\"));\n","filename":"test\/jdk\/jdk\/jfr\/event\/runtime\/TestBackToBackSensitive.java","additions":33,"deletions":26,"binary":false,"changes":59,"status":"modified"}]}