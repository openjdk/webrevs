{"files":[{"patch":"@@ -441,4 +441,1 @@\n-        return getMetadata(Annotations.class)\n-                .map(a -> { a.setAnnotations(annos) ; return this; })\n-                .orElseGet(() ->\n-                    addMetadata(new Annotations(annos)));\n+        return addMetadata(new Annotations(annos));\n@@ -454,1 +451,1 @@\n-                .map(Annotations::getAnnotations).orElse(List.nil());\n+                .map(Annotations::annotations).orElse(List.nil());\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Type.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -28,2 +28,0 @@\n-import com.sun.tools.javac.code.Attribute.TypeCompound;\n-import com.sun.tools.javac.util.Assert;\n@@ -31,0 +29,1 @@\n+import com.sun.tools.javac.util.ListBuffer;\n@@ -59,2 +58,1 @@\n-    final class Annotations implements TypeMetadata {\n-        private List<Attribute.TypeCompound> annos;\n+    record Annotations(ListBuffer<Attribute.TypeCompound> annotationBuffer) implements TypeMetadata {\n@@ -62,8 +60,2 @@\n-        public static final List<Attribute.TypeCompound> TO_BE_SET = List.nil();\n-\n-        public Annotations() {\n-            this.annos = TO_BE_SET;\n-        }\n-\n-        public Annotations(List<Attribute.TypeCompound> annos) {\n-            this.annos = annos;\n+        Annotations() {\n+            this(new ListBuffer<>());\n@@ -72,2 +64,3 @@\n-        public List<Attribute.TypeCompound> getAnnotations() {\n-            return annos;\n+        Annotations(List<Attribute.TypeCompound> annotations) {\n+            this();\n+            annotationBuffer.appendList(annotations);\n@@ -76,3 +69,2 @@\n-        public void setAnnotations(List<TypeCompound> annos) {\n-            Assert.check(this.annos == TO_BE_SET);\n-            this.annos = annos;\n+        List<Attribute.TypeCompound> annotations() {\n+            return annotationBuffer.toList();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/TypeMetadata.java","additions":9,"deletions":17,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -1054,2 +1054,2 @@\n-            Assert.check(metadata.getAnnotations() == Annotations.TO_BE_SET);\n-            storeAt.getMetadata(Annotations.class).get().setAnnotations(compounds);\n+            Assert.check(metadata.annotationBuffer().isEmpty());\n+            metadata.annotationBuffer().appendList(compounds);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Annotate.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}