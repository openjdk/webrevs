{"files":[{"patch":"@@ -549,1 +549,5 @@\n-                    if (unconditionalExactnessCheck(selectorType, classLabel)) {\n+                    if (isNotValidPair(selectorType, caseLabel)){\n+                        cb.goto_(next);\n+                        continue;\n+                    }\n+                    else if (unconditionalExactnessCheck(selectorType, classLabel)) {\n@@ -720,0 +724,5 @@\n+    private static boolean isNotValidPair(Class<?> selectorType, Object caseLabel) {\n+        return (selectorType == boolean.class && caseLabel != boolean.class && caseLabel != Boolean.class) ||\n+               (selectorType != boolean.class && selectorType.isPrimitive() && (caseLabel == boolean.class || caseLabel == Boolean.class));\n+    }\n+\n@@ -772,5 +781,5 @@\n-                ((selectorType.equals(byte.class) && !targetType.equals(char.class)) ||\n-                 (selectorType.equals(short.class) && (selectorWrapper.isStrictSubRangeOf(targetWrapper))) ||\n-                 (selectorType.equals(char.class)  && (selectorWrapper.isStrictSubRangeOf(targetWrapper)))  ||\n-                 (selectorType.equals(int.class)   && (targetType.equals(double.class) || targetType.equals(long.class))) ||\n-                 (selectorType.equals(float.class) && (selectorWrapper.isStrictSubRangeOf(targetWrapper))))) return true;\n+                (targetType.isPrimitive() && selectorType.isPrimitive() &&\n+                    (selectorWrapper.isStrictSubRangeOf(targetWrapper) &&\n+                            !((selectorType.equals(byte.class) && targetType.equals(char.class)) ||\n+                              (selectorType.equals(int.class)  && targetType.equals(float.class)) ||\n+                              (selectorType.equals(long.class) && (targetType.equals(double.class) || targetType.equals(float.class))))))) return true;\n","filename":"src\/java.base\/share\/classes\/java\/lang\/runtime\/SwitchBootstraps.java","additions":15,"deletions":6,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -5088,10 +5088,6 @@\n-        if (isSameType(selectorType, targetType)) {\n-            return true;\n-        }\n-\n-        return (selectorType.isPrimitive() && targetType.isPrimitive()) &&\n-                ((selectorType.hasTag(BYTE) && !targetType.hasTag(CHAR)) ||\n-                 (selectorType.hasTag(SHORT) && (selectorType.getTag().isStrictSubRangeOf(targetType.getTag()))) ||\n-                 (selectorType.hasTag(CHAR)  && (selectorType.getTag().isStrictSubRangeOf(targetType.getTag())))  ||\n-                 (selectorType.hasTag(INT)   && (targetType.hasTag(DOUBLE) || targetType.hasTag(LONG))) ||\n-                 (selectorType.hasTag(FLOAT) && (selectorType.getTag().isStrictSubRangeOf(targetType.getTag()))));\n+        return isSameType(selectorType, targetType) ||\n+                (selectorType.isPrimitive() && targetType.isPrimitive()) &&\n+                ((selectorType.getTag().isStrictSubRangeOf(targetType.getTag())) &&\n+                        !((selectorType.hasTag(BYTE) && targetType.hasTag(CHAR)) ||\n+                          (selectorType.hasTag(INT)  && targetType.hasTag(FLOAT)) ||\n+                          (selectorType.hasTag(LONG) && (targetType.hasTag(DOUBLE) || targetType.hasTag(FLOAT)))));\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Types.java","additions":6,"deletions":10,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -77,0 +77,6 @@\n+    private void testPrimitiveType(Object target, Class<?> targetType, int start, int result, Object... labels) throws Throwable {\n+        MethodType switchType = MethodType.methodType(int.class, targetType, int.class);\n+        MethodHandle indy = ((CallSite) BSM_TYPE_SWITCH.invoke(MethodHandles.lookup(), \"\", switchType, labels)).dynamicInvoker();\n+        assertEquals((int) indy.invoke(target, start), result);\n+    }\n+\n@@ -135,0 +141,12 @@\n+    public void testPrimitiveTypes() throws Throwable {\n+        testPrimitiveType((short) 1, short.class, 0, 1, String.class);\n+        testPrimitiveType((byte) 1, byte.class,0, 1, String.class, byte.class);\n+        testPrimitiveType(true, boolean.class,0, 1, false, boolean.class);\n+        testPrimitiveType(1, int.class,0, 1, String.class);\n+        testPrimitiveType(1, int.class,0, 1, true);\n+        testPrimitiveType(true, boolean.class,0, 1, false);\n+        testPrimitiveType((byte) 1, byte.class,0, 1, boolean.class, byte.class);\n+        testPrimitiveType((byte) 1, byte.class,0, 1, Boolean.class, byte.class);\n+        testPrimitiveType(true, boolean.class,0, 1, String.class, boolean.class);\n+    }\n+\n","filename":"test\/jdk\/java\/lang\/runtime\/SwitchBootstrapsTest.java","additions":18,"deletions":0,"binary":false,"changes":18,"status":"modified"}]}