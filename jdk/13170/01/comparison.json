{"files":[{"patch":"@@ -33,3 +33,0 @@\n-com\/sun\/jdi\/FetchLocals.java 8285422 generic-all\n-com\/sun\/jdi\/Frames2Test.java 8285422 generic-all\n-com\/sun\/jdi\/GetSetLocalTest.java 8285422 generic-all\n@@ -40,1 +37,0 @@\n-com\/sun\/jdi\/LaunchCommandLine.java 8285422 generic-all\n@@ -43,1 +39,0 @@\n-com\/sun\/jdi\/NativeInstanceFilter.java 8285422 generic-all\n","filename":"test\/jdk\/ProblemList-svc-vthread.txt","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -466,9 +466,11 @@\n-        String mainWrapper = System.getProperty(\"main.wrapper\");\n-        if (\"Virtual\".equals(mainWrapper)) {\n-            argInfo.targetAppCommandLine = TestScaffold.class.getName() + \" \" + mainWrapper + \" \";\n-            argInfo.targetVMArgs += \"--enable-preview \";\n-        } else if (\"true\".equals(System.getProperty(\"test.enable.preview\"))) {\n-            \/\/ the test specified @enablePreview.\n-            argInfo.targetVMArgs += \"--enable-preview \";\n-        }\n-\n+        \/\/ Parse arguments, like java\/j* tools command-line arguments\n+        \/\/ the first argument not-starting with '-' is treated as a classname\n+        \/\/ the other arguments are split to targetVMArgs targetAppCommandLine correspondingly\n+        \/\/ The example of args for line '@run driver Frames2Test -Xss4M' is  '-Xss4M' 'Frames2Targ'.\n+        \/\/ The result without any wrapper enabled:\n+        \/\/ argInfo.targetAppCommandLine : Frames2Targ\n+        \/\/ argInfo.targetVMArgs : -Xss4M\n+        \/\/ The result with wrapper enabled:\n+        \/\/ argInfo.targetAppCommandLine : TestScaffold Virtual Frames2Targ\n+        \/\/ argInfo.targetVMArgs : -Xss4M --enable-preview\n+        boolean classNameParsed = false;\n@@ -476,1 +478,7 @@\n-            if (args[i].equals(\"-connect\")) {\n+            String arg = args[i].trim();\n+            if (classNameParsed) {\n+                \/\/ once classname is read, treat any other arguments as app arguments\n+                argInfo.targetAppCommandLine += (arg + ' ');\n+                continue;\n+            }\n+            if (arg.equals(\"-connect\")) {\n@@ -479,1 +487,1 @@\n-            } else if (args[i].equals(\"-trace\")) {\n+            } else if (arg.equals(\"-trace\")) {\n@@ -482,1 +490,1 @@\n-            } else if (args[i].equals(\"-redefstart\")) {\n+            } else if (arg.equals(\"-redefstart\")) {\n@@ -484,1 +492,1 @@\n-            } else if (args[i].equals(\"-redefevent\")) {\n+            } else if (arg.equals(\"-redefevent\")) {\n@@ -486,1 +494,1 @@\n-            } else if (args[i].equals(\"-redefasync\")) {\n+            } else if (arg.equals(\"-redefasync\")) {\n@@ -488,2 +496,2 @@\n-            } else if (args[i].startsWith(\"-J\")) {\n-                argInfo.targetVMArgs += (args[i].substring(2) + ' ');\n+            } else if (arg.startsWith(\"-J\")) {\n+                argInfo.targetVMArgs += (arg.substring(2) + ' ');\n@@ -495,1 +503,1 @@\n-                if (args[i].equals(\"-J-classpath\")) {\n+                if (arg.equals(\"-J-classpath\")) {\n@@ -499,0 +507,2 @@\n+            } else if (arg.startsWith(\"-\")) {\n+                argInfo.targetVMArgs += (arg + ' ');\n@@ -500,1 +510,2 @@\n-                argInfo.targetAppCommandLine += (args[i] + ' ');\n+                classNameParsed = true;\n+                argInfo.targetAppCommandLine += (arg + ' ');\n@@ -503,0 +514,11 @@\n+\n+        \/\/ Need to change args to run wrapper using command like 'TestScaffold Virtual <app-name>'\n+        String mainWrapper = System.getProperty(\"main.wrapper\");\n+        if (mainWrapper != null && !argInfo.targetAppCommandLine.isEmpty()) {\n+            argInfo.targetAppCommandLine = TestScaffold.class.getName() + ' '\n+                    + mainWrapper + ' ' + argInfo.targetAppCommandLine;\n+            argInfo.targetVMArgs += \"--enable-preview \";\n+        } else if (\"true\".equals(System.getProperty(\"test.enable.preview\"))) {\n+            \/\/ the test specified @enablePreview.\n+            argInfo.targetVMArgs += \"--enable-preview \";\n+        }\n","filename":"test\/jdk\/com\/sun\/jdi\/TestScaffold.java","additions":40,"deletions":18,"binary":false,"changes":58,"status":"modified"}]}