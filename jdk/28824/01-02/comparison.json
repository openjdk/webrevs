{"files":[{"patch":"@@ -2467,1 +2467,1 @@\n-cpu_time_t os::detailed_thread_cpu_time(Thread* t) {\n+CPUTime os::detailed_thread_cpu_time(Thread* t) {\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2293,1 +2293,1 @@\n-cpu_time_t os::detailed_thread_cpu_time(Thread* t) {\n+CPUTime os::detailed_thread_cpu_time(Thread* t) {\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -5001,1 +5001,1 @@\n-cpu_time_t os::detailed_thread_cpu_time(Thread* t) {\n+CPUTime os::detailed_thread_cpu_time(Thread* t) {\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -4895,1 +4895,1 @@\n-cpu_time_t os::detailed_thread_cpu_time(Thread* t) {\n+CPUTime os::detailed_thread_cpu_time(Thread* t) {\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -73,0 +73,10 @@\n+static CPUTime sample_detailed_cpu_time() {\n+  CPUTime cpu_time_vm = CPUTimeUsage::GC::detailed_gc_operation_vm_thread();\n+  CPUTime cpu_time_gc = CPUTimeUsage::GC::detailed_gc_threads();\n+  CPUTime cpu_time_stringdedup = CPUTimeUsage::GC::detailed_stringdedup();\n+  return {\n+    cpu_time_vm.user + cpu_time_gc.user + cpu_time_stringdedup.user,\n+    cpu_time_vm.system + cpu_time_gc.system + cpu_time_stringdedup.system\n+  };\n+}\n+\n@@ -76,2 +86,1 @@\n-  _starting_user_time(0),\n-  _starting_system_time(0),\n+  _starting_cpu_time(0,0),\n@@ -79,2 +88,1 @@\n-  _tracer(tracer)\n-{\n+  _tracer(tracer) {\n@@ -82,5 +90,1 @@\n-    cpu_time_t cpu_time_vm = CPUTimeUsage::GC::detailed_gc_operation_vm_thread();\n-    cpu_time_t cpu_time_gc = CPUTimeUsage::GC::detailed_gc_threads();\n-    cpu_time_t cpu_time_stringdedup = CPUTimeUsage::GC::detailed_stringdedup();\n-    _starting_user_time = cpu_time_vm.user + cpu_time_gc.user + cpu_time_stringdedup.user;\n-    _starting_system_time = cpu_time_vm.system + cpu_time_gc.system + cpu_time_stringdedup.system;\n+    _starting_cpu_time = sample_detailed_cpu_time();\n@@ -97,7 +101,2 @@\n-    cpu_time_t cpu_time_vm = CPUTimeUsage::GC::detailed_gc_operation_vm_thread();\n-    cpu_time_t cpu_time_gc = CPUTimeUsage::GC::detailed_gc_threads();\n-    cpu_time_t cpu_time_stringdedup = CPUTimeUsage::GC::detailed_stringdedup();\n-\n-    double real_time = os::elapsedTime() - _starting_real_time;\n-    jlong user_time = cpu_time_vm.user + cpu_time_gc.user + cpu_time_stringdedup.user;\n-    jlong system_time = cpu_time_vm.system + cpu_time_gc.system + cpu_time_stringdedup.system;\n+    double real_time = os::elapsedTime();\n+    CPUTime cpu_time = sample_detailed_cpu_time();\n@@ -106,2 +105,1 @@\n-      user_time -= _starting_user_time;\n-      system_time -= _starting_system_time;\n+      cpu_time -= _starting_cpu_time;\n@@ -109,2 +107,2 @@\n-      double user_time_seconds = 1.0 * user_time \/ NANOSECS_PER_SEC;\n-      double system_time_seconds = 1.0 * system_time \/ NANOSECS_PER_SEC;\n+      double user_time_seconds = 1.0 * cpu_time.user \/ NANOSECS_PER_SEC;\n+      double system_time_seconds = 1.0 * cpu_time.system \/ NANOSECS_PER_SEC;\n@@ -113,1 +111,1 @@\n-        _tracer->report_cpu_time_event(user_time, system_time, real_time);\n+        _tracer->report_cpu_time_event(user_time_seconds, system_time_seconds, real_time);\n","filename":"src\/hotspot\/share\/gc\/shared\/gcTraceTime.cpp","additions":19,"deletions":21,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"runtime\/os.hpp\"\n@@ -38,4 +39,3 @@\n-  bool _active;                 \/\/ True if times will be measured and printed\n-  jlong _starting_user_time;    \/\/ User time at start of measurement\n-  jlong _starting_system_time;  \/\/ System time at start of measurement\n-  double _starting_real_time;   \/\/ Real time at start of measurement\n+  bool _active;                  \/\/ True if times will be measured and printed\n+  CPUTime _starting_cpu_time;    \/\/ User and system time at start of measurement\n+  double _starting_real_time;    \/\/ Real time at start of measurement\n","filename":"src\/hotspot\/share\/gc\/shared\/gcTraceTime.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -103,0 +103,9 @@\n+CPUTime::CPUTime(long user, long system) :\n+  user(user), system(system) {};\n+\n+CPUTime CPUTime::operator-=(const CPUTime &n) {\n+  user -= n.user;\n+  system -= n.system;\n+  return *this;\n+}\n+\n@@ -510,1 +519,1 @@\n-  cpu_time_t cpu_time = detailed_thread_cpu_time(thread);\n+  CPUTime cpu_time = detailed_thread_cpu_time(thread);\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -170,3 +170,6 @@\n-struct cpu_time {\n-  jlong user;\n-  jlong system;\n+class CPUTime {\n+public:\n+  long user;\n+  long system;\n+  CPUTime(long user, long system);\n+  CPUTime operator-=(const CPUTime &n);\n@@ -174,1 +177,0 @@\n-typedef struct cpu_time cpu_time_t;\n@@ -1003,1 +1005,1 @@\n-  static cpu_time_t detailed_thread_cpu_time(Thread* t);\n+  static CPUTime detailed_thread_cpu_time(Thread* t);\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -38,2 +38,2 @@\n-static inline cpu_time_t detailed_thread_cpu_time_or_zero(Thread* thread) {\n-  cpu_time_t cpu_time = os::detailed_thread_cpu_time(thread);\n+static inline CPUTime detailed_thread_cpu_time_or_zero(Thread* thread) {\n+  CPUTime cpu_time = os::detailed_thread_cpu_time(thread);\n@@ -69,1 +69,1 @@\n-  cpu_time_t _cpu_time = { 0, 0 };\n+  CPUTime _cpu_time = { 0, 0 };\n@@ -73,1 +73,1 @@\n-    cpu_time_t new_value = detailed_thread_cpu_time_or_zero(thread);\n+    CPUTime new_value = detailed_thread_cpu_time_or_zero(thread);\n@@ -77,1 +77,1 @@\n-  cpu_time_t cpu_time() { return _cpu_time; };\n+  CPUTime cpu_time() { return _cpu_time; };\n@@ -101,1 +101,1 @@\n-cpu_time_t CPUTimeUsage::GC::detailed_gc_threads() {\n+CPUTime CPUTimeUsage::GC::detailed_gc_threads() {\n@@ -107,1 +107,1 @@\n-cpu_time_t CPUTimeUsage::GC::detailed_gc_operation_vm_thread() {\n+CPUTime CPUTimeUsage::GC::detailed_gc_operation_vm_thread() {\n@@ -112,1 +112,1 @@\n-cpu_time_t CPUTimeUsage::GC::detailed_stringdedup() {\n+CPUTime CPUTimeUsage::GC::detailed_stringdedup() {\n","filename":"src\/hotspot\/share\/services\/cpuTimeUsage.cpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-    static cpu_time_t detailed_gc_threads();\n+    static CPUTime detailed_gc_threads();\n@@ -45,2 +45,2 @@\n-    static cpu_time_t detailed_gc_operation_vm_thread();\n-    static cpu_time_t detailed_stringdedup();\n+    static CPUTime detailed_gc_operation_vm_thread();\n+    static CPUTime detailed_stringdedup();\n","filename":"src\/hotspot\/share\/services\/cpuTimeUsage.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}