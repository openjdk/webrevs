{"files":[{"patch":"@@ -34,0 +34,1 @@\n+import java.util.List;\n@@ -35,1 +36,0 @@\n-import java.util.stream.Stream;\n@@ -39,4 +39,1 @@\n-public enum CapturableState {\n-    GET_LAST_ERROR    (\"GetLastError\",    JAVA_INT, 1 << 0),\n-    WSA_GET_LAST_ERROR(\"WSAGetLastError\", JAVA_INT, 1 << 1),\n-    ERRNO             (\"errno\",           JAVA_INT, 1 << 2);\n+public final class CapturableState {\n@@ -45,1 +42,1 @@\n-    public static final Map<String, CapturableState> SUPPORTED;\n+    private static final Map<String, CapturableState> LOOKUP;\n@@ -48,1 +45,1 @@\n-        var values = values();\n+        List<CapturableState> supported;\n@@ -51,3 +48,5 @@\n-            SUPPORTED = Map.of(GET_LAST_ERROR.stateName, GET_LAST_ERROR,\n-                               WSA_GET_LAST_ERROR.stateName, WSA_GET_LAST_ERROR,\n-                               ERRNO.stateName, ERRNO);\n+            supported = List.of(\n+                    new CapturableState(\"GetLastError\",    JAVA_INT, 1 << 0),\n+                    new CapturableState(\"WSAGetLastError\", JAVA_INT, 1 << 1),\n+                    new CapturableState(\"errno\",           JAVA_INT, 1 << 2)\n+            );\n@@ -55,1 +54,1 @@\n-            SUPPORTED = Map.of(ERRNO.stateName, ERRNO);\n+            supported = List.of(new CapturableState(\"errno\", JAVA_INT, 1 << 2));\n@@ -58,1 +57,3 @@\n-        MemoryLayout[] stateLayouts = new MemoryLayout[SUPPORTED.size()];\n+        MemoryLayout[] stateLayouts = new MemoryLayout[supported.size()];\n+        @SuppressWarnings(\"rawtypes\")\n+        Map.Entry<String, CapturableState>[] entries = new Map.Entry[supported.size()];\n@@ -60,2 +61,3 @@\n-        for (var supported : SUPPORTED.values()) {\n-            stateLayouts[i++] = supported.layout;\n+        for (var each : supported) {\n+            stateLayouts[i++] = each.layout;\n+            entries[i++] = Map.entry(each.stateName, each);\n@@ -64,0 +66,1 @@\n+        LOOKUP = Map.ofEntries(entries);\n@@ -70,1 +73,1 @@\n-    CapturableState(String stateName, ValueLayout layout, int mask) {\n+    private CapturableState(String stateName, ValueLayout layout, int mask) {\n@@ -77,1 +80,1 @@\n-        var ret = SUPPORTED.get(name);\n+        var ret = LOOKUP.get(name);\n@@ -81,1 +84,1 @@\n-                            + SUPPORTED.keySet());\n+                            + LOOKUP.keySet());\n@@ -92,1 +95,1 @@\n-        for (var e : SUPPORTED.values()) {\n+        for (var e : LOOKUP.values()) {\n@@ -99,0 +102,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return stateName;\n+    }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/CapturableState.java","additions":26,"deletions":18,"binary":false,"changes":44,"status":"modified"}]}