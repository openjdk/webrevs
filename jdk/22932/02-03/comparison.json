{"files":[{"patch":"@@ -2111,2 +2111,33 @@\n-                             jintArray smallIconRaster, jint smw, jint smh)\n-{\n+                             jintArray smallIconRaster, jint smw, jint smh) {\n+    HICON hNewIcon = NULL;\n+    HICON hNewIconSm = NULL;\n+\n+    try {\n+        hNewIcon = CreateIconFromRaster(env, iconRaster, w, h);\n+        if (env->ExceptionCheck()) {\n+            if (hNewIcon) {\n+                DestroyIcon(hNewIcon);\n+            }\n+            return;\n+        }\n+\n+        hNewIconSm = CreateIconFromRaster(env, smallIconRaster, smw, smh);\n+        if (env->ExceptionCheck()) {\n+            if (hNewIcon != NULL) {\n+                DestroyIcon(hNewIcon);\n+            }\n+            if (hNewIconSm != NULL) {\n+                DestroyIcon(hNewIconSm);\n+            }\n+            return;\n+        }\n+    } catch (...) {\n+        if (hNewIcon != NULL) {\n+            DestroyIcon(hNewIcon);\n+        }\n+        if (hNewIconSm != NULL) {\n+            DestroyIcon(hNewIconSm);\n+        }\n+        return;\n+    }\n+\n@@ -2115,1 +2146,0 @@\n-    \/\/Destroy previous icon if it isn't inherited\n@@ -2119,1 +2149,0 @@\n-    m_hIcon = NULL;\n@@ -2123,1 +2152,0 @@\n-    m_hIconSm = NULL;\n@@ -2125,15 +2153,2 @@\n-    try {\n-        m_hIcon = CreateIconFromRaster(env, iconRaster, w, h);\n-        JNU_CHECK_EXCEPTION(env); \/\/ Might throw here\n-        m_hIconSm = CreateIconFromRaster(env, smallIconRaster, smw, smh);\n-        JNU_CHECK_EXCEPTION(env); \/\/ Or here\n-    } catch (...) {\n-        \/\/ Clean up any allocated resources here\n-        if (m_hIcon != NULL) {\n-            DestroyIcon(m_hIcon);\n-        }\n-        if (m_hIconSm != NULL) {\n-            DestroyIcon(m_hIconSm);\n-        }\n-        throw; \/\/ Re-throw the exception\n-    }\n+    m_hIcon = hNewIcon;\n+    m_hIconSm = hNewIconSm;\n@@ -2152,0 +2167,1 @@\n+\n@@ -2154,0 +2170,2 @@\n+\n+    \/\/ Destroy previous icons if they were not inherited\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Window.cpp","additions":38,"deletions":20,"binary":false,"changes":58,"status":"modified"}]}