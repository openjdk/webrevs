{"files":[{"patch":"@@ -365,1 +365,1 @@\n-                        = new PluginOption(false,\n+                        = new PluginOption(true,\n@@ -368,1 +368,4 @@\n-                                m.put(plugin.getName(), DefaultCompressPlugin.LEVEL_2);\n+                                String level = (arg != null && !arg.isEmpty())\n+                                        ? arg\n+                                        :\"zip-6\";\n+                                m.put(plugin.getName(), level);\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/TaskHelper.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -308,1 +308,1 @@\n-\\      --compress <compress>             Compression to use in compressing resources:\\n\\\n+\\      --compress <compress>             Compress all resources in the output image:\\n\\\n@@ -314,1 +314,1 @@\n-\\                                        0:  No compression. Equivalent to zip-0.\\n\\\n+\\                                        0:  No compression. Use zip-0 instead.\\n\\\n@@ -316,1 +316,1 @@\n-\\                                        2:  Equivalent to zip-6.\n+\\                                        2:  ZIP. Use zip-6 instead.\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/plugins.properties","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -67,1 +67,1 @@\n-`--compress=zip-[0-9]`\n+`-c zip-[0-9]` or `--compress=zip-[0-9]`\n@@ -73,1 +73,1 @@\n-    -   `0`: No compression. Equivalent to zip-0.\n+    -   `0`: No compression. Use zip-0 instead.\n@@ -75,1 +75,1 @@\n-    -   `2`: ZIP. Equivalent to zip-6.\n+    -   `2`: ZIP. Use zip-6 instead.\n@@ -185,1 +185,1 @@\n-    -   Level 0: No compression. Equivalent to zip-0.\n+    -   Level 0: No compression. Use zip-0 instead.\n@@ -187,1 +187,1 @@\n-    -   Level 2: ZIP. Equivalent to zip-6.\n+    -   Level 2: ZIP. Use zip-6 instead.\n","filename":"src\/jdk.jlink\/share\/man\/jlink.md","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -67,1 +67,4 @@\n-        }, true, \"--main-no-arg\")\n+        }, true, \"--main-no-arg\"),\n+        new Option<>(true, (task, opt, arg) -> {\n+            compressArgValue = (arg != null && !arg.isEmpty()) ? arg : \"zip-6\";\n+        }, \"--compress\", \"-c\")\n@@ -73,0 +76,1 @@\n+    private static String compressArgValue;\n@@ -121,0 +125,1 @@\n+        compressArgValue= null;\n@@ -220,0 +225,40 @@\n+\n+    record CompressTestCase(String[] tokens, String expectedCompressValue, boolean expectedMainFlag) {}\n+\n+    public static Stream<CompressTestCase> compressUsages() {\n+        return Stream.of(\n+\n+                new CompressTestCase(new String[] {\"-c\", \"0\"}, \"0\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-0\"}, \"zip-0\", false),\n+\n+                new CompressTestCase(new String[] {\"-c\", \"1\"}, \"1\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-1\"}, \"zip-1\", false),\n+\n+                new CompressTestCase(new String[] {\"-c\", \"2\"}, \"2\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-2\"}, \"zip-2\", false),\n+\n+                new CompressTestCase(new String[] {\"--compress=zip-3\"}, \"zip-3\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-4\"}, \"zip-4\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-5\"}, \"zip-5\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-6\"}, \"zip-6\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-7\"}, \"zip-7\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-8\"}, \"zip-8\", false),\n+                new CompressTestCase(new String[] {\"--compress=zip-9\"}, \"zip-9\", false)\n+                );\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"compressUsages\")\n+    public void testCompressOptionArg(CompressTestCase testCase) throws TaskHelper.BadArgs {\n+        var remaining = optionsHelper.handleOptions(this, testCase.tokens);\n+        try {\n+            \/\/ trigger Plugin::configure\n+            taskHelper.getPluginsConfig(null, null, null);\n+        } catch (IOException ex) {\n+            fail(\"Unexpected IOException\");\n+        }\n+\n+        assertTrue(remaining.isEmpty());\n+        assertEquals(testCase.expectedCompressValue, compressArgValue);\n+        assertEquals(testCase.expectedMainFlag(), mainFlag);\n+    }\n","filename":"test\/jdk\/tools\/jlink\/TaskHelperTest.java","additions":46,"deletions":1,"binary":false,"changes":47,"status":"modified"}]}