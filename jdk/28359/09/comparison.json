{"files":[{"patch":"@@ -365,1 +365,1 @@\n-                        = new PluginOption(false,\n+                        = new PluginOption(true,\n@@ -368,1 +368,4 @@\n-                                m.put(plugin.getName(), DefaultCompressPlugin.LEVEL_2);\n+                                String level = (arg != null && !arg.isEmpty())\n+                                        ? arg\n+                                        :\"zip-6\";\n+                                m.put(plugin.getName(), level);\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/TaskHelper.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n-jlink.description=assemble and optimize a set of modules and their dependencies into a custom runtime image\n+jlink.description=assemble and optimize a set of modules and their dependences into a custom runtime image\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/jlink.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -308,1 +308,1 @@\n-\\      --compress <compress>             Compression to use in compressing resources:\\n\\\n+\\      --compress <compress>             Compress all resources in the output image:\\n\\\n@@ -314,1 +314,1 @@\n-\\                                        0:  No compression. Equivalent to zip-0.\\n\\\n+\\                                        0:  No compression. Use zip-0 instead.\\n\\\n@@ -316,1 +316,1 @@\n-\\                                        2:  Equivalent to zip-6.\n+\\                                        2:  ZIP. Use zip-6 instead.\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/plugins.properties","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-dependences, to create a custom runtime image.\n+dependencies, to create a custom runtime image.\n@@ -67,2 +67,4 @@\n-`-c ={0|1|2}` or `--compress={0|1|2}`\n-:   Enable compression of resources:\n+`-c zip-[0-9]` or `--compress=zip-[0-9]`\n+:   Enable compression of resources. The accepted values are:\n+    zip-[0-9], where zip-0 provides no compression,\n+    and zip-9 provides the best compression. Default is zip-6.\n@@ -70,1 +72,2 @@\n-    -   `0`: No compression\n+:   Deprecated values to be removed in a future release:\n+    -   `0`: No compression. Use zip-0 instead.\n@@ -72,1 +75,1 @@\n-    -   `2`: ZIP\n+    -   `2`: ZIP. Use zip-6 instead.\n@@ -173,1 +176,1 @@\n-:   `--compress=`{`0`\\|`1`\\|`2`}\\[`:filter=`*pattern-list*\\]\n+:   `--compress=zip-`[`0`-`9`]\\[`:filter=`*pattern-list*\\]\n@@ -177,0 +180,3 @@\n+    Accepted values are:\n+    zip-[0-9], where zip-0 provides no compression,\n+    and zip-9 provides the best compression. Default is zip-6.\n@@ -178,1 +184,2 @@\n-    -   Level 0: No compression\n+:   Deprecated values to be removed in a future release:\n+    -   Level 0: No compression. Use zip-0 instead.\n@@ -180,1 +187,1 @@\n-    -   Level 2: ZIP\n+    -   Level 2: ZIP. Use zip-6 instead.\n","filename":"src\/jdk.jlink\/share\/man\/jlink.md","additions":15,"deletions":8,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -45,4 +45,1 @@\n- * @bug 8189777\n- * @bug 8194922\n- * @bug 8206962\n- * @bug 8240349\n+ * @bug 8189777 8194922 8206962 8240349 8163382 8165735 8166810 8173717 8321139\n@@ -361,0 +358,33 @@\n+        \/\/ short command  without argument\n+        {\n+            String[] userOptions = {\"-c\"};\n+            String moduleName = \"invalidCompressLevelEmpty\";\n+            helper.generateDefaultJModule(moduleName, \"composite2\");\n+            helper.generateDefaultImage(userOptions, moduleName).assertFailure(\"Error: no value given for -c\");\n+        }\n+\n+        \/\/ invalid short command\n+        {\n+            String[] userOptions = {\"-c\", \"3\", \"--output\", \"image\"};\n+            String moduleName = \"invalidCompressLevel3\";\n+            helper.generateDefaultJModule(moduleName, \"composite2\");\n+            helper.generateDefaultImage(userOptions, moduleName).assertFailure(\"Error: Invalid compression level 3\");\n+        }\n+\n+\n+        \/\/ invalid argument value\n+        {\n+            String[] userOptions = {\"--compress\", \"42\", \"--output\", \"image\"};\n+            String moduleName = \"invalidCompressLevel42\";\n+            helper.generateDefaultJModule(moduleName, \"composite2\");\n+            helper.generateDefaultImage(userOptions, moduleName).assertFailure(\"Error: Invalid compression level 42\");\n+        }\n+\n+        \/\/ invalid argument value\n+        {\n+            String[] userOptions = {\"--compress\", \"zip-\", \"--output\", \"image\"};\n+            String moduleName = \"invalidCompressLevelZip\";\n+            helper.generateDefaultJModule(moduleName, \"composite2\");\n+            helper.generateDefaultImage(userOptions, moduleName).assertFailure(\"Error: Invalid compression level zip-\");\n+        }\n+\n","filename":"test\/jdk\/tools\/jlink\/JLinkTest.java","additions":34,"deletions":4,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -51,1 +51,1 @@\n- * @bug 8303884\n+ * @bug 8303884 8321139\n@@ -62,1 +62,0 @@\n-            System.out.println(arg);\n@@ -67,1 +66,4 @@\n-        }, true, \"--main-no-arg\")\n+        }, true, \"--main-no-arg\"),\n+        new Option<>(true, (task, opt, arg) -> {\n+            compressArgValue = (arg != null && !arg.isEmpty()) ? arg : \"zip-6\";\n+        }, \"--compress\", \"-c\")\n@@ -73,0 +75,1 @@\n+    private static String compressArgValue;\n@@ -74,1 +77,1 @@\n-    public record ArgTestCase(String cmdLine, String[] tokens, String pluginArgValue, String mainArgValue, boolean mainFlagSet) {};\n+    public record ArgTestCase(String cmdLine, String[] tokens, String pluginArgValue, String mainArgValue, boolean mainFlagSet) {}\n@@ -121,0 +124,1 @@\n+        compressArgValue= null;\n@@ -220,1 +224,41 @@\n-}\n\\ No newline at end of file\n+\n+    record CompressTestCase(String[] tokens, String expectedCompressValue) {}\n+\n+    public static Stream<CompressTestCase> compressUsages() {\n+        return Stream.of(\n+\n+                new CompressTestCase(new String[] {\"-c\", \"0\"}, \"0\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-0\"}, \"zip-0\"),\n+\n+                new CompressTestCase(new String[] {\"-c\", \"1\"}, \"1\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-1\"}, \"zip-1\"),\n+\n+                new CompressTestCase(new String[] {\"-c\", \"2\"}, \"2\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-2\"}, \"zip-2\"),\n+\n+                new CompressTestCase(new String[] {\"--compress=zip-3\"}, \"zip-3\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-4\"}, \"zip-4\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-5\"}, \"zip-5\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-6\"}, \"zip-6\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-7\"}, \"zip-7\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-8\"}, \"zip-8\"),\n+                new CompressTestCase(new String[] {\"--compress=zip-9\"}, \"zip-9\")\n+                );\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"compressUsages\")\n+    public void testCompressOptionArg(CompressTestCase testCase) throws TaskHelper.BadArgs {\n+        var remaining = optionsHelper.handleOptions(this, testCase.tokens);\n+        try {\n+            \/\/ trigger Plugin::configure\n+            taskHelper.getPluginsConfig(null, null, null);\n+        } catch (IOException ex) {\n+            fail(\"Unexpected IOException\");\n+        }\n+\n+        assertTrue(remaining.isEmpty());\n+        assertEquals(testCase.expectedCompressValue, compressArgValue);\n+    }\n+}\n+\n","filename":"test\/jdk\/tools\/jlink\/TaskHelperTest.java","additions":49,"deletions":5,"binary":false,"changes":54,"status":"modified"}]}