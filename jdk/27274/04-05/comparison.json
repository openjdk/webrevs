{"files":[{"patch":"@@ -423,3 +423,6 @@\n-        size_t aligned_map_memsz = ROUNDUP(existing_map->memsz, page_size);\n-        \/\/ The lib offset may be aligned down, so lib_php->p_memsz > existing_map->memsz\n-        bool offset_aligned_down = aligned_map_memsz == ROUNDUP(lib_php->p_memsz + (lib_php->p_offset & (page_size - 1)), page_size);\n+        uint64_t lib_memsz = lib_php->p_memsz;\n+        if (target_vaddr > existing_map->vaddr) {\n+            lib_memsz += target_vaddr - existing_map->vaddr;\n+        }\n+        lib_memsz = ROUNDUP(lib_memsz, page_size);\n+\n@@ -428,2 +431,1 @@\n-            (aligned_map_memsz != ROUNDUP(lib_php->p_memsz, page_size)) &&\n-            !offset_aligned_down) {\n+            (ROUNDUP(existing_map->memsz, page_size) != lib_memsz)) {\n@@ -442,5 +444,1 @@\n-        if (offset_aligned_down) {\n-          \/\/ We should trust the core dump in this case.\n-        } else {\n-          existing_map->memsz = ROUNDUP(lib_php->p_memsz, page_size);\n-        }\n+        existing_map->memsz = ROUNDUP(lib_php->p_memsz, page_size);\n","filename":"src\/jdk.hotspot.agent\/linux\/native\/libsaproc\/ps_core.c","additions":8,"deletions":10,"binary":false,"changes":18,"status":"modified"}]}