{"files":[{"patch":"@@ -141,1 +141,1 @@\n- void CompilationPolicy::wait_replay_training_at_init(JavaThread* current) {\n+ void CompilationPolicy::wait_replay_training_to_finish(JavaThread* current) {\n@@ -160,1 +160,1 @@\n-          if (ctd->init_deps_left() == 0) {\n+          if (ctd->init_deps_left_acquire() == 0) {\n@@ -192,1 +192,1 @@\n-  while (!CompileBroker::is_compilation_disabled_forever()) {\n+  while (!CompileBroker::is_compilation_disabled_forever() || AOTVerifyTrainingData) {\n@@ -457,1 +457,1 @@\n-      st->print(\"%d\", ctd->init_deps_left());\n+      st->print(\"%d\", ctd->init_deps_left_acquire());\n@@ -1183,1 +1183,1 @@\n-  if (SkipTier2IfPossible && ctd->init_deps_left() == 0) {\n+  if (SkipTier2IfPossible && ctd->init_deps_left_acquire() == 0) {\n@@ -1211,1 +1211,1 @@\n-  if (ctd != nullptr && ctd->init_deps_left() == 0) {\n+  if (ctd != nullptr && ctd->init_deps_left_acquire() == 0) {\n","filename":"src\/hotspot\/share\/compiler\/compilationPolicy.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -365,1 +365,1 @@\n-  static void wait_replay_training_at_init(JavaThread* current);\n+  static void wait_replay_training_to_finish(JavaThread* current);\n","filename":"src\/hotspot\/share\/compiler\/compilationPolicy.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -244,1 +244,1 @@\n-void CompileTrainingData::dec_init_deps_left(KlassTrainingData* ktd) {\n+void CompileTrainingData::dec_init_deps_left_release(KlassTrainingData* ktd) {\n@@ -465,1 +465,1 @@\n-    comp_dep(i)->dec_init_deps_left(this);\n+    comp_dep(i)->dec_init_deps_left_release(this);\n@@ -632,1 +632,1 @@\n-    int init_deps_left1 = init_deps_left();\n+    int init_deps_left1 = init_deps_left_acquire();\n","filename":"src\/hotspot\/share\/oops\/trainingData.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -676,2 +676,4 @@\n-  void dec_init_deps_left(KlassTrainingData* ktd);\n-  int init_deps_left() const { return _init_deps_left; }\n+  void dec_init_deps_left_release(KlassTrainingData* ktd);\n+  int init_deps_left_acquire() const {\n+    return Atomic::load_acquire(&_init_deps_left);\n+  }\n","filename":"src\/hotspot\/share\/oops\/trainingData.hpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -522,1 +522,1 @@\n-    CompilationPolicy::wait_replay_training_at_init(THREAD);\n+    CompilationPolicy::wait_replay_training_to_finish(THREAD);\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}