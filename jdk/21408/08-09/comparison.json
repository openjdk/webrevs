{"files":[{"patch":"@@ -416,3 +416,4 @@\n-         * Proxy-Authorization} header set then its value will be used and\n-         * the {@link Authenticator} will not be invoked for the corresponding\n-         * authentication.\n+         * Proxy-Authorization} header set then its value is used and\n+         * the {@link Authenticator} is not invoked for the corresponding\n+         * authentication. In this case, any authentication errors are returned\n+         * to the user and requests are not automatically retried.\n","filename":"src\/java.net.http\/share\/classes\/java\/net\/http\/HttpClient.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n- * @run main\/othervm  -Djdk.httpclient.HttpClient.log=errors,requests,headers,ssl,trace,all UserAuthWithAuthenticator\n+ * @run main\/othervm UserAuthWithAuthenticator\n@@ -72,0 +72,1 @@\n+    private static final String AUTH_PREFIX = \"Basic \";\n@@ -82,1 +83,4 @@\n-                authValue = t.getRequestHeaders().firstValue(\"Authorization\").orElse(\"\");\n+                authValue = t.getRequestHeaders()\n+                        .firstValue(\"Authorization\")\n+                        .orElse(AUTH_PREFIX)\n+                        .substring(AUTH_PREFIX.length());\n@@ -137,3 +141,1 @@\n-            \/\/if (!useHeader) {\n-                builder.authenticator(sa);\n-            \/\/}\n+            builder.authenticator(sa);\n@@ -144,1 +146,1 @@\n-                    .header(useHeader ? \"Authorization\" : \"X-Ignore\", encoded)\n+                    .header(useHeader ? \"Authorization\" : \"X-Ignore\", AUTH_PREFIX + encoded)\n@@ -150,1 +152,2 @@\n-                assertTrue(h.authValue() == null, \"Expected user set header to be set\");\n+                assertTrue(resp.statusCode() == 200, \"Expected 200 response\");\n+                assertTrue(h.authValue().equals(encoded), \"Expected user set header to be set\");\n@@ -234,1 +237,1 @@\n-                .setHeader(\"Authorization\", \"Basic \" + encoded)\n+                .setHeader(\"Authorization\", AUTH_PREFIX + encoded)\n@@ -268,1 +271,1 @@\n-                .setHeader(\"Proxy-Authorization\", \"Basic \" + encoded1)\n+                .setHeader(\"Proxy-Authorization\", AUTH_PREFIX + encoded1)\n@@ -294,1 +297,1 @@\n-                .setHeader(\"Authorization\", \"Basic \" + encoded)\n+                .setHeader(\"Authorization\", AUTH_PREFIX + encoded)\n","filename":"test\/jdk\/java\/net\/httpclient\/UserAuthWithAuthenticator.java","additions":13,"deletions":10,"binary":false,"changes":23,"status":"modified"}]}