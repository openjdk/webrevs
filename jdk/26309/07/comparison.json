{"files":[{"patch":"@@ -48,0 +48,1 @@\n+#include \"utilities\/vmError.hpp\"\n@@ -204,0 +205,1 @@\n+    VMError::set_handshake_timed_out_thread(p2i(target));\n@@ -211,1 +213,5 @@\n-  fatal(\"Handshake timeout\");\n+  if (target != nullptr) {\n+    fatal(\"Thread \" PTR_FORMAT \" has not cleared handshake op %s, and failed to terminate the JVM\", p2i(target), op->name());\n+  } else {\n+    fatal(\"Handshake timeout\");\n+  }\n","filename":"src\/hotspot\/share\/runtime\/handshake.cpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -69,0 +69,1 @@\n+#include \"utilities\/vmError.hpp\"\n@@ -653,0 +654,1 @@\n+        VMError::set_safepoint_timed_out_thread(p2i(cur_thread));\n","filename":"src\/hotspot\/share\/runtime\/safepoint.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -107,0 +107,2 @@\n+volatile intptr_t VMError::_handshake_timed_out_thread = p2i(nullptr);\n+volatile intptr_t VMError::_safepoint_timed_out_thread = p2i(nullptr);\n@@ -822,1 +824,7 @@\n-        st->print(\" (sent by kill)\");\n+        if (_handshake_timed_out_thread == p2i(_thread)) {\n+          st->print(\" (sent by handshake timeout handler\");\n+        } else if (_safepoint_timed_out_thread == p2i(_thread)) {\n+          st->print(\" (sent by safepoint timeout handler\");\n+        } else {\n+          st->print(\" (sent by kill)\");\n+        }\n@@ -1333,0 +1341,8 @@\n+void VMError::set_handshake_timed_out_thread(intptr_t thread_addr) {\n+  _handshake_timed_out_thread = thread_addr;\n+}\n+\n+void VMError::set_safepoint_timed_out_thread(intptr_t thread_addr) {\n+  _safepoint_timed_out_thread = thread_addr;\n+}\n+\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":17,"deletions":1,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -145,0 +145,4 @@\n+  \/\/ Handshake\/safepoint timed out threads\n+  static volatile intptr_t _handshake_timed_out_thread;\n+  static volatile intptr_t _safepoint_timed_out_thread;\n+\n@@ -221,0 +225,3 @@\n+\n+  static void set_handshake_timed_out_thread(intptr_t thread_addr);\n+  static void set_safepoint_timed_out_thread(intptr_t thread_addr);\n","filename":"src\/hotspot\/share\/utilities\/vmError.hpp","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -91,1 +91,1 @@\n-                output.shouldContain(\"(sent by kill)\");\n+                output.shouldContain(\"(sent by safepoint timeout handler\");\n","filename":"test\/hotspot\/jtreg\/runtime\/Safepoint\/TestAbortVMOnSafepointTimeout.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}