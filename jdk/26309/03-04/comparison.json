{"files":[{"patch":"@@ -48,2 +48,1 @@\n-\n-intptr_t handshakeTimedOutThread = p2i(nullptr);\n+#include \"utilities\/vmError.hpp\"\n@@ -206,1 +205,1 @@\n-    handshakeTimedOutThread = p2i(target);\n+    VMError::set_handshake_timed_out_thread(p2i(target));\n@@ -214,1 +213,5 @@\n-  fatal(\"Handshake timeout\");\n+  if (target != nullptr) {\n+    fatal(\"Thread \" PTR_FORMAT \" has not cleared handshake op: \" PTR_FORMAT \", then failed to terminate JVM\", p2i(target), p2i(op));\n+  } else {\n+    fatal(\"Handshake timeout\");\n+  }\n","filename":"src\/hotspot\/share\/runtime\/handshake.cpp","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -35,3 +35,0 @@\n-\/\/ Indicate VMError::report() that SIGILL came from handshake timeout handler, report which thread timed out\n-extern intptr_t handshakeTimedOutThread;\n-\n","filename":"src\/hotspot\/share\/runtime\/handshake.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -69,2 +69,1 @@\n-\n-intptr_t safepointTimedOutThread = p2i(nullptr);\n+#include \"utilities\/vmError.hpp\"\n@@ -655,1 +654,1 @@\n-        safepointTimedOutThread = p2i(cur_thread);\n+        VMError::set_safepoint_timed_out_thread(p2i(cur_thread));\n","filename":"src\/hotspot\/share\/runtime\/safepoint.cpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -49,3 +49,0 @@\n-\/\/ Indicate VMError::report() that SIGILL came from safepoint timeout handler, report which thread timed out\n-extern intptr_t safepointTimedOutThread;\n-\n","filename":"src\/hotspot\/share\/runtime\/safepoint.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -107,0 +107,2 @@\n+volatile intptr_t VMError::handshakeTimedOutThread = p2i(nullptr);\n+volatile intptr_t VMError::safepointTimedOutThread = p2i(nullptr);\n@@ -822,1 +824,1 @@\n-          st->print(\" (sent by handshake timeout handler, timed out thread \" PTR_FORMAT \")\", handshakeTimedOutThread);\n+          st->print(\" (sent by handshake timeout handler\");\n@@ -824,1 +826,1 @@\n-          st->print(\" (sent by safepoint timeout handler, timed out thread \" PTR_FORMAT \")\", safepointTimedOutThread);\n+          st->print(\" (sent by safepoint timeout handler\");\n@@ -1338,0 +1340,8 @@\n+void VMError::set_handshake_timed_out_thread(intptr_t x) {\n+  handshakeTimedOutThread = x;\n+}\n+\n+void VMError::set_safepoint_timed_out_thread(intptr_t x) {\n+  safepointTimedOutThread = x;\n+}\n+\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":12,"deletions":2,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -145,0 +145,4 @@\n+  \/\/ Handshake\/safepoint timed out threads\n+  static volatile intptr_t handshakeTimedOutThread;\n+  static volatile intptr_t safepointTimedOutThread;\n+\n@@ -221,0 +225,3 @@\n+\n+  static void set_handshake_timed_out_thread(intptr_t x);\n+  static void set_safepoint_timed_out_thread(intptr_t x);\n","filename":"src\/hotspot\/share\/utilities\/vmError.hpp","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -91,1 +91,1 @@\n-                output.shouldContain(\"(sent by safepoint timeout handler, timed out thread \");\n+                output.shouldContain(\"(sent by safepoint timeout handler\");\n","filename":"test\/hotspot\/jtreg\/runtime\/Safepoint\/TestAbortVMOnSafepointTimeout.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}