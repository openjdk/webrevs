{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,4 +50,1 @@\n-    \/**\n-     * @param args\n-     *\/\n-    public static void main(String[] args) {\n+    public static void main(String[] args) throws IOException {\n@@ -56,3 +53,4 @@\n-                InputStream is = t.getRequestBody();\n-                read(is);\n-                \/\/ .. read the request body\n+                try (InputStream is = t.getRequestBody();\n+                     OutputStream os = t.getResponseBody()) {\n+                    read(is);\n+                    \/\/ .. read the request body\n@@ -60,5 +58,5 @@\n-                t.sendResponseHeaders(200, response.length());\n-                OutputStream os = t.getResponseBody();\n-                os.write(response.getBytes());\n-                os.close();\n-                error = Thread.currentThread().isDaemon();\n+                    t.sendResponseHeaders(200, response.length());\n+                    os.write(response.getBytes());\n+                    os.close();\n+                    error = Thread.currentThread().isDaemon();\n+                }\n@@ -68,2 +66,2 @@\n-\n-        HttpServer server;\n+        InetAddress loopback = InetAddress.getLoopbackAddress();\n+        HttpServer server = HttpServer.create(new InetSocketAddress(loopback, 0), 10);\n@@ -71,3 +69,0 @@\n-            InetAddress loopback = InetAddress.getLoopbackAddress();\n-            server = HttpServer.create(new InetSocketAddress(loopback, 0), 10);\n-\n@@ -77,1 +72,1 @@\n-                server.start();\n+            server.start();\n@@ -79,1 +74,0 @@\n-            String s = \"http:\/\/localhost:\"+port+\"\/apps\/foo\";\n@@ -81,5 +75,5 @@\n-                      .scheme(\"http\")\n-                      .loopback()\n-                      .port(port)\n-                      .path(\"\/apps\/foo\")\n-                      .toURL();\n+                    .scheme(\"http\")\n+                    .loopback()\n+                    .port(port)\n+                    .path(\"\/apps\/foo\")\n+                    .toURL();\n@@ -87,2 +81,1 @@\n-            read (is);\n-            server.stop(0);\n+            read(is);\n@@ -90,1 +83,1 @@\n-                throw new RuntimeException (\"error in test\");\n+                throw new RuntimeException(\"error in test\");\n@@ -92,3 +85,1 @@\n-\n-        }\n-        catch (Exception e) {\n+        } catch (Exception e) {\n@@ -96,0 +87,2 @@\n+        } finally {\n+            server.stop(0);\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/bugs\/B6431193.java","additions":24,"deletions":31,"binary":false,"changes":55,"status":"modified"}]}