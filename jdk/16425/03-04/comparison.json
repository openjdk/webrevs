{"files":[{"patch":"@@ -34,0 +34,1 @@\n+import org.junit.jupiter.api.condition.EnabledIf;\n@@ -45,1 +46,2 @@\n- * @run junit\/othervm test.java.lang.String.StringRacyConstructor\n+ * @run junit\/othervm -XX:+CompactStrings test.java.lang.String.StringRacyConstructor\n+ * @run junit\/othervm -XX:-CompactStrings test.java.lang.String.StringRacyConstructor\n@@ -68,0 +70,14 @@\n+    \/* {@return true iff CompactStrings are enabled}\n+     *\/\n+    public static boolean isCompactStrings() {\n+        try {\n+            Field compactStringField = String.class.getDeclaredField(\"COMPACT_STRINGS\");\n+            compactStringField.setAccessible(true);\n+            return compactStringField.getBoolean(null);\n+        } catch (NoSuchFieldException ex) {\n+            throw new ExceptionInInitializerError(ex);\n+        } catch (IllegalAccessException iae) {\n+            throw new AssertionError(iae);\n+        }\n+    }\n+\n@@ -124,0 +140,1 @@\n+    @EnabledIf(\"test.java.lang.String.StringRacyConstructor#isCompactStrings\")\n@@ -140,0 +157,1 @@\n+    @EnabledIf(\"test.java.lang.String.StringRacyConstructor#isCompactStrings\")\n@@ -149,0 +167,1 @@\n+    @EnabledIf(\"test.java.lang.String.StringRacyConstructor#isCompactStrings\")\n@@ -159,0 +178,1 @@\n+    @EnabledIf(\"test.java.lang.String.StringRacyConstructor#isCompactStrings\")\n@@ -199,1 +219,1 @@\n-        final byte FILL_BYTE = 0x52;\n+        final byte FILL_BYTE = 'R';\n@@ -217,0 +237,1 @@\n+    @EnabledIf(\"test.java.lang.String.StringRacyConstructor#isCompactStrings\")\n@@ -231,0 +252,1 @@\n+    @EnabledIf(\"test.java.lang.String.StringRacyConstructor#isCompactStrings\")\n@@ -241,0 +263,1 @@\n+    @EnabledIf(\"test.java.lang.String.StringRacyConstructor#isCompactStrings\")\n@@ -258,1 +281,1 @@\n-        if (original.chars().max().orElseThrow() > 256) {\n+        if (original.chars().max().getAsInt() >= 256) {\n@@ -288,1 +311,1 @@\n-                    System.err.printf(\"Unable to produce a UTF16 string in %d iterations: %s%n\", i, original);\n+                    System.out.printf(\"Unable to produce a UTF16 string in %d iterations: %s%n\", i, original);\n@@ -334,1 +357,1 @@\n-                    System.err.printf(\"Unable to produce a UTF16 string in %d iterations: %s%n\", i, original);\n+                    System.out.printf(\"Unable to produce a UTF16 string in %d iterations: %s%n\", i, original);\n@@ -381,1 +404,1 @@\n-                    System.err.printf(\"Unable to create a string in %d iterations: %s%n\", i, original);\n+                    System.out.printf(\"Unable to create a string in %d iterations: %s%n\", i, original);\n@@ -400,1 +423,1 @@\n-            return aString.length() + 1;\n+            return aString.length();\n","filename":"test\/jdk\/java\/lang\/String\/StringRacyConstructor.java","additions":30,"deletions":7,"binary":false,"changes":37,"status":"modified"}]}