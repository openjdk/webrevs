{"files":[{"patch":"@@ -134,2 +134,2 @@\n-     * The contents are indeterminate if the {@code CharSequence}\n-     * is modified before the constructor returns.\n+     * The contents are unspecified if the {@code CharSequence}\n+     * is modified during string construction.\n@@ -673,2 +673,3 @@\n-     * The contents are indeterminate if the {@code CharSequence}\n-     * is modified before the method returns.\n+     * The contents are unspecified if the {@code CharSequence}\n+     * is modified during the method call or an exception is thrown\n+     * when accessing the {@code CharSequence}.\n@@ -1251,2 +1252,3 @@\n-     * The contents are indeterminate if the {@code CharSequence}\n-     * is modified before the method returns.\n+     * The contents are unspecified if the {@code CharSequence}\n+     * is modified during the method call or an exception is thrown\n+     * when accessing the {@code CharSequence}.\n@@ -1302,2 +1304,3 @@\n-     * The contents are indeterminate if the {@code CharSequence}\n-     * is modified before the method returns.\n+     * The contents are unspecified if the {@code CharSequence}\n+     * is modified during the method call or an exception is thrown\n+     * when accessing the {@code CharSequence}.\n@@ -1690,2 +1693,3 @@\n-            this.value = StringUTF16.compress(value, off, len);\n-            this.coder = (this.value.length == len) ? LATIN1 : UTF16;\n+            byte[] val = StringUTF16.compress(value, off, len);\n+            this.coder = StringUTF16.coderFromArrayLen(val, len);\n+            this.value = val;\n@@ -1944,2 +1948,3 @@\n-     * The contents are indeterminate if the {@code CharSequence}\n-     * is modified before the method returns.\n+     * The contents are unspecified if the {@code CharSequence}\n+     * is modified during the method call or an exception is thrown\n+     * when accessing the {@code CharSequence}.\n","filename":"src\/java.base\/share\/classes\/java\/lang\/AbstractStringBuilder.java","additions":17,"deletions":12,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -61,2 +61,2 @@\n-     * The contents of this {@code Appendable} are indeterminate if the argument\n-     * is modified before the {@code append} method returns or an exception is thrown\n+     * The contents of this {@code Appendable} are unspecified if the {@code CharSequence}\n+     * is modified during the method call or an exception is thrown\n@@ -89,2 +89,2 @@\n-     * The contents of this {@code Appendable} are indeterminate if the argument\n-     * is modified before the {@code append} method returns or an exception is thrown\n+     * The contents of this {@code Appendable} are unspecified if the {@code CharSequence}\n+     * is modified during the method call or an exception is thrown\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Appendable.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -271,1 +271,1 @@\n-     * Allocates a new {@code String} so that it represents the sequence of\n+     * Allocates a new {@code String} so that it represents the sequence ofbb\n@@ -276,2 +276,2 @@\n-     * <p> The contents of the string are indeterminate if the character array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the character array\n+     * is modified during string construction.\n@@ -294,2 +294,2 @@\n-     * <p> The contents of the string are indeterminate if the character array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the character array\n+     * is modified during string construction.\n@@ -328,2 +328,2 @@\n-     * <p> The contents of the string are indeterminate if the array of codepoints\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the codepoints array\n+     * is modified during string construction.\n@@ -378,2 +378,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -442,2 +442,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -479,2 +479,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -520,2 +520,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -673,2 +673,3 @@\n-                    this.value = StringUTF16.compress(ca, 0, clen);\n-                    this.coder = (this.value.length == clen) ? LATIN1 : UTF16;\n+                    byte[] val = StringUTF16.compress(ca, 0, clen);;\n+                    this.coder = StringUTF16.coderFromArrayLen(val, clen);\n+                    this.value = val;\n@@ -701,2 +702,3 @@\n-                this.value = StringUTF16.compress(ca, 0, caLen);\n-                this.coder = (this.value.length == caLen) ? LATIN1 : UTF16;\n+                byte[] val = StringUTF16.compress(ca, 0, caLen);\n+                this.coder = StringUTF16.coderFromArrayLen(val, caLen);\n+                this.value = val;\n@@ -841,3 +843,3 @@\n-            byte[] value = StringUTF16.compress(ca, 0, caLen);\n-            int coder = (value.length == len) ? LATIN1 : UTF16;\n-            return new String(value, coder);\n+            byte[] val = StringUTF16.compress(ca, 0, caLen);\n+            int coder = StringUTF16.coderFromArrayLen(val, len);\n+            return new String(val, coder);\n@@ -1397,2 +1399,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -1428,2 +1430,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -1455,2 +1457,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -1488,2 +1490,2 @@\n-     * <p> The contents of the string are indeterminate if the byte array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the byte array\n+     * is modified during string construction.\n@@ -1519,2 +1521,2 @@\n-     * <p> The contents of the string are indeterminate if the {@code StringBuilder}\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the {@code StringBuilder}\n+     * is modified during string construction.\n@@ -4514,2 +4516,2 @@\n-     * <p> The contents of the string are indeterminate if the character array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the character array\n+     * is modified during string construction.\n@@ -4535,2 +4537,2 @@\n-     * <p> The contents of the string are indeterminate if the character array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the character array\n+     * is modified during string construction.\n@@ -4807,2 +4809,2 @@\n-     * <p> The contents of the string are indeterminate if the character array\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the character array\n+     * is modified during string construction.\n@@ -4818,1 +4820,1 @@\n-            this.coder = (val.length == len) ? LATIN1 : UTF16;\n+            this.coder = StringUTF16.coderFromArrayLen(val, len);\n@@ -4830,2 +4832,2 @@\n-     * <p> The contents of the string are indeterminate if the {@code StringBuilder}\n-     * is modified before the constructor returns.\n+     * <p> The contents of the string are unspecified if the {@code StringBuilder}\n+     * is modified during string construction.\n","filename":"src\/java.base\/share\/classes\/java\/lang\/String.java","additions":43,"deletions":41,"binary":false,"changes":84,"status":"modified"},{"patch":"@@ -180,0 +180,8 @@\n+    \/\/ Clever way to get the coder from a byte array returned from compress\n+    \/\/ that maybe either latin1 or UTF16-coded\n+    \/\/ Equivalent to (len == val.length) ? LATIN1 : UTF16\n+    @ForceInline\n+    static byte coderFromArrayLen(byte[] value, int len) {\n+        return (byte) ((len - value.length) >>> Integer.SIZE - 1);\n+    }\n+\n@@ -199,1 +207,1 @@\n-     * The resulting string may be indeterminate if the input array is modified during this\n+     * The resulting string contents are unspecified if the input array is modified during this\n","filename":"src\/java.base\/share\/classes\/java\/lang\/StringUTF16.java","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"}]}