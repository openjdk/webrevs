{"files":[{"patch":"@@ -206,6 +206,2 @@\n-        JavaFileManager fm = context.get(JavaFileManager.class);\n-        if (fm instanceof JavacFileManager javacFileManager) {\n-            legacyCtPropertiesInfoAccess = javacFileManager.getLegacyCtPropertiesInfo();\n-        } else {\n-            legacyCtPropertiesInfoAccess = LegacyCtPropertiesAccess.NOOP;\n-        }\n+        legacyCtPropertiesInfoAccess =\n+                JavacFileManager.getLegacyCtPropertiesInfo(fileManager);\n@@ -250,1 +246,2 @@\n-                    LegacyCtPropertiesInfo info = legacyCtPropertiesInfoAccess.getInfo(packge.flatName());\n+                    LegacyCtPropertiesInfo legacyInfo =\n+                            legacyCtPropertiesInfoAccess.getInfo(packge.flatName());\n@@ -252,1 +249,1 @@\n-                    if (info.proprietary)\n+                    if (legacyInfo.proprietary)\n@@ -254,2 +251,2 @@\n-                    if (info.minProfile != null)\n-                        minProfile = Profile.lookup(info.minProfile);\n+                    if (legacyInfo.minProfile != null)\n+                        minProfile = Profile.lookup(legacyInfo.minProfile);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/ClassFinder.java","additions":7,"deletions":10,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -44,2 +44,0 @@\n-import java.util.MissingResourceException;\n-import java.util.ResourceBundle;\n@@ -180,1 +178,1 @@\n-                    getCtInfo(rd));\n+                    LegacyCtPropertiesInfo.createLegacyCtPropertiesInfo(rd));\n@@ -196,34 +194,0 @@\n-    private LegacyCtPropertiesInfo getCtInfo(RelativeDirectory dir) {\n-        if (dir.path.isEmpty())\n-            return LegacyCtPropertiesInfo.EMPTY;\n-        \/\/ It's a side-effect of the default build rules that ct.properties\n-        \/\/ ends up as a resource bundle.\n-        if (ctBundle == null) {\n-            final String bundleName = \"com.sun.tools.javac.resources.ct\";\n-            ctBundle = ResourceBundle.getBundle(bundleName);\n-        }\n-        try {\n-            String attrs = ctBundle.getString(dir.path.replace('\/', '.') + '*');\n-            boolean hidden = false;\n-            boolean proprietary = false;\n-            String minProfile = null;\n-            for (String attr: attrs.split(\" +\", 0)) {\n-                switch (attr) {\n-                    case \"hidden\":\n-                        hidden = true;\n-                        break;\n-                    case \"proprietary\":\n-                        proprietary = true;\n-                        break;\n-                    default:\n-                        minProfile = attr;\n-                }\n-            }\n-            return new LegacyCtPropertiesInfo(hidden, proprietary, minProfile);\n-        } catch (MissingResourceException e) {\n-            return LegacyCtPropertiesInfo.EMPTY;\n-        }\n-\n-    }\n-\n-    private ResourceBundle ctBundle;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/file\/JRTIndex.java","additions":1,"deletions":37,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -461,3 +461,7 @@\n-    public LegacyCtPropertiesAccess getLegacyCtPropertiesInfo() {\n-        if (isDefaultBootClassPath() && isSymbolFileEnabled() && JRTIndex.isAvailable()) {\n-            return getJRTIndex();\n+    \/**\n+     * {@return Accessor for additional class properties.}\n+     *\/\n+    public static LegacyCtPropertiesAccess getLegacyCtPropertiesInfo(JavaFileManager fm) {\n+        if (fm instanceof JavacFileManager jfm && jfm.isDefaultBootClassPath() &&\n+            jfm.isSymbolFileEnabled() && JRTIndex.isAvailable()) {\n+            return jfm.getJRTIndex();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/file\/JavacFileManager.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+import java.util.MissingResourceException;\n+import java.util.ResourceBundle;\n@@ -30,0 +32,2 @@\n+import com.sun.tools.javac.file.RelativePath.RelativeDirectory;\n+\n@@ -115,0 +119,34 @@\n+        static LegacyCtPropertiesInfo createLegacyCtPropertiesInfo(RelativeDirectory dir) {\n+            if (dir.path.isEmpty())\n+                return LegacyCtPropertiesInfo.EMPTY;\n+            \/\/ It's a side-effect of the default build rules that ct.properties\n+            \/\/ ends up as a resource bundle.\n+            if (ctBundle == null) {\n+                final String bundleName = \"com.sun.tools.javac.resources.ct\";\n+                ctBundle = ResourceBundle.getBundle(bundleName);\n+            }\n+            try {\n+                String attrs = ctBundle.getString(dir.path.replace('\/', '.') + '*');\n+                boolean hidden = false;\n+                boolean proprietary = false;\n+                String minProfile = null;\n+                for (String attr: attrs.split(\" +\", 0)) {\n+                    switch (attr) {\n+                        case \"hidden\":\n+                            hidden = true;\n+                            break;\n+                        case \"proprietary\":\n+                            proprietary = true;\n+                            break;\n+                        default:\n+                            minProfile = attr;\n+                    }\n+                }\n+                return new LegacyCtPropertiesInfo(hidden, proprietary, minProfile);\n+            } catch (MissingResourceException e) {\n+                return LegacyCtPropertiesInfo.EMPTY;\n+            }\n+        }\n+\n+        private static ResourceBundle ctBundle;\n+\n@@ -117,1 +155,0 @@\n-\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/file\/LegacyCtPropertiesAccess.java","additions":38,"deletions":1,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -95,0 +95,1 @@\n+        ignore(\"com\/sun\/tools\/javac\/file\/LegacyCtPropertiesAccess$LegacyCtPropertiesInfo\", \"ctBundle\");\n","filename":"test\/langtools\/tools\/javac\/T8003967\/DetectMutableStaticFields.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}