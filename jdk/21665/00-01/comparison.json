{"files":[{"patch":"@@ -57,0 +57,1 @@\n+import java.util.stream.Collectors;\n@@ -63,0 +64,1 @@\n+import jdk.test.lib.Utils;\n@@ -250,24 +252,0 @@\n-    private static void copyFiles(Path source, String destination)\n-            throws IOException {\n-        try (Stream<Path> sourceEntries = Files.walk(source)) {\n-            sourceEntries.forEach(sourceEntry -> {\n-                Path destinationPath = Paths.get(destination, sourceEntry.toString()\n-                        .substring(source.toString().length()));\n-                try {\n-                    if (Files.isRegularFile(sourceEntry)) {\n-                        \/\/ copy regular files to destination directory\n-                        Files.copy(sourceEntry, destinationPath,\n-                                StandardCopyOption.REPLACE_EXISTING);\n-                        destinationPath.toFile().setWritable(true);\n-\n-                    } else if (!Files.exists(destinationPath)) {\n-                        \/\/ create directory if it does not exist\n-                        Files.createDirectory(destinationPath);\n-                    }\n-                } catch (IOException e) {\n-                    throw new RuntimeException(e);\n-                }\n-            });\n-        }\n-    }\n-\n@@ -523,6 +501,1 @@\n-        String base = getBase();\n-        String nss = \"nss\";\n-        Path nssDirSource = Path.of(base).resolve(nss);\n-        String nssDirDestination = Path.of(\".\").resolve(nss).toString();\n-        copyFiles(nssDirSource, nssDirDestination);\n-\n+        String nssConfigDir = copyNssFiles();\n@@ -534,1 +507,1 @@\n-                nssDirDestination + SEP + \"db\";\n+                nssConfigDir + SEP + \"db\";\n@@ -544,1 +517,1 @@\n-                nssDirDestination + SEP + customConfigName;\n+                nssConfigDir + SEP + customConfigName;\n@@ -827,0 +800,25 @@\n+    \/\/Copy the nss config files to the current directory for tests. Returns the destination path\n+    private static String copyNssFiles() throws Exception {\n+        String nss = \"nss\";\n+        String db = \"db\";\n+        Path nssDirSource = Path.of(getBase()).resolve(nss);\n+        Path nssDirDestination = Path.of(\".\").resolve(nss);\n+\n+        \/\/ copy files from nss directory\n+        copyFiles(nssDirSource, nssDirDestination);\n+        \/\/ copy files from nss\/db directory\n+        copyFiles(nssDirSource.resolve(db), nssDirDestination.resolve(db));\n+        return nssDirDestination.toString();\n+    }\n+\n+    private static void copyFiles(Path dirSource, Path dirDestination) throws IOException {\n+        List<Path> sourceFiles = Arrays\n+                .stream(dirSource.toFile().listFiles())\n+                .filter(File::isFile)\n+                .map(File::toPath)\n+                .collect(Collectors.toList());\n+        List<Path> destFiles = Utils.copyFiles(sourceFiles, dirDestination,\n+                StandardCopyOption.REPLACE_EXISTING);\n+        destFiles.forEach((Path file) -> file.toFile().setWritable(true));\n+    }\n+\n","filename":"test\/jdk\/sun\/security\/pkcs11\/PKCS11Test.java","additions":30,"deletions":32,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+#        jdk.test.lib.Utils\n","filename":"test\/jdk\/sun\/security\/pkcs11\/Provider\/MultipleLogins.sh","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}