{"files":[{"patch":"@@ -764,2 +764,7 @@\n-     * method returns a segment that behaves as if it had been allocated using the\n-     * provided arena.\n+     * method returns a segment that can be used as any other segment allocated using the\n+     * provided arena. However, The returned segment is backed by the same memory region\n+     * as that of the original segment. As such, the region of memory backing the\n+     * returned segment is deallocated only when this segment's arena is closed.\n+     * This might lead to <em>use-after-free<\/em> issues, as the returned segment can be\n+     * accessed <em>after<\/em> its region of memory has been deallocated via this\n+     * segment's arena.\n@@ -814,3 +819,8 @@\n-     * of the confinement restrictions associated with this segment. In other words,\n-     * this method returns a segment that behaves as if it had been allocated using the\n-     * provided arena.\n+     * of the confinement restrictions associated with this segment. In other words, this\n+     * method returns a segment that can be used as any other segment allocated using the\n+     * provided arena. However, The returned segment is backed by the same memory region\n+     * as that of the original segment. As such, the region of memory backing the\n+     * returned segment is deallocated only when this segment's arena is closed.\n+     * This might lead to <em>use-after-free<\/em> issues, as the returned segment can be\n+     * accessed <em>after<\/em> its region of memory has been deallocated via this\n+     * segment's arena.\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/MemorySegment.java","additions":15,"deletions":5,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+import static java.lang.foreign.ValueLayout.JAVA_BYTE;\n@@ -395,0 +396,18 @@\n+    @Test\n+    void testReinterpretArenaClose() {\n+        MemorySegment segment;\n+        try (Arena arena = Arena.ofConfined()){\n+            try (Arena otherArena = Arena.ofConfined()) {\n+                segment = arena.allocate(100);\n+                segment = segment.reinterpret(otherArena, null);\n+            }\n+            final MemorySegment sOther = segment;\n+            assertThrows(IllegalStateException.class, () -> sOther.get(JAVA_BYTE, 0));\n+            segment = segment.reinterpret(arena, null);\n+            final MemorySegment sOriginal = segment;\n+            sOriginal.get(JAVA_BYTE, 0);\n+        }\n+        final MemorySegment closed = segment;\n+        assertThrows(IllegalStateException.class, () -> closed.get(JAVA_BYTE, 0));\n+    }\n+\n","filename":"test\/jdk\/java\/foreign\/TestSegments.java","additions":19,"deletions":0,"binary":false,"changes":19,"status":"modified"}]}