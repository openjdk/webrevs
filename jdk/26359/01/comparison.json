{"files":[{"patch":"@@ -29,1 +29,9 @@\n-import java.awt.*;\n+import java.awt.Color;\n+import java.awt.EventQueue;\n+import java.awt.HeadlessException;\n+import java.awt.Font;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.GraphicsEnvironment;\n+import java.awt.SecondaryLoop;\n+import java.awt.Toolkit;\n@@ -32,1 +40,7 @@\n-import java.awt.print.*;\n+import java.awt.print.Pageable;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Paper;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterAbortException;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n@@ -36,1 +50,4 @@\n-import javax.print.*;\n+import javax.print.DocFlavor;\n+import javax.print.PrintService;\n+import javax.print.PrintServiceLookup;\n+import javax.print.StreamPrintService;\n@@ -51,2 +68,10 @@\n-import sun.java2d.*;\n-import sun.print.*;\n+import sun.java2d.Disposer;\n+import sun.java2d.DisposerRecord;\n+import sun.java2d.SunGraphics2D;\n+import sun.java2d.SurfaceData;\n+import sun.print.CustomMediaTray;\n+import sun.print.CustomOutputBin;\n+import sun.print.GrayscaleProxyGraphics2D;\n+import sun.print.PeekGraphics;\n+import sun.print.RasterPrinterJob;\n+import sun.print.SunPageSelection;\n@@ -85,1 +110,2 @@\n-    private Object fNSPrintInfoLock = new Object();\n+    private final Object fNSPrintInfoLock = new Object();\n+    private final Object disposerReferent = new Object();\n@@ -613,8 +639,10 @@\n-    @Override\n-    @SuppressWarnings(\"removal\")\n-    protected void finalize() {\n-        synchronized (fNSPrintInfoLock) {\n-            if (fNSPrintInfo != -1) {\n-                dispose(fNSPrintInfo);\n-            }\n-            fNSPrintInfo = -1;\n+    static class NSPrintInfoDisposer implements DisposerRecord {\n+\n+        private final long fNSPrintInfo;\n+\n+        NSPrintInfoDisposer(long ptr) {\n+            fNSPrintInfo = ptr;\n+        }\n+\n+        public void dispose() {\n+            CPrinterJob.disposeNSPrintInfo(fNSPrintInfo);\n@@ -624,2 +652,2 @@\n-    private native long createNSPrintInfo();\n-    private native void dispose(long printInfo);\n+    private static native long createNSPrintInfo();\n+    private static native void disposeNSPrintInfo(long printInfo);\n@@ -632,0 +660,2 @@\n+                Disposer.addRecord(disposerReferent,\n+                                   new NSPrintInfoDisposer(fNSPrintInfo));\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/CPrinterJob.java","additions":46,"deletions":16,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -620,1 +620,1 @@\n-  (JNIEnv *env, jobject jthis)\n+  (JNIEnv *env, jclass clazz)\n@@ -624,1 +624,1 @@\n-    \/\/ This is used to create the NSPrintInfo for this PrinterJob. Thread\n+    \/\/ This is used to create the NSPrintInfo for a PrinterJob. Thread\n@@ -637,1 +637,1 @@\n- * Method:    dispose\n+ * Method:    disposeNSPrintInfo\n@@ -640,2 +640,2 @@\n-JNIEXPORT void JNICALL Java_sun_lwawt_macosx_CPrinterJob_dispose\n-  (JNIEnv *env, jobject jthis, jlong nsPrintInfo)\n+JNIEXPORT void JNICALL Java_sun_lwawt_macosx_CPrinterJob_disposeNSPrintInfo\n+  (JNIEnv *env, jclass clazz, jlong nsPrintInfo)\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CPrinterJob.m","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"}]}