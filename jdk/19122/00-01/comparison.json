{"files":[{"patch":"@@ -246,0 +246,1 @@\n+  _any_gc_count(0),\n@@ -247,1 +248,0 @@\n-  _is_any_gc_active(false),\n","filename":"src\/hotspot\/share\/gc\/shared\/collectedHeap.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -94,1 +94,1 @@\n-  friend class IsAnyGCActiveMark; \/\/ Block structured external access to _is_any_gc_active\n+  friend class IsAnyGCActiveMark; \/\/ Block structured external access to _any_gc_count;\n@@ -115,0 +115,5 @@\n+  \/\/ Number of GCs currently running. Can be modified concurrently\n+  \/\/ by different parts of GC subsystems. Updated atomically.\n+  volatile int _any_gc_count;\n+\n+  \/\/ Number of STW GCs currently running. Only modified at safepoint.\n@@ -116,1 +121,0 @@\n-  bool _is_any_gc_active;\n@@ -382,1 +386,1 @@\n-  bool is_any_gc_active() const { return _is_any_gc_active; }\n+  bool is_any_gc_active() const { return Atomic::load(&_any_gc_count) > 0; }\n","filename":"src\/hotspot\/share\/gc\/shared\/collectedHeap.hpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-\/\/ _is_stw_gc_active \/ _is_any_gc_active state without requiring\n+\/\/ _is_stw_gc_active \/ _any_gc_count state without requiring\n@@ -49,5 +49,1 @@\n-  _doit = !heap->is_any_gc_active();\n-  if (_doit) {\n-    assert(!heap->is_any_gc_active(), \"Sanity\");\n-    heap->_is_any_gc_active = true;\n-  }\n+  Atomic::inc(&heap->_any_gc_count, memory_order_relaxed);\n@@ -58,4 +54,1 @@\n-  if (_doit) {\n-    assert(heap->is_any_gc_active(), \"Sanity\");\n-    heap->_is_any_gc_active = false;\n-  }\n+  Atomic::dec(&heap->_any_gc_count, memory_order_relaxed);\n","filename":"src\/hotspot\/share\/gc\/shared\/isGCActiveMark.cpp","additions":3,"deletions":10,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -35,3 +35,3 @@\n-private:\n-  bool _doit;\n-public:\n+ private:\n+  bool _skip;\n+ public:\n@@ -43,1 +43,1 @@\n-public:\n+ public:\n","filename":"src\/hotspot\/share\/gc\/shared\/isGCActiveMark.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}