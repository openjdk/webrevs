{"files":[{"patch":"@@ -84,0 +84,1 @@\n+import static com.sun.tools.javac.jvm.ByteCodes.ret;\n@@ -2279,0 +2280,15 @@\n+        public Type implicitReceiverType() {\n+            ClassSymbol enclosingClass = enclClass();\n+            if (enclosingClass == null) {\n+                return null;\n+            }\n+            Type enclosingType = enclosingClass.type;\n+            if (isConstructor()) {\n+                return enclosingType.getEnclosingType();\n+            }\n+            if (!isStatic()) {\n+                return enclosingType;\n+            }\n+            return null;\n+        }\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Symbol.java","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -131,1 +131,1 @@\n-            recvtype = null;\n+            recvtype = msym.implicitReceiverType();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/MemberEnter.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2342,0 +2342,1 @@\n+        m.type.asMethodType().recvtype = m.implicitReceiverType();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/jvm\/ClassReader.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8222369 8225488\n+ * @bug 8222369 8225488 8319196\n@@ -31,0 +31,1 @@\n+ * @compile\/process -processor TestExecutableReceiverType -proc:only MethodHost\n@@ -48,2 +49,8 @@\n-            count += testType(elements.getTypeElement(\"MethodHost\"));\n-            count += testType(elements.getTypeElement(\"MethodHost.Nested\"));\n+            for (ExecutableElement e : ElementFilter.methodsIn(\n+                  roundEnv.getElementsAnnotatedWith(ReceiverTypeKind.class))) {\n+              count += testExecutable(e);\n+            }\n+            for (ExecutableElement e : ElementFilter.constructorsIn(\n+                  roundEnv.getElementsAnnotatedWith(ReceiverTypeKind.class))) {\n+              count += testExecutable(e);\n+            }\n@@ -58,14 +65,0 @@\n-    int testType(TypeElement typeElement) {\n-        int count = 0;\n-        for (ExecutableElement executable :\n-                 ElementFilter.constructorsIn(typeElement.getEnclosedElements())) {\n-            count += testExecutable(executable);\n-        }\n-\n-        for (ExecutableElement executable :\n-                 ElementFilter.methodsIn(typeElement.getEnclosedElements())) {\n-            count += testExecutable(executable);\n-        }\n-        return count;\n-    }\n-\n@@ -73,2 +66,5 @@\n-        TypeKind expectedKind = executable.getAnnotation(ReceiverTypeKind.class).value();\n-        TypeKind actualKind = executable.getReceiverType().getKind();\n+        ReceiverTypeKind expected = executable.getAnnotation(ReceiverTypeKind.class);\n+        TypeKind expectedKind = expected.value();\n+        String expectedType = expected.type();\n+        TypeMirror actualType = executable.getReceiverType();\n+        TypeKind actualKind = actualType.getKind();\n@@ -79,1 +75,6 @@\n-                                              executable, expectedKind, actualKind));\n+                                              executable, expectedKind, actualKind), executable);\n+        }\n+        if (!expectedType.isEmpty() && !actualType.toString().equals(expectedType)) {\n+            messager.printError(String.format(\"Unexpected receiver type of %s:\" +\n+                                              \" expected %s\\t got %s%n\",\n+                                              executable, expectedType, actualType), executable);\n@@ -83,1 +84,1 @@\n-        TypeKind kindFromType = new TypeKindVisitor<TypeKind, Object>(null) {\n+        TypeMirror fromType = new TypeKindVisitor<TypeMirror, Object>(null) {\n@@ -85,2 +86,2 @@\n-            public TypeKind visitExecutable(ExecutableType t, Object p) {\n-                return t.getReceiverType().getKind();\n+            public TypeMirror visitExecutable(ExecutableType t, Object p) {\n+                return t.getReceiverType();\n@@ -89,0 +90,1 @@\n+        TypeKind kindFromType = fromType.getKind();\n@@ -93,1 +95,6 @@\n-                                              executable, expectedKind, kindFromType));\n+                                              executable, expectedKind, kindFromType), executable);\n+        }\n+        if (!expectedType.isEmpty() && !fromType.toString().equals(expectedType)) {\n+            messager.printError(String.format(\"Unexpected receiver type of %s:\" +\n+                                              \" expected %s\\t got %s%n\",\n+                                              executable, expectedType, fromType), executable);\n@@ -102,0 +109,1 @@\n+    String type() default \"\";\n@@ -114,1 +122,1 @@\n-    @ReceiverTypeKind(TypeKind.NONE)\n+    @ReceiverTypeKind(value = TypeKind.DECLARED, type = \"MethodHost\")\n@@ -117,1 +125,1 @@\n-    @ReceiverTypeKind(TypeKind.DECLARED)\n+    @ReceiverTypeKind(value = TypeKind.DECLARED, type = \"MethodHost\")\n@@ -121,1 +129,1 @@\n-        @ReceiverTypeKind(TypeKind.DECLARED)\n+        @ReceiverTypeKind(value = TypeKind.DECLARED, type = \"MethodHost\")\n@@ -123,0 +131,18 @@\n+\n+        @ReceiverTypeKind(value = TypeKind.DECLARED, type = \"MethodHost\")\n+        public Nested(int foo) {}\n+    }\n+\n+    private static class StaticNested {\n+        @ReceiverTypeKind(TypeKind.NONE)\n+        public StaticNested() {}\n+    }\n+\n+    private static class Generic<X> {\n+      private class GenericNested<Y> {\n+        @ReceiverTypeKind(value = TypeKind.DECLARED, type = \"MethodHost.Generic<X>\")\n+        GenericNested(Generic<X> Generic.this) {}\n+\n+        @ReceiverTypeKind(value = TypeKind.DECLARED, type = \"MethodHost.Generic<X>\")\n+        GenericNested(int x) {}\n+      }\n","filename":"test\/langtools\/tools\/javac\/processing\/model\/element\/TestExecutableReceiverType.java","additions":53,"deletions":27,"binary":false,"changes":80,"status":"modified"},{"patch":"@@ -475,1 +475,1 @@\n-    @Test(posn=3, annoType=TA.class, expect=\"4\")\n+    @Test(posn=8, annoType=TA.class, expect=\"4\")\n@@ -481,1 +481,1 @@\n-    @Test(posn=4, annoType=TA.class, expect=\"6\")\n+    @Test(posn=9, annoType=TA.class, expect=\"6\")\n@@ -485,1 +485,1 @@\n-    @Test(posn=8, annoType=TA.class, expect=\"8\")\n+    @Test(posn=13, annoType=TA.class, expect=\"8\")\n@@ -532,2 +532,2 @@\n-    @Test(posn=6, annoType = TA.class, expect = \"25\")\n-    @Test(posn=6, annoType = TB.class, expect = \"26\")\n+    @Test(posn=11, annoType = TA.class, expect = \"25\")\n+    @Test(posn=11, annoType = TB.class, expect = \"26\")\n@@ -543,1 +543,1 @@\n-    @Test(posn=6, annoType = TB.class, expect = \"41\")\n+    @Test(posn=11, annoType = TB.class, expect = \"41\")\n@@ -552,2 +552,2 @@\n-    @Test(posn=6, annoType = TA.class, expect = \"60\")\n-    @Test(posn=6, annoType = TB.class, expect = \"61\")\n+    @Test(posn=11, annoType = TA.class, expect = \"60\")\n+    @Test(posn=11, annoType = TB.class, expect = \"61\")\n@@ -563,1 +563,1 @@\n-    @Test(posn=6, annoType = TB.class, expect = \"81\")\n+    @Test(posn=11, annoType = TB.class, expect = \"81\")\n","filename":"test\/langtools\/tools\/javac\/processing\/model\/type\/BasicAnnoTests.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -141,4 +141,4 @@\n-        (byte) 0x10, (byte) 0xE6, (byte) 0xE8, (byte) 0x11,\n-        (byte) 0xC8, (byte) 0x02, (byte) 0x63, (byte) 0x9B,\n-        (byte) 0xAB, (byte) 0x11, (byte) 0x9E, (byte) 0x4F,\n-        (byte) 0xFA, (byte) 0x00, (byte) 0x6D, (byte) 0x81\n+        (byte) 0xDD, (byte) 0x66, (byte) 0x1F, (byte) 0x0C,\n+        (byte) 0x64, (byte) 0x71, (byte) 0x62, (byte) 0x1E,\n+        (byte) 0x7E, (byte) 0xBC, (byte) 0x06, (byte) 0x1D,\n+        (byte) 0x5D, (byte) 0x82, (byte) 0x62, (byte) 0x59\n","filename":"test\/langtools\/tools\/javac\/sym\/ElementStructureTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}