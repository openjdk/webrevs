{"files":[{"patch":"@@ -1751,0 +1751,1 @@\n+  Handle thread_handle(current_thread, thread_obj);\n@@ -1777,5 +1778,1 @@\n-  if (self) {\n-    op.doit(java_thread, self);\n-  } else {\n-    Handshake::execute(&op, java_thread);\n-  }\n+  JvmtiHandshake::execute(&op, &tlh, java_thread, thread_handle);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnv.cpp","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2169,0 +2169,1 @@\n+  Handle thread_handle(current_thread, thread_obj);\n@@ -2189,0 +2190,1 @@\n+  MutexLocker mu(JvmtiThreadState_lock);\n@@ -2190,5 +2192,1 @@\n-  if (self) {\n-    op.doit(java_thread, self);\n-  } else {\n-    Handshake::execute(&op, java_thread);\n-  }\n+  JvmtiHandshake::execute(&op, &tlh, java_thread, thread_handle);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -459,10 +459,0 @@\n-class JvmtiHandshakeClosure : public HandshakeClosure {\n- protected:\n-  jvmtiError _result;\n- public:\n-  JvmtiHandshakeClosure(const char* name)\n-    : HandshakeClosure(name),\n-      _result(JVMTI_ERROR_THREAD_NOT_ALIVE) {}\n-  jvmtiError result() { return _result; }\n-};\n-\n@@ -502,1 +492,1 @@\n-class SetForceEarlyReturn : public JvmtiHandshakeClosure {\n+class SetForceEarlyReturn : public JvmtiUnitedHandshakeClosure {\n@@ -509,1 +499,1 @@\n-    : JvmtiHandshakeClosure(\"SetForceEarlyReturn\"),\n+    : JvmtiUnitedHandshakeClosure(\"SetForceEarlyReturn\"),\n@@ -513,0 +503,1 @@\n+  void doit(Thread *target, bool self);\n@@ -514,1 +505,5 @@\n-    doit(target, false \/* self *\/);\n+    doit(target, _self);\n+  }\n+  void do_vthread(Handle target_h) {\n+    assert(_target_jt != nullptr, \"sanity check\");\n+    doit(_target_jt, _self); \/\/ mounted virtual thread\n@@ -516,1 +511,0 @@\n-  void doit(Thread *target, bool self);\n@@ -520,1 +514,1 @@\n-class UpdateForPopTopFrameClosure : public JvmtiHandshakeClosure {\n+class UpdateForPopTopFrameClosure : public JvmtiUnitedHandshakeClosure {\n@@ -526,1 +520,1 @@\n-    : JvmtiHandshakeClosure(\"UpdateForPopTopFrame\"),\n+    : JvmtiUnitedHandshakeClosure(\"UpdateForPopTopFrame\"),\n@@ -528,0 +522,1 @@\n+  void doit(Thread *target, bool self);\n@@ -529,1 +524,5 @@\n-    doit(target, false \/* self *\/);\n+    doit(target, _self);\n+  }\n+  void do_vthread(Handle target_h) {\n+    assert(_target_jt != nullptr, \"sanity check\");\n+    doit(_target_jt, _self); \/\/ mounted virtual thread\n@@ -531,1 +530,0 @@\n-  void doit(Thread *target, bool self);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.hpp","additions":16,"deletions":18,"binary":false,"changes":34,"status":"modified"}]}