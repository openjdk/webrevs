{"files":[{"patch":"@@ -338,5 +338,2 @@\n-        finally {\n-            asyncReceiver.unsubscribe(headersReader);\n-            headersReader.reset();\n-        }\n-\n+        asyncReceiver.unsubscribe(headersReader);\n+        headersReader.reset();\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http1Response.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -1289,1 +1289,1 @@\n-                promiseHeaders, \"illegal push headers for pushId=%s: \".formatted(pushId), 0);\n+                promiseHeaders, \"illegal push headers for pushId=%s: \".formatted(pushId), -1);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http3ExchangeImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+import static jdk.internal.net.http.common.Utils.readStatusCode;\n@@ -609,1 +610,0 @@\n-         boolean finalResponse = false;\n@@ -611,4 +611,2 @@\n-             responseCode = (int) responseHeaders\n-                     .firstValueAsLong(\":status\")\n-                     .orElseThrow(() -> new IOException(\"no statuscode in response\"));\n-         } catch (IOException | NumberFormatException exception) {\n+             responseCode = readStatusCode(responseHeaders, \"\");\n+         } catch (ProtocolException pe) {\n@@ -618,5 +616,1 @@\n-             cancelImpl(exception, Http3Error.H3_MESSAGE_ERROR);\n-             return;\n-         }\n-         if (responseCode < 100 || responseCode > 999) {\n-             cancelImpl(new IOException(\"Unexpected :status header value\"), Http3Error.H3_MESSAGE_ERROR);\n+             cancelImpl(pe, Http3Error.H3_MESSAGE_ERROR);\n@@ -626,0 +620,1 @@\n+         boolean finalResponse = false;\n@@ -630,1 +625,0 @@\n-             assert responseCode >= 100 && responseCode <= 200 : \"unexpected responseCode: \" + responseCode;\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http3Stream.java","additions":5,"deletions":11,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -373,2 +373,2 @@\n-        var transferEncoding = headers.firstValue(\"Transfer-Encoding\").orElse(null);\n-        if (transferEncoding != null) {\n+        var transferEncoding = headers.firstValue(\"Transfer-Encoding\");\n+        if (transferEncoding.isPresent()) {\n@@ -376,1 +376,1 @@\n-                    \"Unexpected \\\"Transfer-Encoding\\\" header in a 204 response: \" + transferEncoding);\n+                    \"Unexpected \\\"Transfer-Encoding\\\" header in a 204 response: \" + transferEncoding.get());\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/MultiExchange.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -65,0 +65,1 @@\n+import static jdk.internal.net.http.common.Utils.readStatusCode;\n@@ -1822,20 +1823,0 @@\n-    private static int readStatusCode(HttpHeaders headers, String errorPrefix) throws ProtocolException {\n-        var s = headers.firstValue(\":status\").orElse(null);\n-        if (s == null) {\n-            throw new ProtocolException(errorPrefix + \"missing status code\");\n-        }\n-        Throwable t = null;\n-        int i = 0;\n-        try {\n-            i = Integer.parseInt(s);\n-        } catch (NumberFormatException nfe) {\n-            t = nfe;\n-        }\n-        if (t != null || i < 0) {\n-            var pe = new ProtocolException(errorPrefix + \"invalid status code: \" + s);\n-            pe.initCause(t);\n-            throw pe;\n-        }\n-        return i;\n-    }\n-\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Stream.java","additions":1,"deletions":20,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -1349,0 +1349,20 @@\n+    public static int readStatusCode(HttpHeaders headers, String errorPrefix) throws ProtocolException {\n+        var s = headers.firstValue(\":status\").orElse(null);\n+        if (s == null) {\n+            throw new ProtocolException(errorPrefix + \"missing status code\");\n+        }\n+        Throwable t = null;\n+        int i = 0;\n+        try {\n+            i = Integer.parseInt(s);\n+        } catch (NumberFormatException nfe) {\n+            t = nfe;\n+        }\n+        if (t != null || i < 100 || i > 999) {\n+            var pe = new ProtocolException(errorPrefix + \"invalid status code: \" + s);\n+            pe.initCause(t);\n+            throw pe;\n+        }\n+        return i;\n+    }\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/common\/Utils.java","additions":20,"deletions":0,"binary":false,"changes":20,"status":"modified"}]}