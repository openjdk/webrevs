{"files":[{"patch":"@@ -38,0 +38,1 @@\n+import java.io.FileInputStream;\n@@ -39,0 +40,1 @@\n+import java.io.InputStream;\n@@ -40,0 +42,2 @@\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipInputStream;\n@@ -179,1 +183,1 @@\n-    final String filename;\n+    final String imageName;\n@@ -182,0 +186,1 @@\n+    final File zipFile;\n@@ -183,1 +188,1 @@\n-    JpegExifThumbnailTest(String filename,\n+    JpegExifThumbnailTest(String imageName,\n@@ -186,2 +191,2 @@\n-                          Dimension... thumbnailSizes) {\n-        this.filename = filename;\n+                          Dimension... thumbnailSizes) throws IOException {\n+        this.imageName = imageName;\n@@ -195,1 +200,0 @@\n-    }\n@@ -197,1 +201,3 @@\n-    public void run() throws IOException {\n+        \/\/ the sample images are bundled in a zip archive\n+        \/\/ because a github script labeled two of them as\n+        \/\/ executable files (which are not allowed)\n@@ -200,2 +206,5 @@\n-        String filePath = dir+sep+filename;\n-        File file = new File(filePath);\n+        String filePath = dir+sep+\"test-files.zip\";\n+        zipFile = new File(filePath);\n+        if (!zipFile.exists())\n+            throw new IOException(\"missing test file: \" + zipFile.getPath());\n+    }\n@@ -203,3 +212,13 @@\n-        if (!file.exists())\n-            throw new IOException(\"missing test file: \" + file.getPath());\n-        System.out.println(\"Testing \" + file.getPath());\n+    public void run() throws IOException {\n+        try (FileInputStream fileIn = new FileInputStream(zipFile);\n+             ZipInputStream zipIn = new ZipInputStream(fileIn)) {\n+            ZipEntry entry = zipIn.getNextEntry();\n+            while (entry != null && !entry.getName().equals(imageName)) {\n+                entry = zipIn.getNextEntry();\n+            }\n+            if (entry == null) {\n+                throw new IOException(\"missing test image: \" + imageName);\n+            }\n+            run(zipIn);\n+        }\n+    }\n@@ -207,0 +226,1 @@\n+    private void run(InputStream in) throws IOException {\n@@ -208,1 +228,1 @@\n-        ImageInputStream stream = ImageIO.createImageInputStream(file);\n+        ImageInputStream stream = ImageIO.createImageInputStream(in);\n","filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/JpegExifThumbnailTest.java","additions":32,"deletions":12,"binary":false,"changes":44,"status":"modified"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/SV650.jpg","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/bad-timestamp.jpg","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/corrupt-magic-number.jpg","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/jfif-and-exif.jpg","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/malicious-looping-IFD.jpg","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/plastic-wrap.jpg","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/test-files.zip","binary":true,"status":"added"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/uncompressed-exif-thumbnail.jpg","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/imageio\/plugins\/jpeg\/JpegExifThumbnail\/unusual-ImageFileDirectory.jpeg","binary":true,"status":"deleted"}]}