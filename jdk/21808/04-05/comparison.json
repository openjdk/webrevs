{"files":[{"patch":"@@ -58,22 +58,1 @@\n-  char* orig = nullptr;\n-  julong phys_mem = os::Linux::physical_memory();\n-  \/\/ adjust orig path down to the actual mounted suffix\n-  char *start_suffix = os::strdup(mem->cgroup_path());\n-  char *suffix = start_suffix;\n-  while (!os::file_exists(mem->subsystem_path())) {\n-    if (*suffix == 0) break;\n-    suffix = strchr(suffix+1, '\/');\n-    if (suffix == nullptr) break;\n-    mem->set_subsystem_path(suffix);\n-  }\n-  if (suffix != nullptr && *suffix == '\/') {\n-    orig = os::strdup(suffix);\n-  } else {\n-    orig = os::strdup(\"\/\");\n-    mem->set_subsystem_path(orig);\n-  }\n-  if (strcmp(start_suffix, orig) != 0) {\n-    log_trace(os, container)(\"Adjusted path suffix to: %s.\", orig);\n-  }\n-  os::free(start_suffix);\n-  \/\/ adjust up the hierarchy to locate the lowest limit\n+  char* orig = os::strdup(mem->cgroup_path());\n@@ -82,0 +61,2 @@\n+  assert(cg_path[0] == '\/', \"cgroup path must start with '\/'\");\n+  julong phys_mem = os::Linux::physical_memory();\n@@ -137,21 +118,1 @@\n-  char* orig = nullptr;\n-  \/\/ adjust orig path down to the actual mounted suffix\n-  char *start_suffix = os::strdup(cpu->cgroup_path());\n-  char *suffix = start_suffix;\n-  while (!os::file_exists(cpu->subsystem_path())) {\n-    if (*suffix == 0) break;\n-    suffix = strchr(suffix+1, '\/');\n-    if (suffix == nullptr) break;\n-    cpu->set_subsystem_path(suffix);\n-  }\n-  if (suffix != nullptr && *suffix == '\/') {\n-    orig = os::strdup(suffix);\n-  } else {\n-    orig = os::strdup(\"\/\");\n-    cpu->set_subsystem_path(orig);\n-  }\n-  if (strcmp(start_suffix, orig) != 0) {\n-    log_trace(os, container)(\"Adjusted path suffix to: %s.\", orig);\n-  }\n-  os::free(start_suffix);\n-  \/\/ adjust up the hierarchy to locate the lowest limit\n+  char* orig = os::strdup(cpu->cgroup_path());\n@@ -160,0 +121,1 @@\n+  assert(cg_path[0] == '\/', \"cgroup path must start with '\/'\");\n","filename":"src\/hotspot\/os\/linux\/cgroupUtil_linux.cpp","additions":5,"deletions":43,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-        if (strcmp(cgroup_path,\"\/\") != 0) {\n+        if (*cgroup_path != '\\0' && strcmp(cgroup_path, \"\/\") != 0) {\n@@ -67,2 +67,14 @@\n-          \/\/ Rely on path adjustment that determines the actual suffix.\n-          ss.print_raw(cgroup_path);\n+          const char *suffix = cgroup_path;\n+          while (suffix != nullptr) {\n+            stringStream pp;\n+            pp.print_raw(_mount_point);\n+            pp.print_raw(suffix);\n+            if (os::file_exists(pp.base())) {\n+              ss.print_raw(suffix);\n+              if (suffix != cgroup_path) {\n+                log_trace(os, container)(\"set_subsystem_path: cgroup v1 path reduced to: %s.\", suffix);\n+              }\n+              break;\n+            }\n+            suffix = strchr(suffix+1, '\/');\n+          }\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"}]}