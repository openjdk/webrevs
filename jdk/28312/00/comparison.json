{"files":[{"patch":"@@ -30,0 +30,2 @@\n+ * @library \/test\/lib\n+ * @build jdk.test.lib.Platform\n@@ -52,1 +54,0 @@\n-\n@@ -54,0 +55,1 @@\n+import jdk.test.lib.Platform;\n@@ -56,0 +58,3 @@\n+    private static final int PRIMARY_TOLERANCE = 2;\n+    private static int TOLERANCE = 30;\n+    private static final boolean DEBUG = false;\n@@ -60,1 +65,1 @@\n-    private static StringBuffer errorLog = new StringBuffer();\n+    private static final StringBuffer errorLog = new StringBuffer();\n@@ -67,1 +72,3 @@\n-            robot = new Robot();\n+            if (!Platform.isOSX()) {\n+                TOLERANCE = PRIMARY_TOLERANCE;\n+            }\n@@ -69,0 +76,1 @@\n+            robot = new Robot();\n@@ -80,1 +88,1 @@\n-                throw new RuntimeException(\"Test failed: \\n\" + errorLog.toString());\n+                throw new RuntimeException(\"Test failed for the following region(s)\" + errorLog);\n@@ -104,1 +112,1 @@\n-        g2d.setColor(Color.black);\n+        g2d.setColor(Color.BLUE);\n@@ -107,1 +115,1 @@\n-        g2d.setColor(Color.green);\n+        g2d.setColor(Color.GREEN);\n@@ -110,1 +118,1 @@\n-        g2d.setColor(Color.red);\n+        g2d.setColor(Color.RED);\n@@ -126,6 +134,6 @@\n-        testRegion(\"green\", 0, 0, 400, 10, 0xff00ff00);\n-        testRegion(\"original-red\", 0, 10, 50, 400, 0xffff0000);\n-        testRegion(\"background\", 50, 10, 60, 400, 0xff000000);\n-        testRegion(\"in-between\", 60, 10, 110, 20, 0xff000000);\n-        testRegion(\"copied-red\", 60, 20, 110, 400, 0xffff0000);\n-        testRegion(\"background\", 110, 10, 400, 400, 0xff000000);\n+        testRegion(\"green\", 0, 0, 400, 10, Color.GREEN);\n+        testRegion(\"original-red\", 0, 10, 50, 400, Color.RED);\n+        testRegion(\"background\", 50, 10, 60, 400, Color.BLUE);\n+        testRegion(\"in-between\", 60, 10, 110, 20, Color.BLUE);\n+        testRegion(\"copied-red\", 60, 20, 110, 400, Color.RED);\n+        testRegion(\"background\", 110, 10, 400, 400, Color.BLUE);\n@@ -140,2 +148,1 @@\n-                                   int expected) {\n-        System.out.print(\"Test region: \" + region);\n+                                   Color expected) {\n@@ -144,9 +151,9 @@\n-                int actual = captureImg.getRGB(x, y);\n-                if (actual != expected) {\n-                    System.out.print(\" Status: FAILED\\n\");\n-                    errorLog.append(\"Test failed for \" + region\n-                                                + \" region at x: \" + x + \" y: \" + y\n-                                                + \" (expected: \"\n-                                                + Integer.toHexString(expected)\n-                                                + \" actual: \"\n-                                                + Integer.toHexString(actual) + \")\\n\");\n+                Color actual = new Color(captureImg.getRGB(x, y));\n+                if (DEBUG) {\n+                    System.out.println(\"Actual color: \" + actual);\n+                }\n+                if (!compareColor(expected, actual)) {\n+                    errorLog.append(\"\\nTest region: \" + region + \" Status: FAILED!!!\\n\");\n+                    errorLog.append(\"Test failed at x : \" + x + \" y : \" + y + \"\\n\"\n+                                    + \"Expected Color: \" + expected + \"\\n\"\n+                                    + \"Actual Color: \" + actual + \"\\n\");\n@@ -157,1 +164,1 @@\n-        System.out.print(\" Status: PASSED\\n\");\n+        System.out.println(\"Test region: \" + region + \" Status: PASSED\");\n@@ -176,0 +183,9 @@\n+\n+    private static boolean compareColor(Color expected, Color actual) {\n+            return Math.abs(expected.getRed() - actual.getRed())\n+                   < (expected.equals(Color.RED) ? PRIMARY_TOLERANCE : TOLERANCE)\n+                   && Math.abs(expected.getGreen() - actual.getGreen())\n+                      < (expected.equals(Color.GREEN) ? PRIMARY_TOLERANCE : TOLERANCE)\n+                   && Math.abs(expected.getBlue() - actual.getBlue())\n+                      < (expected.equals(Color.BLUE) ? PRIMARY_TOLERANCE : TOLERANCE);\n+    }\n@@ -177,0 +193,1 @@\n+\n","filename":"test\/jdk\/java\/awt\/Graphics2D\/CopyAreaOOB.java","additions":42,"deletions":25,"binary":false,"changes":67,"status":"modified"}]}