{"files":[{"patch":"@@ -16043,0 +16043,14 @@\n+void Assembler::esetzucc(Condition cc, Register dst) {\n+  assert(VM_Version::supports_apx_f(), \"\");\n+  assert(0 <= cc && cc < 16, \"illegal cc\");\n+\n+  InstructionAttr attributes(AVX_128bit, \/* vex_w *\/ false, \/* legacy_mode *\/ false, \/* no_mask_reg *\/ true, \/* uses_vl *\/ false);\n+  attributes.set_is_evex_instruction();\n+  attributes.set_extended_context();\n+\n+  \/\/ Encoding Format : eevex_prefix | opcode_cc | modrm\n+  int encode =  evex_prefix_and_encode_ndd(0, 0, dst->encoding(), VEX_SIMD_F2, \/* MAP4 *\/VEX_OPCODE_0F_3C, &attributes);\n+  emit_opcode_prefix_and_encoding((0x40 | cc), 0xC0, encode);\n+\n+}\n+\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.cpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1042,1 +1042,1 @@\n-  \/\/ APX ISA extensions for register save\/restore optimizations.\n+  \/\/ APX ISA Extensions for register save\/restore optimizations.\n@@ -1050,0 +1050,3 @@\n+  \/\/ New Zero Upper setcc instruction.\n+  void esetzucc(Condition cc, Register dst);\n+\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -129,2 +129,1 @@\n-            \"sete     $res\\n\\t\"\n-            \"movzbl   $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -138,2 +137,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n","filename":"src\/hotspot\/cpu\/x86\/gc\/x\/x_x86_64.ad","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -215,2 +215,1 @@\n-            \"sete     $res\\n\\t\"\n-            \"movzbl   $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -225,2 +224,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n","filename":"src\/hotspot\/cpu\/x86\/gc\/z\/z_x86_64.ad","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -10424,0 +10424,9 @@\n+\n+void MacroAssembler::setcc(Assembler::Condition comparison, Register dst) {\n+  if (VM_Version::supports_apx_f()) {\n+    esetzucc(comparison, dst);\n+  } else {\n+    setb(comparison, dst);\n+    movzbl(dst, dst);\n+  }\n+}\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2157,0 +2157,1 @@\n+  void setcc(Assembler::Condition comparison, Register dst);\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -660,2 +660,1 @@\n-  __ setb(Assembler::notEqual, dst);\n-  __ movzbl(dst, dst);\n+  __ setcc(Assembler::notEqual, dst);\n@@ -7073,2 +7072,1 @@\n-            \"sete    $res\\n\\t\"\n-            \"movzbl  $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -7078,2 +7076,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n@@ -7095,2 +7092,1 @@\n-            \"sete    $res\\n\\t\"\n-            \"movzbl  $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -7100,2 +7096,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n@@ -7117,2 +7112,1 @@\n-            \"sete    $res\\n\\t\"\n-            \"movzbl  $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -7122,2 +7116,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n@@ -7139,2 +7132,1 @@\n-            \"sete    $res\\n\\t\"\n-            \"movzbl  $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -7144,2 +7136,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n@@ -7161,2 +7152,1 @@\n-            \"sete    $res\\n\\t\"\n-            \"movzbl  $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -7166,2 +7156,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n@@ -7182,2 +7171,1 @@\n-            \"sete    $res\\n\\t\"\n-            \"movzbl  $res, $res\" %}\n+            \"setcc $res \\t# emits sete + movzbl or setzue for APX\" %}\n@@ -7187,2 +7175,1 @@\n-    __ setb(Assembler::equal, $res$$Register);\n-    __ movzbl($res$$Register, $res$$Register);\n+    __ setcc(Assembler::equal, $res$$Register);\n@@ -9732,2 +9719,1 @@\n-            \"setlt   $dst\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\\t\"\n+            \"setcc   $dst \\t# emits setlt + movzbl or setzul for APX\"\n@@ -9737,2 +9723,1 @@\n-    __ setb(Assembler::less, $dst$$Register);\n-    __ movzbl($dst$$Register, $dst$$Register);\n+    __ setcc(Assembler::less, $dst$$Register);\n@@ -11863,2 +11848,1 @@\n-            \"setne   $dst\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\\t\"\n+            \"setcc   $dst \\t# emits setne + movzbl or setzune for APX\"\n@@ -11871,2 +11855,1 @@\n-    __ setb(Assembler::notZero, $dst$$Register);\n-    __ movzbl($dst$$Register, $dst$$Register);\n+    __ setcc(Assembler::notZero, $dst$$Register);\n@@ -11889,2 +11872,1 @@\n-            \"setne   $dst\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\\t\"\n+            \"setcc   $dst \\t# emits setne + movzbl or setzune for APX\"\n@@ -11897,2 +11879,1 @@\n-    __ setb(Assembler::notZero, $dst$$Register);\n-    __ movzbl($dst$$Register, $dst$$Register);\n+    __ setcc(Assembler::notZero, $dst$$Register);\n@@ -11915,2 +11896,1 @@\n-            \"setne   $dst\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\\t\"\n+            \"setcc   $dst \\t# emits setne + movzbl or setzune for APX\"\n@@ -11923,2 +11903,1 @@\n-    __ setb(Assembler::notZero, $dst$$Register);\n-    __ movzbl($dst$$Register, $dst$$Register);\n+    __ setcc(Assembler::notZero, $dst$$Register);\n","filename":"src\/hotspot\/cpu\/x86\/x86_64.ad","additions":21,"deletions":42,"binary":false,"changes":63,"status":"modified"}]}