{"files":[{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -112,0 +112,7 @@\n+    switch (opcode) {\n+      case Op_SelectFromTwoVector:\n+        \/\/ There is no masked version of selectFrom two vector, i.e. selectFrom(av, bv, mask) in vector API.\n+        return false;\n+      default:\n+        break;\n+    }\n@@ -4428,0 +4435,28 @@\n+\/\/ ------------------------------ Vector selectFrom -----------------------------\n+\n+instruct select_from_two_vectors(vReg dst, vReg src1, vReg src2, vReg index, vRegMask_V0 v0, vReg tmp) %{\n+  match(Set dst (SelectFromTwoVector (Binary index src1) src2));\n+  effect(TEMP_DEF dst, TEMP v0, TEMP tmp);\n+  format %{ \"select_from_two_vectors $dst, $src1, $src2, $index\" %}\n+  ins_encode %{\n+    BasicType bt = Matcher::vector_element_basic_type(this);\n+    __ vsetvli_helper(bt, Matcher::vector_length(this));\n+    __ vrgather_vv(as_VectorRegister($dst$$reg), as_VectorRegister($src1$$reg),\n+                   as_VectorRegister($index$$reg));\n+    bool use_imm = __ is_simm5(Matcher::vector_length(this) - 1);\n+    if (use_imm) {\n+      __ vmsgtu_vi(v0, as_VectorRegister($index$$reg), Matcher::vector_length(this) - 1);\n+      __ vadd_vi(as_VectorRegister($tmp$$reg), as_VectorRegister($index$$reg),\n+                 -Matcher::vector_length(this), Assembler::v0_t);\n+    } else {\n+      __ mv(t0, Matcher::vector_length(this) - 1);\n+      __ vmsgtu_vx(v0, as_VectorRegister($index$$reg), t0);\n+      __ mv(t0, -Matcher::vector_length(this));\n+      __ vadd_vx(as_VectorRegister($tmp$$reg), as_VectorRegister($index$$reg), t0, Assembler::v0_t);\n+    }\n+    __ vrgather_vv(as_VectorRegister($dst$$reg), as_VectorRegister($src2$$reg),\n+                   as_VectorRegister($tmp$$reg), Assembler::v0_t);\n+  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":36,"deletions":1,"binary":false,"changes":37,"status":"modified"}]}