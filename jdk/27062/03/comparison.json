{"files":[{"patch":"@@ -1985,1 +1985,1 @@\n-                        checkAutoCloseable(resource.pos(), localEnv, resource.type);\n+                        checkAutoCloseable(localEnv, resource, true);\n@@ -2034,1 +2034,3 @@\n-    void checkAutoCloseable(DiagnosticPosition pos, Env<AttrContext> env, Type resource) {\n+    void checkAutoCloseable(Env<AttrContext> env, JCTree tree, boolean useSite) {\n+        DiagnosticPosition pos = tree.pos();\n+        Type resource = tree.type;\n@@ -2052,1 +2054,2 @@\n-                    close.overrides(syms.autoCloseableClose, resource.tsym, types, true) &&\n+                    (useSite || close.owner != syms.autoCloseableType.tsym) &&\n+                    ((MethodSymbol)close).binaryOverrides(syms.autoCloseableClose, resource.tsym, types) &&\n@@ -2054,1 +2057,6 @@\n-                log.warning(pos, LintWarnings.TryResourceThrowsInterruptedExc(resource));\n+                if (!useSite && close.owner == resource.tsym) {\n+                    log.warning(TreeInfo.diagnosticPositionFor(close, tree),\n+                        LintWarnings.TryResourceCanThrowInterruptedExc(resource));\n+                } else {\n+                    log.warning(pos, LintWarnings.TryResourceThrowsInterruptedExc(resource));\n+                }\n@@ -5652,1 +5660,1 @@\n-        checkAutoCloseable(tree.pos(), env, c.type);\n+        checkAutoCloseable(env, tree, false);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2371,0 +2371,5 @@\n+# 0: type\n+# lint: try\n+compiler.warn.try.resource.can.throw.interrupted.exc=\\\n+    close() method can throw InterruptedException in auto-closeable class {0}\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler.properties","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -231,1 +231,2 @@\n-                    diagnostic.getCode().contains(\"try.resource.throws.interrupted.exc\")) {\n+                    (diagnostic.getCode().contains(\"try.resource.throws.interrupted.exc\") ||\n+                     diagnostic.getCode().contains(\"try.resource.can.throw.interrupted.exc\"))) {\n","filename":"test\/langtools\/tools\/javac\/TryWithResources\/InterruptedExceptionTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,256 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @bug 8155591\n+ * @summary Verify cases where no AutoCloseable InterruptedException warning should be generated\n+ * @compile\/ref=InterruptedExceptionTest2.out -XDrawDiagnostics -Xlint:try InterruptedExceptionTest2.java\n+ *\/\n+\n+import java.util.function.Supplier;\n+\n+\/\/ Here's an interface and a class that we can inherit declaring offending close() methods\n+\n+interface HasClose {\n+    void close() throws Exception;\n+}\n+\n+class WithConcreteClose {\n+    public void close() throws Exception { }\n+}\n+\n+abstract class WithAbstractClose {\n+    public abstract void close() throws Exception;\n+}\n+\n+\/\/ Interface declaration tests\n+\n+interface InterruptedExceptionTest_I1 extends AutoCloseable {\n+}\n+\n+interface InterruptedExceptionTest_I2 extends AutoCloseable {\n+    @Override void close();\n+}\n+\n+interface InterruptedExceptionTest_I3 extends AutoCloseable {\n+    @Override void close() throws InterruptedException;                     \/\/ warning here\n+}\n+\n+interface InterruptedExceptionTest_I4 extends AutoCloseable {\n+    @Override void close() throws Exception;                                \/\/ warning here\n+}\n+\n+interface InterruptedExceptionTest_I5 extends AutoCloseable {\n+    @Override default void close() { }\n+}\n+\n+interface InterruptedExceptionTest_I6 extends AutoCloseable {\n+    @Override default void close() throws InterruptedException { }          \/\/ warning here\n+}\n+\n+interface InterruptedExceptionTest_I7 extends AutoCloseable {\n+    @Override default void close() throws Exception { }                     \/\/ warning here\n+}\n+\n+interface InterruptedExceptionTest_I8 extends HasClose, AutoCloseable {\n+}\n+\n+interface InterruptedExceptionTest_I9 extends HasClose, AutoCloseable {\n+    @Override void close();\n+}\n+\n+\/\/ Abstract class declaration tests\n+\n+abstract class InterruptedExceptionTest_C1 implements AutoCloseable {\n+}\n+\n+abstract class InterruptedExceptionTest_C2 implements AutoCloseable {\n+    @Override public abstract void close();\n+}\n+\n+abstract class InterruptedExceptionTest_C3 implements AutoCloseable {\n+    @Override public abstract void close() throws InterruptedException;     \/\/ warning here\n+}\n+\n+abstract class InterruptedExceptionTest_C4 implements AutoCloseable {\n+    @Override public abstract void close() throws Exception;                \/\/ warning here\n+}\n+\n+abstract class InterruptedExceptionTest_C5 implements AutoCloseable {\n+    @Override public void close() { }\n+}\n+\n+abstract class InterruptedExceptionTest_C6 implements AutoCloseable {\n+    @Override public void close() throws InterruptedException { }           \/\/ warning here\n+}\n+\n+abstract class InterruptedExceptionTest_C7 implements AutoCloseable {\n+    @Override public void close() throws Exception { }                      \/\/ warning here\n+}\n+\n+abstract class InterruptedExceptionTest_C8 implements HasClose, AutoCloseable {\n+}\n+\n+abstract class InterruptedExceptionTest_C9 implements HasClose, AutoCloseable {\n+    @Override public void close() { }\n+}\n+\n+abstract class InterruptedExceptionTest_C10 extends WithConcreteClose implements AutoCloseable { \/\/ warning here\n+}\n+\n+abstract class InterruptedExceptionTest_C11 extends WithAbstractClose implements AutoCloseable {\n+}\n+\n+\/\/ Interface use site tests\n+\n+class UseSite_I1 {\n+    void m(Supplier<InterruptedExceptionTest_I1> s) throws Exception {\n+        try (InterruptedExceptionTest_I1 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I2 {\n+    void m(Supplier<InterruptedExceptionTest_I2> s) throws Exception {\n+        try (InterruptedExceptionTest_I2 t = s.get()) {\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I3 {\n+    void m(Supplier<InterruptedExceptionTest_I3> s) throws Exception {\n+        try (InterruptedExceptionTest_I3 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I4 {\n+    void m(Supplier<InterruptedExceptionTest_I4> s) throws Exception {\n+        try (InterruptedExceptionTest_I4 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I5 {\n+    void m(Supplier<InterruptedExceptionTest_I5> s) throws Exception {\n+        try (InterruptedExceptionTest_I5 t = s.get()) {\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I6 {\n+    void m(Supplier<InterruptedExceptionTest_I6> s) throws Exception {\n+        try (InterruptedExceptionTest_I6 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I7 {\n+    void m(Supplier<InterruptedExceptionTest_I7> s) throws Exception {\n+        try (InterruptedExceptionTest_I7 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I8 {\n+    void m(Supplier<InterruptedExceptionTest_I8> s) throws Exception {\n+        try (InterruptedExceptionTest_I8 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_I9 {\n+    void m(Supplier<InterruptedExceptionTest_I9> s) throws Exception {\n+        try (InterruptedExceptionTest_I9 t = s.get()) {\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+\/\/ Abstract class use site tests\n+\n+class UseSite_C1 {\n+    void m(Supplier<InterruptedExceptionTest_C1> s) throws Exception {\n+        try (InterruptedExceptionTest_C1 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C2 {\n+    void m(Supplier<InterruptedExceptionTest_C2> s) throws Exception {\n+        try (InterruptedExceptionTest_C2 t = s.get()) {\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C3 {\n+    void m(Supplier<InterruptedExceptionTest_C3> s) throws Exception {\n+        try (InterruptedExceptionTest_C3 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C4 {\n+    void m(Supplier<InterruptedExceptionTest_C4> s) throws Exception {\n+        try (InterruptedExceptionTest_C4 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C5 {\n+    void m(Supplier<InterruptedExceptionTest_C5> s) throws Exception {\n+        try (InterruptedExceptionTest_C5 t = s.get()) {\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C6 {\n+    void m(Supplier<InterruptedExceptionTest_C6> s) throws Exception {\n+        try (InterruptedExceptionTest_C6 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C7 {\n+    void m(Supplier<InterruptedExceptionTest_C7> s) throws Exception {\n+        try (InterruptedExceptionTest_C7 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C8 {\n+    void m(Supplier<InterruptedExceptionTest_C8> s) throws Exception {\n+        try (InterruptedExceptionTest_C8 t = s.get()) {                     \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C9 {\n+    void m(Supplier<InterruptedExceptionTest_C9> s) throws Exception {\n+        try (InterruptedExceptionTest_C9 t = s.get()) {\n+            t.hashCode();\n+        }\n+    }\n+}\n+\n+class UseSite_C10 {\n+    void m(Supplier<InterruptedExceptionTest_C10> s) throws Exception {\n+        try (InterruptedExceptionTest_C10 t = s.get()) {                    \/\/ warning here\n+            t.hashCode();\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/TryWithResources\/InterruptedExceptionTest2.java","additions":256,"deletions":0,"binary":false,"changes":256,"status":"added"},{"patch":"@@ -0,0 +1,23 @@\n+InterruptedExceptionTest2.java:34:20: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_I3\n+InterruptedExceptionTest2.java:38:20: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_I4\n+InterruptedExceptionTest2.java:46:28: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_I6\n+InterruptedExceptionTest2.java:50:28: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_I7\n+InterruptedExceptionTest2.java:70:36: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_C3\n+InterruptedExceptionTest2.java:74:36: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_C4\n+InterruptedExceptionTest2.java:82:27: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_C6\n+InterruptedExceptionTest2.java:86:27: compiler.warn.try.resource.can.throw.interrupted.exc: InterruptedExceptionTest_C7\n+InterruptedExceptionTest2.java:96:10: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C10\n+InterruptedExceptionTest2.java:106:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_I1\n+InterruptedExceptionTest2.java:122:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_I3\n+InterruptedExceptionTest2.java:130:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_I4\n+InterruptedExceptionTest2.java:146:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_I6\n+InterruptedExceptionTest2.java:154:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_I7\n+InterruptedExceptionTest2.java:162:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_I8\n+InterruptedExceptionTest2.java:180:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C1\n+InterruptedExceptionTest2.java:196:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C3\n+InterruptedExceptionTest2.java:204:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C4\n+InterruptedExceptionTest2.java:220:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C6\n+InterruptedExceptionTest2.java:228:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C7\n+InterruptedExceptionTest2.java:236:42: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C8\n+InterruptedExceptionTest2.java:252:43: compiler.warn.try.resource.throws.interrupted.exc: InterruptedExceptionTest_C10\n+22 warnings\n","filename":"test\/langtools\/tools\/javac\/TryWithResources\/InterruptedExceptionTest2.out","additions":23,"deletions":0,"binary":false,"changes":23,"status":"added"},{"patch":"@@ -25,0 +25,1 @@\n+\/\/ key: compiler.warn.try.resource.can.throw.interrupted.exc\n@@ -29,0 +30,6 @@\n+    {\n+        try (var t = new TryResourceThrowsInterruptedException()) {\n+            t.hashCode();\n+        } catch (InterruptedException e) {\n+        }\n+    }\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/TryResourceThrowsInterruptedExc.java","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"}]}