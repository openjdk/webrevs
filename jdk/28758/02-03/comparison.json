{"files":[{"patch":"@@ -70,1 +70,1 @@\n-    const GCCause::Cause requested_gc_cause = _requested_gc_cause.load_relaxed();\n+    const GCCause::Cause requested_gc_cause = current_requested_gc_cause();\n@@ -74,2 +74,1 @@\n-      _gc_requested.unset();\n-      _requested_gc_cause.store_relaxed(GCCause::_no_gc);\n+      reset_requested_gc();\n@@ -240,1 +239,1 @@\n-      if (_requested_gc_cause.load_relaxed() == GCCause::_no_gc) {\n+      if (current_requested_gc_cause() == GCCause::_no_gc) {\n@@ -368,1 +367,1 @@\n-  _requested_gc_cause.store_relaxed(cause);\n+  _requested_gc_cause = cause;\n@@ -415,0 +414,17 @@\n+\n+\n+GCCause::Cause ShenandoahControlThread::current_requested_gc_cause() {\n+  if (_control_lock.owned_by_self()) return _requested_gc_cause;\n+  {\n+    MonitorLocker ml(&_control_lock, Mutex::_no_safepoint_check_flag);\n+    return _requested_gc_cause;\n+  }\n+}\n+\n+void ShenandoahControlThread::reset_requested_gc() {\n+  {\n+    MonitorLocker ml(&_control_lock, Mutex::_no_safepoint_check_flag);\n+    _requested_gc_cause = GCCause::_no_gc;\n+    _gc_requested.unset();\n+  }\n+}\n\\ No newline at end of file\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahControlThread.cpp","additions":21,"deletions":5,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-#include \"runtime\/atomic.hpp\"\n@@ -46,1 +45,1 @@\n-  Atomic<GCCause::Cause>             _requested_gc_cause;\n+  GCCause::Cause                     _requested_gc_cause;\n@@ -76,0 +75,4 @@\n+\n+  GCCause::Cause current_requested_gc_cause();\n+\n+  void reset_requested_gc();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahControlThread.hpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -82,1 +82,1 @@\n-      if (_requested_gc_cause.load_relaxed() == GCCause::_no_gc) {\n+      if (_requested_gc_cause == GCCause::_no_gc) {\n@@ -99,1 +99,1 @@\n-  _requested_gc_cause.store_relaxed(GCCause::_shenandoah_stop_vm);\n+  _requested_gc_cause = GCCause::_shenandoah_stop_vm;\n@@ -118,1 +118,1 @@\n-    request.cause = _requested_gc_cause.load_relaxed();\n+    request.cause = _requested_gc_cause;\n@@ -123,1 +123,1 @@\n-    _requested_gc_cause.store_relaxed(GCCause::_no_gc);\n+    _requested_gc_cause = GCCause::_no_gc;\n@@ -648,1 +648,1 @@\n-                          GCCause::to_string(_requested_gc_cause.load_relaxed()),\n+                          GCCause::to_string(_requested_gc_cause),\n@@ -673,1 +673,1 @@\n-      GCCause::Cause requested_gc_cause = _requested_gc_cause.load_relaxed();\n+      GCCause::Cause requested_gc_cause = _requested_gc_cause;\n@@ -700,1 +700,1 @@\n-  _requested_gc_cause.store_relaxed(cause);\n+  _requested_gc_cause = cause;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGenerationalControlThread.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -33,1 +33,0 @@\n-#include \"runtime\/atomic.hpp\"\n@@ -67,1 +66,1 @@\n-  Atomic<GCCause::Cause> _requested_gc_cause;\n+  GCCause::Cause _requested_gc_cause;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGenerationalControlThread.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}