{"files":[{"patch":"@@ -38,3 +38,4 @@\n-bool   HotCodeGrouper::_is_initialized = false;\n-int    HotCodeGrouper::_new_c2_nmethods_count = 0;\n-int    HotCodeGrouper::_total_c2_nmethods_count = 0;\n+bool      HotCodeGrouper::_is_initialized = false;\n+int       HotCodeGrouper::_new_c2_nmethods_count = 0;\n+int       HotCodeGrouper::_total_c2_nmethods_count = 0;\n+CodeHeap* HotCodeGrouper::hot_code_heap = nullptr;\n@@ -51,0 +52,14 @@\n+  \/\/ Find HotCodeHeap\n+  const GrowableArray<CodeHeap*>* heaps = CodeCache::nmethod_heaps();\n+  for (GrowableArrayIterator<CodeHeap*> heap = heaps->begin(); heap != heaps->end(); ++heap) {\n+    if ((*heap)->accepts(CodeBlobType::MethodHot)) {\n+      hot_code_heap = *heap;\n+      break;\n+    }\n+  }\n+\n+  \/\/ If the hot code heap is not found return and remain uninitialized\n+  if (hot_code_heap == nullptr) {\n+    return;\n+  }\n+\n@@ -75,0 +90,5 @@\n+bool HotCodeGrouper::hot_heap_has_space(size_t size) {\n+  assert(hot_code_heap != nullptr, \"must initialize HotCodeGrouper\");\n+  return hot_code_heap->unallocated_capacity() > size;\n+}\n+\n@@ -104,0 +124,1 @@\n+      log_info(hotcodegrouper)(\"Ratio of samples from hot nmethods (%f) over threshold (%f). Done grouping\", ratio_from_hot, HotCodeSampleRatio);\n@@ -125,0 +146,6 @@\n+    if (!hot_heap_has_space(nm->size())) {\n+      log_info(hotcodegrouper)(\"Not enough space in HotCodeHeap (%ld bytes) to relocate nm (%d bytes). Bailing out\",\n+        hot_code_heap->unallocated_capacity(), nm->size());\n+      return;\n+    }\n+\n@@ -172,0 +199,6 @@\n+      if (!hot_heap_has_space(actual_dest_nm->size())) {\n+        log_info(hotcodegrouper)(\"Not enough space in HotCodeHeap (%ld bytes) to relocate nm (%d bytes). Bailing out\",\n+          hot_code_heap->unallocated_capacity(), actual_dest_nm->size());\n+        return;\n+      }\n+\n","filename":"src\/hotspot\/share\/runtime\/hotCodeGrouper.cpp","additions":36,"deletions":3,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -40,0 +40,2 @@\n+  static CodeHeap* hot_code_heap;\n+\n@@ -52,0 +54,2 @@\n+\n+  bool hot_heap_has_space(size_t size);\n","filename":"src\/hotspot\/share\/runtime\/hotCodeGrouper.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}