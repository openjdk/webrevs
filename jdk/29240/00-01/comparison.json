{"files":[{"patch":"@@ -1736,1 +1736,1 @@\n-bool os::remove_stack_guard_pages(char* addr, size_t size, const char* err_msg) {\n+bool os::remove_stack_guard_pages(char* addr, size_t size) {\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1766,2 +1766,3 @@\n-bool os::remove_stack_guard_pages(char* addr, size_t size, const char* err_msg) {\n-  return os::uncommit_memory(addr, size, false, err_msg);\n+bool os::remove_stack_guard_pages(char* addr, size_t size) {\n+  os::uncommit_memory(addr, size, false);\n+  return true;\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -3566,1 +3566,1 @@\n-bool os::remove_stack_guard_pages(char* addr, size_t size, const char* err_msg) {\n+bool os::remove_stack_guard_pages(char* addr, size_t size) {\n@@ -3572,1 +3572,2 @@\n-  return os::uncommit_memory(addr, size, false, err_msg);\n+  os::uncommit_memory(addr, size, false);\n+  return true;\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -3260,5 +3260,4 @@\n-    bool rc = (file_desc != -1) ? os::unmap_memory(extra_base, extra_size) :\n-                                  os::release_memory(extra_base, extra_size);\n-    assert(rc, \"release failed\");\n-    if (!rc) {\n-      return nullptr;\n+    if ((file_desc != -1)) {\n+      os::unmap_memory(extra_base, extra_size);\n+    } else {\n+      os::release_memory(extra_base, extra_size);\n@@ -3660,2 +3659,3 @@\n-bool os::remove_stack_guard_pages(char* addr, size_t size, const char* err_msg) {\n-  return os::uncommit_memory(addr, size, false, err_msg);\n+bool os::remove_stack_guard_pages(char* addr, size_t size) {\n+  os::uncommit_memory(addr, size, false);\n+  return true;\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1328,3 +1328,1 @@\n-    char err_msg[] = \"os::unmap_memory of region 2147483647 failed\";\n-    os::snprintf_checked(err_msg, sizeof(err_msg), \"os::unmap_memory of region %d failed\", region_index);\n-    os::unmap_memory(mapped_base, r->used_aligned(), err_msg);\n+    os::unmap_memory(mapped_base, r->used_aligned());\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -81,3 +81,2 @@\n-  bool result = special() || os::uncommit_memory(base_addr, bytes);\n-  if (result) {\n-    _committed_high_addr -= bytes;\n+  if (!special()) {\n+    os::uncommit_memory(base_addr, bytes);\n@@ -86,1 +85,3 @@\n-  return result;\n+  _committed_high_addr -= bytes;\n+\n+  return true;\n","filename":"src\/hotspot\/share\/gc\/parallel\/psVirtualspace.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -1771,1 +1771,1 @@\n-    os::uncommit_memory((char*)_aux_bitmap_region.start(), _aux_bitmap_region.byte_size(), false, \"Auxiliary marking bitmap uncommit failed\");\n+    os::uncommit_memory((char*)_aux_bitmap_region.start(), _aux_bitmap_region.byte_size(), false);\n@@ -2621,1 +2621,1 @@\n-  os::uncommit_memory(addr, len, false, \"Bitmap slice uncommit failed\");\n+  os::uncommit_memory(addr, len, false);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -814,1 +814,1 @@\n-    os::uncommit_memory((char *) bottom(), RegionSizeBytes, false, \"Region uncommit failed\");\n+    os::uncommit_memory((char *) bottom(), RegionSizeBytes, false);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegion.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -232,1 +232,1 @@\n-bool MemoryReserver::release(const ReservedSpace& reserved) {\n+void MemoryReserver::release(const ReservedSpace& reserved) {\n@@ -236,1 +236,1 @@\n-    return os::release_memory_special(reserved.base(), reserved.size());\n+    os::release_memory_special(reserved.base(), reserved.size());\n@@ -238,1 +238,1 @@\n-    return os::release_memory(reserved.base(), reserved.size());\n+    os::release_memory(reserved.base(), reserved.size());\n","filename":"src\/hotspot\/share\/memory\/memoryReserver.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -73,1 +73,1 @@\n-  static bool release(const ReservedSpace& reserved);\n+  static void release(const ReservedSpace& reserved);\n","filename":"src\/hotspot\/share\/memory\/memoryReserver.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -193,1 +193,1 @@\n-  os::uncommit_memory((char*)p, word_size * BytesPerWord, false, \"Failed to uncommit metaspace.\");\n+  os::uncommit_memory((char*)p, word_size * BytesPerWord, false);\n","filename":"src\/hotspot\/share\/memory\/metaspace\/virtualSpaceNode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2260,9 +2260,0 @@\n-\/\/ Helper for os::uncommit_memory and os::unmap_memory\n-static void print_err_fatal(char* addr, size_t bytes, const char* err_msg1, const char* err_msg2) {\n-  const char* s = \": \";\n-  if (err_msg1 == nullptr) {\n-    err_msg1 = \"\";\n-    s =  \"\";\n-  }\n-  fatal(\"%s%s%s\" RANGEFMT, err_msg1, s, err_msg2, RANGEFMTARGS(addr, bytes));\n-}\n@@ -2275,1 +2266,1 @@\n-bool os::uncommit_memory(char* addr, size_t bytes, bool executable, const char* err_msg) {\n+void os::uncommit_memory(char* addr, size_t bytes, bool executable) {\n@@ -2289,1 +2280,1 @@\n-    print_err_fatal(addr, bytes, err_msg, \"Failed to uncommit \");\n+    fatal(\"Failed to uncommit \" RANGEFMT, RANGEFMTARGS(addr, bytes));\n@@ -2292,2 +2283,0 @@\n-\n-  return true;\n@@ -2301,1 +2290,1 @@\n-bool os::release_memory(char* addr, size_t bytes) {\n+void os::release_memory(char* addr, size_t bytes) {\n@@ -2317,2 +2306,0 @@\n-\n-  return true;\n@@ -2387,1 +2374,1 @@\n-bool os::unmap_memory(char *addr, size_t bytes, const char* err_msg) {\n+void os::unmap_memory(char *addr, size_t bytes) {\n@@ -2399,1 +2386,1 @@\n-    print_err_fatal(addr, bytes, err_msg, \"Failed to unmap memory \");\n+    fatal(\"Failed to unmap memory \" RANGEFMT, RANGEFMTARGS(addr, bytes));\n@@ -2401,1 +2388,0 @@\n-  return true;\n@@ -2429,1 +2415,1 @@\n-bool os::release_memory_special(char* addr, size_t bytes) {\n+void os::release_memory_special(char* addr, size_t bytes) {\n@@ -2443,1 +2429,0 @@\n-  return true;\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":6,"deletions":21,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -488,2 +488,2 @@\n-  static bool   uncommit_memory(char* addr, size_t bytes, bool executable = false, const char* err_msg = nullptr);\n-  static bool   release_memory(char* addr, size_t bytes);\n+  static void   uncommit_memory(char* addr, size_t bytes, bool executable = false);\n+  static void   release_memory(char* addr, size_t bytes);\n@@ -518,1 +518,1 @@\n-  static bool   remove_stack_guard_pages(char* addr, size_t bytes, const char* err_msg = nullptr);\n+  static bool   remove_stack_guard_pages(char* addr, size_t bytes);\n@@ -534,1 +534,1 @@\n-  static bool   unmap_memory(char *addr, size_t bytes, const char* err_msg = nullptr);\n+  static void   unmap_memory(char *addr, size_t bytes);\n@@ -557,1 +557,1 @@\n-  static bool   release_memory_special(char* addr, size_t bytes);\n+  static void   release_memory_special(char* addr, size_t bytes);\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -119,1 +119,1 @@\n-    if (os::remove_stack_guard_pages((char *) low_addr, len, \"Attempt to deallocate stack guard pages failed\")) {\n+    if (os::remove_stack_guard_pages((char *) low_addr, len)) {\n","filename":"src\/hotspot\/share\/runtime\/stackOverflow.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -171,2 +171,1 @@\n-    const bool released = os::release_memory((char*)untype(blocked), ZGranuleSize);\n-    ASSERT_TRUE(released);\n+    os::release_memory((char*)untype(blocked), ZGranuleSize);\n","filename":"test\/hotspot\/gtest\/gc\/z\/test_zVirtualMemoryManager.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -37,1 +37,1 @@\n-      EXPECT_TRUE(MemoryReserver::release(*_rs));\n+      MemoryReserver::release(*_rs);\n@@ -358,1 +358,1 @@\n-      EXPECT_TRUE(os::release_memory_special(rs.base(), rs.size()));\n+      os::release_memory_special(rs.base(), rs.size());\n@@ -360,1 +360,1 @@\n-      EXPECT_TRUE(os::release_memory(rs.base(), rs.size()));\n+      os::release_memory(rs.base(), rs.size());\n","filename":"test\/hotspot\/gtest\/memory\/test_virtualspace.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -514,1 +514,1 @@\n-    EXPECT_TRUE(os::release_memory((char*)q, stripe_len));\n+    os::release_memory((char*)q, stripe_len);\n@@ -537,1 +537,1 @@\n-    EXPECT_TRUE(os::release_memory((char*)p, total_range_len));\n+    os::release_memory((char*)p, total_range_len);\n@@ -630,1 +630,1 @@\n-    ASSERT_TRUE(os::release_memory((char*)p_middle_stripes, middle_stripe_len));\n+    os::release_memory((char*)p_middle_stripes, middle_stripe_len);\n@@ -644,1 +644,1 @@\n-    ASSERT_TRUE(os::release_memory((char*)p, total_range_len));\n+    os::release_memory((char*)p, total_range_len);\n@@ -653,0 +653,7 @@\n+\n+static char* setup_release_test_memory() {\n+  char* p = os::reserve_memory(4 * M, mtTest);\n+  EXPECT_NE(p, (char*)nullptr);\n+  return p;\n+}\n+\n@@ -654,1 +661,1 @@\n-TEST_VM_ASSERT_MSG(os, release_bad_ranges, \".*bad release\") {\n+TEST_VM_ASSERT_MSG(os, release_bad_range_start, \".*bad release\") {\n@@ -656,1 +663,1 @@\n-TEST_VM(os, release_bad_ranges) {\n+TEST_VM_FATAL_ERROR_MSG(os, release_bad_range_start, \".*Failed to release.*\") {\n@@ -658,15 +665,3 @@\n-  char* p = os::reserve_memory(4 * M, mtTest);\n-  ASSERT_NE(p, (char*)nullptr);\n-  \/\/ Release part of range\n-  ASSERT_FALSE(os::release_memory(p, M));\n-  \/\/ Release part of range\n-  ASSERT_FALSE(os::release_memory(p + M, M));\n-  \/\/ Release more than the range (explicitly switch off NUMA here\n-  \/\/  to make os::release_memory() test more strictly and to not\n-  \/\/  accidentally release neighbors)\n-  {\n-    NUMASwitcher b(false);\n-    ASSERT_FALSE(os::release_memory(p, M * 5));\n-    ASSERT_FALSE(os::release_memory(p - M, M * 5));\n-    ASSERT_FALSE(os::release_memory(p - M, M * 6));\n-  }\n+  char* p = setup_release_test_memory();\n+  os::release_memory(p, M);  \/\/ Release part of the range\n+}\n@@ -674,2 +669,50 @@\n-  ASSERT_TRUE(os::release_memory(p, 4 * M)); \/\/ Release for real\n-  ASSERT_FALSE(os::release_memory(p, 4 * M)); \/\/ Again, should fail\n+#ifdef ASSERT\n+TEST_VM_ASSERT_MSG(os, release_bad_range_middle, \".*bad release\") {\n+#else\n+TEST_VM_FATAL_ERROR_MSG(os, release_bad_range_middle, \".*Failed to release.*\") {\n+#endif\n+  char* p = setup_release_test_memory();\n+  os::release_memory(p + M, M);  \/\/ Release middle part\n+}\n+\n+\/\/ Release more than the range (explicitly switch off NUMA here\n+\/\/  to make os::release_memory() test more strict and to not\n+\/\/  accidentally release neighbors)\n+#ifdef ASSERT\n+TEST_VM_ASSERT_MSG(os, release_beyond_range1, \".*bad release\") {\n+#else\n+TEST_VM_FATAL_ERROR_MSG(os, release_beyond_range1, \".*Failed to release.*\") {\n+#endif\n+  char* p = setup_release_test_memory();\n+  NUMASwitcher b(false);\n+  os::release_memory(p, M * 5);\n+}\n+\n+#ifdef ASSERT\n+TEST_VM_ASSERT_MSG(os, release_beyond_range2, \".*bad release\") {\n+#else\n+TEST_VM_FATAL_ERROR_MSG(os, release_beyond_range2, \".*Failed to release.*\") {\n+#endif\n+  char* p = setup_release_test_memory();\n+  NUMASwitcher b(false);\n+  os::release_memory(p - M, M * 5);\n+}\n+\n+#ifdef ASSERT\n+TEST_VM_ASSERT_MSG(os, release_beyond_range3, \".*bad release\") {\n+#else\n+TEST_VM_FATAL_ERROR_MSG(os, release_beyond_range3, \".*Failed to release.*\") {\n+#endif\n+  char* p = setup_release_test_memory();\n+  NUMASwitcher b(false);\n+  os::release_memory(p - M, M * 6);\n+}\n+\n+#ifdef ASSERT\n+TEST_VM_ASSERT_MSG(os, release_already_released, \".*bad release\") {\n+#else\n+TEST_VM_FATAL_ERROR_MSG(os, release_already_released, \".*Failed to release.*\") {\n+#endif\n+  char* p = setup_release_test_memory();\n+  os::release_memory(p, 4 * M); \/\/ Release for real\n+  os::release_memory(p, 4 * M); \/\/ Again, should fail\n@@ -698,1 +741,1 @@\n-  ASSERT_TRUE(os::release_memory((char*)p, total_range_len));\n+  os::release_memory((char*)p, total_range_len);\n@@ -702,1 +745,1 @@\n-    ASSERT_TRUE(os::release_memory((char*)p2, stripe_len));\n+    os::release_memory((char*)p2, stripe_len);\n@@ -775,1 +818,1 @@\n-    ASSERT_TRUE(os::release_memory((char*)p, total_range_len));\n+    os::release_memory((char*)p, total_range_len);\n@@ -804,1 +847,1 @@\n-  ASSERT_TRUE(os::release_memory((char*)p, total_range_len));\n+  os::release_memory((char*)p, total_range_len);\n@@ -1135,1 +1178,1 @@\n-  ASSERT_TRUE(os::uncommit_memory(base, size, false));\n+  os::uncommit_memory(base, size, false);\n@@ -1138,2 +1181,2 @@\n-  ASSERT_TRUE(os::uncommit_memory(base, size, false));\n-  EXPECT_TRUE(os::release_memory(base, size));\n+  os::uncommit_memory(base, size, false);\n+  os::release_memory(base, size);\n@@ -1155,1 +1198,1 @@\n-  EXPECT_TRUE(os::unmap_memory(result, size));\n+  os::unmap_memory(result, size);\n@@ -1172,1 +1215,1 @@\n-  EXPECT_TRUE(os::unmap_memory(result, size));\n+  os::unmap_memory(result, size);\n@@ -1187,1 +1230,1 @@\n-  EXPECT_TRUE(os::unmap_memory(result, os::vm_allocation_granularity()));\n+  os::unmap_memory(result, os::vm_allocation_granularity());\n","filename":"test\/hotspot\/gtest\/runtime\/test_os.cpp","additions":76,"deletions":33,"binary":false,"changes":109,"status":"modified"},{"patch":"@@ -382,2 +382,2 @@\n-  EXPECT_TRUE(os::uncommit_memory(heap, size, false));\n-  EXPECT_TRUE(os::release_memory(heap, size));\n+  os::uncommit_memory(heap, size, false);\n+  os::release_memory(heap, size);\n","filename":"test\/hotspot\/gtest\/runtime\/test_os_linux.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}