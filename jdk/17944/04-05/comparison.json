{"files":[{"patch":"@@ -871,6 +871,1 @@\n-\n-  if (java_lang_VirtualThread::is_instance(thread_oop)) {\n-    *thread_state_ptr = JvmtiEnvBase::get_vthread_state(thread_oop, java_thread);\n-  } else {\n-    *thread_state_ptr = JvmtiEnvBase::get_thread_state(thread_oop, java_thread);\n-  }\n+  *thread_state_ptr = JvmtiEnvBase::get_thread_or_vthread_state(thread_oop, java_thread);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnv.cpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -816,0 +816,11 @@\n+jint\n+JvmtiEnvBase::get_thread_or_vthread_state(oop thread_oop, JavaThread* java_thread) {\n+  jint state = 0;\n+  if (java_lang_VirtualThread::is_instance(thread_oop)) {\n+    state = JvmtiEnvBase::get_vthread_state(thread_oop, java_thread);\n+  } else {\n+    state = JvmtiEnvBase::get_thread_state(thread_oop, java_thread);\n+  }\n+  return state;\n+}\n+\n@@ -939,3 +950,1 @@\n-    bool is_virtual = java_lang_VirtualThread::is_instance(thread_oop);\n-    jint state = is_virtual ? JvmtiEnvBase::get_vthread_state(thread_oop, java_thread)\n-                            : JvmtiEnvBase::get_thread_state(thread_oop, java_thread);\n+    jint state = get_thread_or_vthread_state(thread_oop, java_thread);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -391,1 +391,1 @@\n-  \/\/ get virtual thread thread state\n+  \/\/ get virtual thread state\n@@ -394,0 +394,3 @@\n+  \/\/ get platform or virtual thread state\n+  static jint get_thread_or_vthread_state(oop thread_oop, JavaThread* jt);\n+\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"}]}