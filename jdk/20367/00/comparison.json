{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -998,0 +998,2 @@\n+    gdata->jvmti_data_dump = JNI_FALSE;\n+\n@@ -1162,0 +1164,9 @@\n+        } else if (strcmp(buf, \"datadump\") == 0) {\n+          \/\/ Allow enabling of JVMTI DATA_DUMP_REQUEST support.\n+          \/\/ This is not a documented flag. This feature is only intended to be used\n+          \/\/ by debug agent developers. It is advised that you launch the debuggee\n+          \/\/ with -XX:+StartAttachListener. Otherwise the attach listener may fail to\n+          \/\/ startup due to the Signal Dispatcher thread being suspended due to an event.\n+          if ( !get_boolean(&str, &(gdata->jvmti_data_dump)) ) {\n+                goto syntax_error;\n+            }\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/debugInit.c","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1390,3 +1390,1 @@\n-\/***** debugging *****\/\n-\n-#ifdef DEBUG\n+\/***** APIs for debugging the debug agent *****\/\n@@ -1479,2 +1477,0 @@\n-\n-#endif \/* DEBUG *\/\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/eventFilter.c","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,1 +79,1 @@\n-\/***** debugging *****\/\n+\/***** APIs for debugging the debug agent *****\/\n@@ -81,1 +81,0 @@\n-#ifdef DEBUG\n@@ -83,1 +82,0 @@\n-#endif\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/eventFilter.h","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1333,0 +1333,10 @@\n+\/* Event callback for JVMTI_EVENT_DATA_DUMP_REQUEST *\/\n+static void JNICALL\n+cbDataDump(jvmtiEnv *jvmti_env)\n+{\n+    tty_message(\"Debug Agent Data Dump\");\n+    tty_message(\"=====================\");\n+    threadControl_dumpAllThreads();\n+    eventHandler_dumpAllHandlers(JNI_TRUE);\n+}\n+\n@@ -1521,0 +1531,13 @@\n+\n+    \/*\n+     * DATA_DUMP_REQUEST is special since it is not tied to any handlers or an EI,\n+     * so it cannot be setup using threadControl_setEventMode(). Use JVMTI API directly.\n+     *\/\n+    if (gdata->jvmti_data_dump) {\n+        error = JVMTI_FUNC_PTR(gdata->jvmti,SetEventNotificationMode)\n+                (gdata->jvmti, JVMTI_ENABLE, JVMTI_EVENT_DATA_DUMP_REQUEST, NULL);\n+        if (error != JVMTI_ERROR_NONE) {\n+            EXIT_ERROR(error,\"Can't enable data dump request events\");\n+        }\n+    }\n+\n@@ -1583,0 +1606,2 @@\n+    \/* Event callback for JVMTI_EVENT_DATA_DUMP_REQUEST *\/\n+    gdata->callbacks.DataDumpRequest = &cbDataDump;\n@@ -1842,3 +1867,1 @@\n-\/***** debugging *****\/\n-\n-#ifdef DEBUG\n+\/***** APIs for debugging the debug agent *****\/\n@@ -1883,2 +1906,0 @@\n-\n-#endif \/* DEBUG *\/\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/eventHandler.c","additions":27,"deletions":6,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,1 +85,1 @@\n-\/***** debugging *****\/\n+\/***** APIs for debugging the debug agent *****\/\n@@ -87,1 +87,0 @@\n-#ifdef DEBUG\n@@ -91,1 +90,0 @@\n-#endif\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/eventHandler.h","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -140,5 +140,0 @@\n-#ifdef DEBUG\n-static void dumpThreadList(ThreadList *list);\n-static void dumpThread(ThreadNode *node);\n-#endif\n-\n@@ -2559,1 +2554,1 @@\n-\/***** debugging *****\/\n+\/***** APIs for debugging the debug agent *****\/\n@@ -2561,1 +2556,2 @@\n-#ifdef DEBUG\n+static void dumpThreadList(ThreadList *list);\n+static void dumpThread(ThreadNode *node);\n@@ -2566,0 +2562,1 @@\n+    tty_message(\"suspendAllCount: %d\", suspendAllCount);\n@@ -2650,2 +2647,0 @@\n-\n-#endif \/* DEBUG *\/\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/threadControl.c","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -79,1 +79,1 @@\n-\/***** debugging *****\/\n+\/***** APIs for debugging the debug agent *****\/\n@@ -81,1 +81,0 @@\n-#ifdef DEBUG\n@@ -84,1 +83,0 @@\n-#endif\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/threadControl.h","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1987,2 +1987,0 @@\n-#ifdef DEBUG\n-\n@@ -2043,2 +2041,0 @@\n-#endif\n-\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/util.c","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -93,0 +93,1 @@\n+    jboolean jvmti_data_dump; \/* If true, then support JVMTI DATA_DUMP_REQUEST events. *\/\n@@ -392,1 +393,0 @@\n-#ifdef DEBUG\n@@ -394,1 +394,0 @@\n-#endif\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/util.h","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}