{"files":[{"patch":"@@ -290,2 +290,6 @@\n-static bool is_valid_lane_type(int laneType) {\n-  return laneType >= T_FLOAT && laneType <= T_LONG;\n+static bool is_primitive_lane_type(int laneType) {\n+  return laneType >= T_FLOAT && laneType <= T_FLOAT16;\n+}\n+\n+static bool is_unsupported_lane_type(int laneType) {\n+  return laneType == T_FLOAT16;\n@@ -350,0 +354,5 @@\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** not a primitive lt=%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n+  }\n+\n@@ -532,1 +541,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -534,1 +543,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -537,3 +546,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -549,0 +557,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -629,6 +638,8 @@\n-  int num_elem = vlen->get_con();\n-  if (!is_valid_lane_type(laneType->get_con())) {\n-    if (C->print_intrinsics()) {\n-      tty->print_cr(\"  ** not a primitive lt=%s\", VectorSupport::lanetype2name(laneType->get_con()));\n-    }\n-    return false; \/\/ should be primitive type\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** not a primitive lt=%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n+  }\n+\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n@@ -637,0 +648,1 @@\n+  int num_elem = vlen->get_con();\n@@ -705,0 +717,4 @@\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** not a primitive lt=%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n+  }\n@@ -707,4 +723,3 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt) && bcast_mode != VectorSupport::MODE_BROADCAST) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n-    return false;\n+  if (is_unsupported_lane_type(laneType->get_con()) && bcast_mode != VectorSupport::MODE_BROADCAST) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false; \/\/ should be primitive type\n@@ -717,0 +732,1 @@\n+\n@@ -718,0 +734,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -844,0 +861,5 @@\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** not a primitive lt=%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n+  }\n+\n@@ -1038,0 +1060,5 @@\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** not a primitive lt=%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n+  }\n+\n@@ -1267,1 +1294,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -1269,1 +1296,6 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n+  }\n+\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n@@ -1449,1 +1481,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -1451,1 +1483,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -1454,3 +1486,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -1460,0 +1491,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -1598,1 +1630,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -1600,1 +1632,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -1603,3 +1635,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -1613,0 +1644,1 @@\n+\n@@ -1614,0 +1646,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -1676,1 +1709,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -1748,1 +1781,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -1750,1 +1783,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -1753,3 +1786,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -1765,0 +1797,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -1852,0 +1885,1 @@\n+\n@@ -1863,0 +1897,1 @@\n+\n@@ -1869,1 +1904,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -1871,1 +1906,6 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n+  }\n+\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n@@ -2002,1 +2042,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -2004,1 +2044,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -2007,3 +2047,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -2012,0 +2051,1 @@\n+\n@@ -2013,0 +2053,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -2168,1 +2209,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -2170,1 +2211,6 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n+  }\n+\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n@@ -2338,1 +2384,1 @@\n-  if (!is_valid_lane_type(laneType_from->get_con())) {\n+  if (!is_primitive_lane_type(laneType_from->get_con())) {\n@@ -2343,1 +2389,1 @@\n-  if (!is_valid_lane_type(laneType_to->get_con())) {\n+  if (!is_primitive_lane_type(laneType_to->get_con())) {\n@@ -2348,0 +2394,10 @@\n+  if (is_unsupported_lane_type(laneType_from->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType_from->get_con()));\n+    return false;\n+  }\n+\n+  if (is_unsupported_lane_type(laneType_to->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType_to->get_con()));\n+    return false;\n+  }\n+\n@@ -2516,1 +2572,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -2518,1 +2574,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -2521,3 +2577,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -2531,0 +2586,1 @@\n+\n@@ -2532,0 +2588,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -2607,1 +2664,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -2609,1 +2666,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -2612,3 +2669,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -2622,1 +2678,0 @@\n-  int num_elem = vlen->get_con();\n@@ -2624,0 +2679,2 @@\n+  int num_elem = vlen->get_con();\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -2795,1 +2852,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -2797,1 +2854,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -2800,3 +2857,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -2811,1 +2867,0 @@\n-\n@@ -2813,0 +2868,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -2938,1 +2994,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -2940,1 +2996,6 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n+  }\n+\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n+    return false;\n@@ -3012,1 +3073,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -3014,1 +3075,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -3017,3 +3078,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -3029,0 +3089,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n@@ -3151,1 +3212,1 @@\n-  if (!is_valid_lane_type(laneType->get_con())) {\n+  if (!is_primitive_lane_type(laneType->get_con())) {\n@@ -3153,1 +3214,1 @@\n-    return false; \/\/ should be primitive type\n+    return false;\n@@ -3156,3 +3217,2 @@\n-  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n-  if (!is_java_primitive(elem_bt)) {\n-    log_if_needed(\"  ** unhandled bt=%s\", type2name(elem_bt));\n+  if (is_unsupported_lane_type(laneType->get_con())) {\n+    log_if_needed(\"  ** unsupported lane type =%s\", VectorSupport::lanetype2name(laneType->get_con()));\n@@ -3167,1 +3227,0 @@\n-\n@@ -3169,0 +3228,1 @@\n+  BasicType elem_bt = get_vector_primitive_lane_type(laneType->get_con());\n","filename":"src\/hotspot\/share\/opto\/vectorIntrinsics.cpp","additions":136,"deletions":76,"binary":false,"changes":212,"status":"modified"}]}