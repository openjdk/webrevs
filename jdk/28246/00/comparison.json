{"files":[{"patch":"@@ -31,0 +31,2 @@\n+ * @requires vm.flavor == \"server\" & (vm.opt.TieredStopAtLevel == null | vm.opt.TieredStopAtLevel == 4)\n+ * @requires !vm.emulatedClient\n@@ -33,1 +35,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+SegmentedCodeCache\n@@ -58,2 +60,5 @@\n-        \/\/ Call function enough to compile\n-        callFunction();\n+        \/\/ Enqueue method for compilation and wait until it is done\n+        WHITE_BOX.enqueueMethodForCompilation(method, CompilerWhiteBoxTest.COMP_LEVEL_FULL_OPTIMIZATION);\n+        while (WHITE_BOX.isMethodQueuedForCompilation(method)) {\n+            Thread.onSpinWait();\n+        }\n@@ -94,7 +99,0 @@\n-    \/\/ Call function multiple times to trigger compilation\n-    private static void callFunction() {\n-        for (int i = 0; i < CompilerWhiteBoxTest.THRESHOLD; i++) {\n-            function();\n-        }\n-    }\n-\n","filename":"test\/hotspot\/jtreg\/compiler\/whitebox\/DeoptimizeRelocatedNMethod.java","additions":8,"deletions":10,"binary":false,"changes":18,"status":"modified"}]}