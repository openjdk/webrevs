{"files":[{"patch":"@@ -31,1 +31,1 @@\n-import java.util.*;\n+import java.util.List;\n@@ -42,15 +42,0 @@\n-\/**\n- * @test id=path-to-gc-roots-true-cutoff-inf\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx256M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots true infinity true\n- *\/\n-\/**\n- * @test id=path-to-gc-roots-true-cutoff-0\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx256M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots true 0 true\n- *\/\n-\n@@ -59,26 +44,2 @@\n- * @test id=path-to-gc-roots-true-cutoff-default\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx256M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots true - true\n- *\/\n-\n-\/**\n- * @test id=path-to-gc-roots-false-cutoff-inf\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx256M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots false infinity false\n- *\/\n-\n-\/**\n- * @test id=path-to-gc-roots-false-cutoff-0\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx256M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots false 0 false\n- *\/\n-\n-\/**\n- * @test id=path-to-gc-roots-false-cutoff-default\n- * @requires vm.hasJFR & vm.flagless\n+ * @summary Start a recording with or without path-to-gc-roots\n+ * @requires vm.hasJFR\n@@ -87,25 +48,3 @@\n- * @run main\/othervm -XX:TLABSize=2k -Xmx256M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots false - false\n- *\/\n-\n-\/**\n- * @test id=path-to-gc-roots-default-cutoff-inf\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx512M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots - infinity true\n- *\/\n-\n-\/**\n- * @test id=path-to-gc-roots-default-cutoff-0\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx512M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots - 0 false\n- *\/\n-\n-\/**\n- * @test id=path-to-gc-roots-default-cutoff-default\n- * @requires vm.hasJFR & vm.flagless\n- * @modules jdk.jfr\/jdk.jfr.internal.test\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:TLABSize=2k -Xmx512M -XX:ErrorLogTimeout=1 jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots - - false\n+ * @requires vm.flagless\n+ *\n+ * @run main\/othervm -XX:TLABSize=2k jdk.jfr.jcmd.TestJcmdDumpPathToGCRoots\n@@ -115,4 +54,2 @@\n-    \/\/ Comfortably large enough to saturate the 32M EdgeQueue in PathToGcRootsOperation\n-    \/\/ and thus exercise both BFS and DFS paths\n-    private static final int OBJECT_COUNT = 2_500_000;\n-    public static List<Object> leak = new ArrayList<>();\n+    private static final int OBJECT_COUNT = 100_000;\n+    public static List<Object[]> leak = new ArrayList<>(OBJECT_COUNT);\n@@ -123,4 +60,0 @@\n-        if (args.length != 3) {\n-            throw new RuntimeException(\"Expected 2 arguments\");\n-        }\n-\n@@ -129,15 +62,0 @@\n-        final String ptgcr =\n-            switch (args[0]) {\n-                case \"-\" -> \"\";\n-                default -> \"path-to-gc-roots=\" + args[0];\n-            };\n-\n-        final Map settings = switch (args[1]) {\n-            case \"infinity\" -> Collections.singletonMap(settingName, \"infinity\");\n-            case \"0\" -> Collections.singletonMap(settingName, \"0 ns\");\n-            case \"-\" -> Collections.emptyMap();\n-            default -> throw new RuntimeException(\"Invalid \" + args[1]);\n-        };\n-\n-        final boolean expectChains = Boolean.valueOf(args[2]);\n-\n@@ -145,1 +63,3 @@\n-        testDump(ptgcr, settings, expectChains);\n+        testDump(\"path-to-gc-roots=true\", Collections.singletonMap(settingName, \"infinity\"), true);\n+        testDump(\"path-to-gc-roots=true\", Collections.singletonMap(settingName, \"0 ns\"), true);\n+        testDump(\"path-to-gc-roots=true\", Collections.emptyMap(), true);\n@@ -147,0 +67,7 @@\n+        testDump(\"path-to-gc-roots=false\", Collections.singletonMap(settingName, \"infinity\"), false);\n+        testDump(\"path-to-gc-roots=false\", Collections.singletonMap(settingName, \"0 ns\"), false);\n+        testDump(\"path-to-gc-roots=false\", Collections.emptyMap(), false);\n+\n+        testDump(\"\", Collections.singletonMap(settingName, \"infinity\"), true);\n+        testDump(\"\", Collections.singletonMap(settingName, \"0 ns\"), false);\n+        testDump(\"\", Collections.emptyMap(), false);\n@@ -166,1 +93,1 @@\n-                File recording = new File(\"TestJcmdDumpPathToGCRoots.jfr\");\n+                File recording = new File(\"TestJcmdDumpPathToGCRoots\" + r.getId() + \".jfr\");\n@@ -207,7 +134,2 @@\n-        int chainlen = 10000;\n-        for (int i = 0; i < OBJECT_COUNT\/chainlen; i ++) {\n-            LinkedList<Object> l = new LinkedList();\n-            for (int j = 0; j < chainlen; j ++) {\n-                l.add(new Object());\n-            }\n-            leak.add(l);\n+        for (int i = 0; i < OBJECT_COUNT;i ++) {\n+            leak.add(new Object[0]);\n","filename":"test\/jdk\/jdk\/jfr\/jcmd\/TestJcmdDumpPathToGCRoots.java","additions":21,"deletions":99,"binary":false,"changes":120,"status":"modified"}]}