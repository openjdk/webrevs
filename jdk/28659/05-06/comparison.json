{"files":[{"patch":"@@ -100,1 +100,1 @@\n-    _depth = psi.d;\n+    _depth = psi.depth;\n@@ -120,2 +120,23 @@\n-      _depth++;\n-      pointee->oop_iterate(this);\n+      _depth++; \/\/ increase range for do_oop() to pick up\n+\n+      if (pointee->is_objArray()) {\n+        objArrayOop pointee_oa = (objArrayOop)pointee;\n+        const int len = pointee_oa->length();\n+        \/\/ since our stack items are larger than those of GC marking stacks,\n+        \/\/ we use a smaller stride\n+        const int stridelen = MAX2((uintx)1, ObjArrayMarkingStride \/ 2);\n+        const int begidx = psi.chunk * stridelen;\n+        const int endidx = MIN2(len, (psi.chunk + 1) * stridelen);\n+        if (endidx > begidx) {\n+          if (endidx < len) {\n+            ProbeStackItem psi2 = psi;\n+            psi2.chunk ++;\n+            _probe_stack.push(psi2);\n+tty->print_cr(\"adding cont task %u %d\", psi2.depth, psi2.chunk);\n+          }\n+          pointee_oa->oop_iterate_range(this, begidx, endidx);\n+        }\n+      } else {\n+        pointee->oop_iterate(this);\n+      }\n+\n@@ -159,1 +180,1 @@\n-    ProbeStackItem psi { UnifiedOopRef::encode_in_heap(ref), _depth };\n+    ProbeStackItem psi { UnifiedOopRef::encode_in_heap(ref), checked_cast<unsigned>(_depth), 0 };\n@@ -169,1 +190,1 @@\n-    ProbeStackItem psi { UnifiedOopRef::encode_in_heap(ref), _depth };\n+    ProbeStackItem psi { UnifiedOopRef::encode_in_heap(ref), checked_cast<unsigned>(_depth), 0 };\n@@ -178,1 +199,1 @@\n-  ProbeStackItem psi { ref, _depth };\n+  ProbeStackItem psi { ref, checked_cast<unsigned>(_depth), 0 };\n","filename":"src\/hotspot\/share\/jfr\/leakprofiler\/chains\/dfsClosure.cpp","additions":27,"deletions":6,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-  struct ProbeStackItem { UnifiedOopRef r; size_t d; };\n+  struct ProbeStackItem { UnifiedOopRef r; unsigned depth; int chunk; };\n","filename":"src\/hotspot\/share\/jfr\/leakprofiler\/chains\/dfsClosure.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}