{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,0 +125,11 @@\n+    public HeapRegion heapRegionForAddress(Address addr) {\n+        Iterator<HeapRegion> iter = heapRegionIterator();\n+        while (iter.hasNext()) {\n+            HeapRegion hr = iter.next();\n+            if (hr.isInRegion(addr)) {\n+                return hr;\n+            }\n+        }\n+        return null;\n+    }\n+\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/gc\/g1\/G1CollectedHeap.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -143,0 +143,4 @@\n+    public boolean isInRegion(Address addr) {\n+        return (addr.greaterThanOrEqual(bottom()) && addr.lessThan(end()));\n+    }\n+\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/gc\/g1\/HeapRegion.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+import sun.jvm.hotspot.gc.g1.*;\n@@ -107,2 +108,1 @@\n-        SerialHeap sh = (SerialHeap) heap;\n-        loc.heap = heap;\n+        SerialHeap sh = (SerialHeap)heap;\n@@ -122,0 +122,12 @@\n+      \/\/ If we are using the G1CollectedHeap, find out which region the address is in\n+      if (heap instanceof G1CollectedHeap) {\n+        G1CollectedHeap g1 = (G1CollectedHeap)heap;\n+        loc.hr = g1.heapRegionForAddress(a);\n+        \/\/ We don't assert that loc.hr is not null like we do for the SerialHeap. This is\n+        \/\/ because heap.isIn(a) can return true if the address is anywhere in G1's mapped\n+        \/\/ memory, even if that area of memory is not in use by a G1 HeapRegion. So there\n+        \/\/ may in fact be no HeapRegion for the address even though it is in the heap.\n+        \/\/ Leaving loc.hr == null in this case will result in PointerFinder saying that\n+        \/\/ the address is \"In unknown section of Java the heap\", which is what we want.\n+      }\n+\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/utilities\/PointerFinder.java","additions":14,"deletions":2,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import sun.jvm.hotspot.gc.g1.*;\n@@ -60,1 +61,2 @@\n-  Generation gen;\n+  Generation gen;  \/\/ Serial heap generation\n+  HeapRegion hr;   \/\/ G1 heap region\n@@ -126,1 +128,5 @@\n-      return gen;\n+    return gen; \/\/ SerialHeap generation\n+  }\n+\n+  public HeapRegion getHeapRegion() {\n+    return hr; \/\/ G1 heap region\n@@ -281,8 +287,4 @@\n-      } else {\n-        if (isInNewGen()) {\n-          tty.print(\"In new generation \");\n-        } else if (isInOldGen()) {\n-          tty.print(\"In old generation \");\n-        } else {\n-          tty.print(\"In unknown section of Java heap\");\n-        }\n+      }\n+      \/\/ This section provides details about where in the heap the address is located,\n+      \/\/ but we only want to do that if it is not in a TLAB or if verbose requested.\n+      if (!isInTLAB() || verbose) {\n@@ -290,1 +292,24 @@\n-          getGeneration().printOn(tty); \/\/ does not include \"\\n\"\n+          \/\/ Address is in SerialGC heap\n+          if (isInNewGen()) {\n+              tty.print(\"In new generation of SerialGC heap\");\n+          } else if (isInOldGen()) {\n+              tty.print(\"In old generation of SerialGC heap\");\n+          } else {\n+              tty.print(\"In unknown generation of SerialGC heap\");\n+          }\n+          if (verbose) {\n+              tty.print(\":\");\n+              getGeneration().printOn(tty); \/\/ does not include \"\\n\"\n+          }\n+          tty.println();\n+        } else if (getHeapRegion() != null) {\n+            \/\/ Address is in the G1 heap\n+            if (verbose) {\n+                tty.print(\"In G1 heap \");\n+                getHeapRegion().printOn(tty); \/\/ includes \"\\n\"\n+            } else {\n+                tty.println(\"In G1 heap region\");\n+            }\n+        } else {\n+            \/\/ Address is some other heap type that we haven't special cased yet.\n+            tty.println(\"In unknown section of the Java heap\");\n@@ -292,1 +317,0 @@\n-        tty.println();\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/utilities\/PointerLocation.java","additions":36,"deletions":12,"binary":false,"changes":48,"status":"modified"}]}