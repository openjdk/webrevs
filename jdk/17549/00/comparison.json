{"files":[{"patch":"@@ -26,0 +26,1 @@\n+import jdk.jfr.Recording;\n@@ -27,1 +28,1 @@\n-import jdk.jfr.consumer.RecordingStream;\n+import jdk.test.lib.jfr.Events;\n@@ -33,0 +34,1 @@\n+import java.io.IOException;\n@@ -39,1 +41,0 @@\n-import java.util.ArrayList;\n@@ -49,1 +50,1 @@\n- * @bug 8275338\n+ * @bug 8275338 8324220\n@@ -59,1 +60,1 @@\n-    private static final List<RecordedEvent> events = new ArrayList<>();\n+    private static List<RecordedEvent> events;\n@@ -62,5 +63,4 @@\n-    static void recordEvents() {\n-        try (var rs = new RecordingStream()) {\n-            rs.enable(SerializationMisdeclaration);\n-            rs.onEvent(SerializationMisdeclaration, events::add);\n-            rs.startAsync();\n+    static void recordEvents() throws IOException {\n+        try (Recording r = new Recording()) {\n+            r.enable(SerializationMisdeclaration);\n+            r.start();\n@@ -68,1 +68,2 @@\n-            rs.stop();\n+            r.stop();\n+            events = Events.fromRecording(r);\n","filename":"test\/jdk\/jdk\/jfr\/event\/io\/TestSerializationMisdeclarationEvent.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"}]}