{"files":[{"patch":"@@ -1424,0 +1424,2 @@\n+    private native boolean applyThemeIfNeeded();\n+\n@@ -1466,0 +1468,15 @@\n+\n+        if (IS_3) {\n+            boolean shouldApplyTheme = false;\n+            if (toolkit instanceof UNIXToolkit unixToolkit) {\n+                if (\"gnome\".equals(unixToolkit.getDesktop())) {\n+                    int gnomeShellVersion = unixToolkit.getGnomeShellMajorVersion();\n+                    shouldApplyTheme = gnomeShellVersion >= 47;\n+                }\n+            }\n+\n+            if (shouldApplyTheme && applyThemeIfNeeded()) {\n+                GTKEngine.INSTANCE.themeChanged();\n+                GTKIconFactory.resetIcons();\n+            }\n+        }\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKLookAndFeel.java","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -605,0 +605,3 @@\n+\n+            fp_g_settings_new = dl_symbol(\"g_settings_new\"); \/\/ since 2.26\n+            fp_g_settings_get_string = dl_symbol(\"g_settings_get_string\"); \/\/ since 2.26\n@@ -2990,0 +2993,31 @@\n+static gboolean apply_theme_if_needed() {\n+    if (!glib_version_2_68) {\n+        return FALSE;\n+    }\n+\n+    GSettings *settings = fp_g_settings_new(\"org.gnome.desktop.interface\");\n+    if (!settings) {\n+        return FALSE;\n+    }\n+\n+    static gboolean wasDark = FALSE;\n+\n+    gchar *scheme = fp_g_settings_get_string(settings, \"color-scheme\");\n+    const gboolean isDark = strcmp(scheme, \"prefer-dark\") == 0;\n+\n+    fp_g_free(scheme);\n+    fp_g_object_unref(settings);\n+\n+    if (wasDark ^ isDark) {\n+        GtkSettings* gtkSettings = fp_gtk_settings_get_default();\n+        if (!gtkSettings) {\n+            return FALSE;\n+        }\n+        fp_g_object_set(gtkSettings, \"gtk-application-prefer-dark-theme\", isDark, NULL);\n+        wasDark = isDark;\n+        return TRUE;\n+    }\n+\n+    return FALSE;\n+}\n+\n@@ -2999,0 +3033,2 @@\n+    gtk->apply_theme_if_needed = &apply_theme_if_needed;\n+\n","filename":"src\/java.desktop\/unix\/native\/libawt_xawt\/awt\/gtk3_interface.c","additions":36,"deletions":0,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -196,0 +196,1 @@\n+typedef void GSettings;\n@@ -636,0 +637,4 @@\n+\n+static GSettings *(*fp_g_settings_new)(const gchar *schema_id);\n+static gchar *(*fp_g_settings_get_string)(GSettings *settings, const gchar *key);\n+\n","filename":"src\/java.desktop\/unix\/native\/libawt_xawt\/awt\/gtk3_interface.h","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -544,0 +544,2 @@\n+    gboolean (*apply_theme_if_needed)();\n+\n","filename":"src\/java.desktop\/unix\/native\/libawt_xawt\/awt\/gtk_interface.h","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -391,0 +391,14 @@\n+\n+\/*\n+ * Class:     com_sun_java_swing_plaf_gtk_GTKLookAndFeel\n+ * Method:    applyThemeIfNeeded\n+ * Signature: ()Z\n+ *\/\n+JNIEXPORT jboolean JNICALL\n+Java_com_sun_java_swing_plaf_gtk_GTKLookAndFeel_applyThemeIfNeeded(JNIEnv *env, jobject this) {\n+    gtk->gdk_threads_enter();\n+    const gboolean result = gtk->apply_theme_if_needed();\n+    gtk->gdk_threads_leave();\n+\n+    return result;\n+}\n","filename":"src\/java.desktop\/unix\/native\/libawt_xawt\/awt\/swing_GTKEngine.c","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"}]}