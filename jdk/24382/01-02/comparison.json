{"files":[{"patch":"@@ -2024,3 +2024,12 @@\n-template<typename T, BasicType B>\n-const Type* reverse_bytes(const Node* node, PhaseGVN* phase) {\n-  const Type* type = phase->type(node->in(1));\n+const Type* reverse_bytes(int opcode, const Type* con) {\n+  switch (opcode) {\n+    case Op_ReverseBytesS:  return TypeInt::make(byteswap(checked_cast<jshort>(con->is_int()->get_con())));\n+    case Op_ReverseBytesUS: return TypeInt::make(byteswap(checked_cast<jchar>(con->is_int()->get_con())));\n+    case Op_ReverseBytesI:  return TypeInt::make(byteswap(checked_cast<jint>(con->is_int()->get_con())));\n+    case Op_ReverseBytesL:  return TypeLong::make(byteswap(checked_cast<jlong>(con->is_long()->get_con())));\n+    default: ShouldNotReachHere();\n+  }\n+}\n+\n+const Type* ReverseBytesNode::Value(PhaseGVN* phase) const {\n+  const Type* type = phase->type(in(1));\n@@ -2030,4 +2039,2 @@\n-  const TypeInteger* typeInteger = type->isa_integer(B);\n-  if (typeInteger != nullptr && typeInteger->is_con()) {\n-    const T res = byteswap<T>(static_cast<T>(typeInteger->get_con_as_long(B)));\n-    return TypeInteger::make(res, B);\n+  if (type->singleton()) {\n+    return reverse_bytes(Opcode(), type);\n@@ -2035,17 +2042,1 @@\n-  return node->bottom_type();\n-}\n-\n-const Type* ReverseBytesINode::Value(PhaseGVN* phase) const {\n-  return reverse_bytes<jint, T_INT>(this, phase);\n-}\n-\n-const Type* ReverseBytesSNode::Value(PhaseGVN* phase) const {\n-  return reverse_bytes<jshort, T_INT>(this, phase);\n-}\n-\n-const Type* ReverseBytesUSNode::Value(PhaseGVN* phase) const {\n-  return reverse_bytes<jchar, T_INT>(this, phase);\n-}\n-\n-const Type* ReverseBytesLNode::Value(PhaseGVN* phase) const {\n-  return reverse_bytes<jlong, T_LONG>(this, phase);\n+  return bottom_type();\n","filename":"src\/hotspot\/share\/opto\/subnode.cpp","additions":15,"deletions":24,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -564,0 +564,6 @@\n+\n+class ReverseBytesNode : public InvolutionNode {\n+public:\n+  ReverseBytesNode(Node* in) : InvolutionNode(in) {}\n+  virtual const Type* Value(PhaseGVN* phase) const;\n+};\n@@ -566,1 +572,1 @@\n-class ReverseBytesINode : public InvolutionNode {\n+class ReverseBytesINode : public ReverseBytesNode {\n@@ -568,1 +574,3 @@\n-  ReverseBytesINode(Node* in) : InvolutionNode(in) {}\n+  ReverseBytesINode(Node* in) : ReverseBytesNode(in) {\n+  }\n+\n@@ -572,1 +580,0 @@\n-  virtual const Type* Value(PhaseGVN* phase) const;\n@@ -577,1 +584,1 @@\n-class ReverseBytesLNode : public InvolutionNode {\n+class ReverseBytesLNode : public ReverseBytesNode {\n@@ -579,1 +586,1 @@\n-  ReverseBytesLNode(Node* in) : InvolutionNode(in) {}\n+  ReverseBytesLNode(Node* in) : ReverseBytesNode(in) {}\n@@ -583,1 +590,0 @@\n-  virtual const Type* Value(PhaseGVN* phase) const;\n@@ -588,1 +594,1 @@\n-class ReverseBytesUSNode : public InvolutionNode {\n+class ReverseBytesUSNode : public ReverseBytesNode {\n@@ -590,1 +596,1 @@\n-  ReverseBytesUSNode(Node* in1) : InvolutionNode(in1) {}\n+  ReverseBytesUSNode(Node* in1) : ReverseBytesNode(in1) {}\n@@ -594,1 +600,0 @@\n-  virtual const Type* Value(PhaseGVN* phase) const;\n@@ -599,1 +604,1 @@\n-class ReverseBytesSNode : public InvolutionNode {\n+class ReverseBytesSNode : public ReverseBytesNode {\n@@ -601,1 +606,1 @@\n-  ReverseBytesSNode(Node* in) : InvolutionNode(in) {}\n+  ReverseBytesSNode(Node* in) : ReverseBytesNode(in) {}\n@@ -605,1 +610,0 @@\n-  virtual const Type* Value(PhaseGVN* phase) const;\n","filename":"src\/hotspot\/share\/opto\/subnode.hpp","additions":16,"deletions":12,"binary":false,"changes":28,"status":"modified"}]}