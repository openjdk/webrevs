{"files":[{"patch":"@@ -32,0 +32,4 @@\n+import java.io.File;\n+import java.io.IOException;\n+\n+import javax.imageio.ImageIO;\n@@ -50,1 +54,1 @@\n- * @build SwingTestHelper\n+ * @build SwingTestHelper Util\n@@ -63,2 +67,1 @@\n-            throw new SkippedException(\"GTK LAF is not supported on this system;\" +\n-                    \" test passes\");\n+            throw new SkippedException(\"GTK LAF is not supported on this system\");\n@@ -116,1 +119,1 @@\n-    private void onBackgroundThread20() {\n+    private void onEDT20() {\n@@ -122,4 +125,2 @@\n-            Point loc = ref.getLocationOnScreen();\n-            Rectangle refRect =\n-                new Rectangle(loc.x, loc.y, ref.getWidth(), ref.getHeight());\n-            BufferedImage refimg = robot.createScreenCapture(refRect);\n+            Rectangle refRect = new Rectangle(ref.getLocationOnScreen(), ref.getSize());\n+            BufferedImage refImg = robot.createScreenCapture(refRect);\n@@ -130,11 +131,8 @@\n-                loc = test.getLocationOnScreen();\n-                Rectangle testRect =\n-                    new Rectangle(loc.x, loc.y,\n-                                  test.getWidth(), test.getHeight());\n-                BufferedImage testimg = robot.createScreenCapture(testRect);\n-\n-                if (refimg.getWidth() != testimg.getWidth()\n-                   || refimg.getHeight() != testimg.getHeight())\n-                {\n-                    fail(\"Test image size must match reference image size\");\n-                }\n+                Rectangle testRect = new Rectangle(test.getLocationOnScreen(), test.getSize());\n+                BufferedImage testImg = robot.createScreenCapture(testRect);\n+\n+                if (!Util.compareBufferedImages(refImg, testImg)) {\n+                    try {\n+                        ImageIO.write(refImg, \"png\", new File(\"refImg.png\"));\n+                        ImageIO.write(testImg, \"png\", new File(\"testImg.png\"));\n+                    } catch (IOException ignored) {}\n@@ -142,9 +140,1 @@\n-                for (int y = 0; y < refimg.getHeight(); y++) {\n-                    for (int x = 0; x < refimg.getWidth(); x++) {\n-                        int refPixel  = refimg.getRGB(x, y);\n-                        int testPixel = testimg.getRGB(x, y);\n-                        if (refPixel != testPixel) {\n-                            fail(\"Image comparison failed at (\" +\n-                                 x + \",\" + y + \") for image \" + index);\n-                        }\n-                    }\n+                    fail(\"Image comparison failed for images at index \" + count + \" and \" + index);\n","filename":"test\/jdk\/com\/sun\/java\/swing\/plaf\/gtk\/bug6492108.java","additions":18,"deletions":28,"binary":false,"changes":46,"status":"modified"}]}