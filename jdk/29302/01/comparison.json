{"files":[{"patch":"@@ -274,3 +274,1 @@\n-     *     mode = NOPARAMS    : no parameters allowed for type\n-     *     mode = TYPEARG     : type argument\n-     *     mode |= NOLAMBDA   : lambdas are not allowed\n+     *     mode = NOLAMBDA    : lambdas are not allowed\n@@ -280,4 +278,1 @@\n-    protected static final int NOPARAMS      = 1 << 2;\n-    protected static final int TYPEARG       = 1 << 3;\n-    protected static final int DIAMOND       = 1 << 4;\n-    protected static final int NOLAMBDA      = 1 << 5;\n+    protected static final int NOLAMBDA      = 1 << 2;\n@@ -1443,1 +1438,1 @@\n-            if (isMode(TYPE) && isMode(TYPEARG) && !isMode(NOPARAMS)) {\n+            if (isMode(TYPE)) {\n@@ -1525,1 +1520,1 @@\n-                if (token.kind == LT) typeArgs = typeArguments(false);\n+                if (token.kind == LT) typeArgs = typeArguments();\n@@ -1628,1 +1623,0 @@\n-                        setMode(mode & ~NOPARAMS);\n@@ -1656,1 +1650,1 @@\n-                                if (token.kind == LT) typeArgs = typeArguments(false);\n+                                if (token.kind == LT) typeArgs = typeArguments();\n@@ -1707,1 +1701,1 @@\n-                                t = typeArgumentsOpt(t);\n+                                t = typeApplyOpt(t);\n@@ -1724,1 +1718,1 @@\n-            t = typeArgumentsOpt(t);\n+            t = typeApplyOpt(t);\n@@ -1883,1 +1877,1 @@\n-                    if (token.kind == LT) typeArgs = typeArguments(false);\n+                    if (token.kind == LT) typeArgs = typeArguments();\n@@ -1903,1 +1897,1 @@\n-                    t = argumentsOpt(typeArgs, typeArgumentsOpt(t));\n+                    t = argumentsOpt(typeArgs, typeApplyOpt(t));\n@@ -2305,1 +2299,1 @@\n-            typeArgs = (token.kind == LT) ? typeArguments(false) : null;\n+            typeArgs = (token.kind == LT) ? typeArguments() : null;\n@@ -2376,1 +2370,1 @@\n-    JCExpression typeArgumentsOpt(JCExpression t) {\n+    JCExpression typeApplyOpt(JCExpression t) {\n@@ -2378,2 +2372,1 @@\n-            isMode(TYPE) &&\n-            !isMode(NOPARAMS)) {\n+            isMode(TYPE)) {\n@@ -2381,1 +2374,1 @@\n-            return typeArguments(t, false);\n+            return typeApply(t);\n@@ -2392,2 +2385,1 @@\n-            if (!isMode(useMode) ||\n-                isMode(NOPARAMS)) {\n+            if (!isMode(useMode)) {\n@@ -2397,1 +2389,1 @@\n-            return typeArguments(false);\n+            return typeArguments();\n@@ -2407,1 +2399,1 @@\n-    List<JCExpression> typeArguments(boolean diamondAllowed) {\n+    List<JCExpression> typeArguments() {\n@@ -2410,2 +2402,3 @@\n-            if (token.kind == GT && diamondAllowed) {\n-                setMode(mode | DIAMOND);\n+            ListBuffer<JCExpression> args = new ListBuffer<>();\n+            args.append(!isMode(EXPR) ? typeArgument() : parseType());\n+            while (token.kind == COMMA) {\n@@ -2413,3 +2406,0 @@\n-                return List.nil();\n-            } else {\n-                ListBuffer<JCExpression> args = new ListBuffer<>();\n@@ -2417,5 +2407,2 @@\n-                while (token.kind == COMMA) {\n-                    nextToken();\n-                    args.append(!isMode(EXPR) ? typeArgument() : parseType());\n-                }\n-                switch (token.kind) {\n+            }\n+            switch (token.kind) {\n@@ -2423,12 +2410,10 @@\n-                case GTGTGTEQ: case GTGTEQ: case GTEQ:\n-                case GTGTGT: case GTGT:\n-                    token = S.split();\n-                    break;\n-                case GT:\n-                    nextToken();\n-                    break;\n-                default:\n-                    args.append(syntaxError(token.pos, Errors.Expected2(GT, COMMA)));\n-                    break;\n-                }\n-                return args.toList();\n+            case GTGTGTEQ: case GTGTEQ: case GTEQ:\n+            case GTGTGT: case GTGT:\n+                token = S.split();\n+                break;\n+            case GT:\n+                nextToken();\n+                break;\n+            default:\n+                args.append(syntaxError(token.pos, Errors.Expected2(GT, COMMA)));\n+                break;\n@@ -2436,0 +2421,1 @@\n+            return args.toList();\n@@ -2483,1 +2469,1 @@\n-    JCTypeApply typeArguments(JCExpression t, boolean diamondAllowed) {\n+    JCTypeApply typeApply(JCExpression t) {\n@@ -2485,1 +2471,1 @@\n-        List<JCExpression> args = typeArguments(diamondAllowed);\n+        List<JCExpression> args = typeArguments();\n@@ -2489,0 +2475,11 @@\n+    JCTypeApply typeApplyOrDiamond(JCExpression t) {\n+        if (peekToken(GT)) {\n+            int pos = token.pos;\n+            accept(LT);\n+            accept(GT);\n+            return toP(F.at(pos).TypeApply(t, List.nil()));\n+        } else {\n+            return typeApply(t);\n+        }\n+    }\n+\n@@ -2588,1 +2585,1 @@\n-            typeArgs = typeArguments(false);\n+            typeArgs = typeArguments();\n@@ -2625,1 +2622,0 @@\n-        boolean diamondFound = false;\n@@ -2629,2 +2625,1 @@\n-            t = typeArguments(t, true);\n-            diamondFound = isMode(DIAMOND);\n+            t = typeApplyOrDiamond(t);\n@@ -2633,1 +2628,1 @@\n-            if (diamondFound) {\n+            if (TreeInfo.isDiamond(t)) {\n@@ -2648,2 +2643,1 @@\n-                t = typeArguments(t, true);\n-                diamondFound = isMode(DIAMOND);\n+                t = typeApplyOrDiamond(t);\n@@ -2660,1 +2654,1 @@\n-            if (diamondFound) {\n+            if (TreeInfo.isDiamond(t)) {\n@@ -2705,1 +2699,1 @@\n-            t = typeArguments(t, true);\n+            t = typeApplyOrDiamond(t);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/parser\/JavacParser.java","additions":51,"deletions":57,"binary":false,"changes":108,"status":"modified"}]}