{"files":[{"patch":"@@ -779,1 +779,0 @@\n-  char for_this_node[50];\n@@ -784,0 +783,1 @@\n+    ASSERT_EQ(node.key(), (VMATree::position)et.nodes[i]) << \"at line \" << line_no;\n@@ -791,2 +791,3 @@\n-\n-    snprintf(for_this_node, sizeof(for_this_node), \"test at line: %d, for node: %d\", line_no, et.nodes[i]);\n+    stringStream ss(50);\n+    ss.print(\"test at line: %d, for node: %d\", line_no, et.nodes[i]);\n+    const char* for_this_node = ss.base();\n@@ -876,1 +877,1 @@\n-    tree.commit_mapping(0, 20, call_stack_2, true); \/\/ commit at the begin of the region\n+    tree.commit_mapping(0, 20, call_stack_2, true); \/\/ commit at the beginning of the region\n@@ -1066,0 +1067,1 @@\n+  SIndex si_3 = si[2];\n@@ -1074,0 +1076,2 @@\n+  VMATree::RegionData call_stack_2_mtNone(si_2, mtNone);\n+  VMATree::RegionData call_stack_3(si_3, mtTest);\n@@ -1085,0 +1089,1 @@\n+    \/\/ Request:               100--------------------------------250\n@@ -1107,0 +1112,1 @@\n+    \/\/ Request:               100********************************250\n@@ -1132,1 +1138,2 @@\n-    \/\/ Post: ........0--------100--------------------------------250--------300********400........\n+    \/\/ Request:               100--------------------------------250\n+    \/\/ Post: ........0--------100????????????????200?????????????250--------300********400........\n@@ -1154,0 +1161,1 @@\n+    \/\/ Request:               100................................250\n@@ -1176,0 +1184,1 @@\n+    \/\/ Request:               100--------------------------------250\n@@ -1198,0 +1207,1 @@\n+    \/\/ Request:               100********************************250\n@@ -1210,1 +1220,1 @@\n-  { \/\/ Do 'Uncommit' for a reserved region\n+  { \/\/ Do 'Uncommit' over two different reserved regions\n@@ -1216,1 +1226,1 @@\n-    tree.reserve_mapping(100, 100, call_stack_1);\n+    tree.reserve_mapping(100, 100, call_stack_2);\n@@ -1220,11 +1230,12 @@\n-    \/\/ Post: ........0--------100--------------------------------250--------300********400........\n-    \/\/        mtNone   mtTest                 mtTest                 mtTest     mtTest     mtNone\n-    \/\/        Rl       Rs                     Rs                     Rs         C          Rl\n-    \/\/        -        si_1                   si_1                   si_1       si_1       -\n-    \/\/        -        -                      -                      -          si_1       -\n-    ExpectedTree<5> et = {{     0,    100,    250,    300,    400         },\n-                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtNone },\n-                          {Rl    , Rs    , Rs    , Rs    , C     , Rl     },\n-                          {-1    , si_1  , si_1  , si_1  , si_1  , -1     },\n-                          {-1    , -1    , -1    , -1    , si_1  , -1     }};\n-    check_tree(tree, et, __LINE__);\n+    \/\/ Request:               100--------------------------------250\n+    \/\/ Post: ........0--------100----------------200-------------250--------300********400........\n+    \/\/        mtNone   mtTest        mtTest             mtTest       mtTest     mtTest     mtNone\n+    \/\/        Rl       Rs            Rs                 Rs           Rs         C          Rl\n+    \/\/        -        si_1          si_2               si_1         si_1       si_1       -\n+    \/\/        -        -             -                  -            -          si_1       -\n+    ExpectedTree<6> et = {{     0,    100,    200,    250,    300,    400         },\n+                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , Rs    , Rs    , Rs    , C     , Rl     },\n+                          {-1    , si_1  , si_2  , si_1  , si_1  , si_1  , -1     },\n+                          {-1    , -1    , -1    , -1    , -1    , si_1  , -1     }};\n+    if (ok_to_run) check_tree(tree, et, __LINE__);\n@@ -1242,0 +1253,1 @@\n+    \/\/ Request:               100................................250\n@@ -1263,0 +1275,1 @@\n+    \/\/ Request:               100--------------------------------250\n@@ -1284,0 +1297,1 @@\n+    \/\/ Request:               100********************************250\n@@ -1304,11 +1318,12 @@\n-    \/\/ Pre:  ........0--------100****************200------------------------300********400........\n-    \/\/ Post: ........0--------100--------------------------------250--------300********400........\n-    \/\/        mtNone   mtTest                 mtTest                 mtTest     mtTest     mtNone\n-    \/\/        Rl       Rs                     Rs                     Rs         C          Rl\n-    \/\/        -        si_1                   si_1                   si_1       si_1       -\n-    \/\/        -        -                      -                      -          si_1       -\n-    ExpectedTree<5> et = {{     0,    100,    250,    300,    400         },\n-                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtNone },\n-                          {Rl    , Rs    , Rs    , Rs    , C     , Rl     },\n-                          {-1    , si_1  , si_1  , si_1  , si_1  , -1     },\n-                          {-1    , -1    , -1    , -1    , si_1  , -1     }};\n+    \/\/ Pre:  ........0--------100****************200------------------300********400........\n+    \/\/ Request:               100--------------------------250\n+    \/\/ Post: ........0------------------------------------------------300********400........\n+    \/\/        mtNone                    mtTest                            mtTest     mtNone\n+    \/\/        Rl                        Rs                                C          Rl\n+    \/\/        -                         si_1                              si_1       -\n+    \/\/        -                         -                                 si_1       -\n+    ExpectedTree<3> et = {{     0,    300,    400         },\n+                          {mtNone, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , C     , Rl     },\n+                          {-1    , si_1  , si_1  , -1     },\n+                          {-1    , -1    , si_1  , -1     }};\n@@ -1326,0 +1341,1 @@\n+    \/\/ Request:               100................................250\n@@ -1345,0 +1361,1 @@\n+  SIndex si_3 = si[2];\n@@ -1353,0 +1370,1 @@\n+  VMATree::RegionData call_stack_3(si_3, mtTest);\n@@ -1364,0 +1382,1 @@\n+    \/\/ Request:                          150----------------250\n@@ -1386,0 +1405,1 @@\n+    \/\/ Request:                          150****************250\n@@ -1410,0 +1430,1 @@\n+    \/\/ Request:                          150----------------250\n@@ -1431,11 +1452,12 @@\n-    \/\/ Pre:  ........0--------100................200-----------------------300********400........\n-    \/\/ Post: ........0--------100........150................250------------300********400........\n-    \/\/        mtNone   mtTest     mtNone         mtNone           mtTest       mtTest     mtNone\n-    \/\/        Rl       Rs         Rl             Rl               Rs           C          Rl\n-    \/\/        -        si_1       -              -                si_1         si_1       -\n-    \/\/        -        -          -              -                -            si_1       -\n-    ExpectedTree<6> et = {{     0,    100,    150,    250,    300,   400          },\n-                          {mtNone, mtTest, mtNone, mtNone, mtTest, mtTest, mtNone },\n-                          {Rl    , Rs    , Rl     , Rl   , Rs    , C     , Rl     },\n-                          {-1    , si_1  , -1     , -1   , si_1  , si_1  , -1     },\n-                          {-1    , -1    , -1     , -1   , -1    , si_1  , -1     }};\n+    \/\/ Pre:  ........0--------100................200--------------------300********400........\n+    \/\/ Request:                           150............250\n+    \/\/ Post: ........0--------100........................250------------300********400........\n+    \/\/        mtNone   mtTest             mtNone               mtTest       mtTest     mtNone\n+    \/\/        Rl       Rs                 Rl                   Rs           C          Rl\n+    \/\/        -        si_1               -                    si_1         si_1       -\n+    \/\/        -        -                  -                    -            si_1       -\n+    ExpectedTree<5> et = {{     0,    100,    250,    300,   400          },\n+                          {mtNone, mtTest,  mtNone, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    ,  Rl   , Rs    , C     , Rl     },\n+                          {-1    , si_1  ,  -1   , si_1  , si_1  , -1     },\n+                          {-1    , -1    ,  -1   , -1    , si_1  , -1     }};\n@@ -1450,1 +1472,1 @@\n-    tree.reserve_mapping(100, 100, call_stack_1);\n+    tree.reserve_mapping(100, 100, call_stack_3);\n@@ -1454,0 +1476,1 @@\n+    \/\/ Request:                          150----------------250\n@@ -1457,1 +1480,1 @@\n-    \/\/        -        si_1       si_1           si_2             si_1         si_1       -\n+    \/\/        -        si_1       si_3           si_2             si_1         si_1       -\n@@ -1462,1 +1485,1 @@\n-                          {-1    , si_1  , si_1  , si_2  , si_1  , si_1  , -1     },\n+                          {-1    , si_1  , si_3  , si_2  , si_1  , si_1  , -1     },\n@@ -1466,1 +1489,1 @@\n-  { \/\/ Do 'Commit' for a reserved region\n+  { \/\/ Do 'Commit' over two different reserved regions\n@@ -1472,1 +1495,1 @@\n-    tree.reserve_mapping(100, 100, call_stack_1);\n+    tree.reserve_mapping(100, 100, call_stack_3);\n@@ -1475,12 +1498,15 @@\n-    \/\/ Pre:  ........0--------100----------------200-----------------------300********400........\n-    \/\/ Post: ........0--------100--------150****************250------------300********400........\n-    \/\/        mtNone   mtTest     mtTest         mtTest           mtTest       mtTest     mtNone\n-    \/\/        Rl       Rs         Rs             C                Rs           C          Rl\n-    \/\/        -        si_1       si_1           si_1             si_1         si_1       -\n-    \/\/        -        -          -              si_2             -            si_1       -\n-    ExpectedTree<6> et = {{     0,    100,    150,    250,    300,   400          },\n-                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtTest, mtNone },\n-                          {Rl    , Rs    , Rs    , C     , Rs    , C     , Rl     },\n-                          {-1    , si_1  , si_1  , si_1  , si_1  , si_1  , -1     },\n-                          {-1    , -1    , -1    , si_2  , -1    , si_1  , -1     }};\n-    check_tree(tree, et, __LINE__);\n+    \/\/ Pre:  ........0--------100-------------------200--------------------300********400........\n+    \/\/                   si_1         si_3                  si_1                si_1\n+    \/\/\n+    \/\/ Request:                          150*******************250\n+    \/\/ Post: ........0--------100--------150********200********250---------300********400........\n+    \/\/        mtNone   mtTest     mtTest     mtTest     mtTest      mtTest     mtTest     mtNone\n+    \/\/        Rl       Rs         Rs         C          C           Rs         C          Rl\n+    \/\/        -        si_1       si_3       si_3       si_1        si_1       si_1       -\n+    \/\/        -        -          -          si_2       si_2        -          si_1       -\n+    ExpectedTree<7> et = {{     0,    100,    150,    200,    250,    300,   400          },\n+                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , Rs    , C     , C     , Rs    , C     , Rl     },\n+                          {-1    , si_1  , si_3  , si_3  , si_1  , si_1  , si_1  , -1     },\n+                          {-1    , -1    , -1    , si_2  , si_2  , -1    , si_1  , -1     }};\n+    if (ok_to_run) check_tree(tree, et, __LINE__);\n@@ -1488,1 +1514,1 @@\n-  { \/\/ Do 'Uncommit' for a reserved region\n+  { \/\/ Do 'Uncommit' over two different reserved regions\n@@ -1494,1 +1520,1 @@\n-    tree.reserve_mapping(100, 100, call_stack_1);\n+    tree.reserve_mapping(100, 100, call_stack_2);\n@@ -1498,11 +1524,14 @@\n-    \/\/ Post: ........0--------100--------150----------------250------------300********400........\n-    \/\/        mtNone   mtTest     mtTest         mtTest           mtTest       mtTest     mtNone\n-    \/\/        Rl       Rs         Rs             Rs               Rs           C          Rl\n-    \/\/        -        si_1       si_1           si_1             si_1         si_1       -\n-    \/\/        -        -          -              -                -            si_1       -\n-    ExpectedTree<6> et = {{     0,    100,    150,    250,    300,   400          },\n-                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtTest, mtNone },\n-                          {Rl    , Rs    , Rs    , Rs    , Rs    , C     , Rl     },\n-                          {-1    , si_1  , si_1  , si_1  , si_1  , si_1  , -1     },\n-                          {-1    , -1    , -1    , -1    , -1    , si_1  , -1     }};\n-    check_tree(tree, et, __LINE__);\n+    \/\/                  si_1          si_2                 si_1                  si_1\n+    \/\/\n+    \/\/ Reqquest:                      150-------------------250\n+    \/\/ Pre:  ........0--------100----------------200-----------------------300********400........\n+    \/\/        mtNone   mtTest        mtTest                mtTest              mtTest     mtNone\n+    \/\/        Rl       Rs            Rs                    Rs                  C          Rl\n+    \/\/        -        si_1          si_2                  si_1                si_1       -\n+    \/\/        -        -             -                     -                   si_1       -\n+    ExpectedTree<5> et = {{     0,    100,    200,    300,   400          },\n+                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , Rs    , Rs    , C     , Rl     },\n+                          {-1    , si_1  , si_2  , si_1  , si_1  , -1     },\n+                          {-1    , -1    , -1    , -1    , si_1  , -1     }};\n+    if (ok_to_run) check_tree(tree, et, __LINE__);\n@@ -1516,1 +1545,1 @@\n-    tree.reserve_mapping(100, 100, call_stack_1);\n+    tree.reserve_mapping(100, 100, call_stack_2);\n@@ -1520,0 +1549,1 @@\n+    \/\/ Request:                          150................250\n@@ -1523,1 +1553,1 @@\n-    \/\/        -        si_1       si_1           -                si_1         si_1       -\n+    \/\/        -        si_1       si_2           -                si_1         si_1       -\n@@ -1528,1 +1558,1 @@\n-                          {-1    , si_1  , si_1  , -1    , si_1  , si_1  , -1     },\n+                          {-1    , si_1  , si_2  , -1    , si_1  , si_1  , -1     },\n@@ -1541,0 +1571,1 @@\n+    \/\/ Request:                          150----------------250\n@@ -1562,0 +1593,1 @@\n+    \/\/ Request:                          150****************250\n@@ -1582,11 +1614,12 @@\n-    \/\/ Pre:  ........0--------100****************200-----------------------300********400........\n-    \/\/ Post: ........0--------100********150----------------250------------300********400........\n-    \/\/        mtNone   mtTest     mtTest         mtTest           mtTest       mtTest     mtNone\n-    \/\/        Rl       Rs         C              Rs               Rs           C          Rl\n-    \/\/        -        si_1       si_1           si_1             si_1         si_1       -\n-    \/\/        -        -          si_1           -                -            si_1       -\n-    ExpectedTree<6> et = {{     0,    100,    150,    250,    300,   400          },\n-                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtTest, mtNone },\n-                          {Rl    , Rs    , C     , Rs    , Rs    , C     , Rl     },\n-                          {-1    , si_1  , si_1  , si_1  , si_1  , si_1  , -1     },\n-                          {-1    , -1    , si_1  , -1    , -1    , si_1  , -1     }};\n+    \/\/ Pre:  ........0--------100*******************200--------------------300********400........\n+    \/\/ Request:                          150--------------------250\n+    \/\/ Post: ........0--------100********150-------------------------------300********400........\n+    \/\/        mtNone   mtTest     mtTest                mtTest                 mtTest     mtNone\n+    \/\/        Rl       Rs         C                     Rs                     C          Rl\n+    \/\/        -        si_1       si_1                  si_1                   si_1       -\n+    \/\/        -        -          si_1                  -                      si_1       -\n+    ExpectedTree<5> et = {{     0,    100,    150,    300,   400          },\n+                          {mtNone, mtTest, mtTest, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , C     , Rs    , C     , Rl     },\n+                          {-1    , si_1  , si_1  , si_1  , si_1  , -1     },\n+                          {-1    , -1    , si_1  , -1    , si_1  , -1     }};\n@@ -1604,0 +1637,1 @@\n+    \/\/ Request:                          150................250\n@@ -1618,0 +1652,260 @@\n+TEST_VM_F(NMTVMATreeTest, MultipleRegionsAllWithSameTag) {\n+  using SIndex = NativeCallStackStorage::StackIndex;\n+  using State = VMATree::StateType;\n+  SIndex si_1 = si[0];\n+  SIndex si_2 = si[1];\n+\n+  const bool ok_to_run = false;\n+  const State Rs = State::Reserved;\n+  const State Rl = State::Released;\n+  const State C = State::Committed;\n+  VMATree::RegionData call_stack_1(si_1, mtTest);\n+  VMATree::RegionData call_stack_1_mtNone(si_1, mtNone);\n+  VMATree::RegionData call_stack_2(si_2, mtTest);\n+\n+  { \/\/ Do 'Reserve' over multiple committed\/reserved regions\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.reserve_mapping(50, 900, call_stack_2);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request: (reserve)        50-------------------------------------------------------------------------950\n+    \/\/ Post:    ........0--------50-------------------------------------------------------------------------950--------1000........\n+    \/\/           mtNone   mtTest                                 mtTest                                         mtTest      mtNone\n+    \/\/           Rl       Rs                                     Rs                                             Rs          Rl\n+    \/\/           -        si_1                                   si_2                                           si_1        -\n+    \/\/           -        -                                      -                                              -           -\n+    ExpectedTree<4> et = {{     0,    50,    950,    1000         },\n+                          {mtNone, mtTest, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , Rs    , Rs    , Rl     },\n+                          {-1    , si_1  , si_2  , si_1  , -1     },\n+                          {-1    , -1    , -1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+  }\n+  { \/\/ Do 'Reserve' [A, B) over multiple committed\/reserved regions where B already exists in nodes\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.reserve_mapping(50, 550, call_stack_2);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request:                  50--------------------------------------------------------------600\n+    \/\/ Post:    ........0--------50--------------------------------------------------------------600-------------------1000........\n+    \/\/           mtNone                                          mtTest                                   mtTest            mtNone\n+    \/\/           Rl                                              Rs                                       Rs                Rl\n+    \/\/           -                                               si_2                                     si_1              -\n+    \/\/           -                                               -                                        -                 -\n+    ExpectedTree<4> et = {{     0,    50,    600,    1000         },\n+                          {mtNone, mtTest, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , Rs    , Rs    , Rl     },\n+                          {-1    , si_1  , si_2  , si_1  , -1     },\n+                          {-1    , -1    , -1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+  }\n+  { \/\/ Do 'Reserve' [A, B) over multiple committed\/reserved regions where A already exists in nodes\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.reserve_mapping(0, 950, call_stack_2);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request:         0-----------------------------------------------------------------------------------950\n+    \/\/ Post:    ........0-----------------------------------------------------------------------------------950--------1000........\n+    \/\/           mtNone                                          mtTest                                         mtTest      mtNone\n+    \/\/           Rl                                              Rs                                             Rs          Rl\n+    \/\/           -                                               si_2                                           si_1        -\n+    \/\/           -                                               -                                              -           -\n+    ExpectedTree<3> et = {{     0,    950,    1000        },\n+                          {mtNone, mtTest, mtTest, mtNone },\n+                          {Rl    , Rs    , Rs    , Rl     },\n+                          {-1    , si_2  , si_1  , -1     },\n+                          {-1    , -1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+  }\n+  { \/\/ Do 'Uncommit' over multiple committed\/reserved regions\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.uncommit_mapping(50, 900, call_stack_1_mtNone);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request: (uncommit)       50-------------------------------------------------------------------------950\n+    \/\/ Post:    ........0----------------------------------------------------------------------------------------------1000........\n+    \/\/           mtNone                                           mtTest                                                    mtNone\n+    \/\/           Rl                                               Rs                                                        Rl\n+    \/\/           -                                                si_1                                                      -\n+    \/\/           -                                                -                                                         -\n+    ExpectedTree<2> et = {{     0,   1000         },\n+                          {mtNone, mtTest, mtNone },\n+                          {Rl    , Rs    , Rl     },\n+                          {-1    , si_1  , -1     },\n+                          {-1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+    VMATree::VMATreap::Range r = tree.tree().find_enclosing_range(50);\n+    EXPECT_EQ((int)r.start->key(), 0);\n+    EXPECT_EQ((int)r.end->key(), 1000);\n+  }\n+  { \/\/ Do 'Uncommit' [A,B) over multiple committed\/reserved regions where B already exists in the nodes\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.uncommit_mapping(50, 550, call_stack_1_mtNone);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request: (uncommit)       50--------------------------------------------------------------600\n+    \/\/ Post:    ........0----------------------------------------------------------------------------------------------1000........\n+    \/\/           mtNone                                           mtTest                                                    mtNone\n+    \/\/           Rl                                               Rs                                                        Rl\n+    \/\/           -                                                si_1                                                      -\n+    \/\/           -                                                -                                                         -\n+    ExpectedTree<2> et = {{     0,   1000         },\n+                          {mtNone, mtTest, mtNone },\n+                          {Rl    , Rs    , Rl     },\n+                          {-1    , si_1  , -1     },\n+                          {-1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+    VMATree::VMATreap::Range r = tree.tree().find_enclosing_range(50);\n+    EXPECT_EQ((int)r.start->key(), 0);  \/\/ make sure 600 is removed\n+    EXPECT_EQ((int)r.end->key(), 1000);\n+  }\n+  { \/\/ Do 'Uncommit' [A,B) over multiple committed\/reserved regions where A already exists in the nodes\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.uncommit_mapping(100, 850, call_stack_1_mtNone);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request: (uncommit)               100--------------------------------------------------------------950\n+    \/\/ Post:    ........0----------------------------------------------------------------------------------------------1000........\n+    \/\/           mtNone                                           mtTest                                                    mtNone\n+    \/\/           Rl                                               Rs                                                        Rl\n+    \/\/           -                                                si_1                                                      -\n+    \/\/           -                                                -                                                         -\n+    ExpectedTree<2> et = {{     0,   1000         },\n+                          {mtNone, mtTest, mtNone },\n+                          {Rl    , Rs    , Rl     },\n+                          {-1    , si_1  , -1     },\n+                          {-1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+    VMATree::VMATreap::Range r = tree.tree().find_enclosing_range(50);\n+    EXPECT_EQ((int)r.start->key(), 0);  \/\/ make sure both 50 and 600 are removed\n+    EXPECT_EQ((int)r.end->key(), 1000);\n+  }\n+  { \/\/ Do 'Release' over multiple committed\/reserved regions\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.release_mapping(50, 900);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request:                  50-------------------------------------------------------------------------950\n+    \/\/ Post:    ........0--------50.........................................................................950--------1000........\n+    \/\/           mtNone   mtTest                                 mtNone                                         mtTest      mtNone\n+    \/\/           Rl       Rs                                     Rl                                             Rs          Rl\n+    \/\/           -        si_1                                   -                                              si_1        -\n+    \/\/           -        -                                      -                                              -           -\n+    ExpectedTree<4> et = {{     0,    50,    950,    1000         },\n+                          {mtNone, mtTest, mtNone, mtTest, mtNone },\n+                          {Rl    , Rs    , Rl    , Rs    , Rl     },\n+                          {-1    , si_1  , -1    , si_1  , -1     },\n+                          {-1    , -1    , -1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+  }\n+  { \/\/ Do 'Release' [A,B) over multiple committed\/reserved regions where B already exists in the nodes\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.release_mapping(50, 550);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request:                  50..............................................................600\n+    \/\/ Post:    ........0--------50..............................................................600-------------------1000........\n+    \/\/           mtNone   mtTest                                 mtNone                                    mtTest           mtNone\n+    \/\/           Rl       Rs                                     Rl                                        Rs               Rl\n+    \/\/           -        si_1                                   -                                         si_1             -\n+    \/\/           -        -                                      -                                         -               -\n+    ExpectedTree<4> et = {{     0,    50,    600,    1000         },\n+                          {mtNone, mtTest, mtNone, mtTest, mtNone },\n+                          {Rl    , Rs    , Rl    , Rs    , Rl     },\n+                          {-1    , si_1  , -1    , si_1  , -1     },\n+                          {-1    , -1    , -1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+  }\n+  { \/\/ Do 'Release' [A,B) over multiple committed\/reserved regions where B is start of a released region\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.release_mapping(50, 950);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request:                  50....................................................................................1000\n+    \/\/ Post:    ........0--------50.........\n+    \/\/           mtNone   mtTest    mtNone\n+    \/\/           Rl       Rs        Rl\n+    \/\/           -        si_1      -\n+    \/\/           -        -         -\n+    ExpectedTree<2> et = {{     0,    50,         },\n+                          {mtNone, mtTest, mtNone },\n+                          {Rl    , Rs    , Rl     },\n+                          {-1    , si_1  , -1     },\n+                          {-1    , -1    , -1     }};\n+    check_tree(tree, et, __LINE__);\n+  }\n+  { \/\/ Do 'Release' [A,B) over multiple committed\/reserved regions where A already exists in the nodes\n+    Tree tree;\n+    \/\/ Prepare pre-cond\n+    tree.reserve_mapping(0, 1000, call_stack_1);\n+    tree.commit_mapping(100, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(300, 100, call_stack_1_mtNone, true);\n+    tree.commit_mapping(500, 100, call_stack_1_mtNone, true);\n+    \/\/ New request\n+    tree.release_mapping(50, 650);\n+    \/\/ Pre:     ........0----------------100*********200--------300********400--------500********600-------------------1000........\n+    \/\/ Request:         0..................................................................................700\n+    \/\/ Post:    ...........................................................................................700---------1000........\n+    \/\/                                                   mtNone                                                 mtTest      mtNone\n+    \/\/                                                   Rl                                                     Rs          Rl\n+    \/\/                                                   -                                                      si_1        -\n+    \/\/                                                   -                                                      -           -\n+    ExpectedTree<2> et = {{   700,   1000,        },\n+                          {mtNone, mtTest, mtNone },\n+                          {Rl    , Rs    , Rl     },\n+                          {-1    , si_1  , -1     },\n+                          {-1    , -1    , -1     }};\n+    \/\/ Skipped until JDK-8354115 is integrated\n+    if (ok_to_run) {\n+      check_tree(tree, et, __LINE__);\n+      VMATree::VMATreap::Range r = tree.tree().find_enclosing_range(0);\n+      EXPECT_EQ(r.start, nullptr);  \/\/ make sure 0 is removed\n+      EXPECT_EQ((int)r.end->key(), 700);\n+    }\n+ }\n+}\n\\ No newline at end of file\n","filename":"test\/hotspot\/gtest\/nmt\/test_vmatree.cpp","additions":378,"deletions":84,"binary":false,"changes":462,"status":"modified"}]}