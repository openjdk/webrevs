{"files":[{"patch":"@@ -338,1 +338,7 @@\n-    live_data += live_bytes;\n+    if (!region->was_promoted_in_place()) {\n+      \/\/ As currently implemented, region->get_live_data_bytes() represents bytes concurrently marked.\n+      \/\/ Expansion of the region by promotion during concurrent marking is above TAMS, and is not included\n+      \/\/ as live-data at [start of] old marking.\n+      live_data += live_bytes;\n+    }\n+    \/\/ else, regions that were promoted in place had 0 old live data at mark start\n@@ -377,1 +383,0 @@\n-  \/\/ TODO: subtract from live_data bytes promoted during concurrent GC.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.cpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -226,1 +226,0 @@\n-\n@@ -254,0 +253,1 @@\n+    region->set_promoted_in_place();\n@@ -292,0 +292,1 @@\n+      r->set_promoted_in_place();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGenerationalEvacuationTask.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -265,0 +265,1 @@\n+  bool _promoted_in_place;\n@@ -357,0 +358,9 @@\n+\n+  inline void set_promoted_in_place() {\n+    _promoted_in_place = true;\n+  }\n+\n+  \/\/ Returns true iff this region was promoted in place subsequent to the most recent start of concurrent old marking.\n+  inline bool was_promoted_in_place() {\n+    return _promoted_in_place;\n+  }\n@@ -382,0 +392,3 @@\n+\n+  \/\/ Represents the number of live bytes identified by most recent marking effort.  Does not include the bytes\n+  \/\/ above TAMS.\n@@ -383,0 +396,3 @@\n+\n+  \/\/ Represents the number of live words identified by most recent marking effort.  Does not include the words\n+  \/\/ above TAMS.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegion.hpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -155,0 +155,1 @@\n+  _promoted_in_place = false;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegion.inline.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}