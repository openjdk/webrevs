{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -330,0 +330,2 @@\n+  \/\/ Returns true if the platform efficiently implements the given masked vector\n+  \/\/ operation using predicate features, false otherwise.\n","filename":"src\/hotspot\/share\/opto\/matcher.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -846,1 +846,2 @@\n-    Flag_is_predicated_vector        = 1ULL << 14,\n+    Flag_is_predicated_vector        = 1ULL << 14, \/\/ Marked on a vector node that has an additional\n+                                                   \/\/ mask input controlling the lane operations.\n","filename":"src\/hotspot\/share\/opto\/node.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -2446,0 +2446,7 @@\n+\/\/ Create the type for a vector mask with the given element basic type and lane\n+\/\/ count.\n+\/\/ - Returns \"TypeVectMask\" for platforms that support the predicate feature and\n+\/\/   it is implemented properly in the backend, allowing the vector mask to be\n+\/\/   stored in a predicate\/mask register.\n+\/\/ - Returns a normal vector type (i.e. TypeVectA ~ TypeVectZ) otherwise, where\n+\/\/   the vector mask is stored in a vector register.\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -1015,1 +1015,1 @@\n-\/\/ Class of Vector Types\n+\/\/ Basic class of vector (mask) types.\n@@ -1055,0 +1055,10 @@\n+\/\/ TypeVect subclasses representing vectors or vector masks with \"BVectMask\" or \"NVectMask\"\n+\/\/ layout (see vectornode.hpp for detailed notes on vector mask representations), mapped\n+\/\/ to vector registers and distinguished by vector register size:\n+\/\/\n+\/\/ - TypeVectA: Scalable vector type (variable size, e.g., AArch64 SVE, RISC-V RVV)\n+\/\/ - TypeVectS: 32-bit vector type\n+\/\/ - TypeVectD: 64-bit vector type\n+\/\/ - TypeVectX: 128-bit vector type\n+\/\/ - TypeVectY: 256-bit vector type\n+\/\/ - TypeVectZ: 512-bit vector type\n@@ -1085,0 +1095,3 @@\n+\/\/ Class of TypeVectMask, representing vector masks with \"PVectMask\" layout (see\n+\/\/ vectornode.hpp for detailed notes on vector mask representations), mapped to\n+\/\/ dedicated hardware predicate\/mask registers.\n","filename":"src\/hotspot\/share\/opto\/type.hpp","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,0 +36,56 @@\n+\/\/=======================Notes-for-VectorMask-Representation=======================\n+\/\/\n+\/\/ There are three distinct representations for vector masks based on platform and\n+\/\/ use scenarios:\n+\/\/\n+\/\/ - BVectMask: Platform-independent mask stored in a vector register with 8-bit\n+\/\/   lanes containing 1\/0 values. The corresponding type is TypeVectA ~ TypeVectZ.\n+\/\/\n+\/\/ - NVectMask: Platform-specific mask stored in vector registers with N-bit lanes,\n+\/\/   where all bits in each lane are either set (true) or unset (false). Generated\n+\/\/   on architectures without predicate\/mask feature, such as AArch64 NEON, x86\n+\/\/   AVX2, etc. The corresponding type is TypeVectA ~ TypeVectZ.\n+\/\/\n+\/\/ - PVectMask: Platform-specific mask stored in predicate\/mask registers. Generated\n+\/\/   on architectures with predicate\/mask feature, such as AArch64 SVE, x86 AVX-512,\n+\/\/   and RISC-V Vector Extension (RVV). The corresponding type is TypeVectMask.\n+\/\/\n+\/\/ NVectMask and PVectMask encode element data type and vector length information.\n+\/\/ They are the primary mask representations used in most mask and masked vector\n+\/\/ operations. While BVectMask primarily represents mask values loaded from or\n+\/\/ stored to Java boolean memory, and is currently used in certain mask operations\n+\/\/ (i.e. VectorMaskOpNode).\n+\/\/\n+\/\/=========================Notes-for-Masked-Vector-Nodes===========================\n+\/\/\n+\/\/ Each lane-wise and cross-lane (reduction) ALU node supports both non-masked\n+\/\/ and masked operations.\n+\/\/\n+\/\/ Currently masked vector nodes are only used to implement the Vector API's masked\n+\/\/ operations (which might also be used for auto-vectorization in future), such as:\n+\/\/   Vector<E> lanewise(VectorOperators.Binary op, Vector<E> v, VectorMask<E> m)\n+\/\/\n+\/\/ They are generated during intrinsification for Vector API, only on architectures\n+\/\/ that support the relevant predicated instructions. The compiler uses\n+\/\/ \"Matcher::match_rule_supported_vector_masked()\" to check whether the current\n+\/\/ platform supports the predicated\/masked vector instructions for an operation. It\n+\/\/ generates the masked vector node for the operation if supported. Otherwise, it\n+\/\/ generates the unpredicated vector node and implements the masked operation with\n+\/\/ the help of a VectorBlendNode. Please see more details from API intrinsification\n+\/\/ in vectorIntrinsics.cpp.\n+\/\/\n+\/\/ To differentiate the masked and non-masked nodes, flag \"Flag_is_predicated_vector\"\n+\/\/ is set for the masked version. Meanwhile, there is an additional mask input for\n+\/\/ the masked nodes.\n+\/\/\n+\/\/ For example, \"AddVBNode\" might have two versions:\n+\/\/   - Non-masked version:\n+\/\/          in1  in2\n+\/\/           \\   \/\n+\/\/         AddVBNode\n+\/\/\n+\/\/   - Masked version (with \"Flag_is_predicated_vector\" being set):\n+\/\/       in1  in2  mask\n+\/\/         \\   |   \/\n+\/\/         AddVBNode\n+\n@@ -106,0 +162,2 @@\n+  \/\/ Returns true if the lower vlen bits (bits [0, vlen-1]) of the long value\n+  \/\/ are all 1s or all 0s, indicating a \"mask all\" or \"mask none\" pattern.\n@@ -1054,0 +1112,1 @@\n+\/\/ Vector mask compress\n@@ -1329,0 +1388,2 @@\n+\/\/ Generate a vector mask based on the given length. Lanes with indices in\n+\/\/ [0, length) are set to true, while the remaining lanes are set to false.\n@@ -1342,0 +1403,2 @@\n+\/\/ Base class for certain vector mask operations. The supported input mask can be\n+\/\/ either \"BVectMask\" or \"PVectMask\" depending on the platform.\n@@ -1362,0 +1425,1 @@\n+\/\/ Count the number of true (set) lanes in the vector mask.\n@@ -1369,0 +1433,2 @@\n+\/\/ Returns the index of the first true (set) lane in the vector mask.\n+\/\/ If no lanes are set, returns the vector length.\n@@ -1376,0 +1442,2 @@\n+\/\/ Returns the index of the last true (set) lane in the vector mask.\n+\/\/ If no lanes are set, returns -1 .\n@@ -1383,0 +1451,4 @@\n+\/\/ Pack the mask lane values into a long value, supporting at most the\n+\/\/ first 64 lanes. Each mask lane is packed into one bit in the long\n+\/\/ value, ordered from the least significant bit to the most significant\n+\/\/ bit.\n@@ -1394,0 +1466,3 @@\n+\/\/ Unpack bits from a long value into vector mask lane values. Each bit\n+\/\/ in the long value is unpacked into one mask lane, ordered from the\n+\/\/ least significant bit to the sign bit.\n@@ -1403,1 +1478,4 @@\n-\/\/-------------------------- Vector mask broadcast -----------------------------------\n+\/\/-------------------------- Vector mask broadcast ------------------------------\n+\/\/ Broadcast a scalar value to all lanes of a vector mask. All lanes are set\n+\/\/ to true if the input value is non-zero, or false if the input value is zero.\n+\/\/ This node is only used to generate a mask with \"PVectMask\" layout.\n@@ -1410,1 +1488,3 @@\n-\/\/--------------------------- Vector mask logical and --------------------------------\n+\/\/--------------------------- Vector mask logical and ---------------------------\n+\/\/ Perform a bitwise AND operation between two vector masks. This node is only\n+\/\/ used for vector masks with \"PVectMask\" layout.\n@@ -1417,1 +1497,3 @@\n-\/\/--------------------------- Vector mask logical or ---------------------------------\n+\/\/--------------------------- Vector mask logical or ----------------------------\n+\/\/ Perform a bitwise OR operation between two vector masks. This node is only\n+\/\/ used for vector masks with \"PVectMask\" layout.\n@@ -1424,1 +1506,3 @@\n-\/\/--------------------------- Vector mask logical xor --------------------------------\n+\/\/--------------------------- Vector mask logical xor ---------------------------\n+\/\/ Perform a bitwise XOR operation between two vector masks. This node is only\n+\/\/ used for vector masks with \"PVectMask\" layout.\n@@ -1656,0 +1740,3 @@\n+\/\/------------------------------VectorMaskCmpNode-------------------------------\n+\/\/ Compare two vectors lane-wise using the specified predicate and produce a\n+\/\/ vector mask.\n@@ -1700,0 +1787,3 @@\n+\/\/------------------------------VectorTestNode-------------------------------\n+\/\/ Test whether all or any lanes in the first input vector mask is true,\n+\/\/ based on the specified predicate.\n@@ -1722,0 +1812,4 @@\n+\/\/------------------------------VectorBlendNode-------------------------------\n+\/\/ Blend two vectors based on a vector mask. For each lane, select the value\n+\/\/ from the first input vector (vec1) if the corresponding mask lane is set,\n+\/\/ otherwise select from the second input vector (vec2).\n@@ -1739,1 +1833,0 @@\n-    \/\/ assert(mask->is_VectorMask(), \"VectorBlendNode requires that third argument be a mask\");\n@@ -1747,1 +1840,0 @@\n-\n@@ -1761,7 +1853,10 @@\n-\/\/ The target may not directly support the rearrange operation for an element type. In those cases,\n-\/\/ we can transform the rearrange into a different element type. For example, on x86 before AVX512,\n-\/\/ there is no rearrange instruction for short elements, what we will then do is to transform the\n-\/\/ shuffle vector into one that we can do byte rearrange such that it would provide the same\n-\/\/ result. This could have been done in VectorRearrangeNode during code emission but we eagerly\n-\/\/ expand this out because it is often the case that an index vector is reused in many rearrange\n-\/\/ operations. This allows the index preparation to be GVN-ed as well as hoisted out of loops, etc.\n+\/\/------------------------------VectorLoadShuffleNode------------------------------\n+\/\/ The target may not directly support the rearrange operation for an element type.\n+\/\/ In those cases, we can transform the rearrange into a different element type.\n+\/\/ For example, on x86 before AVX512, there is no rearrange instruction for short\n+\/\/ elements, what we will then do is to transform the shuffle vector into one that\n+\/\/ we can do byte rearrange such that it would provide the same result. This could\n+\/\/ have been done in VectorRearrangeNode during code emission but we eagerly expand\n+\/\/ this out because it is often the case that an index vector is reused in many\n+\/\/ rearrange operations. This allows the index preparation to be GVN-ed as well as\n+\/\/ hoisted out of loops, etc.\n@@ -1776,0 +1871,3 @@\n+\/\/------------------------------VectorLoadMaskNode---------------------------------\n+\/\/ Convert a \"BVectMask\" into a platform-specific vector mask (either \"NVectMask\"\n+\/\/ or \"PVectMask\").\n@@ -1787,0 +1885,3 @@\n+\/\/------------------------------VectorStoreMaskNode--------------------------------\n+\/\/ Convert a platform-specific vector mask (either \"NVectMask\" or \"PVectMask\")\n+\/\/ into a \"BVectMask\".\n@@ -1798,0 +1899,3 @@\n+\/\/------------------------------VectorMaskCastNode----------------------------------\n+\/\/ Lane-wise type cast a vector mask to the given vector type. The vector length\n+\/\/ of the input and output must be the same.\n","filename":"src\/hotspot\/share\/opto\/vectornode.hpp","additions":118,"deletions":14,"binary":false,"changes":132,"status":"modified"}]}