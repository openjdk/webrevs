{"files":[{"patch":"@@ -4160,43 +4160,0 @@\n-DWORD os::win32::system_logical_processor_count() {\n-  DWORD logical_processors = 0;\n-  LOGICAL_PROCESSOR_RELATIONSHIP relationship_type = RelationGroup;\n-  PSYSTEM_LOGICAL_PROCESSOR_INFORMATION_EX system_logical_processor_info = nullptr;\n-  DWORD returned_length = 0;\n-\n-  if (GetLogicalProcessorInformationEx(relationship_type, nullptr, &returned_length) == 0) {\n-    DWORD last_error = GetLastError();\n-\n-    if (last_error == ERROR_INSUFFICIENT_BUFFER) {\n-      system_logical_processor_info = (PSYSTEM_LOGICAL_PROCESSOR_INFORMATION_EX)os::malloc(returned_length, mtInternal);\n-\n-      if (nullptr == system_logical_processor_info) {\n-        warning(\"os::malloc() failed to allocate %ld bytes for GetLogicalProcessorInformationEx buffer\", returned_length);\n-      } else if (GetLogicalProcessorInformationEx(relationship_type, system_logical_processor_info, &returned_length) == 0) {\n-        char buf[512];\n-        size_t buf_len = os::lasterror(buf, sizeof(buf));\n-        warning(\"Attempt to determine logical processor count from GetLogicalProcessorInformationEx() failed: %s\", buf_len != 0 ? buf : \"<unknown error>\");\n-      } else {\n-        DWORD processor_groups = system_logical_processor_info->Group.ActiveGroupCount;\n-\n-        PROCESSOR_GROUP_INFO* group_info = (PROCESSOR_GROUP_INFO*)system_logical_processor_info->Group.GroupInfo;\n-        for (DWORD i = 0; i < processor_groups; i++, group_info++) {\n-          logical_processors += group_info->ActiveProcessorCount;\n-        }\n-\n-        if (logical_processors == 0) {\n-          warning(\"Could not determine logical processor count from GetLogicalProcessorInformationEx()\");\n-          assert(false, \"Must find at least 1 logical processor\");\n-        }\n-      }\n-\n-      os::free(system_logical_processor_info);\n-    } else {\n-      char buf[512];\n-      size_t buf_len = os::lasterror(buf, sizeof(buf));\n-      warning(\"Attempt to determine logical processor count from GetLogicalProcessorInformationEx() failed: %s\", buf_len != 0 ? buf : \"<unknown error>\");\n-    }\n-  }\n-\n-  return logical_processors;\n-}\n-\n@@ -4214,1 +4171,7 @@\n-    processors = system_logical_processor_count();\n+    processors = GetActiveProcessorCount(ALL_PROCESSOR_GROUPS);\n+    if (processors == 0) {\n+      char buf[512];\n+      size_t buf_len = os::lasterror(buf, sizeof(buf));\n+      warning(\"Attempt to determine the processor count from GetActiveProcessorCount() failed: %s\", buf_len != 0 ? buf : \"<unknown error>\");\n+      assert(false, \"Must find at least 1 logical processor\");\n+    }\n@@ -4578,1 +4541,1 @@\n-  log_debug(os)(\"%d logical processors found.\", win32::system_logical_processor_count());\n+  log_debug(os)(\"%d logical processors found.\", processor_count());\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":8,"deletions":45,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -68,1 +68,0 @@\n-  static DWORD  system_logical_processor_count();\n","filename":"src\/hotspot\/os\/windows\/os_windows.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}