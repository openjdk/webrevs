{"files":[{"patch":"@@ -4058,1 +4058,1 @@\n-  if (!IsProcessInJob(GetCurrentProcess(), nullptr, &is_in_job_object)) {\n+  if (IsProcessInJob(GetCurrentProcess(), nullptr, &is_in_job_object) == 0) {\n@@ -4072,25 +4072,17 @@\n-  if (!QueryInformationJobObject(nullptr, JobObjectGroupInformationEx, nullptr, 0, &job_object_information_length)) {\n-    DWORD last_error = GetLastError();\n-    if (last_error == ERROR_INSUFFICIENT_BUFFER) {\n-      DWORD group_count = job_object_information_length \/ sizeof(GROUP_AFFINITY);\n-\n-      job_object_information = os::malloc(job_object_information_length, mtInternal);\n-      if (job_object_information != nullptr) {\n-          if (QueryInformationJobObject(nullptr, JobObjectGroupInformationEx, job_object_information, job_object_information_length, &job_object_information_length)) {\n-            DWORD groups_found = job_object_information_length \/ sizeof(GROUP_AFFINITY);\n-            if (groups_found != group_count) {\n-              warning(\"Unexpected processor group count->%ld. Expected %ld processor groups.\", groups_found, group_count);\n-              assert(false, \"Unexpected group count\");\n-            }\n-\n-            GROUP_AFFINITY* group_affinity_data = ((GROUP_AFFINITY*)job_object_information);\n-            for (DWORD i = 0; i < groups_found; i++, group_affinity_data++) {\n-              processors += population_count(group_affinity_data->Mask);\n-            }\n-\n-            if (processors == 0) {\n-              warning(\"Could not determine processor count from the job object.\");\n-              assert(false, \"Must find at least 1 logical processor\");\n-            }\n-          } else {\n-            warning(\"QueryInformationJobObject() failed: GetLastError->%ld.\", GetLastError());\n+  if (QueryInformationJobObject(nullptr, JobObjectGroupInformationEx, nullptr, 0, &job_object_information_length) != 0) {\n+    warning(\"Unexpected QueryInformationJobObject success result.\");\n+    assert(false, \"Unexpected QueryInformationJobObject success result\");\n+    return 0;\n+  }\n+\n+  DWORD last_error = GetLastError();\n+  if (last_error == ERROR_INSUFFICIENT_BUFFER) {\n+    DWORD group_count = job_object_information_length \/ sizeof(GROUP_AFFINITY);\n+\n+    job_object_information = os::malloc(job_object_information_length, mtInternal);\n+    if (job_object_information != nullptr) {\n+        if (QueryInformationJobObject(nullptr, JobObjectGroupInformationEx, job_object_information, job_object_information_length, &job_object_information_length) != 0) {\n+          DWORD groups_found = job_object_information_length \/ sizeof(GROUP_AFFINITY);\n+          if (groups_found != group_count) {\n+            warning(\"Unexpected processor group count: %ld. Expected %ld processor groups.\", groups_found, group_count);\n+            assert(false, \"Unexpected group count\");\n@@ -4099,4 +4091,16 @@\n-          os::free(job_object_information);\n-      } else {\n-          warning(\"os::malloc() failed to allocate %ld bytes for QueryInformationJobObject\", job_object_information_length);\n-      }\n+          GROUP_AFFINITY* group_affinity_data = ((GROUP_AFFINITY*)job_object_information);\n+          for (DWORD i = 0; i < groups_found; i++, group_affinity_data++) {\n+            processors += population_count(group_affinity_data->Mask);\n+          }\n+\n+          if (processors == 0) {\n+            warning(\"Could not determine processor count from the job object.\");\n+            assert(false, \"Must find at least 1 logical processor\");\n+          }\n+        } else {\n+          warning(\"QueryInformationJobObject() failed: GetLastError->%ld.\", GetLastError());\n+        }\n+\n+        os::free(job_object_information);\n+    } else {\n+        warning(\"os::malloc() failed to allocate %ld bytes for QueryInformationJobObject\", job_object_information_length);\n@@ -4104,0 +4108,4 @@\n+  } else {\n+    warning(\"Unexpected QueryInformationJobObject error code: GetLastError->%ld.\", last_error);\n+    assert(false, \"Unexpected QueryInformationJobObject error code\");\n+    return 0;\n@@ -4116,1 +4124,1 @@\n-  if (!GetLogicalProcessorInformationEx(relationship_type, nullptr, &returned_length)) {\n+  if (GetLogicalProcessorInformationEx(relationship_type, nullptr, &returned_length) == 0) {\n@@ -4124,1 +4132,1 @@\n-      } else if (!GetLogicalProcessorInformationEx(relationship_type, system_logical_processor_info, &returned_length)) {\n+      } else if (GetLogicalProcessorInformationEx(relationship_type, system_logical_processor_info, &returned_length) == 0) {\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":40,"deletions":32,"binary":false,"changes":72,"status":"modified"}]}