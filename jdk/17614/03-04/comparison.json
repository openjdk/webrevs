{"files":[{"patch":"@@ -88,0 +88,5 @@\n+typedef struct {\n+    int monitorCounter;\n+    int monitorLimit;\n+    HMONITOR* hmpMonitors;\n+} MonitorData;\n@@ -89,5 +94,0 @@\n-\/* Some helper functions (from awt_MMStub.h\/cpp) *\/\n-\n-int g_nMonitorCounter;\n-int g_nMonitorLimit;\n-HMONITOR* g_hmpMonitors;\n@@ -117,1 +117,1 @@\n-static BOOL WINAPI clb_fCountMonitors(HMONITOR hMon, HDC hDC, LPRECT rRect, LPARAM lP)\n+static BOOL WINAPI clb_fCountMonitors(HMONITOR hMon, HDC hDC, LPRECT rRect, LPARAM lpMonitorCounter)\n@@ -120,1 +120,1 @@\n-        g_nMonitorCounter++;\n+        (*((int *)lpMonitorCounter))++;\n@@ -128,3 +128,3 @@\n-    g_nMonitorCounter = 0;\n-    ::EnumDisplayMonitors(NULL, NULL, clb_fCountMonitors, 0L);\n-    return g_nMonitorCounter;\n+    int monitorCounter = 0;\n+    ::EnumDisplayMonitors(NULL, NULL, clb_fCountMonitors, (LPARAM)&monitorCounter);\n+    return monitorCounter;\n@@ -134,1 +134,1 @@\n-static BOOL WINAPI clb_fCollectMonitors(HMONITOR hMon, HDC hDC, LPRECT rRect, LPARAM lP)\n+static BOOL WINAPI clb_fCollectMonitors(HMONITOR hMon, HDC hDC, LPRECT rRect, LPARAM lpMonitorData)\n@@ -136,3 +136,4 @@\n-    if ((g_nMonitorCounter < g_nMonitorLimit) && (IsValidMonitor(hMon))) {\n-        g_hmpMonitors[g_nMonitorCounter] = hMon;\n-        g_nMonitorCounter++;\n+    MonitorData* pMonitorData = (MonitorData *)lpMonitorData;\n+    if ((pMonitorData->monitorCounter < pMonitorData->monitorLimit) && (IsValidMonitor(hMon))) {\n+        pMonitorData->hmpMonitors[pMonitorData->monitorCounter] = hMon;\n+        pMonitorData->monitorCounter++;\n@@ -146,5 +147,9 @@\n-    g_nMonitorCounter = 0;\n-    g_hmpMonitors = hmpMonitors;\n-    g_nMonitorLimit = nNum;\n-    if (NULL != g_hmpMonitors) {\n-        ::EnumDisplayMonitors(NULL, NULL, clb_fCollectMonitors, 0L);\n+    if (NULL != hmpMonitors) {\n+        MonitorData monitorData;\n+        monitorData.monitorCounter = 0;\n+        monitorData.monitorLimit = nNum;\n+        monitorData.hmpMonitors = hmpMonitors;\n+        ::EnumDisplayMonitors(NULL, NULL, clb_fCollectMonitors, (LPARAM)&monitorData);\n+        return monitorData.monitorCounter;\n+    } else {\n+        return 0;\n@@ -152,1 +157,0 @@\n-    return g_nMonitorCounter;\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/Devices.cpp","additions":24,"deletions":20,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -192,7 +192,1 @@\n-    int getDiBitsRC = ::GetDIBits(hBMDC, hBM, 0, 1, NULL, gpBitmapInfo, DIB_RGB_COLORS);\n-    VERIFY(getDiBitsRC);\n-    if (getDiBitsRC == 0) {\n-        VERIFY(::DeleteObject(hBM));\n-        VERIFY(::DeleteDC(hBMDC));\n-        return;\n-    }\n+    VERIFY(::GetDIBits(hBMDC, hBM, 0, 1, NULL, gpBitmapInfo, DIB_RGB_COLORS));\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Win32GraphicsDevice.cpp","additions":1,"deletions":7,"binary":false,"changes":8,"status":"modified"}]}