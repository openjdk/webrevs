{"files":[{"patch":"@@ -58,0 +58,2 @@\n+import sun.java2d.Disposer;\n+import sun.java2d.DisposerRecord;\n@@ -222,0 +224,1 @@\n+                    this.JPEGWriter.dispose();\n@@ -228,0 +231,1 @@\n+                    this.JPEGWriter.dispose();\n@@ -266,0 +270,6 @@\n+                \/\/ The JDK built-in JPEGImageWriter will self-dispose.\n+                \/\/ So a Disposer is only needed here if it is an unknown reader.\n+                \/\/ This is not common, so likely this will rarely be needed.\n+                if (!(this.JPEGWriter instanceof com.sun.imageio.plugins.jpeg.JPEGImageWriter)) {\n+                    Disposer.addRecord(this, new ImageWriterDisposerRecord(this.JPEGWriter));\n+                }\n@@ -438,5 +448,10 @@\n-    @SuppressWarnings(\"removal\")\n-    protected void finalize() throws Throwable {\n-        super.finalize();\n-        if(JPEGWriter != null) {\n-            JPEGWriter.dispose();\n+    private static class ImageWriterDisposerRecord implements DisposerRecord {\n+        private final ImageWriter writer;\n+\n+        public ImageWriterDisposerRecord(ImageWriter writer) {\n+            this.writer = writer;\n+        }\n+\n+        @Override\n+        public void dispose() {\n+            writer.dispose();\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/imageio\/plugins\/tiff\/TIFFBaseJPEGCompressor.java","additions":20,"deletions":5,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -37,0 +37,2 @@\n+import sun.java2d.Disposer;\n+import sun.java2d.DisposerRecord;\n@@ -68,0 +70,7 @@\n+            \/\/ The JDK built-in ImageReader will self-dispose.\n+            \/\/ So a Disposer is only needed here if it is an unknown reader.\n+            \/\/ This is not common, so likely this will rarely be needed.\n+            if (!(this.JPEGReader instanceof com.sun.imageio.plugins.jpeg.JPEGImageReader)) {\n+                Disposer.addRecord(this, new ImageReaderDisposerRecord(this.JPEGReader));\n+            }\n+\n@@ -142,4 +151,11 @@\n-    @SuppressWarnings(\"removal\")\n-    protected void finalize() throws Throwable {\n-        super.finalize();\n-        JPEGReader.dispose();\n+    private static class ImageReaderDisposerRecord implements DisposerRecord {\n+        private final ImageReader reader;\n+\n+        public ImageReaderDisposerRecord(ImageReader reader) {\n+            this.reader = reader;\n+        }\n+\n+        @Override\n+        public void dispose() {\n+            reader.dispose();\n+        }\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/imageio\/plugins\/tiff\/TIFFJPEGDecompressor.java","additions":20,"deletions":4,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -613,4 +613,0 @@\n-    protected void finalize() throws Throwable {\n-        super.finalize();\n-        JPEGReader.dispose();\n-    }\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/imageio\/plugins\/tiff\/TIFFOldJPEGDecompressor.java","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"}]}