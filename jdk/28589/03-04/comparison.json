{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/hotspot\/share\/ci\/ciArray.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/hotspot\/share\/ci\/ciInstance.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -175,1 +175,1 @@\n-ciConstant ciObject::check_constant_value_cache(int off, BasicType bt) {\n+ciConstant ciObject::check_constant_value_cache(int key, BasicType bt) {\n@@ -179,1 +179,1 @@\n-      if (cached_val.off() == off) {\n+      if (cached_val.key() == key) {\n@@ -192,1 +192,1 @@\n-void ciObject::add_to_constant_value_cache(int off, ciConstant val) {\n+void ciObject::add_to_constant_value_cache(int key, ciConstant val) {\n@@ -194,1 +194,1 @@\n-  assert(!check_constant_value_cache(off, val.basic_type()).is_valid(), \"duplicate\");\n+  assert(!check_constant_value_cache(key, val.basic_type()).is_valid(), \"duplicate\");\n@@ -199,1 +199,1 @@\n-  _constant_values->append(ConstantValue(off, val));\n+  _constant_values->append(ConstantValue(key, val));\n@@ -233,13 +233,15 @@\n-  if (!is_null_object()) {\n-    \/\/ Handle identity hash as if it were a field.\n-    ciConstant value = check_constant_value_cache(IDENTITY_HASH_OFFSET, T_INT);\n-    if (!value.is_valid()) {\n-      VM_ENTRY_MARK;\n-      jint identity_hash = checked_cast<jint>(get_oop()->fast_identity_hash_or_no_hash());\n-      value = ciConstant(T_INT, identity_hash);\n-      \/\/ Cache observed state so it doesn't change during compilation.\n-      add_to_constant_value_cache(IDENTITY_HASH_OFFSET, value);\n-    }\n-    if (value.as_int() != markWord::no_hash) {\n-      return value;\n-    }\n+  if (is_null_object()) {\n+    \/\/ Note: library_call already has a path for System.identityHashCode(null)\n+    return ciConstant(T_INT, 0);\n+  }\n+  \/\/ Handle identity hash as if it were a field value.\n+  ciConstant value = check_constant_value_cache(identityHashKey, T_INT);\n+  if (!value.is_valid()) {\n+    VM_ENTRY_MARK;\n+    jint identity_hash = checked_cast<jint>(get_oop()->fast_identity_hash_or_no_hash());\n+    value = ciConstant(T_INT, identity_hash);\n+    \/\/ Cache observed state so it doesn't change during compilation.\n+    add_to_constant_value_cache(identityHashKey, value);\n+  }\n+  if (value.as_int() != markWord::no_hash) {\n+    return value;\n","filename":"src\/hotspot\/share\/ci\/ciObject.cpp","additions":21,"deletions":19,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,1 +66,1 @@\n-      int _off;\n+      int _key;\n@@ -69,2 +69,2 @@\n-      ConstantValue() : _value(ciConstant()), _off(0) { }\n-      ConstantValue(int off, ciConstant value) : _value(value), _off(off) { }\n+      ConstantValue() : _value(ciConstant()), _key(0) { }\n+      ConstantValue(int key, ciConstant value) : _value(value), _key(key) { }\n@@ -72,1 +72,1 @@\n-      int off() const { return _off; }\n+      int key() const { return _key; }\n@@ -76,1 +76,2 @@\n-  const int IDENTITY_HASH_OFFSET = -1;\n+  \/\/ The reserved key for identity hash code\n+  static constexpr int identityHashKey = -1;\n@@ -117,2 +118,3 @@\n-  ciConstant check_constant_value_cache(int off, BasicType bt);\n-  void add_to_constant_value_cache(int off, ciConstant val);\n+  \/\/ Key must be nonnegative. Negative keys are reserved.\n+  ciConstant check_constant_value_cache(int key, BasicType bt);\n+  void add_to_constant_value_cache(int key, ciConstant val);\n","filename":"src\/hotspot\/share\/ci\/ciObject.hpp","additions":10,"deletions":8,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/hotspot\/share\/oops\/oop.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/hotspot\/share\/oops\/oop.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-    static final Object a = new Object(), b = new Object();\n+    static final Object a = new Object(), b = new Object(), NULL = null;\n@@ -48,1 +48,1 @@\n-    static final int expectedResult;\n+    static final int expectedSum;\n@@ -52,1 +52,1 @@\n-        expectedResult = System.identityHashCode(a) + System.identityHashCode(b);\n+        expectedSum = System.identityHashCode(a) + System.identityHashCode(b);\n@@ -63,2 +63,2 @@\n-        if (sum != expectedResult) {\n-            throw new IllegalStateException(\"Unexpected hash sum, expected %X actual %X\".formatted(expectedResult, sum));\n+        if (sum != expectedSum) {\n+            throw new IllegalStateException(\"Unexpected hash sum, expected %X actual %X\".formatted(expectedSum, sum));\n@@ -68,0 +68,12 @@\n+    @Test\n+    @IR(failOn = {IRNode.ADD_I})\n+    public int testNullSum() {\n+        return 42 + System.identityHashCode(NULL);\n+    }\n+\n+    @Check(test = \"testNullSum\")\n+    public void checkNullSum(int sum) {\n+        if (sum != 42) {\n+            throw new IllegalStateException(\"Unexpected null hash sum, expected %X actual %X\".formatted(42, sum));\n+        }\n+    }\n","filename":"test\/hotspot\/jtreg\/compiler\/intrinsics\/object\/IdentityHashCodeFold.java","additions":18,"deletions":6,"binary":false,"changes":24,"status":"modified"}]}