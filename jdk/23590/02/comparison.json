{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,11 @@\n+\/*\n+ * @test\n+ * @bug 8240256 8269034\n+ * @summary\n+ * @library \/test\/lib\/ \/sun\/security\/pkcs11\/\n+ * @modules jdk.crypto.cryptoki\/sun.security.pkcs11\n+ * @run main\/othervm\n+ *        -DCUSTOM_P11_CONFIG=${test.src}\/MultipleLogins-nss.txt\n+ *        -DCUSTOM_DB_DIR=.\/nss\/db\n+ *        MultipleLogins\n+ *\/\n@@ -33,0 +44,2 @@\n+import jdk.test.lib.Utils;\n+\n@@ -35,0 +48,4 @@\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n@@ -36,0 +53,1 @@\n+import java.util.List;\n@@ -45,0 +63,23 @@\n+    private static void copyDbFiles() throws IOException {\n+        final var testFolder = System.getProperty(\"test.src\", \".\");\n+        final var srcDbFolder = Paths.get(testFolder).getParent().resolve(\"nss\", \"db\");\n+\n+        \/\/ Getting path & creating the temporary scratch directory .\/nss\/db\n+        final var nssFolder = Path.of(\".\").resolve(\"nss\");\n+        Files.createDirectory(nssFolder);\n+        final var destination = nssFolder.resolve(\"db\");\n+\n+        final var sourceFiles = List.of(\n+                srcDbFolder.resolve(\"cert9.db\"),\n+                srcDbFolder.resolve(\"key4.db\"),\n+                srcDbFolder.resolve(\"cert8.db\"),\n+                srcDbFolder.resolve(\"key3.db\")\n+        );\n+\n+        final var copiedFiles = Utils.copyFiles(sourceFiles, destination, StandardCopyOption.REPLACE_EXISTING);\n+        copiedFiles.forEach(path -> path.toFile().setWritable(true));\n+\n+        System.out.println(\"NSS db files copied to: \");\n+        copiedFiles.forEach(System.out::println);\n+    }\n+\n@@ -46,0 +87,2 @@\n+        copyDbFiles();\n+\n","filename":"test\/jdk\/sun\/security\/pkcs11\/Provider\/MultipleLogins.java","additions":44,"deletions":1,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -1,139 +0,0 @@\n-#\n-# Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-# @test\n-# @bug 8240256 8269034\n-# @summary\n-# @library \/test\/lib\/\n-# @build jdk.test.lib.util.ForceGC\n-#        jdk.test.lib.Platform\n-#        jdk.test.lib.Utils\n-# @run shell MultipleLogins.sh\n-\n-# set a few environment variables so that the shell-script can run stand-alone\n-# in the source directory\n-\n-# if running by hand on windows, change TESTSRC and TESTCLASSES to \".\"\n-if [ \"${TESTSRC}\" = \"\" ] ; then\n-    TESTSRC=`pwd`\n-fi\n-if [ \"${TESTCLASSES}\" = \"\" ] ; then\n-    TESTCLASSES=`pwd`\n-fi\n-\n-if [ \"${TESTCLASSPATH}\" = \"\" ] ; then\n-    TESTCLASSPATH=`pwd`\n-fi\n-\n-if [ \"${COMPILEJAVA}\" = \"\" ]; then\n-    COMPILEJAVA=\"${TESTJAVA}\"\n-fi\n-echo TESTSRC=${TESTSRC}\n-echo TESTCLASSES=${TESTCLASSES}\n-echo TESTJAVA=${TESTJAVA}\n-echo COMPILEJAVA=${COMPILEJAVA}\n-echo \"\"\n-\n-# let java test exit if platform unsupported\n-\n-OS=`uname -s`\n-case \"$OS\" in\n-  Linux )\n-    FS=\"\/\"\n-    PS=\":\"\n-    CP=\"${FS}bin${FS}cp\"\n-    CHMOD=\"${FS}bin${FS}chmod\"\n-    ;;\n-  Darwin )\n-    FS=\"\/\"\n-    PS=\":\"\n-    CP=\"${FS}bin${FS}cp\"\n-    CHMOD=\"${FS}bin${FS}chmod\"\n-    ;;\n-  AIX )\n-    FS=\"\/\"\n-    PS=\":\"\n-    CP=\"${FS}bin${FS}cp\"\n-    CHMOD=\"${FS}bin${FS}chmod\"\n-    ;;\n-  Windows* )\n-    FS=\"\\\\\"\n-    PS=\";\"\n-    CP=\"cp\"\n-    CHMOD=\"chmod\"\n-    ;;\n-  CYGWIN* )\n-    FS=\"\/\"\n-    PS=\";\"\n-    CP=\"cp\"\n-    CHMOD=\"chmod\"\n-    #\n-    # javac does not like \/cygdrive produced by `pwd`\n-    #\n-    TESTSRC=`cygpath -d ${TESTSRC}`\n-    ;;\n-  * )\n-    echo \"Unrecognized system!\"\n-    exit 1;\n-    ;;\n-esac\n-\n-# first make cert\/key DBs writable\n-\n-${CP} ${TESTSRC}${FS}..${FS}nss${FS}db${FS}cert9.db ${TESTCLASSES}\n-${CHMOD} +w ${TESTCLASSES}${FS}cert9.db\n-\n-${CP} ${TESTSRC}${FS}..${FS}nss${FS}db${FS}key4.db ${TESTCLASSES}\n-${CHMOD} +w ${TESTCLASSES}${FS}key4.db\n-\n-${CP} ${TESTSRC}${FS}..${FS}nss${FS}db${FS}cert8.db ${TESTCLASSES}\n-${CHMOD} +w ${TESTCLASSES}${FS}cert8.db\n-\n-${CP} ${TESTSRC}${FS}..${FS}nss${FS}db${FS}key3.db ${TESTCLASSES}\n-${CHMOD} +w ${TESTCLASSES}${FS}key3.db\n-\n-# compile test\n-${COMPILEJAVA}${FS}bin${FS}javac ${TESTJAVACOPTS} ${TESTTOOLVMOPTS} \\\n-        -classpath ${TESTCLASSPATH} \\\n-        -d ${TESTCLASSES} \\\n-        --add-modules jdk.crypto.cryptoki \\\n-        --add-exports jdk.crypto.cryptoki\/sun.security.pkcs11=ALL-UNNAMED \\\n-        ${TESTSRC}${FS}..${FS}..${FS}..${FS}..${FS}..${FS}lib${FS}jdk${FS}test${FS}lib${FS}artifacts${FS}*.java \\\n-        ${TESTSRC}${FS}..${FS}..${FS}..${FS}..${FS}..${FS}lib${FS}jtreg${FS}*.java \\\n-        ${TESTSRC}${FS}MultipleLogins.java \\\n-        ${TESTSRC}${FS}..${FS}PKCS11Test.java\n-\n-TEST_ARGS=\"${TESTVMOPTS} ${TESTJAVAOPTS} -classpath ${TESTCLASSPATH} \\\n-        --add-modules jdk.crypto.cryptoki \\\n-        --add-exports jdk.crypto.cryptoki\/sun.security.pkcs11=ALL-UNNAMED \\\n-        -DCUSTOM_DB_DIR=${TESTCLASSES} \\\n-        -DCUSTOM_P11_CONFIG=${TESTSRC}${FS}MultipleLogins-nss.txt \\\n-        -Dtest.src=${TESTSRC} \\\n-        -Dtest.classes=${TESTCLASSES} \\\n-        -Djava.security.debug=${DEBUG}\"\n-\n-# run test without security manager\n-${TESTJAVA}${FS}bin${FS}java ${TEST_ARGS} MultipleLogins || exit 10\n-\n-echo Done\n-exit 0\n","filename":"test\/jdk\/sun\/security\/pkcs11\/Provider\/MultipleLogins.sh","additions":0,"deletions":139,"binary":false,"changes":139,"status":"deleted"}]}