{"files":[{"patch":"@@ -185,6 +185,0 @@\n-static void print_local_time(outputStream* output) {\n-  char buf[32];\n-  output->print_cr(\"%s\", os::local_time_string(buf, sizeof(buf)));\n-}\n-\n-\n@@ -235,4 +229,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -259,4 +249,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -411,4 +397,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -431,4 +413,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -440,4 +418,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -517,4 +491,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -568,4 +538,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -596,0 +562,6 @@\n+static void print_local_time(outputStream* output) {\n+  char buf[32];\n+  output->print_cr(\"%s\", os::local_time_string(buf, sizeof(buf)));\n+}\n+\n+\n@@ -597,2 +569,5 @@\n-  \/\/ always timestamp\n-  print_local_time(output());\n+  \/\/ Timestamping is handled by the calle.\n+  \/\/ Stay backwards compatible in cases where timestamp is not requested explicitly.\n+  if (JcmdOptions::TimeStamp::Default == commonOptions.timestamp) {\n+    print_local_time(output());\n+  }\n@@ -837,4 +812,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -874,4 +845,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -883,4 +850,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -892,4 +855,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -900,4 +859,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -930,4 +885,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -955,3 +906,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n@@ -972,3 +920,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n@@ -1012,3 +957,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n@@ -1052,4 +994,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -1096,4 +1034,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -1240,4 +1174,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -1248,4 +1178,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -1266,4 +1192,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -1279,4 +1201,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n@@ -1295,4 +1213,0 @@\n-  if (commonOptions.timestamp == JcmdOptions::TimeStamp::Yes) {\n-    print_local_time(output());\n-  }\n-\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":11,"deletions":97,"binary":false,"changes":108,"status":"modified"},{"patch":"@@ -389,1 +389,1 @@\n-  JcmdOptions options = {};\n+  JcmdOptions options;\n@@ -466,0 +466,5 @@\n+\n+      if (options.timestamp == JcmdOptions::TimeStamp::Yes){\n+        _out->date_stamp(true, \"\", \"\\n\");\n+      }\n+\n","filename":"src\/hotspot\/share\/services\/diagnosticFramework.cpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -171,1 +171,1 @@\n-    Yes\n+    Yes \/\/ timestamp was explicitly requeted with -T flag\n@@ -174,1 +174,1 @@\n-  TimeStamp timestamp;\n+  TimeStamp timestamp = TimeStamp::Default;\n","filename":"src\/hotspot\/share\/services\/diagnosticFramework.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -29,0 +29,3 @@\n+import jdk.test.lib.dcmd.FileJcmdExecutor;\n+import jdk.test.lib.dcmd.PidJcmdExecutor;\n+import jdk.test.lib.dcmd.JcmdExecutor;\n@@ -34,1 +37,0 @@\n- *\n@@ -36,1 +38,0 @@\n- *\n@@ -42,6 +43,4 @@\n-        TestJcmdTimestamp(\"VM.version\", true \/* -T *\/, true \/* expectTimestamp *\/);\n-        TestJcmdTimestamp(\"VM.version\", false \/* -T *\/, false \/* expectTimestamp *\/);\n-\n-        \/\/ \"Thread.print\" should be unconditionally timestamped\n-        TestJcmdTimestamp(\"Thread.print\", true \/* -T *\/, true \/* expectTimestamp *\/);\n-        TestJcmdTimestamp(\"Thread.print\", false \/* -T *\/, true \/* expectTimestamp *\/);\n+        TestJcmdTimestamp(new PidJcmdExecutor(), \"-T VM.version\", true \/* expectTimestamp *\/);\n+        TestJcmdTimestamp(new PidJcmdExecutor(), \"VM.version\", false \/* expectTimestamp *\/);\n+        TestJcmdTimestamp(new FileJcmdExecutor(), \"-T VM.version\", true \/* expectTimestamp *\/);\n+        TestJcmdTimestamp(new FileJcmdExecutor(), \"VM.version\", false \/* expectTimestamp *\/);\n@@ -50,1 +49,0 @@\n-\n@@ -53,1 +51,2 @@\n-        final String timePattern = \"yyyy-MM-dd HH:mm:ss\";\n+        \/\/ ISO 8601. Example \"2026-01-21T16:58:49.518+0100\"\n+        final String timePattern = \"yyyy-MM-dd'T'HH:mm:ss.SSSZ\";\n@@ -62,4 +61,3 @@\n-    private static void TestJcmdTimestamp(final String command, boolean flaged, boolean expectTimestamp) throws Exception {\n-        final OutputAnalyzer output = flaged\n-                ? JcmdBase.jcmd(new String[] {\"-T\", command})\n-                : JcmdBase.jcmd(new String[] {command});\n+    private static void TestJcmdTimestamp(final JcmdExecutor executor,\n+            final String command,\n+            final boolean expectTimestamp) throws Exception {\n@@ -67,0 +65,1 @@\n+        OutputAnalyzer output = executor.execute(command);\n","filename":"test\/jdk\/sun\/tools\/jcmd\/TestJcmdTimestamp.java","additions":13,"deletions":14,"binary":false,"changes":27,"status":"modified"}]}