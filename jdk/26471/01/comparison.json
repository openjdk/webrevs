{"files":[{"patch":"@@ -27,3 +27,2 @@\n- * @summary To check proper WINDOW_EVENTS are triggered when Frame gains or losses the focus\n- * @library \/lib\/client\n- * @build ExtendedRobot\n+ * @summary To check proper WINDOW_EVENTS are triggered when Frame gains\n+ * or looses the focus\n@@ -39,0 +38,1 @@\n+import java.awt.Robot;\n@@ -46,0 +46,2 @@\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -49,9 +51,9 @@\n-    private Frame frame, frame2;\n-    private Button button, button2;\n-    private TextField textField, textField2;\n-    private volatile int eventType;\n-    private final Object lock1 = new Object();\n-    private final Object lock2 = new Object();\n-    private final Object lock3 = new Object();\n-    private boolean passed = true;\n-    private final int delay = 150;\n+    private static Frame frame, frame2;\n+    private static Button button, button2;\n+    private static TextField textField, textField2;\n+    private static volatile int eventType;\n+\n+    private static CountDownLatch windowActivatedLatch = new CountDownLatch(1);\n+    private static CountDownLatch windowDeactivatedLatch = new CountDownLatch(1);\n+    private static CountDownLatch windowFocusGainedLatch = new CountDownLatch(1);\n+    private static boolean passed = true;\n@@ -60,1 +62,0 @@\n-        ActiveAWTWindowTest test = new ActiveAWTWindowTest();\n@@ -62,1 +63,6 @@\n-            test.doTest();\n+            EventQueue.invokeAndWait(() -> {\n+                initializeGUI();\n+            });\n+            doTest();\n+        } catch (Exception e) {\n+            throw new RuntimeException(\"Unexpected Exception encountered.\");\n@@ -65,2 +71,2 @@\n-                if (test.frame != null) {\n-                    test.frame.dispose();\n+                if (frame != null) {\n+                    frame.dispose();\n@@ -68,2 +74,2 @@\n-                if (test.frame2 != null) {\n-                    test.frame2.dispose();\n+                if (frame2 != null) {\n+                    frame2.dispose();\n@@ -75,12 +81,1 @@\n-    public ActiveAWTWindowTest() {\n-        try{\n-            EventQueue.invokeAndWait( () -> {\n-                    initializeGUI();\n-            });\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            throw new RuntimeException(\"Interrupted or unexpected Exception occured\");\n-        }\n-    }\n-\n-    private void initializeGUI() {\n+    private static void initializeGUI() {\n@@ -89,1 +84,0 @@\n-\n@@ -93,0 +87,1 @@\n+\n@@ -94,0 +89,1 @@\n+            @Override\n@@ -96,7 +92,1 @@\n-                synchronized (lock3) {\n-                    try {\n-                        lock3.notifyAll();\n-                    } catch (Exception ex) {\n-                        ex.printStackTrace();\n-                    }\n-                }\n+                windowFocusGainedLatch.countDown();\n@@ -105,0 +95,1 @@\n+            @Override\n@@ -106,1 +97,1 @@\n-                    System.out.println(\"Frame Focus lost\");\n+                System.out.println(\"Frame Focus lost\");\n@@ -109,0 +100,1 @@\n+\n@@ -110,0 +102,1 @@\n+            @Override\n@@ -112,8 +105,2 @@\n-                System.out.println(\"Undecorated Frame is activated\\n\");\n-                synchronized (lock1) {\n-                    try {\n-                        lock1.notifyAll();\n-                    } catch (Exception ex) {\n-                        ex.printStackTrace();\n-                    }\n-                }\n+                System.out.println(\"Undecorated Frame is activated\");\n+                windowActivatedLatch.countDown();\n@@ -122,0 +109,1 @@\n+            @Override\n@@ -124,8 +112,2 @@\n-                System.out.println(\"Undecorated Frame got Deactivated\\n\");\n-                synchronized (lock2) {\n-                    try {\n-                        lock2.notifyAll();\n-                    } catch (Exception ex) {\n-                        ex.printStackTrace();\n-                    }\n-                }\n+                System.out.println(\"Undecorated Frame got Deactivated\");\n+                windowDeactivatedLatch.countDown();\n@@ -134,0 +116,1 @@\n+\n@@ -137,0 +120,1 @@\n+            @Override\n@@ -152,0 +136,1 @@\n+\n@@ -155,0 +140,1 @@\n+            @Override\n@@ -163,2 +149,0 @@\n-\n-        frame.toFront();\n@@ -167,2 +151,2 @@\n-    public void doTest() {\n-        ExtendedRobot robot;\n+    private static void doTest() {\n+        Robot robot;\n@@ -170,1 +154,1 @@\n-            robot = new ExtendedRobot();\n+            robot = new Robot();\n@@ -172,1 +156,0 @@\n-            e.printStackTrace();\n@@ -175,2 +158,1 @@\n-\n-        robot.setAutoDelay(delay);\n+        robot.setAutoDelay(150);\n@@ -178,0 +160,8 @@\n+        try {\n+            if (!windowFocusGainedLatch.await(1500, TimeUnit.MILLISECONDS)) {\n+                passed = false;\n+            }\n+        } catch (InterruptedException e) {\n+            Thread.currentThread().interrupt();\n+            throw new RuntimeException(\"Interrupted while waiting for focus\");\n+        }\n@@ -179,3 +169,3 @@\n-        robot.waitForIdle(5*delay);\n-        robot.mouseMove(button.getLocationOnScreen().x + button.getSize().width \/ 2,\n-                        button.getLocationOnScreen().y + button.getSize().height \/ 2);\n+        robot.mouseMove(\n+            button.getLocationOnScreen().x + button.getSize().width \/ 2,\n+            button.getLocationOnScreen().y + button.getSize().height \/ 2);\n@@ -186,6 +176,5 @@\n-            synchronized (lock1) {\n-                try {\n-                    lock1.wait(delay * 10);\n-                } catch (Exception e) {\n-                    e.printStackTrace();\n-                }\n+            try {\n+                windowActivatedLatch.await(1500, TimeUnit.MILLISECONDS);\n+            } catch (Exception e) {\n+                throw new RuntimeException(\"Unexpected Exception: \"\n+                    + \"waiting on WINDOW_ACTIVATED event\");\n@@ -196,2 +185,0 @@\n-            System.err.println(\"WINDOW_ACTIVATED event did not occur when the \" +\n-                    \"undecorated frame is activated!\");\n@@ -199,1 +186,0 @@\n-\n@@ -202,2 +188,3 @@\n-        robot.mouseMove(button2.getLocationOnScreen().x + button2.getSize().width \/ 2,\n-                        button2.getLocationOnScreen().y + button2.getSize().height \/ 2);\n+        robot.mouseMove(\n+            button2.getLocationOnScreen().x + button2.getSize().width \/ 2,\n+            button2.getLocationOnScreen().y + button2.getSize().height \/ 2);\n@@ -208,5 +195,5 @@\n-            synchronized (lock2) {\n-                try {\n-                    lock2.wait(delay * 10);\n-                } catch (Exception e) {\n-                }\n+            try {\n+                windowDeactivatedLatch.await(1500, TimeUnit.MILLISECONDS);\n+            } catch (Exception e) {\n+                throw new RuntimeException(\"Unexpected Exception: \"\n+                    + \"waiting on WINDOW_DEACTIVATED event\");\n@@ -217,2 +204,0 @@\n-            System.err.println(\"FAIL: WINDOW_DEACTIVATED event did not occur for the \" +\n-                    \"undecorated frame when another frame gains focus!\");\n@@ -222,2 +207,0 @@\n-            System.err.println(\"FAIL: The undecorated frame has focus even when \" +\n-                        \"another frame is clicked!\");\n@@ -225,1 +208,0 @@\n-\n@@ -227,2 +209,0 @@\n-            \/\/captureScreenAndSave();\n-            System.err.println(\"Test failed!\");\n@@ -230,2 +210,0 @@\n-        } else {\n-            System.out.println(\"Test passed\");\n@@ -235,0 +213,1 @@\n+\n","filename":"test\/jdk\/java\/awt\/Frame\/MiscUndecorated\/ActiveAWTWindowTest.java","additions":70,"deletions":91,"binary":false,"changes":161,"status":"modified"}]}