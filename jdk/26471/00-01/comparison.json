{"files":[{"patch":"@@ -29,2 +29,0 @@\n- * @library \/lib\/client\n- * @build ExtendedRobot\n@@ -40,0 +38,1 @@\n+import java.awt.Robot;\n@@ -47,1 +46,0 @@\n-\n@@ -53,9 +51,9 @@\n-    private Frame frame, frame2;\n-    private Button button, button2;\n-    private TextField textField, textField2;\n-    private volatile int eventType;\n-    private static final CountDownLatch windowActivatedLatch = new CountDownLatch(1);\n-    private static final CountDownLatch windowDeactivatedLatch = new CountDownLatch(1);\n-    private static final CountDownLatch windowFocusGainedLatch = new CountDownLatch(1);\n-    private boolean passed = true;\n-    private final int delay = 150;\n+    private static Frame frame, frame2;\n+    private static Button button, button2;\n+    private static TextField textField, textField2;\n+    private static volatile int eventType;\n+\n+    private static CountDownLatch windowActivatedLatch = new CountDownLatch(1);\n+    private static CountDownLatch windowDeactivatedLatch = new CountDownLatch(1);\n+    private static CountDownLatch windowFocusGainedLatch = new CountDownLatch(1);\n+    private static boolean passed = true;\n@@ -64,1 +62,0 @@\n-        ActiveAWTWindowTest test = new ActiveAWTWindowTest();\n@@ -66,1 +63,6 @@\n-            test.doTest();\n+            EventQueue.invokeAndWait(() -> {\n+                initializeGUI();\n+            });\n+            doTest();\n+        } catch (Exception e) {\n+            throw new RuntimeException(\"Unexpected Exception encountered.\");\n@@ -69,2 +71,2 @@\n-                if (test.frame != null) {\n-                    test.frame.dispose();\n+                if (frame != null) {\n+                    frame.dispose();\n@@ -72,2 +74,2 @@\n-                if (test.frame2 != null) {\n-                    test.frame2.dispose();\n+                if (frame2 != null) {\n+                    frame2.dispose();\n@@ -79,12 +81,1 @@\n-    public ActiveAWTWindowTest() {\n-        try{\n-            EventQueue.invokeAndWait( () -> {\n-                    initializeGUI();\n-            });\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            throw new RuntimeException(\"Interrupted or unexpected Exception occured\");\n-        }\n-    }\n-\n-    private void initializeGUI() {\n+    private static void initializeGUI() {\n@@ -93,1 +84,0 @@\n-\n@@ -97,0 +87,1 @@\n+\n@@ -98,0 +89,1 @@\n+            @Override\n@@ -103,0 +95,1 @@\n+            @Override\n@@ -104,1 +97,1 @@\n-                    System.out.println(\"Frame Focus lost\");\n+                System.out.println(\"Frame Focus lost\");\n@@ -107,0 +100,1 @@\n+\n@@ -108,0 +102,1 @@\n+            @Override\n@@ -110,1 +105,1 @@\n-                System.out.println(\"Undecorated Frame is activated\\n\");\n+                System.out.println(\"Undecorated Frame is activated\");\n@@ -114,0 +109,1 @@\n+            @Override\n@@ -116,1 +112,1 @@\n-                System.out.println(\"Undecorated Frame got Deactivated\\n\");\n+                System.out.println(\"Undecorated Frame got Deactivated\");\n@@ -120,0 +116,1 @@\n+\n@@ -123,0 +120,1 @@\n+            @Override\n@@ -138,0 +136,1 @@\n+\n@@ -141,0 +140,1 @@\n+            @Override\n@@ -149,2 +149,0 @@\n-\n-        frame.toFront();\n@@ -153,2 +151,2 @@\n-    public void doTest() {\n-        ExtendedRobot robot;\n+    private static void doTest() {\n+        Robot robot;\n@@ -156,1 +154,1 @@\n-            robot = new ExtendedRobot();\n+            robot = new Robot();\n@@ -158,1 +156,0 @@\n-            e.printStackTrace();\n@@ -161,2 +158,1 @@\n-\n-        robot.setAutoDelay(delay);\n+        robot.setAutoDelay(150);\n@@ -164,0 +160,8 @@\n+        try {\n+            if (!windowFocusGainedLatch.await(1500, TimeUnit.MILLISECONDS)) {\n+                passed = false;\n+            }\n+        } catch (InterruptedException e) {\n+            Thread.currentThread().interrupt();\n+            throw new RuntimeException(\"Interrupted while waiting for focus\");\n+        }\n@@ -165,3 +169,3 @@\n-        robot.waitForIdle(5*delay);\n-        robot.mouseMove(button.getLocationOnScreen().x + button.getSize().width \/ 2,\n-                        button.getLocationOnScreen().y + button.getSize().height \/ 2);\n+        robot.mouseMove(\n+            button.getLocationOnScreen().x + button.getSize().width \/ 2,\n+            button.getLocationOnScreen().y + button.getSize().height \/ 2);\n@@ -173,1 +177,1 @@\n-                windowActivatedLatch.await(delay * 10, TimeUnit.MILLISECONDS);\n+                windowActivatedLatch.await(1500, TimeUnit.MILLISECONDS);\n@@ -175,1 +179,2 @@\n-                e.printStackTrace();\n+                throw new RuntimeException(\"Unexpected Exception: \"\n+                    + \"waiting on WINDOW_ACTIVATED event\");\n@@ -180,2 +185,0 @@\n-            System.err.println(\"WINDOW_ACTIVATED event did not occur when the \" +\n-                    \"undecorated frame is activated!\");\n@@ -183,1 +186,0 @@\n-\n@@ -186,2 +188,3 @@\n-        robot.mouseMove(button2.getLocationOnScreen().x + button2.getSize().width \/ 2,\n-                        button2.getLocationOnScreen().y + button2.getSize().height \/ 2);\n+        robot.mouseMove(\n+            button2.getLocationOnScreen().x + button2.getSize().width \/ 2,\n+            button2.getLocationOnScreen().y + button2.getSize().height \/ 2);\n@@ -193,1 +196,1 @@\n-                windowDeactivatedLatch.await(delay * 10, TimeUnit.MILLISECONDS);\n+                windowDeactivatedLatch.await(1500, TimeUnit.MILLISECONDS);\n@@ -195,0 +198,2 @@\n+                throw new RuntimeException(\"Unexpected Exception: \"\n+                    + \"waiting on WINDOW_DEACTIVATED event\");\n@@ -199,2 +204,0 @@\n-            System.err.println(\"FAIL: WINDOW_DEACTIVATED event did not occur for the \" +\n-                    \"undecorated frame when another frame gains focus!\");\n@@ -204,2 +207,0 @@\n-            System.err.println(\"FAIL: The undecorated frame has focus even when \" +\n-                        \"another frame is clicked!\");\n@@ -207,1 +208,0 @@\n-\n@@ -209,2 +209,0 @@\n-            \/\/captureScreenAndSave();\n-            System.err.println(\"Test failed!\");\n@@ -212,2 +210,0 @@\n-        } else {\n-            System.out.println(\"Test passed\");\n@@ -217,0 +213,1 @@\n+\n","filename":"test\/jdk\/java\/awt\/Frame\/MiscUndecorated\/ActiveAWTWindowTest.java","additions":59,"deletions":62,"binary":false,"changes":121,"status":"modified"}]}