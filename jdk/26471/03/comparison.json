{"files":[{"patch":"@@ -27,3 +27,2 @@\n- * @summary To check proper WINDOW_EVENTS are triggered when Frame gains or losses the focus\n- * @library \/lib\/client\n- * @build ExtendedRobot\n+ * @summary To check proper WINDOW_EVENTS are triggered when Frame gains\n+ * or looses the focus\n@@ -33,0 +32,1 @@\n+import java.awt.AWTException;\n@@ -39,0 +39,1 @@\n+import java.awt.Robot;\n@@ -46,0 +47,2 @@\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -49,9 +52,4 @@\n-    private Frame frame, frame2;\n-    private Button button, button2;\n-    private TextField textField, textField2;\n-    private volatile int eventType;\n-    private final Object lock1 = new Object();\n-    private final Object lock2 = new Object();\n-    private final Object lock3 = new Object();\n-    private boolean passed = true;\n-    private final int delay = 150;\n+    private static Frame frame, frame2;\n+    private static Button button, button2;\n+    private static TextField textField, textField2;\n+    private static volatile int eventType;\n@@ -59,15 +57,4 @@\n-    public static void main(String[] args) throws Exception {\n-        ActiveAWTWindowTest test = new ActiveAWTWindowTest();\n-        try {\n-            test.doTest();\n-        } finally {\n-            EventQueue.invokeAndWait(() -> {\n-                if (test.frame != null) {\n-                    test.frame.dispose();\n-                }\n-                if (test.frame2 != null) {\n-                    test.frame2.dispose();\n-                }\n-            });\n-        }\n-    }\n+    private static CountDownLatch windowActivatedLatch = new CountDownLatch(1);\n+    private static CountDownLatch windowDeactivatedLatch = new CountDownLatch(1);\n+    private static CountDownLatch windowFocusGainedLatch = new CountDownLatch(1);\n+    private static boolean passed = true;\n@@ -75,9 +62,13 @@\n-    public ActiveAWTWindowTest() {\n-        try{\n-            EventQueue.invokeAndWait( () -> {\n-                    initializeGUI();\n-            });\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            throw new RuntimeException(\"Interrupted or unexpected Exception occured\");\n-        }\n+    public static void main(String[] args) throws Exception {\n+        EventQueue.invokeAndWait(() -> {\n+            initializeGUI();\n+        });\n+        doTest();\n+        EventQueue.invokeAndWait(() -> {\n+            if (frame != null) {\n+                frame.dispose();\n+            }\n+            if (frame2 != null) {\n+                frame2.dispose();\n+            }\n+        });\n@@ -86,1 +77,1 @@\n-    private void initializeGUI() {\n+    private static void initializeGUI() {\n@@ -89,1 +80,0 @@\n-\n@@ -93,0 +83,1 @@\n+\n@@ -94,0 +85,1 @@\n+            @Override\n@@ -96,7 +88,1 @@\n-                synchronized (lock3) {\n-                    try {\n-                        lock3.notifyAll();\n-                    } catch (Exception ex) {\n-                        ex.printStackTrace();\n-                    }\n-                }\n+                windowFocusGainedLatch.countDown();\n@@ -105,0 +91,1 @@\n+            @Override\n@@ -106,1 +93,1 @@\n-                    System.out.println(\"Frame Focus lost\");\n+                System.out.println(\"Frame Focus lost\");\n@@ -109,0 +96,1 @@\n+\n@@ -110,0 +98,1 @@\n+            @Override\n@@ -112,8 +101,2 @@\n-                System.out.println(\"Undecorated Frame is activated\\n\");\n-                synchronized (lock1) {\n-                    try {\n-                        lock1.notifyAll();\n-                    } catch (Exception ex) {\n-                        ex.printStackTrace();\n-                    }\n-                }\n+                System.out.println(\"Undecorated Frame is activated\");\n+                windowActivatedLatch.countDown();\n@@ -122,0 +105,1 @@\n+            @Override\n@@ -124,8 +108,2 @@\n-                System.out.println(\"Undecorated Frame got Deactivated\\n\");\n-                synchronized (lock2) {\n-                    try {\n-                        lock2.notifyAll();\n-                    } catch (Exception ex) {\n-                        ex.printStackTrace();\n-                    }\n-                }\n+                System.out.println(\"Undecorated Frame got Deactivated\");\n+                windowDeactivatedLatch.countDown();\n@@ -134,0 +112,1 @@\n+\n@@ -136,5 +115,1 @@\n-        button.addActionListener(new ActionListener() {\n-            public void actionPerformed(ActionEvent e) {\n-                textField.setText(\"Focus gained\");\n-            }\n-        });\n+        button.addActionListener(e -> textField.setText(\"Focus gained\"));\n@@ -152,0 +127,1 @@\n+\n@@ -154,5 +130,1 @@\n-        button2.addActionListener(new ActionListener() {\n-            public void actionPerformed(ActionEvent e) {\n-                textField2.setText(\"Got the focus\");\n-            }\n-        });\n+        button2.addActionListener(e -> textField2.setText(\"Got the focus\"));\n@@ -163,2 +135,0 @@\n-\n-        frame.toFront();\n@@ -167,10 +137,3 @@\n-    public void doTest() {\n-        ExtendedRobot robot;\n-        try {\n-            robot = new ExtendedRobot();\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            throw new RuntimeException(\"Cannot create robot\");\n-        }\n-\n-        robot.setAutoDelay(delay);\n+    private static void doTest() throws AWTException, InterruptedException  {\n+        Robot robot = new Robot();\n+        robot.setAutoDelay(150);\n@@ -178,4 +141,6 @@\n-\n-        robot.waitForIdle(5*delay);\n-        robot.mouseMove(button.getLocationOnScreen().x + button.getSize().width \/ 2,\n-                        button.getLocationOnScreen().y + button.getSize().height \/ 2);\n+        if (!windowFocusGainedLatch.await(1500, TimeUnit.MILLISECONDS)) {\n+                passed = false;\n+        }\n+        robot.mouseMove(\n+            button.getLocationOnScreen().x + button.getSize().width \/ 2,\n+            button.getLocationOnScreen().y + button.getSize().height \/ 2);\n@@ -186,7 +151,1 @@\n-            synchronized (lock1) {\n-                try {\n-                    lock1.wait(delay * 10);\n-                } catch (Exception e) {\n-                    e.printStackTrace();\n-                }\n-            }\n+            windowActivatedLatch.await(1500, TimeUnit.MILLISECONDS);\n@@ -196,2 +155,0 @@\n-            System.err.println(\"WINDOW_ACTIVATED event did not occur when the \" +\n-                    \"undecorated frame is activated!\");\n@@ -199,1 +156,0 @@\n-\n@@ -202,2 +158,3 @@\n-        robot.mouseMove(button2.getLocationOnScreen().x + button2.getSize().width \/ 2,\n-                        button2.getLocationOnScreen().y + button2.getSize().height \/ 2);\n+        robot.mouseMove(\n+            button2.getLocationOnScreen().x + button2.getSize().width \/ 2,\n+            button2.getLocationOnScreen().y + button2.getSize().height \/ 2);\n@@ -208,6 +165,1 @@\n-            synchronized (lock2) {\n-                try {\n-                    lock2.wait(delay * 10);\n-                } catch (Exception e) {\n-                }\n-            }\n+            windowDeactivatedLatch.await(1500, TimeUnit.MILLISECONDS);\n@@ -217,2 +169,0 @@\n-            System.err.println(\"FAIL: WINDOW_DEACTIVATED event did not occur for the \" +\n-                    \"undecorated frame when another frame gains focus!\");\n@@ -222,2 +172,0 @@\n-            System.err.println(\"FAIL: The undecorated frame has focus even when \" +\n-                        \"another frame is clicked!\");\n@@ -225,1 +173,0 @@\n-\n@@ -227,2 +174,0 @@\n-            \/\/captureScreenAndSave();\n-            System.err.println(\"Test failed!\");\n@@ -230,2 +175,0 @@\n-        } else {\n-            System.out.println(\"Test passed\");\n@@ -235,0 +178,1 @@\n+\n","filename":"test\/jdk\/java\/awt\/Frame\/MiscUndecorated\/ActiveAWTWindowTest.java","additions":59,"deletions":115,"binary":false,"changes":174,"status":"modified"}]}