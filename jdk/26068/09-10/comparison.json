{"files":[{"patch":"@@ -284,4 +284,16 @@\n-        if (j < use->req())\n-          use->set_req(j, nn);\n-        else\n-          use->set_prec(j, nn);\n+        if (use != nn || use->is_CFG() || use->is_Phi() || use->is_Mach()) {\n+          if (j < use->req()) {\n+            use->set_req(j, nn);\n+          } else {\n+            use->set_prec(j, nn);\n+          }\n+        } else {\n+          \/\/ Avoid linking node with itself, drop the input instead.\n+          \/\/ Roll the IV back a bit to revisit the now-j-th node.\n+          if (j < use->req()) {\n+            use->del_req(j);\n+          } else {\n+            use->rm_prec(j);\n+          }\n+          j--;\n+        }\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":16,"deletions":4,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -468,0 +468,1 @@\n+    assert( this != n || is_CFG() || is_Phi() || is_Mach(), \"cannot create input loops\");\n@@ -480,0 +481,1 @@\n+    assert( this != n || is_CFG() || is_Phi() || is_Mach(), \"cannot create input loops\");\n","filename":"src\/hotspot\/share\/opto\/node.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -490,3 +490,3 @@\n-  \/\/ Remove all elements up to the index (exclusive). The order is preserved.\n-  void remove_till(int idx) {\n-    remove_range(0, idx);\n+  \/\/ Remove all elements in the range [0; end). The order is preserved.\n+  void remove_till(int end) {\n+    remove_range(0, end);\n@@ -495,1 +495,1 @@\n-  \/\/ Remove all elements in the range [start - end). The order is preserved.\n+  \/\/ Remove all elements in the range [start; end). The order is preserved.\n@@ -498,2 +498,2 @@\n-    assert(start < end && end <= this->_len,\n-           \"erase called with invalid range (%d, %d) for length %d\",\n+    assert(start <= end && end <= this->_len,\n+           \"erase called with invalid range [%d, %d) for length %d\",\n","filename":"src\/hotspot\/share\/utilities\/growableArray.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -235,0 +235,97 @@\n+  template <typename ArrayClass>\n+  static void test_remove_range(ArrayClass* a) {\n+    \/\/ Seed initial\n+    for (int i = 0; i < 10; i++) {\n+      a->append(i);\n+    }\n+    ASSERT_EQ(a->length(), 10);\n+\n+    \/\/ Remove empty range from the non-empty list, should not modify the list.\n+    a->remove_range(0, 0);\n+    ASSERT_EQ(a->length(), 10);\n+\n+    \/\/ Remove one element from head, should result in [1 ... 9]\n+    a->remove_range(0, 1);\n+    ASSERT_EQ(a->length(), 9);\n+    for (int i = 0; i < a->length(); i++) {\n+      ASSERT_EQ(a->at(i), i + 1);\n+    }\n+\n+    \/\/ Remove one element from tail, should result in [1 ... 8]\n+    a->remove_range(8, 9);\n+    ASSERT_EQ(a->length(), 8);\n+    for (int i = 0; i < a->length(); i++) {\n+      ASSERT_EQ(a->at(i), i + 1);\n+    }\n+\n+    \/\/ Remove another empty range from the non-empty list, should not modify\n+    a->remove_range(1, 1);\n+    ASSERT_EQ(a->length(), 8);\n+\n+    \/\/ Remove some elements from the middle, should result in [1 2 7 8]\n+    a->remove_range(2, 6);\n+    ASSERT_EQ(a->length(), 4);\n+    ASSERT_EQ(a->at(0), 1);\n+    ASSERT_EQ(a->at(1), 2);\n+    ASSERT_EQ(a->at(2), 7);\n+    ASSERT_EQ(a->at(3), 8);\n+\n+    \/\/ Remove the rest of the elements one by one\n+    a->remove_range(0, 1);\n+    ASSERT_EQ(a->length(), 3);\n+    ASSERT_EQ(a->at(0), 2);\n+    ASSERT_EQ(a->at(1), 7);\n+    ASSERT_EQ(a->at(2), 8);\n+\n+    a->remove_range(0, 1);\n+    ASSERT_EQ(a->length(), 2);\n+    ASSERT_EQ(a->at(0), 7);\n+    ASSERT_EQ(a->at(1), 8);\n+\n+    a->remove_range(0, 1);\n+    ASSERT_EQ(a->length(), 1);\n+    ASSERT_EQ(a->at(0), 8);\n+\n+    a->remove_range(0, 1);\n+    ASSERT_EQ(a->length(), 0);\n+\n+    \/\/ Remove elements from empty list with empty range, should be accepted\n+    a->remove_range(0, 0);\n+    ASSERT_EQ(a->length(), 0);\n+  }\n+\n+  template <typename ArrayClass>\n+  static void test_remove_till(ArrayClass* a) {\n+    \/\/ Seed initial\n+    for (int i = 0; i < 10; i++) {\n+      a->append(i);\n+    }\n+    ASSERT_EQ(a->length(), 10);\n+\n+    \/\/ Remove empty range from non-empty list, should work\n+    a->remove_till(0);\n+    ASSERT_EQ(a->length(), 10);\n+\n+    \/\/ Remove one element from head, should result in [1 ... 9]\n+    a->remove_till(1);\n+    ASSERT_EQ(a->length(), 9);\n+    for (int i = 0; i < a->length(); i++) {\n+      ASSERT_EQ(a->at(i), i + 1);\n+    }\n+\n+    \/\/ Remove two elements from head, should result in [3 ... 9]\n+    a->remove_till(2);\n+    ASSERT_EQ(a->length(), 7);\n+    for (int i = 0; i < a->length(); i++) {\n+      ASSERT_EQ(a->at(i), i + 3);\n+    }\n+\n+    \/\/ Remove remaining elements, should result in []\n+    a->remove_till(a->length());\n+    ASSERT_EQ(a->length(), 0);\n+\n+    \/\/ Remove empty range from empty list, should work\n+    a->remove_till(0);\n+    ASSERT_EQ(a->length(), 0);\n+  }\n+\n@@ -240,1 +337,3 @@\n-    Iterator\n+    Iterator,\n+    RemoveRange,\n+    RemoveTill\n@@ -262,0 +361,8 @@\n+      case RemoveRange:\n+        test_remove_range(a);\n+        break;\n+\n+      case RemoveTill:\n+        test_remove_till(a);\n+        break;\n+\n@@ -454,0 +561,8 @@\n+TEST_VM_F(GrowableArrayTest, remove_range) {\n+  with_all_types_all_0(RemoveRange);\n+}\n+\n+TEST_VM_F(GrowableArrayTest, remove_till) {\n+  with_all_types_all_0(RemoveTill);\n+}\n+\n","filename":"test\/hotspot\/gtest\/utilities\/test_growableArray.cpp","additions":116,"deletions":1,"binary":false,"changes":117,"status":"modified"}]}