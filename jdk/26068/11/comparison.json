{"files":[{"patch":"@@ -605,0 +605,5 @@\n+  \/\/ Xcomp has no reasonable profiling information, enable inlining cold methods\n+  if (Arguments::is_compiler_only() && FLAG_IS_DEFAULT(InlineColdMethods)) {\n+    FLAG_SET_DEFAULT(InlineColdMethods, true);\n+  }\n+\n","filename":"src\/hotspot\/share\/compiler\/compilerDefinitions.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -391,0 +391,6 @@\n+  product(bool, InlineColdMethods, false, DIAGNOSTIC,                       \\\n+          \"Inline cold methods that would otherwise be rejected due to \"    \\\n+          \"cold profile counters. Useful for compiler testing to expose \"   \\\n+          \"more code to compilers.\")                                        \\\n+                                                                            \\\n+\n","filename":"src\/hotspot\/share\/compiler\/compiler_globals.hpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -298,7 +298,4 @@\n-  \/\/ don't use counts with -Xcomp\n-  if (UseInterpreter) {\n-    if (!callee_method->has_compiled_code() &&\n-        !callee_method->was_executed_more_than(0)) {\n-      set_msg(\"never executed\");\n-      return true;\n-    }\n+  \/\/ accept cold methods in CTW or -Xcomp\n+  if (InlineColdMethods) {\n+    return false;\n+  }\n@@ -306,4 +303,5 @@\n-    if (is_init_with_ea(callee_method, caller_method, C)) {\n-      \/\/ Escape Analysis: inline all executed constructors\n-      return false;\n-    }\n+  if (!callee_method->has_compiled_code() &&\n+      !callee_method->was_executed_more_than(0)) {\n+    set_msg(\"never executed\");\n+    return true;\n+  }\n@@ -311,13 +309,17 @@\n-    if (MinInlineFrequencyRatio > 0) {\n-      int call_site_count  = caller_method->scale_count(profile.count());\n-      int invoke_count     = caller_method->interpreter_invocation_count();\n-      assert(invoke_count != 0, \"require invocation count greater than zero\");\n-      double freq = (double)call_site_count \/ (double)invoke_count;\n-      \/\/ avoid division by 0, set divisor to at least 1\n-      int cp_min_inv = MAX2(1, CompilationPolicy::min_invocations());\n-      double min_freq = MAX2(MinInlineFrequencyRatio, 1.0 \/ cp_min_inv);\n-\n-      if (freq < min_freq) {\n-        set_msg(\"low call site frequency\");\n-        return true;\n-      }\n+  if (is_init_with_ea(callee_method, caller_method, C)) {\n+    \/\/ Escape Analysis: inline all executed constructors\n+    return false;\n+  }\n+\n+  if (MinInlineFrequencyRatio > 0) {\n+    int call_site_count  = caller_method->scale_count(profile.count());\n+    int invoke_count     = caller_method->interpreter_invocation_count();\n+    assert(invoke_count != 0, \"require invocation count greater than zero\");\n+    double freq = (double)call_site_count \/ (double)invoke_count;\n+    \/\/ avoid division by 0, set divisor to at least 1\n+    int cp_min_inv = MAX2(1, CompilationPolicy::min_invocations());\n+    double min_freq = MAX2(MinInlineFrequencyRatio, 1.0 \/ cp_min_inv);\n+\n+    if (freq < min_freq) {\n+      set_msg(\"low call site frequency\");\n+      return true;\n@@ -331,2 +333,2 @@\n-  if (!UseInterpreter) {\n-    return false; \/\/ -Xcomp\n+  if (InlineColdMethods) {\n+    return false; \/\/ CTW or -Xcomp\n@@ -406,1 +408,1 @@\n-    if (!UseInterpreter &&\n+    if (InlineColdMethods &&\n","filename":"src\/hotspot\/share\/opto\/bytecodeInfo.cpp","additions":29,"deletions":27,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -2101,0 +2101,1 @@\n+  assert(_late_inlines.length() > 0, \"should have been checked by caller\");\n@@ -2212,0 +2213,4 @@\n+    if (_late_inlines.length() == 0) {\n+      break; \/\/ no more progress\n+    }\n+\n@@ -2222,4 +2227,0 @@\n-\n-    if (_late_inlines.length() == 0) {\n-      break; \/\/ no more progress\n-    }\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -468,0 +468,1 @@\n+    assert( this != n || is_CFG() || is_Phi() || is_Mach(), \"cannot create input loops\");\n@@ -480,0 +481,1 @@\n+    assert( this != n || is_CFG() || is_Phi() || is_Mach(), \"cannot create input loops\");\n","filename":"src\/hotspot\/share\/opto\/node.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -310,0 +310,5 @@\n+                \/\/ Artificially expand the scope of inlining in the absence of reasonable profile:\n+                \/\/ inline cold methods and bump the static inlining limits.\n+                \"-XX:+InlineColdMethods\",\n+                \"-XX:MaxInlineSize=50\",\n+                \"-XX:C1MaxInlineSize=50\",\n","filename":"test\/hotspot\/jtreg\/testlibrary\/ctw\/src\/sun\/hotspot\/tools\/ctw\/CtwRunner.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}