{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+#include <fcntl.h>\n@@ -78,11 +79,13 @@\n-    if (fd != -1) {\n-        struct stat buf;\n-        int result;\n-        RESTARTABLE(fstat(fd, &buf), result);\n-        if (result != -1) {\n-            if (S_ISDIR(buf.st_mode)) {\n-                close(fd);\n-                errno = EISDIR;\n-                fd = -1;\n-            }\n-        } else {\n+    \/\/ No further checking is needed if the file is not a\n+    \/\/ directory or open returned an error\n+    if (fd == -1 || ((oflag & O_ACCMODE) != O_RDONLY) != 0) {\n+        return fd;\n+    }\n+\n+    \/\/ FileInputStream is specified to throw if the\n+    \/\/ file is a directory\n+    struct stat buf;\n+    int result;\n+    RESTARTABLE(fstat(fd, &buf), result);\n+    if (result != -1) {\n+        if (S_ISDIR(buf.st_mode)) {\n@@ -90,0 +93,1 @@\n+            errno = EISDIR;\n@@ -92,0 +96,3 @@\n+    } else {\n+        close(fd);\n+        fd = -1;\n","filename":"src\/java.base\/unix\/native\/libjava\/io_util_md.c","additions":19,"deletions":12,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.io.RandomAccessFile;\n@@ -84,0 +85,25 @@\n+    @State(Scope.Benchmark)\n+    @Warmup(iterations = 3, time = 2)\n+    @Measurement(iterations = 5, time = 5)\n+    @BenchmarkMode(Mode.SampleTime)\n+    @OutputTimeUnit(TimeUnit.NANOSECONDS)\n+    @Threads(1)\n+    @Fork(value = 10)\n+    public static class OpenFileForWritingBench {\n+        final byte[] payload = \"something\".getBytes();\n+        final String path = System.getProperty(\"os.name\", \"unknown\").toLowerCase().contains(\"win\") ? \"NUL\" : \"\/dev\/null\";\n+\n+        @Benchmark\n+        public void testFileOutputStream() throws IOException {\n+            try (FileOutputStream f = new FileOutputStream(path)) {\n+                f.write(payload);\n+            }\n+        }\n+\n+        @Benchmark\n+        public void testRandomAccessFile() throws IOException {\n+            try (RandomAccessFile f = new RandomAccessFile(path, \"rw\")) {\n+                f.write(payload);\n+            }\n+        }\n+    }\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/io\/FileWrite.java","additions":27,"deletions":1,"binary":false,"changes":28,"status":"modified"}]}