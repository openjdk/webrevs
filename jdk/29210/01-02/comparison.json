{"files":[{"patch":"@@ -64,1 +64,1 @@\n-import org.junit.jupiter.params.provider.MethodSource;\n+import org.junit.jupiter.params.provider.ValueSource;\n@@ -141,0 +141,5 @@\n+    @ParameterizedTest\n+    @ValueSource(strings = { \"classnotpublic\", \"methodnotpublic\", \"badreturntype\",\n+            \"returnsnull\", \"throwsexception\" })\n+    public void testBadFactory(String testName) throws Exception {\n+        Path mods = compileTest(TEST1_MODULE);\n@@ -142,9 +147,5 @@\n-    public static Object[][] createBadFactories() {\n-        return new Object[][] {\n-                { \"classnotpublic\",     null },\n-                { \"methodnotpublic\",    null },\n-                { \"badreturntype\",      null },\n-                { \"returnsnull\",        null },\n-                { \"throwsexception\",    null },\n-        };\n-    }\n+        \/\/ compile the bad factory\n+        Path source = BADFACTORIES_DIR.resolve(testName);\n+        Path output = Files.createTempDirectory(USER_DIR, \"tmp\");\n+        boolean compiled = CompilerUtils.compile(source, output);\n+        assertTrue(compiled);\n@@ -152,0 +153,5 @@\n+        \/\/ copy the compiled class into the module\n+        Path classFile = Paths.get(\"p\", \"ProviderFactory.class\");\n+        Files.copy(output.resolve(classFile),\n+                mods.resolve(TEST1_MODULE).resolve(classFile),\n+                StandardCopyOption.REPLACE_EXISTING);\n@@ -153,21 +159,4 @@\n-    @ParameterizedTest\n-    @MethodSource(\"createBadFactories\")\n-    public void testBadFactory(String testName, String ignore) throws Exception {\n-        Assertions.assertThrows(ServiceConfigurationError.class, () -> {\n-            Path mods = compileTest(TEST1_MODULE);\n-\n-            \/\/ compile the bad factory\n-            Path source = BADFACTORIES_DIR.resolve(testName);\n-            Path output = Files.createTempDirectory(USER_DIR, \"tmp\");\n-            boolean compiled = CompilerUtils.compile(source, output);\n-            assertTrue(compiled);\n-\n-            \/\/ copy the compiled class into the module\n-            Path classFile = Paths.get(\"p\", \"ProviderFactory.class\");\n-            Files.copy(output.resolve(classFile),\n-                    mods.resolve(TEST1_MODULE).resolve(classFile),\n-                    StandardCopyOption.REPLACE_EXISTING);\n-\n-            \/\/ load providers and instantiate each one\n-            loadProviders(mods, TEST1_MODULE).forEach(Provider::get);\n-        });\n+        Assertions.assertThrows(ServiceConfigurationError.class,\n+                \/\/ load providers and instantiate each one\n+                () -> loadProviders(mods, TEST1_MODULE).forEach(Provider::get)\n+        );\n@@ -176,0 +165,4 @@\n+    @ParameterizedTest\n+    @ValueSource(strings = { \"notpublic\", \"ctornotpublic\", \"notasubtype\", \"throwsexception\" })\n+    public void testBadProvider(String testName) throws Exception {\n+        Path mods = compileTest(TEST2_MODULE);\n@@ -177,8 +170,5 @@\n-    public static Object[][] createBadProviders() {\n-        return new Object[][] {\n-                { \"notpublic\",          null },\n-                { \"ctornotpublic\",      null },\n-                { \"notasubtype\",        null },\n-                { \"throwsexception\",    null }\n-        };\n-    }\n+        \/\/ compile the bad provider\n+        Path source = BADPROVIDERS_DIR.resolve(testName);\n+        Path output = Files.createTempDirectory(USER_DIR, \"tmp\");\n+        boolean compiled = CompilerUtils.compile(source, output);\n+        assertTrue(compiled);\n@@ -186,0 +176,5 @@\n+        \/\/ copy the compiled class into the module\n+        Path classFile = Paths.get(\"p\", \"Provider.class\");\n+        Files.copy(output.resolve(classFile),\n+                mods.resolve(TEST2_MODULE).resolve(classFile),\n+                StandardCopyOption.REPLACE_EXISTING);\n@@ -187,21 +182,4 @@\n-    @ParameterizedTest\n-    @MethodSource(\"createBadProviders\")\n-    public void testBadProvider(String testName, String ignore) throws Exception {\n-        Assertions.assertThrows(ServiceConfigurationError.class, () -> {\n-            Path mods = compileTest(TEST2_MODULE);\n-\n-            \/\/ compile the bad provider\n-            Path source = BADPROVIDERS_DIR.resolve(testName);\n-            Path output = Files.createTempDirectory(USER_DIR, \"tmp\");\n-            boolean compiled = CompilerUtils.compile(source, output);\n-            assertTrue(compiled);\n-\n-            \/\/ copy the compiled class into the module\n-            Path classFile = Paths.get(\"p\", \"Provider.class\");\n-            Files.copy(output.resolve(classFile),\n-                    mods.resolve(TEST2_MODULE).resolve(classFile),\n-                    StandardCopyOption.REPLACE_EXISTING);\n-\n-            \/\/ load providers and instantiate each one\n-            loadProviders(mods, TEST2_MODULE).forEach(Provider::get);\n-        });\n+        Assertions.assertThrows(ServiceConfigurationError.class,\n+                \/\/ load providers and instantiate each one\n+                () -> loadProviders(mods, TEST2_MODULE).forEach(Provider::get)\n+        );\n@@ -217,36 +195,25 @@\n-        Assertions.assertThrows(ServiceConfigurationError.class, () -> {\n-            Path mods = compileTest(TEST1_MODULE);\n-\n-            var bytes = ClassFile.of().build(ClassDesc.of(\"p\", \"ProviderFactory\"), clb -> {\n-                clb.withSuperclass(CD_Object);\n-                clb.withFlags(AccessFlag.PUBLIC, AccessFlag.SUPER);\n-\n-                var providerFactory$1 = ClassDesc.of(\"p\", \"ProviderFactory$1\");\n-\n-                \/\/ public static p.Service provider()\n-                clb.withMethodBody(\"provider\", MethodTypeDesc.of(ClassDesc.of(\"p\", \"Service\")),\n-                        ACC_PUBLIC | ACC_STATIC, cob -> {\n-                            cob.new_(providerFactory$1);\n-                            cob.dup();\n-                            cob.invokespecial(providerFactory$1, INIT_NAME, MTD_void);\n-                            cob.areturn();\n-                        });\n-\n-                \/\/ public static p.ProviderFactory$1 provider()\n-                clb.withMethodBody(\"provider\", MethodTypeDesc.of(providerFactory$1),\n-                        ACC_PUBLIC | ACC_STATIC, cob -> {\n-                            cob.new_(providerFactory$1);\n-                            cob.dup();\n-                            cob.invokespecial(providerFactory$1, INIT_NAME, MTD_void);\n-                            cob.areturn();\n-                        });\n-            });\n-\n-            \/\/ write the class bytes into the compiled module directory\n-            Path classFile = mods.resolve(TEST1_MODULE)\n-                    .resolve(\"p\")\n-                    .resolve(\"ProviderFactory.class\");\n-            Files.write(classFile, bytes);\n-\n-            \/\/ load providers and instantiate each one\n-            loadProviders(mods, TEST1_MODULE).forEach(Provider::get);\n+        Path mods = compileTest(TEST1_MODULE);\n+\n+        var bytes = ClassFile.of().build(ClassDesc.of(\"p\", \"ProviderFactory\"), clb -> {\n+            clb.withSuperclass(CD_Object);\n+            clb.withFlags(AccessFlag.PUBLIC, AccessFlag.SUPER);\n+\n+            var providerFactory$1 = ClassDesc.of(\"p\", \"ProviderFactory$1\");\n+\n+            \/\/ public static p.Service provider()\n+            clb.withMethodBody(\"provider\", MethodTypeDesc.of(ClassDesc.of(\"p\", \"Service\")),\n+                    ACC_PUBLIC | ACC_STATIC, cob -> {\n+                        cob.new_(providerFactory$1);\n+                        cob.dup();\n+                        cob.invokespecial(providerFactory$1, INIT_NAME, MTD_void);\n+                        cob.areturn();\n+                    });\n+\n+            \/\/ public static p.ProviderFactory$1 provider()\n+            clb.withMethodBody(\"provider\", MethodTypeDesc.of(providerFactory$1),\n+                    ACC_PUBLIC | ACC_STATIC, cob -> {\n+                        cob.new_(providerFactory$1);\n+                        cob.dup();\n+                        cob.invokespecial(providerFactory$1, INIT_NAME, MTD_void);\n+                        cob.areturn();\n+                    });\n@@ -254,0 +221,11 @@\n+\n+        \/\/ write the class bytes into the compiled module directory\n+        Path classFile = mods.resolve(TEST1_MODULE)\n+                .resolve(\"p\")\n+                .resolve(\"ProviderFactory.class\");\n+        Files.write(classFile, bytes);\n+\n+        Assertions.assertThrows(ServiceConfigurationError.class,\n+                \/\/ load providers and instantiate each one\n+                () -> loadProviders(mods, TEST1_MODULE).forEach(Provider::get)\n+        );\n","filename":"test\/jdk\/java\/util\/ServiceLoader\/BadProvidersTest.java","additions":74,"deletions":96,"binary":false,"changes":170,"status":"modified"},{"patch":"@@ -445,0 +445,1 @@\n+        class S { }\n@@ -446,1 +447,0 @@\n-            class S { }\n","filename":"test\/jdk\/java\/util\/ServiceLoader\/ModulesTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -68,6 +68,4 @@\n-        Assertions.assertThrows(ConcurrentModificationException.class, () -> {\n-            ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n-            Iterator<ScriptEngineFactory> iterator = sl.iterator();\n-            sl.reload();\n-            iterator.hasNext();\n-        });\n+        ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n+        Iterator<ScriptEngineFactory> iterator = sl.iterator();\n+        sl.reload();\n+        Assertions.assertThrows(ConcurrentModificationException.class, iterator::hasNext);\n@@ -78,7 +76,5 @@\n-        Assertions.assertThrows(ConcurrentModificationException.class, () -> {\n-            ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n-            Iterator<ScriptEngineFactory> iterator = sl.iterator();\n-            assertTrue(iterator.hasNext());\n-            sl.reload();\n-            iterator.next();\n-        });\n+        ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n+        Iterator<ScriptEngineFactory> iterator = sl.iterator();\n+        assertTrue(iterator.hasNext());\n+        sl.reload();\n+        Assertions.assertThrows(ConcurrentModificationException.class, iterator::next);\n@@ -89,6 +85,4 @@\n-        Assertions.assertThrows(ConcurrentModificationException.class, () -> {\n-            ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n-            Stream<Provider<ScriptEngineFactory>> stream = sl.stream();\n-            sl.reload();\n-            stream.findAny();\n-        });\n+        ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n+        Stream<Provider<ScriptEngineFactory>> stream = sl.stream();\n+        sl.reload();\n+        Assertions.assertThrows(ConcurrentModificationException.class, stream::findAny);\n@@ -99,7 +93,6 @@\n-        Assertions.assertThrows(ConcurrentModificationException.class, () -> {\n-            ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n-            Stream<Provider<ScriptEngineFactory>> stream = sl.stream();\n-            Spliterator<Provider<ScriptEngineFactory>> spliterator = stream.spliterator();\n-            sl.reload();\n-            spliterator.tryAdvance(System.out::println);\n-        });\n+        ServiceLoader<ScriptEngineFactory> sl = load(ScriptEngineFactory.class);\n+        Stream<Provider<ScriptEngineFactory>> stream = sl.stream();\n+        Spliterator<Provider<ScriptEngineFactory>> spliterator = stream.spliterator();\n+        sl.reload();\n+        Assertions.assertThrows(ConcurrentModificationException.class,\n+                () -> spliterator.tryAdvance(System.out::println));\n","filename":"test\/jdk\/java\/util\/ServiceLoader\/ReloadTest.java","additions":19,"deletions":26,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -55,0 +55,1 @@\n+import org.junit.jupiter.params.provider.ValueSource;\n@@ -92,1 +93,1 @@\n-    public static Object[][] testCases() {\n+    private static Object[][] testCases() {\n@@ -113,10 +114,0 @@\n-    public static Object[][] negativeTestCases() {\n-        return new Object[][]{\n-            {\"blah blah\"},\n-            {\"9234\"},\n-            {\"X!\"},\n-            {\"BarProvider\"},\n-            {\"FooProvider42\"}\n-        };\n-    }\n-\n@@ -129,2 +120,2 @@\n-    @ParameterizedTest\n-    @MethodSource(\"negativeTestCases\")\n+    @ParameterizedTest \/\/ negative test cases\n+    @ValueSource(strings = { \"blah blah\", \"9234\", \"X!\", \"BarProvider\", \"FooProvider42\" })\n","filename":"test\/jdk\/java\/util\/ServiceLoader\/basic\/ServiceLoaderBasicTest.java","additions":4,"deletions":13,"binary":false,"changes":17,"status":"modified"}]}