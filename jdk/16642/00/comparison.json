{"files":[{"patch":"@@ -81,4 +81,0 @@\n-  if (thread_oop == nullptr) {  \/\/ Then thread should not be null (see assert above).\n-    thread_oop = thread->jvmti_vthread() != nullptr ? thread->jvmti_vthread() : thread->threadObj();\n-  }\n-\n@@ -92,1 +88,9 @@\n-  if (state == nullptr || state->get_thread_oop() != thread_oop) {\n+\n+  if (thread_oop == nullptr) {  \/\/ Then thread should not be null (see assert above).\n+    thread_oop = thread->jvmti_vthread() != nullptr ? thread->jvmti_vthread() : thread->threadObj();\n+  }\n+  \/\/ The state->get_thread_oop() may be null if the state is created during\n+  \/\/ the allocation of the thread oop when a native thread is attaching. Make\n+  \/\/ sure we don't create a new state for the JavaThread.\n+  if (state == nullptr || (state->get_thread_oop() != nullptr &&\n+                           state->get_thread_oop() != thread_oop)) {\n@@ -101,0 +105,1 @@\n+  assert(state != nullptr, \"sanity check\");\n","filename":"src\/hotspot\/share\/prims\/jvmtiThreadState.inline.hpp","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"}]}