{"files":[{"patch":"@@ -550,3 +550,3 @@\n-  size_t fpregs_offset = ((address)uc->uc_mcontext.fpregs >= (address)uc) ?\n-                         pointer_delta(uc->uc_mcontext.fpregs, uc, 1) : 0;\n-  if (fpregs_offset >= sizeof(ucontext_t) || fpregs_offset == 0) {\n+  \/\/ Sanity check: fpregs should point into the context.\n+  if ((address)uc->uc_mcontext.fpregs < (address)uc ||\n+      pointer_delta(uc->uc_mcontext.fpregs, uc, 1) >= sizeof(ucontext_t)) {\n","filename":"src\/hotspot\/os_cpu\/linux_x86\/os_linux_x86.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -734,3 +734,9 @@\n-  \/\/ In the copied version, fpregs should point to the copied contents. Preserve the offset.\n-  size_t fpregs_offset = pointer_delta(((const ucontext_t*)context)->uc_mcontext.fpregs, context, 1);\n-  *((void**) &g_stored_assertion_context.uc_mcontext.fpregs) = (void*)((address)(void*)&g_stored_assertion_context + fpregs_offset);\n+  \/\/ In the copied version, fpregs should point to the copied contents.\n+  \/\/ Sanity check: fpregs should point into the context.\n+  if ((address)((const ucontext_t*)context)->uc_mcontext.fpregs > (address)context) {\n+    size_t fpregs_offset = pointer_delta(((const ucontext_t*)context)->uc_mcontext.fpregs, context, 1);\n+    if (fpregs_offset < sizeof(ucontext_t)) {\n+      \/\/ Preserve the offset.\n+      *((void**) &g_stored_assertion_context.uc_mcontext.fpregs) = (void*)((address)(void*)&g_stored_assertion_context + fpregs_offset);\n+    }\n+  }\n","filename":"src\/hotspot\/share\/utilities\/debug.cpp","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"}]}