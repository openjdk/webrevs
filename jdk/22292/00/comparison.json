{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -505,52 +505,27 @@\n-\n-\n-    private static class ThemeGetter {\n-        private static int GET_THEME_DIR  = 0;\n-        private static int GET_USER_THEME = 1;\n-        private static int GET_IMAGE      = 2;\n-\n-        public Object getThemeItem(int type, Object arg) {\n-            if (type == GET_THEME_DIR) {\n-                String sep = File.separator;\n-                String[] dirs = new String[] {\n-                    userHome + sep + \".themes\",\n-                    System.getProperty(\"swing.metacitythemedir\"),\n-                    \"\/usr\/X11R6\/share\/themes\",\n-                    \"\/usr\/X11R6\/share\/gnome\/themes\",\n-                    \"\/usr\/local\/share\/themes\",\n-                    \"\/usr\/local\/share\/gnome\/themes\",\n-                    \"\/usr\/share\/themes\",\n-                    \"\/usr\/gnome\/share\/themes\",  \/\/ Debian\/Redhat\/Solaris\n-                    \"\/opt\/gnome2\/share\/themes\"  \/\/ SuSE\n-                };\n-\n-                URL themeDir = null;\n-                for (int i = 0; i < dirs.length; i++) {\n-                    \/\/ System property may not be set so skip null directories.\n-                    if (dirs[i] == null) {\n-                        continue;\n-                    }\n-                    File dir =\n-                        new File(dirs[i] + sep + arg + sep + \"metacity-1\");\n-                    if (new File(dir, \"metacity-theme-1.xml\").canRead()) {\n-                        try {\n-                            themeDir = dir.toURI().toURL();\n-                        } catch (MalformedURLException ex) {\n-                            themeDir = null;\n-                        }\n-                        break;\n-                    }\n-                }\n-                if (themeDir == null) {\n-                    String filename = \"resources\/metacity\/\" + arg +\n-                        \"\/metacity-1\/metacity-theme-1.xml\";\n-                    URL url = getClass().getResource(filename);\n-                    if (url != null) {\n-                        String str = url.toString();\n-                        try {\n-                            @SuppressWarnings(\"deprecation\")\n-                            var _unused = themeDir = new URL(str.substring(0, str.lastIndexOf('\/'))+\"\/\");\n-                        } catch (MalformedURLException ex) {\n-                            themeDir = null;\n-                        }\n-                    }\n+    private static URL getThemeDir(String arg) {\n+        String sep = File.separator;\n+        String[] dirs = new String[] {\n+            userHome + sep + \".themes\",\n+            System.getProperty(\"swing.metacitythemedir\"),\n+            \"\/usr\/X11R6\/share\/themes\",\n+            \"\/usr\/X11R6\/share\/gnome\/themes\",\n+            \"\/usr\/local\/share\/themes\",\n+            \"\/usr\/local\/share\/gnome\/themes\",\n+            \"\/usr\/share\/themes\",\n+            \"\/usr\/gnome\/share\/themes\",  \/\/ Debian\/Redhat\/Solaris\n+            \"\/opt\/gnome2\/share\/themes\"  \/\/ SuSE\n+        };\n+\n+        URL themeDir = null;\n+        for (int i = 0; i < dirs.length; i++) {\n+            \/\/ System property may not be set so skip null directories.\n+            if (dirs[i] == null) {\n+                continue;\n+            }\n+            File dir =\n+                new File(dirs[i] + sep + arg + sep + \"metacity-1\");\n+            if (new File(dir, \"metacity-theme-1.xml\").canRead()) {\n+                try {\n+                    themeDir = dir.toURI().toURL();\n+                } catch (MalformedURLException ex) {\n+                    themeDir = null;\n@@ -558,2 +533,9 @@\n-                return themeDir;\n-            } else if (type == GET_USER_THEME) {\n+                break;\n+            }\n+        }\n+        if (themeDir == null) {\n+            String filename = \"resources\/metacity\/\" + arg +\n+                \"\/metacity-1\/metacity-theme-1.xml\";\n+            URL url = Metacity.class.getResource(filename);\n+            if (url != null) {\n+                String str = url.toString();\n@@ -561,9 +543,0 @@\n-                    \/\/ Set userHome here because we need the privilege\n-                    userHome = System.getProperty(\"user.home\");\n-\n-                    String theme = System.getProperty(\"swing.metacitythemename\");\n-                    if (theme != null) {\n-                        return theme;\n-                    }\n-                    \/\/ Note: this is a small file (< 1024 bytes) so it's not worth\n-                    \/\/ starting an XML parser or even to use a buffered reader.\n@@ -571,28 +544,3 @@\n-                    URL url = new URL(new File(userHome).toURI().toURL(),\n-                                      \".gconf\/apps\/metacity\/general\/%25gconf.xml\");\n-                    \/\/ Pending: verify character encoding spec for gconf\n-                    StringBuilder sb = new StringBuilder();\n-                    try (InputStream in = url.openStream();\n-                         Reader reader = new InputStreamReader(in, ISO_8859_1))\n-                    {\n-                        char[] buf = new char[1024];\n-                        int n;\n-                        while ((n = reader.read(buf)) >= 0) {\n-                            sb.append(buf, 0, n);\n-                        }\n-                    }\n-                    String str = sb.toString();\n-                    if (str != null) {\n-                        String strLowerCase = str.toLowerCase();\n-                        int i = strLowerCase.indexOf(\"<entry name=\\\"theme\\\"\");\n-                        if (i >= 0) {\n-                            i = strLowerCase.indexOf(\"<stringvalue>\", i);\n-                            if (i > 0) {\n-                                i += \"<stringvalue>\".length();\n-                                int i2 = str.indexOf('<', i);\n-                                return str.substring(i, i2);\n-                            }\n-                        }\n-                    }\n-                } catch (IOException ex) {\n-                    \/\/ OK to just ignore. We'll use a fallback theme.\n+                    var _unused = themeDir = new URL(str.substring(0, str.lastIndexOf('\/'))+\"\/\");\n+                } catch (MalformedURLException ex) {\n+                    themeDir = null;\n@@ -600,5 +548,0 @@\n-                return null;\n-            } else if (type == GET_IMAGE) {\n-                return new ImageIcon((URL)arg).getImage();\n-            } else {\n-                return null;\n@@ -607,4 +550,1 @@\n-    }\n-\n-    private static URL getThemeDir(String themeName) {\n-        return (URL)new ThemeGetter().getThemeItem(ThemeGetter.GET_THEME_DIR, themeName);\n+        return themeDir;\n@@ -614,1 +554,39 @@\n-        return (String)new ThemeGetter().getThemeItem(ThemeGetter.GET_USER_THEME, null);\n+        try {\n+            \/\/ Set userHome here\n+            userHome = System.getProperty(\"user.home\");\n+\n+            String theme = System.getProperty(\"swing.metacitythemename\");\n+            if (theme != null) {\n+                return theme;\n+            }\n+            \/\/ Note: this is a small file (< 1024 bytes) so it's not worth\n+            \/\/ starting an XML parser or even to use a buffered reader.\n+            @SuppressWarnings(\"deprecation\")\n+            URL url = new URL(new File(userHome).toURI().toURL(),\n+                              \".gconf\/apps\/metacity\/general\/%25gconf.xml\");\n+            \/\/ Pending: verify character encoding spec for gconf\n+            StringBuilder sb = new StringBuilder();\n+            try (InputStream in = url.openStream();\n+                 Reader reader = new InputStreamReader(in, ISO_8859_1))\n+            {\n+                char[] buf = new char[1024];\n+                int n;\n+                while ((n = reader.read(buf)) >= 0) {\n+                    sb.append(buf, 0, n);\n+                }\n+            }\n+            String str = sb.toString();\n+            String strLowerCase = str.toLowerCase();\n+            int i = strLowerCase.indexOf(\"<entry name=\\\"theme\\\"\");\n+            if (i >= 0) {\n+                i = strLowerCase.indexOf(\"<stringvalue>\", i);\n+                if (i > 0) {\n+                    i += \"<stringvalue>\".length();\n+                    int i2 = str.indexOf('<', i);\n+                    return str.substring(i, i2);\n+                }\n+            }\n+        } catch (IOException ex) {\n+            \/\/ OK to just ignore. We'll use a fallback theme.\n+        }\n+        return null;\n@@ -665,1 +643,1 @@\n-                    image = (Image)new ThemeGetter().getThemeItem(ThemeGetter.GET_IMAGE, url);\n+                    image = new ImageIcon(url).getImage();\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/Metacity.java","additions":81,"deletions":103,"binary":false,"changes":184,"status":"modified"}]}