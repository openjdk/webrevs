[{"commit":{"message":"8304301: Remove the global option SuperWordMaxVectorSize\n\nhttps:\/\/github.com\/openjdk\/jdk\/pull\/8877 introduced the global\noption `SuperWordMaxVectorSize` as a temporary solution to fix\nthe performance regression on some x86 machines.\n\nCurrently, SuperWordMaxVectorSize behaves differently between\nx86 and other platforms[1]. For example, if the current machine\nonly supports `MaxVectorSize <= 32`, but we set\n`SuperWordMaxVectorSize = 64`, then `SuperWordMaxVectorSize`\nwill be kept at 64 on other platforms while x86 machine would\nchange `SuperWordMaxVectorSize` to `MaxVectorSize`. Other\nplatforms except x86 miss similar implementations like [2].\n\nAlso, `SuperWordMaxVectorSize` limits the max vector size of\nauto-vectorization as `64`, which is fine for current aarch64\nhardware but SVE architecture supports larger than 512 bits.\n\nThe patch is to drop the global option and use an architecture-\ndependent interface to consult the max vector size for auto-\nvectorization, fixing the performance issue on x86 and reducing\nside effects for other platforms. After the patch, auto-\nvectorization is still limited to 32-byte vectors by default\non Cascade Lake and users can override this by either setting\n`-XX:UseAVX=3` or `-XX:MaxVectorSize=64` on JVM command line.\n\nSo my question is:\n\nBefore the patch, we could have a smaller max vector size for\nauto-vectorization than `MaxVectorSize` on x86. For example,\nusers could have `MaxVectorSize=64` and\n`SuperWordMaxVectorSize=32`. But after the change, if we set\n`-XX:MaxVectorSize=64` explicitly, then the max vector size for\nauto-vectorization would be `MaxVectorSize`, i.e. 64 bytes, which\nI believe is more reasonable. @sviswa7 @jatin-bhateja, are you\nhappy about the change?\n\n[1] https:\/\/github.com\/openjdk\/jdk\/pull\/12350#discussion_r1126106213\n[2] https:\/\/github.com\/openjdk\/jdk\/blob\/33bec207103acd520eb99afb093cfafa44aecfda\/src\/hotspot\/cpu\/x86\/vm_version_x86.cpp#L1314-L1333"},"files":[{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad"},{"filename":"src\/hotspot\/cpu\/arm\/arm.ad"},{"filename":"src\/hotspot\/cpu\/ppc\/ppc.ad"},{"filename":"src\/hotspot\/cpu\/riscv\/riscv.ad"},{"filename":"src\/hotspot\/cpu\/s390\/s390.ad"},{"filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp"},{"filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.hpp"},{"filename":"src\/hotspot\/cpu\/x86\/x86.ad"},{"filename":"src\/hotspot\/share\/opto\/c2_globals.hpp"},{"filename":"src\/hotspot\/share\/opto\/matcher.hpp"},{"filename":"src\/hotspot\/share\/opto\/superword.cpp"},{"filename":"src\/hotspot\/share\/opto\/superword.hpp"},{"filename":"src\/hotspot\/share\/opto\/vectornode.cpp"},{"filename":"src\/hotspot\/share\/opto\/vectornode.hpp"}],"sha":"49de669c2d901e27e088dc7410a02d8cc32fa560"}]