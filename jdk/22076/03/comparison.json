{"files":[{"patch":"@@ -5163,1 +5163,1 @@\n-    _igv_printer->print_method(name, level);\n+    _igv_printer->print_graph(name);\n@@ -5205,0 +5205,9 @@\n+#ifndef PRODUCT\n+void Compile::init_igv() {\n+  if (_igv_printer == nullptr) {\n+    _igv_printer = IdealGraphPrinter::printer();\n+    _igv_printer->set_compile(this);\n+  }\n+}\n+#endif\n+\n@@ -5212,3 +5221,2 @@\n-  if (need && !_igv_printer) {\n-    _igv_printer = IdealGraphPrinter::printer();\n-    _igv_printer->set_compile(this);\n+  if (need) {\n+    Compile::init_igv();\n@@ -5282,1 +5290,1 @@\n-  _debug_file_printer->print(phase_name, (Node*)C->root());\n+  _debug_file_printer->print_graph(phase_name);\n@@ -5286,0 +5294,6 @@\n+  ResourceMark rm;\n+  GrowableArray<const Node*> empty_list;\n+  igv_print_graph_to_network(phase_name, (Node*) C->root(), empty_list);\n+}\n+\n+void Compile::igv_print_graph_to_network(const char* name, Node* node, GrowableArray<const Node*>& visible_nodes) {\n@@ -5292,1 +5306,1 @@\n-  _debug_network_printer->print(phase_name, (Node*)C->root());\n+  _debug_network_printer->print(name, (Node*) Compile::current()->root(), visible_nodes);\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":20,"deletions":6,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -713,0 +713,1 @@\n+  void init_igv();\n@@ -715,1 +716,1 @@\n-      _igv_printer->print_method(graph_name, level);\n+      _igv_printer->print_graph(graph_name);\n@@ -721,0 +722,1 @@\n+  void igv_print_graph_to_network(const char* name, Node* node, GrowableArray<const Node*>& visible_nodes);\n","filename":"src\/hotspot\/share\/opto\/compile.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -56,0 +56,1 @@\n+const char *IdealGraphPrinter::FALSE_VALUE = \"false\";\n@@ -71,0 +72,6 @@\n+const char *IdealGraphPrinter::GRAPH_STATES_ELEMENT = \"graphStates\";\n+const char *IdealGraphPrinter::STATE_ELEMENT = \"state\";\n+const char *IdealGraphPrinter::DIFFERENCE_ELEMENT = \"difference\";\n+const char *IdealGraphPrinter::DIFFERENCE_VALUE_PROPERTY = \"value\";\n+const char *IdealGraphPrinter::VISIBLE_NODES_ELEMENT = \"visibleNodes\";\n+const char *IdealGraphPrinter::ALL_PROPERTY = \"all\";\n@@ -352,1 +359,1 @@\n-void IdealGraphPrinter::visit_node(Node *n, bool edges, VectorSet* temp_set) {\n+void IdealGraphPrinter::visit_node(Node* n, bool edges) {\n@@ -778,1 +785,1 @@\n-void IdealGraphPrinter::walk_nodes(Node* start, bool edges, VectorSet* temp_set) {\n+void IdealGraphPrinter::walk_nodes(Node* start, bool edges) {\n@@ -799,1 +806,1 @@\n-    visit_node(n, edges, temp_set);\n+    visit_node(n, edges);\n@@ -815,4 +822,4 @@\n-void IdealGraphPrinter::print_method(const char *name, int level) {\n-  if (C->should_print_igv(level)) {\n-    print(name, (Node *) C->root());\n-  }\n+void IdealGraphPrinter::print_graph(const char* name) {\n+  ResourceMark rm;\n+  GrowableArray<const Node*> empty_list;\n+  print(name, (Node*) C->root(), empty_list);\n@@ -822,1 +829,1 @@\n-void IdealGraphPrinter::print(const char *name, Node *node) {\n+void IdealGraphPrinter::print(const char* name, Node* node, GrowableArray<const Node*>& visible_nodes) {\n@@ -833,2 +840,0 @@\n-  VectorSet temp_set;\n-\n@@ -846,1 +851,1 @@\n-  walk_nodes(node, false, &temp_set);\n+  walk_nodes(node, false);\n@@ -850,1 +855,1 @@\n-  walk_nodes(node, true, &temp_set);\n+  walk_nodes(node, true);\n@@ -880,0 +885,19 @@\n+  if (visible_nodes.is_nonempty()) {\n+    head(GRAPH_STATES_ELEMENT);\n+    head(STATE_ELEMENT);\n+    begin_elem(DIFFERENCE_ELEMENT);\n+    print_attr(DIFFERENCE_VALUE_PROPERTY, \"0\");\n+    end_elem();\n+\n+    begin_head(VISIBLE_NODES_ELEMENT);\n+    print_attr(ALL_PROPERTY, FALSE_VALUE);\n+    end_head();\n+    for (int i = 0; i < visible_nodes.length(); ++i) {\n+      begin_elem(NODE_ELEMENT);\n+      print_attr(NODE_ID_PROPERTY, visible_nodes.at(i)->_igv_idx);\n+      end_elem();\n+    }\n+    tail(VISIBLE_NODES_ELEMENT);\n+    tail(STATE_ELEMENT);\n+    tail(GRAPH_STATES_ELEMENT);\n+  }\n","filename":"src\/hotspot\/share\/opto\/idealGraphPrinter.cpp","additions":36,"deletions":12,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -62,0 +62,6 @@\n+  static const char *GRAPH_STATES_ELEMENT;\n+  static const char *STATE_ELEMENT;\n+  static const char *DIFFERENCE_ELEMENT;\n+  static const char *DIFFERENCE_VALUE_PROPERTY;\n+  static const char *VISIBLE_NODES_ELEMENT;\n+  static const char *ALL_PROPERTY;\n@@ -72,0 +78,1 @@\n+  static const char *FALSE_VALUE;\n@@ -104,1 +111,1 @@\n-  void visit_node(Node* n, bool edges, VectorSet* temp_set);\n+  void visit_node(Node* n, bool edges);\n@@ -110,1 +117,1 @@\n-  void walk_nodes(Node *start, bool edges, VectorSet* temp_set);\n+  void walk_nodes(Node* start, bool edges);\n@@ -140,2 +147,2 @@\n-  void print_method(const char *name, int level = 0);\n-  void print(const char *name, Node *root);\n+  void print_graph(const char* name);\n+  void print(const char* name, Node* root, GrowableArray<const Node*>& hidden_nodes);\n","filename":"src\/hotspot\/share\/opto\/idealGraphPrinter.hpp","additions":11,"deletions":4,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -1833,0 +1833,2 @@\n+  bool _print_igv = false;\n+\n@@ -2050,0 +2052,5 @@\n+    if (_print_igv) {\n+      Compile* C = Compile::current();\n+      C->init_igv();\n+      C->igv_print_graph_to_network(\"PrintBFS\", (Node*) C->root(), _print_list);\n+    }\n@@ -2092,0 +2099,1 @@\n+  _output->print_cr(\"      !: show nodes on IGV (sent over network stream)\");\n@@ -2205,0 +2213,3 @@\n+      case '!':\n+        _print_igv = true;\n+        break;\n","filename":"src\/hotspot\/share\/opto\/node.cpp","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2839,1 +2839,1 @@\n-    printer->print_method(buffer, perBytecode);\n+    printer->print_graph(buffer);\n","filename":"src\/hotspot\/share\/opto\/parse2.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}