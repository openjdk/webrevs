{"files":[{"patch":"@@ -96,3 +96,1 @@\n-    check_oop_function = [](oopDesc* obj) {\n-      (void)to_zaddress(obj);\n-    };\n+    check_oop_function = &check_is_valid_zaddress;\n","filename":"src\/hotspot\/share\/gc\/z\/zAddress.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -336,2 +336,1 @@\n-inline zaddress to_zaddress(uintptr_t value) {\n-  const zaddress addr = zaddress(value);\n+inline void check_is_valid_zaddress(zaddress addr) {\n@@ -340,0 +339,13 @@\n+}\n+\n+inline void check_is_valid_zaddress(uintptr_t value) {\n+  check_is_valid_zaddress(zaddress(value));\n+}\n+\n+inline void check_is_valid_zaddress(oopDesc* o) {\n+  check_is_valid_zaddress(uintptr_t(o));\n+}\n+\n+inline zaddress to_zaddress(uintptr_t value) {\n+  const zaddress addr = zaddress(value);\n+  check_is_valid_zaddress(addr);\n@@ -347,1 +359,1 @@\n-inline oop to_oop(zaddress addr) {\n+inline void assert_is_oop_or_null(zaddress addr) {\n@@ -355,1 +367,10 @@\n-  return obj;\n+}\n+\n+inline void assert_is_oop(zaddress addr) {\n+  assert(!is_null(addr), \"Should not be null\");\n+  assert_is_oop_or_null(addr);\n+}\n+\n+inline oop to_oop(zaddress addr) {\n+  assert_is_oop_or_null(addr);\n+  return cast_to_oop(addr);\n@@ -381,1 +402,0 @@\n-\n","filename":"src\/hotspot\/share\/gc\/z\/zAddress.inline.hpp","additions":25,"deletions":5,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -748,1 +748,1 @@\n-  assert(!ZVerifyOops || oopDesc::is_oop(to_oop(addr), false), \"must be oop\");\n+  assert_is_oop(addr);\n@@ -760,1 +760,1 @@\n-  assert(!ZVerifyOops || oopDesc::is_oop(to_oop(addr), false), \"must be oop\");\n+  assert_is_oop(addr);\n","filename":"src\/hotspot\/share\/gc\/z\/zBarrier.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -433,1 +433,1 @@\n-  assert_is_valid(to_zaddress(src));\n+  check_is_valid_zaddress(src);\n","filename":"src\/hotspot\/share\/gc\/z\/zBarrierSet.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -149,1 +149,1 @@\n-    assert_is_valid(to_zaddress(o));\n+    check_is_valid_zaddress(o);\n","filename":"src\/hotspot\/share\/gc\/z\/zHeapIterator.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -368,1 +368,1 @@\n-  assert_is_valid(to_zaddress(obj));\n+  check_is_valid_zaddress(obj);\n","filename":"src\/hotspot\/share\/gc\/z\/zMark.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -50,1 +50,1 @@\n-  assert(!ZVerifyOops || oopDesc::is_oop(to_oop(addr)), \"Should be oop\");\n+  assert_is_oop(addr);\n","filename":"src\/hotspot\/share\/gc\/z\/zMark.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -314,1 +314,1 @@\n-  (void)to_oop(addr);\n+  assert_is_oop(addr);\n","filename":"src\/hotspot\/share\/gc\/z\/zPage.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -146,1 +146,1 @@\n-    (void)to_zaddress(referent);\n+    check_is_valid_zaddress(referent);\n","filename":"src\/hotspot\/share\/gc\/z\/zReferenceProcessor.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -114,0 +114,10 @@\n+static void z_verify_oop_object(zaddress addr, zpointer o, void* p) {\n+  const oop obj = cast_to_oop(addr);\n+  guarantee(oopDesc::is_oop(obj), BAD_OOP_ARG(o, p));\n+}\n+\n+static void z_verify_root_oop_object(zaddress o, void* p) {\n+  const oop obj = cast_to_oop(o);\n+  guarantee(oopDesc::is_oop(obj), BAD_OOP_ARG(o, p));\n+}\n+\n@@ -124,1 +134,1 @@\n-      guarantee(oopDesc::is_oop(to_oop(addr)), BAD_OOP_ARG(o, p));\n+      z_verify_oop_object(addr, o, p);\n@@ -146,1 +156,1 @@\n-      guarantee(oopDesc::is_oop(to_oop(ZPointer::uncolor(o))), BAD_OOP_ARG(o, p));\n+      z_verify_oop_object(ZPointer::uncolor(o), o, p);\n@@ -151,4 +161,0 @@\n-static void z_verify_root_oop_object(zaddress o, void* p) {\n-  guarantee(oopDesc::is_oop(to_oop(o)), BAD_OOP_ARG(o, p));\n-}\n-\n@@ -171,1 +177,1 @@\n-    guarantee(oopDesc::is_oop(to_oop(addr)), BAD_OOP_ARG(o, p));\n+    z_verify_oop_object(addr, o, p);\n@@ -214,1 +220,1 @@\n-      z_verify_root_oop_object(addr, p);\n+      z_verify_oop_object(addr, o, p);\n@@ -221,1 +227,1 @@\n-        z_verify_root_oop_object(addr, p);\n+        z_verify_oop_object(addr, o, p);\n","filename":"src\/hotspot\/share\/gc\/z\/zVerify.cpp","additions":15,"deletions":9,"binary":false,"changes":24,"status":"modified"}]}