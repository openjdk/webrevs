{"files":[{"patch":"@@ -964,4 +964,4 @@\n-                \/\/ If this class appears as an anonymous class in a constructor\n-                \/\/ prologue, disable implicit outer instance from being passed.\n-                \/\/ (This would be an illegal access to \"this before super\").\n-                if (ctorProloguePrev && env.tree.hasTag(NEWCLASS)) {\n+                \/\/ If a class declaration appears in a constructor prologue,\n+                \/\/ that means it's either a local class or an anonymous class.\n+                \/\/ Either way, there is no immediately enclosing instance.\n+                if (ctorProloguePrev) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1846,1 +1846,0 @@\n-            Assert.error();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Lower.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -0,0 +1,32 @@\n+\/*\n+ * @test  \/nodynamiccopyright\/\n+ * @bug 8328649\n+ * @summary Verify local classes in constructor prologues don't have enclosing instances\n+ * @compile\/fail\/ref=LocalClassCtorPrologue.out -XDrawDiagnostics LocalClassCtorPrologue.java\n+ * @enablePreview\n+ *\/\n+\n+class LocalClassCtorPrologue {\n+\n+    int x;\n+\n+    LocalClassCtorPrologue() {\n+        class Local {\n+            {\n+                x++;                \/\/ this should fail\n+            }\n+        }\n+        super();\n+    }\n+\n+    public class Inner {\n+        public Inner() {\n+            class Local {\n+                {\n+                    x++;            \/\/ this should work\n+                }\n+            };\n+            super();\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/LocalClassCtorPrologue.java","additions":32,"deletions":0,"binary":false,"changes":32,"status":"added"},{"patch":"@@ -0,0 +1,4 @@\n+LocalClassCtorPrologue.java:16:17: compiler.err.no.encl.instance.of.type.in.scope: LocalClassCtorPrologue\n+- compiler.note.preview.filename: LocalClassCtorPrologue.java, DEFAULT\n+- compiler.note.preview.recompile\n+1 error\n","filename":"test\/langtools\/tools\/javac\/LocalClassCtorPrologue.out","additions":4,"deletions":0,"binary":false,"changes":4,"status":"added"},{"patch":"@@ -410,26 +410,0 @@\n-    \/\/ local class declared before super(), but not used until after super()\n-    public static class Test20 {\n-        public Test20() {\n-            class Foo {\n-                Foo() {\n-                    Test20.this.hashCode();\n-                }\n-            }\n-            super();\n-            new Foo();\n-        }\n-    }\n-\n-    \/\/ local class inside super() parameter list\n-    public static class Test21 extends AtomicReference<Object> {\n-        private int x;\n-        public Test21() {\n-            super(switch (\"foo\".hashCode()) {\n-                default -> {\n-                    class Nested {{ System.out.println(x); }}       \/\/ class is NOT instantiated - OK\n-                    yield \"bar\";\n-                }\n-            });\n-        }\n-    }\n-\n@@ -477,2 +451,0 @@\n-        new Test20();\n-        new Test21();\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/SuperInitGood.java","additions":0,"deletions":28,"binary":false,"changes":28,"status":"modified"}]}