{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -391,0 +391,1 @@\n+        @Override\n@@ -394,0 +395,6 @@\n+        @Override\n+        public Spliterator<K> spliterator() {\n+            return Spliterators.spliterator(this,\n+                    Spliterator.DISTINCT | Spliterator.ORDERED | Spliterator.SORTED | Spliterator.NONNULL);\n+        }\n+        @Override\n@@ -397,0 +404,1 @@\n+        @Override\n@@ -400,0 +408,1 @@\n+        @Override\n@@ -405,0 +414,1 @@\n+        @Override\n@@ -430,0 +440,1 @@\n+        @Override\n@@ -433,0 +444,5 @@\n+        @Override\n+        public Spliterator<V> spliterator() {\n+            return Spliterators.spliterator(this, Spliterator.ORDERED);\n+        }\n+        @Override\n@@ -436,0 +452,1 @@\n+        @Override\n@@ -439,0 +456,1 @@\n+        @Override\n@@ -451,0 +469,1 @@\n+        @Override\n@@ -474,0 +493,1 @@\n+        @Override\n@@ -477,1 +497,6 @@\n-\n+        @Override\n+        public Spliterator<Entry<K, V>> spliterator() {\n+            return Spliterators.spliterator(this,\n+                    Spliterator.DISTINCT | Spliterator.ORDERED | Spliterator.SORTED | Spliterator.NONNULL);\n+        }\n+        @Override\n@@ -482,0 +507,1 @@\n+        @Override\n@@ -486,0 +512,1 @@\n+        @Override\n@@ -489,0 +516,1 @@\n+        @Override\n@@ -492,0 +520,1 @@\n+        @Override\n@@ -496,0 +525,1 @@\n+        @Override\n","filename":"src\/java.base\/share\/classes\/java\/util\/EnumMap.java","additions":32,"deletions":2,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -0,0 +1,108 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @run     junit EnumMapSpliteratorTest\n+ * @bug     8373288\n+ * @summary EnumMap spliterators should include more specific characteristics\n+ *\/\n+\n+import java.util.AbstractMap;\n+import java.util.Arrays;\n+import java.util.EnumMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Spliterator;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class EnumMapSpliteratorTest {\n+\n+    enum TestEnum { A, B, C, D, E }\n+\n+    private final EnumMap<TestEnum, Integer> map = new EnumMap<>(TestEnum.class);\n+\n+    {{\n+        map.put(TestEnum.A, 0);\n+        map.put(TestEnum.B, 1);\n+        map.put(TestEnum.C, 2);\n+        map.put(TestEnum.D, 3);\n+        map.put(TestEnum.E, null);\n+    }}\n+\n+    @Test\n+    public void testKeySetSpliteratorCharacteristics() {\n+        Spliterator<TestEnum> spliterator = map.keySet().spliterator();\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.DISTINCT), \"Missing DISTINCT\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SORTED), \"Missing SORTED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.ORDERED), \"Missing ORDERED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.NONNULL), \"Missing NONNULL\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SIZED), \"Missing SIZED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SUBSIZED), \"Missing SUBSIZED\");\n+        int expectedCharacteristics = Spliterator.DISTINCT | Spliterator.ORDERED | Spliterator.SORTED\n+                | Spliterator.NONNULL | Spliterator.SIZED | Spliterator.SUBSIZED;\n+        assertEquals(expectedCharacteristics, spliterator.characteristics(), \"Unexpected additional characteristics\");\n+        List<TestEnum> expectedEncounterOrder = Arrays.asList(TestEnum.values());\n+        assertEquals(expectedEncounterOrder, map.keySet().stream().toList());\n+    }\n+\n+    @Test\n+    public void testEntrySetSpliteratorCharacteristics() {\n+        Spliterator<Map.Entry<TestEnum, Integer>> spliterator = map.entrySet().spliterator();\n+        int characteristics = spliterator.characteristics();\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.DISTINCT), \"Missing DISTINCT\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SORTED), \"Missing SORTED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.ORDERED), \"Missing ORDERED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.NONNULL), \"Missing NONNULL\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SIZED), \"Missing SIZED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SUBSIZED), \"Missing SUBSIZED\");\n+        int expectedCharacteristics = Spliterator.DISTINCT | Spliterator.ORDERED | Spliterator.SORTED\n+                | Spliterator.NONNULL | Spliterator.SIZED | Spliterator.SUBSIZED;\n+        assertEquals(expectedCharacteristics, characteristics, \"Unexpected additional characteristics\");\n+        List<Map.Entry<TestEnum, Integer>> expectedEncounterOrder = List.of(\n+                new AbstractMap.SimpleEntry<>(TestEnum.A, 0),\n+                new AbstractMap.SimpleEntry<>(TestEnum.B, 1),\n+                new AbstractMap.SimpleEntry<>(TestEnum.C, 2),\n+                new AbstractMap.SimpleEntry<>(TestEnum.D, 3),\n+                new AbstractMap.SimpleEntry<>(TestEnum.E, null));\n+        assertEquals(expectedEncounterOrder, map.entrySet().stream().toList());\n+    }\n+\n+    @Test\n+    public void testValuesSpliteratorCharacteristics() {\n+        map.put(TestEnum.E, null);\n+        Spliterator<Integer> spliterator = map.values().spliterator();\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.ORDERED), \"Missing ORDERED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SIZED), \"Missing SIZED\");\n+        assertTrue(spliterator.hasCharacteristics(Spliterator.SUBSIZED), \"Missing SUBSIZED\");\n+        int expectedCharacteristics = Spliterator.ORDERED | Spliterator.SIZED | Spliterator.SUBSIZED;\n+        assertEquals(expectedCharacteristics, spliterator.characteristics(), \"Unexpected additional characteristics\");\n+        List<Integer> expectedEncounterOrder = Arrays.asList(0, 1, 2, 3, null);\n+        assertEquals(expectedEncounterOrder, map.values().stream().toList());\n+    }\n+}\n\\ No newline at end of file\n","filename":"test\/jdk\/java\/util\/EnumMap\/EnumMapSpliteratorTest.java","additions":108,"deletions":0,"binary":false,"changes":108,"status":"added"}]}