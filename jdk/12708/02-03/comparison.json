{"files":[{"patch":"@@ -234,1 +234,1 @@\n-        VMStorage[] hfaAlloc(GroupLayout group) {\n+        VMStorage[] hfaAlloc(List<MemoryLayout> scalarLayouts) {\n@@ -236,2 +236,2 @@\n-            int count = group.memberLayouts().size();\n-            Class<?> elementCarrier = ((ValueLayout) (group.memberLayouts().get(0))).carrier();\n+            int count = scalarLayouts.size();\n+            Class<?> elementCarrier = ((ValueLayout) (scalarLayouts.get(0))).carrier();\n@@ -360,3 +360,3 @@\n-                    GroupLayout group = (GroupLayout) layout;\n-                    VMStorage[] regs = storageCalculator.hfaAlloc(group);\n-                    final long baseSize = group.memberLayouts().get(0).byteSize();\n+                    List<MemoryLayout> scalarLayouts = TypeClass.scalarLayouts((GroupLayout) layout);\n+                    VMStorage[] regs = storageCalculator.hfaAlloc(scalarLayouts);\n+                    final long baseSize = scalarLayouts.get(0).byteSize();\n@@ -432,3 +432,3 @@\n-                    GroupLayout group = (GroupLayout) layout;\n-                    VMStorage[] regs = storageCalculator.hfaAlloc(group);\n-                    final long baseSize = group.memberLayouts().get(0).byteSize();\n+                    List<MemoryLayout> scalarLayouts = TypeClass.scalarLayouts((GroupLayout) layout);\n+                    VMStorage[] regs = storageCalculator.hfaAlloc(scalarLayouts);\n+                    final long baseSize = scalarLayouts.get(0).byteSize();\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/ppc64\/CallArranger.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import java.lang.foreign.SequenceLayout;\n@@ -32,0 +33,2 @@\n+import java.util.List;\n+import java.util.ArrayList;\n@@ -66,0 +69,21 @@\n+    static List<MemoryLayout> scalarLayouts(GroupLayout gl) {\n+        List<MemoryLayout> out = new ArrayList<>();\n+        scalarLayoutsInternal(out, gl);\n+        return out;\n+    }\n+\n+    private static void scalarLayoutsInternal(List<MemoryLayout> out, GroupLayout gl) {\n+        for (MemoryLayout member : gl.memberLayouts()) {\n+            if (member instanceof GroupLayout memberGl) {\n+                scalarLayoutsInternal(out, memberGl);\n+            } else if (member instanceof SequenceLayout memberSl) {\n+                for (long i = 0; i < memberSl.elementCount(); i++) {\n+                    out.add(memberSl.elementLayout());\n+                }\n+            } else {\n+                \/\/ padding or value layouts\n+                out.add(member);\n+            }\n+        }\n+    }\n+\n@@ -67,1 +91,1 @@\n-        GroupLayout groupLayout = (GroupLayout)type;\n+        List<MemoryLayout> scalarLayouts = scalarLayouts((GroupLayout) type);\n@@ -69,1 +93,1 @@\n-        final int numElements = groupLayout.memberLayouts().size();\n+        final int numElements = scalarLayouts.size();\n@@ -73,1 +97,1 @@\n-        MemoryLayout baseType = groupLayout.memberLayouts().get(0);\n+        MemoryLayout baseType = scalarLayouts.get(0);\n@@ -82,1 +106,1 @@\n-        for (MemoryLayout elem : groupLayout.memberLayouts()) {\n+        for (MemoryLayout elem : scalarLayouts) {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/ppc64\/TypeClass.java","additions":28,"deletions":4,"binary":false,"changes":32,"status":"modified"}]}