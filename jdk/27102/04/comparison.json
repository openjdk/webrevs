{"files":[{"patch":"@@ -87,0 +87,1 @@\n+        LONG(\"long\", \"long\", null),\n","filename":"make\/langtools\/tools\/propertiesparser\/parser\/MessageType.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -3993,0 +3993,1 @@\n+            chk.checkOutOfRangeShift(tree.rhs.pos(), operator, operand);\n@@ -4083,0 +4084,1 @@\n+            chk.checkOutOfRangeShift(tree.rhs.pos(), operator, right);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -4044,0 +4044,31 @@\n+    \/**\n+     *  Check for bit shifts using an out-of-range bit count.\n+     *  @param pos           Position for error reporting.\n+     *  @param operator      The operator for the expression\n+     *  @param operand       The right hand operand for the expression\n+     *\/\n+    void checkOutOfRangeShift(final DiagnosticPosition pos, Symbol operator, Type operand) {\n+        if (operand.constValue() instanceof Number shiftAmount) {\n+            Type targetType;\n+            int maximumShift;\n+            switch (((OperatorSymbol)operator).opcode) {\n+            case ByteCodes.ishl, ByteCodes.ishr, ByteCodes.iushr, ByteCodes.ishll, ByteCodes.ishrl, ByteCodes.iushrl -> {\n+                targetType = syms.intType;\n+                maximumShift = 0x1f;\n+            }\n+            case ByteCodes.lshl, ByteCodes.lshr, ByteCodes.lushr, ByteCodes.lshll, ByteCodes.lshrl, ByteCodes.lushrl -> {\n+                targetType = syms.longType;\n+                maximumShift = 0x3f;\n+            }\n+            default -> {\n+                return;\n+            }\n+            }\n+            long specifiedShift = shiftAmount.longValue();\n+            if (specifiedShift > maximumShift || specifiedShift < -maximumShift) {\n+                int actualShift = (int)specifiedShift & (maximumShift - 1);\n+                log.warning(pos, LintWarnings.BitShiftOutOfRange(targetType, specifiedShift, actualShift));\n+            }\n+        }\n+    }\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Check.java","additions":31,"deletions":0,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2456,0 +2456,5 @@\n+# 0: type, 1: long, 2: number\n+# lint: lossy-conversions\n+compiler.warn.bit.shift.out.of.range=\\\n+    shifting {0} by {1} bits is equivalent to shifting by {2} bit(s)\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler.properties","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -231,1 +231,1 @@\n-    Warn about possible lossy conversions in compound assignment.\n+    Warn about possible lossy conversions in compound assignment and bit shift operations.\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/javac.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -168,1 +168,2 @@\n- * <tr><th scope=\"row\">{@code lossy-conversions}    <td>possible lossy conversions in compound assignment\n+ * <tr><th scope=\"row\">{@code lossy-conversions}    <td>possible lossy conversions in compound assignments or bit shifts\n+ *                                                      (more than \\u00B131 bits for integers or \\u00B163 bits for longs)\n","filename":"src\/jdk.compiler\/share\/classes\/module-info.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -614,1 +614,1 @@\n-        in compound assignment.\n+        in compound assignment and bit shift operations.\n","filename":"src\/jdk.compiler\/share\/man\/javac.md","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,31 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/\/ key: compiler.warn.bit.shift.out.of.range\n+\/\/ options: -Xlint:lossy-conversions\n+\n+class BitShiftOutOfRange {\n+    int m(int a) {\n+        return a << 32;\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/BitShiftOutOfRange.java","additions":31,"deletions":0,"binary":false,"changes":31,"status":"added"},{"patch":"@@ -0,0 +1,83 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @bug 5038439\n+ * @summary Verify warnings about bit shifts using out-of-range shift amounts\n+ * @compile\/ref=ShiftOutOfRange.out -XDrawDiagnostics -Xlint:lossy-conversions ShiftOutOfRange.java\n+ *\/\n+\n+public class ShiftOutOfRange {\n+\n+    public void shiftInt() {\n+        int a = 123;\n+\n+        \/\/ These should generate warnings\n+        a = a << (byte)-32;\n+        a = a >> (short)-32;\n+        a = a >>> -32;\n+        a <<= -32L;\n+        a >>= (byte)-32;\n+        a >>>= (short)-32;\n+\n+        \/\/ These should not generate warnings\n+        a = a << (byte)-31;\n+        a = a >> (short)-23;\n+        a = a >>> -17;\n+        a <<= -13L;\n+        a >>= (byte)-1;\n+        a >>>= (short)0;\n+        a = a << (byte)0;\n+        a = a >> (char)7;\n+        a = a >>> (short)13;\n+        a <<= 17;\n+        a >>= (long)23;\n+        a >>>= (byte)31;\n+        a <<= hashCode();\n+        a >>= hashCode();\n+        a >>>= hashCode();\n+\n+        \/\/ These should generate warnings\n+        a = a << (byte)32;\n+        a = a >> (char)32;\n+        a = a >>> (short)32;\n+        a <<= 32;\n+        a >>= (long)32;\n+        a >>>= (byte)32;\n+    }\n+\n+    public void shiftLong() {\n+        long a = 123;\n+\n+        \/\/ These should generate warnings\n+        a = a << (byte)-64;\n+        a = a >> (short)-64;\n+        a = a >>> -64;\n+        a <<= -64L;\n+        a >>= (byte)-64L;\n+        a >>>= (short)-64;\n+\n+        \/\/ These should not generate warnings\n+        a = a << (byte)-63;\n+        a = a >> (short)-47;\n+        a = a >>> -34;\n+        a <<= -25L;\n+        a >>= (byte)-15;\n+        a >>>= (short)0;\n+        a = a << (byte)0;\n+        a = a >> (char)15;\n+        a = a >>> (short)25;\n+        a <<= 34;\n+        a >>= (long)47;\n+        a >>>= (byte)63;\n+        a <<= hashCode();\n+        a >>= hashCode();\n+        a >>>= hashCode();\n+\n+        \/\/ These should generate warnings\n+        a = a << (byte)64;\n+        a = a >> (char)64;\n+        a = a >>> (short)64;\n+        a <<= 64;\n+        a >>= (long)64;\n+        a >>>= (byte)64;\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/lint\/ShiftOutOfRange.java","additions":83,"deletions":0,"binary":false,"changes":83,"status":"added"},{"patch":"@@ -0,0 +1,29 @@\n+ShiftOutOfRange.java:14:18: compiler.warn.bit.shift.out.of.range: int, -32, 0\n+ShiftOutOfRange.java:15:18: compiler.warn.bit.shift.out.of.range: int, -32, 0\n+ShiftOutOfRange.java:16:19: compiler.warn.bit.shift.out.of.range: int, -32, 0\n+ShiftOutOfRange.java:17:15: compiler.warn.possible.loss.of.precision: long, int\n+ShiftOutOfRange.java:17:15: compiler.warn.bit.shift.out.of.range: int, -32, 0\n+ShiftOutOfRange.java:18:15: compiler.warn.bit.shift.out.of.range: int, -32, 0\n+ShiftOutOfRange.java:19:16: compiler.warn.bit.shift.out.of.range: int, -32, 0\n+ShiftOutOfRange.java:25:15: compiler.warn.possible.loss.of.precision: long, int\n+ShiftOutOfRange.java:32:15: compiler.warn.possible.loss.of.precision: long, int\n+ShiftOutOfRange.java:39:18: compiler.warn.bit.shift.out.of.range: int, 32, 0\n+ShiftOutOfRange.java:40:18: compiler.warn.bit.shift.out.of.range: int, 32, 0\n+ShiftOutOfRange.java:41:19: compiler.warn.bit.shift.out.of.range: int, 32, 0\n+ShiftOutOfRange.java:42:15: compiler.warn.bit.shift.out.of.range: int, 32, 0\n+ShiftOutOfRange.java:43:15: compiler.warn.possible.loss.of.precision: long, int\n+ShiftOutOfRange.java:43:15: compiler.warn.bit.shift.out.of.range: int, 32, 0\n+ShiftOutOfRange.java:44:16: compiler.warn.bit.shift.out.of.range: int, 32, 0\n+ShiftOutOfRange.java:51:18: compiler.warn.bit.shift.out.of.range: long, -64, 0\n+ShiftOutOfRange.java:52:18: compiler.warn.bit.shift.out.of.range: long, -64, 0\n+ShiftOutOfRange.java:53:19: compiler.warn.bit.shift.out.of.range: long, -64, 0\n+ShiftOutOfRange.java:54:15: compiler.warn.bit.shift.out.of.range: long, -64, 0\n+ShiftOutOfRange.java:55:15: compiler.warn.bit.shift.out.of.range: long, -64, 0\n+ShiftOutOfRange.java:56:16: compiler.warn.bit.shift.out.of.range: long, -64, 0\n+ShiftOutOfRange.java:76:18: compiler.warn.bit.shift.out.of.range: long, 64, 0\n+ShiftOutOfRange.java:77:18: compiler.warn.bit.shift.out.of.range: long, 64, 0\n+ShiftOutOfRange.java:78:19: compiler.warn.bit.shift.out.of.range: long, 64, 0\n+ShiftOutOfRange.java:79:15: compiler.warn.bit.shift.out.of.range: long, 64, 0\n+ShiftOutOfRange.java:80:15: compiler.warn.bit.shift.out.of.range: long, 64, 0\n+ShiftOutOfRange.java:81:16: compiler.warn.bit.shift.out.of.range: long, 64, 0\n+28 warnings\n","filename":"test\/langtools\/tools\/javac\/lint\/ShiftOutOfRange.out","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"}]}