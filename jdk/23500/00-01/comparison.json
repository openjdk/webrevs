{"files":[{"patch":"@@ -38,0 +38,22 @@\n+JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void* reserved) {\n+#ifdef WINDOWS\n+    HMODULE handle;\n+    handle = GetModuleHandle(\"jvm.dll\");\n+    if (handle == NULL) {\n+        \/\/ No loaded jvm.dll. Get the handle to the executable.\n+        handle = GetModuleHandle(NULL);\n+    }\n+#endif\n+#ifdef WINDOWS\n+#define GET_VM_FUNCTION(f) GetProcAddress(handle, f)\n+#else\n+#define GET_VM_FUNCTION(f) dlsym(RTLD_DEFAULT, f)\n+#endif\n+    GetCreatedJavaVMs = (GetCreatedJavaVMs_t)GET_VM_FUNCTION(\"JNI_GetCreatedJavaVMs\");\n+    if (GetCreatedJavaVMs == NULL) {\n+        fprintf(stderr, \"Find JNI_GetCreatedJavaVMs failed\\n\");\n+        return JNI_ERR;\n+    }\n+    return JNI_VERSION_1_8;\n+}\n+\n@@ -91,21 +113,0 @@\n-    if (GetCreatedJavaVMs == NULL) {\n-#ifdef WINDOWS\n-        HMODULE handle;\n-        handle = GetModuleHandle(\"jvm.dll\");\n-        if (handle == NULL) {\n-            \/\/ No loaded jvm.dll. Get the handle to the executable.\n-            handle = GetModuleHandle(NULL);\n-        }\n-#endif\n-#ifdef WINDOWS\n-#define GET_VM_FUNCTION(f) GetProcAddress(handle, f)\n-#else\n-#define GET_VM_FUNCTION(f) dlsym(RTLD_DEFAULT, f)\n-#endif\n-        GetCreatedJavaVMs = (GetCreatedJavaVMs_t)GET_VM_FUNCTION(\"JNI_GetCreatedJavaVMs\");\n-        if (GetCreatedJavaVMs == NULL) {\n-            fprintf(stderr, \"Find JNI_GetCreatedJavaVMs failed\\n\");\n-            return;\n-        }\n-    }\n-\n","filename":"test\/jdk\/java\/lang\/Thread\/jni\/AttachCurrentThread\/libExplicitAttach.c","additions":22,"deletions":21,"binary":false,"changes":43,"status":"modified"}]}