{"files":[{"patch":"@@ -83,1 +83,0 @@\n-  BUILD_JDK_JTREG_LIBRARIES_JDK_LIBS_libExplicitAttach := java.base:libjvm\n","filename":"make\/test\/JtregNativeJdk.gmk","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -25,0 +25,5 @@\n+#ifdef WINDOWS\n+#include <windows.h>\n+#else\n+#include <dlfcn.h>\n+#endif \/\/ WINDOWS\n@@ -29,0 +34,26 @@\n+typedef jint (JNICALL *GetCreatedJavaVMs_t)(JavaVM **vmBuf, jsize bufLen, jsize *nVMs);\n+\n+GetCreatedJavaVMs_t GetCreatedJavaVMs = NULL;\n+\n+JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void* reserved) {\n+#ifdef WINDOWS\n+    HMODULE handle;\n+    handle = GetModuleHandle(\"jvm.dll\");\n+    if (handle == NULL) {\n+        \/\/ No loaded jvm.dll. Get the handle to the executable.\n+        handle = GetModuleHandle(NULL);\n+    }\n+#endif\n+#ifdef WINDOWS\n+#define GET_VM_FUNCTION(f) GetProcAddress(handle, f)\n+#else\n+#define GET_VM_FUNCTION(f) dlsym(RTLD_DEFAULT, f)\n+#endif\n+    GetCreatedJavaVMs = (GetCreatedJavaVMs_t)GET_VM_FUNCTION(\"JNI_GetCreatedJavaVMs\");\n+    if (GetCreatedJavaVMs == NULL) {\n+        fprintf(stderr, \"Find JNI_GetCreatedJavaVMs failed\\n\");\n+        return JNI_ERR;\n+    }\n+    return JNI_VERSION_1_8;\n+}\n+\n@@ -39,1 +70,1 @@\n-    res = JNI_GetCreatedJavaVMs(&vm, 1, &count);\n+    res = (*GetCreatedJavaVMs)(&vm, 1, &count);\n","filename":"test\/jdk\/java\/lang\/Thread\/jni\/AttachCurrentThread\/libExplicitAttach.c","additions":32,"deletions":1,"binary":false,"changes":33,"status":"modified"}]}