{"files":[{"patch":"@@ -25,5 +25,0 @@\n-#ifdef WINDOWS\n-#include <windows.h>\n-#else\n-#include <dlfcn.h>\n-#endif \/\/ WINDOWS\n@@ -34,1 +29,1 @@\n-typedef jint (JNICALL *GetCreatedJavaVMs_t)(JavaVM **vmBuf, jsize bufLen, jsize *nVMs);\n+static JavaVM *vm;\n@@ -36,21 +31,2 @@\n-GetCreatedJavaVMs_t GetCreatedJavaVMs = NULL;\n-\n-JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void* reserved) {\n-#ifdef WINDOWS\n-    HMODULE handle;\n-    handle = GetModuleHandle(\"jvm.dll\");\n-    if (handle == NULL) {\n-        \/\/ No loaded jvm.dll. Get the handle to the executable.\n-        handle = GetModuleHandle(NULL);\n-    }\n-#endif\n-#ifdef WINDOWS\n-#define GET_VM_FUNCTION(f) GetProcAddress(handle, f)\n-#else\n-#define GET_VM_FUNCTION(f) dlsym(RTLD_DEFAULT, f)\n-#endif\n-    GetCreatedJavaVMs = (GetCreatedJavaVMs_t)GET_VM_FUNCTION(\"JNI_GetCreatedJavaVMs\");\n-    if (GetCreatedJavaVMs == NULL) {\n-        fprintf(stderr, \"Find JNI_GetCreatedJavaVMs failed\\n\");\n-        return JNI_ERR;\n-    }\n+JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *jvm, void* reserved) {\n+    vm = jvm;\n@@ -64,1 +40,0 @@\n-    JavaVM *vm;\n@@ -70,6 +45,0 @@\n-    res = (*GetCreatedJavaVMs)(&vm, 1, &count);\n-    if (res != JNI_OK) {\n-        fprintf(stderr, \"JNI_GetCreatedJavaVMs failed: %d\\n\", res);\n-        return NULL;\n-    }\n-\n","filename":"test\/jdk\/java\/lang\/Thread\/jni\/AttachCurrentThread\/libExplicitAttach.c","additions":3,"deletions":34,"binary":false,"changes":37,"status":"modified"}]}