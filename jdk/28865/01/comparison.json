{"files":[{"patch":"@@ -26,8 +26,0 @@\n-import org.testng.ITestContext;\n-import org.testng.ITestResult;\n-import org.testng.SkipException;\n-import org.testng.annotations.AfterTest;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.BeforeMethod;\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n@@ -52,1 +44,0 @@\n-import java.util.Arrays;\n@@ -79,2 +70,11 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n+import org.junit.jupiter.api.AfterAll;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.extension.BeforeEachCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.junit.jupiter.api.extension.TestWatcher;\n@@ -84,17 +84,17 @@\n-    SSLContext sslContext;\n-    HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n-    HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n-    HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n-    HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n-    HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n-    String httpURI_fixed;\n-    String httpURI_chunk;\n-    String httpsURI_fixed;\n-    String httpsURI_chunk;\n-    String http2URI_fixed;\n-    String http2URI_chunk;\n-    String https2URI_fixed;\n-    String https2URI_chunk;\n-    String http3URI_fixed;\n-    String http3URI_chunk;\n-    String http3URI_head;\n+    static SSLContext sslContext;\n+    static HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n+    static HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n+    static HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n+    static HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n+    static HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n+    static String httpURI_fixed;\n+    static String httpURI_chunk;\n+    static String httpsURI_fixed;\n+    static String httpsURI_chunk;\n+    static String http2URI_fixed;\n+    static String http2URI_chunk;\n+    static String https2URI_fixed;\n+    static String https2URI_chunk;\n+    static String http3URI_fixed;\n+    static String http3URI_chunk;\n+    static String http3URI_head;\n@@ -119,2 +119,28 @@\n-    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n-    private volatile HttpClient sharedClient;\n+    static final class TestStopper implements TestWatcher, BeforeEachCallback {\n+        final AtomicReference<String> failed = new AtomicReference<>();\n+        TestStopper() { }\n+        @Override\n+        public void testFailed(ExtensionContext context, Throwable cause) {\n+            if (stopAfterFirstFailure()) {\n+                String msg = \"Aborting due to: \" + cause;\n+                failed.compareAndSet(null, msg);\n+                FAILURES.putIfAbsent(context.getDisplayName(), cause);\n+                System.out.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+                System.err.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+            }\n+        }\n+\n+        @Override\n+        public void beforeEach(ExtensionContext context) {\n+            String msg = failed.get();\n+            Assumptions.assumeTrue(msg == null, msg);\n+        }\n+    }\n+\n+    @RegisterExtension\n+    static final TestStopper stopper = new TestStopper();\n+\n+    static final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+    private static volatile HttpClient sharedClient;\n@@ -146,1 +172,1 @@\n-    protected boolean stopAfterFirstFailure() {\n+    protected static boolean stopAfterFirstFailure() {\n@@ -150,11 +176,0 @@\n-    final AtomicReference<SkipException> skiptests = new AtomicReference<>();\n-    void checkSkip() {\n-        var skip = skiptests.get();\n-        if (skip != null) throw skip;\n-    }\n-    static String name(ITestResult result) {\n-        var params = result.getParameters();\n-        return result.getName()\n-                + (params == null ? \"()\" : Arrays.toString(result.getParameters()));\n-    }\n-\n@@ -171,1 +186,1 @@\n-    HttpRequest.Builder newRequestBuilder(String uri) {\n+    static HttpRequest.Builder newRequestBuilder(String uri) {\n@@ -180,1 +195,1 @@\n-    HttpResponse<String> headRequest(HttpClient client)\n+    static HttpResponse<String> headRequest(HttpClient client)\n@@ -189,2 +204,2 @@\n-        assertEquals(response.statusCode(), 200);\n-        assertEquals(response.version(), HTTP_2);\n+        assertEquals(200, response.statusCode());\n+        assertEquals(HTTP_2, response.version());\n@@ -196,13 +211,2 @@\n-    @BeforeMethod\n-    void beforeMethod(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            if (skiptests.get() == null) {\n-                SkipException skip = new SkipException(\"some tests failed\");\n-                skip.setStackTrace(new StackTraceElement[0]);\n-                skiptests.compareAndSet(null, skip);\n-            }\n-        }\n-    }\n-\n-    @AfterClass\n-    static final void printFailedTests(ITestContext context) {\n+    @AfterAll\n+    static final void printFailedTests() {\n@@ -233,1 +237,1 @@\n-    private String[] uris() {\n+    private static String[] uris() {\n@@ -248,1 +252,1 @@\n-    static AtomicLong URICOUNT = new AtomicLong();\n+    static final AtomicLong URICOUNT = new AtomicLong();\n@@ -250,2 +254,1 @@\n-    @DataProvider(name = \"sanity\")\n-    public Object[][] sanity() {\n+    public static Object[][] sanity() {\n@@ -264,5 +267,1 @@\n-    @DataProvider(name = \"variants\")\n-    public Object[][] variants(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] variants() {\n@@ -285,1 +284,1 @@\n-    private HttpClient makeNewClient() {\n+    private static HttpClient makeNewClient() {\n@@ -287,1 +286,1 @@\n-        HttpClient client =  newClientBuilderForH3()\n+        HttpClient client =  HttpServerAdapters.createClientBuilderForH3()\n@@ -295,1 +294,1 @@\n-    HttpClient newHttpClient(boolean share) {\n+    static HttpClient newHttpClient(boolean share) {\n@@ -299,1 +298,1 @@\n-        synchronized (this) {\n+        synchronized (AbstractThrowingSubscribers.class) {\n@@ -360,1 +359,1 @@\n-                assertEquals(URI.create(u).getPath(), URI.create(uri2).getPath()));\n+                assertEquals(URI.create(uri2).getPath(), URI.create(u).getPath()));\n@@ -472,1 +471,0 @@\n-        checkSkip();\n@@ -554,1 +552,0 @@\n-\n@@ -822,2 +819,2 @@\n-    @BeforeTest\n-    public void setup() throws Exception {\n+    @BeforeAll\n+    public static void setup() throws Exception {\n@@ -905,2 +902,2 @@\n-    @AfterTest\n-    public void teardown() throws Exception {\n+    @AfterAll\n+    public static void teardown() throws Exception {\n","filename":"test\/jdk\/java\/net\/httpclient\/AbstractThrowingSubscribers.java","additions":76,"deletions":79,"binary":false,"changes":155,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStream\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStream\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsInputStream.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStreamAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStreamAsync\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsInputStreamAsync.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimiting\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimiting\n@@ -41,1 +41,0 @@\n-import org.testng.annotations.Test;\n@@ -46,0 +45,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -49,1 +50,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLimiting.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimitingAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimitingAsync\n@@ -41,1 +41,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -46,1 +47,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLimitingAsync.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLines\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLines\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLines.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLinesAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLinesAsync\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLinesAsync.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsString\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsString\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsString.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsStringAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsStringAsync\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsStringAsync.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersSanity\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersSanity\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"sanity\")\n+    @ParameterizedTest\n+    @MethodSource(\"sanity\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersSanity.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"}]}