{"files":[{"patch":"@@ -69,0 +69,4 @@\n+\/\/ All pointers in tmp_array must point to:\n+\/\/    - a buffered object; or\n+\/\/    - a source object that has been archived; or\n+\/\/    - (only when dumping dynamic archive) an object in the static archive.\n","filename":"src\/hotspot\/share\/cds\/archiveUtils.inline.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -550,1 +550,1 @@\n-  return _is_dumping_static_archive && _is_dumping_preimage_static_archive;\n+  return _is_dumping_preimage_static_archive;\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -192,1 +192,4 @@\n-\/\/ This is a map of all the original vtptrs. E.g., for\n+\/\/ _orig_cpp_vtptrs and _archived_cpp_vtptrs are used for type checking in\n+\/\/ CppVtables::get_archived_vtable().\n+\/\/\n+\/\/ _orig_cpp_vtptrs is a map of all the original vtptrs. E.g., for\n@@ -195,3 +198,7 @@\n-\/\/     _orig_cpp_vtptrs[ConstantPool_Kind] ==  ((intptr_t**)cp)[0]\n-static intptr_t* _orig_cpp_vtptrs[_num_cloned_vtable_kinds];      \/\/ vtptrs set by the C++ compiler\n-static intptr_t* _archived_cpp_vtptrs[_num_cloned_vtable_kinds];  \/\/ vtptrs used in the static archive\n+\/\/     _orig_cpp_vtptrs[ConstantPool_Kind] == ((intptr_t**)cp)[0]\n+\/\/\n+\/\/ _archived_cpp_vtptrs is a map of all the vptprs used by classes in a preimage. E.g., for\n+\/\/    InstanceKlass* k = a class loaded from the preimage;\n+\/\/    ConstantPool* cp = k->constants();\n+\/\/ the following holds true:\n+\/\/     _archived_cpp_vtptrs[ConstantPool_Kind] == ((intptr_t**)cp)[0]\n@@ -199,0 +206,2 @@\n+static intptr_t* _orig_cpp_vtptrs[_num_cloned_vtable_kinds];\n+static intptr_t* _archived_cpp_vtptrs[_num_cloned_vtable_kinds];\n@@ -248,1 +257,3 @@\n-  if (soc->writing() && CDSConfig::is_dumping_final_static_archive()) {\n+  if (soc->writing() && !CDSConfig::is_dumping_preimage_static_archive()) {\n+    \/\/ This table is written only when creating the preimage. It will be used\n+    \/\/ only when writing the final static archive.\n","filename":"src\/hotspot\/share\/cds\/cppVtables.cpp","additions":16,"deletions":5,"binary":false,"changes":21,"status":"modified"}]}