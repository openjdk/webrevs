{"files":[{"patch":"@@ -37,1 +37,0 @@\n-import java.lang.classfile.FieldBuilder;\n@@ -42,1 +41,0 @@\n-import java.lang.constant.DynamicConstantDesc;\n@@ -54,1 +52,1 @@\n-import java.lang.classfile.constantpool.MethodRefEntry;\n+\n@@ -58,2 +56,0 @@\n-import static java.lang.invoke.MethodHandles.Lookup.ClassOption.NESTMATE;\n-import static java.lang.invoke.MethodHandles.Lookup.ClassOption.STRONG;\n@@ -64,0 +60,1 @@\n+import jdk.internal.vm.annotation.Stable;\n@@ -74,1 +71,2 @@\n-    private static final String[] EMPTY_STRING_ARRAY = new String[0];\n+    private static final int ARG_NAME_CACHE_SIZE = 8; \/\/ Arbitrary cache size for common capture arg names\n+    private static final @Stable String[] ARG_NAME_CACHE = new String[ARG_NAME_CACHE_SIZE];\n@@ -99,1 +97,0 @@\n-    private final String[] argNames;                 \/\/ Generated names for the constructor arguments\n@@ -177,0 +174,2 @@\n+        ClassDesc[] argDescs;\n+        MethodTypeDesc constructorTypeDesc;\n@@ -178,1 +177,0 @@\n-            argNames = new String[parameterCount];\n@@ -181,1 +179,0 @@\n-                argNames[i] = \"arg$\" + (i + 1);\n@@ -184,0 +181,1 @@\n+            constructorTypeDesc = MethodTypeDescImpl.ofValidated(CD_void, argDescs);\n@@ -185,1 +183,0 @@\n-            argNames = EMPTY_STRING_ARRAY;\n@@ -187,0 +184,13 @@\n+            constructorTypeDesc = MTD_void;\n+        }\n+        this.argDescs = argDescs;\n+        this.constructorTypeDesc = constructorTypeDesc;\n+    }\n+\n+    private static String argName(int i) {\n+        String argName = i < ARG_NAME_CACHE_SIZE ? ARG_NAME_CACHE[i] : null;\n+        if (argName == null) {\n+            argName = \"arg$\" + (i + 1);\n+            if (i < ARG_NAME_CACHE_SIZE) {\n+                ARG_NAME_CACHE[i] = argName;\n+            }\n@@ -188,1 +198,1 @@\n-        constructorTypeDesc = MethodTypeDescImpl.ofValidated(CD_void, argDescs);\n+        return argName;\n@@ -316,1 +326,1 @@\n-                    clb.withField(argNames[i], argDescs[i], ACC_PRIVATE | ACC_FINAL);\n+                    clb.withField(argName(i), argDescs[i], ACC_PRIVATE | ACC_FINAL);\n@@ -399,1 +409,1 @@\n-                               .putfield(pool.fieldRefEntry(lambdaClassEntry, pool.nameAndTypeEntry(argNames[i], argDescs[i])));\n+                               .putfield(pool.fieldRefEntry(lambdaClassEntry, pool.nameAndTypeEntry(argName(i), argDescs[i])));\n@@ -451,1 +461,1 @@\n-                               .getfield(pool.fieldRefEntry(lambdaClassEntry, pool.nameAndTypeEntry(argNames[i], argDescs[i])));\n+                               .getfield(pool.fieldRefEntry(lambdaClassEntry, pool.nameAndTypeEntry(argName(i), argDescs[i])));\n@@ -508,1 +518,1 @@\n-                for (int i = 0; i < argNames.length; i++) {\n+                for (int i = 0; i < argDescs.length; i++) {\n@@ -510,1 +520,1 @@\n-                       .getfield(pool.fieldRefEntry(lambdaClassEntry, pool.nameAndTypeEntry(argNames[i], argDescs[i])));\n+                       .getfield(pool.fieldRefEntry(lambdaClassEntry, pool.nameAndTypeEntry(argName(i), argDescs[i])));\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/InnerClassLambdaMetafactory.java","additions":26,"deletions":16,"binary":false,"changes":42,"status":"modified"}]}