{"files":[{"patch":"@@ -165,1 +165,0 @@\n-                Content c;\n@@ -168,1 +167,3 @@\n-                } else if (linkTarget != null) {\n+                }\n+                Content c = Text.of(text);\n+                if (linkTarget != null) {\n@@ -177,1 +178,1 @@\n-                                false, \/\/ TODO: for now\n+                                true,\n@@ -184,2 +185,3 @@\n-                } else {\n-                    c = HtmlTree.SPAN(Text.of(text));\n+                }\n+                if (!classes.isEmpty()) {\n+                    c = HtmlTree.SPAN(c);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/taglets\/SnippetTaglet.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8266666 8281969 8319339 8338833\n+ * @bug 8266666 8281969 8319339 8338833 8371896\n@@ -183,1 +183,1 @@\n-                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(true, \"java.lang.Object#Object\", r.group(1)))\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"java.lang.Object#Object\", r.group(1)))\n@@ -193,1 +193,1 @@\n-                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(true, \"java.lang.System#out\", r.group(1)))\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"java.lang.System#out\", r.group(1)))\n@@ -203,1 +203,62 @@\n-                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(true, \"java.lang.System#in\", r.group(1)))\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"java.lang.System#in\", r.group(1)))\n+                )\n+        );\n+        testPositive(base, testCases);\n+    }\n+\n+    \/\/ Test combinations of @link, @highlight and @replace on the same or overlapping substrings.\n+    @Test\n+    public void testLinkHighlightReplace(Path base) throws Exception {\n+        var testCases = List.of(\n+                new TestCase(\n+                        \"\"\"\n+                                void method(Object o);  \/\/ @link substring=Object target=Object @highlight substring=Object\n+                                \"\"\",\n+                        replace(\"\"\"\n+                                void method(<span class=\"bold\">link(Object)<\/span> o);\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"Object\", r.group(1)))\n+                ),\n+                new TestCase(\n+                        \"\"\"\n+                                void method(Object o); \/\/ @replace substring=Object replacement=String \\\n+                                @highlight substring=String @link substring=String target=String\n+                                \"\"\",\n+                        replace(\"\"\"\n+                                void method(<span class=\"bold\">link(String)<\/span> o);\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"String\", r.group(1)))\n+                ),\n+                new TestCase(\n+                        \"\"\"\n+                                void method(Object o);  \/\/ @highlight substring=\"(Object o)\" @link substring=Object target=Object\n+                                \"\"\",\n+                        replace(\"\"\"\n+                                void method<span class=\"bold\">(<\/span><span class=\"bold\">link(Object)<\/span><span class=\"bold\"> o)<\/span>;\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"Object\", r.group(1)))\n+                ),\n+                new TestCase(\n+                        \"\"\"\n+                                void method(Object o); \/\/ @replace substring=Object replacement=String \\\n+                                @link substring=String target=String @highlight substring=\"(String o)\"\n+                                \"\"\",\n+                        replace(\"\"\"\n+                                void method<span class=\"bold\">(<\/span><span class=\"bold\">link(String)<\/span><span class=\"bold\"> o)<\/span>;\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"String\", r.group(1)))\n+                ),\n+                new TestCase(\n+                        \"\"\"\n+                                void method(Object o); \/\/ @replace substring=Object replacement=String \\\n+                                @link substring=\"String o\" target=String @highlight substring=String\n+                                \"\"\",\n+                        replace(\"\"\"\n+                                void method(<span class=\"bold\">link(String)<\/span>link( o));\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"String\", r.group(1)))\n+                ),\n+                \/\/ replacement subtext does not retain links and highlights of the replaced subtext\n+                new TestCase(\n+                        \"\"\"\n+                                void method(Object o); \/\/ @link substring=Object target=Object \\\n+                                @highlight substring=Object @replace substring=Object replacement=String\n+                                \"\"\",\n+                        \"\"\"\n+                                void method(String o);\n+                                \"\"\"\n@@ -248,1 +309,1 @@\n-                        <pre><code>Second<\/code><\/pre>\n+                        <pre>Second<\/pre>\n@@ -649,1 +710,1 @@\n-                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(true, \"java.lang.Object#equals(Object)\", r.group(1)))\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(\"java.lang.Object#equals(Object)\", r.group(1)))\n@@ -913,2 +974,1 @@\n-    private static String link(boolean linkPlain,\n-                               String targetReference,\n+    private static String link(String targetReference,\n@@ -938,1 +998,1 @@\n-                \/** {@link %s %s} *\/\n+                \/** {@linkplain %s %s} *\/\n@@ -1066,2 +1126,2 @@\n-            Matcher m = Pattern.compile(\"(?is)(<a href=\\\"[^<>]*\\\" title=\\\"[^<>]*\\\" class=\\\"[^<>]*\\\"><code>)\"\n-                    +  LABEL_PLACEHOLDER + \"(<\/code><\/a>)\").matcher(output);\n+            Matcher m = Pattern.compile(\"(?is)(<a href=\\\"[^<>]*\\\" title=\\\"[^<>]*\\\" class=\\\"[^<>]*\\\">)\"\n+                    +  LABEL_PLACEHOLDER + \"(<\/a>)\").matcher(output);\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSnippetTag\/TestSnippetMarkup.java","additions":71,"deletions":11,"binary":false,"changes":82,"status":"modified"}]}