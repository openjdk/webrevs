{"files":[{"patch":"@@ -492,1 +492,0 @@\n-java\/awt\/Graphics2D\/CopyAreaOOB.java 8343106 macosx-aarch64\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * destination parameters are outside the destination bounds.\n+ *          destination parameters are outside the destination bounds.\n@@ -31,1 +31,0 @@\n- * @author campbelc\n@@ -34,2 +33,22 @@\n-import java.awt.*;\n-import java.awt.image.*;\n+import java.awt.Canvas;\n+import java.awt.Color;\n+import java.awt.Dimension;\n+import java.awt.EventQueue;\n+import java.awt.Frame;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.GraphicsConfiguration;\n+import java.awt.GraphicsEnvironment;\n+import java.awt.Image;\n+import java.awt.Point;\n+import java.awt.Rectangle;\n+import java.awt.Robot;\n+import java.awt.Toolkit;\n+import java.awt.image.BufferedImage;\n+import java.awt.image.MultiResolutionImage;\n+import java.awt.image.RenderedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.List;\n+\n+import javax.imageio.ImageIO;\n@@ -38,0 +57,3 @@\n+    private static Frame frame;\n+    private static Robot robot;\n+    private static BufferedImage captureImg;\n@@ -39,1 +61,36 @@\n-    private static Robot robot = null;\n+    private static StringBuffer errorLog = new StringBuffer();\n+\n+    private static final Point OFF_FRAME_LOC = new Point(50, 50);\n+    private static final int SIZE = 400;\n+\n+    public static void main(String[] args) throws Exception {\n+        try {\n+            robot = new Robot();\n+\n+            \/\/ added to move mouse pointer away from test UI\n+            \/\/ so that it is not captured in the screenshot\n+            robot.mouseMove(OFF_FRAME_LOC.x, OFF_FRAME_LOC.y);\n+            robot.waitForIdle();\n+            robot.delay(100);\n+\n+            createTestUI();\n+            robot.delay(1000);\n+\n+            if (!errorLog.isEmpty()) {\n+                saveImages();\n+                throw new RuntimeException(\"Test failed: \\n\" + errorLog.toString());\n+            }\n+        } finally {\n+            EventQueue.invokeAndWait(frame::dispose);\n+        }\n+    }\n+\n+    private static void createTestUI() {\n+        CopyAreaOOB canvas = new CopyAreaOOB();\n+        frame = new Frame();\n+        frame.setUndecorated(true);\n+        frame.add(canvas);\n+        frame.pack();\n+        frame.setLocationRelativeTo(null);\n+        frame.setVisible(true);\n+    }\n@@ -53,1 +110,1 @@\n-        g2d.fillRect(0, 10, 50, h-10);\n+        g2d.fillRect(0, 10, 50, h - 10);\n@@ -57,1 +114,1 @@\n-        g2d.copyArea(0, 10, 50, h-10, 60, 10);\n+        g2d.copyArea(0, 10, 50, h - 10, 60, 10);\n@@ -61,10 +118,6 @@\n-        BufferedImage capture = null;\n-        try {\n-            Thread.sleep(500);\n-            if (robot == null) robot = new Robot();\n-            Point pt1 = getLocationOnScreen();\n-            Rectangle rect = new Rectangle(pt1.x, pt1.y, 400, 400);\n-            capture = robot.createScreenCapture(rect);\n-        } catch (Exception e) {\n-            throw new RuntimeException(\"Problems handling Robot\");\n-        }\n+        robot.delay(500);\n+\n+        Point pt1 = this.getLocationOnScreen();\n+        Rectangle rect = new Rectangle(pt1.x, pt1.y, SIZE, SIZE);\n+        captureImg = robot.createScreenCapture(rect);\n+\n@@ -72,6 +125,6 @@\n-        testRegion(capture, \"green\",          0,   0, 400,  10, 0xff00ff00);\n-        testRegion(capture, \"original red\",   0,  10,  50, 400, 0xffff0000);\n-        testRegion(capture, \"background\",    50,  10,  60, 400, 0xff000000);\n-        testRegion(capture, \"in-between\",    60,  10, 110,  20, 0xff000000);\n-        testRegion(capture, \"copied red\",    60,  20, 110, 400, 0xffff0000);\n-        testRegion(capture, \"background\",   110,  10, 400, 400, 0xff000000);\n+        testRegion(\"green\", 0, 0, 400, 10, 0xff00ff00);\n+        testRegion(\"original-red\", 0, 10, 50, 400, 0xffff0000);\n+        testRegion(\"background\", 50, 10, 60, 400, 0xff000000);\n+        testRegion(\"in-between\", 60, 10, 110, 20, 0xff000000);\n+        testRegion(\"copied-red\", 60, 20, 110, 400, 0xffff0000);\n+        testRegion(\"background\", 110, 10, 400, 400, 0xff000000);\n@@ -81,1 +134,1 @@\n-        return new Dimension(400, 400);\n+        return new Dimension(SIZE, SIZE);\n@@ -84,1 +137,1 @@\n-    private static void testRegion(BufferedImage bi, String name,\n+    private static void testRegion(String region,\n@@ -86,2 +139,2 @@\n-                                   int expected)\n-    {\n+                                   int expected) {\n+        System.out.print(\"Test region: \" + region);\n@@ -90,1 +143,1 @@\n-                int actual = bi.getRGB(x, y);\n+                int actual = captureImg.getRGB(x, y);\n@@ -92,7 +145,8 @@\n-                    throw new RuntimeException(\"Test failed for \" + name +\n-                                                       \" region at x=\"+x+\" y=\"+y+\n-                                                       \" (expected=\"+\n-                                                       Integer.toHexString(expected) +\n-                                                       \" actual=\"+\n-                                                       Integer.toHexString(actual) +\n-                                                       \")\");\n+                    System.out.print(\" Status: FAILED\\n\");\n+                    errorLog.append(\"Test failed for \" + region\n+                                                + \" region at x: \" + x + \" y: \" + y\n+                                                + \" (expected: \"\n+                                                + Integer.toHexString(expected)\n+                                                + \" actual: \"\n+                                                + Integer.toHexString(actual) + \")\\n\");\n+                    return;\n@@ -102,0 +156,1 @@\n+        System.out.print(\" Status: PASSED\\n\");\n@@ -104,2 +159,4 @@\n-    public static void main(String[] args) {\n-        boolean show = (args.length == 1) && (\"-show\".equals(args[0]));\n+    private static void saveImages() {\n+        GraphicsConfiguration ge = GraphicsEnvironment.getLocalGraphicsEnvironment()\n+                                                      .getDefaultScreenDevice()\n+                                                      .getDefaultConfiguration();\n@@ -107,7 +164,3 @@\n-        CopyAreaOOB test = new CopyAreaOOB();\n-        Frame frame = new Frame();\n-        frame.setUndecorated(true);\n-        frame.add(test);\n-        frame.pack();\n-        frame.setLocationRelativeTo(null);\n-        frame.setVisible(true);\n+        MultiResolutionImage mrImage = robot.createMultiResolutionScreenCapture(ge.getBounds());\n+        List<Image> variants = mrImage.getResolutionVariants();\n+        RenderedImage screenCapture = (RenderedImage) variants.get(variants.size() - 1);\n@@ -116,4 +169,4 @@\n-            Thread.sleep(3000);\n-        } catch (InterruptedException ex) {}\n-        if (!show) {\n-            frame.dispose();\n+            ImageIO.write(screenCapture, \"png\", new File(\"fullscreen.png\"));\n+            ImageIO.write(captureImg, \"png\", new File(\"canvas.png\"));\n+        } catch (IOException e) {\n+            System.err.println(\"Can't write image \" + e);\n","filename":"test\/jdk\/java\/awt\/Graphics2D\/CopyAreaOOB.java","additions":102,"deletions":49,"binary":false,"changes":151,"status":"modified"}]}