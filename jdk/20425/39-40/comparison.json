{"files":[{"patch":"@@ -97,8 +97,8 @@\n-    return;\n-    \/\/ Will be commented out after 8350567. The error outputs corrupt the jdk-image.\n-    \/\/ log_error(nmt)(\"summary mismatch, at %s, for %s,\"\n-    \/\/                \" diff-reserved:  %ld\"\n-    \/\/                \" diff-committed: %ld\"\n-    \/\/                \" vms-reserved: %zu\"\n-    \/\/                \" vms-committed: %zu\",\n-    \/\/                str, NMTUtil::tag_to_name(tag), (long)reserve_delta, (long)commit_delta, reserved, committed);\n+#ifdef ASSERT\n+    log_error(nmt)(\"summary mismatch, at %s, for %s,\"\n+                   \" diff-reserved:  %ld\"\n+                   \" diff-committed: %ld\"\n+                   \" vms-reserved: %zu\"\n+                   \" vms-committed: %zu\",\n+                   str, NMTUtil::tag_to_name(tag), (long)reserve_delta, (long)commit_delta, reserved, committed);\n+#endif\n","filename":"src\/hotspot\/share\/nmt\/virtualMemoryTracker.cpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -421,2 +421,1 @@\n-  DEBUG_ONLY(print_case();)\n-  switch(row) {\n+    switch(row) {\n","filename":"src\/hotspot\/share\/nmt\/vmatree.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -263,1 +263,0 @@\n-    print_tree(et, line_no);\n@@ -309,1 +308,0 @@\n-    print_tree(et, line_no);\n@@ -353,0 +351,10 @@\n+TEST_VM_F(NMTVMATreeTest, DuplicateReserve) {\n+  VMATree::RegionData rd{si[0], mtTest};\n+  Tree tree;\n+  tree.reserve_mapping(100, 100, rd);\n+  tree.reserve_mapping(100, 100, rd);\n+  EXPECT_EQ(2, count_nodes(tree));\n+  VMATree::VMATreap::Range r = tree.tree().find_enclosing_range(110);\n+  EXPECT_EQ(100, (int)(r.end->key() - r.start->key()));\n+}\n+\n","filename":"test\/hotspot\/gtest\/nmt\/test_vmatree.cpp","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -100,4 +100,0 @@\n-    address frame = (address)0x1235;\n-    NativeCallStack stack(&frame, 1);\n-    VirtualMemoryTracker::Instance::add_reserved_region((address)base, size, stack, mtThreadStack);\n-\n","filename":"test\/hotspot\/gtest\/runtime\/test_committed_virtualmemory.cpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -170,0 +170,2 @@\n+    RegionsTree* rtree = VirtualMemoryTracker::Instance::tree();\n+    rtree->tree().remove_all();\n@@ -183,3 +185,0 @@\n-    \/\/ Add the reserved memory\n-    VirtualMemoryTracker::Instance::add_reserved_region(addr, size, stack, mtTest);\n-\n@@ -187,1 +186,0 @@\n-    RegionsTree* rtree = VirtualMemoryTracker::Instance::tree();\n@@ -260,0 +258,2 @@\n+    RegionsTree* rtree = VirtualMemoryTracker::Instance::tree();\n+    rtree->tree().remove_all();\n@@ -275,1 +275,0 @@\n-    RegionsTree* rtree = VirtualMemoryTracker::Instance::tree();\n@@ -436,0 +435,2 @@\n+    RegionsTree* rtree = VirtualMemoryTracker::Instance::tree();\n+    rtree->tree().remove_all();\n@@ -450,1 +451,0 @@\n-    RegionsTree* rtree = VirtualMemoryTracker::Instance::tree();\n","filename":"test\/hotspot\/gtest\/runtime\/test_virtualMemoryTracker.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -172,8 +172,11 @@\n-          if (pretouch_committed <= (no_pretouch_committed + expected_delta)) {\n-            throw new RuntimeException(\"Expected a higher amount of committed with pretouch stacks\" +\n-                                       \"PreTouch amount: \" + pretouch_committed +\n-                                       \"NoPreTouch amount: \" + (no_pretouch_committed + expected_delta));\n-          }\n-          if (actual_delta < expected_delta) {\n-            throw new RuntimeException(\"Expected a higher delta between stack committed of with and without pretouch.\" +\n-                                       \"Expected: \" + expected_delta + \" Actual: \" + actual_delta);\n+          if (((double)pretouch_committed) \/ ((double)no_pretouch_committed) < 1.20) {\n+            if (pretouch_committed <= (no_pretouch_committed + expected_delta)) {\n+              throw new RuntimeException(\"Expected a higher amount of committed with pretouch stacks\" +\n+                                        \" PreTouch amount: \" + pretouch_committed +\n+                                        \" NoPreTouch amount: \" + no_pretouch_committed +\n+                                        \" Expected delta: \" + expected_delta);\n+            }\n+            if (actual_delta < expected_delta) {\n+              throw new RuntimeException(\"Expected a higher delta between stack committed of with and without pretouch.\" +\n+                                        \" Expected: \" + expected_delta + \" Actual: \" + actual_delta);\n+            }\n","filename":"test\/hotspot\/jtreg\/runtime\/Thread\/TestAlwaysPreTouchStacks.java","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"}]}