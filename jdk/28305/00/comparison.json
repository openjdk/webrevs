{"files":[{"patch":"@@ -123,5 +123,0 @@\n-        try {\n-            String tempDirectory = env.buildRoot().toAbsolutePath().toString();\n-            if (WindowsDefender.isThereAPotentialWindowsDefenderIssue(tempDirectory)) {\n-                Log.verbose(I18N.format(\"message.potential.windows.defender.issue\", tempDirectory));\n-            }\n@@ -129,1 +124,4 @@\n-            target.toFile().setWritable(true, true);\n+        String tempDirectory = env.buildRoot().toAbsolutePath().toString();\n+        if (WindowsDefender.isThereAPotentialWindowsDefenderIssue(tempDirectory)) {\n+            Log.verbose(I18N.format(\"message.potential.windows.defender.issue\", tempDirectory));\n+        }\n@@ -131,5 +129,5 @@\n-            var shortTargetPath = ShortPathUtils.toShortPath(target);\n-            long resourceLock = lockResource(shortTargetPath.orElse(target).toString());\n-            if (resourceLock == 0) {\n-                throw I18N.buildException().message(\"error.lock-resource\", shortTargetPath.orElse(target)).create(RuntimeException::new);\n-            }\n+        var shortTargetPath = ShortPathUtils.toShortPath(target);\n+        long resourceLock = lockResource(shortTargetPath.orElse(target).toString());\n+        if (resourceLock == 0) {\n+            throw I18N.buildException().message(\"error.lock-resource\", shortTargetPath.orElse(target)).create(RuntimeException::new);\n+        }\n@@ -137,18 +135,17 @@\n-            final boolean resourceUnlockedSuccess;\n-            try {\n-                for (var action : actions) {\n-                    action.editResource(resourceLock);\n-                }\n-            } finally {\n-                if (resourceLock == 0) {\n-                    resourceUnlockedSuccess = true;\n-                } else {\n-                    resourceUnlockedSuccess = unlockResource(resourceLock);\n-                    if (shortTargetPath.isPresent()) {\n-                        \/\/ Windows will rename the excuatble in the unlock operation.\n-                        \/\/ Should restore executable's name.\n-                        var tmpPath = target.getParent().resolve(\n-                                target.getFileName().toString() + \".restore\");\n-                        Files.move(shortTargetPath.get(), tmpPath);\n-                        Files.move(tmpPath, target);\n-                    }\n+        final boolean resourceUnlockedSuccess;\n+        try {\n+            for (var action : actions) {\n+                action.editResource(resourceLock);\n+            }\n+        } finally {\n+            if (resourceLock == 0) {\n+                resourceUnlockedSuccess = true;\n+            } else {\n+                resourceUnlockedSuccess = unlockResource(resourceLock);\n+                if (shortTargetPath.isPresent()) {\n+                    \/\/ Windows will rename the excutable in the unlock operation.\n+                    \/\/ Should restore executable's name.\n+                    var tmpPath = target.getParent().resolve(\n+                            target.getFileName().toString() + \".restore\");\n+                    Files.move(shortTargetPath.get(), tmpPath);\n+                    Files.move(tmpPath, target);\n@@ -157,0 +154,1 @@\n+        }\n@@ -158,5 +156,2 @@\n-            if (!resourceUnlockedSuccess) {\n-                throw I18N.buildException().message(\"error.unlock-resource\", target).create(RuntimeException::new);\n-            }\n-        } finally {\n-            target.toFile().setReadOnly();\n+        if (!resourceUnlockedSuccess) {\n+            throw I18N.buildException().message(\"error.unlock-resource\", target).create(RuntimeException::new);\n","filename":"src\/jdk.jpackage\/windows\/classes\/jdk\/jpackage\/internal\/ExecutableRebrander.java","additions":29,"deletions":34,"binary":false,"changes":63,"status":"modified"}]}