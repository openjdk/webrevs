{"files":[{"patch":"@@ -381,1 +381,1 @@\n-void os::Linux::kernel_version(long* major, long* minor) {\n+void os::Linux::kernel_version(long* major, long* patch, long* sub) {\n@@ -383,1 +383,2 @@\n-  *minor = -1;\n+  *patch = -1;\n+  *sub   = -1;\n@@ -391,3 +392,3 @@\n-  int nr_matched = sscanf(buffer.release, \"%ld.%ld\", major, minor);\n-  if (nr_matched != 2) {\n-    log_warning(os)(\"Parsing kernel version failed, expected 2 version numbers, only matched %d\", nr_matched);\n+  int nr_matched = sscanf(buffer.release, \"%ld.%ld.%ld\", major, patch, sub);\n+  if (nr_matched != 3) {\n+    log_warning(os)(\"Parsing kernel version failed, expected 3 version numbers, only matched %d\", nr_matched);\n@@ -397,0 +398,17 @@\n+int os::Linux::kernel_version_compare(long major1, long patch1, long sub1,\n+                                      long major2, long patch2, long sub2) {\n+  \/\/ Compare major versions\n+  if (major1 > major2) return 1;\n+  if (major1 < major2) return -1;\n+\n+  \/\/ Compare patch versions\n+  if (patch1 > patch2) return 1;\n+  if (patch1 < patch2) return -1;\n+\n+  \/\/ Compare sublevel versions\n+  if (sub1 > sub2) return 1;\n+  if (sub1 < sub2) return -1;\n+\n+  return 0;\n+}\n+\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":23,"deletions":5,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -94,1 +94,7 @@\n-  static void kernel_version(long* major, long* minor);\n+  static void kernel_version(long* major, long* patch, long* sub);\n+\n+  \/\/ If kernel1 > kernel2 return  1\n+  \/\/ If kernel1 < kernel2 return -1\n+  \/\/ If kernel1 = kernel2 return  0\n+  static int kernel_version_compare(long major1, long patch1, long sub1,\n+                                    long major2, long patch2, long sub2);\n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -69,5 +69,5 @@\n-  long major, minor;\n-  os::Linux::kernel_version(&major, &minor);\n-  if (!(major > 6 || (major == 6 && minor >= 9))) {\n-    log_info(os)(\"Linux kernel %ld.%ld does not support MEMBARRIER PRIVATE_EXPEDITED on RISC-V.\",\n-                 major, minor);\n+  long major, patch, sub;\n+  os::Linux::kernel_version(&major, &patch, &sub);\n+  if (os::Linux::kernel_version_compare(major, patch, sub, 6, 9, 0) == -1) {\n+    log_info(os)(\"Linux kernel %ld.%ld.%ld does not support MEMBARRIER PRIVATE_EXPEDITED on RISC-V.\",\n+                 major, patch, sub);\n","filename":"src\/hotspot\/os\/linux\/systemMemoryBarrier_linux.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"}]}