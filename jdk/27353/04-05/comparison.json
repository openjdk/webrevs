{"files":[{"patch":"@@ -264,1 +264,1 @@\n-    if (ctx->is_marked_strong(left)) {\n+    if (ctx->is_marked(left)) {\n@@ -271,4 +271,3 @@\n-      \/\/ In the case that this region was most recently marked as young, the fact that this region has been promoted\n-      \/\/ in place denotes that final mark (Young) has completed.  In the case that this region was most recently marked\n-      \/\/ as old, the fact that (ctx != nullptr) denotes that old marking has completed.  Otherwise, ctx would equal null.\n-\n+      \/\/ In the case that this region was most recently marked as young, the fact that this region has been promoted in place\n+      \/\/ denotes that final mark (Young) has completed.  In the case that this region was most recently marked as old, the\n+      \/\/ fact that (ctx != nullptr) denotes that old marking has completed.  Otherwise, ctx would equal null.\n@@ -276,4 +275,1 @@\n-      \/\/ Given that marking has completed, if this object is only marked weakly, then this object is dead.  Its memory will\n-      \/\/ be reclaimed momentarily.  Since this object is dead, its class may also be reclaimed.  Therefore, we cannot\n-      \/\/ rely on its size() method, and we should not scan its pointers.\n-      if ((prev <= left) && ctx->is_marked_strong(prev)) {\n+      if (prev <= left) {\n@@ -288,4 +284,3 @@\n-    \/\/ Either prev >= left (no previous object found), or the previous object that was found ends before my card range begins,\n-    \/\/ or the previously object that was found was only weakly marked, so it should not be scanned.  In all of these cases,\n-    \/\/ find the next strongly marked object if any on this card\n-    assert(!ctx->is_marked_strong(left), \"Was dealt with above\");\n+    \/\/ Either prev >= left (no previous object found), or the previous object that was found ends before my card range begins.\n+    \/\/ In eiher case, find the next marked object if any on this card\n+    assert(!ctx->is_marked(left), \"Was dealt with above\");\n@@ -294,4 +289,1 @@\n-    HeapWord* next = left - 1;\n-    do {\n-      next = ctx->get_next_marked_addr(next + 1, right);\n-    } while ((next <  right) && !ctx->is_marked_strong(next));\n+    HeapWord* next = ctx->get_next_marked_addr(left, right);\n@@ -304,5 +296,1 @@\n-    \/\/ If top_at_mark_start(region) is within this card's range, we will return its value.  If the returned value\n-    \/\/ is less than region->top(), then the returned value represents an object that should be scanned.  Otherwise,\n-    \/\/ the returned value equals region->top() and will not be scanned.  There are no races with ongoing allocations\n-    \/\/ within old generation because this function is only called during concurrent marking and during concurrent\n-    \/\/ update references.\n+    \/\/ Note: returned value may point beyond this card's range of memory, and may not point to an allocated object.\n@@ -340,1 +328,1 @@\n-    if (ctx->is_marked_strong(p)) {\n+    if (ctx->is_marked(p)) {\n@@ -347,2 +335,1 @@\n-      \/\/ Object that spans start of card is dead, so should not be scanned.\n-      \/\/ From above, we know that if (ctx != nullptr), left >= tams.  Therefore, left + offset >= tams.\n+      \/\/ Object that spans start of card is dead, so should not be scanned\n@@ -366,3 +353,0 @@\n-  \/\/ p points to first object that precedes the start of card card_index.  The object is \"alive\".\n-  assert((ctx == nullptr) || (p >= tams), \"Sanity\");\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahScanRemembered.cpp","additions":12,"deletions":28,"binary":false,"changes":40,"status":"modified"}]}