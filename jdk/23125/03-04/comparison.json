{"files":[{"patch":"@@ -476,0 +476,15 @@\n+void ObjectMonitor::notify_contended_enter(JavaThread *current) {\n+  current->set_current_pending_monitor(this);\n+\n+  DTRACE_MONITOR_PROBE(contended__enter, this, object(), current);\n+  if (JvmtiExport::should_post_monitor_contended_enter()) {\n+    JvmtiExport::post_monitor_contended_enter(current, this);\n+\n+    \/\/ The current thread does not yet own the monitor and does not\n+    \/\/ yet appear on any queues that would get it made the successor.\n+    \/\/ This means that the JVMTI_EVENT_MONITOR_CONTENDED_ENTER event\n+    \/\/ handler cannot accidentally consume an unpark() meant for the\n+    \/\/ ParkEvent associated with this ObjectMonitor.\n+  }\n+}\n+\n@@ -496,12 +511,0 @@\n-  current->set_current_pending_monitor(this);\n-\n-  DTRACE_MONITOR_PROBE(contended__enter, this, object(), current);\n-  if (JvmtiExport::should_post_monitor_contended_enter()) {\n-    JvmtiExport::post_monitor_contended_enter(current, this);\n-\n-    \/\/ The current thread does not yet own the monitor and does not\n-    \/\/ yet appear on any queues that would get it made the successor.\n-    \/\/ This means that the JVMTI_EVENT_MONITOR_CONTENDED_ENTER event\n-    \/\/ handler cannot accidentally consume an unpark() meant for the\n-    \/\/ ParkEvent associated with this ObjectMonitor.\n-  }\n@@ -510,1 +513,3 @@\n-  if (ce != nullptr && ce->is_virtual_thread()) {\n+  bool is_virtual = ce != nullptr && ce->is_virtual_thread();\n+  if (is_virtual) {\n+    notify_contended_enter(current);\n@@ -537,0 +542,3 @@\n+    if (!is_virtual) { \/\/ already notified contended_enter for virtual\n+      notify_contended_enter(current);\n+    }\n","filename":"src\/hotspot\/share\/runtime\/objectMonitor.cpp","additions":21,"deletions":13,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -393,0 +393,1 @@\n+  void      notify_contended_enter(JavaThread *current);\n","filename":"src\/hotspot\/share\/runtime\/objectMonitor.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}