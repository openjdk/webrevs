{"files":[{"patch":"@@ -122,2 +122,2 @@\n-    log_info(cds,dynamic)(\"CDS dynamic dump: clinit = \" INT64_FORMAT \"ms)\",\n-                          (int64_t)ClassLoader::class_init_time_ms());\n+    log_info(cds,dynamic)(\"CDS dynamic dump: clinit = \" JLONG_FORMAT \"ms)\",\n+                          ClassLoader::class_init_time_ms());\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -81,0 +81,1 @@\n+#include \"utilities\/ostream.hpp\"\n@@ -138,16 +139,13 @@\n-void ClassLoader::print_counters() {\n-  if (ProfileClassLinkage) {\n-    LogStreamHandle(Info, init) log;\n-    if (log.is_enabled()) {\n-      log.print_cr(\"ClassLoader:\");\n-      log.print_cr(\"  clinit:               \" INT64_FORMAT \"ms \/ \" INT64_FORMAT \" events\", (int64_t)ClassLoader::class_init_time_ms(), (int64_t)ClassLoader::class_init_count());\n-      log.print_cr(\"  link methods:         \" INT64_FORMAT \"ms \/ \" INT64_FORMAT \" events\", (int64_t)Management::ticks_to_ms(_perf_ik_link_methods_time->get_value())   , (int64_t)_perf_ik_link_methods_count->get_value());\n-      log.print_cr(\"  method adapters:      \" INT64_FORMAT \"ms \/ \" INT64_FORMAT \" events\", (int64_t)Management::ticks_to_ms(_perf_method_adapters_time->get_value())   , (int64_t)_perf_method_adapters_count->get_value());\n-      log.print_cr(\"  resolve...\");\n-      log.print_cr(\"    invokedynamic:   \" INT64_FORMAT \"ms \/ \" INT64_FORMAT \" events\", (int64_t)Management::ticks_to_ms(_perf_resolve_indy_time->get_value())         , (int64_t)_perf_resolve_indy_count->get_value());\n-      log.print_cr(\"    invokehandle:    \" INT64_FORMAT \"ms \/ \" INT64_FORMAT \" events\", (int64_t)Management::ticks_to_ms(_perf_resolve_invokehandle_time->get_value()) , (int64_t)_perf_resolve_invokehandle_count->get_value());\n-      log.print_cr(\"    CP_MethodHandle: \" INT64_FORMAT \"ms \/ \" INT64_FORMAT \" events\", (int64_t)Management::ticks_to_ms(_perf_resolve_mh_time->get_value())           , (int64_t)_perf_resolve_mh_count->get_value());\n-      log.print_cr(\"    CP_MethodType:   \" INT64_FORMAT \"ms \/ \" INT64_FORMAT \" events\", (int64_t)Management::ticks_to_ms(_perf_resolve_mt_time->get_value())           , (int64_t)_perf_resolve_mt_count->get_value());\n-      log.cr();\n-    }\n-  }\n+void ClassLoader::print_counters(outputStream *st) {\n+  assert(ProfileClassLinkage, \"already checked by the caller\");\n+  assert(log_is_enabled(Info, init), \"already checked by the caller\");\n+  st->print_cr(\"ClassLoader:\");\n+  st->print_cr(\"  clinit:               \" JLONG_FORMAT \"ms \/ \" JLONG_FORMAT \" events\", ClassLoader::class_init_time_ms(), ClassLoader::class_init_count());\n+  st->print_cr(\"  link methods:         \" JLONG_FORMAT \"ms \/ \" JLONG_FORMAT \" events\", Management::ticks_to_ms(_perf_ik_link_methods_time->get_value())   , _perf_ik_link_methods_count->get_value());\n+  st->print_cr(\"  method adapters:      \" JLONG_FORMAT \"ms \/ \" JLONG_FORMAT \" events\", Management::ticks_to_ms(_perf_method_adapters_time->get_value())   , _perf_method_adapters_count->get_value());\n+  st->print_cr(\"  resolve...\");\n+  st->print_cr(\"    invokedynamic:   \" JLONG_FORMAT \"ms \/ \" JLONG_FORMAT \" events\", Management::ticks_to_ms(_perf_resolve_indy_time->get_value())         , _perf_resolve_indy_count->get_value());\n+  st->print_cr(\"    invokehandle:    \" JLONG_FORMAT \"ms \/ \" JLONG_FORMAT \" events\", Management::ticks_to_ms(_perf_resolve_invokehandle_time->get_value()) , _perf_resolve_invokehandle_count->get_value());\n+  st->print_cr(\"    CP_MethodHandle: \" JLONG_FORMAT \"ms \/ \" JLONG_FORMAT \" events\", Management::ticks_to_ms(_perf_resolve_mh_time->get_value())           , _perf_resolve_mh_count->get_value());\n+  st->print_cr(\"    CP_MethodType:   \" JLONG_FORMAT \"ms \/ \" JLONG_FORMAT \" events\", Management::ticks_to_ms(_perf_resolve_mt_time->get_value())           , _perf_resolve_mt_count->get_value());\n+  st->cr();\n","filename":"src\/hotspot\/share\/classfile\/classLoader.cpp","additions":14,"deletions":16,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+#include \"utilities\/ostream.hpp\"\n@@ -317,1 +318,1 @@\n-  static void print_counters();\n+  static void print_counters(outputStream *st);\n","filename":"src\/hotspot\/share\/classfile\/classLoader.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -3757,5 +3757,1 @@\n-  if (log_is_enabled(Info, init)) {\n-     FLAG_SET_ERGO_IF_DEFAULT(ProfileClassLinkage, true);\n-  }\n-\n-  if (ProfileClassLinkage && !UsePerfData) {\n+  if (FLAG_IS_CMDLINE(ProfileClassLinkage) && !UsePerfData) {\n@@ -3765,1 +3761,1 @@\n-     }\n+    }\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -160,1 +160,1 @@\n-void log_vm_init_stats() {\n+void log_vm_stats(outputStream *st) {\n@@ -163,1 +163,3 @@\n-    ClassLoader::print_counters();\n+    if (ProfileClassLinkage) {\n+      ClassLoader::print_counters(st);\n+    }\n@@ -367,1 +369,1 @@\n-  log_vm_init_stats();\n+  log_vm_stats(tty);\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-extern void log_vm_init_stats();\n+extern void log_vm_stats(outputStream *st);\n","filename":"src\/hotspot\/share\/runtime\/java.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -838,1 +838,4 @@\n-    const char* name() const { return (_timerp != nullptr) ? _timerp->name() : nullptr; }\n+    const char* name() const {\n+      assert(_timerp != nullptr, \"sanity\");\n+      return _timerp->name();\n+    }\n","filename":"src\/hotspot\/share\/runtime\/perfData.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -832,2 +832,3 @@\n-    log_info(init)(\"Before main:\");\n-    log_vm_init_stats();\n+    LogStreamHandle(Info, init) log;\n+    log.print_cr(\"At VM initialization completion:\");\n+    log_vm_stats(&log);\n","filename":"src\/hotspot\/share\/runtime\/threads.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}