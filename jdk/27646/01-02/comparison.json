{"files":[{"patch":"@@ -261,1 +261,1 @@\n-bool os::machine_free_memory(physical_memory_size_type& value) {\n+bool os::Machine::free_memory(physical_memory_size_type& value) {\n@@ -269,1 +269,1 @@\n-bool os::machine_available_memory(physical_memory_size_type& value) {\n+bool os::Machine::available_memory(physical_memory_size_type& value) {\n@@ -284,1 +284,1 @@\n-  return machine_total_swap_space(value);\n+  return Machine::total_swap_space(value);\n@@ -287,1 +287,1 @@\n-bool os::machine_total_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::total_swap_space(physical_memory_size_type& value) {\n@@ -297,1 +297,1 @@\n-  return machine_free_swap_space(value);\n+  return Machine::free_swap_space(value);\n@@ -300,1 +300,1 @@\n-bool os::machine_free_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::free_swap_space(physical_memory_size_type& value) {\n@@ -313,1 +313,1 @@\n-physical_memory_size_type os::machine_physical_memory() {\n+physical_memory_size_type os::Machine::physical_memory() {\n@@ -2282,1 +2282,1 @@\n-  return machine_active_processor_count();\n+  return Machine::active_processor_count();\n@@ -2285,1 +2285,1 @@\n-int os::machine_active_processor_count() {\n+int os::Machine::active_processor_count() {\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -140,1 +140,1 @@\n-bool os::machine_available_memory(physical_memory_size_type& value) {\n+bool os::Machine::available_memory(physical_memory_size_type& value) {\n@@ -148,1 +148,1 @@\n-bool os::machine_free_memory(physical_memory_size_type& value) {\n+bool os::Machine::free_memory(physical_memory_size_type& value) {\n@@ -192,1 +192,1 @@\n-  return machine_total_swap_space(value);\n+  return Machine::total_swap_space(value);\n@@ -195,1 +195,1 @@\n-bool os::machine_total_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::total_swap_space(physical_memory_size_type& value) {\n@@ -210,1 +210,1 @@\n-  return machine_free_swap_space(value);\n+  return Machine::free_swap_space(value);\n@@ -213,1 +213,1 @@\n-bool os::machine_free_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::free_swap_space(physical_memory_size_type& value) {\n@@ -231,1 +231,1 @@\n-physical_memory_size_type os::machine_physical_memory() {\n+physical_memory_size_type os::Machine::physical_memory() {\n@@ -2123,1 +2123,1 @@\n-  return machine_active_processor_count();\n+  return Machine::active_processor_count();\n@@ -2126,1 +2126,1 @@\n-int os::machine_active_processor_count() {\n+int os::Machine::active_processor_count() {\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -125,1 +125,1 @@\n-  julong phys_mem = static_cast<julong>(os::machine_physical_memory());\n+  julong phys_mem = static_cast<julong>(os::Machine::physical_memory());\n","filename":"src\/hotspot\/os\/linux\/osContainer_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -220,1 +220,1 @@\n-bool os::container_memory_limit(physical_memory_size_type& value) {\n+bool os::Container::memory_limit(physical_memory_size_type& value) {\n@@ -230,1 +230,1 @@\n-bool os::container_memory_soft_limit(physical_memory_size_type& value) {\n+bool os::Container::memory_soft_limit(physical_memory_size_type& value) {\n@@ -241,1 +241,1 @@\n-bool os::container_memory_throttle_limit(physical_memory_size_type& value) {\n+bool os::Container::memory_throttle_limit(physical_memory_size_type& value) {\n@@ -252,1 +252,1 @@\n-bool os::container_used_memory(physical_memory_size_type& value) {\n+bool os::Container::used_memory(physical_memory_size_type& value) {\n@@ -264,1 +264,1 @@\n-  if (is_containerized() && container_available_memory(value)) {\n+  if (is_containerized() && Container::available_memory(value)) {\n@@ -269,1 +269,1 @@\n-  return machine_available_memory(value);\n+  return Machine::available_memory(value);\n@@ -272,1 +272,1 @@\n-bool os::machine_available_memory(physical_memory_size_type& value) {\n+bool os::Machine::available_memory(physical_memory_size_type& value) {\n@@ -276,1 +276,1 @@\n-bool os::container_available_memory(physical_memory_size_type& value) {\n+bool os::Container::available_memory(physical_memory_size_type& value) {\n@@ -313,1 +313,1 @@\n-  if (is_containerized() && container_available_memory(value)) {\n+  if (is_containerized() && Container::available_memory(value)) {\n@@ -318,1 +318,1 @@\n-  return machine_free_memory(value);\n+  return Machine::free_memory(value);\n@@ -321,1 +321,1 @@\n-bool os::machine_free_memory(physical_memory_size_type& value) {\n+bool os::Machine::free_memory(physical_memory_size_type& value) {\n@@ -340,1 +340,1 @@\n-  if (is_containerized() && container_total_swap_space(value)) {\n+  if (is_containerized() && Container::total_swap_space(value)) {\n@@ -343,1 +343,1 @@\n-  return machine_total_swap_space(value);\n+  return Machine::total_swap_space(value);\n@@ -346,1 +346,1 @@\n-bool os::machine_total_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::total_swap_space(physical_memory_size_type& value) {\n@@ -357,1 +357,1 @@\n-bool os::container_total_swap_space(physical_memory_size_type& value) {\n+bool os::Container::total_swap_space(physical_memory_size_type& value) {\n@@ -389,1 +389,1 @@\n-    if (container_free_swap_space(value)) {\n+    if (Container::free_swap_space(value)) {\n@@ -404,1 +404,1 @@\n-bool os::machine_free_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::free_swap_space(physical_memory_size_type& value) {\n@@ -408,1 +408,1 @@\n-bool os::container_free_swap_space(physical_memory_size_type& value) {\n+bool os::Container::free_swap_space(physical_memory_size_type& value) {\n@@ -435,1 +435,1 @@\n-    if (container_memory_limit(mem_limit)) {\n+    if (Container::memory_limit(mem_limit)) {\n@@ -441,1 +441,1 @@\n-  physical_memory_size_type phys_mem = machine_physical_memory();\n+  physical_memory_size_type phys_mem = Machine::physical_memory();\n@@ -446,1 +446,1 @@\n-physical_memory_size_type os::machine_physical_memory() {\n+physical_memory_size_type os::Machine::physical_memory() {\n@@ -4754,1 +4754,1 @@\n-    double cpu_quota = container_processor_count();\n+    double cpu_quota = Container::processor_count();\n@@ -4756,1 +4756,1 @@\n-    assert(active_cpus <= machine_active_processor_count(), \"must be\");\n+    assert(active_cpus <= Machine::active_processor_count(), \"must be\");\n@@ -4762,1 +4762,1 @@\n-  return machine_active_processor_count();\n+  return Machine::active_processor_count();\n@@ -4765,1 +4765,1 @@\n-int os::machine_active_processor_count() {\n+int os::Machine::active_processor_count() {\n@@ -4769,1 +4769,1 @@\n-double os::container_processor_count() {\n+double os::Container::processor_count() {\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":26,"deletions":26,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -841,1 +841,1 @@\n-bool os::machine_available_memory(physical_memory_size_type& value) {\n+bool os::Machine::available_memory(physical_memory_size_type& value) {\n@@ -849,1 +849,1 @@\n-bool os::machine_free_memory(physical_memory_size_type& value) {\n+bool os::Machine::free_memory(physical_memory_size_type& value) {\n@@ -869,1 +869,1 @@\n-  return machine_total_swap_space(value);\n+  return Machine::total_swap_space(value);\n@@ -872,1 +872,1 @@\n-bool os::machine_total_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::total_swap_space(physical_memory_size_type& value) {\n@@ -886,1 +886,1 @@\n-  return machine_free_swap_space(value);\n+  return Machine::free_swap_space(value);\n@@ -889,1 +889,1 @@\n-bool os::machine_free_swap_space(physical_memory_size_type& value) {\n+bool os::Machine::free_swap_space(physical_memory_size_type& value) {\n@@ -906,1 +906,1 @@\n-physical_memory_size_type os::machine_physical_memory() {\n+physical_memory_size_type os::Machine::physical_memory() {\n@@ -933,1 +933,1 @@\n-  return machine_active_processor_count();\n+  return Machine::active_processor_count();\n@@ -936,1 +936,1 @@\n-int os::machine_active_processor_count() {\n+int os::Machine::active_processor_count() {\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -404,1 +404,1 @@\n-  return static_cast<jlong>(os::machine_physical_memory());\n+  return static_cast<jlong>(os::Machine::physical_memory());\n@@ -410,1 +410,1 @@\n-  (void)os::machine_total_swap_space(total_swap_space);\n+  (void)os::Machine::total_swap_space(total_swap_space);\n","filename":"src\/hotspot\/share\/jfr\/jni\/jfrJniMethod.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2577,1 +2577,1 @@\n-  return static_cast<jlong>(os::machine_physical_memory());\n+  return static_cast<jlong>(os::Machine::physical_memory());\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2205,1 +2205,1 @@\n-    return container_used_memory(value);\n+    return Container::used_memory(value);\n@@ -2208,1 +2208,1 @@\n-  return machine_used_memory(value);\n+  return Machine::used_memory(value);\n@@ -2211,1 +2211,1 @@\n-bool os::machine_used_memory(physical_memory_size_type& value) {\n+bool os::Machine::used_memory(physical_memory_size_type& value) {\n@@ -2225,2 +2225,2 @@\n-double os::container_processor_count() {\n-  assert(is_containerized(), \"must be running containerized\");\n+double os::Container::processor_count() {\n+  ShouldNotReachHere();\n@@ -2230,2 +2230,2 @@\n-bool os::container_available_memory(physical_memory_size_type& value) {\n-  assert(is_containerized(), \"must be running containerized\");\n+bool os::Container::available_memory(physical_memory_size_type& value) {\n+  ShouldNotReachHere();\n@@ -2235,2 +2235,2 @@\n-bool os::container_used_memory(physical_memory_size_type& value) {\n-  assert(is_containerized(), \"must be running containerized\");\n+bool os::Container::used_memory(physical_memory_size_type& value) {\n+  ShouldNotReachHere();\n@@ -2240,2 +2240,2 @@\n-bool os::container_total_swap_space(physical_memory_size_type& value) {\n-  assert(is_containerized(), \"must be running containerized\");\n+bool os::Container::total_swap_space(physical_memory_size_type& value) {\n+  ShouldNotReachHere();\n@@ -2245,2 +2245,2 @@\n-bool os::container_free_swap_space(physical_memory_size_type& value) {\n-  assert(is_containerized(), \"must be running containerized\");\n+bool os::Container::free_swap_space(physical_memory_size_type& value) {\n+  ShouldNotReachHere();\n@@ -2250,2 +2250,2 @@\n-bool os::container_memory_limit(physical_memory_size_type& value) {\n-  assert(is_containerized(), \"must be running containerized\");\n+bool os::Container::memory_limit(physical_memory_size_type& value) {\n+  ShouldNotReachHere();\n@@ -2255,2 +2255,2 @@\n-bool os::container_memory_soft_limit(physical_memory_size_type& value) {\n-  assert(is_containerized(), \"must be running containerized\");\n+bool os::Container::memory_soft_limit(physical_memory_size_type& value) {\n+  ShouldNotReachHere();\n@@ -2260,2 +2260,2 @@\n-bool os::container_memory_throttle_limit(physical_memory_size_type& value) {\n-  assert(is_containerized(), \"must be running containerized\");\n+bool os::Container::memory_throttle_limit(physical_memory_size_type& value) {\n+  ShouldNotReachHere();\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":19,"deletions":19,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"memory\/allStatic.hpp\"\n@@ -345,4 +346,4 @@\n-  \/\/ On platforms with container support (currently only Linux)\n-  \/\/ we combine machine values with potential container values, abstracting\n-  \/\/ which value is actually used. These functions are used to get machine\n-  \/\/ values and container values (when available) separately.\n+  \/\/ On platforms with container support (currently only Linux) we combine machine values with\n+  \/\/ potential container values in os:: methods, abstracting which value is actually used.\n+  \/\/ The os::Machine and os::Container classes and containing methods are used to get machine\n+  \/\/ and container values (when available) separately.\n@@ -351,1 +352,8 @@\n-  static int machine_active_processor_count();\n+  \/\/ The os::Machine class reports system resource metrics from the perspective of the operating\n+  \/\/ system, without considering container-imposed limits. The values returned by these methods\n+  \/\/ reflect the resources visible to the process as reported by the OS, and may already be\n+  \/\/ affected by mechanisms such as virtualization, hypervisor limits, or process affinity,\n+  \/\/ but do NOT consider further restrictions imposed by container runtimes (e.g., cgroups)\n+  class Machine : AllStatic {\n+  public:\n+    static int active_processor_count();\n@@ -353,3 +361,3 @@\n-  [[nodiscard]] static bool machine_available_memory(physical_memory_size_type& value);\n-  [[nodiscard]] static bool machine_used_memory(physical_memory_size_type& value);\n-  [[nodiscard]] static bool machine_free_memory(physical_memory_size_type& value);\n+    [[nodiscard]] static bool available_memory(physical_memory_size_type& value);\n+    [[nodiscard]] static bool used_memory(physical_memory_size_type& value);\n+    [[nodiscard]] static bool free_memory(physical_memory_size_type& value);\n@@ -357,2 +365,2 @@\n-  [[nodiscard]] static bool machine_total_swap_space(physical_memory_size_type& value);\n-  [[nodiscard]] static bool machine_free_swap_space(physical_memory_size_type& value);\n+    [[nodiscard]] static bool total_swap_space(physical_memory_size_type& value);\n+    [[nodiscard]] static bool free_swap_space(physical_memory_size_type& value);\n@@ -360,1 +368,2 @@\n-  static physical_memory_size_type machine_physical_memory();\n+    static physical_memory_size_type physical_memory();\n+  };\n@@ -362,2 +371,8 @@\n-  \/\/ Container values, not safe to use unless `is_containerized()` is true.\n-  static double container_processor_count();\n+  \/\/ The os::Container class reports resource limits as imposed by a supported container runtime\n+  \/\/ (currently only cgroup-based Linux runtimes). If the process is running inside a\n+  \/\/ containerized environment, methods from this class report the effective limits imposed\n+  \/\/ by the container, which may be more restrictive than what os::Machine reports.\n+  \/\/ These methods are not safe to use unless `os::is_containerized()` is true.\n+  class Container : AllStatic {\n+  public:\n+    static double processor_count(); \/\/ Returns the core-equivalent CPU quota\n@@ -365,2 +380,2 @@\n-  [[nodiscard]] static bool container_available_memory(physical_memory_size_type& value);\n-  [[nodiscard]] static bool container_used_memory(physical_memory_size_type& value);\n+    [[nodiscard]] static bool available_memory(physical_memory_size_type& value);\n+    [[nodiscard]] static bool used_memory(physical_memory_size_type& value);\n@@ -368,2 +383,2 @@\n-  [[nodiscard]] static bool container_total_swap_space(physical_memory_size_type& value);\n-  [[nodiscard]] static bool container_free_swap_space(physical_memory_size_type& value);\n+    [[nodiscard]] static bool total_swap_space(physical_memory_size_type& value);\n+    [[nodiscard]] static bool free_swap_space(physical_memory_size_type& value);\n@@ -371,3 +386,4 @@\n-  [[nodiscard]] static bool container_memory_limit(physical_memory_size_type& value);\n-  [[nodiscard]] static bool container_memory_soft_limit(physical_memory_size_type& value);\n-  [[nodiscard]] static bool container_memory_throttle_limit(physical_memory_size_type& value);\n+    [[nodiscard]] static bool memory_limit(physical_memory_size_type& value);\n+    [[nodiscard]] static bool memory_soft_limit(physical_memory_size_type& value);\n+    [[nodiscard]] static bool memory_throttle_limit(physical_memory_size_type& value);\n+  };\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":36,"deletions":20,"binary":false,"changes":56,"status":"modified"}]}