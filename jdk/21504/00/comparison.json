{"files":[{"patch":"@@ -40,27 +40,0 @@\n-template<ShenandoahGenerationType GENERATION>\n-class ShenandoahInitMarkRootsClosure : public OopClosure {\n-private:\n-  ShenandoahObjToScanQueue* const _queue;\n-  ShenandoahMarkingContext* const _mark_context;\n-\n-  template <class T>\n-  inline void do_oop_work(T* p);\n-public:\n-  ShenandoahInitMarkRootsClosure(ShenandoahObjToScanQueue* q);\n-\n-  void do_oop(narrowOop* p) { do_oop_work(p); }\n-  void do_oop(oop* p)       { do_oop_work(p); }\n-};\n-\n-template <ShenandoahGenerationType GENERATION>\n-ShenandoahInitMarkRootsClosure<GENERATION>::ShenandoahInitMarkRootsClosure(ShenandoahObjToScanQueue* q) :\n-  _queue(q),\n-  _mark_context(ShenandoahHeap::heap()->marking_context()) {\n-}\n-\n-template <ShenandoahGenerationType GENERATION>\n-template <class T>\n-void ShenandoahInitMarkRootsClosure<GENERATION>::do_oop_work(T* p) {\n-  ShenandoahMark::mark_through_ref<T, GENERATION>(p, _queue, _mark_context, false);\n-}\n-\n@@ -140,2 +113,3 @@\n-  ShenandoahInitMarkRootsClosure<NON_GEN>  init_mark(task_queues()->queue(worker_id));\n-  _root_scanner.roots_do(&init_mark, worker_id);\n+  ShenandoahReferenceProcessor* rp = ShenandoahHeap::heap()->ref_processor();\n+  ShenandoahMarkRefsClosure<NON_GEN> cl(task_queues()->queue(worker_id), rp);\n+  _root_scanner.roots_do(&cl, worker_id);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahSTWMark.cpp","additions":3,"deletions":29,"binary":false,"changes":32,"status":"modified"}]}