{"files":[{"patch":"@@ -29,0 +29,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -74,3 +75,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"Could not commit PerfData memory\\n\");\n-    }\n+    log_debug(perf)(\"Could not commit PerfData memory\");\n@@ -300,1 +299,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n+    if (log_is_enabled(Debug, perf)) {\n+      LogStreamHandle(Debug, perf) log;\n@@ -302,1 +302,1 @@\n-        warning(\"directory %s is a symlink and is not secure\\n\", dirname);\n+        log.print_cr(\"directory %s is a symlink and is not secure\", dirname);\n@@ -304,1 +304,1 @@\n-        warning(\"could not open directory %s: %s\\n\", dirname, os::strerror(errno));\n+        log.print_cr(\"could not open directory %s: %s\", dirname, os::strerror(errno));\n@@ -374,3 +374,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"could not change to directory %s\", dirname);\n-    }\n+    log_debug(perf)(\"could not change to directory %s\", dirname);\n@@ -414,3 +412,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"fstat failed on %s: %s\\n\", filename, os::strerror(errno));\n-    }\n+    log_debug(perf)(\"fstat failed on %s: %s\", filename, os::strerror(errno));\n@@ -421,3 +417,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"file %s has multiple links\\n\", filename);\n-    }\n+    log_debug(perf)(\"file %s has multiple links\", filename);\n@@ -450,1 +444,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n+    if (log_is_enabled(Debug, perf)) {\n+      LogStreamHandle(Debug, perf) log;\n@@ -452,2 +447,1 @@\n-        warning(\"Could not retrieve passwd entry: %s\\n\",\n-                os::strerror(result));\n+        log.print_cr(\"Could not retrieve passwd entry: %s\", os::strerror(result));\n@@ -466,2 +460,1 @@\n-        warning(\"Could not retrieve passwd entry: %s\\n\",\n-                os::strerror(errno));\n+        log.print_cr(\"Could not retrieve passwd entry: %s\", os::strerror(errno));\n@@ -470,3 +463,2 @@\n-        warning(\"Could not determine user name: %s\\n\",\n-                p->pw_name == nullptr ? \"pw_name = null\" :\n-                                     \"pw_name zero length\");\n+        log.print_cr(\"Could not determine user name: %s\",\n+                     p->pw_name == nullptr ? \"pw_name = null\" : \"pw_name zero length\");\n@@ -683,1 +675,1 @@\n-  if (PrintMiscellaneous && Verbose && result == OS_ERR) {\n+  if (log_is_enabled(Debug, perf) && result == OS_ERR) {\n@@ -685,2 +677,2 @@\n-      warning(\"Could not unlink shared memory backing\"\n-              \" store file %s : %s\\n\", path, os::strerror(errno));\n+      log_debug(perf)(\"Could not unlink shared memory backing store file %s : %s\",\n+                      path, os::strerror(errno));\n@@ -822,1 +814,0 @@\n-      \/\/\n@@ -825,3 +816,1 @@\n-        if (PrintMiscellaneous && Verbose) {\n-          warning(\"%s directory is insecure\\n\", dirname);\n-        }\n+        log_debug(perf)(\"%s directory is insecure\", dirname);\n@@ -834,5 +823,1 @@\n-      \/\/\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"could not create directory %s: %s\\n\",\n-                dirname, os::strerror(errno));\n-      }\n+      log_debug(perf)(\"could not create directory %s: %s\", dirname, os::strerror(errno));\n@@ -875,1 +860,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n+    if (log_is_enabled(Debug, perf)) {\n+      LogStreamHandle(Debug, perf) log;\n@@ -877,1 +863,1 @@\n-        warning(\"file %s is a symlink and is not secure\\n\", filename);\n+        log.print_cr(\"file %s is a symlink and is not secure\", filename);\n@@ -879,1 +865,1 @@\n-        warning(\"could not create file %s: %s\\n\", filename, os::strerror(errno));\n+        log.print_cr(\"could not create file %s: %s\", filename, os::strerror(errno));\n@@ -927,3 +913,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"could not truncate shared memory file: %s\\n\", os::strerror(errno));\n-    }\n+    log_debug(perf)(\"could not truncate shared memory file: %s\", os::strerror(errno));\n@@ -936,3 +920,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"could not set shared memory file size: %s\\n\", os::strerror(errno));\n-    }\n+    log_debug(perf)(\"could not set shared memory file size: %s\", os::strerror(errno));\n@@ -1060,3 +1042,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"mmap failed -  %s\\n\", os::strerror(errno));\n-    }\n+    log_debug(perf)(\"mmap failed -  %s\", os::strerror(errno));\n@@ -1138,3 +1118,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"fstat failed: %s\\n\", os::strerror(errno));\n-    }\n+    log_debug(perf)(\"fstat failed: %s\", os::strerror(errno));\n@@ -1215,3 +1193,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"mmap failed: %s\\n\", os::strerror(errno));\n-    }\n+    log_debug(perf)(\"mmap failed: %s\", os::strerror(errno));\n@@ -1247,1 +1223,0 @@\n-\n@@ -1250,4 +1225,1 @@\n-      \/\/\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"Reverting to non-shared PerfMemory region.\\n\");\n-      }\n+      log_debug(perf)(\"Reverting to non-shared PerfMemory region.\");\n","filename":"src\/hotspot\/os\/posix\/perfMemory_posix.cpp","additions":30,"deletions":58,"binary":false,"changes":88,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -65,3 +66,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"Could not commit PerfData memory\\n\");\n-    }\n+    log_debug(perf)(\"Could not commit PerfData memory\");\n@@ -99,4 +98,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"Could not create Perfdata save file: %s: %s\\n\",\n-              destfile, os::strerror(errno));\n-    }\n+    log_debug(perf)(\"Could not create Perfdata save file: %s: %s\",\n+                    destfile, os::strerror(errno));\n@@ -108,4 +105,2 @@\n-        if (PrintMiscellaneous && Verbose) {\n-          warning(\"Could not write Perfdata save file: %s: %s\\n\",\n-                  destfile, os::strerror(errno));\n-        }\n+        log_debug(perf)(\"Could not write Perfdata save file: %s: %s\",\n+                        destfile, os::strerror(errno));\n@@ -120,4 +115,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      if (result == OS_ERR) {\n-        warning(\"Could not close %s: %s\\n\", destfile, os::strerror(errno));\n-      }\n+    if (result == OS_ERR) {\n+      log_debug(perf)(\"Could not close %s: %s\", destfile, os::strerror(errno));\n@@ -223,4 +216,2 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"could not get attributes for file %s: \"\n-                \" lasterror = %d\\n\", path, lasterror);\n-      }\n+      log_debug(perf)(\"could not get attributes for file %s: lasterror = %d\",\n+                      path, lasterror);\n@@ -237,3 +228,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"%s is a reparse point\\n\", path);\n-    }\n+    log_debug(perf)(\"%s is a reparse point\", path);\n@@ -256,4 +245,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"%s is not a directory, file attributes = \"\n-              INTPTR_FORMAT \"\\n\", path, fa);\n-    }\n+    log_debug(perf)(\"%s is not a directory, file attributes = \"\n+                    INTPTR_FORMAT, path, fa);\n@@ -495,5 +482,3 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      if (errno != ENOENT) {\n-        warning(\"Could not unlink shared memory backing\"\n-                \" store file %s : %s\\n\", path, os::strerror(errno));\n-      }\n+    if (errno != ENOENT) {\n+      log_debug(perf)(\"Could not unlink shared memory backing store file %s : %s\",\n+                      path, os::strerror(errno));\n@@ -518,5 +503,3 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      DWORD lastError = GetLastError();\n-      if (lastError != ERROR_INVALID_PARAMETER) {\n-        warning(\"OpenProcess failed: %d\\n\", GetLastError());\n-      }\n+    DWORD lastError = GetLastError();\n+    if (lastError != ERROR_INVALID_PARAMETER) {\n+      log_debug(perf)(\"OpenProcess failed: %d\", lastError);\n@@ -529,3 +512,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"GetExitCodeProcess failed: %d\\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"GetExitCodeProcess failed: %d\", GetLastError());\n@@ -548,3 +529,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"bypassing file system criteria checks for %s\\n\", path);\n-    }\n+    log_debug(perf)(\"bypassing file system criteria checks for %s\", path);\n@@ -556,3 +535,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"expected device specifier in path: %s\\n\", path);\n-    }\n+    log_debug(perf)(\"expected device specifier in path: %s\", path);\n@@ -579,5 +556,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"could not get device information for %s: \"\n-              \" path = %s: lasterror = %d\\n\",\n-              root_path, path, GetLastError());\n-    }\n+    log_debug(perf)(\"could not get device information for %s: path = %s: lasterror = %d\",\n+                    root_path, path, GetLastError());\n@@ -589,4 +563,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"file system type %s on device %s does not support\"\n-              \" ACLs\\n\", fs_type, root_path);\n-    }\n+    log_debug(perf)(\"file system type %s on device %s does not support ACLs\",\n+                    fs_type, root_path);\n@@ -598,4 +570,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"file system type %s on device %s is compressed\\n\",\n-              fs_type, root_path);\n-    }\n+    log_debug(perf)(\"file system type %s on device %s is compressed\",\n+                    fs_type, root_path);\n@@ -707,3 +677,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"CreateFileMapping failed, lasterror = %d\\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"CreateFileMapping failed, lasterror = %d\", GetLastError());\n@@ -720,3 +688,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"file mapping already exists, lasterror = %d\\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"file mapping already exists, lasterror = %d\", GetLastError());\n@@ -786,3 +752,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"OpenProcessToken failure: lasterror = %d \\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"OpenProcessToken failure: lasterror = %d\", GetLastError());\n@@ -798,4 +762,2 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"GetTokenInformation failure: lasterror = %d,\"\n-                \" rsize = %d\\n\", lasterror, rsize);\n-      }\n+      log_debug(perf)(\"GetTokenInformation failure: lasterror = %d, rsize = %d\",\n+                      lasterror, rsize);\n@@ -811,4 +773,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"GetTokenInformation failure: lasterror = %d,\"\n-              \" rsize = %d\\n\", GetLastError(), rsize);\n-    }\n+    log_debug(perf)(\"GetTokenInformation failure: lasterror = %d, rsize = %d\",\n+                    GetLastError(), rsize);\n@@ -824,4 +784,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"GetTokenInformation failure: lasterror = %d,\"\n-              \" rsize = %d\\n\", GetLastError(), rsize);\n-    }\n+    log_debug(perf)(\"GetTokenInformation failure: lasterror = %d, rsize = %d\",\n+                    GetLastError(), rsize);\n@@ -869,4 +827,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"GetSecurityDescriptor failure: lasterror = %d \\n\",\n-              GetLastError());\n-    }\n+    log_debug(perf)(\"GetSecurityDescriptor failure: lasterror = %d\",\n+                    GetLastError());\n@@ -889,4 +845,2 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"GetAclInformation failure: lasterror = %d \\n\", GetLastError());\n-        return false;\n-      }\n+      log_debug(perf)(\"GetAclInformation failure: lasterror = %d\", GetLastError());\n+      return false;\n@@ -917,3 +871,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"InitializeAcl failure: lasterror = %d \\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"InitializeAcl failure: lasterror = %d\", GetLastError());\n@@ -930,3 +882,1 @@\n-        if (PrintMiscellaneous && Verbose) {\n-          warning(\"InitializeAcl failure: lasterror = %d \\n\", GetLastError());\n-        }\n+        log_debug(perf)(\"InitializeAcl failure: lasterror = %d\", GetLastError());\n@@ -957,3 +907,1 @@\n-          if (PrintMiscellaneous && Verbose) {\n-            warning(\"AddAce failure: lasterror = %d \\n\", GetLastError());\n-          }\n+          log_debug(perf)(\"AddAce failure: lasterror = %d\", GetLastError());\n@@ -972,4 +920,2 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"AddAccessAllowedAce failure: lasterror = %d \\n\",\n-                GetLastError());\n-      }\n+      log_debug(perf)(\"AddAccessAllowedAce failure: lasterror = %d\",\n+                      GetLastError());\n@@ -988,3 +934,1 @@\n-        if (PrintMiscellaneous && Verbose) {\n-          warning(\"InitializeAcl failure: lasterror = %d \\n\", GetLastError());\n-        }\n+        log_debug(perf)(\"InitializeAcl failure: lasterror = %d\", GetLastError());\n@@ -996,3 +940,1 @@\n-        if (PrintMiscellaneous && Verbose) {\n-          warning(\"AddAce failure: lasterror = %d \\n\", GetLastError());\n-        }\n+        log_debug(perf)(\"AddAce failure: lasterror = %d\", GetLastError());\n@@ -1008,4 +950,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"SetSecurityDescriptorDacl failure:\"\n-              \" lasterror = %d \\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"SetSecurityDescriptorDacl failure: lasterror = %d\", GetLastError());\n@@ -1028,4 +967,1 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"SetSecurityDescriptorControl failure:\"\n-                \" lasterror = %d \\n\", GetLastError());\n-      }\n+      log_debug(perf)(\"SetSecurityDescriptorControl failure: lasterror = %d\", GetLastError());\n@@ -1060,4 +996,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"InitializeSecurityDescriptor failure: \"\n-              \"lasterror = %d \\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"InitializeSecurityDescriptor failure: lasterror = %d\", GetLastError());\n@@ -1116,5 +1049,1 @@\n-\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"AllocateAndInitializeSid failure: \"\n-              \"lasterror = %d \\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"AllocateAndInitializeSid failure: lasterror = %d\", GetLastError());\n@@ -1134,5 +1063,1 @@\n-\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"AllocateAndInitializeSid failure: \"\n-              \"lasterror = %d \\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"AllocateAndInitializeSid failure: lasterror = %d\", GetLastError());\n@@ -1239,3 +1164,1 @@\n-        if (PrintMiscellaneous && Verbose) {\n-          warning(\"%s directory is insecure\\n\", dirname);\n-        }\n+        log_debug(perf)(\"%s directory is insecure\", dirname);\n@@ -1252,5 +1175,2 @@\n-        if (PrintMiscellaneous && Verbose) {\n-          lasterror = GetLastError();\n-          warning(\"SetFileSecurity failed for %s directory.  lasterror %d \\n\",\n-                                                        dirname, lasterror);\n-        }\n+        lasterror = GetLastError();\n+        log_debug(perf)(\"SetFileSecurity failed for %s directory. lasterror %d\", dirname, lasterror);\n@@ -1259,3 +1179,1 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"CreateDirectory failed: %d\\n\", GetLastError());\n-      }\n+      log_debug(perf)(\"CreateDirectory failed: %d\", GetLastError());\n@@ -1328,3 +1246,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"could not create file %s: %d\\n\", filename, lasterror);\n-    }\n+    log_debug(perf)(\"could not create file %s: %d\", filename, lasterror);\n@@ -1356,4 +1272,2 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"Could not get status information from file %s: %s\\n\",\n-            filename, os::strerror(errno));\n-      }\n+      log_debug(perf)(\"Could not get status information from file %s: %s\",\n+                      filename, os::strerror(errno));\n@@ -1372,3 +1286,1 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"could not flush file %s: %d\\n\", filename, lasterror);\n-      }\n+      log_debug(perf)(\"could not flush file %s: %d\", filename, lasterror);\n@@ -1405,4 +1317,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"OpenFileMapping failed for shared memory object %s:\"\n-              \" lasterror = %d\\n\", objectname, lasterror);\n-    }\n+    log_debug(perf)(\"OpenFileMapping failed for shared memory object %s:\"\n+                    \" lasterror = %d\", objectname, lasterror);\n@@ -1488,3 +1398,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"MapViewOfFile failed, lasterror = %d\\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"MapViewOfFile failed, lasterror = %d\", GetLastError());\n@@ -1554,3 +1462,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"stat %s failed: %s\\n\", filename, os::strerror(errno));\n-    }\n+    log_debug(perf)(\"stat %s failed: %s\", filename, os::strerror(errno));\n@@ -1562,6 +1468,2 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"unexpected file size: size = %zu\\n\",\n-              statbuf.st_size);\n-    }\n-    THROW_MSG_0(vmSymbols::java_io_IOException(),\n-                \"Invalid PerfMemory size\");\n+    log_debug(perf)(\"unexpected file size: size = %zu\", statbuf.st_size);\n+    THROW_MSG_0(vmSymbols::java_io_IOException(), \"Invalid PerfMemory size\");\n@@ -1640,3 +1542,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"MapViewOfFile failed, lasterror = %d\\n\", GetLastError());\n-    }\n+    log_debug(perf)(\"MapViewOfFile failed, lasterror = %d\", GetLastError());\n@@ -1711,3 +1611,1 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"Reverting to non-shared PerfMemory region.\\n\");\n-      }\n+      log_debug(perf)(\"Reverting to non-shared PerfMemory region.\");\n","filename":"src\/hotspot\/os\/windows\/perfMemory_windows.cpp","additions":69,"deletions":171,"binary":false,"changes":240,"status":"modified"},{"patch":"@@ -117,3 +117,1 @@\n-    if (PrintMiscellaneous && Verbose) {\n-      warning(\"Could not create PerfData Memory region, reverting to malloc\");\n-    }\n+    log_debug(perf)(\"Could not create PerfData Memory region, reverting to malloc\");\n@@ -253,4 +251,1 @@\n-      if (PrintMiscellaneous && Verbose) {\n-        warning(\"Invalid performance data file path name specified, \"\\\n-                \"fall back to a default name\");\n-      }\n+      log_debug(perf)(\"Invalid performance data file path name specified, fall back to a default name\");\n","filename":"src\/hotspot\/share\/runtime\/perfMemory.cpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"}]}