{"files":[{"patch":"@@ -1702,2 +1702,2 @@\n-  \/\/ If any floating point comparison instruction is used, unordered case never triggers jump\n-  \/\/ For above equal condition, CF=0 is false when at least one input is NaN\n+  \/\/ If any floating point comparison instruction is used, unordered case always triggers jump\n+  \/\/ For below condition, CF=1 is true when at least one input is NaN\n@@ -1705,2 +1705,0 @@\n-  __ setcc(Assembler::above, dst);\n-  __ jcc(Assembler::aboveEqual, done);\n@@ -1708,0 +1706,2 @@\n+  __ jcc(Assembler::below, done);\n+  __ setcc(Assembler::notEqual, dst);\n@@ -5533,1 +5533,1 @@\n-  predicate(!VM_Version::supports_avx10_2());\n+  predicate(!UseAPX || !VM_Version::supports_avx10_2());\n@@ -5542,1 +5542,1 @@\n-  predicate(VM_Version::supports_avx10_2());\n+  predicate(UseAPX && VM_Version::supports_avx10_2());\n@@ -6075,1 +6075,1 @@\n-  predicate(!VM_Version::supports_avx10_2() &&\n+  predicate((!UseAPX || !VM_Version::supports_avx10_2()) &&\n@@ -6098,1 +6098,1 @@\n-  predicate(!VM_Version::supports_avx10_2() &&\n+  predicate((!UseAPX || !VM_Version::supports_avx10_2()) &&\n@@ -6125,1 +6125,1 @@\n-  predicate(VM_Version::supports_avx10_2() &&\n+  predicate((UseAPX && VM_Version::supports_avx10_2()) &&\n@@ -9177,1 +9177,0 @@\n-  predicate(!UseAPX);\n@@ -9186,12 +9185,0 @@\n-instruct cmovI_regUCFE(cmpOpUCFE cop, rFlagsRegUCFE cr, rRegI dst, rRegI src) %{\n-  predicate(UseAPX);\n-  match(Set dst (CMoveI (Binary cop cr) (Binary dst src)));\n-\n-  ins_cost(200);\n-  format %{ \"cmovl$cop $dst, $src\\t# signed, unsigned, int\" %}\n-  ins_encode %{\n-    __ cmovl((Assembler::Condition)($cop$$cmpcode), $dst$$Register, $src$$Register);\n-  %}\n-  ins_pipe(pipe_cmov_reg);\n-%}\n-\n@@ -9199,1 +9186,0 @@\n-  predicate(UseAPX);\n@@ -9211,1 +9197,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n@@ -9227,1 +9213,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n@@ -9283,1 +9269,0 @@\n-  predicate(!UseAPX);\n@@ -9292,12 +9277,0 @@\n-instruct cmovI_memUCFE(cmpOpUCFE cop, rFlagsRegUCFE cr, rRegI dst, memory src) %{\n-  predicate(UseAPX);\n-  match(Set dst (CMoveI (Binary cop cr) (Binary dst (LoadI src))));\n-\n-  ins_cost(250);\n-  format %{ \"cmovl$cop $dst, $src\\t# signed, unsigned, int\" %}\n-  ins_encode %{\n-    __ cmovl((Assembler::Condition)($cop$$cmpcode), $dst$$Register, $src$$Address);\n-  %}\n-  ins_pipe(pipe_cmov_mem);\n-%}\n-\n@@ -9319,1 +9292,0 @@\n-  predicate(UseAPX);\n@@ -9373,1 +9345,0 @@\n-  predicate(!UseAPX);\n@@ -9382,12 +9353,0 @@\n-instruct cmovN_regUCFE(cmpOpUCFE cop, rFlagsRegUCFE cr, rRegN dst, rRegN src) %{\n-  predicate(UseAPX);\n-  match(Set dst (CMoveN (Binary cop cr) (Binary dst src)));\n-\n-  ins_cost(200);\n-  format %{ \"cmovl$cop $dst, $src\\t# signed, unsigned, compressed ptr\" %}\n-  ins_encode %{\n-    __ cmovl((Assembler::Condition)($cop$$cmpcode), $dst$$Register, $src$$Register);\n-  %}\n-  ins_pipe(pipe_cmov_reg);\n-%}\n-\n@@ -9409,1 +9368,0 @@\n-  predicate(UseAPX);\n@@ -9421,1 +9379,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n@@ -9437,1 +9395,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n@@ -9507,1 +9465,0 @@\n-  predicate(!UseAPX);\n@@ -9516,12 +9473,0 @@\n-instruct cmovP_regUCFE(cmpOpUCFE cop, rFlagsRegUCFE cr, rRegP dst, rRegP src) %{\n-  predicate(UseAPX);\n-  match(Set dst (CMoveP (Binary cop cr) (Binary dst src)));\n-\n-  ins_cost(200);\n-  format %{ \"cmovq$cop $dst, $src\\t# signed, unsigned, ptr\" %}\n-  ins_encode %{\n-    __ cmovq((Assembler::Condition)($cop$$cmpcode), $dst$$Register, $src$$Register);\n-  %}\n-  ins_pipe(pipe_cmov_reg);\n-%}\n-\n@@ -9529,1 +9474,0 @@\n-  predicate(UseAPX);\n@@ -9541,1 +9485,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n@@ -9557,1 +9501,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n@@ -9678,1 +9622,1 @@\n-  predicate(!UseAPX && n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_long() == 0);\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_long() == 0);\n@@ -9692,1 +9636,1 @@\n-  predicate(UseAPX && n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_long() == 0);\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_long() == 0);\n@@ -9705,1 +9649,0 @@\n-  predicate(!UseAPX);\n@@ -9714,12 +9657,0 @@\n-instruct cmovL_regUCFE(cmpOpUCFE cop, rFlagsRegUCFE cr, rRegL dst, rRegL src) %{\n-  predicate(UseAPX);\n-  match(Set dst (CMoveL (Binary cop cr) (Binary dst src)));\n-\n-  ins_cost(200);\n-  format %{ \"cmovq$cop $dst, $src\\t# signed, unsigned, long\" %}\n-  ins_encode %{\n-    __ cmovq((Assembler::Condition)($cop$$cmpcode), $dst$$Register, $src$$Register);\n-  %}\n-  ins_pipe(pipe_cmov_reg);\n-%}\n-\n@@ -9728,1 +9659,0 @@\n-  predicate(UseAPX);\n@@ -9740,1 +9670,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::ne);\n@@ -9756,1 +9686,1 @@\n-  predicate(!UseAPX && n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n+  predicate(n->in(1)->in(1)->as_Bool()->_test._test == BoolTest::eq);\n@@ -9783,1 +9713,0 @@\n-  predicate(!UseAPX);\n@@ -9792,12 +9721,0 @@\n-instruct cmovL_memUCFE(cmpOpUCFE cop, rFlagsRegUCFE cr, rRegL dst, memory src) %{\n-  predicate(UseAPX);\n-  match(Set dst (CMoveL (Binary cop cr) (Binary dst (LoadL src))));\n-\n-  ins_cost(200);\n-  format %{ \"cmovq$cop $dst, $src\\t# signed, unsigned, long\" %}\n-  ins_encode %{\n-    __ cmovq((Assembler::Condition)($cop$$cmpcode), $dst$$Register, $src$$Address);\n-  %}\n-  ins_pipe(pipe_cmov_mem);\n-%}\n-\n@@ -9819,1 +9736,0 @@\n-  predicate(UseAPX);\n@@ -14594,20 +14510,0 @@\n-\/\/ Compare into -1,0,1\n-instruct cmpF_regE(rRegI dst, regF src1, regF src2, rFlagsReg cr)\n-%{\n-  match(Set dst (CmpF3 src1 src2));\n-  effect(KILL cr);\n-\n-  ins_cost(250);\n-  format %{ \"ucomxss $src1, $src2\\n\\t\"\n-            \"seta    $dst\\n\\t\"\n-            \"jae,s   done\\n\\t\"\n-            \"movl    $dst, #-1\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\"\n-    \"done:\" %}\n-  ins_encode %{\n-    __ ucomxss($src1$$XMMRegister, $src2$$XMMRegister);\n-    emit_cmpfp3(masm, $dst$$Register);\n-  %}\n-  ins_pipe(pipe_slow);\n-%}\n-\n@@ -14635,20 +14531,0 @@\n-\/\/ Compare into -1,0,1\n-instruct cmpF_memE(rRegI dst, regF src1, memory src2, rFlagsReg cr)\n-%{\n-  match(Set dst (CmpF3 src1 (LoadF src2)));\n-  effect(KILL cr);\n-\n-  ins_cost(250);\n-  format %{ \"ucomxss $src1, $src2\\n\\t\"\n-            \"seta    $dst\\n\\t\"\n-            \"jae,s   done\\n\\t\"\n-            \"movl    $dst, #-1\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\"\n-    \"done:\" %}\n-  ins_encode %{\n-    __ ucomxss($src1$$XMMRegister, $src2$$Address);\n-    emit_cmpfp3(masm, $dst$$Register);\n-  %}\n-  ins_pipe(pipe_slow);\n-%}\n-\n@@ -14675,19 +14551,0 @@\n-\/\/ Compare into -1,0,1\n-instruct cmpF_immE(rRegI dst, regF src, immF con, rFlagsReg cr) %{\n-  match(Set dst (CmpF3 src con));\n-  effect(KILL cr);\n-\n-  ins_cost(250);\n-  format %{ \"ucomxss $src, [$constantaddress]\\t# load from constant table: float=$con\\n\\t\"\n-            \"seta    $dst\\n\\t\"\n-            \"jae,s   done\\n\\t\"\n-            \"movl    $dst, #-1\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\"\n-    \"done:\" %}\n-  ins_encode %{\n-    __ ucomxss($src$$XMMRegister, $constantaddress($con));\n-    emit_cmpfp3(masm, $dst$$Register);\n-  %}\n-  ins_pipe(pipe_slow);\n-%}\n-\n@@ -14715,20 +14572,0 @@\n-\/\/ Compare into -1,0,1\n-instruct cmpD_regE(rRegI dst, regD src1, regD src2, rFlagsReg cr)\n-%{\n-  match(Set dst (CmpD3 src1 src2));\n-  effect(KILL cr);\n-\n-  ins_cost(250);\n-  format %{ \"ucomxsd $src1, $src2\\n\\t\"\n-            \"seta    $dst\\n\\t\"\n-            \"jae,s   done\\n\\t\"\n-            \"movl    $dst, #-1\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\"\n-    \"done:\" %}\n-  ins_encode %{\n-    __ ucomxsd($src1$$XMMRegister, $src2$$XMMRegister);\n-    emit_cmpfp3(masm, $dst$$Register);\n-  %}\n-  ins_pipe(pipe_slow);\n-%}\n-\n@@ -14756,20 +14593,0 @@\n-\/\/ Compare into -1,0,1\n-instruct cmpD_memE(rRegI dst, regD src1, memory src2, rFlagsReg cr)\n-%{\n-  match(Set dst (CmpD3 src1 (LoadD src2)));\n-  effect(KILL cr);\n-\n-  ins_cost(250);\n-  format %{ \"ucomxsd $src1, $src2\\n\\t\"\n-            \"seta    $dst\\n\\t\"\n-            \"jae,s   done\\n\\t\"\n-            \"movl    $dst, #-1\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\"\n-    \"done:\" %}\n-  ins_encode %{\n-    __ ucomxsd($src1$$XMMRegister, $src2$$Address);\n-    emit_cmpfp3(masm, $dst$$Register);\n-  %}\n-  ins_pipe(pipe_slow);\n-%}\n-\n@@ -14796,19 +14613,0 @@\n-\/\/ Compare into -1,0,1\n-instruct cmpD_immE(rRegI dst, regD src, immD con, rFlagsReg cr) %{\n-  match(Set dst (CmpD3 src con));\n-  effect(KILL cr);\n-\n-  ins_cost(250);\n-  format %{ \"ucomxsd $src, [$constantaddress]\\t# load from constant table: float=$con\\n\\t\"\n-            \"seta    $dst\\n\\t\"\n-            \"jae,s   done\\n\\t\"\n-            \"movl    $dst, #-1\\n\\t\"\n-            \"movzbl  $dst, $dst\\n\"\n-    \"done:\" %}\n-  ins_encode %{\n-    __ ucomxsd($src$$XMMRegister, $constantaddress($con));\n-    emit_cmpfp3(masm, $dst$$Register);\n-  %}\n-  ins_pipe(pipe_slow);\n-%}\n-\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":19,"deletions":221,"binary":false,"changes":240,"status":"modified"}]}