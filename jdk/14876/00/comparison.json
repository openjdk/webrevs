{"files":[{"patch":"@@ -49,2 +49,0 @@\n-    private static OutputAnalyzer out;\n-    private static ProcessBuilder pb;\n@@ -61,2 +59,1 @@\n-    static void checkFor(String... outputStrings) throws Exception {\n-        out = new OutputAnalyzer(pb.start());\n+    static void checkFor(OutputAnalyzer output, String... outputStrings) throws Exception {\n@@ -64,1 +61,1 @@\n-            out.shouldContain(s);\n+            output.shouldContain(s);\n@@ -66,1 +63,0 @@\n-        out.shouldHaveExitValue(0);\n@@ -69,2 +65,1 @@\n-    static void checkAbsent(String... outputStrings) throws Exception {\n-        out = new OutputAnalyzer(pb.start());\n+    static void checkAbsent(OutputAnalyzer output, String... outputStrings) throws Exception {\n@@ -72,1 +67,1 @@\n-            out.shouldNotContain(s);\n+            output.shouldNotContain(s);\n@@ -74,1 +69,0 @@\n-        out.shouldHaveExitValue(0);\n@@ -78,1 +72,1 @@\n-    static ProcessBuilder exec(String... args) throws Exception {\n+    static OutputAnalyzer exec(String... args) throws Exception {\n@@ -81,7 +75,6 @@\n-        Collections.addAll(argsList, \"-Xmn8m\");\n-        Collections.addAll(argsList, \"-Xbootclasspath\/a:.\");\n-        Collections.addAll(argsList, \"-XX:+UnlockDiagnosticVMOptions\");\n-        Collections.addAll(argsList, \"-XX:+WhiteBoxAPI\");\n-        Collections.addAll(argsList, \"-XX:+ClassUnloading\");\n-        Collections.addAll(argsList, ClassUnloadTestMain.class.getName());\n-        return ProcessTools.createJavaProcessBuilder(argsList);\n+        Collections.addAll(argsList, \"-Xmn8m\", \"-Xbootclasspath\/a:.\", \"-XX:+UnlockDiagnosticVMOptions\",\n+                           \"-XX:+WhiteBoxAPI\", \"-XX:+ClassUnloading\", ClassUnloadTestMain.class.getName());\n+        ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(argsList);\n+        OutputAnalyzer output = new OutputAnalyzer(pb.start());\n+        output.shouldHaveExitValue(0);\n+        return output;\n@@ -92,0 +85,2 @@\n+        OutputAnalyzer output;\n+\n@@ -93,2 +88,2 @@\n-        pb = exec(\"-Xlog:class+unload=info\");\n-        checkFor(\"[class,unload]\", \"unloading class\");\n+        output = exec(\"-Xlog:class+unload=info\");\n+        checkFor(output, \"[class,unload]\", \"unloading class\");\n@@ -97,2 +92,2 @@\n-        pb = exec(\"-Xlog:class+unload=off\");\n-        checkAbsent(\"[class,unload]\");\n+        output = exec(\"-Xlog:class+unload=off\");\n+        checkAbsent(output,\"[class,unload]\");\n@@ -101,2 +96,2 @@\n-        pb = exec(\"-Xlog:class+load=info\");\n-        checkFor(\"[class,load]\", \"java.lang.Object\", \"source:\");\n+        output = exec(\"-Xlog:class+load=info\");\n+        checkFor(output,\"[class,load]\", \"java.lang.Object\", \"source:\");\n@@ -105,2 +100,2 @@\n-        pb = exec(\"-Xlog:class+load=debug\");\n-        checkFor(\"[class,load]\", \"java.lang.Object\", \"source:\", \"klass:\", \"super:\", \"loader:\", \"bytes:\");\n+        output = exec(\"-Xlog:class+load=debug\");\n+        checkFor(output,\"[class,load]\", \"java.lang.Object\", \"source:\", \"klass:\", \"super:\", \"loader:\", \"bytes:\");\n@@ -109,2 +104,2 @@\n-        pb = exec(\"-Xlog:class+load=off\");\n-        checkAbsent(\"[class,load]\");\n+        output = exec(\"-Xlog:class+load=off\");\n+        checkAbsent(output,\"[class,load]\");\n@@ -113,3 +108,3 @@\n-        pb = exec(\"-verbose:class\");\n-        checkFor(\"[class,load]\", \"java.lang.Object\", \"source:\");\n-        checkFor(\"[class,unload]\", \"unloading class\");\n+        output = exec(\"-verbose:class\");\n+        checkFor(output,\"[class,load]\", \"java.lang.Object\", \"source:\");\n+        checkFor(output,\"[class,unload]\", \"unloading class\");\n@@ -118,2 +113,2 @@\n-        pb = exec(\"-Xlog:class+loader+data=trace\");\n-        checkFor(\"[class,loader,data]\", \"create loader data\");\n+        output = exec(\"-Xlog:class+loader+data=trace\");\n+        checkFor(output, \"[class,loader,data]\", \"create loader data\");\n@@ -122,3 +117,3 @@\n-        pb = exec(\"-Xlog:class+load+cause\");\n-        checkAbsent(\"[class,load,cause]\");\n-        checkFor(\"class load cause logging will not produce output without LogClassLoadingCauseFor\");\n+        output = exec(\"-Xlog:class+load+cause\");\n+        checkAbsent(output,\"[class,load,cause]\");\n+        checkFor(output,\"class load cause logging will not produce output without LogClassLoadingCauseFor\");\n@@ -128,2 +123,2 @@\n-        pb = exec(\"-Xlog:class+load+cause\", \"-XX:LogClassLoadingCauseFor=\" + x);\n-        checkFor(\"[class,load,cause]\", \"Java stack when loading \" + x + \":\");\n+        output = exec(\"-Xlog:class+load+cause\", \"-XX:LogClassLoadingCauseFor=\" + x);\n+        checkFor(output,\"[class,load,cause]\", \"Java stack when loading \" + x + \":\");\n@@ -131,2 +126,2 @@\n-        pb = exec(\"-Xlog:class+load+cause+native\", \"-XX:LogClassLoadingCauseFor=\" + x);\n-        checkFor(\"[class,load,cause,native]\", \"Native stack when loading \" + x + \":\");\n+        output = exec(\"-Xlog:class+load+cause+native\", \"-XX:LogClassLoadingCauseFor=\" + x);\n+        checkFor(output,\"[class,load,cause,native]\", \"Native stack when loading \" + x + \":\");\n@@ -134,3 +129,3 @@\n-        pb = exec(\"-Xlog:class+load+cause*\", \"-XX:LogClassLoadingCauseFor=\" + x);\n-        checkFor(\"[class,load,cause] Java stack when loading \" + x + \":\");\n-        checkFor(\"[class,load,cause,native] Native stack when loading \" + x + \":\");\n+        output = exec(\"-Xlog:class+load+cause*\", \"-XX:LogClassLoadingCauseFor=\" + x);\n+        checkFor(output,\"[class,load,cause] Java stack when loading \" + x + \":\");\n+        checkFor(output,\"[class,load,cause,native] Native stack when loading \" + x + \":\");\n","filename":"test\/hotspot\/jtreg\/runtime\/logging\/ClassLoadUnloadTest.java","additions":38,"deletions":43,"binary":false,"changes":81,"status":"modified"}]}