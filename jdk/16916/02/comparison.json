{"files":[{"patch":"@@ -573,1 +573,0 @@\n-java\/nio\/file\/Files\/probeContentType\/Basic.java                 8320943 windows-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+ * @modules java.base\/jdk.internal.util\n@@ -36,0 +37,1 @@\n+import java.util.ArrayList;\n@@ -39,0 +41,3 @@\n+import jdk.internal.util.OperatingSystem;\n+import jdk.internal.util.OSVersion;\n+\n@@ -44,3 +49,0 @@\n-    private static final boolean IS_UNIX =\n-        ! System.getProperty(\"os.name\").startsWith(\"Windows\");\n-\n@@ -82,1 +84,1 @@\n-            if (IS_UNIX) {\n+            if (!OperatingSystem.isWindows()) {\n@@ -101,1 +103,1 @@\n-    static int checkContentTypes(ExType[] exTypes)\n+    static int checkContentTypes(List<ExType> exTypes)\n@@ -104,3 +106,3 @@\n-        for (int i = 0; i < exTypes.length; i++) {\n-            String extension = exTypes[i].extension();\n-            List<String> expectedTypes = exTypes[i].expectedTypes();\n+        for (ExType exType : exTypes) {\n+            String extension = exType.extension();\n+            List<String> expectedTypes = exType.expectedTypes();\n@@ -158,34 +160,49 @@\n-        var exTypes = new ExType[] {\n-                new ExType(\"adoc\", List.of(\"text\/plain\")),\n-                new ExType(\"bz2\", List.of(\"application\/bz2\", \"application\/x-bzip2\", \"application\/x-bzip\")),\n-                new ExType(\"css\", List.of(\"text\/css\")),\n-                new ExType(\"csv\", List.of(\"text\/csv\")),\n-                new ExType(\"doc\", List.of(\"application\/msword\")),\n-                new ExType(\"docx\", List.of(\"application\/vnd.openxmlformats-officedocument.wordprocessingml.document\")),\n-                new ExType(\"gz\", List.of(\"application\/gzip\", \"application\/x-gzip\")),\n-                new ExType(\"jar\", List.of(\"application\/java-archive\", \"application\/x-java-archive\", \"application\/jar\")),\n-                new ExType(\"jpg\", List.of(\"image\/jpeg\")),\n-                new ExType(\"js\", List.of(\"text\/plain\", \"text\/javascript\", \"application\/javascript\")),\n-                new ExType(\"json\", List.of(\"application\/json\")),\n-                new ExType(\"markdown\", List.of(\"text\/markdown\")),\n-                new ExType(\"md\", List.of(\"text\/markdown\", \"application\/x-genesis-rom\")),\n-                new ExType(\"mp3\", List.of(\"audio\/mpeg\")),\n-                new ExType(\"mp4\", List.of(\"video\/mp4\")),\n-                new ExType(\"odp\", List.of(\"application\/vnd.oasis.opendocument.presentation\")),\n-                new ExType(\"ods\", List.of(\"application\/vnd.oasis.opendocument.spreadsheet\")),\n-                new ExType(\"odt\", List.of(\"application\/vnd.oasis.opendocument.text\")),\n-                new ExType(\"pdf\", List.of(\"application\/pdf\")),\n-                new ExType(\"php\", List.of(\"text\/plain\", \"text\/php\", \"application\/x-php\")),\n-                new ExType(\"png\", List.of(\"image\/png\")),\n-                new ExType(\"ppt\", List.of(\"application\/vnd.ms-powerpoint\")),\n-                new ExType(\"pptx\",List.of(\"application\/vnd.openxmlformats-officedocument.presentationml.presentation\")),\n-                new ExType(\"py\", List.of(\"text\/plain\", \"text\/x-python\", \"text\/x-python-script\")),\n-                new ExType(\"rar\", List.of(\"application\/rar\", \"application\/vnd.rar\", \"application\/x-rar\", \"application\/x-rar-compressed\")),\n-                new ExType(\"rtf\", List.of(\"application\/rtf\", \"text\/rtf\")),\n-                new ExType(\"webm\", List.of(\"video\/webm\")),\n-                new ExType(\"webp\", List.of(\"image\/webp\")),\n-                new ExType(\"xls\", List.of(\"application\/vnd.ms-excel\")),\n-                new ExType(\"xlsx\", List.of(\"application\/vnd.openxmlformats-officedocument.spreadsheetml.sheet\")),\n-                new ExType(\"7z\", List.of(\"application\/x-7z-compressed\")),\n-                new ExType(\"wasm\", List.of(\"application\/wasm\")),\n-        };\n+        List<ExType> exTypes = new ArrayList<ExType>();\n+\n+        \/\/ extensions with consistent content type\n+        exTypes.add(new ExType(\"adoc\", List.of(\"text\/plain\")));\n+        exTypes.add(new ExType(\"css\", List.of(\"text\/css\")));\n+        exTypes.add(new ExType(\"doc\", List.of(\"application\/msword\")));\n+        exTypes.add(new ExType(\"docx\", List.of(\"application\/vnd.openxmlformats-officedocument.wordprocessingml.document\")));\n+        exTypes.add(new ExType(\"gz\", List.of(\"application\/gzip\", \"application\/x-gzip\")));\n+        exTypes.add(new ExType(\"jar\", List.of(\"application\/java-archive\", \"application\/x-java-archive\", \"application\/jar\")));\n+        exTypes.add(new ExType(\"jpg\", List.of(\"image\/jpeg\")));\n+        exTypes.add(new ExType(\"js\", List.of(\"text\/plain\", \"text\/javascript\", \"application\/javascript\")));\n+        exTypes.add(new ExType(\"json\", List.of(\"application\/json\")));\n+        exTypes.add(new ExType(\"markdown\", List.of(\"text\/markdown\")));\n+        exTypes.add(new ExType(\"md\", List.of(\"text\/markdown\", \"application\/x-genesis-rom\")));\n+        exTypes.add(new ExType(\"mp3\", List.of(\"audio\/mpeg\")));\n+        exTypes.add(new ExType(\"mp4\", List.of(\"video\/mp4\")));\n+        exTypes.add(new ExType(\"odp\", List.of(\"application\/vnd.oasis.opendocument.presentation\")));\n+        exTypes.add(new ExType(\"ods\", List.of(\"application\/vnd.oasis.opendocument.spreadsheet\")));\n+        exTypes.add(new ExType(\"odt\", List.of(\"application\/vnd.oasis.opendocument.text\")));\n+        exTypes.add(new ExType(\"pdf\", List.of(\"application\/pdf\")));\n+        exTypes.add(new ExType(\"php\", List.of(\"text\/plain\", \"text\/php\", \"application\/x-php\")));\n+        exTypes.add(new ExType(\"png\", List.of(\"image\/png\")));\n+        exTypes.add(new ExType(\"ppt\", List.of(\"application\/vnd.ms-powerpoint\")));\n+        exTypes.add(new ExType(\"pptx\", List.of(\"application\/vnd.openxmlformats-officedocument.presentationml.presentation\")));\n+        exTypes.add(new ExType(\"py\", List.of(\"text\/plain\", \"text\/x-python\", \"text\/x-python-script\")));\n+        exTypes.add(new ExType(\"webm\", List.of(\"video\/webm\")));\n+        exTypes.add(new ExType(\"webp\", List.of(\"image\/webp\")));\n+        exTypes.add(new ExType(\"xls\", List.of(\"application\/vnd.ms-excel\")));\n+        exTypes.add(new ExType(\"xlsx\", List.of(\"application\/vnd.openxmlformats-officedocument.spreadsheetml.sheet\")));\n+        exTypes.add(new ExType(\"wasm\", List.of(\"application\/wasm\")));\n+\n+        \/\/ extensions with content type that differs on Windows 11+\n+        if (OperatingSystem.isWindows() &&\n+            (System.getProperty(\"os.name\").endsWith(\"11\") ||\n+                new OSVersion(10, 0).compareTo(OSVersion.current()) > 0)) {\n+            System.out.println(\"Windows 11+ detected: using different types\");\n+            exTypes.add(new ExType(\"bz2\", List.of(\"application\/bz2\", \"application\/x-bzip2\", \"application\/x-bzip\", \"application\/x-compressed\")));\n+            exTypes.add(new ExType(\"csv\", List.of(\"text\/csv\", \"application\/vnd.ms-excel\")));\n+            exTypes.add(new ExType(\"rar\", List.of(\"application\/rar\", \"application\/vnd.rar\", \"application\/x-rar\", \"application\/x-rar-compressed\", \"application\/x-compressed\")));\n+            exTypes.add(new ExType(\"rtf\", List.of(\"application\/rtf\", \"text\/rtf\", \"application\/msword\")));\n+            exTypes.add(new ExType(\"7z\", List.of(\"application\/x-7z-compressed\", \"application\/x-compressed\")));\n+        } else {\n+            exTypes.add(new ExType(\"bz2\", List.of(\"application\/bz2\", \"application\/x-bzip2\", \"application\/x-bzip\")));\n+            exTypes.add(new ExType(\"csv\", List.of(\"text\/csv\")));\n+            exTypes.add(new ExType(\"rar\", List.of(\"application\/rar\", \"application\/vnd.rar\", \"application\/x-rar\", \"application\/x-rar-compressed\")));\n+            exTypes.add(new ExType(\"rtf\", List.of(\"application\/rtf\", \"text\/rtf\")));\n+            exTypes.add(new ExType(\"7z\", List.of(\"application\/x-7z-compressed\")));\n+        }\n+\n","filename":"test\/jdk\/java\/nio\/file\/Files\/probeContentType\/Basic.java","additions":60,"deletions":43,"binary":false,"changes":103,"status":"modified"}]}