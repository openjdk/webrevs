{"files":[{"patch":"@@ -36,1 +36,5 @@\n-import java.io.*;\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.OutputStream;\n@@ -44,0 +48,1 @@\n+\n@@ -45,0 +50,1 @@\n+\n@@ -58,1 +64,10 @@\n-import java.util.*;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Base64;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.TimeZone;\n+import java.util.concurrent.CountDownLatch;\n@@ -78,2 +93,0 @@\n-    static final double TIMEOUT_FACTOR = Double.parseDouble(System.getProperty(\"test.timeout.factor\", \"1.0\"));\n-\n@@ -97,4 +110,0 @@\n-    \/*\n-     * Is the server ready to serve?\n-     *\/\n-    volatile static boolean serverReady = false;\n@@ -169,1 +178,1 @@\n-        serverReady = false;\n+        CountDownLatch serverReady = new CountDownLatch(1);\n@@ -197,1 +206,1 @@\n-                servParams);\n+                servParams, serverReady);\n@@ -224,1 +233,1 @@\n-     * If the server prematurely exits, serverReady will be set to true\n+     * If the server prematurely exits, serverReady will be countdown\n@@ -227,1 +236,1 @@\n-    void doServerSide(ServerParameters servParams) throws Exception {\n+    void doServerSide(ServerParameters servParams, CountDownLatch serverReady) throws Exception {\n@@ -279,1 +288,1 @@\n-        serverReady = true;\n+        serverReady.countDown();\n@@ -311,1 +320,1 @@\n-     * If the server prematurely exits, serverReady will be set to true\n+     * If the server prematurely exits, serverReady will be countdown\n@@ -314,1 +323,1 @@\n-    void doClientSide(ClientParameters cliParams) throws Exception {\n+    void doClientSide(ClientParameters cliParams, CountDownLatch serverReady) throws Exception {\n@@ -316,9 +325,1 @@\n-        \/\/ Wait 5 seconds for server ready\n-        int maxWait = (int)(TIMEOUT_FACTOR * 100);\n-        for (int i = 0; (i < maxWait && !serverReady); i++) {\n-            Thread.sleep(50);\n-        }\n-        if (!serverReady) {\n-            System.out.println(\"Server wasn't ready after \" + maxWait \/ 20 + \" seconds\");\n-            throw new RuntimeException(\"Server not ready yet\");\n-        }\n+        serverReady.await();\n@@ -381,1 +382,1 @@\n-            ServerParameters servParams) throws Exception {\n+            ServerParameters servParams, CountDownLatch serverReady) throws Exception {\n@@ -385,2 +386,2 @@\n-                startServer(servParams, true);\n-                startClient(cliParams, false);\n+                startServer(servParams, true, serverReady);\n+                startClient(cliParams, false, serverReady);\n@@ -388,2 +389,2 @@\n-                startClient(cliParams, true);\n-                startServer(servParams, false);\n+                startClient(cliParams, true, serverReady);\n+                startServer(servParams, false, serverReady);\n@@ -460,1 +461,1 @@\n-    final void startServer(ServerParameters servParams, boolean newThread)\n+    final void startServer(ServerParameters servParams, boolean newThread, CountDownLatch serverReady)\n@@ -467,1 +468,1 @@\n-                        doServerSide(servParams);\n+                        doServerSide(servParams, serverReady);\n@@ -475,1 +476,0 @@\n-                        serverReady = true;\n@@ -477,0 +477,2 @@\n+                    } finally {\n+                        serverReady.countDown();\n@@ -483,1 +485,1 @@\n-                doServerSide(servParams);\n+                doServerSide(servParams, serverReady);\n@@ -488,1 +490,1 @@\n-                serverReady = true;\n+                serverReady.countDown();\n@@ -493,1 +495,1 @@\n-    final void startClient(ClientParameters cliParams, boolean newThread)\n+    final void startClient(ClientParameters cliParams, boolean newThread, CountDownLatch serverReady)\n@@ -500,1 +502,1 @@\n-                        doClientSide(cliParams);\n+                        doClientSide(cliParams, serverReady);\n@@ -513,1 +515,1 @@\n-                doClientSide(cliParams);\n+                doClientSide(cliParams, serverReady);\n","filename":"test\/jdk\/javax\/net\/ssl\/Stapling\/HttpsUrlConnClient.java","additions":39,"deletions":37,"binary":false,"changes":76,"status":"modified"}]}