{"files":[{"patch":"@@ -864,5 +864,4 @@\n-  const char* filename = _filename.value();\n-  if (strncmp(filename, DEFAULT_PERFMAP_FILENAME, strlen(DEFAULT_PERFMAP_FILENAME)) == 0) {\n-      filename = nullptr; \/\/ use the default filename based on the pid\n-  }\n-  CodeCache::write_perf_map(filename);\n+  \/\/ The check for _filename.is_set() is because we don't want to use\n+  \/\/ DEFAULT_PERFMAP_FILENAME, since it is meant as a description\n+  \/\/ of the default, not the actual default.\n+  CodeCache::write_perf_map(_filename.is_set() ? _filename.value() : nullptr);\n@@ -1015,1 +1014,0 @@\n-  const char* file = _filename.value();\n@@ -1017,3 +1015,4 @@\n-  if (strncmp(file, DEFAULT_PERFMAP_FILENAME, strlen(DEFAULT_PERFMAP_FILENAME)) == 0) {\n-    file = nullptr; \/\/ use the default filename based on the suboption and pid\n-  }\n+  \/\/ The check for _filename.is_set() is because we don't want to use\n+  \/\/ DEFAULT_CDS_ARCHIVE_FILENAME, since it is meant as a description\n+  \/\/ of the default, not the actual default.\n+  const char* file = _filename.is_set() ? _filename.value() : nullptr;\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-        Assert.assertTrue(Files.exists(path));\n+        Assert.assertTrue(Files.exists(path), \"File must exist: \" + path);\n@@ -97,0 +97,12 @@\n+\n+\n+    @Test\n+    public void specifiedDefaultMapFile() {\n+        \/\/ This is a special case of specifiedMapFile() where the filename specified\n+        \/\/ is the same as the default filename as given in the help output. The dcmd\n+        \/\/ should treat this literally as the filename and not expand <pid> into\n+        \/\/ the actual PID of the process.\n+        String test_dir = System.getProperty(\"test.dir\", \".\");\n+        Path path = Paths.get(\"\/tmp\/perf-<pid>.map\");\n+        run(new JMXExecutor(), \"Compiler.perfmap \" + path.toString(), path);\n+    }\n","filename":"test\/hotspot\/jtreg\/serviceability\/dcmd\/compiler\/PerfMapTest.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"}]}