{"files":[{"patch":"@@ -81,1 +81,5 @@\n-      CFLAGS := $(CFLAGS_JDKEXE) -I$(TOPDIR)\/src\/$(MODULE)\/unix\/native\/libjava, \\\n+      CFLAGS := $(CFLAGS_JDKEXE) -I$(TOPDIR)\/src\/$(MODULE)\/unix\/native\/libjava \\\n+          -DVERSION_FEATURE=$(VERSION_FEATURE) \\\n+          -DVERSION_INTERIM=$(VERSION_INTERIM) \\\n+          -DVERSION_UPDATE=$(VERSION_UPDATE) \\\n+          -DVERSION_PATCH=$(VERSION_PATCH), \\\n","filename":"make\/modules\/java.base\/Launcher.gmk","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -49,1 +49,5 @@\n-LIBJAVA_CFLAGS := -DARCHPROPNAME='\"$(OPENJDK_TARGET_CPU_OSARCH)\"'\n+LIBJAVA_CFLAGS := -DARCHPROPNAME='\"$(OPENJDK_TARGET_CPU_OSARCH)\"' \\\n+    -DVERSION_FEATURE=$(VERSION_FEATURE) \\\n+    -DVERSION_INTERIM=$(VERSION_INTERIM) \\\n+    -DVERSION_UPDATE=$(VERSION_UPDATE) \\\n+    -DVERSION_PATCH=$(VERSION_PATCH)\n","filename":"make\/modules\/java.base\/lib\/CoreLibraries.gmk","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -53,0 +53,16 @@\n+#ifndef VERSION_FEATURE\n+#error VERSION_FEATURE must be defined\n+#endif\n+\n+#ifndef VERSION_INTERIM\n+#error VERSION_INTERIM must be defined\n+#endif\n+\n+#ifndef VERSION_UPDATE\n+#error VERSION_UPDATE must be defined\n+#endif\n+\n+#ifndef VERSION_PATCH\n+#error VERSION_PATCH must be defined\n+#endif\n+\n@@ -142,0 +158,1 @@\n+    int jdk_feature, jdk_interim, jdk_update, jdk_patch;\n@@ -151,2 +168,9 @@\n-    r = sscanf (argv[1], \"%d:%d:%d\", &fdinr, &fdinw, &fdout);\n-    if (r == 3 && fcntl(fdinr, F_GETFD) != -1 && fcntl(fdinw, F_GETFD) != -1) {\n+    r = sscanf (argv[1], \"%d:%d:%d:%d:%d:%d:%d\", &fdinr, &fdinw, &fdout, &jdk_feature, &jdk_interim, &jdk_update, &jdk_patch);\n+    if (r == 7 && fcntl(fdinr, F_GETFD) != -1 && fcntl(fdinw, F_GETFD) != -1) {\n+        \/\/ Check that JDK version and jspawnhelper version are the same\n+        if (jdk_feature != VERSION_FEATURE || jdk_interim != VERSION_INTERIM || jdk_update != VERSION_UPDATE || jdk_patch != VERSION_PATCH) {\n+            fprintf(stderr, \"Expected jspawnhelper for Java %d.%d.%d.%d, \", jdk_feature, jdk_interim, jdk_update, jdk_patch);\n+            fprintf(stderr, \"but jspawnhelper for Java %d.%d.%d.%d was found.\\n\", VERSION_FEATURE, VERSION_INTERIM, VERSION_UPDATE, VERSION_PATCH);\n+            shutItDown();\n+        }\n+\n","filename":"src\/java.base\/unix\/native\/jspawnhelper\/jspawnhelper.c","additions":26,"deletions":2,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -303,0 +303,16 @@\n+#ifndef VERSION_FEATURE\n+#error VERSION_FEATURE must be defined\n+#endif\n+\n+#ifndef VERSION_INTERIM\n+#error VERSION_INTERIM must be defined\n+#endif\n+\n+#ifndef VERSION_UPDATE\n+#error VERSION_UPDATE must be defined\n+#endif\n+\n+#ifndef VERSION_PATCH\n+#error VERSION_PATCH must be defined\n+#endif\n+\n@@ -490,1 +506,1 @@\n-    char *buf, buf1[(3 * 11) + 3]; \/\/ \"%d:%d:%d\\0\"\n+    char *buf, buf1[(7 * 11) + 7]; \/\/ \"%d:%d:%d:%d:%d:%d:%d\\0\"\n@@ -497,1 +513,3 @@\n-    snprintf(buf1, sizeof(buf1), \"%d:%d:%d\", c->childenv[0], c->childenv[1], c->fail[1]);\n+    snprintf(buf1, sizeof(buf1), \"%d:%d:%d:%d:%d:%d:%d\", c->childenv[0], c->childenv[1], c->fail[1],\n+             VERSION_FEATURE, VERSION_INTERIM, VERSION_UPDATE, VERSION_PATCH);\n+\n","filename":"src\/java.base\/unix\/native\/libjava\/ProcessImpl_md.c","additions":20,"deletions":2,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n- * @bug 8325567\n+ * @bug 8325567 8325621\n@@ -52,0 +52,10 @@\n+    private static void testVersion() throws Exception {\n+        String[] args = new String[2];\n+        args[0] = Paths.get(System.getProperty(\"java.home\"), \"lib\", \"jspawnhelper\").toString();\n+        args[1] = \"1:1:1:1:1:1:1\";\n+        Process p = ProcessTools.startProcess(\"jspawnhelper\", new ProcessBuilder(args));\n+        OutputAnalyzer oa = new OutputAnalyzer(p);\n+        oa.shouldHaveExitValue(1);\n+        oa.shouldContain(\"Expected jspawnhelper for Java 1.1.1.1\");\n+    }\n+\n@@ -56,0 +66,2 @@\n+\n+        testVersion();\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/JspawnhelperWarnings.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"}]}