{"files":[{"patch":"@@ -81,5 +81,3 @@\n-      CFLAGS := $(CFLAGS_JDKEXE) -I$(TOPDIR)\/src\/$(MODULE)\/unix\/native\/libjava \\\n-          -DVERSION_FEATURE=$(VERSION_FEATURE) \\\n-          -DVERSION_INTERIM=$(VERSION_INTERIM) \\\n-          -DVERSION_UPDATE=$(VERSION_UPDATE) \\\n-          -DVERSION_PATCH=$(VERSION_PATCH), \\\n+      CFLAGS := $(CFLAGS_JDKEXE) \\\n+                -I$(TOPDIR)\/src\/$(MODULE)\/unix\/native\/libjava \\\n+                $(VERSION_CFLAGS), \\\n","filename":"make\/modules\/java.base\/Launcher.gmk","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -49,5 +49,1 @@\n-LIBJAVA_CFLAGS := -DARCHPROPNAME='\"$(OPENJDK_TARGET_CPU_OSARCH)\"' \\\n-    -DVERSION_FEATURE=$(VERSION_FEATURE) \\\n-    -DVERSION_INTERIM=$(VERSION_INTERIM) \\\n-    -DVERSION_UPDATE=$(VERSION_UPDATE) \\\n-    -DVERSION_PATCH=$(VERSION_PATCH)\n+LIBJAVA_CFLAGS := -DARCHPROPNAME='\"$(OPENJDK_TARGET_CPU_OSARCH)\"'\n@@ -66,0 +62,1 @@\n+    ProcessImpl_md.c_CFLAGS := $(VERSION_CFLAGS), \\\n","filename":"make\/modules\/java.base\/lib\/CoreLibraries.gmk","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include <string.h>\n@@ -53,14 +54,2 @@\n-#ifndef VERSION_FEATURE\n-#error VERSION_FEATURE must be defined\n-#endif\n-\n-#ifndef VERSION_INTERIM\n-#error VERSION_INTERIM must be defined\n-#endif\n-\n-#ifndef VERSION_UPDATE\n-#error VERSION_UPDATE must be defined\n-#endif\n-\n-#ifndef VERSION_PATCH\n-#error VERSION_PATCH must be defined\n+#ifndef VERSION_STRING\n+#error VERSION_STRING must be defined\n@@ -158,1 +147,0 @@\n-    int jdk_feature, jdk_interim, jdk_update, jdk_patch;\n@@ -161,1 +149,1 @@\n-    if (argc != 2) {\n+    if (argc != 3) {\n@@ -168,8 +156,0 @@\n-    r = sscanf (argv[1], \"%d:%d:%d:%d:%d:%d:%d\", &fdinr, &fdinw, &fdout, &jdk_feature, &jdk_interim, &jdk_update, &jdk_patch);\n-    if (r == 7 && fcntl(fdinr, F_GETFD) != -1 && fcntl(fdinw, F_GETFD) != -1) {\n-        \/\/ Check that JDK version and jspawnhelper version are the same\n-        if (jdk_feature != VERSION_FEATURE || jdk_interim != VERSION_INTERIM || jdk_update != VERSION_UPDATE || jdk_patch != VERSION_PATCH) {\n-            fprintf(stderr, \"Expected jspawnhelper for Java %d.%d.%d.%d, \", jdk_feature, jdk_interim, jdk_update, jdk_patch);\n-            fprintf(stderr, \"but jspawnhelper for Java %d.%d.%d.%d was found.\\n\", VERSION_FEATURE, VERSION_INTERIM, VERSION_UPDATE, VERSION_PATCH);\n-            shutItDown();\n-        }\n@@ -177,0 +157,7 @@\n+    if (strcmp(argv[1], VERSION_STRING) != 0) {\n+        fprintf(stdout, \"Version check failed. jspawnhelper version: %s, JDK version: %s\\n\", VERSION_STRING, argv[1]);\n+        shutItDown();\n+    }\n+\n+    r = sscanf (argv[2], \"%d:%d:%d\", &fdinr, &fdinw, &fdout);\n+    if (r == 3 && fcntl(fdinr, F_GETFD) != -1 && fcntl(fdinw, F_GETFD) != -1) {\n","filename":"src\/java.base\/unix\/native\/jspawnhelper\/jspawnhelper.c","additions":11,"deletions":24,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -303,14 +303,2 @@\n-#ifndef VERSION_FEATURE\n-#error VERSION_FEATURE must be defined\n-#endif\n-\n-#ifndef VERSION_INTERIM\n-#error VERSION_INTERIM must be defined\n-#endif\n-\n-#ifndef VERSION_UPDATE\n-#error VERSION_UPDATE must be defined\n-#endif\n-\n-#ifndef VERSION_PATCH\n-#error VERSION_PATCH must be defined\n+#ifndef VERSION_STRING\n+#error VERSION_STRING must be defined\n@@ -506,2 +494,2 @@\n-    char *buf, buf1[(7 * 11) + 7]; \/\/ \"%d:%d:%d:%d:%d:%d:%d\\0\"\n-    char *hlpargs[3];\n+    char *buf, buf1[(3 * 11) + 3]; \/\/ \"%d:%d:%d\\0\"\n+    char *hlpargs[4];\n@@ -513,3 +501,1 @@\n-    snprintf(buf1, sizeof(buf1), \"%d:%d:%d:%d:%d:%d:%d\", c->childenv[0], c->childenv[1], c->fail[1],\n-             VERSION_FEATURE, VERSION_INTERIM, VERSION_UPDATE, VERSION_PATCH);\n-\n+    snprintf(buf1, sizeof(buf1), \"%d:%d:%d\", c->childenv[0], c->childenv[1], c->fail[1]);\n@@ -518,1 +504,2 @@\n-     * argv[1] contains the fd string as argument to jspawnhelper\n+     * argv[1] contains the version string as argument to jspawnhelper\n+     * argv[2] contains the fd string as argument to jspawnhelper\n@@ -521,2 +508,3 @@\n-    hlpargs[1] = buf1;\n-    hlpargs[2] = NULL;\n+    hlpargs[1] = VERSION_STRING;\n+    hlpargs[2] = buf1;\n+    hlpargs[3] = NULL;\n","filename":"src\/java.base\/unix\/native\/libjava\/ProcessImpl_md.c","additions":10,"deletions":22,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-        String[] args = new String[2];\n+        String[] args = new String[3];\n@@ -55,1 +55,2 @@\n-        args[1] = \"1:1:1:1:1:1:1\";\n+        args[1] = \"wrongVersion\";\n+        args[2] = \"1:1:1\";\n@@ -59,1 +60,1 @@\n-        oa.shouldContain(\"Expected jspawnhelper for Java 1.1.1.1\");\n+        oa.shouldContain(\"Version check failed\");\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/JspawnhelperWarnings.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"}]}