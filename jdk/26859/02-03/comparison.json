{"files":[{"patch":"@@ -2422,1 +2422,9 @@\n-          JVMFlag::printError(true,\"uintx MaxHeapFreeRatio=%s is outside the allowed range  [ 0.0 ... 1.0 ]\\n\", tail);\n+          jio_fprintf(defaultStream::error_stream(),\n+                      \"-Xmaxf value (%s) is outside the allowed range [ 0.0 ... 1.0 ]\\n\",\n+                      option->optionString);\n+          return JNI_EINVAL;\n+        }\n+        if (MinHeapFreeRatio > (uintx)(dmaxf * 100)) {\n+          jio_fprintf(defaultStream::error_stream(),\n+                      \"-Xmaxf value (%s) which is also used for MaxHeapFreeRatio must be greater than or equal to MinHeapFreeRatio (%3.2lf)\\n\",\n+                      tail, MinHeapFreeRatio \/ 100.0);\n@@ -2440,1 +2448,9 @@\n-          JVMFlag::printError(true,\"uintx MinHeapFreeRatio=%s is outside the allowed range [ 0.0 ... 1.0 ]\\n\", tail);\n+          jio_fprintf(defaultStream::error_stream(),\n+                      \"-Xminf value (%s) is outside the allowed range [ 0.0 ... 1.0 ]\\n\",\n+                      tail);\n+          return JNI_EINVAL;\n+        }\n+        if (MaxHeapFreeRatio < (uintx)(dminf * 100)) {\n+          jio_fprintf(defaultStream::error_stream(),\n+                      \"-Xminf value (%s) which is also used for MinHeapFreeRatio must be less than or equal to MaxHeapFreeRatio (%3.2lf)\\n\",\n+                      tail, MaxHeapFreeRatio \/ 100.0);\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":18,"deletions":2,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -50,6 +50,1 @@\n-  private static void testMinMaxFreeRatio(String min, String max, Validation type) throws Exception {\n-    OutputAnalyzer output = GCArguments.executeTestJava(\n-        \"-Xminf\" + min,\n-        \"-Xmaxf\" + max,\n-        \"-version\");\n-\n+  private static void checkValidity(OutputAnalyzer output, String min, String max, Validation type) {\n@@ -77,1 +72,1 @@\n-      output.shouldContain(\"must be less than or equal to MaxHeapFreeRatio\");\n+      output.shouldMatch(\"must be (less|greater) than or equal to M..HeapFreeRatio\");\n@@ -88,0 +83,18 @@\n+  private static void testMinMaxFreeRatio_Reordered(String min, String max, Validation type) throws Exception {\n+    OutputAnalyzer output = GCArguments.executeTestJava(\n+        \"-Xmaxf\" + max,\n+        \"-Xminf\" + min,\n+        \"-version\");\n+\n+    checkValidity(output, min, max, type);\n+  }\n+\n+  private static void testMinMaxFreeRatio(String min, String max, Validation type) throws Exception {\n+    OutputAnalyzer output = GCArguments.executeTestJava(\n+        \"-Xminf\" + min,\n+        \"-Xmaxf\" + max,\n+        \"-version\");\n+\n+    checkValidity(output, min, max, type);\n+  }\n+\n@@ -107,1 +120,1 @@\n-                  \"2147483647\", \"0.5\", Validation.OUT_OF_RANGE);\n+                   \"2147483647\", \"0.5\", Validation.OUT_OF_RANGE);\n@@ -117,3 +130,15 @@\n-    testMinMaxFreeRatio( \"0.5\",  \"0.1\", Validation.COMBINATION_INVALID);\n-    testMinMaxFreeRatio(  \".5\",  \".10\", Validation.COMBINATION_INVALID);\n-    testMinMaxFreeRatio(\"0.12\",\"0.100\", Validation.COMBINATION_INVALID);\n+    testMinMaxFreeRatio( \"0.5\",   \"0.1\", Validation.COMBINATION_INVALID);\n+    testMinMaxFreeRatio(  \".5\",   \".10\", Validation.COMBINATION_INVALID);\n+    testMinMaxFreeRatio(\"0.12\", \"0.100\", Validation.COMBINATION_INVALID);\n+\n+    \/\/ Default range is [0.40, 0.70]\n+    \/\/ setting minf to 0.80 violates minf < maxf\n+    testMinMaxFreeRatio(\"0.80\", \"0.90\", Validation.COMBINATION_INVALID);\n+\n+    \/\/ Options are re-ordered: -Xmaxf is given before -Xminf\n+\n+    \/\/ valid range, but acceptable only if maxf be set first\n+    testMinMaxFreeRatio_Reordered(\"0.80\", \"0.90\", Validation.VALID);\n+\n+    \/\/ although a valid range, but setting maxf first violates minf < maxf\n+    testMinMaxFreeRatio_Reordered(\"0.10\", \"0.30\", Validation.COMBINATION_INVALID);\n","filename":"test\/hotspot\/jtreg\/gc\/arguments\/TestHeapFreeRatio.java","additions":36,"deletions":11,"binary":false,"changes":47,"status":"modified"}]}