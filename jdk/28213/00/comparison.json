{"files":[{"patch":"@@ -188,4 +188,7 @@\n-    \/\/ Currently, only attempts to allocate GC alloc regions set\n-    \/\/ do_expand to true. So, we should only reach here during a\n-    \/\/ safepoint.\n-    assert(SafepointSynchronize::is_at_safepoint(), \"invariant\");\n+    \/\/ There are two situations where do_expand is set to true:\n+    \/\/  - for mutator regions during initialization\n+    \/\/  - for GC alloc regions during a safepoint\n+    \/\/ Make sure we only reach here before initialization is complete\n+    \/\/ or during a safepoint.\n+    assert(!is_init_completed() ||\n+           SafepointSynchronize::is_at_safepoint() , \"invariant\");\n@@ -3104,1 +3107,1 @@\n-                                                false \/* do_expand *\/,\n+                                                policy()->should_expand_on_mutator_allocation() \/* do_expand *\/,\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -1190,2 +1190,15 @@\n-  uint young_list_length = _g1h->young_regions_count();\n-  return young_list_length < young_list_target_length();\n+  if (_g1h->young_regions_count() < young_list_target_length()) {\n+    return true;\n+  }\n+\n+  if (should_expand_on_mutator_allocation()) {\n+    return true;\n+  }\n+\n+  return false;\n+}\n+\n+bool G1Policy::should_expand_on_mutator_allocation() const {\n+  \/\/ We can't do a GC during init so allow additional mutator\n+  \/\/ allocations until we can GC.\n+  return !is_init_completed();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -370,0 +370,1 @@\n+  bool should_expand_on_mutator_allocation() const;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}