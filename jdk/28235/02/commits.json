[{"commit":{"message":"OS agnostic fix for alignment of native segments\n\nOnly align up the requested memory if the requested alignment is larget\nthan max alignment provided by malloc, or if the requested size is not a\nmultiple of the alignment size.\n\nThis work was sponsored by: The FreeBSD Foundation\n\nCo-authored-by: mcimadamore"},"files":[{"filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/SegmentFactories.java"}],"sha":"15daa51b06aaf4cda7b85e5326d8652f838d1a79"},{"commit":{"message":"Second try to fix alignment for native segments\n\nIntroducing a helper function as suggested by JornVernee to decide on\nthe proper alignment based on the segment size.\n\nThis work was sponsored by: The FreeBSD Foundation\n\nCo-authored-by: JornVernee"},"files":[{"filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/SegmentFactories.java"}],"sha":"2b8266f682d96212baab6e17c72eba335b77e130"},{"commit":{"message":"Test that native segments don't overlap\n\nThis work was sponsored by: The FreeBSD Foundation"},"files":[{"filename":"test\/jdk\/java\/foreign\/TestMemoryAlignment.java"}],"sha":"2090700643dddddbde3bef1893659a1f687b26f5"},{"commit":{"message":"8371637: allocateNativeInternal sometimes return incorrectly aligned memory\n\njdk.internal.foreign.SegmentFactories::allocateNativeInternal assumes\nthat the underlying implementation of malloc aligns allocations on 16\nbyte boundaries for 64 bit platforms, and 8 byte boundaries on 32 bit\nplatforms. So for any allocation where the requested alignment is less\nthan or equal to this default alignment it makes no adjustment.\n\nHowever, this assumption does not hold for all allocators. Specifically\njemallc, used by libc on FreeBSD will align small allocations on 8 or 4\nbyte boundaries, respectively. This causes allocateNativeInternal to\nsometimes return memory that is not properly aligned when the requested\nalignment is exactly 16 bytes.\n\nTo make sure we honour the requested alignment when it exaclty matches\nthe quantum as defined by MAX_MALLOC_ALIGN, this patch ensures that we\nadjust the alignment also in this case.\n\nThis should make no difference for platforms where malloc allready\naligns on the quantum, except for a few unnecessary trivial\ncalculations.\n\nThis work was sponsored by: The FreeBSD Foundation"},"files":[{"filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/SegmentFactories.java"}],"sha":"0d1bb66558b84799ab022c95743d3361a61fa7e2"}]