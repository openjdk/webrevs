{"files":[{"patch":"@@ -51,0 +51,4 @@\n+    \/\/ The maximum alignment supported by malloc - typically 16 bytes on\n+    \/\/ 64-bit platforms and 8 bytes on 32-bit platforms.\n+    private static final long MAX_MALLOC_ALIGN = Unsafe.ADDRESS_SIZE == 4 ? 8 : 16;\n+\n@@ -202,3 +206,2 @@\n-        long defaultAlignment = alignmentForSize(alignedSize);\n-        if (byteAlignment > defaultAlignment) {\n-            allocationSize = alignedSize + byteAlignment - defaultAlignment;\n+        if (byteAlignment > MAX_MALLOC_ALIGN || alignedSize % byteAlignment != 0) {\n+            allocationSize = alignedSize + byteAlignment - MAX_MALLOC_ALIGN;\n@@ -250,10 +253,0 @@\n-    private static final boolean IS_FREEBSD = System.getProperty(\"os.name\").equals(\"FreeBSD\");\n-\n-    private static long alignmentForSize(long size) {\n-        if (IS_FREEBSD && size <= Double.BYTES) {\n-            return Double.BYTES;\n-        } else {\n-            return Unsafe.ADDRESS_SIZE == 4 ? 8 : 16;\n-        }\n-    }\n-\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/SegmentFactories.java","additions":6,"deletions":13,"binary":false,"changes":19,"status":"modified"}]}