{"files":[{"patch":"@@ -85,1 +85,1 @@\n- *\n+ * <p>\n@@ -101,1 +101,1 @@\n- *\n+ * <p>\n@@ -108,2 +108,2 @@\n- * @author      Robi Khan\n- * @since       1.3\n+ * @author Robi Khan\n+ * @since 1.3\n@@ -117,1 +117,1 @@\n-    private static Rectangle screenBounds;\n+    private static Rectangle[] allScreenBounds;\n@@ -124,4 +124,4 @@\n-     * @throws  AWTException if the platform configuration does not allow\n-     * low-level input control.  This exception is always thrown when\n-     * GraphicsEnvironment.isHeadless() returns true\n-     * @see     java.awt.GraphicsEnvironment#isHeadless\n+     * @throws AWTException if the platform configuration does not allow\n+     *                      low-level input control.  This exception is always thrown when\n+     *                      GraphicsEnvironment.isHeadless() returns true\n+     * @see java.awt.GraphicsEnvironment#isHeadless\n@@ -132,1 +132,1 @@\n-            .getDefaultScreenDevice());\n+                .getDefaultScreenDevice());\n@@ -149,9 +149,9 @@\n-     * @param screen    A screen GraphicsDevice indicating the coordinate\n-     *                  system the Robot will operate in.\n-     * @throws  AWTException if the platform configuration does not allow\n-     * low-level input control.  This exception is always thrown when\n-     * GraphicsEnvironment.isHeadless() returns true.\n-     * @throws  IllegalArgumentException if {@code screen} is not a screen\n-     *          GraphicsDevice.\n-     * @see     java.awt.GraphicsEnvironment#isHeadless\n-     * @see     GraphicsDevice\n+     * @param screen A screen GraphicsDevice indicating the coordinate\n+     *               system the Robot will operate in.\n+     * @throws AWTException             if the platform configuration does not allow\n+     *                                  low-level input control.  This exception is always thrown when\n+     *                                  GraphicsEnvironment.isHeadless() returns true.\n+     * @throws IllegalArgumentException if {@code screen} is not a screen\n+     *                                  GraphicsDevice.\n+     * @see java.awt.GraphicsEnvironment#isHeadless\n+     * @see GraphicsDevice\n@@ -168,1 +168,1 @@\n-            peer = ((ComponentFactory)toolkit).createRobot(screen);\n+            peer = ((ComponentFactory) toolkit).createRobot(screen);\n@@ -171,1 +171,5 @@\n-        screenBounds = screen.getDefaultConfiguration().getBounds();\n+        GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();\n+        GraphicsDevice[] gs = ge.getScreenDevices();\n+        for (int i = 0; i < gs.length; i++) {\n+            allScreenBounds[i] = gs[i].getDefaultConfiguration().getBounds();\n+        }\n@@ -179,1 +183,1 @@\n-        if (Toolkit.getDefaultToolkit().areExtraMouseButtonsEnabled()){\n+        if (Toolkit.getDefaultToolkit().areExtraMouseButtonsEnabled()) {\n@@ -181,3 +185,3 @@\n-                final int buttonsNumber = ((SunToolkit)(Toolkit.getDefaultToolkit())).getNumberOfButtons();\n-                for (int i = 0; i < buttonsNumber; i++){\n-                    tmpMask |= InputEvent.getMaskForButton(i+1);\n+                final int buttonsNumber = ((SunToolkit) (Toolkit.getDefaultToolkit())).getNumberOfButtons();\n+                for (int i = 0; i < buttonsNumber; i++) {\n+                    tmpMask |= InputEvent.getMaskForButton(i + 1);\n@@ -187,6 +191,6 @@\n-        tmpMask |= InputEvent.BUTTON1_MASK|\n-            InputEvent.BUTTON2_MASK|\n-            InputEvent.BUTTON3_MASK|\n-            InputEvent.BUTTON1_DOWN_MASK|\n-            InputEvent.BUTTON2_DOWN_MASK|\n-            InputEvent.BUTTON3_DOWN_MASK;\n+        tmpMask |= InputEvent.BUTTON1_MASK |\n+                InputEvent.BUTTON2_MASK |\n+                InputEvent.BUTTON3_MASK |\n+                InputEvent.BUTTON1_DOWN_MASK |\n+                InputEvent.BUTTON2_DOWN_MASK |\n+                InputEvent.BUTTON3_DOWN_MASK;\n@@ -219,2 +223,2 @@\n-     * @param x         X position\n-     * @param y         Y position\n+     * @param x X position\n+     * @param y Y position\n@@ -223,2 +227,31 @@\n-        peer.mouseMove(Math.min(Math.max(x, screenBounds.x), screenBounds.x + screenBounds.width),\n-                Math.min(Math.max(y, screenBounds.y), screenBounds.y + screenBounds.height));\n+        int leastXDiff = Integer.MAX_VALUE;\n+        int leastYDiff = Integer.MAX_VALUE;\n+        int finX, finY;\n+\n+        for (Rectangle screenBounds : allScreenBounds) {\n+            int closestX = Math.min(Math.max(x, screenBounds.x), screenBounds.x + screenBounds.width);\n+            int closestY = Math.min(Math.max(y, screenBounds.y), screenBounds.y + screenBounds.height);\n+\n+            int currXDiff = Math.abs(x - closestX);\n+            int currYDiff = Math.abs(y - closestY);\n+\n+            if ((currXDiff == 0) && (currYDiff == 0)) {\n+                finX = x;\n+                finY = y;\n+                break;\n+            } else if (currXDiff < leastXDiff) {\n+                finX = closestX;\n+                finY = closestY;\n+                leastXDiff = currXDiff;\n+                leastYDiff = currYDiff;\n+            } else if (currYDiff < leastYDiff) {\n+                finX = closestX;\n+                finY = closestY;\n+                leastXDiff = currXDiff;\n+                leastYDiff = currYDiff;\n+            }\n+        }\n+\n+        peer.mouseMove(finX, finY);\n+\/\/        peer.mouseMove(Math.min(Math.max(x, screenBounds.x), screenBounds.x + screenBounds.width),\n+\/\/                Math.min(Math.max(y, screenBounds.y), screenBounds.y + screenBounds.height));\n@@ -233,37 +266,37 @@\n-     * mouse button masks.\n-     * <p>\n-     * It is allowed to use only a combination of valid values as a {@code buttons} parameter.\n-     * A valid combination consists of {@code InputEvent.BUTTON1_DOWN_MASK},\n-     * {@code InputEvent.BUTTON2_DOWN_MASK}, {@code InputEvent.BUTTON3_DOWN_MASK}\n-     * and values returned by the\n-     * {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)} method.\n-     *\n-     * The valid combination also depends on a\n-     * {@link Toolkit#areExtraMouseButtonsEnabled() Toolkit.areExtraMouseButtonsEnabled()} value as follows:\n-     * <ul>\n-     * <li> If support for extended mouse buttons is\n-     * {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n-     * then it is allowed to use only the following standard button masks:\n-     * {@code InputEvent.BUTTON1_DOWN_MASK}, {@code InputEvent.BUTTON2_DOWN_MASK},\n-     * {@code InputEvent.BUTTON3_DOWN_MASK}.\n-     * <li> If support for extended mouse buttons is\n-     * {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n-     * then it is allowed to use the standard button masks\n-     * and masks for existing extended mouse buttons, if the mouse has more then three buttons.\n-     * In that way, it is allowed to use the button masks corresponding to the buttons\n-     * in the range from 1 to {@link java.awt.MouseInfo#getNumberOfButtons() MouseInfo.getNumberOfButtons()}.\n-     * <br>\n-     * It is recommended to use the {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)}\n-     * method to obtain the mask for any mouse button by its number.\n-     * <\/ul>\n-     * <p>\n-     * The following standard button masks are also accepted:\n-     * <ul>\n-     * <li>{@code InputEvent.BUTTON1_MASK}\n-     * <li>{@code InputEvent.BUTTON2_MASK}\n-     * <li>{@code InputEvent.BUTTON3_MASK}\n-     * <\/ul>\n-     * However, it is recommended to use {@code InputEvent.BUTTON1_DOWN_MASK},\n-     * {@code InputEvent.BUTTON2_DOWN_MASK},  {@code InputEvent.BUTTON3_DOWN_MASK} instead.\n-     * Either extended {@code _DOWN_MASK} or old {@code _MASK} values\n-     * should be used, but both those models should not be mixed.\n+     *                mouse button masks.\n+     *                <p>\n+     *                It is allowed to use only a combination of valid values as a {@code buttons} parameter.\n+     *                A valid combination consists of {@code InputEvent.BUTTON1_DOWN_MASK},\n+     *                {@code InputEvent.BUTTON2_DOWN_MASK}, {@code InputEvent.BUTTON3_DOWN_MASK}\n+     *                and values returned by the\n+     *                {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)} method.\n+     *                <p>\n+     *                The valid combination also depends on a\n+     *                {@link Toolkit#areExtraMouseButtonsEnabled() Toolkit.areExtraMouseButtonsEnabled()} value as follows:\n+     *                <ul>\n+     *                <li> If support for extended mouse buttons is\n+     *                {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n+     *                then it is allowed to use only the following standard button masks:\n+     *                {@code InputEvent.BUTTON1_DOWN_MASK}, {@code InputEvent.BUTTON2_DOWN_MASK},\n+     *                {@code InputEvent.BUTTON3_DOWN_MASK}.\n+     *                <li> If support for extended mouse buttons is\n+     *                {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n+     *                then it is allowed to use the standard button masks\n+     *                and masks for existing extended mouse buttons, if the mouse has more then three buttons.\n+     *                In that way, it is allowed to use the button masks corresponding to the buttons\n+     *                in the range from 1 to {@link java.awt.MouseInfo#getNumberOfButtons() MouseInfo.getNumberOfButtons()}.\n+     *                <br>\n+     *                It is recommended to use the {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)}\n+     *                method to obtain the mask for any mouse button by its number.\n+     *                <\/ul>\n+     *                <p>\n+     *                The following standard button masks are also accepted:\n+     *                <ul>\n+     *                <li>{@code InputEvent.BUTTON1_MASK}\n+     *                <li>{@code InputEvent.BUTTON2_MASK}\n+     *                <li>{@code InputEvent.BUTTON3_MASK}\n+     *                <\/ul>\n+     *                However, it is recommended to use {@code InputEvent.BUTTON1_DOWN_MASK},\n+     *                {@code InputEvent.BUTTON2_DOWN_MASK},  {@code InputEvent.BUTTON3_DOWN_MASK} instead.\n+     *                Either extended {@code _DOWN_MASK} or old {@code _MASK} values\n+     *                should be used, but both those models should not be mixed.\n@@ -271,1 +304,1 @@\n-     *         and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n+     *                                  and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n@@ -273,1 +306,1 @@\n-     *         that does not exist on the mouse and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n+     *                                  that does not exist on the mouse and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n@@ -290,37 +323,37 @@\n-     * mouse button masks.\n-     * <p>\n-     * It is allowed to use only a combination of valid values as a {@code buttons} parameter.\n-     * A valid combination consists of {@code InputEvent.BUTTON1_DOWN_MASK},\n-     * {@code InputEvent.BUTTON2_DOWN_MASK}, {@code InputEvent.BUTTON3_DOWN_MASK}\n-     * and values returned by the\n-     * {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)} method.\n-     *\n-     * The valid combination also depends on a\n-     * {@link Toolkit#areExtraMouseButtonsEnabled() Toolkit.areExtraMouseButtonsEnabled()} value as follows:\n-     * <ul>\n-     * <li> If the support for extended mouse buttons is\n-     * {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n-     * then it is allowed to use only the following standard button masks:\n-     * {@code InputEvent.BUTTON1_DOWN_MASK}, {@code InputEvent.BUTTON2_DOWN_MASK},\n-     * {@code InputEvent.BUTTON3_DOWN_MASK}.\n-     * <li> If the support for extended mouse buttons is\n-     * {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n-     * then it is allowed to use the standard button masks\n-     * and masks for existing extended mouse buttons, if the mouse has more then three buttons.\n-     * In that way, it is allowed to use the button masks corresponding to the buttons\n-     * in the range from 1 to {@link java.awt.MouseInfo#getNumberOfButtons() MouseInfo.getNumberOfButtons()}.\n-     * <br>\n-     * It is recommended to use the {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)}\n-     * method to obtain the mask for any mouse button by its number.\n-     * <\/ul>\n-     * <p>\n-     * The following standard button masks are also accepted:\n-     * <ul>\n-     * <li>{@code InputEvent.BUTTON1_MASK}\n-     * <li>{@code InputEvent.BUTTON2_MASK}\n-     * <li>{@code InputEvent.BUTTON3_MASK}\n-     * <\/ul>\n-     * However, it is recommended to use {@code InputEvent.BUTTON1_DOWN_MASK},\n-     * {@code InputEvent.BUTTON2_DOWN_MASK},  {@code InputEvent.BUTTON3_DOWN_MASK} instead.\n-     * Either extended {@code _DOWN_MASK} or old {@code _MASK} values\n-     * should be used, but both those models should not be mixed.\n+     *                mouse button masks.\n+     *                <p>\n+     *                It is allowed to use only a combination of valid values as a {@code buttons} parameter.\n+     *                A valid combination consists of {@code InputEvent.BUTTON1_DOWN_MASK},\n+     *                {@code InputEvent.BUTTON2_DOWN_MASK}, {@code InputEvent.BUTTON3_DOWN_MASK}\n+     *                and values returned by the\n+     *                {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)} method.\n+     *                <p>\n+     *                The valid combination also depends on a\n+     *                {@link Toolkit#areExtraMouseButtonsEnabled() Toolkit.areExtraMouseButtonsEnabled()} value as follows:\n+     *                <ul>\n+     *                <li> If the support for extended mouse buttons is\n+     *                {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n+     *                then it is allowed to use only the following standard button masks:\n+     *                {@code InputEvent.BUTTON1_DOWN_MASK}, {@code InputEvent.BUTTON2_DOWN_MASK},\n+     *                {@code InputEvent.BUTTON3_DOWN_MASK}.\n+     *                <li> If the support for extended mouse buttons is\n+     *                {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n+     *                then it is allowed to use the standard button masks\n+     *                and masks for existing extended mouse buttons, if the mouse has more then three buttons.\n+     *                In that way, it is allowed to use the button masks corresponding to the buttons\n+     *                in the range from 1 to {@link java.awt.MouseInfo#getNumberOfButtons() MouseInfo.getNumberOfButtons()}.\n+     *                <br>\n+     *                It is recommended to use the {@link InputEvent#getMaskForButton(int) InputEvent.getMaskForButton(button)}\n+     *                method to obtain the mask for any mouse button by its number.\n+     *                <\/ul>\n+     *                <p>\n+     *                The following standard button masks are also accepted:\n+     *                <ul>\n+     *                <li>{@code InputEvent.BUTTON1_MASK}\n+     *                <li>{@code InputEvent.BUTTON2_MASK}\n+     *                <li>{@code InputEvent.BUTTON3_MASK}\n+     *                <\/ul>\n+     *                However, it is recommended to use {@code InputEvent.BUTTON1_DOWN_MASK},\n+     *                {@code InputEvent.BUTTON2_DOWN_MASK},  {@code InputEvent.BUTTON3_DOWN_MASK} instead.\n+     *                Either extended {@code _DOWN_MASK} or old {@code _MASK} values\n+     *                should be used, but both those models should not be mixed.\n@@ -328,1 +361,1 @@\n-     *         and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n+     *                                  and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() disabled} by Java\n@@ -330,1 +363,1 @@\n-     *         that does not exist on the mouse and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n+     *                                  that does not exist on the mouse and support for extended mouse buttons is {@link Toolkit#areExtraMouseButtonsEnabled() enabled} by Java\n@@ -344,1 +377,1 @@\n-        if ( (buttons|LEGAL_BUTTON_MASK) != LEGAL_BUTTON_MASK ) {\n+        if ((buttons | LEGAL_BUTTON_MASK) != LEGAL_BUTTON_MASK) {\n@@ -352,4 +385,3 @@\n-     * @param wheelAmt  number of \"notches\" to move the mouse wheel\n-     *                  Negative values indicate movement up\/away from the user,\n-     *                  positive values indicate movement down\/towards the user.\n-     *\n+     * @param wheelAmt number of \"notches\" to move the mouse wheel\n+     *                 Negative values indicate movement up\/away from the user,\n+     *                 positive values indicate movement down\/towards the user.\n@@ -371,5 +403,5 @@\n-     * @param   keycode Key to press (e.g. {@code KeyEvent.VK_A})\n-     * @throws  IllegalArgumentException if {@code keycode} is not\n-     *          a valid key\n-     * @see     #keyRelease(int)\n-     * @see     java.awt.event.KeyEvent\n+     * @param keycode Key to press (e.g. {@code KeyEvent.VK_A})\n+     * @throws IllegalArgumentException if {@code keycode} is not\n+     *                                  a valid key\n+     * @see #keyRelease(int)\n+     * @see java.awt.event.KeyEvent\n@@ -390,5 +422,5 @@\n-     * @param   keycode Key to release (e.g. {@code KeyEvent.VK_A})\n-     * @throws  IllegalArgumentException if {@code keycode} is not a\n-     *          valid key\n-     * @see  #keyPress(int)\n-     * @see     java.awt.event.KeyEvent\n+     * @param keycode Key to release (e.g. {@code KeyEvent.VK_A})\n+     * @throws IllegalArgumentException if {@code keycode} is not a\n+     *                                  valid key\n+     * @see #keyPress(int)\n+     * @see java.awt.event.KeyEvent\n@@ -420,0 +452,6 @@\n+     *\n+     * @param x X position of pixel\n+     * @param y Y position of pixel\n+     * @return Color of the pixel\n+     * @throws SecurityException if access to the screen is denied\n+     *                           by the desktop environment\n@@ -424,6 +462,0 @@\n-     *\n-     * @param   x       X position of pixel\n-     * @param   y       Y position of pixel\n-     * @throws  SecurityException if access to the screen is denied\n-     *          by the desktop environment\n-     * @return  Color of the pixel\n@@ -433,1 +465,1 @@\n-                                                    : toDeviceSpace(x, y);\n+                : toDeviceSpace(x, y);\n@@ -445,0 +477,7 @@\n+     *\n+     * @param screenRect Rect to capture in screen coordinates\n+     * @return The captured image\n+     * @throws IllegalArgumentException if {@code screenRect} width and height\n+     *                                  are not greater than zero\n+     * @throws SecurityException        if access to the screen is denied\n+     *                                  by the desktop environment\n@@ -449,7 +488,0 @@\n-     *\n-     * @param   screenRect      Rect to capture in screen coordinates\n-     * @return  The captured image\n-     * @throws  IllegalArgumentException if {@code screenRect} width and height\n-     *          are not greater than zero\n-     * @throws  SecurityException if access to the screen is denied\n-     *          by the desktop environment\n@@ -493,6 +525,0 @@\n-     * @param   screenRect     Rect to capture in screen coordinates\n-     * @return  The captured image\n-     * @throws  IllegalArgumentException if {@code screenRect} width and height\n-     *          are not greater than zero\n-     * @throws  SecurityException if access to the screen is denied\n-     *          by the desktop environment\n@@ -500,0 +526,6 @@\n+     * @param screenRect Rect to capture in screen coordinates\n+     * @return The captured image\n+     * @throws IllegalArgumentException if {@code screenRect} width and height\n+     *                                  are not greater than zero\n+     * @throws SecurityException        if access to the screen is denied\n+     *                                  by the desktop environment\n@@ -503,1 +535,1 @@\n-            createMultiResolutionScreenCapture(Rectangle screenRect) {\n+    createMultiResolutionScreenCapture(Rectangle screenRect) {\n@@ -510,1 +542,1 @@\n-            createCompatibleImage(Rectangle screenRect, boolean isHiDPI) {\n+    createCompatibleImage(Rectangle screenRect, boolean isHiDPI) {\n@@ -607,1 +639,1 @@\n-            if(!isHiDPI) {\n+            if (!isHiDPI) {\n@@ -638,0 +670,1 @@\n+     *\n@@ -647,1 +680,2 @@\n-     * @param   isOn    Whether {@code waitForIdle} is automatically invoked\n+     *\n+     * @param isOn Whether {@code waitForIdle} is automatically invoked\n@@ -674,1 +708,1 @@\n-     * @param  ms the delay duration in milliseconds\n+     * @param ms the delay duration in milliseconds\n@@ -676,1 +710,1 @@\n-     *         is not between 0 and 60,000 milliseconds inclusive\n+     *                                  is not between 0 and 60,000 milliseconds inclusive\n@@ -698,1 +732,1 @@\n-     * @param  ms time to sleep in milliseconds\n+     * @param ms time to sleep in milliseconds\n@@ -700,1 +734,1 @@\n-     *         and {@code 60,000} milliseconds inclusive\n+     *                                  and {@code 60,000} milliseconds inclusive\n@@ -722,1 +756,2 @@\n-     * @throws  IllegalThreadStateException if called on the AWT event dispatching thread\n+     *\n+     * @throws IllegalThreadStateException if called on the AWT event dispatching thread\n@@ -739,1 +774,1 @@\n-     * @return  the string representation.\n+     * @return the string representation.\n@@ -743,1 +778,1 @@\n-        String params = \"autoDelay = \"+getAutoDelay()+\", \"+\"autoWaitForIdle = \"+isAutoWaitForIdle();\n+        String params = \"autoDelay = \" + getAutoDelay() + \", \" + \"autoWaitForIdle = \" + isAutoWaitForIdle();\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/Robot.java","additions":194,"deletions":159,"binary":false,"changes":353,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+    private static final Point STARTING_LOC = new Point(200, 200);\n@@ -41,1 +42,1 @@\n-        robot.mouseMove(200, 200);\n+        robot.mouseMove(STARTING_LOC.x, STARTING_LOC.y);\n","filename":"test\/jdk\/java\/awt\/Robot\/MouseMoveOffScreen.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}