{"files":[{"patch":"@@ -263,9 +263,2 @@\n-  if (PreserveFramePointer) {\n-    if (nof_caller_save_cpu_regs() >= 26 R18_RESERVED_ONLY(-1)) {\n-      _caller_save_cpu_regs[25 R18_RESERVED_ONLY(-1)] = r27_opr;\n-    }\n-  } else {\n-    _caller_save_cpu_regs[25 R18_RESERVED_ONLY(-1)] = r29_opr;\n-    if (nof_caller_save_cpu_regs() >= 27 R18_RESERVED_ONLY(-1)) {\n-      _caller_save_cpu_regs[26 R18_RESERVED_ONLY(-1)] = r27_opr;\n-    }\n+  if (nof_caller_save_cpu_regs() > 25 R18_RESERVED_ONLY(-1)) {\n+    _caller_save_cpu_regs[25 R18_RESERVED_ONLY(-1)] = r27_opr;\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_FrameMap_aarch64.cpp","additions":2,"deletions":9,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -143,1 +143,1 @@\n-  static int adjust_reg_range(int range) {\n+  static int adjust_reg_range(int range, bool exclude_fp = true) {\n@@ -150,2 +150,3 @@\n-    \/\/ r29 is not allocatable when PreserveFramePointer is on\n-    if (PreserveFramePointer) {\n+    \/\/ r29 is not allocatable when PreserveFramePointer is on,\n+    \/\/ but fp saving is handled in MacroAssembler::build_frame()\/remove_frame()\n+    if (exclude_fp) {\n@@ -161,3 +162,3 @@\n-  static int nof_caller_save_cpu_regs() { return adjust_reg_range(pd_nof_caller_save_cpu_regs_frame_map); }\n-  static int last_cpu_reg()             { return adjust_reg_range(pd_last_cpu_reg);  }\n-  static int last_byte_reg()            { return adjust_reg_range(pd_last_byte_reg); }\n+  static int nof_caller_save_cpu_regs() { return adjust_reg_range(pd_nof_caller_save_cpu_regs_frame_map);  }\n+  static int last_cpu_reg()             { return adjust_reg_range(pd_last_cpu_reg, PreserveFramePointer);  }\n+  static int last_byte_reg()            { return adjust_reg_range(pd_last_byte_reg, PreserveFramePointer); }\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_FrameMap_aarch64.hpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"}]}