{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,0 +42,1 @@\n+import static sun.nio.ch.NioSocketImpl.MAX_ADAPTOR_BUFFER_SIZE;\n@@ -83,0 +84,3 @@\n+        if (bb.remaining() > MAX_ADAPTOR_BUFFER_SIZE) {\n+            bb = bb.slice(bb.position(), MAX_ADAPTOR_BUFFER_SIZE);\n+        }\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/ChannelInputStream.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,0 +35,1 @@\n+import static sun.nio.ch.NioSocketImpl.MAX_ADAPTOR_BUFFER_SIZE;\n@@ -68,1 +69,3 @@\n-            int n = ch.write(bb);\n+            ByteBuffer writeBuf = bb.remaining() <= MAX_ADAPTOR_BUFFER_SIZE\n+                ? bb : bb.slice(bb.position(), MAX_ADAPTOR_BUFFER_SIZE);\n+            int n = ch.write(writeBuf);\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/ChannelOutputStream.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -83,1 +83,1 @@\n-    private static final int MAX_BUFFER_SIZE = 128 * 1024;\n+    static final int MAX_ADAPTOR_BUFFER_SIZE = 128 * 1024;\n@@ -358,2 +358,2 @@\n-                \/\/ read up to MAX_BUFFER_SIZE bytes\n-                int size = Math.min(len, MAX_BUFFER_SIZE);\n+                \/\/ read up to MAX_ADAPTOR_BUFFER_SIZE bytes\n+                int size = Math.min(len, MAX_ADAPTOR_BUFFER_SIZE);\n@@ -456,2 +456,2 @@\n-                    \/\/ write up to MAX_BUFFER_SIZE bytes\n-                    int size = Math.min((end - pos), MAX_BUFFER_SIZE);\n+                    \/\/ write up to MAX_ADAPTOR_BUFFER_SIZE bytes\n+                    int size = Math.min((end - pos), MAX_ADAPTOR_BUFFER_SIZE);\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/NioSocketImpl.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+import static sun.nio.ch.NioSocketImpl.MAX_ADAPTOR_BUFFER_SIZE;\n@@ -1376,0 +1377,1 @@\n+        len = Math.min(len, MAX_ADAPTOR_BUFFER_SIZE);\n@@ -1472,1 +1474,1 @@\n-                    int size = end - pos;\n+                    int size = Math.min(end - pos, MAX_ADAPTOR_BUFFER_SIZE);\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/SocketChannelImpl.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -26,1 +26,0 @@\n- * @run testng SocketChannelStreams\n@@ -29,0 +28,3 @@\n+ * @library \/test\/lib\n+ * @build jdk.test.lib.RandomFactory\n+ * @run testng SocketChannelStreams\n@@ -42,0 +44,1 @@\n+import java.util.Arrays;\n@@ -43,0 +46,1 @@\n+import java.util.Random;\n@@ -49,0 +53,2 @@\n+import jdk.test.lib.RandomFactory;\n+\n@@ -54,0 +60,1 @@\n+    private static Random RND = RandomFactory.getRandom();\n@@ -66,0 +73,17 @@\n+    \/**\n+     * Test writing and reading an array of bytes.\n+     *\/\n+    public void testWriteRead() throws Exception {\n+        final int size = 512*1024;\n+        byte[] b = new byte[size];\n+        int off = RND.nextInt(1024);\n+        int len = RND.nextInt(size - off);\n+        RND.nextBytes(b);\n+        withConnection((sc, peer) -> {\n+            Channels.newOutputStream(peer).write(b, off, len);\n+            byte[] data = new byte[len];\n+            int n = Channels.newInputStream(sc).read(data, 0, len);\n+            assertTrue(Arrays.equals(data, 0, n, b, off, off + n));\n+        });\n+    }\n+\n","filename":"test\/jdk\/java\/nio\/channels\/Channels\/SocketChannelStreams.java","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"}]}