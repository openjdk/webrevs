{"files":[{"patch":"@@ -39,0 +39,1 @@\n+import java.nio.channels.ByteChannel;\n@@ -41,1 +42,0 @@\n-import java.nio.channels.ReadableByteChannel;\n@@ -44,1 +44,0 @@\n-import java.nio.channels.WritableByteChannel;\n@@ -392,1 +391,1 @@\n-        InputStream in = Channels.newInputStream(new ThrowingReadableChannel());\n+        InputStream in = Channels.newInputStream(new TestChannel());\n@@ -402,1 +401,1 @@\n-        OutputStream out = Channels.newOutputStream(new ThrowingWritableChannel());\n+        OutputStream out = Channels.newOutputStream(new TestChannel());\n@@ -507,2 +506,2 @@\n-     * ReadableByteChannel that throws if more than 128k bytes remain\n-     * in the supplied buffer.\n+     * ByteChannel that throws if more than 128k bytes remain\n+     * in the buffer supplied for reading or writing.\n@@ -510,9 +509,8 @@\n-    private class ThrowingReadableChannel implements ReadableByteChannel {\n-        private boolean closed = false;\n-\n-        public ThrowingReadableChannel() {}\n-\n-        public int read(ByteBuffer dst) throws IOException {\n-            int rem = dst.remaining();\n-            if (rem > MAX_BUFFER_SIZE)\n-                throw new IOException(\"Too many remaining bytes \" + rem);\n+    private static class TestChannel implements ByteChannel {\n+        @Override\n+        public int read(ByteBuffer bb) throws IOException {\n+            int rem = bb.remaining();\n+            if (rem > MAX_BUFFER_SIZE) {\n+                throw new IOException(\"too big\");\n+            }\n+            bb.position(bb.limit());\n@@ -522,22 +520,7 @@\n-        public void close() throws IOException {\n-            closed = true;\n-        }\n-\n-        public boolean isOpen() {\n-            return !closed;\n-        }\n-    }\n-\n-    \/**\n-     * WritableByteChannel that throws if more than 128k bytes remain\n-     * in the supplied buffer.\n-     *\/\n-    private class ThrowingWritableChannel implements WritableByteChannel {\n-        private boolean closed = false;\n-\n-        public ThrowingWritableChannel() {}\n-\n-        public int write(ByteBuffer src) throws IOException {\n-            int rem = src.remaining();\n-            if (rem > MAX_BUFFER_SIZE)\n-                throw new IOException(\"Too many remaining bytes \" + rem);\n+        @Override\n+        public int write(ByteBuffer bb) throws IOException {\n+            int rem = bb.remaining();\n+            if (rem > MAX_BUFFER_SIZE) {\n+                throw new IOException(\"too big\");\n+            }\n+            bb.position(bb.limit());\n@@ -547,2 +530,3 @@\n-        public void close() throws IOException {\n-            closed = true;\n+        @Override\n+        public boolean isOpen() {\n+            return true;\n@@ -551,2 +535,3 @@\n-        public boolean isOpen() {\n-            return !closed;\n+        @Override\n+        public void close() {\n+            throw new UnsupportedOperationException();\n@@ -554,1 +539,2 @@\n-    }}\n+    }\n+}\n","filename":"test\/jdk\/java\/nio\/channels\/Channels\/SocketChannelStreams.java","additions":28,"deletions":42,"binary":false,"changes":70,"status":"modified"}]}