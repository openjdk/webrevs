{"files":[{"patch":"@@ -76,0 +76,1 @@\n+            bb.position(pos);\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/ChannelOutputStream.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import java.nio.ByteBuffer;\n@@ -40,0 +41,1 @@\n+import java.nio.channels.ReadableByteChannel;\n@@ -42,0 +44,1 @@\n+import java.nio.channels.WritableByteChannel;\n@@ -54,0 +57,3 @@\n+    \/\/ Maximum size of internal temporary buffer\n+    private static final int MAX_BUFFER_SIZE = 128*1024;\n+\n@@ -382,0 +388,19 @@\n+    \/**\n+     * Test that internal buffers have at most MAX_BUFFER_SIZE bytes remaining.\n+     *\/\n+    public void testReadLimit() throws IOException {\n+        InputStream in = Channels.newInputStream(new ThrowingReadableChannel());\n+        byte[] b = new byte[3*MAX_BUFFER_SIZE];\n+        int n = in.read(b, 0, b.length);\n+        assertEquals(n, MAX_BUFFER_SIZE);\n+    }\n+\n+    \/**\n+     * Test that internal buffers have at most MAX_BUFFER_SIZE bytes remaining.\n+     *\/\n+    public void testWriteLimit() throws IOException {\n+        OutputStream out = Channels.newOutputStream(new ThrowingWritableChannel());\n+        byte[] b = new byte[3*MAX_BUFFER_SIZE];\n+        out.write(b, 0, b.length);\n+    }\n+\n@@ -480,1 +505,50 @@\n-}\n+\n+    \/**\n+     * ReadableByteChannel that throws if more than 128k bytes remain\n+     * in the supplied buffer.\n+     *\/\n+    private class ThrowingReadableChannel implements ReadableByteChannel {\n+        private boolean closed = false;\n+\n+        public ThrowingReadableChannel() {}\n+\n+        public int read(ByteBuffer dst) throws IOException {\n+            int rem = dst.remaining();\n+            if (rem > MAX_BUFFER_SIZE)\n+                throw new IOException(\"Too many remaining bytes \" + rem);\n+            return rem;\n+        }\n+\n+        public void close() throws IOException {\n+            closed = true;\n+        }\n+\n+        public boolean isOpen() {\n+            return !closed;\n+        }\n+    }\n+\n+    \/**\n+     * WritableByteChannel that throws if more than 128k bytes remain\n+     * in the supplied buffer.\n+     *\/\n+    private class ThrowingWritableChannel implements WritableByteChannel {\n+        private boolean closed = false;\n+\n+        public ThrowingWritableChannel() {}\n+\n+        public int write(ByteBuffer src) throws IOException {\n+            int rem = src.remaining();\n+            if (rem > MAX_BUFFER_SIZE)\n+                throw new IOException(\"Too many remaining bytes \" + rem);\n+            return rem;\n+        }\n+\n+        public void close() throws IOException {\n+            closed = true;\n+        }\n+\n+        public boolean isOpen() {\n+            return !closed;\n+        }\n+    }}\n","filename":"test\/jdk\/java\/nio\/channels\/Channels\/SocketChannelStreams.java","additions":75,"deletions":1,"binary":false,"changes":76,"status":"modified"}]}