{"files":[{"patch":"@@ -33,5 +33,0 @@\n-import java.awt.Component;\n-import java.awt.event.ActionEvent;\n-import java.awt.event.InputEvent;\n-import java.awt.event.MouseAdapter;\n-import java.awt.event.MouseEvent;\n@@ -43,1 +38,0 @@\n-import javax.swing.JButton;\n@@ -53,0 +47,1 @@\n+    static Container pane;\n@@ -55,23 +50,1 @@\n-\n-    public static class MyThread implements Runnable {\n-        static Container box;\n-        static Component invo;\n-\n-        public MyThread(Container cont, Component comp) {\n-            this.invo = comp;\n-            this.box = cont;\n-        }\n-\n-        public void run() {\n-            System.out.println(\"Starting 3 second countdown...\");\n-            try{\n-                Thread.currentThread().sleep(3000);\n-            } catch (Exception e) {}\n-            System.out.println(\"Removing popup invoker from the container.\");\n-            box.remove(invo);\n-            box.repaint();\n-            if (jpm.isVisible()) {\n-                throw new RuntimeException(\"poup is visible after component is removed\");\n-            }\n-        }\n-    }\n+    static volatile boolean isVisible;\n@@ -81,1 +54,1 @@\n-        final Container pane = frame.getContentPane();\n+        pane = frame.getContentPane();\n@@ -83,17 +56,1 @@\n-        label = new JLabel(\"Click here to invoke popup\");\n-        label.addMouseListener(new MouseAdapter() {\n-            public void mouseReleased(MouseEvent e) {\n-                if (jpm == null) {\n-                    jpm = new JPopupMenu(\"Popup\");\n-                    jpm.add(\"One\");\n-                    jpm.add(\"Two\");\n-                    jpm.add(\"Three\");\n-                }\n-                jpm.show(label, 0, 0);\n-            }\n-\n-            public void mousePressed(MouseEvent e) {\n-                Thread thr = new Thread(new MyThread(pane, label));\n-                thr.start();\n-            }\n-        });\n+        label = new JLabel(\"Popup Invoker\");\n@@ -113,0 +70,5 @@\n+                jpm = new JPopupMenu(\"Popup\");\n+                jpm.add(\"One\");\n+                jpm.add(\"Two\");\n+                jpm.add(\"Three\");\n+                jpm.show(label, 0, 0);\n@@ -116,3 +78,0 @@\n-            robot.mouseMove(pt.x + size.width \/ 2, pt.y + size.height \/ 2);\n-            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n-            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n@@ -120,1 +79,9 @@\n-            robot.delay(1000);\n+            robot.delay(2000);\n+            SwingUtilities.invokeAndWait(() -> {\n+                pane.remove(label);\n+                pane.repaint();\n+                isVisible = jpm.isVisible();\n+            });\n+            if (isVisible) {\n+                throw new RuntimeException(\"poup is visible after component is removed\");\n+            }\n","filename":"test\/jdk\/javax\/swing\/JPopupMenu\/TestPopupInvoker.java","additions":18,"deletions":51,"binary":false,"changes":69,"status":"modified"}]}