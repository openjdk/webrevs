{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -123,3 +123,3 @@\n-            if (next instanceof ClassMethodTransform cmt)\n-                return new ClassMethodTransform(transform.andThen(cmt.transform),\n-                                                mm -> filter.test(mm) && cmt.filter.test(mm));\n+            if (next instanceof ClassMethodTransform(var nextTransform, var nextFilter))\n+                return new ClassMethodTransform(transform.andThen(nextTransform),\n+                                                mm -> filter.test(mm) || nextFilter.test(mm));\n@@ -146,3 +146,3 @@\n-            if (next instanceof ClassFieldTransform cft)\n-                return new ClassFieldTransform(transform.andThen(cft.transform),\n-                                               mm -> filter.test(mm) && cft.filter.test(mm));\n+            if (next instanceof ClassFieldTransform(var nextTransform, var nextFilter))\n+                return new ClassFieldTransform(transform.andThen(nextTransform),\n+                                               mm -> filter.test(mm) || nextFilter.test(mm));\n@@ -211,2 +211,2 @@\n-            return (next instanceof TransformImpl.MethodCodeTransform mct)\n-                   ? new TransformImpl.MethodCodeTransform(xform.andThen(mct.xform))\n+            return (next instanceof MethodCodeTransform(var nextXform))\n+                   ? new TransformImpl.MethodCodeTransform(xform.andThen(nextXform))\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/TransformImpl.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8335935 8336588\n+ * @bug 8335935 8336588 8372047\n@@ -57,0 +57,1 @@\n+import java.util.concurrent.atomic.AtomicBoolean;\n@@ -59,0 +60,1 @@\n+import jdk.internal.classfile.impl.TransformImpl;\n@@ -337,0 +339,30 @@\n+\n+    @Test\n+    void testFilteringTransformChaining() {\n+        var cf = ClassFile.of();\n+        var clazz = cf.parse(cf.build(ClassDesc.of(\"Test\"), clb -> clb\n+                .withField(\"one\", CD_int, _ -> {})\n+                .withField(\"two\", CD_int, _ -> {})\n+                .withMethodBody(\"one\", MTD_void, 0, CodeBuilder::return_)\n+                .withMethodBody(\"two\", MTD_void, 0, CodeBuilder::return_)));\n+\n+        AtomicBoolean oneFieldCalled = new AtomicBoolean(false);\n+        var oneFieldTransform = new TransformImpl.ClassFieldTransform(FieldTransform.endHandler(_ -> oneFieldCalled.set(true)),\n+                fm -> fm.fieldName().equalsString(\"one\"));\n+        AtomicBoolean twoFieldCalled = new AtomicBoolean(false);\n+        var twoFieldTransform = new TransformImpl.ClassFieldTransform(FieldTransform.endHandler(_ -> twoFieldCalled.set(true)),\n+                fm -> fm.fieldName().equalsString(\"two\"));\n+        cf.transformClass(clazz, oneFieldTransform.andThen(twoFieldTransform));\n+        assertTrue(oneFieldCalled.get(), \"Field one not transformed\");\n+        assertTrue(twoFieldCalled.get(), \"Field two not transformed\");\n+\n+        AtomicBoolean oneMethodCalled = new AtomicBoolean(false);\n+        var oneMethodTransform = ClassTransform.transformingMethods(mm -> mm.methodName().equalsString(\"one\"),\n+                MethodTransform.endHandler(_ -> oneMethodCalled.set(true)));\n+        AtomicBoolean twoMethodCalled = new AtomicBoolean(false);\n+        var twoMethodTransform = ClassTransform.transformingMethods(mm -> mm.methodName().equalsString(\"two\"),\n+                MethodTransform.endHandler(_ -> twoMethodCalled.set(true)));\n+        cf.transformClass(clazz, oneMethodTransform.andThen(twoMethodTransform));\n+        assertTrue(oneMethodCalled.get(), \"Method one not transformed\");\n+        assertTrue(twoMethodCalled.get(), \"Method two not transformed\");\n+    }\n","filename":"test\/jdk\/jdk\/classfile\/TransformTests.java","additions":34,"deletions":2,"binary":false,"changes":36,"status":"modified"}]}