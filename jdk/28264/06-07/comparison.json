{"files":[{"patch":"@@ -27,1 +27,0 @@\n-#include \"utilities\/spinYield.hpp\"\n@@ -29,1 +28,1 @@\n-void SpinCriticalSectionHelper::spin_acquire(volatile int* adr) {\n+void SpinCriticalSection::spin_acquire(volatile int* adr) {\n@@ -34,2 +33,0 @@\n-  SpinYield sy(4096, 5, 1000000);\n-\n@@ -37,0 +34,2 @@\n+  int ctr = 0;\n+  int Yields = 0;\n@@ -39,1 +38,13 @@\n-      sy.wait();\n+      ++ctr;\n+      if ((ctr & 0xFFF) == 0 || !os::is_MP()) {\n+        if (Yields > 5) {\n+          os::naked_short_sleep(1);\n+        }\n+        else {\n+          os::naked_yield();\n+          ++Yields;\n+        }\n+      }\n+      else {\n+        SpinPause();\n+      }\n@@ -45,1 +56,1 @@\n-void SpinCriticalSectionHelper::spin_release(volatile int* adr) {\n+void SpinCriticalSection::spin_release(volatile int* adr) {\n","filename":"src\/hotspot\/share\/utilities\/spinCriticalSection.cpp","additions":17,"deletions":6,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -30,10 +30,0 @@\n-class SpinCriticalSectionHelper : AllStatic {\n-  friend class SpinCriticalSection;\n-  template<class Lambda, class...Args>\n-  friend class SpinSingleSection;\n-  \/\/ Low-level leaf-lock primitives used to implement synchronization.\n-  \/\/ Not for general synchronization use.\n-  static void spin_acquire(volatile int* Lock);\n-  static void spin_release(volatile int* Lock);\n-};\n-\n@@ -43,1 +33,1 @@\n-\/\/ We use this critical section _only for low-contention code, and\n+\/\/ We use this critical section only for low-contention code, and\n@@ -48,0 +38,2 @@\n+  \/\/ We use int type as 32-bit atomic operation is the most performant\n+  \/\/ compared to  smaller\/larger types.\n@@ -49,0 +41,5 @@\n+\n+  \/\/ Low-level leaf-lock primitives used to implement synchronization.\n+  \/\/ Not for general synchronization use.\n+  static void spin_acquire(volatile int* Lock);\n+  static void spin_release(volatile int* Lock);\n@@ -52,1 +49,1 @@\n-    SpinCriticalSectionHelper::spin_acquire(_lock);\n+    spin_acquire(_lock);\n@@ -55,1 +52,1 @@\n-    SpinCriticalSectionHelper::spin_release(_lock);\n+    spin_release(_lock);\n","filename":"src\/hotspot\/share\/utilities\/spinCriticalSection.hpp","additions":10,"deletions":13,"binary":false,"changes":23,"status":"modified"}]}