{"files":[{"patch":"@@ -205,1 +205,1 @@\n-    VMError::set_handshake_timed_out_thread(p2i(target));\n+    VMError::set_handshake_timed_out_thread(target);\n","filename":"src\/hotspot\/share\/runtime\/handshake.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -654,1 +654,1 @@\n-        VMError::set_safepoint_timed_out_thread(p2i(cur_thread));\n+        VMError::set_safepoint_timed_out_thread(cur_thread);\n","filename":"src\/hotspot\/share\/runtime\/safepoint.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -107,2 +107,2 @@\n-volatile intptr_t VMError::_handshake_timed_out_thread = p2i(nullptr);\n-volatile intptr_t VMError::_safepoint_timed_out_thread = p2i(nullptr);\n+Thread* VMError::_handshake_timed_out_thread = nullptr;\n+Thread* VMError::_safepoint_timed_out_thread = nullptr;\n@@ -824,4 +824,4 @@\n-        if (_handshake_timed_out_thread == p2i(_thread)) {\n-          st->print(\" (sent by handshake timeout handler\");\n-        } else if (_safepoint_timed_out_thread == p2i(_thread)) {\n-          st->print(\" (sent by safepoint timeout handler\");\n+        if (get_handshake_timed_out_thread() == _thread) {\n+          st->print(\" (sent by handshake timeout handler)\");\n+        } else if (get_safepoint_timed_out_thread() == _thread) {\n+          st->print(\" (sent by safepoint timeout handler)\");\n@@ -1341,2 +1341,3 @@\n-void VMError::set_handshake_timed_out_thread(intptr_t thread_addr) {\n-  _handshake_timed_out_thread = thread_addr;\n+void VMError::set_handshake_timed_out_thread(Thread* thread) {\n+  _handshake_timed_out_thread = thread;\n+  OrderAccess::fence();\n@@ -1345,2 +1346,11 @@\n-void VMError::set_safepoint_timed_out_thread(intptr_t thread_addr) {\n-  _safepoint_timed_out_thread = thread_addr;\n+void VMError::set_safepoint_timed_out_thread(Thread* thread) {\n+  _safepoint_timed_out_thread = thread;\n+  OrderAccess::fence();\n+}\n+\n+Thread* VMError::get_handshake_timed_out_thread() {\n+  return _handshake_timed_out_thread;\n+}\n+\n+Thread* VMError::get_safepoint_timed_out_thread() {\n+  return _safepoint_timed_out_thread;\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":20,"deletions":10,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -146,2 +146,2 @@\n-  static volatile intptr_t _handshake_timed_out_thread;\n-  static volatile intptr_t _safepoint_timed_out_thread;\n+  static Thread* _handshake_timed_out_thread;\n+  static Thread* _safepoint_timed_out_thread;\n@@ -226,2 +226,4 @@\n-  static void set_handshake_timed_out_thread(intptr_t thread_addr);\n-  static void set_safepoint_timed_out_thread(intptr_t thread_addr);\n+  static void set_handshake_timed_out_thread(Thread* thread);\n+  static void set_safepoint_timed_out_thread(Thread* thread);\n+  static Thread* get_handshake_timed_out_thread();\n+  static Thread* get_safepoint_timed_out_thread();\n","filename":"src\/hotspot\/share\/utilities\/vmError.hpp","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -91,1 +91,1 @@\n-                output.shouldContain(\"(sent by safepoint timeout handler\");\n+                output.shouldContain(\"(sent by safepoint timeout handler)\");\n","filename":"test\/hotspot\/jtreg\/runtime\/Safepoint\/TestAbortVMOnSafepointTimeout.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}