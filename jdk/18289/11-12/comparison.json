{"files":[{"patch":"@@ -84,11 +84,1 @@\n-      if (in.type == out.type) {\n-        if (out.type == StateType::Released) {\n-          return true;\n-        } else if (out.type == StateType::Committed) {\n-          return NativeCallStackStorage::StackIndex::equals(in.data.stack_idx, out.data.stack_idx);\n-        } else {\n-          return Metadata::equals(in.data, out.data);\n-        }\n-      } else {\n-        return false;\n-      }\n+      return in.type == out.type && Metadata::equals(in.data, out.data);\n@@ -183,1 +173,1 @@\n-        \/\/stA.out.merge(leqA_n->val().out);\n+        stA.out.merge(leqA_n->val().out);\n@@ -203,1 +193,1 @@\n-        stA.in = leqA_n->val().out; \/\/ .. and the region's prior state is the incoming state\n+        stA.in.merge(leqA_n->val().out); \/\/ .. and the region's prior state is the incoming state\n@@ -247,1 +237,1 @@\n-            \/\/stB.out.merge(head->val().out);\n+            stB.out.merge(head->val().out);\n","filename":"src\/hotspot\/share\/nmt\/vmatree.hpp","additions":4,"deletions":14,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -172,1 +172,2 @@\n-  {\n+  { \/\/ A committed region inside of\/replacing a reserved region\n+    \/\/ should inherit the reserved region\n@@ -187,0 +188,25 @@\n+  {\n+    Tree tree;\n+    VMATree::Metadata md{si1, mtTest };\n+    VMATree::Metadata md2{si2, mtNMT };\n+    VMATree::Metadata md3{si1, mtNone };\n+    tree.reserve_mapping(0, 50, md);\n+    tree.reserve_mapping(50, 50, md2);\n+    tree.commit_mapping(0, 100, md3);\n+    int found_nodes = 0;\n+    tree.visit(0, 99999, [&](Node* x) {\n+      EXPECT_TRUE(x->key() == 0 || x->key() == 100);\n+      if (x->key() == 0) {\n+        EXPECT_EQ(x->val().out.data.flag, mtTest);\n+      }\n+      if (x->key() == 50) {\n+        EXPECT_EQ(x->val().in.data.flag, mtTest);\n+        EXPECT_EQ(x->val().out.data.flag, mtNMT);\n+      }\n+      if (x->key() == 100) {\n+        EXPECT_EQ(x->val().in.data.flag, mtNMT);\n+      }\n+      found_nodes++;\n+    });\n+    EXPECT_EQ(3, found_nodes);\n+  }\n","filename":"test\/hotspot\/gtest\/nmt\/test_vmatree.cpp","additions":27,"deletions":1,"binary":false,"changes":28,"status":"modified"}]}