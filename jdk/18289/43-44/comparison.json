{"files":[{"patch":"@@ -147,1 +147,1 @@\n-                to_visit.push(head->left());\n+        to_visit.push(head->left());\n@@ -196,0 +196,5 @@\n+  \/\/ Sort them in address order, lowest first.\n+  to_be_deleted_inbetween_a_b.sort([](AddressState* a, AddressState* b) -> int {\n+    return -AddressComparator::cmp(a->address, b->address);\n+  });\n+\n@@ -197,1 +202,0 @@\n-  MEMFLAGS flag_in = LEQ_A.flag_out();\n@@ -201,0 +205,1 @@\n+    \/\/ Delete node in (A, B]\n@@ -202,1 +207,2 @@\n-    auto& rescom = diff.flag[NMTUtil::flag_to_index(flag_in)];\n+    \/\/ Perform summary accounting\n+    auto& rescom = diff.flag[NMTUtil::flag_to_index(delete_me.state.in.flag())];\n@@ -210,1 +216,0 @@\n-    flag_in = delete_me.flag_out();\n","filename":"src\/hotspot\/share\/nmt\/vmatree.cpp","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -73,0 +73,21 @@\n+\n+    \/\/ Reserving the exact same space again should result in still having only 2 nodes\n+    for (int i = 0; i < 100; i++) {\n+      tree.reserve_mapping(i * 100, 100, md);\n+    }\n+    found_nodes = 0;\n+    tree.visit(0, 999999, [&](Node* x) {\n+      found_nodes++;\n+    });\n+    EXPECT_EQ(2, found_nodes) << \"Adjacent reservations should result in exactly 2 nodes\";\n+\n+    \/\/ Do it backwards instead.\n+    Tree tree2;\n+    for (int i = 99; i >= 0; i--) {\n+      tree2.reserve_mapping(i * 100, 100, md);\n+    }\n+    found_nodes = 0;\n+    tree2.visit(0, 999999, [&](Node* x) {\n+      found_nodes++;\n+    });\n+    EXPECT_EQ(2, found_nodes) << \"Adjacent reservations should result in exactly 2 nodes\";\n@@ -268,1 +289,1 @@\n-    Tree::Metadata md(NCS::StackIndex(), mtTest);\n+  Tree::Metadata md(NCS::StackIndex(), mtTest);\n@@ -280,0 +301,11 @@\n+\n+  { \/\/ A commit with two previous commits inside of it should only register\n+    \/\/ the new memory in the commit diff.\n+    Tree tree;\n+    Tree::Metadata md(NCS::StackIndex(), mtTest);\n+    tree.commit_mapping(128, 128, md);\n+    tree.commit_mapping(512, 128, md);\n+    auto diff = tree.commit_mapping(0, 1024, md);\n+    EXPECT_EQ(768, diff.flag[NMTUtil::flag_to_index(mtTest)].commit);\n+    EXPECT_EQ(768, diff.flag[NMTUtil::flag_to_index(mtTest)].reserve);\n+  }\n","filename":"test\/hotspot\/gtest\/nmt\/test_vmatree.cpp","additions":33,"deletions":1,"binary":false,"changes":34,"status":"modified"}]}