{"files":[{"patch":"@@ -678,0 +678,7 @@\n+  \/\/ The JvmtiThreadState is incomplete if initialized in post_early_vm_start\n+  \/\/ before classes are initialized. It should be updated now.\n+  JavaThread *thread  = JavaThread::current();\n+  if (thread->jvmti_thread_state() != nullptr) {\n+    thread->jvmti_thread_state()->update_thread_oop_during_vm_start(thread);\n+  }\n+\n@@ -687,1 +694,0 @@\n-      JavaThread *thread  = JavaThread::current();\n","filename":"src\/hotspot\/share\/prims\/jvmtiExport.cpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1044,0 +1044,8 @@\n+void JvmtiThreadState::update_thread_oop_during_vm_start(JavaThread* thread) {\n+  assert(thread->threadObj() != nullptr, \"santity check\");\n+  if (thread->jvmti_thread_state()->get_thread_oop() == nullptr) {\n+    _thread_oop_h.release(JvmtiExport::jvmti_oop_storage());\n+    _thread_oop_h = OopHandle(JvmtiExport::jvmti_oop_storage(), thread->threadObj());\n+  }\n+}\n+\n","filename":"src\/hotspot\/share\/prims\/jvmtiThreadState.cpp","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -314,0 +314,1 @@\n+  void update_thread_oop_during_vm_start(JavaThread* thread);\n","filename":"src\/hotspot\/share\/prims\/jvmtiThreadState.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8172970\n+ * @bug 8172970 8362203\n@@ -32,0 +32,1 @@\n+ * @run main\/othervm\/native -agentlib:AllowedFunctions=with_early_vmstart  -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n AllowedFunctions\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/StartPhase\/AllowedFunctions\/AllowedFunctions.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}