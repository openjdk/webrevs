{"files":[{"patch":"@@ -2233,9 +2233,3 @@\n-  if (UseCompressedClassPointers) {\n-    st->print_cr(\"\\tldrw rscratch1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n-    st->print_cr(\"\\tldrw r10, [rscratch2 + CompiledICData::speculated_klass_offset()]\\t# compressed klass\");\n-    st->print_cr(\"\\tcmpw rscratch1, r10\");\n-  } else {\n-    st->print_cr(\"\\tldr rscratch1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n-    st->print_cr(\"\\tldr r10, [rscratch2 + CompiledICData::speculated_klass_offset()]\\t# compressed klass\");\n-    st->print_cr(\"\\tcmp rscratch1, r10\");\n-  }\n+  st->print_cr(\"\\tldrw rscratch1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n+  st->print_cr(\"\\tldrw r10, [rscratch2 + CompiledICData::speculated_klass_offset()]\\t# compressed klass\");\n+  st->print_cr(\"\\tcmpw rscratch1, r10\");\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -61,16 +61,0 @@\n-static void select_different_registers(Register preserve,\n-                                       Register extra,\n-                                       Register &tmp1,\n-                                       Register &tmp2) {\n-  if (tmp1 == preserve) {\n-    assert_different_registers(tmp1, tmp2, extra);\n-    tmp1 = extra;\n-  } else if (tmp2 == preserve) {\n-    assert_different_registers(tmp1, tmp2, extra);\n-    tmp2 = extra;\n-  }\n-  assert_different_registers(preserve, tmp1, tmp2);\n-}\n-\n-\n-\n@@ -1294,6 +1278,4 @@\n-  if (k->is_loaded() && !UseCompressedClassPointers) {\n-    select_different_registers(obj, dst, k_RInfo, klass_RInfo);\n-  } else {\n-    Rtmp1 = op->tmp3()->as_register();\n-    select_different_registers(obj, dst, k_RInfo, klass_RInfo, Rtmp1);\n-  }\n+\n+  Rtmp1 = op->tmp3()->as_register();\n+  select_different_registers(obj, dst, k_RInfo, klass_RInfo, Rtmp1);\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_LIRAssembler_aarch64.cpp","additions":4,"deletions":22,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -1290,3 +1290,1 @@\n-  if (!x->klass()->is_loaded() || UseCompressedClassPointers) {\n-    tmp3 = new_register(objectType);\n-  }\n+  tmp3 = new_register(objectType);\n@@ -1311,3 +1309,1 @@\n-  if (!x->klass()->is_loaded() || UseCompressedClassPointers) {\n-    tmp3 = new_register(objectType);\n-  }\n+  tmp3 = new_register(objectType);\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_LIRGenerator_aarch64.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -108,6 +108,2 @@\n-    if (UseCompressedClassPointers) { \/\/ Take care not to kill klass\n-      encode_klass_not_null(t1, klass);\n-      strw(t1, Address(obj, oopDesc::klass_offset_in_bytes()));\n-    } else {\n-      str(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n-    }\n+    encode_klass_not_null(t1, klass); \/\/ Take care not to kill klass\n+    strw(t1, Address(obj, oopDesc::klass_offset_in_bytes()));\n@@ -124,1 +120,1 @@\n-  } else if (UseCompressedClassPointers && !UseCompactObjectHeaders) {\n+  } else if (!UseCompactObjectHeaders) {\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_MacroAssembler_aarch64.cpp","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -768,1 +768,1 @@\n-  \/\/ if ((UseCompressedOops || UseCompressedClassPointers) && !TraceBytecodes) verify_heapbase(\"call_VM_base: heap base corrupted?\");\n+  \/\/ if (!TraceBytecodes) verify_heapbase(\"call_VM_base: heap base corrupted?\");\n@@ -1008,1 +1008,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -1012,4 +1012,0 @@\n-  } else {\n-    ldr(tmp1, Address(receiver, oopDesc::klass_offset_in_bytes()));\n-    ldr(tmp2, Address(data, CompiledICData::speculated_klass_offset()));\n-    cmp(tmp1, tmp2);\n@@ -3131,1 +3127,0 @@\n-  assert (UseCompressedOops || UseCompressedClassPointers, \"should be compressed\");\n@@ -4921,4 +4916,0 @@\n-    decode_klass_not_null(dst);\n-  } else if (UseCompressedClassPointers) {\n-    ldrw(dst, Address(src, oopDesc::klass_offset_in_bytes()));\n-    decode_klass_not_null(dst);\n@@ -4926,1 +4917,1 @@\n-    ldr(dst, Address(src, oopDesc::klass_offset_in_bytes()));\n+    ldrw(dst, Address(src, oopDesc::klass_offset_in_bytes()));\n@@ -4928,0 +4919,1 @@\n+  decode_klass_not_null(dst);\n@@ -4979,16 +4971,2 @@\n-  if (UseCompressedClassPointers) {\n-    if (UseCompactObjectHeaders) {\n-      load_narrow_klass_compact(tmp, obj);\n-    } else {\n-      ldrw(tmp, Address(obj, oopDesc::klass_offset_in_bytes()));\n-    }\n-    if (CompressedKlassPointers::base() == nullptr) {\n-      cmp(klass, tmp, LSL, CompressedKlassPointers::shift());\n-      return;\n-    } else if (((uint64_t)CompressedKlassPointers::base() & 0xffffffff) == 0\n-               && CompressedKlassPointers::shift() == 0) {\n-      \/\/ Only the bottom 32 bits matter\n-      cmpw(klass, tmp);\n-      return;\n-    }\n-    decode_klass_not_null(tmp);\n+  if (UseCompactObjectHeaders) {\n+    load_narrow_klass_compact(tmp, obj);\n@@ -4996,1 +4974,10 @@\n-    ldr(tmp, Address(obj, oopDesc::klass_offset_in_bytes()));\n+    ldrw(tmp, Address(obj, oopDesc::klass_offset_in_bytes()));\n+  }\n+  if (CompressedKlassPointers::base() == nullptr) {\n+    cmp(klass, tmp, LSL, CompressedKlassPointers::shift());\n+    return;\n+  } else if (((uint64_t)CompressedKlassPointers::base() & 0xffffffff) == 0\n+             && CompressedKlassPointers::shift() == 0) {\n+    \/\/ Only the bottom 32 bits matter\n+    cmpw(klass, tmp);\n+    return;\n@@ -4998,0 +4985,1 @@\n+  decode_klass_not_null(tmp);\n@@ -5005,2 +4993,1 @@\n-    cmpw(tmp1, tmp2);\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -5009,5 +4996,0 @@\n-    cmpw(tmp1, tmp2);\n-  } else {\n-    ldr(tmp1, Address(obj1, oopDesc::klass_offset_in_bytes()));\n-    ldr(tmp2, Address(obj2, oopDesc::klass_offset_in_bytes()));\n-    cmp(tmp1, tmp2);\n@@ -5015,0 +4997,1 @@\n+  cmpw(tmp1, tmp2);\n@@ -5021,6 +5004,2 @@\n-  if (UseCompressedClassPointers) {\n-    encode_klass_not_null(src);\n-    strw(src, Address(dst, oopDesc::klass_offset_in_bytes()));\n-  } else {\n-    str(src, Address(dst, oopDesc::klass_offset_in_bytes()));\n-  }\n+  encode_klass_not_null(src);\n+  strw(src, Address(dst, oopDesc::klass_offset_in_bytes()));\n@@ -5031,4 +5010,2 @@\n-  if (UseCompressedClassPointers) {\n-    \/\/ Store to klass gap in destination\n-    strw(src, Address(dst, oopDesc::klass_gap_offset_in_bytes()));\n-  }\n+  \/\/ Store to klass gap in destination\n+  strw(src, Address(dst, oopDesc::klass_gap_offset_in_bytes()));\n@@ -5180,2 +5157,0 @@\n-  assert(UseCompressedClassPointers, \"not using compressed class pointers\");\n-\n@@ -5311,2 +5286,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n-\n@@ -5379,1 +5352,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.cpp","additions":23,"deletions":51,"binary":false,"changes":74,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -78,1 +78,0 @@\n-    assert(UseCompressedClassPointers, \"only for compressed klass code\");\n","filename":"src\/hotspot\/cpu\/arm\/matcher_arm.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -147,1 +147,1 @@\n-  } else if (UseCompressedClassPointers && !UseCompactObjectHeaders) {\n+  } else if (!UseCompactObjectHeaders) {\n","filename":"src\/hotspot\/cpu\/ppc\/c1_MacroAssembler_ppc.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3188,6 +3188,2 @@\n-  if (UseCompressedClassPointers) {\n-    Register compressedKlass = encode_klass_not_null(ck, klass);\n-    stw(compressedKlass, oopDesc::klass_offset_in_bytes(), dst_oop);\n-  } else {\n-    std(klass, oopDesc::klass_offset_in_bytes(), dst_oop);\n-  }\n+  Register compressedKlass = encode_klass_not_null(ck, klass);\n+  stw(compressedKlass, oopDesc::klass_offset_in_bytes(), dst_oop);\n@@ -3198,6 +3194,3 @@\n-  if (UseCompressedClassPointers) {\n-    if (val == noreg) {\n-      val = R0;\n-      li(val, 0);\n-    }\n-    stw(val, oopDesc::klass_gap_offset_in_bytes(), dst_oop);\n+  if (val == noreg) {\n+    val = R0;\n+    li(val, 0);\n@@ -3205,0 +3198,1 @@\n+  stw(val, oopDesc::klass_gap_offset_in_bytes(), dst_oop);\n@@ -3213,11 +3207,7 @@\n-    if (!UseCompressedClassPointers) {\n-      computed_size = 0;\n-    } else {\n-      \/\/ Determine by scratch emit.\n-      ResourceMark rm;\n-      int code_size = 8 * BytesPerInstWord;\n-      CodeBuffer cb(\"decode_klass_not_null scratch buffer\", code_size, 0);\n-      MacroAssembler* a = new MacroAssembler(&cb);\n-      a->decode_klass_not_null(R11_scratch1);\n-      computed_size = a->offset();\n-    }\n+    \/\/ Determine by scratch emit.\n+    ResourceMark rm;\n+    int code_size = 8 * BytesPerInstWord;\n+    CodeBuffer cb(\"decode_klass_not_null scratch buffer\", code_size, 0);\n+    MacroAssembler* a = new MacroAssembler(&cb);\n+    a->decode_klass_not_null(R11_scratch1);\n+    computed_size = a->offset();\n@@ -3246,2 +3236,0 @@\n-  } else if (UseCompressedClassPointers) {\n-    lwz(dst, oopDesc::klass_offset_in_bytes(), src);\n@@ -3249,1 +3237,1 @@\n-    ld(dst, oopDesc::klass_offset_in_bytes(), src);\n+    lwz(dst, oopDesc::klass_offset_in_bytes(), src);\n@@ -3255,3 +3243,1 @@\n-  if (UseCompressedClassPointers) { \/\/ also true for UseCompactObjectHeaders\n-    decode_klass_not_null(dst);\n-  }\n+  decode_klass_not_null(dst);\n@@ -3273,8 +3259,2 @@\n-  if (UseCompressedClassPointers) {\n-    if (UseCompactObjectHeaders) {\n-      load_narrow_klass_compact(tmp, obj);\n-    } else {\n-      lwz(tmp, oopDesc::klass_offset_in_bytes(), obj);\n-    }\n-    Register encoded_klass = encode_klass_not_null(tmp2, klass);\n-    cmpw(dst, tmp, encoded_klass);\n+  if (UseCompactObjectHeaders) {\n+    load_narrow_klass_compact(tmp, obj);\n@@ -3282,2 +3262,1 @@\n-    ld(tmp, oopDesc::klass_offset_in_bytes(), obj);\n-    cmpd(dst, tmp, klass);\n+    lwz(tmp, oopDesc::klass_offset_in_bytes(), obj);\n@@ -3285,0 +3264,2 @@\n+  Register encoded_klass = encode_klass_not_null(tmp2, klass);\n+  cmpw(dst, tmp, encoded_klass);\n@@ -3292,1 +3273,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -3296,4 +3277,0 @@\n-  } else {\n-    ld(tmp1, oopDesc::klass_offset_in_bytes(), obj1);\n-    ld(tmp2, oopDesc::klass_offset_in_bytes(), obj2);\n-    cmpd(dst, tmp1, tmp2);\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.cpp","additions":21,"deletions":44,"binary":false,"changes":65,"status":"modified"},{"patch":"@@ -91,1 +91,0 @@\n-    assert(UseCompressedClassPointers, \"only for compressed klass code\");\n","filename":"src\/hotspot\/cpu\/ppc\/matcher_ppc.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -199,1 +199,1 @@\n-    } else if (UseCompressedClassPointers) {\n+    } else {\n@@ -202,3 +202,0 @@\n-    } else {\n-      __ ld(tmp, Address(src, oopDesc::klass_offset_in_bytes()));\n-      __ ld(t0, Address(dst, oopDesc::klass_offset_in_bytes()));\n@@ -260,3 +257,1 @@\n-    if (UseCompressedClassPointers) {\n-      __ encode_klass_not_null(tmp);\n-    }\n+    __ encode_klass_not_null(tmp);\n","filename":"src\/hotspot\/cpu\/riscv\/c1_LIRAssembler_arraycopy_riscv.cpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -58,14 +58,0 @@\n-static void select_different_registers(Register preserve,\n-                                       Register extra,\n-                                       Register &tmp1,\n-                                       Register &tmp2) {\n-  if (tmp1 == preserve) {\n-    assert_different_registers(tmp1, tmp2, extra);\n-    tmp1 = extra;\n-  } else if (tmp2 == preserve) {\n-    assert_different_registers(tmp1, tmp2, extra);\n-    tmp2 = extra;\n-  }\n-  assert_different_registers(preserve, tmp1, tmp2);\n-}\n-\n@@ -1184,6 +1170,2 @@\n-  if (k->is_loaded() && !UseCompressedClassPointers) {\n-    select_different_registers(obj, dst, k_RInfo, klass_RInfo);\n-  } else {\n-    Rtmp1 = op->tmp3()->as_register();\n-    select_different_registers(obj, dst, k_RInfo, klass_RInfo, Rtmp1);\n-  }\n+  Rtmp1 = op->tmp3()->as_register();\n+  select_different_registers(obj, dst, k_RInfo, klass_RInfo, Rtmp1);\n","filename":"src\/hotspot\/cpu\/riscv\/c1_LIRAssembler_riscv.cpp","additions":2,"deletions":20,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -1076,3 +1076,1 @@\n-  if (!x->klass()->is_loaded() || UseCompressedClassPointers) {\n-    tmp3 = new_register(objectType);\n-  }\n+  tmp3 = new_register(objectType);\n@@ -1097,3 +1095,1 @@\n-  if (!x->klass()->is_loaded() || UseCompressedClassPointers) {\n-    tmp3 = new_register(objectType);\n-  }\n+  tmp3 = new_register(objectType);\n","filename":"src\/hotspot\/cpu\/riscv\/c1_LIRGenerator_riscv.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -95,6 +95,2 @@\n-    if (UseCompressedClassPointers) { \/\/ Take care not to kill klass\n-      encode_klass_not_null(tmp1, klass, tmp2);\n-      sw(tmp1, Address(obj, oopDesc::klass_offset_in_bytes()));\n-    } else {\n-      sd(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n-    }\n+    encode_klass_not_null(tmp1, klass, tmp2);\n+    sw(tmp1, Address(obj, oopDesc::klass_offset_in_bytes()));\n@@ -111,1 +107,1 @@\n-  } else if (UseCompressedClassPointers && !UseCompactObjectHeaders) {\n+  } else if (!UseCompactObjectHeaders) {\n","filename":"src\/hotspot\/cpu\/riscv\/c1_MacroAssembler_riscv.cpp","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1159,2 +1159,1 @@\n-  assert((base_offset % (UseCompactObjectHeaders ? 4 :\n-                        (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+  assert((base_offset % (UseCompactObjectHeaders ? 4 : 8)) == 0, \"Must be\");\n@@ -1253,2 +1252,1 @@\n-  assert((base_offset % (UseCompactObjectHeaders ? 4 :\n-                          (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+  assert((base_offset % (UseCompactObjectHeaders ? 4 : 8)) == 0, \"Must be\");\n@@ -1469,2 +1467,1 @@\n-  assert((base_offset % (UseCompactObjectHeaders ? 4 :\n-                         (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+  assert((base_offset % (UseCompactObjectHeaders ? 4 : 8)) == 0, \"Must be\");\n@@ -1595,2 +1592,1 @@\n-  assert((base_offset % (UseCompactObjectHeaders ? 4 :\n-                         (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+  assert((base_offset % (UseCompactObjectHeaders ? 4 : 8)) == 0, \"Must be\");\n@@ -2606,2 +2602,1 @@\n-  assert((base_offset % (UseCompactObjectHeaders ? 4 :\n-                         (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+  assert((base_offset % (UseCompactObjectHeaders ? 4 : 8)) == 0, \"Must be\");\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -3109,2 +3109,0 @@\n-  } else if (UseCompressedClassPointers) {\n-    lwu(tmp, Address(oop, oopDesc::klass_offset_in_bytes()));\n@@ -3112,1 +3110,1 @@\n-    ld(tmp, Address(oop, oopDesc::klass_offset_in_bytes()));\n+    lwu(tmp, Address(oop, oopDesc::klass_offset_in_bytes()));\n@@ -3336,1 +3334,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -3339,2 +3337,0 @@\n-  } else {\n-    ld(dst, Address(src, oopDesc::klass_offset_in_bytes()));\n@@ -3348,6 +3344,3 @@\n-  if (UseCompressedClassPointers) {\n-    encode_klass_not_null(src, tmp);\n-    sw(src, Address(dst, oopDesc::klass_offset_in_bytes()));\n-  } else {\n-    sd(src, Address(dst, oopDesc::klass_offset_in_bytes()));\n-  }\n+  encode_klass_not_null(src, tmp);\n+  sw(src, Address(dst, oopDesc::klass_offset_in_bytes()));\n+\n@@ -3358,4 +3351,2 @@\n-  if (UseCompressedClassPointers) {\n-    \/\/ Store to klass gap in destination\n-    sw(src, Address(dst, oopDesc::klass_gap_offset_in_bytes()));\n-  }\n+  \/\/ Store to klass gap in destination\n+  sw(src, Address(dst, oopDesc::klass_gap_offset_in_bytes()));\n@@ -3370,1 +3361,0 @@\n-  assert(UseCompressedClassPointers, \"should only be used for compressed headers\");\n@@ -3401,2 +3391,0 @@\n-  assert(UseCompressedClassPointers, \"should only be used for compressed headers\");\n-\n@@ -4933,1 +4921,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n@@ -5014,1 +5001,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -5017,3 +5004,0 @@\n-  } else {\n-    ld(tmp1,  Address(receiver, oopDesc::klass_offset_in_bytes()));\n-    ld(tmp2, Address(data, CompiledICData::speculated_klass_offset()));\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.cpp","additions":8,"deletions":24,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -1804,7 +1804,2 @@\n-  if (UseCompressedClassPointers) {\n-    st->print_cr(\"\\tlwu t1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n-    st->print_cr(\"\\tlwu t2, [t0      + CompiledICData::speculated_klass_offset()]\\t# compressed klass\");\n-  } else {\n-    st->print_cr(\"\\tld t1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n-    st->print_cr(\"\\tld t2, [t0      + CompiledICData::speculated_klass_offset()]\\t# compressed klass\");\n-  }\n+  st->print_cr(\"\\tlwu t1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n+  st->print_cr(\"\\tlwu t2, [t0      + CompiledICData::speculated_klass_offset()]\\t# compressed klass\");\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2615,2 +2615,1 @@\n-    assert((base_offset % (UseCompactObjectHeaders ? 4 :\n-                           (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+    assert((base_offset % (UseCompactObjectHeaders ? 4 : 8)) == 0, \"Must be\");\n@@ -2673,2 +2672,1 @@\n-    assert((base_offset % (UseCompactObjectHeaders ? 4 :\n-                           (UseCompressedClassPointers ? 8 : 4))) == 0, \"Must be\");\n+    assert((base_offset % (UseCompactObjectHeaders ? 4 : 8)) == 0, \"Must be\");\n","filename":"src\/hotspot\/cpu\/riscv\/stubGenerator_riscv.cpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2254,3 +2254,1 @@\n-    if (UseCompressedClassPointers) {\n-      __ encode_klass_not_null(tmp);\n-    }\n+    __ encode_klass_not_null(tmp);\n@@ -2543,7 +2541,2 @@\n-    if (UseCompressedClassPointers) {\n-      __ load_klass(klass_RInfo, obj);\n-      __ compareU64_and_branch(k_RInfo, klass_RInfo, Assembler::bcondNotEqual, *failure_target);\n-    } else {\n-      __ z_cg(k_RInfo, Address(obj, oopDesc::klass_offset_in_bytes()));\n-      __ branch_optimized(Assembler::bcondNotEqual, *failure_target);\n-    }\n+    __ load_klass(klass_RInfo, obj);\n+    __ compareU64_and_branch(k_RInfo, klass_RInfo, Assembler::bcondNotEqual, *failure_target);\n","filename":"src\/hotspot\/cpu\/s390\/c1_LIRAssembler_s390.cpp","additions":3,"deletions":10,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -112,1 +112,1 @@\n-  } else if (UseCompressedClassPointers && !UseCompactObjectHeaders) {\n+  } else if (!UseCompactObjectHeaders) {\n","filename":"src\/hotspot\/cpu\/s390\/c1_MacroAssembler_s390.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1239,1 +1239,0 @@\n-  assert(UseCompressedClassPointers, \"must be on to call this method\");\n@@ -1257,1 +1256,0 @@\n-  assert(UseCompressedClassPointers, \"must be on to call this method\");\n@@ -1350,2 +1348,0 @@\n-  assert(UseCompressedClassPointers, \"Can only patch compressed klass pointers\");\n-\n@@ -1366,2 +1362,0 @@\n-  assert(UseCompressedClassPointers, \"Can only patch compressed klass pointers\");\n-\n@@ -2237,2 +2231,0 @@\n-  } else if (UseCompressedClassPointers) {\n-    z_llgf(R1_scratch, Address(R2_receiver, oopDesc::klass_offset_in_bytes()));\n@@ -2240,1 +2232,1 @@\n-    z_lg(R1_scratch, Address(R2_receiver, oopDesc::klass_offset_in_bytes()));\n+    z_llgf(R1_scratch, Address(R2_receiver, oopDesc::klass_offset_in_bytes()));\n@@ -3918,1 +3910,0 @@\n-  assert(UseCompressedClassPointers, \"only for compressed klass ptrs\");\n@@ -4015,1 +4006,0 @@\n-  assert(UseCompressedClassPointers, \"only for compressed klass ptrs\");\n@@ -4045,1 +4035,0 @@\n-  assert(UseCompressedClassPointers, \"only for compressed klass ptrs\");\n@@ -4087,1 +4076,0 @@\n-  assert(UseCompressedClassPointers, \"only for compressed klass ptrs\");\n@@ -4127,7 +4115,3 @@\n-  if (UseCompressedClassPointers) {\n-    z_llgf(klass, mem);\n-    \/\/ Attention: no null check here!\n-    decode_klass_not_null(klass);\n-  } else {\n-    z_lg(klass, mem);\n-  }\n+  z_llgf(klass, mem);\n+  \/\/ Attention: no null check here!\n+  decode_klass_not_null(klass);\n@@ -4156,2 +4140,0 @@\n-  } else if (UseCompressedClassPointers) {\n-    z_c(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n@@ -4159,1 +4141,1 @@\n-    z_cg(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n+    z_c(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n@@ -4172,1 +4154,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -4175,3 +4157,0 @@\n-  } else {\n-    z_lg(tmp1, Address(obj1, oopDesc::klass_offset_in_bytes()));\n-    z_cg(tmp1, Address(obj2, oopDesc::klass_offset_in_bytes()));\n@@ -4186,1 +4165,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -4189,2 +4168,0 @@\n-  } else {\n-    z_lg(klass, oopDesc::klass_offset_in_bytes(), src_oop);\n@@ -4196,8 +4173,4 @@\n-  if (UseCompressedClassPointers) {\n-    assert_different_registers(dst_oop, klass, Z_R0);\n-    if (ck == noreg) ck = klass;\n-    encode_klass_not_null(ck, klass);\n-    z_st(ck, Address(dst_oop, oopDesc::klass_offset_in_bytes()));\n-  } else {\n-    z_stg(klass, Address(dst_oop, oopDesc::klass_offset_in_bytes()));\n-  }\n+  assert_different_registers(dst_oop, klass, Z_R0);\n+  if (ck == noreg) ck = klass;\n+  encode_klass_not_null(ck, klass);\n+  z_st(ck, Address(dst_oop, oopDesc::klass_offset_in_bytes()));\n@@ -4208,8 +4181,6 @@\n-  if (UseCompressedClassPointers) {\n-    assert(s != d, \"not enough registers\");\n-    \/\/ Support s = noreg.\n-    if (s != noreg) {\n-      z_st(s, Address(d, oopDesc::klass_gap_offset_in_bytes()));\n-    } else {\n-      z_mvhi(Address(d, oopDesc::klass_gap_offset_in_bytes()), 0);\n-    }\n+  assert(s != d, \"not enough registers\");\n+  \/\/ Support s = noreg.\n+  if (s != noreg) {\n+    z_st(s, Address(d, oopDesc::klass_gap_offset_in_bytes()));\n+  } else {\n+    z_mvhi(Address(d, oopDesc::klass_gap_offset_in_bytes()), 0);\n@@ -4229,3 +4200,2 @@\n-  if (UseCompressedClassPointers) {\n-    const int shift = CompressedKlassPointers::shift();\n-    address   base  = CompressedKlassPointers::base();\n+  const int shift = CompressedKlassPointers::shift();\n+  address   base  = CompressedKlassPointers::base();\n@@ -4233,2 +4203,13 @@\n-    if (UseCompactObjectHeaders) {\n-      assert(shift >= 3, \"cKlass encoder detected bad shift\");\n+  if (UseCompactObjectHeaders) {\n+    assert(shift >= 3, \"cKlass encoder detected bad shift\");\n+  } else {\n+    assert((shift == 0) || (shift == 3), \"cKlass encoder detected bad shift\");\n+  }\n+  assert_different_registers(Rop1, Z_R0);\n+  assert_different_registers(Rop1, Rbase, Z_R1);\n+\n+  \/\/ First encode register oop and then compare with cOop in memory.\n+  \/\/ This sequence saves an unnecessary cOop load and decode.\n+  if (base == nullptr) {\n+    if (shift == 0) {\n+      z_cl(Rop1, disp, Rbase);     \/\/ Unscaled\n@@ -4236,1 +4217,2 @@\n-      assert((shift == 0) || (shift == 3), \"cKlass encoder detected bad shift\");\n+      z_srlg(Z_R0, Rop1, shift);   \/\/ ZeroBased\n+      z_cl(Z_R0, disp, Rbase);\n@@ -4238,13 +4220,1 @@\n-    assert_different_registers(Rop1, Z_R0);\n-    assert_different_registers(Rop1, Rbase, Z_R1);\n-\n-    \/\/ First encode register oop and then compare with cOop in memory.\n-    \/\/ This sequence saves an unnecessary cOop load and decode.\n-    if (base == nullptr) {\n-      if (shift == 0) {\n-        z_cl(Rop1, disp, Rbase);     \/\/ Unscaled\n-      } else {\n-        z_srlg(Z_R0, Rop1, shift);   \/\/ ZeroBased\n-        z_cl(Z_R0, disp, Rbase);\n-      }\n-    } else {                         \/\/ HeapBased\n+  } else {                         \/\/ HeapBased\n@@ -4252,2 +4222,2 @@\n-      bool     used_R0 = true;\n-      bool     used_R1 = true;\n+    bool     used_R0 = true;\n+    bool     used_R1 = true;\n@@ -4255,2 +4225,2 @@\n-      Register current = Rop1;\n-      Label    done;\n+    Register current = Rop1;\n+    Label    done;\n@@ -4258,5 +4228,5 @@\n-      if (maybenull) {       \/\/ null pointer must be preserved!\n-        z_ltgr(Z_R0, current);\n-        z_bre(done);\n-        current = Z_R0;\n-      }\n+    if (maybenull) {       \/\/ null pointer must be preserved!\n+      z_ltgr(Z_R0, current);\n+      z_bre(done);\n+      current = Z_R0;\n+    }\n@@ -4264,12 +4234,12 @@\n-      unsigned int base_h = ((unsigned long)base)>>32;\n-      unsigned int base_l = (unsigned int)((unsigned long)base);\n-      if ((base_h != 0) && (base_l == 0) && VM_Version::has_HighWordInstr()) {\n-        lgr_if_needed(Z_R0, current);\n-        z_aih(Z_R0, -((int)base_h));     \/\/ Base has no set bits in lower half.\n-      } else if ((base_h == 0) && (base_l != 0)) {\n-        lgr_if_needed(Z_R0, current);\n-        z_agfi(Z_R0, -(int)base_l);\n-      } else {\n-        int pow2_offset = get_oop_base_complement(Z_R1, ((uint64_t)(intptr_t)base));\n-        add2reg_with_index(Z_R0, pow2_offset, Z_R1, Rop1); \/\/ Subtract base by adding complement.\n-      }\n+    unsigned int base_h = ((unsigned long)base)>>32;\n+    unsigned int base_l = (unsigned int)((unsigned long)base);\n+    if ((base_h != 0) && (base_l == 0) && VM_Version::has_HighWordInstr()) {\n+      lgr_if_needed(Z_R0, current);\n+      z_aih(Z_R0, -((int)base_h));     \/\/ Base has no set bits in lower half.\n+    } else if ((base_h == 0) && (base_l != 0)) {\n+      lgr_if_needed(Z_R0, current);\n+      z_agfi(Z_R0, -(int)base_l);\n+    } else {\n+      int pow2_offset = get_oop_base_complement(Z_R1, ((uint64_t)(intptr_t)base));\n+      add2reg_with_index(Z_R0, pow2_offset, Z_R1, Rop1); \/\/ Subtract base by adding complement.\n+    }\n@@ -4277,5 +4247,5 @@\n-      if (shift != 0) {\n-        z_srlg(Z_R0, Z_R0, shift);\n-      }\n-      bind(done);\n-      z_cl(Z_R0, disp, Rbase);\n+    if (shift != 0) {\n+      z_srlg(Z_R0, Z_R0, shift);\n+    }\n+    bind(done);\n+    z_cl(Z_R0, disp, Rbase);\n@@ -4283,2 +4253,2 @@\n-      if (used_R0) preset_reg(Z_R0, 0xb05bUL, 2);\n-      if (used_R1) preset_reg(Z_R1, 0xb06bUL, 2);\n+    if (used_R0) preset_reg(Z_R0, 0xb05bUL, 2);\n+    if (used_R1) preset_reg(Z_R1, 0xb06bUL, 2);\n@@ -4286,3 +4256,0 @@\n-    }\n-  } else {\n-    z_clg(Rop1, disp, Z_R0, Rbase);\n@@ -4290,0 +4257,1 @@\n+\n","filename":"src\/hotspot\/cpu\/s390\/macroAssembler_s390.cpp","additions":64,"deletions":96,"binary":false,"changes":160,"status":"modified"},{"patch":"@@ -845,2 +845,1 @@\n-  \/\/ Compares the Klass pointer of an object to a given Klass (which might be narrow,\n-  \/\/ depending on UseCompressedClassPointers).\n+  \/\/ Compares the narrow Klass pointer of an object to a given narrow Klass\n","filename":"src\/hotspot\/cpu\/s390\/macroAssembler_s390.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,1 +85,0 @@\n-    assert(UseCompressedClassPointers, \"only for compressed klass code\");\n","filename":"src\/hotspot\/cpu\/s390\/matcher_s390.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -79,17 +79,0 @@\n-\n-static void select_different_registers(Register preserve,\n-                                       Register extra,\n-                                       Register &tmp1,\n-                                       Register &tmp2) {\n-  if (tmp1 == preserve) {\n-    assert_different_registers(tmp1, tmp2, extra);\n-    tmp1 = extra;\n-  } else if (tmp2 == preserve) {\n-    assert_different_registers(tmp1, tmp2, extra);\n-    tmp2 = extra;\n-  }\n-  assert_different_registers(preserve, tmp1, tmp2);\n-}\n-\n-\n-\n@@ -1322,6 +1305,2 @@\n-  if (k->is_loaded() && !UseCompressedClassPointers) {\n-    select_different_registers(obj, dst, k_RInfo, klass_RInfo);\n-  } else {\n-    Rtmp1 = op->tmp3()->as_register();\n-    select_different_registers(obj, dst, k_RInfo, klass_RInfo, Rtmp1);\n-  }\n+  Rtmp1 = op->tmp3()->as_register();\n+  select_different_registers(obj, dst, k_RInfo, klass_RInfo, Rtmp1);\n@@ -1367,6 +1346,2 @@\n-    if (UseCompressedClassPointers) {\n-      __ load_klass(Rtmp1, obj, tmp_load_klass);\n-      __ cmpptr(k_RInfo, Rtmp1);\n-    } else {\n-      __ cmpptr(k_RInfo, Address(obj, oopDesc::klass_offset_in_bytes()));\n-    }\n+    __ load_klass(Rtmp1, obj, tmp_load_klass);\n+    __ cmpptr(k_RInfo, Rtmp1);\n@@ -2675,3 +2650,1 @@\n-    if (UseCompressedClassPointers) {\n-      __ encode_klass_not_null(tmp, rscratch1);\n-    }\n+    __ encode_klass_not_null(tmp, rscratch1);\n","filename":"src\/hotspot\/cpu\/x86\/c1_LIRAssembler_x86.cpp","additions":5,"deletions":32,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -1294,3 +1294,1 @@\n-  if (!x->klass()->is_loaded() || UseCompressedClassPointers) {\n-    tmp3 = new_register(objectType);\n-  }\n+  tmp3 = new_register(objectType);\n@@ -1316,3 +1314,1 @@\n-  if (!x->klass()->is_loaded() || UseCompressedClassPointers) {\n-    tmp3 = new_register(objectType);\n-  }\n+  tmp3 = new_register(objectType);\n","filename":"src\/hotspot\/cpu\/x86\/c1_LIRGenerator_x86.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -88,1 +88,1 @@\n-  } else if (UseCompressedClassPointers) { \/\/ Take care not to kill klass\n+  } else { \/\/ Take care not to kill klass\n@@ -93,3 +93,0 @@\n-  } else {\n-    movptr(Address(obj, oopDesc::mark_offset_in_bytes()), checked_cast<int32_t>(markWord::prototype().value()));\n-    movptr(Address(obj, oopDesc::klass_offset_in_bytes()), klass);\n@@ -107,1 +104,1 @@\n-  } else if (UseCompressedClassPointers && !UseCompactObjectHeaders) {\n+  } else if (!UseCompactObjectHeaders) {\n","filename":"src\/hotspot\/cpu\/x86\/c1_MacroAssembler_x86.cpp","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -988,1 +988,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -991,3 +991,0 @@\n-  } else {\n-    movptr(temp, Address(receiver, oopDesc::klass_offset_in_bytes()));\n-    cmpptr(temp, Address(data, CompiledICData::speculated_klass_offset()));\n@@ -5160,1 +5157,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -5163,2 +5160,0 @@\n-  } else {\n-    movptr(dst, Address(src, oopDesc::klass_offset_in_bytes()));\n@@ -5172,6 +5167,2 @@\n-  if (UseCompressedClassPointers) {\n-    encode_klass_not_null(src, tmp);\n-    movl(Address(dst, oopDesc::klass_offset_in_bytes()), src);\n-  } else {\n-    movptr(Address(dst, oopDesc::klass_offset_in_bytes()), src);\n-  }\n+  encode_klass_not_null(src, tmp);\n+  movl(Address(dst, oopDesc::klass_offset_in_bytes()), src);\n@@ -5186,2 +5177,0 @@\n-  } else if (UseCompressedClassPointers) {\n-    cmpl(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n@@ -5189,1 +5178,1 @@\n-    cmpptr(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n+    cmpl(klass, Address(obj, oopDesc::klass_offset_in_bytes()));\n@@ -5200,1 +5189,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -5203,3 +5192,0 @@\n-  } else {\n-    movptr(tmp1, Address(obj1, oopDesc::klass_offset_in_bytes()));\n-    cmpptr(tmp1, Address(obj2, oopDesc::klass_offset_in_bytes()));\n@@ -5254,4 +5240,2 @@\n-  if (UseCompressedClassPointers) {\n-    \/\/ Store to klass gap in destination\n-    movl(Address(dst, oopDesc::klass_gap_offset_in_bytes()), src);\n-  }\n+  \/\/ Store to klass gap in destination\n+  movl(Address(dst, oopDesc::klass_gap_offset_in_bytes()), src);\n@@ -5447,1 +5431,0 @@\n-  assert(UseCompressedClassPointers, \"should only be used for compressed headers\");\n@@ -5469,1 +5452,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n@@ -5526,1 +5508,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n@@ -5534,1 +5515,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n@@ -5560,1 +5540,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n@@ -5568,1 +5547,0 @@\n-  assert (UseCompressedClassPointers, \"should only be used for compressed headers\");\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":8,"deletions":30,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -354,2 +354,1 @@\n-  \/\/ Compares the Klass pointer of an object to a given Klass (which might be narrow,\n-  \/\/ depending on UseCompressedClassPointers).\n+  \/\/ Compares the narrow Klass pointer of an object to a given narrow Klass (which might be narrow\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -78,1 +78,0 @@\n-    assert(UseCompressedClassPointers, \"only for compressed klass code\");\n","filename":"src\/hotspot\/cpu\/x86\/matcher_x86.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2607,7 +2607,2 @@\n-  if (UseCompressedClassPointers) {\n-    st->print_cr(\"movl    rscratch1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n-    st->print_cr(\"\\tcmpl    rscratch1, [rax + CompiledICData::speculated_klass_offset()]\\t # Inline cache check\");\n-  } else {\n-    st->print_cr(\"movq    rscratch1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n-    st->print_cr(\"\\tcmpq    rscratch1, [rax + CompiledICData::speculated_klass_offset()]\\t # Inline cache check\");\n-  }\n+  st->print_cr(\"movl    rscratch1, [j_rarg0 + oopDesc::klass_offset_in_bytes()]\\t# compressed klass\");\n+  st->print_cr(\"\\tcmpl    rscratch1, [rax + CompiledICData::speculated_klass_offset()]\\t # Inline cache check\");\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -548,1 +548,0 @@\n-    assert(UseCompressedClassPointers, \"heap archiving requires UseCompressedClassPointers\");\n","filename":"src\/hotspot\/share\/cds\/aotMapLogger.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -57,1 +57,1 @@\n-    CDS_JAVA_HEAP_ONLY(return (UseG1GC && UseCompressedClassPointers);)\n+    CDS_JAVA_HEAP_ONLY(return UseG1GC;)\n","filename":"src\/hotspot\/share\/cds\/aotMappedHeapLoader.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -469,1 +469,0 @@\n-  assert(UseCompressedClassPointers, \"Archived heap only supported for compressed klasses\");\n@@ -725,1 +724,0 @@\n-  assert(UseCompressedClassPointers, \"Archived heap only supported for compressed klasses\");\n","filename":"src\/hotspot\/share\/cds\/aotMappedHeapWriter.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -252,1 +252,1 @@\n-  if (UseCompressedClassPointers && CompressedKlassPointers::needs_class_space()) {\n+  if (CompressedKlassPointers::needs_class_space()) {\n@@ -1852,2 +1852,7 @@\n-\/\/ If UseCompressedClassPointers is disabled, only one address space will be\n-\/\/  reserved:\n+\/\/ The range encompassing both spaces will be suitable to en\/decode narrow Klass\n+\/\/  pointers: the base will be valid for encoding, the range [Base, End) and not\n+\/\/  surpass the max. range for that encoding.\n+\/\/\n+\/\/ On 32-bit, a \"narrow\" Klass is just the pointer itself, and the Klass encoding\n+\/\/  range encompasses the whole address range. Consequently, we can \"decode\" and\n+\/\/  \"encode\" any pointer anywhere, and so are free to place the CDS archive anywhere:\n@@ -1867,4 +1872,0 @@\n-\/\/ If UseCompressedClassPointers=1, the range encompassing both spaces will be\n-\/\/  suitable to en\/decode narrow Klass pointers: the base will be valid for\n-\/\/  encoding, the range [Base, End) and not surpass the max. range for that encoding.\n-\/\/\n@@ -1875,1 +1876,1 @@\n-\/\/      class_space_rs if UseCompressedClassPointers is true.\n+\/\/      class_space_rs on 64-bit.\n@@ -1882,6 +1883,4 @@\n-\/\/    - class_space_rs: If UseCompressedClassPointers=1, class_space_rs will\n-\/\/      be reserved. Its start address will be aligned to metaspace reserve\n-\/\/      alignment, which may differ from CDS alignment. It will follow the cds\n-\/\/      archive space, close enough such that narrow class pointer encoding\n-\/\/      covers both spaces.\n-\/\/      If UseCompressedClassPointers=0, class_space_rs remains unreserved.\n+\/\/    - class_space_rs: On 64-bit, class_space_rs will be reserved. Its start\n+\/\/      address will be aligned to metaspace reserve alignment, which may differ\n+\/\/      from CDS alignment. It will follow the cds archive space, close enough\n+\/\/      such that narrow class pointer encoding covers both spaces.\n","filename":"src\/hotspot\/share\/cds\/aotMetaspace.cpp","additions":13,"deletions":14,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -390,1 +390,0 @@\n-  assert(UseCompressedClassPointers, \"Archived heap only supported for compressed klasses\");\n","filename":"src\/hotspot\/share\/cds\/aotStreamedHeapWriter.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -671,6 +671,1 @@\n-#ifdef _LP64\n-    \/\/ More strict alignments needed for UseCompressedClassPointers\n-    if (UseCompressedClassPointers) {\n-      alignment = nth_bit(ArchiveBuilder::precomputed_narrow_klass_shift());\n-    }\n-#endif\n+    alignment = nth_bit(ArchiveBuilder::precomputed_narrow_klass_shift());\n@@ -1140,1 +1135,0 @@\n-#ifdef _LP64\n@@ -1142,2 +1136,2 @@\n-  \/\/ Legacy Mode:\n-  \/\/    We use 32 bits for narrowKlass, which should cover the full 4G Klass range. Shift can be 0.\n+  \/\/ Standard Mode:\n+  \/\/    We use 32 bits for narrowKlass, which should cover a full 4G Klass range. Shift can be 0.\n@@ -1150,1 +1144,0 @@\n-  assert(UseCompressedClassPointers, \"Only needed for compressed class pointers\");\n@@ -1153,1 +1146,0 @@\n-#endif \/\/ _LP64\n","filename":"src\/hotspot\/share\/cds\/archiveBuilder.cpp","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -514,1 +514,0 @@\n-#ifdef _LP64\n@@ -534,1 +533,0 @@\n-#endif \/\/ _LP64\n","filename":"src\/hotspot\/share\/cds\/archiveBuilder.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -891,4 +891,0 @@\n-  if (!UseCompressedClassPointers) {\n-    return \"UseCompressedClassPointers must be true\";\n-  }\n-\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.cpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -228,9 +228,3 @@\n-  _compressed_class_ptrs = UseCompressedClassPointers;\n-  if (UseCompressedClassPointers) {\n-#ifdef _LP64\n-    _narrow_klass_pointer_bits = CompressedKlassPointers::narrow_klass_pointer_bits();\n-    _narrow_klass_shift = ArchiveBuilder::precomputed_narrow_klass_shift();\n-#endif\n-  } else {\n-    _narrow_klass_pointer_bits = _narrow_klass_shift = -1;\n-  }\n+  _narrow_klass_pointer_bits = CompressedKlassPointers::narrow_klass_pointer_bits();\n+  _narrow_klass_shift = ArchiveBuilder::precomputed_narrow_klass_shift();\n+\n@@ -298,1 +292,0 @@\n-  st->print_cr(\"- compressed_class_ptrs:                    %d\", _compressed_class_ptrs);\n@@ -1913,5 +1906,6 @@\n-  aot_log_info(aot)(\"The %s was created with UseCompressedOops = %d, UseCompressedClassPointers = %d, UseCompactObjectHeaders = %d\",\n-                          file_type, compressed_oops(), compressed_class_pointers(), compact_headers());\n-  if (compressed_oops() != UseCompressedOops || compressed_class_pointers() != UseCompressedClassPointers) {\n-    aot_log_warning(aot)(\"Unable to use %s.\\nThe saved state of UseCompressedOops and UseCompressedClassPointers is \"\n-                               \"different from runtime, CDS will be disabled.\", file_type);\n+  aot_log_info(aot)(\"The %s was created with UseCompressedOops = %d, UseCompactObjectHeaders = %d\",\n+                          file_type, compressed_oops(), compact_headers());\n+  if (compressed_oops() != UseCompressedOops) {\n+    aot_log_warning(aot)(\"Unable to use %s.\\nThe saved state of UseCompressedOops (%d) is \"\n+                               \"different from runtime (%d), CDS will be disabled.\", file_type,\n+                               compressed_oops(), UseCompressedOops);\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":9,"deletions":15,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -120,1 +120,0 @@\n-  bool    _compressed_class_ptrs;                 \/\/ save the flag UseCompressedClassPointers\n@@ -204,1 +203,0 @@\n-  bool compressed_class_pointers()         const { return _compressed_class_ptrs; }\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -91,2 +91,1 @@\n-#ifdef _LP64\n-  if (k != nullptr && UseCompressedClassPointers) {\n+  if (k != nullptr) {\n@@ -95,1 +94,0 @@\n-#endif\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -410,3 +410,0 @@\n-  if (UseCompressedClassPointers) {\n-    _flags |= compressedClassPointers;\n-  }\n@@ -455,4 +452,0 @@\n-  if (((_flags & compressedClassPointers) != 0) != UseCompressedClassPointers) {\n-    log_debug(aot, codecache, init)(\"AOT Code Cache disabled: it was created with UseCompressedClassPointers = %s\", UseCompressedClassPointers ? \"false\" : \"true\");\n-    return false;\n-  }\n","filename":"src\/hotspot\/share\/code\/aotCodeCache.cpp","additions":0,"deletions":7,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -180,6 +180,5 @@\n-      compressedClassPointers  = 4,\n-      useTLAB                  = 8,\n-      systemClassAssertions    = 16,\n-      userClassAssertions      = 32,\n-      enableContendedPadding   = 64,\n-      restrictContendedPadding = 128\n+      useTLAB                  = 4,\n+      systemClassAssertions    = 8,\n+      userClassAssertions      = 16,\n+      enableContendedPadding   = 32,\n+      restrictContendedPadding = 64\n","filename":"src\/hotspot\/share\/code\/aotCodeCache.hpp","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -79,5 +79,1 @@\n-  if (UseCompressedClassPointers) {\n-    _speculated_klass = (uintptr_t)CompressedKlassPointers::encode_not_null(receiver_klass);\n-  } else {\n-    _speculated_klass = (uintptr_t)receiver_klass;\n-  }\n+  _speculated_klass = (uintptr_t)CompressedKlassPointers::encode_not_null(receiver_klass);\n@@ -136,6 +132,1 @@\n-\n-  if (UseCompressedClassPointers) {\n-    return CompressedKlassPointers::decode_not_null((narrowKlass)_speculated_klass);\n-  } else {\n-    return (Klass*)_speculated_klass;\n-  }\n+  return CompressedKlassPointers::decode_not_null((narrowKlass)_speculated_klass);\n","filename":"src\/hotspot\/share\/code\/compiledIC.cpp","additions":2,"deletions":11,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -711,1 +711,0 @@\n-    assert(UseCompressedClassPointers, \"\");\n","filename":"src\/hotspot\/share\/gc\/shared\/c2\/barrierSetC2.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -125,1 +125,0 @@\n-\n@@ -127,3 +126,1 @@\n-  if (UseCompressedClassPointers) {\n-    send_metaspace_chunk_free_list_summary(when, Metaspace::ClassType, summary.class_chunk_free_list_summary());\n-  }\n+  send_metaspace_chunk_free_list_summary(when, Metaspace::ClassType, summary.class_chunk_free_list_summary());\n","filename":"src\/hotspot\/share\/gc\/shared\/gcTrace.cpp","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -562,9 +562,7 @@\n-  if (UseCompressedClassPointers) {\n-    if (UseCompactObjectHeaders) { \/\/ look in forwardee\n-      markWord mark = obj->mark();\n-      if (mark.is_marked()) {\n-        oop fwd = cast_to_oop(mark.clear_lock_bits().to_pointer());\n-        if (!os::is_readable_pointer(fwd)) {\n-          return false;\n-        }\n-        mark = fwd->mark();\n+\n+  if (UseCompactObjectHeaders) { \/\/ look in forwardee\n+    markWord mark = obj->mark();\n+    if (mark.is_marked()) {\n+      oop fwd = cast_to_oop(mark.clear_lock_bits().to_pointer());\n+      if (!os::is_readable_pointer(fwd)) {\n+        return false;\n@@ -572,6 +570,1 @@\n-      nk = mark.narrow_klass();\n-    } else {\n-      nk = obj->narrow_klass();\n-    }\n-    if (!CompressedKlassPointers::is_valid_narrow_klass_id(nk)) {\n-      return false;\n+      mark = fwd->mark();\n@@ -579,1 +572,1 @@\n-    k = CompressedKlassPointers::decode_not_null_without_asserts(nk);\n+    nk = mark.narrow_klass();\n@@ -581,1 +574,1 @@\n-    k = obj->klass();\n+    nk = obj->narrow_klass();\n@@ -583,0 +576,5 @@\n+  if (!CompressedKlassPointers::is_valid_narrow_klass_id(nk)) {\n+    return false;\n+  }\n+  k = CompressedKlassPointers::decode_not_null_without_asserts(nk);\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahAsserts.cpp","additions":15,"deletions":17,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -445,1 +445,1 @@\n-        assert(!UseCompressedClassPointers || UseCompactObjectHeaders, \"should only happen without compressed class pointers\");\n+        assert(UseCompactObjectHeaders, \"should only happen with COH\");\n","filename":"src\/hotspot\/share\/gc\/z\/c2\/zBarrierSetC2.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -53,5 +53,1 @@\n-    if (UseCompressedClassPointers)\n-        set $klass = (Klass*)(void*)((uintptr_t)CompressedKlassPointers::_base +((uintptr_t)$obj->_metadata->_compressed_klass << CompressedKlassPointers::_shift))\n-    else\n-        set $klass = $obj->_metadata->_klass\n-    end\n+    set $klass = (Klass*)(void*)((uintptr_t)CompressedKlassPointers::_base +((uintptr_t)$obj->_metadata->_compressed_klass << CompressedKlassPointers::_shift))\n","filename":"src\/hotspot\/share\/gc\/z\/zDebug.gdb","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -209,7 +209,2 @@\n-  if (UseCompressedClassPointers) {\n-    Universe_narrow_klass_base = CompressedKlassPointers::base();\n-    Universe_narrow_klass_shift = CompressedKlassPointers::shift();\n-  } else {\n-    Universe_narrow_klass_base = nullptr;\n-    Universe_narrow_klass_shift = 0;\n-  }\n+  Universe_narrow_klass_base = CompressedKlassPointers::base();\n+  Universe_narrow_klass_shift = CompressedKlassPointers::shift();\n@@ -386,1 +381,0 @@\n-  do_bool_flag(UseCompressedClassPointers)                                 \\\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCompilerToVMInit.cpp","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,3 +43,4 @@\n-\/\/ A CLD owns one MetaspaceArena if UseCompressedClassPointers is false. Otherwise\n-\/\/ it owns two - one for the Klass* objects from the class space, one for the other\n-\/\/ types of MetaspaceObjs from the non-class space.\n+\/\/ 64-bit:\n+\/\/\n+\/\/ A CLD owns two MetaspaceArenas - one for the Klass* objects from the class space,\n+\/\/ one for the other types of MetaspaceObjs from the non-class space.\n@@ -61,0 +62,5 @@\n+\/\/ 32-bit:\n+\/\/\n+\/\/ A CLD owns just one MetaspaceArena. In that arena all metadata - Klass and other -\n+\/\/ are placed.\n+\n@@ -70,1 +76,0 @@\n-  \/\/  (resp. for all allocations if -XX:-UseCompressedClassPointers).\n@@ -74,1 +79,1 @@\n-  \/\/  (null if -XX:-UseCompressedClassPointers).\n+  \/\/  (null for 32-bit).\n","filename":"src\/hotspot\/share\/memory\/classLoaderMetaspace.hpp","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -661,1 +661,2 @@\n-  if (UseCompressedClassPointers) {\n+  if (using_class_space()) {\n+\n@@ -727,1 +728,0 @@\n-  \/\/ If UseCompressedClassPointers=1, we have two cases:\n@@ -729,2 +729,1 @@\n-  \/\/    for us, initialize it and set up CompressedKlassPointers encoding.\n-  \/\/    Class space will be reserved above the mapped archives.\n+  \/\/    for us. It then will set up encoding.\n@@ -733,3 +732,2 @@\n-  \/\/    since we assume it has been placed in low\n-  \/\/    address regions. We may rethink this (see JDK-8244943). Failing that,\n-  \/\/    it will be placed anywhere.\n+  \/\/    since we assume it has been placed in low address regions. Failing that, it will\n+  \/\/    be placed anywhere.\n@@ -838,6 +836,4 @@\n-  \/\/ +UseCompressedClassPointers on 32-bit: does not need class space. Klass can live wherever.\n-  if (UseCompressedClassPointers) {\n-    const address start = (address)os::vm_min_address(); \/\/ but not in the zero page\n-    const address end = (address)CompressedKlassPointers::max_klass_range_size();\n-    CompressedKlassPointers::initialize(start, end - start);\n-  }\n+  \/\/ 32-bit:\n+  const address start = (address)os::vm_min_address(); \/\/ but not in the zero page\n+  const address end = (address)CompressedKlassPointers::max_klass_range_size();\n+  CompressedKlassPointers::initialize(start, end - start);\n@@ -851,9 +847,6 @@\n-  if (UseCompressedClassPointers) {\n-    \/\/ Note: \"cds\" would be a better fit but keep this for backward compatibility.\n-    LogTarget(Info, gc, metaspace) lt;\n-    if (lt.is_enabled()) {\n-      LogStream ls(lt);\n-      CDS_ONLY(AOTMetaspace::print_on(&ls);)\n-      Metaspace::print_compressed_class_space(&ls);\n-      CompressedKlassPointers::print_mode(&ls);\n-    }\n+  LogTarget(Info, gc, metaspace) lt;\n+  if (lt.is_enabled()) {\n+    LogStream ls(lt);\n+    CDS_ONLY(AOTMetaspace::print_on(&ls);)\n+    Metaspace::print_compressed_class_space(&ls);\n+    CompressedKlassPointers::print_mode(&ls);\n","filename":"src\/hotspot\/share\/memory\/metaspace.cpp","additions":15,"deletions":22,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -167,1 +167,1 @@\n-  \/\/ Return TRUE only if UseCompressedClassPointers is True.\n+  \/\/ Returns true if we use a class space.\n@@ -169,1 +169,2 @@\n-    return NOT_LP64(false) LP64_ONLY(UseCompressedClassPointers);\n+    return NOT_LP64(false) \/\/ Not needed on 32-bit\n+           LP64_ONLY(true);\n","filename":"src\/hotspot\/share\/memory\/metaspace.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -265,3 +265,3 @@\n-  \/\/ On 32-bit, with +UseCompressedClassPointers, the whole address space is the encoding range. We therefore\n-  \/\/ don't need a class space. However, as a pragmatic workaround for pesty overflow problems on 32-bit, we leave\n-  \/\/ a small area at the end of the address space out of the encoding range. We just assume no Klass will ever live\n+  \/\/ On 32-bit, the whole address space is the encoding range. We therefore don't need a class space.\n+  \/\/ However, as a pragmatic workaround for pesty overflow problems on 32-bit, we leave a small area\n+  \/\/ at the end of the address space out of the encoding range. We just assume no Klass will ever live\n@@ -269,2 +269,1 @@\n-  assert(!UseCompressedClassPointers ||\n-         rs.end() <= (char*)CompressedKlassPointers::max_klass_range_size(), \"Weirdly high address\");\n+  assert(rs.end() <= (char*)CompressedKlassPointers::max_klass_range_size(), \"Weirdly high address\");\n","filename":"src\/hotspot\/share\/memory\/metaspace\/virtualSpaceNode.cpp","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -83,2 +83,1 @@\n-  \/\/ after the compressed Klass* when running with compressed class-pointers\n-  \/\/ (+UseCompressedClassPointers), or else after the full Klass*.\n+  \/\/ after the compressed Klass*\n","filename":"src\/hotspot\/share\/oops\/arrayOop.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -321,16 +321,11 @@\n-  st->print_cr(\"UseCompressedClassPointers %d, UseCompactObjectHeaders %d\",\n-               UseCompressedClassPointers, UseCompactObjectHeaders);\n-  if (UseCompressedClassPointers) {\n-    st->print_cr(\"Narrow klass pointer bits %d, Max shift %d\",\n-                 _narrow_klass_pointer_bits, _max_shift);\n-    st->print_cr(\"Narrow klass base: \" PTR_FORMAT \", Narrow klass shift: %d\",\n-                  p2i(base()), shift());\n-    st->print_cr(\"Encoding Range: \" RANGE2FMT, RANGE2FMTARGS(_base, encoding_range_end()));\n-    st->print_cr(\"Klass Range:    \" RANGE2FMT, RANGE2FMTARGS(_klass_range_start, _klass_range_end));\n-    st->print_cr(\"Klass ID Range:  [%u - %u) (%u)\", _lowest_valid_narrow_klass_id, _highest_valid_narrow_klass_id + 1,\n-                 _highest_valid_narrow_klass_id + 1 - _lowest_valid_narrow_klass_id);\n-    if (_protection_zone_size > 0) {\n-      st->print_cr(\"Protection zone: \" RANGEFMT, RANGEFMTARGS(_base, _protection_zone_size));\n-    } else {\n-      st->print_cr(\"No protection zone.\");\n-    }\n+  st->print_cr(\"UseCompactObjectHeaders %d\", UseCompactObjectHeaders);\n+  st->print_cr(\"Narrow klass pointer bits %d, Max shift %d\",\n+               _narrow_klass_pointer_bits, _max_shift);\n+  st->print_cr(\"Narrow klass base: \" PTR_FORMAT \", Narrow klass shift: %d\",\n+                p2i(base()), shift());\n+  st->print_cr(\"Encoding Range: \" RANGE2FMT, RANGE2FMTARGS(_base, encoding_range_end()));\n+  st->print_cr(\"Klass Range:    \" RANGE2FMT, RANGE2FMTARGS(_klass_range_start, _klass_range_end));\n+  st->print_cr(\"Klass ID Range:  [%u - %u) (%u)\", _lowest_valid_narrow_klass_id, _highest_valid_narrow_klass_id + 1,\n+               _highest_valid_narrow_klass_id + 1 - _lowest_valid_narrow_klass_id);\n+  if (_protection_zone_size > 0) {\n+    st->print_cr(\"Protection zone: \" RANGEFMT, RANGEFMTARGS(_base, _protection_zone_size));\n@@ -338,1 +333,1 @@\n-    st->print_cr(\"UseCompressedClassPointers off\");\n+    st->print_cr(\"No protection zone.\");\n","filename":"src\/hotspot\/share\/oops\/compressedKlass.cpp","additions":12,"deletions":17,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -101,1 +101,0 @@\n-\/\/ For UseCompressedClassPointers.\n@@ -164,1 +163,0 @@\n-  \/\/      - UseCompressedClassPointers\n","filename":"src\/hotspot\/share\/oops\/compressedKlass.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -78,1 +78,0 @@\n-  assert(UseCompressedClassPointers, \"Only call for +UseCCP\");\n@@ -87,1 +86,0 @@\n-  assert(UseCompressedClassPointers, \"Only call for +UseCCP\");\n","filename":"src\/hotspot\/share\/oops\/compressedKlass.inline.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -489,1 +489,1 @@\n-  if (ik != nullptr && UseCompressedClassPointers) {\n+  if (ik != nullptr) {\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1063,8 +1063,3 @@\n-#ifdef ASSERT\n-  if (UseCompressedClassPointers) {\n-    \/\/ Stricter checks for both correct alignment and placement\n-    CompressedKlassPointers::check_encodable(this);\n-  } else {\n-    assert(Metaspace::contains((address)this), \"Should be\");\n-  }\n-#endif \/\/ ASSERT\n+\n+  \/\/ Stricter checks for both correct alignment and placement\n+  DEBUG_ONLY(CompressedKlassPointers::check_encodable(this));\n","filename":"src\/hotspot\/share\/oops\/klass.cpp","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -45,4 +45,0 @@\n-  } else {\n-    _klass_mode = Uncompressed;\n-    _oop_base_offset_in_bytes = sizeof(markWord) + sizeof(Klass*);\n-    _oop_has_klass_gap = false;\n@@ -53,1 +49,1 @@\n-  \/\/ We support +-UseCompressedClassPointers on 32-bit, but the layout\n+  \/\/ We support narrow Klass pointers on 32-bit, but the layout\n@@ -55,1 +51,1 @@\n-  _klass_mode = UseCompressedClassPointers ? Compressed : Uncompressed;\n+  _klass_mode = Compressed;\n","filename":"src\/hotspot\/share\/oops\/objLayout.cpp","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -30,2 +30,2 @@\n- * operations that require checking UseCompressedClassPointers,\n- * UseCompactObjectHeaders and possibly more.\n+ * operations that require checking UseCompactObjectHeaders and - in the future -\n+ * possibly more.\n@@ -40,1 +40,1 @@\n-    \/\/ +UseCompactObjectHeaders (implies +UseCompressedClassPointers)\n+    \/\/ +UseCompactObjectHeaders\n@@ -42,1 +42,1 @@\n-    \/\/ +UseCompressedClassPointers (-UseCompactObjectHeaders)\n+    \/\/ -UseCompactObjectHeaders (compressed Klass pointers)\n@@ -44,2 +44,0 @@\n-    \/\/ -UseCompressedClassPointers (-UseCompactObjectHeaders)\n-    Uncompressed,\n","filename":"src\/hotspot\/share\/oops\/objLayout.hpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -35,2 +35,0 @@\n-  } else if (UseCompressedClassPointers) {\n-    assert(_klass_mode == Compressed, \"Klass mode does not match flags\");\n@@ -38,1 +36,1 @@\n-    assert(_klass_mode == Uncompressed, \"Klass mode does not match flags\");\n+    assert(_klass_mode == Compressed, \"Klass mode does not match flags\");\n","filename":"src\/hotspot\/share\/oops\/objLayout.inline.hpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -155,1 +155,0 @@\n-  assert(UseCompressedClassPointers, \"must be\");\n","filename":"src\/hotspot\/share\/oops\/oop.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -157,5 +157,1 @@\n-  if (UseCompressedClassPointers) {\n-    _metadata._compressed_klass = CompressedKlassPointers::encode_not_null(k);\n-  } else {\n-    _metadata._klass = k;\n-  }\n+  _metadata._compressed_klass = CompressedKlassPointers::encode_not_null(k);\n@@ -168,6 +164,1 @@\n-  if (UseCompressedClassPointers) {\n-    AtomicAccess::release_store((narrowKlass*)raw_mem,\n-                          CompressedKlassPointers::encode_not_null(k));\n-  } else {\n-    AtomicAccess::release_store((Klass**)raw_mem, k);\n-  }\n+  AtomicAccess::release_store((narrowKlass*)raw_mem, CompressedKlassPointers::encode_not_null(k));\n","filename":"src\/hotspot\/share\/oops\/oop.inline.hpp","additions":2,"deletions":11,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2593,1 +2593,1 @@\n-  if ((UseCompressedOops || UseCompressedClassPointers) && can_reshape && progress == nullptr) {\n+  if (can_reshape && progress == nullptr) {\n","filename":"src\/hotspot\/share\/opto\/cfgnode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2636,1 +2636,1 @@\n-                      (UseCompressedClassPointers && check->as_Mach()->ideal_Opcode() == Op_DecodeNKlass) ||\n+                      (check->as_Mach()->ideal_Opcode() == Op_DecodeNKlass) ||\n","filename":"src\/hotspot\/share\/opto\/chaitin.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3422,2 +3422,1 @@\n-    if ((UseCompressedOops || UseCompressedClassPointers) &&\n-        addp->Opcode() == Op_ConP &&\n+    if (addp->Opcode() == Op_ConP &&\n@@ -3436,1 +3435,1 @@\n-          (is_klass && UseCompressedClassPointers && Matcher::const_klass_prefer_decode() &&\n+          (is_klass && Matcher::const_klass_prefer_decode() &&\n@@ -3977,2 +3976,1 @@\n-  if ((UseCompressedOops && !Matcher::gen_narrow_oop_implicit_null_checks()) ||\n-      (!UseCompressedOops && !UseCompressedClassPointers))\n+  if (UseCompressedOops && !Matcher::gen_narrow_oop_implicit_null_checks())\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -309,2 +309,1 @@\n-        if ((UseCompressedOops && CompressedOops::shift() == 0) ||\n-            (UseCompressedClassPointers && CompressedKlassPointers::shift() == 0)) {\n+        if ((UseCompressedOops && CompressedOops::shift() == 0) || CompressedKlassPointers::shift() == 0) {\n","filename":"src\/hotspot\/share\/opto\/lcm.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2403,1 +2403,0 @@\n-    assert(UseCompressedClassPointers, \"no compressed klasses\");\n@@ -2711,2 +2710,1 @@\n-               (UseCompressedClassPointers && val->bottom_type()->isa_klassptr() &&\n-                adr->bottom_type()->isa_rawptr())) {\n+               (val->bottom_type()->isa_klassptr() && adr->bottom_type()->isa_rawptr())) {\n","filename":"src\/hotspot\/share\/opto\/memnode.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -105,1 +105,1 @@\n-  assert(UseCompressedClassPointers && t->isa_klassptr(), \"only klass ptr here\");\n+  assert(t->isa_klassptr(), \"only klass ptr here\");\n","filename":"src\/hotspot\/share\/opto\/narrowptrnode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3464,1 +3464,1 @@\n-      _is_ptr_to_narrowklass = UseCompressedClassPointers;\n+      _is_ptr_to_narrowklass = true;\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -333,1 +333,0 @@\n-  assert(UseCompressedClassPointers, \"Should only call for UseCompressedClassPointers\");\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1576,1 +1576,1 @@\n-    if (UseCompressedOops || UseCompressedClassPointers) {\n+    if (UseCompressedOops) {\n@@ -1589,1 +1589,0 @@\n-    }\n@@ -1591,3 +1590,2 @@\n-    if (UseCompressedOops) {\n-      uintptr_t heap_end = HeapBaseMinAddress + MaxHeapSize;\n-      uintptr_t max_coop_heap = max_heap_for_compressed_oops();\n+      size_t heap_end = HeapBaseMinAddress + MaxHeapSize;\n+      size_t max_coop_heap = max_heap_for_compressed_oops();\n@@ -3800,4 +3798,0 @@\n-  if (UseCompactObjectHeaders && FLAG_IS_CMDLINE(UseCompressedClassPointers) && !UseCompressedClassPointers) {\n-    warning(\"Compact object headers require compressed class pointers. Disabling compact object headers.\");\n-    FLAG_SET_DEFAULT(UseCompactObjectHeaders, false);\n-  }\n@@ -3817,3 +3811,0 @@\n-  if (UseCompactObjectHeaders && !UseCompressedClassPointers) {\n-    FLAG_SET_DEFAULT(UseCompressedClassPointers, true);\n-  }\n@@ -3835,3 +3826,1 @@\n-  if (UseCompressedClassPointers) {\n-    CompressedKlassPointers::pre_initialize();\n-  }\n+  CompressedKlassPointers::pre_initialize();\n@@ -3882,4 +3871,0 @@\n-  if (FLAG_IS_CMDLINE(CompressedClassSpaceSize) && !UseCompressedClassPointers) {\n-    warning(\"Setting CompressedClassSpaceSize has no effect when compressed class pointers are not used\");\n-  }\n-\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":4,"deletions":19,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -1397,3 +1397,0 @@\n-  product(bool, UseCompressedClassPointers, true,                           \\\n-          \"(Deprecated) Use 32-bit class pointers.\")                        \\\n-                                                                            \\\n","filename":"src\/hotspot\/share\/runtime\/globals.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1299,1 +1299,1 @@\n-  if (UseCompressedClassPointers && CompressedKlassPointers::is_in_protection_zone(addr)) {\n+  if (CompressedKlassPointers::is_in_protection_zone(addr)) {\n@@ -1353,0 +1353,1 @@\n+  \/\/ Todo: questionable for COH - can we do this better?\n@@ -1354,1 +1355,1 @@\n-  if (UseCompressedClassPointers && ((uintptr_t)addr &~ (uintptr_t)max_juint) == 0) {\n+  if (((uintptr_t)addr &~ (uintptr_t)max_juint) == 0) {\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -116,5 +116,3 @@\n-  if (UseCompressedClassPointers) {\n-    _compressed_class_pool = new CompressedKlassSpacePool();\n-    mgr->add_pool(_compressed_class_pool);\n-    _pools_list->append(_compressed_class_pool);\n-  }\n+  _compressed_class_pool = new CompressedKlassSpacePool();\n+  mgr->add_pool(_compressed_class_pool);\n+  _pools_list->append(_compressed_class_pool);\n","filename":"src\/hotspot\/share\/services\/memoryService.cpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -537,2 +537,1 @@\n-                 UseCompactObjectHeaders ? \", compact obj headers\"\n-                                         : (UseCompressedClassPointers ? \", compressed class ptrs\" : \"\"),\n+                 UseCompactObjectHeaders ? \", compact obj headers\" : \"\",\n@@ -1214,1 +1213,1 @@\n-  STEP_IF(\"printing compressed klass pointers mode\", _verbose && UseCompressedClassPointers)\n+  STEP_IF(\"printing compressed klass pointers mode\", _verbose)\n@@ -1429,6 +1428,4 @@\n-  if (UseCompressedClassPointers) {\n-    CDS_ONLY(AOTMetaspace::print_on(st);)\n-    Metaspace::print_compressed_class_space(st);\n-    CompressedKlassPointers::print_mode(st);\n-    st->cr();\n-  }\n+  CDS_ONLY(AOTMetaspace::print_on(st);)\n+  Metaspace::print_compressed_class_space(st);\n+  CompressedKlassPointers::print_mode(st);\n+  st->cr();\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -86,2 +86,0 @@\n-    } else if (VM.getVM().isCompressedKlassPointersEnabled()) {\n-      lengthOffsetInBytes = typeSize - VM.getVM().getIntSize();\n@@ -89,1 +87,1 @@\n-      lengthOffsetInBytes = typeSize;\n+      lengthOffsetInBytes = typeSize - VM.getVM().getIntSize();\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/oops\/Array.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,2 +60,0 @@\n-    } else if (VM.getVM().isCompressedKlassPointersEnabled()) {\n-      return typeSize - VM.getVM().getIntSize();\n@@ -63,1 +61,1 @@\n-      return typeSize;\n+      return typeSize - VM.getVM().getIntSize();\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/oops\/Instance.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -86,1 +86,0 @@\n-      assert(VM.getVM().isCompressedKlassPointersEnabled());\n@@ -88,2 +87,0 @@\n-    } else if (VM.getVM().isCompressedKlassPointersEnabled()) {\n-      return (Klass)compressedKlass.getValue(getHandle());\n@@ -91,1 +88,1 @@\n-      return (Klass)klass.getValue(getHandle());\n+      return (Klass)compressedKlass.getValue(getHandle());\n@@ -160,5 +157,1 @@\n-        if (VM.getVM().isCompressedKlassPointersEnabled()) {\n-          visitor.doMetadata(compressedKlass, true);\n-        } else {\n-          visitor.doMetadata(klass, true);\n-        }\n+        visitor.doMetadata(compressedKlass, true);\n@@ -223,2 +216,0 @@\n-    } else if (VM.getVM().isCompressedKlassPointersEnabled()) {\n-      return (Klass)Metadata.instantiateWrapperFor(handle.getCompKlassAddressAt(compressedKlass.getOffset()));\n@@ -226,1 +217,1 @@\n-      return (Klass)Metadata.instantiateWrapperFor(handle.getAddressAt(klass.getOffset()));\n+      return (Klass)Metadata.instantiateWrapperFor(handle.getCompKlassAddressAt(compressedKlass.getOffset()));\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/oops\/Oop.java","additions":4,"deletions":13,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -147,1 +147,0 @@\n-  private Boolean compressedKlassPointersEnabled;\n@@ -518,5 +517,1 @@\n-    if (isCompressedKlassPointersEnabled()) {\n-      klassPtrSize = (int)getIntSize();\n-    } else {\n-      klassPtrSize = (int)getOopSize(); \/\/ same as an oop\n-    }\n+    klassPtrSize = (int)getIntSize();\n@@ -941,9 +936,0 @@\n-  public boolean isCompressedKlassPointersEnabled() {\n-    if (compressedKlassPointersEnabled == null) {\n-        Flag flag = getCommandLineFlag(\"UseCompressedClassPointers\");\n-        compressedKlassPointersEnabled = (flag == null) ? Boolean.FALSE:\n-             (flag.getBool()? Boolean.TRUE: Boolean.FALSE);\n-    }\n-    return compressedKlassPointersEnabled.booleanValue();\n-  }\n-\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/VM.java","additions":1,"deletions":15,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n-  if (UseCompressedClassPointers && CompressedKlassPointers::needs_class_space()) {\n+  if (CompressedKlassPointers::needs_class_space()) {\n@@ -63,1 +63,1 @@\n-  if (UseCompressedClassPointers && CompressedKlassPointers::needs_class_space()) {\n+  if (CompressedKlassPointers::needs_class_space()) {\n@@ -72,15 +72,0 @@\n-TEST_VM(metaspace, MetaspaceUtils_non_compressed_class_pointers) {\n-  if (UseCompressedClassPointers) {\n-    return;\n-  }\n-\n-  size_t committed_class = MetaspaceUtils::committed_bytes(Metaspace::ClassType);\n-  EXPECT_EQ(committed_class, 0UL);\n-\n-  size_t used_class = MetaspaceUtils::used_bytes(Metaspace::ClassType);\n-  EXPECT_EQ(used_class, 0UL);\n-\n-  size_t reserved_class = MetaspaceUtils::reserved_bytes(Metaspace::ClassType);\n-  EXPECT_EQ(reserved_class, 0UL);\n-}\n-\n@@ -105,1 +90,1 @@\n-  if (CompressedKlassPointers::needs_class_space() && UseCompressedClassPointers) {\n+  if (CompressedKlassPointers::needs_class_space()) {\n","filename":"test\/hotspot\/gtest\/metaspace\/test_metaspaceUtils.cpp","additions":3,"deletions":18,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -100,1 +100,1 @@\n-  } else if (UseCompressedClassPointers) {\n+  } else {\n@@ -111,16 +111,0 @@\n-  } else {\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_BOOLEAN), 20);\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_BYTE),    20);\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_SHORT),   20);\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_CHAR),    20);\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_INT),     20);\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_FLOAT),   20);\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_LONG),    24);\n-    EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_DOUBLE),  24);\n-    if (UseCompressedOops) {\n-      EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_OBJECT), 20);\n-      EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_ARRAY),  20);\n-    } else {\n-      EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_OBJECT), 24);\n-      EXPECT_EQ(arrayOopDesc::base_offset_in_bytes(T_ARRAY),  24);\n-    }\n","filename":"test\/hotspot\/gtest\/oops\/test_arrayOop.cpp","additions":1,"deletions":17,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -32,3 +32,0 @@\n-  if (!UseCompressedClassPointers) {\n-    return;\n-  }\n@@ -58,12 +55,0 @@\n-TEST_VM(CompressedKlass, ccp_off) {\n-  if (UseCompressedClassPointers) {\n-    return;\n-  }\n-  ASSERT_EQ(CompressedKlassPointers::klass_range_start(), (address)nullptr);\n-  ASSERT_EQ(CompressedKlassPointers::klass_range_end(), (address)nullptr);\n-  \/\/ We should be able to call CompressedKlassPointers::is_encodable, and it should\n-  \/\/ always return false\n-  ASSERT_FALSE(CompressedKlassPointers::is_encodable((address)0x12345));\n-}\n-\n-\n@@ -71,3 +56,0 @@\n-  if (!UseCompressedClassPointers) {\n-    return;\n-  }\n@@ -81,3 +63,0 @@\n-  if (!UseCompressedClassPointers) {\n-    return;\n-  }\n@@ -91,3 +70,0 @@\n-  if (!UseCompressedClassPointers) {\n-    return;\n-  }\n@@ -107,3 +83,0 @@\n-  if (!UseCompressedClassPointers) {\n-    return;\n-  }\n@@ -118,3 +91,0 @@\n-  if (!UseCompressedClassPointers) {\n-    return;\n-  }\n","filename":"test\/hotspot\/gtest\/oops\/test_compressedKlass.cpp","additions":0,"deletions":30,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-    int objal; bool ccp; bool coops; bool coh; int result;\n+    int objal; bool coops; bool coh; int result;\n@@ -32,1 +32,1 @@\n-\/\/    ObjAligInB, UseCCP, UseCoops, UseCOH, object size in heap words\n+\/\/    ObjAligInB, UseCoops, UseCOH, object size in heap words\n@@ -34,18 +34,12 @@\n-    { 8,          false,  false, false,   4 },  \/\/ 20 byte header, 8 byte oops\n-    { 8,          false,  true,  false,   3 },  \/\/ 20 byte header, 4 byte oops\n-    { 8,          true,   false, false,   3 },  \/\/ 16 byte header, 8 byte oops\n-    { 8,          true,   true,  false,   3 },  \/\/ 16 byte header, 4 byte oops\n-    { 8,          true,   false, true,    3 },  \/\/ 12 byte header, 8 byte oops\n-    { 8,          true,   true,  true,    2 },  \/\/ 12 byte header, 4 byte oops\n-    { 16,         false,  false, false,   4 },  \/\/ 20 byte header, 8 byte oops, 16-byte align\n-    { 16,         false,  true,  false,   4 },  \/\/ 20 byte header, 4 byte oops, 16-byte align\n-    { 16,         true,   false, false,   4 },  \/\/ 16 byte header, 8 byte oops, 16-byte align\n-    { 16,         true,   true,  false,   4 },  \/\/ 16 byte header, 4 byte oops, 16-byte align\n-    { 16,         true,   false, true,    4 },  \/\/ 12 byte header, 8 byte oops, 16-byte align\n-    { 16,         true,   true,  true,    2 },  \/\/ 12 byte header, 4 byte oops, 16-byte align\n-    { 256,        false,  false, false,  32 }, \/\/ 20 byte header, 8 byte oops, 256-byte align\n-    { 256,        false,  true,  false,  32 }, \/\/ 20 byte header, 4 byte oops, 256-byte align\n-    { 256,        true,   false, false,  32 }, \/\/ 16 byte header, 8 byte oops, 256-byte align\n-    { 256,        true,   true,  false,  32 }, \/\/ 16 byte header, 4 byte oops, 256-byte align\n-    { 256,        true,   false, true,   32 }, \/\/ 12 byte header, 8 byte oops, 256-byte align\n-    { 256,        true,   true,  true,   32 }, \/\/ 12 byte header, 4 byte oops, 256-byte align\n+    { 8,          false, false,   3 },  \/\/ 16 byte header, 8 byte oops\n+    { 8,          true,  false,   3 },  \/\/ 16 byte header, 4 byte oops\n+    { 8,          false, true,    3 },  \/\/ 12 byte header, 8 byte oops\n+    { 8,          true,  true,    2 },  \/\/ 12 byte header, 4 byte oops\n+    { 16,         false, false,   4 },  \/\/ 16 byte header, 8 byte oops, 16-byte align\n+    { 16,         true,  false,   4 },  \/\/ 16 byte header, 4 byte oops, 16-byte align\n+    { 16,         false, true,    4 },  \/\/ 12 byte header, 8 byte oops, 16-byte align\n+    { 16,         true,  true,    2 },  \/\/ 12 byte header, 4 byte oops, 16-byte align\n+    { 256,        false, false,  32 }, \/\/ 16 byte header, 8 byte oops, 256-byte align\n+    { 256,        true,  false,  32 }, \/\/ 16 byte header, 4 byte oops, 256-byte align\n+    { 256,        false, true,   32 }, \/\/ 12 byte header, 8 byte oops, 256-byte align\n+    { 256,        true,  true,   32 }, \/\/ 12 byte header, 4 byte oops, 256-byte align\n@@ -53,1 +47,1 @@\n-    { 8,          false,  false, false,   4 }, \/\/ 12 byte header, 4 byte oops, wordsize 4\n+    { 8,          false, false,   4 }, \/\/ 12 byte header, 4 byte oops, wordsize 4\n@@ -55,1 +49,1 @@\n-    { -1,         false,  false, false,  -1 }\n+    { -1,         false, false,  -1 }\n@@ -58,1 +52,1 @@\n-    if (x[i].objal == (int)ObjectAlignmentInBytes && x[i].ccp == UseCompressedClassPointers && x[i].coops == UseCompressedOops &&\n+    if (x[i].objal == (int)ObjectAlignmentInBytes && x[i].coops == UseCompressedOops &&\n","filename":"test\/hotspot\/gtest\/oops\/test_objArrayOop.cpp","additions":17,"deletions":23,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,4 +37,0 @@\n- * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions -XX:-UseCompressedClassPointers -Xmx128m\n- *                   -XX:CompileCommand=compileonly,compiler.arraycopy.TestObjectArrayClone::testClone*\n- *                   -XX:CompileCommand=compileonly,jdk.internal.reflect.GeneratedMethodAccessor*::invoke\n- *                   compiler.arraycopy.TestObjectArrayClone\n","filename":"test\/hotspot\/jtreg\/compiler\/arraycopy\/TestObjectArrayClone.java","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,1 @@\n- * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -Xcomp -XX:-UseCompressedClassPointers -XX:CompileOnly=TestArrayCopyToFromObject::test TestArrayCopyToFromObject\n- * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -Xcomp -XX:+UseCompressedClassPointers -XX:CompileOnly=TestArrayCopyToFromObject::test TestArrayCopyToFromObject\n+ * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -Xcomp -XX:CompileOnly=TestArrayCopyToFromObject::test TestArrayCopyToFromObject\n","filename":"test\/hotspot\/jtreg\/compiler\/c1\/TestArrayCopyToFromObject.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1,63 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @bug 8330795\n- * @summary Check that Reduce Allocation Merges doesn't crash when CompressedClassPointers\n- *          is disabled and there is an access to Klass \"field\" through the phi.\n- * @requires vm.bits == 64 & vm.flagless & vm.compiler2.enabled & vm.opt.final.EliminateAllocations\n- * @run main\/othervm -XX:CompileCommand=dontinline,*TestReduceAllocationAndLoadKlass*::test\n- *                   -XX:CompileCommand=compileonly,*TestReduceAllocationAndLoadKlass*::test\n- *                   -XX:CompileCommand=compileonly,*Shape*::*init*\n- *                   -XX:CompileCommand=compileonly,*Point*::*init*\n- *                   -XX:CompileCommand=exclude,*TestReduceAllocationAndLoadKlass*::dummy\n- *                   -XX:-TieredCompilation\n- *                   -XX:-UseCompressedClassPointers\n- *                   -Xbatch\n- *                   -Xcomp\n- *                   compiler.c2.TestReduceAllocationAndLoadKlass\n- *\/\n-\n-package compiler.c2;\n-\n-public class TestReduceAllocationAndLoadKlass {\n-    public static void main(String[] args) {\n-        Point p = new Point();\n-        Line q = new Line();\n-\n-        test(true);\n-        test(false);\n-    }\n-\n-    static Class test(boolean cond) {\n-        Object p = cond ? dummy() : new Line();\n-        return p.getClass();\n-    }\n-\n-    static Point dummy() { return new Point(); }\n-\n-    static class Shape { }\n-    static class Point extends Shape { }\n-    static class Line extends Shape { }\n-}\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/TestReduceAllocationAndLoadKlass.java","additions":0,"deletions":63,"binary":false,"changes":63,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,1 +49,0 @@\n-                                             \"-XX:+UseCompressedClassPointers\",\n@@ -56,13 +55,1 @@\n-        Scenario scenario1 = new Scenario(1, \"-XX:+UnlockDiagnosticVMOptions\",\n-                                             \"-XX:+ReduceAllocationMerges\",\n-                                             \"-XX:+TraceReduceAllocationMerges\",\n-                                             \"-XX:+DeoptimizeALot\",\n-                                             \"-XX:+UseCompressedOops\",\n-                                             \"-XX:-UseCompressedClassPointers\",\n-                                             \"-XX:CompileCommand=inline,*::charAt*\",\n-                                             \"-XX:CompileCommand=inline,*PicturePositions::*\",\n-                                             \"-XX:CompileCommand=inline,*Point::*\",\n-                                             \"-XX:CompileCommand=inline,*Nested::*\",\n-                                             \"-XX:CompileCommand=exclude,*::dummy*\");\n-\n-        Scenario scenario2 = new Scenario(2, \"-XX:+UnlockDiagnosticVMOptions\",\n+        Scenario scenario1 = new Scenario(2, \"-XX:+UnlockDiagnosticVMOptions\",\n@@ -79,1 +66,1 @@\n-        Scenario scenario3 = new Scenario(3, \"-XX:+UnlockDiagnosticVMOptions\",\n+        Scenario scenario2 = new Scenario(3, \"-XX:+UnlockDiagnosticVMOptions\",\n@@ -84,1 +71,0 @@\n-                                             \"-XX:+UseCompressedClassPointers\",\n@@ -93,1 +79,1 @@\n-        framework.addScenarios(scenario0, scenario1, scenario2, scenario3).start();\n+        framework.addScenarios(scenario0, scenario1, scenario2).start();\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/scalarReplacement\/AllocationMergesTests.java","additions":4,"deletions":18,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -162,1 +162,0 @@\n-            \/\/ = WB.getBooleanVMFlag(\"UseCompressedClassPointers\");\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/compilerToVM\/GetResolvedJavaTypeTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -122,1 +122,0 @@\n-        Assume.assumeTrue(config.useCompressedClassPointers);\n@@ -147,1 +146,0 @@\n-        Assume.assumeTrue(config.useCompressedClassPointers);\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/jdk.vm.ci.code.test\/src\/jdk\/vm\/ci\/code\/test\/DataPatchTest.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -39,1 +39,0 @@\n-    public final boolean useCompressedClassPointers = getFlag(\"UseCompressedClassPointers\", Boolean.class);\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/jdk.vm.ci.code.test\/src\/jdk\/vm\/ci\/code\/test\/TestHotSpotVMConfig.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -33,3 +33,0 @@\n- * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions -XX:-TieredCompilation -XX:-UseOnStackReplacement -XX:-BackgroundCompilation\n- *                   -XX:CompileOnly=TestCheckCastPPBecomesTOP::test1 -XX:LoopMaxUnroll=0\n- *                   -XX:CompileCommand=dontinline,TestCheckCastPPBecomesTOP::notInlined -XX:+UseParallelGC -XX:-UseCompressedClassPointers TestCheckCastPPBecomesTOP\n","filename":"test\/hotspot\/jtreg\/compiler\/types\/TestCheckCastPPBecomesTOP.java","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -250,1 +250,1 @@\n-                \"-XX:+UseCompressedOops\", \"-XX:+UseCompressedClassPointers\",\n+                \"-XX:+UseCompressedOops\",\n@@ -257,15 +257,1 @@\n-                \"-XX:+UseCompressedOops\", \"-XX:-UseCompressedClassPointers\",\n-                \"-XX:CompileCommand=dontinline,compiler.unsafe.OpaqueAccesses::test*\"\n-        );\n-        TestFramework.runWithFlags(\n-                \"--add-exports=java.base\/jdk.internal.misc=ALL-UNNAMED\",\n-                \"-XX:+IgnoreUnrecognizedVMOptions\", \"-XX:+UnlockDiagnosticVMOptions\",\n-                \"-XX:-TieredCompilation\", \"-Xbatch\",\n-                \"-XX:-UseCompressedOops\", \"-XX:+UseCompressedClassPointers\",\n-                \"-XX:CompileCommand=dontinline,compiler.unsafe.OpaqueAccesses::test*\"\n-        );\n-        TestFramework.runWithFlags(\n-                \"--add-exports=java.base\/jdk.internal.misc=ALL-UNNAMED\",\n-                \"-XX:+IgnoreUnrecognizedVMOptions\", \"-XX:+UnlockDiagnosticVMOptions\",\n-                \"-XX:-TieredCompilation\", \"-Xbatch\",\n-                \"-XX:-UseCompressedOops\", \"-XX:-UseCompressedClassPointers\",\n+                \"-XX:-UseCompressedOops\",\n","filename":"test\/hotspot\/jtreg\/compiler\/unsafe\/OpaqueAccesses.java","additions":3,"deletions":17,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -1,53 +0,0 @@\n-\/*\n- * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package gc.arguments;\n-\n-import jdk.test.lib.process.OutputAnalyzer;\n-import jdk.test.lib.Platform;\n-\n-\/*\n- * @test\n- * @bug 8015107\n- * @summary Tests that VM prints a warning when -XX:CompressedClassSpaceSize\n- *          is used together with -XX:-UseCompressedClassPointers\n- * @library \/test\/lib\n- * @library \/\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @requires vm.opt.CompressedClassSpaceSize == null & vm.opt.UseCompressedClassPointers == null\n- * @run driver gc.arguments.TestCompressedClassFlags\n- *\/\n-public class TestCompressedClassFlags {\n-    public static void main(String[] args) throws Exception {\n-        if (Platform.is64bit()) {\n-            OutputAnalyzer output = GCArguments.executeTestJava(\n-                \"-XX:CompressedClassSpaceSize=1g\",\n-                \"-XX:-UseCompressedClassPointers\",\n-                \"-version\");\n-            output.shouldContain(\"warning\");\n-            output.shouldNotContain(\"error\");\n-            output.shouldHaveExitValue(0);\n-        }\n-    }\n-}\n","filename":"test\/hotspot\/jtreg\/gc\/arguments\/TestCompressedClassFlags.java","additions":0,"deletions":53,"binary":false,"changes":53,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,1 @@\n-          dump_args.addAll(0, Arrays.asList(new String[] { \"-XX:+UseCompressedClassPointers\", \"-XX:+UseCompressedOops\" }));\n+          dump_args.addFirst(\"-XX:+UseCompressedOops\" );\n@@ -69,1 +69,1 @@\n-                load_args.addAll(0, Arrays.asList(new String[] { \"-XX:+UseCompressedClassPointers\", \"-XX:+UseCompressedOops\" }));\n+                dump_args.addFirst(\"-XX:+UseCompressedOops\" );\n","filename":"test\/hotspot\/jtreg\/gc\/g1\/TestSharedArchiveWithPreTouch.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,4 +40,3 @@\n- * @run main\/othervm -XX:-UseCompressedOops gc.metaspace.TestMetaspaceMemoryPool\n- * @run main\/othervm -XX:-UseCompressedOops -XX:MaxMetaspaceSize=60m gc.metaspace.TestMetaspaceMemoryPool\n- * @run main\/othervm -XX:+UseCompressedOops -XX:+UseCompressedClassPointers gc.metaspace.TestMetaspaceMemoryPool\n- * @run main\/othervm -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:CompressedClassSpaceSize=60m gc.metaspace.TestMetaspaceMemoryPool\n+ * @run main\/othervm gc.metaspace.TestMetaspaceMemoryPool\n+ * @run main\/othervm -XX:MaxMetaspaceSize=60m gc.metaspace.TestMetaspaceMemoryPool\n+ * @run main\/othervm -XX:CompressedClassSpaceSize=60m gc.metaspace.TestMetaspaceMemoryPool\n@@ -54,4 +53,2 @@\n-            if (InputArguments.contains(\"-XX:+UseCompressedOops\")) {\n-                MemoryPoolMXBean cksPool = getMemoryPool(\"Compressed Class Space\");\n-                verifyMemoryPool(cksPool, true);\n-            }\n+            MemoryPoolMXBean cksPool = getMemoryPool(\"Compressed Class Space\");\n+            verifyMemoryPool(cksPool, true);\n","filename":"test\/hotspot\/jtreg\/gc\/metaspace\/TestMetaspaceMemoryPool.java","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,2 +51,1 @@\n- * @run main\/othervm -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+UsePerfData -XX:+UseSerialGC gc.metaspace.TestMetaspacePerfCounters\n- * @run main\/othervm -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:+UsePerfData -XX:+UseSerialGC gc.metaspace.TestMetaspacePerfCounters\n+ * @run main\/othervm -XX:+UseCompressedOops -XX:+UsePerfData -XX:+UseSerialGC gc.metaspace.TestMetaspacePerfCounters\n@@ -66,2 +65,1 @@\n- * @run main\/othervm -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+UsePerfData -XX:+UseParallelGC gc.metaspace.TestMetaspacePerfCounters\n- * @run main\/othervm -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:+UsePerfData -XX:+UseParallelGC gc.metaspace.TestMetaspacePerfCounters\n+ * @run main\/othervm -XX:+UseCompressedOops -XX:+UsePerfData -XX:+UseParallelGC gc.metaspace.TestMetaspacePerfCounters\n@@ -81,2 +79,1 @@\n- * @run main\/othervm -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+UsePerfData -XX:+UseG1GC gc.metaspace.TestMetaspacePerfCounters\n- * @run main\/othervm -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:+UsePerfData -XX:+UseG1GC gc.metaspace.TestMetaspacePerfCounters\n+ * @run main\/othervm -XX:+UseCompressedOops -XX:+UsePerfData -XX:+UseG1GC gc.metaspace.TestMetaspacePerfCounters\n@@ -96,2 +93,1 @@\n- * @run main\/othervm -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+UsePerfData -XX:+UseShenandoahGC gc.metaspace.TestMetaspacePerfCounters\n- * @run main\/othervm -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:+UsePerfData -XX:+UseShenandoahGC gc.metaspace.TestMetaspacePerfCounters\n+ * @run main\/othervm -XX:+UseCompressedOops -XX:+UsePerfData -XX:+UseShenandoahGC gc.metaspace.TestMetaspacePerfCounters\n@@ -111,2 +107,1 @@\n- * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+UsePerfData -XX:+UseEpsilonGC gc.metaspace.TestMetaspacePerfCounters\n- * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:+UsePerfData -XX:+UseEpsilonGC gc.metaspace.TestMetaspacePerfCounters\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseCompressedOops  -XX:+UsePerfData -XX:+UseEpsilonGC gc.metaspace.TestMetaspacePerfCounters\n@@ -230,8 +225,2 @@\n-\n-        if (isUsingCompressedClassPointers()) {\n-            checkPerfCounters(ccs);\n-            checkUsedIncreasesWhenLoadingClass(ccs);\n-        } else {\n-            checkEmptyPerfCounters(ccs);\n-            checkUsedIncreasesWhenLoadingClass(metaspace);\n-        }\n+        checkPerfCounters(ccs);\n+        checkUsedIncreasesWhenLoadingClass(ccs);\n@@ -265,7 +254,0 @@\n-    private static void checkEmptyPerfCounters(String ns) throws Exception {\n-        for (PerfCounter counter : countersInNamespace(ns)) {\n-            String msg = \"Expected \" + counter.getName() + \" to equal 0\";\n-            assertEQ(counter.longValue(), 0L, msg);\n-        }\n-    }\n-\n@@ -299,3 +281,0 @@\n-    private static boolean isUsingCompressedClassPointers() {\n-        return Platform.is64bit() && InputArguments.contains(\"-XX:+UseCompressedClassPointers\");\n-    }\n","filename":"test\/hotspot\/jtreg\/gc\/metaspace\/TestMetaspacePerfCounters.java","additions":8,"deletions":29,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,2 +43,1 @@\n- * @run main\/othervm -Xlog:class+load,class+unload=trace -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+UseSerialGC -XX:+UsePerfData -Xint gc.metaspace.TestPerfCountersAndMemoryPools\n- * @run main\/othervm -Xlog:class+load,class+unload=trace -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:+UseSerialGC -XX:+UsePerfData -Xint gc.metaspace.TestPerfCountersAndMemoryPools\n+ * @run main\/othervm -Xlog:class+load,class+unload=trace -XX:+UseCompressedOops -XX:+UseSerialGC -XX:+UsePerfData -Xint gc.metaspace.TestPerfCountersAndMemoryPools\n@@ -63,1 +62,1 @@\n-        if (InputArguments.contains(\"-XX:+UseCompressedClassPointers\") && Platform.is64bit()) {\n+        if (Platform.is64bit()) {\n","filename":"test\/hotspot\/jtreg\/gc\/metaspace\/TestPerfCountersAndMemoryPools.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,2 +38,1 @@\n- * @run driver gc.metaspace.TestSizeTransitions false -XX:+UseSerialGC\n- * @run driver gc.metaspace.TestSizeTransitions true  -XX:+UseSerialGC\n+ * @run driver gc.metaspace.TestSizeTransitions -XX:+UseSerialGC\n@@ -46,2 +45,1 @@\n- * @run driver gc.metaspace.TestSizeTransitions false -XX:+UseParallelGC\n- * @run driver gc.metaspace.TestSizeTransitions true  -XX:+UseParallelGC\n+ * @run driver gc.metaspace.TestSizeTransitions -XX:+UseParallelGC\n@@ -54,2 +52,1 @@\n- * @run driver gc.metaspace.TestSizeTransitions false -XX:+UseG1GC\n- * @run driver gc.metaspace.TestSizeTransitions true  -XX:+UseG1GC\n+ * @run driver gc.metaspace.TestSizeTransitions -XX:+UseG1GC\n@@ -79,1 +76,1 @@\n-  private static final String NO_COMPRESSED_KLASS_POINTERS_REGEX =\n+  private static final String WITHOUT_CLASS_SPACE_REGEX =\n@@ -85,1 +82,1 @@\n-  private static final String COMPRESSED_KLASS_POINTERS_REGEX =\n+  private static final String WITH_CLASS_SPACE_REGEX =\n@@ -93,3 +90,2 @@\n-    \/\/ args: <use-coops> <gc-arg>\n-    if (args.length != 2) {\n-      throw new RuntimeException(\"wrong number of args: \" + args.length);\n+    if (args.length == 0) {\n+      throw new RuntimeException(\"expected jvm args: \" + args.length);\n@@ -98,15 +94,1 @@\n-    final boolean hasCompressedKlassPointers = Platform.is64bit();\n-    final boolean useCompressedKlassPointers = Boolean.parseBoolean(args[0]);\n-    final String gcArg = args[1];\n-\n-    if (!hasCompressedKlassPointers && useCompressedKlassPointers) {\n-       \/\/ No need to run this configuration.\n-       System.out.println(\"Skipping test.\");\n-       return;\n-    }\n-\n-    List<String> jvmArgs = new ArrayList<>();\n-    if (hasCompressedKlassPointers) {\n-      jvmArgs.add(useCompressedKlassPointers ? \"-XX:+UseCompressedClassPointers\" : \"-XX:-UseCompressedClassPointers\");\n-    }\n-    jvmArgs.add(gcArg);\n+    List<String> jvmArgs = new ArrayList<>(List.of(args));\n@@ -126,3 +108,5 @@\n-    if (useCompressedKlassPointers) {\n-      output.stdoutShouldMatch(COMPRESSED_KLASS_POINTERS_REGEX);\n-      output.stdoutShouldNotMatch(NO_COMPRESSED_KLASS_POINTERS_REGEX);\n+    \/\/ 32-bit uses narrow Pointers but no class space\n+    final boolean hasClassSpace = Platform.is64bit();\n+    if (hasClassSpace) {\n+      output.stdoutShouldMatch(WITH_CLASS_SPACE_REGEX);\n+      output.stdoutShouldNotMatch(WITHOUT_CLASS_SPACE_REGEX);\n@@ -130,2 +114,2 @@\n-      output.stdoutShouldMatch(NO_COMPRESSED_KLASS_POINTERS_REGEX);\n-      output.stdoutShouldNotMatch(COMPRESSED_KLASS_POINTERS_REGEX);\n+      output.stdoutShouldMatch(WITHOUT_CLASS_SPACE_REGEX);\n+      output.stdoutShouldNotMatch(WITH_CLASS_SPACE_REGEX);\n","filename":"test\/hotspot\/jtreg\/gc\/metaspace\/TestSizeTransitions.java","additions":16,"deletions":32,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -29,2 +29,2 @@\n-\/* @test id=with-coops-with-ccp\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n+\/* @test id=with-coops\n+ * @summary Run object array size tests with compressed oops\n@@ -34,1 +34,1 @@\n- * @run main\/native GTestWrapper --gtest_filter=arrayOop -XX:+UseCompressedClassPointers -XX:+UseCompressedOops\n+ * @run main\/native GTestWrapper --gtest_filter=arrayOop -XX:+UseCompressedOops\n@@ -36,16 +36,3 @@\n-\/* @test id=with-coops-no-ccp\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @run main\/native GTestWrapper --gtest_filter=arrayOop -XX:-UseCompressedClassPointers -XX:+UseCompressedOops\n- *\/\n-\/* @test id=no-coops-with-ccp\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @run main\/native GTestWrapper --gtest_filter=arrayOop -XX:+UseCompressedClassPointers -XX:-UseCompressedOops\n- *\/\n-\/* @test id=no-coops-no-ccp\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n+\n+\/* @test id=no-coops\n+ * @summary Run object array size tests with compressed oops\n@@ -55,1 +42,1 @@\n- * @run main\/native GTestWrapper --gtest_filter=arrayOop -XX:-UseCompressedClassPointers -XX:-UseCompressedOops\n+ * @run main\/native GTestWrapper --gtest_filter=arrayOop -XX:-UseCompressedOops\n","filename":"test\/hotspot\/jtreg\/gtest\/ArrayTests.java","additions":7,"deletions":20,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,8 +42,0 @@\n-\/* @test id=ccp_off\n- * @library \/test\/lib\n- * @requires vm.bits == \"64\"\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @run main\/native GTestWrapper --gtest_filter=CompressedKlass* -XX:-UseCompressedClassPointers -Xlog:metaspace* -Xmx6g -Xms128m\n- *\/\n-\n","filename":"test\/hotspot\/jtreg\/gtest\/CompressedKlassGtest.java","additions":1,"deletions":9,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,9 +43,0 @@\n-\/* @test id=no-ccs\n- * @summary Run metaspace-related gtests with compressed class pointers off\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @requires vm.bits == 64\n- * @requires vm.flagless\n- * @run main\/native GTestWrapper --gtest_filter=metaspace* -XX:+UnlockDiagnosticVMOptions -XX:-UseCompressedClassPointers\n- *\/\n","filename":"test\/hotspot\/jtreg\/gtest\/MetaspaceGtests.java","additions":1,"deletions":10,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-\/* @test id=with-coops-with-ccp\n+\/* @test id=with-coops\n@@ -34,22 +34,1 @@\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:+UseCompressedClassPointers -XX:+UseCompressedOops\n- *\/\n-\/* @test id=with-coops-no-ccp\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:-UseCompressedClassPointers -XX:+UseCompressedOops\n- *\/\n-\/* @test id=no-coops-with-ccp\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:+UseCompressedClassPointers -XX:-UseCompressedOops\n- *\/\n-\/* @test id=no-coops-no-ccp\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:-UseCompressedClassPointers -XX:-UseCompressedOops\n+ * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:+UseCompressedOops\n@@ -58,1 +37,1 @@\n-\/* @test id=with-coops-with-ccp-large-align\n+\/* @test id=no-coops\n@@ -63,1 +42,1 @@\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:ObjAlignmentInBytes=256\n+ * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:-UseCompressedOops\n@@ -65,8 +44,2 @@\n-\/* @test id=with-coops-no-ccp-large-align\n- * @summary Run object array size tests with compressed oops and compressed class pointers\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.xml\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:-UseCompressedClassPointers -XX:+UseCompressedOops -XX:ObjAlignmentInBytes=256\n- *\/\n-\/* @test id=no-coops-with-ccp-large-align\n+\n+\/* @test id=with-coops-large-align\n@@ -77,1 +50,1 @@\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:+UseCompressedClassPointers -XX:-UseCompressedOops -XX:ObjAlignmentInBytes=256\n+ * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:+UseCompressedOops -XX:ObjAlignmentInBytes=256\n@@ -79,1 +52,2 @@\n-\/* @test id=no-coops-no-ccp-large-align\n+\n+\/* @test id=no-coops-large-align\n@@ -84,1 +58,1 @@\n- * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:-UseCompressedClassPointers -XX:-UseCompressedOops -XX:ObjAlignmentInBytes=256\n+ * @run main\/native GTestWrapper --gtest_filter=objArrayOop -XX:-UseCompressedOops -XX:ObjAlignmentInBytes=256\n","filename":"test\/hotspot\/jtreg\/gtest\/ObjArrayTests.java","additions":10,"deletions":36,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -1,66 +0,0 @@\n-\/*\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/**\n- * @test\n- * @requires vm.cds\n- * @requires vm.bits == 64\n- * @requires vm.flagless\n- * @bug 8003424\n- * @summary Testing UseCompressedClassPointers with CDS\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @run driver CDSCompressedKPtrs\n- *\/\n-\n-import jdk.test.lib.Platform;\n-import jdk.test.lib.process.ProcessTools;\n-import jdk.test.lib.process.OutputAnalyzer;\n-import jtreg.SkippedException;\n-\n-public class CDSCompressedKPtrs {\n-  public static void main(String[] args) throws Exception {\n-    ProcessBuilder pb;\n-    pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-      \"-XX:+UseCompressedClassPointers\", \"-XX:+UseCompressedOops\",\n-      \"-XX:+UnlockDiagnosticVMOptions\", \"-XX:SharedArchiveFile=.\/CDSCompressedKPtrs.jsa\", \"-Xshare:dump\", \"-Xlog:cds\");\n-    OutputAnalyzer output = new OutputAnalyzer(pb.start());\n-    try {\n-      output.shouldContain(\"Loading classes to share\");\n-      output.shouldHaveExitValue(0);\n-\n-      pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-        \"-XX:+UseCompressedClassPointers\", \"-XX:+UseCompressedOops\",\n-        \"-XX:+UnlockDiagnosticVMOptions\", \"-XX:SharedArchiveFile=.\/CDSCompressedKPtrs.jsa\", \"-Xshare:on\", \"-version\");\n-      output = new OutputAnalyzer(pb.start());\n-      output.shouldContain(\"sharing\");\n-      output.shouldHaveExitValue(0);\n-\n-    } catch (RuntimeException e) {\n-      output.shouldContain(\"Unable to use shared archive\");\n-      output.shouldHaveExitValue(1);\n-      throw new SkippedException(\"CDS was turned off\");\n-    }\n-  }\n-}\n","filename":"test\/hotspot\/jtreg\/runtime\/CDSCompressedKPtrs\/CDSCompressedKPtrs.java","additions":0,"deletions":66,"binary":false,"changes":66,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +43,0 @@\n-import jtreg.SkippedException;\n@@ -221,1 +220,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n@@ -239,1 +237,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n@@ -261,1 +258,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n@@ -283,1 +279,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n@@ -294,12 +289,0 @@\n-    public static void heapBaseMinAddressTestNoCoop() throws Exception {\n-        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-            \"-XX:-UseCompressedOops\",\n-            \"-XX:+UseCompressedClassPointers\",\n-            \"-XX:HeapBaseMinAddress=1m\",\n-            \"-Xlog:gc+heap+coops=debug\",\n-            \"-version\");\n-        OutputAnalyzer output = new OutputAnalyzer(pb.start());\n-        output.shouldContain(\"HeapBaseMinAddress must be at least\");\n-        output.shouldHaveExitValue(0);\n-    }\n-\n@@ -310,1 +293,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n@@ -328,1 +310,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n@@ -359,1 +340,0 @@\n-        heapBaseMinAddressTestNoCoop();\n","filename":"test\/hotspot\/jtreg\/runtime\/CompressedOops\/CompressedClassPointers.java","additions":1,"deletions":21,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -110,7 +110,0 @@\n-\n-                pb = ProcessTools.createLimitedTestJavaProcessBuilder(\"-XX:-UseCompressedClassPointers\",\n-                        \"-XX:CompressedClassSpaceSize=\" + minAllowedClassSpaceSize,\n-                        \"-version\");\n-                output = new OutputAnalyzer(pb.start());\n-                output.shouldContain(\"Setting CompressedClassSpaceSize has no effect when compressed class pointers are not used\")\n-                        .shouldHaveExitValue(0);\n","filename":"test\/hotspot\/jtreg\/runtime\/CompressedOops\/CompressedClassSpaceSize.java","additions":1,"deletions":8,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,2 +26,1 @@\n- * @bug 8000968\n- * @summary NPG: UseCompressedClassPointers asserts with ObjectAlignmentInBytes=32\n+ * @summary Test Compressed Oops with different object alignments\n@@ -54,1 +53,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n","filename":"test\/hotspot\/jtreg\/runtime\/CompressedOops\/CompressedKlassPointerAndOops.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run driver TestVMConfigInHsErrFile coh-off\n+ * @run driver TestVMConfigInHsErrFile false\n@@ -45,1 +45,1 @@\n- * @run driver TestVMConfigInHsErrFile coh-on\n+ * @run driver TestVMConfigInHsErrFile true\n@@ -51,1 +51,0 @@\n-import java.util.ArrayList;\n@@ -57,4 +56,1 @@\n-    switch (args[0]) {\n-      case \"coh-on\" -> testCompactObjectHeaders();\n-      case \"coh-off\" -> testCompressedClassPointers();\n-    }\n+    test(Boolean.parseBoolean(args[0]));\n@@ -63,24 +59,3 @@\n-  private static void testCompactObjectHeaders() throws Exception {\n-    ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-        \"-XX:+UnlockDiagnosticVMOptions\",\n-        \"-XX:+UnlockExperimentalVMOptions\",\n-        \"-XX:+UseCompactObjectHeaders\",\n-        \"-Xmx100M\",\n-        \"-XX:-CreateCoredumpOnCrash\",\n-        \"-XX:ErrorHandlerTest=14\",\n-        \"-version\");\n-\n-    OutputAnalyzer output = new OutputAnalyzer(pb.start());\n-    output.shouldNotHaveExitValue(0);\n-\n-    \/\/ extract hs-err file\n-    File f = HsErrFileUtils.openHsErrFileFromOutput(output);\n-\n-    Pattern[] expectedPatterns = new Pattern[] {\n-      Pattern.compile(\"# Java VM: .*compact obj headers.*\")\n-    };\n-    Pattern[] notExpectedPatterns = new Pattern[] {\n-      Pattern.compile(\"# Java VM: .*compressed class ptrs.*\")\n-    };\n-\n-    HsErrFileUtils.checkHsErrFileContent(f, expectedPatterns, notExpectedPatterns, true, true);\n+  private static void test(boolean coh) throws Exception {\n+    final String argument = \"-XX:%cUseCompactObjectHeaders\".formatted(coh ? '+' : '-');\n+    final Pattern[] pattern = new Pattern[] { Pattern.compile(\"# Java VM: .*compact obj headers.*\") };\n@@ -88,3 +63,0 @@\n-  }\n-\n-  private static void testCompressedClassPointers() throws Exception {\n@@ -94,2 +66,1 @@\n-        \"-XX:-UseCompactObjectHeaders\",\n-        \"-XX:+UseCompressedClassPointers\",\n+        argument,\n@@ -106,10 +77,5 @@\n-\n-    Pattern[] expectedPatterns = new Pattern[] {\n-      Pattern.compile(\"# Java VM: .*compressed class ptrs.*\")\n-    };\n-    Pattern[] notExpectedPatterns = new Pattern[] {\n-      Pattern.compile(\"# Java VM: .*compact obj headers.*\")\n-    };\n-\n-    HsErrFileUtils.checkHsErrFileContent(f, expectedPatterns, notExpectedPatterns, true, true);\n-\n+    if (coh) {\n+      HsErrFileUtils.checkHsErrFileContent(f, pattern, null, true, true);\n+    } else {\n+      HsErrFileUtils.checkHsErrFileContent(f, null, pattern, true, true);\n+    }\n","filename":"test\/hotspot\/jtreg\/runtime\/ErrorHandling\/TestVMConfigInHsErrFile.java","additions":12,"deletions":46,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -25,1 +25,1 @@\n- * @test id=with-coops-with-ccp\n+ * @test id=with-coops\n@@ -32,21 +32,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:-UseCompactObjectHeaders BaseOffsets\n- *\/\n-\/*\n- * @test id=no-coops-with-ccp\n- * @library \/test\/lib \/\n- * @requires vm.bits == \"64\"\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:-UseCompressedOops -XX:+UseCompressedClassPointers -XX:-UseCompactObjectHeaders BaseOffsets\n- *\/\n-\/*\n- * @test id=with-coops-no-ccp\n- * @library \/test\/lib \/\n- * @requires vm.bits == \"64\"\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseCompressedOops -XX:-UseCompressedClassPointers -XX:-UseCompactObjectHeaders BaseOffsets\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseCompressedOops -XX:-UseCompactObjectHeaders BaseOffsets\n@@ -54,0 +34,1 @@\n+\n@@ -55,1 +36,1 @@\n- * @test id=no-coops-no-ccp\n+ * @test id=no-coops\n@@ -62,1 +43,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:-UseCompactObjectHeaders BaseOffsets\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:-UseCompressedOops -XX:-UseCompactObjectHeaders BaseOffsets\n@@ -64,0 +45,1 @@\n+\n@@ -65,1 +47,1 @@\n- * @test id=with-coop--with-coh\n+ * @test id=with-coop-with-coh\n@@ -74,0 +56,1 @@\n+\n@@ -84,0 +67,1 @@\n+\n@@ -120,1 +104,1 @@\n-        } else if (WB.getBooleanVMFlag(\"UseCompressedClassPointers\")) {\n+        } else {\n@@ -124,4 +108,0 @@\n-        } else {\n-            INT_OFFSET = 16;\n-            INT_ARRAY_OFFSET = 20;\n-            LONG_ARRAY_OFFSET = 24;\n","filename":"test\/hotspot\/jtreg\/runtime\/FieldLayout\/BaseOffsets.java","additions":10,"deletions":30,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,2 +40,1 @@\n- * @run main\/othervm -XX:+UseCompressedOops -XX:+UseCompressedClassPointers FieldDensityTest\n- * @run main\/othervm -XX:+UseCompressedOops -XX:-UseCompressedClassPointers FieldDensityTest\n+ * @run main\/othervm -XX:+UseCompressedOops FieldDensityTest\n","filename":"test\/hotspot\/jtreg\/runtime\/FieldLayout\/FieldDensityTest.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @test id=no_coops_no_ccptr_no_coh\n+ * @test id=no_coops_no_coh\n@@ -39,1 +39,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:-UseCompactObjectHeaders TestOopMapSizeMinimal\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:-UseCompressedOops -XX:-UseCompactObjectHeaders TestOopMapSizeMinimal\n@@ -43,1 +43,1 @@\n- * @test id=coops_no_ccptr_no_coh\n+ * @test id=coops_no_coh\n@@ -49,1 +49,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:+UseCompressedOops -XX:-UseCompressedClassPointers -XX:-UseCompactObjectHeaders TestOopMapSizeMinimal\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:+UseCompressedOops -XX:-UseCompactObjectHeaders TestOopMapSizeMinimal\n@@ -53,1 +53,1 @@\n- * @test id=no_coops_ccptr_no_coh\n+ * @test id=no_coops_coh\n@@ -59,11 +59,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:-UseCompressedOops -XX:+UseCompressedClassPointers -XX:-UseCompactObjectHeaders TestOopMapSizeMinimal\n- *\/\n-\n-\/*\n- * @test id=coops_ccptr_no_coh\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:+UseCompressedOops -XX:+UseCompressedClassPointers -XX:-UseCompactObjectHeaders TestOopMapSizeMinimal\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:-UseCompressedOops -XX:+UseCompactObjectHeaders TestOopMapSizeMinimal\n@@ -73,1 +63,1 @@\n- * @test id=no_coops_ccptr_coh\n+ * @test id=coops_coh\n@@ -79,1 +69,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:-UseCompressedOops -XX:+UseCompactObjectHeaders TestOopMapSizeMinimal\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:+UseCompressedOops -XX:+UseCompactObjectHeaders TestOopMapSizeMinimal\n@@ -102,2 +92,0 @@\n-            } else if (WB.getBooleanVMFlag(\"UseCompressedClassPointers\")) {\n-                HEADER_SIZE_IN_BYTES = 12;\n@@ -105,1 +93,1 @@\n-                HEADER_SIZE_IN_BYTES = 16;\n+                HEADER_SIZE_IN_BYTES = 12;\n@@ -191,4 +179,3 @@\n-        \/\/ There are two combinations that have gaps:\n-        \/\/ -UseCompressedOops + +COH, and -UseCompressedOops + -UseCompressedClassPointers.\n-        \/\/ In both cases there is a gap following i1, and i2 will therefore nestle into that gap.\n-        \/\/ Otherwise the same logic applies.\n+        \/\/ There is one combination that has gaps:\n+        \/\/ -UseCompressedOops + +COH: A gap will be following i1, and i2 will therefore nestle into that gap.\n+        \/\/ Otherwise, the same logic applies.\n","filename":"test\/hotspot\/jtreg\/runtime\/FieldLayout\/TestOopMapSizeMinimal.java","additions":12,"deletions":25,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,1 +42,0 @@\n-            \"-XX:+UseCompressedClassPointers\",\n","filename":"test\/hotspot\/jtreg\/runtime\/Metaspace\/MaxMetaspaceSizeTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+import jdk.test.lib.Platform;\n@@ -28,9 +29,1 @@\n-\/*\n- * @test id=test-64bit-ccs\n- * @summary Test the VM.metaspace command\n- * @requires vm.bits == \"64\"\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @run main\/othervm -Dwith-compressed-class-space -XX:MaxMetaspaceSize=201M -Xmx100M -XX:+UseCompressedOops -XX:+UseCompressedClassPointers PrintMetaspaceDcmd\n- *\/\n+import java.io.IOException;\n@@ -39,11 +32,1 @@\n- * @test id=test-64bit-noccs\n- * @summary Test the VM.metaspace command\n- * @requires vm.bits == \"64\"\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @run main\/othervm -Dwithout-compressed-class-space -XX:MaxMetaspaceSize=201M -Xmx100M -XX:-UseCompressedOops -XX:-UseCompressedClassPointers PrintMetaspaceDcmd\n- *\/\n-\n- \/*\n- * @test id=test-nospecified\n+ * @test\n@@ -51,1 +34,0 @@\n- * @requires vm.bits == \"64\"\n@@ -55,11 +37,1 @@\n- * @run main\/othervm -Dno-specified-flag -Xmx100M -XX:-UseCompressedOops -XX:-UseCompressedClassPointers PrintMetaspaceDcmd\n- *\/\n-\n-\/*\n- * @test test-32bit\n- * @summary Test the VM.metaspace command\n- * @requires vm.bits == \"32\"\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @run main\/othervm -Dwithout-compressed-class-space -XX:MaxMetaspaceSize=201M -Xmx100M PrintMetaspaceDcmd\n+ * @run main\/othervm -Dwith-compressed-class-space -XX:MaxMetaspaceSize=201M -Xmx100M PrintMetaspaceDcmd\n@@ -70,3 +42,1 @@\n-    private static void doTheNoSpecifiedPropTest() throws Exception {\n-        ProcessBuilder pb = new ProcessBuilder();\n-        OutputAnalyzer output;\n+    public static void main(String [] args) throws IOException {\n@@ -74,5 +44,1 @@\n-        pb.command(new PidJcmdExecutor().getCommandLine(\"VM.metaspace\", \"basic\"));\n-        output = new OutputAnalyzer(pb.start());\n-        output.shouldHaveExitValue(0);\n-        output.shouldMatch(\"MaxMetaspaceSize: unlimited\");\n-    }\n+        final boolean usesCompressedClassSpace = Platform.is64bit();\n@@ -80,1 +46,0 @@\n-    private static void doTheCCSPropTest(boolean usesCompressedClassSpace) throws Exception {\n@@ -175,11 +140,0 @@\n-    public static void main(String args[]) throws Exception {\n-        if (System.getProperty(\"no-specified-flag\") != null) {\n-            doTheNoSpecifiedPropTest();\n-        } else if (System.getProperty(\"with-compressed-class-space\") != null) {\n-            doTheCCSPropTest(true);\n-        } else if (System.getProperty(\"without-compressed-class-space\") != null) {\n-            doTheCCSPropTest(false);\n-        } else {\n-            throw new IllegalArgumentException(\"Unrecognized running mode\");\n-        }\n-    }\n","filename":"test\/hotspot\/jtreg\/runtime\/Metaspace\/PrintMetaspaceDcmd.java","additions":6,"deletions":52,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,1 +58,0 @@\n-        \"-XX:+UseCompressedClassPointers\",\n@@ -126,1 +125,0 @@\n-                testEntry.equals(\"-XX:+UseCompressedClassPointers\") ||\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/CommandLineFlagCombo.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,3 +69,3 @@\n-            \"The saved state of UseCompressedOops and UseCompressedClassPointers is different from runtime, CDS will be disabled.\", 1) );\n-        testTable.add( new TestVector(\"-XX:+UseCompressedClassPointers\", \"-XX:-UseCompressedClassPointers\",\n-           \"The saved state of UseCompressedOops and UseCompressedClassPointers is different from runtime, CDS will be disabled.\", 1) );\n+            \"The saved state of UseCompressedOops (1) is different from runtime (0), CDS will be disabled.\", 1) );\n+        testTable.add( new TestVector(\"-XX:-UseCompressedOops\", \"-XX:+UseCompressedOops\",\n+                \"The saved state of UseCompressedOops (0) is different from runtime (1), CDS will be disabled.\", 1) );\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/CommandLineFlagComboNegative.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1,53 +0,0 @@\n-\/*\n- * Copyright (C) 2022, Tencent. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/**\n- * @test\n- * bug 8286066\n- * @summary VM crash caused by unloaded FillerObject_klass\n- * @library \/test\/lib\n- * @requires vm.cds\n- * @requires vm.flagless\n- * @run driver FillerObjectLoadTest\n- *\/\n-\n-import jdk.test.lib.process.OutputAnalyzer;\n-import jdk.test.lib.process.ProcessTools;\n-\n-public class FillerObjectLoadTest {\n-    public static void main(String... args) throws Exception {\n-        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-                \"-XX:+IgnoreUnrecognizedVMOptions\", \"-XX:-UseCompressedClassPointers\",\n-                \"-XX:+UnlockExperimentalVMOptions\", \"-XX:+UseEpsilonGC\", \"-Xshare:dump\",\n-                \"-XX:SharedArchiveFile=\" + TestCommon.getNewArchiveName());\n-        OutputAnalyzer analyzer = new OutputAnalyzer(pb.start());\n-        analyzer.shouldHaveExitValue(0);\n-\n-        pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-                \"-XX:+IgnoreUnrecognizedVMOptions\", \"-XX:-UseCompressedClassPointers\",\n-                \"-XX:TLABSize=2048\", \"-Xshare:dump\",\n-                \"-XX:SharedArchiveFile=\" + TestCommon.getNewArchiveName());\n-        analyzer = new OutputAnalyzer(pb.start());\n-        analyzer.shouldHaveExitValue(0);\n-    }\n-}\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/FillerObjectLoadTest.java","additions":0,"deletions":53,"binary":false,"changes":53,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,1 +49,0 @@\n-        public boolean useCompressedClassPointers;   \/\/ UseCompressedClassPointers\n@@ -52,1 +51,1 @@\n-        public ConfArg(boolean useCompressedOops, boolean useCompressedClassPointers, String msg, int code) {\n+        public ConfArg(boolean useCompressedOops, String msg, int code) {\n@@ -54,1 +53,0 @@\n-            this.useCompressedClassPointers = useCompressedClassPointers;\n@@ -68,25 +66,2 @@\n-           \/* The combinations have four cases.\n-            *          UseCompressedOops   UseCompressedClassPointers  Result\n-            *    1.\n-            *    dump: on                  on\n-            *    test: on                  on                          Pass\n-            *          on                  off                         Fail\n-            *          off                 on                          Fail\n-            *          off                 off                         Fail\n-            *    2.\n-            *    dump: on                  off\n-            *    test: on                  off                         Pass\n-            *          on                  on                          Fail\n-            *          off                 on                          Pass\n-            *          off                 off                         Fail\n-            *    3.\n-            *    dump: off                 on\n-            *    test: off                 on                          Pass\n-            *          on                  on                          Fail\n-            *          on                  off                         Fail\n-            *    4.\n-            *    dump: off                 off\n-            *    test: off                 off                         Pass\n-            *          on                  on                          Fail\n-            *          on                  off                         Fail\n-            **\/\n+            \/\/ We fail this test if the UseCompressedOops setting used at dumptime differs from runtime,\n+            \/\/ succeed if it is identical\n@@ -94,35 +69,4 @@\n-            if (dumpArg.useCompressedOops && dumpArg.useCompressedClassPointers) {\n-                execArgs\n-                    .add(new ConfArg(true, true, HELLO_STRING, PASS));\n-                execArgs\n-                    .add(new ConfArg(true, false, EXEC_ABNORMAL_MSG, FAIL));\n-                execArgs\n-                    .add(new ConfArg(false, true, EXEC_ABNORMAL_MSG, FAIL));\n-                execArgs\n-                    .add(new ConfArg(false, false, EXEC_ABNORMAL_MSG, FAIL));\n-\n-            }  else if(dumpArg.useCompressedOops && !dumpArg.useCompressedClassPointers) {\n-                execArgs\n-                    .add(new ConfArg(true, false, HELLO_STRING, PASS));\n-                execArgs\n-                    .add(new ConfArg(true, true, EXEC_ABNORMAL_MSG, FAIL));\n-                execArgs\n-                    .add(new ConfArg(false, true, EXEC_ABNORMAL_MSG, FAIL));\n-                execArgs\n-                    .add(new ConfArg(false, false, EXEC_ABNORMAL_MSG, FAIL));\n-\n-            } else if (!dumpArg.useCompressedOops && dumpArg.useCompressedClassPointers) {\n-                execArgs\n-                    .add(new ConfArg(false, true, HELLO_STRING, PASS));\n-                execArgs\n-                    .add(new ConfArg(true, true, EXEC_ABNORMAL_MSG, FAIL));\n-                execArgs\n-                    .add(new ConfArg(true, false, EXEC_ABNORMAL_MSG, FAIL));\n-            } else if (!dumpArg.useCompressedOops && !dumpArg.useCompressedClassPointers) {\n-                execArgs\n-                    .add(new ConfArg(false, false, HELLO_STRING, PASS));\n-                execArgs\n-                    .add(new ConfArg(true, true, EXEC_ABNORMAL_MSG, FAIL));\n-                execArgs\n-                    .add(new ConfArg(true, false, EXEC_ABNORMAL_MSG, FAIL));\n-            }\n+            execArgs\n+                    .add(new ConfArg(dumpArg.useCompressedOops, HELLO_STRING, PASS));\n+            execArgs\n+                    .add(new ConfArg(!dumpArg.useCompressedOops, EXEC_ABNORMAL_MSG, FAIL));\n@@ -137,5 +81,0 @@\n-    public static String getCompressedClassPointersArg(boolean on) {\n-        if (on) return \"-XX:+UseCompressedClassPointers\";\n-        else    return \"-XX:-UseCompressedClassPointers\";\n-    }\n-\n@@ -147,5 +86,1 @@\n-            .add(new RunArg(new ConfArg(true, true, null, PASS)));\n-        runList\n-            .add(new RunArg(new ConfArg(true, false, null, PASS)));\n-        runList\n-            .add(new RunArg(new ConfArg(false, true, null, PASS)));\n+            .add(new RunArg(new ConfArg(true, null, PASS)));\n@@ -153,1 +88,1 @@\n-            .add(new RunArg(new ConfArg(false, false, null, PASS)));\n+            .add(new RunArg(new ConfArg(false, null, PASS)));\n@@ -165,1 +100,0 @@\n-                      getCompressedClassPointersArg(t.dumpArg.useCompressedClassPointers),\n@@ -178,1 +112,0 @@\n-                                      getCompressedClassPointersArg(c.useCompressedClassPointers),\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/TestCombinedCompressedFlags.java","additions":10,"deletions":77,"binary":false,"changes":87,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,3 +41,5 @@\n-    public final static String HELLO = \"Hello World\";\n-    public final static String UNABLE_TO_USE_ARCHIVE = \"Unable to use shared archive.\";\n-    public final static String ERR_MSG = \"The saved state of UseCompressedOops and UseCompressedClassPointers is different from runtime, CDS will be disabled.\";\n+    private final static String HELLO = \"Hello World\";\n+    private final static String UNABLE_TO_USE_ARCHIVE = \"Unable to use shared archive.\";\n+    private final static String ERR_MSG = \"The saved state of UseCompressedOops (0) is different from runtime (1), CDS will be disabled.\";\n+    private final static String COMPACT_OBJECT_HEADERS = \"-XX:+UseCompactObjectHeaders\";\n+\n@@ -45,1 +47,1 @@\n-         String compactHeaders = \"-XX:+UseCompactObjectHeaders\";\n+\n@@ -52,1 +54,1 @@\n-                                        compactHeaders,\n+                                        COMPACT_OBJECT_HEADERS,\n@@ -61,1 +63,1 @@\n-                         compactHeaders,\n+                         COMPACT_OBJECT_HEADERS,\n@@ -67,1 +69,1 @@\n-         System.out.println(\"2. Run with +UseCompressedOops +UseCompressedClassPointers\");\n+         System.out.println(\"2. Run with +UseCompressedOops\");\n@@ -72,15 +74,1 @@\n-                         \"-XX:+UseCompressedClassPointers\",  \/\/ by jtreg\n-                         compactHeaders,\n-                         \"-Xlog:cds\",\n-                         \"Hello\");\n-         out.shouldContain(UNABLE_TO_USE_ARCHIVE);\n-         out.shouldContain(ERR_MSG);\n-         out.shouldHaveExitValue(1);\n-\n-         System.out.println(\"3. Run with -UseCompressedOops -UseCompressedClassPointers\");\n-         out = TestCommon\n-                   .exec(helloJar,\n-                         \"-XX:+UseSerialGC\",\n-                         \"-XX:-UseCompressedOops\",\n-                         \"-XX:-UseCompressedClassPointers\",\n-                         compactHeaders,\n+                         COMPACT_OBJECT_HEADERS,\n@@ -93,1 +81,1 @@\n-         System.out.println(\"4. Run with -UseCompressedOops +UseCompressedClassPointers\");\n+         System.out.println(\"4. Run with -UseCompressedOops\");\n@@ -98,2 +86,1 @@\n-                         \"-XX:+UseCompressedClassPointers\",\n-                         compactHeaders,\n+                         COMPACT_OBJECT_HEADERS,\n@@ -105,14 +92,1 @@\n-         System.out.println(\"5. Run with +UseCompressedOops -UseCompressedClassPointers\");\n-         out = TestCommon\n-                   .exec(helloJar,\n-                         \"-XX:+UseSerialGC\",\n-                         \"-XX:+UseCompressedOops\",\n-                         \"-XX:-UseCompressedClassPointers\",\n-                         compactHeaders,\n-                         \"-Xlog:cds\",\n-                         \"Hello\");\n-         out.shouldContain(UNABLE_TO_USE_ARCHIVE);\n-         out.shouldContain(ERR_MSG);\n-         out.shouldHaveExitValue(1);\n-\n-         System.out.println(\"6. Run with +UseCompressedOops +UseCompressedClassPointers\");\n+         System.out.println(\"6. Run with +UseCompressedOops\");\n@@ -123,2 +97,1 @@\n-                         \"-XX:+UseCompressedClassPointers\",\n-                         compactHeaders,\n+                         COMPACT_OBJECT_HEADERS,\n@@ -131,12 +104,0 @@\n-         System.out.println(\"7. Dump with -UseCompressedOops -UseCompressedClassPointers\");\n-         out = TestCommon\n-                   .dump(helloJar,\n-                         new String[] {\"Hello\"},\n-                         \"-XX:+UseSerialGC\",\n-                         \"-XX:-UseCompressedOops\",\n-                         \"-XX:+UseCompressedClassPointers\",\n-                         compactHeaders,\n-                         \"-Xlog:cds\");\n-         out.shouldContain(\"Dumping shared data to file:\");\n-         out.shouldHaveExitValue(0);\n-\n@@ -147,1 +108,1 @@\n-                         compactHeaders,\n+                         COMPACT_OBJECT_HEADERS,\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/TestZGCWithCDS.java","additions":16,"deletions":55,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -56,5 +56,0 @@\n-\n-        \/\/ Heap archiving is disable with -XX:-UseCompressedClassPointers.\n-        \/\/ This will disable AOT class linking.\n-        Tester tester3 = new Tester(\"-XX:-UseCompressedClassPointers\");\n-        tester3.run(new String[] {\"AOT\", \"--two-step-training\"} );\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/aotCache\/OldClassSupport2.java","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -87,1 +87,1 @@\n-                                            \"The saved state of UseCompressedOops and UseCompressedClassPointers is different from runtime, CDS will be disabled.\");\n+                                            \"The saved state of UseCompressedOops (1) is different from runtime (0), CDS will be disabled.\");\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/cacheObject\/DifferentHeapSizes.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,1 +72,1 @@\n-                   System.out.println(\"Because the test was run with ZGC with UseCompressedOops and UseCompressedClassPointers disabled,\");\n+                   System.out.println(\"Because the test was run with ZGC with UseCompressedOops disabled,\");\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/CDSStreamTestDriver.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -309,3 +309,2 @@\n-     *   -XX:+UseZGC which implicitly disabled the UseCompressedOoops and the\n-     *   UseCompressedClassPointers options. Those \"compressed\" options were\n-     *   enabled when the default CDS archive was built.\n+     *   -XX:+UseZGC which implicitly disables the UseCompressedOoops option.\n+     *   UseCompressedOoops was enabled when the default CDS archive was built.\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/DynamicArchiveTestBase.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -86,1 +86,3 @@\n-        \"The saved state of UseCompressedOops and UseCompressedClassPointers is different from runtime, CDS will be disabled.\";\n+        \"The saved state of UseCompressedOops \\\\(%d\\\\) is different from runtime \\\\(%d\\\\), CDS will be disabled.\";\n+    static final String COMPRESSED_OOPS_NOT_CONSISTENT_10 = COMPRESSED_OOPS_NOT_CONSISTENT.formatted(1, 0);\n+    static final String COMPRESSED_OOPS_NOT_CONSISTENT_01 = COMPRESSED_OOPS_NOT_CONSISTENT.formatted(0, 1);\n@@ -120,1 +122,1 @@\n-        testExec(3, \"-XX:+UseG1GC\", \"-XX:-UseCompressedOops\", COMPRESSED_OOPS_NOT_CONSISTENT, true);\n+        testExec(3, \"-XX:+UseG1GC\", \"-XX:-UseCompressedOops\", COMPRESSED_OOPS_NOT_CONSISTENT_10, true);\n@@ -133,1 +135,1 @@\n-            testExec(4, \"-XX:+UseZGC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT, true);\n+            testExec(4, \"-XX:+UseZGC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT_10, true);\n@@ -138,3 +140,3 @@\n-        testExec(4, \"-XX:+UseG1GC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT, true);\n-        testExec(4, \"-XX:+UseParallelGC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT, true);\n-        testExec(4, \"-XX:+UseSerialGC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT, true);\n+        testExec(4, \"-XX:+UseG1GC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT_01, true);\n+        testExec(4, \"-XX:+UseParallelGC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT_01, true);\n+        testExec(4, \"-XX:+UseSerialGC\", \"\", COMPRESSED_OOPS_NOT_CONSISTENT_01, true);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/sharedStrings\/IncompatibleOptions.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -64,1 +64,1 @@\n-                System.out.println(\"Shared archive was not created due to UseCompressedOops and UseCompressedClassPointers have been disabled.\");\n+                System.out.println(\"Shared archive was not created due to UseCompressedOops being disabled.\");\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/sharedStrings\/SysDictCrash.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,11 +35,0 @@\n-\/*\n- * @test\n- * @summary Test of diagnostic command VM.classloader_stats (-UseCCP)\n- * @library \/test\/lib\n- * @requires vm.bits != \"32\"\n- * @modules java.base\/jdk.internal.misc\n- *          java.compiler\n- *          java.management\n- *          jdk.internal.jvmstat\/sun.jvmstat.monitor\n- * @run testng\/othervm -XX:-UseCompressedClassPointers --add-exports=java.base\/jdk.internal.misc=ALL-UNNAMED --add-exports=jdk.internal.jvmstat\/sun.jvmstat.monitor=ALL-UNNAMED ClassLoaderStatsTest\n- *\/\n@@ -113,1 +102,1 @@\n-                    \/\/ size at least 4k (if UseCompressedClassPointers is off).\n+                    \/\/ size at least 4k.\n","filename":"test\/hotspot\/jtreg\/serviceability\/dcmd\/vm\/ClassLoaderStatsTest.java","additions":2,"deletions":13,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -167,19 +167,0 @@\n-        runCheck(new String[] {\"-XX:+IgnoreUnrecognizedVMOptions\", \"-XX:-UseCompressedClassPointers\"},\n-                 BadFailOnConstraint.create(Loads.class, \"load()\", 1, 1, \"Load\"),\n-                 BadFailOnConstraint.create(Loads.class, \"load()\", 1, 3, \"LoadI\"),\n-                 BadCountsConstraint.create(Loads.class, \"load()\", 1, 1, 0),\n-                 BadCountsConstraint.create(Loads.class, \"load()\", 1, 2, 1,\"Load\"),\n-                 GoodRuleConstraint.create(Loads.class, \"load()\", 2),\n-                 GoodFailOnConstraint.create(Loads.class, \"load()\", 3),\n-                 BadCountsConstraint.create(Loads.class, \"load()\", 3, 2, 2,\"Store\"),\n-                 BadFailOnConstraint.create(Loads.class, \"load()\", 4, 2, \"Store\"),\n-                 BadFailOnConstraint.create(Loads.class, \"load()\", 5, \"Load\"),\n-                 BadFailOnConstraint.create(Loads.class, \"load()\", 6, \"Load\"),\n-                 BadFailOnConstraint.create(Loads.class, \"load()\", 7, \"Load\"),\n-                 GoodRuleConstraint.create(Loads.class, \"load()\", 8),\n-                 GoodRuleConstraint.create(Loads.class, \"load()\", 9),\n-                 GoodRuleConstraint.create(Loads.class, \"load()\", 10),\n-                 BadFailOnConstraint.create(Loads.class, \"loadKlass()\", 1),\n-                 BadCountsConstraint.create(Loads.class, \"loadKlass()\", 2, 2,\"Field\")\n-                 );\n-\n","filename":"test\/hotspot\/jtreg\/testlibrary_tests\/ir_framework\/tests\/TestIRMatching.java","additions":0,"deletions":19,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -317,2 +317,2 @@\n-    static final boolean CCP = WhiteBox.getWhiteBox().getBooleanVMFlag(\"UseCompressedClassPointers\");\n-    static final int ARRAY_HEADER_SIZE = CCP ? 16 : (Platform.is64bit() ? 20 : 16);\n+    \/\/ Includes length, excludes alignment gap to base\n+    static final int ARRAY_HEADER_SIZE = Platform.is64bit() ? 16 : 12;\n","filename":"test\/jdk\/java\/lang\/instrument\/GetObjectSizeIntrinsicsTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -67,3 +67,4 @@\n-    private static final Boolean COMPRESSED_CLASS_PTRS = WhiteBox.getWhiteBox().getBooleanVMFlag(\"UseCompressedClassPointers\");\n-\n-    private static final int BYTE_ARRAY_OVERHEAD = (Platform.is64bit() && !COMPRESSED_CLASS_PTRS) ? 24 : 16;\n+    \/\/ 64-bit  COH: MW8 +      L4 + End Alignment = 16\n+    \/\/ 64-bit -COH: MW8 + K4 + L4                 = 16\n+    \/\/ 32-bit     : MW4 + K4 + L4 + End Alignment = 16\n+    private static final int BYTE_ARRAY_OVERHEAD = 16;\n","filename":"test\/jdk\/jdk\/jfr\/event\/allocation\/TestObjectAllocationInNewTLABEvent.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -67,3 +67,4 @@\n-    private static final Boolean COMPRESSED_CLASS_PTRS = WhiteBox.getWhiteBox().getBooleanVMFlag(\"UseCompressedClassPointers\");\n-\n-    private static final int BYTE_ARRAY_OVERHEAD = (Platform.is64bit() && !COMPRESSED_CLASS_PTRS) ? 24 : 16;\n+    \/\/ 64-bit  COH: MW8 +      L4 + End Alignment = 16\n+    \/\/ 64-bit -COH: MW8 + K4 + L4                 = 16\n+    \/\/ 32-bit     : MW4 + K4 + L4 + End Alignment = 16\n+    private static final int BYTE_ARRAY_OVERHEAD = 16;\n","filename":"test\/jdk\/jdk\/jfr\/event\/allocation\/TestObjectAllocationOutsideTLABEvent.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -55,3 +55,4 @@\n-    private static final Boolean COMPRESSED_CLASS_PTRS = WhiteBox.getWhiteBox().getBooleanVMFlag(\"UseCompressedClassPointers\");\n-\n-    private static final int BYTE_ARRAY_OVERHEAD = (Platform.is64bit() && !COMPRESSED_CLASS_PTRS) ? 24 : 16;\n+    \/\/ 64-bit  COH: MW8 +      L4 + End Alignment = 16\n+    \/\/ 64-bit -COH: MW8 + K4 + L4                 = 16\n+    \/\/ 32-bit     : MW4 + K4 + L4 + End Alignment = 16\n+    private static final int BYTE_ARRAY_OVERHEAD = 16;\n","filename":"test\/jdk\/jdk\/jfr\/event\/allocation\/TestObjectAllocationSampleEventThrottling.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -36,10 +36,0 @@\n-\/**\n- * @test\n- * @bug 8264008\n- * @requires vm.flagless\n- * @requires vm.hasJFR & vm.bits == 64\n- * @requires vm.gc == \"Serial\" | vm.gc == null\n- * @library \/test\/lib \/test\/jdk\n- * @run main\/othervm -XX:+UseSerialGC -XX:-UseCompressedClassPointers\n- *                   jdk.jfr.event.gc.heapsummary.TestHeapSummaryEventDefNewSerial\n- *\/\n","filename":"test\/jdk\/jdk\/jfr\/event\/gc\/heapsummary\/TestHeapSummaryEventDefNewSerial.java","additions":0,"deletions":10,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,1 @@\n-            System.out.println(className);\n+            System.out.printf(\"%s: count %d totalSize %d%n\", className, count, totalSize);\n@@ -72,3 +72,4 @@\n-        int bytesPerWord = runsOn32Bit ? 4 : 8;\n-        int objectHeaderSize = bytesPerWord * 3; \/\/ length will be aligned on 64 bits\n-        int alignmentInOopArray = runsOn32Bit ? 4 : 0;\n+        \/\/ Compressed Class Pointers, +COH\n+        final int bytesPerWord = runsOn32Bit ? 4 : 8;\n+        final int objectHeaderSize = runsOn32Bit ? 12 : 16;\n+        final int alignmentGap = runsOn32Bit ? 4 : 0;\n@@ -76,1 +77,1 @@\n-        return objectHeaderSize + alignmentInOopArray + count * ptrSize;\n+        return objectHeaderSize + alignmentGap + count * ptrSize;\n","filename":"test\/jdk\/jdk\/jfr\/event\/gc\/objectcount\/ObjectCountEventVerifier.java","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n- * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseG1GC -XX:+ExplicitGCInvokesConcurrent -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithG1ConcurrentMark\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseG1GC -XX:+ExplicitGCInvokesConcurrent -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithG1ConcurrentMark\n","filename":"test\/jdk\/jdk\/jfr\/event\/gc\/objectcount\/TestObjectCountAfterGCEventWithG1ConcurrentMark.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n- * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseG1GC -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithG1FullCollection\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseG1GC -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithG1FullCollection\n","filename":"test\/jdk\/jdk\/jfr\/event\/gc\/objectcount\/TestObjectCountAfterGCEventWithG1FullCollection.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseParallelGC -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithParallelOld\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseParallelGC -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithParallelOld\n","filename":"test\/jdk\/jdk\/jfr\/event\/gc\/objectcount\/TestObjectCountAfterGCEventWithParallelOld.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseSerialGC -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithSerial\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseSerialGC -XX:MarkSweepDeadRatio=0 -XX:-UseCompressedOops -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountAfterGCEventWithSerial\n","filename":"test\/jdk\/jdk\/jfr\/event\/gc\/objectcount\/TestObjectCountAfterGCEventWithSerial.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n- * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseSerialGC -XX:-UseCompressedOops -XX:-UseCompressedClassPointers -XX:MarkSweepDeadRatio=0 -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountEvent\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseSerialGC -XX:-UseCompressedOops -XX:MarkSweepDeadRatio=0 -XX:+IgnoreUnrecognizedVMOptions jdk.jfr.event.gc.objectcount.TestObjectCountEvent\n","filename":"test\/jdk\/jdk\/jfr\/event\/gc\/objectcount\/TestObjectCountEvent.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -489,2 +489,1 @@\n-     *         with the current set of jtreg VM options. For example, false will be returned\n-     *         if -XX:-UseCompressedClassPointers is specified.\n+     *         with the current set of jtreg VM options.\n@@ -498,2 +497,1 @@\n-     *         with the current set of jtreg VM options. For example, false will be returned\n-     *         if -XX:-UseCompressedClassPointers is specified.\n+     *         with the current set of jtreg VM options.\n@@ -507,2 +505,1 @@\n-     *         with the current set of jtreg VM options. For example, false will be returned\n-     *         if -XX:-UseCompressedClassPointers is specified.\n+     *         with the current set of jtreg VM options.\n","filename":"test\/jtreg-ext\/requires\/VMProps.java","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"}]}