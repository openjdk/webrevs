{"files":[{"patch":"@@ -460,2 +460,2 @@\n-  assert(is_aligned(size, os::vm_allocation_granularity()),\n-      \"Size must be a multiple of allocation granularity (page size)\");\n+  assert(is_aligned(size, os::vm_page_size()),\n+      \"Size must be a multiple of page size\");\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2997,1 +2997,1 @@\n-  size_t page_size = UseLargePages ? _large_page_size : os::vm_allocation_granularity();\n+  size_t page_size = UseLargePages ? _large_page_size : os::vm_page_size();\n@@ -3238,3 +3238,3 @@\n-      \"Alignment must be a multiple of allocation granularity (page size)\");\n-  assert(is_aligned(size, os::vm_allocation_granularity()),\n-      \"Size must be a multiple of allocation granularity (page size)\");\n+      \"Alignment must be a multiple of allocation granularity\");\n+  assert(is_aligned(size, os::vm_page_size()),\n+      \"Size must be a multiple of page size\");\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -218,2 +218,2 @@\n-    if (!is_aligned(AOTCodeMaxSize, os::vm_allocation_granularity())) {\n-      _max_aot_code_size = align_up(AOTCodeMaxSize, os::vm_allocation_granularity());\n+    if (!is_aligned(AOTCodeMaxSize, os::vm_page_size())) {\n+      _max_aot_code_size = align_up(AOTCodeMaxSize, os::vm_page_size());\n","filename":"src\/hotspot\/share\/code\/aotCodeCache.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -354,1 +354,1 @@\n-  const size_t rs_size = align_up(size, rs_align);\n+  const size_t rs_size = align_up(size, os::vm_page_size());\n","filename":"src\/hotspot\/share\/code\/codeCache.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -35,1 +35,1 @@\n-  return os::align_up_vm_allocation_granularity(number_of_slots);\n+  return os::align_up_vm_page_size(number_of_slots);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1BlockOffsetTable.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -71,1 +71,1 @@\n-  return os::align_up_vm_allocation_granularity(number_of_slots);\n+  return os::align_up_vm_page_size(number_of_slots);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardTable.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,2 +45,1 @@\n-  bytes_to_reserve =\n-    align_up(bytes_to_reserve, os::vm_allocation_granularity());\n+  bytes_to_reserve = align_up(bytes_to_reserve, os::vm_page_size());\n","filename":"src\/hotspot\/share\/gc\/parallel\/objectStartArray.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-  return os::align_up_vm_allocation_granularity(number_of_slots);\n+  return os::align_up_vm_page_size(number_of_slots);\n","filename":"src\/hotspot\/share\/gc\/serial\/serialBlockOffsetTable.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-  return os::align_up_vm_allocation_granularity(heap_size \/ mark_distance());\n+  return os::align_up_vm_page_size(heap_size \/ mark_distance());\n","filename":"src\/hotspot\/share\/gc\/shared\/markBitMap.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -106,1 +106,1 @@\n-  assert(is_aligned(reservation_size_request_bytes, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(reservation_size_request_bytes, os::vm_page_size()), \"invariant\");\n@@ -117,1 +117,1 @@\n-  assert(is_aligned(_rs.size(), os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(_rs.size(), os::vm_page_size()), \"invariant\");\n@@ -148,1 +148,1 @@\n-  assert(is_aligned(block_size_request_bytes, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(block_size_request_bytes, os::vm_page_size()), \"invariant\");\n@@ -245,1 +245,1 @@\n-  assert(is_aligned(reservation_size_request_words * BytesPerWord, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(reservation_size_request_words * BytesPerWord, os::vm_page_size()), \"invariant\");\n@@ -249,1 +249,1 @@\n-  assert(is_aligned(_reservation_size_request_limit_words * BytesPerWord, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(_reservation_size_request_limit_words * BytesPerWord, os::vm_page_size()), \"invariant\");\n@@ -260,1 +260,1 @@\n-  assert(is_aligned(reservation_size_request_words * BytesPerWord, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(reservation_size_request_words * BytesPerWord, os::vm_page_size()), \"invariant\");\n@@ -300,1 +300,0 @@\n-  assert(is_aligned(block_size_request_words * BytesPerWord, os::vm_allocation_granularity()), \"invariant\");\n@@ -302,1 +301,0 @@\n-  assert(is_aligned(reservation_size_request_words * BytesPerWord, os::vm_allocation_granularity()), \"invariant\");\n@@ -344,1 +342,1 @@\n-  assert(is_aligned(block_size_request_words * BytesPerWord, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(block_size_request_words * BytesPerWord, os::vm_page_size()), \"invariant\");\n@@ -385,2 +383,2 @@\n-  assert(is_aligned(*reservation_size_bytes, os::vm_allocation_granularity()), \"invariant\");\n-  assert(is_aligned(*commit_size_bytes, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(*reservation_size_bytes, os::vm_page_size()), \"invariant\");\n+  assert(is_aligned(*commit_size_bytes, os::vm_page_size()), \"invariant\");\n@@ -388,2 +386,2 @@\n-  size_t reservation_size_units = *reservation_size_bytes \/ os::vm_allocation_granularity();\n-  size_t commit_size_units = *commit_size_bytes \/ os::vm_allocation_granularity();\n+  size_t reservation_size_units = *reservation_size_bytes \/ os::vm_page_size();\n+  size_t commit_size_units = *commit_size_bytes \/ os::vm_page_size();\n@@ -406,2 +404,2 @@\n-  *reservation_size_bytes = reservation_size_units * os::vm_allocation_granularity();\n-  *commit_size_bytes = commit_size_units * os::vm_allocation_granularity();\n+  *reservation_size_bytes = reservation_size_units * os::vm_page_size();\n+  *commit_size_bytes = commit_size_units * os::vm_page_size();\n@@ -426,2 +424,2 @@\n-  reservation_size_request_bytes = os::align_up_vm_allocation_granularity(reservation_size_request_bytes);\n-  assert(is_aligned(reservation_size_request_bytes, os::vm_allocation_granularity()), \"invariant\");\n+  reservation_size_request_bytes = os::align_up_vm_page_size(reservation_size_request_bytes);\n+  assert(is_aligned(reservation_size_request_bytes, os::vm_page_size()), \"invariant\");\n@@ -429,3 +427,3 @@\n-  block_size_request_bytes = MAX2(block_size_request_bytes, (size_t)os::vm_allocation_granularity());\n-  block_size_request_bytes = os::align_up_vm_allocation_granularity(block_size_request_bytes);\n-  assert(is_aligned(block_size_request_bytes, os::vm_allocation_granularity()), \"invariant\");\n+  block_size_request_bytes = MAX2(block_size_request_bytes, (size_t)os::vm_page_size());\n+  block_size_request_bytes = os::align_up_vm_page_size(block_size_request_bytes);\n+  assert(is_aligned(block_size_request_bytes, os::vm_page_size()), \"invariant\");\n@@ -433,1 +431,1 @@\n-  \/\/ adjustment to valid ratio in units of vm_allocation_granularity\n+  \/\/ adjustment to valid ratio in units of vm_page_size\n@@ -435,1 +433,1 @@\n-  assert(is_aligned(reservation_size_request_bytes, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(reservation_size_request_bytes, os::vm_page_size()), \"invariant\");\n@@ -437,1 +435,1 @@\n-  assert(is_aligned(block_size_request_bytes, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(block_size_request_bytes, os::vm_page_size()), \"invariant\");\n@@ -461,1 +459,1 @@\n-  assert(is_aligned(block_size_request_words * BytesPerWord, os::vm_allocation_granularity()), \"invariant\");\n+  assert(is_aligned(block_size_request_words * BytesPerWord, os::vm_page_size()), \"invariant\");\n","filename":"src\/hotspot\/share\/jfr\/recorder\/storage\/jfrVirtualMemory.cpp","additions":22,"deletions":24,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n-  size_t _physical_commit_size_request_words; \/\/ aligned to os::vm_allocation_granularity()\n+  size_t _physical_commit_size_request_words; \/\/ aligned to os::vm_page_size()\n","filename":"src\/hotspot\/share\/jfr\/recorder\/storage\/jfrVirtualMemory.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-  size_t alignment = os::vm_allocation_granularity();\n+  size_t alignment = os::vm_page_size();\n","filename":"src\/hotspot\/share\/memory\/allocation.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,1 +40,2 @@\n-  assert(is_aligned(size, granularity), \"size not aligned to os::vm_allocation_granularity()\");\n+  DEBUG_ONLY(const size_t page_size = os::vm_page_size());\n+  assert(is_aligned(size, page_size), \"size not aligned to os::vm_page_size()\");\n@@ -527,1 +528,0 @@\n-  const size_t granularity = os::vm_allocation_granularity();\n@@ -530,1 +530,1 @@\n-  assert(is_aligned(size, granularity), \"size not aligned to os::vm_allocation_granularity()\");\n+  assert(is_aligned(size, os::vm_page_size()), \"size not aligned to os::vm_page_size()\");\n@@ -533,1 +533,1 @@\n-  assert(is_aligned(alignment, granularity), \"alignment not aligned to os::vm_allocation_granularity()\");\n+  assert(is_aligned(alignment, os::vm_allocation_granularity()), \"alignment not aligned to os::vm_allocation_granularity()\");\n@@ -682,1 +682,1 @@\n-  assert(is_aligned(size, alignment), \"Precondition\");\n+  assert(is_aligned(size, page_size), \"Precondition\");\n","filename":"src\/hotspot\/share\/memory\/memoryReserver.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2432,1 +2432,1 @@\n-    size_t size = os::vm_allocation_granularity();\n+    size_t size = os::vm_page_size();\n","filename":"src\/hotspot\/share\/prims\/jni.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -306,1 +306,2 @@\n-  ReservedHeapSpace rhs = HeapReserver::reserve(100 * granularity, granularity, os::vm_page_size(), nullptr);\n+  size_t page_size = os::vm_page_size();\n+  ReservedHeapSpace rhs = HeapReserver::reserve(100 * page_size, granularity, page_size, nullptr);\n@@ -346,1 +347,2 @@\n-  ReservedHeapSpace rhs = HeapReserver::reserve(reserved_space_size * granularity, granularity, os::vm_page_size(), nullptr);\n+  size_t page_size = os::vm_page_size();\n+  ReservedHeapSpace rhs = HeapReserver::reserve(reserved_space_size * page_size, granularity, page_size, nullptr);\n@@ -1526,1 +1528,1 @@\n-  p = os::reserve_memory(os::vm_allocation_granularity(), mtTest);\n+  p = os::reserve_memory(os::vm_page_size(), mtTest);\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -95,1 +95,1 @@\n-                             os::vm_allocation_granularity());\n+                             os::vm_page_size());\n@@ -98,1 +98,1 @@\n-                          \" os::vm_allocation_granularity = %zu\"\n+                          \" os::vm_page_size = %zu\"\n@@ -101,1 +101,1 @@\n-                          os::vm_allocation_granularity(),\n+                          os::vm_page_size(),\n","filename":"src\/hotspot\/share\/runtime\/perfMemory.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1184,1 +1184,1 @@\n-  char* result = os::map_memory_to_file_aligned(os::vm_allocation_granularity(), os::vm_allocation_granularity(), fd, mtTest);\n+  char* result = os::map_memory_to_file_aligned(os::vm_page_size(), os::vm_allocation_granularity(), fd, mtTest);\n@@ -1187,1 +1187,1 @@\n-  EXPECT_TRUE(os::unmap_memory(result, os::vm_allocation_granularity()));\n+  EXPECT_TRUE(os::unmap_memory(result, os::vm_page_size()));\n","filename":"test\/hotspot\/gtest\/runtime\/test_os.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}