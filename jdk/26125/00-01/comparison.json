{"files":[{"patch":"@@ -979,3 +979,0 @@\n-  if (!OptimizePtrCompare) {\n-    return;\n-  }\n@@ -3278,1 +3275,3 @@\n-  assert(OptimizePtrCompare, \"sanity\");\n+  if (!OptimizePtrCompare) {\n+    return TypeInt::CC;\n+  }\n","filename":"src\/hotspot\/share\/opto\/escape.cpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,96 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8361140\n+ * @summary Test ConnectionGraph::reduce_phi_on_cmp when OptimizePtrCompare is disabled\n+ * @library \/test\/lib \/\n+ * @requires vm.debug == true\n+ * @requires vm.compiler2.enabled\n+ * @run driver compiler.c2.TestReducePhiOnCmpWithNoOptPtrCompare\n+ *\/\n+\n+package compiler.c2;\n+\n+import java.util.Random;\n+import jdk.test.lib.Asserts;\n+import compiler.lib.ir_framework.*;\n+\n+public class TestReducePhiOnCmpWithNoOptPtrCompare {\n+    private int invocations = 0;\n+\n+    public static void main(String[] args) {\n+        TestFramework framework = new TestFramework();\n+        Scenario scenario0 = new Scenario(0, \"-XX:-OptimizePtrCompare\");\n+        framework.addScenarios(scenario0).start();\n+    }\n+\n+    @Run(test = {\"testReducePhiOnCmp_C2\"})\n+    public void runner(RunInfo info) {\n+        invocations++;\n+        Random random = info.getRandom();\n+        boolean cond = invocations % 2 == 0;\n+        int x = random.nextInt();\n+        int y = random.nextInt();\n+        Asserts.assertEQ(testReducePhiOnCmp_Interp(cond, x, y),testReducePhiOnCmp_C2(cond, x, y));\n+    }\n+\n+    @Test\n+    int testReducePhiOnCmp_C2(boolean cond, int x, int y) { return testReducePhiOnCmp(cond, x, y); }\n+\n+    @DontCompile\n+    int testReducePhiOnCmp_Interp(boolean cond, int x, int y) { return testReducePhiOnCmp(cond, x, y); }\n+\n+    int testReducePhiOnCmp(boolean cond,int x,int y) {\n+        Point p = null;\n+\n+        if (cond) {\n+            p = new Point(x*x, y*y);\n+        } else if (x > y) {\n+            p = new Point(x+y, x*y);\n+        }\n+\n+        if (p != null) {\n+            return p.x * p.y;\n+        } else {\n+            return 1984;\n+        }\n+    }\n+\n+    static class Point {\n+        int x, y;\n+        Point(int x, int y) {\n+            this.x = x;\n+            this.y = y;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (o == this) return true;\n+            if (!(o instanceof Point)) return false;\n+            Point p = (Point) o;\n+            return (p.x == x) && (p.y == y);\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/TestReducePhiOnCmpWithNoOptPtrCompare.java","additions":96,"deletions":0,"binary":false,"changes":96,"status":"added"}]}