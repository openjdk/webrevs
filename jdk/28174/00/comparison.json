{"files":[{"patch":"@@ -111,0 +111,2 @@\n+  \/\/ We can wrap the buffer in a fixed stringStream, this won't free buffer once buf goes out of scope.\n+  stringStream buf(buffer, bufferSize);\n@@ -112,2 +114,2 @@\n-    jio_snprintf(buffer, bufferSize, \"CreateCoredumpOnCrash is disabled from command line\");\n-    VMError::record_coredump_status(buffer, false);\n+    buf.print(\"CreateCoredumpOnCrash is disabled from command line\");\n+    VMError::record_coredump_status(buf.freeze(), false);\n@@ -120,1 +122,5 @@\n-      jio_snprintf(buffer, bufferSize, \"core.%d (may not exist)\", current_process_id());\n+      \/\/ In the warning message, let the user know.\n+      if (check_only) {\n+        buf.print(\"core path is unknown, trying \");\n+      }\n+      buf.print(\"core.%d (may not exist)\", current_process_id());\n@@ -123,1 +129,4 @@\n-      jio_snprintf(buffer, bufferSize, \"Core dumps may be processed with %s\", core_path);\n+      if (check_only) {\n+        buf.print(\"core dumps may be processed with \");\n+      }\n+      buf.print(\"%s\", core_path);\n@@ -126,1 +135,4 @@\n-      jio_snprintf(buffer, bufferSize, \"%s (may not exist)\", core_path);\n+      if (check_only) {\n+        buf.print(\"couldn't deduce rlim, trying \");\n+      }\n+      buf.print(\"%s (may not exist)\", core_path);\n@@ -130,1 +142,1 @@\n-          jio_snprintf(buffer, bufferSize, \"%s\", core_path);\n+          buf.print(\"%s\", core_path);\n@@ -134,1 +146,1 @@\n-          jio_snprintf(buffer, bufferSize, \"Core dumps have been disabled. To enable core dumping, try \\\"ulimit -c unlimited\\\" before starting Java again\");\n+          buf.print(\"%s dumps have been disabled. To enable core dumping, try \\\"ulimit -c unlimited\\\" before starting Java again\", check_only ? \"core\" : \"Core\");\n@@ -138,1 +150,6 @@\n-          jio_snprintf(buffer, bufferSize, \"%s (max size \" UINT64_FORMAT \" k). To ensure a full core dump, try \\\"ulimit -c unlimited\\\" before starting Java again\", core_path, uint64_t(rlim.rlim_cur) \/ K);\n+          if (check_only) {\n+            buf.print(\"core dumps are constrained \");\n+          } else {\n+             buf.print( \"%s \", core_path);\n+          }\n+          buf.print( \"(max size \" UINT64_FORMAT \" k). To ensure a full core dump, try \\\"ulimit -c unlimited\\\" before starting Java again\", uint64_t(rlim.rlim_cur) \/ K);\n@@ -142,0 +159,1 @@\n+    const char* result = buf.freeze();\n@@ -143,1 +161,1 @@\n-      VMError::record_coredump_status(buffer, success);\n+      VMError::record_coredump_status(result, success);\n@@ -145,1 +163,1 @@\n-      warning(\"CreateCoredumpOnCrash specified, but %s\", buffer);\n+      warning(\"CreateCoredumpOnCrash specified, but %s\", result);\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":28,"deletions":10,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -75,1 +75,1 @@\n-           # Core dump will be written. Default location: Core dumps may be processed with \"\/usr\/share\/apport\/apport %p %s %c %P\" (or dumping to\n+           # Core dump will be written. Default location: \"\/usr\/share\/apport\/apport %p %s %c %P\" (or dumping to\n","filename":"test\/hotspot\/jtreg\/runtime\/ErrorHandling\/TestCrashOnOutOfMemoryError.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}