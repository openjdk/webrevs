{"files":[{"patch":"@@ -199,5 +199,0 @@\n-  template <typename CMP, typename RET, typename ARG1, typename ARG2, typename = void>\n-  struct has_cmp_type : std::false_type {};\n-  template <typename CMP, typename RET, typename ARG1, typename ARG2>\n-  struct has_cmp_type<CMP, RET, ARG1, ARG2, decltype(static_cast<RET(*)(ARG1, ARG2)>(CMP::cmp), void())> : std::true_type {};\n-\n@@ -205,1 +200,2 @@\n-  static constexpr bool HasKeyComparator = has_cmp_type<CMP, RBTreeOrdering, K, K>::value;\n+  static constexpr bool HasKeyComparator =\n+      std::is_invocable_r_v<RBTreeOrdering, decltype(&CMP::cmp), K, K>;\n@@ -208,1 +204,2 @@\n-  static constexpr bool HasNodeComparator = has_cmp_type<CMP, RBTreeOrdering, K, const NodeType*>::value;\n+  static constexpr bool HasNodeComparator =\n+      std::is_invocable_r_v<RBTreeOrdering, decltype(&CMP::cmp), K, const NodeType*>;\n@@ -210,4 +207,2 @@\n-  template <typename CMP, typename RET, typename ARG1, typename ARG2, typename = void>\n-  struct has_less_than_type : std::false_type {};\n-  template <typename CMP, typename RET, typename ARG1, typename ARG2>\n-  struct has_less_than_type<CMP, RET, ARG1, ARG2, decltype(static_cast<RET(*)(ARG1, ARG2)>(CMP::less), void())> : std::true_type {};\n+  template <typename CMP, typename = void>\n+  static constexpr bool HasNodeVerifier = false;\n@@ -216,1 +211,2 @@\n-  static constexpr bool HasNodeVerifier = has_less_than_type<CMP, bool, const NodeType*, const NodeType*>::value;\n+  static constexpr bool HasNodeVerifier<CMP, std::void_t<decltype(&CMP::less_than)>> =\n+      std::is_invocable_r_v<bool, decltype(&CMP::less_than), const NodeType*, const NodeType*>;\n@@ -218,1 +214,0 @@\n-  template <typename CMP = COMPARATOR, ENABLE_IF(HasKeyComparator<CMP> && !HasNodeComparator<CMP>)>\n@@ -220,11 +215,5 @@\n-    return COMPARATOR::cmp(a, b->key());\n-  }\n-\n-  template <typename CMP = COMPARATOR, ENABLE_IF(HasNodeComparator<CMP>)>\n-  RBTreeOrdering cmp(const K& a, const NodeType* b) const {\n-    return COMPARATOR::cmp(a, b);\n-  }\n-\n-  template <typename CMP = COMPARATOR, ENABLE_IF(!HasNodeVerifier<CMP>)>\n-  bool less_than(const NodeType* a, const NodeType* b) const {\n-    return true;\n+    if constexpr (HasNodeComparator<COMPARATOR>) {\n+      return COMPARATOR::cmp(a, b);\n+    } else if constexpr (HasKeyComparator<COMPARATOR>) {\n+      return COMPARATOR::cmp(a, b->key());\n+    }\n@@ -233,1 +222,0 @@\n-  template <typename CMP = COMPARATOR, ENABLE_IF(HasNodeVerifier<CMP>)>\n@@ -235,1 +223,5 @@\n-    return COMPARATOR::less_than(a, b);\n+    if constexpr (HasNodeVerifier<COMPARATOR>) {\n+      return COMPARATOR::less_than(a, b);\n+    } else {\n+      return true;\n+    }\n@@ -238,5 +230,0 @@\n-  \/\/ Cannot assert if no key comparator exist.\n-  template <typename CMP = COMPARATOR, ENABLE_IF(!HasKeyComparator<CMP>)>\n-  void assert_key_leq(K a, K b) const {}\n-\n-  template <typename CMP = COMPARATOR, ENABLE_IF(HasKeyComparator<CMP>)>\n@@ -244,1 +231,3 @@\n-    assert(COMPARATOR::cmp(a, b) != RBTreeOrdering::GT, \"key a must be less or equal to key b\");\n+    if constexpr (HasKeyComparator<COMPARATOR>) { \/\/ Cannot assert if no key comparator exist.\n+      assert(COMPARATOR::cmp(a, b) != RBTreeOrdering::GT, \"key a must be less or equal to key b\");\n+    }\n@@ -441,1 +430,1 @@\n-  \/\/ A second `cmp` must exist in COMPARATOR (see top of file).\n+  \/\/ a function `less_than` must exist in COMPARATOR (see top of file).\n@@ -445,7 +434,1 @@\n-  template <typename USER_VERIFIER = empty_verifier, typename CMP = COMPARATOR, ENABLE_IF(HasNodeVerifier<CMP>)>\n-  void verify_self(const USER_VERIFIER& extra_verifier = USER_VERIFIER()) const {\n-    verify_self([](const NodeType* a, const NodeType* b){ return COMPARATOR::less_than(a, b);}, extra_verifier);\n-  }\n-\n-  template <typename USER_VERIFIER = empty_verifier, typename CMP = COMPARATOR,\n-            ENABLE_IF(HasKeyComparator<CMP> && !HasNodeVerifier<CMP>)>\n+  template <typename USER_VERIFIER = empty_verifier>\n@@ -453,7 +436,7 @@\n-    verify_self([](const NodeType* a, const NodeType* b){ return COMPARATOR::cmp(a->key(), b->key()) == RBTreeOrdering::LT; }, extra_verifier);\n-  }\n-\n-  template <typename USER_VERIFIER = empty_verifier, typename CMP = COMPARATOR,\n-            ENABLE_IF(HasNodeComparator<CMP> && !HasKeyComparator<CMP> && !HasNodeVerifier<CMP>)>\n-  void verify_self(const USER_VERIFIER& extra_verifier = USER_VERIFIER()) const {\n-    verify_self([](const NodeType*, const NodeType*){ return true;}, extra_verifier);\n+    if constexpr (HasNodeVerifier<COMPARATOR>) {\n+      verify_self([](const NodeType* a, const NodeType* b){ return COMPARATOR::less_than(a, b);}, extra_verifier);\n+    } else if constexpr (HasKeyComparator<COMPARATOR>) {\n+      verify_self([](const NodeType* a, const NodeType* b){ return COMPARATOR::cmp(a->key(), b->key()) == RBTreeOrdering::LT; }, extra_verifier);\n+    } else {\n+      verify_self([](const NodeType*, const NodeType*){ return true;}, extra_verifier);\n+    }\n","filename":"src\/hotspot\/share\/utilities\/rbTree.hpp","additions":30,"deletions":47,"binary":false,"changes":77,"status":"modified"},{"patch":"@@ -698,2 +698,2 @@\n-          ENABLE_IF(std::is_integral<T>::value),\n-          ENABLE_IF(std::is_signed<T>::value)>\n+          ENABLE_IF(std::is_integral_v<T>),\n+          ENABLE_IF(std::is_signed_v<T>)>\n@@ -705,2 +705,2 @@\n-          ENABLE_IF(std::is_integral<T>::value),\n-          ENABLE_IF(std::is_unsigned<T>::value)>\n+          ENABLE_IF(std::is_integral_v<T>),\n+          ENABLE_IF(std::is_unsigned_v<T>)>\n@@ -712,1 +712,1 @@\n-          ENABLE_IF(std::is_pointer<T>::value)>\n+          ENABLE_IF(std::is_pointer_v<T>)>\n","filename":"src\/hotspot\/share\/utilities\/rbTree.inline.hpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"}]}