{"files":[{"patch":"@@ -143,0 +143,4 @@\n+    if (argc != 2) {\n+        shutItDown();\n+    }\n+\n","filename":"src\/java.base\/unix\/native\/jspawnhelper\/jspawnhelper.c","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import java.nio.file.Paths;\n@@ -95,0 +96,34 @@\n+    private static void jspawnhelperWithNoArgs() throws Exception {\n+        System.out.println(\"Running jspawnhelper without args\");\n+        Process p = null;\n+        try {\n+            p = Runtime.getRuntime().exec(Paths.get(System.getProperty(\"java.home\"), \"lib\", \"jspawnhelper\").toString());\n+        } catch (Exception e) {\n+            e.printStackTrace(System.out);\n+            System.exit(ERROR);\n+        }\n+        if (!p.waitFor(TIMEOUT, TimeUnit.SECONDS)) {\n+            System.out.println(\"Child process timed out\");\n+            System.exit(ERROR + 1);\n+        }\n+        if (p.exitValue() != 1)\n+            System.exit(ERROR + 2);\n+        System.exit(0);\n+    }\n+\n+    private static void simulateJspawnhelperWithoutArgs() throws Exception {\n+        ProcessBuilder pb;\n+        pb = ProcessTools.createLimitedTestJavaProcessBuilder(\"-Djdk.lang.Process.launchMechanism=posix_spawn\",\n+                                                              \"JspawnhelperProtocol\",\n+                                                              \"noargs\");\n+        pb.inheritIO();\n+        Process p = pb.start();\n+\n+        if (!p.waitFor(TIMEOUT, TimeUnit.SECONDS)) {\n+            throw new Exception(\"Parent process timed out\");\n+        }\n+        if (p.exitValue() != 0) {\n+            throw new Exception(\"Parent process exited with \" + p.exitValue());\n+        }\n+    }\n+\n@@ -225,1 +260,4 @@\n-            parentCode(args[0]);\n+            if (\"noargs\".equals(args[0]))\n+                jspawnhelperWithNoArgs();\n+            else\n+                parentCode(args[0]);\n@@ -229,0 +267,1 @@\n+            simulateJspawnhelperWithoutArgs();\n@@ -238,1 +277,1 @@\n-}\n+}\n\\ No newline at end of file\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/JspawnhelperProtocol.java","additions":41,"deletions":2,"binary":false,"changes":43,"status":"modified"}]}