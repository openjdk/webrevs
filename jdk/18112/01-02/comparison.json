{"files":[{"patch":"@@ -34,3 +34,0 @@\n-import java.io.BufferedReader;\n-import java.io.IOException;\n-import java.nio.file.Path;\n@@ -39,1 +36,0 @@\n-import java.util.Optional;\n@@ -41,1 +37,0 @@\n-import java.util.concurrent.TimeoutException;\n@@ -43,0 +38,1 @@\n+import jdk.test.lib.process.OutputAnalyzer;\n@@ -49,9 +45,7 @@\n-    private static void jspawnhelperWithNArgs(int args) throws Exception {\n-        System.out.println(\"Running jspawnhelper with \"+args+\" args\");\n-        String[] argArray = new String[args +1];\n-        Arrays.fill(argArray, \"1\");\n-        argArray[0] = Paths.get(System.getProperty(\"java.home\"), \"lib\", \"jspawnhelper\").toString();\n-        for (int i = 0; i < argArray.length; ++i)\n-            System.out.println(argArray[i]);\n-        Process p = Runtime.getRuntime().exec(argArray);\n-\n+    private static void jspawnhelperWithNArgs(int nArgs) throws Exception {\n+        System.out.println(\"Running jspawnhelper with \"+nArgs+\" args\");\n+        String[] args = new String[nArgs +1];\n+        Arrays.fill(args, \"1\");\n+        args[0] = Paths.get(System.getProperty(\"java.home\"), \"lib\", \"jspawnhelper\").toString();\n+        Process p = ProcessTools.startProcess(\"jspawnhelper\", new ProcessBuilder(args));\n+        OutputAnalyzer oa = new OutputAnalyzer(p);\n@@ -59,14 +53,1 @@\n-            throw new Exception(\"Child process timed out after \" + TIMEOUT + \" seconds\");\n-        }\n-\n-        try (BufferedReader br = p.inputReader()) {\n-            String line = br.readLine();\n-            System.out.println(line);\n-            while (line != null && !line.startsWith(\"This command is not for general use\")) {\n-                System.out.println(line);\n-                line = br.readLine();\n-            }\n-            if (line == null) {\n-                throw new Exception(\"Wrong output from parent process\");\n-            }\n-            System.out.println(line);\n+            throw new RuntimeException(\"jspawnhelper timed out after \" + TIMEOUT + \" seconds\");\n@@ -74,3 +55,2 @@\n-\n-        if (p.exitValue() != 1)\n-            throw new Exception(\"Unexpected exit value from jspawnhelper \"+ p.exitValue());\n+        oa.shouldHaveExitValue(1);\n+        oa.shouldContain(\"This command is not for general use\");\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/JspawnhelperWarnings.java","additions":11,"deletions":31,"binary":false,"changes":42,"status":"modified"}]}