{"files":[{"patch":"@@ -36,0 +36,1 @@\n+import java.lang.foreign.Arena;\n@@ -39,0 +40,1 @@\n+import java.lang.foreign.MemorySegment;\n@@ -40,0 +42,2 @@\n+import java.lang.invoke.MethodHandles;\n+import java.lang.invoke.MethodType;\n@@ -79,3 +83,11 @@\n-        Linker.nativeLinker().downcallHandle(\n-                FunctionDescriptor.of(STRUCT_LL,\n-                        Stream.generate(() -> layout).limit(UPCALL_AVAILABLE_SLOTS \/ numSlots).toArray(MemoryLayout[]::new)));\n+        try (Arena arena = Arena.ofConfined()) {\n+            Linker.nativeLinker().upcallStub(\n+                    MethodHandles.empty(MethodType.methodType(MemorySegment.class,\n+                            Stream.generate(() -> layout).limit(UPCALL_AVAILABLE_SLOTS \/ numSlots)\n+                                    .map(ValueLayout::carrier)\n+                                    .toArray(Class<?>[]::new))),\n+                    FunctionDescriptor.of(STRUCT_LL,\n+                            Stream.generate(() -> layout).limit(UPCALL_AVAILABLE_SLOTS \/ numSlots)\n+                                    .toArray(MemoryLayout[]::new)),\n+                    arena);\n+        }\n","filename":"test\/jdk\/java\/foreign\/largestub\/TestLargeStub.java","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"}]}