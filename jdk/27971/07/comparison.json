{"files":[{"patch":"@@ -82,0 +82,2 @@\n+#include <ctype.h>\n+#include <dirent.h>\n@@ -2725,0 +2727,4 @@\n+\n+void os::print_open_file_descriptors(outputStream* st) {\n+  \/\/ File descriptor counting not implemented on AIX\n+}\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -79,0 +79,1 @@\n+# include <mach\/mach.h>\n@@ -105,0 +106,1 @@\n+  #include <libproc.h>\n@@ -1468,0 +1470,2 @@\n+  os::print_open_file_descriptors(st);\n+\n@@ -2581,0 +2585,33 @@\n+\n+void os::print_open_file_descriptors(outputStream* st) {\n+#ifdef __APPLE__\n+  const int MAX_SAFE_FDS = 1024;\n+  struct proc_fdinfo fds[MAX_SAFE_FDS];\n+  int nfiles;\n+  kern_return_t kres;\n+  int res;\n+  pid_t my_pid;\n+\n+  kres = pid_for_task(mach_task_self(), &my_pid);\n+  if (kres != KERN_SUCCESS) {\n+    st->print_cr(\"Open File Descriptors: unknown\");\n+    return;\n+  }\n+\n+  res = proc_pidinfo(my_pid, PROC_PIDLISTFDS, 0, fds, MAX_SAFE_FDS * sizeof(struct proc_fdinfo));\n+  if (res <= 0) {\n+    st->print_cr(\"Open File Descriptors: unknown\");\n+    return;\n+  }\n+\n+  nfiles = res \/ sizeof(struct proc_fdinfo);\n+  if (nfiles >= MAX_SAFE_FDS) {\n+    st->print_cr(\"Open File Descriptors: > 1024\");\n+    return;\n+  }\n+\n+  st->print_cr(\"Open File Descriptors: %d\", nfiles);\n+#else\n+    st->print_cr(\"Open File Descriptors: unknown\");\n+#endif\n+}\n\\ No newline at end of file\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":37,"deletions":0,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -86,0 +86,1 @@\n+# include <dirent.h>\n@@ -116,0 +117,1 @@\n+# include <time.h>\n@@ -2095,0 +2097,2 @@\n+  os::print_open_file_descriptors(st);\n+\n@@ -5383,0 +5387,38 @@\n+\n+void os::print_open_file_descriptors(outputStream* st) {\n+  DIR* dirp = opendir(\"\/proc\/self\/fd\");\n+  int fds = 0;\n+  struct dirent* dentp;\n+  const int TIMEOUT_MS = 50;\n+  struct timespec start, now;\n+  clock_gettime(CLOCK_MONOTONIC, &start);\n+  bool timed_out = false;\n+\n+  if (dirp == nullptr) {\n+    st->print_cr(\"Open File Descriptors: unknown\");\n+    return;\n+  }\n+\n+  \/\/ limit proc file read to 50ms\n+  while ((dentp = readdir(dirp)) != nullptr) {\n+    if (isdigit(dentp->d_name[0])) fds++;\n+    if (fds % 100 == 0) {\n+      clock_gettime(CLOCK_MONOTONIC, &now);\n+      long elapsed_ms = (now.tv_sec - start.tv_sec) * 1000L +\n+                        (now.tv_nsec - start.tv_nsec) \/ 1000000L;\n+      if (elapsed_ms > TIMEOUT_MS) {\n+        timed_out = true;\n+        break;\n+      }\n+    }\n+  }\n+\n+  closedir(dirp);\n+  if (timed_out) {\n+    st->print_cr(\"Open File Descriptors: > %d\", fds - 1); \/\/ minus the opendir fd itself\n+  } else {\n+    st->print_cr(\"Open File Descriptors: %d\", fds - 1);\n+  }\n+}\n+\n+\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":42,"deletions":0,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -6261,0 +6261,4 @@\n+void os::print_open_file_descriptors(outputStream* st) {\n+  \/\/ File descriptor counting not supported on Windows.\n+}\n+\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -848,0 +848,3 @@\n+  \/\/ Prints the number of open file descriptors for the current process\n+  static void print_open_file_descriptors(outputStream* st);\n+\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}