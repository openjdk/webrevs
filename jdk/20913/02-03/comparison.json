{"files":[{"patch":"@@ -639,0 +639,8 @@\n+  \/\/ If we are using UseCtxFencei no ICache invalidation is needed here.\n+  \/\/ Instead every hart will preform an fence.i either by a Java thread\n+  \/\/ (due to patching epoch will take it to slow path),\n+  \/\/ or by the kernel when a Java thread is moved to a hart.\n+  \/\/ The instruction streams changes must only happen before the disarm of\n+  \/\/ the nmethod barrier. Where the disarm have a leading full two way fence.\n+  \/\/ If this is performed during a safepoint, all Java threads will emit a fence.i\n+  \/\/ before transitioning to 'Java', e.g. leaving native or the safepoint wait barrier.\n@@ -640,1 +648,3 @@\n-    \/\/ A full fence is generated before icache_flush by default in invalidate_word\n+    \/\/ ICache invalidation is a serialization point.\n+    \/\/ The above patching of instructions happens before the invalidation.\n+    \/\/ Hence it have a leading full two way fence (wr, wr).\n@@ -642,2 +652,0 @@\n-  } else {\n-    OrderAccess::fence();\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/z\/zBarrierSetAssembler_riscv.cpp","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -59,0 +59,8 @@\n+  \/\/ If we are using UseCtxFencei no ICache invalidation is needed here.\n+  \/\/ Instead every hart will preform an fence.i either by a Java thread\n+  \/\/ (due to patching epoch will take it to slow path),\n+  \/\/ or by the kernel when a Java thread is moved to a hart.\n+  \/\/ The instruction streams changes must only happen before the disarm of\n+  \/\/ the nmethod barrier. Where the disarm have a leading full two way fence.\n+  \/\/ If this is performed during a safepoint, all Java threads will emit a fence.i\n+  \/\/ before transitioning to 'Java', e.g. leaving native or the safepoint wait barrier.\n@@ -60,0 +68,3 @@\n+    \/\/ ICache invalidation is a serialization point.\n+    \/\/ The above patching of instructions happens before the invalidation.\n+    \/\/ Hence it have a leading full two way fence (wr, wr).\n","filename":"src\/hotspot\/cpu\/riscv\/relocInfo_riscv.cpp","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"}]}