{"files":[{"patch":"@@ -124,20 +124,0 @@\n-  \/\/ Linux kernel require Zifencei\n-  if (!ext_Zifencei.enabled()) {\n-    ext_Zifencei.enable_feature();\n-  }\n-\n-  if (UseCtxFencei) {\n-    \/\/ Note that we can set this up only for effected threads\n-    \/\/ via PR_RISCV_SCOPE_PER_THREAD, i.e. on VM attach\/deattach.\n-    int ret = prctl(PR_RISCV_SET_ICACHE_FLUSH_CTX, PR_RISCV_CTX_SW_FENCEI_ON, PR_RISCV_SCOPE_PER_PROCESS);\n-    if (ret == 0) {\n-      if (FLAG_IS_DEFAULT(UseCtxFencei)) {\n-        FLAG_SET_DEFAULT(UseCtxFencei, true);\n-      }\n-      log_debug(os, cpu)(\"UseCtxFencei (PR_RISCV_CTX_SW_FENCEI_ON) enabled.\");\n-    } else {\n-      FLAG_SET_ERGO(UseCtxFencei, false);\n-      log_info(os, cpu)(\"UseCtxFencei (PR_RISCV_CTX_SW_FENCEI_ON) disabled, unsupported by kernel.\");\n-    }\n-  }\n-\n@@ -197,0 +177,18 @@\n+  \/\/ Linux kernel require Zifencei\n+  if (!ext_Zifencei.enabled()) {\n+    log_info(os, cpu)(\"Zifencei not found, required by Linux, enabling.\");\n+    ext_Zifencei.enable_feature();\n+  }\n+\n+  if (UseCtxFencei) {\n+    \/\/ Note that we can set this up only for effected threads\n+    \/\/ via PR_RISCV_SCOPE_PER_THREAD, i.e. on VM attach\/deattach.\n+    int ret = prctl(PR_RISCV_SET_ICACHE_FLUSH_CTX, PR_RISCV_CTX_SW_FENCEI_ON, PR_RISCV_SCOPE_PER_PROCESS);\n+    if (ret == 0) {\n+      log_debug(os, cpu)(\"UseCtxFencei (PR_RISCV_CTX_SW_FENCEI_ON) enabled.\");\n+    } else {\n+      FLAG_SET_ERGO(UseCtxFencei, false);\n+      log_info(os, cpu)(\"UseCtxFencei (PR_RISCV_CTX_SW_FENCEI_ON) disabled, unsupported by kernel.\");\n+    }\n+  }\n+\n","filename":"src\/hotspot\/os_cpu\/linux_riscv\/vm_version_linux_riscv.cpp","additions":18,"deletions":20,"binary":false,"changes":38,"status":"modified"}]}