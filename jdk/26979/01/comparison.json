{"files":[{"patch":"@@ -24,0 +24,1 @@\n+#include <errno.h>\n@@ -25,0 +26,3 @@\n+#include <stdlib.h>\n+#include <string.h>\n+#include <sys\/resource.h>\n@@ -27,0 +31,2 @@\n+static jint limit_num_fds();\n+\n@@ -29,0 +35,7 @@\n+  \/\/ Lower the number of possible open files to make the test go faster\n+  jint ret = limit_num_fds();\n+  if (ret != 0) {\n+    fprintf(stderr, \"Failed to limit number of fds: %s\", strerror(errno));\n+    return ret;\n+  }\n+\n@@ -32,0 +45,1 @@\n+    fprintf(stderr, \"Failed to open file: %s\", strerror(errno));\n@@ -34,0 +48,1 @@\n+\n@@ -37,0 +52,24 @@\n+\n+static jint limit_num_fds() {\n+  struct rlimit rl;\n+\n+  \/\/ Fetch the current limit\n+  int ret = getrlimit(RLIMIT_NOFILE, &rl);\n+  if (ret != 0) {\n+    return JNI_ERR;\n+  }\n+\n+  \/\/ Use a lower value unless it is already low\n+  rlim_t limit = 100;\n+  if (limit < rl.rlim_cur) {\n+    rl.rlim_cur = limit;\n+  }\n+\n+  \/\/ Lower the value\n+  int ret2 = setrlimit(RLIMIT_NOFILE, &rl);\n+  if (ret2 != 0) {\n+    return JNI_ERR;\n+  }\n+\n+  return JNI_OK;\n+}\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/FDLeakTest\/libFDLeaker.c","additions":39,"deletions":0,"binary":false,"changes":39,"status":"modified"}]}