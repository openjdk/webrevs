{"files":[{"patch":"@@ -3,1 +3,1 @@\n-# Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,2 @@\n-# the 'autoconf' program by the OpenJDK build.\n+# the 'autoconf' program by the OpenJDK build. To override TARGET_PLATFORM\n+# just set the variable before running this script.\n@@ -35,1 +36,21 @@\n-TARGET_PLATFORM=linux_x86\n+case `uname -s` in\n+    Darwin)\n+        os=macosx\n+        ;;\n+    Linux)\n+        os=linux\n+        ;;\n+    CYGWIN*)\n+        os=cygwin\n+        ;;\n+esac\n+case `uname -m` in\n+    arm64|aarch64)\n+        arch=aarch64\n+        ;;\n+    amd64|x86_64|x64)\n+        arch=x64\n+        ;;\n+esac\n+TARGET_PLATFORM=${TARGET_PLATFORM:=\"${os}_${arch}\"}\n+\n@@ -39,2 +60,2 @@\n-TMPDIR=`mktemp -d -t autoconfbundle-XXXX`\n-trap \"rm -rf \\\"$TMPDIR\\\"\" EXIT\n+SCRIPT_DIR=\"$(cd \"$(dirname $0)\" > \/dev\/null && pwd)\"\n+OUTPUT_ROOT=\"${SCRIPT_DIR}\/..\/..\/build\/autoconf\"\n@@ -42,4 +63,3 @@\n-ORIG_DIR=`pwd`\n-cd $TMPDIR\n-OUTPUT_DIR=$TMPDIR\/$MODULE_NAME\n-mkdir -p $OUTPUT_DIR\/usr\n+cd $OUTPUT_ROOT\n+IMAGE_DIR=$OUTPUT_ROOT\/$MODULE_NAME\n+mkdir -p $IMAGE_DIR\/usr\n@@ -51,2 +71,2 @@\n-  mkdir -p $OUTPUT_DIR\/usr\/bin\n-  cp \/usr\/bin\/m4 $OUTPUT_DIR\/usr\/bin\n+  mkdir -p $IMAGE_DIR\/usr\/bin\n+  cp \/usr\/bin\/m4 $IMAGE_DIR\/usr\/bin\n@@ -55,2 +75,2 @@\n-  mkdir -p $OUTPUT_DIR\/usr\/bin\n-  cp \/usr\/bin\/m4 $OUTPUT_DIR\/usr\/bin\n+  mkdir -p $IMAGE_DIR\/usr\/bin\n+  cp \/usr\/bin\/m4 $IMAGE_DIR\/usr\/bin\n@@ -60,2 +80,2 @@\n-  cd $OUTPUT_DIR\n-  rpm2cpio ..\/m4-$M4_VERSION.el6.x86_64.rpm | cpio -d -i\n+  cd $IMAGE_DIR\n+  rpm2cpio $OUTPUT_ROOT\/m4-$M4_VERSION.el6.x86_64.rpm | cpio -d -i\n@@ -65,2 +85,2 @@\n-  cd $OUTPUT_DIR\n-  rpm2cpio ..\/m4-$M4_VERSION.el6.i686.rpm | cpio -d -i\n+  cd $IMAGE_DIR\n+  rpm2cpio $OUTPUT_ROOT\/m4-$M4_VERSION.el6.i686.rpm | cpio -d -i\n@@ -71,1 +91,1 @@\n-  .\/configure --prefix=$OUTPUT_DIR\/usr\n+  .\/configure --prefix=$IMAGE_DIR\/usr CFLAGS=\"-w -Wno-everything\"\n@@ -82,1 +102,1 @@\n-.\/configure --prefix=$OUTPUT_DIR\/usr M4=$OUTPUT_DIR\/usr\/bin\/m4\n+.\/configure --prefix=$IMAGE_DIR\/usr M4=$IMAGE_DIR\/usr\/bin\/m4\n@@ -87,2 +107,1 @@\n-perl -pi -e \"s!$OUTPUT_DIR\/!.\/!\" $OUTPUT_DIR\/usr\/bin\/auto* $OUTPUT_DIR\/usr\/share\/autoconf\/autom4te.cfg\n-cp $OUTPUT_DIR\/usr\/share\/autoconf\/autom4te.cfg $OUTPUT_DIR\/autom4te.cfg\n+perl -pi -e \"s!$IMAGE_DIR\/!.\/!\" $IMAGE_DIR\/usr\/bin\/auto* $IMAGE_DIR\/usr\/share\/autoconf\/autom4te.cfg\n@@ -90,1 +109,1 @@\n-cat > $OUTPUT_DIR\/autoconf << EOF\n+cat > $IMAGE_DIR\/autoconf << EOF\n@@ -103,6 +122,1 @@\n-autom4te_cfg=\\$this_script_dir\/usr\/share\/autoconf\/autom4te.cfg\n-cp \\$this_script_dir\/autom4te.cfg \\$autom4te_cfg\n-\n-echo 'begin-language: \"M4sugar\"' >> \\$autom4te_cfg\n-echo \"args: --prepend-include '\"\\$this_script_dir\/usr\/share\/autoconf\"'\" >> \\$autom4te_cfg\n-echo 'end-language: \"M4sugar\"' >> \\$autom4te_cfg\n+PREPEND_INCLUDE=\"--prepend-include \\$this_script_dir\/usr\/share\/autoconf\"\n@@ -110,1 +124,1 @@\n-exec \\$this_script_dir\/usr\/bin\/autoconf \"\\$@\"\n+exec \\$this_script_dir\/usr\/bin\/autoconf \\$PREPEND_INCLUDE \"\\$@\"\n@@ -112,5 +126,3 @@\n-chmod +x $OUTPUT_DIR\/autoconf\n-cd $OUTPUT_DIR\n-tar -cvzf ..\/$BUNDLE_NAME *\n-cd ..\n-cp $BUNDLE_NAME \"$ORIG_DIR\"\n+chmod +x $IMAGE_DIR\/autoconf\n+cd $IMAGE_DIR\n+tar -cvzf $OUTPUT_ROOT\/$BUNDLE_NAME *\n","filename":"make\/devkit\/createAutoconfBundle.sh","additions":46,"deletions":34,"binary":false,"changes":80,"status":"modified"}]}