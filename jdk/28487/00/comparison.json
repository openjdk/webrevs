{"files":[{"patch":"@@ -165,1 +165,3 @@\n-                verify(cmd, launcherName, launcherAsService);\n+                \/\/ Launcher should not be a service with \"--launcher-as-service\"\n+                \/\/ and \"--mac-app-store\" specified.\n+                verify(cmd, launcherName, launcherAsService && !cmd.hasArgument(\"--mac-app-store\"));\n@@ -196,1 +198,1 @@\n-        if (launcherAsServiceNames.isEmpty() || cmd.isRuntime()) {\n+        if (launcherAsServiceNames.isEmpty() || cmd.isRuntime() || cmd.hasArgument(\"--mac-app-store\")) {\n@@ -311,1 +313,1 @@\n-        if (canVerifyInstall(cmd)) {\n+        if (canVerifyInstall(cmd) && !cmd.hasArgument(\"--mac-app-store\")) {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/LauncherAsServiceVerifier.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -814,1 +814,2 @@\n-                    && !LauncherAsServiceVerifier.getLaunchersAsServices(cmd).isEmpty();\n+                    && !LauncherAsServiceVerifier.getLaunchersAsServices(cmd).isEmpty()\n+                    && !cmd.hasArgument(\"--mac-app-store\");\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/PackageTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -57,1 +57,1 @@\n-                    PkgInstallScript.POSTINSTALL },\n+                    PkgInstallScript.POSTINSTALL }, false,\n@@ -60,1 +60,1 @@\n-                    PkgInstallScript.PREINSTALL },\n+                    PkgInstallScript.PREINSTALL }, false,\n@@ -63,1 +63,11 @@\n-                    PkgInstallScript.POSTINSTALL },\n+                    PkgInstallScript.POSTINSTALL }, false,\n+            },\n+            { new PkgInstallScript[]{\n+                    PkgInstallScript.PREINSTALL,\n+                    PkgInstallScript.POSTINSTALL }, true,\n+            },\n+            { new PkgInstallScript[]{\n+                    PkgInstallScript.PREINSTALL }, true,\n+            },\n+            { new PkgInstallScript[]{\n+                    PkgInstallScript.POSTINSTALL }, true,\n@@ -70,1 +80,1 @@\n-    public void test(PkgInstallScript[] customScriptRoles) {\n+    public void test(PkgInstallScript[] customScriptRoles, boolean appStore) {\n@@ -83,0 +93,3 @@\n+                if (appStore) {\n+                    cmd.addArgument(\"--mac-app-store\");\n+                }\n@@ -96,1 +109,1 @@\n-                    customScript.verify(cmd);\n+                    customScript.verify(cmd, !appStore);\n@@ -158,1 +171,1 @@\n-        void verify(JPackageCommand cmd) {\n+        void verify(JPackageCommand cmd, boolean exists) {\n@@ -160,2 +173,2 @@\n-                role.verifyExists(cmd, true);\n-            } else {\n+                role.verifyExists(cmd, exists);\n+            } else if (exists) {\n@@ -163,0 +176,2 @@\n+            } else {\n+                TKit.assertPathExists(responseFilePath(cmd), false);\n","filename":"test\/jdk\/tools\/jpackage\/macosx\/PkgScriptsTest.java","additions":23,"deletions":8,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+import jdk.internal.util.OperatingSystem;\n@@ -158,3 +159,5 @@\n-    @Parameter(\"true\")\n-    @Parameter(\"false\")\n-    public void testAddL(boolean mainLauncherAsService) {\n+    @Parameter(value = {\"true\", \"false\"})\n+    @Parameter(value = {\"false\", \"false\"})\n+    @Parameter(value = {\"true\", \"true\"}, ifOS = OperatingSystem.MACOS)\n+    @Parameter(value = {\"false\", \"true\"}, ifOS = OperatingSystem.MACOS)\n+    public void testAddL(boolean mainLauncherAsService, boolean isMacAppStore) {\n@@ -166,0 +169,5 @@\n+                .addInitializer(cmd -> {\n+                    if (isMacAppStore) {\n+                        cmd.addArgument(\"--mac-app-store\");\n+                    }\n+                })\n@@ -202,3 +210,5 @@\n-    @Parameter(\"true\")\n-    @Parameter(\"false\")\n-    public void testAddLFromAppImage(boolean mainLauncherAsService) {\n+    @Parameter(value = {\"true\", \"false\"})\n+    @Parameter(value = {\"false\", \"false\"})\n+    @Parameter(value = {\"true\", \"true\"}, ifOS = OperatingSystem.MACOS)\n+    @Parameter(value = {\"false\", \"true\"}, ifOS = OperatingSystem.MACOS)\n+    public void testAddLFromAppImage(boolean mainLauncherAsService, boolean isMacAppStore) {\n@@ -216,0 +226,4 @@\n+        if (isMacAppStore) {\n+            appImageCmd.cmd().orElseThrow().addArgument(\"--mac-app-store\");\n+        }\n+\n@@ -251,0 +265,3 @@\n+                    if (isMacAppStore) {\n+                        cmd.addArgument(\"--mac-app-store\");\n+                    }\n","filename":"test\/jdk\/tools\/jpackage\/share\/ServiceTest.java","additions":23,"deletions":6,"binary":false,"changes":29,"status":"modified"}]}