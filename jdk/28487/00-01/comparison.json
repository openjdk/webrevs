{"files":[{"patch":"@@ -152,1 +152,5 @@\n-            pkg.addInstallVerifier(this::verifyLauncherExecuted);\n+            pkg.addInstallVerifier(cmd -> {\n+                if (!MacHelper.isForAppStore(cmd)) {\n+                    verifyLauncherExecuted(cmd);\n+                }\n+            });\n@@ -230,1 +234,5 @@\n-        return Objects.requireNonNull(partitionLaunchers(cmd).get(true));\n+        if (MacHelper.isForAppStore(cmd)) {\n+            return List.of();\n+        } else {\n+            return Objects.requireNonNull(partitionLaunchers(cmd).get(true));\n+        }\n@@ -244,1 +252,3 @@\n-        if (cmd.isMainLauncher(launcherName)) {\n+        if (MacHelper.isForAppStore(cmd)) {\n+            return false;\n+        } else if (cmd.isMainLauncher(launcherName)) {\n@@ -307,1 +317,1 @@\n-        if (canVerifyInstall(cmd) && !cmd.hasArgument(\"--mac-app-store\")) {\n+        if (canVerifyInstall(cmd)) {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/LauncherAsServiceVerifier.java","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -798,0 +798,9 @@\n+    }\n+\n+    public static boolean isForAppStore(JPackageCommand cmd) {\n+        return PropertyFinder.findAppProperty(cmd,\n+                PropertyFinder.cmdlineBooleanOption(\"--mac-app-store\"),\n+                PropertyFinder.appImageFile(appImageFile -> {\n+                    return Boolean.toString(appImageFile.macAppStore());\n+                })\n+        ).map(Boolean::parseBoolean).orElse(false);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/MacHelper.java","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -814,2 +814,1 @@\n-                    && !LauncherAsServiceVerifier.getLaunchersAsServices(cmd).isEmpty()\n-                    && !cmd.hasArgument(\"--mac-app-store\");\n+                    && !LauncherAsServiceVerifier.getLaunchersAsServices(cmd).isEmpty();\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/PackageTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+import java.util.ArrayList;\n@@ -35,0 +36,1 @@\n+import jdk.jpackage.test.MacHelper;\n@@ -53,23 +55,12 @@\n-    public static Collection<?> input() {\n-        return List.of(new Object[][]{\n-            { new PkgInstallScript[]{\n-                    PkgInstallScript.PREINSTALL,\n-                    PkgInstallScript.POSTINSTALL }, false,\n-            },\n-            { new PkgInstallScript[]{\n-                    PkgInstallScript.PREINSTALL }, false,\n-            },\n-            { new PkgInstallScript[]{\n-                    PkgInstallScript.POSTINSTALL }, false,\n-            },\n-            { new PkgInstallScript[]{\n-                    PkgInstallScript.PREINSTALL,\n-                    PkgInstallScript.POSTINSTALL }, true,\n-            },\n-            { new PkgInstallScript[]{\n-                    PkgInstallScript.PREINSTALL }, true,\n-            },\n-            { new PkgInstallScript[]{\n-                    PkgInstallScript.POSTINSTALL }, true,\n-            },\n-        });\n+    public static Collection<Object[]> input() {\n+        List<Object[]> data = new ArrayList<>();\n+        for (var appStore : List.of(true, false)) {\n+            for (var scriptRoles : List.of(\n+                    List.of(PkgInstallScript.PREINSTALL, PkgInstallScript.POSTINSTALL),\n+                    List.of(PkgInstallScript.PREINSTALL),\n+                    List.of(PkgInstallScript.POSTINSTALL)\n+            )) {\n+                data.add(new Object[] {scriptRoles.toArray(PkgInstallScript[]::new), appStore});\n+            }\n+        }\n+        return data;\n@@ -109,1 +100,1 @@\n-                    customScript.verify(cmd, !appStore);\n+                    customScript.verify(cmd);\n@@ -171,1 +162,2 @@\n-        void verify(JPackageCommand cmd, boolean exists) {\n+        void verify(JPackageCommand cmd) {\n+            var scriptsEnabled = !MacHelper.isForAppStore(cmd);\n@@ -173,2 +165,2 @@\n-                role.verifyExists(cmd, exists);\n-            } else if (exists) {\n+                role.verifyExists(cmd, scriptsEnabled);\n+            } else if (scriptsEnabled) {\n","filename":"test\/jdk\/tools\/jpackage\/macosx\/PkgScriptsTest.java","additions":19,"deletions":27,"binary":false,"changes":46,"status":"modified"}]}