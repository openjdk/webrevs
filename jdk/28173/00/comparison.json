{"files":[{"patch":"@@ -27,1 +27,0 @@\n- * @key headful\n@@ -33,1 +32,1 @@\n-import java.awt.Graphics2D;\n+import java.awt.Graphics;\n@@ -37,1 +36,0 @@\n-import java.awt.Robot;\n@@ -48,1 +46,3 @@\n-    static JFrame frame;\n+    static final int WIDTH = 100;\n+    static final int HEIGHT = 100;\n+    static final int FONTSIZE = 32;\n@@ -50,3 +50,3 @@\n-    public static void main(String[] args) throws Exception {\n-        int width = 100;\n-        int height = 100;\n+    static int getEmptyPixel() {\n+        return 0xFFFFFFFF;\n+    }\n@@ -54,6 +54,12 @@\n-        try {\n-            Robot robot = new Robot();\n-            SwingUtilities.invokeAndWait(() -> {\n-                frame = new JFrame(\"TestGlyphBGHeight\");\n-                frame.setSize(width, height);\n-                frame.getContentPane().setLayout(new BorderLayout());\n+    static BufferedImage createImage() throws Exception {\n+        final BufferedImage img = new BufferedImage(WIDTH, HEIGHT, BufferedImage.TYPE_INT_ARGB);\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                @Override\n+                public void run() {\n+                    Graphics g = img.getGraphics();\n+                    g.setColor(new Color(getEmptyPixel()));\n+                    g.fillRect(0, 0, WIDTH, HEIGHT);\n+                }\n+            });\n+        return img;\n+    }\n@@ -61,2 +67,1 @@\n-                final JTextPane comp = new JTextPane();\n-                final StyledDocument doc = comp.getStyledDocument();\n+    public static void main(String[] args) throws Exception {\n@@ -64,7 +69,4 @@\n-                Style style = comp.addStyle(\"superscript\", null);\n-                StyleConstants.setSuperscript(style, true);\n-                StyleConstants.setFontSize(style, 32);\n-                StyleConstants.setBackground(style, Color.YELLOW);\n-                try {\n-                    doc.insertString(doc.getLength(), \"hello\", style);\n-                } catch (Exception e) {}\n+        final BufferedImage img = createImage();\n+        SwingUtilities.invokeAndWait(() -> {\n+            final JTextPane comp = new JTextPane();\n+            final StyledDocument doc = comp.getStyledDocument();\n@@ -72,2 +74,7 @@\n-                comp.setDocument(doc);\n-                comp.setBackground(Color.RED);\n+            Style style = comp.addStyle(\"superscript\", null);\n+            StyleConstants.setSuperscript(style, true);\n+            StyleConstants.setFontSize(style, FONTSIZE);\n+            StyleConstants.setBackground(style, Color.YELLOW);\n+            try {\n+                doc.insertString(doc.getLength(), \"hello\", style);\n+            } catch (Exception e) {}\n@@ -75,1 +82,3 @@\n-                frame.getContentPane().add(comp, BorderLayout.CENTER);\n+            comp.setSize(WIDTH, HEIGHT);\n+            comp.setDocument(doc);\n+            comp.setBackground(Color.RED);\n@@ -77,5 +86,2 @@\n-                frame.setLocationRelativeTo(null);\n-                frame.setVisible(true);\n-            });\n-            robot.waitForIdle();\n-            robot.delay(1000);\n+            comp.paint(img.getGraphics());\n+        });\n@@ -83,5 +89,1 @@\n-            BufferedImage img = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);\n-            Graphics2D g2d = (Graphics2D) img.getGraphics();\n-            frame.paint(g2d);\n-            ImageIO.write(img, \"png\", new File(\"AppTest.png\"));\n-            g2d.dispose();\n+        ImageIO.write(img, \"png\", new File(\"AppTest.png\"));\n@@ -89,10 +91,7 @@\n-            BufferedImage bimg = img.getSubimage(0, 80, width, 1);\n-            ImageIO.write(bimg, \"png\", new File(\"AppTest1.png\"));\n-            robot.waitForIdle();\n-            robot.delay(1000);\n-            for (int x = 10; x < width \/ 2; x++) {\n-                Color col = new Color(bimg.getRGB(x, 0));\n-                System.out.println(Integer.toHexString(bimg.getRGB(x, 0)));\n-                if (col.equals(Color.YELLOW)) {\n-                    throw new RuntimeException(\" Background is painted taller than needed for styled text\");\n-                }\n+        BufferedImage bimg = img.getSubimage(0, FONTSIZE + 20, WIDTH, 1);\n+        ImageIO.write(bimg, \"png\", new File(\"AppTest1.png\"));\n+        for (int x = 10; x < WIDTH\/ 2; x++) {\n+            Color col = new Color(bimg.getRGB(x, 0));\n+            System.out.println(Integer.toHexString(bimg.getRGB(x, 0)));\n+            if (col.equals(Color.YELLOW)) {\n+                throw new RuntimeException(\" Background is painted taller than needed for styled text\");\n@@ -100,6 +99,0 @@\n-        } finally {\n-            SwingUtilities.invokeAndWait(() -> {\n-                if (frame != null) {\n-                    frame.dispose();\n-                }\n-            });\n","filename":"test\/jdk\/javax\/swing\/text\/GlyphView\/TestGlyphBGHeight.java","additions":44,"deletions":51,"binary":false,"changes":95,"status":"modified"}]}