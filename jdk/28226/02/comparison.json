{"files":[{"patch":"@@ -111,3 +111,0 @@\n-            super(upstream, StreamShape.REFERENCE,\n-                  StreamOpFlag.IS_ORDERED | StreamOpFlag.IS_SORTED);\n-            this.isNaturalSort = true;\n@@ -117,1 +114,1 @@\n-            this.comparator = comp;\n+            this(upstream, comp);\n@@ -126,0 +123,2 @@\n+            Objects.requireNonNull(comparator);\n+            boolean isNaturalSort = Comparator.naturalOrder().equals(comparator);\n@@ -127,3 +126,4 @@\n-                  StreamOpFlag.IS_ORDERED | StreamOpFlag.NOT_SORTED);\n-            this.isNaturalSort = false;\n-            this.comparator = Objects.requireNonNull(comparator);\n+                  StreamOpFlag.IS_ORDERED |\n+                          (isNaturalSort ? StreamOpFlag.SORTED : StreamOpFlag.NOT_SORTED));\n+            this.isNaturalSort = isNaturalSort;\n+            this.comparator = comparator;\n","filename":"src\/java.base\/share\/classes\/java\/util\/stream\/SortedOps.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+import java.util.Comparator;\n@@ -741,3 +742,3 @@\n-     * {@code Comparator} is {@code null}) then the characteristic is converted\n-     * to the {@link #SORTED} flag, otherwise the characteristic is not\n-     * converted.\n+     * {@code Comparator} is {@code null} or {@code Comparator.naturalOrder()}) then\n+     * the characteristic is converted to the {@link #SORTED} flag, otherwise\n+     * the characteristic is not converted.\n@@ -751,1 +752,5 @@\n-        if ((characteristics & Spliterator.SORTED) != 0 && spliterator.getComparator() != null) {\n+        if ((characteristics & Spliterator.SORTED) != 0 &&\n+                !(spliterator.getComparator() == null ||\n+        if ((characteristics & Spliterator.SORTED) != 0 &&\n+                spliterator.getComparator() instanceof Comparator c &&\n+                !c.equals(Comparator.naturalOrder()))) {\n","filename":"src\/java.base\/share\/classes\/java\/util\/stream\/StreamOpFlag.java","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -380,0 +380,5 @@\n+\n+        {\n+            int flags = StreamOpFlag.fromCharacteristics(new SortedEmptySpliterator(Comparator.naturalOrder()));\n+            assertEquals(flags, StreamOpFlag.IS_SORTED);\n+        }\n","filename":"test\/jdk\/java\/util\/stream\/boottest\/java.base\/java\/util\/stream\/StreamOpFlagsTest.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import java.util.Comparator;\n@@ -118,0 +119,1 @@\n+        assertSorted(to10.stream().sorted(Comparator.naturalOrder()).iterator());\n@@ -122,0 +124,3 @@\n+        s = to10.stream().sorted(Comparator.naturalOrder()).spliterator();\n+        assertTrue(s.hasCharacteristics(Spliterator.SORTED));\n+\n","filename":"test\/jdk\/java\/util\/stream\/test\/org\/openjdk\/tests\/java\/util\/stream\/SortedOpTest.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}