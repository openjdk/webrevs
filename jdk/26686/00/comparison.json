{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,15 @@\n-\/**\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n+import java.net.Proxy;\n+import java.net.URL;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ThreadFactory;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import com.sun.net.httpserver.HttpServer;\n+import jdk.test.lib.net.URIBuilder;\n+\n+\/*\n@@ -39,14 +53,0 @@\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStream;\n-import java.net.InetAddress;\n-import java.net.InetSocketAddress;\n-import java.net.Proxy;\n-import java.net.URL;\n-import java.util.concurrent.Executors;\n-import java.util.concurrent.ThreadFactory;\n-import java.util.concurrent.atomic.AtomicInteger;\n-import com.sun.net.httpserver.HttpServer;\n-import jdk.test.lib.net.URIBuilder;\n-\n@@ -55,0 +55,2 @@\n+    private static final String HELLO = \"Hello\";\n+\n@@ -68,1 +70,2 @@\n-        server.setExecutor(Executors.newThreadPerTaskExecutor(factory));\n+        final ExecutorService serverExecutor = Executors.newThreadPerTaskExecutor(factory);\n+        server.setExecutor(serverExecutor);\n@@ -70,4 +73,11 @@\n-            byte[] response = \"Hello\".getBytes(\"UTF-8\");\n-            e.sendResponseHeaders(200, response.length);\n-            try (OutputStream out = e.getResponseBody()) {\n-                out.write(response);\n+            try {\n+                byte[] response = HELLO.getBytes(\"UTF-8\");\n+                e.sendResponseHeaders(200, response.length);\n+                try (OutputStream out = e.getResponseBody()) {\n+                    out.write(response);\n+                }\n+            } catch (Throwable t) {\n+                System.err.println(\"failed to handle request \" + e.getRequestURI()\n+                        + \" due to: \" + t);\n+                t.printStackTrace();\n+                throw t; \/\/ let it propagate\n@@ -88,1 +98,1 @@\n-        try {\n+        try (serverExecutor) {\n@@ -92,1 +102,5 @@\n-                    executor.submit(() -> fetch(url)).get();\n+                    final String actual = executor.submit(() -> fetch(url)).get();\n+                    if (!HELLO.equals(actual)) {\n+                        throw new RuntimeException(\"unexpected response: \\\"\" + actual\n+                                + \"\\\" for request \" + i);\n+                    }\n","filename":"test\/jdk\/java\/net\/vthread\/HttpALot.java","additions":37,"deletions":23,"binary":false,"changes":60,"status":"modified"}]}