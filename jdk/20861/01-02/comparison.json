{"files":[{"patch":"@@ -32,0 +32,1 @@\n+import java.awt.Dimension;\n@@ -34,2 +35,0 @@\n-import java.awt.event.ActionEvent;\n-import java.awt.event.ActionListener;\n@@ -37,0 +36,2 @@\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -46,3 +47,2 @@\n-    static volatile int buttonW;\n-    static volatile int buttonH;\n-    static volatile boolean passed = true;\n+    private static final CountDownLatch anyButton = new CountDownLatch(1);\n+    private static final CountDownLatch mouseButton1 = new CountDownLatch(1);\n@@ -59,3 +59,4 @@\n-                button.addActionListener(new ActionListener() {\n-                    public void actionPerformed(ActionEvent e) {\n-                        passed = false;\n+                button.addActionListener(e -> {\n+                    System.err.println(\"ActionEvent: \" + e);\n+                    if ((e.getModifiers() & InputEvent.BUTTON1_MASK) != 0) {\n+                        mouseButton1.countDown();\n@@ -63,0 +64,1 @@\n+                    anyButton.countDown();\n@@ -66,1 +68,0 @@\n-                frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n@@ -72,3 +73,3 @@\n-                pt = button.getLocationOnScreen();\n-                buttonW = button.getSize().width;\n-                buttonH = button.getSize().height;\n+                Point loc = button.getLocationOnScreen();\n+                Dimension size = button.getSize();\n+                pt = new Point(loc.x + size.width \/ 2, loc.y + size.height \/ 2);\n@@ -77,1 +78,1 @@\n-            robot.mouseMove(pt.x + buttonW \/ 2, pt.y + buttonH \/ 2);\n+            robot.mouseMove(pt.x, pt.y);\n@@ -85,3 +86,5 @@\n-            robot.delay(3000);\n-            boolean result = passed;\n-            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            if (anyButton.await(3, TimeUnit.SECONDS)) {\n+                \/\/ Restore robot state\n+                robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+                throw new RuntimeException(\"Unexpected ActionEvent\");\n+            }\n@@ -89,2 +92,3 @@\n-            if (!result) {\n-                throw new RuntimeException(\"Test Failed\");\n+            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            if (!mouseButton1.await(2, TimeUnit.SECONDS)) {\n+                throw new RuntimeException(\"Missing ActionEvent for BUTTON1\");\n","filename":"test\/jdk\/javax\/swing\/JButton\/bug4490179.java","additions":22,"deletions":18,"binary":false,"changes":40,"status":"modified"}]}