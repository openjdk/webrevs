{"files":[{"patch":"@@ -26,8 +26,0 @@\n-import org.testng.ITestContext;\n-import org.testng.ITestResult;\n-import org.testng.SkipException;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.AfterTest;\n-import org.testng.annotations.BeforeMethod;\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n@@ -64,0 +56,1 @@\n+import java.util.concurrent.atomic.AtomicBoolean;\n@@ -81,2 +74,11 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n+import org.junit.jupiter.api.AfterAll;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.extension.BeforeEachCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.junit.jupiter.api.extension.TestWatcher;\n@@ -86,17 +88,17 @@\n-    SSLContext sslContext;\n-    HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n-    HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n-    HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n-    HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n-    HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n-    String httpURI_fixed;\n-    String httpURI_chunk;\n-    String httpsURI_fixed;\n-    String httpsURI_chunk;\n-    String http2URI_fixed;\n-    String http2URI_chunk;\n-    String https2URI_fixed;\n-    String https2URI_chunk;\n-    String http3URI_fixed;\n-    String http3URI_chunk;\n-    String http3URI_head;\n+    static SSLContext sslContext;\n+    static HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n+    static HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n+    static HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n+    static HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n+    static HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n+    static String httpURI_fixed;\n+    static String httpURI_chunk;\n+    static String httpsURI_fixed;\n+    static String httpsURI_chunk;\n+    static String http2URI_fixed;\n+    static String http2URI_chunk;\n+    static String https2URI_fixed;\n+    static String https2URI_chunk;\n+    static String http3URI_fixed;\n+    static String http3URI_chunk;\n+    static String http3URI_head;\n@@ -120,2 +122,24 @@\n-    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n-    private volatile HttpClient sharedClient;\n+    record Heart(AtomicBoolean beat) implements TestWatcher, BeforeEachCallback {\n+        @Override\n+        public void testFailed(ExtensionContext context, Throwable cause) {\n+            if (stopAfterFirstFailure()) {\n+                beat.set(false);\n+                FAILURES.putIfAbsent(context.getDisplayName(), cause);\n+                System.out.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+                System.err.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+            }\n+        }\n+\n+        @Override\n+        public void beforeEach(ExtensionContext context) {\n+            Assumptions.assumeTrue(beat.get(), \"It's dead, Jim.\");\n+        }\n+    }\n+\n+    @RegisterExtension\n+    static final Heart heart = new Heart(new AtomicBoolean(true));\n+\n+    static final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+    private static volatile HttpClient sharedClient;\n@@ -147,1 +171,1 @@\n-    protected boolean stopAfterFirstFailure() {\n+    protected static boolean stopAfterFirstFailure() {\n@@ -151,10 +175,5 @@\n-    final AtomicReference<SkipException> skiptests = new AtomicReference<>();\n-    void checkSkip() {\n-        var skip = skiptests.get();\n-        if (skip != null) throw skip;\n-    }\n-    static String name(ITestResult result) {\n-        var params = result.getParameters();\n-        return result.getName()\n-                + (params == null ? \"()\" : Arrays.toString(result.getParameters()));\n-    }\n+\/\/    static String name(ITestResult result) {\n+\/\/        var params = result.getParameters();\n+\/\/        return result.getName()\n+\/\/                + (params == null ? \"()\" : Arrays.toString(result.getParameters()));\n+\/\/    }\n@@ -172,1 +191,1 @@\n-    HttpRequest.Builder newRequestBuilder(String uri) {\n+    static HttpRequest.Builder newRequestBuilder(String uri) {\n@@ -181,1 +200,1 @@\n-    HttpResponse<String> headRequest(HttpClient client)\n+    static HttpResponse<String> headRequest(HttpClient client)\n@@ -190,2 +209,2 @@\n-        assertEquals(response.statusCode(), 200);\n-        assertEquals(response.version(), HTTP_2);\n+        assertEquals(200, response.statusCode());\n+        assertEquals(HTTP_2, response.version());\n@@ -197,10 +216,0 @@\n-    @BeforeMethod\n-    void beforeMethod(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            if (skiptests.get() == null) {\n-                SkipException skip = new SkipException(\"some tests failed\");\n-                skip.setStackTrace(new StackTraceElement[0]);\n-                skiptests.compareAndSet(null, skip);\n-            }\n-        }\n-    }\n@@ -208,2 +217,2 @@\n-    @AfterClass\n-    static final void printFailedTests(ITestContext context) {\n+    @AfterAll\n+    static final void printFailedTests() {\n@@ -233,1 +242,1 @@\n-    private String[] uris() {\n+    private static String[] uris() {\n@@ -248,2 +257,1 @@\n-    @DataProvider(name = \"sanity\")\n-    public Object[][] sanity() {\n+    public static Object[][] sanity() {\n@@ -280,1 +288,1 @@\n-    private Object[][] variants(List<Thrower> throwers, Set<Where> whereValues) {\n+    private static Object[][] variants(List<Thrower> throwers, Set<Where> whereValues) {\n@@ -299,5 +307,1 @@\n-    @DataProvider(name = \"subscribeProvider\")\n-    public Object[][] subscribeProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] subscribeProvider() {\n@@ -310,5 +314,1 @@\n-    @DataProvider(name = \"requestProvider\")\n-    public Object[][] requestProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] requestProvider() {\n@@ -321,5 +321,1 @@\n-    @DataProvider(name = \"nextRequestProvider\")\n-    public Object[][] nextRequestProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] nextRequestProvider() {\n@@ -332,5 +328,1 @@\n-    @DataProvider(name = \"beforeCancelProviderIO\")\n-    public Object[][] beforeCancelProviderIO(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] beforeCancelProviderIO() {\n@@ -342,5 +334,1 @@\n-    @DataProvider(name = \"afterCancelProviderIO\")\n-    public Object[][] afterCancelProviderIO(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] afterCancelProviderIO() {\n@@ -352,5 +340,1 @@\n-    @DataProvider(name = \"beforeCancelProviderCustom\")\n-    public Object[][] beforeCancelProviderCustom(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] beforeCancelProviderCustom() {\n@@ -362,5 +346,1 @@\n-    @DataProvider(name = \"afterCancelProviderCustom\")\n-    public Object[][] afterCancelProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] afterCancelProviderCustom() {\n@@ -372,1 +352,1 @@\n-    private HttpClient makeNewClient() {\n+    private static HttpClient makeNewClient() {\n@@ -374,1 +354,1 @@\n-        return TRACKER.track(newClientBuilderForH3()\n+        return TRACKER.track(HttpServerAdapters.createClientBuilderForH3()\n@@ -381,1 +361,1 @@\n-    HttpClient newHttpClient(boolean share) {\n+    static HttpClient newHttpClient(boolean share) {\n@@ -385,1 +365,1 @@\n-        synchronized (this) {\n+        synchronized (AbstractThrowingPublishers.class) {\n@@ -433,1 +413,1 @@\n-            assertEquals(body, Stream.of(BODY.split(\"\\\\|\")).collect(Collectors.joining()));\n+            assertEquals(Stream.of(BODY.split(\"\\\\|\")).collect(Collectors.joining()), body);\n@@ -477,1 +457,0 @@\n-        checkSkip();\n@@ -781,2 +760,2 @@\n-    @BeforeTest\n-    public void setup() throws Exception {\n+    @BeforeAll\n+    public static void setup() throws Exception {\n@@ -864,2 +843,2 @@\n-    @AfterTest\n-    public void teardown() throws Exception {\n+    @AfterAll\n+    public static void teardown() throws Exception {\n","filename":"test\/jdk\/java\/net\/httpclient\/AbstractThrowingPublishers.java","additions":84,"deletions":105,"binary":false,"changes":189,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"afterCancelProviderCustom\")\n+    @ParameterizedTest\n+    @MethodSource(\"afterCancelProviderCustom\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersCustomAfterCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"beforeCancelProviderCustom\")\n+    @ParameterizedTest\n+    @MethodSource(\"beforeCancelProviderCustom\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersCustomBeforeCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"afterCancelProviderIO\")\n+    @ParameterizedTest\n+    @MethodSource(\"afterCancelProviderIO\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersIOAfterCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"beforeCancelProviderIO\")\n+    @ParameterizedTest\n+    @MethodSource(\"beforeCancelProviderIO\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersIOBeforeCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"nextRequestProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"nextRequestProvider\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersInNextRequest.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"requestProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"requestProvider\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersInRequest.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"subscribeProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"subscribeProvider\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersInSubscribe.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -41,1 +42,2 @@\n-    @Test(dataProvider = \"sanity\")\n+    @ParameterizedTest\n+    @MethodSource(\"sanity\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersSanity.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"}]}