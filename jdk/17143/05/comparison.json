{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -219,1 +219,11 @@\n-        for (MethodHandle getter : getters) {\n+        var equalsGetters = getters.toArray(new MethodHandle[0]);\n+        Arrays.sort(equalsGetters, (mh1, mh2) -> {\n+            var rt1 = mh1.type().returnType();\n+            var rt2 = mh2.type().returnType();\n+            return Integer.compare(\n+                rt1.isPrimitive() || rt1.isEnum() || rt1.isArray() ? 1 : Iterable.class.isAssignableFrom(rt1) ? -1 : 0,\n+                rt2.isPrimitive() || rt2.isEnum() || rt2.isArray() ? 1 : Iterable.class.isAssignableFrom(rt2) ? -1 : 0\n+            );\n+        });\n+\n+        for (MethodHandle getter : equalsGetters) {\n@@ -437,1 +447,1 @@\n-                List<String> nameList = \"\".equals(names) ? List.of() : List.of(names.split(\";\"));\n+                List<String> nameList = names.isEmpty() ? List.of() : List.of(names.split(\";\"));\n","filename":"src\/java.base\/share\/classes\/java\/lang\/runtime\/ObjectMethods.java","additions":13,"deletions":3,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import java.util.ArrayList;\n@@ -38,0 +39,2 @@\n+import java.util.concurrent.TimeUnit;\n+\n@@ -41,0 +44,1 @@\n+import static org.testng.Assert.assertNotEquals;\n@@ -142,0 +146,36 @@\n+    public void testRearrangeEquals() {\n+        class ThrowingList extends ArrayList<Object> {\n+            public boolean equals(Object o) {\n+                throw new IllegalStateException(\"Shouldn't be called\");\n+            }\n+        }\n+\n+        class ThrowingObject {\n+            public boolean equals(Object obj) {\n+                throw new IllegalStateException(\"Shouldn't be called\");\n+            }\n+        }\n+\n+        record TestRecord1(List<Object> list, byte[] bytes, long id){}\n+        record TestRecord2(Object object, TimeUnit timeUnit, int id){}\n+\n+        var obj1 = new TestRecord1(new ThrowingList(), new byte[0], 1);\n+        var obj2 = new TestRecord1(new ThrowingList(), new byte[0], -1);\n+\n+        \/\/check exception is not thrown because false is returned before calling ThrowingList.equals()\n+        assertNotEquals(obj1, obj2);\n+        \/\/verify List.equals() is called\n+        assertThrows(ISE, () -> {\n+            byte[] sameArray = new byte[0];\n+            new TestRecord1(new ThrowingList(), sameArray, 1).equals(new TestRecord1(new ThrowingList(), sameArray, 1));\n+        });\n+\n+        var obj3 = new TestRecord2(new ThrowingObject(), TimeUnit.DAYS, 1);\n+        var obj4 = new TestRecord2(new ThrowingObject(), TimeUnit.HOURS, 1);\n+\n+        \/\/check exception is not thrown because false is returned before calling ThrowingObject.equals()\n+        assertNotEquals(obj3, obj4);\n+        \/\/verify Object.equals() is called\n+        assertThrows(ISE, () -> new TestRecord2(new ThrowingObject(), TimeUnit.DAYS, 1).equals(new TestRecord2(new ThrowingObject(), TimeUnit.DAYS, 1)));\n+    }\n+\n@@ -144,0 +184,1 @@\n+    Class<IllegalStateException> ISE = IllegalStateException.class;\n","filename":"test\/jdk\/java\/lang\/runtime\/ObjectMethodsTest.java","additions":42,"deletions":1,"binary":false,"changes":43,"status":"modified"}]}