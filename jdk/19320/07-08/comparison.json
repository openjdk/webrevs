{"files":[{"patch":"@@ -3614,0 +3614,29 @@\n+void MacroAssembler::population_count(Register dst, Register src,\n+                                      Register tmp1, Register tmp2) {\n+  if (UsePopCountInstruction) {\n+    cpop(dst, src);\n+  } else {\n+    assert_different_registers(src, tmp1, tmp2);\n+    assert_different_registers(dst, tmp1, tmp2);\n+    Label loop, done;\n+\n+    mv(tmp1, src);\n+    \/\/ dst = 0;\n+    \/\/ while(tmp1 != 0) {\n+    \/\/   dst++;\n+    \/\/   tmp1 &= (tmp1 - 1);\n+    \/\/ }\n+    mv(dst, zr);\n+    beqz(tmp1, done);\n+    {\n+      bind(loop);\n+      addi(dst, dst, 1);\n+      mv(tmp2, tmp1);\n+      addi(tmp2, tmp2, -1);\n+      andr(tmp1, tmp1, tmp2);\n+      bnez(tmp1, loop);\n+    }\n+    bind(done);\n+  }\n+}\n+\n@@ -3670,1 +3699,1 @@\n-    cpop(r_array_index, r_array_index);\n+    population_count(r_array_index, r_array_index, t0, tmp1);\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.cpp","additions":30,"deletions":1,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -325,0 +325,2 @@\n+  void population_count(Register dst, Register src, Register tmp1, Register tmp2);\n+\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -206,9 +206,0 @@\n-  if (!UsePopCountInstruction) {\n-    if (UseSecondarySupersTable) {\n-      if (!FLAG_IS_DEFAULT(UseSecondarySupersTable)) {\n-        warning(\"UseSecondarySupersTable is not supported on this CPU\");\n-      }\n-      FLAG_SET_DEFAULT(UseSecondarySupersTable, false);\n-    }\n-  }\n-\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.cpp","additions":0,"deletions":9,"binary":false,"changes":9,"status":"modified"}]}