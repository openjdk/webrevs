{"files":[{"patch":"@@ -118,7 +118,0 @@\n-    \/\/ Check if the line is output TRACE_RESOLVE\n-    if (strncmp(_line, LambdaFormInvokers::lambda_form_invoker_tag(),\n-                strlen(LambdaFormInvokers::lambda_form_invoker_tag())) == 0) {\n-      LambdaFormInvokers::append(os::strdup((const char*)_line, mtInternal));\n-      continue;\n-    }\n-\n@@ -136,0 +129,1 @@\n+  _lambda_form_line = false;\n@@ -188,2 +182,2 @@\n-void ClassListParser::split_tokens_by_whitespace() {\n-  int start = 0;\n+void ClassListParser::split_tokens_by_whitespace(int offset) {\n+  int start = offset;\n@@ -206,0 +200,12 @@\n+int ClassListParser::split_at_tag_from_line() {\n+  _token = _line;\n+  char* ptr;\n+  if ((ptr = strchr(_line, ' ')) == NULL) {\n+    error(\"Too few items following the @ tag \\\"%s\\\" line #%d\", _line, _line_no);\n+    return 0;\n+  }\n+  *ptr++ = '\\0';\n+  while (*ptr == ' ' || *ptr == '\\t') ptr++;\n+  return (int)(ptr - _line);\n+}\n+\n@@ -208,4 +214,9 @@\n-  split_tokens_by_whitespace();\n-  if (strcmp(_indy_items->at(0), LAMBDA_PROXY_TAG) == 0) {\n-    if (_indy_items->length() < 3) {\n-      error(\"Line with @ tag has too few items \\\"%s\\\" line #%d\", _line, _line_no);\n+  int offset;\n+  if ((offset = split_at_tag_from_line()) == 0) {\n+    return false;\n+  }\n+\n+  if (strcmp(_token, LAMBDA_PROXY_TAG) == 0) {\n+    split_tokens_by_whitespace(offset);\n+    if (_indy_items->length() < 2) {\n+      error(\"Line with @ tag has too few items \\\"%s\\\" line #%d\", _token, _line_no);\n@@ -215,1 +226,5 @@\n-    _class_name = _indy_items->at(1);\n+    _class_name = _indy_items->at(0);\n+    return true;\n+  } else if (strcmp(_token, LAMBDA_FORM_TAG) == 0) {\n+    LambdaFormInvokers::append(os::strdup((const char*)(_line + offset), mtInternal));\n+    _lambda_form_line = true;\n@@ -218,1 +233,1 @@\n-    error(\"Invalid @ tag at the beginning of line \\\"%s\\\" line #%d\", _line, _line_no);\n+    error(\"Invalid @ tag at the beginning of line \\\"%s\\\" line #%d\", _token, _line_no);\n@@ -435,1 +450,1 @@\n-  int indy_info_offset = 2;\n+  int indy_info_offset = 1;\n","filename":"src\/hotspot\/share\/classfile\/classListParser.cpp","additions":31,"deletions":16,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -33,1 +33,2 @@\n-#define LAMBDA_PROXY_TAG \"@lambda-proxy:\"\n+#define LAMBDA_PROXY_TAG \"@lambda-proxy\"\n+#define LAMBDA_FORM_TAG  \"@lambda-form-invoker\"\n@@ -102,0 +103,1 @@\n+  bool                _lambda_form_line;\n@@ -123,1 +125,2 @@\n-  void split_tokens_by_whitespace();\n+  void split_tokens_by_whitespace(int offset);\n+  int split_at_tag_from_line();\n@@ -165,0 +168,2 @@\n+  bool lambda_form_line() { return _lambda_form_line; }\n+\n","filename":"src\/hotspot\/share\/classfile\/classListParser.hpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -69,3 +69,1 @@\n-    char* record = _lambdaform_lines->at(i);\n-    record += strlen(lambda_form_invoker_tag()) + 1; \/\/ skip the @lambda_form_invoker prefix\n-    Handle h_line = java_lang_String::create_from_str(record, CHECK);\n+    Handle h_line = java_lang_String::create_from_str(_lambdaform_lines->at(i), CHECK);\n","filename":"src\/hotspot\/share\/classfile\/lambdaFormInvokers.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -45,4 +45,0 @@\n-\n-  static const char* lambda_form_invoker_tag() {\n-    return \"@lambda-form-invoker\";\n-  }\n","filename":"src\/hotspot\/share\/classfile\/lambdaFormInvokers.hpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1099,0 +1099,3 @@\n+    if (parser.lambda_form_line()) {\n+      continue;\n+    }\n","filename":"src\/hotspot\/share\/memory\/metaspaceShared.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"classfile\/classListParser.hpp\"\n@@ -35,1 +36,0 @@\n-#include \"classfile\/lambdaFormInvokers.hpp\"\n@@ -3886,1 +3886,1 @@\n-    w.stream()->print_cr(\"%s %s\", LambdaFormInvokers::lambda_form_invoker_tag(), c_line);\n+    w.stream()->print_cr(\"%s %s\", LAMBDA_FORM_TAG, c_line);\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-                        \"@lambda-proxy: WrongBSM 7\"));\n+                        \"@lambda-proxy WrongBSM 7\"));\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/BadBSM.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-                        \"@lambda-proxy: LambHello run ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()V\"));\n+                        \"@lambda-proxy LambHello run ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()V\"));\n@@ -52,1 +52,1 @@\n-                        \"@lambda-proxy: LambHello\"));\n+                        \"@lambda-proxy LambHello\"));\n@@ -54,1 +54,1 @@\n-       .shouldContain(\"Line with @ tag has too few items \\\"@lambda-proxy:\\\" line #2\")\n+       .shouldContain(\"Line with @ tag has too few items \\\"@lambda-proxy\\\" line #2\")\n@@ -61,1 +61,1 @@\n-                        \"@lambda-proxy: LambHello run ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()Z\"));\n+                        \"@lambda-proxy LambHello run ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()Z\"));\n@@ -68,1 +68,1 @@\n-                        \"@lambda-proxy:  LambHello run  ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()V\"));\n+                        \"@lambda-proxy  LambHello run  ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()V\"));\n@@ -74,1 +74,1 @@\n-                        \"@lambda-proxy: LambHello run ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()V \"));\n+                        \"@lambda-proxy LambHello run ()Ljava\/lang\/Runnable; ()V REF_invokeStatic LambHello lambda$doTest$0 ()V ()V \"));\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/LambdaProxyClasslist.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"}]}