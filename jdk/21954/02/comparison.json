{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -169,1 +169,1 @@\n-      ClassFileStream st((u1*)buf, len, nullptr, ClassFileStream::verify);\n+      ClassFileStream st((u1*)buf, len, nullptr);\n","filename":"src\/hotspot\/share\/cds\/lambdaFormInvokers.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4662,1 +4662,1 @@\n-  if (!_need_verify || _relax_verify) { return; }\n+  if (!_need_verify) { return; }\n@@ -4702,1 +4702,1 @@\n-  if (!_need_verify || _relax_verify) { return; }\n+  if (!_need_verify) { return; }\n@@ -4735,1 +4735,1 @@\n-  if (!_need_verify || _relax_verify) { return; }\n+  if (!_need_verify) { return; }\n@@ -5239,11 +5239,0 @@\n-static bool relax_format_check_for(ClassLoaderData* loader_data) {\n-  bool trusted = loader_data->is_boot_class_loader_data() ||\n-                 loader_data->is_platform_class_loader_data();\n-  bool need_verify =\n-    \/\/ verifyAll\n-    (BytecodeVerificationLocal && BytecodeVerificationRemote) ||\n-    \/\/ verifyRemote\n-    (!BytecodeVerificationLocal && BytecodeVerificationRemote && !trusted);\n-  return !need_verify;\n-}\n-\n@@ -5306,1 +5295,0 @@\n-  _relax_verify(false),\n@@ -5327,14 +5315,1 @@\n-  if (CDSConfig::is_dumping_static_archive()) {\n-    \/\/ verify == true means it's a 'remote' class (i.e., non-boot class)\n-    \/\/ Verification decision is based on BytecodeVerificationRemote flag\n-    \/\/ for those classes.\n-    _need_verify = (stream->need_verify()) ? BytecodeVerificationRemote :\n-                                              BytecodeVerificationLocal;\n-  }\n-  else {\n-    _need_verify = Verifier::should_verify_for(_loader_data->class_loader(),\n-                                               stream->need_verify());\n-  }\n-\n-  \/\/ synch back verification state to stream\n-  stream->set_verify(_need_verify);\n+  _need_verify = Verifier::should_verify_for(_loader_data->class_loader());\n@@ -5342,3 +5317,2 @@\n-  \/\/ Check if verification needs to be relaxed for this class file\n-  \/\/ Do not restrict it to jdk1.0 or jdk1.1 to maintain backward compatibility (4982376)\n-  _relax_verify = relax_format_check_for(_loader_data);\n+  \/\/ synch back verification state to stream to check for truncation.\n+  stream->set_need_verify(_need_verify);\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":6,"deletions":32,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -188,1 +188,0 @@\n-  bool _relax_verify;\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,2 +31,0 @@\n-const bool ClassFileStream::verify = true;\n-\n@@ -40,1 +38,0 @@\n-                                 bool verify_stream,\n@@ -46,1 +43,1 @@\n-  _need_verify(verify_stream),\n+  _need_verify(true),  \/\/ may be reset by ClassFileParser when this stream is parsed.\n@@ -75,1 +72,0 @@\n-                             need_verify(),\n","filename":"src\/hotspot\/share\/classfile\/classFileStream.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-  bool _need_verify;             \/\/ True if verification is on for the class file\n+  bool _need_verify;             \/\/ True if we need to verify and check truncation of stream bytes.\n@@ -55,2 +55,0 @@\n-  static const bool verify;\n-\n@@ -60,1 +58,0 @@\n-                  bool verify_stream = verify,  \/\/ to be verified by default\n@@ -80,1 +77,1 @@\n-  void set_verify(bool flag) { _need_verify = flag; }\n+  void set_need_verify(bool flag) { _need_verify = flag; }\n","filename":"src\/hotspot\/share\/classfile\/classFileStream.hpp","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -300,2 +300,1 @@\n-                                   _dir,\n-                                   ClassFileStream::verify);\n+                                   _dir);\n@@ -369,2 +368,1 @@\n-                             _zip_name,\n-                             ClassFileStream::verify);\n+                             _zip_name);\n@@ -452,1 +450,0 @@\n-                               ClassFileStream::verify,\n@@ -1201,2 +1198,0 @@\n-  stream->set_verify(ClassLoaderExt::should_verify(classpath_index));\n-\n","filename":"src\/hotspot\/share\/classfile\/classLoader.cpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,5 +36,0 @@\n-  static bool should_verify(int classpath_index) {\n-    CDS_ONLY(return (classpath_index >= _app_class_paths_start_index);)\n-    NOT_CDS(return false;)\n-  }\n-\n","filename":"src\/hotspot\/share\/classfile\/classLoaderExt.hpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-* Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+* Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -80,2 +80,1 @@\n-                                                    cfs->source(),\n-                                                    ClassFileStream::verify);\n+                                                    cfs->source());\n@@ -160,2 +159,1 @@\n-                                   stream->source(),\n-                                   stream->need_verify());\n+                                   stream->source());\n","filename":"src\/hotspot\/share\/classfile\/klassFactory.cpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -828,1 +828,0 @@\n-  assert(st->need_verify(), \"invariant\");\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -108,2 +108,2 @@\n-bool Verifier::should_verify_for(oop class_loader, bool should_verify_class) {\n-  return (class_loader == nullptr || !should_verify_class) ?\n+bool Verifier::should_verify_for(oop class_loader) {\n+  return class_loader == nullptr ?\n@@ -279,1 +279,1 @@\n-  return (should_verify_for(klass->class_loader(), should_verify_class) &&\n+  return (should_verify_class &&\n","filename":"src\/hotspot\/share\/classfile\/verifier.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,1 +55,1 @@\n-  static bool should_verify_for(oop class_loader, bool should_verify_class);\n+  static bool should_verify_for(oop class_loader);\n","filename":"src\/hotspot\/share\/classfile\/verifier.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -1205,1 +1205,1 @@\n-  return new ClassFileStream(new_buffer, orig_stream_length, nullptr, ClassFileStream::verify);\n+  return new ClassFileStream(new_buffer, orig_stream_length, nullptr);\n@@ -1513,1 +1513,1 @@\n-  return new ClassFileStream(new_bytes, size_of_new_bytes, nullptr, ClassFileStream::verify);\n+  return new ClassFileStream(new_bytes, size_of_new_bytes, nullptr);\n@@ -1550,1 +1550,1 @@\n-  return new ClassFileStream(new_bytes, size_of_new_bytes, nullptr, ClassFileStream::verify);\n+  return new ClassFileStream(new_bytes, size_of_new_bytes, nullptr);\n","filename":"src\/hotspot\/share\/jfr\/instrumentation\/jfrEventClassTransformer.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -291,1 +291,1 @@\n-  ClassFileStream st((u1*)buf, bufLen, nullptr, ClassFileStream::verify);\n+  ClassFileStream st((u1*)buf, bufLen, nullptr);\n","filename":"src\/hotspot\/share\/prims\/jni.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -920,1 +920,1 @@\n-  ClassFileStream st((u1*)buf, len, source, ClassFileStream::verify);\n+  ClassFileStream st((u1*)buf, len, source);\n@@ -1006,1 +1006,1 @@\n-  ClassFileStream st((u1*)buf, len, source, ClassFileStream::verify);\n+  ClassFileStream st((u1*)buf, len, source);\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1365,2 +1365,1 @@\n-                       \"__VM_RedefineClasses__\",\n-                       ClassFileStream::verify);\n+                       \"__VM_RedefineClasses__\");\n","filename":"src\/hotspot\/share\/prims\/jvmtiRedefineClasses.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}