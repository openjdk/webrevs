{"files":[{"patch":"@@ -35,1 +35,0 @@\n-import sun.awt.AppContext;\n@@ -964,1 +963,2 @@\n-        private static final Object ICON_SIZE_KEY = new StringBuffer(\"IconSize\");\n+\n+        private static Dimension[] iconSizesMap;\n@@ -967,2 +967,1 @@\n-            AppContext appContext = AppContext.getAppContext();\n-            Dimension[] iconSizes = (Dimension[])appContext.get(ICON_SIZE_KEY);\n+            Dimension[] iconSizes = iconSizesMap;\n@@ -979,1 +978,1 @@\n-                appContext.put(ICON_SIZE_KEY, iconSizes);\n+                iconSizesMap = iconSizes;\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKStyle.java","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-import sun.awt.AppContext;\n-\n@@ -84,0 +82,2 @@\n+    private static final ArrayCache ARRAY_CACHE = new ArrayCache();\n+\n@@ -85,6 +85,1 @@\n-        ArrayCache cache = (ArrayCache)AppContext.getAppContext().get(ArrayCache.class);\n-        if (cache == null){\n-            cache = new ArrayCache();\n-            AppContext.getAppContext().put(ArrayCache.class,cache);\n-        }\n-        return cache;\n+        return ARRAY_CACHE;\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/nimbus\/Effect.java","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -31,1 +31,0 @@\n-import sun.awt.AppContext;\n@@ -44,2 +43,0 @@\n-    private static final StringBuffer CACHE_KEY =\n-                               new StringBuffer(\"SynthCacheKey\");\n@@ -56,0 +53,2 @@\n+    private static volatile WeakReference<Paint9Painter> cacheRef;\n+\n@@ -58,3 +57,1 @@\n-        \/\/ cache to be shared by all, and we don't use a static because we\n-        \/\/ don't want it to persist between look and feels.  For that reason\n-        \/\/ we use a AppContext specific Paint9Painter.  It's backed via\n+        \/\/ cache to be shared by all. It's held via\n@@ -62,5 +59,1 @@\n-        synchronized(CACHE_KEY) {\n-            @SuppressWarnings(\"unchecked\")\n-            WeakReference<Paint9Painter> cacheRef =\n-                     (WeakReference<Paint9Painter>)AppContext.getAppContext().\n-                     get(CACHE_KEY);\n+        synchronized(ImagePainter.class) {\n@@ -71,1 +64,0 @@\n-                AppContext.getAppContext().put(CACHE_KEY, cacheRef);\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/synth\/ImagePainter.java","additions":4,"deletions":12,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-import sun.awt.AppContext;\n-\n@@ -75,2 +73,0 @@\n-    private static final Object UI_TO_REGION_MAP_KEY = new Object();\n-    private static final Object LOWER_CASE_NAME_MAP_KEY = new Object();\n@@ -428,4 +424,4 @@\n-    private static Map<String, Region> getUItoRegionMap() {\n-        AppContext context = AppContext.getAppContext();\n-        @SuppressWarnings(\"unchecked\")\n-        Map<String, Region> map = (Map<String, Region>) context.get(UI_TO_REGION_MAP_KEY);\n+    private static Map<String, Region> regionMap;\n+\n+    private static synchronized Map<String, Region> getUItoRegionMap() {\n+        Map<String, Region> map = regionMap;\n@@ -479,1 +475,1 @@\n-            context.put(UI_TO_REGION_MAP_KEY, map);\n+            regionMap = map;\n@@ -484,4 +480,4 @@\n-    private static Map<Region, String> getLowerCaseNameMap() {\n-        AppContext context = AppContext.getAppContext();\n-        @SuppressWarnings(\"unchecked\")\n-        Map<Region, String> map = (Map<Region, String>) context.get(LOWER_CASE_NAME_MAP_KEY);\n+    private static Map<Region, String> lcRegionMap;\n+\n+    private static synchronized Map<Region, String> getLowerCaseNameMap() {\n+        Map<Region, String> map = lcRegionMap;\n@@ -490,1 +486,1 @@\n-            context.put(LOWER_CASE_NAME_MAP_KEY, map);\n+            lcRegionMap = map;\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/synth\/Region.java","additions":10,"deletions":14,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -28,2 +28,0 @@\n-import sun.awt.AppContext;\n-\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/synth\/SynthButtonUI.java","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -63,1 +63,0 @@\n-import sun.awt.AppContext;\n@@ -104,15 +103,2 @@\n-    \/**\n-     * AppContext key to get the current SynthStyleFactory.\n-     *\/\n-    private static final Object STYLE_FACTORY_KEY =\n-                  new StringBuffer(\"com.sun.java.swing.plaf.gtk.StyleCache\");\n-\n-    \/**\n-     * AppContext key to get selectedUI.\n-     *\/\n-    private static final Object SELECTED_UI_KEY = new StringBuilder(\"selectedUI\");\n-\n-    \/**\n-     * AppContext key to get selectedUIState.\n-     *\/\n-    private static final Object SELECTED_UI_STATE_KEY = new StringBuilder(\"selectedUIState\");\n+    private static ComponentUI selectedUI;\n+    private static int selectedUIStateValue;\n@@ -121,2 +107,1 @@\n-     * The last SynthStyleFactory that was asked for from AppContext\n-     * <code>lastContext<\/code>.\n+     * The last SynthStyleFactory that was set.\n@@ -125,4 +110,0 @@\n-    \/**\n-     * AppContext lastLAF came from.\n-     *\/\n-    private static AppContext lastContext;\n@@ -144,1 +125,1 @@\n-        return (ComponentUI) AppContext.getAppContext().get(SELECTED_UI_KEY);\n+        return selectedUI;\n@@ -185,4 +166,2 @@\n-        AppContext context = AppContext.getAppContext();\n-\n-        context.put(SELECTED_UI_KEY, uix);\n-        context.put(SELECTED_UI_STATE_KEY, Integer.valueOf(selectedUIState));\n+        selectedUI = uix;\n+        selectedUIStateValue = selectedUIState;\n@@ -192,3 +171,1 @@\n-        Integer result = (Integer) AppContext.getAppContext().get(SELECTED_UI_STATE_KEY);\n-\n-        return result == null ? 0 : result.intValue();\n+        return selectedUIStateValue;\n@@ -201,1 +178,2 @@\n-        AppContext.getAppContext().remove(SELECTED_UI_KEY);\n+        selectedUI = null;\n+        selectedUIStateValue = 0;\n@@ -213,1 +191,0 @@\n-        \/\/ for a particular AppContext.\n@@ -215,1 +192,0 @@\n-            AppContext context = AppContext.getAppContext();\n@@ -217,2 +193,0 @@\n-            lastContext = context;\n-            context.put(STYLE_FACTORY_KEY, cache);\n@@ -229,7 +203,0 @@\n-            AppContext context = AppContext.getAppContext();\n-\n-            if (lastContext == context) {\n-                return lastFactory;\n-            }\n-            lastContext = context;\n-            lastFactory = (SynthStyleFactory) context.get(STYLE_FACTORY_KEY);\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/synth\/SynthLookAndFeel.java","additions":9,"deletions":42,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -1,99 +0,0 @@\n-\/*\n- * Copyright (c) 2012, 2015, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @bug 7143614\n- * @summary Issues with Synth Look&Feel\n- * @author Pavel Porvatov\n- * @modules java.desktop\/javax.swing.plaf.synth:open\n- * @modules java.desktop\/sun.awt\n- *\/\n-\n-import sun.awt.SunToolkit;\n-\n-import javax.swing.plaf.ComponentUI;\n-import javax.swing.plaf.basic.BasicButtonUI;\n-import javax.swing.plaf.synth.SynthConstants;\n-import javax.swing.plaf.synth.SynthLookAndFeel;\n-import java.lang.reflect.Method;\n-\n-public class bug7143614 {\n-    private static Method setSelectedUIMethod;\n-\n-    private static ComponentUI componentUI = new BasicButtonUI();\n-\n-    public static void main(String[] args) throws Exception {\n-        setSelectedUIMethod = SynthLookAndFeel.class.getDeclaredMethod(\"setSelectedUI\", ComponentUI.class,\n-                boolean.class, boolean.class, boolean.class, boolean.class);\n-        setSelectedUIMethod.setAccessible(true);\n-\n-        setSelectedUIMethod.invoke(null, componentUI, true, true, true, true);\n-\n-        validate();\n-\n-        Thread thread = new ThreadInAnotherAppContext();\n-\n-        thread.start();\n-        thread.join();\n-\n-        validate();\n-\n-        System.out.println(\"Test bug7143614 passed.\");\n-    }\n-\n-    private static void validate() throws Exception {\n-        Method getSelectedUIMethod = SynthLookAndFeel.class.getDeclaredMethod(\"getSelectedUI\");\n-\n-        getSelectedUIMethod.setAccessible(true);\n-\n-        Method getSelectedUIStateMethod = SynthLookAndFeel.class.getDeclaredMethod(\"getSelectedUIState\");\n-\n-        getSelectedUIStateMethod.setAccessible(true);\n-\n-        if (getSelectedUIMethod.invoke(null) != componentUI) {\n-            throw new RuntimeException(\"getSelectedUI returns invalid value\");\n-        }\n-        if (((Integer) getSelectedUIStateMethod.invoke(null)).intValue() !=\n-                (SynthConstants.SELECTED | SynthConstants.FOCUSED)) {\n-            throw new RuntimeException(\"getSelectedUIState returns invalid value\");\n-        }\n-\n-    }\n-\n-    private static class ThreadInAnotherAppContext extends Thread {\n-        public ThreadInAnotherAppContext() {\n-            super(new ThreadGroup(\"7143614\"), \"ThreadInAnotherAppContext\");\n-        }\n-\n-        public void run() {\n-            SunToolkit.createNewAppContext();\n-\n-            try {\n-                setSelectedUIMethod.invoke(null, null, false, false, false, false);\n-            } catch (Exception e) {\n-                throw new RuntimeException(e);\n-            }\n-        }\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/plaf\/synth\/7143614\/bug7143614.java","additions":0,"deletions":99,"binary":false,"changes":99,"status":"deleted"},{"patch":"@@ -1,125 +0,0 @@\n-\/*\n- * Copyright (c) 2009, 2016, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @key headful\n- * @bug 6660049 6849518\n- * @summary Tests the Region initialization\n- * @author Sergey Malenkov\n- * @modules java.desktop\/sun.awt\n- *\/\n-\n-import sun.awt.SunToolkit;\n-\n-import javax.swing.JButton;\n-import javax.swing.JComponent;\n-import javax.swing.SwingUtilities;\n-import javax.swing.plaf.synth.Region;\n-import javax.swing.plaf.synth.SynthLookAndFeel;\n-\n-public class Test6660049 implements Runnable {\n-    public static void main(String[] args) {\n-        SwingUtilities.invokeLater(new Test6660049(\n-                javax.swing.JButton.class,\n-                javax.swing.JCheckBox.class,\n-                javax.swing.JCheckBoxMenuItem.class,\n-                javax.swing.JColorChooser.class,\n-                javax.swing.JComboBox.class,\n-                javax.swing.JDesktopPane.class,\n-                javax.swing.JEditorPane.class,\n-                javax.swing.JFileChooser.class,\n-                javax.swing.JFormattedTextField.class,\n-                javax.swing.JInternalFrame.class,\n-                javax.swing.JLabel.class,\n-                javax.swing.JList.class,\n-                javax.swing.JMenu.class,\n-                javax.swing.JMenuBar.class,\n-                javax.swing.JMenuItem.class,\n-                javax.swing.JOptionPane.class,\n-                javax.swing.JPanel.class,\n-                javax.swing.JPasswordField.class,\n-                javax.swing.JPopupMenu.class,\n-                javax.swing.JProgressBar.class,\n-                javax.swing.JRadioButton.class,\n-                javax.swing.JRadioButtonMenuItem.class,\n-                javax.swing.JRootPane.class,\n-                javax.swing.JScrollBar.class,\n-                javax.swing.JScrollPane.class,\n-                javax.swing.JSeparator.class,\n-                javax.swing.JSlider.class,\n-                javax.swing.JSpinner.class,\n-                javax.swing.JSplitPane.class,\n-                javax.swing.JTabbedPane.class,\n-                javax.swing.JTable.class,\n-                javax.swing.JTextArea.class,\n-                javax.swing.JTextField.class,\n-                javax.swing.JTextPane.class,\n-                javax.swing.JToggleButton.class,\n-                javax.swing.JToolBar.class,\n-                javax.swing.JToolTip.class,\n-                javax.swing.JTree.class,\n-                javax.swing.JViewport.class,\n-                javax.swing.table.JTableHeader.class));\n-    }\n-\n-    private final Class<? extends JComponent>[] types;\n-    private final Region region;\n-\n-    private Test6660049(Class<? extends JComponent>... types) {\n-        this.types = types;\n-        run();\n-\n-        this.region = new Region(\"Button\", \"ButtonUI\", true) {\n-            @Override\n-            public String getName() {\n-                throw new Error(\"6660049: exploit is available\");\n-            }\n-        };\n-    }\n-\n-    public void run() {\n-        if (this.region != null) {\n-            SunToolkit.createNewAppContext();\n-        }\n-        for (Class<? extends JComponent> type : this.types) {\n-            Region region = getRegion(type);\n-            if (region == null) {\n-                throw new Error(\"6849518: region is not initialized\");\n-            }\n-        }\n-        getRegion(JButton.class).getName();\n-    }\n-\n-    private static Region getRegion(Class<? extends JComponent> type) {\n-        try {\n-            return SynthLookAndFeel.getRegion(type.newInstance());\n-        }\n-        catch (IllegalAccessException exception) {\n-            throw new Error(\"unexpected exception\", exception);\n-        }\n-        catch (InstantiationException exception) {\n-            throw new Error(\"unexpected exception\", exception);\n-        }\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/plaf\/synth\/Test6660049.java","additions":0,"deletions":125,"binary":false,"changes":125,"status":"deleted"}]}