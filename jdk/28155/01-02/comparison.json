{"files":[{"patch":"@@ -124,2 +124,2 @@\n-RELEASE_FILE_TEMPLATE := $(TOPDIR)\/src\/java.base\/share\/classes\/jdk\/internal\/jmod\/resources\/release.txt.template\n-RELEASE_FILE_TARGET := $(SUPPORT_OUTPUTDIR)\/gensrc\/$(MODULE)\/jdk\/internal\/jmod\/resources\/release.txt\n+RELEASE_FILE_TEMPLATE := $(TOPDIR)\/src\/java.base\/share\/classes\/jdk\/internal\/misc\/resources\/release.txt.template\n+RELEASE_FILE_TARGET := $(SUPPORT_OUTPUTDIR)\/gensrc\/$(MODULE)\/jdk\/internal\/misc\/resources\/release.txt\n","filename":"make\/modules\/java.base\/Gensrc.gmk","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"","filename":"src\/java.base\/share\/classes\/jdk\/internal\/misc\/resources\/release.txt.template","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"src\/java.base\/share\/classes\/jdk\/internal\/jmod\/resources\/release.txt.template","status":"renamed"},{"patch":"@@ -61,1 +61,0 @@\n-import java.util.NoSuchElementException;\n@@ -244,2 +243,2 @@\n-    \/\/ Release information as in the java.base module for target image\n-    public static final String JDK_RELEASE_RESOURCE = \"jdk\/internal\/jmod\/resources\/release.txt\";\n+    \/\/ Release information stored in the java.base module\n+    private static final String JDK_RELEASE_RESOURCE = \"jdk\/internal\/misc\/resources\/release.txt\";\n@@ -251,2 +250,3 @@\n-        var in = mref.open().open(JDK_RELEASE_RESOURCE);\n-        if (in.isEmpty()) {\n+        Optional<InputStream> release = mref.open().open(JDK_RELEASE_RESOURCE);\n+\n+        if (release.isEmpty()) {\n@@ -256,1 +256,1 @@\n-        try (var r = new BufferedReader(new InputStreamReader(in.get()))) {\n+        try (var r = new BufferedReader(new InputStreamReader(release.get()))) {\n@@ -584,2 +584,2 @@\n-     * Checks the version of the module descriptor of java.base for compatibility\n-     * with the current runtime version.\n+     * Checks the release information of the java.base used for target image\n+     * for compatibility with the java.base used by jlink.\n@@ -587,3 +587,2 @@\n-     * @throws IllegalArgumentException the descriptor of java.base has no\n-     * version or the java.base version is not the same as the current runtime's\n-     * version.\n+     * @throws IllegalArgumentException This jlink cannot be used to create\n+     * the target runtime image.\n@@ -599,0 +598,1 @@\n+            \/\/ This jlink runtime should always have the release.txt\n@@ -600,1 +600,2 @@\n-                new IllegalArgumentException(\"Cannot find release.txt\"));\n+                    new IllegalArgumentException(\"Cannot find release.txt\"));\n+            \/\/ Old runtime may not have the release.txt, result in a mismatch\n@@ -603,2 +604,1 @@\n-                \/\/ jlink version and java.base version do not match.\n-                \/\/ We do not (yet) support this mode.\n+                \/\/ Current runtime image and the target runtime image is not compatible release\n@@ -609,2 +609,0 @@\n-        } catch (NoSuchElementException e) {\n-            assert false : \"Should have found java.base module\";\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/JlinkTask.java","additions":14,"deletions":16,"binary":false,"changes":30,"status":"modified"}]}