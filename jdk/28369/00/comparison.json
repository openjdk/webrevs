{"files":[{"patch":"@@ -66,2 +66,0 @@\n-    private static final Timer timerCloseSession\n-            = new Timer(\"auto-close screencast session\", true);\n@@ -69,0 +67,4 @@\n+    private static class TimerHolder {\n+        private static final Timer timerCloseSession =\n+                new Timer(\"auto-close screencast session\", true);\n+    }\n@@ -146,1 +148,1 @@\n-        timerCloseSession.schedule(timerTask, DELAY_BEFORE_SESSION_CLOSE);\n+        TimerHolder.timerCloseSession.schedule(timerTask, DELAY_BEFORE_SESSION_CLOSE);\n","filename":"src\/java.desktop\/unix\/classes\/sun\/awt\/screencast\/ScreencastHelper.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -241,0 +241,1 @@\n+    private static volatile boolean isWatcherThreadStarted = false;\n@@ -260,4 +261,0 @@\n-\n-        if (watchService != null) {\n-            new WatcherThread(watchService).start();\n-        }\n@@ -340,0 +337,18 @@\n+    private static void startWatcherThreadIfNeeded() {\n+        if (!isWatcherThreadStarted) {\n+            \/\/ not sure if the double-checked locking is actually needed here\n+            \/\/ the getTokens is only called from ScreencastHelper#getRGBPixels\n+            \/\/ and ScreencastHelper#remoteDesktop* methods (which are synchronized),\n+            \/\/ but it may change later.\n+            synchronized (TokenStorage.class) {\n+                if (!isWatcherThreadStarted) {\n+                    readTokens(PROPS_PATH);\n+                    if (watchService != null) {\n+                        new WatcherThread(watchService).start();\n+                    }\n+                    isWatcherThreadStarted = true;\n+                }\n+            }\n+        }\n+    }\n+\n@@ -341,0 +356,2 @@\n+        startWatcherThreadIfNeeded();\n+\n","filename":"src\/java.desktop\/unix\/classes\/sun\/awt\/screencast\/TokenStorage.java","additions":21,"deletions":4,"binary":false,"changes":25,"status":"modified"}]}