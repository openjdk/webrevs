{"files":[{"patch":"@@ -703,1 +703,1 @@\n-    if (_deferred_updates_next.compare_exchange(nullptr, this) == nullptr) {\n+    if (_deferred_updates_next.compare_set(nullptr, this)) {\n","filename":"src\/hotspot\/share\/gc\/shared\/oopStorage.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -186,2 +186,2 @@\n-  Age cmpxchg_age(Age old_age, Age new_age) {\n-    return _age.compare_exchange(old_age, new_age);\n+  bool par_set_age(Age old_age, Age new_age) {\n+    return _age.compare_set(old_age, new_age);\n@@ -348,1 +348,1 @@\n-  using TaskQueueSuper<N, MT>::cmpxchg_age;\n+  using TaskQueueSuper<N, MT>::par_set_age;\n","filename":"src\/hotspot\/share\/gc\/shared\/taskqueue.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -173,2 +173,1 @@\n-    Age tempAge = cmpxchg_age(oldAge, newAge);\n-    if (tempAge == oldAge) {\n+    if (par_set_age(oldAge, newAge)) {\n@@ -286,1 +285,1 @@\n-  Age resAge = cmpxchg_age(oldAge, newAge);\n+  bool result = par_set_age(oldAge, newAge);\n@@ -291,1 +290,1 @@\n-  return resAge == oldAge ? PopResult::Success : PopResult::Contended;\n+  return result ? PopResult::Success : PopResult::Contended;\n","filename":"src\/hotspot\/share\/gc\/shared\/taskqueue.inline.hpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -78,0 +78,1 @@\n+\/\/     v.compare_set(x, y [, o]) -> bool\n@@ -270,0 +271,5 @@\n+  bool compare_set(T compare_value, T new_value,\n+                   atomic_memory_order order = memory_order_conservative) {\n+    return AtomicAccess::cmpxchg(value_ptr(), compare_value, new_value, order) == compare_value;\n+  }\n+\n@@ -482,0 +488,7 @@\n+  bool compare_set(T compare_value, T new_value,\n+                   atomic_memory_order order = memory_order_conservative) {\n+    return _value.compare_set(decay(compare_value),\n+                              decay(new_value),\n+                              order);\n+  }\n+\n","filename":"src\/hotspot\/share\/runtime\/atomic.hpp","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -160,1 +160,1 @@\n-  if (_first.compare_exchange(expect, node) == expect) {\n+  if (_first.compare_set(expect, node)) {\n@@ -175,1 +175,1 @@\n-  if (_first.compare_exchange(tmp, set_state(tmp, STATE_LOCK_BIT)) == tmp) {\n+  if (_first.compare_set(tmp, set_state(tmp, STATE_LOCK_BIT))) {\n","filename":"src\/hotspot\/share\/utilities\/concurrentHashTable.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -184,1 +184,1 @@\n-    if (_state.compare_exchange(state, new_state) == state) {\n+    if (_state.compare_set(state, new_state)) {\n@@ -221,1 +221,1 @@\n-    if (_state.compare_exchange(state, new_state) == state) {\n+    if (_state.compare_set(state, new_state)) {\n@@ -250,1 +250,1 @@\n-    if (_state.compare_exchange(state, new_state) == state) {\n+    if (_state.compare_set(state, new_state)) {\n","filename":"src\/hotspot\/share\/utilities\/waitBarrier_generic.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -165,0 +165,29 @@\n+template<typename T>\n+struct AtomicIntegerCmpsetTestSupport {\n+  Atomic<T> _test_value;\n+\n+  AtomicIntegerCmpsetTestSupport() : _test_value{} {}\n+\n+  void test() {\n+    T zero = 0;\n+    T five = 5;\n+    T ten = 10;\n+    _test_value.store_relaxed(zero);\n+    EXPECT_FALSE(_test_value.compare_set(five, ten));\n+    EXPECT_EQ(zero, _test_value.load_relaxed());\n+    EXPECT_TRUE(_test_value.compare_set(zero, ten));\n+    EXPECT_EQ(ten, _test_value.load_relaxed());\n+  }\n+};\n+\n+TEST_VM(AtomicIntegerTest, cmpset_int32) {\n+  using Support = AtomicIntegerCmpsetTestSupport<int32_t>;\n+  Support().test();\n+}\n+\n+TEST_VM(AtomicIntegerTest, cmpset_int64) {\n+  \/\/ Check if 64-bit atomics are available on the machine.\n+  using Support = AtomicIntegerCmpsetTestSupport<int64_t>;\n+  Support().test();\n+}\n+\n","filename":"test\/hotspot\/gtest\/runtime\/test_atomic.cpp","additions":29,"deletions":0,"binary":false,"changes":29,"status":"modified"}]}