{"files":[{"patch":"@@ -890,1 +890,1 @@\n-  phase->set_ctrl(gc_state_offset, phase->C->root());\n+  phase->set_root_as_ctrl(gc_state_offset);\n@@ -948,1 +948,1 @@\n-  phase->set_ctrl(cset_addr_ptr, phase->C->root());\n+  phase->set_root_as_ctrl(cset_addr_ptr);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c2\/shenandoahSupport.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -776,2 +776,1 @@\n-      ConINode* con_stride = _igvn.intcon(stride);\n-      set_ctrl(con_stride, C->root());\n+      ConINode* con_stride = intcon(stride);\n@@ -785,2 +784,1 @@\n-      ConLNode* con_stride = _igvn.longcon(stride);\n-      set_ctrl(con_stride, C->root());\n+      ConLNode* con_stride = longcon(stride);\n@@ -803,2 +801,1 @@\n-    ConNode* con_scale = _igvn.intcon(scale);\n-    set_ctrl(con_scale, C->root());\n+    ConNode* con_scale = intcon(scale);\n@@ -821,2 +818,1 @@\n-      con_scale = _igvn.longcon(scale);\n-      set_ctrl(con_scale, C->root());\n+      con_scale = longcon(scale);\n@@ -1351,2 +1347,1 @@\n-  ConNode* zero = _igvn.intcon(0);\n-  set_ctrl(zero, C->root());\n+  ConNode* zero = intcon(0);\n","filename":"src\/hotspot\/share\/opto\/loopPredicate.cpp","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -357,1 +357,0 @@\n-    Node* zero;\n@@ -359,2 +358,1 @@\n-      zero = phase->_igvn.intcon(0);\n-      n_inv1 = new SubINode(zero, inv1);\n+      n_inv1 = new SubINode(phase->intcon(0), inv1);\n@@ -362,2 +360,1 @@\n-      zero = phase->_igvn.longcon(0L);\n-      n_inv1 = new SubLNode(zero, inv1);\n+      n_inv1 = new SubLNode(phase->longcon(0L), inv1);\n@@ -365,1 +362,0 @@\n-    phase->set_ctrl(zero, phase->C->root());\n@@ -1788,2 +1784,1 @@\n-  Node* unrolled_stride = _igvn.intcon(unrolled_stride_con);\n-  set_ctrl(unrolled_stride, C->root());\n+  Node* unrolled_stride = intcon(unrolled_stride_con);\n@@ -1956,2 +1951,1 @@\n-      new_limit = _igvn.intcon(limit->get_int() - stride_con);\n-      set_ctrl(new_limit, C->root());\n+      new_limit = intcon(limit->get_int() - stride_con);\n@@ -1963,2 +1957,1 @@\n-      Node* stride_l = _igvn.longcon(stride_con);\n-      set_ctrl(stride_l, C->root());\n+      Node* stride_l = longcon(stride_con);\n@@ -1971,2 +1964,1 @@\n-      Node* underflow_clamp_l = _igvn.longcon((stride_con > 0) ? min_jint : max_jint);\n-      set_ctrl(underflow_clamp_l, C->root());\n+      Node* underflow_clamp_l = longcon((stride_con > 0) ? min_jint : max_jint);\n@@ -2062,2 +2054,1 @@\n-  Node *one = _igvn.intcon(1);\n-  set_ctrl(one, C->root());\n+  Node *one = intcon(1);\n@@ -2199,2 +2190,1 @@\n-  Node* scale = _igvn.longcon(scale_con);\n-  set_ctrl(scale, C->root());\n+  Node* scale = longcon(scale_con);\n@@ -2239,2 +2229,1 @@\n-    Node* one = _igvn.longcon(1);\n-    set_ctrl(one, C->root());\n+    Node* one = longcon(1);\n@@ -2445,2 +2434,1 @@\n-      Node *zero = _igvn.zerocon(bt);\n-      set_ctrl(zero, C->root());\n+      Node *zero = zerocon(bt);\n@@ -2497,2 +2485,1 @@\n-          Node *zero = _igvn.integercon(0, exp_bt);\n-          set_ctrl(zero, C->root());\n+          Node *zero = integercon(0, exp_bt);\n@@ -2616,2 +2603,2 @@\n-  Node* zero = _igvn.longcon(0);\n-  Node* one  = _igvn.longcon(1);\n+  Node* zero = longcon(0);\n+  Node* one  = longcon(1);\n@@ -2619,4 +2606,1 @@\n-  Node* mini = _igvn.longcon(-max_jint);\n-  set_ctrl(zero, C->root());\n-  set_ctrl(one,  C->root());\n-  set_ctrl(mini, C->root());\n+  Node* mini = longcon(-max_jint);\n@@ -2824,2 +2808,1 @@\n-      Node *kill_con = _igvn.intcon(1-flip);\n-      set_ctrl(kill_con, C->root());\n+      Node* kill_con = intcon(1-flip);\n","filename":"src\/hotspot\/share\/opto\/loopTransform.cpp","additions":15,"deletions":32,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -316,2 +316,1 @@\n-  Node* outer_test = _igvn.intcon(0);\n-  set_ctrl(outer_test, C->root());\n+  Node* outer_test = intcon(0);\n@@ -972,2 +971,1 @@\n-  Node* int_zero = _igvn.intcon(0);\n-  set_ctrl(int_zero, C->root());\n+  Node* int_zero = intcon(0);\n@@ -980,2 +978,1 @@\n-  Node* int_stride = _igvn.intcon(stride_con);\n-  set_ctrl(int_stride, C->root());\n+  Node* int_stride = intcon(stride_con);\n@@ -1276,8 +1273,4 @@\n-  Node* long_zero = _igvn.longcon(0);\n-  set_ctrl(long_zero, C->root());\n-  Node* int_zero = _igvn.intcon(0);\n-  set_ctrl(int_zero, this->C->root());\n-  Node* long_one = _igvn.longcon(1);\n-  set_ctrl(long_one, this->C->root());\n-  Node* int_stride = _igvn.intcon(checked_cast<int>(stride_con));\n-  set_ctrl(int_stride, this->C->root());\n+  Node* long_zero = longcon(0);\n+  Node* int_zero = intcon(0);\n+  Node* long_one = longcon(1);\n+  Node* int_stride = intcon(checked_cast<int>(stride_con));\n@@ -1305,2 +1298,1 @@\n-    Node* K = _igvn.longcon(scale);\n-    set_ctrl(K, this->C->root());\n+    Node* K = longcon(scale);\n@@ -1337,2 +1329,1 @@\n-      Node* max_jint_plus_one_long = _igvn.longcon((jlong)max_jint + 1);\n-      set_ctrl(max_jint_plus_one_long, C->root());\n+      Node* max_jint_plus_one_long = longcon((jlong)max_jint + 1);\n@@ -1392,2 +1383,1 @@\n-    Node* max_jlong_long = _igvn.longcon(max_jlong);\n-    set_ctrl(max_jlong_long, this->C->root());\n+    Node* max_jlong_long = longcon(max_jlong);\n@@ -1427,2 +1417,1 @@\n-    K = _igvn.intcon(checked_cast<int>(scale));\n-    set_ctrl(K, this->C->root());\n+    K = intcon(checked_cast<int>(scale));\n@@ -3158,1 +3147,1 @@\n-    iloop->set_ctrl(zero, igvn->C->root());\n+    iloop->set_root_as_ctrl(zero);\n@@ -4070,2 +4059,1 @@\n-    Node* ratio = _igvn.integercon(ratio_con, stride_con2_bt);\n-    set_ctrl(ratio, C->root());\n+    Node* ratio = integercon(ratio_con, stride_con2_bt);\n@@ -4491,2 +4479,1 @@\n-      ConINode* one = _igvn.intcon(1);\n-      set_ctrl(one, C->root());\n+      ConINode* one = intcon(1);\n@@ -6869,0 +6856,30 @@\n+ConINode* PhaseIdealLoop::intcon(jint i) {\n+  ConINode* node = _igvn.intcon(i);\n+  set_root_as_ctrl(node);\n+  return node;\n+}\n+\n+ConLNode *PhaseIdealLoop::longcon(jlong i) {\n+  ConLNode* node = _igvn.longcon(i);\n+  set_root_as_ctrl(node);\n+  return node;\n+}\n+\n+ConNode *PhaseIdealLoop::makecon(const Type* t) {\n+  ConNode* node = _igvn.makecon(t);\n+  set_root_as_ctrl(node);\n+  return node;\n+}\n+\n+ConNode* PhaseIdealLoop::integercon(jlong l, BasicType bt) {\n+  ConNode* node = _igvn.integercon(l, bt);\n+  set_root_as_ctrl(node);\n+  return node;\n+}\n+\n+ConNode *PhaseIdealLoop::zerocon(BasicType bt) {\n+  ConNode* node = _igvn.zerocon(bt);\n+  set_root_as_ctrl(node);\n+  return node;\n+}\n+\n","filename":"src\/hotspot\/share\/opto\/loopnode.cpp","additions":44,"deletions":27,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -988,0 +988,4 @@\n+  void set_root_as_ctrl(Node* n) {\n+    assert(!has_node(n) || has_ctrl(n), \"\");\n+    _loop_or_ctrl.map(n->_idx, (Node*)((intptr_t)C->root() + 1));\n+  }\n@@ -1793,0 +1797,10 @@\n+\n+  ConINode* intcon(jint i);\n+\n+  ConLNode* longcon(jlong i);\n+\n+  ConNode* makecon(const Type* t);\n+\n+  ConNode* integercon(jlong l, BasicType bt);\n+\n+  ConNode* zerocon(BasicType bt);\n","filename":"src\/hotspot\/share\/opto\/loopnode.hpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -193,1 +193,1 @@\n-      set_ctrl(x, C->root());\n+      set_root_as_ctrl(x);\n@@ -334,2 +334,1 @@\n-  Node *con = _igvn.makecon(pop == Op_IfTrue ? TypeInt::ONE : TypeInt::ZERO);\n-  set_ctrl(con, C->root()); \/\/ Constant gets a new use\n+  Node* con = makecon(pop == Op_IfTrue ? TypeInt::ONE : TypeInt::ZERO);\n@@ -475,2 +474,1 @@\n-      Node* zero = _igvn.integercon(0, bt);\n-      set_ctrl(zero, C->root());\n+      Node* zero = integercon(0, bt);\n@@ -2909,2 +2907,1 @@\n-  Node *con = _igvn.intcon(proj_con);\n-  set_ctrl(con, C->root());\n+  Node* con = intcon(proj_con);\n@@ -3219,2 +3216,1 @@\n-    rhs_cmpi = _igvn.makecon(TypeInt::ZERO); \/\/ For i < 0\n-    set_ctrl(rhs_cmpi, C->root());\n+    rhs_cmpi = makecon(TypeInt::ZERO); \/\/ For i < 0\n@@ -3249,2 +3245,1 @@\n-  Node *con = _igvn.makecon(lp_proj->is_IfTrue() ? TypeInt::ONE : TypeInt::ZERO);\n-  set_ctrl(con, C->root());\n+  Node* con = makecon(lp_proj->is_IfTrue() ? TypeInt::ONE : TypeInt::ZERO);\n@@ -4632,1 +4627,1 @@\n-    set_ctrl(identity_scalar, C->root());\n+    set_root_as_ctrl(identity_scalar);\n","filename":"src\/hotspot\/share\/opto\/loopopts.cpp","additions":7,"deletions":12,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -1218,3 +1218,1 @@\n-    PhaseIterGVN& igvn = phase()->igvn();\n-    Node* zero = igvn.zerocon(bt);\n-    phase()->set_ctrl(zero, phase()->C->root());\n+    Node* zero = phase()->zerocon(bt);\n","filename":"src\/hotspot\/share\/opto\/vectorization.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"}]}