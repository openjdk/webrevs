{"files":[{"patch":"@@ -68,1 +68,6 @@\n-  msg.append(\"  \" PTR_FORMAT \" - klass \" PTR_FORMAT \" %s\\n\", p2i(obj), p2i(obj->klass()), obj->klass()->external_name());\n+  Klass* klass = obj->klass();\n+  msg.append(\"  \" PTR_FORMAT \" - klass \" PTR_FORMAT \" %s\\n\", p2i(obj), p2i(klass), klass->external_name());\n+  if (klass == vmClasses::Class_klass()) {\n+    msg.append(\"  mirrored klass:       \" PTR_FORMAT \"\\n\", p2i(obj->metadata_field(java_lang_Class::klass_offset())));\n+    msg.append(\"  mirrored array klass: \" PTR_FORMAT \"\\n\", p2i(obj->metadata_field(java_lang_Class::array_klass_offset())));\n+  }\n@@ -267,1 +272,3 @@\n-  \/\/ We want to check class loading\/unloading did not corrupt them.\n+  \/\/ We want to check class loading\/unloading did not corrupt them. We can only reasonably\n+  \/\/ trust the forwarded objects, as the from-space object can have the klasses effectively\n+  \/\/ dead.\n@@ -270,1 +277,1 @@\n-    Metadata* klass = obj->metadata_field(java_lang_Class::klass_offset());\n+    Metadata* klass = fwd->metadata_field(java_lang_Class::klass_offset());\n@@ -273,1 +280,1 @@\n-                    \"Instance class mirror should point to Metaspace\",\n+                    \"Mirrored instance class should point to Metaspace\",\n@@ -277,1 +284,1 @@\n-    Metadata* array_klass = obj->metadata_field(java_lang_Class::array_klass_offset());\n+    Metadata* array_klass = fwd->metadata_field(java_lang_Class::array_klass_offset());\n@@ -280,1 +287,1 @@\n-                    \"Array class mirror should point to Metaspace\",\n+                    \"Mirrored array class should point to Metaspace\",\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahAsserts.cpp","additions":13,"deletions":6,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -223,1 +223,3 @@\n-    \/\/ We want to check class loading\/unloading did not corrupt them.\n+    \/\/ We want to check class loading\/unloading did not corrupt them. We can only reasonably\n+    \/\/ trust the forwarded objects, as the from-space object can have the klasses effectively\n+    \/\/ dead.\n@@ -226,2 +228,2 @@\n-      Metadata* klass = obj->metadata_field(java_lang_Class::klass_offset());\n-      check(ShenandoahAsserts::_safe_oop, obj,\n+      Metadata* klass = fwd->metadata_field(java_lang_Class::klass_offset());\n+      check(ShenandoahAsserts::_safe_all, obj,\n@@ -229,1 +231,1 @@\n-            \"Instance class mirror should point to Metaspace\");\n+            \"Mirrored instance class should point to Metaspace\");\n@@ -231,2 +233,2 @@\n-      Metadata* array_klass = obj->metadata_field(java_lang_Class::array_klass_offset());\n-      check(ShenandoahAsserts::_safe_oop, obj,\n+      Metadata* array_klass = fwd->metadata_field(java_lang_Class::array_klass_offset());\n+      check(ShenandoahAsserts::_safe_all, obj,\n@@ -234,1 +236,1 @@\n-            \"Array class mirror should point to Metaspace\");\n+            \"Mirrored array class should point to Metaspace\");\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahVerifier.cpp","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"}]}