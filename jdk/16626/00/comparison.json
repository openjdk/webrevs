{"files":[{"patch":"@@ -29,0 +29,1 @@\n+#include \"cds\/cdsConfig.hpp\"\n@@ -518,1 +519,1 @@\n-      assert(DynamicDumpSharedSpaces, \"sanity\");\n+      assert(CDSConfig::is_dumping_dynamic_archive(), \"sanity\");\n@@ -746,1 +747,1 @@\n-      if (DynamicDumpSharedSpaces) {\n+      if (CDSConfig::is_dumping_dynamic_archive()) {\n@@ -819,1 +820,1 @@\n-    assert(DynamicDumpSharedSpaces, \"must be\");\n+    assert(CDSConfig::is_dumping_dynamic_archive(), \"must be\");\n@@ -927,1 +928,1 @@\n-    assert(DynamicDumpSharedSpaces, \"must be\");\n+    assert(CDSConfig::is_dumping_dynamic_archive(), \"must be\");\n","filename":"src\/hotspot\/share\/cds\/archiveBuilder.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -29,3 +29,1 @@\n-bool CDSConfig::is_dumping_archive() {\n-  return is_dumping_static_archive() || is_dumping_dynamic_archive();\n-}\n+bool CDSConfig::_is_dumping_static_archive = false;\n@@ -37,4 +35,0 @@\n-bool CDSConfig::is_dumping_dynamic_archive() {\n-  return DynamicDumpSharedSpaces;\n-}\n-\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.cpp","additions":1,"deletions":7,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -32,0 +32,4 @@\n+#if INCLUDE_CDS\n+  static bool _is_dumping_static_archive;\n+#endif\n+\n@@ -34,1 +38,1 @@\n-  static bool      is_dumping_archive()                      NOT_CDS_RETURN_(false);\n+  static bool      is_dumping_archive()                      { return is_dumping_static_archive() || is_dumping_dynamic_archive(); }\n@@ -36,1 +40,3 @@\n-  static bool      is_dumping_dynamic_archive()              NOT_CDS_RETURN_(false);\n+  static bool      is_dumping_dynamic_archive()              { return CDS_ONLY(_is_dumping_static_archive) NOT_CDS(false); }\n+  static void  enable_dumping_dynamic_archive()              { CDS_ONLY(_is_dumping_static_archive = true); }\n+  static void disable_dumping_dynamic_archive()              { CDS_ONLY(_is_dumping_static_archive = false); }\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.hpp","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+#include \"cds\/cdsConfig.hpp\"\n@@ -412,1 +413,1 @@\n-  assert(DynamicDumpSharedSpaces, \"DynamicDumpSharedSpaces only\");\n+  assert(CDSConfig::is_dumping_dynamic_archive(), \"sanity\");\n@@ -472,1 +473,1 @@\n-  if (DynamicDumpSharedSpaces && !UseSharedSpaces) {\n+  if (CDSConfig::is_dumping_dynamic_archive() && !UseSharedSpaces) {\n@@ -488,1 +489,1 @@\n-    DynamicDumpSharedSpaces = false;\n+    CDSConfig::disable_dumping_dynamic_archive();\n@@ -496,1 +497,1 @@\n-  if (!DynamicDumpSharedSpaces || archive_name == nullptr) {\n+  if (!CDSConfig::is_dumping_dynamic_archive() || archive_name == nullptr) {\n@@ -519,1 +520,1 @@\n-  DynamicDumpSharedSpaces = false;  \/\/ Just for good measure\n+  CDSConfig::disable_dumping_dynamic_archive();  \/\/ Just for good measure\n@@ -526,1 +527,1 @@\n-  assert(DynamicDumpSharedSpaces, \"already checked by check_for_dynamic_dump() during VM startup\");\n+  assert(CDSConfig::is_dumping_dynamic_archive(), \"already checked by check_for_dynamic_dump() during VM startup\");\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.cpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -197,1 +197,1 @@\n-  set_magic(DynamicDumpSharedSpaces ? CDS_DYNAMIC_ARCHIVE_MAGIC : CDS_ARCHIVE_MAGIC);\n+  set_magic(CDSConfig::is_dumping_dynamic_archive() ? CDS_DYNAMIC_ARCHIVE_MAGIC : CDS_ARCHIVE_MAGIC);\n@@ -238,1 +238,1 @@\n-  if (!DynamicDumpSharedSpaces) {\n+  if (!CDSConfig::is_dumping_dynamic_archive()) {\n@@ -935,1 +935,1 @@\n-  if (DynamicDumpSharedSpaces) {\n+  if (CDSConfig::is_dumping_dynamic_archive()) {\n@@ -945,1 +945,1 @@\n-      DynamicDumpSharedSpaces = false;\n+      CDSConfig::disable_dumping_dynamic_archive();\n@@ -951,1 +951,1 @@\n-        DynamicDumpSharedSpaces = false;\n+        CDSConfig::disable_dumping_dynamic_archive();\n@@ -1526,1 +1526,1 @@\n-    assert(!DynamicDumpSharedSpaces, \"must be\");\n+    assert(!CDSConfig::is_dumping_dynamic_archive(), \"must be\");\n@@ -2275,1 +2275,1 @@\n-        DynamicDumpSharedSpaces = true;\n+        CDSConfig::enable_dumping_dynamic_archive();\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -282,1 +282,1 @@\n-      if (!DynamicDumpSharedSpaces) {\n+      if (!CDSConfig::is_dumping_dynamic_archive()) {\n@@ -587,1 +587,1 @@\n-  if (DynamicDumpSharedSpaces && ik->is_shared_unregistered_class()) {\n+  if (CDSConfig::is_dumping_dynamic_archive() && ik->is_shared_unregistered_class()) {\n@@ -952,1 +952,1 @@\n-    if (DynamicDumpSharedSpaces) {\n+    if (CDSConfig::is_dumping_dynamic_archive()) {\n@@ -958,1 +958,1 @@\n-    DynamicDumpSharedSpaces = false;\n+    CDSConfig::disable_dumping_dynamic_archive();\n@@ -994,1 +994,1 @@\n-  if (DynamicDumpSharedSpaces) {\n+  if (CDSConfig::is_dumping_dynamic_archive()) {\n@@ -1489,1 +1489,1 @@\n-  if (DynamicDumpSharedSpaces) {\n+  if (CDSConfig::is_dumping_dynamic_archive()) {\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -1129,3 +1129,3 @@\n-    \/\/ DynamicDumpSharedSpaces requires UseSharedSpaces to be enabled. Since --patch-module\n-    \/\/ is not supported with UseSharedSpaces, it is not supported with DynamicDumpSharedSpaces.\n-    assert(!DynamicDumpSharedSpaces, \"sanity\");\n+    \/\/ Dynamic dumping requires UseSharedSpaces to be enabled. Since --patch-module\n+    \/\/ is not supported with UseSharedSpaces, we can never come here during dynamic dumping.\n+    assert(!CDSConfig::is_dumping_dynamic_archive(), \"sanity\");\n@@ -1494,1 +1494,1 @@\n-    assert(!DynamicDumpSharedSpaces, \"DynamicDumpSharedSpaces not supported with exploded module builds\");\n+    assert(!CDSConfig::is_dumping_dynamic_archive(), \"not supported with exploded module builds\");\n","filename":"src\/hotspot\/share\/classfile\/classLoader.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"cds\/cdsConfig.hpp\"\n@@ -674,1 +675,1 @@\n-  if (!DynamicDumpSharedSpaces) {\n+  if (CDSConfig::is_dumping_static_archive()) {\n@@ -678,0 +679,1 @@\n+    assert(CDSConfig::is_dumping_dynamic_archive(), \"must be\");\n","filename":"src\/hotspot\/share\/classfile\/symbolTable.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -989,1 +989,1 @@\n-  if (DynamicDumpSharedSpaces && Thread::current()->is_VM_thread()) {\n+  if (CDSConfig::is_dumping_dynamic_archive() && Thread::current()->is_VM_thread()) {\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -123,1 +123,1 @@\n-      assert(DynamicDumpSharedSpaces, \"must be\");\n+      assert(CDSConfig::is_dumping_dynamic_archive(), \"must be\");\n","filename":"src\/hotspot\/share\/interpreter\/rewriter.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1878,1 +1878,1 @@\n-    assert(DynamicDumpSharedSpaces, \"must be\");\n+    assert(CDSConfig::is_dumping_dynamic_archive(), \"must be\");\n@@ -2699,1 +2699,1 @@\n-  } else if (DynamicDumpSharedSpaces) {\n+  } else if (CDSConfig::is_dumping_dynamic_archive()) {\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -3729,1 +3729,1 @@\n-  return ClassListWriter::is_enabled() || DynamicDumpSharedSpaces;\n+  return ClassListWriter::is_enabled() || CDSConfig::is_dumping_dynamic_archive();\n@@ -3737,1 +3737,1 @@\n-  assert(ClassListWriter::is_enabled() || DynamicDumpSharedSpaces,  \"Should be set and open or do dynamic dump\");\n+  assert(ClassListWriter::is_enabled() || CDSConfig::is_dumping_dynamic_archive(),  \"Should be set and open or do dynamic dump\");\n@@ -3742,1 +3742,1 @@\n-    if (DynamicDumpSharedSpaces) {\n+    if (CDSConfig::is_dumping_dynamic_archive()) {\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -3066,1 +3066,1 @@\n-    DynamicDumpSharedSpaces = false;\n+    CDSConfig::disable_dumping_dynamic_archive();\n@@ -3068,1 +3068,1 @@\n-    DynamicDumpSharedSpaces = true;\n+    CDSConfig::enable_dumping_dynamic_archive();\n@@ -3089,1 +3089,1 @@\n-  if (DumpSharedSpaces || DynamicDumpSharedSpaces) {\n+  if (CDSConfig::is_dumping_archive()) {\n@@ -3496,1 +3496,1 @@\n-            DynamicDumpSharedSpaces = true;\n+            CDSConfig::enable_dumping_dynamic_archive();\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -44,1 +44,0 @@\n-bool DynamicDumpSharedSpaces;\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -557,1 +557,0 @@\n-extern bool DynamicDumpSharedSpaces;\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}