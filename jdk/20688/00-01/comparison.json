{"files":[{"patch":"@@ -39,2 +39,0 @@\n-extern JavaVM *jvm;\n-\n@@ -636,5 +634,0 @@\n-    JNIEnv *pEnv = nil;\n-    jint ret = (*jvm)->GetEnv(jvm, &pEnv, JNI_VERSION_1_4);\n-    if (ret == JNI_EDETACHED) {\n-        return;\n-    }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/AWTWindow.m","additions":0,"deletions":7,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -125,1 +125,4 @@\n-    if (!shouldInstall) return nil;\n+    if (!shouldInstall) {\n+        [ThreadUtilities setApplicationOwner:NO];\n+        return nil;\n+    }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/ApplicationDelegate.m","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -134,0 +134,1 @@\n++ (void)setApplicationOwner:(BOOL)owner;\n","filename":"src\/java.desktop\/macosx\/native\/libosxapp\/ThreadUtilities.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+static BOOL isNSApplicationOwner = YES;\n@@ -62,0 +63,4 @@\n++ (void)setApplicationOwner:(BOOL)owner {\n+    isNSApplicationOwner = owner;\n+}\n+\n@@ -64,2 +69,7 @@\n-    if (appKitEnv == NULL) {\n-        attachCurrentThread((void **)&appKitEnv);\n+    if (isNSApplicationOwner) {\n+        if (appKitEnv == NULL) {\n+            attachCurrentThread((void **)&appKitEnv);\n+        }\n+        return appKitEnv;\n+    } else {\n+        return [ThreadUtilities getJNIEnvUncached];\n@@ -67,1 +77,0 @@\n-    return appKitEnv;\n","filename":"src\/java.desktop\/macosx\/native\/libosxapp\/ThreadUtilities.m","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"}]}