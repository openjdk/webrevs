{"files":[{"patch":"@@ -48,5 +48,4 @@\n-            String s = null;\n-            if (args.length == 1) {\n-                s = format1(format, args[0]);\n-            } else if (args.length == 2) {\n-                s = format2(format, args[0], args[1]);\n+            int off = format.indexOf('%');\n+            if (off == -1) {\n+                \/\/ no formatting to be done\n+                return format;\n@@ -54,2 +53,17 @@\n-            if (s != null) {\n-                return s;\n+\n+            int len = format.length();\n+            if (off + 1 != len) {\n+                int off1 = format.indexOf('%', off + 2);\n+                String s = null;\n+                if (args.length == 1) {\n+                    if (off1 == -1) {\n+                        s = format1(format, off, args[0]);\n+                    }\n+                } else if (args.length == 2) {\n+                    if (off1 != -1 && off1 + 1 != len) {\n+                        s = format2(format, off, off1, args[0], args[1]);\n+                    }\n+                }\n+                if (s != null) {\n+                    return s;\n+                }\n@@ -62,18 +76,2 @@\n-    private static String format1(String format, Object arg) {\n-        int off = format.indexOf('%');\n-        if (off == -1) {\n-            \/\/ no formatting to be done\n-            return format;\n-        }\n-\n-        int max = format.length();\n-        if (off + 1 == max) {\n-            return null;\n-        }\n-\n-        if (off + 2 < max) {\n-            if (format.indexOf('%', off + 2) != -1) {\n-                return null;\n-            }\n-        }\n-\n+    private static String format1(String format, int off, Object arg) {\n+        int len = format.length();\n@@ -84,1 +82,1 @@\n-            if (off + 2 < max) {\n+            if (off + 2 < len) {\n@@ -104,11 +102,2 @@\n-    private static String format2(String format, Object arg0, Object arg1) {\n-        int off0 = format.indexOf('%');\n-        if (off0 == -1) {\n-            \/\/ no formatting to be done\n-            return format;\n-        }\n-\n-        int max = format.length();\n-        if (off0 + 1 == max) {\n-            return null;\n-        }\n+    private static String format2(String format, int off0, int off1, Object arg0, Object arg1) {\n+        final int len = format.length();\n@@ -119,1 +108,1 @@\n-            if (off0 + 2 < max) {\n+            if (off0 + 2 < len) {\n@@ -124,4 +113,0 @@\n-        int off1 = format.indexOf('%', off0 + 1);\n-        if (off1 == -1 || off1 + 1 == max) {\n-            return null;\n-        }\n@@ -132,1 +117,1 @@\n-            if (off1 + 2 < max) {\n+            if (off1 + 2 < len) {\n@@ -137,1 +122,1 @@\n-        if (off1 + 2 < max) {\n+        if (off1 + 2 < len) {\n@@ -174,0 +159,8 @@\n+        int specifierSize0 = 2 + (width0 != 0 ? 1 : 0);\n+        int specifierSize1 = 2 + (width1 != 0 ? 1 : 0);\n+\n+        int strlen = len\n+                + Math.max(width0, size0)\n+                + Math.max(width1, size1)\n+                - specifierSize0\n+                - specifierSize1;\n@@ -175,2 +168,4 @@\n-                ? format2Latin1(format, off0, conv0, arg0, width0, size0, off1, conv1, arg1, width1, size1)\n-                : format2UTF16( format, off0, conv0, arg0, width0, size0, off1, conv1, arg1, width1, size1);\n+                ? format2Latin1(format, strlen, off0, conv0, arg0, width0, size0, specifierSize0,\n+                                                off1, conv1, arg1, width1, size1, specifierSize1)\n+                : format2UTF16( format, strlen, off0, conv0, arg0, width0, size0, specifierSize0,\n+                                                off1, conv1, arg1, width1, size1, specifierSize1);\n@@ -222,3 +217,3 @@\n-            String format,\n-            int off0, char conv0, Object arg0, int width0, int size0,\n-            int off1, char conv1, Object arg1, int width1, int size1\n+            String format, int length,\n+            int off0, char conv0, Object arg0, int width0, int size0, int specifierSize0,\n+            int off1, char conv1, Object arg1, int width1, int size1, int specifierSize1\n@@ -226,7 +221,0 @@\n-        int specifierSize0 = 2 + (width0 != 0 ? 1 : 0);\n-        int specifierSize1 = 2 + (width1 != 0 ? 1 : 0);\n-        int length = format.length()\n-                + Math.max(width0, size0)\n-                + Math.max(width1, size1)\n-                - specifierSize0\n-                - specifierSize1;\n@@ -256,3 +244,3 @@\n-            String format,\n-            int off0, char conv0, Object arg0, int width0, int size0,\n-            int off1, char conv1, Object arg1, int width1, int size1\n+            String format, int length,\n+            int off0, char conv0, Object arg0, int width0, int size0, int specifierSize0,\n+            int off1, char conv1, Object arg1, int width1, int size1, int specifierSize1\n@@ -261,7 +249,0 @@\n-        int specifierSize0 = 2 + (width0 != 0 ? 1 : 0);\n-        int specifierSize1 = 2 + (width1 != 0 ? 1 : 0);\n-        int length = format.length()\n-                + Math.max(width0, size0)\n-                + Math.max(width1, size1)\n-                - specifierSize0\n-                - specifierSize1;\n","filename":"src\/java.base\/share\/classes\/java\/lang\/StringFormat.java","additions":47,"deletions":66,"binary":false,"changes":113,"status":"modified"}]}