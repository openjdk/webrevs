{"files":[{"patch":"@@ -105,0 +105,1 @@\n+\t$(info $(_) TEST_DEPS=\"dependency1 ...\" # Specify additional dependencies for running tests, e.g docs-jdk\n","filename":"make\/Global.gmk","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-      COMPARE_BUILD JTREG GTEST MICRO TEST_OPTS TEST_VM_OPTS\n+      COMPARE_BUILD JTREG GTEST MICRO TEST_OPTS TEST_VM_OPTS TEST_DEPS\n","filename":"make\/InitSupport.gmk","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -788,1 +788,1 @@\n-    DEPS := jdk-image test-image, \\\n+    DEPS := jdk-image test-image $(TEST_DEPS), \\\n@@ -794,1 +794,1 @@\n-    DEPS := exploded-image test-image, \\\n+    DEPS := exploded-image test-image $(TEST_DEPS), \\\n@@ -1113,2 +1113,2 @@\n-  $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))\n-  $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))\n+  $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image $(TEST_DEPS)))\n+  $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image $(TEST_DEPS)))\n","filename":"make\/Main.gmk","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -267,0 +267,1 @@\n+docs_JTREG_PROBLEM_LIST += $(TOPDIR)\/test\/docs\/ProblemList.txt\n@@ -871,0 +872,7 @@\n+  ifneq ($$(DOCS_IMAGE_DIR), )\n+    DOCS_PATH := $$(DOCS_IMAGE_DIR)\n+  else\n+    DOCS_PATH := $$(OUTPUTDIR)\/images\/docs\n+  endif\n+  $1_JTREG_BASIC_OPTIONS += -e:DOCS_IMAGE_DIR=$$(DOCS_PATH)\n+\n","filename":"make\/RunTests.gmk","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-JTREG_TESTROOTS += $(addprefix $(TOPDIR)\/test\/, hotspot\/jtreg jdk langtools jaxp lib-test)\n+JTREG_TESTROOTS += $(addprefix $(TOPDIR)\/test\/, hotspot\/jtreg jdk langtools jaxp lib-test docs)\n","filename":"make\/common\/FindTests.gmk","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -960,1 +960,1 @@\n-    if (testedProfile == null) {\n+    if (testedProfile == null || testedProfile == \"docs\") {\n@@ -1002,0 +1002,9 @@\n+    var testOnlyProfilesPrebuiltDocs = {\n+        \"run-test-prebuilt-docs\": clone(testOnlyProfilesPrebuilt[\"run-test-prebuilt\"])\n+    };\n+\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"].dependencies.push(\"docs.doc_api_spec\", \"tidy\");\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"].environment[\"DOCS_IMAGE_DIR\"] = input.get(\"docs.doc_api_spec\", \"install_path\");\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"].environment[\"TIDY\"] = input.get(\"tidy\", \"home_path\") + \"\/bin\/tidy\";\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"].labels = \"test-docs\";\n+\n@@ -1005,1 +1014,1 @@\n-    if (input.profile == \"run-test-prebuilt\") {\n+    if (input.profile == \"run-test-prebuilt\" || input.profile == \"run-test-prebuilt-docs\") {\n@@ -1010,10 +1019,7 @@\n-    if (profiles[testedProfile] != null) {\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_os\"]\n-            = profiles[testedProfile][\"target_os\"];\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_cpu\"]\n-            = profiles[testedProfile][\"target_cpu\"];\n-    } else if (profiles[testImageProfile] != null) {\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_os\"]\n-            = profiles[testImageProfile][\"target_os\"];\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_cpu\"]\n-            = profiles[testImageProfile][\"target_cpu\"];\n+    function updateProfileTargets(profiles, testedProfile, testImageProfile, targetProfile, runTestProfile) {\n+        var profileToCheck = profiles[testedProfile] || profiles[testImageProfile];\n+\n+        if (profileToCheck != null) {\n+            targetProfile[runTestProfile][\"target_os\"] = profileToCheck[\"target_os\"];\n+            targetProfile[runTestProfile][\"target_cpu\"] = profileToCheck[\"target_cpu\"];\n+        }\n@@ -1021,0 +1027,5 @@\n+\n+    updateProfileTargets(profiles, testedProfile, testImageProfile, testOnlyProfilesPrebuilt, \"run-test-prebuilt\");\n+    updateProfileTargets(profiles, testedProfile, testImageProfile, testOnlyProfilesPrebuiltDocs, \"run-test-prebuilt-docs\");\n+\n+    profiles = concatObjects(profiles, testOnlyProfilesPrebuiltDocs);\n@@ -1070,0 +1081,2 @@\n+        profiles[\"run-test-prebuilt-docs\"] = concatObjects(profiles[\"run-test-prebuilt-docs\"],\n+            runTestPrebuiltSrcFullExtra);\n","filename":"make\/conf\/jib-profiles.js","additions":25,"deletions":12,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -0,0 +1,41 @@\n+###########################################################################\n+#\n+# Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+###########################################################################\n+\n+#############################################################################\n+#\n+# List of quarantined tests -- tests that should not be run by default, because\n+# they may fail due to known reason. The reason (CR#) must be mandatory specified.\n+#\n+# List items are testnames followed by labels, all MUST BE commented\n+#   as to why they are here and use a label:\n+#     generic-all   Problems on all platforms\n+#     generic-ARCH  Where ARCH is one of: x64, i586, ppc64, ppc64le, s390x etc.\n+#     OSNAME-all    Where OSNAME is one of: linux, windows, macosx, aix\n+#     OSNAME-ARCH   Specific on to one OSNAME and ARCH, e.g. macosx-x64\n+#     OSNAME-REV    Specific on to one OSNAME and REV, e.g. macosx-10.7.4\n+#\n+# More than one label is allowed but must be on the same line.\n+#\n+#############################################################################\n","filename":"test\/docs\/ProblemList.txt","additions":41,"deletions":0,"binary":false,"changes":41,"status":"added"},{"patch":"@@ -0,0 +1,51 @@\n+#\n+# Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+#\n+\n+# This file identifies the root of the test-suite hierarchy.\n+# It also contains test-suite configuration information.\n+\n+# The list of keywords supported in the entire test suite.  The\n+# \"intermittent\" keyword marks tests known to fail intermittently.\n+# The \"randomness\" keyword marks tests using randomness with test\n+# cases differing from run to run. (A test using a fixed random seed\n+# would not count as \"randomness\" by this definition.) Extra care\n+# should be taken to handle test failures of intermittent or\n+# randomness tests.\n+\n+# Group definitions\n+groups=TEST.groups\n+\n+# Minimum jtreg version\n+requiredVersion=7.4+1\n+\n+# Use new module options\n+useNewOptions=true\n+\n+# Use --patch-module instead of -Xmodule:\n+useNewPatchModule=true\n+\n+# Path to libraries in the topmost test directory. This is needed so @library\n+# does not need ..\/..\/ notation to reach them\n+external.lib.roots = ..\/..\/\n","filename":"test\/docs\/TEST.ROOT","additions":51,"deletions":0,"binary":false,"changes":51,"status":"added"},{"patch":"@@ -0,0 +1,29 @@\n+#  Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+#  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+#  This code is free software; you can redistribute it and\/or modify it\n+#  under the terms of the GNU General Public License version 2 only, as\n+#  published by the Free Software Foundation.\n+#\n+#  This code is distributed in the hope that it will be useful, but WITHOUT\n+#  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+#  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+#  version 2 for more details (a copy is included in the LICENSE file that\n+#  accompanied this code).\n+#\n+#  You should have received a copy of the GNU General Public License version\n+#  2 along with this work; if not, write to the Free Software Foundation,\n+#  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+#  Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+#  or visit www.oracle.com if you need additional information or have any\n+#  questions.\n+#\n+\n+# Docs-specific test groups\n+\n+docs_all = \\\n+    \/\n+\n+tier2 = \\\n+    :docs_all\n","filename":"test\/docs\/TEST.groups","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"},{"patch":"@@ -0,0 +1,44 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @library \/test\/lib ..\/..\/tools\/tester\n+ * @build jtreg.SkippedException\n+ * @summary example of a test on the generated documentation\n+ * @run main TestDocs\n+ *\/\n+\n+import java.nio.file.Files;\n+\n+public class TestDocs {\n+    public static void main(String... args) throws Exception {\n+        var docs = DocTester.resolveDocs();\n+        System.err.println(\"Path to the docs is: \" + docs);\n+        System.err.println(\"Do docs exits?\");\n+        System.err.println(Files.exists(docs));\n+        System.err.println(\"tidy location\");\n+        System.err.println(System.getProperty(\"tidy\"));\n+        System.err.println(\"End of test\");\n+    }\n+}\n","filename":"test\/docs\/jdk\/javadoc\/TestDocs.java","additions":44,"deletions":0,"binary":false,"changes":44,"status":"added"},{"patch":"@@ -0,0 +1,47 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\n+import jtreg.SkippedException;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+\n+\/**\n+ * Test framework for performing tests on the generated documentation.\n+ *\/\n+public class DocTester {\n+    private final static String DIR = System.getenv(\"DOCS_IMAGE_DIR\");\n+    private static final Path firstCandidate = Path.of(System.getProperty(\"test.jdk\"))\n+            .getParent().resolve(\"docs\");\n+\n+    public static Path resolveDocs() {\n+        if (DIR != null && !DIR.isBlank() && Files.exists(Path.of(DIR))) {\n+            return Path.of(DIR);\n+        } else if (Files.exists(firstCandidate)) {\n+            return firstCandidate;\n+        }else {\n+            throw new SkippedException(\"docs folder not found in either location\");\n+        }\n+    }\n+}\n","filename":"test\/docs\/tools\/tester\/DocTester.java","additions":47,"deletions":0,"binary":false,"changes":47,"status":"added"}]}