{"files":[{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,0 +60,1 @@\n+\t$(info $(_) make test-docs TEST=<t> # Run test(s) on the generated documentation)\n","filename":"make\/Global.gmk","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -791,0 +791,6 @@\n+$(eval $(call SetupTarget, test-docs, \\\n+    MAKEFILE := RunTests, \\\n+    ARGS := TEST=\"$(TEST)\", \\\n+    DEPS := jdk-image test-image docs-jdk, \\\n+))\n+\n@@ -1337,0 +1343,1 @@\n+run-test-docs: test-docs\n","filename":"make\/Main.gmk","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -267,0 +267,1 @@\n+docs_JTREG_PROBLEM_LIST += $(TOPDIR)\/test\/docs\/ProblemList.txt\n@@ -871,0 +872,7 @@\n+  ifneq ($$(DOCS_IMAGE_DIR), )\n+    DOCS_PATH := $$(DOCS_IMAGE_DIR)\n+  else\n+    DOCS_PATH := $$(OUTPUTDIR)\/images\/docs\n+  endif\n+  $1_JTREG_BASIC_OPTIONS += -e:DOCS_IMAGE_DIR=$$(DOCS_PATH)\n+\n","filename":"make\/RunTests.gmk","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-JTREG_TESTROOTS += $(addprefix $(TOPDIR)\/test\/, hotspot\/jtreg jdk langtools jaxp lib-test)\n+JTREG_TESTROOTS += $(addprefix $(TOPDIR)\/test\/, hotspot\/jtreg jdk langtools jaxp lib-test docs)\n","filename":"make\/common\/FindTests.gmk","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -960,1 +960,1 @@\n-    if (testedProfile == null) {\n+    if (testedProfile == null || testedProfile == \"docs\") {\n@@ -1002,0 +1002,8 @@\n+    var testOnlyProfilesPrebuiltDocs = clone(testOnlyProfilesPrebuilt);\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"] = testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt\"];\n+    delete testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt\"];\n+\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"].dependencies.push(\"docs.doc_api_spec\");\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"].environment[\"DOCS_IMAGE_DIR\"] = input.get(\"docs.doc_api_spec\", \"install_path\");\n+    testOnlyProfilesPrebuiltDocs[\"run-test-prebuilt-docs\"].labels = \"test-docs\";\n+\n@@ -1005,1 +1013,1 @@\n-    if (input.profile == \"run-test-prebuilt\") {\n+    if (input.profile == \"run-test-prebuilt\" || input.profile == \"run-test-prebuilt-docs\") {\n@@ -1010,12 +1018,2 @@\n-    if (profiles[testedProfile] != null) {\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_os\"]\n-            = profiles[testedProfile][\"target_os\"];\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_cpu\"]\n-            = profiles[testedProfile][\"target_cpu\"];\n-    } else if (profiles[testImageProfile] != null) {\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_os\"]\n-            = profiles[testImageProfile][\"target_os\"];\n-        testOnlyProfilesPrebuilt[\"run-test-prebuilt\"][\"target_cpu\"]\n-            = profiles[testImageProfile][\"target_cpu\"];\n-    }\n-    profiles = concatObjects(profiles, testOnlyProfilesPrebuilt);\n+    function updateProfileTargets(profiles, testedProfile, testImageProfile, targetProfile, runTestProfile) {\n+        var profileToCheck = profiles[testedProfile] || profiles[testImageProfile];\n@@ -1023,18 +1021,3 @@\n-    \/\/ On macosx add the devkit bin dir to the path in all the run-test profiles.\n-    \/\/ This gives us a guaranteed working version of lldb for the jtreg failure handler.\n-    if (input.build_os == \"macosx\") {\n-        macosxRunTestExtra = {\n-            dependencies: [ \"lldb\" ],\n-            environment_path: [\n-                input.get(\"gnumake\", \"install_path\") + \"\/bin\",\n-                input.get(\"lldb\", \"install_path\") + \"\/Xcode\/Contents\/Developer\/usr\/bin\",\n-            ],\n-        };\n-        profiles[\"run-test\"] = concatObjects(profiles[\"run-test\"], macosxRunTestExtra);\n-        profiles[\"run-test-prebuilt\"] = concatObjects(profiles[\"run-test-prebuilt\"], macosxRunTestExtra);\n-    } else if (input.build_os == \"windows\") {\n-        \/\/ On windows, add the devkit debugger to the path in all the run-test profiles\n-        \/\/ to make them available to the jtreg failure handler.\n-        var archDir = \"x64\";\n-        if (input.build_arch == \"aarch64\") {\n-            archDir = \"arm64\"\n+        if (profileToCheck != null) {\n+            targetProfile[runTestProfile][\"target_os\"] = profileToCheck[\"target_os\"];\n+            targetProfile[runTestProfile][\"target_cpu\"] = profileToCheck[\"target_cpu\"];\n@@ -1042,7 +1025,0 @@\n-        windowsRunTestExtra = {\n-            environment_path: [\n-                input.get(\"devkit\", \"install_path\") + \"\/10\/Debuggers\/\" + archDir\n-            ]\n-        }\n-        profiles[\"run-test\"] = concatObjects(profiles[\"run-test\"], windowsRunTestExtra);\n-        profiles[\"run-test-prebuilt\"] = concatObjects(profiles[\"run-test-prebuilt\"], windowsRunTestExtra);\n@@ -1051,0 +1027,6 @@\n+    updateProfileTargets(profiles, testedProfile, testImageProfile, testOnlyProfilesPrebuilt, \"run-test-prebuilt\");\n+    updateProfileTargets(profiles, testedProfile, testImageProfile, testOnlyProfilesPrebuiltDocs, \"run-test-prebuilt-docs\");\n+\n+    profiles = concatObjects(profiles, testOnlyProfilesPrebuiltDocs);\n+    profiles = concatObjects(profiles, testOnlyProfilesPrebuilt);\n+\n@@ -1070,0 +1052,2 @@\n+        profiles[\"run-test-prebuilt-docs\"] = concatObjects(profiles[\"run-test-prebuilt-docs\"],\n+            runTestPrebuiltSrcFullExtra);\n","filename":"make\/conf\/jib-profiles.js","additions":23,"deletions":39,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -0,0 +1,10 @@\n+#\n+# Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+# ORACLE PROPRIETARY\/CONFIDENTIAL. Use is subject to license terms.\n+#\n+\n+###########################################################################\n+#\n+# See doc\/test\/ProblemList.txt for documentation on this file and its purpose.\n+#\n+#############################################################################\n","filename":"test\/docs\/ProblemList.txt","additions":10,"deletions":0,"binary":false,"changes":10,"status":"added"},{"patch":"@@ -0,0 +1,28 @@\n+# This file identifies the root of the test-suite hierarchy.\n+# It also contains test-suite configuration information.\n+\n+# The list of keywords supported in the entire test suite.  The\n+# \"intermittent\" keyword marks tests known to fail intermittently.\n+# The \"randomness\" keyword marks tests using randomness with test\n+# cases differing from run to run. (A test using a fixed random seed\n+# would not count as \"randomness\" by this definition.) Extra care\n+# should be taken to handle test failures of intermittent or\n+# randomness tests.\n+\n+keys=intermittent randomness needs-src needs-src-jdk_javadoc\n+\n+# Group definitions\n+groups=TEST.groups\n+\n+# Minimum jtreg version\n+requiredVersion=7.4+1\n+\n+# Use new module options\n+useNewOptions=true\n+\n+# Use --patch-module instead of -Xmodule:\n+useNewPatchModule=true\n+\n+# Path to libraries in the topmost test directory. This is needed so @library\n+# does not need ..\/..\/ notation to reach them\n+external.lib.roots = ..\/..\/\n","filename":"test\/docs\/TEST.ROOT","additions":28,"deletions":0,"binary":false,"changes":28,"status":"added"},{"patch":"@@ -0,0 +1,29 @@\n+#  Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+#  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+#  This code is free software; you can redistribute it and\/or modify it\n+#  under the terms of the GNU General Public License version 2 only, as\n+#  published by the Free Software Foundation.\n+#\n+#  This code is distributed in the hope that it will be useful, but WITHOUT\n+#  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+#  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+#  version 2 for more details (a copy is included in the LICENSE file that\n+#  accompanied this code).\n+#\n+#  You should have received a copy of the GNU General Public License version\n+#  2 along with this work; if not, write to the Free Software Foundation,\n+#  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+#  Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+#  or visit www.oracle.com if you need additional information or have any\n+#  questions.\n+#\n+\n+# Docs-specific test groups\n+\n+docs_all = \\\n+    \/\n+\n+tier2 = \\\n+    :docs_all\n","filename":"test\/docs\/TEST.groups","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"},{"patch":"@@ -0,0 +1,39 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @library \/test\/lib ..\/..\/tools\/tester\n+ * @build jtreg.SkippedException\n+ * @summary example of a test on the generated documentation\n+ * @run main TestDocs\n+ *\/\n+\n+import tester.DocTester;\n+\n+public class TestDocs {\n+    public static void main(String... args) throws Exception {\n+        var docs = DocTester.resolveDocs();\n+        System.err.println(docs);\n+    }\n+}\n","filename":"test\/docs\/jdk\/javadoc\/TestDocs.java","additions":39,"deletions":0,"binary":false,"changes":39,"status":"added"},{"patch":"@@ -0,0 +1,1 @@\n+echo_file test\/TEST.properties\n","filename":"test\/docs\/req.flg","additions":1,"deletions":0,"binary":false,"changes":1,"status":"added"},{"patch":"@@ -0,0 +1,48 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package tester;\n+\n+import jtreg.SkippedException;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+\n+\/**\n+ * Test framework for performing tests on the generated documentation.\n+ *\/\n+public class DocTester {\n+    private final static String DIR = System.getenv(\"DOCS_IMAGE_DIR\");\n+    private static final Path firstCandidate = Path.of(System.getProperty(\"test.jdk\"))\n+            .getParent().resolve(\"docs\");\n+\n+    public static Path resolveDocs() {\n+        if (DIR != null && !DIR.isBlank() && Files.exists(Path.of(DIR))) {\n+            return Path.of(DIR);\n+        } else if (Files.exists(firstCandidate)) {\n+            return firstCandidate;\n+        }else {\n+            throw new SkippedException(\"docs folder not found in either location\");\n+        }\n+    }\n+}\n","filename":"test\/docs\/tools\/tester\/DocTester.java","additions":48,"deletions":0,"binary":false,"changes":48,"status":"added"}]}