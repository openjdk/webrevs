{"files":[{"patch":"@@ -37,3 +37,3 @@\n- * is written to it.\n- * The data can be retrieved using {@code toByteArray()} and\n- * {@code toString()}.\n+ * is written to it. The data can be retrieved using {@code toByteArray()}\n+ * and {@code toString()}.\n+ *\n@@ -45,0 +45,6 @@\n+ * <p>\n+ * Subclasses of this class may override {@code ensureCapacity(int)} in\n+ * order to customize the buffer growth behavior. Subclasses which add\n+ * additional write methods should either manage buffer growth manually\n+ * or invoke {@code ensureCapacity(int)} to grow the buffer.\n+ *\n@@ -48,1 +54,0 @@\n-\n@@ -84,16 +89,0 @@\n-    \/**\n-     * Increases the capacity if necessary to ensure that this\n-     * {@code ByteArrayOutputStream} can hold at least the number of\n-     * elements specified by the {@code minCapacity} argument.\n-     * If the {@code minCapacity} argument is nonpositive, this\n-     * method takes no action and simply returns.\n-     *\n-     * @param minCapacity the desired minimum capacity.\n-     * @since 27\n-     *\/\n-    protected void ensureCapacity(int minCapacity) {\n-        if (minCapacity > 0) {\n-            ensureCapacityInternal(minCapacity);\n-        }\n-    }\n-\n@@ -108,1 +97,1 @@\n-     * request for the unsatisfiably large capacity.\n+     * request for the unsatisfiably large capacity\n@@ -110,0 +99,1 @@\n+     * @since 27\n@@ -111,1 +101,1 @@\n-    private void ensureCapacityInternal(int minCapacity) {\n+    protected void ensureCapacity(int minCapacity) {\n@@ -128,1 +118,1 @@\n-        ensureCapacityInternal(count + 1);\n+        ensureCapacity(count + 1);\n@@ -148,1 +138,1 @@\n-        ensureCapacityInternal(count + len);\n+        ensureCapacity(count + len);\n","filename":"src\/java.base\/share\/classes\/java\/io\/ByteArrayOutputStream.java","additions":14,"deletions":24,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -74,0 +74,17 @@\n+\n+        \/\/ verify that overriding ensureCapacity() affects behavior of standard write methods\n+\n+        EvenOutputStream out2 = new EvenOutputStream();\n+        assertEquals(0, out2.getBufferLength());\n+\n+        out2.write(89);\n+        assertEquals(2, out2.getBufferLength());\n+\n+        out2.write(12);\n+        assertEquals(2, out2.getBufferLength());\n+\n+        out2.write(new byte[] { 1, 2, 3 }, 0, 3);\n+        assertEquals(6, out2.getBufferLength());\n+\n+        out2.write(77);\n+        assertEquals(6, out2.getBufferLength());\n@@ -98,0 +115,1 @@\n+    \/\/ provides extra visibility into internals\n@@ -106,0 +124,17 @@\n+\n+    \/\/ starts empty, is always sized to an even number of bytes\n+    private static final class EvenOutputStream extends ByteArrayOutputStream {\n+        public EvenOutputStream() {\n+            super(0);\n+        }\n+        protected void ensureCapacity(int minCapacity) {\n+            int deficit = minCapacity - buf.length;\n+            if (deficit > 0) {\n+                minCapacity += minCapacity % 2;\n+                buf = Arrays.copyOf(buf, minCapacity);\n+            }\n+        }\n+        public int getBufferLength() {\n+            return buf.length;\n+        }\n+    }\n","filename":"test\/jdk\/java\/io\/ByteArrayOutputStream\/EnsureCapacity.java","additions":35,"deletions":0,"binary":false,"changes":35,"status":"modified"}]}