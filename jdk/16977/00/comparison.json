{"files":[{"patch":"@@ -559,1 +559,0 @@\n-\n@@ -713,0 +712,11 @@\n+            return new Attribute.Error(syms.errType);\n+        } else {\n+            ListBuffer<Attribute> buf = new ListBuffer<>();\n+            for (List<JCExpression> l = na.elems; l.nonEmpty(); l = l.tail) {\n+                buf.append(attributeAnnotationValue(types.elemtype(expectedElementType),\n+                        l.head,\n+                        env));\n+            }\n+            na.type = expectedElementType;\n+            return new Attribute.\n+                    Array(expectedElementType, buf.toArray(new Attribute[buf.length()]));\n@@ -714,9 +724,0 @@\n-        ListBuffer<Attribute> buf = new ListBuffer<>();\n-        for (List<JCExpression> l = na.elems; l.nonEmpty(); l=l.tail) {\n-            buf.append(attributeAnnotationValue(types.elemtype(expectedElementType),\n-                    l.head,\n-                    env));\n-        }\n-        na.type = expectedElementType;\n-        return new Attribute.\n-                Array(expectedElementType, buf.toArray(new Attribute[buf.length()]));\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Annotate.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -0,0 +1,18 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @bug 8320144\n+ * @summary Compilation crashes when a custom annotation with invalid default value is used\n+ * @compile\/fail\/ref=T8320144.out -XDrawDiagnostics T8320144.java\n+ *\/\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+public class T8320144 {\n+    @Retention(RetentionPolicy.RUNTIME)\n+    @Target({ElementType.TYPE})\n+    public @interface TestAnnotation {\n+        public String[] excludeModules() default new String[0];\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/T8320144.java","additions":18,"deletions":0,"binary":false,"changes":18,"status":"added"},{"patch":"@@ -0,0 +1,2 @@\n+T8320144.java:16:54: compiler.err.new.not.allowed.in.annotation\n+1 error\n\\ No newline at end of file\n","filename":"test\/langtools\/tools\/javac\/T8320144.out","additions":2,"deletions":0,"binary":false,"changes":2,"status":"added"}]}