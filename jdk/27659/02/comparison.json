{"files":[{"patch":"@@ -82,10 +82,1 @@\n-compiler\/whitebox\/DeoptimizeRelocatedNMethod.java#G1 8369147 generic-all\n-compiler\/whitebox\/DeoptimizeRelocatedNMethod.java#Parallel 8369147 generic-all\n-compiler\/whitebox\/DeoptimizeRelocatedNMethod.java#Serial 8369147 generic-all\n-compiler\/whitebox\/DeoptimizeRelocatedNMethod.java#ZGC 8369147 generic-all\n-compiler\/whitebox\/RelocateNMethod.java#G1 8369147 generic-all\n-compiler\/whitebox\/RelocateNMethod.java#Parallel 8369147 generic-all\n-compiler\/whitebox\/RelocateNMethod.java#Serial 8369147 generic-all\n-compiler\/whitebox\/RelocateNMethod.java#ZGC 8369147 generic-all\n-compiler\/whitebox\/StressNMethodRelocation.java 8369147,8369148,8369149 generic-all\n-serviceability\/jvmti\/NMethodRelocation\/NMethodRelocationTest.java 8369150,8369151 generic-all\n+serviceability\/jvmti\/NMethodRelocation\/NMethodRelocationTest.java 8369150 generic-all\n","filename":"test\/hotspot\/jtreg\/ProblemList.txt","additions":1,"deletions":10,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @test id=Serial\n+ * @test\n@@ -31,1 +31,0 @@\n- * @requires vm.gc.Serial\n@@ -34,53 +33,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache -XX:+UseSerialGC\n- * -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.DeoptimizeRelocatedNMethod\n- *\/\n-\n-\/*\n- * @test id=Parallel\n- * @bug 8316694\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.Parallel\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache -XX:+UseParallelGC\n- * -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.DeoptimizeRelocatedNMethod\n- *\/\n-\n-\/*\n- * @test id=G1\n- * @bug 8316694\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.G1\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache -XX:+UseG1GC\n- * -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.DeoptimizeRelocatedNMethod\n- *\/\n-\n-\/*\n- * @test id=Shenandoah\n- * @bug 8316694\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.Shenandoah\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache -XX:+UseShenandoahGC\n- * -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.DeoptimizeRelocatedNMethod\n- *\/\n-\n-\/*\n- * @test id=ZGC\n- * @bug 8316694\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.Z\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache -XX:+UseZGC\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache\n@@ -121,1 +68,1 @@\n-        WHITE_BOX.relocateNMethodFromMethod(method, BlobType.MethodProfiled.id);\n+        WHITE_BOX.relocateNMethodFromMethod(method, BlobType.MethodNonProfiled.id);\n","filename":"test\/hotspot\/jtreg\/compiler\/whitebox\/DeoptimizeRelocatedNMethod.java","additions":3,"deletions":56,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @test id=Serial\n+ * @test\n@@ -31,1 +31,0 @@\n- *\n@@ -33,2 +32,0 @@\n- * @requires vm.gc.Serial\n- *\n@@ -38,1 +35,1 @@\n- * -XX:+UseSerialGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.RelocateNMethod\n+ * -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.RelocateNMethod\n@@ -41,63 +38,0 @@\n-\/*\n- * @test id=Parallel\n- * @bug 8316694\n- * @summary test that nmethod::relocate() correctly creates a new nmethod\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.Parallel\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache\n- * -XX:+UseParallelGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.RelocateNMethod\n- *\/\n-\n-\/*\n- * @test id=G1\n- * @bug 8316694\n- * @summary test that nmethod::relocate() correctly creates a new nmethod\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.G1\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache\n- * -XX:+UseG1GC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.RelocateNMethod\n- *\/\n-\n-\/*\n- * @test id=Shenandoah\n- * @bug 8316694\n- * @summary test that nmethod::relocate() correctly creates a new nmethod\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.Shenandoah\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache\n- * -XX:+UseShenandoahGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.RelocateNMethod\n- *\/\n-\n-\/*\n- * @test id=ZGC\n- * @bug 8316694\n- * @summary test that nmethod::relocate() correctly creates a new nmethod\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @requires vm.opt.DeoptimizeALot != true\n- * @requires vm.gc.Z\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+SegmentedCodeCache\n- * -XX:+UseZGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.RelocateNMethod\n- *\/\n@@ -135,1 +69,1 @@\n-        WHITE_BOX.relocateNMethodFromMethod(method, BlobType.MethodProfiled.id);\n+        WHITE_BOX.relocateNMethodFromMethod(method, BlobType.MethodNonProfiled.id);\n","filename":"test\/hotspot\/jtreg\/compiler\/whitebox\/RelocateNMethod.java","additions":3,"deletions":69,"binary":false,"changes":72,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @test id=SerialC1\n+ * @test id=C1\n@@ -29,1 +29,0 @@\n- * @requires vm.gc.Serial\n@@ -37,1 +36,1 @@\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseSerialGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n+ * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n@@ -42,1 +41,1 @@\n- * @test id=SerialC2\n+ * @test id=C2\n@@ -45,1 +44,0 @@\n- * @requires vm.gc.Serial\n@@ -53,129 +51,1 @@\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseSerialGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=ParallelC1\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.Parallel\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation -XX:TieredStopAtLevel=1\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseParallelGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=ParallelC2\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.Parallel\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseParallelGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=G1C1\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.G1\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation -XX:TieredStopAtLevel=1\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseG1GC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=G1C2\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.G1\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseG1GC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=ShenandoahC1\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.Shenandoah\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation -XX:TieredStopAtLevel=1\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseShenandoahGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=ShenandoahC2\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.Shenandoah\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseShenandoahGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=ZGCC1\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.Z\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation -XX:TieredStopAtLevel=1\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseZGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n- * compiler.whitebox.RelocateNMethodMultiplePaths\n- *\/\n-\n-\/*\n- * @test id=ZGCC2\n- * @bug 8316694\n- * @requires vm.debug == true\n- * @requires vm.gc.Z\n- * @summary test that relocated nmethod is correctly deoptimized\n- * @library \/test\/lib \/\n- * @modules java.base\/jdk.internal.misc java.management\n- *\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbatch -XX:+TieredCompilation\n- * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UseZGC -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n+ * -XX:+SegmentedCodeCache -XX:-DeoptimizeRandom -XX:+DeoptimizeALot -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation\n","filename":"test\/hotspot\/jtreg\/compiler\/whitebox\/RelocateNMethodMultiplePaths.java","additions":4,"deletions":134,"binary":false,"changes":138,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+ * @requires vm.compiler2.enabled & vm.opt.SegmentedCodeCache != false & vm.opt.TieredCompilation != false\n@@ -34,2 +35,1 @@\n- *                   -XX:+SegmentedCodeCache -XX:+UnlockExperimentalVMOptions\n- *                   -XX:+NMethodRelocation compiler.whitebox.StressNMethodRelocation\n+ *                   -XX:+UnlockExperimentalVMOptions -XX:+NMethodRelocation compiler.whitebox.StressNMethodRelocation\n@@ -48,1 +48,1 @@\n-import java.util.Arrays;\n+import java.util.ArrayList;\n@@ -55,1 +55,0 @@\n-    private static final int ACTIVE_METHODS = 1024;\n@@ -57,1 +56,1 @@\n-    private static TestMethod[] methods;\n+    private static ArrayList<TestMethod> methods;\n@@ -61,1 +60,2 @@\n-    private static long DURATION = 60_000;\n+    private static long COMPILE_DURATION = 30_000;\n+    private static long RUN_DURATION = 60_000;\n@@ -68,1 +68,1 @@\n-        methods = new TestMethod[ACTIVE_METHODS];\n+        methods = new ArrayList<>();\n@@ -111,1 +111,1 @@\n-    private static void generateCode(TestMethod[] m) throws Exception {\n+    private static void generateCode(ArrayList<TestMethod> m) throws Exception {\n@@ -114,4 +114,6 @@\n-        for (int i = 0; i < ACTIVE_METHODS; ++i) {\n-            m[i] = new TestMethod();\n-            m[i].profile(num1, num2, result);\n-            m[i].compileWithC2();\n+        long startTime = System.currentTimeMillis();\n+        while (System.currentTimeMillis() - startTime < COMPILE_DURATION) {\n+            TestMethod testMethod = new TestMethod();\n+            testMethod.profile(num1, num2, result);\n+            testMethod.compileWithC2();\n+            m.add(testMethod);\n@@ -197,1 +199,1 @@\n-            while (System.currentTimeMillis() - startTime < DURATION) {\n+            while (System.currentTimeMillis() - startTime < RUN_DURATION) {\n@@ -223,1 +225,1 @@\n-                while (System.currentTimeMillis() - startTime < DURATION) {\n+                while (System.currentTimeMillis() - startTime < RUN_DURATION) {\n","filename":"test\/hotspot\/jtreg\/compiler\/whitebox\/StressNMethodRelocation.java","additions":16,"deletions":14,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+ * @requires vm.gc == \"null\" | vm.gc == \"Serial\"\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/NMethodRelocation\/NMethodRelocationTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}