{"files":[{"patch":"@@ -87,1 +87,0 @@\n-  static bool has_agents() { return head() != nullptr; }\n","filename":"src\/hotspot\/share\/prims\/jvmtiAgentList.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"jvmtifiles\/jvmtiEnv.hpp\"\n@@ -32,1 +33,0 @@\n-#include \"prims\/jvmtiAgentList.hpp\"\n@@ -41,1 +41,1 @@\n-static void for_scoped_methods(JavaThread* jt, const Func& func) {\n+static void for_scoped_methods(JavaThread* jt, bool agents_loaded, const Func& func) {\n@@ -53,1 +53,0 @@\n-  bool agents_loaded = JvmtiAgentList::has_agents();\n@@ -94,1 +93,2 @@\n-  if (jt->is_throwing_unsafe_access_error()) {\n+  bool agents_loaded = JvmtiEnv::environments_might_exist();\n+  if (!agents_loaded && jt->is_throwing_unsafe_access_error()) {\n@@ -101,1 +101,1 @@\n-  for_scoped_methods(jt, [&](vframeStream& stream){\n+  for_scoped_methods(jt, agents_loaded, [&](vframeStream& stream){\n","filename":"src\/hotspot\/share\/prims\/scopedMemoryAccess.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1363,0 +1363,1 @@\n+  bool _prev;\n@@ -1364,1 +1365,3 @@\n-  ThrowingUnsafeAccessError(JavaThread* thread) : _thread(thread) {\n+  ThrowingUnsafeAccessError(JavaThread* thread) :\n+      _thread(thread),\n+      _prev(thread->is_throwing_unsafe_access_error()) {\n@@ -1368,1 +1371,1 @@\n-    _thread->set_throwing_unsafe_access_error(false);\n+    _thread->set_throwing_unsafe_access_error(_prev);\n","filename":"src\/hotspot\/share\/runtime\/javaThread.hpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"}]}