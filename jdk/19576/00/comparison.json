{"files":[{"patch":"@@ -390,9 +390,0 @@\n-#define CHECK_EXCEPTION_NULL_FAIL(obj) \\\n-    do { \\\n-        if ((*env)->ExceptionOccurred(env)) { \\\n-            return 0; \\\n-        } else if (obj == NULL) { \\\n-            return 0; \\\n-        } \\\n-    } while (JNI_FALSE)\n-\n@@ -400,2 +391,5 @@\n- * Invoke a static main with arguments. Returns 1 (true) if successful otherwise\n- * processes the pending exception from GetStaticMethodID and returns 0 (false).\n+ * Locates a static main(String[]) method and invokes that method.\n+ * Returns 1 (true) if the method was found and invoked. Returns 0 (false) if\n+ * the method was not found.\n+ * Any exception thrown while locating the method or from within the invoked main\n+ * method will be available through ExceptionOccurred(JNIEnv *env).\n@@ -407,1 +401,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(mainID);\n+    if (mainID == NULL) {\n+        \/\/ static main(String[]) not found\n+        return 0;\n+    }\n@@ -409,1 +406,1 @@\n-    return 1;\n+    return 1; \/\/ method was invoked\n@@ -413,2 +410,5 @@\n- * Invoke an instance main with arguments. Returns 1 (true) if successful otherwise\n- * processes the pending exception from GetMethodID and returns 0 (false).\n+ * Locates a main(String[]) instance method and invokes that method.\n+ * Returns 1 (true) if the method was found and invoked. Returns 0 (false) if\n+ * the method was not found.\n+ * Any exception thrown while locating the method or from within the invoked main\n+ * method will be available through ExceptionOccurred(JNIEnv *env).\n@@ -419,1 +419,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(constructor);\n+    if (constructor == NULL) {\n+        \/\/ main class' no-arg constructor not found\n+        return 0;\n+    }\n@@ -421,1 +424,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(mainObject);\n+    if (mainObject == NULL) {\n+        \/\/ main class instance couldn't be constructed\n+        return 0;\n+    }\n@@ -424,1 +430,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(mainID);\n+    if (mainID == NULL) {\n+        \/\/ instance method main(String[]) method not found\n+        return 0;\n+    }\n@@ -426,1 +435,1 @@\n-    return 1;\n+    return 1; \/\/ method was invoked\n@@ -430,2 +439,5 @@\n- * Invoke a static main without arguments. Returns 1 (true) if successful otherwise\n- * processes the pending exception from GetStaticMethodID and returns 0 (false).\n+ * Locates a no-arg static \"main\" method and invokes that method.\n+ * Returns 1 (true) if the method was found and invoked. Returns 0 (false) if\n+ * the method was not found.\n+ * Any exception thrown while locating the method or from within the invoked main\n+ * method will be available through ExceptionOccurred(JNIEnv *env).\n@@ -437,1 +449,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(mainID);\n+    if (mainID == NULL) {\n+        \/\/ static main() method couldn't be located\n+        return 0;\n+    }\n@@ -439,1 +454,1 @@\n-    return 1;\n+    return 1; \/\/ method was invoked\n@@ -443,2 +458,5 @@\n- * Invoke an instance main without arguments. Returns 1 (true) if successful otherwise\n- * processes the pending exception from GetMethodID and returns 0 (false).\n+ * Locates a no-arg instance method \"main\" and invokes that method.\n+ * Returns 1 (true) if the method was found and invoked. Returns 0 (false) if\n+ * the method could not be found.\n+ * Any exception thrown while locating the method or from within the invoked main\n+ * method will be available through ExceptionOccurred(JNIEnv *env).\n@@ -449,1 +467,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(constructor);\n+    if (constructor == NULL) {\n+        \/\/ main class' no-arg constructor not found\n+        return 0;\n+    }\n@@ -451,1 +472,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(mainObject);\n+    if (mainObject == NULL) {\n+        \/\/ couldn't create instance of main class\n+        return 0;\n+    }\n@@ -454,1 +478,4 @@\n-    CHECK_EXCEPTION_NULL_FAIL(mainID);\n+    if (mainID == NULL) {\n+        \/\/ instance method main() not found\n+        return 0;\n+    }\n@@ -456,1 +483,1 @@\n-    return 1;\n+    return 1; \/\/ method was invoked\n@@ -642,0 +669,2 @@\n+        \/\/ An appropriate main method couldn't be located, check and report\n+        \/\/ any exception and LEAVE()\n@@ -649,2 +678,9 @@\n-    ret = (*env)->ExceptionOccurred(env) == NULL ? 0 : 1;\n-\n+    if (ret && (*env)->ExceptionOccurred(env) == NULL) {\n+        \/\/ main method was invoked and no exception was thrown from it,\n+        \/\/ return success.\n+        ret = 0;\n+    } else {\n+        \/\/ Either the main method couldn't be located or an exception occurred\n+        \/\/ in the invoked main method, return failure.\n+        ret = 1;\n+    }\n","filename":"src\/java.base\/share\/native\/libjli\/java.c","additions":67,"deletions":31,"binary":false,"changes":98,"status":"modified"}]}