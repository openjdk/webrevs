{"files":[{"patch":"@@ -754,0 +754,4 @@\n+  \/\/\n+  \/\/ In some cases, there are other relevant initial memory states besides\n+  \/\/ initial_mem. In such cases, we are rather dealing with multiple trees and\n+  \/\/ their fringes.\n@@ -773,6 +777,7 @@\n-  if (load->in(0) && initial_mem_block != nullptr) {\n-    \/\/ If the load has an explicit control input and initial_mem has a block,\n-    \/\/ walk up the dominator tree from the early block to the initial memory\n-    \/\/ block. If we in a block find memory Phi(s) that can alias initial_mem,\n-    \/\/ these are also potential initial memory states and there may be further\n-    \/\/ required anti dependences due to them.\n+  assert(initial_mem_block != nullptr, \"sanity\");\n+  if (load->in(0) != nullptr) {\n+    \/\/ If the load has an explicit control input, walk up the dominator tree\n+    \/\/ from the early block (inclusive) to the initial memory block\n+    \/\/ (inclusive). If we in a block find memory Phi(s) that can alias\n+    \/\/ initial_mem, these are also potential initial memory states and there\n+    \/\/ may be further required anti-dependences due to them.\n@@ -781,3 +786,5 @@\n-    \/\/ Stop searching when we run out of dominators (b == nullptr) or when we\n-    \/\/ step past the initial memory block (b == initial_mem_block->_idom).\n-    while (b != nullptr && b != initial_mem_block->_idom) {\n+    \/\/ Stop searching when we step past the initial memory block (b ==\n+    \/\/ initial_mem_block->_idom). The loop below always terminates because the\n+    \/\/ root block strictly dominates initial_mem_block.\n+    while (b != initial_mem_block->_idom) {\n+      assert(b != nullptr, \"sanity\");\n@@ -785,0 +792,2 @@\n+        \/\/ If we are in the initial memory block, and initial_mem is not itself\n+        \/\/ a Phi, no Phis in the block can be initial memory states.\n@@ -787,0 +796,4 @@\n+      \/\/ We need to process all memory Phi nodes in the block. We may not have\n+      \/\/ run LCM yet, so we cannot assume anything regarding the location of\n+      \/\/ Phi nodes within the block. Therefore, we must search the entire\n+      \/\/ block.\n@@ -789,1 +802,2 @@\n-        if (n->is_memory_phi() && C->can_alias(n->adr_type(), load_alias_idx)) {\n+        if (n->is_memory_phi() && C->can_alias(n->adr_type(), load_alias_idx) && n != initial_mem) {\n+          \/\/ We have found a relevant Phi initial memory state\n","filename":"src\/hotspot\/share\/opto\/gcm.cpp","additions":24,"deletions":10,"binary":false,"changes":34,"status":"modified"}]}