{"files":[{"patch":"@@ -907,0 +907,15 @@\n+static bool trace_compiler_threads() {\n+  LogTarget(Debug, jit, thread) lt;\n+  return TraceCompilerThreads || lt.is_enabled();\n+}\n+\n+static void print_compiler_threads(stringStream& msg) {\n+  if (TraceCompilerThreads) {\n+    tty->print_cr(\"%7d %s\", (int)tty->time_stamp().milliseconds(), msg.as_string());\n+  }\n+  LogTarget(Debug, jit, thread) lt;\n+  if (lt.is_enabled()) {\n+    LogStream ls(lt);\n+    ls.print_cr(\"%s\", msg.as_string());\n+  }\n+}\n@@ -946,1 +961,1 @@\n-      if (TraceCompilerThreads) {\n+      if (trace_compiler_threads()) {\n@@ -950,1 +965,3 @@\n-        tty->print_cr(\"Added initial compiler thread %s\", ct->name());\n+        stringStream msg;\n+        msg.print(\"Added initial compiler thread %s\", ct->name());\n+        print_compiler_threads(msg);\n@@ -967,1 +984,1 @@\n-      if (TraceCompilerThreads) {\n+      if (trace_compiler_threads()) {\n@@ -971,1 +988,3 @@\n-        tty->print_cr(\"Added initial compiler thread %s\", ct->name());\n+        stringStream msg;\n+        msg.print(\"Added initial compiler thread %s\", ct->name());\n+        print_compiler_threads(msg);\n@@ -1029,1 +1048,1 @@\n-          if (TraceCompilerThreads) {\n+          if (trace_compiler_threads()) {\n@@ -1031,2 +1050,4 @@\n-            tty->print_cr(\"JVMCI compiler thread creation failed:\");\n-            PENDING_EXCEPTION->print();\n+            stringStream msg;\n+            msg.print_cr(\"JVMCI compiler thread creation failed:\");\n+            PENDING_EXCEPTION->print_on(&msg);\n+            print_compiler_threads(msg);\n@@ -1047,1 +1068,1 @@\n-      if (TraceCompilerThreads) {\n+      if (trace_compiler_threads()) {\n@@ -1051,2 +1072,4 @@\n-        tty->print_cr(\"Added compiler thread %s (available memory: %dMB, available non-profiled code cache: %dMB)\",\n-                      ct->name(), (int)(available_memory\/M), (int)(available_cc_np\/M));\n+        stringStream msg;\n+        msg.print(\"Added compiler thread %s (available memory: %dMB, available non-profiled code cache: %dMB)\",\n+                  ct->name(), (int)(available_memory\/M), (int)(available_cc_np\/M));\n+        print_compiler_threads(msg);\n@@ -1068,1 +1091,1 @@\n-      if (TraceCompilerThreads) {\n+      if (trace_compiler_threads()) {\n@@ -1072,2 +1095,4 @@\n-        tty->print_cr(\"Added compiler thread %s (available memory: %dMB, available profiled code cache: %dMB)\",\n-                      ct->name(), (int)(available_memory\/M), (int)(available_cc_p\/M));\n+        stringStream msg;\n+        msg.print(\"Added compiler thread %s (available memory: %dMB, available profiled code cache: %dMB)\",\n+                  ct->name(), (int)(available_memory\/M), (int)(available_cc_p\/M));\n+        print_compiler_threads(msg);\n@@ -1888,3 +1913,6 @@\n-          if (TraceCompilerThreads) {\n-            tty->print_cr(\"Removing compiler thread %s after \" JLONG_FORMAT \" ms idle time\",\n-                          thread->name(), thread->idle_time_millis());\n+          if (trace_compiler_threads()) {\n+            ResourceMark rm;\n+            stringStream msg;\n+            msg.print(\"Removing compiler thread %s after \" JLONG_FORMAT \" ms idle time\",\n+                      thread->name(), thread->idle_time_millis());\n+            print_compiler_threads(msg);\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.cpp","additions":44,"deletions":16,"binary":false,"changes":60,"status":"modified"}]}