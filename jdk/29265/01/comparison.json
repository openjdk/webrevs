{"files":[{"patch":"@@ -76,0 +76,5 @@\n+static Node* trace_vector(Node* operation) {\n+  VectorNode::trace_new_vector(operation, \"VectorAPI\");\n+  return operation;\n+}\n+\n@@ -460,1 +465,1 @@\n-\n+  trace_vector(operation);\n@@ -629,1 +634,1 @@\n-  Node* maskoper = gvn().transform(VectorMaskOpNode::make(mask_vec, maskoper_ty, mopc));\n+  Node* maskoper = gvn().transform(trace_vector(VectorMaskOpNode::make(mask_vec, maskoper_ty, mopc)));\n@@ -712,1 +717,1 @@\n-      broadcast = gvn().transform(new VectorLongToMaskNode(elem, vt));\n+      broadcast = gvn().transform(trace_vector(new VectorLongToMaskNode(elem, vt)));\n@@ -715,1 +720,1 @@\n-      broadcast = gvn().transform(new VectorLongToMaskNode(elem, mvt));\n+      broadcast = gvn().transform(trace_vector(new VectorLongToMaskNode(elem, mvt)));\n@@ -743,1 +748,1 @@\n-    broadcast = VectorNode::scalar2vector(elem, num_elem, elem_bt, is_mask);\n+    broadcast = trace_vector(VectorNode::scalar2vector(elem, num_elem, elem_bt, is_mask));\n@@ -929,1 +934,1 @@\n-    Node* vstore = gvn().transform(StoreVectorNode::make(0, control(), memory(addr), addr, addr_type, val, store_num_elem));\n+    Node* vstore = gvn().transform(trace_vector(StoreVectorNode::make(0, control(), memory(addr), addr, addr_type, val, store_num_elem)));\n@@ -935,1 +940,1 @@\n-      vload = gvn().transform(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, mem_num_elem, mem_elem_bt));\n+      vload = gvn().transform(trace_vector(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, mem_num_elem, mem_elem_bt)));\n@@ -941,1 +946,1 @@\n-        vload = gvn().transform(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, num_elem, T_BOOLEAN));\n+        vload = gvn().transform(trace_vector(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, num_elem, T_BOOLEAN)));\n@@ -944,1 +949,1 @@\n-        vload = gvn().transform(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, num_elem, elem_bt));\n+        vload = gvn().transform(trace_vector(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, num_elem, elem_bt)));\n@@ -1142,1 +1147,1 @@\n-    Node* vstore = gvn().transform(new StoreVectorMaskedNode(control(), memory(addr), addr, val, addr_type, mask));\n+    Node* vstore = gvn().transform(trace_vector(new StoreVectorMaskedNode(control(), memory(addr), addr, val, addr_type, mask)));\n@@ -1157,1 +1162,1 @@\n-      vload = gvn().transform(new LoadVectorMaskedNode(control(), memory(addr), addr, addr_type, vt, mask));\n+      vload = gvn().transform(trace_vector(new LoadVectorMaskedNode(control(), memory(addr), addr, addr_type, vt, mask)));\n@@ -1162,1 +1167,1 @@\n-      vload = gvn().transform(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, mem_num_elem, mem_elem_bt));\n+      vload = gvn().transform(trace_vector(LoadVectorNode::make(0, control(), memory(addr), addr, addr_type, mem_num_elem, mem_elem_bt)));\n@@ -1367,1 +1372,1 @@\n-      vstore = gvn().transform(new StoreVectorScatterMaskedNode(control(), memory(addr), addr, addr_type, val, indexes, mask));\n+      vstore = gvn().transform(trace_vector(new StoreVectorScatterMaskedNode(control(), memory(addr), addr, addr_type, val, indexes, mask)));\n@@ -1369,1 +1374,1 @@\n-      vstore = gvn().transform(new StoreVectorScatterNode(control(), memory(addr), addr, addr_type, val, indexes));\n+      vstore = gvn().transform(trace_vector(new StoreVectorScatterNode(control(), memory(addr), addr, addr_type, val, indexes)));\n@@ -1375,1 +1380,1 @@\n-      vload = gvn().transform(new LoadVectorGatherMaskedNode(control(), memory(addr), addr, addr_type, vector_type, indexes, mask));\n+      vload = gvn().transform(trace_vector(new LoadVectorGatherMaskedNode(control(), memory(addr), addr, addr_type, vector_type, indexes, mask)));\n@@ -1377,1 +1382,1 @@\n-      vload = gvn().transform(new LoadVectorGatherNode(control(), memory(addr), addr, addr_type, vector_type, indexes));\n+      vload = gvn().transform(trace_vector(new LoadVectorGatherNode(control(), memory(addr), addr, addr_type, vector_type, indexes)));\n@@ -1495,1 +1500,1 @@\n-  value = ReductionNode::make(opc, nullptr, init, value, elem_bt, \/* requires_strict_order *\/ false);\n+  value = trace_vector(ReductionNode::make(opc, nullptr, init, value, elem_bt, \/* requires_strict_order *\/ false));\n@@ -1587,1 +1592,1 @@\n-  Node* cmp = gvn().transform(new VectorTestNode(opd1, opd2, booltest));\n+  Node* cmp = gvn().transform(trace_vector(new VectorTestNode(opd1, opd2, booltest)));\n@@ -1655,1 +1660,1 @@\n-  Node* blend = gvn().transform(new VectorBlendNode(v1, v2, mask));\n+  Node* blend = gvn().transform(trace_vector(new VectorBlendNode(v1, v2, mask)));\n@@ -1750,0 +1755,1 @@\n+  trace_vector(operation);\n@@ -1889,0 +1895,1 @@\n+  trace_vector(rearrange);\n@@ -2036,0 +2043,1 @@\n+  trace_vector(rearrange);\n@@ -2195,0 +2203,1 @@\n+  trace_vector(operation);\n@@ -2357,1 +2366,1 @@\n-      op = gvn().transform(VectorCastNode::make(cast_vopc, op, elem_bt_to, num_elem_for_cast));\n+      op = gvn().transform(trace_vector(VectorCastNode::make(cast_vopc, op, elem_bt_to, num_elem_for_cast)));\n@@ -2378,1 +2387,1 @@\n-      op = gvn().transform(VectorCastNode::make(cast_vopc, op, elem_bt_to, num_elem_to));\n+      op = gvn().transform(trace_vector(VectorCastNode::make(cast_vopc, op, elem_bt_to, num_elem_to)));\n@@ -2387,1 +2396,1 @@\n-        op = gvn().transform(new VectorMaskCastNode(op, dst_type));\n+        op = gvn().transform(trace_vector(new VectorMaskCastNode(op, dst_type)));\n@@ -2391,1 +2400,1 @@\n-        op = gvn().transform(VectorCastNode::make(cast_vopc, op, elem_bt_to, num_elem_to));\n+        op = gvn().transform(trace_vector(VectorCastNode::make(cast_vopc, op, elem_bt_to, num_elem_to)));\n@@ -2396,1 +2405,1 @@\n-    op = gvn().transform(new VectorReinterpretNode(op, src_type, dst_type));\n+    op = gvn().transform(trace_vector(new VectorReinterpretNode(op, src_type, dst_type)));\n@@ -2481,1 +2490,1 @@\n-  Node* operation = gvn().transform(VectorInsertNode::make(opd, insert_val, idx->get_con(), gvn()));\n+  Node* operation = gvn().transform(trace_vector(VectorInsertNode::make(opd, insert_val, idx->get_con(), gvn())));\n@@ -2539,1 +2548,1 @@\n-      opd = gvn().transform(VectorStoreMaskNode::make(gvn(), opd, elem_bt, num_elem));\n+      opd = gvn().transform(trace_vector(VectorStoreMaskNode::make(gvn(), opd, elem_bt, num_elem)));\n@@ -2549,1 +2558,1 @@\n-        opd = gvn().transform(VectorStoreMaskNode::make(gvn(), opd, elem_bt, num_elem));\n+        opd = gvn().transform(trace_vector(VectorStoreMaskNode::make(gvn(), opd, elem_bt, num_elem)));\n@@ -2667,2 +2676,2 @@\n-  Node* p1 = phase.transform(new VectorRearrangeNode(src1, wrapped_index_vec));\n-  Node* p2 = phase.transform(new VectorRearrangeNode(src2, wrapped_index_vec));\n+  Node* p1 = phase.transform(trace_vector(new VectorRearrangeNode(src1, wrapped_index_vec)));\n+  Node* p2 = phase.transform(trace_vector(new VectorRearrangeNode(src2, wrapped_index_vec)));\n@@ -2786,1 +2795,1 @@\n-    operation = gvn().transform(VectorNode::make(Op_SelectFromTwoVector, opd1, opd2, opd3, vt));\n+    operation = gvn().transform(trace_vector(VectorNode::make(Op_SelectFromTwoVector, opd1, opd2, opd3, vt)));\n@@ -2871,1 +2880,1 @@\n-  Node* operation = gvn().transform(VectorNode::make(opc, opd1, mask, vt));\n+  Node* operation = gvn().transform(trace_vector(VectorNode::make(opc, opd1, mask, vt)));\n@@ -3004,1 +3013,1 @@\n-    index = gvn().transform(VectorNode::make(vmul_op, index, scale, vt));\n+    index = gvn().transform(trace_vector(VectorNode::make(vmul_op, index, scale, vt)));\n@@ -3009,1 +3018,1 @@\n-    index = gvn().transform(VectorNode::make(vadd_op, opd, index, vt));\n+    index = gvn().transform(trace_vector(VectorNode::make(vadd_op, opd, index, vt)));\n@@ -3126,1 +3135,1 @@\n-    mask = gvn().transform(new VectorMaskCmpNode(BoolTest::lt, iota, indexLimit, pred_node, vmask_type));\n+    mask = gvn().transform(trace_vector(new VectorMaskCmpNode(BoolTest::lt, iota, indexLimit, pred_node, vmask_type)));\n","filename":"src\/hotspot\/share\/opto\/vectorIntrinsics.cpp","additions":43,"deletions":34,"binary":false,"changes":77,"status":"modified"}]}