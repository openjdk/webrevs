{"files":[{"patch":"@@ -536,0 +536,17 @@\n+int G1BarrierSetC2::estimate_stub_size() const {\n+  Compile* const C = Compile::current();\n+  BufferBlob* const blob = C->output()->scratch_buffer_blob();\n+  GrowableArray<G1BarrierStubC2*>* const stubs = barrier_set_state()->stubs();\n+  int size = 0;\n+\n+  for (int i = 0; i < stubs->length(); i++) {\n+    CodeBuffer cb(blob->content_begin(), checked_cast<CodeBuffer::csize_t>((address)C->output()->scratch_locs_memory() - blob->content_begin()));\n+    MacroAssembler masm(&cb);\n+    stubs->at(i)->emit_code(masm);\n+    size += cb.insts_size();\n+  }\n+\n+  \/\/ Add slop to avoid expansion during emit_stubs.\n+  return size + PhaseOutput::MAX_inst_size;\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/c2\/g1BarrierSetC2.cpp","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -121,0 +121,1 @@\n+  virtual int estimate_stub_size() const;\n","filename":"src\/hotspot\/share\/gc\/g1\/c2\/g1BarrierSetC2.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1364,0 +1364,2 @@\n+  \/\/ Despite the name \"stub\", GC barrier stubs are emitted into\n+  \/\/ the insn section, and should be counted in code_req.\n@@ -1365,1 +1367,1 @@\n-  stub_req += bs->estimate_stub_size();\n+  code_req += bs->estimate_stub_size();\n","filename":"src\/hotspot\/share\/opto\/output.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"}]}