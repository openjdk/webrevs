{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,0 @@\n-#include \"runtime\/atomicAccess.hpp\"\n@@ -64,2 +63,2 @@\n-  AtomicAccess::add(&_num_segments, num, memory_order_relaxed);\n-  AtomicAccess::add(&_mem_size, mem_size, memory_order_relaxed);\n+  _num_segments.add_then_fetch(num, memory_order_relaxed);\n+  _mem_size.add_then_fetch(mem_size, memory_order_relaxed);\n@@ -70,1 +69,1 @@\n-                prefix, AtomicAccess::load(&_num_segments), AtomicAccess::load(&_mem_size));\n+                prefix, _num_segments.load_relaxed(), _mem_size.load_relaxed());\n@@ -78,2 +77,2 @@\n-  num_segments = AtomicAccess::load(&_num_segments);\n-  mem_size = AtomicAccess::load(&_mem_size);\n+  num_segments = _num_segments.load_relaxed();\n+  mem_size = _mem_size.load_relaxed();\n@@ -82,2 +81,2 @@\n-    AtomicAccess::sub(&_num_segments, num_segments, memory_order_relaxed);\n-    AtomicAccess::sub(&_mem_size, mem_size, memory_order_relaxed);\n+    _num_segments.sub_then_fetch(num_segments, memory_order_relaxed);\n+    _mem_size.sub_then_fetch(mem_size, memory_order_relaxed);\n@@ -99,2 +98,2 @@\n-  AtomicAccess::sub(&_num_segments, num_freed, memory_order_relaxed);\n-  AtomicAccess::sub(&_mem_size, mem_size_freed, memory_order_relaxed);\n+  _num_segments.sub_then_fetch(num_freed, memory_order_relaxed);\n+  _mem_size.sub_then_fetch(mem_size_freed, memory_order_relaxed);\n@@ -118,1 +117,1 @@\n-  Segment* old = AtomicAccess::cmpxchg(&_first, prev, next);\n+  Segment* old = _first.compare_exchange(prev, next);\n@@ -129,3 +128,3 @@\n-    AtomicAccess::inc(&_num_segments, memory_order_relaxed);\n-    AtomicAccess::add(&_mem_size, next->mem_size(), memory_order_relaxed);\n-    AtomicAccess::add(&_num_total_slots, next->num_slots(), memory_order_relaxed);\n+    _num_segments.add_then_fetch(1u, memory_order_relaxed);\n+    _mem_size.add_then_fetch(next->mem_size(), memory_order_relaxed);\n+    _num_total_slots.add_then_fetch(next->num_slots(), memory_order_relaxed);\n@@ -158,1 +157,1 @@\n-  Segment* cur = AtomicAccess::load_acquire(&_first);\n+  Segment* cur = _first.load_acquire();\n@@ -178,2 +177,2 @@\n-    assert(num_segments == _num_segments, \"Segment count inconsistent %u %u\", num_segments, _num_segments);\n-    assert(mem_size == _mem_size, \"Memory size inconsistent\");\n+    assert(num_segments == _num_segments.load_relaxed(), \"Segment count inconsistent %u %u\", num_segments, _num_segments.load_relaxed());\n+    assert(mem_size == _mem_size.load_relaxed(), \"Memory size inconsistent\");\n@@ -182,1 +181,1 @@\n-    _segment_free_list->bulk_add(*first, *_last, _num_segments, _mem_size);\n+    _segment_free_list->bulk_add(*first, *_last, _num_segments.load_relaxed(), _mem_size.load_relaxed());\n@@ -185,1 +184,1 @@\n-  _first = nullptr;\n+  _first.store_relaxed(nullptr);\n@@ -187,4 +186,4 @@\n-  _num_segments = 0;\n-  _mem_size = 0;\n-  _num_total_slots = 0;\n-  _num_allocated_slots = 0;\n+  _num_segments.store_relaxed(0);\n+  _mem_size.store_relaxed(0);\n+  _num_total_slots.store_relaxed(0);\n+  _num_allocated_slots.store_relaxed(0);\n@@ -196,1 +195,1 @@\n-  Segment* cur = AtomicAccess::load_acquire(&_first);\n+  Segment* cur = _first.load_acquire();\n@@ -204,1 +203,1 @@\n-      AtomicAccess::inc(&_num_allocated_slots, memory_order_relaxed);\n+      _num_allocated_slots.add_then_fetch(1u, memory_order_relaxed);\n@@ -216,1 +215,1 @@\n-  return AtomicAccess::load(&_num_segments);\n+  return _num_segments.load_relaxed();\n@@ -241,1 +240,1 @@\n-  Segment* cur = AtomicAccess::load_acquire(&_first);\n+  Segment* cur = _first.load_acquire();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1MonotonicArena.cpp","additions":27,"deletions":28,"binary":false,"changes":55,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -68,4 +69,4 @@\n-  Segment* volatile _first;       \/\/ The (start of the) list of all segments.\n-  Segment* _last;                 \/\/ The last segment of the list of all segments.\n-  volatile uint _num_segments;    \/\/ Number of assigned segments to this allocator.\n-  volatile size_t _mem_size;      \/\/ Memory used by all segments.\n+  Atomic<Segment*> _first;       \/\/ The (start of the) list of all segments.\n+  Segment* _last;                \/\/ The last segment of the list of all segments.\n+  Atomic<uint> _num_segments;    \/\/ Number of assigned segments to this allocator.\n+  Atomic<size_t> _mem_size;      \/\/ Memory used by all segments.\n@@ -76,2 +77,2 @@\n-  volatile uint _num_total_slots; \/\/ Number of slots available in all segments (allocated + not yet used).\n-  volatile uint _num_allocated_slots; \/\/ Number of total slots allocated ever (including free and pending).\n+  Atomic<uint> _num_total_slots; \/\/ Number of slots available in all segments (allocated + not yet used).\n+  Atomic<uint> _num_allocated_slots; \/\/ Number of total slots allocated ever (including free and pending).\n@@ -84,1 +85,1 @@\n-  const Segment* first_segment() const { return AtomicAccess::load(&_first); }\n+  const Segment* first_segment() const { return _first.load_relaxed(); }\n@@ -86,1 +87,1 @@\n-  uint num_total_slots() const { return AtomicAccess::load(&_num_total_slots); }\n+  uint num_total_slots() const { return _num_total_slots.load_relaxed(); }\n@@ -88,1 +89,1 @@\n-    uint allocated = AtomicAccess::load(&_num_allocated_slots);\n+    uint allocated = _num_allocated_slots.load_relaxed();\n@@ -119,1 +120,1 @@\n-  Segment* volatile _next;\n+  Atomic<Segment*> _next;\n@@ -123,1 +124,1 @@\n-  uint volatile _next_allocate;\n+  Atomic<uint> _next_allocate;\n@@ -142,1 +143,1 @@\n-  Segment* volatile* next_addr() { return &_next; }\n+  Atomic<Segment*>* next_addr() { return &_next; }\n@@ -148,1 +149,1 @@\n-  Segment* next() const { return _next; }\n+  Segment* next() const { return _next.load_relaxed(); }\n@@ -152,1 +153,1 @@\n-    _next = next;\n+    _next.store_relaxed(next);\n@@ -156,1 +157,1 @@\n-    _next_allocate = 0;\n+    _next_allocate.store_relaxed(0);\n@@ -169,1 +170,1 @@\n-    return MIN2(_next_allocate, _num_slots);\n+    return MIN2(_next_allocate.load_relaxed(), _num_slots);\n@@ -179,1 +180,1 @@\n-  bool is_full() const { return _next_allocate >= _num_slots; }\n+  bool is_full() const { return _next_allocate.load_relaxed() >= _num_slots; }\n@@ -189,1 +190,1 @@\n-  static Segment* volatile* next_ptr(Segment& segment) {\n+  static Atomic<Segment*>* next_ptr(Segment& segment) {\n@@ -196,2 +197,2 @@\n-  volatile size_t _num_segments;\n-  volatile size_t _mem_size;\n+  Atomic<size_t> _num_segments;\n+  Atomic<size_t> _mem_size;\n@@ -213,2 +214,2 @@\n-  size_t num_segments() const { return AtomicAccess::load(&_num_segments); }\n-  size_t mem_size() const { return AtomicAccess::load(&_mem_size); }\n+  size_t num_segments() const { return _num_segments.load_relaxed(); }\n+  size_t mem_size() const { return _mem_size.load_relaxed(); }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1MonotonicArena.hpp","additions":24,"deletions":23,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,0 @@\n-#include \"runtime\/atomicAccess.hpp\"\n@@ -35,1 +34,1 @@\n-  if (_next_allocate >= _num_slots) {\n+  if (_next_allocate.load_relaxed() >= _num_slots) {\n@@ -38,1 +37,1 @@\n-  uint result = AtomicAccess::fetch_then_add(&_next_allocate, 1u, memory_order_relaxed);\n+  uint result = _next_allocate.fetch_then_add(1u, memory_order_relaxed);\n@@ -51,2 +50,2 @@\n-    AtomicAccess::dec(&_num_segments, memory_order_relaxed);\n-    AtomicAccess::sub(&_mem_size, result->mem_size(), memory_order_relaxed);\n+    _num_segments.sub_then_fetch(1u, memory_order_relaxed);\n+    _mem_size.sub_then_fetch(result->mem_size(), memory_order_relaxed);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1MonotonicArena.inline.hpp","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"}]}