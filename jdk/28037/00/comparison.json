{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,3 @@\n+import java.util.Collections;\n+import java.util.IdentityHashMap;\n+import java.util.Set;\n@@ -338,1 +341,6 @@\n-        throw asRunException(cause);\n+        \/\/ Guard against recursive cause chains by\n+        \/\/ using a Set with identity equality semantics.\n+        Set<Throwable> dejaVu = Collections.newSetFromMap(new IdentityHashMap<>());\n+        dejaVu.add(cause);\n+\n+        throw asRunException(cause, dejaVu);\n@@ -341,1 +349,1 @@\n-    private RunException asRunException(Throwable ex) {\n+    private RunException asRunException(Throwable ex, Set<Throwable> dejaVu) {\n@@ -350,1 +358,8 @@\n-            ue.initCause(cause == null ? null : asRunException(cause));\n+            if (cause != null) {\n+                Throwable throwable = dejaVu.add(cause)\n+                        ? asRunException(cause, dejaVu)\n+                        : new UserException(\"CIRCULAR REFERENCE!\",\n+                            cause.getClass().getName(),\n+                            cause.getStackTrace());\n+                ue.initCause(throwable);\n+            }\n","filename":"src\/jdk.jshell\/share\/classes\/jdk\/jshell\/execution\/DirectExecutionControl.java","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n- * @bug 8198801 8212167 8210527\n+ * @bug 8198801 8212167 8210527 8370175\n@@ -323,0 +323,10 @@\n+    @Test\n+    public void recursiveCauses() {\n+        assertEval(\"var one = new Throwable();\");\n+        assertEval(\"var two = new Error();\");\n+        assertEval(\"one.initCause(two);\");\n+        assertEval(\"two.initCause(one);\");\n+        assertExecuteException(\"throw one;\", Throwable.class);\n+        assertExecuteException(\"throw two;\", Error.class);\n+    }\n+\n","filename":"test\/langtools\/jdk\/jshell\/ExceptionsTest.java","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"}]}