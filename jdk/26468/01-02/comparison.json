{"files":[{"patch":"@@ -155,1 +155,1 @@\n-void Jfr::on_vm_shutdown(bool emit_old_object_samples, bool halt) {\n+void Jfr::on_vm_shutdown(bool emit_old_object_samples, bool emit_event_shutdown, bool halt) {\n@@ -157,1 +157,1 @@\n-    JfrEmergencyDump::on_vm_shutdown(emit_old_object_samples);\n+    JfrEmergencyDump::on_vm_shutdown(emit_old_object_samples, emit_event_shutdown);\n","filename":"src\/hotspot\/share\/jfr\/jfr.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -73,1 +73,1 @@\n-  static void on_vm_shutdown(bool emit_old_object_samples = true, bool halt = false);\n+  static void on_vm_shutdown(bool emit_old_object_samples, bool emit_event_shutdown, bool halt = false);\n","filename":"src\/hotspot\/share\/jfr\/jfr.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -559,1 +559,1 @@\n-static void post_events(bool emit_old_object_samples, Thread* thread) {\n+static void post_events(bool emit_old_object_samples, bool emit_event_shutdown, Thread* thread) {\n@@ -562,1 +562,2 @@\n-  } else {\n+  }\n+  if (emit_event_shutdown) {\n@@ -573,1 +574,1 @@\n-void JfrEmergencyDump::on_vm_shutdown(bool emit_old_object_samples) {\n+void JfrEmergencyDump::on_vm_shutdown(bool emit_old_object_samples, bool emit_event_shutdown) {\n@@ -586,1 +587,1 @@\n-  post_events(emit_old_object_samples, thread);\n+  post_events(emit_old_object_samples, emit_event_shutdown, thread);\n","filename":"src\/hotspot\/share\/jfr\/recorder\/repository\/jfrEmergencyDump.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-  static void on_vm_shutdown(bool emit_old_object_samples);\n+  static void on_vm_shutdown(bool emit_old_object_samples, bool emit_event_shutdown);\n","filename":"src\/hotspot\/share\/jfr\/recorder\/repository\/jfrEmergencyDump.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -466,1 +466,4 @@\n-  JFR_ONLY(Jfr::on_vm_shutdown(true, halt);)\n+  \/\/ 2nd argument (emit_event_shutdown) should be set to false\n+  \/\/ because EventShutdown would be emitted at Threads::destroy_vm().\n+  \/\/ (one of the callers of before_exit())\n+  JFR_ONLY(Jfr::on_vm_shutdown(true, false, halt);)\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1859,1 +1859,1 @@\n-  JFR_ONLY(Jfr::on_vm_shutdown(static_cast<VMErrorType>(_id) == OOM_JAVA_HEAP_FATAL);)\n+  JFR_ONLY(Jfr::on_vm_shutdown(static_cast<VMErrorType>(_id) == OOM_JAVA_HEAP_FATAL, true);)\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}