{"files":[{"patch":"@@ -60,6 +60,0 @@\n-    enum Expected {\n-        PASS,\n-        NSAE,\n-        NSAE_OR_NSPE \/\/ depends on provider registration\n-    }\n-\n@@ -76,14 +70,11 @@\n-        checkTransformation(\"ChaCha20\", Expected.PASS);\n-        checkTransformation(\"ChaCha20\/None\/NoPadding\", Expected.PASS);\n-        checkTransformation(\"ChaCha20-Poly1305\", Expected.PASS);\n-        checkTransformation(\"ChaCha20-Poly1305\/None\/NoPadding\", Expected.PASS);\n-\n-        checkTransformation(\"ChaCha20-Poly1305\/BAD_MODE\/NoPadding\", Expected.NSAE);\n-        checkTransformation(\"ChaCha20-Poly1305\/BAD_MODE\/PKCS5Padding\", Expected.NSAE);\n-\n-        checkTransformation(\"ChaCha20\/ECB\/NoPadding\", Expected.NSAE_OR_NSPE);\n-        checkTransformation(\"ChaCha20\/None\/PKCS5Padding\", Expected.NSAE_OR_NSPE);\n-        checkTransformation(\"ChaCha20-Poly1305\/ECB\/NoPadding\",\n-                Expected.NSAE_OR_NSPE);\n-        checkTransformation(\"ChaCha20-Poly1305\/None\/PKCS5Padding\",\n-                Expected.NSAE_OR_NSPE);\n+        Class NSAE = NoSuchAlgorithmException.class;\n+        Class NSPE = NoSuchPaddingException.class;\n+\n+        checkTransformation(\"ChaCha20\", null);\n+        checkTransformation(\"ChaCha20\/None\/NoPadding\", null);\n+        checkTransformation(\"ChaCha20-Poly1305\", null);\n+        checkTransformation(\"ChaCha20-Poly1305\/None\/NoPadding\", null);\n+        checkTransformation(\"ChaCha20\/ECB\/NoPadding\", NSAE);\n+        checkTransformation(\"ChaCha20\/None\/PKCS5Padding\", NSPE);\n+        checkTransformation(\"ChaCha20-Poly1305\/ECB\/NoPadding\", NSAE);\n+        checkTransformation(\"ChaCha20-Poly1305\/None\/PKCS5Padding\", NSPE);\n@@ -92,1 +83,1 @@\n-    private static void checkTransformation(String transformation, Expected e)\n+    private static void checkTransformation(String transformation, Class exCls)\n@@ -95,10 +86,5 @@\n-            Cipher.getInstance(transformation);\n-            if (e == Expected.PASS) {\n-                System.out.println(\"Expected PASS: \" + transformation);\n-            } else {\n-                throw new RuntimeException(\n-                        \"Unexpected PASS for \" + transformation);\n-            }\n-        } catch (NoSuchAlgorithmException nsae) {\n-            if (e == Expected.NSAE || e == Expected.NSAE_OR_NSPE) {\n-                System.out.println(\"Expected NSAE: \" + transformation);\n+            Cipher.getInstance(transformation,\n+                    System.getProperty(\"test.provider.name\", \"SunJCE\"));\n+            if (exCls != null) {\n+                throw new RuntimeException(\"Expected Exception not thrown: \" +\n+                        exCls);\n@@ -106,2 +92,1 @@\n-                throw new RuntimeException(\"Unexpected NSAE for \" +\n-                        transformation);\n+                System.out.println(transformation + \": pass\");\n@@ -109,3 +94,3 @@\n-        } catch (NoSuchPaddingException nspe) {\n-            if (e == Expected.NSAE_OR_NSPE) {\n-                System.out.println(\"Expected NSPE: \" + transformation);\n+        } catch (NoSuchAlgorithmException | NoSuchPaddingException e) {\n+            if (e.getClass() != exCls) {\n+                throw new RuntimeException(\"Unexpected Exception\", e);\n@@ -113,2 +98,2 @@\n-                throw new RuntimeException(\"Unexpected NSPE for \" +\n-                        transformation);\n+                System.out.println(transformation + \": got expected \" +\n+                        exCls.getName());\n","filename":"test\/jdk\/com\/sun\/crypto\/provider\/Cipher\/ChaCha20\/unittest\/ChaCha20CipherUnitTest.java","additions":23,"deletions":38,"binary":false,"changes":61,"status":"modified"}]}