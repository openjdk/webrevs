{"files":[{"patch":"@@ -560,4 +560,0 @@\n-        } else {\n-            throw new NoSuchAlgorithmException\n-                    (\"Cannot find any provider supporting \" + transformation,\n-                    failure);\n@@ -565,0 +561,3 @@\n+        throw new NoSuchAlgorithmException\n+                (\"Cannot find any provider supporting \" + transformation,\n+                failure);\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/Cipher.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -60,0 +60,6 @@\n+    enum Expected {\n+        PASS,\n+        NSAE,\n+        NSAE_OR_NSPE \/\/ depends on provider registration\n+    }\n+\n@@ -70,4 +76,7 @@\n-        checkTransformation(\"ChaCha20\", true);\n-        checkTransformation(\"ChaCha20\/None\/NoPadding\", true);\n-        checkTransformation(\"ChaCha20-Poly1305\", true);\n-        checkTransformation(\"ChaCha20-Poly1305\/None\/NoPadding\", true);\n+        checkTransformation(\"ChaCha20\", Expected.PASS);\n+        checkTransformation(\"ChaCha20\/None\/NoPadding\", Expected.PASS);\n+        checkTransformation(\"ChaCha20-Poly1305\", Expected.PASS);\n+        checkTransformation(\"ChaCha20-Poly1305\/None\/NoPadding\", Expected.PASS);\n+\n+        checkTransformation(\"ChaCha20-Poly1305\/BAD_MODE\/NoPadding\", Expected.NSAE);\n+        checkTransformation(\"ChaCha20-Poly1305\/BAD_MODE\/PKCS5Padding\", Expected.NSAE);\n@@ -75,4 +84,6 @@\n-        checkTransformation(\"ChaCha20\/ECB\/NoPadding\", false);\n-        checkTransformation(\"ChaCha20\/None\/PKCS5Padding\", false);\n-        checkTransformation(\"ChaCha20-Poly1305\/ECB\/NoPadding\", false);\n-        checkTransformation(\"ChaCha20-Poly1305\/None\/PKCS5Padding\", false);\n+        checkTransformation(\"ChaCha20\/ECB\/NoPadding\", Expected.NSAE_OR_NSPE);\n+        checkTransformation(\"ChaCha20\/None\/PKCS5Padding\", Expected.NSAE_OR_NSPE);\n+        checkTransformation(\"ChaCha20-Poly1305\/ECB\/NoPadding\",\n+                Expected.NSAE_OR_NSPE);\n+        checkTransformation(\"ChaCha20-Poly1305\/None\/PKCS5Padding\",\n+                Expected.NSAE_OR_NSPE);\n@@ -81,2 +92,2 @@\n-    private static void checkTransformation(String transformation,\n-            boolean expected) throws Exception {\n+    private static void checkTransformation(String transformation, Expected e)\n+            throws Exception {\n@@ -85,1 +96,3 @@\n-            if (!expected) {\n+            if (e == Expected.PASS) {\n+                System.out.println(\"Expected PASS: \" + transformation);\n+            } else {\n@@ -87,1 +100,5 @@\n-                        \"Unexpected transformation: \" + transformation);\n+                        \"Unexpected PASS for \" + transformation);\n+            }\n+        } catch (NoSuchAlgorithmException nsae) {\n+            if (e == Expected.NSAE || e == Expected.NSAE_OR_NSPE) {\n+                System.out.println(\"Expected NSAE: \" + transformation);\n@@ -89,1 +106,2 @@\n-                System.out.println(\"Expected transformation: \" + transformation);\n+                throw new RuntimeException(\"Unexpected NSAE for \" +\n+                        transformation);\n@@ -91,3 +109,3 @@\n-        } catch (NoSuchAlgorithmException | NoSuchPaddingException e) {\n-            if (!expected) {\n-                System.out.println(\"Unexpected transformation: \" + transformation);\n+        } catch (NoSuchPaddingException nspe) {\n+            if (e == Expected.NSAE_OR_NSPE) {\n+                System.out.println(\"Expected NSPE: \" + transformation);\n@@ -95,1 +113,2 @@\n-                throw new RuntimeException(\"Unexpected fail: \" + transformation, e);\n+                throw new RuntimeException(\"Unexpected NSPE for \" +\n+                        transformation);\n","filename":"test\/jdk\/com\/sun\/crypto\/provider\/Cipher\/ChaCha20\/unittest\/ChaCha20CipherUnitTest.java","additions":36,"deletions":17,"binary":false,"changes":53,"status":"modified"}]}