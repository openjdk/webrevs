{"files":[{"patch":"@@ -92,1 +92,1 @@\n-    static String nss_library = \"softokn3\";\n+    static String nss_library = System.getProperty(\"CUSTOM_P11_LIBRARY_NAME\", \"softokn3\");\n@@ -457,0 +457,48 @@\n+    \/**\n+     * Return the full path of a configuration file that will be used\n+     * to configure the PKCS11 provider.\n+     *\n+     * By default, the directory is that returned by copyNssFiles,\n+     * \".\/nss\", and the file is \"p11-nss.txt\", resulting in the full\n+     * path \".\/nss\/p11-nss.txt\".\n+     *\n+     * This value can be adjusted using the following system\n+     * properties:\n+     *\n+     * CUSTOM_P11_CONFIG_NAME: The name of a custom configuration\n+     * file; overrides the default \"p11-nss.txt\".\n+     *\n+     * CUSTOM_P11_CONFIG: The absolute path of a custom configuration\n+     * file; overrides the default \".\/nss\/p11-nss.txt\".  Takes\n+     * precedence over CUSTOM_P11_CONFIG_NAME if both are specified.\n+     *\n+     * CUSTOM_P11_CONFIG_VARIANT: The variant of the base\n+     * configuration file name to use.\n+     *\n+     * A hyphen followed by the CUSTOM_P11_CONFIG_VARIANT string will\n+     * be inserted before the \".\" in the file extension, or appended\n+     * to the file name if it is extensionless.\n+     *\n+     * Providers can have related configurations with multiple\n+     * variants, for example, p11-nss.txt and p11-nss-sensitive.txt.\n+     * The CUSTOM_P11_CONFIG_VARIANT property allows test authors to\n+     * select in which of the related configurations the provider\n+     * should run.\n+     *\n+     * For example, setting -DCUSTOM_P11_CONFIG_VARIANT=sensitive,\n+     * (and no other CUSTOM_P11_CONFIG_* properties), will cause this\n+     * method to return \".\/nss\/p11-nss-sensitive.txt\".\n+     *\n+     * CUSTOM_P11_CONFIG and CUSTOM_P11_CONFIG_NAME are also\n+     * influenced by CUSTOM_P11_CONFIG_VARIANT.  For example the\n+     * settings \"-DCUSTOM_P11_CONFIG=\/tmp\/p11-nss.txt\n+     * -DCUSTOM_P11_CONFIG_VARIANT=sensitive\" will cause this method\n+     * to return \"\/tmp\/p11-nss-sensitive.txt\".\n+     *\n+     * CUSTOM_P11_CONFIG_VARIANT is primarily meant to be set in test\n+     * case @run arguments.  The test can then specify whether it\n+     * needs the provider to be configured with a specific variant,\n+     * while still allowing the user of the test suite to specify a\n+     * custom set of configuration file variants by setting\n+     * CUSTOM_P11_CONFIG on the jtreg command line.\n+     *\/\n@@ -458,1 +506,0 @@\n-        nss_library = System.getProperty(\"CUSTOM_P11_LIBRARY_NAME\", nss_library);\n@@ -487,1 +534,6 @@\n-            \/\/ Change, e.g., ...\/p11-nss.txt to ...\/p11-nss-sensitive.txt.\n+            \/\/ If the file name has an extension, prepend\n+            \/\/ -{CUSTOM_P11_CONFIG_VARIANT} before its \".\"; for\n+            \/\/ example, ...\/p11-nss.txt becomes\n+            \/\/ ...\/p11-nss-sensitive.txt.  If the file name has no\n+            \/\/ extension, append -{CUSTOM_P11_CONFIG_VARIANT}; for\n+            \/\/ example: ...\/p11-nss becomes ...\/p11-nss-sensitive.\n@@ -491,0 +543,4 @@\n+        if (!new File(configFilePath).exists()) {\n+            throw new RuntimeException(\"Configuration file does not exist: \"\n+                                       + configFilePath);\n+        }\n","filename":"test\/jdk\/sun\/security\/pkcs11\/PKCS11Test.java","additions":59,"deletions":3,"binary":false,"changes":62,"status":"modified"}]}