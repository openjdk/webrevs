{"files":[{"patch":"@@ -72,4 +72,0 @@\n-        \/\/ Sleep to give LingeredApp an opportunity to reach attachable status\n-        Thread.sleep(1000);\n-        int exitValue = run(pb);\n-\n@@ -77,17 +73,8 @@\n-\tif (KELVIN_DEBUG) {\n-            String stdout = read(out);\n-            String stderr = read(err);\n-\t    System.out.println(\"\");\n-            System.out.println(\"Stdout is: \");\n-            System.out.print(stdout);\n-            System.out.println(\"\");\n-            System.out.println(\"Stderr is: \");\n-            System.out.print(stderr);\n-\n-\t    if (exitValue != 0) {\n-                throw new Exception(\"jmap -heap exited with error code: \" + exitValue);\n-            }\n-\n-            output = new OutputAnalyzer(stdout);\n-\t} else {\n-            output = new OutputAnalyzer(read(out));\n+        \/\/ If we attempt to attach to LingeredApp before it has initialized, the heap dump request will fail, so we allow 3 retries\n+        int allowed_retries = 3;\n+        int exitValue;\n+        do {\n+            exitValue = run(pb);\n+        } while ((exitValue != 0) && (allowed_retries-- > 0));\n+        if (exitValue != 0) {\n+            throw new Exception(\"jmap -heap exited with error code: \" + exitValue);\n@@ -95,0 +82,1 @@\n+        output = new OutputAnalyzer(read(out));\n@@ -103,5 +91,1 @@\n-        int exitValue = output.getExitValue();\n-        if (!KELVIN_DEBUG && (exitValue != 0)) {\n-            throw new Exception(\"jmap -heap exited with error code: \" + exitValue);\n-        }\n-        return exitValue;\n+        return output.getExitValue();\n","filename":"test\/hotspot\/jtreg\/gc\/metaspace\/CompressedClassSpaceSizeInJmapHeap.java","additions":10,"deletions":26,"binary":false,"changes":36,"status":"modified"}]}