{"files":[{"patch":"@@ -183,2 +183,5 @@\n-void AOTLinkedClassBulkLoader::link_or_init_javabase_classes(TRAPS) {\n-  link_or_init_classes_for_loader(Handle(), AOTLinkedClassTable::get()->boot1(), CHECK);\n+void AOTLinkedClassBulkLoader::link_or_init_javabase_classes(JavaThread* current) {\n+  link_or_init_classes_for_loader(Handle(), AOTLinkedClassTable::get()->boot1(), current);\n+  if (current->has_pending_exception()) {\n+    exit_on_exception(current);\n+  }\n@@ -190,2 +193,0 @@\n-    \/\/ We cannot continue, as we might have loaded some of the aot-linked classes, which\n-    \/\/ may have dangling C++ pointers to other aot-linked classes that we have failed to load.\n@@ -229,0 +230,11 @@\n+\/\/ For the AOT cache to function properly, all classes in the AOTLinkedClassTable\n+\/\/ must be loaded and linked. In addition, AOT-initialized classes must be moved to\n+\/\/ the initialized state.\n+\/\/\n+\/\/ We can encounter a failure during the loading, linking, or initialization of\n+\/\/ classes in the AOTLinkedClassTable only if:\n+\/\/   - We ran out of memory,\n+\/\/   - There is a serious error in the VM implemenation\n+\/\/ When this happens, the VM may be in an inconsistent state (e.g., we have a cached\n+\/\/ heap object of class X, but X is not linked). We must exit the JVM now.\n+\n","filename":"src\/hotspot\/share\/cds\/aotLinkedClassBulkLoader.cpp","additions":16,"deletions":4,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -73,1 +73,1 @@\n-  static void link_or_init_javabase_classes(TRAPS) NOT_CDS_RETURN;\n+  static void link_or_init_javabase_classes(JavaThread* current) NOT_CDS_RETURN;\n","filename":"src\/hotspot\/share\/cds\/aotLinkedClassBulkLoader.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -775,1 +775,1 @@\n-    AOTLinkedClassBulkLoader::link_or_init_javabase_classes(CHECK_JNI_ERR);\n+    AOTLinkedClassBulkLoader::link_or_init_javabase_classes(THREAD);\n","filename":"src\/hotspot\/share\/runtime\/threads.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}