{"files":[{"patch":"@@ -826,0 +826,4 @@\n+                        Paper paper = pageFormat.getPaper();\n+                        double width = Math.rint(paper.getWidth());\n+                        double height = Math.rint(paper.getHeight());\n+                        setGraphicsConfigInfo(((Graphics2D)graphics).getTransform(), width, height);\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/CPrinterJob.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -267,1 +267,1 @@\n-   private double yres = PS_XRES;\n+   private double yres = PS_YRES;\n","filename":"src\/java.desktop\/share\/classes\/sun\/print\/PSPrinterJob.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2095,1 +2095,1 @@\n-    synchronized void setGraphicsConfigInfo(AffineTransform at,\n+    synchronized protected void setGraphicsConfigInfo(AffineTransform at,\n","filename":"src\/java.desktop\/share\/classes\/sun\/print\/RasterPrinterJob.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 4276227\n+ * @bug 4276227 8320443\n@@ -29,1 +29,1 @@\n- * @author prr\n+ * @key printer\n@@ -33,6 +33,15 @@\n-import java.awt.*;\n-import java.awt.geom.*;\n-import java.awt.print.*;\n-import java.io.*;\n-import javax.print.attribute.*;\n-import javax.print.attribute.standard.*;\n+import java.io.File;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.GraphicsConfiguration;\n+import java.awt.GraphicsDevice;\n+import java.awt.Rectangle;\n+import java.awt.geom.AffineTransform;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n+import javax.print.attribute.HashPrintRequestAttributeSet;\n+import javax.print.attribute.PrintRequestAttributeSet;\n+import javax.print.attribute.standard.Destination;\n+import javax.print.attribute.standard.OrientationRequested;\n@@ -42,0 +51,2 @@\n+    static volatile boolean failed = false;\n+\n@@ -57,0 +68,3 @@\n+        if (failed) {\n+            throw new RuntimeException(\"Test failed but no exception propagated.\");\n+        }\n@@ -60,11 +74,3 @@\n-         if (pageIndex > 0 ) {\n-             return Printable.NO_SUCH_PAGE;\n-         }\n-\n-         \/* Make sure calls to get DeviceConfig, its transforms,\n-          * etc all work without exceptions and as expected *\/\n-         Graphics2D g2 = (Graphics2D)g;\n-         GraphicsConfiguration gConfig = g2.getDeviceConfiguration();\n-         AffineTransform dt = gConfig.getDefaultTransform();\n-         AffineTransform nt = gConfig.getNormalizingTransform();\n-         AffineTransform gt = g2.getTransform();\n+        if (pageIndex > 0) {\n+            return Printable.NO_SUCH_PAGE;\n+        }\n@@ -72,3 +78,19 @@\n-         System.out.println(\"Graphics2D transform = \" + gt);\n-         System.out.println(\"Default transform = \" + dt);\n-         System.out.println(\"Normalizing transform = \" + nt);\n+        Graphics2D g2 = (Graphics2D)g;\n+        GraphicsConfiguration gConfig = g2.getDeviceConfiguration();\n+        AffineTransform nt = null;\n+        try {\n+            \/* Make sure calls to get DeviceConfig, its transforms,\n+             * etc all work without exceptions and as expected *\/\n+            System.out.println(\"GraphicsConfig=\"+gConfig);\n+            AffineTransform dt = gConfig.getDefaultTransform();\n+            System.out.println(\"Default transform = \" + dt);\n+            nt = gConfig.getNormalizingTransform();\n+            System.out.println(\"Normalizing transform = \" + nt);\n+            AffineTransform gt = g2.getTransform();\n+            System.out.println(\"Graphics2D transform = \" + gt);\n+        } catch (Exception e) {\n+            failed = true;\n+            System.err.println(\"Unexpected exception getting transform.\");\n+            e.printStackTrace();\n+            throw e;\n+        }\n@@ -76,5 +98,6 @@\n-         Rectangle bounds = gConfig.getBounds();\n-         System.out.println(\"Bounds = \" + bounds);\n-         if (!nt.isIdentity()) {\n-             throw new RuntimeException(\"Expected Identity transdform\");\n-         }\n+        Rectangle bounds = gConfig.getBounds();\n+        System.out.println(\"Bounds = \" + bounds);\n+        if (!nt.isIdentity()) {\n+            failed = true;\n+            throw new RuntimeException(\"Expected Identity transform\");\n+        }\n@@ -82,9 +105,10 @@\n-         \/* Make sure that device really is TYPE_PRINTER *\/\n-         GraphicsDevice gd = gConfig.getDevice();\n-         System.out.println(\"Printer Device ID = \" + gd.getIDstring());\n-         if (!(gd.getType() == GraphicsDevice.TYPE_PRINTER)) {\n-             throw new RuntimeException(\"Expected printer device\");\n-         }\n-         System.out.println(\" *** \");\n-         System.out.println(\"\");\n-         return Printable.PAGE_EXISTS;\n+        \/* Make sure that device really is TYPE_PRINTER *\/\n+        GraphicsDevice gd = gConfig.getDevice();\n+        System.out.println(\"Printer Device ID = \" + gd.getIDstring());\n+        if (!(gd.getType() == GraphicsDevice.TYPE_PRINTER)) {\n+            failed = true;\n+            throw new RuntimeException(\"Expected printer device\");\n+        }\n+        System.out.println(\" *** \");\n+        System.out.println(\"\");\n+        return Printable.PAGE_EXISTS;\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/PrinterDevice.java","additions":60,"deletions":36,"binary":false,"changes":96,"status":"modified"}]}