{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,11 @@\n+void G1EvacStats::reset() {\n+  PLABStats::reset();\n+  _region_end_waste.store_relaxed(0);\n+  _regions_filled.store_relaxed(0);\n+  _num_plab_filled.store_relaxed(0);\n+  _direct_allocated.store_relaxed(0);\n+  _num_direct_allocated.store_relaxed(0);\n+  _failure_used.store_relaxed(0);\n+  _failure_waste.store_relaxed(0);\n+}\n+\n@@ -54,7 +65,7 @@\n-                      _region_end_waste * HeapWordSize,\n-                      _regions_filled,\n-                      _num_plab_filled,\n-                      _direct_allocated * HeapWordSize,\n-                      _num_direct_allocated,\n-                      _failure_used * HeapWordSize,\n-                      _failure_waste * HeapWordSize);\n+                      region_end_waste() * HeapWordSize,\n+                      regions_filled(),\n+                      num_plab_filled(),\n+                      direct_allocated() * HeapWordSize,\n+                      num_direct_allocated(),\n+                      failure_used() * HeapWordSize,\n+                      failure_waste() * HeapWordSize);\n@@ -112,1 +123,1 @@\n-  size_t const used_for_waste_calculation = used() > _region_end_waste ? used() - _region_end_waste : 0;\n+  size_t const used_for_waste_calculation = used() > region_end_waste() ? used() - region_end_waste() : 0;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1EvacStats.cpp","additions":20,"deletions":9,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -39,5 +40,5 @@\n-  size_t _region_end_waste; \/\/ Number of words wasted due to skipping to the next region.\n-  uint   _regions_filled;   \/\/ Number of regions filled completely.\n-  size_t _num_plab_filled; \/\/ Number of PLABs filled and retired.\n-  size_t _direct_allocated; \/\/ Number of words allocated directly into the regions.\n-  size_t _num_direct_allocated; \/\/ Number of direct allocation attempts.\n+  Atomic<size_t> _region_end_waste; \/\/ Number of words wasted due to skipping to the next region.\n+  Atomic<uint>   _regions_filled;   \/\/ Number of regions filled completely.\n+  Atomic<size_t> _num_plab_filled; \/\/ Number of PLABs filled and retired.\n+  Atomic<size_t> _direct_allocated; \/\/ Number of words allocated directly into the regions.\n+  Atomic<size_t> _num_direct_allocated; \/\/ Number of direct allocation attempts.\n@@ -47,1 +48,1 @@\n-  size_t _failure_used;\n+  Atomic<size_t> _failure_used;\n@@ -51,1 +52,1 @@\n-  size_t _failure_waste;\n+  Atomic<size_t> _failure_waste;\n@@ -53,10 +54,1 @@\n-  virtual void reset() {\n-    PLABStats::reset();\n-    _region_end_waste = 0;\n-    _regions_filled = 0;\n-    _num_plab_filled = 0;\n-    _direct_allocated = 0;\n-    _num_direct_allocated = 0;\n-    _failure_used = 0;\n-    _failure_waste = 0;\n-  }\n+  virtual void reset();\n@@ -80,5 +72,5 @@\n-  uint regions_filled() const { return _regions_filled; }\n-  size_t num_plab_filled() const { return _num_plab_filled; }\n-  size_t region_end_waste() const { return _region_end_waste; }\n-  size_t direct_allocated() const { return _direct_allocated; }\n-  size_t num_direct_allocated() const { return _num_direct_allocated; }\n+  uint regions_filled() const;\n+  size_t num_plab_filled() const;\n+  size_t region_end_waste() const;\n+  size_t direct_allocated() const;\n+  size_t num_direct_allocated() const;\n@@ -87,1 +79,1 @@\n-  size_t failure_used() const { return _failure_used; }\n+  size_t failure_used() const;\n@@ -89,1 +81,1 @@\n-  size_t failure_waste() const { return _failure_waste; }\n+  size_t failure_waste() const;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1EvacStats.hpp","additions":17,"deletions":25,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,13 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+inline uint G1EvacStats::regions_filled() const { return _regions_filled.load_relaxed(); }\n+\n+inline size_t G1EvacStats::num_plab_filled() const { return _num_plab_filled.load_relaxed(); }\n+\n+inline size_t G1EvacStats::region_end_waste() const { return _region_end_waste.load_relaxed(); }\n+\n+inline size_t G1EvacStats::direct_allocated() const { return _direct_allocated.load_relaxed(); }\n+\n+inline size_t G1EvacStats::num_direct_allocated() const { return _num_direct_allocated.load_relaxed(); }\n+\n+inline size_t G1EvacStats::failure_used() const { return _failure_used.load_relaxed(); }\n+\n+inline size_t G1EvacStats::failure_waste() const { return _failure_waste.load_relaxed(); }\n@@ -33,1 +45,1 @@\n-  AtomicAccess::add(&_direct_allocated, value, memory_order_relaxed);\n+  _direct_allocated.add_then_fetch(value, memory_order_relaxed);\n@@ -37,1 +49,1 @@\n-  AtomicAccess::add(&_num_plab_filled, value, memory_order_relaxed);\n+  _num_plab_filled.add_then_fetch(value, memory_order_relaxed);\n@@ -41,1 +53,1 @@\n-  AtomicAccess::add(&_num_direct_allocated, value, memory_order_relaxed);\n+  _num_direct_allocated.add_then_fetch(value, memory_order_relaxed);\n@@ -45,2 +57,2 @@\n-  AtomicAccess::add(&_region_end_waste, value, memory_order_relaxed);\n-  AtomicAccess::inc(&_regions_filled, memory_order_relaxed);\n+  _region_end_waste.add_then_fetch(value, memory_order_relaxed);\n+  _regions_filled.add_then_fetch(1u, memory_order_relaxed);\n@@ -50,2 +62,2 @@\n-  AtomicAccess::add(&_failure_used, used, memory_order_relaxed);\n-  AtomicAccess::add(&_failure_waste, waste, memory_order_relaxed);\n+  _failure_used.add_then_fetch(used, memory_order_relaxed);\n+  _failure_waste.add_then_fetch(waste, memory_order_relaxed);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1EvacStats.inline.hpp","additions":21,"deletions":9,"binary":false,"changes":30,"status":"modified"}]}