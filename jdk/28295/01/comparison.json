{"files":[{"patch":"@@ -1082,1 +1082,0 @@\n-    bool failure = false;\n@@ -1087,4 +1086,14 @@\n-      if (is_verify_Value())    { failure |= verify_Value_for(n); }\n-      if (is_verify_Ideal())    { failure |= verify_Ideal_for(n, false); }\n-      if (is_verify_Ideal())    { failure |= verify_Ideal_for(n, true); }\n-      if (is_verify_Identity()) { failure |= verify_Identity_for(n); }\n+      \/\/ If we get an assert here, check why the reported node was not processed again in IGVN.\n+      \/\/ We should either make sure that this node is properly added back to the IGVN worklist\n+      \/\/ in PhaseIterGVN::add_users_to_worklist to update it again or add an exception\n+      \/\/ in the verification code above if that is not possible for some reason (like Load nodes).\n+      if (is_verify_Value()) {\n+        verify_Value_for(n);\n+      }\n+      if (is_verify_Ideal()) {\n+        verify_Ideal_for(n, false);\n+        verify_Ideal_for(n, true);\n+      }\n+      if (is_verify_Identity()) {\n+        verify_Identity_for(n);\n+      }\n@@ -1101,5 +1110,0 @@\n-    \/\/ If we get this assert, check why the reported nodes were not processed again in IGVN.\n-    \/\/ We should either make sure that these nodes are properly added back to the IGVN worklist\n-    \/\/ in PhaseIterGVN::add_users_to_worklist to update them again or add an exception\n-    \/\/ in the verification code above if that is not possible for some reason (like Load nodes).\n-    assert(!failure, \"Missed optimization opportunity in PhaseIterGVN\");\n@@ -1130,1 +1134,1 @@\n-\/\/ Check that type(n) == n->Value(), return true if we have a failure.\n+\/\/ Check that type(n) == n->Value(), asserts if we have a failure.\n@@ -1135,1 +1139,1 @@\n-bool PhaseIterGVN::verify_Value_for(Node* n) {\n+void PhaseIterGVN::verify_Value_for(Node *n) {\n@@ -1141,1 +1145,1 @@\n-    return false;\n+    return;\n@@ -1150,1 +1154,1 @@\n-      return false; \/\/ ignore integer widen\n+      return; \/\/ ignore integer widen\n@@ -1159,1 +1163,1 @@\n-    return false;\n+    return;\n@@ -1178,1 +1182,1 @@\n-    return false;\n+    return;\n@@ -1192,1 +1196,2 @@\n-  return true;\n+\n+  assert(false, \"Missed Value optimization opportunity in PhaseIterGVN for %s\", n->Name());\n@@ -1196,3 +1201,3 @@\n-\/\/ Returns true if it found missed optimization opportunities and\n-\/\/         false otherwise (no missed optimization, or skipped verification).\n-bool PhaseIterGVN::verify_Ideal_for(Node* n, bool can_reshape) {\n+\/\/ Asserts if it found missed optimization opportunities or encountered unexpected changes, and\n+\/\/         returns normally otherwise (no missed optimization, or skipped verification).\n+void PhaseIterGVN::verify_Ideal_for(Node *n, bool can_reshape) {\n@@ -1212,1 +1217,1 @@\n-      return false;\n+      return;\n@@ -1223,1 +1228,1 @@\n-      return false;\n+      return;\n@@ -1233,1 +1238,1 @@\n-      return false;\n+      return;\n@@ -1242,1 +1247,1 @@\n-      return false;\n+      return;\n@@ -1261,1 +1266,1 @@\n-      return false;\n+      return;\n@@ -1340,1 +1345,1 @@\n-      return false;\n+      return;\n@@ -1364,1 +1369,1 @@\n-      return false;\n+      return;\n@@ -1396,1 +1401,1 @@\n-      return false;\n+      return;\n@@ -1408,1 +1413,1 @@\n-      return false;\n+      return;\n@@ -1437,1 +1442,1 @@\n-      return false;\n+      return;\n@@ -1462,1 +1467,1 @@\n-      return false;\n+      return;\n@@ -1482,1 +1487,1 @@\n-      return false;\n+      return;\n@@ -1505,1 +1510,1 @@\n-      return false;\n+      return;\n@@ -1518,1 +1523,1 @@\n-      return false;\n+      return;\n@@ -1534,1 +1539,1 @@\n-      return false;\n+      return;\n@@ -1548,1 +1553,1 @@\n-      return false;\n+      return;\n@@ -1574,1 +1579,1 @@\n-      return false;\n+      return;\n@@ -1586,1 +1591,1 @@\n-      return false;\n+      return;\n@@ -1594,1 +1599,1 @@\n-      return false;\n+      return;\n@@ -1609,1 +1614,1 @@\n-      return false;\n+      return;\n@@ -1623,1 +1628,1 @@\n-      return false;\n+      return;\n@@ -1632,1 +1637,1 @@\n-      return false;\n+      return;\n@@ -1642,1 +1647,1 @@\n-      return false;\n+      return;\n@@ -1655,1 +1660,1 @@\n-      return false;\n+      return;\n@@ -1660,1 +1665,1 @@\n-      return false;\n+      return;\n@@ -1666,1 +1671,1 @@\n-      return false;\n+      return;\n@@ -1675,1 +1680,1 @@\n-      return false;\n+      return;\n@@ -1684,1 +1689,1 @@\n-      return false;\n+      return;\n@@ -1689,1 +1694,1 @@\n-      return false;\n+      return;\n@@ -1694,1 +1699,1 @@\n-      return false;\n+      return;\n@@ -1699,1 +1704,1 @@\n-      return false;\n+      return;\n@@ -1710,1 +1715,1 @@\n-      return false;\n+      return;\n@@ -1717,1 +1722,1 @@\n-      return false;\n+      return;\n@@ -1733,1 +1738,1 @@\n-    return false;\n+    return;\n@@ -1747,1 +1752,1 @@\n-    return false;\n+    return;\n@@ -1766,1 +1771,1 @@\n-    return false;\n+    return;\n@@ -1785,1 +1790,1 @@\n-    return false;\n+    return;\n@@ -1817,1 +1822,1 @@\n-    return false;\n+    return;\n@@ -1824,0 +1829,6 @@\n+  \/\/ Remove 'n' from hash table in case it gets modified. We want to avoid\n+  \/\/ hitting the \"Need to remove from hash before changing edges\" assert if\n+  \/\/ a change occurs. Instead, we would like to proceed with the optimization,\n+  \/\/ return and finally hit the assert in PhaseIterGVN::verify_optimize to get\n+  \/\/ a more meaningful message\n+  _table.hash_delete(n);\n@@ -1834,1 +1845,1 @@\n-      return true;\n+      assert(false, \"Unexpected new unused nodes from applying Ideal optimization on %s\", n->Name());\n@@ -1844,1 +1855,1 @@\n-      return true;\n+      assert(false, \"Unexpected hash change from applying Ideal optimization on %s\", n->Name());\n@@ -1850,1 +1861,2 @@\n-    return false;\n+    hash_find_insert(n);\n+    return;\n@@ -1867,1 +1879,2 @@\n-  return true;\n+\n+  assert(false, \"Missed Ideal optimization opportunity in PhaseIterGVN for %s\", n->Name());\n@@ -1871,3 +1884,3 @@\n-\/\/ Returns true if it found missed optimization opportunities and\n-\/\/         false otherwise (no missed optimization, or skipped verification).\n-bool PhaseIterGVN::verify_Identity_for(Node* n) {\n+\/\/ Asserts if it found missed optimization opportunities, and\n+\/\/         returns normally otherwise (no missed optimization, or skipped verification).\n+void PhaseIterGVN::verify_Identity_for(Node *n) {\n@@ -1892,1 +1905,1 @@\n-      return false;\n+      return;\n@@ -1903,1 +1916,1 @@\n-      return false;\n+      return;\n@@ -1917,1 +1930,1 @@\n-      return false;\n+      return;\n@@ -1927,1 +1940,1 @@\n-      return false;\n+      return;\n@@ -1945,1 +1958,1 @@\n-      return false;\n+      return;\n@@ -1959,1 +1972,1 @@\n-      return false;\n+      return;\n@@ -1970,1 +1983,1 @@\n-      return false;\n+      return;\n@@ -1990,1 +2003,1 @@\n-      return false;\n+      return;\n@@ -2004,1 +2017,1 @@\n-      return false;\n+      return;\n@@ -2009,1 +2022,1 @@\n-      return false;\n+      return;\n@@ -2023,1 +2036,1 @@\n-    return false;\n+    return;\n@@ -2034,1 +2047,1 @@\n-    return false;\n+    return;\n@@ -2040,1 +2053,1 @@\n-    return false;\n+    return;\n@@ -2047,1 +2060,1 @@\n-    return false;\n+    return;\n@@ -2059,1 +2072,2 @@\n-  return true;\n+\n+  assert(false, \"Missed Identity optimization opportunity in PhaseIterGVN for %s\", n->Name());\n@@ -2832,1 +2846,8 @@\n-    failure |= verify_Value_for(n);\n+\n+    \/\/ If we get an assert in verify_Value_for, it means that PhaseCCP is not at fixpoint\n+    \/\/ and that the analysis result may be unsound.\n+    \/\/ Check why the reported nodes were not processed again in CCP.\n+    \/\/ We should either make sure that these nodes are properly added back to the CCP worklist\n+    \/\/ in PhaseCCP::push_child_nodes_to_worklist() to update their type or add an exception\n+    \/\/ in the verification code above if that is not possible for some reason (like Load nodes).\n+    verify_Value_for(n);\n@@ -2834,5 +2855,0 @@\n-  \/\/ If we get this assert, check why the reported nodes were not processed again in CCP.\n-  \/\/ We should either make sure that these nodes are properly added back to the CCP worklist\n-  \/\/ in PhaseCCP::push_child_nodes_to_worklist() to update their type or add an exception\n-  \/\/ in the verification code above if that is not possible for some reason (like Load nodes).\n-  assert(!failure, \"PhaseCCP not at fixpoint: analysis result may be unsound.\");\n","filename":"src\/hotspot\/share\/opto\/phaseX.cpp","additions":102,"deletions":86,"binary":false,"changes":188,"status":"modified"},{"patch":"@@ -493,3 +493,4 @@\n-  bool verify_Value_for(Node* n);\n-  bool verify_Ideal_for(Node* n, bool can_reshape);\n-  bool verify_Identity_for(Node* n);\n+\n+  void verify_Value_for(Node *n);\n+  void verify_Ideal_for(Node *n, bool can_reshape);\n+  void verify_Identity_for(Node *n);\n","filename":"src\/hotspot\/share\/opto\/phaseX.hpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"}]}