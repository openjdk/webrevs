{"files":[{"patch":"@@ -333,3 +333,2 @@\n-            if (OperatingSystem.isWindows() ||\n-                    OperatingSystem.isMacOS() ||\n-                        OperatingSystem.isLinux()) {\n+            if (OperatingSystem.isWindows() || OperatingSystem.isMacOS()\n+                    || OperatingSystem.isLinux()) {\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/krb5\/Credentials.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -125,1 +125,1 @@\n-        System.out.println(\"Copying credentials to memory cache\");\n+        System.out.println(\"Creating in-memory cache and copying TGT from file cache\");\n@@ -127,10 +127,1 @@\n-        String memoryCacheName = \"MEMORY:test_\" + System.currentTimeMillis();\n-\n-        \/\/ Create the in-memory cache\n-        if (!NativeCredentialCacheHelper.createInMemoryCache(memoryCacheName)) {\n-            throw new RuntimeException(\"Failed to create memory cache\");\n-        }\n-        System.out.println(\"Created memory cache: \" + memoryCacheName);\n-\n-        \/\/ Try to copy credentials from the file cache\n-        boolean copied = false;\n+        \/\/ Check that the FILE: ccache exists\n@@ -138,6 +129,2 @@\n-        if (fileCache.exists()) {\n-            System.out.println(\"Copying from: \" + fileCache.getAbsolutePath());\n-            copied = NativeCredentialCacheHelper.copyCredentialsToInMemoryCache(\n-                memoryCacheName,\n-                \"FILE:\" + fileCache.getAbsolutePath()\n-            );\n+        if (!fileCache.exists()) {\n+            throw new RuntimeException(\"File cache does not exist: \" + fileCache.getAbsolutePath());\n@@ -146,9 +133,5 @@\n-        \/\/ Fallback to the default cache if copying from file cache fails\n-        if (!copied) {\n-            copied = NativeCredentialCacheHelper.copyCredentialsToInMemoryCache(memoryCacheName, null);\n-        }\n-\n-        if (copied) {\n-            System.out.println(\"Credentials copied to memory cache\");\n-        } else {\n-            System.out.println(\"No credentials found to copy\");\n+        \/\/ Create MEMORY: ccache from the FILE: ccache\n+        String memoryCacheName = \"MEMORY:test_\" + System.currentTimeMillis();\n+        if (!NativeCredentialCacheHelper.createInMemoryCacheFromFileCache(\n+                memoryCacheName, \"FILE:\" + fileCache.getAbsolutePath())) {\n+            throw new RuntimeException(\"Failed to create in-memory cache from file cache\");\n@@ -157,2 +140,0 @@\n-        \/\/ Set as the default cache for JAAS testing\n-        NativeCredentialCacheHelper.setDefaultCache(memoryCacheName);\n@@ -161,0 +142,2 @@\n+        System.out.println(\"Successfully created in-memory cache with credentials: \" + memoryCacheName);\n+\n@@ -180,2 +163,1 @@\n-        try {\n-            Credentials creds = Credentials.acquireDefaultCreds();\n+        Credentials creds = Credentials.acquireDefaultCreds();\n@@ -183,3 +165,3 @@\n-            if (creds != null) {\n-                String client = creds.getClient().toString();\n-                String server = creds.getServer().toString();\n+        if (creds != null) {\n+            String client = creds.getClient().toString();\n+            String server = creds.getServer().toString();\n@@ -187,1 +169,3 @@\n-                System.out.println(\"SUCCESS: JAAS retrieved credentials from in-memory cache\");\n+            \/\/ Verify these are the OneKDC test credentials\n+            if (client.contains(\"dummy\") && server.contains(\"RABBIT.HOLE\") && server.contains(\"krbtgt\")) {\n+                System.out.println(\"SUCCESS: Retrieved correct OneKDC test credentials from in-memory cache\");\n@@ -190,14 +174,0 @@\n-\n-                \/\/ Verify these are the OneKDC test credentials\n-                if (client.contains(\"dummy\") && server.contains(\"RABBIT.HOLE\")) {\n-                    System.out.println(\"SUCCESS: Retrieved correct OneKDC test credentials from in-memory cache\");\n-                    if (server.contains(\"krbtgt\")) {\n-                        System.out.println(\"Retrieved TGT as expected\");\n-                    }\n-                } else {\n-                    System.out.println(\"ERROR: JAAS retrieved wrong credentials from in-memory cache\");\n-                    System.out.println(\"Expected: dummy@RABBIT.HOLE -> krbtgt\/RABBIT.HOLE@RABBIT.HOLE\");\n-                    System.out.println(\"Found: \" + client + \" -> \" + server);\n-                    throw new RuntimeException(\"in-memory cache test failed - wrong credentials retrieved\");\n-                }\n-\n@@ -205,1 +175,4 @@\n-                System.out.println(\"JAAS accessed in-memory cache but found no credentials\");\n+                System.out.println(\"ERROR: JAAS retrieved wrong credentials from in-memory cache\");\n+                System.out.println(\"Expected: dummy@RABBIT.HOLE -> krbtgt\/RABBIT.HOLE@RABBIT.HOLE\");\n+                System.out.println(\"Found: \" + client + \" -> \" + server);\n+                throw new RuntimeException(\"in-memory cache test failed - wrong credentials retrieved\");\n@@ -207,3 +180,3 @@\n-\n-        } catch (Exception e) {\n-            System.out.println(\"JAAS error: \" + e.getMessage());\n+        } else {\n+            System.out.println(\"ERROR: JAAS accessed in-memory cache but found no credentials\");\n+            throw new RuntimeException(\"in-memory cache test failed - no credentials retrieved\");\n","filename":"test\/jdk\/sun\/security\/krb5\/native\/NativeCacheTest.java","additions":25,"deletions":52,"binary":false,"changes":77,"status":"modified"},{"patch":"@@ -1,1 +1,26 @@\n-\/* DO NOT EDIT THIS FILE - it is machine generated *\/\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+ \/* DO NOT EDIT THIS FILE - it is machine generated *\/\n@@ -12,9 +37,1 @@\n- * Method:    createInMemoryCache\n- * Signature: (Ljava\/lang\/String;)Z\n- *\/\n-JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_createInMemoryCache\n-  (JNIEnv *, jclass, jstring);\n-\n-\/*\n- * Class:     NativeCredentialCacheHelper\n- * Method:    copyCredentialsToInMemoryCache\n+ * Method:    createInMemoryCacheFromFileCache\n@@ -23,1 +40,1 @@\n-JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_copyCredentialsToInMemoryCache\n+JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_createInMemoryCacheFromFileCache\n@@ -26,8 +43,0 @@\n-\/*\n- * Class:     NativeCredentialCacheHelper\n- * Method:    setDefaultCache\n- * Signature: (Ljava\/lang\/String;)Z\n- *\/\n-JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_setDefaultCache\n-  (JNIEnv *, jclass, jstring);\n-\n","filename":"test\/jdk\/sun\/security\/krb5\/native\/NativeCredentialCacheHelper.h","additions":28,"deletions":19,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -26,2 +26,2 @@\n- * Provides native methods to create MEMORY: credential caches and copy\n- * real Kerberos credentials to them for testing JAAS access.\n+ * Provides native methods to create in-memory credential caches and copy\n+ * Kerberos credentials from file credential caches for testing JAAS access.\n@@ -41,3 +41,6 @@\n-     * Create an in-memory credential cache using native krb5 API.\n-     * @param cacheName The name for the in-memory cache (e.g., \"MEMORY:test123\")\n-     * @return true if cache was created successfully, false otherwise\n+     * Creates an in-memory credential ccache, copies credentials from a file ccache,\n+     * and sets KRB5CCNAME to the in-memory ccache.\n+     *\n+     * @param inMemoryCacheName The name for the MEMORY: ccache (e.g., \"MEMORY:test123\")\n+     * @param fileCacheName The FILE: ccache name to copy from (e.g., \"FILE:\/path\/to\/cache\")\n+     * @return true if all operations succeeded, false if any operation failed\n@@ -45,17 +48,1 @@\n-    public static native boolean createInMemoryCache(String cacheName);\n-\n-    \/**\n-     * Copy real Kerberos credentials from a source cache to an in-memory cache.\n-     * Used to move OneKDC-generated TGTs to an in-memory cache for testing.\n-     * @param inMemoryCacheName The target in-memory cache name (e.g., \"MEMORY:test123\")\n-     * @param sourceCacheName The source cache name (null for default cache)\n-     * @return true if credentials were copied successfully, false otherwise\n-     *\/\n-    public static native boolean copyCredentialsToInMemoryCache(String inMemoryCacheName, String sourceCacheName);\n-\n-    \/**\n-     * Set KRB5CCNAME so that the test will pick up the in-memory credential cache.\n-     * @param cacheName The credential cache name to set as default\n-     * @return true if set successfully, false otherwise\n-     *\/\n-    public static native boolean setDefaultCache(String cacheName);\n+    public static native boolean createInMemoryCacheFromFileCache(String inMemoryCacheName, String fileCacheName);\n","filename":"test\/jdk\/sun\/security\/krb5\/native\/NativeCredentialCacheHelper.java","additions":9,"deletions":22,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -88,1 +88,2 @@\n- * Create an in-memory credential cache using native krb5 API.\n+ * Creates an in-memory credential ccache, copies credentials from a file ccache,\n+ * and sets KRB5CCNAME to the in-memory ccache.\n@@ -90,2 +91,2 @@\n-JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_createInMemoryCache\n-  (JNIEnv *env, jclass cls, jstring cacheName)\n+JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_createInMemoryCacheFromFileCache\n+  (JNIEnv *env, jclass cls, jstring inMemoryCacheName, jstring fileCacheName)\n@@ -94,61 +95,1 @@\n-    krb5_ccache ccache;\n-    char *cache_name = NULL;\n-\n-    ret = ensure_context();\n-    if (ret) {\n-        print_krb5_error(\"ensure_context\", ret);\n-        return JNI_FALSE;\n-    }\n-\n-    cache_name = jstring_to_cstring(env, cacheName);\n-    if (cache_name == NULL) {\n-        return JNI_FALSE;\n-    }\n-\n-    \/\/ Resolve the memory cache\n-    ret = krb5_cc_resolve(g_context, cache_name, &ccache);\n-    if (ret) {\n-        print_krb5_error(\"krb5_cc_resolve\", ret);\n-        free(cache_name);\n-        return JNI_FALSE;\n-    }\n-\n-    printf(\"Created memory cache: %s\\n\", cache_name);\n-\n-    krb5_cc_close(g_context, ccache);\n-    free(cache_name);\n-    return JNI_TRUE;\n-}\n-\n-\/**\n- * Set KRB5CCNAME so that the test will pick up the in-memory credential cache.\n- *\/\n-JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_setDefaultCache\n-  (JNIEnv *env, jclass cls, jstring cacheName)\n-{\n-    char *cache_name = jstring_to_cstring(env, cacheName);\n-    if (cache_name == NULL) {\n-        return JNI_FALSE;\n-    }\n-\n-    \/\/ Set KRB5CCNAME environment variable\n-    if (setenv(\"KRB5CCNAME\", cache_name, 1) != 0) {\n-        free(cache_name);\n-        return JNI_FALSE;\n-    }\n-\n-    printf(\"Set default cache to: %s\\n\", cache_name);\n-    free(cache_name);\n-    return JNI_TRUE;\n-}\n-\n-\/**\n- * Copy real Kerberos credentials from a source cache to an in-memory cache.\n- * in-memory cache.  Used to move OneKDC-generated TGTs to an in-memory cache\n- * for testing.\n- *\/\n-JNIEXPORT jboolean JNICALL Java_NativeCredentialCacheHelper_copyCredentialsToInMemoryCache\n-  (JNIEnv *env, jclass cls, jstring inMemoryCacheName, jstring sourceCacheName)\n-{\n-    krb5_error_code ret;\n-    krb5_ccache source_ccache = NULL;\n+    krb5_ccache file_ccache = NULL;\n@@ -159,1 +100,1 @@\n-    char *source_cache_name = NULL;\n+    char *file_cache_name = NULL;\n@@ -168,1 +109,0 @@\n-    \/\/ Convert Java strings\n@@ -170,6 +110,3 @@\n-    if (sourceCacheName != NULL) {\n-        source_cache_name = jstring_to_cstring(env, sourceCacheName);\n-    }\n-\n-    if (!in_memory_cache_name) {\n-        printf(\"Failed to get in-memory cache name\\n\");\n+    file_cache_name = jstring_to_cstring(env, fileCacheName);\n+    if (!in_memory_cache_name || !file_cache_name) {\n+        printf(\"Failed to get file or in-memory cache names\\n\");\n@@ -179,4 +116,2 @@\n-    printf(\"Copying credentials to in-memory cache: %s from source: %s\\n\",\n-        in_memory_cache_name,\n-        source_cache_name ? source_cache_name : \"default cache\"\n-    );\n+    printf(\"Creating in-memory cache: %s from file cache: %s\\n\",\n+        in_memory_cache_name, file_cache_name);\n@@ -184,13 +119,6 @@\n-    \/\/ Open source cache (or default cache if sourceCacheName is null)\n-    if (source_cache_name) {\n-        ret = krb5_cc_resolve(g_context, source_cache_name, &source_ccache);\n-        if (ret) {\n-            print_krb5_error(\"krb5_cc_resolve (source)\", ret);\n-            goto cleanup;\n-        }\n-    } else {\n-        ret = krb5_cc_default(g_context, &source_ccache);\n-        if (ret) {\n-            print_krb5_error(\"krb5_cc_default\", ret);\n-            goto cleanup;\n-        }\n+    \/\/ Resolve FILE: ccache\n+    ret = krb5_cc_resolve(g_context, file_cache_name, &file_ccache);\n+    if (ret) {\n+        print_krb5_error(\"krb5_cc_resolve (file cache)\", ret);\n+        printf(\"ERROR: File cache does not exist or cannot be accessed: %s\\n\", file_cache_name);\n+        goto cleanup;\n@@ -199,1 +127,1 @@\n-    \/\/ Open\/resolve memory cache\n+    \/\/ Resolve in-memory cache\n@@ -206,1 +134,3 @@\n-    \/\/ Get principal from source cache for initialization\n+    printf(\"Created in-memory cache: %s\\n\", in_memory_cache_name);\n+\n+    \/\/ Get principal from file cache for initialization\n@@ -208,1 +138,1 @@\n-    ret = krb5_cc_get_principal(g_context, source_ccache, &principal);\n+    ret = krb5_cc_get_principal(g_context, file_ccache, &principal);\n@@ -211,0 +141,1 @@\n+        printf(\"ERROR: Cannot get principal from file cache: %s\\n\", file_cache_name);\n@@ -222,2 +153,2 @@\n-    \/\/ Start credential cursor on source cache\n-    ret = krb5_cc_start_seq_get(g_context, source_ccache, &cursor);\n+    \/\/ Copy credentials from file cache to in-memory cache\n+    ret = krb5_cc_start_seq_get(g_context, file_ccache, &cursor);\n@@ -230,2 +161,1 @@\n-    \/\/ Copy each credential from source to memory cache\n-    while ((ret = krb5_cc_next_cred(g_context, source_ccache, &cursor, &creds)) == 0) {\n+    while ((ret = krb5_cc_next_cred(g_context, file_ccache, &cursor, &creds)) == 0) {\n@@ -239,3 +169,16 @@\n-        printf(\"Copied in-memory credential: %s -> %s\\n\",\n-               creds.client ? \"client\" : \"unknown\",\n-               creds.server ? \"server\" : \"unknown\");\n+        \/\/ Print the actual credential names\n+        char *client_name = NULL;\n+        char *server_name = NULL;\n+        if (creds.client) {\n+            krb5_unparse_name(g_context, creds.client, &client_name);\n+        }\n+        if (creds.server) {\n+            krb5_unparse_name(g_context, creds.server, &server_name);\n+        }\n+\n+        printf(\"Copied credential: %s -> %s\\n\",\n+               client_name ? client_name : \"unknown\",\n+               server_name ? server_name : \"unknown\");\n+\n+        if (client_name) krb5_free_unparsed_name(g_context, client_name);\n+        if (server_name) krb5_free_unparsed_name(g_context, server_name);\n@@ -248,9 +191,4 @@\n-    krb5_cc_end_seq_get(g_context, source_ccache, &cursor);\n-\n-    \/\/ Success if we copied at least one credential\n-    if (copied_count > 0) {\n-        printf(\"Successfully copied %d credentials to in-memory cache: %s\\n\",\n-               copied_count, in_memory_cache_name);\n-        ret = 0;\n-    } else {\n-        printf(\"No credentials found in source cache to copy to in-memory cache\\n\");\n+    krb5_cc_end_seq_get(g_context, file_ccache, &cursor);\n+\n+    if (copied_count == 0) {\n+        printf(\"ERROR: No credentials found in file cache to copy: %s\\n\", file_cache_name);\n@@ -258,0 +196,2 @@\n+        krb5_free_principal(g_context, principal);\n+        goto cleanup;\n@@ -260,0 +200,13 @@\n+    printf(\"Successfully copied %d credentials to in-memory cache: %s\\n\",\n+           copied_count, in_memory_cache_name);\n+\n+    \/\/ Set KRB5CCNAME environment variable to point to in-memory cache\n+    if (setenv(\"KRB5CCNAME\", in_memory_cache_name, 1) != 0) {\n+        printf(\"ERROR: Failed to set KRB5CCNAME environment variable\\n\");\n+        ret = -1;\n+        krb5_free_principal(g_context, principal);\n+        goto cleanup;\n+    }\n+\n+    printf(\"Set KRB5CCNAME to: %s\\n\", in_memory_cache_name);\n+    ret = 0;\n@@ -263,1 +216,3 @@\n-    if (source_ccache) krb5_cc_close(g_context, source_ccache);\n+    if (file_ccache) krb5_cc_close(g_context, file_ccache);\n+    if (file_cache_name) free(file_cache_name);\n+\n@@ -266,1 +221,0 @@\n-    if (source_cache_name) free(source_cache_name);\n","filename":"test\/jdk\/sun\/security\/krb5\/native\/libNativeCredentialCacheHelper.c","additions":64,"deletions":110,"binary":false,"changes":174,"status":"modified"}]}