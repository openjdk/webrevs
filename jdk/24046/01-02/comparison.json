{"files":[{"patch":"@@ -26,0 +26,1 @@\n+#include \"cds\/aotClassLocation.hpp\"\n","filename":"src\/hotspot\/share\/cds\/aotArtifactFinder.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -706,2 +706,2 @@\n-\/\/ Detect such classes and exclude them from the archive.\n-void AOTClassLocationConfig::check_invalid_classpath_index(int classpath_index, InstanceKlass* ik) {\n+\/\/ Detect such classes so that they can be excluded from the archive.\n+bool AOTClassLocationConfig::is_valid_classpath_index(int classpath_index, InstanceKlass* ik) {\n@@ -717,1 +717,1 @@\n-        log_warning(cds)(\"class %s cannot be archived because it was not define from %s as claimed\",\n+        log_warning(cds)(\"class %s cannot be archived because it was not defined from %s as claimed\",\n@@ -719,1 +719,1 @@\n-        ik->set_shared_classpath_index(-1);\n+        return false;\n@@ -723,0 +723,2 @@\n+\n+  return true;\n","filename":"src\/hotspot\/share\/cds\/aotClassLocation.cpp","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -270,1 +270,1 @@\n-  void check_invalid_classpath_index(int classpath_index, InstanceKlass* ik);\n+  bool is_valid_classpath_index(int classpath_index, InstanceKlass* ik);\n","filename":"src\/hotspot\/share\/cds\/aotClassLocation.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-void ClassLoaderExt::record_result(const s2 classpath_index, InstanceKlass* result, bool redefined) {\n+void ClassLoaderExt::record_result(s2 classpath_index, InstanceKlass* result, bool redefined) {\n@@ -83,0 +83,7 @@\n+\n+  if (CDSConfig::is_dumping_preimage_static_archive() || CDSConfig::is_dumping_dynamic_archive()) {\n+    if (!AOTClassLocationConfig::dumptime()->is_valid_classpath_index(classpath_index, result)) {\n+      classpath_index = -1;\n+    }\n+  }\n+\n@@ -86,0 +93,1 @@\n+\n@@ -103,4 +111,0 @@\n-\n-  if (CDSConfig::is_dumping_preimage_static_archive() || CDSConfig::is_dumping_dynamic_archive()) {\n-    AOTClassLocationConfig::dumptime()->check_invalid_classpath_index(classpath_index, result);\n-  }\n","filename":"src\/hotspot\/share\/classfile\/classLoaderExt.cpp","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-  static void record_result(const s2 classpath_index, InstanceKlass* result, bool redefined);\n+  static void record_result(s2 classpath_index, InstanceKlass* result, bool redefined);\n","filename":"src\/hotspot\/share\/classfile\/classLoaderExt.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}