{"files":[{"patch":"@@ -3648,0 +3648,5 @@\n+  \/\/ The VMThread needs to stop now and then to execute these debug options.\n+  if ((HandshakeALot || SafepointALot) && FLAG_IS_DEFAULT(GuaranteedSafepointInterval)) {\n+    FLAG_SET_DEFAULT(GuaranteedSafepointInterval, 1000);\n+  }\n+\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -747,3 +747,2 @@\n-          \"off). The check is performed on GuaranteedSafepointInterval, \"   \\\n-          \"AsyncDeflationInterval or GuaranteedAsyncDeflationInterval, \"    \\\n-          \"whichever is lower.\")                                            \\\n+          \"off). The check is performed on AsyncDeflationInterval or \"      \\\n+          \"GuaranteedAsyncDeflationInterval, whichever is lower.\")          \\\n@@ -1280,1 +1279,1 @@\n-  product(intx, GuaranteedSafepointInterval, 1000, DIAGNOSTIC,              \\\n+  product(intx, GuaranteedSafepointInterval, 0, DIAGNOSTIC,                 \\\n","filename":"src\/hotspot\/share\/runtime\/globals.hpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -53,5 +53,1 @@\n-  \/\/ We wait for the lowest of these three intervals:\n-  \/\/  - GuaranteedSafepointInterval\n-  \/\/      While deflation is not related to safepoint anymore, this keeps compatibility with\n-  \/\/      the old behavior when deflation also happened at safepoints. Users who set this\n-  \/\/      option to get more\/less frequent deflations would be served with this option.\n+  \/\/ We wait for the lowest of these two intervals:\n@@ -66,3 +62,0 @@\n-  if (GuaranteedSafepointInterval > 0) {\n-    wait_time = MIN2(wait_time, GuaranteedSafepointInterval);\n-  }\n","filename":"src\/hotspot\/share\/runtime\/monitorDeflationThread.cpp","additions":1,"deletions":8,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -311,1 +311,1 @@\n-bool VMThread::handshake_alot() {\n+bool VMThread::handshake_or_safepoint_alot() {\n@@ -314,1 +314,1 @@\n-  if (!HandshakeALot) {\n+  if (!HandshakeALot && !SafepointALot) {\n@@ -330,15 +330,0 @@\n-void VMThread::setup_periodic_safepoint_if_needed() {\n-  assert(_cur_vm_operation  == nullptr, \"Already have an op\");\n-  assert(_next_vm_operation == nullptr, \"Already have an op\");\n-  \/\/ Check for a cleanup before SafepointALot to keep stats correct.\n-  jlong interval_ms = SafepointTracing::time_since_last_safepoint_ms();\n-  bool max_time_exceeded = GuaranteedSafepointInterval != 0 &&\n-                           (interval_ms >= GuaranteedSafepointInterval);\n-  if (!max_time_exceeded) {\n-    return;\n-  }\n-  if (SafepointALot) {\n-    _next_vm_operation = &safepointALot_op;\n-  }\n-}\n-\n@@ -468,2 +453,2 @@\n-    if (handshake_alot()) {\n-      {\n+    if (handshake_or_safepoint_alot()) {\n+      if (HandshakeALot) {\n@@ -478,0 +463,4 @@\n+      if (SafepointALot) {\n+        _next_vm_operation = &safepointALot_op;\n+        return;\n+      }\n@@ -482,5 +471,0 @@\n-    setup_periodic_safepoint_if_needed();\n-    if (_next_vm_operation != nullptr) {\n-      return;\n-    }\n-\n","filename":"src\/hotspot\/share\/runtime\/vmThread.cpp","additions":8,"deletions":24,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -73,2 +73,1 @@\n-  static bool handshake_alot();\n-  static void setup_periodic_safepoint_if_needed();\n+  static bool handshake_or_safepoint_alot();\n","filename":"src\/hotspot\/share\/runtime\/vmThread.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"}]}