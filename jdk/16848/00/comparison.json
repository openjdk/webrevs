{"files":[{"patch":"@@ -371,1 +371,4 @@\n-  Copy::fill_to_memory_atomic(p, sz, value);\n+  {\n+    GuardUnsafeAccess guard(thread);\n+    Copy::fill_to_memory_atomic(p, sz, value);\n+  }\n","filename":"src\/hotspot\/share\/prims\/unsafe.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -44,0 +44,1 @@\n+import java.lang.foreign.MemorySegment;\n@@ -63,0 +64,2 @@\n+    private static final int NUM_TESTS = 4;\n+\n@@ -74,1 +77,1 @@\n-        FileChannel fileChannel = new RandomAccessFile(file, \"r\").getChannel();\n+        FileChannel fileChannel = new RandomAccessFile(file, \"rw\").getChannel();\n@@ -76,1 +79,1 @@\n-            fileChannel.map(FileChannel.MapMode.READ_ONLY, 0, fileChannel.size());\n+            fileChannel.map(FileChannel.MapMode.READ_WRITE, 0, fileChannel.size());\n@@ -89,1 +92,1 @@\n-        for (int i = 0; i < 3; i++) {\n+        for (int i = 0; i < NUM_TESTS; i++) {\n@@ -95,1 +98,1 @@\n-        for (int i = 0; i < 3; i++) {\n+        for (int i = 0; i < NUM_TESTS; i++) {\n@@ -110,1 +113,1 @@\n-        for (int i = 0; i < 3; i++) {\n+        for (int i = 0; i < NUM_TESTS; i++) {\n@@ -124,1 +127,1 @@\n-        for (int i = 0; i < 3; i++) {\n+        for (int i = 0; i < NUM_TESTS; i++) {\n@@ -153,0 +156,5 @@\n+            case 3:\n+                MemorySegment segment = MemorySegment.ofBuffer(buffer);\n+                \/\/ testing Unsafe.setMemory, trying to access next  page after truncation.\n+                segment.fill((byte) 0xF0);\n+                break;\n","filename":"test\/hotspot\/jtreg\/runtime\/Unsafe\/InternalErrorTest.java","additions":14,"deletions":6,"binary":false,"changes":20,"status":"modified"}]}