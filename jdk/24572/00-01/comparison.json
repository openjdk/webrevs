{"files":[{"patch":"@@ -75,1 +75,3 @@\n-    assert(!is_uncommit_operation || leqA_state != StateType::Released, \"uncommitting a released region\");\n+    if (is_uncommit_operation && leqA_state == StateType::Released) {\n+      return SummaryDiff(-1);\n+    }\n@@ -137,0 +139,1 @@\n+  bool is_remove_ok = true;\n@@ -140,2 +143,3 @@\n-    tty->print_cr(\"uc: %d, adr: %d, st:%d\", is_uncommit_operation,(int) head->key(),(int) head->val().out.type());\n-    assert(!is_uncommit_operation || head->val().out.type() != StateType::Released, \"uncommitting a released region\");\n+    if (is_uncommit_operation && head->val().out.type() == StateType::Released)  {\n+      is_remove_ok = false;\n+    }\n@@ -156,1 +160,3 @@\n-\n+  if (!is_remove_ok) {\n+    return SummaryDiff(-1);\n+  }\n","filename":"src\/hotspot\/share\/nmt\/vmatree.cpp","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -178,1 +178,1 @@\n-    SummaryDiff() {\n+    SummaryDiff(int init = 0) {\n@@ -180,1 +180,1 @@\n-        tag[i] = SingleDiff{0, 0};\n+        tag[i] = SingleDiff{init, init};\n@@ -183,1 +183,7 @@\n-\n+    bool is_valid() const {\n+      for (int i = 0; i < mt_number_of_tags; i++) {\n+        if (tag[i].reserve >= 0 || tag[i].commit >= 0)\n+          return true;\n+      }\n+      return false;\n+    }\n","filename":"src\/hotspot\/share\/nmt\/vmatree.hpp","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -753,1 +753,2 @@\n-    EXPECT_DEATH(tree.uncommit_mapping(40, 20, rd2), \"\");\n+    VMATree::SummaryDiff diff = tree.uncommit_mapping(40, 20, rd2);\n+    EXPECT_FALSE(diff.is_valid());\n@@ -763,1 +764,2 @@\n-    EXPECT_DEATH(tree.uncommit_mapping(60, 20, rd2), \"\");\n+    VMATree::SummaryDiff diff = tree.uncommit_mapping(60, 20, rd2);\n+    EXPECT_FALSE(diff.is_valid());\n","filename":"test\/hotspot\/gtest\/nmt\/test_vmatree.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"}]}