{"files":[{"patch":"@@ -157,1 +157,1 @@\n-        Certificate[] chain = new Certificate[] {serverCert, trustedCert};\n+        Certificate[] chain = new Certificate[] {serverCert};\n@@ -167,1 +167,1 @@\n-        ctx.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);\n+        ctx.init(kmf.getKeyManagers(), null, null);\n@@ -190,4 +190,1 @@\n-        if (!serverReady.await(SERVER_WAIT_SECS, TimeUnit.SECONDS)) {\n-            throw new RuntimeException(\"Server did not start within \" +\n-                    SERVER_WAIT_SECS + \" seconds.\");\n-        }\n+        serverReady.await();\n","filename":"test\/jdk\/javax\/net\/ssl\/HttpsURLConnection\/CriticalSubjectAltName.java","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"filename":"test\/jdk\/javax\/net\/ssl\/HttpsURLConnection\/crisubn.jks","binary":true,"status":"deleted"},{"filename":"test\/jdk\/javax\/net\/ssl\/HttpsURLConnection\/trusted.jks","binary":true,"status":"deleted"},{"patch":"@@ -1,305 +0,0 @@\n-\/*\n- * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/\/\n-\/\/ SunJSSE does not support dynamic system properties, no way to re-use\n-\/\/ system properties in samevm\/agentvm mode.\n-\/\/\n-\n-\/* @test id=tls12\n- * @summary X509 certificate hostname checking is broken in JDK1.6.0_10\n- * @bug 6766775\n- * @library \/test\/lib\n- * @run main\/othervm IPIdentities TLSv1.2 MD5withRSA\n- * @author Xuelei Fan\n- *\/\n-\n-\/* @test id=tls13\n- * @summary X509 certificate hostname checking is broken in JDK1.6.0_10\n- * @bug 6766775\n- * @library \/test\/lib\n- * @run main\/othervm IPIdentities TLSv1.3 SHA256withRSA\n- * @author Xuelei Fan\n- *\/\n-\n-\n-import java.io.PrintStream;\n-import java.net.InetAddress;\n-import java.net.InetSocketAddress;\n-import java.net.Proxy;\n-import java.net.URL;\n-import jdk.test.lib.net.URIBuilder;\n-import jdk.test.lib.security.SecurityUtils;\n-import java.util.List;\n-\n-import javax.net.ssl.HttpsURLConnection;\n-import javax.net.ssl.SSLContext;\n-import javax.net.ssl.SSLServerSocket;\n-import javax.net.ssl.SSLServerSocketFactory;\n-import javax.net.ssl.SSLSocket;\n-\n-\n-public class IPIdentities extends IdentitiesBase {\n-\n-    \/*\n-     * =============================================================\n-     * Set the various variables needed for the tests, then\n-     * specify what tests to run on each side.\n-     *\/\n-\n-    \/*\n-     * Should we run the client or server in a separate thread?\n-     * Both sides can throw exceptions, but do you have a preference\n-     * as to which side should be the main thread.\n-     *\/\n-    static boolean separateServerThread = true;\n-\n-    \/*\n-     * Is the server ready to serve?\n-     *\/\n-    volatile static boolean serverReady = false;\n-\n-    \/*\n-     * Is the connection ready to close?\n-     *\/\n-    volatile static boolean closeReady = false;\n-\n-\n-\n-    private SSLServerSocket sslServerSocket = null;\n-\n-    \/*\n-     * Define the server side of the test.\n-     *\n-     * If the server prematurely exits, serverReady will be set to true\n-     * to avoid infinite hangs.\n-     *\/\n-    void doServerSide() throws Exception {\n-        SSLContext context = getServerSSLContext();\n-        SSLServerSocketFactory sslssf = context.getServerSocketFactory();\n-\n-        \/\/ doClientSide() connects to the loopback address\n-        InetAddress loopback = InetAddress.getLoopbackAddress();\n-        InetSocketAddress address = new InetSocketAddress(loopback, serverPort);\n-\n-        sslServerSocket =\n-            (SSLServerSocket) sslssf.createServerSocket();\n-        sslServerSocket.bind(address);\n-        serverPort = sslServerSocket.getLocalPort();\n-\n-        \/*\n-         * Signal Client, we're ready for his connect.\n-         *\/\n-        serverReady = true;\n-\n-        SSLSocket sslSocket = (SSLSocket) sslServerSocket.accept();\n-        sslSocket.setNeedClientAuth(true);\n-\n-        PrintStream out =\n-                new PrintStream(sslSocket.getOutputStream());\n-\n-        try {\n-            \/\/ ignore request data\n-\n-            \/\/ send the response\n-            out.print(\"HTTP\/1.1 200 OK\\r\\n\");\n-            out.print(\"Content-Type: text\/html; charset=iso-8859-1\\r\\n\");\n-            out.print(\"Content-Length: \"+ 9 +\"\\r\\n\");\n-            out.print(\"\\r\\n\");\n-            out.print(\"Testing\\r\\n\");\n-            out.flush();\n-        } finally {\n-             \/\/ close the socket\n-             while (!closeReady) {\n-                 Thread.sleep(50);\n-             }\n-\n-             System.out.println(\"Server closing socket\");\n-             sslSocket.close();\n-             serverReady = false;\n-        }\n-\n-    }\n-\n-    \/*\n-     * Define the client side of the test.\n-     *\n-     * If the server prematurely exits, serverReady will be set to true\n-     * to avoid infinite hangs.\n-     *\/\n-    void doClientSide() throws Exception {\n-        SSLContext reservedSSLContext = SSLContext.getDefault();\n-        try {\n-            SSLContext context = getClientSSLContext();\n-            SSLContext.setDefault(context);\n-\n-            \/*\n-             * Wait for server to get started.\n-             *\/\n-            while (!serverReady) {\n-                Thread.sleep(50);\n-            }\n-\n-            HttpsURLConnection http = null;\n-\n-            \/* establish http connection to server *\/\n-            URL url = URIBuilder.newBuilder()\n-                .scheme(\"https\")\n-                .loopback()\n-                .port(serverPort)\n-                .path(\"\/\")\n-                .toURL();\n-            System.out.println(\"url is \"+url.toString());\n-\n-            try {\n-                http = (HttpsURLConnection)url.openConnection(Proxy.NO_PROXY);\n-\n-                int respCode = http.getResponseCode();\n-                System.out.println(\"respCode = \"+respCode);\n-            } finally {\n-                if (http != null) {\n-                    http.disconnect();\n-                }\n-                closeReady = true;\n-            }\n-        } finally {\n-            SSLContext.setDefault(reservedSSLContext);\n-        }\n-    }\n-\n-    \/*\n-     * =============================================================\n-     * The remainder is just support stuff\n-     *\/\n-\n-    \/\/ use any free port by default\n-    volatile int serverPort = 0;\n-\n-    volatile Exception serverException = null;\n-    volatile Exception clientException = null;\n-\n-\n-\n-    public static void main(String args[]) throws Exception {\n-        if (args[1].contains(\"MD5\")) {\n-            SecurityUtils.removeFromDisabledAlgs(\n-                    \"jdk.certpath.disabledAlgorithms\", List.of(\"MD5\"));\n-            SecurityUtils.removeFromDisabledTlsAlgs(\"MD5\");\n-        }\n-\n-        if (debug) {\n-            System.setProperty(\"javax.net.debug\", \"all\");\n-        }\n-\n-        \/*\n-         * Start the tests.\n-         *\/\n-        new IPIdentities(args[0], args[1]);\n-    }\n-\n-    Thread clientThread = null;\n-    Thread serverThread = null;\n-    \/*\n-     * Primary constructor, used to drive remainder of the test.\n-     *\n-     * Fork off the other side, then do your work.\n-     *\/\n-    IPIdentities(String protocol, String signatureAlg) throws Exception {\n-        super(protocol, signatureAlg);\n-\n-        if (separateServerThread) {\n-            startServer(true);\n-            startClient(false);\n-        } else {\n-            startClient(true);\n-            startServer(false);\n-        }\n-\n-        \/*\n-         * Wait for other side to close down.\n-         *\/\n-        if (separateServerThread) {\n-            serverThread.join();\n-        } else {\n-            clientThread.join();\n-        }\n-\n-        \/*\n-         * When we get here, the test is pretty much over.\n-         *\n-         * If the main thread excepted, that propagates back\n-         * immediately.  If the other thread threw an exception, we\n-         * should report back.\n-         *\/\n-        if (serverException != null)\n-            throw serverException;\n-        if (clientException != null)\n-            throw clientException;\n-    }\n-\n-    void startServer(boolean newThread) throws Exception {\n-        if (newThread) {\n-            serverThread = new Thread() {\n-                public void run() {\n-                    try {\n-                        doServerSide();\n-                    } catch (Exception e) {\n-                        \/*\n-                         * Our server thread just died.\n-                         *\n-                         * Release the client, if not active already...\n-                         *\/\n-                        System.err.println(\"Server died...\");\n-                        serverReady = true;\n-                        serverException = e;\n-                    }\n-                }\n-            };\n-            serverThread.start();\n-        } else {\n-            doServerSide();\n-        }\n-    }\n-\n-    void startClient(boolean newThread) throws Exception {\n-        if (newThread) {\n-            clientThread = new Thread() {\n-                public void run() {\n-                    try {\n-                        doClientSide();\n-                    } catch (Exception e) {\n-                        \/*\n-                         * Our client thread just died.\n-                         *\/\n-                        System.err.println(\"Client died...\");\n-                        clientException = e;\n-                    }\n-                }\n-            };\n-            clientThread.start();\n-        } else {\n-            doClientSide();\n-        }\n-    }\n-\n-}\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/https\/HttpsURLConnection\/IPIdentities.java","additions":0,"deletions":305,"binary":false,"changes":305,"status":"deleted"},{"patch":"@@ -104,1 +104,1 @@\n-                .addExtension(CertificateBuilder.createIPSubjectAltNameExt(true, \"127.0.0.1\"))\n+                .addExtension(CertificateBuilder.createIPSubjectAltNameExt(true, \"127.0.0.1\", \"::1\"))\n@@ -119,1 +119,1 @@\n-                .addExtension(CertificateBuilder.createIPSubjectAltNameExt(true, \"127.0.0.1\"))\n+                .addExtension(CertificateBuilder.createIPSubjectAltNameExt(true, \"127.0.0.1\", \"::1\"))\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/https\/HttpsURLConnection\/IdentitiesBase.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -156,1 +156,1 @@\n-            boolean critical, String dnsName) throws IOException {\n+            boolean critical, String... dnsNames) throws IOException {\n@@ -158,1 +158,3 @@\n-        gns.add(new GeneralName(new DNSName(dnsName)));\n+        for (String dnsName : dnsNames) {\n+            gns.add(new GeneralName(new DNSName(dnsName)));\n+        }\n@@ -165,1 +167,1 @@\n-     * @param ipAddress IP address to use in the extension\n+     * @param ipAddresses IP addresses to use in the extension\n@@ -169,1 +171,1 @@\n-            boolean critical, String ipAddress) throws IOException {\n+            boolean critical, String... ipAddresses) throws IOException {\n@@ -171,1 +173,3 @@\n-        gns.add(new GeneralName(new IPAddressName(ipAddress)));\n+        for (String ip : ipAddresses) {\n+            gns.add(new GeneralName(new IPAddressName(ip)));\n+        }\n","filename":"test\/lib\/jdk\/test\/lib\/security\/CertificateBuilder.java","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"}]}