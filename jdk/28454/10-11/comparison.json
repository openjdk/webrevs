{"files":[{"patch":"@@ -1076,22 +1076,0 @@\n-    \/\/ This follows the implementation of encodeASCII\n-    private static int encodedLengthASCII(byte coder, byte[] val) {\n-        if (coder == LATIN1) {\n-            return val.length;\n-        }\n-        int len = val.length >> 1;\n-        int dp = 0;\n-        for (int i = 0; i < len; i++) {\n-            char c = StringUTF16.getChar(val, i);\n-            if (c < 0x80) {\n-                dp++;\n-                continue;\n-            }\n-            if (Character.isHighSurrogate(c) && i + 1 < len &&\n-                    Character.isLowSurrogate(StringUTF16.getChar(val, i + 1))) {\n-                i++;\n-            }\n-            dp++;\n-        }\n-        return dp;\n-    }\n-\n@@ -1158,2 +1136,2 @@\n-    \/\/ This follows the implementation of encode8859_1\n-    private static int encodedLength8859_1(byte coder, byte[] val) {\n+    \/\/ This follows the implementation of encodeASCII and encode8859_1\n+    private static int encodedLengthASCIIor8859_1(byte coder, byte[] val) {\n@@ -1167,0 +1145,8 @@\n+        while (sp < sl) {\n+            char c = StringUTF16.getChar(val, sp);\n+            if (c >= Character.MIN_HIGH_SURROGATE) {\n+                break;\n+            }\n+            dp++;\n+            sp++;\n+        }\n@@ -1169,5 +1155,3 @@\n-            if (c > 0x80) {\n-                if (Character.isHighSurrogate(c) && sp < sl &&\n-                        Character.isLowSurrogate(StringUTF16.getChar(val, sp))) {\n-                    sp++;\n-                }\n+            if (Character.isHighSurrogate(c) && sp < sl &&\n+                    Character.isLowSurrogate(StringUTF16.getChar(val, sp))) {\n+                sp++;\n@@ -2137,4 +2121,2 @@\n-        } else if (cs == ISO_8859_1.INSTANCE) {\n-            return encodedLength8859_1(coder, value);\n-        } else if (cs == US_ASCII.INSTANCE) {\n-            return encodedLengthASCII(coder, value);\n+        } else if (cs == ISO_8859_1.INSTANCE || cs == US_ASCII.INSTANCE) {\n+            return encodedLengthASCIIor8859_1(coder, value);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/String.java","additions":15,"deletions":33,"binary":false,"changes":48,"status":"modified"}]}