{"files":[{"patch":"@@ -1076,0 +1076,21 @@\n+    private static int encodedLengthASCII(byte coder, byte[] value) {\n+        if (coder == LATIN1) {\n+            return value.length;\n+        }\n+        int len = value.length >> 1;\n+        int dp = 0;\n+        for (int i = 0; i < len; i++) {\n+            char c = StringUTF16.getChar(value, i);\n+            if (c < 0x80) {\n+                dp++;\n+                continue;\n+            }\n+            if (Character.isHighSurrogate(c) && i + 1 < len &&\n+                    Character.isLowSurrogate(StringUTF16.getChar(value, i + 1))) {\n+                i++;\n+            }\n+            dp++;\n+        }\n+        return dp;\n+    }\n+\n@@ -2113,0 +2134,2 @@\n+     * @implNote This method may allocate memory to compute the length for some charsets.\n+     *\n@@ -2115,0 +2138,1 @@\n+     * @since 27\n@@ -2119,7 +2143,8 @@\n-        }\n-        if (bytesCompatible(cs, 0, value.length)) {\n-            return value.length;\n-        }\n-        if (cs instanceof sun.nio.cs.UTF_16LE ||\n-            cs instanceof sun.nio.cs.UTF_16BE) {\n-            return value.length << (1 - coder());\n+        } else if (cs == ISO_8859_1.INSTANCE) {\n+            if (isLatin1()) {\n+                return value.length;\n+            }\n+        } else if (cs == US_ASCII.INSTANCE) {\n+            return encodedLengthASCII(coder, value);\n+        } else if (cs instanceof sun.nio.cs.UTF_16LE || cs instanceof sun.nio.cs.UTF_16BE) {\n+            return byteFor(value.length, coder);\n@@ -2130,0 +2155,4 @@\n+    private int byteFor(int length, int coder) {\n+        return length << (1 - coder);\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/lang\/String.java","additions":36,"deletions":7,"binary":false,"changes":43,"status":"modified"}]}