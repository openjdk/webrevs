{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+ * @enablePreview\n@@ -31,6 +32,19 @@\n-import java.io.*;\n-import java.util.*;\n-\n-import java.security.*;\n-import java.security.interfaces.*;\n-import java.security.spec.*;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.InputStream;\n+import java.security.Key;\n+import java.security.KeyFactory;\n+import java.security.KeyStore;\n+import java.security.PEM;\n+import java.security.PrivateKey;\n+import java.security.PublicKey;\n+import java.security.interfaces.RSAPrivateCrtKey;\n+import java.security.spec.KeySpec;\n+import java.security.spec.PKCS8EncodedKeySpec;\n+import java.security.spec.RSAPrivateCrtKeySpec;\n+import java.security.spec.RSAPrivateKeySpec;\n+import java.security.spec.RSAPublicKeySpec;\n+import java.security.spec.X509EncodedKeySpec;\n+\n+import java.util.Arrays;\n+import java.util.Enumeration;\n@@ -86,1 +100,0 @@\n-\n@@ -88,1 +101,2 @@\n-        byte[] encodedPriv = Base64.getDecoder().decode(PKCS1_PRIV_STR);\n+        byte[] encodedPriv =\n+                new PEM(\"PRIVATE KEY\", PKCS1_PRIV_STR).decode();\n@@ -103,1 +117,1 @@\n-        byte[] encodedPub = Base64.getDecoder().decode(PKCS1_PUB_STR);\n+        byte[] encodedPub = new PEM(\"PRIVATE KEY\", PKCS1_PUB_STR).decode();\n@@ -133,1 +147,1 @@\n-        if (key2.getAlgorithm().equals(\"RSA\") == false) {\n+        if (!key2.getAlgorithm().equals(\"RSA\")) {\n@@ -137,1 +151,1 @@\n-            if (key2.getFormat().equals(\"X.509\") == false) {\n+            if (!key2.getFormat().equals(\"X.509\")) {\n@@ -141,1 +155,1 @@\n-            if (key2.getFormat().equals(\"PKCS#8\") == false) {\n+            if (!key2.getFormat().equals(\"PKCS#8\")) {\n@@ -207,2 +221,1 @@\n-        if (key instanceof RSAPrivateCrtKey) {\n-            RSAPrivateCrtKey rsaKey = (RSAPrivateCrtKey)key;\n+        if (key instanceof RSAPrivateCrtKey rsaKey) {\n@@ -210,2 +223,8 @@\n-                    rsaKey.getPublicExponent(), rsaKey.getPrivateExponent(), rsaKey.getPrimeP(), rsaKey.getPrimeQ(),\n-                    rsaKey.getPrimeExponentP(), rsaKey.getPrimeExponentQ(), rsaKey.getCrtCoefficient(), rsaKey.getParams());\n+                    rsaKey.getPublicExponent(),\n+                    rsaKey.getPrivateExponent(),\n+                    rsaKey.getPrimeP(),\n+                    rsaKey.getPrimeQ(),\n+                    rsaKey.getPrimeExponentP(),\n+                    rsaKey.getPrimeExponentQ(),\n+                    rsaKey.getCrtCoefficient(),\n+                    rsaKey.getParams());\n@@ -218,1 +237,1 @@\n-        if (key.getAlgorithm().equals(\"RSA\") == false) {\n+        if (!key.getAlgorithm().equals(\"RSA\")) {\n","filename":"test\/jdk\/sun\/security\/rsa\/TestKeyFactory.java","additions":37,"deletions":18,"binary":false,"changes":55,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,0 @@\n-import java.io.ByteArrayInputStream;\n@@ -29,0 +28,3 @@\n+import java.security.PEM;\n+import java.security.PEMDecoder;\n+import java.security.PEMEncoder;\n@@ -31,0 +33,1 @@\n+import java.security.Security;\n@@ -32,2 +35,1 @@\n-import java.security.cert.CertificateException;\n-import java.security.cert.CertificateFactory;\n+import java.security.cert.X509Certificate;\n@@ -37,1 +39,0 @@\n-import java.security.spec.PKCS8EncodedKeySpec;\n@@ -42,1 +43,0 @@\n-import java.util.Base64;\n@@ -48,0 +48,1 @@\n+ * @enablePreview\n@@ -50,0 +51,1 @@\n+\n@@ -77,4 +79,6 @@\n-            KeyFactory kf = KeyFactory.getInstance(algorithm, provider);\n-            PKCS8EncodedKeySpec privSpec = new PKCS8EncodedKeySpec(\n-                    Base64.getMimeDecoder().decode(type));\n-            PrivateKey priv = kf.generatePrivate(privSpec);\n+            final PEMDecoder decoder = PEMDecoder.of()\n+                    .withFactory(Security.getProvider(provider));\n+            final PrivateKey priv = decoder.decode(\n+                    new PEM(\"PRIVATE KEY\", type).toString(),\n+                    PrivateKey.class\n+            );\n@@ -82,13 +86,19 @@\n-            RSAPrivateCrtKey crtKey = (RSAPrivateCrtKey) priv;\n-            PrivateKey priv1 = kf.generatePrivate(new RSAPrivateCrtKeySpec(\n-                    crtKey.getModulus(),\n-                    crtKey.getPublicExponent(),\n-                    crtKey.getPrivateExponent(),\n-                    crtKey.getPrimeP(),\n-                    crtKey.getPrimeQ(),\n-                    crtKey.getPrimeExponentP(),\n-                    crtKey.getPrimeExponentQ(),\n-                    crtKey.getCrtCoefficient(),\n-                    crtKey.getParams()\n-            ));\n-            equals(priv, priv1);\n+            if (priv instanceof RSAPrivateCrtKey crtKey) {\n+                final KeyFactory kf = KeyFactory.getInstance(algorithm, provider);\n+                final PrivateKey priv1 =\n+                        kf.generatePrivate(new RSAPrivateCrtKeySpec(\n+                                crtKey.getModulus(),\n+                                crtKey.getPublicExponent(),\n+                                crtKey.getPrivateExponent(),\n+                                crtKey.getPrimeP(),\n+                                crtKey.getPrimeQ(),\n+                                crtKey.getPrimeExponentP(),\n+                                crtKey.getPrimeExponentQ(),\n+                                crtKey.getCrtCoefficient(),\n+                                crtKey.getParams()\n+                        ));\n+                equals(priv, priv1);\n+            } else {\n+                throw new RuntimeException(\n+                        \"Private key is not RSAPrivateCrtKey\");\n+            }\n@@ -96,1 +106,1 @@\n-                | NoSuchProviderException e) {\n+                 | NoSuchProviderException e) {\n@@ -108,3 +118,2 @@\n-            CertificateFactory cf = CertificateFactory.getInstance(\"X.509\");\n-            Certificate cert = cf.generateCertificate(\n-                    new ByteArrayInputStream(type.getBytes()));\n+            final Certificate cert = PEMDecoder.of()\n+                    .decode(type, X509Certificate.class);\n@@ -112,8 +121,15 @@\n-            KeyFactory kf = KeyFactory.getInstance(algorithm, provider);\n-            X509EncodedKeySpec pubSpec = kf.getKeySpec(\n-                    cert.getPublicKey(), X509EncodedKeySpec.class);\n-            PublicKey pub = kf.generatePublic(pubSpec);\n-            PublicKey pub1 = kf.generatePublic(new RSAPublicKeySpec(\n-                    ((RSAPublicKey) pub).getModulus(),\n-                    ((RSAPublicKey) pub).getPublicExponent(),\n-                    ((RSAPublicKey) pub).getParams()));\n+\n+            final PEMDecoder decoder = PEMDecoder.of()\n+                    .withFactory(Security.getProvider(provider));\n+            final RSAPublicKey pub = decoder.decode(\n+                    PEMEncoder.of().encodeToString(\n+                            new X509EncodedKeySpec(\n+                                    cert.getPublicKey().getEncoded())\n+                    ),\n+                    RSAPublicKey.class);\n+\n+            final KeyFactory kf = KeyFactory.getInstance(algorithm, provider);\n+            final PublicKey pub1 = kf.generatePublic(new RSAPublicKeySpec(\n+                    pub.getModulus(),\n+                    pub.getPublicExponent(),\n+                    pub.getParams()));\n@@ -122,2 +138,2 @@\n-        } catch (CertificateException | NoSuchAlgorithmException\n-                | InvalidKeySpecException | NoSuchProviderException e) {\n+        } catch (NoSuchAlgorithmException\n+                 | InvalidKeySpecException | NoSuchProviderException e) {\n","filename":"test\/jdk\/sun\/security\/rsa\/pss\/PSSKeyCompatibility.java","additions":53,"deletions":37,"binary":false,"changes":90,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+ * @enablePreview\n@@ -35,2 +36,2 @@\n-import java.io.ByteArrayInputStream;\n-import java.io.UnsupportedEncodingException;\n+import java.security.PEM;\n+import java.security.PEMDecoder;\n@@ -46,1 +47,0 @@\n-import java.util.Base64;\n@@ -352,1 +352,2 @@\n-        CertificateFactory certFac = CertificateFactory.getInstance(\"X.509\");\n+        CertificateFactory certFac =\n+                CertificateFactory.getInstance(\"X.509\");\n@@ -354,7 +355,15 @@\n-        X509Certificate goodGuyCert = getCert(certFac, GOOD_SERVER_PEM);\n-        X509Certificate badGuyCert = getCert(certFac, BAD_SERVER_PEM);\n-        X509Certificate intCACert = getCert(certFac, INT_CA_PEM);\n-        X509Certificate rootCACert = getCert(certFac, ROOT_CA_PEM);\n-        byte[] goodOcspDer = pemToDer(GOOD_GUY_OCSP_PEM);\n-        byte[] badOcspDer = pemToDer(BAD_GUY_OCSP_PEM);\n-        byte[] intCAOcspDer = pemToDer(INT_CA_OCSP_PEM);\n+        final PEMDecoder decoder = PEMDecoder.of();\n+        X509Certificate goodGuyCert =\n+                decoder.decode(GOOD_SERVER_PEM, X509Certificate.class);\n+        X509Certificate badGuyCert =\n+                decoder.decode(BAD_SERVER_PEM, X509Certificate.class);\n+        X509Certificate intCACert =\n+                decoder.decode(INT_CA_PEM, X509Certificate.class);\n+        X509Certificate rootCACert =\n+                decoder.decode(ROOT_CA_PEM, X509Certificate.class);\n+        byte[] goodOcspDer =\n+                new PEM(\"OCSP RESPONSE\", GOOD_GUY_OCSP_PEM).decode();\n+        byte[] badOcspDer =\n+                new PEM(\"OCSP RESPONSE\", BAD_GUY_OCSP_PEM).decode();\n+        byte[] intCAOcspDer =\n+                new PEM(\"OCSP RESPONSE\",INT_CA_OCSP_PEM).decode();\n@@ -482,15 +491,0 @@\n-\n-    static X509Certificate getCert(CertificateFactory fac, String pemCert) {\n-        try {\n-            ByteArrayInputStream bais =\n-                    new ByteArrayInputStream(pemCert.getBytes(\"UTF-8\"));\n-            return (X509Certificate)fac.generateCertificate(bais);\n-        } catch (UnsupportedEncodingException | CertificateException exc) {\n-            throw new RuntimeException(exc);\n-        }\n-    }\n-\n-    static byte[] pemToDer(String pemData) {\n-        Base64.Decoder b64Dec = Base64.getMimeDecoder();\n-        return b64Dec.decode(pemData);\n-    }\n","filename":"test\/jdk\/sun\/security\/validator\/PKIXValAndRevCheckTests.java","additions":21,"deletions":27,"binary":false,"changes":48,"status":"modified"}]}