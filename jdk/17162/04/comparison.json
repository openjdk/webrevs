{"files":[{"patch":"@@ -1655,2 +1655,1 @@\n-        length = new CastIINode(length, narrow_length_type);\n-        length->set_req(TypeFunc::Control, init->proj_out_or_null(TypeFunc::Control));\n+        length = new CastIINode(init->proj_out_or_null(TypeFunc::Control), length, narrow_length_type);\n","filename":"src\/hotspot\/share\/opto\/callnode.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -126,41 +126,1 @@\n-Node* ConstraintCastNode::make_cast(int opcode, Node* c, Node* n, const Type* t, DependencyType dependency,\n-                                    const TypeTuple* extra_types) {\n-  switch(opcode) {\n-  case Op_CastII: {\n-    Node* cast = new CastIINode(n, t, dependency, false, extra_types);\n-    cast->set_req(0, c);\n-    return cast;\n-  }\n-  case Op_CastLL: {\n-    Node* cast = new CastLLNode(n, t, dependency, extra_types);\n-    cast->set_req(0, c);\n-    return cast;\n-  }\n-  case Op_CastPP: {\n-    Node* cast = new CastPPNode(n, t, dependency, extra_types);\n-    cast->set_req(0, c);\n-    return cast;\n-  }\n-  case Op_CastFF: {\n-    Node* cast = new CastFFNode(n, t, dependency, extra_types);\n-    cast->set_req(0, c);\n-    return cast;\n-  }\n-  case Op_CastDD: {\n-    Node* cast = new CastDDNode(n, t, dependency, extra_types);\n-    cast->set_req(0, c);\n-    return cast;\n-  }\n-  case Op_CastVV: {\n-    Node* cast = new CastVVNode(n, t, dependency, extra_types);\n-    cast->set_req(0, c);\n-    return cast;\n-  }\n-  case Op_CheckCastPP: return new CheckCastPPNode(c, n, t, dependency, extra_types);\n-  default:\n-    fatal(\"Bad opcode %d\", opcode);\n-  }\n-  return nullptr;\n-}\n-\n-Node* ConstraintCastNode::make(Node* c, Node *n, const Type *t, DependencyType dependency, BasicType bt) {\n+Node* ConstraintCastNode::make_cast_for_basic_type(Node* c, Node* n, const Type* t, DependencyType dependency, BasicType bt) {\n@@ -168,6 +128,4 @@\n-  case T_INT: {\n-    return make_cast(Op_CastII, c, n, t, dependency, nullptr);\n-  }\n-  case T_LONG: {\n-    return make_cast(Op_CastLL, c, n, t, dependency, nullptr);\n-  }\n+  case T_INT:\n+    return new CastIINode(c, n, t, dependency);\n+  case T_LONG:\n+    return new CastLLNode(c, n, t, dependency);\n@@ -270,1 +228,1 @@\n-  Node* n = ConstraintCastNode::make(control, parent, type, dependency, bt);\n+  Node* n = ConstraintCastNode::make_cast_for_basic_type(control, parent, type, dependency, bt);\n@@ -490,1 +448,0 @@\n-  Node* cast= nullptr;\n@@ -492,1 +449,1 @@\n-    cast = make_cast(Op_CastII, c, in, type, dependency, types);\n+    return new CastIINode(c, in, type, dependency, false, types);\n@@ -494,1 +451,1 @@\n-    cast = make_cast(Op_CastLL, c, in, type, dependency, types);\n+    return new CastLLNode(c, in, type, dependency, types);\n@@ -496,1 +453,1 @@\n-    cast = make_cast(Op_CastFF, c, in, type, dependency, types);\n+    return new CastFFNode(c, in, type, dependency, types);\n@@ -498,1 +455,1 @@\n-    cast = make_cast(Op_CastDD, c, in, type, dependency, types);\n+    return new CastDDNode(c, in, type, dependency, types);\n@@ -500,1 +457,1 @@\n-    cast = make_cast(Op_CastVV, c, in, type, dependency, types);\n+    return new CastVVNode(c, in, type, dependency, types);\n@@ -502,1 +459,1 @@\n-    cast = make_cast(Op_CastPP, c, in, type, dependency, types);\n+    return new CastPPNode(c, in, type, dependency, types);\n@@ -504,1 +461,1 @@\n-  return cast;\n+  fatal(\"unreachable. Invalid cast type.\");\n","filename":"src\/hotspot\/share\/opto\/castnode.cpp","additions":13,"deletions":56,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -57,1 +57,1 @@\n-  ConstraintCastNode(Node* n, const Type* t, ConstraintCastNode::DependencyType dependency,\n+  ConstraintCastNode(Node* ctrl, Node* n, const Type* t, ConstraintCastNode::DependencyType dependency,\n@@ -61,0 +61,1 @@\n+    init_req(0, ctrl);\n@@ -71,2 +72,1 @@\n-  static Node* make_cast(int opcode, Node* c, Node* n, const Type* t, DependencyType dependency, const TypeTuple* extra_types);\n-  static Node* make(Node* c, Node *n, const Type *t, DependencyType dependency, BasicType bt);\n+  static Node* make_cast_for_basic_type(Node* c, Node* n, const Type* t, DependencyType dependency, BasicType bt);\n@@ -105,1 +105,1 @@\n-    : ConstraintCastNode(n, t, dependency, types), _range_check_dependency(range_check_dependency) {\n+    : ConstraintCastNode(nullptr, n, t, dependency, types), _range_check_dependency(range_check_dependency) {\n@@ -108,2 +108,2 @@\n-  CastIINode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, bool range_check_dependency = false)\n-    : ConstraintCastNode(n, t, dependency, nullptr), _range_check_dependency(range_check_dependency) {\n+  CastIINode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, bool range_check_dependency = false, const TypeTuple* types = nullptr)\n+    : ConstraintCastNode(ctrl, n, t, dependency, types), _range_check_dependency(range_check_dependency) {\n@@ -111,1 +111,0 @@\n-    init_req(0, ctrl);\n@@ -134,7 +133,2 @@\n-  CastLLNode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency)\n-    : ConstraintCastNode(n, t, dependency, nullptr) {\n-    init_class_id(Class_CastLL);\n-    init_req(0, ctrl);\n-  }\n-  CastLLNode(Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n-          : ConstraintCastNode(n, t, dependency, types) {\n+  CastLLNode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n+          : ConstraintCastNode(ctrl, n, t, dependency, types) {\n@@ -152,2 +146,2 @@\n-  CastFFNode(Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n-          : ConstraintCastNode(n, t, dependency, types) {\n+  CastFFNode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n+          : ConstraintCastNode(ctrl, n, t, dependency, types) {\n@@ -162,2 +156,2 @@\n-  CastDDNode(Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n-          : ConstraintCastNode(n, t, dependency, types) {\n+  CastDDNode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n+          : ConstraintCastNode(ctrl, n, t, dependency, types) {\n@@ -172,2 +166,2 @@\n-  CastVVNode(Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n-          : ConstraintCastNode(n, t, dependency, types) {\n+  CastVVNode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n+          : ConstraintCastNode(ctrl, n, t, dependency, types) {\n@@ -185,2 +179,2 @@\n-  CastPPNode (Node *n, const Type *t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n-    : ConstraintCastNode(n, t, dependency, types) {\n+  CastPPNode (Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n+    : ConstraintCastNode(ctrl, n, t, dependency, types) {\n@@ -196,2 +190,2 @@\n-  CheckCastPPNode(Node *c, Node *n, const Type *t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n-    : ConstraintCastNode(n, t, dependency, types) {\n+  CheckCastPPNode(Node* ctrl, Node* n, const Type* t, DependencyType dependency = RegularDependency, const TypeTuple* types = nullptr)\n+    : ConstraintCastNode(ctrl, n, t, dependency, types) {\n@@ -199,1 +193,0 @@\n-    init_req(0, c);\n","filename":"src\/hotspot\/share\/opto\/castnode.hpp","additions":18,"deletions":25,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -2151,2 +2151,1 @@\n-          cast = ConstraintCastNode::make_cast(Op_CastPP, r, uin, phi_type, ConstraintCastNode::StrongDependency,\n-                                               extra_types);\n+          cast = new CastPPNode(r, uin, phi_type, ConstraintCastNode::StrongDependency, extra_types);\n@@ -2162,2 +2161,1 @@\n-            cast = ConstraintCastNode::make_cast(Op_CastPP, r, uin, TypePtr::NOTNULL,\n-                                                 ConstraintCastNode::StrongDependency, extra_types);\n+            cast = new CastPPNode(r, uin, TypePtr::NOTNULL, ConstraintCastNode::StrongDependency, extra_types);\n@@ -2175,2 +2173,1 @@\n-            cast = ConstraintCastNode::make_cast(Op_CheckCastPP, r, n, phi_type, ConstraintCastNode::StrongDependency,\n-                                                 extra_types);\n+            cast = new CheckCastPPNode(r, uin, phi_type, ConstraintCastNode::StrongDependency, extra_types);\n@@ -2179,2 +2176,1 @@\n-            cast = ConstraintCastNode::make_cast(Op_CastPP, r, uin, phi_type, ConstraintCastNode::StrongDependency,\n-                                                 extra_types);\n+            cast = new CastPPNode(r, uin, phi_type, ConstraintCastNode::StrongDependency, extra_types);\n","filename":"src\/hotspot\/share\/opto\/cfgnode.cpp","additions":4,"deletions":8,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -4474,1 +4474,0 @@\n-    value = new CastIINode(value, itype, carry_dependency ? ConstraintCastNode::StrongDependency : ConstraintCastNode::RegularDependency, true \/* range check dependency *\/);\n@@ -4479,1 +4478,1 @@\n-    value->set_req(0, ctrl);\n+    value = new CastIINode(ctrl, value, itype, carry_dependency ? ConstraintCastNode::StrongDependency : ConstraintCastNode::RegularDependency, true \/* range check dependency *\/);\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1442,2 +1442,1 @@\n-  Node *cast = new CastPPNode(obj,t_not_null);\n-  cast->init_req(0, control());\n+  Node* cast = new CastPPNode(control(), obj,t_not_null);\n","filename":"src\/hotspot\/share\/opto\/graphKit.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -875,2 +875,1 @@\n-    Node* ccast = new CastIINode(index, TypeInt::POS);\n-    ccast->set_req(0, control());\n+    Node* ccast = new CastIINode(control(), index, TypeInt::POS);\n@@ -1143,1 +1142,3 @@\n-  Node* casted_length = ConstraintCastNode::make(control(), length, TypeInteger::make(0, upper_bound, Type::WidenMax, bt), ConstraintCastNode::RegularDependency, bt);\n+  Node* casted_length = ConstraintCastNode::make_cast_for_basic_type(\n+      control(), length, TypeInteger::make(0, upper_bound, Type::WidenMax, bt),\n+      ConstraintCastNode::RegularDependency, bt);\n@@ -1171,1 +1172,3 @@\n-  Node* result = ConstraintCastNode::make(control(), index, TypeInteger::make(0, upper_bound, Type::WidenMax, bt), ConstraintCastNode::RegularDependency, bt);\n+  Node* result = ConstraintCastNode::make_cast_for_basic_type(\n+      control(), index, TypeInteger::make(0, upper_bound, Type::WidenMax, bt),\n+      ConstraintCastNode::RegularDependency, bt);\n@@ -4291,2 +4294,1 @@\n-      Node* cast = new CastPPNode(klass_node, akls);\n-      cast->init_req(0, control());\n+      Node* cast = new CastPPNode(control(), klass_node, akls);\n@@ -5919,2 +5921,1 @@\n-       Node *cast = new CastPPNode(z, TypePtr::NOTNULL);\n-       cast->init_req(0, control());\n+       Node* cast = new CastPPNode(control(), z, TypePtr::NOTNULL);\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":9,"deletions":8,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -1287,2 +1287,1 @@\n-  Node* castii = new CastIINode(incr, TypeInt::INT, ConstraintCastNode::UnconditionalDependency);\n-  castii->set_req(0, ctrl);\n+  Node* castii = new CastIINode(ctrl, incr, TypeInt::INT, ConstraintCastNode::UnconditionalDependency);\n@@ -3164,1 +3163,1 @@\n-  main_limit = new CastIINode(main_limit, TypeInt::make(upward ? min_jint : orig_limit_t->_lo,\n+  main_limit = new CastIINode(pre_ctrl, main_limit, TypeInt::make(upward ? min_jint : orig_limit_t->_lo,\n@@ -3166,1 +3165,0 @@\n-  main_limit->init_req(0, pre_ctrl);\n@@ -3425,1 +3423,4 @@\n-  Node* cast_ii = ConstraintCastNode::make(cl->in(LoopNode::EntryControl), exact_limit, phase->_igvn.type(exact_limit), ConstraintCastNode::UnconditionalDependency, T_INT);\n+  Node* cast_ii = ConstraintCastNode::make_cast_for_basic_type(\n+      cl->in(LoopNode::EntryControl), exact_limit,\n+      phase->_igvn.type(exact_limit),\n+      ConstraintCastNode::UnconditionalDependency, T_INT);\n","filename":"src\/hotspot\/share\/opto\/loopTransform.cpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -1733,1 +1733,1 @@\n-        ccast = new CastIINode(val, tboth);\n+        ccast = new CastIINode(control(), val, tboth);\n@@ -1736,1 +1736,1 @@\n-        ccast = new CastPPNode(val, tboth);\n+        ccast = new CastPPNode(control(), val, tboth);\n@@ -1767,1 +1767,0 @@\n-    ccast->set_req(0, control());\n","filename":"src\/hotspot\/share\/opto\/parse2.cpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -491,1 +491,1 @@\n-    vec_field_ld = gvn.transform(new CastPPNode(vec_field_ld, payload_type));\n+    vec_field_ld = gvn.transform(new CastPPNode(nullptr, vec_field_ld, payload_type));\n","filename":"src\/hotspot\/share\/opto\/vector.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}