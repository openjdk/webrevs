{"files":[{"patch":"@@ -2042,0 +2042,6 @@\n+#ifdef __APPLE__\n+      rlim_t rlim_org = nbr_files.rlim_cur;\n+      \/\/ according to setrlimit(2), OPEN_MAX must be used instead\n+      \/\/ of RLIM_INFINITY, but testing on macOS >= 10.6, reveals that\n+      \/\/ we can, in fact, use even RLIM_INFINITY, so try the max value\n+      \/\/ that the system claims can be used first.\n@@ -2044,5 +2050,14 @@\n-#ifdef __APPLE__\n-      \/\/ Darwin returns RLIM_INFINITY for rlim_max, but fails with EINVAL if\n-      \/\/ you attempt to use RLIM_INFINITY. As per setrlimit(2), OPEN_MAX must\n-      \/\/ be used instead\n-      nbr_files.rlim_cur = MIN(OPEN_MAX, nbr_files.rlim_cur);\n+      \/\/ WORKAROUND: some terminals (ksh) will internally use \"int\" type\n+      \/\/ to store this value and since RLIM_INFINITY overflows an \"int\"\n+      \/\/ we might end up with a negative value, so cap the system limit max\n+      \/\/ at INT_MAX instead, just in case, for everyone.\n+      nbr_files.rlim_cur = MIN(INT_MAX, nbr_files.rlim_max);\n+\n+      status = setrlimit(RLIMIT_NOFILE, &nbr_files);\n+      if (status != 0) {\n+        \/\/ if that fails then try lowering the limit to either OPEN_MAX\n+        \/\/ (which is safe) or the original limit, whichever was greater.\n+        nbr_files.rlim_cur = MAX(OPEN_MAX, rlim_org);\n+      }\n+#else\n+      nbr_files.rlim_cur = nbr_files.rlim_max;\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":20,"deletions":5,"binary":false,"changes":25,"status":"modified"}]}