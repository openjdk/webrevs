{"files":[{"patch":"@@ -1414,1 +1414,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xC0, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xC0, no_flags);\n@@ -1438,1 +1438,1 @@\n-  (void)evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  (void)emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -1638,1 +1638,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xE0, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xE0, no_flags);\n@@ -1669,1 +1669,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -1816,1 +1816,1 @@\n-  evex_opcode_prefix_and_encode_swap(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x40 | cc, false \/* no_flags *\/, true \/* is_map1 *\/);\n+  evex_opcode_prefix_and_encode(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x40 | cc, false \/* no_flags *\/, true \/* is_map1 *\/, true \/* swap *\/);\n@@ -2517,1 +2517,1 @@\n-  evex_opcode_prefix_and_encode_swap(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0xAF, no_flags, true \/* is_map1 *\/);\n+  evex_opcode_prefix_and_encode(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0xAF, no_flags, true \/* is_map1 *\/, true \/* swap *\/);\n@@ -4068,1 +4068,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -4401,1 +4401,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes);\n@@ -4409,1 +4409,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_66, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_66, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -4433,1 +4433,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xC8, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xC8, no_flags);\n@@ -4457,1 +4457,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6198,1 +6198,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes);\n@@ -6281,1 +6281,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6296,1 +6296,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6313,1 +6313,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6328,1 +6328,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6339,1 +6339,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -6356,1 +6356,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -6371,1 +6371,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -6388,1 +6388,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -6457,1 +6457,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6472,1 +6472,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6537,1 +6537,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6552,1 +6552,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6693,1 +6693,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6708,1 +6708,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6726,1 +6726,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6742,1 +6742,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6961,1 +6961,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xE8, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xE8, no_flags);\n@@ -6972,1 +6972,1 @@\n-  (void) evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  (void) emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -6997,1 +6997,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -7287,1 +7287,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xF0, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_32bit, 0x81, 0xF0, no_flags);\n@@ -7311,1 +7311,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -12951,1 +12951,1 @@\n-    int encode = evex_prefix_and_encode_ndd(src_enc, dst_enc, nds_enc, pre, opc, &attributes, no_flags);\n+    int encode = emit_eevex_prefix_or_demote_ndd(src_enc, dst_enc, nds_enc, pre, opc, &attributes, no_flags);\n@@ -12957,15 +12957,2 @@\n-                                              int size, int byte1, bool no_flags, bool is_map1) {\n-  bool is_prefixq = (size == EVEX_64bit) ? true : false;\n-  if (is_demotable(no_flags, dst_enc, nds_enc)) {\n-    int encode = is_prefixq ? prefixq_and_encode(src_enc, dst_enc, is_map1) : prefix_and_encode(src_enc, dst_enc, is_map1);\n-    emit_opcode_prefix_and_encoding((unsigned char)byte1, 0xC0, encode);\n-  } else {\n-    InstructionAttr attributes(AVX_128bit, is_prefixq, \/* legacy_mode *\/ false, \/* no_mask_reg *\/ true, \/* uses_vl *\/ false);\n-    attributes.set_is_evex_instruction();\n-    int encode = vex_prefix_and_encode(src_enc, dst_enc, nds_enc, pre, opc, &attributes, \/* src_is_gpr *\/ true, \/* nds_is_ndd *\/ true, no_flags);\n-    emit_int16(byte1, (0xC0 | encode));\n-  }\n-}\n-\n-void Assembler::evex_opcode_prefix_and_encode_swap(int dst_enc, int nds_enc, int src_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                                   int size, int byte1, bool no_flags, bool is_map1) {\n+                                              int size, int byte1, bool no_flags, bool is_map1, bool swap) {\n+  int encode;\n@@ -12977,1 +12964,7 @@\n-    int encode = is_prefixq ? prefixq_and_encode(dst_enc, src_enc, is_map1) : prefix_and_encode(dst_enc, src_enc, is_map1);\n+\n+    if (swap) {\n+      encode = is_prefixq ? prefixq_and_encode(dst_enc, src_enc, is_map1) : prefix_and_encode(dst_enc, src_enc, is_map1);\n+    }\n+    else {\n+      encode = is_prefixq ? prefixq_and_encode(src_enc, dst_enc, is_map1) : prefix_and_encode(src_enc, dst_enc, is_map1);\n+    }\n@@ -12982,1 +12975,6 @@\n-    int encode = vex_prefix_and_encode(nds_enc, dst_enc, src_enc, pre, opc, &attributes, \/* src_is_gpr *\/ true, \/* nds_is_ndd *\/ true, no_flags);\n+    if (swap) {\n+      encode = vex_prefix_and_encode(nds_enc, dst_enc, src_enc, pre, opc, &attributes, \/* src_is_gpr *\/ true, \/* nds_is_ndd *\/ true, no_flags);\n+    }\n+    else {\n+      encode = vex_prefix_and_encode(src_enc, dst_enc, nds_enc, pre, opc, &attributes, \/* src_is_gpr *\/ true, \/* nds_is_ndd *\/ true, no_flags);\n+    }\n@@ -12987,2 +12985,2 @@\n-int Assembler::evex_prefix_and_encode_ndd(int dst_enc, int nds_enc, int src_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                          InstructionAttr *attributes, bool no_flags, bool use_prefixq) {\n+int Assembler::emit_eevex_prefix_or_demote_ndd(int dst_enc, int nds_enc, int src_enc, VexSimdPrefix pre, VexOpcode opc,\n+                                               InstructionAttr *attributes, bool no_flags, bool use_prefixq) {\n@@ -12999,2 +12997,2 @@\n-int Assembler::evex_prefix_and_encode_ndd(int dst_enc, int nds_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                          InstructionAttr *attributes, bool no_flags, bool use_prefixq) {\n+int Assembler::emit_eevex_prefix_or_demote_ndd(int dst_enc, int nds_enc, VexSimdPrefix pre, VexOpcode opc,\n+                                               InstructionAttr *attributes, bool no_flags, bool use_prefixq) {\n@@ -13009,2 +13007,2 @@\n-int Assembler::evex_prefix_and_encode_ndd(int dst_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                          InstructionAttr *attributes, bool no_flags) {\n+int Assembler::emit_eevex_prefix_or_demote_ndd(int dst_enc, VexSimdPrefix pre, VexOpcode opc,\n+                                               InstructionAttr *attributes, bool no_flags) {\n@@ -13021,2 +13019,2 @@\n-void Assembler::evex_prefix_arith(Register dst, Register nds, int32_t imm32, VexSimdPrefix pre, VexOpcode opc,\n-                                  int size, int op1, int op2, bool no_flags) {\n+void Assembler::emit_eevex_prefix_or_demote_arith_ndd(Register dst, Register nds, int32_t imm32, VexSimdPrefix pre, VexOpcode opc,\n+                                                      int size, int op1, int op2, bool no_flags) {\n@@ -14527,1 +14525,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xC0, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xC0, no_flags);\n@@ -14550,1 +14548,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -14575,1 +14573,1 @@\n-  int encode = evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_66, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_66, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n@@ -14600,1 +14598,1 @@\n-  int encode = evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_F3, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_F3, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n@@ -14624,1 +14622,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xE0, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xE0, no_flags);\n@@ -14647,1 +14645,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -14800,1 +14798,1 @@\n-  evex_opcode_prefix_and_encode_swap(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x40 | cc, false \/* no_flags *\/, true \/* is_map1 *\/);\n+  evex_opcode_prefix_and_encode(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x40 | cc, false \/* no_flags *\/, true \/* is_map1 *\/, true \/* swap *\/);\n@@ -14911,1 +14909,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -14924,1 +14922,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15009,1 +15007,1 @@\n-  evex_opcode_prefix_and_encode_swap(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0xAF, no_flags, true \/* is_map1 *\/);\n+  evex_opcode_prefix_and_encode(dst->encoding(), src1->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0xAF, no_flags, true \/* is_map1 *\/, true \/* swap *\/);\n@@ -15107,1 +15105,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags);\n@@ -15122,1 +15120,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15389,1 +15387,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15415,1 +15413,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n@@ -15484,1 +15482,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xC8, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xC8, no_flags);\n@@ -15494,1 +15492,1 @@\n-  (void) evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  (void) emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15518,1 +15516,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15775,1 +15773,1 @@\n-  int encode =  evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n+  int encode =  emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n@@ -15796,1 +15794,1 @@\n-  int encode =  evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n+  int encode =  emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, false \/* no_flags *\/, true \/* use_prefixq *\/);\n@@ -15899,1 +15897,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15914,1 +15912,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15976,1 +15974,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -15991,1 +15989,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16030,1 +16028,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16045,1 +16043,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16063,1 +16061,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16079,1 +16077,1 @@\n-  int encode = evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  int encode = emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16164,1 +16162,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xE8, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xE8, no_flags);\n@@ -16175,1 +16173,1 @@\n-  (void) evex_prefix_and_encode_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  (void) emit_eevex_prefix_or_demote_ndd(dst->encoding(), src->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16199,1 +16197,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16264,1 +16262,1 @@\n-  (void) evex_prefix_and_encode_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n+  (void) emit_eevex_prefix_or_demote_ndd(src1->encoding(), dst->encoding(), src2->encoding(), VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes, no_flags, true \/* use_prefixq *\/);\n@@ -16285,1 +16283,1 @@\n-  evex_prefix_arith(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xF0, no_flags);\n+  emit_eevex_prefix_or_demote_arith_ndd(dst, src, imm32, VEX_SIMD_NONE, VEX_OPCODE_0F_3C \/* MAP4 *\/, EVEX_64bit, 0x81, 0xF0, no_flags);\n@@ -16313,1 +16311,1 @@\n-  int encode =  evex_prefix_and_encode_ndd(dst->encoding(), VEX_SIMD_F2, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes); \/\/ demotion disabled\n+  int encode =  emit_eevex_prefix_or_demote_ndd(dst->encoding(), VEX_SIMD_F2, VEX_OPCODE_0F_3C \/* MAP4 *\/, &attributes); \/\/ demotion disabled\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.cpp","additions":90,"deletions":92,"binary":false,"changes":182,"status":"modified"},{"patch":"@@ -791,2 +791,2 @@\n-  int  evex_prefix_and_encode_ndd(int dst_enc, int nds_enc, int src_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                  InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false);\n+  int  emit_eevex_prefix_or_demote_ndd(int dst_enc, int nds_enc, int src_enc, VexSimdPrefix pre, VexOpcode opc,\n+                                       InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false);\n@@ -794,2 +794,2 @@\n-  int  evex_prefix_and_encode_ndd(int dst_enc, int nds_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                  InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false);\n+  int  emit_eevex_prefix_or_demote_ndd(int dst_enc, int nds_enc, VexSimdPrefix pre, VexOpcode opc,\n+                                       InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false);\n@@ -797,2 +797,2 @@\n-  int  evex_prefix_and_encode_ndd(int dst_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                  InstructionAttr *attributes, bool no_flags = false);\n+  int  emit_eevex_prefix_or_demote_ndd(int dst_enc, VexSimdPrefix pre, VexOpcode opc,\n+                                       InstructionAttr *attributes, bool no_flags = false);\n@@ -803,2 +803,2 @@\n-  void evex_prefix_arith(Register dst, Register nds, int32_t imm32, VexSimdPrefix pre, VexOpcode opc,\n-                         int size, int op1, int op2, bool no_flags);\n+  void emit_eevex_prefix_or_demote_arith_ndd(Register dst, Register nds, int32_t imm32, VexSimdPrefix pre, VexOpcode opc,\n+                                             int size, int op1, int op2, bool no_flags);\n@@ -807,4 +807,1 @@\n-                                     int size, int byte1, bool no_flags, bool is_map1 = false);\n-\n-  void evex_opcode_prefix_and_encode_swap(int dst_enc, int nds_enc, int src_enc, VexSimdPrefix pre, VexOpcode opc,\n-                                          int size, int byte1, bool no_flags, bool is_map1 = false);\n+                                     int size, int byte1, bool no_flags, bool is_map1 = false, bool swap = false);\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":9,"deletions":12,"binary":false,"changes":21,"status":"modified"}]}