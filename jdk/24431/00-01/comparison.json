{"files":[{"patch":"@@ -2645,1 +2645,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -4593,1 +4593,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -7073,1 +7073,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -7089,1 +7089,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -7105,1 +7105,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -7121,1 +7121,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -7138,1 +7138,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -7154,1 +7154,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -13768,1 +13768,1 @@\n-                           InstructionAttr *attributes, bool no_flags, bool use_prefixq) {\n+                           InstructionAttr *attributes, bool no_flags, bool use_prefixq, bool demote) {\n@@ -13770,2 +13770,2 @@\n-  if (!no_flags && dst_enc == nds_enc) {\n-    return use_prefixq? prefixq_and_encode(dst_enc, src_enc) : prefix_and_encode(dst_enc, src_enc);\n+  if (demote && is_demotable(no_flags, dst_enc, nds_enc)) {\n+    return use_prefixq ? prefixq_and_encode(dst_enc, src_enc) : prefix_and_encode(dst_enc, src_enc);\n@@ -13778,1 +13778,1 @@\n-                           InstructionAttr *attributes, bool no_flags, bool use_prefixq) {\n+                           InstructionAttr *attributes, bool no_flags, bool use_prefixq, bool demote) {\n@@ -13780,2 +13780,2 @@\n-  if (!no_flags && dst_enc == nds_enc) {\n-    return use_prefixq? prefixq_and_encode(dst_enc) : prefix_and_encode(dst_enc);\n+  if (demote && is_demotable(no_flags, dst_enc, nds_enc)) {\n+    return use_prefixq ? prefixq_and_encode(dst_enc) : prefix_and_encode(dst_enc);\n@@ -13818,4 +13818,0 @@\n-bool Assembler::is_demotable(bool no_flags, int dst_enc, int nds_enc, int src_enc) {\n-  return (!no_flags && dst_enc == nds_enc);\n-}\n-\n@@ -15367,1 +15363,1 @@\n-  if (is_demotable(false, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(false, dst->encoding(), src1->encoding())) {\n@@ -15392,1 +15388,1 @@\n-  if (is_demotable(false, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(false, dst->encoding(), src1->encoding())) {\n@@ -15833,1 +15829,1 @@\n-  if (is_demotable(no_flags, dst->encoding(), src1->encoding(), src2->encoding())) {\n+  if (is_demotable(no_flags, dst->encoding(), src1->encoding())) {\n@@ -17185,1 +17181,1 @@\n-  int encode =  evex_prefix_and_encode_ndd(0, 0, dst->encoding(), VEX_SIMD_F2, \/* MAP4 *\/VEX_OPCODE_0F_3C, &attributes); \/\/TODO: check this\n+  int encode =  evex_prefix_and_encode_ndd(0, 0, dst->encoding(), VEX_SIMD_F2, \/* MAP4 *\/VEX_OPCODE_0F_3C, &attributes, false, false, false); \/\/ demotion disabled\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.cpp","additions":18,"deletions":22,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -811,1 +811,1 @@\n-                                  InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false);\n+                                  InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false, bool demote = true);\n@@ -814,1 +814,1 @@\n-                                  InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false);\n+                                  InstructionAttr *attributes, bool no_flags = false, bool use_prefixq = false, bool demote = true);\n@@ -826,1 +826,0 @@\n-  bool is_demotable(bool no_flags, int dst_enc, int nds_enc, int src_enc);\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"}]}