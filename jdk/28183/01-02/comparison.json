{"files":[{"patch":"@@ -2032,2 +2032,2 @@\n-    ShenandoahBarrierSet::satb_mark_queue_set().set_filter_mode(\n-      is_concurrent_young_mark_in_progress(), is_concurrent_old_mark_in_progress()\n+    ShenandoahBarrierSet::satb_mark_queue_set().set_filter_out_young(\n+      is_concurrent_old_mark_in_progress() && !is_concurrent_young_mark_in_progress()\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -31,1 +31,1 @@\n-  SATBMarkQueueSet(allocator), _filter_mode(FILTER_MARKED)\n+  SATBMarkQueueSet(allocator), _filter_out_young(false)\n@@ -38,1 +38,1 @@\n-class ShenandoahSatbFilterOutMarked {\n+class ShenandoahSATBMarkQueueFilterFn {\n@@ -42,1 +42,1 @@\n-  explicit ShenandoahSatbFilterOutMarked(ShenandoahHeap* heap) : _heap(heap) {}\n+  explicit ShenandoahSATBMarkQueueFilterFn(ShenandoahHeap* heap) : _heap(heap) {}\n@@ -50,1 +50,1 @@\n-class ShenandoahSatbFilterOutYoung {\n+class ShenandoahSATBOldMarkQueueFilterFn {\n@@ -54,1 +54,1 @@\n-  explicit ShenandoahSatbFilterOutYoung(ShenandoahHeap* heap) : _heap(heap) {}\n+  explicit ShenandoahSATBOldMarkQueueFilterFn(ShenandoahHeap* heap) : _heap(heap) {}\n@@ -64,14 +64,0 @@\n-class ShenandoahSatbFilterOutOld {\n-  ShenandoahHeap* const _heap;\n-\n-public:\n-  explicit ShenandoahSatbFilterOutOld(ShenandoahHeap* heap) : _heap(heap) {}\n-\n-  \/\/ Return true if entry should be filtered out (removed), false if it should be retained.\n-  bool operator()(const void* entry) const {\n-    assert(!_heap->is_concurrent_old_mark_in_progress(), \"Should only use this when old marking is not in progress\");\n-    assert(_heap->is_concurrent_young_mark_in_progress(), \"Should only use this when young marking is in progress\");\n-    return !_heap->requires_marking(entry) || !_heap->is_in_young(entry);\n-  }\n-};\n-\n@@ -80,12 +66,4 @@\n-  switch (_filter_mode) {\n-    case FILTER_MARKED:\n-      apply_filter(ShenandoahSatbFilterOutMarked(heap), queue);\n-      break;\n-    case FILTER_YOUNG:\n-      apply_filter(ShenandoahSatbFilterOutYoung(heap), queue);\n-      break;\n-    case FILTER_OLD:\n-      apply_filter(ShenandoahSatbFilterOutOld(heap), queue);\n-      break;\n-    default:\n-      ShouldNotReachHere();\n+  if (_filter_out_young) {\n+    apply_filter(ShenandoahSATBOldMarkQueueFilterFn(heap), queue);\n+  } else {\n+    apply_filter(ShenandoahSATBMarkQueueFilterFn(heap), queue);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahSATBMarkQueueSet.cpp","additions":9,"deletions":31,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -33,7 +33,1 @@\n-  enum FilterMode {\n-    FILTER_MARKED,\n-    FILTER_YOUNG,\n-    FILTER_OLD\n-  };\n-\n-  FilterMode _filter_mode;\n+  bool _filter_out_young;\n@@ -46,8 +40,2 @@\n-  void set_filter_mode(bool marking_young, bool marking_old) {\n-    if (marking_young && !marking_old) {\n-      _filter_mode = FILTER_OLD;\n-    } else if (!marking_young && marking_old) {\n-      _filter_mode = FILTER_YOUNG;\n-    } else {\n-      _filter_mode = FILTER_MARKED;\n-    }\n+  void set_filter_out_young(bool filter_out_young) {\n+    _filter_out_young = filter_out_young;\n@@ -57,1 +45,1 @@\n-    return _filter_mode == FILTER_YOUNG;\n+    return _filter_out_young;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahSATBMarkQueueSet.hpp","additions":4,"deletions":16,"binary":false,"changes":20,"status":"modified"}]}