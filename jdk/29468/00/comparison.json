{"files":[{"patch":"@@ -3514,4 +3514,1 @@\n-        if (n->has_out_with(Op_StoreP, Op_LoadP, Op_StoreN, Op_LoadN) ||\n-            n->has_out_with(Op_GetAndSetP, Op_GetAndSetN, Op_CompareAndExchangeP, Op_CompareAndExchangeN) ||\n-            n->has_out_with(Op_CompareAndSwapP, Op_CompareAndSwapN, Op_WeakCompareAndSwapP, Op_WeakCompareAndSwapN) ||\n-            BarrierSet::barrier_set()->barrier_set_c2()->escape_has_out_with_unsafe_object(n)) {\n+        if (has_oop_node_outs(n)) {\n@@ -3533,4 +3530,1 @@\n-      if (n->has_out_with(Op_StoreP, Op_LoadP, Op_StoreN, Op_LoadN) ||\n-          n->has_out_with(Op_GetAndSetP, Op_GetAndSetN, Op_CompareAndExchangeP, Op_CompareAndExchangeN) ||\n-          n->has_out_with(Op_CompareAndSwapP, Op_CompareAndSwapN, Op_WeakCompareAndSwapP, Op_WeakCompareAndSwapN) ||\n-          BarrierSet::barrier_set()->barrier_set_c2()->escape_has_out_with_unsafe_object(n)) {\n+      if (has_oop_node_outs(n)) {\n@@ -3542,1 +3536,10 @@\n-  return (is_reference_type(bt) || bt == T_NARROWOOP);\n+  bool res = (is_reference_type(bt) || bt == T_NARROWOOP);\n+  assert(!has_oop_node_outs(n) || res, \"sanity: AddP has oop outs, needs to be treated as oop field\");\n+  return res;\n+}\n+\n+bool ConnectionGraph::has_oop_node_outs(Node* n) {\n+  return n->has_out_with(Op_StoreP, Op_LoadP, Op_StoreN, Op_LoadN) ||\n+         n->has_out_with(Op_GetAndSetP, Op_GetAndSetN, Op_CompareAndExchangeP, Op_CompareAndExchangeN) ||\n+         n->has_out_with(Op_CompareAndSwapP, Op_CompareAndSwapN, Op_WeakCompareAndSwapP, Op_WeakCompareAndSwapN) ||\n+         BarrierSet::barrier_set()->barrier_set_c2()->escape_has_out_with_unsafe_object(n);\n","filename":"src\/hotspot\/share\/opto\/escape.cpp","additions":12,"deletions":9,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -542,1 +542,2 @@\n-  bool   is_oop_field(Node* n, int offset, bool* unsafe);\n+  bool is_oop_field(Node* n, int offset, bool* unsafe);\n+  bool has_oop_node_outs(Node* n);\n","filename":"src\/hotspot\/share\/opto\/escape.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}