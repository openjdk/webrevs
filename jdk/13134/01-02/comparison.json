{"files":[{"patch":"@@ -385,1 +385,1 @@\n-  if (!(DynamicDumpSharedSpaces && archive_name != nullptr)) {\n+  if (!DynamicDumpSharedSpaces || archive_name == nullptr) {\n@@ -389,1 +389,1 @@\n-  log_info(cds,dynamic)(\"Preparing for dynamic dump at exit in thread %s\", current->name());\n+  log_info(cds, dynamic)(\"Preparing for dynamic dump at exit in thread %s\", current->name());\n@@ -391,2 +391,3 @@\n-  MetaspaceShared::link_shared_classes(false\/*not from jcmd*\/, current);\n-  if (!current->has_pending_exception()) {\n+  JavaThread* THREAD = current; \/\/ For TRAPS processing related to link_shared_classes\n+  MetaspaceShared::link_shared_classes(false\/*not from jcmd*\/, THREAD);\n+  if (!HAS_PENDING_EXCEPTION) {\n@@ -395,1 +396,1 @@\n-    if (!current->has_pending_exception()) {\n+    if (!HAS_PENDING_EXCEPTION) {\n@@ -407,1 +408,1 @@\n-  current->clear_pending_exception();\n+  CLEAR_PENDING_EXCEPTION;\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.cpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"}]}