{"files":[{"patch":"@@ -29,1 +29,1 @@\n- * @run main B5045306\n+ * @run main\/othervm B5045306\n","filename":"test\/jdk\/sun\/net\/www\/http\/KeepAliveCache\/B5045306.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -46,3 +46,1 @@\n-    static class Server extends Thread {\n-        final ServerSocket serverSocket;\n-        final int port;\n+    static class Server extends Thread implements AutoCloseable {\n@@ -50,0 +48,2 @@\n+        final ServerSocket serverSocket = new ServerSocket(0);\n+        final int port;\n@@ -53,1 +53,1 @@\n-            serverSocket = new ServerSocket(0);\n+            this.param = param;\n@@ -56,1 +56,0 @@\n-            this.param = param;\n@@ -63,6 +62,4 @@\n-        public void close() {\n-            try {\n-                serverSocket.close();\n-                if (s != null)\n-                    s.close();\n-            } catch (IOException e) {}\n+        public void close() throws IOException {\n+            serverSocket.close();\n+            if (s != null)\n+                s.close();\n@@ -134,16 +131,16 @@\n-        Server server = new Server(param);\n-        int port = server.getPort();\n-        server.start();\n-        URL url = URIBuilder.newBuilder()\n-                .scheme(\"http\")\n-                .loopback()\n-                .port(port)\n-                .path(\"\/\")\n-                .toURL();\n-        HttpURLConnection urlc = (HttpURLConnection) url.openConnection();\n-        int count=0;\n-        try (InputStream i = urlc.getInputStream()) {\n-            int c;\n-            byte[] buf = new byte[256];\n-            while ((c = i.read(buf)) != -1) {\n-                count += c;\n+        try (Server server = new Server(param)) {\n+            server.start();\n+            URL url = URIBuilder.newBuilder()\n+                    .scheme(\"http\")\n+                    .loopback()\n+                    .port(server.getPort())\n+                    .path(\"\/\")\n+                    .toURL();\n+            HttpURLConnection urlc = (HttpURLConnection) url.openConnection();\n+            int count = 0;\n+            try (InputStream i = urlc.getInputStream()) {\n+                int c;\n+                byte[] buf = new byte[256];\n+                while ((c = i.read(buf)) != -1) {\n+                    count += c;\n+                }\n@@ -151,3 +148,1 @@\n-        }\n-        System.out.println(\"Read \" + count);\n-        try {\n+            System.out.println(\"Read \" + count);\n@@ -159,2 +154,0 @@\n-        } finally {\n-            server.close();\n","filename":"test\/jdk\/sun\/net\/www\/http\/KeepAliveCache\/B8291637.java","additions":25,"deletions":32,"binary":false,"changes":57,"status":"modified"}]}