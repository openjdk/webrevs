{"files":[{"patch":"@@ -379,3 +379,3 @@\n-  os::Linux::accurate_meminfo_t info;\n-  if (os::Linux::query_accurate_process_memory_info(&info) && info.rss != -1) {\n-    size = info.rss * K;\n+  os::Linux::accurate_meminfo_t accurate_info;\n+  if (os::Linux::query_accurate_process_memory_info(&accurate_info) && accurate_info.rss != -1) {\n+    size = accurate_info.rss * K;\n@@ -2377,2 +2377,6 @@\n-  const int num_values = sizeof(os::Linux::accurate_meminfo_t) \/ sizeof(size_t);\n-  int num_found = 0;\n+  if (f == nullptr) {\n+    return false;\n+  }\n+\n+  const size_t num_values = sizeof(os::Linux::accurate_meminfo_t) \/ sizeof(size_t);\n+  size_t num_found = 0;\n@@ -2382,14 +2386,13 @@\n-  if (f != nullptr) {\n-    while (::fgets(buf, sizeof(buf), f) != nullptr && num_found < num_values) {\n-      if ( (info->rss == -1        && sscanf(buf, \"Rss: %zd kB\", &info->rss) == 1) ||\n-           (info->pss == -1        && sscanf(buf, \"Pss: %zd kB\", &info->pss) == 1) ||\n-           (info->pssdirty == -1   && sscanf(buf, \"Pss_Dirty: %zd kB\", &info->pssdirty) == 1) ||\n-           (info->pssanon == -1    && sscanf(buf, \"Pss_Anon: %zd kB\", &info->pssanon) == 1) ||\n-           (info->pssfile == -1    && sscanf(buf, \"Pss_File: %zd kB\", &info->pssfile) == 1) ||\n-           (info->pssshmem == -1   && sscanf(buf, \"Pss_Shmem: %zd kB\", &info->pssshmem) == 1) ||\n-           (info->swap == -1       && sscanf(buf, \"Swap: %zd kB\", &info->swap) == 1) ||\n-           (info->swappss == -1    && sscanf(buf, \"SwapPss: %zd kB\", &info->swappss) == 1)\n-           )\n-      {\n-        num_found ++;\n-      }\n+\n+  while (::fgets(buf, sizeof(buf), f) != nullptr && num_found < num_values) {\n+    if ( (info->rss == -1        && sscanf(buf, \"Rss: %zd kB\", &info->rss) == 1) ||\n+         (info->pss == -1        && sscanf(buf, \"Pss: %zd kB\", &info->pss) == 1) ||\n+         (info->pssdirty == -1   && sscanf(buf, \"Pss_Dirty: %zd kB\", &info->pssdirty) == 1) ||\n+         (info->pssanon == -1    && sscanf(buf, \"Pss_Anon: %zd kB\", &info->pssanon) == 1) ||\n+         (info->pssfile == -1    && sscanf(buf, \"Pss_File: %zd kB\", &info->pssfile) == 1) ||\n+         (info->pssshmem == -1   && sscanf(buf, \"Pss_Shmem: %zd kB\", &info->pssshmem) == 1) ||\n+         (info->swap == -1       && sscanf(buf, \"Swap: %zd kB\", &info->swap) == 1) ||\n+         (info->swappss == -1    && sscanf(buf, \"SwapPss: %zd kB\", &info->swappss) == 1)\n+         )\n+    {\n+      num_found ++;\n@@ -2397,2 +2400,0 @@\n-    fclose(f);\n-    return true;\n@@ -2400,1 +2401,2 @@\n-  return false;\n+  fclose(f);\n+  return true;\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":24,"deletions":22,"binary":false,"changes":46,"status":"modified"}]}