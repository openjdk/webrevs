{"files":[{"patch":"@@ -35,1 +35,1 @@\n- * @library \/test\/lib\n+ * @library \/test\/lib \/javax\/net\/ssl\/templates\n@@ -52,1 +52,1 @@\n-public class NonAutoClose {\n+import static jdk.test.lib.Asserts.assertEquals;\n@@ -54,7 +54,1 @@\n-    \/*\n-     * Where do we find the keystores?\n-     *\/\n-    private final static String pathToStores = \"..\/..\/..\/..\/javax\/net\/ssl\/etc\";\n-    private final static String keyStoreFile = \"keystore\";\n-    private final static String trustStoreFile = \"truststore\";\n-    private final static String passwd = \"passphrase\";\n+public class NonAutoClose extends SSLContextTemplate {\n@@ -70,1 +64,1 @@\n-    private final static boolean DEBUG = false;\n+    private final static boolean DEBUG = Boolean.getBoolean(\"test.debug\");\n@@ -77,8 +71,0 @@\n-    private void expectValue(int got, int expected, String msg) throws IOException {\n-        if (got != expected) {\n-            throw new IOException(msg + \": read (\" + got\n-                + \") but expecting(\" + expected + \")\");\n-        }\n-    }\n-\n-\n@@ -90,2 +76,1 @@\n-        SSLSocketFactory sslsf =\n-                (SSLSocketFactory) SSLSocketFactory.getDefault();\n+        SSLSocketFactory sslsf = createServerSSLContext().getSocketFactory();\n@@ -106,1 +91,1 @@\n-                expectValue(is.read(), PLAIN_CLIENT_VAL, \"Server\");\n+                assertEquals(PLAIN_CLIENT_VAL, is.read());\n@@ -126,1 +111,1 @@\n-                            expectValue(sslis.read(), TLS_CLIENT_VAL, \"Server\");\n+                            assertEquals(TLS_CLIENT_VAL, sslis.read());\n@@ -134,1 +119,1 @@\n-                expectValue(is.read(), PLAIN_CLIENT_VAL, \"Server\");\n+                assertEquals(PLAIN_CLIENT_VAL, is.read());\n@@ -154,2 +139,1 @@\n-        SSLSocketFactory sslsf =\n-                (SSLSocketFactory) SSLSocketFactory.getDefault();\n+        SSLSocketFactory sslsf = createClientSSLContext().getSocketFactory();\n@@ -164,1 +148,1 @@\n-            expectValue(is.read(), PLAIN_SERVER_VAL, \"Client\");\n+            assertEquals(PLAIN_SERVER_VAL, is.read());\n@@ -182,1 +166,1 @@\n-                    expectValue(sslis.read(), TLS_SERVER_VAL, \"Client\");\n+                    assertEquals(TLS_SERVER_VAL, sslis.read());\n@@ -188,1 +172,1 @@\n-            expectValue(is.read(), PLAIN_SERVER_VAL, \"Client\");\n+            assertEquals(PLAIN_SERVER_VAL, is.read());\n@@ -200,7 +184,0 @@\n-    private final static String keyFilename =\n-            System.getProperty(\"test.src\", \".\") + \"\/\" + pathToStores +\n-                    \"\/\" + keyStoreFile;\n-    private final static String trustFilename =\n-            System.getProperty(\"test.src\", \".\") + \"\/\" + pathToStores +\n-                    \"\/\" + trustStoreFile;\n-\n@@ -212,4 +189,0 @@\n-        System.setProperty(\"javax.net.ssl.keyStore\", keyFilename);\n-        System.setProperty(\"javax.net.ssl.keyStorePassword\", passwd);\n-        System.setProperty(\"javax.net.ssl.trustStore\", trustFilename);\n-        System.setProperty(\"javax.net.ssl.trustStorePassword\", passwd);\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLSocketImpl\/NonAutoClose.java","additions":12,"deletions":39,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n- * @library \/test\/lib\n+ * @library \/test\/lib \/javax\/net\/ssl\/templates\n@@ -59,1 +59,1 @@\n-public class SetClientMode {\n+public class SetClientMode extends SSLContextTemplate {\n@@ -63,8 +63,0 @@\n-    \/*\n-     * Where do we find the keystores?\n-     *\/\n-    private final static String pathToStores = \"..\/..\/..\/..\/javax\/net\/ssl\/etc\";\n-    private final static String keyStoreFile = \"keystore\";\n-    private final static String trustStoreFile = \"truststore\";\n-    private final static String passwd = \"passphrase\";\n-\n@@ -77,11 +69,0 @@\n-        String keyFilename =\n-            System.getProperty(\"test.src\", \".\/\") + \"\/\" + pathToStores +\n-                \"\/\" + keyStoreFile;\n-        String trustFilename =\n-            System.getProperty(\"test.src\", \".\/\") + \"\/\" + pathToStores +\n-                \"\/\" + trustStoreFile;\n-\n-        System.setProperty(\"javax.net.ssl.keyStore\", keyFilename);\n-        System.setProperty(\"javax.net.ssl.keyStorePassword\", passwd);\n-        System.setProperty(\"javax.net.ssl.trustStore\", trustFilename);\n-        System.setProperty(\"javax.net.ssl.trustStorePassword\", passwd);\n@@ -94,2 +75,1 @@\n-        SSLServerSocketFactory ssf =\n-            (SSLServerSocketFactory) SSLServerSocketFactory.getDefault();\n+        SSLServerSocketFactory ssf = createServerSSLContext().getServerSocketFactory();\n@@ -103,1 +83,1 @@\n-            SSLSocketFactory sf = (SSLSocketFactory) SSLSocketFactory.getDefault();\n+            SSLSocketFactory sf = createClientSSLContext().getSocketFactory();\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLSocketImpl\/SetClientMode.java","additions":4,"deletions":24,"binary":false,"changes":28,"status":"modified"}]}