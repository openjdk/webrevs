{"files":[{"patch":"@@ -343,0 +343,1 @@\n+        int spill_offset = offset - reg_save_index * BytesPerWord;\n@@ -344,2 +345,6 @@\n-          _masm->addi(spill_addr, R1_SP, offset - reg_save_index * BytesPerWord);\n-          _masm->stxvd2x(vs_reg, spill_addr);\n+          if (PowerArchitecturePPC64 >= 9) {\n+            _masm->stxv(vs_reg, spill_offset, R1_SP);\n+          } else {\n+            _masm->addi(spill_addr, R1_SP, spill_offset);\n+            _masm->stxvd2x(vs_reg, spill_addr);\n+          }\n@@ -347,2 +352,6 @@\n-          _masm->addi(spill_addr, R1_SP, offset - reg_save_index * BytesPerWord);\n-          _masm->lxvd2x(vs_reg, spill_addr);\n+          if (PowerArchitecturePPC64 >= 9) {\n+            _masm->lxv(vs_reg, spill_offset, R1_SP);\n+          } else {\n+            _masm->addi(spill_addr, R1_SP, spill_offset);\n+            _masm->lxvd2x(vs_reg, spill_addr);\n+          }\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/shared\/barrierSetAssembler_ppc.cpp","additions":13,"deletions":4,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -1821,3 +1821,11 @@\n-      if (masm) {\n-        __ addi(R0, R1_SP, dst_offset);\n-        __ stxvd2x(Rsrc, R0);\n+      if (PowerArchitecturePPC64 >= 9) {\n+        if (masm) {\n+          __ stxv(Rsrc, dst_offset, R1_SP);\n+        }\n+        size += 4;\n+      } else {\n+        if (masm) {\n+          __ addi(R0, R1_SP, dst_offset);\n+          __ stxvd2x(Rsrc, R0);\n+        }\n+        size += 8;\n@@ -1825,1 +1833,0 @@\n-      size += 8;\n@@ -1831,3 +1838,11 @@\n-      if (masm) {\n-        __ addi(R0, R1_SP, src_offset);\n-        __ lxvd2x(Rdst, R0);\n+      if (PowerArchitecturePPC64 >= 9) {\n+        if (masm) {\n+          __ lxv(Rdst, src_offset, R1_SP);\n+        }\n+        size += 4;\n+      } else {\n+        if (masm) {\n+          __ addi(R0, R1_SP, src_offset);\n+          __ lxvd2x(Rdst, R0);\n+        }\n+        size += 8;\n@@ -1835,1 +1850,0 @@\n-      size += 8;\n","filename":"src\/hotspot\/cpu\/ppc\/ppc.ad","additions":22,"deletions":8,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -357,3 +357,18 @@\n-  for (int i = 0; i < vsregstosave_num; i++) {\n-    int reg_num  = RegisterSaver_LiveVSRegs[i].reg_num;\n-    int reg_type = RegisterSaver_LiveVSRegs[i].reg_type;\n+  if (PowerArchitecturePPC64 >= 10) {\n+    for (int i = 0; i < vsregstosave_num; i += 2) {\n+      int reg_num  = RegisterSaver_LiveVSRegs[i].reg_num;\n+      assert(RegisterSaver_LiveVSRegs[i + 1].reg_num == reg_num + 1, \"or use other instructions!\");\n+\n+      __ stxvp(as_VectorSRegister(reg_num), offset, R1_SP);\n+\n+      if (generate_oop_map) {\n+        map->set_callee_saved(VMRegImpl::stack2reg(offset >> 2),\n+                              RegisterSaver_LiveVSRegs[i].vmreg);\n+        map->set_callee_saved(VMRegImpl::stack2reg((offset + vs_reg_size) >> 2),\n+                              RegisterSaver_LiveVSRegs[i + 1].vmreg);\n+      }\n+      offset += (2 * vs_reg_size);\n+    }\n+  } else {\n+    for (int i = 0; i < vsregstosave_num; i++) {\n+      int reg_num  = RegisterSaver_LiveVSRegs[i].reg_num;\n@@ -361,2 +376,2 @@\n-    __ li(R30, offset);\n-    __ stxvd2x(as_VectorSRegister(reg_num), R30, R1_SP);\n+      __ li(R31, offset);\n+      __ stxvd2x(as_VectorSRegister(reg_num), R31, R1_SP);\n@@ -364,3 +379,5 @@\n-    if (generate_oop_map) {\n-      map->set_callee_saved(VMRegImpl::stack2reg(offset>>2),\n-                            RegisterSaver_LiveVSRegs[i].vmreg);\n+      if (generate_oop_map) {\n+        map->set_callee_saved(VMRegImpl::stack2reg(offset >> 2),\n+                              RegisterSaver_LiveVSRegs[i].vmreg);\n+      }\n+      offset += vs_reg_size;\n@@ -368,1 +385,0 @@\n-    offset += vs_reg_size;\n@@ -431,3 +447,4 @@\n-  for (int i = 0; i < vsregstosave_num; i++) {\n-    int reg_num  = RegisterSaver_LiveVSRegs[i].reg_num;\n-    int reg_type = RegisterSaver_LiveVSRegs[i].reg_type;\n+  if (PowerArchitecturePPC64 >= 10) {\n+    for (int i = 0; i < vsregstosave_num; i += 2) {\n+      int reg_num  = RegisterSaver_LiveVSRegs[i].reg_num;\n+      assert(RegisterSaver_LiveVSRegs[i + 1].reg_num == reg_num + 1, \"or use other instructions!\");\n@@ -435,2 +452,1 @@\n-    __ li(R31, offset);\n-    __ lxvd2x(as_VectorSRegister(reg_num), R31, R1_SP);\n+      __ lxvp(as_VectorSRegister(reg_num), offset, R1_SP);\n@@ -438,1 +454,11 @@\n-    offset += vs_reg_size;\n+      offset += (2 * vs_reg_size);\n+    }\n+  } else {\n+    for (int i = 0; i < vsregstosave_num; i++) {\n+      int reg_num  = RegisterSaver_LiveVSRegs[i].reg_num;\n+\n+      __ li(R31, offset);\n+      __ lxvd2x(as_VectorSRegister(reg_num), R31, R1_SP);\n+\n+      offset += vs_reg_size;\n+    }\n","filename":"src\/hotspot\/cpu\/ppc\/sharedRuntime_ppc.cpp","additions":41,"deletions":15,"binary":false,"changes":56,"status":"modified"}]}