{"files":[{"patch":"@@ -80,0 +80,29 @@\n+\n+\/\/ Scavenges a single oop in a ClassLoaderData.\n+class PSScavengeCLDOopClosure : public OopClosure {\n+  PSPromotionManager* _pm;\n+\n+public:\n+  \/\/ Records whether this CLD contains oops pointing into young-gen after scavenging.\n+  bool _has_oops_into_young_gen;\n+\n+  PSScavengeCLDOopClosure(PSPromotionManager* pm) : _pm(pm), _has_oops_into_young_gen(false) {}\n+\n+  void do_oop(narrowOop* p) { ShouldNotReachHere(); }\n+  void do_oop(oop* p) {\n+    ParallelScavengeHeap* psh = ParallelScavengeHeap::heap();\n+    assert(!psh->is_in_reserved(p), \"GC barrier needed\");\n+    if (PSScavenge::should_scavenge(p)) {\n+      assert(PSScavenge::should_scavenge(p, true), \"revisiting object?\");\n+\n+      oop o = RawAccess<IS_NOT_NULL>::oop_load(p);\n+      oop new_obj = _pm->copy_to_survivor_space<\/*promote_immediately=*\/false>(o);\n+      RawAccess<IS_NOT_NULL>::oop_store(p, new_obj);\n+\n+      if (PSScavenge::is_obj_in_young(new_obj) && !_has_oops_into_young_gen) {\n+        _has_oops_into_young_gen = true;\n+      }\n+    }\n+  }\n+};\n+\n@@ -93,28 +122,1 @@\n-    \/\/ Scavenges a single oop in a ClassLoaderData.\n-    class CLDOopClosure : public OopClosure {\n-      PSPromotionManager* _pm;\n-\n-    public:\n-      \/\/ Records whether this CLD contains oops pointing into young-gen after scavenging.\n-      bool _has_oop_into_young_gen;\n-\n-      CLDOopClosure(PSPromotionManager* pm) : _pm(pm), _has_oop_into_young_gen(false) {}\n-\n-      void do_oop(narrowOop* p) { ShouldNotReachHere(); }\n-      void do_oop(oop* p) {\n-        ParallelScavengeHeap* psh = ParallelScavengeHeap::heap();\n-        assert(!psh->is_in_reserved(p), \"GC barrier needed\");\n-        if (PSScavenge::should_scavenge(p)) {\n-          assert(PSScavenge::should_scavenge(p, true), \"revisiting object?\");\n-\n-          oop o = RawAccess<IS_NOT_NULL>::oop_load(p);\n-          oop new_obj = _pm->copy_to_survivor_space<\/*promote_immediately=*\/false>(o);\n-          RawAccess<IS_NOT_NULL>::oop_store(p, new_obj);\n-\n-          if (PSScavenge::is_obj_in_young(new_obj) && !_has_oop_into_young_gen) {\n-            _has_oop_into_young_gen = true;\n-          }\n-        }\n-      }\n-    } oop_closure{_pm};\n-\n+    PSScavengeCLDOopClosure oop_closure{_pm};\n@@ -124,1 +126,1 @@\n-    if (oop_closure._has_oop_into_young_gen) {\n+    if (oop_closure._has_oops_into_young_gen) {\n","filename":"src\/hotspot\/share\/gc\/parallel\/psClosure.inline.hpp","additions":31,"deletions":29,"binary":false,"changes":60,"status":"modified"}]}