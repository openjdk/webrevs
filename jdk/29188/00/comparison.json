{"files":[{"patch":"@@ -31,1 +31,0 @@\n-#include \"os_linux.hpp\"\n@@ -608,0 +607,5 @@\n+void CgroupSubsystem::adjust_controllers(physical_memory_size_type upper_mem_bound, int upper_cpu_bound) {\n+  CgroupUtil::adjust_controller(memory_controller()->controller(), upper_mem_bound);\n+  CgroupUtil::adjust_controller(cpu_controller()->controller(), upper_cpu_bound);\n+}\n+\n@@ -634,1 +638,1 @@\n-bool CgroupSubsystem::active_processor_count(int& value) {\n+bool CgroupSubsystem::active_processor_count(int (*cpu_bound_func)(), int& value) {\n@@ -649,1 +653,1 @@\n-  cpu_count = os::Linux::active_processor_count();\n+  cpu_count = cpu_bound_func();\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.cpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -280,1 +280,1 @@\n-    bool active_processor_count(int& value);\n+    bool active_processor_count(int (*cpu_bound_func)(), int& value);\n@@ -293,0 +293,2 @@\n+    void adjust_controllers(physical_memory_size_type upper_mem_bound, int upper_cpu_bound);\n+\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -26,1 +26,0 @@\n-#include \"os_linux.hpp\"\n@@ -90,1 +89,1 @@\n-void CgroupUtil::adjust_controller(CgroupMemoryController* mem) {\n+void CgroupUtil::adjust_controller(CgroupMemoryController* mem, physical_memory_size_type upper_bound) {\n@@ -108,1 +107,0 @@\n-  physical_memory_size_type phys_mem = os::Linux::physical_memory();\n@@ -111,3 +109,3 @@\n-  physical_memory_size_type lowest_limit = phys_mem;\n-  lowest_limit = get_updated_mem_limit(mem, lowest_limit, phys_mem);\n-  physical_memory_size_type orig_limit = lowest_limit != phys_mem ? lowest_limit : phys_mem;\n+  physical_memory_size_type lowest_limit = upper_bound;\n+  lowest_limit = get_updated_mem_limit(mem, lowest_limit, upper_bound);\n+  physical_memory_size_type orig_limit = lowest_limit != upper_bound ? lowest_limit : upper_bound;\n@@ -118,1 +116,1 @@\n-    limit = get_updated_mem_limit(mem, lowest_limit, phys_mem);\n+    limit = get_updated_mem_limit(mem, lowest_limit, upper_bound);\n@@ -127,1 +125,1 @@\n-  limit = get_updated_mem_limit(mem, lowest_limit, phys_mem);\n+  limit = get_updated_mem_limit(mem, lowest_limit, upper_bound);\n@@ -133,1 +131,1 @@\n-  assert(lowest_limit <= phys_mem, \"limit must not exceed host memory\");\n+  assert(lowest_limit <= upper_bound, \"limit must not exceed upper bound\");\n@@ -155,1 +153,1 @@\n-void CgroupUtil::adjust_controller(CgroupCpuController* cpu) {\n+void CgroupUtil::adjust_controller(CgroupCpuController* cpu, int upper_bound) {\n@@ -173,4 +171,3 @@\n-  int host_cpus = os::Linux::active_processor_count();\n-  int lowest_limit = host_cpus;\n-  int cpus = get_updated_cpu_limit(cpu, lowest_limit, host_cpus);\n-  int orig_limit = lowest_limit != host_cpus ? lowest_limit : host_cpus;\n+  int lowest_limit = upper_bound;\n+  int cpus = get_updated_cpu_limit(cpu, lowest_limit, upper_bound);\n+  int orig_limit = lowest_limit != upper_bound ? lowest_limit : upper_bound;\n@@ -182,2 +179,2 @@\n-    cpus = get_updated_cpu_limit(cpu, lowest_limit, host_cpus);\n-    if (cpus != host_cpus && cpus < lowest_limit) {\n+    cpus = get_updated_cpu_limit(cpu, lowest_limit, upper_bound);\n+    if (cpus != upper_bound && cpus < lowest_limit) {\n@@ -191,2 +188,2 @@\n-  cpus = get_updated_cpu_limit(cpu, lowest_limit, host_cpus);\n-  if (cpus != host_cpus && cpus < lowest_limit) {\n+  cpus = get_updated_cpu_limit(cpu, lowest_limit, upper_bound);\n+  if (cpus != upper_bound && cpus < lowest_limit) {\n","filename":"src\/hotspot\/os\/linux\/cgroupUtil_linux.cpp","additions":15,"deletions":18,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -37,1 +37,1 @@\n-    static void adjust_controller(CgroupMemoryController* m);\n+    static void adjust_controller(CgroupMemoryController* m, physical_memory_size_type upper_bound);\n@@ -40,1 +40,1 @@\n-    static void adjust_controller(CgroupCpuController* c);\n+    static void adjust_controller(CgroupCpuController* c, int upper_bound);\n","filename":"src\/hotspot\/os\/linux\/cgroupUtil_linux.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -329,2 +329,0 @@\n-  CgroupUtil::adjust_controller(memory);\n-  CgroupUtil::adjust_controller(cpu);\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -157,2 +157,0 @@\n-  CgroupUtil::adjust_controller(memory);\n-  CgroupUtil::adjust_controller(cpu);\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -62,0 +62,5 @@\n+  \/\/ Adjust controller paths once subsystem is initialized\n+  physical_memory_size_type phys_mem = os::Linux::physical_memory();\n+  int host_cpus = os::Linux::active_processor_count();\n+  cgroup_subsystem->adjust_controllers(phys_mem, host_cpus);\n+\n@@ -257,1 +262,1 @@\n-  return cgroup_subsystem->active_processor_count(value);\n+  return cgroup_subsystem->active_processor_count(&os::Linux::active_processor_count, value);\n","filename":"src\/hotspot\/os\/linux\/osContainer_linux.cpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -482,1 +482,1 @@\n-  CgroupUtil::adjust_controller(ccc);\n+  CgroupUtil::adjust_controller(ccc, 1);\n@@ -492,1 +492,1 @@\n-  CgroupUtil::adjust_controller(cmc);\n+  CgroupUtil::adjust_controller(cmc, (physical_memory_size_type)1024);\n@@ -515,1 +515,1 @@\n-  CgroupUtil::adjust_controller(ccc);\n+  CgroupUtil::adjust_controller(ccc, 1);\n@@ -524,1 +524,1 @@\n-  CgroupUtil::adjust_controller(cmc);\n+  CgroupUtil::adjust_controller(cmc, (physical_memory_size_type)1024);\n","filename":"test\/hotspot\/gtest\/runtime\/test_cgroupSubsystem_linux.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}