{"files":[{"patch":"@@ -31,1 +31,0 @@\n-#include \"os_linux.hpp\"\n@@ -608,0 +607,5 @@\n+void CgroupSubsystem::adjust_controllers(physical_memory_size_type upper_mem_bound, int upper_cpu_bound) {\n+  CgroupUtil::adjust_controller(memory_controller()->controller(), upper_mem_bound);\n+  CgroupUtil::adjust_controller(cpu_controller()->controller(), upper_cpu_bound);\n+}\n+\n@@ -634,1 +638,1 @@\n-bool CgroupSubsystem::active_processor_count(double& value) {\n+bool CgroupSubsystem::active_processor_count(int (*cpu_bound_func)(), double& value) {\n@@ -646,1 +650,1 @@\n-  int cpu_count = os::Linux::active_processor_count();\n+  int cpu_count = cpu_bound_func();\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.cpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -281,1 +281,1 @@\n-    bool active_processor_count(double& value);\n+    bool active_processor_count(int (*cpu_bound_func)(), double& value);\n@@ -294,0 +294,2 @@\n+    void adjust_controllers(physical_memory_size_type upper_mem_bound, int upper_cpu_bound);\n+\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-#include \"os_linux.hpp\"\n@@ -85,1 +84,1 @@\n-void CgroupUtil::adjust_controller(CgroupMemoryController* mem) {\n+void CgroupUtil::adjust_controller(CgroupMemoryController* mem, physical_memory_size_type upper_bound) {\n@@ -103,1 +102,0 @@\n-  physical_memory_size_type phys_mem = os::Linux::physical_memory();\n@@ -106,3 +104,3 @@\n-  physical_memory_size_type lowest_limit = phys_mem;\n-  lowest_limit = get_updated_mem_limit(mem, lowest_limit, phys_mem);\n-  physical_memory_size_type orig_limit = lowest_limit != phys_mem ? lowest_limit : phys_mem;\n+  physical_memory_size_type lowest_limit = upper_bound;\n+  lowest_limit = get_updated_mem_limit(mem, lowest_limit, upper_bound);\n+  physical_memory_size_type orig_limit = lowest_limit != upper_bound ? lowest_limit : upper_bound;\n@@ -113,1 +111,1 @@\n-    limit = get_updated_mem_limit(mem, lowest_limit, phys_mem);\n+    limit = get_updated_mem_limit(mem, lowest_limit, upper_bound);\n@@ -122,1 +120,1 @@\n-  limit = get_updated_mem_limit(mem, lowest_limit, phys_mem);\n+  limit = get_updated_mem_limit(mem, lowest_limit, upper_bound);\n@@ -128,1 +126,1 @@\n-  assert(lowest_limit <= phys_mem, \"limit must not exceed host memory\");\n+  assert(lowest_limit <= upper_bound, \"limit must not exceed upper bound\");\n@@ -150,1 +148,1 @@\n-void CgroupUtil::adjust_controller(CgroupCpuController* cpu) {\n+void CgroupUtil::adjust_controller(CgroupCpuController* cpu, int upper_bound) {\n@@ -168,4 +166,3 @@\n-  int host_cpus = os::Linux::active_processor_count();\n-  int lowest_limit = host_cpus;\n-  double cpus = get_updated_cpu_limit(cpu, lowest_limit, host_cpus);\n-  int orig_limit = lowest_limit != host_cpus ? lowest_limit : host_cpus;\n+  int lowest_limit = upper_bound;\n+  double cpus = get_updated_cpu_limit(cpu, lowest_limit, upper_bound);\n+  int orig_limit = lowest_limit != upper_bound ? lowest_limit : upper_bound;\n@@ -177,2 +174,2 @@\n-    cpus = get_updated_cpu_limit(cpu, lowest_limit, host_cpus);\n-    if (cpus != host_cpus && cpus < lowest_limit) {\n+    cpus = get_updated_cpu_limit(cpu, lowest_limit, upper_bound);\n+    if (cpus != upper_bound && cpus < lowest_limit) {\n@@ -186,2 +183,2 @@\n-  cpus = get_updated_cpu_limit(cpu, lowest_limit, host_cpus);\n-  if (cpus != host_cpus && cpus < lowest_limit) {\n+  cpus = get_updated_cpu_limit(cpu, lowest_limit, upper_bound);\n+  if (cpus != upper_bound && cpus < lowest_limit) {\n","filename":"src\/hotspot\/os\/linux\/cgroupUtil_linux.cpp","additions":15,"deletions":18,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-    static void adjust_controller(CgroupMemoryController* m);\n+    static void adjust_controller(CgroupMemoryController* m, physical_memory_size_type upper_bound);\n@@ -41,1 +41,1 @@\n-    static void adjust_controller(CgroupCpuController* c);\n+    static void adjust_controller(CgroupCpuController* c, int upper_bound);\n","filename":"src\/hotspot\/os\/linux\/cgroupUtil_linux.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -329,2 +329,0 @@\n-  CgroupUtil::adjust_controller(memory);\n-  CgroupUtil::adjust_controller(cpu);\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -157,2 +157,0 @@\n-  CgroupUtil::adjust_controller(memory);\n-  CgroupUtil::adjust_controller(cpu);\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -62,0 +62,5 @@\n+  \/\/ Adjust controller paths once subsystem is initialized\n+  physical_memory_size_type phys_mem = os::Linux::physical_memory();\n+  int host_cpus = os::Linux::active_processor_count();\n+  cgroup_subsystem->adjust_controllers(phys_mem, host_cpus);\n+\n@@ -255,1 +260,1 @@\n-  return cgroup_subsystem->active_processor_count(value);\n+  return cgroup_subsystem->active_processor_count(&os::Linux::active_processor_count, value);\n","filename":"src\/hotspot\/os\/linux\/osContainer_linux.cpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -482,1 +482,1 @@\n-  CgroupUtil::adjust_controller(ccc);\n+  CgroupUtil::adjust_controller(ccc, 1);\n@@ -492,1 +492,1 @@\n-  CgroupUtil::adjust_controller(cmc);\n+  CgroupUtil::adjust_controller(cmc, (physical_memory_size_type)1024);\n@@ -515,1 +515,1 @@\n-  CgroupUtil::adjust_controller(ccc);\n+  CgroupUtil::adjust_controller(ccc, 1);\n@@ -524,1 +524,1 @@\n-  CgroupUtil::adjust_controller(cmc);\n+  CgroupUtil::adjust_controller(cmc, (physical_memory_size_type)1024);\n","filename":"test\/hotspot\/gtest\/runtime\/test_cgroupSubsystem_linux.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}