{"files":[{"patch":"@@ -3176,1 +3176,1 @@\n-      size_t free = capacity() - used();\n+      size_t free = capacity_holding_lock() - used_holding_lock();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFreeSet.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -785,3 +785,6 @@\n-  \/\/ locked action can be seen by these unlocked functions.  All three functions will wait for freeset rebulid to\n-  \/\/ complete before returning an intermediate value that is not meaningful.\n-  inline size_t capacity() {\n+  \/\/ locked action can be seen by these unlocked functions.\n+  inline size_t capacity_holding_lock() const {\n+    shenandoah_assert_heaplocked();\n+    return _partitions.capacity_of(ShenandoahFreeSetPartitionId::Mutator);\n+  }\n+  inline size_t capacity_not_holding_lock() {\n@@ -792,1 +795,5 @@\n-  inline size_t used() {\n+  inline size_t used_holding_lock() const {\n+    shenandoah_assert_heaplocked();\n+    return _partitions.used_by(ShenandoahFreeSetPartitionId::Mutator);\n+  }\n+  inline size_t used_not_holding_lock() {\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFreeSet.hpp","additions":11,"deletions":4,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -1651,1 +1651,1 @@\n-  return _free_set->capacity();\n+  return _free_set->capacity_not_holding_lock();\n@@ -2131,1 +2131,1 @@\n-  return _free_set->used();\n+  return _free_set->used_not_holding_lock();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-  , _used_before(free_set->used())\n+  , _used_before(free_set->used_not_holding_lock())\n@@ -54,1 +54,1 @@\n-  const size_t used_after = _free_set->used();\n+  const size_t used_after = _free_set->used_not_holding_lock();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahMetrics.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}