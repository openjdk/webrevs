{"files":[{"patch":"@@ -785,3 +785,12 @@\n-  \/\/ locked action can be seen by these unlocked functions.\n-  inline size_t capacity()  const { return _partitions.capacity_of(ShenandoahFreeSetPartitionId::Mutator);             }\n-  inline size_t used()      const { return _partitions.used_by(ShenandoahFreeSetPartitionId::Mutator);                 }\n+  \/\/ locked action can be seen by these unlocked functions.  All three functions will wait for freeset rebulid to\n+  \/\/ complete before returning an intermediate value that is not meaningful.\n+  inline size_t capacity() {\n+    shenandoah_assert_not_heaplocked();\n+    ShenandoahRebuildLocker locker(rebuild_lock());\n+    return _partitions.capacity_of(ShenandoahFreeSetPartitionId::Mutator);\n+  }\n+  inline size_t used() {\n+    shenandoah_assert_not_heaplocked();\n+    ShenandoahRebuildLocker locker(rebuild_lock());\n+    return _partitions.used_by(ShenandoahFreeSetPartitionId::Mutator);\n+  }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFreeSet.hpp","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"}]}