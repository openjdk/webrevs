{"files":[{"patch":"@@ -51,3 +51,1 @@\n-        long address = SegmentFactories.allocateNative(byteSize, byteAlignment, session, shouldReserveMemory, false);\n-        \/\/ Must be called after SegmentFactories.allocateNative to avoid class initialization cycles\n-        return new NativeMemorySegmentImpl(address, byteSize, false, session);\n+        return SegmentFactories.allocateNativeSegment(byteSize, byteAlignment, session, shouldReserveMemory, false);\n@@ -58,3 +56,1 @@\n-        long address = SegmentFactories.allocateNative(byteSize, byteAlignment, session, shouldReserveMemory, true);\n-        \/\/ Must be called after SegmentFactories.allocateNative to avoid class initialization cycles\n-        return new NativeMemorySegmentImpl(address, byteSize, false, session);\n+        return SegmentFactories.allocateNativeSegment(byteSize, byteAlignment, session, shouldReserveMemory, true);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/ArenaImpl.java","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -179,2 +179,8 @@\n-    public static long allocateNative(long byteSize, long byteAlignment, MemorySessionImpl sessionImpl,\n-                                      boolean shouldReserve, boolean init) {\n+    public static NativeMemorySegmentImpl allocateNativeSegment(long byteSize, long byteAlignment, MemorySessionImpl sessionImpl,\n+                                                                boolean shouldReserve, boolean init) {\n+        long address = SegmentFactories.allocateNativeInternal(byteSize, byteAlignment, sessionImpl, shouldReserve, init);\n+        return new NativeMemorySegmentImpl(address, byteSize, false, sessionImpl);\n+    }\n+\n+    private static long allocateNativeInternal(long byteSize, long byteAlignment, MemorySessionImpl sessionImpl,\n+                                               boolean shouldReserve, boolean init) {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/SegmentFactories.java","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"}]}