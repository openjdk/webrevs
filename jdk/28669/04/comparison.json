{"files":[{"patch":"@@ -43,0 +43,2 @@\n+#include \"gc\/shenandoah\/shenandoahOldGeneration.hpp\"\n+#include \"gc\/shenandoah\/shenandoahScanRemembered.hpp\"\n@@ -448,1 +450,2 @@\n-    if (!_heap->marking_context()->allocated_after_mark_start(reinterpret_cast<HeapWord*>(dst))) {\n+    if (_heap->heap_region_containing(dst)->is_old() ||\n+        !_heap->marking_context()->allocated_after_mark_start(reinterpret_cast<HeapWord*>(dst))) {\n@@ -450,0 +453,17 @@\n+#ifdef ASSERT\n+      if (_heap->heap_region_containing(dst)->is_old()) {\n+        ShenandoahScanRemembered* card_scan = ShenandoahGenerationalHeap::heap()->old_generation()->card_scan();\n+        T* end = dst + count;\n+        for (T* elem_ptr = dst; elem_ptr < end; elem_ptr++) {\n+          T o = RawAccess<>::oop_load(elem_ptr);\n+          if (!CompressedOops::is_null(o)) {\n+            HeapWord *elem_heap_word_ptr = reinterpret_cast<HeapWord*>(elem_ptr);\n+            oop obj = CompressedOops::decode_not_null(o);\n+            assert(!_heap->is_in_young(obj) ||\n+                   card_scan->is_card_dirty(elem_heap_word_ptr) ||\n+                   card_scan->is_write_card_dirty(elem_heap_word_ptr),\n+              \"Card should be dirty if the array element points to obj in young. Array element: \" PTR_FORMAT \", young object: \" PTR_FORMAT \"\", p2i(elem_ptr), p2i(obj));\n+          }\n+        }\n+      }\n+#endif \/\/ ASSERT\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.inline.hpp","additions":21,"deletions":1,"binary":false,"changes":22,"status":"modified"}]}