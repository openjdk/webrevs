{"files":[{"patch":"@@ -131,2 +131,2 @@\n-  template <class T>\n-  inline void arraycopy_marking(T* dst, size_t count);\n+  template <bool IS_GENERATIONAL, class T>\n+  void arraycopy_marking(T* dst, size_t count);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -43,2 +43,0 @@\n-#include \"gc\/shenandoah\/shenandoahOldGeneration.hpp\"\n-#include \"gc\/shenandoah\/shenandoahScanRemembered.hpp\"\n@@ -434,1 +432,5 @@\n-    arraycopy_marking(dst, count);\n+    if (_heap->mode()->is_generational()) {\n+     arraycopy_marking<true>(dst, count);\n+    } else {\n+      arraycopy_marking<false>(dst, count);\n+    }\n@@ -446,1 +448,1 @@\n-template <class T>\n+template <bool IS_GENERATIONAL, class T>\n@@ -451,1 +453,1 @@\n-        (_heap->mode()->is_generational() && _heap->heap_region_containing(dst)->is_old() && _heap->is_concurrent_young_mark_in_progress())) {\n+        (IS_GENERATIONAL && _heap->heap_region_containing(dst)->is_old() && _heap->is_concurrent_young_mark_in_progress())) {\n@@ -453,17 +455,0 @@\n-#ifdef ASSERT\n-      if (_heap->heap_region_containing(dst)->is_old()) {\n-        ShenandoahScanRemembered* card_scan = ShenandoahGenerationalHeap::heap()->old_generation()->card_scan();\n-        T* end = dst + count;\n-        for (T* elem_ptr = dst; elem_ptr < end; elem_ptr++) {\n-          T o = RawAccess<>::oop_load(elem_ptr);\n-          if (!CompressedOops::is_null(o)) {\n-            HeapWord *elem_heap_word_ptr = reinterpret_cast<HeapWord*>(elem_ptr);\n-            oop obj = CompressedOops::decode_not_null(o);\n-            assert(!_heap->is_in_young(obj) ||\n-                   card_scan->is_card_dirty(elem_heap_word_ptr) ||\n-                   card_scan->is_write_card_dirty(elem_heap_word_ptr),\n-              \"Card should be dirty if the array element points to obj in young. Array element: \" PTR_FORMAT \", young object: \" PTR_FORMAT \"\", p2i(elem_ptr), p2i(obj));\n-          }\n-        }\n-      }\n-#endif \/\/ ASSERT\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.inline.hpp","additions":7,"deletions":22,"binary":false,"changes":29,"status":"modified"}]}