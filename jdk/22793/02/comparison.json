{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -149,0 +149,21 @@\n+static void windows_preinit(HINSTANCE hinst) {\n+  vm_lib_handle = hinst;\n+  if (ForceTimeHighResolution) {\n+    timeBeginPeriod(1L);\n+  }\n+  WindowsDbgHelp::pre_initialize();\n+  SymbolEngine::pre_initialize();\n+}\n+\n+static void windows_atexit() {\n+  if (ForceTimeHighResolution) {\n+    timeEndPeriod(1L);\n+  }\n+#if defined(USE_VECTORED_EXCEPTION_HANDLING)\n+  if (topLevelVectoredExceptionHandler != nullptr) {\n+    RemoveVectoredExceptionHandler(topLevelVectoredExceptionHandler);\n+    topLevelVectoredExceptionHandler = nullptr;\n+  }\n+#endif\n+}\n+\n@@ -152,6 +173,1 @@\n-    vm_lib_handle = hinst;\n-    if (ForceTimeHighResolution) {\n-      timeBeginPeriod(1L);\n-    }\n-    WindowsDbgHelp::pre_initialize();\n-    SymbolEngine::pre_initialize();\n+    windows_preinit(hinst);\n@@ -160,9 +176,1 @@\n-    if (ForceTimeHighResolution) {\n-      timeEndPeriod(1L);\n-    }\n-#if defined(USE_VECTORED_EXCEPTION_HANDLING)\n-    if (topLevelVectoredExceptionHandler != nullptr) {\n-      RemoveVectoredExceptionHandler(topLevelVectoredExceptionHandler);\n-      topLevelVectoredExceptionHandler = nullptr;\n-    }\n-#endif\n+    windows_atexit();\n@@ -4428,0 +4436,10 @@\n+HMODULE GetHotspotModuleHandle() {\n+    HMODULE hModule = NULL;\n+    GetModuleHandleEx(\n+        GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS | GET_MODULE_HANDLE_EX_FLAG_UNCHANGED_REFCOUNT,\n+        (LPCTSTR) &GetHotspotModuleHandle,\n+        &hModule\n+    );\n+    return hModule;\n+}\n+\n@@ -4430,0 +4448,6 @@\n+  if (is_vm_statically_linked()) {\n+    \/\/ Mimick what is done in DllMain for non-static builds\n+    windows_preinit(GetHotspotModuleHandle());\n+    atexit(windows_atexit);\n+  }\n+\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":40,"deletions":16,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -529,1 +529,1 @@\n-\/\/ Called at DLL_PROCESS_ATTACH.\n+\/\/ Called at DLL_PROCESS_ATTACH for dynamic builds, and from os::init() for static builds.\n","filename":"src\/hotspot\/os\/windows\/symbolengine.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n-  \/\/ Call at DLL_PROCESS_ATTACH.\n+  \/\/ Called at DLL_PROCESS_ATTACH for dynamic builds, and from os::init() for static builds.\n","filename":"src\/hotspot\/os\/windows\/symbolengine.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -144,1 +144,1 @@\n-\/\/ Called at DLL_PROCESS_ATTACH.\n+\/\/ Called at DLL_PROCESS_ATTACH for dynamic builds, and from os::init() for static builds.\n","filename":"src\/hotspot\/os\/windows\/windbghelp.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,1 +70,1 @@\n-  \/\/ Call at DLL_PROCESS_ATTACH.\n+  \/\/ Called at DLL_PROCESS_ATTACH for dynamic builds, and from os::init() for static builds.\n","filename":"src\/hotspot\/os\/windows\/windbghelp.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}