{"files":[{"patch":"@@ -149,27 +149,0 @@\n-BOOL WINAPI DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved) {\n-  switch (reason) {\n-  case DLL_PROCESS_ATTACH:\n-    vm_lib_handle = hinst;\n-    if (ForceTimeHighResolution) {\n-      timeBeginPeriod(1L);\n-    }\n-    WindowsDbgHelp::pre_initialize();\n-    SymbolEngine::pre_initialize();\n-    break;\n-  case DLL_PROCESS_DETACH:\n-    if (ForceTimeHighResolution) {\n-      timeEndPeriod(1L);\n-    }\n-#if defined(USE_VECTORED_EXCEPTION_HANDLING)\n-    if (topLevelVectoredExceptionHandler != nullptr) {\n-      RemoveVectoredExceptionHandler(topLevelVectoredExceptionHandler);\n-      topLevelVectoredExceptionHandler = nullptr;\n-    }\n-#endif\n-    break;\n-  default:\n-    break;\n-  }\n-  return true;\n-}\n-\n@@ -4416,0 +4389,22 @@\n+HMODULE GetHotspotModuleHandle() {\n+    HMODULE hModule = NULL;\n+    GetModuleHandleEx(\n+        GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS | GET_MODULE_HANDLE_EX_FLAG_UNCHANGED_REFCOUNT,\n+        (LPCTSTR) &GetHotspotModuleHandle,\n+        &hModule\n+    );\n+    return hModule;\n+}\n+\n+static void windows_at_exit_callback() {\n+    if (ForceTimeHighResolution) {\n+      timeEndPeriod(1L);\n+    }\n+#if defined(USE_VECTORED_EXCEPTION_HANDLING)\n+    if (topLevelVectoredExceptionHandler != nullptr) {\n+      RemoveVectoredExceptionHandler(topLevelVectoredExceptionHandler);\n+      topLevelVectoredExceptionHandler = nullptr;\n+    }\n+#endif\n+}\n+\n@@ -4418,0 +4413,8 @@\n+    vm_lib_handle = GetHotspotModuleHandle();\n+    if (ForceTimeHighResolution) {\n+      timeBeginPeriod(1L);\n+    }\n+    WindowsDbgHelp::pre_initialize();\n+    SymbolEngine::pre_initialize();\n+    atexit(windows_at_exit_callback);\n+\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":30,"deletions":27,"binary":false,"changes":57,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -529,1 +529,0 @@\n-\/\/ Called at DLL_PROCESS_ATTACH.\n","filename":"src\/hotspot\/os\/windows\/symbolengine.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,0 @@\n-  \/\/ Call at DLL_PROCESS_ATTACH.\n","filename":"src\/hotspot\/os\/windows\/symbolengine.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -144,1 +144,0 @@\n-\/\/ Called at DLL_PROCESS_ATTACH.\n","filename":"src\/hotspot\/os\/windows\/windbghelp.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,1 +70,0 @@\n-  \/\/ Call at DLL_PROCESS_ATTACH.\n","filename":"src\/hotspot\/os\/windows\/windbghelp.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}