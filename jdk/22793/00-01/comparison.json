{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -149,0 +149,35 @@\n+static void windows_preinit(HINSTANCE hinst) {\n+  vm_lib_handle = hinst;\n+  if (ForceTimeHighResolution) {\n+    timeBeginPeriod(1L);\n+  }\n+  WindowsDbgHelp::pre_initialize();\n+  SymbolEngine::pre_initialize();\n+}\n+\n+static void windows_atexit() {\n+  if (ForceTimeHighResolution) {\n+    timeEndPeriod(1L);\n+  }\n+#if defined(USE_VECTORED_EXCEPTION_HANDLING)\n+  if (topLevelVectoredExceptionHandler != nullptr) {\n+    RemoveVectoredExceptionHandler(topLevelVectoredExceptionHandler);\n+    topLevelVectoredExceptionHandler = nullptr;\n+  }\n+#endif\n+}\n+\n+BOOL WINAPI DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved) {\n+  switch (reason) {\n+  case DLL_PROCESS_ATTACH:\n+    windows_preinit(hinst);\n+    break;\n+  case DLL_PROCESS_DETACH:\n+    windows_atexit();\n+    break;\n+  default:\n+    break;\n+  }\n+  return true;\n+}\n+\n@@ -4411,12 +4446,0 @@\n-static void windows_at_exit_callback() {\n-    if (ForceTimeHighResolution) {\n-      timeEndPeriod(1L);\n-    }\n-#if defined(USE_VECTORED_EXCEPTION_HANDLING)\n-    if (topLevelVectoredExceptionHandler != nullptr) {\n-      RemoveVectoredExceptionHandler(topLevelVectoredExceptionHandler);\n-      topLevelVectoredExceptionHandler = nullptr;\n-    }\n-#endif\n-}\n-\n@@ -4425,7 +4448,5 @@\n-    vm_lib_handle = GetHotspotModuleHandle();\n-    if (ForceTimeHighResolution) {\n-      timeBeginPeriod(1L);\n-    }\n-    WindowsDbgHelp::pre_initialize();\n-    SymbolEngine::pre_initialize();\n-    atexit(windows_at_exit_callback);\n+  if (is_vm_statically_linked()) {\n+    \/\/ Mimick what is done in DllMain for non-static builds\n+    windows_preinit(GetHotspotModuleHandle());\n+    atexit(windows_atexit);\n+  }\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":41,"deletions":20,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -529,0 +529,1 @@\n+\/\/ Called as early as possible\n","filename":"src\/hotspot\/os\/windows\/symbolengine.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,0 +61,1 @@\n+  \/\/ Called as early as possible\n","filename":"src\/hotspot\/os\/windows\/symbolengine.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -144,0 +144,1 @@\n+\/\/ Called as early as possible\n","filename":"src\/hotspot\/os\/windows\/windbghelp.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,0 +70,1 @@\n+  \/\/ Called as early as possible\n","filename":"src\/hotspot\/os\/windows\/windbghelp.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}