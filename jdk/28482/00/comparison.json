{"files":[{"patch":"@@ -50,1 +50,1 @@\n-  size_t new_count = AtomicAccess::add(&_refcount, count, memory_order_relaxed);\n+  size_t new_count = _refcount.add_then_fetch(count, memory_order_relaxed);\n@@ -95,1 +95,1 @@\n-  size_t refcount = AtomicAccess::sub(&state->_refcount, size_t(1), memory_order_release);\n+  size_t refcount = state->_refcount.sub_then_fetch(1u, memory_order_release);\n@@ -119,1 +119,1 @@\n-  uint idx = AtomicAccess::fetch_then_add(&_registered_allocators, 1u, memory_order_relaxed);\n+  uint idx = _registered_allocators.fetch_then_add(1u, memory_order_relaxed);\n@@ -126,2 +126,2 @@\n-  uint old = AtomicAccess::fetch_then_add(&_released_allocators, 1u, memory_order_relaxed);\n-  assert(old < AtomicAccess::load(&_registered_allocators), \"too many releases\");\n+  uint old = _released_allocators.fetch_then_add(1u, memory_order_relaxed);\n+  assert(old < _registered_allocators.load_relaxed(), \"too many releases\");\n@@ -132,2 +132,2 @@\n-  uint count = AtomicAccess::load(&_registered_allocators);\n-  assert(count == AtomicAccess::load(&_released_allocators),\n+  uint count = _registered_allocators.load_relaxed();\n+  assert(count == _released_allocators.load_relaxed(),\n@@ -138,2 +138,2 @@\n-  AtomicAccess::store(&_registered_allocators, 0u);\n-  DEBUG_ONLY(AtomicAccess::store(&_released_allocators, 0u);)\n+  _registered_allocators.store_relaxed(0u);\n+  DEBUG_ONLY(_released_allocators.store_relaxed(0u);)\n","filename":"src\/hotspot\/share\/gc\/shared\/partialArrayState.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -63,2 +64,2 @@\n-  volatile size_t _index;\n-  volatile size_t _refcount;\n+  Atomic<size_t> _index;\n+  Atomic<size_t> _refcount;\n@@ -93,1 +94,1 @@\n-  volatile size_t* index_addr() { return &_index; }\n+  Atomic<size_t>* index_addr() { return &_index; }\n@@ -181,2 +182,2 @@\n-  volatile uint _registered_allocators;\n-  DEBUG_ONLY(volatile uint _released_allocators;)\n+  Atomic<uint> _registered_allocators;\n+  DEBUG_ONLY(Atomic<uint> _released_allocators;)\n","filename":"src\/hotspot\/share\/gc\/shared\/partialArrayState.hpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -76,1 +77,1 @@\n-  inline Step next_impl(size_t length, volatile size_t* index_addr) const;\n+  inline Step next_impl(size_t length, Atomic<size_t>* index_addr) const;\n","filename":"src\/hotspot\/share\/gc\/shared\/partialArrayTaskStepper.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -49,1 +49,1 @@\n-PartialArrayTaskStepper::next_impl(size_t length, volatile size_t* index_addr) const {\n+PartialArrayTaskStepper::next_impl(size_t length, Atomic<size_t>* index_addr) const {\n@@ -55,3 +55,1 @@\n-  size_t start = AtomicAccess::fetch_then_add(index_addr,\n-                                              _chunk_size,\n-                                              memory_order_relaxed);\n+  size_t start = index_addr->fetch_then_add(_chunk_size, memory_order_relaxed);\n","filename":"src\/hotspot\/share\/gc\/shared\/partialArrayTaskStepper.inline.hpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -36,1 +37,1 @@\n-                   size_t* to_length_addr) {\n+                   Atomic<size_t>* to_length_addr) {\n@@ -45,1 +46,1 @@\n-                     size_t* to_length_addr) {\n+                     Atomic<size_t>* to_length_addr) {\n@@ -47,1 +48,1 @@\n-  *to_length_addr = init._index;\n+  to_length_addr->store_relaxed(init._index);\n@@ -60,1 +61,1 @@\n-  size_t to_length;\n+  Atomic<size_t> to_length;\n@@ -62,1 +63,1 @@\n-  ASSERT_EQ(length, to_length);\n+  ASSERT_EQ(length, to_length.load_relaxed());\n","filename":"test\/hotspot\/gtest\/gc\/shared\/test_partialArrayTaskStepper.cpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"}]}