{"files":[{"patch":"@@ -556,2 +556,4 @@\n-            if (frame.getErrorCode() == ResetFrame.NO_ERROR) {\n-                \/\/ stop sending body because server instructed client to with RST_STREAM with NO_ERROR\n+            if (!requestBodyCF.isDone()) {\n+                \/\/ If a RST_STREAM is received, complete the requestBody. This will allow the\n+                \/\/ response to be read before the Reset is handled in the case where the client's\n+                \/\/ input stream is partially consumed or not consumed at all by the server.\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Stream.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -8,1 +8,1 @@\n- * @run testng\/othervm\/timeout=20 -Djdk.httpclient.HttpClient.log=all\n+ * @run testng\/othervm\/timeout=50 -Djdk.httpclient.HttpClient.log=all\n@@ -53,1 +53,0 @@\n-        http2TestServer.setExchangeSupplier(PostPutExchange::new);\n@@ -108,8 +107,0 @@\n-\n-    static class PostPutExchange extends Http2TestExchangeImpl {\n-\n-        public PostPutExchange(int streamid, String method, HttpHeaders reqheaders, HttpHeadersBuilder rspheadersBuilder, URI uri, InputStream is, SSLSession sslSession, BodyOutputStream os, Http2TestServerConnection conn, boolean pushAllowed) {\n-            super(streamid, method, reqheaders, rspheadersBuilder, uri, is, sslSession, os, conn, pushAllowed);\n-            os.setSendResetNoError(true);\n-        }\n-    }\n","filename":"test\/jdk\/java\/net\/httpclient\/http2\/PostPutTest.java","additions":1,"deletions":10,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-    boolean eof;\n+    volatile boolean eof;\n@@ -103,0 +103,5 @@\n+\n+    public boolean isEof() {\n+        return eof;\n+    }\n+\n@@ -133,1 +138,0 @@\n-        \/\/ TODO reset this stream\n","filename":"test\/jdk\/java\/net\/httpclient\/lib\/jdk\/httpclient\/test\/lib\/http2\/BodyInputStream.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -732,0 +732,6 @@\n+            } finally {\n+                \/\/ isEof() for if END_STREAM has been seen.\n+                \/\/ q.size() > 0 for if frames in Queue have not been read.\n+                if (bis instanceof BodyInputStream inputStream && (!inputStream.isEof() || inputStream.q.size() > 0)) {\n+                    bos.setSendResetNoError(true);\n+                }\n","filename":"test\/jdk\/java\/net\/httpclient\/lib\/jdk\/httpclient\/test\/lib\/http2\/Http2TestServerConnection.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"}]}