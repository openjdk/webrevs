{"files":[{"patch":"@@ -294,1 +294,1 @@\n-\/* useful pdh fmt's *\/\n+\/* PDH format patterns, and lengths of their constant component. *\/\n@@ -408,2 +408,2 @@\n-    fullCounterPathLen = strlen(objectName);\n-    fullCounterPathLen += strlen(counterName);\n+    \/\/ Always include space for null terminator:\n+    fullCounterPathLen = strlen(objectName) + strlen(counterName) + 1;\n@@ -432,2 +432,1 @@\n-\n-        fullCounterPath = malloc(fullCounterPathLen + 1);\n+        fullCounterPath = malloc(fullCounterPathLen);\n@@ -439,7 +438,7 @@\n-        _snprintf(fullCounterPath,\n-                  fullCounterPathLen,\n-                  PROCESS_OBJECT_INSTANCE_COUNTER_FMT,\n-                  objectName,\n-                  imageName,\n-                  instance,\n-                  counterName);\n+        snprintf(fullCounterPath,\n+                 fullCounterPathLen,\n+                 PROCESS_OBJECT_INSTANCE_COUNTER_FMT,\n+                 objectName,\n+                 imageName,\n+                 instance,\n+                 counterName);\n@@ -468,1 +467,1 @@\n-        fullCounterPath = malloc(fullCounterPathLen + 1);\n+        fullCounterPath = malloc(fullCounterPathLen);\n@@ -475,6 +474,6 @@\n-            _snprintf(fullCounterPath,\n-                      fullCounterPathLen,\n-                      OBJECT_WITH_INSTANCES_COUNTER_FMT,\n-                      objectName,\n-                      instance,\n-                      counterName);\n+            snprintf(fullCounterPath,\n+                     fullCounterPathLen,\n+                     OBJECT_WITH_INSTANCES_COUNTER_FMT,\n+                     objectName,\n+                     instance,\n+                     counterName);\n@@ -482,5 +481,5 @@\n-            _snprintf(fullCounterPath,\n-                      fullCounterPathLen,\n-                      OBJECT_COUNTER_FMT,\n-                      objectName,\n-                      counterName);\n+            snprintf(fullCounterPath,\n+                     fullCounterPathLen,\n+                     OBJECT_COUNTER_FMT,\n+                     objectName,\n+                     counterName);\n@@ -490,2 +489,0 @@\n-    fullCounterPath[fullCounterPathLen] = '\\0';\n-\n@@ -722,4 +719,4 @@\n-            _snprintf(fullIDProcessCounterPath,\n-                      MAX_PATH,\n-                      pdhIDProcessCounterFmt,\n-                      index);\n+            snprintf(fullIDProcessCounterPath,\n+                     MAX_PATH,\n+                     pdhIDProcessCounterFmt,\n+                     index);\n@@ -1053,1 +1050,1 @@\n-    pdhIDProcessCounterFmtLen += 2; \/\/ \"%d\"\n+    pdhIDProcessCounterFmtLen += 3; \/\/ \"%d\" and '\\0'\n@@ -1056,1 +1053,1 @@\n-    pdhIDProcessCounterFmt = malloc(pdhIDProcessCounterFmtLen + 1);\n+    pdhIDProcessCounterFmt = malloc(pdhIDProcessCounterFmtLen);\n@@ -1062,9 +1059,7 @@\n-    _snprintf(pdhIDProcessCounterFmt,\n-              pdhIDProcessCounterFmtLen,\n-              PROCESS_OBJECT_INSTANCE_COUNTER_FMT,\n-              pdhLocalizedProcessObject,\n-              pdhProcessImageName,\n-              \"%d\",\n-              pdhLocalizedIDProcessCounter);\n-\n-    pdhIDProcessCounterFmt[pdhIDProcessCounterFmtLen] = '\\0';\n+    snprintf(pdhIDProcessCounterFmt,\n+             pdhIDProcessCounterFmtLen,\n+             PROCESS_OBJECT_INSTANCE_COUNTER_FMT,\n+             pdhLocalizedProcessObject,\n+             pdhProcessImageName,\n+             \"%d\",\n+             pdhLocalizedIDProcessCounter);\n","filename":"src\/jdk.management\/windows\/native\/libmanagement_ext\/OperatingSystemImpl.c","additions":36,"deletions":41,"binary":false,"changes":77,"status":"modified"}]}