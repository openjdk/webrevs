{"files":[{"patch":"@@ -101,1 +101,2 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintSystemPropertiesDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintSystemPropertiesDCmd>(full_export, true));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintPropertiesDCmd>(full_export));\n@@ -337,18 +338,32 @@\n-void PrintSystemPropertiesDCmd::execute(DCmdSource source, TRAPS) {\n-  \/\/ load VMSupport\n-  Symbol* klass = vmSymbols::jdk_internal_vm_VMSupport();\n-  Klass* k = SystemDictionary::resolve_or_fail(klass, true, CHECK);\n-  InstanceKlass* ik = InstanceKlass::cast(k);\n-  if (ik->should_be_initialized()) {\n-    ik->initialize(THREAD);\n-  }\n-  if (HAS_PENDING_EXCEPTION) {\n-    java_lang_Throwable::print(PENDING_EXCEPTION, output());\n-    output()->cr();\n-    CLEAR_PENDING_EXCEPTION;\n-    return;\n-  }\n-\n-  \/\/ invoke the serializePropertiesToByteArray method\n-  JavaValue result(T_OBJECT);\n-  JavaCallArguments args;\n+\/\/ helper method for printing system and security properties\n+static void print_properties(Symbol* method_name, outputStream* out, TRAPS) {\n+    Symbol* klass = vmSymbols::jdk_internal_vm_VMSupport();\n+    Klass* k = SystemDictionary::resolve_or_fail(klass, true, CHECK);\n+    InstanceKlass* ik = InstanceKlass::cast(k);\n+    if (ik->should_be_initialized()) {\n+        ik->initialize(THREAD);\n+    }\n+    if (HAS_PENDING_EXCEPTION) {\n+        java_lang_Throwable::print(PENDING_EXCEPTION, out);\n+        out->cr();\n+        CLEAR_PENDING_EXCEPTION;\n+        return;\n+    }\n+    JavaValue result(T_OBJECT);\n+    JavaCallArguments args;\n+    Symbol* signature = vmSymbols::void_byte_array_signature();\n+    JavaCalls::call_static(&result, ik, method_name, signature, &args, THREAD);\n+\n+    if (HAS_PENDING_EXCEPTION) {\n+        java_lang_Throwable::print(PENDING_EXCEPTION, out);\n+        out->cr();\n+        CLEAR_PENDING_EXCEPTION;\n+        return;\n+    }\n+    oop res = result.get_oop();\n+    assert(res->is_typeArray(), \"should be a byte array\");\n+    assert(TypeArrayKlass::cast(res->klass())->element_type() == T_BYTE, \"should be a byte array\");\n+    typeArrayOop ba = typeArrayOop(res);\n+    jbyte* addr = ba->byte_at_addr(0);\n+    out->print_raw((const char*)addr, ba->length());\n+}\n@@ -356,13 +371,3 @@\n-  Symbol* signature = vmSymbols::void_byte_array_signature();\n-  JavaCalls::call_static(&result,\n-                         ik,\n-                         vmSymbols::serializePropertiesToByteArray_name(),\n-                         signature,\n-                         &args,\n-                         THREAD);\n-  if (HAS_PENDING_EXCEPTION) {\n-    java_lang_Throwable::print(PENDING_EXCEPTION, output());\n-    output()->cr();\n-    CLEAR_PENDING_EXCEPTION;\n-    return;\n-  }\n+void PrintSystemPropertiesDCmd::execute(DCmdSource source, TRAPS) {\n+  print_properties(vmSymbols::serializePropertiesToByteArray_name(), output(), THREAD);\n+}\n@@ -370,4 +375,7 @@\n-  \/\/ The result should be a [B\n-  oop res = result.get_oop();\n-  assert(res->is_typeArray(), \"just checking\");\n-  assert(TypeArrayKlass::cast(res->klass())->element_type() == T_BYTE, \"just checking\");\n+PrintPropertiesDCmd::PrintPropertiesDCmd(outputStream* output, bool heap) :\n+                                          DCmdWithParser(output, heap),\n+  _system(\"-system\", \"print system properties\", \"BOOLEAN\", false, \"false\"),\n+  _security(\"-security\", \"print security properties\", \"BOOLEAN\", false, \"false\") {\n+  _dcmdparser.add_dcmd_option(&_system);\n+  _dcmdparser.add_dcmd_option(&_security);\n+}\n@@ -375,4 +383,11 @@\n-  \/\/ copy the bytes to the output stream\n-  typeArrayOop ba = typeArrayOop(res);\n-  jbyte* addr = typeArrayOop(res)->byte_at_addr(0);\n-  output()->print_raw((const char*)addr, ba->length());\n+void PrintPropertiesDCmd::execute(DCmdSource source, TRAPS) {\n+    if (_system.value() && _security.value()) {\n+      output()->print_cr(\"Enter one argument for VM.properties\");\n+      return;\n+    } else if (_system.value()) {\n+      print_properties(vmSymbols::serializePropertiesToByteArray_name(), output(), THREAD);\n+    } else if (_security.value()){\n+      print_properties(vmSymbols::serializeSecurityPropertiesToByteArray_name(), output(), THREAD);\n+    } else {\n+      output()->print_cr(\"Invalid argument to VM.properties, (-system, -security)\");\n+    }\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":55,"deletions":40,"binary":false,"changes":95,"status":"modified"}]}