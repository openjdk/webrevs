{"files":[{"patch":"@@ -704,0 +704,1 @@\n+  template(serializeSecurityPropertiesToByteArray_name, \"serializeSecurityPropertiesToByteArray\")                 \\\n","filename":"src\/hotspot\/share\/classfile\/vmSymbols.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -308,0 +308,6 @@\n+\/\/ Implementation of \"properties -security\" command.\n+\/\/ See also: PrintSecurityPropertiesDCmd class\n+static jint get_security_properties(AttachOperation* op, attachStream* out) {\n+  return get_properties(op, out, vmSymbols::serializeSecurityPropertiesToByteArray_name());\n+}\n+\n","filename":"src\/hotspot\/share\/services\/attachListener.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -103,1 +103,2 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintSystemPropertiesDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintSystemPropertiesDCmd>(full_export, true, true));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintPropertiesDCmd>(full_export, true, false));\n@@ -341,18 +342,32 @@\n-void PrintSystemPropertiesDCmd::execute(DCmdSource source, TRAPS) {\n-  \/\/ load VMSupport\n-  Symbol* klass = vmSymbols::jdk_internal_vm_VMSupport();\n-  Klass* k = SystemDictionary::resolve_or_fail(klass, true, CHECK);\n-  InstanceKlass* ik = InstanceKlass::cast(k);\n-  if (ik->should_be_initialized()) {\n-    ik->initialize(THREAD);\n-  }\n-  if (HAS_PENDING_EXCEPTION) {\n-    java_lang_Throwable::print(PENDING_EXCEPTION, output());\n-    output()->cr();\n-    CLEAR_PENDING_EXCEPTION;\n-    return;\n-  }\n-\n-  \/\/ invoke the serializePropertiesToByteArray method\n-  JavaValue result(T_OBJECT);\n-  JavaCallArguments args;\n+\/\/ helper method for printing system and security properties\n+static void print_properties(Symbol* method_name, outputStream* out, TRAPS) {\n+    Symbol* klass = vmSymbols::jdk_internal_vm_VMSupport();\n+    Klass* k = SystemDictionary::resolve_or_fail(klass, true, CHECK);\n+    InstanceKlass* ik = InstanceKlass::cast(k);\n+    if (ik->should_be_initialized()) {\n+        ik->initialize(THREAD);\n+    }\n+    if (HAS_PENDING_EXCEPTION) {\n+        java_lang_Throwable::print(PENDING_EXCEPTION, out);\n+        out->cr();\n+        CLEAR_PENDING_EXCEPTION;\n+        return;\n+    }\n+    JavaValue result(T_OBJECT);\n+    JavaCallArguments args;\n+    Symbol* signature = vmSymbols::void_byte_array_signature();\n+    JavaCalls::call_static(&result, ik, method_name, signature, &args, THREAD);\n+\n+    if (HAS_PENDING_EXCEPTION) {\n+        java_lang_Throwable::print(PENDING_EXCEPTION, out);\n+        out->cr();\n+        CLEAR_PENDING_EXCEPTION;\n+        return;\n+    }\n+    oop res = result.get_oop();\n+    assert(res->is_typeArray(), \"should be a byte array\");\n+    assert(TypeArrayKlass::cast(res->klass())->element_type() == T_BYTE, \"should be a byte array\");\n+    typeArrayOop ba = typeArrayOop(res);\n+    jbyte* addr = ba->byte_at_addr(0);\n+    out->print_raw((const char*)addr, ba->length());\n+}\n@@ -360,13 +375,3 @@\n-  Symbol* signature = vmSymbols::void_byte_array_signature();\n-  JavaCalls::call_static(&result,\n-                         ik,\n-                         vmSymbols::serializePropertiesToByteArray_name(),\n-                         signature,\n-                         &args,\n-                         THREAD);\n-  if (HAS_PENDING_EXCEPTION) {\n-    java_lang_Throwable::print(PENDING_EXCEPTION, output());\n-    output()->cr();\n-    CLEAR_PENDING_EXCEPTION;\n-    return;\n-  }\n+void PrintSystemPropertiesDCmd::execute(DCmdSource source, TRAPS) {\n+    print_properties(vmSymbols::serializePropertiesToByteArray_name(), output(), THREAD);\n+}\n@@ -374,4 +379,7 @@\n-  \/\/ The result should be a [B\n-  oop res = result.get_oop();\n-  assert(res->is_typeArray(), \"just checking\");\n-  assert(TypeArrayKlass::cast(res->klass())->element_type() == T_BYTE, \"just checking\");\n+PrintPropertiesDCmd::PrintPropertiesDCmd(outputStream* output, bool heap) :\n+                                          DCmdWithParser(output, heap),\n+  _system(\"-system\", \"print system properties\", \"BOOLEAN\", false, \"false\"),\n+  _security(\"-security\", \"print security properties\", \"BOOLEAN\", false, \"false\") {\n+  _dcmdparser.add_dcmd_option(&_system);\n+  _dcmdparser.add_dcmd_option(&_security);\n+}\n@@ -379,4 +387,11 @@\n-  \/\/ copy the bytes to the output stream\n-  typeArrayOop ba = typeArrayOop(res);\n-  jbyte* addr = typeArrayOop(res)->byte_at_addr(0);\n-  output()->print_raw((const char*)addr, ba->length());\n+void PrintPropertiesDCmd::execute(DCmdSource source, TRAPS) {\n+    if (_system.value() && _security.value()) {\n+      output()->print_cr(\"Enter one argument for VM.properties\");\n+      return;\n+    } else if (_system.value()) {\n+      print_properties(vmSymbols::serializePropertiesToByteArray_name(), output(), THREAD);\n+    } else if (_security.value()){\n+      print_properties(vmSymbols::serializeSecurityPropertiesToByteArray_name(), output(), THREAD);\n+    } else {\n+      output()->print_cr(\"Invalid argument to VM.properties, (-system, -security)\");\n+    }\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":55,"deletions":40,"binary":false,"changes":95,"status":"modified"},{"patch":"@@ -97,0 +97,12 @@\n+class PrintPropertiesDCmd : public DCmdWithParser {\n+protected:\n+  DCmdArgument<bool> _system;\n+  DCmdArgument<bool> _security;\n+public:\n+    PrintPropertiesDCmd(outputStream* output, bool heap);\n+    static const char* name() { return \"VM.properties\"; }\n+    static const char* description() { return \"Print -system or -security properties. (VM.properties -arg)\"; }\n+    static const char* impact() { return \"Low\"; }\n+    virtual void execute(DCmdSource source, TRAPS);\n+};\n+\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.hpp","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -322,0 +322,4 @@\n+            @Override\n+            public Properties getCurrentProperties() {\n+                return (Properties) props.clone();\n+            }\n","filename":"src\/java.base\/share\/classes\/java\/security\/Security.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+    Properties getCurrentProperties();\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/access\/JavaSecurityPropertiesAccess.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -101,0 +101,5 @@\n+    public static byte[] serializeSecurityPropertiesToByteArray() throws IOException {\n+        Properties p = SharedSecrets.getJavaSecurityPropertiesAccess().getCurrentProperties();\n+        return serializePropertiesToByteArray(onlyStrings(p));\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/vm\/VMSupport.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}