{"files":[{"patch":"@@ -41,0 +41,3 @@\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.function.Supplier;\n@@ -65,0 +68,5 @@\n+    @FunctionalInterface\n+    private interface IOFunction<T, R> {\n+      public R apply(T t) throws IOException;\n+    }\n+\n@@ -66,1 +74,1 @@\n-    private static Optional<Path> readSymlinkPrivileged(final Path symlink) throws IOException {\n+    private static <R> R filesFunctionPrivileged(IOFunction<Path, R> function, final Path path, Supplier<R> def) throws IOException {\n@@ -68,1 +76,1 @@\n-        return AccessController.doPrivileged((PrivilegedExceptionAction<Optional<Path>>) () -> Optional.ofNullable(Files.readSymbolicLink(symlink)));\n+        return AccessController.doPrivileged((PrivilegedExceptionAction<R>) () -> function.apply(path));\n@@ -70,1 +78,1 @@\n-          if (e.getException() instanceof IOException ioe) throw ioe; else return Optional.empty();\n+          if (e.getException() instanceof IOException ioe) throw ioe; else return def.get();\n@@ -74,0 +82,4 @@\n+    private static Optional<Path> readSymlink(Path symlink) throws IOException { return Optional.ofNullable(Files.readSymbolicLink(symlink)); }\n+\n+    private static Boolean FALSE() { return false; } \/\/ there should be something in j.u.f or j.l for this!\n+\n@@ -78,1 +90,1 @@\n-            nsPath = readSymlinkPrivileged(SELF.resolve(NS_MNT));\n+            nsPath = filesFunctionPrivileged(VirtualMachineImpl::readSymlink, SELF.resolve(NS_MNT), Optional::empty);\n@@ -292,1 +304,1 @@\n-                targetMountNS = readSymlinkPrivileged(procPidPath.resolve(NS_MNT));\n+                targetMountNS = filesFunctionPrivileged(VirtualMachineImpl::readSymlink, procPidPath.resolve(NS_MNT), Optional::empty);\n@@ -295,1 +307,1 @@\n-                if (!Files.exists(procPidPath)) {\n+                if (!filesFunctionPrivileged(Files::exists, procPidPath, VirtualMachineImpl::FALSE)) {\n@@ -308,1 +320,1 @@\n-                if (Files.isReadable(procPidRootTmp)) {\n+                if (filesFunctionPrivileged(Files::isReadable, procPidRootTmp, VirtualMachineImpl::FALSE)) {\n@@ -318,1 +330,1 @@\n-                curPidNS = readSymlinkPrivileged(procPidPath.resolve(NS_PID));\n+                curPidNS = filesFunctionPrivileged(VirtualMachineImpl::readSymlink, procPidPath.resolve(NS_PID), Optional::empty);\n@@ -321,1 +333,1 @@\n-                if (!Files.exists(procPidPath)) {\n+                if (!filesFunctionPrivileged(Files::exists, procPidPath, VirtualMachineImpl::FALSE)) {\n","filename":"src\/jdk.attach\/linux\/classes\/sun\/tools\/attach\/VirtualMachineImpl.java","additions":21,"deletions":9,"binary":false,"changes":30,"status":"modified"}]}