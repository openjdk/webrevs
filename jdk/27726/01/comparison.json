{"files":[{"patch":"@@ -98,1 +98,1 @@\n-  product(bool, UseSIMDForSHA3Intrinsic, true,                          \\\n+  product(bool, UseSIMDForSHA3Intrinsic, false,                         \\\n","filename":"src\/hotspot\/cpu\/aarch64\/globals_aarch64.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -378,12 +378,18 @@\n-  if (UseSHA && VM_Version::supports_sha3()) {\n-    \/\/ Auto-enable UseSHA3Intrinsics on hardware with performance benefit.\n-    \/\/ Note that the evaluation of UseSHA3Intrinsics shows better performance\n-    \/\/ on Apple silicon but worse performance on Neoverse V1 and N2.\n-    if (_cpu == CPU_APPLE) {  \/\/ Apple silicon\n-      if (FLAG_IS_DEFAULT(UseSHA3Intrinsics)) {\n-        FLAG_SET_DEFAULT(UseSHA3Intrinsics, true);\n-      }\n-    }\n-  } else if (UseSHA3Intrinsics && UseSIMDForSHA3Intrinsic) {\n-    warning(\"Intrinsics for SHA3-224, SHA3-256, SHA3-384 and SHA3-512 crypto hash functions not available on this CPU.\");\n-    FLAG_SET_DEFAULT(UseSHA3Intrinsics, false);\n+  if (UseSHA && VM_Version::supports_sha3() && _cpu == CPU_APPLE && FLAG_IS_DEFAULT(UseSIMDForSHA3Intrinsic)) {\n+    \/\/ Note: SIMD faster on Apple, worse on Neoverse V1, V2 and N2.\n+    FLAG_SET_DEFAULT(UseSIMDForSHA3Intrinsic, true);\n+  }\n+\n+  \/\/ Enable SHA-3 intrinsics (SIMD or GPR). The GPR path does not require SHA instructions.\n+  if (FLAG_IS_DEFAULT(UseSHA3Intrinsics)) {\n+    FLAG_SET_DEFAULT(UseSHA3Intrinsics, true);\n+  }\n+\n+  if (!UseSHA3Intrinsics && UseSIMDForSHA3Intrinsic) {\n+    \/\/ Keep flags consistent: if SHA3 intrinsics are off, disable the SHA3 SIMD variant.\n+    FLAG_SET_DEFAULT(UseSIMDForSHA3Intrinsic, false);\n+  }\n+\n+  if (!VM_Version::supports_sha3() && UseSIMDForSHA3Intrinsic) {\n+    warning(\"SHA3 instructions are not available on this CPU\");\n+    FLAG_SET_DEFAULT(UseSIMDForSHA3Intrinsic, false);\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp","additions":18,"deletions":12,"binary":false,"changes":30,"status":"modified"}]}