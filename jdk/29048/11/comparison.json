{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,1 @@\n+#include \"classfile\/symbolTable.hpp\"\n@@ -2339,2 +2340,2 @@\n-PrintClassClosure::PrintClassClosure(outputStream* st, bool verbose)\n-  :_st(st), _verbose(verbose) {\n+PrintClassClosure::PrintClassClosure(outputStream* st, bool verbose, bool location)\n+  :_st(st), _verbose(verbose), _location(location), _aot_statics(0), _aot_dynamics(0) {\n@@ -2357,1 +2358,4 @@\n-  if (k->is_instance_klass()) {\n+\n+  InstanceKlass* ik = k->is_instance_klass() ? InstanceKlass::cast(k) : nullptr;\n+\n+  if (ik != nullptr) {\n@@ -2366,2 +2370,1 @@\n-  if (k->is_instance_klass()) {\n-    InstanceKlass* ik = InstanceKlass::cast(k);\n+  if (ik != nullptr) {\n@@ -2372,1 +2375,13 @@\n-    if (ik->in_aot_cache()) buf[i++] = 'S';\n+    if (ik->in_aot_cache()) {\n+      buf[i++] = 'S';\n+\n+      if (_location) {\n+        if (AOTMetaspace::in_aot_cache_static_region((void*)k)) {\n+          _aot_statics++;\n+          buf[i++] = 's';\n+        } else if (AOTMetaspace::in_aot_cache_dynamic_region((void*)k)) {\n+          _aot_dynamics++;\n+          buf[i++] = 'd';\n+        }\n+      }\n+    }\n@@ -2378,0 +2393,39 @@\n+\n+  if (ik != nullptr && _location) {\n+\n+    oop pd = java_lang_Class::protection_domain(k->java_mirror());\n+\n+    if (pd != nullptr) {\n+\n+      assert(pd->klass()->is_instance_klass(), \"pd klass is not InstanceKlass\");\n+\n+      TempNewSymbol css  = SymbolTable::new_symbol(\"codesource\");\n+      TempNewSymbol csss = SymbolTable::new_symbol(\"Ljava\/security\/CodeSource;\");\n+\n+      fieldDescriptor csfd;\n+\n+      if (InstanceKlass::cast(pd->klass())->find_field(css, csss, &csfd)) {\n+\n+        oop cs = pd->obj_field(csfd.offset());\n+\n+        if (cs != nullptr) {\n+          assert(cs->klass()->is_instance_klass(), \"cs klass is not InstanceKlass\");\n+\n+          fieldDescriptor locfd;\n+\n+          TempNewSymbol csls  = SymbolTable::new_symbol(\"locationNoFragString\");\n+          TempNewSymbol cslss = SymbolTable::new_symbol(\"Ljava\/lang\/String;\");\n+\n+          if (InstanceKlass::cast(cs->klass())->find_field(csls, cslss, &locfd)) {\n+            oop loc = cs->obj_field(locfd.offset());\n+\n+            assert(loc == nullptr || loc->klass() == vmClasses::String_klass(), \"locationNoFragString field is not a String\");\n+\n+            if (loc != nullptr) {\n+              java_lang_String::print(loc, _st, JVM_MAXPATHLEN);\n+            }\n+          }\n+        }\n+      }\n+    }\n+  }\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":61,"deletions":7,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -1212,0 +1212,1 @@\n+  bool _location;\n@@ -1213,1 +1214,4 @@\n-  PrintClassClosure(outputStream* st, bool verbose);\n+  unsigned int _aot_statics;\n+  unsigned int _aot_dynamics;\n+\n+  PrintClassClosure(outputStream* st, bool verbose, bool location);\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.hpp","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+#include \"cds\/filemap.hpp\"\n@@ -953,9 +954,10 @@\n-           \"Dump the detailed content of a Java class. \"\n-           \"Some classes are annotated with flags: \"\n-           \"F = has, or inherits, a non-empty finalize method, \"\n-           \"f = has final method, \"\n-           \"W = methods rewritten, \"\n-           \"C = marked with @Contended annotation, \"\n-           \"R = has been redefined, \"\n-           \"S = is shared class\",\n-           \"BOOLEAN\", false, \"false\") {\n+           \"Dump the detailed content of a Java class.\\n\"\n+           \"\\t\\tclasses are annotated with flags:\\n\"\n+           \"\\t\\tF = has, or inherits, a non-empty finalize method,\\n\"\n+           \"\\t\\tf = has final method,\\n\"\n+           \"\\t\\tW = methods rewritten,\\n\"\n+           \"\\t\\tC = marked with @Contended annotation,\\n\"\n+           \"\\t\\tR = has been redefined,\\n\"\n+           \"\\t\\tS = is an (App)CDS shared class (if -location is also specified, (either) 's' indicating static (or) 'd' indicating dynamic AOT cache locations, are appended)\",\n+           \"BOOLEAN\", false, \"false\"),\n+  _location(\"-location\", \"Print class file location url (if available)\", \"BOOLEAN\", false, \"false\") {\n@@ -963,0 +965,1 @@\n+  _dcmdparser.add_dcmd_option(&_location);\n@@ -969,0 +972,1 @@\n+  bool _location;\n@@ -970,1 +974,1 @@\n-  VM_PrintClasses(outputStream* out, bool verbose) : _out(out), _verbose(verbose) {}\n+  VM_PrintClasses(outputStream* out, bool verbose, bool location) : _out(out), _verbose(verbose), _location(location) {}\n@@ -975,1 +979,1 @@\n-    PrintClassClosure closure(_out, _verbose);\n+    PrintClassClosure closure(_out, _verbose, _location);\n@@ -977,0 +981,7 @@\n+\n+    if (_location) {\n+      if (closure._aot_statics > 0)\n+        _out->print_cr(\"\\n%d classes shared from static cache: %s\", closure._aot_statics, FileMapInfo::current_info()->full_path());\n+      if (closure._aot_dynamics > 0)\n+        _out->print_cr(\"\\n%d classes shared from dynamic cache: %s\", closure._aot_dynamics, FileMapInfo::dynamic_info()->full_path());\n+    }\n@@ -981,1 +992,1 @@\n-  VM_PrintClasses vmop(output(), _verbose.value());\n+  VM_PrintClasses vmop(output(), _verbose.value(), _location.value());\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":24,"deletions":13,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -740,0 +740,1 @@\n+  DCmdArgument<bool> _location;\n@@ -741,1 +742,1 @@\n-  static int num_arguments() { return 1; }\n+  static int num_arguments() { return 2; }\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -803,3 +803,20 @@\n-        Some classes are annotated with flags: `F` = has, or inherits, a non-empty finalize method,\n-        `f` = has final method, `W` = methods rewritten, `C` = marked with `@Contended` annotation,\n-        `R` = has been redefined, `S` = is shared class (BOOLEAN, false)\n+        Some classes are annotated with flags:\n+          - `F` = has, or inherits, a non-empty finalize method,\n+          - `f` = has final method,\n+          - `W` = methods rewritten,\n+          - `C` = marked with `@Contended` annotation,\n+          - `R` = has been redefined,\n+          - `S` = is shared class (if -location is specified then either 's' (for static) or 'd' (for dynamic) AOT cache origin is appended)\n+        (BOOLEAN, false)\n+\n+    -   `-location`: (Optional) Print the location of the class file from which the class is loaded (if available)\n+         If provided by its defining ClassLoader, this option will print a URL specifying the location of the \n+         class file (directory, jar or other URL location) from which this class was initially loaded.\n+\n+         Note: JDK (and other classes) loaded by a ClassLoader that does not provide a location URL to the JVM will omit this field.\n+\n+         Note: if any classes are loaded from an AOT cache, their location reported is that of the original\n+               url from which they were loaded at the time of the training run that created the AOT cache,\n+               additionally the flags will also be annotated to indicate the AOT cache origin (static or dynamic).\n+\n+               The total number of classes loaded (if any) from either AOT cache (and the associated cache filepath) are summarized. \n","filename":"src\/jdk.jcmd\/share\/man\/jcmd.md","additions":20,"deletions":3,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -62,0 +62,4 @@\n+\n+    pb.command(new PidJcmdExecutor().getCommandLine(\"VM.classes\", \"-location\"));\n+    output = new OutputAnalyzer(pb.start());\n+    output.stdoutShouldMatch(\"^.*(file:\/|jar:).*$\");\n","filename":"test\/hotspot\/jtreg\/runtime\/CommandLine\/PrintClasses.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}