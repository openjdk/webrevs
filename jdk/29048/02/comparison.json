{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,1 @@\n+#include \"classfile\/symbolTable.hpp\"\n@@ -2339,2 +2340,2 @@\n-PrintClassClosure::PrintClassClosure(outputStream* st, bool verbose)\n-  :_st(st), _verbose(verbose) {\n+PrintClassClosure::PrintClassClosure(outputStream* st, bool verbose, bool location)\n+  :_st(st), _verbose(verbose), _location(location) {\n@@ -2357,1 +2358,6 @@\n-  if (k->is_instance_klass()) {\n+\n+  assert(!k->is_instance_klass(), \"not InstanceKlass!\");\n+\n+  InstanceKlass *ik = k->is_instance_klass() ? InstanceKlass::cast(k) : nullptr;\n+\n+  if (ik != nullptr) {\n@@ -2366,2 +2372,1 @@\n-  if (k->is_instance_klass()) {\n-    InstanceKlass* ik = InstanceKlass::cast(k);\n+  if (ik != nullptr) {\n@@ -2378,0 +2383,39 @@\n+\n+  if (ik != nullptr && _location) {\n+\n+    oop pd = java_lang_Class::protection_domain(k->java_mirror());\n+\n+    assert(pd != nullptr && !pd->klass()->is_instance_klass(), \"pd klass is not InstanceKlass\");\n+\n+    if (pd != nullptr && (ik = pd->klass()->is_instance_klass() ? InstanceKlass::cast(pd->klass()) : nullptr) != nullptr) {\n+\n+      TempNewSymbol css  = SymbolTable::new_symbol(\"codesource\");\n+      TempNewSymbol csss = SymbolTable::new_symbol(\"Ljava\/security\/CodeSource;\");\n+\n+      fieldDescriptor csfd;\n+\n+      if (ik->find_field(css, csss, &csfd)) {\n+\n+        oop cs = pd->obj_field(csfd.offset());\n+\n+        assert(cs !=nullptr && !cs->klass()->is_instance_klass(), \"cs klass is not InstanceKlass\");\n+\n+        if (cs != nullptr && (ik = cs->klass()->is_instance_klass() ? InstanceKlass::cast(cs->klass()) : nullptr) != nullptr) {\n+          fieldDescriptor locfd;\n+\n+          TempNewSymbol csls  = SymbolTable::new_symbol(\"locationNoFragString\");\n+          TempNewSymbol cslss = SymbolTable::new_symbol(\"Ljava\/lang\/String;\");\n+\n+          if (ik->find_field(csls, cslss, &locfd)) {\n+            oop loc = cs->obj_field(locfd.offset());\n+\n+            assert(loc != nullptr && loc->klass() != vmClasses::String_klass(), \"locationNoFragString field is not a String\");\n+\n+            if (loc != nullptr && loc->klass() == vmClasses::String_klass()) {\n+              java_lang_String::print(loc, _st, MAXPATHLEN);\n+            }\n+          }\n+        } else assert(true, \"failed to find locationNoFragString field in CodeSource\");\n+      } else assert(true, \"failed to find codeSource field in ProtectionDomain\");\n+    }\n+  }\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":50,"deletions":6,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -1212,0 +1212,1 @@\n+  bool _location;\n@@ -1213,1 +1214,1 @@\n-  PrintClassClosure(outputStream* st, bool verbose);\n+  PrintClassClosure(outputStream* st, bool verbose, bool location);\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -961,1 +961,2 @@\n-           \"BOOLEAN\", false, \"false\") {\n+           \"BOOLEAN\", false, \"false\"),\n+  _location(\"-location\", \"Print class file location url (if available)\", \"BOOLEAN\", false, \"false\") {\n@@ -963,0 +964,1 @@\n+  _dcmdparser.add_dcmd_option(&_location);\n@@ -969,0 +971,1 @@\n+  bool _location;\n@@ -970,1 +973,1 @@\n-  VM_PrintClasses(outputStream* out, bool verbose) : _out(out), _verbose(verbose) {}\n+  VM_PrintClasses(outputStream* out, bool verbose, bool location) : _out(out), _verbose(verbose), _location(location) {}\n@@ -975,1 +978,1 @@\n-    PrintClassClosure closure(_out, _verbose);\n+    PrintClassClosure closure(_out, _verbose, _location);\n@@ -981,1 +984,1 @@\n-  VM_PrintClasses vmop(output(), _verbose.value());\n+  VM_PrintClasses vmop(output(), _verbose.value(), _location.value());\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -740,0 +740,1 @@\n+  DCmdArgument<bool> _location;\n@@ -741,1 +742,1 @@\n-  static int num_arguments() { return 1; }\n+  static int num_arguments() { return 2; }\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}