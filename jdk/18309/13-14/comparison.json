{"files":[{"patch":"@@ -4731,0 +4731,33 @@\n+\/\/ population_count variant for running without the POPCNT\n+\/\/ instruction, which was introduced with SSE4.2 in 2008.\n+void MacroAssembler::population_count(Register dst, Register src,\n+                                      Register scratch1, Register scratch2) {\n+  assert_different_registers(src, scratch1, scratch2);\n+  if (UsePopCountInstruction) {\n+    Assembler::popcntq(dst, src);\n+  } else {\n+    assert_different_registers(src, scratch1, scratch2);\n+    assert_different_registers(dst, scratch1, scratch2);\n+    Label loop, done;\n+\n+    mov(scratch1, src);\n+    \/\/ dst = 0;\n+    \/\/ while(scratch1 != 0) {\n+    \/\/   dst++;\n+    \/\/   scratch1 &= (scratch1 - 1);\n+    \/\/ }\n+    xorl(dst, dst);\n+    testq(scratch1, scratch1);\n+    jccb(Assembler::equal, done);\n+    {\n+      bind(loop);\n+      incq(dst);\n+      movq(scratch2, scratch1);\n+      decq(scratch2);\n+      andq(scratch1, scratch2);\n+      jccb(Assembler::notEqual, loop);\n+    }\n+    bind(done);\n+  }\n+}\n+\n@@ -4789,1 +4822,1 @@\n-    popcntq(r_array_index, r_array_index);\n+    population_count(r_array_index, r_array_index, temp2, temp3);\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":34,"deletions":1,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -598,0 +598,2 @@\n+  void population_count(Register dst, Register src, Register scratch1, Register scratch2);\n+\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1776,11 +1776,3 @@\n-  } else {\n-    if (UsePopCountInstruction) {\n-      warning(\"POPCNT instruction is not available on this CPU\");\n-      FLAG_SET_DEFAULT(UsePopCountInstruction, false);\n-    }\n-    if (UseSecondarySupersTable) {\n-      if (!FLAG_IS_DEFAULT(UseSecondarySupersTable)) {\n-        warning(\"UseSecondarySupersTable is not supported on this CPU\");\n-      }\n-      FLAG_SET_DEFAULT(UseSecondarySupersTable, false);\n-    }\n+  } else if (UsePopCountInstruction) {\n+    warning(\"POPCNT instruction is not available on this CPU\");\n+    FLAG_SET_DEFAULT(UsePopCountInstruction, false);\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"}]}