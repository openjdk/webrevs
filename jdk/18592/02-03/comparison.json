{"files":[{"patch":"@@ -179,2 +179,1 @@\n-long os::Linux::_release_major = -1;\n-long os::Linux::_release_minor = -1;\n+\n@@ -371,1 +370,1 @@\n-void os::Linux::version_init() {\n+void os::Linux::kernel_version(long* major, long* minor) {\n@@ -380,2 +379,2 @@\n-  long* set_v = &_release_major;\n-  while (_release_minor == -1 && walker != nullptr) {\n+  long* set_v = major;\n+  while (*minor == -1 && walker != nullptr) {\n@@ -384,1 +383,1 @@\n-      set_v = &_release_minor;\n+      set_v = minor;\n@@ -4549,2 +4548,0 @@\n-  Linux::version_init();\n-\n@@ -4832,0 +4829,8 @@\n+    struct utsname buffer;\n+    int ret = uname(&buffer);\n+    if (ret != 0) {\n+      log_warning(os)(\"uname(2) failed to get kernel version: %s\",\n+                      os::errno_name(ret));\n+    }\n+\n+    long major = -1, minor = -1;\n@@ -4833,3 +4838,4 @@\n-      (Linux::_release_major > 5 ||\n-       (Linux::_release_major == 5 && Linux::_release_minor >= 14)) &&\n-      (::madvise(0, 0, MADV_POPULATE_WRITE) == 0);\n+      (ret == 0 &&\n+       (sscanf(buffer.release, \"%ld.%ld\", &major, &minor) == 2) &&\n+       (major > 5 || (major == 5 && minor >= 14)) &&\n+       (::madvise(0, 0, MADV_POPULATE_WRITE) == 0));\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":17,"deletions":11,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -46,3 +46,0 @@\n-  static long _release_major;\n-  static long _release_minor;\n-\n@@ -72,1 +69,0 @@\n-  static void version_init();\n@@ -100,4 +96,1 @@\n-  static void kernel_version(long* major, long* minor) {\n-    *major = _release_major;\n-    *minor = _release_minor;\n-  }\n+  static void kernel_version(long* major, long* minor);\n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":1,"deletions":8,"binary":false,"changes":9,"status":"modified"}]}