{"files":[{"patch":"@@ -4,1 +4,1 @@\n- * Copyright (c) 2020, 2023, Huawei Technologies Co., Ltd. All rights reserved.\n+ * Copyright (c) 2020, 2024, Huawei Technologies Co., Ltd. All rights reserved.\n@@ -2498,0 +2498,45 @@\n+void MacroAssembler::encode_heap_oop_not_null(Register r) {\n+#ifdef ASSERT\n+  if (CheckCompressedOops) {\n+    Label ok;\n+    bnez(r, ok);\n+    stop(\"null oop passed to encode_heap_oop_not_null\");\n+    bind(ok);\n+  }\n+#endif\n+  verify_oop_msg(r, \"broken oop in encode_heap_oop_not_null\");\n+  if (CompressedOops::base() != nullptr) {\n+    sub(r, r, xheapbase);\n+  }\n+  if (CompressedOops::shift() != 0) {\n+    assert(LogMinObjAlignmentInBytes == CompressedOops::shift(), \"decode alg wrong\");\n+    srli(r, r, LogMinObjAlignmentInBytes);\n+  }\n+}\n+\n+void MacroAssembler::encode_heap_oop_not_null(Register dst, Register src) {\n+#ifdef ASSERT\n+  if (CheckCompressedOops) {\n+    Label ok;\n+    bnez(src, ok);\n+    stop(\"null oop passed to encode_heap_oop_not_null2\");\n+    bind(ok);\n+  }\n+#endif\n+  verify_oop_msg(src, \"broken oop in encode_heap_oop_not_null2\");\n+\n+  Register data = src;\n+  if (CompressedOops::base() != nullptr) {\n+    sub(dst, src, xheapbase);\n+    data = dst;\n+  }\n+  if (CompressedOops::shift() != 0) {\n+    assert(LogMinObjAlignmentInBytes == CompressedOops::shift(), \"decode alg wrong\");\n+    srli(dst, data, LogMinObjAlignmentInBytes);\n+    data = dst;\n+  }\n+  if (data == src) {\n+    mv(dst, src);\n+  }\n+}\n+\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.cpp","additions":46,"deletions":1,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -4,1 +4,1 @@\n- * Copyright (c) 2020, 2023, Huawei Technologies Co., Ltd. All rights reserved.\n+ * Copyright (c) 2020, 2024, Huawei Technologies Co., Ltd. All rights reserved.\n@@ -209,0 +209,2 @@\n+  void encode_heap_oop_not_null(Register r);\n+  void encode_heap_oop_not_null(Register dst, Register src);\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4,1 +4,1 @@\n-\/\/ Copyright (c) 2020, 2023, Huawei Technologies Co., Ltd. All rights reserved.\n+\/\/ Copyright (c) 2020, 2024, Huawei Technologies Co., Ltd. All rights reserved.\n@@ -8407,0 +8407,1 @@\n+  predicate(n->bottom_type()->make_ptr()->ptr() != TypePtr::NotNull);\n@@ -8418,0 +8419,11 @@\n+instruct encodeHeapOop_not_null(iRegNNoSp dst, iRegP src) %{\n+  predicate(n->bottom_type()->make_ptr()->ptr() == TypePtr::NotNull);\n+  match(Set dst (EncodeP src));\n+  ins_cost(ALU_COST);\n+  format %{ \"encode_heap_oop_not_null $dst, $src\\t#@encodeHeapOop_not_null\" %}\n+  ins_encode %{\n+    __ encode_heap_oop_not_null($dst$$Register, $src$$Register);\n+  %}\n+  ins_pipe(pipe_class_default);\n+%}\n+\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"}]}