{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,0 @@\n-import java.awt.EventQueue;\n@@ -34,1 +33,3 @@\n- * @summary Extended key code is not set for a key event\n+ * @summary Tests that ExtendedKeyCode is set for key events\n+ * @library \/lib\/client\n+ * @build ExtendedRobot\n@@ -37,1 +38,0 @@\n-\n@@ -39,3 +39,3 @@\n-    private static Frame frame;\n-    private static volatile boolean setExtendedKeyCode;\n-    private static volatile int eventsCount;\n+\n+    private static volatile boolean setExtendedKeyCode = true;\n+    private static volatile int eventsCount = 0;\n@@ -44,1 +44,1 @@\n-        Robot robot = new Robot();\n+        ExtendedRobot robot = new ExtendedRobot();\n@@ -47,33 +47,2 @@\n-        try {\n-            EventQueue.invokeAndWait(() -> createTestGUI());\n-            robot.waitForIdle();\n-            robot.delay(1000);\n-\n-            robot.keyPress(KeyEvent.VK_D);\n-            robot.keyRelease(KeyEvent.VK_D);\n-            robot.waitForIdle();\n-\n-            if (!setExtendedKeyCode) {\n-                throw new RuntimeException(\"Wrong extended key code!\");\n-            }\n-        } finally {\n-            EventQueue.invokeAndWait(() -> frame.dispose());\n-        }\n-\n-        try {\n-            EventQueue.invokeAndWait(() -> createTestGUI2());\n-            robot.waitForIdle();\n-            robot.delay(1000);\n-\n-            robot.keyPress(KeyEvent.VK_LEFT);\n-            robot.keyRelease(KeyEvent.VK_LEFT);\n-            robot.waitForIdle();\n-\n-            if (eventsCount != 2 || !setExtendedKeyCode) {\n-                throw new RuntimeException(\"Wrong extended key code\\n\" +\n-                        \"eventsCount: \" + eventsCount);\n-            }\n-        } finally {\n-            EventQueue.invokeAndWait(() -> frame.dispose());\n-        }\n-    }\n+        Frame frame = new Frame();\n+        frame.setSize(300, 300);\n@@ -81,4 +50,0 @@\n-    public static void createTestGUI() {\n-        eventsCount = 0;\n-        setExtendedKeyCode = true;\n-        frame = new Frame(\"ExtendedKeyCodeTest1\");\n@@ -86,0 +51,1 @@\n+\n@@ -89,3 +55,2 @@\n-                int keyCode = KeyEvent.getExtendedKeyCodeForChar(e.getKeyChar());\n-                setExtendedKeyCode = setExtendedKeyCode && (e.getExtendedKeyCode() == keyCode);\n-                System.out.println(\"Test 1 keyPressed \" + keyCode);\n+                setExtendedKeyCode = setExtendedKeyCode && (e.getExtendedKeyCode()\n+                        == KeyEvent.getExtendedKeyCodeForChar(e.getKeyChar()));\n@@ -97,3 +62,2 @@\n-                int keyCode = KeyEvent.getExtendedKeyCodeForChar(e.getKeyChar());\n-                setExtendedKeyCode = setExtendedKeyCode && (e.getExtendedKeyCode() == keyCode);\n-                System.out.println(\"Test 1 keyReleased \" + keyCode);\n+                setExtendedKeyCode = setExtendedKeyCode && (e.getExtendedKeyCode()\n+                        == KeyEvent.getExtendedKeyCodeForChar(e.getKeyChar()));\n@@ -103,2 +67,0 @@\n-        frame.setLocationRelativeTo(null);\n-        frame.setSize(300, 300);\n@@ -106,1 +68,7 @@\n-    }\n+        robot.waitForIdle();\n+\n+        robot.keyPress(KeyEvent.VK_D);\n+        robot.keyRelease(KeyEvent.VK_D);\n+        robot.waitForIdle();\n+\n+        frame.dispose();\n@@ -108,1 +76,7 @@\n-    public static void createTestGUI2() {\n+        if (eventsCount != 2 || !setExtendedKeyCode) {\n+            throw new RuntimeException(\"Wrong extended key code\\n\" +\n+                    \"eventsCount: \" + eventsCount);\n+        }\n+\n+        frame = new Frame();\n+        frame.setSize(300, 300);\n@@ -110,1 +84,1 @@\n-        frame = new Frame(\"ExtendedKeyCodeTest2\");\n+\n@@ -112,0 +86,1 @@\n+\n@@ -114,3 +89,1 @@\n-                int keyCode = e.getExtendedKeyCode();\n-                setExtendedKeyCode = keyCode == KeyEvent.VK_LEFT;\n-                System.out.println(\"Test 2 keyPressed \" + keyCode);\n+                setExtendedKeyCode = e.getExtendedKeyCode() == KeyEvent.VK_LEFT;\n@@ -120,2 +93,0 @@\n-        frame.setLocationRelativeTo(null);\n-        frame.setSize(300, 300);\n@@ -123,0 +94,10 @@\n+        robot.waitForIdle();\n+\n+        robot.keyPress(KeyEvent.VK_LEFT);\n+        robot.keyRelease(KeyEvent.VK_LEFT);\n+        robot.waitForIdle();\n+        frame.dispose();\n+\n+        if (!setExtendedKeyCode) {\n+            throw new RuntimeException(\"Wrong extended key code!\");\n+        }\n","filename":"test\/jdk\/java\/awt\/event\/KeyEvent\/ExtendedKeyCode\/ExtendedKeyCodeTest.java","additions":42,"deletions":61,"binary":false,"changes":103,"status":"modified"}]}