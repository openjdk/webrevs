{"files":[{"patch":"@@ -27,0 +27,1 @@\n+ * @key headful\n@@ -28,3 +29,1 @@\n- * @library \/java\/awt\/regtesthelpers\n- * @build PassFailJFrame\n- * @run main\/manual TestGlyphBGHeight\n+ * @run main TestGlyphBGHeight\n@@ -33,0 +32,2 @@\n+import java.io.File;\n+import java.awt.Graphics2D;\n@@ -35,0 +36,3 @@\n+import java.awt.image.BufferedImage;\n+import java.awt.Robot;\n+import javax.imageio.ImageIO;\n@@ -40,0 +44,1 @@\n+import javax.swing.SwingUtilities;\n@@ -43,4 +48,1 @@\n-    final static String INSTRUCTIONS = \"\"\"\n-        A StyledDocument with a text and yellow background will be shown.\n-        If the yellow background is way taller than the text,\n-        press FAIL else press PASS.\"\"\";\n+    static JFrame frame;\n@@ -49,8 +51,6 @@\n-        PassFailJFrame.builder()\n-                .title(\"TestGlyphBGHeight Test Instructions\")\n-                .instructions(INSTRUCTIONS)\n-                .columns(30)\n-                .testUI(TestGlyphBGHeight::createUI)\n-                .build()\n-                .awaitAndCheck();\n-    }\n+        try {\n+            Robot robot = new Robot();\n+            SwingUtilities.invokeAndWait(() -> {\n+                frame = new JFrame(\"TestGlyphBGHeight\");\n+                frame.setSize(100, 100);\n+                frame.getContentPane().setLayout(new BorderLayout());\n@@ -58,4 +58,2 @@\n-    private static JFrame createUI() {\n-        JFrame frame = new JFrame(\"TestGlyphBGHeight\");\n-        frame.setSize(100, 100);\n-        frame.getContentPane().setLayout(new BorderLayout());\n+                final JTextPane comp = new JTextPane();\n+                final StyledDocument doc = comp.getStyledDocument();\n@@ -63,2 +61,7 @@\n-        final JTextPane comp = new JTextPane();\n-        final StyledDocument doc = comp.getStyledDocument();\n+                Style style = comp.addStyle(\"superscript\", null);\n+                StyleConstants.setSuperscript(style, true);\n+                StyleConstants.setFontSize(style, 32);\n+                StyleConstants.setBackground(style, Color.YELLOW);\n+                try {\n+                    doc.insertString(doc.getLength(), \"hello\", style);\n+                } catch (Exception e) {}\n@@ -66,7 +69,10 @@\n-        Style style = comp.addStyle(\"superscript\", null);\n-        StyleConstants.setSuperscript(style, true);\n-        StyleConstants.setFontSize(style, 32);\n-        StyleConstants.setBackground(style, Color.YELLOW);\n-        try {\n-            doc.insertString(doc.getLength(), \"hello\", style);\n-        } catch(Exception e) {}\n+                comp.setDocument(doc);\n+                comp.setBackground(Color.RED);\n+\n+                frame.getContentPane().add(comp, BorderLayout.CENTER);\n+\n+                frame.setLocationRelativeTo(null);\n+                frame.setVisible(true);\n+            });\n+            robot.waitForIdle();\n+            robot.delay(1000);\n@@ -74,1 +80,5 @@\n-        comp.setDocument(doc);\n+            BufferedImage img = new BufferedImage(100, 100, BufferedImage.TYPE_INT_ARGB);\n+            Graphics2D g2d = (Graphics2D) img.getGraphics();\n+            frame.paint(g2d);\n+            ImageIO.write(img, \"png\", new File(\"AppTest.png\"));\n+            g2d.dispose();\n@@ -76,2 +86,18 @@\n-        frame.getContentPane().add(comp, BorderLayout.CENTER);\n-        return frame;\n+            BufferedImage bimg = img.getSubimage(0, 80, 100, 1);\n+            ImageIO.write(bimg, \"png\", new File(\"AppTest1.png\"));\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+            for (int x = 10; x < 50; x++) {\n+                Color col = new Color(bimg.getRGB(x, 0));\n+                System.out.println(Integer.toHexString(bimg.getRGB(x, 0)));\n+                if (col.equals(Color.YELLOW)) {\n+                    throw new RuntimeException(\" Background is painted taller than needed for styled text\");\n+                }\n+            }\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n+        }\n","filename":"test\/jdk\/javax\/swing\/text\/GlyphView\/TestGlyphBGHeight.java","additions":57,"deletions":31,"binary":false,"changes":88,"status":"modified"}]}