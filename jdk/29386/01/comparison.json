{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,0 @@\n-#include \"runtime\/atomicAccess.hpp\"\n@@ -312,1 +311,1 @@\n-  _end = _allocation_end;\n+  _end.store_relaxed(allocation_end());\n@@ -316,2 +315,2 @@\n-  precond(sampling_point >= _top);\n-  precond(sampling_point <= _allocation_end);\n+  precond(sampling_point >= top());\n+  precond(sampling_point <= allocation_end());\n@@ -320,1 +319,1 @@\n-  _end = sampling_point;\n+  _end.store_relaxed(sampling_point);\n@@ -324,1 +323,1 @@\n-  return _allocation_end + alignment_reserve();\n+  return allocation_end() + alignment_reserve();\n@@ -462,1 +461,1 @@\n-  return AtomicAccess::load(&_start);\n+  return _start.load_relaxed();\n@@ -466,1 +465,1 @@\n-  return AtomicAccess::load(&_top);\n+  return _top.load_relaxed();\n","filename":"src\/hotspot\/share\/gc\/shared\/threadLocalAllocBuffer.cpp","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -36,4 +37,1 @@\n-\/\/ the threads for allocation.\n-\/\/            It is thread-private at any time, but maybe multiplexed over\n-\/\/            time across multiple threads. The park()\/unpark() pair is\n-\/\/            used to make it available for such multiplexing.\n+\/\/ the threads for allocation. It is thread-private at any time.\n@@ -41,5 +39,5 @@\n-\/\/            Heap sampling is performed via the end and allocation_end\n-\/\/            fields.\n-\/\/            allocation_end contains the real end of the tlab allocation,\n-\/\/            whereas end can be set to an arbitrary spot in the tlab to\n-\/\/            trip the return and sample the allocation.\n+\/\/ Heap sampling is performed via the end and allocation_end\n+\/\/ fields.\n+\/\/ allocation_end contains the real end of the tlab allocation,\n+\/\/ whereas end can be set to an arbitrary spot in the tlab to\n+\/\/ trip the return and sample the allocation.\n@@ -50,5 +48,5 @@\n-  HeapWord* _start;                              \/\/ address of TLAB\n-  HeapWord* _top;                                \/\/ address after last allocation\n-  HeapWord* _pf_top;                             \/\/ allocation prefetch watermark\n-  HeapWord* _end;                                \/\/ allocation end (can be the sampling end point or _allocation_end)\n-  HeapWord* _allocation_end;                     \/\/ end for allocations (actual TLAB end, excluding alignment_reserve)\n+  Atomic<HeapWord*> _start;                      \/\/ address of TLAB\n+  Atomic<HeapWord*> _top;                        \/\/ address after last allocation\n+  Atomic<HeapWord*> _pf_top;                     \/\/ allocation prefetch watermark\n+  Atomic<HeapWord*> _end;                        \/\/ allocation end (can be the sampling end point or _allocation_end)\n+  Atomic<HeapWord*> _allocation_end;             \/\/ end for allocations (actual TLAB end, excluding alignment_reserve)\n@@ -74,5 +72,7 @@\n-  void set_start(HeapWord* start)                { _start = start; }\n-  void set_end(HeapWord* end)                    { _end = end; }\n-  void set_allocation_end(HeapWord* ptr)         { _allocation_end = ptr; }\n-  void set_top(HeapWord* top)                    { _top = top; }\n-  void set_pf_top(HeapWord* pf_top)              { _pf_top = pf_top; }\n+  HeapWord* allocation_end() const               { return _allocation_end.load_relaxed(); }\n+\n+  void set_start(HeapWord* start)                { _start.store_relaxed(start); }\n+  void set_end(HeapWord* end)                    { _end.store_relaxed(end); }\n+  void set_allocation_end(HeapWord* ptr)         { _allocation_end.store_relaxed(ptr); }\n+  void set_top(HeapWord* top)                    { _top.store_relaxed(top); }\n+  void set_pf_top(HeapWord* pf_top)              { _pf_top.store_relaxed(pf_top); }\n@@ -115,3 +115,3 @@\n-  HeapWord* start() const                        { return _start; }\n-  HeapWord* end() const                          { return _end; }\n-  HeapWord* top() const                          { return _top; }\n+  HeapWord* start() const                        { return _start.load_relaxed(); }\n+  HeapWord* end() const                          { return _end.load_relaxed(); }\n+  HeapWord* top() const                          { return _top.load_relaxed(); }\n@@ -119,1 +119,0 @@\n-  HeapWord* pf_top() const                       { return _pf_top; }\n@@ -121,1 +120,0 @@\n-  size_t used() const                            { return pointer_delta(top(), start()); }\n@@ -174,8 +172,0 @@\n-  template <typename T> void addresses_do(T f) {\n-    f(&_start);\n-    f(&_top);\n-    f(&_pf_top);\n-    f(&_end);\n-    f(&_allocation_end);\n-  }\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/threadLocalAllocBuffer.hpp","additions":23,"deletions":33,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -447,4 +447,4 @@\n-  nonstatic_field(ThreadLocalAllocBuffer,   _start,                                           HeapWord*)                             \\\n-  nonstatic_field(ThreadLocalAllocBuffer,   _top,                                             HeapWord*)                             \\\n-  nonstatic_field(ThreadLocalAllocBuffer,   _end,                                             HeapWord*)                             \\\n-  nonstatic_field(ThreadLocalAllocBuffer,   _pf_top,                                          HeapWord*)                             \\\n+  nonstatic_field(ThreadLocalAllocBuffer,   _start,                                           Atomic<HeapWord*>)                     \\\n+  nonstatic_field(ThreadLocalAllocBuffer,   _top,                                             Atomic<HeapWord*>)                     \\\n+  nonstatic_field(ThreadLocalAllocBuffer,   _end,                                             Atomic<HeapWord*>)                     \\\n+  nonstatic_field(ThreadLocalAllocBuffer,   _pf_top,                                          Atomic<HeapWord*>)                     \\\n","filename":"src\/hotspot\/share\/jvmci\/vmStructs_jvmci.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -350,4 +350,4 @@\n-  nonstatic_field(ThreadLocalAllocBuffer,      _start,                                        HeapWord*)                             \\\n-  nonstatic_field(ThreadLocalAllocBuffer,      _top,                                          HeapWord*)                             \\\n-  nonstatic_field(ThreadLocalAllocBuffer,      _end,                                          HeapWord*)                             \\\n-  nonstatic_field(ThreadLocalAllocBuffer,      _pf_top,                                       HeapWord*)                             \\\n+  nonstatic_field(ThreadLocalAllocBuffer,      _start,                                        Atomic<HeapWord*>)                     \\\n+  nonstatic_field(ThreadLocalAllocBuffer,      _top,                                          Atomic<HeapWord*>)                     \\\n+  nonstatic_field(ThreadLocalAllocBuffer,      _end,                                          Atomic<HeapWord*>)                     \\\n+  nonstatic_field(ThreadLocalAllocBuffer,      _pf_top,                                       Atomic<HeapWord*>)                     \\\n@@ -904,0 +904,1 @@\n+  declare_toplevel_type(Atomic<HeapWord*>)                                \\\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"}]}