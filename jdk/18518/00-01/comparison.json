{"files":[{"patch":"@@ -1283,6 +1283,0 @@\n-  bool _print_stacks;\n-  bool _internal_format;\n-#if INCLUDE_SERVICES\n-  ConcurrentLocksDump* _concurrent_locks;\n-#endif \/\/ INCLUDE_SERVICES\n-  bool _print_extended_info;\n@@ -1291,14 +1285,2 @@\n-  PrintOnClosure(outputStream* st, bool print_stacks,\n-                 bool internal_format,\n-                 bool print_extended_info) :\n-    _st(st),\n-    _print_stacks(print_stacks),\n-    _internal_format(internal_format),\n-#if INCLUDE_SERVICES\n-    _concurrent_locks(nullptr),\n-#endif \/\/ INCLUDE_SERVICES\n-    _print_extended_info(print_extended_info) {}\n-\n-#if INCLUDE_SERVICES\n-  void set_concurrent_locks(ConcurrentLocksDump* cl) { _concurrent_locks = cl; }\n-#endif \/\/ INCLUDE_SERVICES\n+  PrintOnClosure(outputStream* st) :\n+      _st(st) {}\n@@ -1308,21 +1290,2 @@\n-      if (thread->is_Java_thread()) {\n-        JavaThread* p = JavaThread::cast(thread);\n-        ResourceMark rm;\n-        p->print_on(_st, _print_extended_info);\n-        if (_print_stacks) {\n-          if (_internal_format) {\n-            p->trace_stack();\n-          } else {\n-            p->print_stack_on(_st);\n-          }\n-        }\n-        _st->cr();\n-#if INCLUDE_SERVICES\n-        if (_concurrent_locks != nullptr) {\n-          _concurrent_locks->print_locks_on(p, _st);\n-        }\n-#endif \/\/ INCLUDE_SERVICES\n-      } else {\n-        thread->print_on(_st);\n-        _st->cr();\n-      }\n+      thread->print_on(_st);\n+      _st->cr();\n@@ -1346,3 +1309,1 @@\n-  PrintOnClosure cl(st, print_stacks, internal_format, print_extended_info);\n-\n-  #if INCLUDE_SERVICES\n+#if INCLUDE_SERVICES\n@@ -1352,1 +1313,0 @@\n-    cl.set_concurrent_locks(&concurrent_locks);\n@@ -1360,6 +1320,9 @@\n-  if (SafepointSynchronize::is_at_safepoint()) {\n-    \/\/ Threads::threads_do() is synchronized with thread termination\n-    Threads::threads_do(&cl);\n-  } else {\n-    ALL_JAVA_THREADS(p) {\n-      cl.do_thread(p);\n+  ALL_JAVA_THREADS(p) {\n+    ResourceMark rm;\n+    p->print_on(st, print_extended_info);\n+    if (print_stacks) {\n+      if (internal_format) {\n+        p->trace_stack();\n+      } else {\n+        p->print_stack_on(st);\n+      }\n@@ -1367,4 +1330,6 @@\n-    cl.do_thread(VMThread::vm_thread());\n-    Universe::heap()->gc_threads_do(&cl);\n-    cl.do_thread(WatcherThread::watcher_thread());\n-    cl.do_thread(AsyncLogWriter::instance());\n+    st->cr();\n+#if INCLUDE_SERVICES\n+    if (print_concurrent_locks) {\n+      concurrent_locks.print_locks_on(p, st);\n+    }\n+#endif \/\/ INCLUDE_SERVICES\n@@ -1373,0 +1338,3 @@\n+  PrintOnClosure cl(st);\n+  non_java_threads_do(&cl);\n+\n","filename":"src\/hotspot\/share\/runtime\/threads.cpp","additions":23,"deletions":55,"binary":false,"changes":78,"status":"modified"}]}