{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -65,3 +65,0 @@\n-import sun.awt.AppContext;\n-\n-\n@@ -1100,15 +1097,8 @@\n-    private static HashMap<String,Keymap> getKeymapTable() {\n-        synchronized (KEYMAP_TABLE) {\n-            AppContext appContext = AppContext.getAppContext();\n-            @SuppressWarnings(\"unchecked\")\n-            HashMap<String,Keymap> keymapTable =\n-                (HashMap<String,Keymap>)appContext.get(KEYMAP_TABLE);\n-            if (keymapTable == null) {\n-                keymapTable = new HashMap<String,Keymap>(17);\n-                appContext.put(KEYMAP_TABLE, keymapTable);\n-                \/\/initialize default keymap\n-                Keymap binding = addKeymap(DEFAULT_KEYMAP, null);\n-                binding.setDefaultAction(new\n-                                         DefaultEditorKit.DefaultKeyTypedAction());\n-            }\n-            return keymapTable;\n+    private static HashMap<String,Keymap> keymapTable;\n+\n+    private static synchronized HashMap<String,Keymap> getKeymapTable() {\n+        if (keymapTable == null) {\n+            keymapTable = new HashMap<String,Keymap>(17);\n+            \/\/initialize default keymap\n+            Keymap binding = addKeymap(DEFAULT_KEYMAP, null);\n+            binding.setDefaultAction(new DefaultEditorKit.DefaultKeyTypedAction());\n@@ -1116,0 +1106,1 @@\n+        return keymapTable;\n@@ -1656,1 +1647,1 @@\n-            AppContext.getAppContext().remove(FOCUSED_COMPONENT);\n+            focusedComponent = null;\n@@ -4087,0 +4078,2 @@\n+    private static JTextComponent focusedComponent;\n+\n@@ -4092,2 +4085,1 @@\n-        return (JTextComponent)AppContext.getAppContext().\n-            get(FOCUSED_COMPONENT);\n+        return focusedComponent;\n@@ -4108,3 +4100,0 @@\n-    private static final Object KEYMAP_TABLE =\n-        new StringBuilder(\"JTextComponent_KeymapTable\");\n-\n@@ -4441,3 +4430,0 @@\n-    private static final Object FOCUSED_COMPONENT =\n-        new StringBuilder(\"JTextComponent_FocusedComponent\");\n-\n@@ -4496,2 +4482,1 @@\n-            AppContext.getAppContext().put(FOCUSED_COMPONENT,\n-                                           fe.getSource());\n+            focusedComponent = (JTextComponent)fe.getSource();\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/JTextComponent.java","additions":15,"deletions":30,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import sun.awt.AppContext;\n@@ -39,2 +38,0 @@\n-    private static final Object DEFAULT_QUEUE = new Object();\n-\n@@ -44,0 +41,2 @@\n+    private static LayoutQueue defaultQueue;\n+\n@@ -56,8 +55,2 @@\n-        AppContext ac = AppContext.getAppContext();\n-        synchronized (DEFAULT_QUEUE) {\n-            LayoutQueue defaultQueue = (LayoutQueue) ac.get(DEFAULT_QUEUE);\n-            if (defaultQueue == null) {\n-                defaultQueue = new LayoutQueue();\n-                ac.put(DEFAULT_QUEUE, defaultQueue);\n-            }\n-            return defaultQueue;\n+        if (defaultQueue == null) {\n+            defaultQueue = new LayoutQueue();\n@@ -65,0 +58,1 @@\n+        return defaultQueue;\n@@ -73,3 +67,1 @@\n-        synchronized (DEFAULT_QUEUE) {\n-            AppContext.getAppContext().put(DEFAULT_QUEUE, q);\n-        }\n+        defaultQueue = q;\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/LayoutQueue.java","additions":7,"deletions":15,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -95,1 +95,0 @@\n-import sun.awt.AppContext;\n@@ -435,5 +434,1 @@\n-        if (s == null) {\n-            AppContext.getAppContext().remove(DEFAULT_STYLES_KEY);\n-        } else {\n-            AppContext.getAppContext().put(DEFAULT_STYLES_KEY, s);\n-        }\n+        defaultStyles = s;\n@@ -451,3 +446,0 @@\n-        AppContext appContext = AppContext.getAppContext();\n-        StyleSheet defaultStyles = (StyleSheet) appContext.get(DEFAULT_STYLES_KEY);\n-\n@@ -456,1 +448,0 @@\n-            appContext.put(DEFAULT_STYLES_KEY, defaultStyles);\n@@ -695,0 +686,1 @@\n+    private static StyleSheet defaultStyles = null;\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/HTMLEditorKit.java","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,0 @@\n-import sun.awt.AppContext;\n-\n@@ -406,5 +404,0 @@\n-    \/**\n-     * The hashtable key of DTDs in AppContext.\n-     *\/\n-    private static final Object DTD_HASH_KEY = new Object();\n-\n@@ -418,1 +411,1 @@\n-        getDtdHash().put(name, dtd);\n+        DTD_MAP.put(name, dtd);\n@@ -433,1 +426,1 @@\n-        DTD dtd = getDtdHash().get(name);\n+        DTD dtd = DTD_MAP.get(name);\n@@ -440,14 +433,1 @@\n-    private static Hashtable<String, DTD> getDtdHash() {\n-        AppContext appContext = AppContext.getAppContext();\n-\n-        @SuppressWarnings(\"unchecked\")\n-        Hashtable<String, DTD> result = (Hashtable<String, DTD>) appContext.get(DTD_HASH_KEY);\n-\n-        if (result == null) {\n-            result = new Hashtable<String, DTD>();\n-\n-            appContext.put(DTD_HASH_KEY, result);\n-        }\n-\n-        return result;\n-    }\n+    private static final Hashtable<String, DTD> DTD_MAP = new Hashtable<String, DTD>();\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/parser\/DTD.java","additions":4,"deletions":24,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,0 @@\n-import sun.awt.AppContext;\n@@ -110,1 +109,1 @@\n-            AppContext.getAppContext().put(MAX_INDEX_KEY, index);\n+            maxIndex = index;\n@@ -114,1 +113,1 @@\n-    private static final Object MAX_INDEX_KEY = new Object();\n+    private static int maxIndex = 0;\n@@ -117,4 +116,1 @@\n-        Integer value = (Integer) AppContext.getAppContext().get(MAX_INDEX_KEY);\n-        return (value != null)\n-                ? value.intValue()\n-                : 0;\n+        return maxIndex;\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/parser\/Element.java","additions":4,"deletions":8,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,2 +27,0 @@\n-import sun.awt.AppContext;\n-\n@@ -55,1 +53,2 @@\n-    private static final Object DTD_KEY = new Object();\n+\n+    private static DTD dtd = null;\n@@ -65,4 +64,0 @@\n-        AppContext appContext = AppContext.getAppContext();\n-\n-        DTD dtd = (DTD) appContext.get(DTD_KEY);\n-\n@@ -80,2 +75,0 @@\n-\n-            appContext.put(DTD_KEY, dtd);\n@@ -83,1 +76,0 @@\n-\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/parser\/ParserDelegator.java","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1,128 +0,0 @@\n-\/*\n- * Copyright (c) 2010, 2017, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @key headful\n- * @bug 6938813\n- * @summary Swing mutable statics\n- * @author Pavel Porvatov\n- * @modules java.desktop\/javax.swing.text.html.parser:open\n- * @modules java.desktop\/sun.awt\n- *\/\n-\n-import sun.awt.AppContext;\n-import sun.awt.SunToolkit;\n-\n-import javax.swing.text.html.HTMLEditorKit;\n-import javax.swing.text.html.StyleSheet;\n-import javax.swing.text.html.parser.DTD;\n-import javax.swing.text.html.parser.ParserDelegator;\n-import java.lang.reflect.Field;\n-\n-public class bug6938813 {\n-    public static final String DTD_KEY = \"dtd_key\";\n-\n-    private static volatile StyleSheet styleSheet;\n-\n-    public static void main(String[] args) throws Exception {\n-        \/\/ Run validation and init values for this AppContext\n-        validate();\n-\n-        Thread thread = new ThreadInAnotherAppContext();\n-\n-        thread.start();\n-        thread.join();\n-    }\n-\n-    private static void validate() throws Exception {\n-        AppContext appContext = AppContext.getAppContext();\n-\n-        assertTrue(DTD.getDTD(DTD_KEY).getName().equals(DTD_KEY), \"DTD.getDTD() mixed AppContexts\");\n-\n-        \/\/ Spoil hash value\n-        DTD invalidDtd = DTD.getDTD(\"invalid DTD\");\n-\n-        DTD.putDTDHash(DTD_KEY, invalidDtd);\n-\n-        assertTrue(DTD.getDTD(DTD_KEY) == invalidDtd, \"Something wrong with DTD.getDTD()\");\n-\n-        Object dtdKey = getParserDelegator_DTD_KEY();\n-\n-        assertTrue(appContext.get(dtdKey) == null, \"ParserDelegator mixed AppContexts\");\n-\n-        \/\/ Init default DTD\n-        new ParserDelegator();\n-\n-        Object dtdValue = appContext.get(dtdKey);\n-\n-        assertTrue(dtdValue != null, \"ParserDelegator.defaultDTD isn't initialized\");\n-\n-        \/\/ Try reinit default DTD\n-        new ParserDelegator();\n-\n-        assertTrue(dtdValue == appContext.get(dtdKey), \"ParserDelegator.defaultDTD created a duplicate\");\n-\n-        HTMLEditorKit htmlEditorKit = new HTMLEditorKit();\n-\n-        if (styleSheet == null) {\n-            \/\/ First AppContext\n-            styleSheet = htmlEditorKit.getStyleSheet();\n-\n-            assertTrue(styleSheet != null, \"htmlEditorKit.getStyleSheet() returns null\");\n-            assertTrue(htmlEditorKit.getStyleSheet() == styleSheet, \"Something wrong with htmlEditorKit.getStyleSheet()\");\n-        } else {\n-            assertTrue(htmlEditorKit.getStyleSheet() != styleSheet, \"HtmlEditorKit.getStyleSheet() mixed AppContexts\");\n-        }\n-    }\n-\n-    private static void assertTrue(boolean b, String msg) {\n-        if (!b) {\n-            throw new RuntimeException(\"Test failed: \" + msg);\n-        }\n-    }\n-\n-    private static Object getParserDelegator_DTD_KEY() throws Exception {\n-        Field field = ParserDelegator.class.getDeclaredField(\"DTD_KEY\");\n-\n-        field.setAccessible(true);\n-\n-        return field.get(null);\n-    }\n-\n-    private static class ThreadInAnotherAppContext extends Thread {\n-        public ThreadInAnotherAppContext() {\n-            super(new ThreadGroup(\"6938813\"), \"ThreadInAnotherAppContext\");\n-        }\n-\n-        public void run() {\n-            SunToolkit.createNewAppContext();\n-\n-            try {\n-                validate();\n-            } catch (Exception e) {\n-                throw new RuntimeException(e);\n-            }\n-        }\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/Security\/6938813\/bug6938813.java","additions":0,"deletions":128,"binary":false,"changes":128,"status":"deleted"},{"patch":"@@ -1,60 +0,0 @@\n-\/*\n- * Copyright (c) 2007, 2015, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/* @test\n-   @bug 6588003\n-   @summary LayoutQueue should not share its DefaultQueue across AppContexts\n-   @author Peter Zhelezniakov\n-   @modules java.desktop\/sun.awt\n-   @run main Test6588003\n-*\/\n-\n-import javax.swing.text.LayoutQueue;\n-import sun.awt.SunToolkit;\n-\n-public class Test6588003 implements Runnable {\n-    private static final LayoutQueue DEFAULT = new LayoutQueue();\n-\n-    public static void main(String[] args) throws InterruptedException {\n-        LayoutQueue.setDefaultQueue(DEFAULT);\n-\n-        ThreadGroup group = new ThreadGroup(\"Test6588003\");\n-        Thread thread = new Thread(group, new Test6588003());\n-        thread.start();\n-        thread.join();\n-\n-        if (LayoutQueue.getDefaultQueue() != DEFAULT) {\n-            throw new RuntimeException(\"Sharing detected\");\n-        }\n-    }\n-\n-    public void run() {\n-        SunToolkit.createNewAppContext();\n-\n-        if (LayoutQueue.getDefaultQueue() == DEFAULT) {\n-            throw new RuntimeException(\"Sharing detected\");\n-        }\n-\n-        LayoutQueue.setDefaultQueue(new LayoutQueue());\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/text\/LayoutQueue\/Test6588003.java","additions":0,"deletions":60,"binary":false,"changes":60,"status":"deleted"},{"patch":"@@ -1,94 +0,0 @@\n-\/*\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-import java.util.Vector;\n-import javax.swing.text.html.HTML;\n-import javax.swing.text.html.HTMLDocument;\n-import javax.swing.text.html.HTMLEditorKit;\n-import javax.swing.text.html.parser.DTD;\n-import javax.swing.text.html.parser.Element;\n-import sun.awt.SunToolkit;\n-\n-\/*\n- * @test\n- * @bug 8017492\n- * @modules java.desktop\/sun.awt\n- * @run main\/othervm Test8017492\n- * @summary Tests for OutOfMemoryError\/NegativeArraySizeException\n- * @author Sergey Malenkov\n- *\/\n-\n-public class Test8017492 {\n-    public static void main(String[] args) throws Exception {\n-        Runnable task = new Runnable() {\n-            @Override\n-            public void run() {\n-                try {\n-                    SunToolkit.createNewAppContext();\n-                    DTD dtd = DTD.getDTD(\"dtd\");\n-                    dtd.elements = new Vector<Element>() {\n-                        @Override\n-                        public synchronized int size() {\n-                            return Integer.MAX_VALUE;\n-                        }\n-                    };\n-                    dtd.getElement(\"element\");\n-                }\n-                catch (Exception exception) {\n-                    throw new Error(\"unexpected\", exception);\n-                }\n-            }\n-        };\n-        \/\/ run task with different AppContext\n-        Thread thread = new Thread(new ThreadGroup(\"$$$\"), task);\n-        thread.setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {\n-            @Override\n-            public void uncaughtException(Thread thread, Throwable throwable) {\n-                throwable.printStackTrace();\n-                throw new RuntimeException(throwable);\n-            }\n-        });\n-        thread.start();\n-        thread.join();\n-        \/\/ add error handling\n-        SunToolkit.createNewAppContext();\n-        HTMLDocument document = new HTMLDocument() {\n-            @Override\n-            public HTMLEditorKit.ParserCallback getReader(int pos) {\n-                return getReader(pos, 0, 0, null);\n-            }\n-\n-            @Override\n-            public HTMLEditorKit.ParserCallback getReader(int pos, int popDepth, int pushDepth, HTML.Tag insertTag) {\n-                return new HTMLDocument.HTMLReader(pos, popDepth, pushDepth, insertTag) {\n-                    @Override\n-                    public void handleError(String error, int pos) {\n-                        throw new Error(error);\n-                    }\n-                };\n-            }\n-        };\n-        \/\/ run parser\n-        new HTMLEditorKit().insertHTML(document, 0, \"<html><body>text\", 0, 0, null);\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/text\/html\/parser\/Test8017492.java","additions":0,"deletions":94,"binary":false,"changes":94,"status":"deleted"}]}