{"files":[{"patch":"@@ -30,0 +30,1 @@\n+import sun.jvm.hotspot.gc.serial.*;\n@@ -87,3 +88,37 @@\n-    if (heap.isIn(a)) {\n-      loc.heap = heap;\n-      return loc;\n+    if (heap instanceof SerialHeap) {\n+      SerialHeap sh = (SerialHeap) heap;\n+      if (sh.isIn(a)) {\n+        loc.heap = heap;\n+        for (int i = 0; i < sh.nGens(); i++) {\n+          Generation g = sh.getGen(i);\n+          if (g.isIn(a)) {\n+            loc.gen = g;\n+            break;\n+          }\n+        }\n+\n+        if (Assert.ASSERTS_ENABLED) {\n+          Assert.that(loc.gen != null, \"Should have found this in a generation\");\n+        }\n+\n+        if (VM.getVM().getUseTLAB()) {\n+          \/\/ Try to find thread containing it\n+          for (int i = 0; i < threads.getNumberOfThreads(); i++) {\n+            JavaThread t = threads.getJavaThreadAt(i);\n+            ThreadLocalAllocBuffer tlab = t.tlab();\n+            if (tlab.contains(a)) {\n+              loc.inTLAB = true;\n+              loc.tlabThread = t;\n+              loc.tlab = tlab;\n+              break;\n+            }\n+          }\n+        }\n+\n+        return loc;\n+      }\n+    } else {\n+      if (heap.isIn(a)) {\n+        loc.heap = heap;\n+        return loc;\n+      }\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/utilities\/PointerFinder.java","additions":38,"deletions":3,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import sun.jvm.hotspot.gc.serial.*;\n@@ -113,0 +114,12 @@\n+  public boolean isInNewGen() {\n+    return ((gen != null) && (gen.equals(((SerialHeap)heap).getGen(0))));\n+  }\n+\n+  public boolean isInOldGen() {\n+    return ((gen != null) && (gen.equals(((SerialHeap)heap).getGen(1))));\n+  }\n+\n+  public boolean inOtherGen() {\n+    return (!isInNewGen() && !isInOldGen());\n+  }\n+\n@@ -117,0 +130,1 @@\n+  \/** This may be true if isInNewGen is also true *\/\n@@ -262,0 +276,12 @@\n+      } else {\n+        if (isInNewGen()) {\n+          tty.print(\"In new generation \");\n+        } else if (isInOldGen()) {\n+          tty.print(\"In old generation \");\n+        } else {\n+          tty.print(\"In unknown section of Java heap\");\n+        }\n+        if (getGeneration() != null) {\n+          getGeneration().printOn(tty); \/\/ does not include \"\\n\"\n+        }\n+        tty.println();\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/utilities\/PointerLocation.java","additions":26,"deletions":0,"binary":false,"changes":26,"status":"modified"}]}