{"files":[{"patch":"@@ -32,1 +32,4 @@\n-import java.io.IOException;\n+import java.io.ByteArrayInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.ObjectInputStream;\n+import java.io.ObjectOutputStream;\n@@ -48,1 +51,1 @@\n-    public static void main(String[] args) throws IOException {\n+    public static void main(String[] args) throws Exception {\n@@ -51,1 +54,1 @@\n-            updateProfile(true, cs);\n+            testProfile(false, true, cs);\n@@ -56,1 +59,1 @@\n-        updateProfile(false, ColorSpace.CS_sRGB);\n+        testProfile(false, false, ColorSpace.CS_sRGB);\n@@ -61,1 +64,3 @@\n-        testSerialization(true);\n+        for (int cs : colorSpace.keySet()) {\n+            testProfile(true, true, cs);\n+        }\n@@ -66,1 +71,1 @@\n-        testSerialization(false);\n+        testProfile(true, false, ColorSpace.CS_sRGB);\n@@ -70,1 +75,1 @@\n-    private static void updateProfile(boolean isBuiltIn, int cs) {\n+    private static void testProfile(boolean serializationTest, boolean isBuiltIn, int cs) {\n@@ -76,0 +81,15 @@\n+        if (serializationTest) {\n+            try (ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+                 ObjectOutputStream oos = new ObjectOutputStream(baos)) {\n+                oos.writeObject(iccProfile);\n+\n+                byte[] array = baos.toByteArray();\n+                try (ObjectInputStream ois =\n+                             new ObjectInputStream(new ByteArrayInputStream(array))) {\n+                    iccProfile = (ICC_Profile) ois.readObject();\n+                }\n+            } catch (Exception e) {\n+                throw new RuntimeException(\"Test Failed\", e);\n+            }\n+        }\n+\n@@ -102,22 +122,0 @@\n-\n-    \/\/ this test is added to check the ICC_Profile's transient isBuiltIn flag\n-    private static void testSerialization(boolean isBuiltIn)\n-                                                 throws IOException {\n-        ICC_Profile builtInProfile = ICC_Profile.getInstance(ColorSpace.CS_sRGB);\n-        \/\/ if isBuiltIn=true use builtInProfile else create a copy\n-        ICC_Profile iccProfile = isBuiltIn ? builtInProfile\n-                                 : ICC_Profile.getInstance(builtInProfile.getData());\n-\n-        iccProfile.write(\"Serialized_sRGB.icc\");\n-        ICC_Profile deSerialProfile = ICC_Profile.getInstance(\"Serialized_sRGB.icc\");\n-\n-        byte[] headerData = deSerialProfile.getData(HEADER_TAG);\n-        \/\/ Set profile class to valid icSigInputClass = 0x73636E72\n-        headerData[INDEX] = 0x73;\n-        headerData[INDEX + 1] = 0x63;\n-        headerData[INDEX + 2] = 0x6E;\n-        headerData[INDEX + 3] = 0x72;\n-\n-        \/\/ Modifying a deserialized profile should not throw IAE\n-        deSerialProfile.setData(HEADER_TAG, headerData);\n-    }\n","filename":"test\/jdk\/java\/awt\/color\/ICC_Profile\/BuiltInProfileCheck.java","additions":27,"deletions":29,"binary":false,"changes":56,"status":"modified"}]}