{"files":[{"patch":"@@ -218,7 +218,6 @@\n-                    \/\/ notify JVMTI\n-                    vthread.notifyJvmtiStart();\n-\n-                    vthread.run(task);\n-\n-                    \/\/ notify JVMTI\n-                    vthread.notifyJvmtiEnd();\n+                    vthread.notifyJvmtiStart(); \/\/ notify JVMTI\n+                    try {\n+                        vthread.run(task);\n+                    } finally {\n+                        vthread.notifyJvmtiEnd(); \/\/ notify JVMTI\n+                    }\n@@ -412,12 +411,8 @@\n-            try {\n-                \/\/ pop any remaining scopes from the stack, this may block\n-                StackableScope.popAll();\n-\n-                \/\/ emit JFR event if enabled\n-                if (VirtualThreadEndEvent.isTurnedOn()) {\n-                    var event = new VirtualThreadEndEvent();\n-                    event.javaThreadId = threadId();\n-                    event.commit();\n-                }\n-\n-            } finally {\n+            \/\/ pop any remaining scopes from the stack, this may block\n+            StackableScope.popAll();\n+\n+            \/\/ emit JFR event if enabled\n+            if (VirtualThreadEndEvent.isTurnedOn()) {\n+                var event = new VirtualThreadEndEvent();\n+                event.javaThreadId = threadId();\n+                event.commit();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/VirtualThread.java","additions":14,"deletions":19,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -35,1 +35,1 @@\n- * This annotation is only used for VirtualThread methods.\n+ * This annotation is only used for some VirtualThread and Continuation methods.\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/vm\/annotation\/JvmtiMountTransition.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}