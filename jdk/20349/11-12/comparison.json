{"files":[{"patch":"@@ -33,1 +33,0 @@\n-import com.sun.tools.javac.util.ListBuffer;\n@@ -36,0 +35,1 @@\n+import java.util.LinkedHashSet;\n@@ -60,1 +60,1 @@\n-    private final ListBuffer<VarSymbol> fvs = new ListBuffer<>();\n+    private final Set<VarSymbol> fvs = new LinkedHashSet<>();\n@@ -81,3 +81,1 @@\n-        if (!fvs.contains(v)) {\n-            fvs.prepend(v);\n-        }\n+        fvs.add(v);\n@@ -99,1 +97,1 @@\n-        return fvs.toList();\n+        return List.from(fvs);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/CaptureScanner.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -317,1 +317,1 @@\n-        fvs = collector.analyzeCaptures();\n+        fvs = collector.analyzeCaptures().reverse();\n@@ -2251,1 +2251,1 @@\n-      if (sym.owner.kind != MTH && rs.isSerializable(sym.type)) {\n+      if (rs.isSerializable(sym.type)) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Lower.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,47 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8336492\n+ * @summary Regression in lambda serialization\n+ *\/\n+\n+public class CaptureVarOrder {\n+    static Object m(String s, int i, Object o) {\n+        return new Object() {\n+            final byte B = 0;\n+            void g() { System.out.println(s + i + B + o); }\n+        };\n+    }\n+\n+    static Runnable r(String s, int i, Object o) {\n+        final byte B = 0;\n+        return () -> System.out.println(s + i + B + o);\n+    }\n+    \n+    public static void main(String[] args) throws ReflectiveOperationException {\n+        CaptureVarOrder.class.getDeclaredMethod(\"lambda$r$0\", String.class, int.class, Object.class);\n+        m(\"\", 1, null).getClass().getDeclaredConstructor(String.class, int.class, Object.class);\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/lambda\/CaptureVarOrder.java","additions":47,"deletions":0,"binary":false,"changes":47,"status":"added"},{"patch":"@@ -0,0 +1,23 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n@@ -20,1 +43,0 @@\n-        s.test(s::f_anon);\n@@ -57,13 +79,0 @@\n-\n-    Supplier<F> f_anon(int x) {\n-        return new Supplier<F>() {\n-            @Override\n-            public F get() {\n-                return new F() {\n-                    public int getValue() {\n-                        return x;\n-                    }\n-                };\n-            }\n-        };\n-    }\n","filename":"test\/langtools\/tools\/javac\/lambda\/SerializedLambdaInLocalClass.java","additions":23,"deletions":14,"binary":false,"changes":37,"status":"modified"}]}