{"files":[{"patch":"@@ -32,0 +32,1 @@\n+#include \"metaprogramming\/enableIf.hpp\"\n@@ -36,0 +37,2 @@\n+#include <limits>\n+\n@@ -290,0 +293,13 @@\n+TEST_VM(RiscV, cmpxchg_uint32_lr_sc) {\n+  bool zacas = UseZacas;\n+  UseZacas = false;\n+  run_plain_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+  UseZacas = zacas;\n+}\n+\n+TEST_VM(RiscV, cmpxchg_uint32_maybe_zacas) {\n+  if (UseZacas) {\n+    run_plain_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+  }\n+}\n+\n@@ -354,1 +370,1 @@\n-  add -= diff;\n+  add -= diff + 1; \/\/ add one to the diff for the wrap around.\n@@ -362,1 +378,1 @@\n-template <typename TESTSIZE>\n+template <typename TESTSIZE, ENABLE_IF(std::numeric_limits<TESTSIZE>::max() < (std::numeric_limits<TESTSIZE>::min() + TOTAL_ITERATIONS))>\n@@ -364,5 +380,1 @@\n-  if (std::numeric_limits<TESTSIZE>::max() > (std::numeric_limits<TESTSIZE>::min() + TOTAL_ITERATIONS)) {\n-    return std::numeric_limits<TESTSIZE>::min() + TOTAL_ITERATIONS;\n-  }\n-  int64_t range = std::numeric_limits<TESTSIZE>::max();\n-  range -= std::numeric_limits<TESTSIZE>::min();\n+  int64_t range = std::numeric_limits<TESTSIZE>::max() - std::numeric_limits<TESTSIZE>::min() + 1;\n@@ -373,3 +385,3 @@\n-template<>\n-constexpr int64_t result_count<int64_t>() {\n-    return std::numeric_limits<int64_t>::min() + TOTAL_ITERATIONS;\n+template <typename TESTSIZE, ENABLE_IF(std::numeric_limits<TESTSIZE>::max() > (std::numeric_limits<TESTSIZE>::min() + TOTAL_ITERATIONS))>\n+constexpr TESTSIZE result_count() {\n+  return std::numeric_limits<TESTSIZE>::min() + TOTAL_ITERATIONS;\n@@ -452,0 +464,15 @@\n+TEST_VM(RiscV, cmpxchg_uint32_concurrent_lr_sc) {\n+  bool zacas = UseZacas;\n+  UseZacas = false;\n+  run_concurrent_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+  run_concurrent_alt_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+  UseZacas = zacas;\n+}\n+\n+TEST_VM(RiscV, cmpxchg_uint32_concurrent_maybe_zacas) {\n+  if (UseZacas) {\n+    run_concurrent_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+    run_concurrent_alt_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+  }\n+}\n+\n@@ -535,2 +562,2 @@\n-  ASSERT_EQ(ret, 1);\n-  ASSERT_EQ(data, 42);\n+  ASSERT_EQ(ret, (TESTSIZE)1);\n+  ASSERT_EQ(data, (TESTSIZE)42);\n@@ -540,2 +567,2 @@\n-  ASSERT_EQ(ret, 0);\n-  ASSERT_EQ(data, 121);\n+  ASSERT_EQ(ret, (TESTSIZE)0);\n+  ASSERT_EQ(data, (TESTSIZE)121);\n@@ -570,0 +597,13 @@\n+TEST_VM(RiscV, weak_cmpxchg_uint32_lr_sc) {\n+  bool zacas = UseZacas;\n+  UseZacas = false;\n+  run_weak_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+  UseZacas = zacas;\n+}\n+\n+TEST_VM(RiscV, weak_cmpxchg_uint32_maybe_zacas) {\n+  if (UseZacas) {\n+    run_weak_cmpxchg_tests<uint32_t, Assembler::uint32>();\n+  }\n+}\n+\n","filename":"test\/hotspot\/gtest\/riscv\/test_assembler_riscv.cpp","additions":54,"deletions":14,"binary":false,"changes":68,"status":"modified"}]}