{"files":[{"patch":"@@ -2413,1 +2413,1 @@\n-void FileMapInfo::unmap_regions(int regions[], int num_regions) {\n+void FileMapInfo::unmap_regions(int regions[], int num_regions, ReservedSpace rs) {\n@@ -2416,1 +2416,9 @@\n-    unmap_region(idx);\n+\n+    \/\/ If the region is inside an active ReservedSpace, its memory and address space will be\n+    \/\/ freed when the ReservedSpace is released.\n+    if (!rs.is_reserved()) {\n+      unmap_region(idx);\n+    } else {\n+      \/\/ Treat this region as if it has been unmapped\n+      region_at(idx)->set_mapped_base(nullptr);\n+    }\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -473,1 +473,1 @@\n-  void  unmap_regions(int regions[], int num_regions);\n+  void  unmap_regions(int regions[], int num_regions, ReservedSpace rs);\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1351,2 +1351,2 @@\n-    unmap_archive(static_mapinfo);\n-    unmap_archive(dynamic_mapinfo);\n+    unmap_archive(static_mapinfo, archive_space_rs);\n+    unmap_archive(dynamic_mapinfo, archive_space_rs);\n@@ -1604,1 +1604,1 @@\n-    unmap_archive(mapinfo);\n+    unmap_archive(mapinfo, rs);\n@@ -1609,1 +1609,1 @@\n-    unmap_archive(mapinfo);\n+    unmap_archive(mapinfo, rs);\n@@ -1622,1 +1622,1 @@\n-    unmap_archive(mapinfo);\n+    unmap_archive(mapinfo, rs);\n@@ -1630,1 +1630,1 @@\n-void MetaspaceShared::unmap_archive(FileMapInfo* mapinfo) {\n+void MetaspaceShared::unmap_archive(FileMapInfo* mapinfo, ReservedSpace archive_space_rs) {\n@@ -1633,1 +1633,1 @@\n-    mapinfo->unmap_regions(archive_regions, archive_regions_count);\n+    mapinfo->unmap_regions(archive_regions, archive_regions_count, archive_space_rs);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -197,1 +197,1 @@\n-  static void unmap_archive(FileMapInfo* mapinfo);\n+  static void unmap_archive(FileMapInfo* mapinfo, ReservedSpace archive_space_rs);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}