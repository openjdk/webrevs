{"files":[{"patch":"@@ -1855,1 +1855,4 @@\n- * It will be transformed as a merged LoadI and replace the Or3 node\n+ * It is transformed as a merged LoadI, which replace the Or3 node.\n+ *\n+ * Because array value is logical and with constant 0xff\/0xffff, LoadS\/LoadB is converted to an unsigned load\n+ * and 'And' node is eliminated in previous IGVN phase. Please check AndINode::Ideal for reference\n@@ -1869,3 +1872,3 @@\n-  LoadNode*          _load;\n-  Node*                _or;\n-  int               _shift;\n+  LoadNode* const    _load;\n+  Node*     const      _or;\n+  int       const   _shift;\n@@ -1902,1 +1905,1 @@\n-  int          _last_op_index;    \/\/ Index of the last item in merged_list\n+  int          _last_op_index;    \/\/ Index of the last item in merge_list\n@@ -1976,1 +1979,1 @@\n-  if ( l != nullptr && l->outcnt() == 1 && l->unique_out()->Opcode() == Op_ConvI2L) {\n+  if (l != nullptr && l->outcnt() == 1 && l->unique_out()->Opcode() == Op_ConvI2L) {\n@@ -2194,0 +2197,1 @@\n+  \/\/ Collect draft merge list to array\n@@ -2202,1 +2206,1 @@\n-      NOT_PRODUCT( if (is_trace_basic()) { tty->print(\"[TraceMergeLoads]: merge_list:unreachable or nodes\"); base->_or->dump(); info->_or->dump(); tty->cr(); });\n+      NOT_PRODUCT( if (is_trace_basic() && info != nullptr) { tty->print(\"[TraceMergeLoads]: merge_list:unreachable or nodes\"); base->_or->dump(); info->_or->dump(); tty->cr(); });\n@@ -2232,0 +2236,1 @@\n+\n@@ -2236,0 +2241,1 @@\n+\n@@ -2238,1 +2244,12 @@\n-  int last_op_index = array[0]->last_op() ? 0 : -1;\n+  int last_op_index = -1;\n+\n+  \/\/ Check 1st element if it has last_op flag\n+  if (array[0]->last_op()) {\n+    if ((array[0]->_or->Opcode() == Op_OrI && bytes != 4) ||\n+        (array[0]->_or->Opcode() == Op_OrL && bytes != 8)) {\n+      \/\/ The merged load can not cover all bits of result value\n+      return;\n+    }\n+    last_op_index = 0;\n+  }\n+\n@@ -2259,1 +2276,0 @@\n-        last_op_index = i;\n@@ -2265,0 +2281,1 @@\n+        last_op_index = i;\n@@ -2267,0 +2284,1 @@\n+\n","filename":"src\/hotspot\/share\/opto\/memnode.cpp","additions":27,"deletions":9,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -146,0 +146,1 @@\n+\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/TestMergeLoads.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}