{"files":[{"patch":"@@ -476,1 +476,1 @@\n-\n+        Object postData = getPostData();\n@@ -480,1 +480,1 @@\n-            scrollRectToVisible(new Rectangle(0,0,1,1));\n+            scrollRectToVisible(new Rectangle(0, 0, 1, 1));\n@@ -482,4 +482,0 @@\n-        boolean reloaded = false;\n-        Object postData = getPostData();\n-        if ((loaded == null) || !loaded.sameFile(page) || (postData != null)) {\n-            \/\/ different url or POST method, load the new content\n@@ -487,6 +483,6 @@\n-            int p = getAsynchronousLoadPriority(getDocument());\n-            if (p < 0) {\n-                \/\/ open stream synchronously\n-                InputStream in = getStream(page);\n-                if (kit != null) {\n-                    Document doc = initializeModel(kit, page);\n+        if ((postData == null) && (page.sameFile(loaded))) {\n+            if (page.getRef() != null) {\n+                scrollToReference(page.getRef());\n+            }\n+            return;\n+        }\n@@ -494,23 +490,8 @@\n-                    \/\/ At this point, one could either load up the model with no\n-                    \/\/ view notifications slowing it down (i.e. best synchronous\n-                    \/\/ behavior) or set the model and start to feed it on a separate\n-                    \/\/ thread (best asynchronous behavior).\n-                    p = getAsynchronousLoadPriority(doc);\n-                    if (p >= 0) {\n-                        \/\/ load asynchronously\n-                        setDocument(doc);\n-                        synchronized(this) {\n-                            pageLoader = new PageLoader(doc, in, loaded, page);\n-                            pageLoader.execute();\n-                        }\n-                        return;\n-                    }\n-                    read(in, doc);\n-                    setDocument(doc);\n-                    reloaded = true;\n-                }\n-            } else {\n-                \/\/ we may need to cancel background loading\n-                if (pageLoader != null) {\n-                    pageLoader.cancel(true);\n-                }\n+        \/\/ different url or POST method, load the new content\n+        synchronized (this) {\n+            \/\/ we need to cancel background loading\n+            if (pageLoader != null) {\n+                pageLoader.cancel(true);\n+                pageLoader = null;\n+            }\n+        }\n@@ -518,0 +499,3 @@\n+        int p = getAsynchronousLoadPriority(getDocument());\n+        if (p >= 0) {\n+            synchronized (this) {\n@@ -522,1 +506,0 @@\n-                return;\n@@ -524,0 +507,25 @@\n+            return;\n+        }\n+\n+        \/\/ open stream synchronously\n+        InputStream in = getStream(page);\n+\n+        if ((kit == null)) {\n+            return;\n+        }\n+\n+        Document doc = initializeModel(kit, page);\n+\n+        \/\/ At this point, one could either load up the model with no\n+        \/\/ view notifications slowing it down (i.e. best synchronous\n+        \/\/ behavior) or set the model and start to feed it on a separate\n+        \/\/ thread (best asynchronous behavior).\n+        p = getAsynchronousLoadPriority(doc);\n+        if (p >= 0) {\n+            \/\/ load asynchronously\n+            setDocument(doc);\n+            synchronized (this) {\n+                pageLoader = new PageLoader(doc, in, loaded, page);\n+                pageLoader.execute();\n+            }\n+            return;\n@@ -525,0 +533,4 @@\n+\n+        read(in, doc);\n+        setDocument(doc);\n+\n@@ -527,11 +539,7 @@\n-            if (!reloaded) {\n-                scrollToReference(reference);\n-            }\n-            else {\n-                \/\/ Have to scroll after painted.\n-                SwingUtilities.invokeLater(new Runnable() {\n-                    public void run() {\n-                        scrollToReference(reference);\n-                    }\n-                });\n-            }\n+            \/\/ Have to scroll after painted.\n+            SwingUtilities.invokeLater(new Runnable() {\n+                public void run() {\n+                    scrollToReference(reference);\n+                }\n+            });\n+\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/JEditorPane.java","additions":55,"deletions":47,"binary":false,"changes":102,"status":"modified"}]}