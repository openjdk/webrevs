{"files":[{"patch":"@@ -387,1 +387,1 @@\n-    private static List<String> addTestThreadFactoryArgs(String testThreadFactoryName, List<String> command) {\n+    private static String[] addTestThreadFactoryArgs(String testThreadFactoryName, String[] commandArgs) {\n@@ -401,1 +401,1 @@\n-        for (String cmd : command) {\n+        for (String arg : commandArgs) {\n@@ -403,1 +403,1 @@\n-                args.add(cmd);\n+                args.add(arg);\n@@ -409,1 +409,1 @@\n-                args.add(cmd);\n+                args.add(arg);\n@@ -412,2 +412,2 @@\n-            if (unsupportedArgs.contains(cmd)) {\n-                return command;\n+            if (unsupportedArgs.contains(arg)) {\n+                return commandArgs;\n@@ -415,1 +415,1 @@\n-            if (doubleWordArgs.contains(cmd)) {\n+            if (doubleWordArgs.contains(arg)) {\n@@ -417,1 +417,1 @@\n-                args.add(cmd);\n+                args.add(arg);\n@@ -424,2 +424,2 @@\n-            if (cmd.startsWith(\"-\") || cmd.startsWith(\"@\")) {\n-                args.add(cmd);\n+            if (arg.startsWith(\"-\") || arg.startsWith(\"@\")) {\n+                args.add(arg);\n@@ -430,2 +430,2 @@\n-            if (cmd.endsWith(\".java\")) {\n-                return command;\n+            if (arg.endsWith(\".java\")) {\n+                return commandArgs;\n@@ -439,1 +439,1 @@\n-            args.add(cmd);\n+            args.add(arg);\n@@ -441,1 +441,1 @@\n-        return args;\n+        return args.toArray(String[]::new);\n@@ -463,6 +463,1 @@\n-        String testThreadFactoryName = System.getProperty(\"test.thread.factory\");\n-        if (testThreadFactoryName != null) {\n-            args.addAll(addTestThreadFactoryArgs(testThreadFactoryName, Arrays.asList(command)));\n-        } else {\n-            Collections.addAll(args, command);\n-        }\n+        Collections.addAll(args, command);\n@@ -521,1 +516,6 @@\n-        return createJavaProcessBuilder(Utils.prependTestJavaOpts(command));\n+        String[] newCommand = Utils.prependTestJavaOpts(command);\n+        String testThreadFactoryName = System.getProperty(\"test.thread.factory\");\n+        if (testThreadFactoryName != null) {\n+            newCommand = addTestThreadFactoryArgs(testThreadFactoryName, newCommand);\n+        }\n+        return createJavaProcessBuilder(newCommand);\n","filename":"test\/lib\/jdk\/test\/lib\/process\/ProcessTools.java","additions":21,"deletions":21,"binary":false,"changes":42,"status":"modified"}]}