{"files":[{"patch":"@@ -1,22 +1,2 @@\n-\/*\n- * Copyright (c) 2024, IBM Corporation. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n+import java.nio.file.Path;\n+import jdk.test.lib.process.ProcessTools;\n@@ -27,0 +7,1 @@\n+ * @summary verify that System.loadLibrary on AIX is able to load libraries from \".a\" (archive) file\n@@ -28,1 +9,3 @@\n- * @run  main\/othervm  LoadAIXLibraryFromArchiveObject\n+ * @library \/test\/lib\/\n+ * @build jdk.test.lib.process.ProcessTools\n+ * @run  main\/othervm   LoadAIXLibraryFromArchiveObject\n@@ -30,0 +13,1 @@\n+public class LoadAIXLibraryFromArchiveObject {\n@@ -31,3 +15,24 @@\n-import java.io.*;\n-import java.lang.Object.*;\n-import java.nio.file.Files;\n+    private static final String TEST_LIBRARY_NAME = \"foobar\";\n+    \/\/ creates a \".a\" archive file in a test specific directory and then\n+    \/\/ launches a java application passing this directory through \"-Djava.library.path\".\n+    \/\/ the java application then attempts to load the library using System.loadLibrary()\n+    public static void main(final String[] args) throws Exception {\n+        final String javaHome = System.getProperty(\"java.home\");\n+        final Path libj2pcscSo = Path.of(javaHome).resolve(\"lib\", \"libj2pcsc.so\");\n+        if (!Files.exists(libawtSo)) {\n+            throw new AssertionError(libawtSo + \" is missing\");\n+        }\n+        final String archiveFileName = \"lib\" + TEST_LIBRARY_NAME + \".a\";\n+        \/\/ copy over libj2pcsc.so as an archive file to test specific scratch dir\n+        final Path testNativeLibDir = Path.of(\"native\").toAbsolutePath();\n+        Files.createDirectories(testNativeLibDir);\n+        final Path libDummyArchive = testNativeLibDir.resolve(archiveFileName);\n+        Files.copy(libawtSo, libDummyArchive);\n+        \/\/ \/\/ launch a java application which calls System.loadLibrary and is passed\n+        \/\/ \/\/ the directory containing the native library archive file, through\n+        \/\/ \/\/ -Djava.library.path\n+        final ProcessBuilder processBuilder = ProcessTools.createTestJavaProcessBuilder(\n+                \"-Djava.library.path=\" + testNativeLibDir,\n+                LoadAIXLibraryFromArchiveObject.LoadLibraryApp.class.getName());\n+        ProcessTools.executeCommand(processBuilder).shouldHaveExitValue(0);\n+    }\n@@ -35,10 +40,6 @@\n-public class LoadAIXLibraryFromArchiveObject {\n-    public static void main(String[] args) throws Exception {\n-        String libraryName = \"dummyarchive\";\n-        String javaHome = System.getProperty(\"java.home\");\n-        File awtSharedObjectPath = new File(javaHome+\"\/lib\/libawt.so\");\n-        File awtArchivePath = new File(javaHome+\"\/lib\/libdummyarchive.a\");\n-        Files.copy(awtSharedObjectPath.toPath(), awtArchivePath.toPath());\n-        System.loadLibrary(libraryName);\n-        if (!awtArchivePath.delete())\n-            throw new RuntimeException(\"LoadLibraryFromArchiveObject: Failed to delete dummy archive file.\");\n+    static class LoadLibraryApp {\n+        public static void main(final String[] args) throws Exception {\n+            System.out.println(\"attempting to load library \" + TEST_LIBRARY_NAME);\n+            System.loadLibrary(TEST_LIBRARY_NAME);\n+            System.out.println(TEST_LIBRARY_NAME + \" successfully loaded\");\n+        }\n@@ -46,1 +47,1 @@\n-}\n+}\n\\ No newline at end of file\n","filename":"test\/jdk\/java\/lang\/RuntimeTests\/loadLibrary\/aix\/LoadAIXLibraryFromArchiveObject.java","additions":38,"deletions":37,"binary":false,"changes":75,"status":"modified"}]}