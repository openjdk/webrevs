{"files":[{"patch":"@@ -813,4 +813,12 @@\n-  \/\/ FIXME: validation in Klass::hash_secondary_supers() may fail for shared klasses.\n-  \/\/ Even though the bitmaps always match, the canonical order of elements in the table\n-  \/\/ is not guaranteed to stay the same (see tie breaker during Robin Hood hashing in Klass::hash_insert).\n-  \/\/assert(compute_secondary_supers_bitmap(secondary_supers()) == _secondary_supers_bitmap, \"broken table\");\n+  if (CDSConfig::is_dumping_classic_static_archive()) {\n+    \/\/ \"Classic\" static archives are required to have deterministic contents.\n+    \/\/ The elements in _secondary_supers are addresses in the ArchiveBuilder\n+    \/\/ output buffer, so they should have deterministic values. If we rehash\n+    \/\/ _secondary_supers, its elements will appear in a deterministic order.\n+    \/\/\n+    \/\/ Note that the bitmap is guatanteed to be deterministic, regardless of the\n+    \/\/ actual addresses of the elements in _secondary_supers. So rehashing shouldn't\n+    \/\/ change it.\n+    uintx bitmap = hash_secondary_supers(secondary_supers(), true);\n+    assert(bitmap == _secondary_supers_bitmap, \"bitmap should not be changed due to rehashing\");\n+  }\n","filename":"src\/hotspot\/share\/oops\/klass.cpp","additions":12,"deletions":4,"binary":false,"changes":16,"status":"modified"}]}