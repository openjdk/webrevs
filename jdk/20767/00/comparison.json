{"files":[{"patch":"@@ -234,0 +234,2 @@\n+            } else {\n+                inflateCHAR(singleBytes, hash);\n@@ -235,5 +237,7 @@\n-            else {\n-                char[] chararr = new char[rawLen];\n-                int chararr_count = singleBytes;\n-                \/\/ Inflate prefix of bytes to characters\n-                JLA.inflateBytesToChars(rawBytes, offset, chararr, 0, singleBytes);\n+        }\n+\n+        private void inflateCHAR(int singleBytes, int hash) {\n+            char[] chararr = new char[rawLen];\n+            int chararr_count = singleBytes;\n+            \/\/ Inflate prefix of bytes to characters\n+            JLA.inflateBytesToChars(rawBytes, offset, chararr, 0, singleBytes);\n@@ -241,11 +245,17 @@\n-                int px = offset + singleBytes;\n-                int utfend = offset + rawLen;\n-                while (px < utfend) {\n-                    int c = (int) rawBytes[px] & 0xff;\n-                    switch (c >> 4) {\n-                        case 0, 1, 2, 3, 4, 5, 6, 7: {\n-                            \/\/ 0xxx xxxx\n-                            px++;\n-                            chararr[chararr_count++] = (char) c;\n-                            hash = 31 * hash + c;\n-                            break;\n+            int px = offset + singleBytes;\n+            int utfend = offset + rawLen;\n+            while (px < utfend) {\n+                int c = (int) rawBytes[px] & 0xff;\n+                switch (c >> 4) {\n+                    case 0, 1, 2, 3, 4, 5, 6, 7: {\n+                        \/\/ 0xxx xxxx\n+                        px++;\n+                        chararr[chararr_count++] = (char) c;\n+                        hash = 31 * hash + c;\n+                        break;\n+                    }\n+                    case 12, 13: {\n+                        \/\/ 110x xxxx  10xx xxxx\n+                        px += 2;\n+                        if (px > utfend) {\n+                            throw new CpException(\"malformed input: partial character at end\");\n@@ -253,14 +263,3 @@\n-                        case 12, 13: {\n-                            \/\/ 110x xxxx  10xx xxxx\n-                            px += 2;\n-                            if (px > utfend) {\n-                                throw new CpException(\"malformed input: partial character at end\");\n-                            }\n-                            int char2 = rawBytes[px - 1];\n-                            if ((char2 & 0xC0) != 0x80) {\n-                                throw new CpException(\"malformed input around byte \" + px);\n-                            }\n-                            char v = (char) (((c & 0x1F) << 6) | (char2 & 0x3F));\n-                            chararr[chararr_count++] = v;\n-                            hash = 31 * hash + v;\n-                            break;\n+                        int char2 = rawBytes[px - 1];\n+                        if ((char2 & 0xC0) != 0x80) {\n+                            throw new CpException(\"malformed input around byte \" + px);\n@@ -268,15 +267,10 @@\n-                        case 14: {\n-                            \/\/ 1110 xxxx  10xx xxxx  10xx xxxx\n-                            px += 3;\n-                            if (px > utfend) {\n-                                throw new CpException(\"malformed input: partial character at end\");\n-                            }\n-                            int char2 = rawBytes[px - 2];\n-                            int char3 = rawBytes[px - 1];\n-                            if (((char2 & 0xC0) != 0x80) || ((char3 & 0xC0) != 0x80)) {\n-                                throw new CpException(\"malformed input around byte \" + (px - 1));\n-                            }\n-                            char v = (char) (((c & 0x0F) << 12) | ((char2 & 0x3F) << 6) | (char3 & 0x3F));\n-                            chararr[chararr_count++] = v;\n-                            hash = 31 * hash + v;\n-                            break;\n+                        char v = (char) (((c & 0x1F) << 6) | (char2 & 0x3F));\n+                        chararr[chararr_count++] = v;\n+                        hash = 31 * hash + v;\n+                        break;\n+                    }\n+                    case 14: {\n+                        \/\/ 1110 xxxx  10xx xxxx  10xx xxxx\n+                        px += 3;\n+                        if (px > utfend) {\n+                            throw new CpException(\"malformed input: partial character at end\");\n@@ -284,3 +278,9 @@\n-                        default:\n-                            \/\/ 10xx xxxx,  1111 xxxx\n-                            throw new CpException(\"malformed input around byte \" + px);\n+                        int char2 = rawBytes[px - 2];\n+                        int char3 = rawBytes[px - 1];\n+                        if (((char2 & 0xC0) != 0x80) || ((char3 & 0xC0) != 0x80)) {\n+                            throw new CpException(\"malformed input around byte \" + (px - 1));\n+                        }\n+                        char v = (char) (((c & 0x0F) << 12) | ((char2 & 0x3F) << 6) | (char3 & 0x3F));\n+                        chararr[chararr_count++] = v;\n+                        hash = 31 * hash + v;\n+                        break;\n@@ -288,0 +288,3 @@\n+                    default:\n+                        \/\/ 10xx xxxx,  1111 xxxx\n+                        throw new CpException(\"malformed input around byte \" + px);\n@@ -289,4 +292,0 @@\n-                this.hash = hashString(hash);\n-                charLen = chararr_count;\n-                this.chars = chararr;\n-                state = State.CHAR;\n@@ -294,1 +293,4 @@\n-\n+            this.hash = hashString(hash);\n+            charLen = chararr_count;\n+            this.chars = chararr;\n+            state = State.CHAR;\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/classfile\/impl\/AbstractPoolEntry.java","additions":55,"deletions":53,"binary":false,"changes":108,"status":"modified"}]}