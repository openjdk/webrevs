{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -143,0 +143,5 @@\n+    if (argc == 1) {\n+        fprintf(stdout, \"An earlier version of Java is trying to call jspawnhelper.\\n\");\n+        fprintf(stdout, \"Please restart Java process.\\n\");\n+        exit(1);\n+    }\n","filename":"src\/java.base\/unix\/native\/jspawnhelper\/jspawnhelper.c","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import java.nio.file.Paths;\n@@ -95,0 +96,34 @@\n+    private static void jspawnhelperWithNoArgs() throws Exception {\n+        System.out.println(\"Running jspawnhelper without args\");\n+        Process p = null;\n+        try {\n+            p = Runtime.getRuntime().exec(Paths.get(System.getProperty(\"java.home\"), \"lib\", \"jspawnhelper\").toString());\n+        } catch (Exception e) {\n+            e.printStackTrace(System.out);\n+            System.exit(ERROR);\n+        }\n+        if (!p.waitFor(TIMEOUT, TimeUnit.SECONDS)) {\n+            System.out.println(\"Child process timed out\");\n+            System.exit(ERROR + 1);\n+        }\n+        if (p.exitValue() != 1)\n+            System.exit(ERROR + 2);\n+        System.exit(0);\n+    }\n+\n+    private static void simulateJspawnhelperWithoutArgs() throws Exception {\n+        ProcessBuilder pb;\n+        pb = ProcessTools.createLimitedTestJavaProcessBuilder(\"-Djdk.lang.Process.launchMechanism=posix_spawn\",\n+                                                              \"JspawnhelperProtocol\",\n+                                                              \"noargs\");\n+        pb.inheritIO();\n+        Process p = pb.start();\n+\n+        if (!p.waitFor(TIMEOUT, TimeUnit.SECONDS)) {\n+            throw new Exception(\"Parent process timed out\");\n+        }\n+        if (p.exitValue() != 0) {\n+            throw new Exception(\"Parent process exited with \" + p.exitValue());\n+        }\n+    }\n+\n@@ -225,1 +260,4 @@\n-            parentCode(args[0]);\n+            if (\"noargs\".equals(args[0]))\n+                jspawnhelperWithNoArgs();\n+            else\n+                parentCode(args[0]);\n@@ -229,0 +267,1 @@\n+            simulateJspawnhelperWithoutArgs();\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/JspawnhelperProtocol.java","additions":40,"deletions":1,"binary":false,"changes":41,"status":"modified"}]}