{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,1 @@\n+import javax.swing.UIManager;\n@@ -609,0 +610,9 @@\n+    @Override\n+    public synchronized void setEditable(boolean b) {\n+        super.setEditable(b);\n+        Color defaultBackground = this.getBackground();\n+        if (!backgroundSetByClientCode) {\n+            setBackground(defaultBackground, false);\n+        }\n+    }\n+\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/TextArea.java","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -362,0 +362,5 @@\n+    void setBackground(Color c, boolean setByClient) {\n+        backgroundSetByClientCode = setByClient;\n+        super.setBackground(c);\n+    }\n+\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/TextComponent.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,0 +40,1 @@\n+import javax.swing.UIManager;\n@@ -491,0 +492,9 @@\n+    @Override\n+    public synchronized void setEditable(boolean b) {\n+        super.setEditable(b);\n+        Color defaultBackground = UIManager.getColor(\"TextField.background\");\n+        if (!backgroundSetByClientCode) {\n+            setBackground(b ? defaultBackground : SystemColor.control, false);\n+        }\n+    }\n+\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/TextField.java","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -0,0 +1,136 @@\n+\/*\n+ * Copyright (c) 1999, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.awt.Button;\n+import java.awt.Color;\n+import java.awt.FlowLayout;\n+import java.awt.Frame;\n+import java.awt.TextArea;\n+import java.awt.TextField;\n+import java.awt.event.ActionEvent;\n+import java.awt.event.ActionListener;\n+\n+\/*\n+ * @test\n+ * @bug 4258667 4405602\n+ * @summary  Make sure TextComponents are grayed out when non-editable\n+ *           if the background color has not been set by client code.\n+ *           Make sure TextComponents are not grayed out when non-editable\n+ *           if the background color has been set by client code.\n+ * @key headful\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n+ * @run main\/manual BackgroundTest\n+ *\/\n+\n+public class BackgroundTest {\n+    private static final String instructions =\n+            \"\"\"\n+                    The test frame should have a blue background.\n+                    The first TextField and TextArea will be the default color.\n+                    On Windows and macOS, this is usually white.  On Solaris, it will match\n+                    your environment settings.\n+                    The second TextField and TextArea will be green.\n+\n+                    Press the DisableText button.\n+\n+                    The first TextField and TextArea should change colors to the\n+                    default disabled color.  On Windows, this is usually gray.\n+                    On Solaris, it will match your environment settings.  If either\n+                    the TextField or the TextArea do not change colors as described,\n+                    the test FAILS.\n+\n+                    The second TextField and TextArea should still be green.\n+                    If either of them are not green, the test FAILS.\n+\n+                    Press the EnableText button (same button as before).\n+\n+                    The first TextField and TextArea should return to their\n+                    original colors as described in the first paragraph. If they\n+                    do not, the test FAILS.\n+\n+                    The second TextField and TextArea should still be green.\n+                    If either of them are not green, the test FAILS.\n+\n+                    Otherwise, the test PASSES.\n+                    \"\"\";\n+\n+    public static void main(String[] args) throws Exception {\n+        PassFailJFrame.builder()\n+                .instructions(instructions)\n+                .rows((int) instructions.lines().count() + 1)\n+                .columns(45)\n+                .testUI(BackgroundTest::createUI)\n+                .build()\n+                .awaitAndCheck();\n+    }\n+\n+    public static Frame createUI() {\n+        Frame f = new Frame(\"BackgroundTest\");\n+\n+        f.setBackground(Color.blue);\n+        f.setLayout(new FlowLayout(FlowLayout.CENTER));\n+\n+        TextField tf = new TextField(30);\n+        TextArea ta = new TextArea(4, 30);\n+        TextField setTf = new TextField(30);\n+        TextArea setTa = new TextArea(4, 30);\n+\n+        Button enableButton = new Button(\"DisableText\");\n+        enableButton.setBackground(Color.red);\n+\n+        tf.setText(\"Background not set - should be default\");\n+        tf.setEditable(true);\n+        f.add(tf);\n+        ta.setText(\"Background not set - should be default\");\n+        ta.setEditable(true);\n+        f.add(ta);\n+\n+        setTf.setText(\"Background is set - should be Green\");\n+        setTf.setBackground(Color.green);\n+        setTf.setEditable(true);\n+        f.add(setTf);\n+        setTa.setText(\"Background is set - should be Green\");\n+        setTa.setBackground(Color.green);\n+        setTa.setEditable(true);\n+        f.add(setTa);\n+\n+        enableButton.addActionListener(new ActionListener() {\n+            @Override\n+            public void actionPerformed(ActionEvent e) {\n+                boolean currentlyEditable = tf.isEditable();\n+\n+                tf.setEditable(!currentlyEditable);\n+                ta.setEditable(!currentlyEditable);\n+                setTf.setEditable(!currentlyEditable);\n+                setTa.setEditable(!currentlyEditable);\n+                enableButton.setLabel(currentlyEditable ? \"EnableText\" : \"DisableText\");\n+            }\n+        });\n+\n+        f.add(enableButton);\n+\n+        f.setSize(300, 300);\n+        return f;\n+    }\n+}\n","filename":"test\/jdk\/java\/awt\/TextComponent\/BackgroundTest.java","additions":136,"deletions":0,"binary":false,"changes":136,"status":"added"}]}