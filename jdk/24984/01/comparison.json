{"files":[{"patch":"@@ -62,0 +62,1 @@\n+  CHeapStringHolder _inline_messages;\n@@ -468,0 +469,3 @@\n+  void record_inline_messages(const char* msgs) { _inline_messages.set(msgs); }\n+  const char* inline_messages() { return _inline_messages.get(); }\n+\n","filename":"src\/hotspot\/share\/ci\/ciEnv.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -342,0 +342,2 @@\n+  task->mark_queued(os::elapsed_counter());\n+\n@@ -2154,1 +2156,0 @@\n-  task->print_ul();\n@@ -2158,4 +2159,0 @@\n-  if (directive->PrintCompilationOption) {\n-    ResourceMark rm;\n-    task->print_tty();\n-  }\n@@ -2176,0 +2173,1 @@\n+  bool should_print_compilation = PrintCompilation || directive->PrintCompilationOption;\n@@ -2178,0 +2176,8 @@\n+\n+  \/\/ Print the task before compilation.\n+  if (should_print_compilation) {\n+    ttyLocker ttyl;  \/\/ keep the following output all in one block\n+    task->print(tty, \"started\", false, true);\n+  }\n+  task->print_ul(\"started\");\n+\n@@ -2345,1 +2351,0 @@\n-  }\n@@ -2347,10 +2352,26 @@\n-  if (failure_reason != nullptr) {\n-    task->set_failure_reason(failure_reason, failure_reason_on_C_heap);\n-    if (CompilationLog::log() != nullptr) {\n-      CompilationLog::log()->log_failure(thread, task, failure_reason, retry_message);\n-    }\n-    if (PrintCompilation || directive->PrintCompilationOption) {\n-      FormatBufferResource msg = retry_message != nullptr ?\n-        FormatBufferResource(\"COMPILE SKIPPED: %s (%s)\", failure_reason, retry_message) :\n-        FormatBufferResource(\"COMPILE SKIPPED: %s\",      failure_reason);\n-      task->print(tty, msg);\n+    task->mark_finished(os::elapsed_counter());\n+\n+    if (failure_reason != nullptr) {\n+      task->set_failure_reason(failure_reason, failure_reason_on_C_heap);\n+      if (CompilationLog::log() != nullptr) {\n+        CompilationLog::log()->log_failure(thread, task, failure_reason, retry_message);\n+      }\n+      if (should_print_compilation) {\n+        ttyLocker ttyl;\n+        FormatBufferResource msg = retry_message != nullptr ?\n+          FormatBufferResource(\"COMPILE SKIPPED: %s (%s)\", failure_reason, retry_message) :\n+          FormatBufferResource(\"COMPILE SKIPPED: %s\",      failure_reason);\n+        task->print(tty, msg);\n+      }\n+    } else {\n+      if (should_print_compilation) {\n+        ttyLocker ttyl;\n+        task->print_tty();\n+\n+        \/\/ Print inlining information for successful compilations\n+        const char* inline_msgs = ci_env.inline_messages();\n+        if (inline_msgs != nullptr) {\n+          tty->print_raw_cr(inline_msgs);\n+        }\n+      }\n+      task->print_ul();\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.cpp","additions":37,"deletions":16,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -118,1 +118,2 @@\n-  _time_queued = os::elapsed_counter();\n+  _time_created = os::elapsed_counter();\n+  _time_queued = 0;\n@@ -120,0 +121,1 @@\n+  _time_finished = 0;\n@@ -224,1 +226,1 @@\n-                             jlong time_queued, jlong time_started) {\n+                             jlong time_created, jlong time_queued, jlong time_started, jlong time_finished) {\n@@ -227,8 +229,18 @@\n-    st->print(UINT64_FORMAT \" \", (uint64_t) tty->time_stamp().milliseconds());\n-    if (Verbose && time_queued != 0) {\n-      \/\/ Print time in queue and time being processed by compiler thread\n-      jlong now = os::elapsed_counter();\n-      st->print(\"%.0f \", TimeHelper::counter_to_millis(now-time_queued));\n-      if (time_started != 0) {\n-        st->print(\"%.0f \", TimeHelper::counter_to_millis(now-time_started));\n-      }\n+    st->print(UINT64_FORMAT_W(7), (uint64_t) tty->time_stamp().milliseconds());\n+    \/\/ Time waiting to be put on queue\n+    if (time_created != 0 && time_queued != 0) {\n+      st->print(\"%7.0f \", TimeHelper::counter_to_micros(time_queued - time_created));\n+    } else {\n+      st->print(\"%7s \", \"\");\n+    }\n+    \/\/ Time in queue\n+    if (time_queued != 0 && time_started != 0) {\n+      st->print(\"%7.0f \", TimeHelper::counter_to_micros(time_started - time_queued));\n+    } else {\n+      st->print(\"%7s \", \"\");\n+    }\n+    \/\/ Time in compilation\n+    if (time_started != 0 && time_finished != 0) {\n+      st->print(\"%7.0f \", TimeHelper::counter_to_micros(time_finished - time_started));\n+    } else {\n+      st->print(\"%7s \", \"\");\n@@ -236,0 +248,1 @@\n+    st->print(\"  \");\n@@ -292,1 +305,3 @@\n-  print_impl(st, is_unloaded() ? nullptr : method(), compile_id(), comp_level(), is_osr_method, osr_bci(), is_blocking(), msg, short_form, cr, _time_queued, _time_started);\n+  print_impl(st, is_unloaded() ? nullptr : method(), compile_id(), comp_level(),\n+             is_osr_method, osr_bci(), is_blocking(), msg, short_form, cr,\n+             _time_created, _time_queued, _time_started, _time_finished);\n","filename":"src\/hotspot\/share\/compiler\/compileTask.cpp","additions":26,"deletions":11,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -107,2 +107,4 @@\n-  jlong                _time_queued;  \/\/ time when task was enqueued\n-  jlong                _time_started; \/\/ time when compilation started\n+  jlong                _time_created;  \/\/ time when task was created\n+  jlong                _time_queued;   \/\/ time when task was enqueued\n+  jlong                _time_started;  \/\/ time when compilation started\n+  jlong                _time_finished; \/\/ time when compilation finished\n@@ -197,0 +199,1 @@\n+  void         mark_queued(jlong time)           { _time_queued = time; }\n@@ -198,0 +201,1 @@\n+  void         mark_finished(jlong time)         { _time_finished = time; }\n@@ -229,1 +233,1 @@\n-                                      jlong time_queued = 0, jlong time_started = 0);\n+                                      jlong time_created = 0, jlong time_queued = 0, jlong time_started = 0, jlong time_finished = 0);\n","filename":"src\/hotspot\/share\/compiler\/compileTask.hpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -4526,1 +4526,3 @@\n-  inline_printer()->print_on(tty);\n+  stringStream ss;\n+  inline_printer()->print_on(&ss);\n+  _env->record_inline_messages(ss.as_string(\/* c_heap = *\/ true));\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -40,0 +40,4 @@\n+double TimeHelper::counter_to_micros(jlong counter) {\n+  return counter_to_seconds(counter) * 1000000.0;\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/timer.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -78,0 +78,1 @@\n+  static double counter_to_micros(jlong counter);\n","filename":"src\/hotspot\/share\/runtime\/timer.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -105,1 +105,1 @@\n-                \"c2: { PrintInlining: true } }]\";\n+                \"c2: { PrintCompilation: true, PrintInlining: true } }]\";\n","filename":"test\/hotspot\/jtreg\/compiler\/cha\/TypeProfileFinalMethod.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -63,0 +63,1 @@\n+                \"-XX:+PrintCompilation\",\n","filename":"test\/hotspot\/jtreg\/compiler\/inlining\/TestDuplicatedLateInliningOutput.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}