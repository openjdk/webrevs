{"files":[{"patch":"@@ -52,9 +52,0 @@\n-#if defined(_AIX)\n-  \/* AIX does not understand '\/proc\/self' - it requires the real process ID *\/\n-  #define FD_DIR aix_fd_dir\n-#elif defined(_ALLBSD_SOURCE)\n-  #define FD_DIR \"\/dev\/fd\"\n-#else\n-  #define FD_DIR \"\/proc\/self\/fd\"\n-#endif\n-\n@@ -76,0 +67,9 @@\n+#if defined(_AIX)\n+  \/* AIX does not understand '\/proc\/self' - it requires the real process ID *\/\n+  #define FD_DIR aix_fd_dir\n+#elif defined(_ALLBSD_SOURCE)\n+  #define FD_DIR \"\/dev\/fd\"\n+#else\n+  #define FD_DIR \"\/proc\/self\/fd\"\n+#endif\n+\n@@ -79,1 +79,1 @@\n-\/\/ returns 0 on failure and 1 on success.\n+\/\/ returns -1 on failure and 0 on success.\n@@ -95,1 +95,1 @@\n-                       \" file descriptors to close for process %d\",\n+                       \" file descriptors to mark or close for process %d\",\n@@ -97,1 +97,1 @@\n-        return 0; \/\/ failure\n+        return -1; \/\/ failure\n@@ -116,1 +116,1 @@\n-    return 1; \/\/ success\n+    return 0; \/\/ success\n@@ -119,3 +119,4 @@\n-\/\/ Does necessary housekeeping of a forked child process\n-\/\/ (like closing copied file descriptors) before\n-\/\/ execing the child process. This function never returns.\n+\/\/ Performs necessary housekeeping in the forked child process,\n+\/\/ such as marking copied file descriptors (except standard input\/output\/error)\n+\/\/ with FD_CLOEXEC to ensure they are closed during exec().\n+\/\/ This function never returns.\n@@ -125,3 +126,4 @@\n-    \/* Close all file descriptors that have been copied over\n-     * from the parent process due to fork(). *\/\n-    if (markDescriptorsCloseOnExec() != 1) { \/* failed,  close the old way *\/\n+    \/* Mark all file descriptors (except standard input\/output\/error)\n+     * copied from the parent process with FD_CLOEXEC, so they are\n+     * closed automatically upon exec(). *\/\n+    if (markDescriptorsCloseOnExec() < 0) { \/* failed,  close the old way *\/\n","filename":"src\/jdk.jdwp.agent\/unix\/native\/libjdwp\/exec_md.c","additions":21,"deletions":19,"binary":false,"changes":40,"status":"modified"}]}