{"files":[{"patch":"@@ -1202,8 +1202,13 @@\n-\n-  if (ae == StrIntrinsicNode::UU || ae == StrIntrinsicNode::UL) {\n-    \/\/ Divide src size by 2 if String is UTF16 encoded\n-    src_count = _gvn.transform(new RShiftINode(src_count, intcon(1)));\n-  }\n-  if (ae == StrIntrinsicNode::UU) {\n-    \/\/ Divide substring size by 2 if String is UTF16 encoded\n-    tgt_count = _gvn.transform(new RShiftINode(tgt_count, intcon(1)));\n+  bool do_intrinsic =\n+      (StubRoutines::string_indexof() != nullptr) &&\n+      ((ae == StrIntrinsicNode::LL) || (ae == StrIntrinsicNode::UU));\n+\n+  if (!do_intrinsic) {\n+    if (ae == StrIntrinsicNode::UU || ae == StrIntrinsicNode::UL) {\n+      \/\/ Divide src size by 2 if String is UTF16 encoded\n+      src_count = _gvn.transform(new RShiftINode(src_count, intcon(1)));\n+    }\n+    if (ae == StrIntrinsicNode::UU) {\n+      \/\/ Divide substring size by 2 if String is UTF16 encoded\n+      tgt_count = _gvn.transform(new RShiftINode(tgt_count, intcon(1)));\n+    }\n@@ -1212,5 +1217,5 @@\n-  if ((StubRoutines::string_indexof() != nullptr) && (ae == StrIntrinsicNode::LL)) {\n-    Node* call = make_runtime_call(RC_LEAF,\n-                                   OptoRuntime::string_IndexOf_Type(),\n-                                   StubRoutines::string_indexof(), \"stringIndexOf\", TypePtr::BOTTOM,\n-                                   src_start, src_count, tgt_start, tgt_count);\n+  if (do_intrinsic) {\n+    Node* call = make_runtime_call(RC_LEAF, OptoRuntime::string_IndexOf_Type(),\n+                                   StubRoutines::string_indexof(),\n+                                   \"stringIndexOf\", TypePtr::BOTTOM, src_start,\n+                                   src_count, tgt_start, tgt_count);\n@@ -1219,1 +1224,2 @@\n-    result = make_indexOf_node(src_start, src_count, tgt_start, tgt_count, result_rgn, result_phi, ae);\n+    result = make_indexOf_node(src_start, src_count, tgt_start, tgt_count,\n+                               result_rgn, result_phi, ae);\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":20,"deletions":14,"binary":false,"changes":34,"status":"modified"}]}