{"files":[{"patch":"@@ -474,0 +474,1 @@\n+      return nullptr;\n@@ -710,0 +711,5 @@\n+\n+    if (is_shutting_down()) {\n+      stall_for_vm_shutdown();\n+      return nullptr;\n+    }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -324,0 +324,1 @@\n+        return nullptr;\n","filename":"src\/hotspot\/share\/gc\/parallel\/parallelScavengeHeap.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -328,0 +328,1 @@\n+      return nullptr;\n","filename":"src\/hotspot\/share\/gc\/serial\/serialHeap.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -609,1 +609,1 @@\n-  return Atomic::load_acquire(&_is_shutting_down);\n+  return AtomicAccess::load_acquire(&_is_shutting_down);\n@@ -616,1 +616,9 @@\n-  \/\/ allocation requests here until the VM shutdown is complete.\n+  \/\/ allocation requests here allow the VM shutdown is complete.\n+  \/\/\n+  \/\/ We use a timed wait (2 seconds) instead of an indefinite wait to avoid blocking\n+  \/\/ VM shutdown if it happens to trigger a GC.\n+  \/\/ The 2-second timeout is:\n+  \/\/   - long enough to keep daemon threads stalled, while the shutdown\n+  \/\/     sequence completes in the common case.\n+  \/\/   - short enough to avoid excessive stall time if the shutdown itself\n+  \/\/     triggers a GC.\n@@ -618,3 +626,1 @@\n-  while (true) {\n-    ml.wait();\n-  }\n+  ml.wait(2 * 1000);\n@@ -671,1 +677,1 @@\n-    Atomic::release_store(&_is_shutting_down, true);\n+    AtomicAccess::release_store(&_is_shutting_down, true);\n","filename":"src\/hotspot\/share\/gc\/shared\/collectedHeap.cpp","additions":12,"deletions":6,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -479,3 +479,0 @@\n-  \/\/ Run before exit and then stop concurrent GC threads\n-  Universe::before_exit();\n-\n@@ -514,0 +511,2 @@\n+  \/\/ Run before exit and then stop concurrent GC threads\n+  Universe::before_exit();\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"}]}