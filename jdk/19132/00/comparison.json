{"files":[{"patch":"@@ -684,22 +684,19 @@\n-    $(eval MAN_$m := $(call FindModuleManDirs, $m)) \\\n-    $(foreach d, $(MAN_$m), \\\n-      $(foreach f, $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, $d))), \\\n-        $(eval $m_$f_NAME := MAN_TO_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \\\n-        $(eval $(call SetupProcessMarkdown, $($m_$f_NAME), \\\n-            SRC := $d, \\\n-            FILES := $f, \\\n-            DEST := $(DOCS_OUTPUTDIR)\/specs\/man, \\\n-            FILTER := $(PANDOC_HTML_MANPAGE_FILTER), \\\n-            CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \\\n-            REPLACEMENTS := \\\n-\t\t@@COPYRIGHT_YEAR@@ => $(COPYRIGHT_YEAR) ; \\\n-\t\t@@VERSION_SHORT@@ => $(VERSION_SHORT) ; \\\n-\t\t@@VERSION_SPECIFICATION@@ => $(VERSION_SPECIFICATION), \\\n-            OPTIONS := --toc -V include-before='$(SPECS_TOP)' -V include-after='$(SPECS_BOTTOM_1)', \\\n-            POST_PROCESS := $(TOOL_FIXUPPANDOC) --insert-nav --nav-right-info '$(HEADER_RIGHT_SIDE_INFO)' \\\n-                --nav-subdirs 1 --nav-link-guides, \\\n-            EXTRA_DEPS := $(PANDOC_HTML_MANPAGE_FILTER) \\\n-                $(PANDOC_HTML_MANPAGE_FILTER_SOURCE), \\\n-        )) \\\n-        $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \\\n-      ) \\\n+    $(eval MAN_$m := $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, \\\n+          $(call FindModuleManDirs, $m))))) \\\n+    $(if $(MAN_$m), \\\n+      $(eval $(call SetupProcessMarkdown, MAN_TO_HTML_$m, \\\n+        FILES := $(MAN_$m), \\\n+        DEST := $(DOCS_OUTPUTDIR)\/specs\/man, \\\n+        FILTER := $(PANDOC_HTML_MANPAGE_FILTER), \\\n+        CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \\\n+        REPLACEMENTS := \\\n+            @@COPYRIGHT_YEAR@@ => $(COPYRIGHT_YEAR) ; \\\n+            @@VERSION_SHORT@@ => $(VERSION_SHORT) ; \\\n+            @@VERSION_SPECIFICATION@@ => $(VERSION_SPECIFICATION), \\\n+        OPTIONS := --toc -V include-before='$(SPECS_TOP)' -V include-after='$(SPECS_BOTTOM_1)', \\\n+        POST_PROCESS := $(TOOL_FIXUPPANDOC) --insert-nav --nav-right-info '$(HEADER_RIGHT_SIDE_INFO)' \\\n+            --nav-subdirs 1 --nav-link-guides, \\\n+        EXTRA_DEPS := $(PANDOC_HTML_MANPAGE_FILTER) \\\n+            $(PANDOC_HTML_MANPAGE_FILTER_SOURCE), \\\n+      )) \\\n+      $(eval JDK_SPECS_TARGETS += $(MAN_TO_HTML_$m)) \\\n","filename":"make\/Docs.gmk","additions":19,"deletions":22,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -41,2 +41,6 @@\n-  ifneq ($$($1_REPLACEMENTS), )\n-    $1_$2_PANDOC_INPUT := $$(SUPPORT_OUTPUTDIR)\/markdown\/$$($1_$2_MARKER)_pre.tmp\n+  # Only continue if this target file hasn't been processed already. This lets\n+  # the first found source file override any other with the same name.\n+  $$(call PrintVar, $1_$2_INPUT_FILE)\n+  $$(call PrintVar, $1_$2_OUTPUT_FILE_PROCESSED)\n+  ifeq ($$($1_$2_OUTPUT_FILE_PROCESSED), )\n+    $1_$2_OUTPUT_FILE_PROCESSED := true\n@@ -44,8 +48,2 @@\n-    $$(eval $$(call SetupTextFileProcessing, $1_$2_PREPROCESSED, \\\n-        SOURCE_FILES := $$($1_$2_INPUT_FILE), \\\n-        OUTPUT_FILE := $$($1_$2_PANDOC_INPUT), \\\n-        REPLACEMENTS := $$($1_REPLACEMENTS), \\\n-    ))\n-  else\n-    $1_$2_PANDOC_INPUT := $$($1_$2_INPUT_FILE)\n-  endif\n+    ifneq ($$($1_REPLACEMENTS), )\n+      $1_$2_PANDOC_INPUT := $$(SUPPORT_OUTPUTDIR)\/markdown\/$$($1_$2_MARKER)_pre.tmp\n@@ -53,5 +51,8 @@\n-  ifneq ($$($1_POST_PROCESS), )\n-    $1_$2_PANDOC_OUTPUT := $$(SUPPORT_OUTPUTDIR)\/markdown\/$$($1_$2_MARKER)_post.tmp\n-  else\n-    $1_$2_PANDOC_OUTPUT := $$($1_$2_OUTPUT_FILE)\n-  endif\n+      $$(eval $$(call SetupTextFileProcessing, $1_$2_PREPROCESSED, \\\n+          SOURCE_FILES := $$($1_$2_INPUT_FILE), \\\n+          OUTPUT_FILE := $$($1_$2_PANDOC_INPUT), \\\n+          REPLACEMENTS := $$($1_REPLACEMENTS), \\\n+      ))\n+    else\n+      $1_$2_PANDOC_INPUT := $$($1_$2_INPUT_FILE)\n+    endif\n@@ -59,3 +60,2 @@\n-  ifneq ($$($1_CSS), )\n-    ifneq ($$(findstring https:\/, $$($1_CSS)), )\n-      $1_$2_CSS_OPTION := --css '$$($1_CSS)'\n+    ifneq ($$($1_POST_PROCESS), )\n+      $1_$2_PANDOC_OUTPUT := $$(SUPPORT_OUTPUTDIR)\/markdown\/$$($1_$2_MARKER)_post.tmp\n@@ -63,2 +63,10 @@\n-      $1_$2_CSS := $$(strip $$(call RelativePath, $$($1_CSS), $$($1_$2_TARGET_DIR)))\n-      $1_$2_CSS_OPTION := --css '$$($1_$2_CSS)'\n+      $1_$2_PANDOC_OUTPUT := $$($1_$2_OUTPUT_FILE)\n+    endif\n+\n+    ifneq ($$($1_CSS), )\n+      ifneq ($$(findstring https:\/, $$($1_CSS)), )\n+        $1_$2_CSS_OPTION := --css '$$($1_CSS)'\n+      else\n+        $1_$2_CSS := $$(strip $$(call RelativePath, $$($1_CSS), $$($1_$2_TARGET_DIR)))\n+        $1_$2_CSS_OPTION := --css '$$($1_$2_CSS)'\n+      endif\n@@ -66,1 +74,0 @@\n-  endif\n@@ -68,4 +75,4 @@\n-  # This does not need to be included in VARDEPS since it's from the actual\n-  # source file. Only run the shell if the recipe gets executed below.\n-  $1_$2_OPTIONS_FROM_SRC = \\\n-      $$(shell $$(GREP) _pandoc-options_: $3\/$2 | $$(CUT) -d : -f 2-)\n+    # This does not need to be included in VARDEPS since it's from the actual\n+    # source file. Only run the shell if the recipe gets executed below.\n+    $1_$2_OPTIONS_FROM_SRC = \\\n+        $$(shell $$(GREP) _pandoc-options_: $3\/$2 | $$(CUT) -d : -f 2-)\n@@ -73,3 +80,3 @@\n-  ifneq ($$($1_FILTER), )\n-    $1_$2_OPTIONS := --filter $$($1_FILTER)\n-  endif\n+    ifneq ($$($1_FILTER), )\n+      $1_$2_OPTIONS := --filter $$($1_FILTER)\n+    endif\n@@ -77,4 +84,4 @@\n-  $1_$2_VARDEPS := $$($1_OPTIONS) $$($1_$2_OPTIONS) $$($1_CSS) \\\n-      $$($1_REPLACEMENTS) $$($1_POST_PROCESS)\n-  $1_$2_VARDEPS_FILE := $$(call DependOnVariable, $1_$2_VARDEPS, \\\n-      $$(SUPPORT_OUTPUTDIR)\/markdown\/$$($1_$2_MARKER).vardeps)\n+    $1_$2_VARDEPS := $$($1_OPTIONS) $$($1_$2_OPTIONS) $$($1_CSS) \\\n+        $$($1_REPLACEMENTS) $$($1_POST_PROCESS)\n+    $1_$2_VARDEPS_FILE := $$(call DependOnVariable, $1_$2_VARDEPS, \\\n+        $$(SUPPORT_OUTPUTDIR)\/markdown\/$$($1_$2_MARKER).vardeps)\n@@ -82,1 +89,1 @@\n-  $$($1_$2_PANDOC_OUTPUT): $$($1_$2_PANDOC_INPUT) $$($1_$2_VARDEPS_FILE) $$($1_EXTRA_DEPS)\n+    $$($1_$2_PANDOC_OUTPUT): $$($1_$2_PANDOC_INPUT) $$($1_$2_VARDEPS_FILE) $$($1_EXTRA_DEPS)\n@@ -99,4 +106,4 @@\n-  # If we have no post processing, PANDOC_OUTPUT is set to OUTPUT_FILE. Otherwise\n-  # PANDOC_OUTPUT is a temporary file, and we must now create the real OUTPUT_FILE.\n-  ifneq ($$($1_POST_PROCESS), )\n-    $$($1_$2_OUTPUT_FILE): $$($1_$2_PANDOC_OUTPUT)\n+    # If we have no post processing, PANDOC_OUTPUT is set to OUTPUT_FILE. Otherwise\n+    # PANDOC_OUTPUT is a temporary file, and we must now create the real OUTPUT_FILE.\n+    ifneq ($$($1_POST_PROCESS), )\n+      $$($1_$2_OUTPUT_FILE): $$($1_$2_PANDOC_OUTPUT)\n@@ -107,1 +114,1 @@\n-  endif\n+    endif\n@@ -109,1 +116,2 @@\n-  $1 += $$($1_$2_OUTPUT_FILE)\n+    $1 += $$($1_$2_OUTPUT_FILE)\n+  endif\n","filename":"make\/common\/ProcessMarkdown.gmk","additions":47,"deletions":39,"binary":false,"changes":86,"status":"modified"}]}