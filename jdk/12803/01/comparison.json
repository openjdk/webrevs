{"files":[{"patch":"@@ -83,1 +83,1 @@\n-        <Component class=\"javax.swing.JTextArea\" name=\"sourceTextArea\">\n+        <Component class=\"javax.swing.JTextPane\" name=\"sourceTextArea\">\n@@ -85,2 +85,0 @@\n-            <Property name=\"columns\" type=\"int\" value=\"20\"\/>\n-            <Property name=\"rows\" type=\"int\" value=\"5\"\/>\n","filename":"src\/utils\/IdealGraphVisualizer\/Filter\/src\/main\/java\/com\/sun\/hotspot\/igv\/filter\/EditFilterDialog.form","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,8 @@\n+import java.awt.BorderLayout;\n+import java.awt.Color;\n+import java.awt.Font;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.swing.JPanel;\n+import javax.swing.SwingUtilities;\n+import javax.swing.text.*;\n@@ -35,1 +43,1 @@\n-    private CustomFilter customFilter;\n+    private final CustomFilter customFilter;\n@@ -44,0 +52,72 @@\n+        sourceTextArea.setFont(new Font(\"Monospaced\", Font.PLAIN, 12));\n+        AbstractDocument doc = (AbstractDocument) sourceTextArea.getDocument();\n+        doc.setDocumentFilter(new DocumentFilter(){\n+            private final StyledDocument styledDocument = sourceTextArea.getStyledDocument();\n+            private final StyleContext styleContext = StyleContext.getDefaultStyleContext();\n+            private final AttributeSet blueAttributeSet = styleContext.addAttribute(styleContext.getEmptySet(), StyleConstants.Foreground, new Color(8,8,255));\n+            private final AttributeSet greenAttributeSet = styleContext.addAttribute(styleContext.getEmptySet(), StyleConstants.Foreground, new Color(80,160,80));\n+            private final AttributeSet greyAttributeSet = styleContext.addAttribute(styleContext.getEmptySet(), StyleConstants.Foreground, Color.GRAY);\n+            private final AttributeSet blackAttributeSet = styleContext.addAttribute(styleContext.getEmptySet(), StyleConstants.Foreground, Color.BLACK);\n+            private final Pattern comments_pattern = Pattern.compile(\"(?:\/\/.*)|(\/\\\\*(?:.|[\\\\n\\\\r])*?\\\\*\/)\");\n+            private final Pattern quote_pattern = Pattern.compile(\"([\\\"'])((?:\\\\\\\\\\\\1|(?:(?!\\\\1)).)*)(\\\\1)\");\n+            private final Pattern keywords_pattern = buildKeywordsPattern();\n+            private final String tabSpaces = \"  \";\n+\n+\n+            private Pattern buildKeywordsPattern() {\n+                StringBuilder pattern = new StringBuilder();\n+                String[] keywords = new String[]{\"await\",\"break\",\"case\",\"catch\",\"class\",\"const\",\"continue\",\"debugger\",\n+                        \"default\",\"delete\",\"do\",\"else\",\"enum\",\"export\",\"extends\",\"false\",\"finally\",\"for\",\"function\",\n+                        \"if\",\"implements\",\"import\",\"in\",\"instanceof\",\"interface\",\"let\",\"new\",\"null\",\"package\",\"private\",\n+                        \"protected\",\"public\",\"return\",\"super\",\"switch\",\"static\",\"this\",\"throw\",\"try\",\"true\",\"typeof\",\n+                        \"var\",\"void\",\"while\",\"with\",\"yield\"\n+                };\n+                for (String keyword : keywords) {\n+                    pattern.append(\"\\\\b\").append(keyword).append(\"\\\\b|\");\n+                }\n+                if (pattern.length()>0) {\n+                    pattern.deleteCharAt(pattern.length()-1);\n+                }\n+                return Pattern.compile(pattern.toString());\n+            }\n+\n+            @Override\n+            public void insertString(FilterBypass fb, int offset, String text, AttributeSet attrs) throws BadLocationException {\n+                text = text.replace(\"\\t\", tabSpaces);\n+                super.insertString(fb, offset, text, attrs);\n+                SwingUtilities.invokeLater(this::updateSyntaxHighlighting);\n+            }\n+\n+            @Override\n+            public void remove(FilterBypass fb, int offset, int length) throws BadLocationException {\n+                super.remove(fb, offset, length);\n+                SwingUtilities.invokeLater(this::updateSyntaxHighlighting);\n+            }\n+\n+            @Override\n+            public void replace(FilterBypass fb, int offset, int length, String text, AttributeSet attrs) throws BadLocationException {\n+                text = text.replace(\"\\t\", tabSpaces);\n+                super.replace(fb, offset, length, text, attrs);\n+                SwingUtilities.invokeLater(this::updateSyntaxHighlighting);\n+            }\n+\n+            private void updateSyntaxHighlighting() {\n+                styledDocument.setCharacterAttributes(0, sourceTextArea.getText().length(), blackAttributeSet, true);\n+\n+                Matcher keyword_matcher = keywords_pattern.matcher(sourceTextArea.getText());\n+                while (keyword_matcher.find()) {\n+                    styledDocument.setCharacterAttributes(keyword_matcher.start(), keyword_matcher.end() - keyword_matcher.start(), blueAttributeSet, false);\n+                }\n+\n+                Matcher quote_matcher = quote_pattern.matcher(sourceTextArea.getText());\n+                while (quote_matcher.find()) {\n+                    styledDocument.setCharacterAttributes(quote_matcher.start(), quote_matcher.end() - quote_matcher.start(), greenAttributeSet, false);\n+                }\n+\n+                Matcher comments_matcher = comments_pattern.matcher(sourceTextArea.getText());\n+                while (comments_matcher.find()) {\n+                    styledDocument.setCharacterAttributes(comments_matcher.start(), comments_matcher.end() - comments_matcher.start(), greyAttributeSet, false);\n+                }\n+            }\n+        });\n+\n@@ -59,1 +139,0 @@\n-\n@@ -61,1 +140,1 @@\n-        sourceTextArea = new javax.swing.JTextArea();\n+        sourceTextArea = new javax.swing.JTextPane();\n@@ -70,1 +149,1 @@\n-        setResizable(false);\n+        setResizable(true);\n@@ -72,3 +151,3 @@\n-        sourceTextArea.setColumns(20);\n-        sourceTextArea.setRows(5);\n-        jScrollPane1.setViewportView(sourceTextArea);\n+        JPanel panel = new JPanel(new BorderLayout());\n+        panel.add(sourceTextArea);\n+        jScrollPane1.setViewportView(panel);\n@@ -83,5 +162,3 @@\n-        okButton.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cancelButtonClicked(evt);\n-                okButtonClicked(evt);\n-            }\n+        okButton.addActionListener(evt -> {\n+            cancelButtonClicked(evt);\n+            okButtonClicked(evt);\n@@ -91,5 +168,1 @@\n-        cancelButton.addActionListener(new java.awt.event.ActionListener() {\n-            public void actionPerformed(java.awt.event.ActionEvent evt) {\n-                cancelButtonClicked(evt);\n-            }\n-        });\n+        cancelButton.addActionListener(this::cancelButtonClicked);\n@@ -110,1 +183,1 @@\n-                            .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 695, Short.MAX_VALUE)\n+                            .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 695, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE)\n@@ -128,2 +201,2 @@\n-                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 337, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))\n-                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 16, Short.MAX_VALUE)\n+                    .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 337, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE))\n+                    .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)\n@@ -158,1 +231,1 @@\n-    private javax.swing.JTextArea sourceTextArea;\n+    private javax.swing.JTextPane sourceTextArea;\n","filename":"src\/utils\/IdealGraphVisualizer\/Filter\/src\/main\/java\/com\/sun\/hotspot\/igv\/filter\/EditFilterDialog.java","additions":95,"deletions":22,"binary":false,"changes":117,"status":"modified"}]}