{"files":[{"patch":"@@ -51,0 +51,1 @@\n+import jdk.internal.module.Modules;\n@@ -302,0 +303,62 @@\n+        \/**\n+         * Updates module {@code source} in the layer to use a service.\n+         *\n+         * @param  source\n+         *         The source module\n+         * @param  service\n+         *         The service class\n+         *\n+         * @return This controller\n+         *\n+         * @throws IllegalArgumentException\n+         *         If {@code source} is not in the module layer\n+         *\n+         * @see Module#addUses\n+         *\n+         * @since 25\n+         *\/\n+        public Controller addUses(Module source, Class<?> service) {\n+            ensureInLayer(source);\n+            source.implAddUses(service);\n+            return this;\n+        }\n+\n+        \/**\n+         * Updates the layer to locate a service of the given type using\n+         * the given implementation class.\n+         *\n+         * @param  service\n+         *         The service class\n+         * @param  impl\n+         *         The implementation class\n+         *\n+         * @return This controller\n+         *\n+         * @throws IllegalArgumentException\n+         *         If {@code impl} is not an appropriate service provider for\n+         *         {@code service}\n+         *\n+         * @since 25\n+         *\/\n+        public Controller addProvider(Class<?> service, Class<?> impl) {\n+            Module implModule = impl.getModule();\n+            Class<?> providerType;\n+            if (implModule.isNamed()\n+                && (providerType = getProviderMethodType(impl)) != null\n+                && ! service.isAssignableFrom(providerType)\n+                || ! service.isAssignableFrom(impl)) {\n+                throw new IllegalArgumentException(\"Implementation \" + impl + \" does not implment or provide \" + service);\n+            } else {\n+                Modules.addProvider(layer, service, impl);\n+            }\n+            return this;\n+        }\n+\n+        private static Class<?> getProviderMethodType(Class<?> implClass) {\n+            try {\n+                return implClass.getMethod(\"provider\").getReturnType();\n+            } catch (NoSuchMethodException e) {\n+                return null;\n+            }\n+        }\n+\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ModuleLayer.java","additions":63,"deletions":0,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -175,0 +175,11 @@\n+    \/**\n+     * Add a provider to a module layer.\n+     *\n+     * @param layer the layer ot add the provider to (must not be {@code null})\n+     * @param service the service class (must not be {@code null})\n+     * @param impl the service implementation class (must not be {@code null})\n+     *\/\n+    public static void addProvider(ModuleLayer layer, Class<?> service, Class<?> impl) {\n+        JLA.getServicesCatalog(layer).addProvider(impl.getModule(), service, impl);\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/Modules.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"}]}