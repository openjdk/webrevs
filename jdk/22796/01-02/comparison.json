{"files":[{"patch":"@@ -327,1 +327,1 @@\n-         * Updates the module layer to locate a service of the given type using\n+         * Updates the layer to locate a service of the given type using\n@@ -337,0 +337,4 @@\n+         * @throws IllegalArgumentException\n+         *         If {@code impl} is not an appropriate service provider for\n+         *         {@code service}\n+         *\n@@ -340,1 +344,0 @@\n-            \/\/ the implementation module for the service may be named or unnamed\n@@ -342,1 +345,9 @@\n-            Modules.addProvider(layer, service, impl);\n+            Class<?> providerType;\n+            if (implModule.isNamed()\n+                && (providerType = getProviderMethodType(impl)) != null\n+                && ! service.isAssignableFrom(providerType)\n+                || ! service.isAssignableFrom(impl)) {\n+                throw new IllegalArgumentException(\"Implementation \" + impl + \" does not implment or provide \" + service);\n+            } else {\n+                Modules.addProvider(layer, service, impl);\n+            }\n@@ -346,0 +357,8 @@\n+        private static Class<?> getProviderMethodType(Class<?> implClass) {\n+            try {\n+                return implClass.getMethod(\"provider\").getReturnType();\n+            } catch (NoSuchMethodException e) {\n+                return null;\n+            }\n+        }\n+\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ModuleLayer.java","additions":22,"deletions":3,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -183,1 +183,0 @@\n-        \/\/ throws NPE if the layer is null\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/Modules.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}