{"files":[{"patch":"@@ -566,1 +566,1 @@\n-    TOOLCHAIN_CFLAGS_JDK=\"-nologo -MD -Zc:preprocessor -Zc:strictStrings -Zc:inline -utf-8 -Zc:wchar_t-\"\n+    TOOLCHAIN_CFLAGS_JDK=\"-nologo -MD -Zc:preprocessor -Zc:strictStrings -Zc:inline -permissive- -utf-8 -Zc:wchar_t-\"\n","filename":"make\/autoconf\/flags-cflags.m4","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-void D3DGlyphCache_FlushGlyphVertexCache();\n+static void D3DGlyphCache_FlushGlyphVertexCache();\n","filename":"src\/java.desktop\/windows\/native\/libawt\/java2d\/d3d\/D3DGlyphCache.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -205,3 +205,2 @@\n-void AwtCanvas::_SetEraseBackground(void *param)\n-{\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+void AwtCanvas::_SetEraseBackground(void *param) {\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -209,1 +208,1 @@\n-    SetEraseBackgroundStruct *sebs = (SetEraseBackgroundStruct *)param;\n+    SetEraseBackgroundStruct *sebs = static_cast<SetEraseBackgroundStruct *>(param);\n@@ -215,1 +214,14 @@\n-    JNI_CHECK_PEER_GOTO(canvas, ret);\n+    if (canvas == NULL) {\n+        env->ExceptionClear();\n+        JNU_ThrowNullPointerException(env, \"canvas\");\n+        delete sebs;\n+        return;\n+    } else {\n+        pData = JNI_GET_PDATA(canvas);\n+        if (pData == NULL) {\n+            THROW_NULL_PDATA_IF_NOT_DESTROYED(canvas);\n+            env->DeleteGlobalRef(canvas);\n+            delete sebs;\n+            return;\n+        }\n+    }\n@@ -217,1 +229,1 @@\n-    AwtCanvas *c = (AwtCanvas*)pData;\n+    AwtCanvas *c = (AwtCanvas*) pData;\n@@ -221,1 +233,0 @@\n-ret:\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Canvas.cpp","additions":18,"deletions":7,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -6359,2 +6359,1 @@\n-void AwtComponent::_SetParent(void * param)\n-{\n+void AwtComponent::_SetParent(void * param) {\n@@ -6362,2 +6361,2 @@\n-        JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n-        SetParentStruct *data = (SetParentStruct*) param;\n+        JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+        SetParentStruct *data = static_cast<SetParentStruct*>(param);\n@@ -6367,2 +6366,2 @@\n-        AwtComponent *awtComponent = NULL;\n-        AwtComponent *awtParent = NULL;\n+        AwtComponent *awtComponent = nullptr;\n+        AwtComponent *awtParent = nullptr;\n@@ -6371,4 +6370,34 @@\n-        JNI_CHECK_PEER_GOTO(self, ret);\n-        awtComponent = (AwtComponent *)pData;\n-        JNI_CHECK_PEER_GOTO(parent, ret);\n-        awtParent = (AwtComponent *)pData;\n+        if (self == NULL) {\n+            env->ExceptionClear();\n+            JNU_ThrowNullPointerException(env, \"peer\");\n+            env->DeleteGlobalRef(self);\n+            env->DeleteGlobalRef(parent);\n+            delete data;\n+            return;\n+        }\n+        pData = JNI_GET_PDATA(self);\n+        if (pData == NULL) {\n+            THROW_NULL_PDATA_IF_NOT_DESTROYED(self);\n+            env->DeleteGlobalRef(self);\n+            env->DeleteGlobalRef(parent);\n+            delete data;\n+            return;\n+        }\n+        awtComponent = (AwtComponent *) pData;\n+        if (parent == NULL) {\n+            env->ExceptionClear();\n+            JNU_ThrowNullPointerException(env, \"peer\");\n+            env->DeleteGlobalRef(self);\n+            env->DeleteGlobalRef(parent);\n+            delete data;\n+            return;\n+        }\n+        pData = JNI_GET_PDATA(parent);\n+        if (pData == NULL) {\n+            THROW_NULL_PDATA_IF_NOT_DESTROYED(parent);\n+            env->DeleteGlobalRef(self);\n+            env->DeleteGlobalRef(parent);\n+            delete data;\n+            return;\n+        }\n+        awtParent = (AwtComponent *) pData;\n@@ -6383,1 +6412,0 @@\n-ret:\n@@ -6538,2 +6566,1 @@\n-static void _GetInsets(void* param)\n-{\n+static void _GetInsets(void* param) {\n@@ -6542,2 +6569,2 @@\n-    GetInsetsStruct *gis = (GetInsetsStruct *)param;\n-    jobject self = gis->window;\n+    std::unique_ptr<GetInsetsStruct> gis(static_cast<GetInsetsStruct *>(param));\n+    std::unique_ptr<std::remove_pointer<jobject>::type, std::function<void (jobject)>> self(gis->window, [&env] (jobject self) -> void { env->DeleteGlobalRef(self); });\n@@ -6549,2 +6576,2 @@\n-    JNI_CHECK_PEER_GOTO(self, ret);\n-    AwtComponent *component = (AwtComponent *)pData;\n+    JNI_CHECK_PEER_RETURN(self.get());\n+    AwtComponent *component = (AwtComponent *) pData;\n@@ -6553,4 +6580,0 @@\n-\n-  ret:\n-    env->DeleteGlobalRef(self);\n-    delete gis;\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Component.cpp","additions":44,"deletions":21,"binary":false,"changes":65,"status":"modified"},{"patch":"@@ -42,1 +42,0 @@\n-#include <awt.h>\n@@ -45,0 +44,4 @@\n+\/\/ Don't want to pull in the redefined allocation functions\n+#include \"awt_ole.h\"\n+#include \"awt_DCHolder.h\"\n+\n@@ -46,0 +49,1 @@\n+#include \"awt.h\"\n@@ -57,3 +61,0 @@\n-#include \"awt_ole.h\"\n-#include \"awt_DCHolder.h\"\n-\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_DnDDS.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -30,0 +30,2 @@\n+\/\/ Don't want to pull in the redefined allocation functions\n+#include \"awt_ole.h\"\n@@ -34,1 +36,0 @@\n-#include \"awt_ole.h\"\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_DnDDT.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1352,3 +1352,3 @@\n-    HWND hwnd = f->GetHWnd();\n-    if (::IsWindow(hwnd))\n-    {\n+    HWND hwnd;\n+    hwnd = f->GetHWnd();\n+    if (::IsWindow(hwnd)) {\n@@ -1581,1 +1581,2 @@\n-    AwtFrame *f = (AwtFrame *)pData;\n+    AwtFrame *f;\n+    f = (AwtFrame *) pData;\n@@ -1586,1 +1587,2 @@\n-    AwtDialog *d = (AwtDialog *)pData;\n+    AwtDialog *dialog;\n+    dialog = (AwtDialog *) pData;\n@@ -1588,2 +1590,1 @@\n-    if ((f != NULL) && ::IsWindow(f->GetHWnd()))\n-    {\n+    if ((f != NULL) && ::IsWindow(f->GetHWnd())) {\n@@ -1606,1 +1607,1 @@\n-                BlockedThreadStruct *blockedThread = (BlockedThreadStruct *)sm_BlockedThreads.get((void *)((intptr_t)fThread));\n+                BlockedThreadStruct *blockedThread = (BlockedThreadStruct *) sm_BlockedThreads.get((void *)((intptr_t)fThread));\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Frame.cpp","additions":9,"deletions":8,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -38,4 +38,4 @@\n-    static jfieldID AwtPrintDialog::controlID;\n-    static jfieldID AwtPrintDialog::parentID;\n-    static jfieldID AwtPrintDialog::pageID;\n-    static jmethodID AwtPrintDialog::setHWndMID;\n+    static jfieldID controlID;\n+    static jfieldID parentID;\n+    static jfieldID pageID;\n+    static jmethodID setHWndMID;\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_PrintDialog.h","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -60,0 +60,2 @@\n+jfieldID AwtPrintDialog::pageID;\n+\n@@ -212,1 +214,0 @@\n-jfieldID AwtPrintDialog::pageID;\n@@ -543,2 +544,1 @@\n-    else if (awtParent != NULL)\n-    {\n+    else if (awtParent != NULL) {\n@@ -546,3 +546,1 @@\n-    }\n-    else\n-    {\n+    } else {\n@@ -575,1 +573,1 @@\n-        (void)::PageSetupDlg(&setup);\n+        static_cast<void>(::PageSetupDlg(&setup));\n@@ -617,2 +615,3 @@\n-    BOOL ret = ::PageSetupDlg(&setup);\n-    if (ret) {\n+    BOOL result;\n+    result = ::PageSetupDlg(&setup);\n+    if (result) {\n@@ -701,1 +700,2 @@\n-    HGLOBAL oldG = AwtPrintControl::getPrintHDMode(env, self);\n+    HGLOBAL oldG;\n+    oldG = AwtPrintControl::getPrintHDMode(env, self);\n@@ -922,2 +922,0 @@\n-    JNI_CHECK_NULL_GOTO(printDC, \"Invalid printDC\", done);\n-\n@@ -932,0 +930,2 @@\n+    JNI_CHECK_NULL_GOTO(printDC, \"Invalid printDC\", done);\n+\n@@ -934,1 +934,2 @@\n-    WORD dmPaperSize = getPrintPaperSize(env, &err, self);\n+    WORD dmPaperSize;\n+    dmPaperSize = getPrintPaperSize(env, &err, self);\n@@ -942,1 +943,2 @@\n-    jclass paperClass = env->GetObjectClass(origPaper);\n+    jclass paperClass;\n+    paperClass = env->GetObjectClass(origPaper);\n@@ -969,2 +971,2 @@\n-    jint xPixelRes = GetDeviceCaps(printDC, LOGPIXELSX);\n-    jint yPixelRes = GetDeviceCaps(printDC, LOGPIXELSY);\n+    jint xPixelRes;\n+    jint yPixelRes;\n@@ -973,2 +975,2 @@\n-    jint xPixelOrg = GetDeviceCaps(printDC, PHYSICALOFFSETX);\n-    jint yPixelOrg = GetDeviceCaps(printDC, PHYSICALOFFSETY);\n+    jint xPixelOrg;\n+    jint yPixelOrg;\n@@ -977,2 +979,11 @@\n-    jint imgPixelWid = GetDeviceCaps(printDC, HORZRES);\n-    jint imgPixelHgt = GetDeviceCaps(printDC, VERTRES);\n+    jint imgPixelWid;\n+    jint imgPixelHgt;\n+\n+    xPixelRes = GetDeviceCaps(printDC, LOGPIXELSX);\n+    yPixelRes = GetDeviceCaps(printDC, LOGPIXELSY);\n+\n+    xPixelOrg = GetDeviceCaps(printDC, PHYSICALOFFSETX);\n+    yPixelOrg = GetDeviceCaps(printDC, PHYSICALOFFSETY);\n+\n+    imgPixelWid = GetDeviceCaps(printDC, HORZRES);\n+    imgPixelHgt = GetDeviceCaps(printDC, VERTRES);\n@@ -1008,4 +1019,9 @@\n-    jdouble imgX = (jdouble)((xPixelOrg * 72)\/(jdouble)xPixelRes);\n-    jdouble imgY = (jdouble)((yPixelOrg * 72)\/(jdouble)yPixelRes);\n-    jdouble imgWid = (jdouble)((imgPixelWid * 72)\/(jdouble)xPixelRes);\n-    jdouble imgHgt = (jdouble)((imgPixelHgt * 72)\/(jdouble)yPixelRes);\n+    jdouble imgX;\n+    jdouble imgY;\n+    jdouble imgWid;\n+    jdouble imgHgt;\n+\n+    imgX = (jdouble)((xPixelOrg * 72)\/(jdouble)xPixelRes);\n+    imgY = (jdouble)((yPixelOrg * 72)\/(jdouble)yPixelRes);\n+    imgWid = (jdouble)((imgPixelWid * 72)\/(jdouble)xPixelRes);\n+    imgHgt = (jdouble)((imgPixelHgt * 72)\/(jdouble)yPixelRes);\n@@ -1051,2 +1067,3 @@\n-    jmethodID setSizeID = env->GetMethodID(paperClass,\n-                                        SETSIZE_STR, SETSIZE_SIG);\n+    jmethodID setSizeID;\n+    setSizeID = env->GetMethodID(paperClass,\n+                              SETSIZE_STR, SETSIZE_SIG);\n@@ -1055,2 +1072,3 @@\n-    jmethodID setImageableID = env->GetMethodID(paperClass,\n-                                        SETIMAGEABLE_STR, SETIMAGEABLE_SIG);\n+    jmethodID setImageableID;\n+    setImageableID = env->GetMethodID(paperClass,\n+                              SETIMAGEABLE_STR, SETIMAGEABLE_SIG);\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_PrintJob.cpp","additions":46,"deletions":28,"binary":false,"changes":74,"status":"modified"},{"patch":"@@ -56,0 +56,4 @@\n+jmethodID AwtTextComponent::canAccessClipboardMID;\n+AwtTextComponent::OleCallback AwtTextComponent::sm_oleCallback;\n+WNDPROC AwtTextComponent::sm_pDefWindowProc = NULL;\n+\n@@ -60,2 +64,0 @@\n-jmethodID AwtTextComponent::canAccessClipboardMID;\n-\n@@ -914,2 +916,0 @@\n-AwtTextComponent::OleCallback AwtTextComponent::sm_oleCallback;\n-\n@@ -1043,2 +1043,0 @@\n-WNDPROC AwtTextComponent::sm_pDefWindowProc = NULL;\n-\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_TextComponent.cpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1017,3 +1017,2 @@\n-void AwtWindow::_RepositionSecurityWarning(void* param)\n-{\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+void AwtWindow::_RepositionSecurityWarning(void* param) {\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -1022,1 +1021,1 @@\n-        (RepositionSecurityWarningStruct *)param;\n+        static_cast<RepositionSecurityWarningStruct *>(param);\n@@ -1026,2 +1025,15 @@\n-    JNI_CHECK_PEER_GOTO(self, ret);\n-    AwtWindow *window = (AwtWindow *)pData;\n+    if (self == NULL) {\n+        env->ExceptionClear();\n+        JNU_ThrowNullPointerException(env, \"self\");\n+        delete rsws;\n+        return;\n+    } else {\n+        pData = JNI_GET_PDATA(self);\n+        if (pData == NULL) {\n+            THROW_NULL_PDATA_IF_NOT_DESTROYED(self);\n+            env->DeleteGlobalRef(self);\n+            delete rsws;\n+            return;\n+        }\n+    }\n+    AwtWindow *window = (AwtWindow *) pData;\n@@ -1031,1 +1043,0 @@\n-  ret:\n@@ -3115,3 +3126,2 @@\n-void AwtWindow::_ModalDisable(void *param)\n-{\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+void AwtWindow::_ModalDisable(void *param) {\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -3119,1 +3129,1 @@\n-    ModalDisableStruct *mds = (ModalDisableStruct *)param;\n+    ModalDisableStruct *mds = static_cast<ModalDisableStruct *>(param);\n@@ -3126,4 +3136,3 @@\n-    JNI_CHECK_NULL_GOTO(self, \"peer\", ret);\n-    PDATA pData = JNI_GET_PDATA(self);\n-    if (pData == NULL) {\n-        env->DeleteGlobalRef(self);\n+    if (self == NULL) {\n+        env->ExceptionClear();\n+        JNU_ThrowNullPointerException(env, \"self\");\n@@ -3132,0 +3141,7 @@\n+    } else {\n+        PDATA pData = JNI_GET_PDATA(self);\n+        if (pData == NULL) {\n+            env->DeleteGlobalRef(self);\n+            delete mds;\n+            return;\n+        }\n@@ -3134,1 +3150,1 @@\n-    window = (AwtWindow *)pData;\n+    window = (AwtWindow *) pData;\n@@ -3140,1 +3156,0 @@\n-ret:\n@@ -3146,3 +3161,2 @@\n-void AwtWindow::_ModalEnable(void *param)\n-{\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+void AwtWindow::_ModalEnable(void *param) {\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -3150,1 +3164,1 @@\n-    jobject self = (jobject)param;\n+    jobject self = static_cast<jobject>(param);\n@@ -3155,4 +3169,3 @@\n-    JNI_CHECK_NULL_GOTO(self, \"peer\", ret);\n-    PDATA pData = JNI_GET_PDATA(self);\n-    if (pData == NULL) {\n-        env->DeleteGlobalRef(self);\n+    if (self == NULL) {\n+        env->ExceptionClear();\n+        JNU_ThrowNullPointerException(env, \"self\");\n@@ -3160,0 +3173,6 @@\n+    } else {\n+        PDATA pData = JNI_GET_PDATA(self);\n+        if (pData == NULL) {\n+            env->DeleteGlobalRef(self);\n+            return;\n+        }\n@@ -3168,1 +3187,0 @@\n-  ret:\n@@ -3174,1 +3192,1 @@\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -3176,1 +3194,1 @@\n-    OpacityStruct *os = (OpacityStruct *)param;\n+    OpacityStruct *os = static_cast<OpacityStruct *>(param);\n@@ -3178,1 +3196,1 @@\n-    BYTE iOpacity = (BYTE)os->iOpacity;\n+    BYTE iOpacity = (BYTE) os->iOpacity;\n@@ -3181,1 +3199,14 @@\n-    JNI_CHECK_PEER_GOTO(self, ret);\n+    if (self == NULL) {\n+        env->ExceptionClear();\n+        JNU_ThrowNullPointerException(env, \"self\");\n+        delete os;\n+        return;\n+    } else {\n+        pData = JNI_GET_PDATA(self);\n+        if (pData == NULL) {\n+            THROW_NULL_PDATA_IF_NOT_DESTROYED(self);\n+            env->DeleteGlobalRef(self);\n+            delete os;\n+            return;\n+        }\n+    }\n@@ -3186,1 +3217,0 @@\n-  ret:\n@@ -3199,3 +3229,4 @@\n-    PDATA pData;\n-    JNI_CHECK_PEER_GOTO(self, ret);\n-    AwtWindow *window = (AwtWindow *)pData;\n+    {\n+        PDATA pData;\n+        JNI_CHECK_PEER_GOTO(self, ret);\n+        AwtWindow *window = (AwtWindow *)pData;\n@@ -3203,1 +3234,2 @@\n-    window->SetTranslucency(window->getOpacity(), isOpaque);\n+        window->SetTranslucency(window->getOpacity(), isOpaque);\n+    }\n@@ -3218,3 +3250,4 @@\n-    PDATA pData;\n-    JNI_CHECK_PEER_GOTO(self, ret);\n-    AwtWindow *window = (AwtWindow *)pData;\n+    {\n+        PDATA pData;\n+        JNI_CHECK_PEER_GOTO(self, ret);\n+        AwtWindow *window = (AwtWindow *)pData;\n@@ -3222,2 +3255,3 @@\n-    window->UpdateWindow(env, data, (int)uws->width, (int)uws->height,\n-                         uws->hBitmap);\n+        window->UpdateWindow(env, data, (int)uws->width, (int)uws->height,\n+                             uws->hBitmap);\n+    }\n@@ -3242,3 +3276,4 @@\n-    PDATA pData;\n-    JNI_CHECK_PEER_GOTO(self, ret);\n-    AwtWindow *window = (AwtWindow *)pData;\n+    {\n+        PDATA pData;\n+        JNI_CHECK_PEER_GOTO(self, ret);\n+        AwtWindow *window = (AwtWindow *)pData;\n@@ -3246,1 +3281,2 @@\n-    window->setFullScreenExclusiveModeState(state != 0);\n+        window->setFullScreenExclusiveModeState(state != 0);\n+    }\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Window.cpp","additions":80,"deletions":44,"binary":false,"changes":124,"status":"modified"},{"patch":"@@ -1028,1 +1028,1 @@\n-        EXCEPTION_CHECK(\"Getting ParentWithRole - call to CallObjectMethod()\", (AccessibleContext)0);\n+        EXCEPTION_CHECK(\"Getting ParentWithRole - call to CallObjectMethod()\", reinterpret_cast<jobject>((AccessibleContext) 0));\n@@ -1098,1 +1098,1 @@\n-        EXCEPTION_CHECK(\"Getting ParentWithRoleElseRoot - call to CallObjectMethod()\", (AccessibleContext)0);\n+        EXCEPTION_CHECK(\"Getting ParentWithRoleElseRoot - call to CallObjectMethod()\", reinterpret_cast<jobject>((AccessibleContext) 0));\n@@ -1155,1 +1155,1 @@\n-        EXCEPTION_CHECK(\"Getting ActiveDescendent - call to CallObjectMethod()\", (AccessibleContext)0);\n+        EXCEPTION_CHECK(\"Getting ActiveDescendent - call to CallObjectMethod()\", reinterpret_cast<jobject>((AccessibleContext) 0));\n@@ -1164,1 +1164,1 @@\n-        return (AccessibleContext)0;\n+        return reinterpret_cast<jobject>((AccessibleContext) 0);\n","filename":"src\/jdk.accessibility\/windows\/native\/libjavaaccessbridge\/AccessBridgeJavaEntryPoints.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}