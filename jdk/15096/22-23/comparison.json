{"files":[{"patch":"@@ -26,0 +26,4 @@\n+#include <functional>\n+#include <memory>\n+#include <type_traits>\n+\n@@ -208,18 +212,2 @@\n-    class ResourceGuard final {\n-        JNIEnv* env;\n-        SetEraseBackgroundStruct* background;\n-        jobject canvas;\n-\n-    public:\n-        ResourceGuard(JNIEnv* env, SetEraseBackgroundStruct* background, jobject canvas)\n-            : env(env), background(background), canvas(canvas) {\n-\n-        }\n-        ~ResourceGuard() {\n-            env->DeleteGlobalRef(canvas);\n-            delete background;\n-        }\n-    };\n-\n-    SetEraseBackgroundStruct *sebs = static_cast<SetEraseBackgroundStruct *>(param);\n-    jobject canvas = sebs->canvas;\n+    std::unique_ptr<SetEraseBackgroundStruct> sebs(static_cast<SetEraseBackgroundStruct *>(param));\n+    std::unique_ptr<std::remove_pointer<jobject>::type, std::function<void (jobject)>> canvas(sebs->canvas, [&env] (jobject canvas) -> void { env->DeleteGlobalRef(canvas); });\n@@ -229,2 +217,0 @@\n-    ResourceGuard guard(env, sebs, canvas);\n-\n@@ -232,1 +218,1 @@\n-    JNI_CHECK_PEER_RETURN(canvas);\n+    JNI_CHECK_PEER_RETURN(canvas.get());\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Canvas.cpp","additions":7,"deletions":21,"binary":false,"changes":28,"status":"modified"}]}