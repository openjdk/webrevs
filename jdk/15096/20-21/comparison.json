{"files":[{"patch":"@@ -26,3 +26,0 @@\n-#include <functional>\n-#include <memory>\n-\n@@ -211,2 +208,18 @@\n-    std::unique_ptr<SetEraseBackgroundStruct> sebs(static_cast<SetEraseBackgroundStruct *>(param));\n-    std::unique_ptr<_jobject, std::function<void (const jobject)>> canvas(sebs->canvas, [&env] (const jobject canvas) -> void { env->DeleteGlobalRef(canvas); });\n+    class ResourceGuard final {\n+        JNIEnv* env;\n+    \tSetEraseBackgroundStruct* background;\n+    \tjobject canvas;\n+\n+    public:\n+    \tResourceGuard(JNIEnv* env, SetEraseBackgroundStruct* background, jobject canvas)\n+            : env(env), background(background), canvas(canvas) {\n+\n+        }\n+        ~ResourceGuard() {\n+        \tenv->DeleteGlobalRef(canvas);\n+            delete background;\n+        }\n+    };\n+\n+    SetEraseBackgroundStruct *sebs = static_cast<SetEraseBackgroundStruct *>(param);\n+    jobject canvas = sebs->canvas;\n@@ -216,0 +229,2 @@\n+    ResourceGuard guard(env, sebs, canvas);\n+\n@@ -217,1 +232,1 @@\n-    JNI_CHECK_PEER_RETURN(canvas.get());\n+    JNI_CHECK_PEER_RETURN(canvas);\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Canvas.cpp","additions":21,"deletions":6,"binary":false,"changes":27,"status":"modified"}]}