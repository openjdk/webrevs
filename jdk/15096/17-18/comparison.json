{"files":[{"patch":"@@ -205,3 +205,2 @@\n-void AwtCanvas::_SetEraseBackground(void *param)\n-{\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+void AwtCanvas::_SetEraseBackground(void *param) {\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -209,2 +208,2 @@\n-    SetEraseBackgroundStruct *sebs = (SetEraseBackgroundStruct *)param;\n-    jobject canvas = sebs->canvas;\n+    std::unique_ptr<SetEraseBackgroundStruct> sebs(static_cast<SetEraseBackgroundStruct *>(param));\n+    std::unique_ptr<_jobject, void (*) (jobject)> canvas(sebs->canvas, [&env] (jobject canvas) -> void { env->DeleteGlobalRef(canvas); });\n@@ -215,1 +214,1 @@\n-    JNI_CHECK_PEER_GOTO(canvas, ret);\n+    JNI_CHECK_PEER_RETURN(canvas);\n@@ -217,2 +216,1 @@\n-    AwtCanvas *c;\n-    c = (AwtCanvas*) pData;\n+    AwtCanvas *c = (AwtCanvas*) pData;\n@@ -221,4 +219,0 @@\n-\n-ret:\n-    env->DeleteGlobalRef(canvas);\n-    delete sebs;\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Canvas.cpp","additions":6,"deletions":12,"binary":false,"changes":18,"status":"modified"}]}