{"files":[{"patch":"@@ -3190,2 +3190,1 @@\n-void AwtWindow::_SetOpacity(void* param)\n-{\n+void AwtWindow::_SetOpacity(void* param) {\n@@ -3221,3 +3220,2 @@\n-void AwtWindow::_SetOpaque(void* param)\n-{\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+void AwtWindow::_SetOpaque(void* param) {\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -3225,1 +3223,1 @@\n-    OpaqueStruct *os = (OpaqueStruct *)param;\n+    OpaqueStruct *os = static_cast<OpaqueStruct *>(param);\n@@ -3229,6 +3227,14 @@\n-    {\n-        PDATA pData;\n-        JNI_CHECK_PEER_GOTO(self, ret);\n-        AwtWindow *window = (AwtWindow *)pData;\n-\n-        window->SetTranslucency(window->getOpacity(), isOpaque);\n+    PDATA pData;\n+    if (self == NULL) {\n+        env->ExceptionClear();\n+        JNU_ThrowNullPointerException(env, \"self\");\n+        delete os;\n+        return;\n+    } else {\n+        pData = JNI_GET_PDATA(self);\n+        if (pData == NULL) {\n+            THROW_NULL_PDATA_IF_NOT_DESTROYED(self);\n+            env->DeleteGlobalRef(self);\n+            delete os;\n+            return;\n+        }\n@@ -3236,0 +3242,3 @@\n+    AwtWindow *window = (AwtWindow *) pData;\n+\n+    window->SetTranslucency(window->getOpacity(), isOpaque);\n@@ -3237,1 +3246,0 @@\n-  ret:\n@@ -3242,3 +3250,2 @@\n-void AwtWindow::_UpdateWindow(void* param)\n-{\n-    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+void AwtWindow::_UpdateWindow(void* param) {\n+    JNIEnv *env = (JNIEnv *) JNU_GetEnv(jvm, JNI_VERSION_1_2);\n@@ -3246,1 +3253,1 @@\n-    UpdateWindowStruct *uws = (UpdateWindowStruct *)param;\n+    UpdateWindowStruct *uws = static_cast<UpdateWindowStruct *>(param);\n@@ -3250,7 +3257,20 @@\n-    {\n-        PDATA pData;\n-        JNI_CHECK_PEER_GOTO(self, ret);\n-        AwtWindow *window = (AwtWindow *)pData;\n-\n-        window->UpdateWindow(env, data, (int)uws->width, (int)uws->height,\n-                             uws->hBitmap);\n+    PDATA pData;\n+    if (self == NULL) {\n+        env->ExceptionClear();\n+        JNU_ThrowNullPointerException(env, \"self\");\n+        if (data != NULL) {\n+            env->DeleteGlobalRef(data);\n+        }\n+        delete uws;\n+        return;\n+    } else {\n+        pData = JNI_GET_PDATA(self);\n+        if (pData == NULL) {\n+            THROW_NULL_PDATA_IF_NOT_DESTROYED(self);\n+            env->DeleteGlobalRef(self);\n+            if (data != NULL) {\n+                env->DeleteGlobalRef(data);\n+            }\n+            delete uws;\n+            return;\n+        }\n@@ -3258,0 +3278,4 @@\n+    AwtWindow *window = (AwtWindow *) pData;\n+\n+    window->UpdateWindow(env, data, (int) uws->width, (int) uws->height,\n+                         uws->hBitmap);\n@@ -3259,1 +3283,0 @@\n-  ret:\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Window.cpp","additions":48,"deletions":25,"binary":false,"changes":73,"status":"modified"}]}