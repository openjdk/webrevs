{"files":[{"patch":"@@ -2987,0 +2987,1 @@\n+\/\/ Checks that `index` denotes a non-injected field in `klass`\n@@ -2993,1 +2994,8 @@\n-  if (index < 0 || index >= iklass->total_fields_count()) {\n+  if (index < 0 || index >= iklass->java_fields_count()) {\n+    if (index >= 0 && index < iklass->total_fields_count()) {\n+      fieldDescriptor fd(iklass, index);\n+      if (fd.is_injected()) {\n+        JVMCI_THROW_MSG_NULL(IllegalArgumentException,\n+            err_msg(\"Cannot get Field for injected %s.%s\", klass->external_name(), fd.name()->as_C_string()));\n+      }\n+    }\n@@ -3005,4 +3013,0 @@\n-  if (fd.is_injected()) {\n-    JVMCI_THROW_MSG_NULL(IllegalArgumentException,\n-        err_msg(\"Cannot get Field for injected %s.%s\", klass->external_name(), fd.name()->as_C_string()));\n-  }\n@@ -3080,1 +3084,1 @@\n-  return get_encoded_annotation_data(holder, holder->class_annotations(), true, filter_length, filter_klass_pointers, THREAD, JVMCIENV);\n+  return get_encoded_annotation_data(holder, holder->class_annotations(), true, filter_length, filter_klass_pointers, THREAD, JVMCI_CHECK_NULL);\n@@ -3087,1 +3091,1 @@\n-  return get_encoded_annotation_data(method->method_holder(), method->annotations(), false, filter_length, filter_klass_pointers, THREAD, JVMCIENV);\n+  return get_encoded_annotation_data(method->method_holder(), method->annotations(), false, filter_length, filter_klass_pointers, THREAD, JVMCI_CHECK_NULL);\n@@ -3093,1 +3097,1 @@\n-  InstanceKlass* holder = check_field(InstanceKlass::cast(UNPACK_PAIR(Klass, klass)), index, JVMCIENV);\n+  InstanceKlass* holder = check_field(InstanceKlass::cast(UNPACK_PAIR(Klass, klass)), index, JVMCI_CHECK_NULL);\n@@ -3095,1 +3099,1 @@\n-  return get_encoded_annotation_data(holder, fd.annotations(), false, filter_length, filter_klass_pointers, THREAD, JVMCIENV);\n+  return get_encoded_annotation_data(holder, fd.annotations(), false, filter_length, filter_klass_pointers, THREAD, JVMCI_CHECK_NULL);\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCompilerToVM.cpp","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"}]}