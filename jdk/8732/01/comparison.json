{"files":[{"patch":"@@ -117,1 +117,1 @@\n-                load(1, false, false);\n+                load(1, true, false);\n@@ -880,1 +880,1 @@\n-                    || c == '%' || !XML11Char.isXML11InternalEntityContent(c)) {\n+                    || c == '%' || !XML11Char.isXML11InternalEntityContent(c) || c == '\\r') {\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/XML11EntityScanner.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1159,1 +1159,1 @@\n-                    c == '%' || !XMLChar.isContent(c)) {\n+                    c == '%' || !XMLChar.isContent(c) || c == '\\r' && !isExternal) {\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/XMLEntityScanner.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1171,2 +1171,1 @@\n-                    if (fBase.fLength < fMinLength) {\n-                        \/\/ fBase.length, minLength and maxLength defined\n+                    if ((fBase.fFacetsDefined & FACET_LENGTH) != 0 && fBase.fLength < fMinLength) {\n@@ -1175,0 +1174,3 @@\n+                    if ((fFacetsDefined & FACET_LENGTH) != 0 && fLength < fMinLength) {\n+                        reportError(\"length-minLength-maxLength.1.1\", new Object[]{fTypeName, Integer.toString(fLength), Integer.toString(fMinLength)});\n+                    }\n@@ -1183,2 +1185,1 @@\n-                    if (fBase.fLength > fMaxLength) {\n-                        \/\/ fBase.length, minLength and maxLength defined\n+                    if ((fBase.fFacetsDefined & FACET_LENGTH) != 0 && fBase.fLength > fMaxLength) {\n@@ -1187,0 +1188,3 @@\n+                    if ((fFacetsDefined & FACET_LENGTH) != 0 && fLength > fMaxLength) {\n+                        reportError(\"length-minLength-maxLength.2.1\", new Object[]{fTypeName, Integer.toString(fLength), Integer.toString(fMaxLength)});\n+                    }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/dv\/xs\/XSSimpleTypeDecl.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/DOMMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/DatatypeMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/JAXPValidationMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/SAXMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/XIncludeMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/XMLMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n@@ -52,0 +69,1 @@\n+        cvc-complex-type.4_ns = cvc-complex-type.4: Attribute ''{1}'' belonging to namespace ''{2}'', must appear on element ''{0}''.\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/XMLSchemaMessages.properties","additions":18,"deletions":0,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/XMLSerializerMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/msg\/XPointerMessages.properties","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -3224,0 +3224,12 @@\n+                if (!isSpecified) {\n+                    if (currDecl.fTargetNamespace != null) {\n+                       reportSchemaError(\n+                                \"cvc-complex-type.4_ns\",\n+                                new Object[] { element.rawname, currDecl.fName, currDecl.fTargetNamespace });\n+                    }\n+                    else {\n+                       reportSchemaError(\n+                                \"cvc-complex-type.4\",\n+                                new Object[] { element.rawname, currDecl.fName });\n+                    }\n+                }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/xs\/XMLSchemaValidator.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-## Apache Xerces v2.12.1\n+## Apache Xerces v2.12.2\n@@ -11,1 +11,1 @@\n-    Copyright 1999-2020 The Apache Software Foundation\n+    Copyright 1999-2022 The Apache Software Foundation\n","filename":"src\/java.xml\/share\/legal\/xerces.md","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,25 @@\n+<?xml version='1.0'?>\r\n+<xsd:schema xmlns:xsd='http:\/\/www.w3.org\/2001\/XMLSchema' >\r\n+<!-- Schema to test IDREFS datatype -->\r\n+  <xsd:element name='test' type='fooType' \/>\r\n+  <xsd:complexType name='fooType' > \r\n+    <xsd:sequence>\r\n+      <xsd:element name='foo' >\r\n+        <xsd:complexType>\r\n+          <xsd:simpleContent>\r\n+            <xsd:extension base=\"xsd:string\">\r\n+              <xsd:attribute name='attrTest'>\r\n+                <xsd:simpleType> \r\n+                  <xsd:restriction base=\"xsd:IDREFS\">\r\n+                            <xsd:length value=\"5\"\/>\r\n+                            <xsd:minLength value=\"1\"\/>\r\n+                  <\/xsd:restriction>\r\n+                <\/xsd:simpleType>\r\n+              <\/xsd:attribute>\r\n+            <\/xsd:extension>\r\n+          <\/xsd:simpleContent>\r\n+        <\/xsd:complexType>\r\n+      <\/xsd:element>\r\n+    <\/xsd:sequence>\r\n+  <\/xsd:complexType>\r\n+<\/xsd:schema>\r\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/validation\/IDREFS_length006.xsd","additions":25,"deletions":0,"binary":false,"changes":25,"status":"added"},{"patch":"@@ -0,0 +1,25 @@\n+<?xml version='1.0'?>\r\n+<xsd:schema xmlns:xsd='http:\/\/www.w3.org\/2001\/XMLSchema' >\r\n+<!-- Schema to test NMTOKENS datatype -->\r\n+  <xsd:element name='test' type='fooType' \/>\r\n+  <xsd:complexType name='fooType' > \r\n+    <xsd:sequence>\r\n+      <xsd:element name='foo' >\r\n+        <xsd:complexType>\r\n+          <xsd:simpleContent>\r\n+            <xsd:extension base=\"xsd:string\">\r\n+              <xsd:attribute name='attrTest'>\r\n+                <xsd:simpleType> \r\n+                  <xsd:restriction base=\"xsd:NMTOKENS\">\r\n+                            <xsd:length value=\"5\"\/>\r\n+                            <xsd:minLength value=\"1\"\/>\r\n+                  <\/xsd:restriction>\r\n+                <\/xsd:simpleType>\r\n+              <\/xsd:attribute>\r\n+            <\/xsd:extension>\r\n+          <\/xsd:simpleContent>\r\n+        <\/xsd:complexType>\r\n+      <\/xsd:element>\r\n+    <\/xsd:sequence>\r\n+  <\/xsd:complexType>\r\n+<\/xsd:schema>\r\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/validation\/NMTOKENS_length006.xsd","additions":25,"deletions":0,"binary":false,"changes":25,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-import org.testng.annotations.Listeners;\n+import org.testng.annotations.DataProvider;\n@@ -42,1 +42,1 @@\n- * @bug 8149915 8222991\n+ * @bug 8149915 8222991 8282280 8144117\n@@ -45,1 +45,1 @@\n- * @summary Test Schema creation\n+ * @summary Tests schemas and Schema creation.\n@@ -47,1 +47,0 @@\n-@Listeners({jaxp.library.FilePolicy.class})\n@@ -49,0 +48,74 @@\n+    private static final String XSD_8144117 = \"<?xml version='1.0'?>\\n\" +\n+        \"<xs:schema xmlns:xs='http:\/\/www.w3.org\/2001\/XMLSchema'>\\n\" +\n+        \"\\n\" +\n+        \"  <xs:simpleType name='mjtype1'>\\n\" +\n+        \"    <xs:restriction base='xs:string'>\\n\" +\n+        \"      <xs:minLength value='3'\/>\\n\" +\n+        \"    <\/xs:restriction>\\n\" +\n+        \"  <\/xs:simpleType>\\n\" +\n+        \"\\n\" +\n+        \"  <xs:simpleType name='mjtype2'>\\n\" +\n+        \"    <xs:restriction base='mjtype1'>\\n\" +\n+        \"      <xs:minLength value='3'\/>\\n\" +\n+        \"      <xs:length value='4'\/>\\n\" +\n+        \"    <\/xs:restriction>\\n\" +\n+        \"  <\/xs:simpleType>\\n\" +\n+        \"\\n\" +\n+        \"  <xs:element name='top' type='mjtype2'\/>\\n\" +\n+        \"\\n\" +\n+        \"<\/xs:schema>\";\n+\n+    \/*\n+     * DataProvider: valid xsd strings.\n+     *\/\n+    @DataProvider(name = \"xsd\")\n+    Object[][] getXSDString() {\n+        return new Object[][]{\n+            {XSD_8144117},\n+        };\n+    }\n+\n+    \/*\n+     * DataProvider: valid external xsd files.\n+     *\/\n+    @DataProvider(name = \"xsdFile\")\n+    Object[][] getXSDFile() {\n+        return new Object[][]{\n+            \/*\n+             * Refer to the related JCK issue. The following tests match the rules\n+             * specified in:\n+             * XML Schema Part 2: Datatypes (https:\/\/www.w3.org\/TR\/xmlschema-2\/)\n+             * 4.3.1.4 Constraints on length Schema Components\n+             * and are therefore valid.\n+             *\/\n+            {\"NMTOKENS_length006.xsd\"},\n+            {\"IDREFS_length006.xsd\"},\n+        };\n+    }\n+\n+    \/**\n+     * @bug 8144117 fix by 8282280\n+     * Verifies that the schema is valid.\n+     *\n+     * @param xsd the schema\n+     * @throws Exception if the test fails\n+     *\/\n+    @Test(dataProvider = \"xsd\")\n+    public void testSchema1(String xsd) throws Exception {\n+        SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n+        factory.newSchema(new StreamSource(new StringReader(xsd)));\n+    }\n+\n+    \/**\n+     * @bug 8282280\n+     * Verifies that the schema is valid.\n+     *\n+     * @param xsd the schema file\n+     * @throws Exception if the test fails\n+     *\/\n+    @Test(dataProvider = \"xsdFile\")\n+    public void testSchema2(String xsd) throws Exception {\n+        SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n+        factory.newSchema(new File(getClass().getResource(xsd).getFile()));\n+    }\n+\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/validation\/SchemaTest.java","additions":78,"deletions":5,"binary":false,"changes":83,"status":"modified"}]}