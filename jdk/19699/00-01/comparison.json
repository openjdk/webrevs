{"files":[{"patch":"@@ -290,1 +290,1 @@\n-julong os::rss() { return (julong)0; }\n+size_t os::rss() { return (size_t)0; }\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -213,2 +213,2 @@\n-julong os::rss() {\n-  julong rss = 0;\n+size_t os::rss() {\n+  size_t rss = 0;\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -362,2 +362,2 @@\n-julong os::rss() {\n-  julong size = 0;\n+size_t os::rss() {\n+  size_t size = 0;\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -861,2 +861,2 @@\n-julong os::rss() {\n-  julong rss = 0;\n+size_t os::rss() {\n+  size_t rss = 0;\n@@ -868,1 +868,1 @@\n-  if (ret != 0) {\n+  if (ret) {\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -347,1 +347,1 @@\n-  static julong rss();\n+  static size_t rss();\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3,0 +3,1 @@\n+ * Copyright (c) 2024, Red Hat Inc.\n@@ -28,1 +29,1 @@\n- * @summary Tests AlwaysPreTouch Behavior, pages of java heap should be pretouched with AlwaysPreTouch enabled. This test reads RSS of test process, which should be bigger than heap size(1g) with AlwaysPreTouch enabled.\n+ * @summary tests AlwaysPreTouch\n@@ -31,0 +32,1 @@\n+ * @requires os.family != \"aix\"\n@@ -34,1 +36,13 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xmx1g -Xms1g -XX:+UseParallelGC -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xmx512m -Xms512m -XX:+UseParallelGC -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n+ *\/\n+\n+ \/**\n+ * @test id=SerialCollector\n+ * @summary tests AlwaysPreTouch\n+ * @requires vm.gc.Serial\n+ * @requires os.maxMemory > 2G\n+ * @requires os.family != \"aix\"\n+ * @library \/test\/lib\n+ * @build jdk.test.whitebox.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xmx512m -Xms512m -XX:+UseSerialGC -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n@@ -39,1 +53,1 @@\n- * @summary Tests AlwaysPreTouch Behavior, pages of java heap should be pretouched with AlwaysPreTouch enabled. This test reads RSS of test process, which should be bigger than heap size(1g) with AlwaysPreTouch enabled.\n+ * @summary tests AlwaysPreTouch\n@@ -42,0 +56,1 @@\n+ * @requires os.family != \"aix\"\n@@ -45,1 +60,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xmx1g -Xms1g -XX:+UseShenandoahGC  -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xmx512m -Xms512m -XX:+UseShenandoahGC  -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n@@ -50,1 +65,1 @@\n- * @summary Tests AlwaysPreTouch Behavior, pages of java heap should be pretouched with AlwaysPreTouch enabled. This test reads RSS of test process, which should be bigger than heap size(1g) with AlwaysPreTouch enabled.\n+ * @summary tests AlwaysPreTouch\n@@ -53,0 +68,1 @@\n+ * @requires os.family != \"aix\"\n@@ -56,1 +72,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xmx1g -Xms1g -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xmx512m -Xms512m -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n@@ -61,1 +77,1 @@\n- * @summary Tests AlwaysPreTouch Behavior, pages of java heap should be pretouched with AlwaysPreTouch enabled. This test reads RSS of test process, which should be bigger than heap size(1g) with AlwaysPreTouch enabled.\n+ * @summary tests AlwaysPreTouch\n@@ -64,0 +80,1 @@\n+ * @requires os.family != \"aix\"\n@@ -67,1 +84,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseZGC -XX:+ZGenerational -Xmx1g -Xms1g -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseZGC -XX:+ZGenerational -Xmx512m -Xms512m -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n@@ -72,1 +89,1 @@\n- * @summary Tests AlwaysPreTouch Behavior, pages of java heap should be pretouched with AlwaysPreTouch enabled. This test reads RSS of test process, which should be bigger than heap size(1g) with AlwaysPreTouch enabled.\n+ * @summary tests AlwaysPreTouch\n@@ -75,0 +92,1 @@\n+ * @requires os.family != \"aix\"\n@@ -78,1 +96,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseZGC -XX:-ZGenerational -Xmx1g -Xms1g -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseZGC -XX:-ZGenerational -Xmx512m -Xms512m -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n@@ -81,1 +99,0 @@\n-\n@@ -84,1 +101,1 @@\n- * @summary Tests AlwaysPreTouch Behavior, pages of java heap should be pretouched with AlwaysPreTouch enabled. This test reads RSS of test process, which should be bigger than heap size(1g) with AlwaysPreTouch enabled.\n+ * @summary tests AlwaysPreTouch\n@@ -87,0 +104,1 @@\n+ * @requires os.family != \"aix\"\n@@ -90,1 +108,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:+UseEpsilonGC -Xmx1g -Xms1g -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UnlockExperimentalVMOptions -XX:+UseEpsilonGC -Xmx512m -Xms512m -XX:+AlwaysPreTouch gc.TestAlwaysPreTouchBehavior\n@@ -108,2 +126,2 @@\n-    long committedMemory = runtime.totalMemory() \/ 1024; \/\/ in kb\n-    Asserts.assertGreaterThanOrEqual(rss, committedMemory, \"RSS of this process(\" + rss + \"kb) should be bigger than or equal to committed heap mem(\" + committedMemory + \"kb)\");\n+    long committedMemory = runtime.totalMemory();\n+    Asserts.assertGreaterThan(rss, committedMemory, \"RSS of this process(\" + rss + \"b) should be bigger than or equal to committed heap mem(\" + committedMemory + \"b)\");\n","filename":"test\/hotspot\/jtreg\/gc\/TestAlwaysPreTouchBehavior.java","additions":33,"deletions":15,"binary":false,"changes":48,"status":"modified"}]}