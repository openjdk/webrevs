{"files":[{"patch":"@@ -79,0 +79,12 @@\n+  \/\/ The default of parallel_region_stride is 0, ShenandoahHeap::parallel_heap_region_iterate will determine\n+  \/\/ the value based on number of regions and active worker threads if regions number is more than 4096.\n+  \/\/ The default behavior is designed for super light workload e.g. ShenandoahInitMarkUpdateRegionStateClosure,\n+  \/\/ which is just few instruction to capture TAMS for each region.\n+  \/\/ Resetting bitmaps is not really lightweight workload because it needs to reset chunks of memory for\n+  \/\/ marking bitmaps, it doesn't need to be done for each region, the default logic can't distribute the task\n+  \/\/ evenly to all active workers.\n+  \/\/ Using a smaller value here yields better task distribution for a lumpy workload. The task will be split\n+  \/\/ into smaller batches with 8 regions in batch, the worker processes more regions w\/o needs to reset bitmaps\n+  \/\/ will process more batches, but overall all workers will be saturated throughout the whole concurrent reset phase.\n+  size_t parallel_region_stride() override { return 8; }\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGeneration.cpp","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -1965,1 +1965,1 @@\n-  size_t stride = ShenandoahParallelRegionStride;\n+  size_t stride = blk->parallel_region_stride();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -116,0 +116,5 @@\n+  \/\/ Default to global value ShenandoahParallelRegionStride, When it is set to 0,\n+  \/\/ ShenandoahHeap::parallel_heap_region_iterate will derive a reasonable value based\n+  \/\/ on active worker threads and number of regions.\n+  \/\/ For some lumpy workload, the value can be overridden for better task distribution.\n+  virtual size_t parallel_region_stride() { return ShenandoahParallelRegionStride; }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -47,0 +47,4 @@\n+  size_t parallel_region_stride() override {\n+    return _closure->parallel_region_stride();\n+  }\n+\n@@ -67,0 +71,4 @@\n+  size_t parallel_region_stride() override {\n+    return _closure->parallel_region_stride();\n+  }\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegionClosures.hpp","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"}]}