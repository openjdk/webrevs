{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -78,14 +78,1 @@\n-public class addthreadfilter002 {\n-\n-    \/\/----------------------------------------------------- templete section\n-    static final int PASSED = 0;\n-    static final int FAILED = 2;\n-    static final int PASS_BASE = 95;\n-\n-    \/\/----------------------------------------------------- templete parameters\n-    static final String\n-    sHeader1 = \"\\n==> nsk\/jdi\/ThreadStartRequest\/addThreadFilter\/addthreadfilter002 \",\n-    sHeader2 = \"--> debugger: \",\n-    sHeader3 = \"##> debugger: \";\n-\n-    \/\/----------------------------------------------------- main method\n+public class addthreadfilter002 extends JDIBase {\n@@ -112,14 +99,0 @@\n-    \/\/--------------------------------------------------   log procedures\n-\n-    private static Log  logHandler;\n-\n-    private static void log1(String message) {\n-        logHandler.display(sHeader1 + message);\n-    }\n-    private static void log2(String message) {\n-        logHandler.display(sHeader2 + message);\n-    }\n-    private static void log3(String message) {\n-        logHandler.complain(sHeader3 + message);\n-    }\n-\n@@ -132,17 +105,0 @@\n-    \/\/------------------------------------------------------ common section\n-\n-    static Debugee          debuggee;\n-    static ArgumentHandler  argsHandler;\n-\n-    static int waitTime;\n-\n-    static VirtualMachine      vm            = null;\n-    static EventRequestManager eventRManager = null;\n-    static EventQueue          eventQueue    = null;\n-    static EventSet            eventSet      = null;\n-    static EventIterator       eventIterator = null;\n-\n-    static ReferenceType       debuggeeClass = null;\n-\n-    static int  testExitCode = PASSED;\n-\n@@ -290,10 +246,1 @@\n-        String bPointMethod = \"methodForCommunication\";\n-        String lineForComm  = \"lineForComm\";\n-        BreakpointRequest bpRequest;\n-\n-        ThreadReference mainThread = debuggee.threadByNameOrThrow(\"main\");\n-\n-        bpRequest = settingBreakpoint(mainThread,\n-                                      debuggeeClass,\n-                                      bPointMethod, lineForComm, \"zero\");\n-        bpRequest.enable();\n+        setupBreakpointForCommunication(debuggeeClass);\n@@ -310,0 +257,1 @@\n+            ThreadReference mainThread = bpEvent.thread(); \/\/ bpEvent saved by breakpointForCommunication()\n@@ -381,104 +329,0 @@\n-   \/*\n-    * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,\n-    *                                             String, String, String)\n-    *\n-    * It sets up a breakpoint at given line number within a given method in a given class\n-    * for a given thread.\n-    *\n-    * Return value: BreakpointRequest object  in case of success\n-    *\n-    * JDITestRuntimeException   in case of an Exception thrown within the method\n-    *\/\n-\n-    private BreakpointRequest settingBreakpoint ( ThreadReference thread,\n-                                                  ReferenceType testedClass,\n-                                                  String methodName,\n-                                                  String bpLine,\n-                                                  String property)\n-            throws JDITestRuntimeException {\n-\n-        log2(\"......setting up a breakpoint:\");\n-        log2(\"       thread: \" + thread + \"; class: \" + testedClass +\n-                        \"; method: \" + methodName + \"; line: \" + bpLine);\n-\n-        List              alllineLocations = null;\n-        Location          lineLocation     = null;\n-        BreakpointRequest breakpRequest    = null;\n-\n-        try {\n-            Method  method  = (Method) testedClass.methodsByName(methodName).get(0);\n-\n-            alllineLocations = method.allLineLocations();\n-\n-            int n =\n-                ( (IntegerValue) testedClass.getValue(testedClass.fieldByName(bpLine) ) ).value();\n-            if (n > alllineLocations.size()) {\n-                log3(\"ERROR:  TEST_ERROR_IN_settingBreakpoint(): number is out of bound of method's lines\");\n-            } else {\n-                lineLocation = (Location) alllineLocations.get(n);\n-                try {\n-                    breakpRequest = eventRManager.createBreakpointRequest(lineLocation);\n-                    breakpRequest.putProperty(\"number\", property);\n-                    breakpRequest.addThreadFilter(thread);\n-                    breakpRequest.setSuspendPolicy( EventRequest.SUSPEND_EVENT_THREAD);\n-                } catch ( Exception e1 ) {\n-                    log3(\"ERROR: inner Exception within settingBreakpoint() : \" + e1);\n-                    breakpRequest    = null;\n-                }\n-            }\n-        } catch ( Exception e2 ) {\n-            log3(\"ERROR: ATTENTION:  outer Exception within settingBreakpoint() : \" + e2);\n-            breakpRequest    = null;\n-        }\n-\n-        if (breakpRequest == null) {\n-            log2(\"      A BREAKPOINT HAS NOT BEEN SET UP\");\n-            throw new JDITestRuntimeException(\"**FAILURE to set up a breakpoint**\");\n-        }\n-\n-        log2(\"      a breakpoint has been set up\");\n-        return breakpRequest;\n-    }\n-\n-\n-    private void getEventSet()\n-                 throws JDITestRuntimeException {\n-        try {\n-\/\/            log2(\"       eventSet = eventQueue.remove(waitTime);\");\n-            eventSet = eventQueue.remove(waitTime);\n-            if (eventSet == null) {\n-                throw new JDITestRuntimeException(\"** TIMEOUT while waiting for event **\");\n-            }\n-\/\/            log2(\"       eventIterator = eventSet.eventIterator;\");\n-            eventIterator = eventSet.eventIterator();\n-        } catch ( Exception e ) {\n-            throw new JDITestRuntimeException(\"** EXCEPTION while waiting for event ** : \" + e);\n-        }\n-    }\n-\n-\n-    private void breakpointForCommunication()\n-                 throws JDITestRuntimeException {\n-\n-        log2(\"breakpointForCommunication\");\n-        while (true) {\n-            getEventSet();\n-            while (eventIterator.hasNext()) {\n-                Event event = eventIterator.nextEvent();\n-                if (event instanceof BreakpointEvent) {\n-                    return;\n-                } else if (event instanceof ThreadStartEvent) {\n-                    \/\/ It might be the case that while the thread start request was enabled\n-                    \/\/ some threads not related to the test ( e.g. JVMCI threads) were started\n-                    \/\/ and generated thread start events. We ignore these thread start events\n-                    \/\/ and keep waiting for a breakpoint event.\n-                    ThreadStartEvent tse = (ThreadStartEvent) event;\n-                    log2(\"ThreadStartEvent is received while waiting for a breakpoint\" +\n-                            \" event, thread: : \" + tse.thread().name());\n-                    continue;\n-                }\n-                throw new JDITestRuntimeException(\"** event IS NOT a breakpoint or a thread start **\");\n-            }\n-        }\n-    }\n-\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jdi\/ThreadStartRequest\/addThreadFilter\/addthreadfilter002.java","additions":4,"deletions":160,"binary":false,"changes":164,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -344,0 +344,1 @@\n+                \"CompilerThread\",\n@@ -348,1 +349,1 @@\n-                if (tname.startsWith(s)) {\n+                if (tname.indexOf(s) != -1) {\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jdi\/EventFilters.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -242,0 +242,3 @@\n+                ThreadStartEvent tse = (ThreadStartEvent) event;\n+                log2(\"ThreadStartEvent is received while waiting for a breakpoint\" +\n+                     \" event, thread: : \" + tse.thread().name());\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jdi\/JDIBase.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}