{"files":[{"patch":"@@ -165,0 +165,1 @@\n+            boolean extraExportsOrOpens = addExtraExportsAndOpens(bootLayer);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/ModuleBootstrap.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -60,0 +60,5 @@\n+    private static String addOpensArg = \"java.base\/java.lang=\" + TEST_MODULE1;\n+    private static String extraOpts[][] =\n+        {{\"-Xlog:cds\", \"-Xlog:cds\"},\n+         {\"--add-opens\", addOpensArg}}; \n+\n@@ -81,23 +86,28 @@\n-        String appClasses[] = {MAIN_CLASS};\n-        \/\/ create an archive with both -cp and --module-path in the command line.\n-        \/\/ Only the class in the modular jar in the --module-path will be archived;\n-        \/\/ the class in the modular jar in the -cp won't be archived.\n-        OutputAnalyzer output = TestCommon.createArchive(\n-                                        destJar.toString(), appClasses,\n-                                        \"--module-path\", moduleDir.toString(),\n-                                        \"-m\", TEST_MODULE1);\n-        TestCommon.checkDump(output);\n-\n-        \/\/ run with the archive using the same command line as in dump time\n-        \/\/ plus the \"--add-opens java.base\/java.lang=com.simple\" option.\n-        \/\/ The main class should be loaded from the archive.\n-        \/\/ The setaccessible(true) on the ClassLoader.defineClass method should\n-        \/\/ be successful.\n-        TestCommon.run( \"-Xlog:class+load=trace\",\n-                        \"-cp\", destJar.toString(),\n-                        \"--add-opens\", \"java.base\/java.lang=\" + TEST_MODULE1,\n-                        \"--module-path\", moduleDir.toString(),\n-                        \"-m\", TEST_MODULE1, \"with_add_opens\")\n-            .assertNormalExit(\n-                \"[class,load] com.simple.Main source: shared objects file\",\n-                \"method.setAccessible succeeded!\");\n+        String appClasses[] = {MAIN_CLASS, \"java\/lang\/ClassLoader\"};\n+\n+        for (int i = 0; i < 2; i++) {\n+            \/\/ create an archive with both -cp and --module-path, and with the\n+            \/\/ --add-opens option if i == 1, in the command line.\n+            \/\/ Only the class in the modular jar in the --module-path will be archived;\n+            \/\/ the class in the modular jar in the -cp won't be archived.\n+            OutputAnalyzer output = TestCommon.createArchive(\n+                                            destJar.toString(), appClasses,\n+                                            extraOpts[i][0], extraOpts[i][1],\n+                                            \"--module-path\", moduleDir.toString(),\n+                                            \"-m\", TEST_MODULE1);\n+            TestCommon.checkDump(output);\n+\n+            \/\/ run with the archive using the same command line as in dump time\n+            \/\/ plus the \"--add-opens java.base\/java.lang=com.simple\" option.\n+            \/\/ The main class should be loaded from the archive.\n+            \/\/ The setaccessible(true) on the ClassLoader.defineClass method should\n+            \/\/ be successful.\n+            TestCommon.run( \"-Xlog:class+load=trace\",\n+                            \"-cp\", destJar.toString(),\n+                            \"--add-opens\", addOpensArg,\n+                            \"--module-path\", moduleDir.toString(),\n+                            \"-m\", TEST_MODULE1, \"with_add_opens\")\n+                    .assertNormalExit(\n+                    \"[class,load] com.simple.Main source: shared objects file\",\n+                    \"method.setAccessible succeeded!\");\n+        }\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jigsaw\/modulepath\/AddOpens.java","additions":33,"deletions":23,"binary":false,"changes":56,"status":"modified"}]}