{"files":[{"patch":"@@ -385,1 +385,1 @@\n-  _num_root_regions = 0;\n+  _num_root_regions.store_relaxed(0);\n@@ -390,1 +390,1 @@\n-  size_t idx = AtomicAccess::fetch_then_add(&_num_root_regions, 1u);\n+  size_t idx = _num_root_regions.fetch_then_add(1u);\n@@ -401,1 +401,1 @@\n-  _scan_in_progress = _num_root_regions > 0;\n+  _scan_in_progress.store_relaxed(num_root_regions() > 0);\n@@ -403,2 +403,2 @@\n-  _claimed_root_regions = 0;\n-  _should_abort = false;\n+  _claimed_root_regions.store_relaxed(0);\n+  _should_abort.store_relaxed(false);\n@@ -408,1 +408,1 @@\n-  if (_should_abort) {\n+  if (_should_abort.load_relaxed()) {\n@@ -414,1 +414,2 @@\n-  if (_claimed_root_regions >= _num_root_regions) {\n+  uint local_num_root_regions = num_root_regions();\n+  if (_claimed_root_regions.load_relaxed() >= local_num_root_regions) {\n@@ -418,2 +419,2 @@\n-  size_t claimed_index = AtomicAccess::fetch_then_add(&_claimed_root_regions, 1u);\n-  if (claimed_index < _num_root_regions) {\n+  size_t claimed_index = _claimed_root_regions.fetch_then_add(1u);\n+  if (claimed_index < local_num_root_regions) {\n@@ -426,1 +427,1 @@\n-  return (uint)_num_root_regions;\n+  return (uint)_num_root_regions.load_relaxed();\n@@ -430,1 +431,2 @@\n-  for (uint i = 0; i < _num_root_regions; i++) {\n+  uint local_num_root_regions = num_root_regions();\n+  for (uint i = 0; i < local_num_root_regions; i++) {\n@@ -440,1 +442,1 @@\n-  _scan_in_progress = false;\n+  _scan_in_progress.store_relaxed(false);\n@@ -451,2 +453,2 @@\n-  if (!_should_abort) {\n-    assert(_claimed_root_regions >= num_root_regions(),\n+  if (!_should_abort.load_relaxed()) {\n+    assert(_claimed_root_regions.load_relaxed() >= num_root_regions(),\n@@ -454,1 +456,1 @@\n-           _claimed_root_regions, num_root_regions());\n+           _claimed_root_regions.load_relaxed(), num_root_regions());\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentMark.cpp","additions":17,"deletions":15,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -293,1 +293,1 @@\n-  volatile size_t _num_root_regions; \/\/ Actual number of root regions.\n+  Atomic<size_t> _num_root_regions;  \/\/ Actual number of root regions.\n@@ -295,1 +295,1 @@\n-  volatile size_t _claimed_root_regions; \/\/ Number of root regions currently claimed.\n+  Atomic<size_t> _claimed_root_regions; \/\/ Number of root regions currently claimed.\n@@ -297,2 +297,2 @@\n-  volatile bool _scan_in_progress;\n-  volatile bool _should_abort;\n+  Atomic<bool> _scan_in_progress;\n+  Atomic<bool> _should_abort;\n@@ -315,1 +315,1 @@\n-  void abort() { _should_abort = true; }\n+  void abort() { _should_abort.store_relaxed(true); }\n@@ -319,1 +319,1 @@\n-  bool scan_in_progress() { return _scan_in_progress; }\n+  bool scan_in_progress() { return _scan_in_progress.load_relaxed(); }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentMark.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"}]}