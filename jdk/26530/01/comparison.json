{"files":[{"patch":"@@ -736,11 +736,5 @@\n-  struct rlimit rlim;\n-  int getrlimit_res = getrlimit(RLIMIT_AS, &rlim);\n-  \/\/ if there was an error when calling getrlimit, assume that there is no limitation\n-  \/\/ on virtual memory.\n-  bool result;\n-  if ((getrlimit_res != 0) || (rlim.rlim_cur == RLIM_INFINITY)) {\n-    result = false;\n-  } else {\n-    *limit = (size_t)rlim.rlim_cur;\n-    result = true;\n-  }\n+  \/\/ On POSIX systems, the amount of allocatable memory is limited by the\n+  \/\/ size of the virtual address space.\n+  *limit = address_space_limit();\n+  bool is_limited = *limit != SIZE_MAX;\n+\n@@ -748,1 +742,1 @@\n-  return result;\n+  return is_limited;\n@@ -799,0 +793,18 @@\n+size_t os::address_space_limit() {\n+  struct rlimit rlim;\n+  int getrlimit_res = getrlimit(RLIMIT_AS, &rlim);\n+\n+  \/\/ If there was an error calling getrlimit, conservatively assume no limit.\n+  if (getrlimit_res != 0) {\n+    return SIZE_MAX;\n+  }\n+\n+  \/\/ If the current limit is not infinity, there is a limit.\n+  if (rlim.rlim_cur != RLIM_INFINITY) {\n+    return (size_t)rlim.rlim_cur;\n+  }\n+\n+  \/\/ No limit\n+  return SIZE_MAX;\n+}\n+\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":24,"deletions":12,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -908,0 +908,5 @@\n+size_t os::address_space_limit() {\n+  \/\/ Virtual address space cannot be limited on Windows.\n+  return SIZE_MAX;\n+}\n+\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -33,11 +33,0 @@\n-static size_t address_space_limit() {\n-  size_t limit = 0;\n-\n-  if (os::has_allocatable_memory_limit(&limit)) {\n-    return limit;\n-  }\n-\n-  \/\/ No limit\n-  return SIZE_MAX;\n-}\n-\n@@ -46,1 +35,1 @@\n-  const size_t limit = address_space_limit() \/ MaxVirtMemFraction;\n+  const size_t limit = os::address_space_limit() \/ MaxVirtMemFraction;\n@@ -51,1 +40,1 @@\n-  const size_t limit = address_space_limit();\n+  const size_t limit = os::address_space_limit();\n","filename":"src\/hotspot\/share\/gc\/z\/zAddressSpaceLimit.cpp","additions":2,"deletions":13,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -452,0 +452,2 @@\n+  static size_t address_space_limit();\n+\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}