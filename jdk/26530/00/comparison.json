{"files":[{"patch":"@@ -736,11 +736,4 @@\n-  struct rlimit rlim;\n-  int getrlimit_res = getrlimit(RLIMIT_AS, &rlim);\n-  \/\/ if there was an error when calling getrlimit, assume that there is no limitation\n-  \/\/ on virtual memory.\n-  bool result;\n-  if ((getrlimit_res != 0) || (rlim.rlim_cur == RLIM_INFINITY)) {\n-    result = false;\n-  } else {\n-    *limit = (size_t)rlim.rlim_cur;\n-    result = true;\n-  }\n+  \/\/ On POSIX systems, the amount of allocatable memory is limited by the\n+  \/\/ size of the virtual address space.\n+  bool result = has_limited_virtual_address_space(limit);\n+\n@@ -799,0 +792,19 @@\n+bool os::has_limited_virtual_address_space(size_t* limit) {\n+  struct rlimit rlim;\n+  int getrlimit_res = getrlimit(RLIMIT_AS, &rlim);\n+\n+  \/\/ If there was an error calling getrlimit, conservatively assume no limit.\n+  if (getrlimit_res != 0) {\n+    return false;\n+  }\n+\n+  \/\/ If the current limit is not infinity, there is a limit.\n+  if (rlim.rlim_cur != RLIM_INFINITY) {\n+    *limit = (size_t)rlim.rlim_cur;\n+    return true;\n+  }\n+\n+  \/\/ No limit\n+  return false;\n+}\n+\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":23,"deletions":11,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -908,0 +908,5 @@\n+bool os::has_limited_virtual_address_space(size_t* limit) {\n+  \/\/ Virtual address space cannot be limited on Windows.\n+  return false;\n+}\n+\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -36,1 +36,1 @@\n-  if (os::has_allocatable_memory_limit(&limit)) {\n+  if (os::has_limited_virtual_address_space(&limit)) {\n","filename":"src\/hotspot\/share\/gc\/z\/zAddressSpaceLimit.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -452,0 +452,2 @@\n+  static bool has_limited_virtual_address_space(size_t* limit);\n+\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}