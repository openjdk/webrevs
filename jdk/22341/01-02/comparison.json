{"files":[{"patch":"@@ -3422,2 +3422,1 @@\n-  assert_different_registers(r_sub_klass, r_super_klass, temp1, temp2, temp3, temp4, result, Z_R1_scratch, Z_R0_scratch);\n-  \/\/ Z_R0 will be only used in debug builds for slot value varification.\n+  assert_different_registers(r_sub_klass, r_super_klass, temp1, temp2, temp3, temp4, result, Z_R1_scratch);\n@@ -3445,3 +3444,0 @@\n-#ifdef ASSERT\n-  z_lgr(Z_R0, slot);\n-#endif \/\/ ASSERT\n@@ -3477,9 +3473,14 @@\n-  \/\/ restore the value of slot\n-  z_xilf(slot, (u1)(Klass::SECONDARY_SUPERS_TABLE_SIZE - 1)); \/\/ slot ^ 63 === 63 - slot (mod 64)\n-#ifdef ASSERT\n-  NearLabel ok;\n-  z_cgr(slot, Z_R0);\n-  z_bre(ok);\n-  stop(\"slot value got corrupted\");\n-  bind(ok);\n-#endif \/\/ ASSERT\n+  \/\/ Note: this is a small hack:\n+  \/\/\n+  \/\/ The operation \"(slot ^ 63) === 63 - slot (mod 64)\" has already been performed above.\n+  \/\/ Since we lack a rotate-right instruction, we achieve the same effect by rotating left\n+  \/\/ by \"64 - slot\" positions. This produces the result equivalent to a right rotation by \"slot\" positions.\n+  \/\/\n+  \/\/ => initial slot value\n+  \/\/ => slot = 63 - slot        \/\/ done above with that z_xilf instruction\n+  \/\/ => slot = 64 - slot        \/\/ need to do for rotating right by \"slot\" positions\n+  \/\/ => slot = 64 - (63 - slot)\n+  \/\/ => slot = slot - 63 + 64\n+  \/\/ => slot = slot + 1\n+  \/\/\n+  \/\/ So instead of rotating-left by 64-slot times, we can, for now, just rotate left by slot+1 and it would be fine.\n@@ -3489,6 +3490,1 @@\n-\n-  \/\/ below, we just want to subtract slot from 64, because we don't have a rotate right instruction.\n-  \/\/ Oh, also we don't have instruction to do : 64 - slot\n-  \/\/ So, negate slot and add 64 to it. i.e. 64 + (-slot)\n-  z_lngr(slot, slot); \/\/ slot = -slot\n-  z_aghi(slot, 64); \/\/ slot = slot + 64\n+  z_aghi(slot, 1); \/\/ slot = slot + 1\n","filename":"src\/hotspot\/cpu\/s390\/macroAssembler_s390.cpp","additions":16,"deletions":20,"binary":false,"changes":36,"status":"modified"}]}