{"files":[{"patch":"@@ -2462,1 +2462,1 @@\n-        BigDecimal thisAbs = this.abs(), resAbs = result.abs();\n+        BigDecimal rad = this.abs(), resAbs = result.abs();\n@@ -2472,0 +2472,5 @@\n+        if (n < 0) {\n+            n = -n;\n+            rad = ONE.divide(rad, result.scale * n, RoundingMode.DOWN);\n+        }\n+\n@@ -2484,2 +2489,2 @@\n-                resAbs.pow(n).compareTo(thisAbs)     <= 0 &&\n-                neighborUp.pow(n).compareTo(thisAbs) > 0:\n+                resAbs.pow(n).compareTo(rad)     <= 0 &&\n+                neighborUp.pow(n).compareTo(rad) > 0:\n@@ -2492,2 +2497,2 @@\n-                resAbs.pow(n).compareTo(thisAbs)       >= 0 &&\n-                neighborDown.pow(n).compareTo(thisAbs) < 0:\n+                resAbs.pow(n).compareTo(rad)       >= 0 &&\n+                neighborDown.pow(n).compareTo(rad) < 0:\n@@ -2501,3 +2506,3 @@\n-            BigDecimal err = resAbs.pow(n).subtract(thisAbs).abs();\n-            BigDecimal errUp = neighborUp.pow(n).subtract(thisAbs);\n-            BigDecimal errDown =  thisAbs.subtract(neighborDown.pow(n));\n+            BigDecimal err = resAbs.pow(n).subtract(rad).abs();\n+            BigDecimal errUp = neighborUp.pow(n).subtract(rad);\n+            BigDecimal errDown =  rad.subtract(neighborDown.pow(n));\n","filename":"src\/java.base\/share\/classes\/java\/math\/BigDecimal.java","additions":13,"deletions":8,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -218,5 +218,7 @@\n-        BigDecimal[] errCases = {\n-                \/\/ (strippedScale & 1) != 0\n-                BigDecimal.TEN,\n-                \/\/ (strippedScale & 1) == 0 && !stripped.isPowerOfTen() && sqrtRem[1].signum != 0\n-                BigDecimal.TWO,\n+        Object[][] errCases = {\n+                \/\/ strippedScale % n != 0\n+                { BigDecimal.TEN, 2 },\n+                \/\/ strippedScale % n == 0 && sqrtRem[1].signum != 0\n+                { BigDecimal.TWO, 2 },\n+                \/\/ sqrtRem[1].signum == 0 && n < 0\n+                { BigDecimal.valueOf(9L), -2 },\n@@ -225,1 +227,3 @@\n-        for (BigDecimal input : errCases) {\n+        for (Object[] errCase : errCases) {\n+            BigDecimal input = (BigDecimal) errCase[0];\n+            int n = (int) errCase[1];\n@@ -229,2 +233,3 @@\n-                result = input.sqrt(unnecessary);\n-                System.err.println(\"Unexpected sqrt with UNNECESSARY RoundingMode: (\" + input + \").sqrt() = \" + result);\n+                result = input.rootn(n, unnecessary);\n+                System.err.println(\"Unexpected nth root with UNNECESSARY RoundingMode: (\"\n+                + input + \").rootn(\" + n + \") = \" + result);\n@@ -238,2 +243,3 @@\n-                result = input.sqrt(arbitrary);\n-                System.err.println(\"Unexpected sqrt with mc.precision == 0: (\" + input + \").sqrt() = \" + result);\n+                result = input.rootn(n, arbitrary);\n+                System.err.println(\"Unexpected nth root with mc.precision == 0: (\"\n+                + input + \").rootn(\" + n + \") = \" + result);\n@@ -246,1 +252,1 @@\n-        \/\/ (strippedScale & 1) == 0\n+        \/\/ strippedScale % n == 0\n@@ -248,1 +254,1 @@\n-        \/\/ !stripped.isPowerOfTen() && sqrtRem[1].signum == 0 && (mc.precision != 0 && result.precision() > mc.precision)\n+        \/\/ sqrtRem[1].signum == 0 && n > 0 && (mc.precision != 0 && result.precision() > mc.precision)\n@@ -259,1 +265,1 @@\n-        BigDecimal four = BigDecimal.valueOf(4);\n+        BigDecimal four = BigDecimal.valueOf(4), oneHalf = BigDecimal.valueOf(5, 1);\n@@ -261,11 +267,7 @@\n-                \/\/ stripped.isPowerOfTen() && mc.roundingMode == RoundingMode.UNNECESSARY\n-                { BigDecimal.ONE, unnecessary, BigDecimal.ONE },\n-                \/\/ stripped.isPowerOfTen() && mc.roundingMode != RoundingMode.UNNECESSARY && mc.precision == 0\n-                { BigDecimal.ONE, arbitrary, BigDecimal.ONE },\n-                \/\/ !stripped.isPowerOfTen() && mc.roundingMode == RoundingMode.UNNECESSARY\n-                \/\/ && sqrtRem[1].signum == 0 && mc.precision == 0\n-                { four, new MathContext(0, RoundingMode.UNNECESSARY), BigDecimal.TWO },\n-                \/\/ !stripped.isPowerOfTen() && mc.roundingMode != RoundingMode.UNNECESSARY\n-                \/\/ && sqrtRem[1].signum == 0 && mc.precision == 0\n-                { four, arbitrary, BigDecimal.TWO },\n-                \/\/ !stripped.isPowerOfTen() && sqrtRem[1].signum == 0\n+                \/\/ mc.roundingMode == RoundingMode.UNNECESSARY && sqrtRem[1].signum == 0 && n > 0\n+                \/\/ && mc.precision == 0\n+                { four, 2, new MathContext(0, RoundingMode.UNNECESSARY), BigDecimal.TWO },\n+                \/\/ mc.roundingMode != RoundingMode.UNNECESSARY && sqrtRem[1].signum == 0 && n > 0\n+                \/\/ && mc.precision == 0\n+                { four, 2, arbitrary, BigDecimal.TWO },\n+                \/\/ sqrtRem[1].signum == 0 && n > 0\n@@ -273,1 +275,6 @@\n-                { four, unnecessary, BigDecimal.TWO },\n+                { four, 2, unnecessary, BigDecimal.TWO },\n+                \/\/ mc.roundingMode == RoundingMode.UNNECESSARY && sqrtRem[1].signum == 0 && n < 0\n+                { four, -2, unnecessary, oneHalf },\n+                \/\/ mc.roundingMode != RoundingMode.UNNECESSARY && sqrtRem[1].signum == 0 && n < 0\n+                \/\/ && mc.precision == 0\n+                { four, -2, arbitrary, oneHalf },\n@@ -277,2 +284,2 @@\n-            BigDecimal expected = (BigDecimal) testCase[2];\n-            BigDecimal result = ((BigDecimal) testCase[0]).sqrt((MathContext) testCase[1]);\n+            BigDecimal expected = (BigDecimal) testCase[3];\n+            BigDecimal result = ((BigDecimal) testCase[0]).rootn((int) testCase[1], (MathContext) testCase[2]);\n","filename":"test\/jdk\/java\/math\/BigDecimal\/SquareRootTests.java","additions":34,"deletions":27,"binary":false,"changes":61,"status":"modified"}]}