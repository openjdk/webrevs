{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,2 +24,2 @@\n-\/* @test\n- * @bug 8011536 8151430 8316304\n+\/* @test id=tmp\n+ * @bug 8011536 8151430 8316304 8334339\n@@ -27,1 +27,1 @@\n- *     that support it.\n+ *     that support it, test directory is \/tmp.\n@@ -33,0 +33,10 @@\n+\/* @test id=cwd\n+ * @bug 8011536 8151430 8316304 8334339\n+ * @summary Basic test for creationTime attribute on platforms\/file systems\n+ *     that support it, test directory is JTwork\/scratch. The JTwork\/scratch\n+ *     directory maybe at diff disk partition to \/tmp on linux\n+ * @library  ..\/.. \/test\/lib\n+ * @build jdk.test.lib.Platform\n+ * @run main CreationTime .\n+ *\/\n+\n@@ -38,0 +48,1 @@\n+import java.io.BufferedReader;\n@@ -39,0 +50,1 @@\n+import java.io.InputStreamReader;\n@@ -41,0 +53,1 @@\n+import jtreg.SkippedException;\n@@ -62,0 +75,18 @@\n+    \/**\n+     * read the output of linux command `stat -c \"%w\" file`, if the output is \"-\",\n+     * then the file system doesn't support birth time\n+     *\/\n+    public static boolean supportBirthTimeOnLinux(Path file) {\n+        try {\n+            String filePath = file.toAbsolutePath().toString();\n+            ProcessBuilder pb = new ProcessBuilder(\"stat\", \"-c\", \"%w\", filePath);\n+            pb.redirectErrorStream(true);\n+            Process p = pb.start();\n+            BufferedReader b = new BufferedReader(new InputStreamReader(p.getInputStream()));\n+            String l = b.readLine();\n+            if (l != null && l.equals(\"-\")) { return false; }\n+        } catch(Exception e) {\n+        }\n+        return true;\n+    }\n+\n@@ -71,2 +102,7 @@\n-            err.println(\"File creation time reported as: \" + creationTime);\n-            throw new RuntimeException(\"Expected to be close to: \" + now);\n+            System.out.println(\"creationTime.toMillis() == \" + creationTime.toMillis());\n+            if(0 == creationTime.toMillis() && Platform.isLinux() && !supportBirthTimeOnLinux(file) ) {\n+                throw new SkippedException(\"birth time not support for: \" + file);\n+            } else {\n+                err.println(\"File creation time reported as: \" + creationTime);\n+                throw new RuntimeException(\"Expected to be close to: \" + now);\n+            }\n@@ -98,1 +134,1 @@\n-        System.out.println(\"supportsCreationTimeRead == \" + supportsCreationTimeRead);\n+        System.out.println(top + \" supportsCreationTimeRead == \" + supportsCreationTimeRead);\n@@ -130,1 +166,6 @@\n-        Path dir = TestUtil.createTemporaryDirectory();\n+        Path dir;\n+        if(0 == args.length) {\n+            dir = TestUtil.createTemporaryDirectory();\n+        } else {\n+            dir = TestUtil.createTemporaryDirectory(args[0]);\n+        }\n","filename":"test\/jdk\/java\/nio\/file\/attribute\/BasicFileAttributeView\/CreationTime.java","additions":49,"deletions":8,"binary":false,"changes":57,"status":"modified"}]}