{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,0 +56,1 @@\n+import java.util.concurrent.CountDownLatch;\n@@ -66,2 +67,2 @@\n-    private final Object lock = new Object();\n-    private boolean unreferencedInvoked = false;\n+    \/\/ will be counted down when Unreferenced.unreferenced() is invoked\n+    private static final CountDownLatch callbackInvocationLatch = new CountDownLatch(1);\n@@ -72,4 +73,1 @@\n-        synchronized (lock) {\n-            unreferencedInvoked = true;\n-            lock.notify();\n-        }\n+        callbackInvocationLatch.countDown();\n@@ -102,18 +100,8 @@\n-            synchronized (obj.lock) {\n-                System.err.println(\"starting remote client VM...\");\n-                jvm = new JavaVM(\"SelfTerminator\", \"-Drmi.registry.port=\" +\n-                            registryPort, outputFile.toAbsolutePath().toString());\n-                \/\/ launch the self terminating java application which will lookup\n-                \/\/ the bound object and then terminate itself. before terminating\n-                \/\/ it will write the time at which it is terminating, into the\n-                \/\/ output file\n-                jvm.start();\n-\n-                do {\n-                    System.err.println(\"waiting for unreferenced() callback...\");\n-                    obj.lock.wait();\n-                } while (!obj.unreferencedInvoked); \/\/ repeat the loop to take into account\n-                                                    \/\/ spurious wakeups\n-                Instant waitEndedAt = Instant.now();\n-                \/\/ should never happen\n-                assert obj.unreferencedInvoked : \"unreference() not invoked\";\n+            System.err.println(\"starting remote client VM...\");\n+            jvm = new JavaVM(\"SelfTerminator\", \"-Drmi.registry.port=\" +\n+                        registryPort, outputFile.toAbsolutePath().toString());\n+            \/\/ launch the self terminating java application which will lookup\n+            \/\/ the bound object and then terminate itself. before terminating\n+            \/\/ it will write the time at which it is terminating, into the\n+            \/\/ output file\n+            jvm.start();\n@@ -121,16 +109,18 @@\n-                final String content = Files.readString(outputFile);\n-                System.err.println(\"content in \" + outputFile + \": \" + content);\n-                \/\/ parse the time, representing the time at which the SelfTerminator\n-                \/\/ application termination started\n-                final Instant terminationStartedAt = Instant.parse(content);\n-                final Duration waitDuration = Duration.between(terminationStartedAt,\n-                        waitEndedAt);\n-                System.out.println(\"wait completed in \" + waitDuration);\n-                if (waitDuration.compareTo(EXPECTED_MAX_DURATION) > 0) {\n-                    throw new RuntimeException(\"Took unexpectedly long (duration=\" +\n-                            waitDuration + \") to invoke Unreferenced.unreferenced(),\" +\n-                            \" expected max duration=\" + EXPECTED_MAX_DURATION);\n-                } else {\n-                    System.err.println(\"TEST PASSED: unreferenced() invoked in timely\" +\n-                            \" fashion (duration=\" + waitDuration + \")\");\n-                }\n+            System.err.println(\"waiting for unreferenced() callback...\");\n+            callbackInvocationLatch.await();\n+            Instant waitEndedAt = Instant.now();\n+            final String content = Files.readString(outputFile);\n+            System.err.println(\"content in \" + outputFile + \": \" + content);\n+            \/\/ parse the time, representing the time at which the SelfTerminator\n+            \/\/ application termination started\n+            final Instant terminationStartedAt = Instant.parse(content);\n+            final Duration waitDuration = Duration.between(terminationStartedAt,\n+                    waitEndedAt);\n+            System.out.println(\"wait completed in \" + waitDuration);\n+            if (waitDuration.compareTo(EXPECTED_MAX_DURATION) > 0) {\n+                throw new RuntimeException(\"Took unexpectedly long (duration=\" +\n+                        waitDuration + \") to invoke Unreferenced.unreferenced(),\" +\n+                        \" expected max duration=\" + EXPECTED_MAX_DURATION);\n+            } else {\n+                System.err.println(\"TEST PASSED: unreferenced() invoked in timely\" +\n+                        \" fashion (duration=\" + waitDuration + \")\");\n","filename":"test\/jdk\/java\/rmi\/server\/Unreferenced\/leaseCheckInterval\/LeaseCheckInterval.java","additions":31,"deletions":41,"binary":false,"changes":72,"status":"modified"}]}