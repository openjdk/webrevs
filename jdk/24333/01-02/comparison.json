{"files":[{"patch":"@@ -25,1 +25,1 @@\n- * @test \n+ * @test\n@@ -72,1 +72,1 @@\n-          \n+\n@@ -113,1 +113,0 @@\n-    static boolean verifyErrorThrown = false;\n@@ -118,23 +117,0 @@\n-\n-        \/\/ double check our class hasn't been loaded yet\n-        for (Class clazz : inst.getAllLoadedClasses()) {\n-            if (clazz.getName().equals(CLASS_TO_BREAK)) {\n-                throw new AssertionError(\"Oops! Class \" + CLASS_TO_BREAK + \" is already loaded, the test can't work\");\n-            }\n-        }\n-\n-        boolean retransform = Boolean.getBoolean(\"agent.retransform\");\n-        if (retransform) {\n-            \/\/ for the bug the class we call must be already loaded, so that we retransform it\n-            var clazz = Class.forName(CLASS_TO_BREAK);\n-            try {\n-                 inst.addTransformer(new BadTransformer(), true);\n-                 inst.retransformClasses(clazz);\n-             } catch (VerifyError ve) {\n-                 System.out.println(\"Passed: threw VerifyError during retransform\");\n-                 verifyErrorThrown = true;\n-             }\n-        } else {\n-            \/\/ no verify error, the class is used in TestMain\n-            inst.addTransformer(new BadTransformer());\n-        }\n@@ -167,1 +143,1 @@\n-    public static void main(String argv[]) {\n+    public static void main(String argv[]) throws Exception {\n@@ -173,0 +149,9 @@\n+        \/\/ double check our class hasn't been loaded yet\n+        for (Class clazz : inst.getAllLoadedClasses()) {\n+            if (clazz.getName().equals(CLASS_TO_BREAK)) {\n+                throw new AssertionError(\"Oops! Class \" + CLASS_TO_BREAK + \" is already loaded, the test can't work\");\n+            }\n+        }\n+\n+        boolean retransform = Boolean.getBoolean(\"agent.retransform\");\n+\n@@ -174,4 +159,9 @@\n-            \/\/ Now load the class for the VerifyError.\n-            System.out.println(\"1 hour is \" + Duration.ofHours(1).getSeconds() + \" seconds\");\n-            if (!verifyErrorThrown) {\n-                throw new RuntimeException(\"Failed: Did not throw VerifyError\");\n+            if (retransform) {\n+                \/\/ Retransform the class for the VerifyError.\n+                var clazz = Class.forName(CLASS_TO_BREAK);\n+                inst.addTransformer(new BadTransformer(), true);\n+                inst.retransformClasses(clazz);\n+            } else {\n+                \/\/ Load the class instrumented with CFLH for the VerifyError.\n+                inst.addTransformer(new BadTransformer());\n+                System.out.println(\"1 hour is \" + Duration.ofHours(1).getSeconds() + \" seconds\");\n@@ -179,0 +169,1 @@\n+            throw new RuntimeException(\"Failed: Did not throw VerifyError\");\n","filename":"test\/hotspot\/jtreg\/runtime\/verifier\/CFLH\/TestVerify.java","additions":22,"deletions":31,"binary":false,"changes":53,"status":"modified"}]}