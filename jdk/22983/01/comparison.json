{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,0 @@\n-        removePathEnvVar = false;\n@@ -89,2 +88,2 @@\n-    public Executor setRemovePathEnvVar(boolean value) {\n-        removePathEnvVar = value;\n+    public Executor removeEnvVar(String envVarName) {\n+        removeEnvVars.add(Objects.requireNonNull(envVarName));\n@@ -375,4 +374,6 @@\n-        if (removePathEnvVar) {\n-            \/\/ run this with cleared Path in Environment\n-            TKit.trace(\"Clearing PATH in environment\");\n-            builder.environment().remove(\"PATH\");\n+        if (!removeEnvVars.isEmpty()) {\n+            final var envComm = Comm.compare(builder.environment().keySet(), removeEnvVars);\n+            builder.environment().keySet().removeAll(envComm.common());\n+            envComm.common().forEach(envVar -> {\n+                TKit.trace(String.format(\"Clearing %s in environment\", envVar));\n+            });\n@@ -507,1 +508,1 @@\n-    private boolean removePathEnvVar;\n+    private Set<String> removeEnvVars = new HashSet<>();\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/Executor.java","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -475,2 +475,1 @@\n-            final List<String> launcherArgs = List.of(args);\n-            return new Executor()\n+            final var executor = new Executor()\n@@ -480,1 +479,0 @@\n-                    .setRemovePathEnvVar(removePathEnvVar)\n@@ -482,1 +480,3 @@\n-                    .addArguments(launcherArgs);\n+                    .addArguments(List.of(args));\n+\n+            return configureEnvironment(executor);\n@@ -499,0 +499,8 @@\n+    public static Executor configureEnvironment(Executor executor) {\n+        if (CLEAR_JAVA_ENV_VARS) {\n+            executor.removeEnvVar(\"JAVA_TOOL_OPTIONS\");\n+            executor.removeEnvVar(\"_JAVA_OPTIONS\");\n+        }\n+        return executor;\n+    }\n+\n@@ -508,0 +516,3 @@\n+\n+    private static final boolean CLEAR_JAVA_ENV_VARS = Optional.ofNullable(\n+            TKit.getConfigProperty(\"clear-app-launcher-java-env-vars\")).map(Boolean::parseBoolean).orElse(false);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/HelloApp.java","additions":16,"deletions":5,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import static jdk.jpackage.test.HelloApp.configureEnvironment;\n@@ -56,0 +57,1 @@\n+                .ignoreFakeRuntime()\n@@ -65,1 +67,1 @@\n-        List<String> output = new Executor()\n+        List<String> output = configureEnvironment(new Executor())\n","filename":"test\/jdk\/tools\/jpackage\/share\/AppLauncherEnvTest.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,0 +43,1 @@\n+import static jdk.jpackage.test.HelloApp.configureEnvironment;\n@@ -57,1 +58,2 @@\n-                    .helloAppImage(TEST_APP_JAVA + \"*Hello\");\n+                    .helloAppImage(TEST_APP_JAVA + \"*Hello\")\n+                    .ignoreFakeRuntime();\n@@ -64,1 +66,1 @@\n-            List<String> output = new Executor().saveOutput().dumpOutput()\n+            List<String> output = configureEnvironment(new Executor()).saveOutput().dumpOutput()\n","filename":"test\/jdk\/tools\/jpackage\/windows\/WinChildProcessTest.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"}]}