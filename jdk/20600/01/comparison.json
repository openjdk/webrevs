{"files":[{"patch":"@@ -1022,0 +1022,4 @@\n+\/\/ For dynamic lookup of GetTempPath2 API\n+typedef DWORD (WINAPI *GetTempPath2AFnPtr)(DWORD, LPSTR);\n+static GetTempPath2AFnPtr _GetTempPath2A = nullptr;\n+\n@@ -1518,4 +1522,5 @@\n-  if (GetTempPath(MAX_PATH, path_buf) > 0) {\n-    return path_buf;\n-  } else {\n-    path_buf[0] = '\\0';\n+  if (_GetTempPath2A != nullptr) {\n+    if (_GetTempPath2A(MAX_PATH, path_buf) > 0) {\n+      return path_buf;\n+    }\n+  } else if (GetTempPath(MAX_PATH, path_buf) > 0) {\n@@ -1524,0 +1529,2 @@\n+  path_buf[0] = '\\0';\n+  return path_buf;\n@@ -4714,0 +4721,8 @@\n+  \/\/ Lookup GetTempPath2\n+  if (_kernelbase != nullptr) {\n+    _GetTempPath2A =\n+      reinterpret_cast<GetTempPath2AFnPtr>(\n+                                         GetProcAddress(_kernelbase,\n+                                                        \"GetTempPath2A\"));\n+  }\n+  log_info(os, thread)(\"The _GetTempPath2A API is%s available.\", _GetTempPath2A == nullptr ? \" not\" : \"\");\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -324,0 +324,20 @@\n+\/\/ For dynamic lookup of GetTempPath2 API\n+typedef DWORD (WINAPI *GetTempPath2WFnPtr)(DWORD, LPWSTR);\n+static GetTempPath2WFnPtr _GetTempPath2W = NULL;\n+static BOOL _GetTempPath2WInitialized = FALSE;\n+\n+DWORD _GetTempPathW(DWORD nBufferLength, LPWSTR lpBuffer)\n+{\n+    if (!_GetTempPath2WInitialized) {\n+        HINSTANCE _kernelbase = LoadLibrary(TEXT(\"kernelbase.dll\"));\n+        if (_kernelbase != NULL) {\n+            _GetTempPath2W = (GetTempPath2WFnPtr)GetProcAddress(_kernelbase, \"GetTempPath2W\");\n+        }\n+        _GetTempPath2WInitialized = TRUE;\n+    }\n+    if (_GetTempPath2W != NULL) {\n+        return _GetTempPath2W(nBufferLength, lpBuffer);\n+    }\n+    return GetTempPathW(nBufferLength, lpBuffer);\n+}\n+\n@@ -342,1 +362,1 @@\n-        GetTempPathW(MAX_PATH + 1, tmpdir);\n+        _GetTempPathW(MAX_PATH + 1, tmpdir);\n","filename":"src\/java.base\/windows\/native\/libjava\/java_props_md.c","additions":21,"deletions":1,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -35,0 +35,20 @@\n+\/\/ For dynamic lookup of GetTempPath2 API\n+typedef DWORD (WINAPI *GetTempPath2AFnPtr)(DWORD, LPSTR);\n+static GetTempPath2AFnPtr _GetTempPath2A = NULL;\n+static BOOL _GetTempPath2AInitialized = FALSE;\n+\n+DWORD _GetTempPathA(DWORD nBufferLength, LPSTR lpBuffer)\n+{\n+    if (!_GetTempPath2AInitialized) {\n+        HINSTANCE _kernelbase = LoadLibrary(TEXT(\"kernelbase.dll\"));\n+        if (_kernelbase != NULL) {\n+            _GetTempPath2A = (GetTempPath2AFnPtr)GetProcAddress(_kernelbase, \"GetTempPath2A\");\n+        }\n+        _GetTempPath2AInitialized = TRUE;\n+    }\n+    if (_GetTempPath2A != NULL) {\n+        return _GetTempPath2A(nBufferLength, lpBuffer);\n+    }\n+    return GetTempPathA(nBufferLength, lpBuffer);\n+}\n+\n@@ -48,1 +68,1 @@\n-    actualLen = GetTempPath(bufLen, buf);\n+    actualLen = _GetTempPathA(bufLen, buf);\n@@ -54,1 +74,1 @@\n-            actualLen = GetTempPath(actualLen, bufP);\n+            actualLen = _GetTempPathA(actualLen, bufP);\n","filename":"src\/jdk.attach\/windows\/native\/libattach\/AttachProviderImpl.c","additions":22,"deletions":2,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -35,0 +35,22 @@\n+\/\/ For dynamic lookup of GetTempPath2 API\n+typedef DWORD (WINAPI *GetTempPath2WFnPtr)(DWORD, LPWSTR);\n+static GetTempPath2WFnPtr _GetTempPath2W = nullptr;\n+static bool _GetTempPath2WInitialized = false;\n+\n+DWORD _GetTempPathW(DWORD nBufferLength, LPWSTR lpBuffer)\n+{\n+    if (!_GetTempPath2WInitialized) {\n+        HINSTANCE _kernelbase = LoadLibrary(TEXT(\"kernelbase.dll\"));\n+        if (_kernelbase != nullptr) {\n+            _GetTempPath2W =\n+                reinterpret_cast<GetTempPath2WFnPtr>(\n+                    GetProcAddress(_kernelbase, \"GetTempPath2W\"));\n+        }\n+        _GetTempPath2WInitialized = true;\n+    }\n+    if (_GetTempPath2W != nullptr) {\n+        return _GetTempPath2W(nBufferLength, lpBuffer);\n+    }\n+    return GetTempPathW(nBufferLength, lpBuffer);\n+}\n+\n@@ -39,1 +61,1 @@\n-    DWORD res = GetTempPath(static_cast<DWORD>(buffer.size()), buffer.data());\n+    DWORD res = _GetTempPathW(static_cast<DWORD>(buffer.size()), buffer.data());\n@@ -42,1 +64,1 @@\n-        GetTempPath(static_cast<DWORD>(buffer.size()), buffer.data());\n+        _GetTempPathW(static_cast<DWORD>(buffer.size()), buffer.data());\n","filename":"src\/jdk.jpackage\/windows\/native\/common\/WinSysInfo.cpp","additions":24,"deletions":2,"binary":false,"changes":26,"status":"modified"}]}