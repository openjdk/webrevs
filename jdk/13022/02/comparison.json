{"files":[{"patch":"@@ -840,5 +840,0 @@\n-  FailedSpeculation* fs = new (fs_size) FailedSpeculation(speculation, speculation_len);\n-  if (fs == nullptr) {\n-    \/\/ no memory -> ignore failed speculation\n-    return false;\n-  }\n@@ -846,1 +841,0 @@\n-  guarantee(is_aligned(fs, sizeof(FailedSpeculation*)), \"FailedSpeculation objects must be pointer aligned\");\n@@ -850,0 +844,1 @@\n+  FailedSpeculation* fs = nullptr;\n@@ -852,0 +847,9 @@\n+      if (fs == nullptr) {\n+        \/\/ lazily allocate FailedSpeculation\n+        fs = new (fs_size) FailedSpeculation(speculation, speculation_len);\n+        if (fs == nullptr) {\n+          \/\/ no memory -> ignore failed speculation\n+          return false;\n+        }\n+        guarantee(is_aligned(fs, sizeof(FailedSpeculation*)), \"FailedSpeculation objects must be pointer aligned\");\n+      }\n@@ -857,3 +861,0 @@\n-      cursor = old_fs->next_adr();\n-    } else {\n-      cursor = (*cursor)->next_adr();\n@@ -861,0 +862,9 @@\n+    guarantee(*cursor != nullptr, \"cursor must point to non-null FailedSpeculation\");\n+    \/\/ check if the current entry matches this thread's failed speculation\n+    if ((*cursor)->data_len() == speculation_len && memcmp(speculation, (*cursor)->data(), speculation_len) == 0) {\n+      if (fs != nullptr) {\n+        delete fs;\n+      }\n+      return false;\n+    }\n+    cursor = (*cursor)->next_adr();\n","filename":"src\/hotspot\/share\/oops\/methodData.cpp","additions":19,"deletions":9,"binary":false,"changes":28,"status":"modified"}]}