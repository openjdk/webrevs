{"files":[{"patch":"@@ -839,9 +839,0 @@\n-\n-  FailedSpeculation** cursor = failed_speculations_address;\n-  while (*cursor != nullptr) {\n-    if ((*cursor)->data_len() == speculation_len && memcmp(speculation, (*cursor)->data(), speculation_len) == 0) {\n-      return false;\n-    }\n-    cursor = (*cursor)->next_adr();\n-  }\n-\n@@ -849,5 +840,0 @@\n-  FailedSpeculation* fs = new (fs_size) FailedSpeculation(speculation, speculation_len);\n-  if (fs == nullptr) {\n-    \/\/ no memory -> ignore failed speculation\n-    return false;\n-  }\n@@ -855,1 +841,0 @@\n-  guarantee(is_aligned(fs, sizeof(FailedSpeculation*)), \"FailedSpeculation objects must be pointer aligned\");\n@@ -858,0 +843,2 @@\n+  FailedSpeculation** cursor = failed_speculations_address;\n+  FailedSpeculation* fs = nullptr;\n@@ -860,0 +847,9 @@\n+      if (fs == nullptr) {\n+        \/\/ lazily allocate FailedSpeculation\n+        fs = new (fs_size) FailedSpeculation(speculation, speculation_len);\n+        if (fs == nullptr) {\n+          \/\/ no memory -> ignore failed speculation\n+          return false;\n+        }\n+        guarantee(is_aligned(fs, sizeof(FailedSpeculation*)), \"FailedSpeculation objects must be pointer aligned\");\n+      }\n@@ -865,3 +861,0 @@\n-      cursor = old_fs->next_adr();\n-    } else {\n-      cursor = (*cursor)->next_adr();\n@@ -869,0 +862,9 @@\n+    guarantee(*cursor != nullptr, \"cursor must point to non-null FailedSpeculation\");\n+    \/\/ check if the current entry matches this thread's failed speculation\n+    if ((*cursor)->data_len() == speculation_len && memcmp(speculation, (*cursor)->data(), speculation_len) == 0) {\n+      if (fs != nullptr) {\n+        delete fs;\n+      }\n+      return false;\n+    }\n+    cursor = (*cursor)->next_adr();\n","filename":"src\/hotspot\/share\/oops\/methodData.cpp","additions":20,"deletions":18,"binary":false,"changes":38,"status":"modified"}]}