{"files":[{"patch":"@@ -26,1 +26,1 @@\n- * @bug 6797535 6889858 6891113 8013712 8011800 8014365 8280168\n+ * @bug 6797535 6889858 6891113 8013712 8011800 8014365 8280168 8373661\n@@ -28,0 +28,1 @@\n+ * @run junit BasicObjectsTest\n@@ -30,2 +31,13 @@\n-import java.util.*;\n-import java.util.function.*;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertSame;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import org.junit.jupiter.api.Test;\n+import java.util.Arrays;\n+import java.util.Objects;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n@@ -34,17 +46,0 @@\n-    public static void main(String... args) {\n-        int errors = 0;\n-        errors += testEquals();\n-        errors += testDeepEquals();\n-        errors += testHashCode();\n-        errors += testHash();\n-        errors += testToString();\n-        errors += testToString2();\n-        errors += testToIdentityString();\n-        errors += testCompare();\n-        errors += testRequireNonNull();\n-        errors += testIsNull();\n-        errors += testNonNull();\n-        errors += testNonNullOf();\n-        if (errors > 0 )\n-            throw new RuntimeException();\n-    }\n@@ -52,2 +47,2 @@\n-    private static int testEquals() {\n-        int errors = 0;\n+    @Test\n+    public void testEquals() {\n@@ -61,5 +56,1 @@\n-                if (result != expected) {\n-                    errors++;\n-                    System.err.printf(\"When equating %s to %s, got %b instead of %b%n.\",\n-                                      a, b, result, expected);\n-                }\n+                assertEquals(expected, result, \"testEquals\");\n@@ -67,1 +58,0 @@\n-        return errors;\n@@ -70,2 +60,2 @@\n-    private static int testDeepEquals() {\n-        int errors = 0;\n+    @Test\n+    public void testDeepEquals() {\n@@ -90,5 +80,1 @@\n-                if (result != expected) {\n-                    errors++;\n-                    System.err.printf(\"When equating %s to %s, got %b instead of %b%n.\",\n-                                      a, b, result, expected);\n-                }\n+                assertEquals(expected, result, \"testDeepEquals\");\n@@ -96,2 +82,0 @@\n-\n-        return errors;\n@@ -100,3 +84,4 @@\n-    private static int testHashCode() {\n-        int errors = 0;\n-        errors += (Objects.hashCode(null) == 0 ) ? 0 : 1;\n+    @Test\n+    public void testHashCode() {\n+        assertEquals(0, Objects.hashCode(null),\n+            \"hashCode(null) should return 0\");\n@@ -104,2 +89,2 @@\n-        errors += (Objects.hashCode(s) == s.hashCode() ) ? 0 : 1;\n-        return errors;\n+        assertEquals(s.hashCode(), Objects.hashCode(s),\n+            \"hashCode(s) should return s.hashCode()\");\n@@ -108,3 +93,2 @@\n-    private static int testHash() {\n-        int errors = 0;\n-\n+    @Test\n+    public void testHash() {\n@@ -113,1 +97,2 @@\n-        errors += ((Objects.hash((Object[])null) == 0) ? 0 : 1);\n+        assertEquals(0, Objects.hash((Object[])null),\n+            \"hash(null) should return 0\");\n@@ -115,4 +100,3 @@\n-        errors += (Objects.hash(\"perfect\", \"ham\", \"THC\") ==\n-                   Arrays.hashCode(data)) ? 0 : 1;\n-\n-        return errors;\n+        assertEquals(Arrays.hashCode(data),\n+                     Objects.hash(\"perfect\", \"ham\", \"THC\"),\n+                     \"hash should match Arrays.hashCode\");\n@@ -121,3 +105,4 @@\n-    private static int testToString() {\n-        int errors = 0;\n-        errors += (\"null\".equals(Objects.toString(null)) ) ? 0 : 1;\n+    @Test\n+    public void testToString() {\n+        assertEquals(\"null\", Objects.toString(null),\n+            \"toString(null) should return 'null'\");\n@@ -125,2 +110,2 @@\n-        errors += (s.equals(Objects.toString(s)) ) ? 0 : 1;\n-        return errors;\n+        assertEquals(s, Objects.toString(s),\n+            \"toString(s) should return s\");\n@@ -129,2 +114,2 @@\n-    private static int testToString2() {\n-        int errors = 0;\n+    @Test\n+    public void testToString2() {\n@@ -132,3 +117,4 @@\n-        errors += (s.equals(Objects.toString(null, s)) ) ? 0 : 1;\n-        errors += (s.equals(Objects.toString(s, \"another string\")) ) ? 0 : 1;\n-        return errors;\n+        assertEquals(s, Objects.toString(null, s),\n+            \"toString(null, default) should return default\");\n+        assertEquals(s, Objects.toString(s, \"another string\"),\n+            \"toString(s, default) should return s when s is not null\");\n@@ -137,2 +123,2 @@\n-    private static int testToIdentityString() {\n-        int errors = 0;\n+    @Test\n+    public void testToIdentityString() {\n@@ -140,6 +126,4 @@\n-        try {\n-            Objects.toIdentityString(null);\n-            errors++;\n-        } catch (NullPointerException npe) {\n-            ; \/\/ Expected\n-        }\n+        assertThrows(NullPointerException.class,\n+            () -> Objects.toIdentityString(null),\n+            \"toIdentityString(null) should throw NullPointerException\");\n+\n@@ -148,1 +132,3 @@\n-        errors += (Objects.toIdentityString(o).equals(o.toString()))? 0 : 1;\n+        assertEquals(o.toString(), Objects.toIdentityString(o),\n+            \"toIdentityString(o) should equal o.toString()\");\n+\n@@ -153,1 +139,2 @@\n-                    throw new RuntimeException();\n+                    fail(\"toString should not be called\");\n+                    return null;\n@@ -156,1 +143,4 @@\n-        Objects.toIdentityString(badToString);\n+        \/\/ Should not throw RuntimeException from toString\n+        assertDoesNotThrow(() -> Objects.toIdentityString(badToString),\n+            \"toIdentityString should not call toString()\");\n+\n@@ -161,1 +151,2 @@\n-                    throw new RuntimeException(\"0xDEADBEFF\");\n+                    fail(\"hashCode should not be called\");\n+                    return 0;\n@@ -164,2 +155,3 @@\n-        Objects.toIdentityString(badHashCode);\n-        return errors;\n+        \/\/ Should not throw RuntimeException from hashCode\n+        assertDoesNotThrow(() -> Objects.toIdentityString(badHashCode),\n+            \"toIdentityString should not call hashCode()\");\n@@ -168,2 +160,2 @@\n-    private static int testCompare() {\n-        int errors = 0;\n+    @Test\n+    public void testCompare() {\n@@ -172,1 +164,1 @@\n-        errors += compareTest(null, null, 0);\n+        compareTest(null, null, 0);\n@@ -175,1 +167,1 @@\n-            errors += compareTest(a, a, 0);\n+            compareTest(a, a, 0);\n@@ -179,1 +171,1 @@\n-                errors += compareTest(a, b, expected);\n+                compareTest(a, b, expected);\n@@ -182,1 +174,0 @@\n-        return errors;\n@@ -185,2 +176,1 @@\n-    private static int compareTest(String a, String b, int expected) {\n-        int errors = 0;\n+    private void compareTest(String a, String b, int expected) {\n@@ -188,6 +178,1 @@\n-        if (Integer.signum(result) != Integer.signum(expected)) {\n-            errors++;\n-            System.err.printf(\"When comparing %s to %s, got %d instead of %d%n.\",\n-                              a, b, result, expected);\n-        }\n-        return errors;\n+        assertEquals(Integer.signum(expected), Integer.signum(result), \"testCompare\");\n@@ -196,3 +181,2 @@\n-    private static int testRequireNonNull() {\n-        int errors = 0;\n-\n+    @Test\n+    public void testRequireNonNull() {\n@@ -207,3 +191,3 @@\n-        errors += testRNN_NonNull(rnn1, RNN_1);\n-        errors += testRNN_NonNull(rnn2, RNN_2);\n-        errors += testRNN_NonNull(rnn3, RNN_3);\n+        testRNN_NonNull(rnn1, RNN_1);\n+        testRNN_NonNull(rnn2, RNN_2);\n+        testRNN_NonNull(rnn3, RNN_3);\n@@ -211,4 +195,3 @@\n-        errors += testRNN_Null(rnn1, RNN_1, null);\n-        errors += testRNN_Null(rnn2, RNN_2, \"trousers\");\n-        errors += testRNN_Null(rnn3, RNN_3, \"trousers\");\n-        return errors;\n+        testRNN_Null(rnn1, RNN_1, null);\n+        testRNN_Null(rnn2, RNN_2, \"trousers\");\n+        testRNN_Null(rnn3, RNN_3, \"trousers\");\n@@ -217,14 +200,5 @@\n-    private static int testRNN_NonNull(Function<String, String> testFunc,\n-                                       String testFuncName) {\n-        int errors = 0;\n-        try {\n-            String s = testFunc.apply(\"pants\");\n-            if (s != \"pants\") {\n-                System.err.printf(testFuncName + \" failed to return its arg\");\n-                errors++;\n-            }\n-        } catch (NullPointerException e) {\n-            System.err.printf(testFuncName + \" threw unexpected NPE\");\n-            errors++;\n-        }\n-        return errors;\n+    private void testRNN_NonNull(Function<String, String> testFunc,\n+                                 String testFuncName) {\n+        String s = testFunc.apply(\"pants\");\n+        assertSame(\"pants\", s,\n+            testFuncName + \" should return its arg\");\n@@ -233,15 +207,9 @@\n-    private static int testRNN_Null(Function<String, String> testFunc,\n-                                    String testFuncName,\n-                                    String expectedMessage) {\n-        int errors = 0;\n-        try {\n-            String s = testFunc.apply(null);\n-            System.err.printf(testFuncName + \" failed to throw NPE\");\n-            errors++;\n-        } catch (NullPointerException e) {\n-            if (e.getMessage() != expectedMessage) {\n-                System.err.printf(testFuncName + \" threw NPE w\/ bad detail msg\");\n-                errors++;\n-            }\n-        }\n-        return errors;\n+    private void testRNN_Null(Function<String, String> testFunc,\n+                              String testFuncName,\n+                              String expectedMessage) {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> testFunc.apply(null),\n+            testFuncName);\n+        assertEquals(expectedMessage, npe.getMessage(),\n+            testFuncName + \" should have correct exception message\");\n@@ -250,7 +218,6 @@\n-    private static int testIsNull() {\n-        int errors = 0;\n-\n-        errors += Objects.isNull(null) ? 0 : 1;\n-        errors += Objects.isNull(Objects.class) ? 1 : 0;\n-\n-        return errors;\n+    @Test\n+    public void testIsNull() {\n+        assertTrue(Objects.isNull(null),\n+            \"isNull(null) should return true\");\n+        assertFalse(Objects.isNull(Objects.class),\n+            \"isNull(Objects.class) should return false\");\n@@ -259,7 +226,6 @@\n-    private static int testNonNull() {\n-        int errors = 0;\n-\n-        errors += Objects.nonNull(null) ? 1 : 0;\n-        errors += Objects.nonNull(Objects.class) ? 0 : 1;\n-\n-        return errors;\n+    @Test\n+    public void testNonNull() {\n+        assertFalse(Objects.nonNull(null),\n+            \"nonNull(null) should return false\");\n+        assertTrue(Objects.nonNull(Objects.class),\n+            \"nonNull(Objects.class) should return true\");\n@@ -268,2 +234,2 @@\n-    private static int testNonNullOf() {\n-        int errors = 0;\n+    @Test\n+    public void testNonNullOf() {\n@@ -276,10 +242,8 @@\n-        errors += (result == defString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElse(nonNullString, defString) == nonNullString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElse(nonNullString, null) == nonNullString) ? 0 : 1;\n-        try {\n-            Objects.requireNonNullElse(null, null);\n-            errors += 1;\n-        } catch (NullPointerException npe) {\n-            \/\/ expected\n-            errors += npe.getMessage().equals(\"defaultObj\") ? 0 : 1;\n-        }\n+        assertSame(defString, result,\n+            \"requireNonNullElse(null, default) should return default\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElse(nonNullString, defString),\n+            \"requireNonNullElse(non-null, default) should return non-null\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElse(nonNullString, null),\n+            \"requireNonNullElse(non-null, null) should return non-null\");\n@@ -287,0 +251,6 @@\n+        NullPointerException npe1 = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElse(null, null),\n+            \"requireNonNullElse(null, null) should throw NPE\");\n+        assertEquals(\"defaultObj\", npe1.getMessage(),\n+            \"Exception message should be 'defaultObj'\");\n@@ -289,19 +259,99 @@\n-        errors += (Objects.requireNonNullElseGet(nullString, () -> defString) == defString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElseGet(nonNullString, () -> defString) == nonNullString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElseGet(nonNullString, () -> null) == nonNullString) ? 0 : 1;\n-\n-        try {\n-            Objects.requireNonNullElseGet(null, () -> null);\n-            errors += 1;\n-        } catch (NullPointerException npe) {\n-            \/\/ expected\n-            errors += npe.getMessage().equals(\"supplier.get()\") ? 0 : 1;\n-        }\n-        try {       \/\/ supplier is null\n-            Objects.requireNonNullElseGet(null, null);\n-            errors += 1;\n-        } catch (NullPointerException npe) {\n-            \/\/ expected\n-            errors += npe.getMessage().equals(\"supplier\") ? 0 : 1;\n-        }\n-        return errors;\n+        assertSame(defString, Objects.requireNonNullElseGet(nullString, () -> defString),\n+            \"requireNonNullElseGet(null, supplier) should return supplier result\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElseGet(nonNullString, () -> defString),\n+            \"requireNonNullElseGet(non-null, supplier) should return non-null\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElseGet(nonNullString, () -> null),\n+            \"requireNonNullElseGet(non-null, null-supplier) should return non-null\");\n+\n+        NullPointerException npe2 = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, () -> null),\n+            \"requireNonNullElseGet(null, null-returning supplier) should throw NPE\");\n+        assertEquals(\"supplier.get()\", npe2.getMessage(),\n+            \"Exception message should be 'supplier.get()'\");\n+\n+        NullPointerException npe3 = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, null),\n+            \"requireNonNullElseGet(null, null supplier) should throw NPE\");\n+        assertEquals(\"supplier\", npe3.getMessage(),\n+            \"Exception message should be 'supplier'\");\n+    }\n+\n+    \/**\n+     * Test requireNonNull with null Supplier parameter.\n+     * Should throw NullPointerException with null message (as per API spec).\n+     *\/\n+    @Test\n+    public void testRequireNonNullWithNullSupplier() {\n+        \/\/ Test with null object and null supplier\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNull(null, (Supplier<String>) null),\n+            \"requireNonNull(null, null supplier) should throw NPE\");\n+        \/\/ According to Objects.java implementation, when messageSupplier is null,\n+        \/\/ the exception message is also null\n+        assertNull(npe.getMessage(),\n+            \"Exception message should be null when messageSupplier is null\");\n+    }\n+\n+    \/**\n+     * Test requireNonNull with Supplier that throws exception.\n+     * The exception from supplier should be thrown, not wrapped.\n+     *\/\n+    @Test\n+    public void testRequireNonNullWithSupplierThrowingException() {\n+        \/\/ Allocate exception outside of lambda to verify same instance is thrown\n+        RuntimeException expectedException = new RuntimeException(\"Supplier exception\");\n+        RuntimeException actualException = assertThrows(\n+            RuntimeException.class,\n+            () -> Objects.requireNonNull(null, () -> {\n+                throw expectedException;\n+            }),\n+            \"requireNonNull should throw exception from supplier\");\n+        assertSame(expectedException, actualException,\n+            \"The exception from supplier should be thrown directly, not wrapped\");\n+    }\n+\n+    \/**\n+     * Test requireNonNullElse with both arguments null.\n+     * Should throw NullPointerException with message \"defaultObj\".\n+     *\/\n+    @Test\n+    public void testRequireNonNullElseBothNull() {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElse(null, null),\n+            \"requireNonNullElse(null, null) should throw NPE\");\n+        assertEquals(\"defaultObj\", npe.getMessage(),\n+            \"Exception message should be 'defaultObj' when both arguments are null\");\n+    }\n+\n+    \/**\n+     * Test requireNonNullElseGet with null supplier.\n+     * Should throw NullPointerException with message \"supplier\".\n+     *\/\n+    @Test\n+    public void testRequireNonNullElseGetWithNullSupplier() {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, null),\n+            \"requireNonNullElseGet(null, null supplier) should throw NPE\");\n+        assertEquals(\"supplier\", npe.getMessage(),\n+            \"Exception message should be 'supplier' when supplier is null\");\n+    }\n+\n+    \/**\n+     * Test requireNonNullElseGet with supplier returning null.\n+     * Should throw NullPointerException with message \"supplier.get()\".\n+     *\/\n+    @Test\n+    public void testRequireNonNullElseGetWithSupplierReturningNull() {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, () -> null),\n+            \"requireNonNullElseGet(null, null-returning supplier) should throw NPE\");\n+        assertEquals(\"supplier.get()\", npe.getMessage(),\n+            \"Exception message should be 'supplier.get()' when supplier returns null\");\n","filename":"test\/jdk\/java\/util\/Objects\/BasicObjectsTest.java","additions":222,"deletions":172,"binary":false,"changes":394,"status":"modified"}]}