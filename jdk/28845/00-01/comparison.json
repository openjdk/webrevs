{"files":[{"patch":"@@ -26,1 +26,1 @@\n- * @bug 6797535 6889858 6891113 8013712 8011800 8014365 8280168\n+ * @bug 6797535 6889858 6891113 8013712 8011800 8014365 8280168 8373661\n@@ -28,0 +28,1 @@\n+ * @run junit BasicObjectsTest\n@@ -30,0 +31,2 @@\n+import static org.junit.jupiter.api.Assertions.*;\n+import org.junit.jupiter.api.Test;\n@@ -34,23 +37,0 @@\n-    public static void main(String... args) {\n-        int errors = 0;\n-        errors += testEquals();\n-        errors += testDeepEquals();\n-        errors += testHashCode();\n-        errors += testHash();\n-        errors += testToString();\n-        errors += testToString2();\n-        errors += testToIdentityString();\n-        errors += testCompare();\n-        errors += testRequireNonNull();\n-        errors += testIsNull();\n-        errors += testNonNull();\n-        errors += testNonNullOf();\n-\n-        errors += testRequireNonNullWithNullSupplier();\n-        errors += testRequireNonNullWithSupplierThrowingException();\n-        errors += testRequireNonNullElseBothNull();\n-        errors += testRequireNonNullElseGetWithNullSupplier();\n-        errors += testRequireNonNullElseGetWithSupplierReturningNull();\n-        if (errors > 0 )\n-            throw new RuntimeException();\n-    }\n@@ -58,2 +38,2 @@\n-    private static int testEquals() {\n-        int errors = 0;\n+    @Test\n+    public void testEquals() {\n@@ -67,5 +47,3 @@\n-                if (result != expected) {\n-                    errors++;\n-                    System.err.printf(\"When equating %s to %s, got %b instead of %b%n.\",\n-                                      a, b, result, expected);\n-                }\n+                assertEquals(expected, result,\n+                    String.format(\"When equating %s to %s, got %b instead of %b\",\n+                                  a, b, result, expected));\n@@ -73,1 +51,0 @@\n-        return errors;\n@@ -76,2 +53,2 @@\n-    private static int testDeepEquals() {\n-        int errors = 0;\n+    @Test\n+    public void testDeepEquals() {\n@@ -96,5 +73,3 @@\n-                if (result != expected) {\n-                    errors++;\n-                    System.err.printf(\"When equating %s to %s, got %b instead of %b%n.\",\n-                                      a, b, result, expected);\n-                }\n+                assertEquals(expected, result,\n+                    String.format(\"When equating %s to %s, got %b instead of %b\",\n+                                  a, b, result, expected));\n@@ -102,2 +77,0 @@\n-\n-        return errors;\n@@ -106,3 +79,4 @@\n-    private static int testHashCode() {\n-        int errors = 0;\n-        errors += (Objects.hashCode(null) == 0 ) ? 0 : 1;\n+    @Test\n+    public void testHashCode() {\n+        assertEquals(0, Objects.hashCode(null),\n+            \"hashCode(null) should return 0\");\n@@ -110,2 +84,2 @@\n-        errors += (Objects.hashCode(s) == s.hashCode() ) ? 0 : 1;\n-        return errors;\n+        assertEquals(s.hashCode(), Objects.hashCode(s),\n+            \"hashCode(s) should return s.hashCode()\");\n@@ -114,3 +88,2 @@\n-    private static int testHash() {\n-        int errors = 0;\n-\n+    @Test\n+    public void testHash() {\n@@ -119,1 +92,2 @@\n-        errors += ((Objects.hash((Object[])null) == 0) ? 0 : 1);\n+        assertEquals(0, Objects.hash((Object[])null),\n+            \"hash(null) should return 0\");\n@@ -121,4 +95,3 @@\n-        errors += (Objects.hash(\"perfect\", \"ham\", \"THC\") ==\n-                   Arrays.hashCode(data)) ? 0 : 1;\n-\n-        return errors;\n+        assertEquals(Arrays.hashCode(data),\n+                     Objects.hash(\"perfect\", \"ham\", \"THC\"),\n+                     \"hash should match Arrays.hashCode\");\n@@ -127,3 +100,4 @@\n-    private static int testToString() {\n-        int errors = 0;\n-        errors += (\"null\".equals(Objects.toString(null)) ) ? 0 : 1;\n+    @Test\n+    public void testToString() {\n+        assertEquals(\"null\", Objects.toString(null),\n+            \"toString(null) should return 'null'\");\n@@ -131,2 +105,2 @@\n-        errors += (s.equals(Objects.toString(s)) ) ? 0 : 1;\n-        return errors;\n+        assertEquals(s, Objects.toString(s),\n+            \"toString(s) should return s\");\n@@ -135,2 +109,2 @@\n-    private static int testToString2() {\n-        int errors = 0;\n+    @Test\n+    public void testToString2() {\n@@ -138,3 +112,4 @@\n-        errors += (s.equals(Objects.toString(null, s)) ) ? 0 : 1;\n-        errors += (s.equals(Objects.toString(s, \"another string\")) ) ? 0 : 1;\n-        return errors;\n+        assertEquals(s, Objects.toString(null, s),\n+            \"toString(null, default) should return default\");\n+        assertEquals(s, Objects.toString(s, \"another string\"),\n+            \"toString(s, default) should return s when s is not null\");\n@@ -143,2 +118,2 @@\n-    private static int testToIdentityString() {\n-        int errors = 0;\n+    @Test\n+    public void testToIdentityString() {\n@@ -146,6 +121,4 @@\n-        try {\n-            Objects.toIdentityString(null);\n-            errors++;\n-        } catch (NullPointerException npe) {\n-            ; \/\/ Expected\n-        }\n+        assertThrows(NullPointerException.class,\n+            () -> Objects.toIdentityString(null),\n+            \"toIdentityString(null) should throw NullPointerException\");\n+\n@@ -154,1 +127,3 @@\n-        errors += (Objects.toIdentityString(o).equals(o.toString()))? 0 : 1;\n+        assertEquals(o.toString(), Objects.toIdentityString(o),\n+            \"toIdentityString(o) should equal o.toString()\");\n+\n@@ -162,1 +137,4 @@\n-        Objects.toIdentityString(badToString);\n+        \/\/ Should not throw RuntimeException from toString\n+        assertDoesNotThrow(() -> Objects.toIdentityString(badToString),\n+            \"toIdentityString should not call toString()\");\n+\n@@ -170,2 +148,3 @@\n-        Objects.toIdentityString(badHashCode);\n-        return errors;\n+        \/\/ Should not throw RuntimeException from hashCode\n+        assertDoesNotThrow(() -> Objects.toIdentityString(badHashCode),\n+            \"toIdentityString should not call hashCode()\");\n@@ -174,2 +153,2 @@\n-    private static int testCompare() {\n-        int errors = 0;\n+    @Test\n+    public void testCompare() {\n@@ -178,1 +157,1 @@\n-        errors += compareTest(null, null, 0);\n+        compareTest(null, null, 0);\n@@ -181,1 +160,1 @@\n-            errors += compareTest(a, a, 0);\n+            compareTest(a, a, 0);\n@@ -185,1 +164,1 @@\n-                errors += compareTest(a, b, expected);\n+                compareTest(a, b, expected);\n@@ -188,1 +167,0 @@\n-        return errors;\n@@ -191,2 +169,1 @@\n-    private static int compareTest(String a, String b, int expected) {\n-        int errors = 0;\n+    private void compareTest(String a, String b, int expected) {\n@@ -194,6 +171,3 @@\n-        if (Integer.signum(result) != Integer.signum(expected)) {\n-            errors++;\n-            System.err.printf(\"When comparing %s to %s, got %d instead of %d%n.\",\n-                              a, b, result, expected);\n-        }\n-        return errors;\n+        assertEquals(Integer.signum(expected), Integer.signum(result),\n+            String.format(\"When comparing %s to %s, got %d instead of %d\",\n+                          a, b, result, expected));\n@@ -202,3 +176,2 @@\n-    private static int testRequireNonNull() {\n-        int errors = 0;\n-\n+    @Test\n+    public void testRequireNonNull() {\n@@ -213,3 +186,3 @@\n-        errors += testRNN_NonNull(rnn1, RNN_1);\n-        errors += testRNN_NonNull(rnn2, RNN_2);\n-        errors += testRNN_NonNull(rnn3, RNN_3);\n+        testRNN_NonNull(rnn1, RNN_1);\n+        testRNN_NonNull(rnn2, RNN_2);\n+        testRNN_NonNull(rnn3, RNN_3);\n@@ -217,4 +190,3 @@\n-        errors += testRNN_Null(rnn1, RNN_1, null);\n-        errors += testRNN_Null(rnn2, RNN_2, \"trousers\");\n-        errors += testRNN_Null(rnn3, RNN_3, \"trousers\");\n-        return errors;\n+        testRNN_Null(rnn1, RNN_1, null);\n+        testRNN_Null(rnn2, RNN_2, \"trousers\");\n+        testRNN_Null(rnn3, RNN_3, \"trousers\");\n@@ -223,14 +195,5 @@\n-    private static int testRNN_NonNull(Function<String, String> testFunc,\n-                                       String testFuncName) {\n-        int errors = 0;\n-        try {\n-            String s = testFunc.apply(\"pants\");\n-            if (s != \"pants\") {\n-                System.err.printf(testFuncName + \" failed to return its arg\");\n-                errors++;\n-            }\n-        } catch (NullPointerException e) {\n-            System.err.printf(testFuncName + \" threw unexpected NPE\");\n-            errors++;\n-        }\n-        return errors;\n+    private void testRNN_NonNull(Function<String, String> testFunc,\n+                                 String testFuncName) {\n+        String s = testFunc.apply(\"pants\");\n+        assertSame(\"pants\", s,\n+            testFuncName + \" should return its arg\");\n@@ -239,15 +202,9 @@\n-    private static int testRNN_Null(Function<String, String> testFunc,\n-                                    String testFuncName,\n-                                    String expectedMessage) {\n-        int errors = 0;\n-        try {\n-            String s = testFunc.apply(null);\n-            System.err.printf(testFuncName + \" failed to throw NPE\");\n-            errors++;\n-        } catch (NullPointerException e) {\n-            if (e.getMessage() != expectedMessage) {\n-                System.err.printf(testFuncName + \" threw NPE w\/ bad detail msg\");\n-                errors++;\n-            }\n-        }\n-        return errors;\n+    private void testRNN_Null(Function<String, String> testFunc,\n+                              String testFuncName,\n+                              String expectedMessage) {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> testFunc.apply(null),\n+            testFuncName + \" should throw NPE\");\n+        assertEquals(expectedMessage, npe.getMessage(),\n+            testFuncName + \" should have correct exception message\");\n@@ -256,7 +213,6 @@\n-    private static int testIsNull() {\n-        int errors = 0;\n-\n-        errors += Objects.isNull(null) ? 0 : 1;\n-        errors += Objects.isNull(Objects.class) ? 1 : 0;\n-\n-        return errors;\n+    @Test\n+    public void testIsNull() {\n+        assertTrue(Objects.isNull(null),\n+            \"isNull(null) should return true\");\n+        assertFalse(Objects.isNull(Objects.class),\n+            \"isNull(Objects.class) should return false\");\n@@ -265,7 +221,6 @@\n-    private static int testNonNull() {\n-        int errors = 0;\n-\n-        errors += Objects.nonNull(null) ? 1 : 0;\n-        errors += Objects.nonNull(Objects.class) ? 0 : 1;\n-\n-        return errors;\n+    @Test\n+    public void testNonNull() {\n+        assertFalse(Objects.nonNull(null),\n+            \"nonNull(null) should return false\");\n+        assertTrue(Objects.nonNull(Objects.class),\n+            \"nonNull(Objects.class) should return true\");\n@@ -274,2 +229,2 @@\n-    private static int testNonNullOf() {\n-        int errors = 0;\n+    @Test\n+    public void testNonNullOf() {\n@@ -282,10 +237,8 @@\n-        errors += (result == defString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElse(nonNullString, defString) == nonNullString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElse(nonNullString, null) == nonNullString) ? 0 : 1;\n-        try {\n-            Objects.requireNonNullElse(null, null);\n-            errors += 1;\n-        } catch (NullPointerException npe) {\n-            \/\/ expected\n-            errors += npe.getMessage().equals(\"defaultObj\") ? 0 : 1;\n-        }\n+        assertSame(defString, result,\n+            \"requireNonNullElse(null, default) should return default\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElse(nonNullString, defString),\n+            \"requireNonNullElse(non-null, default) should return non-null\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElse(nonNullString, null),\n+            \"requireNonNullElse(non-null, null) should return non-null\");\n@@ -293,0 +246,6 @@\n+        NullPointerException npe1 = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElse(null, null),\n+            \"requireNonNullElse(null, null) should throw NPE\");\n+        assertEquals(\"defaultObj\", npe1.getMessage(),\n+            \"Exception message should be 'defaultObj'\");\n@@ -295,19 +254,22 @@\n-        errors += (Objects.requireNonNullElseGet(nullString, () -> defString) == defString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElseGet(nonNullString, () -> defString) == nonNullString) ? 0 : 1;\n-        errors += (Objects.requireNonNullElseGet(nonNullString, () -> null) == nonNullString) ? 0 : 1;\n-\n-        try {\n-            Objects.requireNonNullElseGet(null, () -> null);\n-            errors += 1;\n-        } catch (NullPointerException npe) {\n-            \/\/ expected\n-            errors += npe.getMessage().equals(\"supplier.get()\") ? 0 : 1;\n-        }\n-        try {       \/\/ supplier is null\n-            Objects.requireNonNullElseGet(null, null);\n-            errors += 1;\n-        } catch (NullPointerException npe) {\n-            \/\/ expected\n-            errors += npe.getMessage().equals(\"supplier\") ? 0 : 1;\n-        }\n-        return errors;\n+        assertSame(defString, Objects.requireNonNullElseGet(nullString, () -> defString),\n+            \"requireNonNullElseGet(null, supplier) should return supplier result\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElseGet(nonNullString, () -> defString),\n+            \"requireNonNullElseGet(non-null, supplier) should return non-null\");\n+\n+        assertSame(nonNullString, Objects.requireNonNullElseGet(nonNullString, () -> null),\n+            \"requireNonNullElseGet(non-null, null-supplier) should return non-null\");\n+\n+        NullPointerException npe2 = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, () -> null),\n+            \"requireNonNullElseGet(null, null-returning supplier) should throw NPE\");\n+        assertEquals(\"supplier.get()\", npe2.getMessage(),\n+            \"Exception message should be 'supplier.get()'\");\n+\n+        NullPointerException npe3 = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, null),\n+            \"requireNonNullElseGet(null, null supplier) should throw NPE\");\n+        assertEquals(\"supplier\", npe3.getMessage(),\n+            \"Exception message should be 'supplier'\");\n@@ -320,21 +282,11 @@\n-    private static int testRequireNonNullWithNullSupplier() {\n-        int errors = 0;\n-        try {\n-            Objects.requireNonNull(\"test\", (Supplier<String>) null);\n-            \/\/ Should not reach here for non-null object\n-            \/\/ But we're testing the supplier parameter\n-            Objects.requireNonNull(null, (Supplier<String>) null);\n-            System.err.println(\"testRequireNonNullWithNullSupplier: \" +\n-                            \"failed to throw NPE\");\n-            errors++;\n-        } catch (NullPointerException e) {\n-            String msg = e.getMessage();\n-            \/\/ According to Objects.java implementation, when messageSupplier is null,\n-            \/\/ the exception message is also null\n-            if (msg != null) {\n-                System.err.println(\"testRequireNonNullWithNullSupplier: \" +\n-                                \"expected null message but got: \" + msg);\n-                errors++;\n-            }\n-        }\n-        return errors;\n+    @Test\n+    public void testRequireNonNullWithNullSupplier() {\n+        \/\/ Test with null object and null supplier\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNull(null, (Supplier<String>) null),\n+            \"requireNonNull(null, null supplier) should throw NPE\");\n+        \/\/ According to Objects.java implementation, when messageSupplier is null,\n+        \/\/ the exception message is also null\n+        assertNull(npe.getMessage(),\n+            \"Exception message should be null when messageSupplier is null\");\n@@ -347,4 +299,6 @@\n-    private static int testRequireNonNullWithSupplierThrowingException() {\n-        int errors = 0;\n-        try {\n-            Objects.requireNonNull(null, () -> {\n+    @Test\n+    public void testRequireNonNullWithSupplierThrowingException() {\n+        \/\/ The exception from supplier should be thrown directly, not wrapped\n+        RuntimeException re = assertThrows(\n+            RuntimeException.class,\n+            () -> Objects.requireNonNull(null, () -> {\n@@ -352,16 +306,4 @@\n-            });\n-            System.err.println(\"testRequireNonNullWithSupplierThrowingException: \" +\n-                            \"failed to throw exception\");\n-            errors++;\n-        } catch (RuntimeException e) {\n-            if (!\"Supplier exception\".equals(e.getMessage())) {\n-                System.err.println(\"testRequireNonNullWithSupplierThrowingException: \" +\n-                                \"wrong exception: \" + e.getMessage());\n-                errors++;\n-            }\n-        } catch (Exception e) {\n-            System.err.println(\"testRequireNonNullWithSupplierThrowingException: \" +\n-                            \"unexpected exception type: \" + e.getClass());\n-            errors++;\n-        }\n-        return errors;\n+            }),\n+            \"requireNonNull should throw exception from supplier\");\n+        assertEquals(\"Supplier exception\", re.getMessage(),\n+            \"Exception message should match the supplier's exception message\");\n@@ -374,16 +316,8 @@\n-    private static int testRequireNonNullElseBothNull() {\n-        int errors = 0;\n-        try {\n-            Objects.requireNonNullElse(null, null);\n-            System.err.println(\"testRequireNonNullElseBothNull: \" +\n-                            \"failed to throw NPE\");\n-            errors++;\n-        } catch (NullPointerException e) {\n-            String msg = e.getMessage();\n-            if (msg == null || !msg.equals(\"defaultObj\")) {\n-                System.err.println(\"testRequireNonNullElseBothNull: \" +\n-                                \"wrong exception message: \" + msg);\n-                errors++;\n-            }\n-        }\n-        return errors;\n+    @Test\n+    public void testRequireNonNullElseBothNull() {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElse(null, null),\n+            \"requireNonNullElse(null, null) should throw NPE\");\n+        assertEquals(\"defaultObj\", npe.getMessage(),\n+            \"Exception message should be 'defaultObj' when both arguments are null\");\n@@ -396,16 +330,8 @@\n-    private static int testRequireNonNullElseGetWithNullSupplier() {\n-        int errors = 0;\n-        try {\n-            Objects.requireNonNullElseGet(null, null);\n-            System.err.println(\"testRequireNonNullElseGetWithNullSupplier: \" +\n-                            \"failed to throw NPE\");\n-            errors++;\n-        } catch (NullPointerException e) {\n-            String msg = e.getMessage();\n-            if (msg == null || !msg.equals(\"supplier\")) {\n-                System.err.println(\"testRequireNonNullElseGetWithNullSupplier: \" +\n-                                \"wrong exception message: \" + msg);\n-                errors++;\n-            }\n-        }\n-        return errors;\n+    @Test\n+    public void testRequireNonNullElseGetWithNullSupplier() {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, null),\n+            \"requireNonNullElseGet(null, null supplier) should throw NPE\");\n+        assertEquals(\"supplier\", npe.getMessage(),\n+            \"Exception message should be 'supplier' when supplier is null\");\n@@ -418,16 +344,8 @@\n-    private static int testRequireNonNullElseGetWithSupplierReturningNull() {\n-        int errors = 0;\n-        try {\n-            Objects.requireNonNullElseGet(null, () -> null);\n-            System.err.println(\"testRequireNonNullElseGetWithSupplierReturningNull: \" +\n-                            \"failed to throw NPE\");\n-            errors++;\n-        } catch (NullPointerException e) {\n-            String msg = e.getMessage();\n-            if (msg == null || !msg.equals(\"supplier.get()\")) {\n-                System.err.println(\"testRequireNonNullElseGetWithSupplierReturningNull: \" +\n-                                \"wrong exception message: \" + msg);\n-                errors++;\n-            }\n-        }\n-        return errors;\n+    @Test\n+    public void testRequireNonNullElseGetWithSupplierReturningNull() {\n+        NullPointerException npe = assertThrows(\n+            NullPointerException.class,\n+            () -> Objects.requireNonNullElseGet(null, () -> null),\n+            \"requireNonNullElseGet(null, null-returning supplier) should throw NPE\");\n+        assertEquals(\"supplier.get()\", npe.getMessage(),\n+            \"Exception message should be 'supplier.get()' when supplier returns null\");\n","filename":"test\/jdk\/java\/util\/Objects\/BasicObjectsTest.java","additions":181,"deletions":263,"binary":false,"changes":444,"status":"modified"}]}