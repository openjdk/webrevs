{"files":[{"patch":"@@ -326,0 +326,11 @@\n+\n+    \/\/ Maybe we have a third instruction: adrp + movk + ldr with offset (e.g. ldr_patchable)\n+    uint32_t insn3 = insn_at(insn_addr, 2);\n+    bool adrpMemInsn3 = Instruction_aarch64::extract(insn3, 29, 24) == 0b111001 &&\n+      Instruction_aarch64::extract(_insn, 4, 0) == Instruction_aarch64::extract(insn3, 9, 5);\n+    bool insn2_is_movk = nativeInstruction_at(insn_addr+4)->is_movk();\n+    if (adrpMemInsn3 && insn2_is_movk) {\n+      adrpMem_impl(insn_addr + 4, target);\n+      instructions = 3;\n+    }\n+\n@@ -467,2 +478,1 @@\n-    \/\/ We know the destination 4k page. Maybe we have a third\n-    \/\/ instruction.\n+    \/\/ We know the destination 4k page. Maybe we have a third instruction.\n@@ -5272,2 +5282,1 @@\n-    address dummy = address(uintptr_t(pc()) & -wordSize); \/\/ A nearby aligned address\n-    ldr_constant(dst, Address(dummy, rspec));\n+    ldr_patchable(dst, Address((address)obj, rspec));\n@@ -5275,1 +5284,0 @@\n-\n@@ -5390,1 +5398,1 @@\n-void MacroAssembler::adrp(Register reg1, const Address &dest, uint64_t &byte_offset) {\n+void MacroAssembler::adrp(Register reg1, const Address &dest, uint64_t &byte_offset, bool force_movk) {\n@@ -5405,1 +5413,1 @@\n-  if (offset_high >= -(1<<20) && offset_low < (1<<20)) {\n+  if (!force_movk && offset_high >= -(1<<20) && offset_low < (1<<20)) {\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.cpp","additions":15,"deletions":7,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -1380,1 +1380,1 @@\n-  void adrp(Register reg1, const Address &dest, uint64_t &byte_offset);\n+  void adrp(Register reg1, const Address &dest, uint64_t &byte_offset, bool force_movk = false);\n@@ -1418,8 +1418,5 @@\n-  void ldr_constant(Register dest, const Address &const_addr) {\n-    if (NearCpool) {\n-      ldr(dest, const_addr);\n-    } else {\n-      uint64_t offset;\n-      adrp(dest, InternalAddress(const_addr.target()), offset);\n-      ldr(dest, Address(dest, offset));\n-    }\n+  void ldr_patchable(Register dest, const Address &const_addr) {\n+    uint64_t offset;\n+    bool force_movk = true; \/\/ movk is important if the target can be more than 4GB away\n+    adrp(dest, const_addr, offset, force_movk);\n+    ldr(dest, Address(dest, offset));\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.hpp","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-      if (NativeInstruction::is_ldr_literal_at(addr())) {\n+      if (NativeInstruction::is_ldr_literal_at(addr()) || NativeInstruction::is_adrp_at(addr())) {\n","filename":"src\/hotspot\/cpu\/aarch64\/relocInfo_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -66,2 +66,0 @@\n-  unsigned int size = header_size;\n-  size += align_up(cb->total_relocation_size(), oopSize);\n@@ -69,1 +67,1 @@\n-  size = align_code_offset(size);\n+  unsigned int size = align_code_offset(header_size);\n@@ -71,2 +69,0 @@\n-  size += align_up(cb->total_oop_size(), oopSize);\n-  size += align_up(cb->total_metadata_size(), oopSize);\n@@ -77,1 +73,2 @@\n-                   int16_t frame_complete_offset, int frame_size, OopMapSet* oop_maps, bool caller_must_gc_arguments) :\n+                   int16_t frame_complete_offset, int frame_size, OopMapSet* oop_maps, bool caller_must_gc_arguments,\n+                   int mutable_data_size) :\n@@ -82,1 +79,1 @@\n-  _content_offset(CodeBlob::align_code_offset(header_size + _relocation_size)),\n+  _content_offset(CodeBlob::align_code_offset(header_size)),\n@@ -84,1 +81,0 @@\n-  _data_offset(_content_offset + align_up(cb->total_content_size(), oopSize)),\n@@ -90,1 +86,3 @@\n-  _caller_must_gc_arguments(caller_must_gc_arguments)\n+  _caller_must_gc_arguments(caller_must_gc_arguments),\n+  _mutable_data(nullptr),\n+  _mutable_data_size(mutable_data_size)\n@@ -95,1 +93,2 @@\n-  assert(_data_offset <= _size, \"codeBlob is too small: %d > %d\", _data_offset, _size);\n+  int code_end_offset = _content_offset + align_up(cb->total_content_size(), oopSize);\n+  assert(code_end_offset == _size, \"wrong codeBlob size: %d != %d\", _size, code_end_offset);\n@@ -102,0 +101,7 @@\n+  if (_mutable_data_size > 0) {\n+    _mutable_data = (address)os::malloc(_mutable_data_size, mtCode);\n+    if (_mutable_data == nullptr) {\n+      vm_exit_out_of_memory(_mutable_data_size, OOM_MALLOC_ERROR, \"codebuffer: no space for mutable data\");\n+    }\n+  }\n+\n@@ -113,1 +119,0 @@\n-  _data_offset(size),\n@@ -167,1 +172,2 @@\n-  : CodeBlob(name, kind, cb, size, header_size, frame_complete, frame_size, oop_maps, caller_must_gc_arguments)\n+  : CodeBlob(name, kind, cb, size, header_size, frame_complete, frame_size, oop_maps, caller_must_gc_arguments,\n+             align_up(cb->total_relocation_size(), oopSize))\n","filename":"src\/hotspot\/share\/code\/codeBlob.cpp","additions":18,"deletions":12,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -111,2 +111,0 @@\n-\n-  int      _data_offset;           \/\/ offset to where data region begins\n@@ -127,0 +125,3 @@\n+  address _mutable_data;\n+  int     _mutable_data_size;\n+\n@@ -133,1 +134,2 @@\n-           int16_t frame_complete_offset, int frame_size, OopMapSet* oop_maps, bool caller_must_gc_arguments);\n+           int16_t frame_complete_offset, int frame_size, OopMapSet* oop_maps, bool caller_must_gc_arguments,\n+           int mutable_data_size);\n@@ -173,0 +175,4 @@\n+  address mutable_data_begin() const          { return _mutable_data; }\n+  address mutable_data_end() const            { return _mutable_data + _mutable_data_size; }\n+  int mutable_data_size() const               { return _mutable_data_size; }\n+\n@@ -176,2 +182,2 @@\n-  relocInfo* relocation_begin() const         { return (relocInfo*) header_end(); }\n-  relocInfo* relocation_end() const           { return (relocInfo*)(header_end()   + _relocation_size); }\n+  relocInfo* relocation_begin() const         { return (relocInfo*)_mutable_data; }\n+  relocInfo* relocation_end() const           { return (relocInfo*)((address)relocation_begin() + _relocation_size); }\n@@ -179,1 +185,1 @@\n-  address    content_end() const              { return (address)    header_begin() + _data_offset; }\n+  address    content_end() const              { return (address)    header_begin() + _size; }\n@@ -181,4 +187,2 @@\n-  \/\/ code_end == content_end is true for all types of blobs for now, it is also checked in the constructor\n-  address    code_end() const                 { return (address)    header_begin() + _data_offset; }\n-  address    data_begin() const               { return (address)    header_begin() + _data_offset; }\n-  address    data_end() const                 { return (address)    header_begin() + _size; }\n+  address    code_end() const                 { return (address)    header_begin() + _size; }\n+  address    blob_end() const                 { return (address)    header_begin() + _size; }\n@@ -189,1 +193,0 @@\n-  int data_offset() const                     { return _data_offset; }\n@@ -207,1 +210,0 @@\n-    _data_offset = (int)used;\n@@ -211,1 +213,1 @@\n-  bool blob_contains(address addr) const         { return header_begin()       <= addr && addr < data_end();       }\n+  bool blob_contains(address addr) const         { return header_begin()       <= addr && addr < blob_end();       }\n","filename":"src\/hotspot\/share\/code\/codeBlob.hpp","additions":15,"deletions":13,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -131,0 +131,1 @@\n+  uint total_mut_size;\n@@ -151,0 +152,1 @@\n+    total_mut_size      += nm->mutable_data_size();\n@@ -170,1 +172,1 @@\n-    uint total_size = total_nm_size + total_immut_size;\n+    uint total_size = total_nm_size + total_immut_size + total_mut_size;\n@@ -179,3 +181,0 @@\n-    if (relocation_size != 0) {\n-      tty->print_cr(\"   relocation    = %u (%f%%)\", relocation_size, (relocation_size * 100.0f)\/total_nm_size);\n-    }\n@@ -191,0 +190,6 @@\n+    if (total_mut_size != 0) {\n+      tty->print_cr(\" mutable data    = %u (%f%%)\", total_mut_size, (total_mut_size * 100.0f)\/total_size);\n+    }\n+    if (relocation_size != 0) {\n+      tty->print_cr(\"   relocation    = %u (%f%%)\", relocation_size, (relocation_size * 100.0f)\/total_mut_size);\n+    }\n@@ -192,1 +197,1 @@\n-      tty->print_cr(\"   oops          = %u (%f%%)\", oops_size, (oops_size * 100.0f)\/total_nm_size);\n+      tty->print_cr(\"   oops          = %u (%f%%)\", oops_size, (oops_size * 100.0f)\/total_mut_size);\n@@ -195,1 +200,1 @@\n-      tty->print_cr(\"   metadata      = %u (%f%%)\", metadata_size, (metadata_size * 100.0f)\/total_nm_size);\n+      tty->print_cr(\"   metadata      = %u (%f%%)\", metadata_size, (metadata_size * 100.0f)\/total_mut_size);\n@@ -1075,0 +1080,8 @@\n+static int required_mutable_data_space(CodeBuffer* code_buffer,\n+                                       int jvmci_data_size = 0) {\n+  return align_up(code_buffer->total_relocation_size(), oopSize) +\n+         align_up(code_buffer->total_oop_size(), oopSize) +\n+         align_up(jvmci_data_size, oopSize) +\n+         align_up(code_buffer->total_metadata_size(), oopSize);\n+}\n+\n@@ -1099,0 +1112,2 @@\n+    int mutable_data_size = required_mutable_data_space(code_buffer);\n+\n@@ -1108,1 +1123,1 @@\n-            oop_maps);\n+            oop_maps, mutable_data_size);\n@@ -1147,5 +1162,0 @@\n-#if INCLUDE_JVMCI\n-    if (compiler->is_jvmci()) {\n-      nmethod_size += align_up(jvmci_data->size(), oopSize);\n-    }\n-#endif\n@@ -1172,0 +1182,4 @@\n+\n+  int mutable_data_size = required_mutable_data_space(code_buffer\n+    JVMCI_ONLY(COMMA (compiler->is_jvmci() ? jvmci_data->size() : 0)));\n+\n@@ -1176,1 +1190,1 @@\n-    nmethod(method(), compiler->type(), nmethod_size, immutable_data_size,\n+    nmethod(method(), compiler->type(), nmethod_size, immutable_data_size, mutable_data_size,\n@@ -1279,1 +1293,2 @@\n-  OopMapSet* oop_maps )\n+  OopMapSet* oop_maps,\n+  int mutable_data_size)\n@@ -1281,1 +1296,1 @@\n-             offsets->value(CodeOffsets::Frame_Complete), frame_size, oop_maps, false),\n+             offsets->value(CodeOffsets::Frame_Complete), frame_size, oop_maps, false, mutable_data_size),\n@@ -1315,8 +1330,6 @@\n-    CHECKED_CAST(_metadata_offset, uint16_t, (align_up(code_buffer->total_oop_size(), oopSize)));\n-    int data_end_offset = _metadata_offset + align_up(code_buffer->total_metadata_size(), wordSize);\n-#if INCLUDE_JVMCI\n-    \/\/ jvmci_data_size is 0 in native wrapper but we need to set offset\n-    \/\/ to correctly calculate metadata_end address\n-    CHECKED_CAST(_jvmci_data_offset, uint16_t, data_end_offset);\n-#endif\n-    assert((data_offset() + data_end_offset) <= nmethod_size, \"wrong nmethod's size: %d < %d\", nmethod_size, (data_offset() + data_end_offset));\n+    CHECKED_CAST(_oops_size, uint16_t, align_up(code_buffer->total_oop_size(), oopSize));\n+    int metadata_size = align_up(code_buffer->total_metadata_size(), wordSize);\n+    JVMCI_ONLY( _jvmci_data_size = 0; )\n+    assert(_mutable_data_size == _relocation_size + _oops_size + metadata_size,\n+           \"wrong mutable data size: %d != %d + %d + %d\",\n+           _mutable_data_size, _relocation_size, _oops_size, metadata_size);\n@@ -1325,1 +1338,1 @@\n-    _immutable_data          = data_end();\n+    _immutable_data          = blob_end();\n@@ -1402,0 +1415,1 @@\n+  int mutable_data_size,\n@@ -1423,1 +1437,1 @@\n-             offsets->value(CodeOffsets::Frame_Complete), frame_size, oop_maps, false),\n+             offsets->value(CodeOffsets::Frame_Complete), frame_size, oop_maps, false, mutable_data_size),\n@@ -1489,2 +1503,0 @@\n-    CHECKED_CAST(_metadata_offset, uint16_t, (align_up(code_buffer->total_oop_size(), oopSize)));\n-    int metadata_end_offset = _metadata_offset + align_up(code_buffer->total_metadata_size(), wordSize);\n@@ -1492,9 +1504,9 @@\n-#if INCLUDE_JVMCI\n-    CHECKED_CAST(_jvmci_data_offset, uint16_t, metadata_end_offset);\n-    int jvmci_data_size   = compiler->is_jvmci() ? jvmci_data->size() : 0;\n-    DEBUG_ONLY( int data_end_offset = _jvmci_data_offset  + align_up(jvmci_data_size, oopSize); )\n-#else\n-    DEBUG_ONLY( int data_end_offset = metadata_end_offset; )\n-#endif\n-    assert((data_offset() + data_end_offset) <= nmethod_size, \"wrong nmethod's size: %d > %d\",\n-           (data_offset() + data_end_offset), nmethod_size);\n+    CHECKED_CAST(_oops_size, uint16_t, align_up(code_buffer->total_oop_size(), oopSize));\n+    uint16_t metadata_size = (uint16_t)align_up(code_buffer->total_metadata_size(), wordSize);\n+    JVMCI_ONLY(CHECKED_CAST(_jvmci_data_size, uint16_t, align_up(compiler->is_jvmci() ? jvmci_data->size() : 0, oopSize)));\n+    int jvmci_data_size = 0 JVMCI_ONLY(+ _jvmci_data_size);\n+    assert(_mutable_data_size == _relocation_size + _oops_size + metadata_size + jvmci_data_size,\n+           \"wrong mutable data size: %d != %d + %d + %d + %d\",\n+           _mutable_data_size, _relocation_size, _oops_size, metadata_size, jvmci_data_size);\n+    assert(nmethod_size == code_end() - header_begin(), \"wrong nmethod size: %d != %d\",\n+           nmethod_size, (int)(code_end() - header_begin()));\n@@ -1508,1 +1520,1 @@\n-      _immutable_data     = data_end();\n+      _immutable_data     = blob_end();\n@@ -2130,1 +2142,1 @@\n-  if (_immutable_data != data_end()) {\n+  if (_immutable_data != blob_end()) {\n@@ -2132,1 +2144,5 @@\n-    _immutable_data = data_end(); \/\/ Valid not null address\n+    _immutable_data = blob_end(); \/\/ Valid not null address\n+  }\n+  if (_mutable_data != blob_end()) {\n+    os::free(_mutable_data);\n+    _mutable_data = blob_end(); \/\/ Valid not null address\n@@ -2146,1 +2162,1 @@\n-  return NMethodAccess<AS_NO_KEEPALIVE>::oop_load(oop_addr_at(index));\n+  return RawAccess<>::oop_load(oop_addr_at(index));\n@@ -2153,1 +2169,1 @@\n-  return NMethodAccess<ON_PHANTOM_OOP_REF>::oop_load(oop_addr_at(index));\n+  return RawAccess<ON_PHANTOM_OOP_REF>::oop_load(oop_addr_at(index));\n@@ -3065,4 +3081,0 @@\n-  if (relocation_size   () > 0) st->print_cr(\" relocation     [\" INTPTR_FORMAT \",\" INTPTR_FORMAT \"] = %d\",\n-                                             p2i(relocation_begin()),\n-                                             p2i(relocation_end()),\n-                                             relocation_size());\n@@ -3081,0 +3093,8 @@\n+  if (mutable_data_size() > 0) st->print_cr(\" mutable data [\" INTPTR_FORMAT \",\" INTPTR_FORMAT \"] = %d\",\n+                                             p2i(mutable_data_begin()),\n+                                             p2i(mutable_data_end()),\n+                                             immutable_data_size());\n+  if (relocation_size() > 0)   st->print_cr(\" relocation     [\" INTPTR_FORMAT \",\" INTPTR_FORMAT \"] = %d\",\n+                                             p2i(relocation_begin()),\n+                                             p2i(relocation_end()),\n+                                             relocation_size());\n@@ -3119,0 +3139,4 @@\n+  if (mutable_data_size() > 0)  st->print_cr(\" mutable data   [\" INTPTR_FORMAT \",\" INTPTR_FORMAT \"] = %d\",\n+                                             p2i(mutable_data_begin()),\n+                                             p2i(mutable_data_end()),\n+                                             mutable_data_size());\n","filename":"src\/hotspot\/share\/code\/nmethod.cpp","additions":69,"deletions":45,"binary":false,"changes":114,"status":"modified"},{"patch":"@@ -138,2 +138,0 @@\n-\/\/  [Relocation]\n-\/\/  - relocation information\n@@ -238,3 +236,2 @@\n-  \/\/ Offsets in mutable data section\n-  \/\/ _oops_offset == _data_offset,  offset where embedded oop table begins (inside data)\n-  uint16_t _metadata_offset; \/\/ embedded meta data table\n+  \/\/ mutable data section\n+  uint16_t _oops_size;\n@@ -242,1 +239,1 @@\n-  uint16_t _jvmci_data_offset;\n+  uint16_t _jvmci_data_size;\n@@ -308,1 +305,2 @@\n-          OopMapSet* oop_maps);\n+          OopMapSet* oop_maps,\n+          int mutable_data_size);\n@@ -315,0 +313,1 @@\n+          int mutable_data_size,\n@@ -529,1 +528,1 @@\n-  address stub_end              () const { return           data_begin()   ; }\n+  address stub_end              () const { return           code_end()     ; }\n@@ -536,3 +535,3 @@\n-  oop*    oops_begin            () const { return (oop*)        data_begin(); }\n-  oop*    oops_end              () const { return (oop*)       (data_begin() + _metadata_offset)      ; }\n-  Metadata** metadata_begin     () const { return (Metadata**) (data_begin() + _metadata_offset)      ; }\n+  oop*    oops_begin            () const { return (oop*)       (mutable_data_begin() + _relocation_size); }\n+  oop*    oops_end              () const { return (oop*)       (mutable_data_begin() + _relocation_size + _oops_size); }\n+  Metadata** metadata_begin     () const { return (Metadata**) (mutable_data_begin() + _relocation_size + _oops_size); }\n@@ -540,3 +539,3 @@\n-  Metadata** metadata_end       () const { return (Metadata**) (data_begin() + _jvmci_data_offset)    ; }\n-  address jvmci_data_begin      () const { return               data_begin() + _jvmci_data_offset     ; }\n-  address jvmci_data_end        () const { return               data_end(); }\n+  Metadata** metadata_end       () const { return (Metadata**) (mutable_data_end() - _jvmci_data_size); }\n+  address jvmci_data_begin      () const { return               mutable_data_end() - _jvmci_data_size; }\n+  address jvmci_data_end        () const { return               mutable_data_end(); }\n@@ -544,1 +543,1 @@\n-  Metadata** metadata_end       () const { return (Metadata**)  data_end(); }\n+  Metadata** metadata_end       () const { return (Metadata**)  mutable_data_end(); }\n","filename":"src\/hotspot\/share\/code\/nmethod.hpp","additions":14,"deletions":15,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -559,1 +559,0 @@\n-  nonstatic_field(CodeBlob,                    _data_offset,                                  int)                                   \\\n@@ -563,0 +562,2 @@\n+  nonstatic_field(CodeBlob,                    _mutable_data,                                 address)                               \\\n+  nonstatic_field(CodeBlob,                    _mutable_data_size,                            int)                                   \\\n@@ -585,2 +586,2 @@\n-  nonstatic_field(nmethod,                     _metadata_offset,                              u2)                                    \\\n-  nonstatic_field(nmethod,                     _scopes_pcs_offset,                            int)                                    \\\n+  nonstatic_field(nmethod,                     _oops_size,                                    u2)                                    \\\n+  nonstatic_field(nmethod,                     _scopes_pcs_offset,                            int)                                   \\\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -51,1 +51,0 @@\n-  private static CIntegerField dataOffsetField;\n@@ -54,0 +53,2 @@\n+  private static AddressField  mutableDataField;\n+  private static CIntegerField mutableDataSizeField;\n@@ -71,1 +72,0 @@\n-    dataOffsetField          = type.getCIntegerField(\"_data_offset\");\n@@ -74,0 +74,2 @@\n+    mutableDataField         = type.getAddressField(\"_mutable_data\");\n+    mutableDataSizeField     = type.getCIntegerField(\"_mutable_data_size\");\n@@ -95,1 +97,1 @@\n-  public Address contentEnd()     { return headerBegin().addOffsetTo(getDataOffset()); }\n+  public Address contentEnd()     { return headerBegin().addOffsetTo(getSize()); }\n@@ -99,1 +101,1 @@\n-  public Address codeEnd()        { return headerBegin().addOffsetTo(getDataOffset()); }\n+  public Address codeEnd()        { return headerBegin().addOffsetTo(getSize()); }\n@@ -101,1 +103,1 @@\n-  public Address dataBegin()      { return headerBegin().addOffsetTo(getDataOffset()); }\n+  public Address dataBegin()      { return mutableDataField.getValue(addr); }\n@@ -103,1 +105,2 @@\n-  public Address dataEnd()        { return headerBegin().addOffsetTo(getSize()); }\n+  public Address dataEnd()        { return (dataBegin() == null) ? dataBegin() :\n+                                        dataBegin().addOffsetTo(mutableDataSizeField.getValue(addr)); }\n@@ -112,2 +115,0 @@\n-  public int getDataOffset()      { return (int) dataOffsetField.getValue(addr); }\n-\n@@ -179,1 +180,1 @@\n-  public boolean blobContains(Address addr)    { return headerBegin() .lessThanOrEqual(addr) && dataEnd()   .greaterThan(addr); }\n+  public boolean blobContains(Address addr)    { return headerBegin() .lessThanOrEqual(addr) && codeEnd()   .greaterThan(addr); }\n@@ -186,1 +187,2 @@\n-  public boolean dataContains(Address addr)    { return dataBegin()   .lessThanOrEqual(addr) && dataEnd()   .greaterThan(addr); }\n+  public boolean dataContains(Address addr)    { return (dataBegin() == null) ? false :\n+                                                        dataBegin()   .lessThanOrEqual(addr) && dataEnd()   .greaterThan(addr); }\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/code\/CodeBlob.java","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -47,0 +47,3 @@\n+  private static AddressField  mutableDataField;\n+  private static CIntegerField mutableDataSizeField;\n+  private static CIntegerField relocationSizeField;\n@@ -54,1 +57,1 @@\n-  private static CIntField     metadataOffsetField;\n+  private static CIntField     oopsSizeField;\n@@ -88,0 +91,3 @@\n+    mutableDataField            = type.getAddressField(\"_mutable_data\");\n+    mutableDataSizeField        = type.getCIntegerField(\"_mutable_data_size\");\n+    relocationSizeField         = type.getCIntegerField(\"_relocation_size\");\n@@ -94,1 +100,1 @@\n-    metadataOffsetField         = new CIntField(type.getCIntegerField(\"_metadata_offset\"), 0);\n+    oopsSizeField               = new CIntField(type.getCIntegerField(\"_oops_size\"), 0);\n@@ -135,4 +141,0 @@\n-  public Address oopsBegin()            { return dataBegin();                                        }\n-  public Address oopsEnd()              { return dataBegin().addOffsetTo(getMetadataOffset());       }\n-  public Address metadataBegin()        { return dataBegin().addOffsetTo(getMetadataOffset());       }\n-  public Address metadataEnd()          { return dataEnd();                                          }\n@@ -153,0 +155,8 @@\n+  public Address mutableDataBegin()     { return mutableDataField.getValue(addr);                       }\n+  public Address mutableDataEnd()       { return mutableDataBegin().addOffsetTo(getMutableDataSize());  }\n+\n+  public Address oopsBegin()            { return mutableDataBegin().addOffsetTo(getRelocationSize());   }\n+  public Address oopsEnd()              { return mutableDataBegin().addOffsetTo(getRelocationSize() + getOopsSize());   }\n+  public Address metadataBegin()        { return mutableDataBegin().addOffsetTo(getRelocationSize() + getOopsSize());   }\n+  public Address metadataEnd()          { return mutableDataEnd();                                      }\n+\n@@ -154,0 +164,2 @@\n+  public int getMutableDataSize()       { return (int) mutableDataSizeField.getValue(addr);          }\n+  public int getRelocationSize()        { return (int) relocationSizeField.getValue(addr);           }\n@@ -538,1 +550,1 @@\n-  private int getMetadataOffset()     { return (int) metadataOffsetField    .getValue(addr); }\n+  private int getOopsSize()           { return (int) oopsSizeField          .getValue(addr); }\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/code\/NMethod.java","additions":19,"deletions":7,"binary":false,"changes":26,"status":"modified"}]}