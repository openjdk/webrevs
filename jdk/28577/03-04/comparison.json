{"files":[{"patch":"@@ -30,2 +30,3 @@\n- * @comment Add -Djavax.net.debug=all to the following line to enable SSL debugging\n- * @run main\/othervm SubjectAltNameIPv6\n+ * @comment Insert -Djavax.net.debug=all into the following lines to enable SSL debugging\n+ * @run main\/othervm SubjectAltNameIPv6 127.0.0.1\n+ * @run main\/othervm SubjectAltNameIPv6 [::1]\n@@ -53,0 +54,1 @@\n+import java.util.function.Consumer;\n@@ -71,0 +73,6 @@\n+    \/\/ SSLSocket object created by HttpsClient internally\n+    SSLSocket clientSSLSocket = null;\n+\n+    \/\/ the hostname the server socket is bound to\n+    String hostName;\n+\n@@ -83,1 +91,1 @@\n-                    InetAddress.getByName(\"[::1]\"));\n+                    InetAddress.getByName(hostName));\n@@ -120,1 +128,1 @@\n-        URI uri = new URI(\"https:\/\/[::1]:\" + serverPort + \"\/index.html\");\n+        URI uri = new URI(\"https:\/\/\" + hostName + \":\" + serverPort + \"\/index.html\");\n@@ -124,1 +132,2 @@\n-         * Simulate an external JSSE implementation.\n+         * Simulate an external JSSE implementation and store the client SSLSocket\n+         * used internally.\n@@ -126,1 +135,2 @@\n-        conn.setSSLSocketFactory(wrapSocketFactory(sf));\n+        conn.setSSLSocketFactory(wrapSocketFactory(sf,\n+                sslSocket -> clientSSLSocket = sslSocket));\n@@ -129,0 +139,6 @@\n+        var sniSN = clientSSLSocket.getSSLParameters().getServerNames();\n+        if( sniSN != null && !sniSN.isEmpty()) {\n+            throw new RuntimeException(\"SNI server name '\" +\n+                    sniSN.getFirst() + \"' must not be set.\");\n+        }\n+\n@@ -142,1 +158,1 @@\n-        new SubjectAltNameIPv6();\n+        new SubjectAltNameIPv6(args[0]);\n@@ -152,1 +168,2 @@\n-    SubjectAltNameIPv6() throws Exception {\n+    SubjectAltNameIPv6(String host) throws Exception {\n+        hostName = host;\n@@ -185,1 +202,1 @@\n-    private static SSLSocketFactory wrapSocketFactory(final SSLSocketFactory wrap) {\n+    private static SSLSocketFactory wrapSocketFactory(final SSLSocketFactory wrap, final Consumer<SSLSocket> store) {\n@@ -200,0 +217,4 @@\n+\n+                \/\/ store the underlying SSLSocket for later use\n+                store.accept(so);\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/HttpsURLConnection\/SubjectAltNameIPv6.java","additions":30,"deletions":9,"binary":false,"changes":39,"status":"modified"}]}