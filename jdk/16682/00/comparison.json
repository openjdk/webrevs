{"files":[{"patch":"@@ -39,3 +39,3 @@\n-#include <stdlib.h>\n-#include <stdio.h>\n-#include <string.h>\n+#include <cstdlib>\n+#include <cstdio>\n+#include <cstring>\n@@ -372,1 +372,2 @@\n-        goto err;\n+        delete[] value;\n+        return GSS_S_FAILURE;\n@@ -377,1 +378,2 @@\n-        goto err;\n+        delete[] value;\n+        return GSS_S_FAILURE;\n@@ -393,1 +395,2 @@\n-        goto err;\n+        delete[] value;\n+        return GSS_S_FAILURE;\n@@ -412,2 +415,1 @@\n-    gss_name_struct* name;\n-    name = new gss_name_struct;\n+    gss_name_struct* name = new gss_name_struct;\n@@ -415,1 +417,2 @@\n-        goto err;\n+        delete[] value;\n+        return GSS_S_FAILURE;\n@@ -420,3 +423,0 @@\n-err:\n-    delete[] value;\n-    return GSS_S_FAILURE;\n@@ -533,1 +533,4 @@\n-        goto err;\n+        if (fullname != name) {\n+            delete[] fullname;\n+        }\n+        return result;\n@@ -537,2 +540,1 @@\n-    size_t namelen;\n-    namelen = wcslen(fullname);\n+    size_t namelen = wcslen(fullname);\n@@ -540,1 +542,4 @@\n-        goto err;\n+        if (fullname != name) {\n+            delete[] fullname;\n+        }\n+        return result;\n@@ -545,4 +550,2 @@\n-    int mechLen;\n-    mechLen = KRB5_OID.length;\n-    char* buffer;\n-    buffer = (char*) malloc(10 + mechLen + len);\n+    int mechLen = KRB5_OID.length;\n+    char* buffer = (char*) malloc(10 + mechLen + len);\n@@ -550,1 +553,4 @@\n-        goto err;\n+        if (fullname != name) {\n+            delete[] fullname;\n+        }\n+        return result;\n@@ -565,1 +571,4 @@\n-        goto err;\n+        if (fullname != name) {\n+            delete[] fullname;\n+        }\n+        return result;\n@@ -570,1 +579,1 @@\n-err:\n+\n@@ -907,1 +916,10 @@\n-        goto err;\n+        if (firstTime) {\n+            OM_uint32 dummy;\n+            gss_delete_sec_context(&dummy, context_handle, GSS_C_NO_BUFFER);\n+        }\n+        delete newCred;\n+        if (output_token->value) {\n+            gss_release_buffer(NULL, output_token);\n+        }\n+        output_token = GSS_C_NO_BUFFER;\n+        return GSS_S_FAILURE;\n@@ -911,2 +929,1 @@\n-    int flag;\n-    flag = flag_gss_to_sspi(req_flags) | ISC_REQ_ALLOCATE_MEMORY;\n+    int flag = flag_gss_to_sspi(req_flags) | ISC_REQ_ALLOCATE_MEMORY;\n@@ -943,1 +960,10 @@\n-                goto err;\n+                if (firstTime) {\n+                    OM_uint32 dummy;\n+                    gss_delete_sec_context(&dummy, context_handle, GSS_C_NO_BUFFER);\n+                }\n+                delete newCred;\n+                if (output_token->value) {\n+                    gss_release_buffer(NULL, output_token);\n+                }\n+                output_token = GSS_C_NO_BUFFER;\n+                return GSS_S_FAILURE;\n@@ -1004,1 +1030,10 @@\n-            goto err;\n+            if (firstTime) {\n+                OM_uint32 dummy;\n+                gss_delete_sec_context(&dummy, context_handle, GSS_C_NO_BUFFER);\n+            }\n+            delete newCred;\n+            if (output_token->value) {\n+                gss_release_buffer(NULL, output_token);\n+            }\n+            output_token = GSS_C_NO_BUFFER;\n+            return GSS_S_FAILURE;\n@@ -1016,1 +1051,10 @@\n-            goto err;\n+            if (firstTime) {\n+                OM_uint32 dummy;\n+                gss_delete_sec_context(&dummy, context_handle, GSS_C_NO_BUFFER);\n+            }\n+            delete newCred;\n+            if (output_token->value) {\n+                gss_release_buffer(NULL, output_token);\n+            }\n+            output_token = GSS_C_NO_BUFFER;\n+            return GSS_S_FAILURE;\n@@ -1022,11 +1066,0 @@\n-err:\n-    if (firstTime) {\n-        OM_uint32 dummy;\n-        gss_delete_sec_context(&dummy, context_handle, GSS_C_NO_BUFFER);\n-    }\n-    delete newCred;\n-    if (output_token->value) {\n-        gss_release_buffer(NULL, output_token);\n-    }\n-    output_token = GSS_C_NO_BUFFER;\n-    return GSS_S_FAILURE;\n","filename":"src\/java.security.jgss\/windows\/native\/libsspi_bridge\/sspi.cpp","additions":73,"deletions":40,"binary":false,"changes":113,"status":"modified"}]}