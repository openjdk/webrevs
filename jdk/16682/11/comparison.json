{"files":[{"patch":"@@ -39,3 +39,3 @@\n-#include <stdlib.h>\n-#include <stdio.h>\n-#include <string.h>\n+#include <cstdlib>\n+#include <cstdio>\n+#include <cstring>\n@@ -44,0 +44,1 @@\n+#include <memory>\n@@ -370,3 +371,3 @@\n-    SEC_WCHAR* value = new SEC_WCHAR[len + 1];\n-    if (value == NULL) {\n-        goto err;\n+    std::unique_ptr<SEC_WCHAR[]> value(new SEC_WCHAR[len + 1]);\n+    if (value == nullptr) {\n+        return GSS_S_FAILURE;\n@@ -375,1 +376,1 @@\n-    len = MultiByteToWideChar(CP_UTF8, 0, input, len, value, len+1);\n+    len = MultiByteToWideChar(CP_UTF8, 0, input, len, value.get(), len+1);\n@@ -377,1 +378,1 @@\n-        goto err;\n+        return GSS_S_FAILURE;\n@@ -381,1 +382,1 @@\n-    PP(\"import_name from %ls\", value);\n+    PP(\"import_name from %ls\", value.get());\n@@ -383,1 +384,1 @@\n-    if (len > 33 && !wcscmp(value+len-33, L\"@WELLKNOWN:ORG.H5L.REFERALS-REALM\")) {\n+    if (len > 33 && !wcscmp(value.get()+len-33, L\"@WELLKNOWN:ORG.H5L.REFERALS-REALM\")) {\n@@ -393,1 +394,1 @@\n-        goto err;\n+        return GSS_S_FAILURE;\n@@ -409,1 +410,1 @@\n-        PP(\"Host-based service now %ls\", value);\n+        PP(\"Host-based service now %ls\", value.get());\n@@ -411,5 +412,4 @@\n-    PP(\"import_name to %ls\", value);\n-    gss_name_struct* name;\n-    name = new gss_name_struct;\n-    if (name == NULL) {\n-        goto err;\n+    PP(\"import_name to %ls\", value.get());\n+    gss_name_struct* name = new gss_name_struct;\n+    if (name == nullptr) {\n+        return GSS_S_FAILURE;\n@@ -417,1 +417,1 @@\n-    name->name = value;\n+    name->name = value.get();\n@@ -420,3 +420,0 @@\n-err:\n-    delete[] value;\n-    return GSS_S_FAILURE;\n@@ -537,2 +534,1 @@\n-    size_t namelen;\n-    namelen = wcslen(fullname);\n+    size_t namelen = wcslen(fullname);\n@@ -545,5 +541,3 @@\n-    int mechLen;\n-    mechLen = KRB5_OID.length;\n-    char* buffer;\n-    buffer = (char*) malloc(10 + mechLen + len);\n-    if (buffer == NULL) {\n+    int mechLen = KRB5_OID.length;\n+    char* buffer = static_cast<char*>(std::malloc(10 + mechLen + len));\n+    if (buffer == nullptr) {\n@@ -911,2 +905,1 @@\n-    int flag;\n-    flag = flag_gss_to_sspi(req_flags) | ISC_REQ_ALLOCATE_MEMORY;\n+    int flag = flag_gss_to_sspi(req_flags) | ISC_REQ_ALLOCATE_MEMORY;\n","filename":"src\/java.security.jgss\/windows\/native\/libsspi_bridge\/sspi.cpp","additions":23,"deletions":30,"binary":false,"changes":53,"status":"modified"}]}