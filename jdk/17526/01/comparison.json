{"files":[{"patch":"@@ -173,0 +173,8 @@\n+        \/\/ Initially, determine existing directory from class name.\n+        \/\/ [pack$age . ] na$me [ $ enclo$ed [$ dee$per] ]\n+        var lastDot = name.lastIndexOf(\".\");\n+        var packageName = lastDot == -1 ? \"\" : name.substring(0, lastDot);\n+        var packagePath = descriptor.sourceRootPath().resolve(packageName.replace('.', '\/'));\n+        \/\/ Trivial case: no matching directory exists\n+        if (!Files.isDirectory(packagePath)) return null;\n+\n@@ -174,4 +182,7 @@\n-        var firstDollarSign = name.indexOf('$'); \/\/ [package . ] name [ $ enclosed [$ deeper] ]\n-        var packageAndClassName = firstDollarSign == -1 ? name : name.substring(0, firstDollarSign);\n-        var path = packageAndClassName.replace('.', '\/') + \".java\";\n-        var file = descriptor.sourceRootPath().resolve(path);\n+        var candidate = name.substring(lastDot + 1, name.length()); \/\/ \"na$me$enclo$ed$dee$per\"\n+        \/\/ For each `$` in the name try to find the first matching compilation unit.\n+        while (candidate.contains(\"$\")) {\n+            if (Files.exists(packagePath.resolve(candidate + \".java\"))) break;\n+            candidate = candidate.substring(0, candidate.lastIndexOf(\"$\"));\n+        }\n+        var file = packagePath.resolve(candidate + \".java\");\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/launcher\/MemoryContext.java","additions":15,"deletions":4,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -78,1 +78,3 @@\n-                        System.out.println(Class.forName(\"p.q.Unit$First$Second\"));\n+                        System.out.println(Class.forName(\"p.q.Unit$Fir$t\"));\n+                        System.out.println(Class.forName(\"p.q.Unit$123$Fir$t$$econd\"));\n+                        System.out.println(Class.forName(\"$.$.$\"));\n@@ -93,2 +95,2 @@\n-                      record First() {\n-                        record Second() {}\n+                      record Fir$t() {\n+                        record $econd() {}\n@@ -98,0 +100,15 @@\n+        Files.writeString(pq.resolve(\"Unit$123.java\"),\n+                    \"\"\"\n+                    package p.q;\n+                    record Unit$123() {\n+                      record Fir$t() {\n+                        record $econd() {}\n+                      }\n+                    }\n+                    \"\"\");\n+        var $$ = Files.createDirectories(base.resolve(\"$\/$\"));\n+        Files.writeString($$.resolve(\"$.java\"),\n+                    \"\"\"\n+                    package $.$;\n+                    record $($ $) {}\n+                    \"\"\");\n@@ -104,1 +121,3 @@\n-                        class p.q.Unit$First$Second\n+                        class p.q.Unit$Fir$t\n+                        class p.q.Unit$123$Fir$t$$econd\n+                        class $.$.$\n","filename":"test\/langtools\/tools\/javac\/launcher\/MultiFileSourceLauncherTests.java","additions":23,"deletions":4,"binary":false,"changes":27,"status":"modified"}]}