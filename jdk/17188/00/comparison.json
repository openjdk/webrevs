{"files":[{"patch":"@@ -309,1 +309,1 @@\n-  \/\/ These are macros so that, if the assert fires, we get the correct\n+  \/\/ These are assert functions so that, if the assert fires, we get the correct\n@@ -312,63 +312,7 @@\n-#define heap_locking_asserts_params(_extra_message_)                          \\\n-  \"%s : Heap_lock locked: %s, at safepoint: %s, is VM thread: %s\",            \\\n-  (_extra_message_),                                                          \\\n-  BOOL_TO_STR(Heap_lock->owned_by_self()),                                    \\\n-  BOOL_TO_STR(SafepointSynchronize::is_at_safepoint()),                       \\\n-  BOOL_TO_STR(Thread::current()->is_VM_thread())\n-\n-#define assert_heap_locked()                                                  \\\n-  do {                                                                        \\\n-    assert(Heap_lock->owned_by_self(),                                        \\\n-           heap_locking_asserts_params(\"should be holding the Heap_lock\"));   \\\n-  } while (0)\n-\n-#define assert_heap_locked_or_at_safepoint(_should_be_vm_thread_)             \\\n-  do {                                                                        \\\n-    assert(Heap_lock->owned_by_self() ||                                      \\\n-           (SafepointSynchronize::is_at_safepoint() &&                        \\\n-             ((_should_be_vm_thread_) == Thread::current()->is_VM_thread())), \\\n-           heap_locking_asserts_params(\"should be holding the Heap_lock or \"  \\\n-                                        \"should be at a safepoint\"));         \\\n-  } while (0)\n-\n-#define assert_heap_locked_and_not_at_safepoint()                             \\\n-  do {                                                                        \\\n-    assert(Heap_lock->owned_by_self() &&                                      \\\n-                                    !SafepointSynchronize::is_at_safepoint(), \\\n-          heap_locking_asserts_params(\"should be holding the Heap_lock and \"  \\\n-                                       \"should not be at a safepoint\"));      \\\n-  } while (0)\n-\n-#define assert_heap_not_locked()                                              \\\n-  do {                                                                        \\\n-    assert(!Heap_lock->owned_by_self(),                                       \\\n-        heap_locking_asserts_params(\"should not be holding the Heap_lock\"));  \\\n-  } while (0)\n-\n-#define assert_heap_not_locked_and_not_at_safepoint()                         \\\n-  do {                                                                        \\\n-    assert(!Heap_lock->owned_by_self() &&                                     \\\n-                                    !SafepointSynchronize::is_at_safepoint(), \\\n-      heap_locking_asserts_params(\"should not be holding the Heap_lock and \"  \\\n-                                   \"should not be at a safepoint\"));          \\\n-  } while (0)\n-\n-#define assert_at_safepoint_on_vm_thread()                                        \\\n-  do {                                                                            \\\n-    assert_at_safepoint();                                                        \\\n-    assert(Thread::current_or_null() != nullptr, \"no current thread\");            \\\n-    assert(Thread::current()->is_VM_thread(), \"current thread is not VM thread\"); \\\n-  } while (0)\n-\n-#ifdef ASSERT\n-#define assert_used_and_recalculate_used_equal(g1h)                           \\\n-  do {                                                                        \\\n-    size_t cur_used_bytes = g1h->used();                                      \\\n-    size_t recal_used_bytes = g1h->recalculate_used();                        \\\n-    assert(cur_used_bytes == recal_used_bytes, \"Used(\" SIZE_FORMAT \") is not\" \\\n-           \" same as recalculated used(\" SIZE_FORMAT \").\",                    \\\n-           cur_used_bytes, recal_used_bytes);                                 \\\n-  } while (0)\n-#else\n-#define assert_used_and_recalculate_used_equal(g1h) do {} while(0)\n-#endif\n+  void assert_heap_locked() const NOT_DEBUG_RETURN;\n+  void assert_heap_locked_or_at_safepoint(bool should_be_vm_thread) const NOT_DEBUG_RETURN;\n+  void assert_heap_locked_and_not_at_safepoint() const NOT_DEBUG_RETURN;\n+  void assert_heap_not_locked() const NOT_DEBUG_RETURN;\n+  void assert_heap_not_locked_and_not_at_safepoint() const NOT_DEBUG_RETURN;\n+  void assert_at_safepoint_on_vm_thread() const NOT_DEBUG_RETURN;\n+  void assert_used_and_recalculate_used_equal() const NOT_DEBUG_RETURN;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.hpp","additions":8,"deletions":64,"binary":false,"changes":72,"status":"modified"},{"patch":"@@ -316,0 +316,56 @@\n+#define heap_locking_asserts_params(_extra_message_)                          \\\n+  \"%s : Heap_lock locked: %s, at safepoint: %s, is VM thread: %s\",            \\\n+  (_extra_message_),                                                          \\\n+  BOOL_TO_STR(Heap_lock->owned_by_self()),                                    \\\n+  BOOL_TO_STR(SafepointSynchronize::is_at_safepoint()),                       \\\n+  BOOL_TO_STR(Thread::current()->is_VM_thread())\n+\n+inline void G1CollectedHeap::assert_heap_locked() const {\n+  assert(Heap_lock->owned_by_self(),\n+          heap_locking_asserts_params(\"should be holding the Heap_lock\"));\n+}\n+\n+inline void G1CollectedHeap::\n+assert_heap_locked_or_at_safepoint(bool should_be_vm_thread) const {\n+  assert(Heap_lock->owned_by_self() ||\n+          (SafepointSynchronize::is_at_safepoint() &&\n+            ((should_be_vm_thread) == Thread::current()->is_VM_thread())),\n+          heap_locking_asserts_params(\"should be holding the Heap_lock or \"\n+                                      \"should be at a safepoint\"));\n+}\n+\n+inline void G1CollectedHeap::assert_heap_locked_and_not_at_safepoint() const {\n+  assert(Heap_lock->owned_by_self() &&\n+                                  !SafepointSynchronize::is_at_safepoint(),\n+        heap_locking_asserts_params(\"should be holding the Heap_lock and \"\n+                                      \"should not be at a safepoint\"));\n+}\n+\n+inline void G1CollectedHeap::assert_heap_not_locked() const {\n+  assert(!Heap_lock->owned_by_self(),\n+      heap_locking_asserts_params(\"should not be holding the Heap_lock\"));\n+}\n+\n+inline void G1CollectedHeap::assert_heap_not_locked_and_not_at_safepoint() const {\n+  assert(!Heap_lock->owned_by_self() &&\n+                                  !SafepointSynchronize::is_at_safepoint(),\n+    heap_locking_asserts_params(\"should not be holding the Heap_lock and \"\n+                                  \"should not be at a safepoint\"));\n+}\n+\n+inline void G1CollectedHeap::assert_at_safepoint_on_vm_thread() const {\n+  assert_at_safepoint();\n+  assert(Thread::current_or_null() != nullptr, \"no current thread\");\n+  assert(Thread::current()->is_VM_thread(), \"current thread is not VM thread\");\n+}\n+\n+inline void G1CollectedHeap::assert_used_and_recalculate_used_equal() const {\n+#if ASSERT\n+  size_t cur_used_bytes = used();\n+  size_t recal_used_bytes = recalculate_used();\n+  assert(cur_used_bytes == recal_used_bytes, \"Used(\" SIZE_FORMAT \") is not\"\n+          \" same as recalculated used(\" SIZE_FORMAT \").\",\n+          cur_used_bytes, recal_used_bytes);\n+#endif\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.inline.hpp","additions":56,"deletions":0,"binary":false,"changes":56,"status":"modified"}]}