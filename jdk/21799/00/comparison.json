{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,0 +48,5 @@\n+\n+BOOL isCDROM(LPCWSTR path) {\n+    UINT driveType = GetDriveTypeW(path);\n+    return (driveType == DRIVE_CDROM);\n+}\n@@ -82,1 +87,1 @@\n-    if (pfnGetDiskSpaceInformation != NULL) {\n+    if (pfnGetDiskSpaceInformation != NULL && !isCDROM(path)) {\n@@ -103,0 +108,44 @@\n+    } else if (isCDROM(path)) {\n+        \/\/ use df\n+        char cmd[256];\n+        snprintf(cmd, sizeof(cmd), \"df -k -P %ls 2>&1\", path);\n+\n+        FILE *fp = _popen(cmd, \"r\");\n+        if (fp == NULL) {\n+            (*env)->ReleaseStringChars(env, root, strchars);\n+            JNU_ThrowByNameWithLastError(env, \"java\/lang\/RuntimeException\",\n+                                         \"popen\");\n+            return JNI_FALSE;\n+        }\n+\n+        char buffer[1024];\n+        int i = 0;\n+        int found = 0;\n+        while (fgets(buffer, sizeof(buffer), fp) != NULL) {\n+            \/\/ skip header and error message containing \"No such file or directory\"\n+            \/\/ meaning that the CD-ROM drive does not have a disk mounted\n+            if (i++ == 0) continue;\n+\n+            char filesystem[256];\n+            long blocks, used, available;\n+            if (sscanf(buffer, \"%s %ld %ld %ld\", filesystem, &blocks, &used, &available) == 4) {\n+                array[0] = (jlong)blocks * 1024;\n+                array[1] = (jlong)used * 1024;\n+                array[2] = array[0] - array[1];\n+                array[3] = (jlong)available * 1024;\n+                found = 1;\n+                break;\n+            }\n+        }\n+\n+        _pclose(fp);\n+\n+        if (!found) {\n+            \/\/ df did not produce output\n+            array[0] = 0;\n+            array[1] = 0;\n+            array[2] = 0;\n+            array[3] = 0;\n+        }\n+\n+        (*env)->ReleaseStringChars(env, root, strchars);\n","filename":"test\/jdk\/java\/io\/File\/libGetXSpace.c","additions":51,"deletions":2,"binary":false,"changes":53,"status":"modified"}]}