{"files":[{"patch":"@@ -221,3 +221,7 @@\n-  __ lbz(tmp1, in_bytes(ShenandoahThreadLocalData::gc_state_offset()), R16_thread);\n-\n-  __ andi_(tmp1, tmp1, ShenandoahHeap::MARKING);\n+  if (in_bytes(SATBMarkQueue::byte_width_of_active()) == 4) {\n+    __ lwz(tmp1, in_bytes(ShenandoahThreadLocalData::satb_mark_queue_active_offset()), R16_thread);\n+  } else {\n+    guarantee(in_bytes(SATBMarkQueue::byte_width_of_active()) == 1, \"Assumption\");\n+    __ lbz(tmp1, in_bytes(ShenandoahThreadLocalData::satb_mark_queue_active_offset()), R16_thread);\n+  }\n+  __ cmpdi(CCR0, tmp1, 0);\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/shenandoah\/shenandoahBarrierSetAssembler_ppc.cpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -226,3 +226,8 @@\n-  Address gc_state(thread, in_bytes(ShenandoahThreadLocalData::gc_state_offset()));\n-  __ testb(gc_state, ShenandoahHeap::MARKING);\n-  __ jcc(Assembler::zero, done);\n+  \/\/ Is marking active?\n+  if (in_bytes(SATBMarkQueue::byte_width_of_active()) == 4) {\n+    __ cmpl(in_progress, 0);\n+  } else {\n+    assert(in_bytes(SATBMarkQueue::byte_width_of_active()) == 1, \"Assumption\");\n+    __ cmpb(in_progress, 0);\n+  }\n+  __ jcc(Assembler::equal, done);\n","filename":"src\/hotspot\/cpu\/x86\/gc\/shenandoah\/shenandoahBarrierSetAssembler_x86.cpp","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"}]}