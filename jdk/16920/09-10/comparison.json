{"files":[{"patch":"@@ -914,2 +914,3 @@\n-static int max_handletable = 0;\n-static int g_handletable_used = 0;\n+constexpr unsigned init_num_handles = 128;\n+static unsigned max_handletable = 0;\n+static unsigned g_handletable_used = 0;\n@@ -1051,1 +1052,1 @@\n-    int i = 0;\n+    unsigned i = 0;\n@@ -1068,21 +1069,7 @@\n-        \/\/ No place in array anymore.\n-        if (max_handletable == 0) {\n-          \/\/ First time we allocate memory for 128 Entries\n-          char* ptmp = (char*)::malloc(128 * sizeof(struct handletableentry));\n-          assert(ptmp != 0, \"no more memory for handletable\");\n-          if (ptmp == nullptr) {\n-            *error_report = \"dlopen: no more memory for handletable\";\n-            return nullptr;\n-          }\n-          max_handletable = 128;\n-          p_handletable = (struct handletableentry*)ptmp;\n-        } else {\n-          \/\/ we already use malloced memory, just double the size\n-          char* ptmp = (char*)::realloc(p_handletable, 2 * max_handletable * sizeof(struct handletableentry));\n-          assert(ptmp != 0, \"no more memory for handletable\");\n-          if (ptmp == nullptr) {\n-            *error_report = \"dlopen: no more memory for handletable\";\n-            return nullptr;\n-          }\n-          max_handletable *= 2;\n-          p_handletable = (struct handletableentry*)ptmp;\n+        \/\/ No place in array anymore; increase array.\n+        unsigned new_max = MAX2(max_handletable * 2, init_num_handles);\n+        struct handletableentry* new_tab = (struct handletableentry*)::realloc(p_handletable, new_max * sizeof(struct handletableentry));\n+        assert(new_tab != nullptr, \"no more memory for handletable\");\n+        if (new_tab == nullptr) {\n+          *error_report = \"dlopen: no more memory for handletable\";\n+          return nullptr;\n@@ -1090,0 +1077,2 @@\n+        max_handletable = new_max;\n+        p_handletable = new_tab;\n@@ -1113,1 +1102,1 @@\n-  int i = 0;\n+  unsigned i = 0;\n","filename":"src\/hotspot\/os\/aix\/porting_aix.cpp","additions":14,"deletions":25,"binary":false,"changes":39,"status":"modified"}]}