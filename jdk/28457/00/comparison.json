{"files":[{"patch":"@@ -57,1 +57,0 @@\n-message.creating-association-with-null-extension=Creating association with null extension.\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/resources\/LinuxResources.properties","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,3 +29,1 @@\n-error.must-sign-app-store=Mac App Store apps must be signed, and signing has been disabled by bundler configuration\n-error.must-sign-app-store.advice=Use --mac-sign option with appropriate user-name and keychain\n-error.certificate.expired=Error: Certificate expired {0}\n+error.certificate.expired=Certificate expired {0}\n@@ -34,2 +32,2 @@\n-error.app-image.mac-sign.required=Error: --mac-sign option is required with predefined application image and with type [app-image]\n-error.tool.failed.with.output=Error: \"{0}\" failed with following output:\n+error.app-image.mac-sign.required=--mac-sign option is required with predefined application image and with type [app-image]\n+error.tool.failed.with.output=\"{0}\" failed with following output:\n@@ -39,1 +37,0 @@\n-resource.bundle-config-file=Bundle config file\n@@ -62,5 +59,2 @@\n-message.creating-association-with-null-extension=Creating association with null extension.\n-message.ignoring.symlink=Warning: codesign is skipping the symlink {0}.\n-message.already.signed=File already signed: {0}.\n-message.keychain.error=Error: unable to get keychain list.\n-message.invalid-identifier=invalid mac bundle identifier [{0}].\n+message.keychain.error=Unable to get keychain list.\n+message.invalid-identifier=Invalid mac bundle identifier [{0}].\n@@ -69,1 +63,0 @@\n-message.running-script=Running shell script on application image [{0}].\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/resources\/MacResources.properties","additions":5,"deletions":12,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -27,2 +27,2 @@\n-import java.io.IOException;\n-import java.nio.file.Files;\n+import static jdk.jpackage.internal.cli.StandardValidator.IS_DIRECTORY_EMPTY_OR_NON_EXISTENT_PREDICATE;\n+\n@@ -44,13 +44,5 @@\n-        var exceptionBuilder = I18N.buildConfigException(\"ERR_BuildRootInvalid\", root);\n-        if (Files.isDirectory(root)) {\n-            try (var rootDirContents = Files.list(root)) {\n-                if (rootDirContents.findAny().isPresent()) {\n-                    \/\/ The root directory is not empty.\n-                    throw exceptionBuilder.create();\n-                }\n-            } catch (IOException ioe) {\n-                throw exceptionBuilder.cause(ioe).create();\n-            }\n-        } else if (Files.exists(root)) {\n-            \/\/ The root is not a directory.\n-            throw exceptionBuilder.create();\n+        \/\/ The directory should be validated earlier with a proper error message.\n+        \/\/ Here is only a sanity check.\n+        if (!IS_DIRECTORY_EMPTY_OR_NON_EXISTENT_PREDICATE.test(root)) {\n+            throw new UnsupportedOperationException(\n+                    String.format(\"Root work directory [%s] should be empty or non existent\", root));\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/BuildEnvBuilder.java","additions":7,"deletions":15,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -421,1 +421,2 @@\n-                asOptionList(MAC_SIGNING_KEY_NAME, MAC_INSTALLER_SIGN_IDENTITY)\n+                asOptionList(MAC_SIGNING_KEY_NAME, MAC_INSTALLER_SIGN_IDENTITY),\n+                asOptionList(MODULE, MAIN_JAR)\n@@ -424,4 +425,0 @@\n-        config.add(new MutualExclusiveOptions(asOptionList(MODULE, MAIN_JAR), _ -> {\n-            return error(\"ERR_BothMainJarAndModule\");\n-        }));\n-\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/OptionsAnalyzer.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -35,1 +35,0 @@\n-import static jdk.jpackage.internal.cli.StandardOptionValueExceptionFactory.ERROR_WITHOUT_CONTEXT;\n@@ -180,4 +179,1 @@\n-    public static final OptionValue<Path> LICENSE_FILE = fileOption(\"license-file\")\n-            .validatorExceptionFormatString(\"ERR_LicenseFileNotExit\")\n-            .validatorExceptionFactory(ERROR_WITHOUT_CONTEXT)\n-            .create();\n+    public static final OptionValue<Path> LICENSE_FILE = fileOption(\"license-file\").create();\n@@ -219,3 +215,0 @@\n-                    return ERROR_WITH_VALUE_AND_OPTION_NAME.create(optionName, optionValue, formatString, cause);\n-                } else {\n-                    return ERROR_WITH_VALUE.create(optionName, optionValue, formatString, cause);\n@@ -223,0 +216,1 @@\n+                return ERROR_WITH_VALUE_AND_OPTION_NAME.create(optionName, optionValue, formatString, cause);\n@@ -224,1 +218,1 @@\n-            .validatorExceptionFormatString(\"ERR_BuildRootInvalid\")\n+            .validatorExceptionFormatString(\"error.parameter-not-empty-directory\")\n@@ -239,2 +233,0 @@\n-            .validatorExceptionFactory(ERROR_WITH_VALUE)\n-            .validatorExceptionFormatString(\"ERR_AppImageNotExist\")\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/StandardOption.java","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -50,1 +50,0 @@\n-message.module-class=Using class \"{0}\" from module \"{1}\" as application main class\n@@ -61,1 +60,1 @@\n-error.root-exists=Error: Application destination directory {0} already exists\n+error.root-exists=Application destination directory {0} already exists\n@@ -76,0 +75,1 @@\n+error.parameter-not-empty-directory=The value \"{0}\" provided for parameter {1} is not an empty directory or non existent path\n@@ -104,4 +104,4 @@\n-error.missing-app-image-file=Error: \"{0}\" file is missing in the predefined app image \"{1}\"\n-error.invalid-app-image-file=Error: \"{0}\" file in the predefined app image \"{1}\" is corrupted or was created by another version of jpackage\n-error.malformed-app-image-file=Error: \"{0}\" file in the predefined app image \"{1}\" contains malformed XML data\n-error.reading-app-image-file=Error: Failed to read \"{0}\" file in the predefined app image \"{1}\"\n+error.missing-app-image-file=\"{0}\" file is missing in the predefined app image \"{1}\"\n+error.invalid-app-image-file=\"{0}\" file in the predefined app image \"{1}\" is corrupted or was created by another version of jpackage\n+error.malformed-app-image-file=\"{0}\" file in the predefined app image \"{1}\" contains malformed XML data\n+error.reading-app-image-file=Failed to read \"{0}\" file in the predefined app image \"{1}\"\n@@ -111,23 +111,15 @@\n-error.invalid-option-value=Invalid value \"{0}\" of option {1}\n-\n-ERR_NoMainClass=Error: Main application class is missing\n-ERR_UnsupportedOption=Error: Option [{0}] is not valid on this platform\n-ERR_InvalidTypeOption=Error: Option [{0}] is not valid with type [{1}]\n-ERR_NoInstallerEntryPoint=Error: Option [{0}] is not valid without --module or --main-jar entry point option\n-ERR_MutuallyExclusiveOptions=Error: Mutually exclusive options [{0}] and [{1}]\n-ERR_InvalidOptionWithAppImageSigning=Error: Option [{0}] is not valid when signing application image\n-\n-ERR_MissingArgument=Error: Missing argument: {0}\n-ERR_MissingArgument2=Error: Missing argument: {0} or {1}\n-ERR_AppImageNotExist=Error: App image directory \"{0}\" does not exist\n-ERR_NoAddLauncherName=Error: --add-launcher option requires a name and a file path (--add-launcher <name>=<file path>)\n-ERR_InvalidAppName=Error: Invalid Application name: {0}\n-ERR_InvalidSLName=Error: Invalid Add Launcher name: {0}\n-ERR_LicenseFileNotExit=Error: Specified license file does not exist\n-ERR_BuildRootInvalid=Error: temp ({0}) must be non-existent or empty directory\n-ERR_InvalidOption=Error: Invalid Option: [{0}]\n-ERR_InvalidInstallerType=Error: Invalid or unsupported type: [{0}]\n-ERR_BothMainJarAndModule=Error: Cannot have both --main-jar and --module Options\n-ERR_NoEntryPoint=Error: creating application image requires --main-jar or --module Option\n-ERR_CannotParseOptions=Error: Processing @filename option: {0}\n-ERR_MissingJLinkOptMacAppStore=Error: --mac-app-store argument requires a {0} option for --jlink-options argument\n+ERR_NoMainClass=Main application class is missing\n+ERR_UnsupportedOption=Option [{0}] is not valid on this platform\n+ERR_InvalidTypeOption=Option [{0}] is not valid with type [{1}]\n+ERR_NoInstallerEntryPoint=Option [{0}] is not valid without --module or --main-jar entry point option\n+ERR_MutuallyExclusiveOptions=Mutually exclusive options [{0}] and [{1}]\n+ERR_InvalidOptionWithAppImageSigning=Option [{0}] is not valid when signing application image\n+\n+ERR_MissingArgument2=Missing argument: {0} or {1}\n+ERR_InvalidAppName=Invalid Application name: {0}\n+ERR_InvalidSLName=Invalid Add Launcher name: {0}\n+ERR_InvalidOption=Invalid Option: [{0}]\n+ERR_InvalidInstallerType=Invalid or unsupported type: [{0}]\n+ERR_NoEntryPoint=creating application image requires --main-jar or --module Option\n+ERR_CannotParseOptions=Processing @filename option: {0}\n+ERR_MissingJLinkOptMacAppStore=--mac-app-store argument requires a {0} option for --jlink-options argument\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources.properties","additions":21,"deletions":29,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-resource.setup-icon=setup dialog icon\n@@ -63,1 +62,0 @@\n-message.creating-association-with-null-extension=Creating association with null extension.\n@@ -70,1 +68,0 @@\n-message.invalid.install.dir=Warning: Invalid install directory {0}. Install directory should be a relative sub-path under the default installation location such as \"Program Files\". Defaulting to application name \"{1}\".\n","filename":"src\/jdk.jpackage\/windows\/classes\/jdk\/jpackage\/internal\/resources\/WinResources.properties","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1,39 +1,39 @@\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 0.2]; errors=[message.version-string-first-number-not-zero, error.invalid-cfbundle-version.advice])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 1.2.3.4]; errors=[message.version-string-too-many-components, error.invalid-cfbundle-version.advice])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 1.]; errors=[error.version-string-zero-length-component+[1.]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 1.b.3]; errors=[error.version-string-invalid-component+[1.b.3, b.3]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, ]; errors=[error.version-string-empty])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --add-modules]; errors=[error.blocked.option+[--add-modules]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --foo]; errors=[error.jlink.failed+[Error: unknown option: --foo]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --module-path]; errors=[error.blocked.option+[--module-path]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --output]; errors=[error.blocked.option+[--output]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--main-jar, non-existent.jar]; errors=[error.main-jar-does-not-exist+[non-existent.jar]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--runtime-image, @@EMPTY_DIR@@]; errors=[error.invalid-runtime-image-missing-file+[@@EMPTY_DIR@@, lib\/**\/libjli.dylib]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_BUNDLE@@]; errors=[error.invalid-runtime-image-missing-file+[@@INVALID_MAC_RUNTIME_BUNDLE@@, Contents\/Home\/lib\/**\/libjli.dylib]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_IMAGE@@]; errors=[error.invalid-runtime-image-missing-file+[@@INVALID_MAC_RUNTIME_IMAGE@@, lib\/**\/libjli.dylib]])\n-ErrorTest.test(IMAGE; app-desc=Hello; args-del=[--main-class]; errors=[error.no-main-class-with-main-jar+[hello.jar], error.no-main-class-with-main-jar.advice+[hello.jar]])\n-ErrorTest.test(IMAGE; args-add=[--module, com.foo.bar, --runtime-image, @@JAVA_HOME@@]; errors=[error.no-module-in-path+[com.foo.bar]])\n-ErrorTest.test(IMAGE; args-add=[--module, java.base, --runtime-image, @@JAVA_HOME@@]; errors=[ERR_NoMainClass])\n-ErrorTest.test(LINUX_DEB; app-desc=Hello; args-add=[--linux-package-name, #]; errors=[error.deb-invalid-value-for-package-name+[#], error.deb-invalid-value-for-package-name.advice])\n-ErrorTest.test(LINUX_RPM; app-desc=Hello; args-add=[--linux-package-name, #]; errors=[error.rpm-invalid-value-for-package-name+[#], error.rpm-invalid-value-for-package-name.advice])\n-ErrorTest.test(MAC_PKG; app-desc=Hello; args-add=[--mac-package-identifier, #1]; errors=[message.invalid-identifier+[#1]])\n-ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--mac-app-store, --runtime-image, @@JAVA_HOME@@]; errors=[error.invalid-runtime-image-bin-dir+[@@JAVA_HOME@@], error.invalid-runtime-image-bin-dir.advice+[--mac-app-store]])\n-ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--runtime-image, @@EMPTY_DIR@@]; errors=[error.invalid-runtime-image-missing-file+[@@EMPTY_DIR@@, lib\/**\/libjli.dylib]])\n-ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_BUNDLE@@]; errors=[error.invalid-runtime-image-missing-file+[@@INVALID_MAC_RUNTIME_BUNDLE@@, Contents\/Home\/lib\/**\/libjli.dylib]])\n-ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_IMAGE@@]; errors=[error.invalid-runtime-image-missing-file+[@@INVALID_MAC_RUNTIME_IMAGE@@, lib\/**\/libjli.dylib]])\n-ErrorTest.test(NATIVE; args-add=[--runtime-image, @@EMPTY_DIR@@]; errors=[error.invalid-runtime-image-missing-file+[@@EMPTY_DIR@@, lib\/**\/libjli.dylib]])\n-ErrorTest.test(NATIVE; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_BUNDLE@@]; errors=[error.invalid-runtime-image-missing-file+[@@INVALID_MAC_RUNTIME_BUNDLE@@, Contents\/Home\/lib\/**\/libjli.dylib]])\n-ErrorTest.test(NATIVE; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_IMAGE@@]; errors=[error.invalid-runtime-image-missing-file+[@@INVALID_MAC_RUNTIME_IMAGE@@, lib\/**\/libjli.dylib]])\n-ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1.2.3.4.5]; errors=[error.msi-product-version-components+[1.2.3.4.5], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1.2.65536]; errors=[error.msi-product-version-build-out-of-range+[1.2.65536], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1.256]; errors=[error.msi-product-version-minor-out-of-range+[1.256], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1234]; errors=[error.msi-product-version-components+[1234], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 256.1]; errors=[error.msi-product-version-major-out-of-range+[256.1], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--launcher-as-service]; errors=[error.missing-service-installer, error.missing-service-installer.advice])\n-ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1.2.3.4.5]; errors=[error.msi-product-version-components+[1.2.3.4.5], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1.2.65536]; errors=[error.msi-product-version-build-out-of-range+[1.2.65536], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1.256]; errors=[error.msi-product-version-minor-out-of-range+[1.256], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1234]; errors=[error.msi-product-version-components+[1234], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 256.1]; errors=[error.msi-product-version-major-out-of-range+[256.1], error.version-string-wrong-format.advice])\n-ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--launcher-as-service]; errors=[error.missing-service-installer, error.missing-service-installer.advice])\n-ErrorTest.test(args-add=[@foo]; errors=[ERR_CannotParseOptions+[foo]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 0.2]; errors=[message.error-header+[message.version-string-first-number-not-zero], message.advice-header+[error.invalid-cfbundle-version.advice]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 1.2.3.4]; errors=[message.error-header+[message.version-string-too-many-components], message.advice-header+[error.invalid-cfbundle-version.advice]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 1.]; errors=[message.error-header+[error.version-string-zero-length-component, 1.]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, 1.b.3]; errors=[message.error-header+[error.version-string-invalid-component, 1.b.3, b.3]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--app-version, ]; errors=[message.error-header+[error.version-string-empty]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --add-modules]; errors=[message.error-header+[error.blocked.option, --add-modules]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --foo]; errors=[message.error-header+[error.jlink.failed, Error: unknown option: --foo]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --module-path]; errors=[message.error-header+[error.blocked.option, --module-path]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--jlink-options, --output]; errors=[message.error-header+[error.blocked.option, --output]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--main-jar, non-existent.jar]; errors=[message.error-header+[error.main-jar-does-not-exist, non-existent.jar]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--runtime-image, @@EMPTY_DIR@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@EMPTY_DIR@@, lib\/**\/libjli.dylib]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_BUNDLE@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@INVALID_MAC_RUNTIME_BUNDLE@@, Contents\/Home\/lib\/**\/libjli.dylib]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_IMAGE@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@INVALID_MAC_RUNTIME_IMAGE@@, lib\/**\/libjli.dylib]])\n+ErrorTest.test(IMAGE; app-desc=Hello; args-del=[--main-class]; errors=[message.error-header+[error.no-main-class-with-main-jar, hello.jar], message.advice-header+[error.no-main-class-with-main-jar.advice, hello.jar]])\n+ErrorTest.test(IMAGE; args-add=[--module, com.foo.bar, --runtime-image, @@JAVA_HOME@@]; errors=[message.error-header+[error.no-module-in-path, com.foo.bar]])\n+ErrorTest.test(IMAGE; args-add=[--module, java.base, --runtime-image, @@JAVA_HOME@@]; errors=[message.error-header+[ERR_NoMainClass]])\n+ErrorTest.test(LINUX_DEB; app-desc=Hello; args-add=[--linux-package-name, #]; errors=[message.error-header+[error.deb-invalid-value-for-package-name, #], message.advice-header+[error.deb-invalid-value-for-package-name.advice]])\n+ErrorTest.test(LINUX_RPM; app-desc=Hello; args-add=[--linux-package-name, #]; errors=[message.error-header+[error.rpm-invalid-value-for-package-name, #], message.advice-header+[error.rpm-invalid-value-for-package-name.advice]])\n+ErrorTest.test(MAC_PKG; app-desc=Hello; args-add=[--mac-package-identifier, #1]; errors=[message.error-header+[message.invalid-identifier, #1]])\n+ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--mac-app-store, --runtime-image, @@JAVA_HOME@@]; errors=[message.error-header+[error.invalid-runtime-image-bin-dir, @@JAVA_HOME@@], message.advice-header+[error.invalid-runtime-image-bin-dir.advice, --mac-app-store]])\n+ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--runtime-image, @@EMPTY_DIR@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@EMPTY_DIR@@, lib\/**\/libjli.dylib]])\n+ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_BUNDLE@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@INVALID_MAC_RUNTIME_BUNDLE@@, Contents\/Home\/lib\/**\/libjli.dylib]])\n+ErrorTest.test(NATIVE; app-desc=Hello; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_IMAGE@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@INVALID_MAC_RUNTIME_IMAGE@@, lib\/**\/libjli.dylib]])\n+ErrorTest.test(NATIVE; args-add=[--runtime-image, @@EMPTY_DIR@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@EMPTY_DIR@@, lib\/**\/libjli.dylib]])\n+ErrorTest.test(NATIVE; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_BUNDLE@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@INVALID_MAC_RUNTIME_BUNDLE@@, Contents\/Home\/lib\/**\/libjli.dylib]])\n+ErrorTest.test(NATIVE; args-add=[--runtime-image, @@INVALID_MAC_RUNTIME_IMAGE@@]; errors=[message.error-header+[error.invalid-runtime-image-missing-file, @@INVALID_MAC_RUNTIME_IMAGE@@, lib\/**\/libjli.dylib]])\n+ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1.2.3.4.5]; errors=[message.error-header+[error.msi-product-version-components, 1.2.3.4.5], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1.2.65536]; errors=[message.error-header+[error.msi-product-version-build-out-of-range, 1.2.65536], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1.256]; errors=[message.error-header+[error.msi-product-version-minor-out-of-range, 1.256], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 1234]; errors=[message.error-header+[error.msi-product-version-components, 1234], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--app-version, 256.1]; errors=[message.error-header+[error.msi-product-version-major-out-of-range, 256.1], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_EXE; app-desc=Hello; args-add=[--launcher-as-service]; errors=[message.error-header+[error.missing-service-installer], message.advice-header+[error.missing-service-installer.advice]])\n+ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1.2.3.4.5]; errors=[message.error-header+[error.msi-product-version-components, 1.2.3.4.5], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1.2.65536]; errors=[message.error-header+[error.msi-product-version-build-out-of-range, 1.2.65536], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1.256]; errors=[message.error-header+[error.msi-product-version-minor-out-of-range, 1.256], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 1234]; errors=[message.error-header+[error.msi-product-version-components, 1234], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--app-version, 256.1]; errors=[message.error-header+[error.msi-product-version-major-out-of-range, 256.1], message.advice-header+[error.version-string-wrong-format.advice]])\n+ErrorTest.test(WIN_MSI; app-desc=Hello; args-add=[--launcher-as-service]; errors=[message.error-header+[error.missing-service-installer], message.advice-header+[error.missing-service-installer.advice]])\n+ErrorTest.test(args-add=[@foo]; errors=[message.error-header+[ERR_CannotParseOptions, foo]])\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/cli\/OptionsValidationFailTest.excludes","additions":39,"deletions":39,"binary":false,"changes":78,"status":"modified"},{"patch":"@@ -413,1 +413,1 @@\n-                        \"ERR_BuildRootInvalid\", cmd.getArgumentValue(\"--temp\")));\n+                        \"error.parameter-not-empty-directory\", cmd.getArgumentValue(\"--temp\"), \"--temp\"));\n","filename":"test\/jdk\/tools\/jpackage\/share\/BasicTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -30,0 +30,2 @@\n+import static jdk.jpackage.test.JPackageCommand.makeAdvice;\n+import static jdk.jpackage.test.JPackageCommand.makeError;\n@@ -42,0 +44,1 @@\n+import java.util.function.UnaryOperator;\n@@ -203,1 +206,1 @@\n-            List<String> removeArgs, List<CannedFormattedString> expectedErrors) {\n+            List<String> removeArgs, List<CannedFormattedString> expectedMessages) {\n@@ -268,2 +271,2 @@\n-            Builder setErrors(List<CannedFormattedString> v) {\n-                expectedErrors = v;\n+            Builder setMessages(List<CannedFormattedString> v) {\n+                expectedMessages = v;\n@@ -273,2 +276,2 @@\n-            Builder setErrors(CannedFormattedString... v) {\n-                return setErrors(List.of(v));\n+            Builder setMessages(CannedFormattedString... v) {\n+                return setMessages(List.of(v));\n@@ -277,2 +280,2 @@\n-            Builder errors(List<CannedFormattedString> v) {\n-                expectedErrors.addAll(v);\n+            Builder messages(List<CannedFormattedString> v) {\n+                expectedMessages.addAll(v);\n@@ -282,2 +285,2 @@\n-            Builder errors(CannedFormattedString... v) {\n-                return errors(List.of(v));\n+            Builder messages(CannedFormattedString... v) {\n+                return messages(List.of(v));\n@@ -287,1 +290,5 @@\n-                return errors(JPackageStringBundle.MAIN.cannedFormattedString(key, args));\n+                return messages(makeError(JPackageStringBundle.MAIN.cannedFormattedString(key, args)));\n+            }\n+\n+            Builder advice(String key, Object ... args) {\n+                return messages(makeAdvice(JPackageStringBundle.MAIN.cannedFormattedString(key, args)));\n@@ -301,1 +308,1 @@\n-                        List.copyOf(addArgs), List.copyOf(removeArgs), List.copyOf(expectedErrors));\n+                        List.copyOf(addArgs), List.copyOf(removeArgs), List.copyOf(expectedMessages));\n@@ -308,1 +315,1 @@\n-            private List<CannedFormattedString> expectedErrors = new ArrayList<>();\n+            private List<CannedFormattedString> expectedMessages = new ArrayList<>();\n@@ -318,1 +325,1 @@\n-            if (expectedErrors.isEmpty()) {\n+            if (expectedMessages.isEmpty()) {\n@@ -356,1 +363,1 @@\n-            defaultInit(cmd, expectedErrors);\n+            defaultInit(cmd, expectedMessages);\n@@ -360,0 +367,4 @@\n+        TestSpec mapExpectedMessages(UnaryOperator<CannedFormattedString> mapper) {\n+            return new TestSpec(type, appDesc, addArgs, removeArgs, expectedMessages.stream().map(mapper).toList());\n+        }\n+\n@@ -375,1 +386,1 @@\n-            sb.append(\"errors=\").append(expectedErrors);\n+            sb.append(\"errors=\").append(expectedMessages);\n@@ -398,1 +409,1 @@\n-                    .error(\"error.no-main-class-with-main-jar.advice\", \"hello.jar\"),\n+                    .advice(\"error.no-main-class-with-main-jar.advice\", \"hello.jar\"),\n@@ -407,1 +418,1 @@\n-                    .error(\"ERR_AppImageNotExist\", \"non-existent.appimage\"),\n+                    .error(\"error.parameter-not-directory\", \"non-existent.appimage\", \"--app-image\"),\n@@ -416,1 +427,1 @@\n-                    .error(\"ERR_LicenseFileNotExit\"),\n+                    .error(\"error.parameter-not-file\", \"non-existent.license\", \"--license-file\"),\n@@ -424,1 +435,1 @@\n-                    .error(\"ERR_MissingArgument\", \"--runtime-image or --module-path\"),\n+                    .error(\"ERR_MissingArgument2\", \"--runtime-image\", \"--module-path\"),\n@@ -431,3 +442,0 @@\n-            \/\/ --main-jar and --module-name\n-            testSpec().noAppDesc().addArgs(\"--main-jar\", \"foo.jar\", \"--module\", \"foo.bar\")\n-                    .error(\"ERR_BothMainJarAndModule\"),\n@@ -442,0 +450,6 @@\n+        \/\/ --main-jar and --module-name\n+        createMutuallyExclusive(\n+                new ArgumentGroup(\"--module\", \"foo.bar\"),\n+                new ArgumentGroup(\"--main-jar\", \"foo.jar\")\n+        ).map(TestSpec.Builder::noAppDesc).map(TestSpec.Builder::create).forEach(testCases::add);\n+\n@@ -536,1 +550,9 @@\n-        spec.test(Map.of(Token.ADD_LAUNCHER_PROPERTY_FILE, cmd -> propsFile));\n+        spec.mapExpectedMessages(cannedStr -> {\n+            return cannedStr.mapArgs(arg -> {\n+                if (arg == Token.ADD_LAUNCHER_PROPERTY_FILE) {\n+                    return propsFile;\n+                } else {\n+                    return arg;\n+                }\n+            });\n+        }).test(Map.of(Token.ADD_LAUNCHER_PROPERTY_FILE, cmd -> propsFile));\n@@ -542,1 +564,1 @@\n-                    .error(\"ERR_NoAddLauncherName\"),\n+                    .error(\"error.parameter-add-launcher-malformed\", Token.ADD_LAUNCHER_PROPERTY_FILE, \"--add-launcher\"),\n@@ -580,1 +602,1 @@\n-                            .error(\"error.missing-service-installer.advice\"),\n+                            .advice(\"error.missing-service-installer.advice\"),\n@@ -585,1 +607,1 @@\n-                            .error(\"error.version-string-wrong-format.advice\"),\n+                            .advice(\"error.version-string-wrong-format.advice\"),\n@@ -588,1 +610,1 @@\n-                            .error(\"error.version-string-wrong-format.advice\"),\n+                            .advice(\"error.version-string-wrong-format.advice\"),\n@@ -591,1 +613,1 @@\n-                            .error(\"error.version-string-wrong-format.advice\"),\n+                            .advice(\"error.version-string-wrong-format.advice\"),\n@@ -594,1 +616,1 @@\n-                            .error(\"error.version-string-wrong-format.advice\"),\n+                            .advice(\"error.version-string-wrong-format.advice\"),\n@@ -597,1 +619,1 @@\n-                            .error(\"error.version-string-wrong-format.advice\")\n+                            .advice(\"error.version-string-wrong-format.advice\")\n@@ -613,1 +635,1 @@\n-                        .error(\"error.invalid-cfbundle-version.advice\"),\n+                        .advice(\"error.invalid-cfbundle-version.advice\"),\n@@ -616,1 +638,1 @@\n-                        .error(\"error.invalid-cfbundle-version.advice\"),\n+                        .advice(\"error.invalid-cfbundle-version.advice\"),\n@@ -662,1 +684,1 @@\n-                        .error(\"error.deb-invalid-value-for-package-name.advice\"),\n+                        .advice(\"error.deb-invalid-value-for-package-name.advice\"),\n@@ -665,1 +687,1 @@\n-                        .error(\"error.rpm-invalid-value-for-package-name.advice\")\n+                        .advice(\"error.rpm-invalid-value-for-package-name.advice\")\n@@ -686,2 +708,2 @@\n-        errorMessages.add(JPackageStringBundle.MAIN.cannedFormattedString(\n-                \"error.cert.not.found\", \"Developer ID Application: \" + signingId, \"\"));\n+        errorMessages.add(makeError(JPackageStringBundle.MAIN.cannedFormattedString(\n+                \"error.cert.not.found\", \"Developer ID Application: \" + signingId, \"\")));\n@@ -689,3 +711,5 @@\n-                \"error.explicit-sign-no-cert\",\n-                \"error.explicit-sign-no-cert.advice\"\n-        ).map(JPackageStringBundle.MAIN::cannedFormattedString).toList());\n+                Map.<String, UnaryOperator<CannedFormattedString>>entry(\"error.explicit-sign-no-cert\", JPackageCommand::makeError),\n+                Map.<String, UnaryOperator<CannedFormattedString>>entry(\"error.explicit-sign-no-cert.advice\", JPackageCommand::makeAdvice)\n+        ).map(e -> {\n+            return e.getValue().apply(JPackageStringBundle.MAIN.cannedFormattedString(e.getKey()));\n+        }).toList());\n@@ -728,1 +752,1 @@\n-            return testSpec().nativeType().addArgs(shortcutOption, value).error(\"error.invalid-option-value\", value, shortcutOption).create();\n+            return testSpec().nativeType().addArgs(shortcutOption, value).error(\"error.parameter-not-launcher-shortcut-dir\", value, shortcutOption).create();\n@@ -733,1 +757,1 @@\n-        var runtimeWithBinDirErr = JPackageStringBundle.MAIN.cannedFormattedString(\n+        var runtimeWithBinDirErr = makeError(JPackageStringBundle.MAIN.cannedFormattedString(\n@@ -736,3 +760,3 @@\n-                }, Token.JAVA_HOME.token()));\n-        var runtimeWithBinDirErrAdvice = JPackageStringBundle.MAIN.cannedFormattedString(\n-                \"error.invalid-runtime-image-bin-dir.advice\", \"--mac-app-store\");\n+                }, Token.JAVA_HOME.token())));\n+        var runtimeWithBinDirErrAdvice = makeAdvice(JPackageStringBundle.MAIN.cannedFormattedString(\n+                \"error.invalid-runtime-image-bin-dir.advice\", \"--mac-app-store\"));\n@@ -742,1 +766,1 @@\n-                        .errors(runtimeWithBinDirErr, runtimeWithBinDirErrAdvice)\n+                        .messages(runtimeWithBinDirErr, runtimeWithBinDirErrAdvice)\n@@ -774,1 +798,1 @@\n-            return builder.addArgs(\"--runtime-image\", runtimeDir.token()).errors(expectedErrorMsg());\n+            return builder.addArgs(\"--runtime-image\", runtimeDir.token()).messages(expectedErrorMsg());\n@@ -778,1 +802,1 @@\n-            return JPackageStringBundle.MAIN.cannedFormattedString(\n+            return makeError(JPackageStringBundle.MAIN.cannedFormattedString(\n@@ -781,1 +805,1 @@\n-                    }, runtimeDir.token()), missingFile);\n+                    }, runtimeDir.token()), missingFile));\n@@ -852,1 +876,1 @@\n-    private static void defaultInit(JPackageCommand cmd, List<CannedFormattedString> expectedErrors) {\n+    private static void defaultInit(JPackageCommand cmd, List<CannedFormattedString> expectedMessages) {\n@@ -863,1 +887,1 @@\n-        cmd.validateOutput(expectedErrors.toArray(CannedFormattedString[]::new));\n+        cmd.validateOutput(expectedMessages.toArray(CannedFormattedString[]::new));\n","filename":"test\/jdk\/tools\/jpackage\/share\/ErrorTest.java","additions":74,"deletions":50,"binary":false,"changes":124,"status":"modified"},{"patch":"@@ -129,1 +129,1 @@\n-                        \"ERR_MissingArgument\", \"--runtime-image or --module-path\");\n+                        \"ERR_MissingArgument2\", \"--runtime-image\", \"--module-path\");\n","filename":"test\/jdk\/tools\/jpackage\/share\/ModulePathTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}