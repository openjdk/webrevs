{"files":[{"patch":"@@ -30,0 +30,2 @@\n+import java.nio.file.FileSystem;\n+import java.nio.file.FileSystems;\n@@ -31,1 +33,0 @@\n-import java.nio.file.Paths;\n@@ -50,2 +51,17 @@\n-    private static final Path BOOT_MODULES_JIMAGE =\n-        Paths.get(JAVA_HOME, \"lib\", \"modules\");\n+    private static final Path BOOT_MODULES_JIMAGE;\n+\n+    static {\n+        FileSystem fs;\n+        if (ImageReaderFactory.class.getClassLoader() == null) {\n+            try {\n+                fs = (FileSystem) Class.forName(\"sun.nio.fs.DefaultFileSystemProvider\")\n+                        .getMethod(\"theFileSystem\")\n+                        .invoke(null);\n+            } catch (Exception e) {\n+                throw new ExceptionInInitializerError(e);\n+            }\n+        } else {\n+            fs = FileSystems.getDefault();\n+        }\n+        BOOT_MODULES_JIMAGE = fs.getPath(JAVA_HOME, \"lib\", \"modules\");\n+    }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ImageReaderFactory.java","additions":19,"deletions":3,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 4313887 7006126 8142968 8178380 8183320 8210112 8266345 8263940\n+ * @bug 4313887 7006126 8142968 8178380 8183320 8210112 8266345 8263940 8331467\n@@ -127,1 +127,0 @@\n-    @Disabled\n","filename":"test\/jdk\/java\/nio\/file\/spi\/SetDefaultProvider.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}