{"files":[{"patch":"@@ -606,1 +606,1 @@\n-double G1CollectionSet::select_candidates_from_optional_groups(double time_remaining_ms, uint& num_regions_selected) {\n+double G1CollectionSet::select_candidates_from_optional_groups(double time_remaining_ms, uint& num_regions_selected, bool force_all) {\n@@ -617,1 +617,1 @@\n-    if (predicted_time_ms > time_remaining_ms) {\n+    if (predicted_time_ms > time_remaining_ms && !force_all) {\n@@ -642,1 +642,1 @@\n-uint G1CollectionSet::select_optional_collection_set_regions(double time_remaining_ms) {\n+uint G1CollectionSet::select_optional_collection_set_regions(double time_remaining_ms, bool force_all) {\n@@ -649,3 +649,1 @@\n-  double total_prediction_ms = select_candidates_from_optional_groups(time_remaining_ms, num_regions_selected);\n-\n-  time_remaining_ms -= total_prediction_ms;\n+  double total_prediction_ms = select_candidates_from_optional_groups(time_remaining_ms, num_regions_selected, force_all);\n@@ -697,1 +695,1 @@\n-bool G1CollectionSet::finalize_optional_for_evacuation(double remaining_pause_time) {\n+bool G1CollectionSet::finalize_optional_for_evacuation(double remaining_pause_time, bool force_all) {\n@@ -700,1 +698,1 @@\n-  uint num_regions_selected = select_optional_collection_set_regions(remaining_pause_time);\n+  uint num_regions_selected = select_optional_collection_set_regions(remaining_pause_time, force_all);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectionSet.cpp","additions":6,"deletions":8,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -194,2 +194,2 @@\n-  uint select_optional_collection_set_regions(double time_remaining_ms);\n-  double select_candidates_from_optional_groups(double time_remaining_ms, uint& num_regions_selected);\n+  uint select_optional_collection_set_regions(double time_remaining_ms, bool force_all = false);\n+  double select_candidates_from_optional_groups(double time_remaining_ms, uint& num_regions_selected, bool force_all = false);\n@@ -288,1 +288,1 @@\n-  bool finalize_optional_for_evacuation(double remaining_pause_time);\n+  bool finalize_optional_for_evacuation(double remaining_pause_time, bool force_all = false);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectionSet.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -825,2 +825,2 @@\n-    if (time_left_ms < 0 ||\n-        !collection_set()->finalize_optional_for_evacuation(time_left_ms * policy()->optional_evacuation_fraction())) {\n+    if ((time_left_ms <= 0 && !EvacuateAllOptionalRegions) ||\n+        !collection_set()->finalize_optional_for_evacuation(time_left_ms * policy()->optional_evacuation_fraction(), EvacuateAllOptionalRegions)) {\n","filename":"src\/hotspot\/share\/gc\/g1\/g1YoungCollector.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -373,0 +373,3 @@\n+  product(bool, EvacuateAllOptionalRegions, false, DIAGNOSTIC,              \\\n+          \"Force to evacuate all optional regions.\")                        \\\n+                                                                            \\\n","filename":"src\/hotspot\/share\/gc\/g1\/g1_globals.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}