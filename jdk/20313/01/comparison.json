{"files":[{"patch":"@@ -847,0 +847,4 @@\n+        if (value.startsWith(\"none\")) {\n+            return null;\n+        }\n+\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/CSS.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,128 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.awt.Dimension;\n+import java.awt.Graphics;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+\n+import javax.imageio.ImageIO;\n+import javax.swing.JEditorPane;\n+import javax.swing.text.View;\n+import javax.swing.text.html.CSS;\n+\n+\/*\n+ * @test\n+ * @bug 8335967\n+ * @summary Tests 'text-decoration: none' is respected\n+ * @run main HTMLTextDecorationNone\n+ *\/\n+public final class HTMLTextDecorationNone {\n+    private static final String HTML = \"\"\"\n+            <!DOCTYPE html>\n+            <html lang=\"en\">\n+            <head>\n+                <meta charset=\"UTF-8\">\n+                <title>text-decoration: none (&lt;a&gt;)<\/title>\n+                <style>\n+                    a.none { text-decoration: none }\n+                <\/style>\n+            <\/head>\n+            <body>\n+            <p><a href=\"https:\/\/openjdk.org\/\">underlined<\/a><\/p>\n+            <p><a href=\"https:\/\/openjdk.org\/\" style=\"text-decoration: none\">not underlined<\/a><\/p>\n+            <p><a href=\"https:\/\/openjdk.org\/\" class=\"none\">not underlined<\/a><\/p>\n+            <p style=\"text-decoration: underline\"><a\n+                   href=\"https:\/\/openjdk.org\/\" style=\"text-decoration: none\">underlined?<\/a><\/p>\n+            <p style=\"text-decoration: underline\"><a\n+                   href=\"https:\/\/openjdk.org\/\" class=\"none\">underlined?<\/a><\/p>\n+            <\/body>\n+            <\/html>\n+            \"\"\";\n+\n+    private static final boolean[] underlined = {true, false, false, true, true};\n+\n+    public static void main(String[] args) {\n+        final JEditorPane html = new JEditorPane(\"text\/html\", HTML);\n+        html.setEditable(false);\n+\n+        final Dimension size = html.getPreferredSize();\n+        html.setSize(size);\n+\n+        BufferedImage image = new BufferedImage(size.width, size.height,\n+                                                BufferedImage.TYPE_INT_RGB);\n+        Graphics g = image.createGraphics();\n+        \/\/ Paint the editor pane to ensure all views are created\n+        html.paint(g);\n+        g.dispose();\n+\n+        int errorCount = 0;\n+        String firstError = null;\n+\n+        System.out.println(\"----- Views -----\");\n+        final View bodyView = html.getUI()\n+                                  .getRootView(html)\n+                                  .getView(1)\n+                                  .getView(1);\n+        for (int i = 0; i < bodyView.getViewCount(); i++) {\n+            View pView = bodyView.getView(i);\n+            View contentView = getContentView(pView);\n+\n+            Object decorationAttr =\n+                    contentView.getAttributes()\n+                               .getAttribute(CSS.Attribute.TEXT_DECORATION);\n+            String decoration = decorationAttr == null\n+                                ? \"none\" : decorationAttr.toString();\n+\n+            System.out.println(i + \": \" + decoration);\n+            if (decoration.contains(\"underline\") != underlined[i]) {\n+                errorCount++;\n+                if (firstError == null) {\n+                    firstError = \"Line \" + i + \": \" + decoration + \" vs \"\n+                                 + (underlined[i] ? \"underline\" : \"none\");\n+                }\n+            }\n+        }\n+\n+        if (errorCount > 0) {\n+            saveImage(image);\n+            throw new RuntimeException(errorCount + \" error(s) found, \"\n+                                       + \"the first one: \" + firstError);\n+        }\n+    }\n+\n+    private static View getContentView(View parent) {\n+        View view = parent.getView(0);\n+        return view.getViewCount() > 0\n+               ? getContentView(view)\n+               : view;\n+    }\n+\n+    private static void saveImage(BufferedImage image) {\n+        try {\n+            ImageIO.write(image, \"png\",\n+                          new File(\"html.png\"));\n+        } catch (IOException ignored) { }\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/text\/html\/HTMLDocument\/HTMLTextDecorationNone.java","additions":128,"deletions":0,"binary":false,"changes":128,"status":"added"}]}