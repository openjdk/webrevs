{"files":[{"patch":"@@ -1939,22 +1939,7 @@\n-    \/* if primary display *\/\n-    if (screenNum == 0) {\n-        RECT rRW;\n-        if (::SystemParametersInfo(SPI_GETWORKAREA,0,(void *) &rRW,0) == TRUE) {\n-            rect->top = rRW.top;\n-            rect->left = rRW.left;\n-            rect->bottom = ::GetSystemMetrics(SM_CYSCREEN) - rRW.bottom;\n-            rect->right = ::GetSystemMetrics(SM_CXSCREEN) - rRW.right;\n-            return TRUE;\n-        }\n-    }\n-    \/* if additional display *\/\n-    else {\n-        MONITORINFO *miInfo;\n-        miInfo = AwtWin32GraphicsDevice::GetMonitorInfo(screenNum);\n-        if (miInfo) {\n-            rect->top = miInfo->rcWork.top    - miInfo->rcMonitor.top;\n-            rect->left = miInfo->rcWork.left   - miInfo->rcMonitor.left;\n-            rect->bottom = miInfo->rcMonitor.bottom - miInfo->rcWork.bottom;\n-            rect->right = miInfo->rcMonitor.right - miInfo->rcWork.right;\n-            return TRUE;\n-        }\n+    MONITORINFO *miInfo = AwtWin32GraphicsDevice::GetMonitorInfo(screenNum);\n+    if (miInfo) {\n+        rect->top = miInfo->rcWork.top - miInfo->rcMonitor.top;\n+        rect->left = miInfo->rcWork.left - miInfo->rcMonitor.left;\n+        rect->bottom = miInfo->rcMonitor.bottom - miInfo->rcWork.bottom;\n+        rect->right = miInfo->rcMonitor.right - miInfo->rcWork.right;\n+        return TRUE;\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Toolkit.cpp","additions":7,"deletions":22,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,3 +27,3 @@\n-  @bug 8020443\n-  @summary Frame is not created on the specified GraphicsDevice with two\n-monitors\n+  @bug 8020443 6899304\n+  @summary Test to check if the frame is created on the specified GraphicsDevice\n+  and if getScreenInsets()returns the correct values across multiple monitors.\n@@ -50,5 +50,0 @@\n-        if (!Platform.isLinux()) {\n-            System.out.println(\"This test is for Linux only...\" +\n-                               \"skipping!\");\n-            return;\n-        }\n@@ -73,1 +68,11 @@\n-            frame.setUndecorated(true);\n+\n+            \/*\n+             * On Windows, undecorated maximized frames are placed over the taskbar.\n+             * Use a decorated frame instead.\n+             *\/\n+            if(Platform.isWindows()) {\n+                frame.setUndecorated(false);\n+            } else {\n+                frame.setUndecorated(true);\n+            }\n+\n@@ -82,0 +87,20 @@\n+\n+            \/*\n+             * On Windows, the top-left corner of an undecorated maximized frame may have negative coordinates (x, y).\n+             * Adjust the frame bounds accordingly.\n+             *\/\n+            if (frameBounds.x < bounds.x)\n+            {\n+                frameBounds.width -= (bounds.x - frameBounds.x) * 2;\n+                frameBounds.x = bounds.x;\n+            }\n+            if (frameBounds.y < bounds.y)\n+            {\n+                frameBounds.height -= (bounds.y - frameBounds.y) * 2;\n+                frameBounds.y = bounds.y;\n+            }\n+\n+            \/\/ Add a margin to compensate for the lost fractional parts when casting to an integer.\n+            int marginX = getMarginForScaleX(gc);\n+            int marginY = getMarginForScaleY(gc);\n+\n@@ -84,2 +109,2 @@\n-                || bounds.width - insets.right - insets.left != frameBounds.width\n-                || bounds.height - insets.bottom - insets.top != frameBounds.height) {\n+                || bounds.width - insets.right - insets.left + marginX != frameBounds.width\n+                || bounds.height - insets.bottom - insets.top + marginY != frameBounds.height) {\n@@ -92,0 +117,8 @@\n+    static int getMarginForScaleX(GraphicsConfiguration gc) {\n+        float scaleFactorX = (float) gc.getDefaultTransform().getScaleX();\n+        return (scaleFactorX % 1 == 0.5) ? 1 : 0;\n+    }\n+    static int getMarginForScaleY(GraphicsConfiguration gc) {\n+        float scaleFactorY = (float) gc.getDefaultTransform().getScaleY();\n+        return (scaleFactorY % 1 == 0.5) ? 1 : 0;\n+    }\n","filename":"test\/jdk\/java\/awt\/Multiscreen\/MultiScreenInsetsTest\/MultiScreenInsetsTest.java","additions":45,"deletions":12,"binary":false,"changes":57,"status":"modified"}]}