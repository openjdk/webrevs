{"files":[{"patch":"@@ -540,1 +540,1 @@\n-    if (AOTCodeCache::is_dumping_adapter()) {\n+    if (CDSConfig::is_dumping_adapters()) {\n","filename":"src\/hotspot\/share\/cds\/archiveBuilder.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -898,0 +898,4 @@\n+\n+bool CDSConfig::is_dumping_adapters() {\n+  return (AOTAdapterCaching && is_dumping_final_static_archive());\n+}\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -190,0 +190,1 @@\n+  static bool is_dumping_adapters()                          NOT_CDS_RETURN_(false);\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -616,1 +616,1 @@\n-  if (AOTCodeCache::is_dumping_adapter()) {\n+  if (CDSConfig::is_dumping_adapters()) {\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -905,1 +905,2 @@\n-  log_debug(aot, codecache, stubs)(\"Read blob '%s' (id=%u, kind=%s) from AOT Code Cache\", name, id, aot_code_entry_kind_name[entry_kind]);\n+  log_debug(aot, codecache, stubs)(\"%sRead blob '%s' (id=%u, kind=%s) from AOT Code Cache\",\n+                                   (blob == nullptr? \"Failed to \" : \"\"), name, id, aot_code_entry_kind_name[entry_kind]);\n@@ -920,2 +921,1 @@\n-    ((AOTCodeCache*)_cache)->set_failed();\n-    report_load_failure();\n+    set_lookup_failed(); \/\/ Skip this blob\n","filename":"src\/hotspot\/share\/code\/aotCodeCache.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -138,0 +138,1 @@\n+  set_adapter_entry(nullptr);\n@@ -410,1 +411,1 @@\n-  if (AOTCodeCache::is_dumping_adapter() && _adapter != nullptr) {\n+  if (CDSConfig::is_dumping_adapters() && _adapter != nullptr) {\n@@ -412,0 +413,1 @@\n+    _adapter = nullptr;\n@@ -1149,1 +1151,1 @@\n-  if (!AOTCodeCache::is_dumping_adapter() || AdapterHandlerLibrary::is_abstract_method_adapter(_adapter)) {\n+  if (!CDSConfig::is_dumping_adapters() || AdapterHandlerLibrary::is_abstract_method_adapter(_adapter)) {\n","filename":"src\/hotspot\/share\/oops\/method.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2459,1 +2459,1 @@\n-  if (!AOTCodeCache::is_dumping_adapter()) {\n+  if (AOTCodeCache::is_using_adapter()) {\n@@ -2569,1 +2569,1 @@\n-  if (!_aot_adapter_handler_table.empty()) {\n+  if (AOTCodeCache::is_using_adapter() && !_aot_adapter_handler_table.empty()) {\n@@ -2991,0 +2991,1 @@\n+  assert(AOTCodeCache::is_using_adapter(), \"AOT adapters code should be available\");\n@@ -3377,4 +3378,6 @@\n-  auto findblob_archived_table = [&] (AdapterHandlerEntry* handler) {\n-    return (found = (b == CodeCache::find_blob(handler->get_i2c_entry())));\n-  };\n-  _aot_adapter_handler_table.iterate(findblob_archived_table);\n+  if (AOTCodeCache::is_using_adapter()) {\n+    auto findblob_archived_table = [&] (AdapterHandlerEntry* handler) {\n+      return (found = (b == CodeCache::find_blob(handler->get_i2c_entry())));\n+    };\n+    _aot_adapter_handler_table.iterate(findblob_archived_table);\n+  }\n@@ -3404,12 +3407,13 @@\n-  auto findblob_archived_table = [&] (AdapterHandlerEntry* handler) {\n-    if (b == CodeCache::find_blob(handler->get_i2c_entry())) {\n-      found = true;\n-      st->print(\"Adapter for signature: \");\n-      handler->print_adapter_on(st);\n-      return true;\n-    } else {\n-      return false; \/\/ keep looking\n-\n-    }\n-  };\n-  _aot_adapter_handler_table.iterate(findblob_archived_table);\n+  if (AOTCodeCache::is_using_adapter()) {\n+    auto findblob_archived_table = [&] (AdapterHandlerEntry* handler) {\n+      if (b == CodeCache::find_blob(handler->get_i2c_entry())) {\n+        found = true;\n+        st->print(\"Adapter for signature: \");\n+        handler->print_adapter_on(st);\n+        return true;\n+      } else {\n+        return false; \/\/ keep looking\n+      }\n+    };\n+    _aot_adapter_handler_table.iterate(findblob_archived_table);\n+  }\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntime.cpp","additions":22,"deletions":18,"binary":false,"changes":40,"status":"modified"}]}