{"files":[{"patch":"@@ -136,5 +136,1 @@\n-        long rss = WhiteBox.getWhiteBox().rss();\n-        System.out.println(\"RSS: \" + rss);\n-        long available = WhiteBox.getWhiteBox().hostAvailableMemory();\n-        System.out.println(\"Host available memory: \" + available);\n-\n+        int maxIter = 20;\n@@ -142,1 +138,0 @@\n-\n@@ -153,6 +148,22 @@\n-        if (rss == 0) {\n-            throw new SkippedException(\"cannot get RSS?\");\n-        }\n-        if (available > requiredAvailable) {\n-            Asserts.assertGreaterThan(rss, minRequiredRss, \"RSS of this process(\" + rss + \"b) should be bigger \" +\n-                                      \"than or equal to heap size(\" + heapSize + \"b) (available memory: \" + available + \"). On Linux Kernel < 4.14 RSS can be inaccurate\");\n+\n+        \/\/ RSS values we get are sometimes somewhat delayed or inaccurate\n+        for (int iter=0; iter < maxIter; iter++) {\n+            long rss = WhiteBox.getWhiteBox().rss();\n+            System.out.println(\"RSS: \" + rss);\n+            long available = WhiteBox.getWhiteBox().hostAvailableMemory();\n+            System.out.println(\"Host available memory: \" + available);\n+\n+            if (rss == 0) {\n+                throw new SkippedException(\"cannot get RSS?\");\n+            }\n+            if (available <= requiredAvailable) {\n+                throw new SkippedException(\"Available memory on host \" + available + \" is too small, not larger than required available memory \" + requiredAvailable);\n+            }\n+\n+            if ((rss < minRequiredRss) && iter < maxIter-1) {\n+                System.out.println(\"We got only an RSS value of \" + rss + \" but require \" + minRequiredRss + \", let's retry!\");\n+            } else {\n+                Asserts.assertGreaterThan(rss, minRequiredRss, \"RSS of this process(\" + rss + \"b) should be bigger \" +\n+                                          \"than or equal to heap size(\" + heapSize + \"b) (available memory: \" + available + \"). On Linux Kernel < 4.14 RSS can be inaccurate\");\n+                break;\n+            }\n","filename":"test\/hotspot\/jtreg\/gc\/TestAlwaysPreTouchBehavior.java","additions":23,"deletions":12,"binary":false,"changes":35,"status":"modified"}]}