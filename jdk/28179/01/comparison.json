{"files":[{"patch":"@@ -30,3 +30,0 @@\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @modules java.base\/jdk.internal.misc\n@@ -35,1 +32,1 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI PrintVMInfoAtExitTest\n+ * @run driver PrintVMInfoAtExitTest\n@@ -40,1 +37,0 @@\n-import jdk.test.whitebox.WhiteBox;\n@@ -55,0 +51,2 @@\n+    \/\/ How many kb of committed memory we expect in the NMT summary.\n+    int committed_kb = 65536;\n@@ -60,7 +58,7 @@\n-    WhiteBox wb = WhiteBox.getWhiteBox();\n-    if (wb.isAsanEnabled()) {\n-        \/\/ the reserved value can be influenced by asan\n-        output_detail.shouldContain(\"Java Heap (reserved=\");\n-        output_detail.shouldContain(\", committed=65536KB)\");\n-    } else {\n-        output_detail.shouldContain(\"Java Heap (reserved=65536KB, committed=65536KB)\");\n+    \/\/ Make sure the heap summary is present.\n+    output_detail.shouldMatch(\"Java Heap \\\\(reserved=[0-9]+KB, committed=\" + committed_kb + \"KB\\\\)\");\n+    \/\/ Check reserved >= committed.\n+    String reserved_kb_string = output_detail.firstMatch(\"Java Heap \\\\(reserved=([0-9]+)KB, committed=\" + committed_kb + \"KB\\\\)\", 1);\n+    int reserved_kb = Integer.parseInt(reserved_kb_string);\n+    if (reserved_kb < committed_kb) {\n+        throw new RuntimeException(\"committed more memory than reserved\");\n","filename":"test\/hotspot\/jtreg\/runtime\/ErrorHandling\/PrintVMInfoAtExitTest.java","additions":10,"deletions":12,"binary":false,"changes":22,"status":"modified"}]}