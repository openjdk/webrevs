{"files":[{"patch":"@@ -3,0 +3,1 @@\n+ * Copyright (c) 2025, Alibaba Group Holding Limited. All Rights Reserved.\n@@ -88,0 +89,1 @@\n+import java.util.concurrent.atomic.AtomicReferenceArray;\n@@ -137,2 +139,4 @@\n-    \/** Cache of time-zone offset by offset in seconds. *\/\n-    private static final ConcurrentMap<Integer, ZoneOffset> SECONDS_CACHE = new ConcurrentHashMap<>(16, 0.75f, 4);\n+    \/** Cache of time-zone offset by offset in quarters. *\/\n+    private static final int SECONDS_PER_QUARTER = 15 * SECONDS_PER_MINUTE;\n+    private static final AtomicReferenceArray<ZoneOffset> QUARTER_CACHE = new AtomicReferenceArray<>(256);\n+\n@@ -426,3 +430,5 @@\n-        if (totalSeconds % (15 * SECONDS_PER_MINUTE) == 0) {\n-            Integer totalSecs = totalSeconds;\n-            ZoneOffset result = SECONDS_CACHE.get(totalSecs);\n+        int quarters = totalSeconds \/ SECONDS_PER_QUARTER;\n+        if (totalSeconds - quarters * SECONDS_PER_QUARTER == 0) {\n+            \/\/ quarters range from -72 to 72, & 0xff maps them to 0-72 and 184-255.\n+            int key = quarters & 0xff;\n+            ZoneOffset result = QUARTER_CACHE.getOpaque(key);\n@@ -431,1 +437,1 @@\n-                var existing = SECONDS_CACHE.putIfAbsent(totalSecs, result);\n+                var existing = QUARTER_CACHE.compareAndExchange(key, null, result);\n","filename":"src\/java.base\/share\/classes\/java\/time\/ZoneOffset.java","additions":12,"deletions":6,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,2 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, Alibaba Group Holding Limited. All Rights Reserved.\n@@ -85,0 +86,15 @@\n+    @Test\n+    public void test_quarter_cache() throws Exception {\n+        \/\/ [-18:00, +18:00]\n+        int quarter = 15 * 60;\n+        int start = -18 * 3600,\n+            end   =  18 * 3600;\n+        for (int totalSeconds = start; totalSeconds <= end; totalSeconds += quarter) {\n+            var offset0 = ZoneOffset.ofTotalSeconds(totalSeconds);\n+            var offset1 = ZoneOffset.ofTotalSeconds(totalSeconds);\n+            var offset2 = ZoneOffset.ofTotalSeconds(totalSeconds);\n+            assertSame(offset0, offset1);\n+            assertSame(offset1, offset2);\n+        }\n+    }\n+\n","filename":"test\/jdk\/java\/time\/test\/java\/time\/TestZoneOffset.java","additions":17,"deletions":1,"binary":false,"changes":18,"status":"modified"}]}