{"files":[{"patch":"@@ -32,0 +32,1 @@\n+import java.nio.charset.StandardCharsets;\n@@ -54,0 +55,7 @@\n+    private static final String NULL_STR = \"null\";\n+    private static final byte[] NULL_BYTES_LATIN1 = NULL_STR.getBytes(java.nio.charset.StandardCharsets.ISO_8859_1);\n+    private static final byte[] NULL_BYTES_UTF16 = NULL_STR.getBytes(\n+            ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN ? StandardCharsets.UTF_16BE : StandardCharsets.UTF_16LE);\n+    private static final int NULL_INT = UNSAFE.getInt(NULL_BYTES_LATIN1, Unsafe.ARRAY_BYTE_BASE_OFFSET);\n+    private static final long NULL_LONG = UNSAFE.getLong(NULL_BYTES_UTF16, Unsafe.ARRAY_BYTE_BASE_OFFSET);\n+\n@@ -61,0 +69,3 @@\n+    final char[] chars4 = new char[NUMBERS * 4];\n+    final StringBuilder sb = new StringBuilder(NUMBERS * 4);\n+    final StringBuilder sb_utf16 = new StringBuilder(NUMBERS * 8).append('\\u4e2d');\n@@ -494,0 +505,105 @@\n+    \/**\n+     * Test whether a constant String of length 4 is MergeStored when calling getBytes\n+     *\/\n+    @Benchmark\n+    @SuppressWarnings(\"deprecation\")\n+    public void putNull_getBytes(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            NULL_STR.getBytes(0, 4, bytes4, off);\n+            off += 4;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test whether a constant byte[] with a length of 4 is MergeStored when arraycopy is called\n+     *\/\n+    @Benchmark\n+    public void putNull_arraycopy(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            System.arraycopy(NULL_BYTES_LATIN1, 0, bytes4, off, 4);\n+            off += 4;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test the performance of Unsafe.putInt, used as a benchmark for comparison with other putNull Benchmarks\n+     *\/\n+    @Benchmark\n+    public void putNull_unsafePutInt(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            UNSAFE.putInt(bytes4, Unsafe.ARRAY_BYTE_BASE_OFFSET + off, NULL_INT);\n+            off += 4;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test whether StringBuilder is MergeStored when appending a constant String of length 4\n+     *\/\n+    @Benchmark\n+    public void putNull_string_builder(Blackhole BH) {\n+        sb.setLength(0);\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            sb.append(NULL_STR);\n+        }\n+        BH.consume(sb_utf16.length());\n+    }\n+\n+    \/**\n+     * Test whether the constant String with a length of 4 calls the getChars method to mergestore\n+     *\/\n+    @Benchmark\n+    public void putNull_getChars(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            NULL_STR.getChars(0, 4, chars4, off);\n+            off += 4;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test the performance of putLong for comparison with other putNull_utf16 benchmarks\n+     *\/\n+    @Benchmark\n+    public void putNull_utf16_unsafePutLong(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            UNSAFE.putLong(bytes8, Unsafe.ARRAY_BYTE_BASE_OFFSET + off, NULL_LONG);\n+            off += 8;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test whether the byte[] arraycopy with a length of 8 is MergeStore\n+     *\/\n+    @Benchmark\n+    public void putNull_utf16_arrayCopy(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            System.arraycopy(NULL_BYTES_UTF16, 0, bytes8, off, 8);\n+            off += 8;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test whether the UTF16 StringBuilder appends a constant String of length 4 to MergeStore\n+     *\/\n+    @Benchmark\n+    public void putNull_utf16_string_builder(Blackhole BH) {\n+        sb_utf16.setLength(0);\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            sb_utf16.append(NULL_STR);\n+        }\n+        BH.consume(sb_utf16.length());\n+    }\n+\n","filename":"test\/micro\/org\/openjdk\/bench\/vm\/compiler\/MergeStoreBench.java","additions":116,"deletions":0,"binary":false,"changes":116,"status":"modified"}]}