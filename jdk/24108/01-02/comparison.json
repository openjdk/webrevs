{"files":[{"patch":"@@ -62,0 +62,9 @@\n+    private static final String STR_5 = \"false\";\n+    private static final byte[] STR_5_BYTES_LATIN1 = STR_5.getBytes(java.nio.charset.StandardCharsets.ISO_8859_1);\n+    private static final byte[] STR_5_BYTES_UTF16 = STR_5.getBytes(\n+            ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN ? StandardCharsets.UTF_16BE : StandardCharsets.UTF_16LE);\n+    private static final int STR_5_BYTES_LATIN1_INT = UNSAFE.getInt(STR_5_BYTES_LATIN1, Unsafe.ARRAY_BYTE_BASE_OFFSET);\n+    private static final byte STR_5_BYTES_LATIN1_BYTE = STR_5_BYTES_LATIN1[4];\n+    private static final long STR_5_BYTES_UTF16_LONG = UNSAFE.getLong(STR_5_BYTES_UTF16, Unsafe.ARRAY_BYTE_BASE_OFFSET);\n+    private static final short STR_5_BYTES_UTF16_SHORT = UNSAFE.getShort(STR_5_BYTES_UTF16, Unsafe.ARRAY_BYTE_BASE_OFFSET + 8);\n+\n@@ -65,0 +74,1 @@\n+    final byte[] bytes5 = new byte[NUMBERS * 5];\n@@ -66,0 +76,1 @@\n+    final byte[] bytes10 = new byte[NUMBERS * 10];\n@@ -70,2 +81,3 @@\n-    final StringBuilder sb = new StringBuilder(NUMBERS * 4);\n-    final StringBuilder sb_utf16 = new StringBuilder(NUMBERS * 8).append('\\u4e2d');\n+    final char[] chars5 = new char[NUMBERS * 5];\n+    final StringBuilder sb = new StringBuilder(NUMBERS * 5);\n+    final StringBuilder sb_utf16 = new StringBuilder(NUMBERS * 10).append('\\u4e2d');\n@@ -533,1 +545,1 @@\n-     * Test the performance of Unsafe.putInt, used as a benchmark for comparison with other putNull Benchmarks\n+     * Test the performance of Unsafe.putInt, used as a benchmark for comparison with other str4 Benchmarks\n@@ -555,1 +567,1 @@\n-        BH.consume(sb_utf16.length());\n+        BH.consume(sb.length());\n@@ -572,1 +584,1 @@\n-     * Test the performance of putLong for comparison with other putNull_utf16 benchmarks\n+     * Test the performance of putLong for comparison with other str4Utf16 benchmarks\n@@ -610,0 +622,93 @@\n+    \/**\n+     * Test whether a constant byte[] with a length of 5 is MergeStored when arraycopy is called\n+     *\/\n+    @Benchmark\n+    public void str5Arraycopy(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            System.arraycopy(STR_5_BYTES_LATIN1, 0, bytes5, off, 5);\n+            off += 5;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test the performance of Unsafe.putInt, used as a benchmark for comparison with other str5 Benchmarks\n+     *\/\n+    @Benchmark\n+    public void str5UnsafePutInt(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            UNSAFE.putInt(bytes5, Unsafe.ARRAY_BYTE_BASE_OFFSET + off, STR_5_BYTES_LATIN1_INT);\n+            UNSAFE.putByte(bytes5, Unsafe.ARRAY_BYTE_BASE_OFFSET + off + 4, STR_5_BYTES_LATIN1_BYTE);\n+            off += 5;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test whether StringBuilder is MergeStored when appending a constant String of length 5\n+     *\/\n+    @Benchmark\n+    public void str5StringBuilder(Blackhole BH) {\n+        sb.setLength(0);\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            sb.append(STR_5);\n+        }\n+        BH.consume(sb.length());\n+    }\n+\n+    \/**\n+     * Test whether the constant String with a length of 5 calls the getChars method to mergestore\n+     *\/\n+    @Benchmark\n+    public void str5GetChars(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            STR_5.getChars(0, 5, chars5, off);\n+            off += 5;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test the performance of putLong for comparison with other str5Utf16 benchmarks\n+     *\/\n+    @Benchmark\n+    public void str5Utf16UnsafePutLong(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            UNSAFE.putLong(bytes8, Unsafe.ARRAY_BYTE_BASE_OFFSET + off, STR_5_BYTES_UTF16_LONG);\n+            UNSAFE.putShort(bytes8, Unsafe.ARRAY_BYTE_BASE_OFFSET + off + 8, STR_5_BYTES_UTF16_SHORT);\n+            off += 10;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test whether the byte[] arraycopy with a length of 10 is MergeStore\n+     *\/\n+    @Benchmark\n+    public void str5Utf16ArrayCopy(Blackhole BH) {\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            System.arraycopy(STR_5_BYTES_UTF16, 0, bytes10, off, 10);\n+            off += 10;\n+        }\n+        BH.consume(off);\n+    }\n+\n+    \/**\n+     * Test whether the UTF16 StringBuilder appends a constant String of length 5 to MergeStore\n+     *\/\n+    @Benchmark\n+    public void str5Utf16StringBuilder(Blackhole BH) {\n+        sb_utf16.setLength(0);\n+        int off = 0;\n+        for (int i = 0; i < NUMBERS; i++) {\n+            sb_utf16.append(STR_5);\n+        }\n+        BH.consume(sb_utf16.length());\n+    }\n+\n","filename":"test\/micro\/org\/openjdk\/bench\/vm\/compiler\/MergeStoreBench.java","additions":110,"deletions":5,"binary":false,"changes":115,"status":"modified"}]}