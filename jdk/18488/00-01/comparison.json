{"files":[{"patch":"@@ -57,0 +57,1 @@\n+import java.util.stream.Stream;\n@@ -261,2 +262,3 @@\n-        String nssLibDir = fetchNssLib(osid);\n-        if (nssLibDir == null) {\n+        Path libraryName = Path.of(System.mapLibraryName(library));\n+        Path nssLibPath = fetchNssLib(osid, libraryName);\n+        if (nssLibPath == null) {\n@@ -266,8 +268,1 @@\n-\n-        String libraryName = System.mapLibraryName(library);\n-        Path libPath = Paths.get(nssLibDir).resolve(libraryName);\n-        if (!Files.exists(libPath)) {\n-            throw new SkippedException(\"NSS library \\\"\" + libraryName + \"\\\" was not found in \" + nssLibDir);\n-        }\n-\n-        return libPath;\n+        return nssLibPath;\n@@ -735,1 +730,1 @@\n-    private static String fetchNssLib(String osId) {\n+    private static Path fetchNssLib(String osId, Path libraryName) {\n@@ -738,1 +733,1 @@\n-                return fetchNssLib(WINDOWS_X64.class);\n+                return fetchNssLib(WINDOWS_X64.class, libraryName);\n@@ -741,1 +736,1 @@\n-                return fetchNssLib(MACOSX_X64.class);\n+                return fetchNssLib(MACOSX_X64.class, libraryName);\n@@ -744,1 +739,1 @@\n-                return fetchNssLib(MACOSX_AARCH64.class);\n+                return fetchNssLib(MACOSX_AARCH64.class, libraryName);\n@@ -750,1 +745,1 @@\n-                    return fetchNssLib(LINUX_X64.class);\n+                    return fetchNssLib(LINUX_X64.class, libraryName);\n@@ -757,1 +752,1 @@\n-                    return fetchNssLib(LINUX_AARCH64.class);\n+                    return fetchNssLib(LINUX_AARCH64.class, libraryName);\n@@ -764,2 +759,2 @@\n-    private static String fetchNssLib(Class<?> clazz) {\n-        String path = null;\n+    private static Path fetchNssLib(Class<?> clazz, Path libraryName) {\n+        Path path = null;\n@@ -769,1 +764,1 @@\n-            path = findNSSLibrary(p);\n+            path = findNSSLibrary(p, libraryName);\n@@ -784,8 +779,8 @@\n-    private static String findNSSLibrary(Path path) throws IOException {\n-        Path nssLibrary = Path.of(System.mapLibraryName(nss_library));\n-        Path p = Files.find(path, 10,\n-                        (tp, attr) -> tp.getFileName().equals(nssLibrary))\n-                .findAny()\n-                .orElse(path)\n-                .getParent();\n-        return p.toString();\n+    private static Path findNSSLibrary(Path path, Path libraryName) throws IOException {\n+        try(Stream<Path> files = Files.find(path, 10,\n+                (tp, attr) -> tp.getFileName().equals(libraryName))) {\n+\n+            return files.findAny()\n+                        .orElseThrow(() -> new SkippedException(\n+                        \"NSS library \\\"\" + libraryName + \"\\\" was not found in \" + path));\n+        }\n","filename":"test\/jdk\/sun\/security\/pkcs11\/PKCS11Test.java","additions":22,"deletions":27,"binary":false,"changes":49,"status":"modified"}]}