{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -57,3 +57,1 @@\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n-import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n@@ -264,2 +262,3 @@\n-        String nssLibDir = fetchNssLib(osid);\n-        if (nssLibDir == null) {\n+        Path libraryName = Path.of(System.mapLibraryName(library));\n+        Path nssLibPath = fetchNssLib(osid, libraryName);\n+        if (nssLibPath == null) {\n@@ -269,8 +268,1 @@\n-\n-        String libraryName = System.mapLibraryName(library);\n-        Path libPath = Paths.get(nssLibDir).resolve(libraryName);\n-        if (!Files.exists(libPath)) {\n-            throw new SkippedException(\"NSS library \\\"\" + libraryName + \"\\\" was not found in \" + nssLibDir);\n-        }\n-\n-        return libPath;\n+        return nssLibPath;\n@@ -738,1 +730,1 @@\n-    private static String fetchNssLib(String osId) {\n+    private static Path fetchNssLib(String osId, Path libraryName) {\n@@ -741,1 +733,1 @@\n-                return fetchNssLib(WINDOWS_X64.class);\n+                return fetchNssLib(WINDOWS_X64.class, libraryName);\n@@ -744,1 +736,1 @@\n-                return fetchNssLib(MACOSX_X64.class);\n+                return fetchNssLib(MACOSX_X64.class, libraryName);\n@@ -747,1 +739,1 @@\n-                return fetchNssLib(MACOSX_AARCH64.class);\n+                return fetchNssLib(MACOSX_AARCH64.class, libraryName);\n@@ -753,1 +745,1 @@\n-                    return fetchNssLib(LINUX_X64.class);\n+                    return fetchNssLib(LINUX_X64.class, libraryName);\n@@ -760,1 +752,1 @@\n-                    return fetchNssLib(LINUX_AARCH64.class);\n+                    return fetchNssLib(LINUX_AARCH64.class, libraryName);\n@@ -767,2 +759,2 @@\n-    private static String fetchNssLib(Class<?> clazz) {\n-        String path = null;\n+    private static Path fetchNssLib(Class<?> clazz, Path libraryName) {\n+        Path path = null;\n@@ -770,4 +762,4 @@\n-            path = ArtifactResolver.resolve(clazz).entrySet().stream()\n-                    .findAny().get().getValue() + File.separator + \"nss\"\n-                    + File.separator + \"lib\" + File.separator;\n-        } catch (ArtifactResolverException e) {\n+            Path p = ArtifactResolver.resolve(clazz).entrySet().stream()\n+                    .findAny().get().getValue();\n+            path = findNSSLibrary(p, libraryName);\n+        } catch (ArtifactResolverException | IOException e) {\n@@ -787,0 +779,10 @@\n+    private static Path findNSSLibrary(Path path, Path libraryName) throws IOException {\n+        try(Stream<Path> files = Files.find(path, 10,\n+                (tp, attr) -> tp.getFileName().equals(libraryName))) {\n+\n+            return files.findAny()\n+                        .orElseThrow(() -> new SkippedException(\n+                        \"NSS library \\\"\" + libraryName + \"\\\" was not found in \" + path));\n+        }\n+    }\n+\n","filename":"test\/jdk\/sun\/security\/pkcs11\/PKCS11Test.java","additions":28,"deletions":26,"binary":false,"changes":54,"status":"modified"}]}