{"files":[{"patch":"@@ -518,0 +518,3 @@\n+    SecKeychainRef keychain = NULL;\n+    CFMutableArrayRef keychainList = NULL;\n+    CFDictionaryRef search = NULL;\n@@ -520,2 +523,21 @@\n-    \/\/ Read Trust Anchors\n-    if (SecTrustCopyAnchorCertificates(&currAnchors) == errSecSuccess) {\n+    \/\/ Load predefined root certificates from SystemRootCertificates keychain\n+    \/\/ SecTrustCopyAnchorCertificates includes extra root certificates and can not be used here\n+    if( SecKeychainOpen(\"\/System\/Library\/Keychains\/SystemRootCertificates.keychain\", &keychain) != errSecSuccess ) {\n+        return;\n+    }\n+\n+    keychainList = CFArrayCreateMutable(kCFAllocatorDefault, 1, &kCFTypeArrayCallBacks);\n+    if (keychainList == NULL) {\n+        goto errOut;\n+    }\n+    CFArrayAppendValue(keychainList, keychain);\n+\n+    CFTypeRef searchKeys[] = { kSecClass, kSecMatchLimit, kSecReturnRef, kSecMatchSearchList };\n+    CFTypeRef searchValues[] = { kSecClassCertificate, kSecMatchLimitAll, kCFBooleanTrue, keychainList };\n+    search = CFDictionaryCreate(kCFAllocatorDefault,\n+                              searchKeys, searchValues, 4, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);\n+    if (search == NULL) {\n+        goto errOut;\n+    }\n+\n+    if( SecItemCopyMatching( search, (CFTypeRef *)&currAnchors ) == errSecSuccess ){\n@@ -564,0 +586,9 @@\n+    if (search != NULL) {\n+        CFRelease(search);\n+    }\n+    if (keychainList != NULL) {\n+        CFRelease(keychainList);\n+    }\n+    if (keychain != NULL) {\n+        CFRelease(keychain);\n+    }\n","filename":"src\/java.base\/macosx\/native\/libosxsecurity\/KeystoreImpl.m","additions":33,"deletions":2,"binary":false,"changes":35,"status":"modified"}]}