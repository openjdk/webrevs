{"files":[{"patch":"@@ -71,0 +71,1 @@\n+        boolean isReadOnly; \/\/ kSecTrustSettingsDomainSystem certificates\n@@ -140,0 +141,8 @@\n+    private void readOnlyCheck(String alias) throws KeyStoreException {\n+        String lowerAlias = alias.toLowerCase();\n+        if (entries.get(lowerAlias) instanceof TrustedCertEntry oldEntry) {\n+            if (oldEntry.isReadOnly) {\n+                throw new KeyStoreException(\"Trusted entry <\" + alias + \"> can not be modified\");\n+            }\n+        }\n+    }\n@@ -405,0 +414,2 @@\n+                readOnlyCheck(alias);\n+\n@@ -437,0 +448,2 @@\n+            } catch (KeyStoreException kse) {\n+                throw kse;\n@@ -475,0 +488,2 @@\n+            readOnlyCheck(alias);\n+\n@@ -526,0 +541,1 @@\n+            readOnlyCheck(alias);\n@@ -796,1 +812,1 @@\n-            long keychainItemRef, long creationDate, byte[] derStream) {\n+            long keychainItemRef, long creationDate, boolean isReadOnly, byte[] derStream) {\n@@ -806,0 +822,1 @@\n+            tce.isReadOnly = isReadOnly;\n","filename":"src\/java.base\/macosx\/classes\/apple\/security\/KeychainStore.java","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -424,1 +424,1 @@\n-\n+    CFArrayRef currAnchors = NULL;\n@@ -432,1 +432,1 @@\n-            env, jc_KeychainStore, \"createTrustedCertEntry\", \"(Ljava\/lang\/String;Ljava\/util\/List;JJ[B)V\");\n+            env, jc_KeychainStore, \"createTrustedCertEntry\", \"(Ljava\/lang\/String;Ljava\/util\/List;JJZ[B)V\");\n@@ -501,1 +501,1 @@\n-            (*env)->CallVoidMethod(env, keyStore, jm_createTrustedCertEntry, alias, inputTrust, nativeRef, creationDate, certData);\n+            (*env)->CallVoidMethod(env, keyStore, jm_createTrustedCertEntry, alias, inputTrust, nativeRef, creationDate, JNI_FALSE, certData);\n@@ -509,1 +509,0 @@\n-    CFArrayRef currAnchors;\n@@ -511,1 +510,1 @@\n-        CFIndex ncerts = CFArrayGetCount(currAnchors);\n+        CFIndex i, nAnchors = CFArrayGetCount(currAnchors);\n@@ -513,1 +512,1 @@\n-        for (int i = 0; i < ncerts; i++) {\n+        for (i = 0; i < nAnchors; i++) {\n@@ -557,1 +556,1 @@\n-            (*env)->CallVoidMethod(env, keyStore, jm_createTrustedCertEntry, alias, inputTrust, nativeRef, creationDate, certData);\n+            (*env)->CallVoidMethod(env, keyStore, jm_createTrustedCertEntry, alias, inputTrust, nativeRef, creationDate, JNI_TRUE, certData);\n@@ -561,0 +560,1 @@\n+            CFRetain(certRef);\n@@ -565,4 +565,0 @@\n-    if (currAnchors != NULL) {\n-        CFRelease(currAnchors);\n-    }\n-\n@@ -573,0 +569,3 @@\n+    if (currAnchors != NULL) {\n+        CFRelease(currAnchors);\n+    }\n","filename":"src\/java.base\/macosx\/native\/libosxsecurity\/KeystoreImpl.m","additions":10,"deletions":11,"binary":false,"changes":21,"status":"modified"}]}