{"files":[{"patch":"@@ -54,0 +54,11 @@\n+\/\/ AIX is the only platform that uses System V shm for reserving virtual memory.\n+\/\/ In this case, the required alignment of the allocated size (64K) and the alignment\n+\/\/ of possible start points of the memory region (256M) differ.\n+\/\/ This is not reflected by os_allocation_granularity().\n+\/\/ The logic here is dual to the one in pd_reserve_memory in os_aix.cpp\n+static size_t allocation_granularity() {\n+  return\n+    AIX_ONLY(os::vm_page_size() == 4*K ? 4*K : 256*M)\n+    NOT_AIX(os::vm_allocation_granularity());\n+}\n+\n@@ -61,9 +72,1 @@\n-\n-    \/\/ AIX is the only platform that uses System V shm for reserving virtual memory.\n-    \/\/ In this case, the required alignment of the allocated size (64K) and the alignment\n-    \/\/ of possible start points of the memory region (256M) differ.\n-    \/\/ This is not reflected by os_allocation_granularity().\n-    \/\/ The logic here is dual to the one in pd_reserve_memory in os_aix.cpp\n-    AIX_ONLY(EXPECT_TRUE(is_aligned(addr, os::vm_page_size() == 4*K ? 4*K : 256*M)) << ERRINFO)\n-    NOT_AIX(EXPECT_TRUE(is_aligned(addr, os::vm_allocation_granularity())) << ERRINFO);\n-\n+    EXPECT_TRUE(is_aligned(addr, allocation_granularity())) << ERRINFO;\n@@ -185,8 +188,1 @@\n-  \/\/ AIX is the only platform that uses System V shm for reserving virtual memory.\n-  \/\/ In this case, the required alignment of the allocated size (64K) and the alignment\n-  \/\/ of possible start points of the memory region (256M) differ.\n-  \/\/ This is not reflected by os_allocation_granularity().\n-  \/\/ The logic here is dual to the one in pd_reserve_memory in os_aix.cpp\n-  const size_t ag =\n-    AIX_ONLY(os::vm_page_size() == 4*K ? 4*K : 256*M)\n-    NOT_AIX(os::vm_allocation_granularity());\n+  const size_t ag = allocation_granularity();\n@@ -271,9 +267,1 @@\n-\n-  \/\/ AIX is the only platform that uses System V shm for reserving virtual memory.\n-  \/\/ In this case, the required alignment of the allocated size (64K) and the alignment\n-  \/\/ of possible start points of the memory region (256M) differ.\n-  \/\/ This is not reflected by os_allocation_granularity().\n-  \/\/ The logic here is dual to the one in pd_reserve_memory in os_aix.cpp\n-  const size_t ag =\n-    AIX_ONLY(os::vm_page_size() == 4*K ? 4*K : 256*M)\n-    NOT_AIX(os::vm_allocation_granularity());\n+  const size_t ag = allocation_granularity();\n@@ -297,11 +285,1 @@\n-\n-  \/\/ AIX is the only platform that uses System V shm for reserving virtual memory.\n-  \/\/ In this case, the required alignment of the allocated size (64K) and the alignment\n-  \/\/ of possible start points of the memory region (256M) differ.\n-  \/\/ This is not reflected by os_allocation_granularity().\n-  \/\/ The logic here is dual to the one in pd_reserve_memory in os_aix.cpp\n-  const size_t system_allocation_granularity =\n-    AIX_ONLY(os::vm_page_size() == 4*K ? 4*K : 256*M)\n-    NOT_AIX(os::vm_allocation_granularity());\n-\n-  for (size_t range_size = system_allocation_granularity; range_size <= large_end; range_size *= 2) {\n+  for (size_t range_size = allocation_granularity(); range_size <= large_end; range_size *= 2) {\n@@ -312,1 +290,1 @@\n-        for (size_t alignment = system_allocation_granularity; alignment < large_end; alignment *= 2) {\n+        for (size_t alignment = allocation_granularity(); alignment < large_end; alignment *= 2) {\n@@ -323,10 +301,1 @@\n-\n-  \/\/ AIX is the only platform that uses System V shm for reserving virtual memory.\n-  \/\/ In this case, the required alignment of the allocated size (64K) and the alignment\n-  \/\/ of possible start points of the memory region (256M) differ.\n-  \/\/ This is not reflected by os_allocation_granularity().\n-  \/\/ The logic here is dual to the one in pd_reserve_memory in os_aix.cpp\n-  const size_t ag =\n-    AIX_ONLY(os::vm_page_size() == 4*K ? 4*K : 256*M)\n-    NOT_AIX(os::vm_allocation_granularity());\n-\n+  const size_t ag = allocation_granularity();\n@@ -372,10 +341,1 @@\n-\n-  \/\/ AIX is the only platform that uses System V shm for reserving virtual memory.\n-  \/\/ In this case, the required alignment of the allocated size (64K) and the alignment\n-  \/\/ of possible start points of the memory region (256M) differ.\n-  \/\/ This is not reflected by os_allocation_granularity().\n-  \/\/ The logic here is dual to the one in pd_reserve_memory in os_aix.cpp\n-  const size_t ag =\n-    AIX_ONLY(os::vm_page_size() == 4*K ? 4*K : 256*M)\n-    NOT_AIX(os::vm_allocation_granularity());\n-\n+  const size_t ag = allocation_granularity();\n","filename":"test\/hotspot\/gtest\/runtime\/test_os_reserve_between.cpp","additions":18,"deletions":58,"binary":false,"changes":76,"status":"modified"}]}