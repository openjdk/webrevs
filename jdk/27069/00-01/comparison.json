{"files":[{"patch":"@@ -70,0 +70,1 @@\n+    private static final String GET = \"GET\";\n@@ -128,1 +129,1 @@\n-    private static boolean isUpgradeRequest(Headers headers) {\n+    private boolean isUpgradeRequest(Headers headers) {\n@@ -131,0 +132,2 @@\n+            && headers.get(\"Upgrade\") != null\n+            && GET.equals(getRequestMethod())\n@@ -169,0 +172,1 @@\n+            uis_orig = new FixedLengthInputStream (this, ris, 0);\n@@ -263,3 +267,2 @@\n-            if (upgrade) {\n-                o.setWrappedStream(ros);\n-                \/\/ auto-close the exchange when handler exits\n+            if (http10 || upgrade && rCode == 101) {\n+                o.setWrappedStream(new UndefLengthOutputStream (this, ros));\n@@ -269,3 +272,0 @@\n-            } else if (http10) {\n-                o.setWrappedStream (new UndefLengthOutputStream (this, ros));\n-                close = true;\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/ExchangeImpl.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -215,0 +215,1 @@\n+                writer.print(\"Upgrade: custom\" + CRLF);\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/InputRead1xxTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}