[{"commit":{"message":"8341436: containers\/docker\/TestJcmdWithSideCar.java takes needlessly long to run\n\nThe fix is twofold.\n\n1. Stop the main container after an iteration is done. The main container is\n   started with its runtime defined as 120 seconds, which means that each\n   iteration takes 120 seconds. In reality, one iteration takes a few seconds\n   while 115 seconds is spent waiting on the main container exiting.\n\n2. Change the name of the main container to be unique per iteration.\n   Containers are started with `--rm`, which means they are removed after\n   exiting. However, the removal is done asynchronously _after_ the `stop`\n   command has returned. This means that the second iteration may get an error\n   if the same container name is used if the removal was not done before the\n   container is started in the next iteration.\n\nOn my machine, this cuts down the test runtime using Podman from 4m 13s to 17s.\nUsing Docker, the runtime goes from 4m 15s to 41s.\n\nPodman only runs half the test cases (since JDK-8341310) which explain some of\nthe difference. But there is also something strange going on in the Docker\ncase; every `docker stop` call takes 10 seconds, and I have not been able to\nfigure out what exactly causes it.\n\nDoing a manual `kill [container Java process PID]` gracefully terminates the\nJava process and container, but `docker stop` never does. Instead, it blocks\nfor 10 seconds before abruptly killing the process using `SIGKILL`. I confirmed\nthis with a simplified case and both\n`strace -e 'trace=!all' docker run --init eclipse-temurin:23 java ..` and\n`strace -e 'trace=!all' docker run eclipse-temurin:23 java ..`, no signals were\never visible when calling either `docker stop` or `docker kill`.\n\nhttps:\/\/www.docker.com\/blog\/docker-best-practices-choosing-between-run-cmd-and-entrypoint\/\nand \"What is PID 1 and why does it matter?\" talks about why [`--init`](https:\/\/docs.docker.com\/reference\/cli\/docker\/container\/run\/#init)\nis supposed to help."},"files":[{"filename":"test\/hotspot\/jtreg\/containers\/docker\/TestJcmdWithSideCar.java"},{"filename":"test\/lib\/jdk\/test\/lib\/containers\/docker\/DockerTestUtils.java"}],"sha":"448455c23866dc7421bcf9afa6b4640e815ea06c"}]