{"files":[{"patch":"@@ -61,1 +61,1 @@\n- *              -Djdk.httpclient.HttpClient.log=requests,responses,headers,errors\n+ *              -Djdk.httpclient.HttpClient.log=errors\n@@ -75,2 +75,2 @@\n-    private final Semaphore responseSemaphore = new Semaphore(0);\n-    private final Semaphore requestSemaphore = new Semaphore(0);\n+    private Semaphore responseSemaphore;\n+    private Semaphore requestSemaphore;\n@@ -83,1 +83,1 @@\n-    private boolean blockResponse() {\n+    private boolean blockResponse(Semaphore request, Semaphore response) {\n@@ -85,2 +85,2 @@\n-            requestSemaphore.release();\n-            responseSemaphore.acquire();\n+            request.release();\n+            response.acquire();\n@@ -95,1 +95,3 @@\n-    void beforeTest() throws Exception {\n+    synchronized void beforeTest() throws Exception {\n+        requestSemaphore = new Semaphore(0);\n+        responseSemaphore = new Semaphore(0);\n@@ -102,1 +104,2 @@\n-        \/\/ create a h2 server\n+\n+        \/\/ create a https server for HTTP\/1.1\n@@ -105,1 +108,1 @@\n-            if (blockResponse()) {\n+            if (blockResponse(requestSemaphore, responseSemaphore)) {\n@@ -115,0 +118,1 @@\n+        \/\/ create a plain http server for HTTP\/1.1\n@@ -117,1 +121,1 @@\n-            if (blockResponse()) {\n+            if (blockResponse(requestSemaphore, responseSemaphore)) {\n@@ -129,1 +133,1 @@\n-    void afterTest() throws Exception {\n+    synchronized void afterTest() throws Exception {\n@@ -138,1 +142,10 @@\n-        serverExecutor.close();\n+        if (serverExecutor != null) {\n+            serverExecutor.close();\n+        }\n+        requestSemaphore = null;\n+        responseSemaphore = null;\n+        serverExecutor = null;\n+        http1Server = null;\n+        https1Server = null;\n+        http1URI = null;\n+        https1URI = null;\n@@ -165,1 +178,1 @@\n-    private void sendManyRequests(final String requestURI, final int many, boolean shutdown) throws Exception {\n+    private synchronized void sendManyRequests(final String requestURI, final int many, boolean shutdown) throws Exception {\n","filename":"test\/jdk\/java\/net\/httpclient\/PlainConnectionLockTest.java","additions":26,"deletions":13,"binary":false,"changes":39,"status":"modified"}]}