{"files":[{"patch":"@@ -26,3 +26,1 @@\n-#include <stdlib.h> \/\/ do not reorder\n-#include <stdint.h> \/\/ do not reorder\n-\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -33,0 +31,2 @@\n+#include <stdint.h>\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/immediate_aarch64.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,0 +2,1 @@\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,2 +26,2 @@\n-#ifndef _IMMEDIATE_H\n-#define _IMMEDIATE_H\n+#ifndef CPU_AARCH64_IMMEDIATE_AARCH64_HPP\n+#define CPU_AARCH64_IMMEDIATE_AARCH64_HPP\n@@ -28,1 +29,1 @@\n-#include <sys\/types.h>\n+#include <stdint.h>\n@@ -54,1 +55,1 @@\n-#endif \/\/ _IMMEDIATE_H\n+#endif \/\/ CPU_AARCH64_IMMEDIATE_AARCH64_HPP\n","filename":"src\/hotspot\/cpu\/aarch64\/immediate_aarch64.hpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -28,3 +29,0 @@\n-#include <stdlib.h>\n-#include <dlfcn.h>\n-#include <string.h>\n@@ -35,0 +33,2 @@\n+#include <dlfcn.h>\n+#include <string.h>\n","filename":"src\/hotspot\/os\/aix\/libodm_aix.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,0 +35,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -36,1 +37,0 @@\n-#include <stdlib.h>\n","filename":"src\/hotspot\/os\/aix\/libperfstat_aix.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -49,1 +50,0 @@\n-#include <stdlib.h>\n","filename":"src\/hotspot\/os\/aix\/os_perf_aix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -37,1 +38,0 @@\n-#include <stdlib.h>\n","filename":"src\/hotspot\/os\/bsd\/memMapPrinter_macosx.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -99,1 +100,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -43,1 +44,0 @@\n-#include <stdlib.h>\n","filename":"src\/hotspot\/os\/linux\/os_perf_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -39,0 +39,3 @@\n+\/\/ POSIX puts _exit in <unistd.h>.\n+FORBID_IMPORTED_NORETURN_C_FUNCTION(void _exit(int), \/* not noexcept *\/, \"use os::exit\")\n+\n@@ -42,6 +45,0 @@\n-\/\/ These are unimplementable for Windows, and they aren't useful for a\n-\/\/ POSIX implementation of NMT either.\n-\/\/ https:\/\/stackoverflow.com\/questions\/62962839\/stdaligned-alloc-missing-from-visual-studio-2019\n-FORBID_C_FUNCTION(int posix_memalign(void**, size_t, size_t), noexcept, \"don't use\");\n-FORBID_C_FUNCTION(void* aligned_alloc(size_t, size_t), noexcept, \"don't use\");\n-\n","filename":"src\/hotspot\/os\/posix\/forbiddenFunctions_posix.hpp","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -31,0 +32,2 @@\n+#include <unistd.h>\n+\n@@ -37,0 +40,2 @@\n+[[noreturn]] inline void _exit(int status) { ::_exit(status); }\n+\n","filename":"src\/hotspot\/os\/posix\/permitForbiddenFunctions_posix.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -37,0 +38,2 @@\n+[[noreturn]] inline void _exit(int status) { ::_exit(status); }\n+\n","filename":"src\/hotspot\/os\/windows\/permitForbiddenFunctions_windows.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n","filename":"src\/hotspot\/os\/windows\/vmError_windows.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -66,1 +67,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/bsd_aarch64\/os_bsd_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -61,1 +62,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/bsd_x86\/os_bsd_x86.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -62,1 +63,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/linux_aarch64\/os_linux_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -60,1 +61,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/linux_arm\/os_linux_arm.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -65,1 +66,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/linux_ppc\/os_linux_ppc.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -64,1 +65,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/linux_riscv\/os_linux_riscv.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+#include \"cppstdlib\/cstdlib.h\"\n@@ -65,1 +66,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/linux_s390\/os_linux_s390.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -62,1 +63,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/linux_x86\/os_linux_x86.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -57,1 +58,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/os_cpu\/windows_aarch64\/os_windows_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -84,1 +85,0 @@\n-#include <stdlib.h>\n","filename":"src\/hotspot\/share\/classfile\/classLoader.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,105 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+#ifndef SHARE_CPPSTDLIB_CSTDLIB_HPP\n+#define SHARE_CPPSTDLIB_CSTDLIB_HPP\n+\n+#include \"utilities\/compilerWarnings.hpp\"\n+\n+\/\/ HotSpot usage for <cstdlib>:\n+\/\/\n+\/\/ Some functions are explicitly forbidden below. That may not be a complete\n+\/\/ list of all the functions we should forbid.\n+\/\/\n+\/\/ We assume <cstdlib> provides definitions in the global namespace, in\n+\/\/ addition to providing them in the std namespace. We prefer to use the names\n+\/\/ in the global namespace.\n+\n+BEGIN_ALLOW_FORBIDDEN_FUNCTIONS\n+#include \"utilities\/vmassert_uninstall.hpp\"\n+\n+#include <cstdlib>\n+\n+#include \"utilities\/vmassert_reinstall.hpp\" \/\/ don't reorder\n+END_ALLOW_FORBIDDEN_FUNCTIONS\n+\n+\/\/ AIX may define malloc and calloc as macros when certain other features are\n+\/\/ present, causing us all sorts of grief.\n+\/\/ https:\/\/www.ibm.com\/docs\/en\/openxl-c-and-cpp-aix\/17.1.4?topic=compilers-memory-allocation\n+\/\/ Replace the macro definitions with something we can work with.\n+\/\/ AIX 7.3 no longer uses macro renaming when building with clang, instead\n+\/\/ using the same asm replacement approach as used below.  This workaround can\n+\/\/ be removed once earlier versions are no longer supported as build platforms.\n+#if defined(AIX) && (defined(__VEC__) || defined(__AIXVEC))\n+#if defined(malloc) || defined(calloc)\n+#if !defined(malloc) || !defined(calloc)\n+#error \"Inconsistent alloc macro mappings, expected both to be mapped.\"\n+#endif\n+\/\/ Remove the macros.\n+#undef malloc\n+#undef calloc\n+\/\/ Implement the mapping using gcc\/clang asm name mapping.\n+extern \"C\" {\n+extern void* malloc(size_t) noexcept asm(\"vec_malloc\");\n+extern void* calloc(size_t, size_t) noexcept asm(\"vec_calloc\");\n+} \/\/ extern \"C\"\n+\/\/ Because the macros are in place when <cstdlib> brings names into the std\n+\/\/ namespace, macro replacement causes the expanded names to be added instead\n+\/\/ of the intended names. We can't remove std::vec_malloc and std::vec_calloc,\n+\/\/ but we do add the standard names in case someone uses them.\n+namespace std {\n+using ::malloc;\n+using ::calloc;\n+} \/\/ namespace std\n+#endif \/\/ Macro definition for malloc or calloc\n+#endif \/\/ AIX altivec allocator support\n+\n+\/\/ Prefer os:: variants of these.\n+FORBID_IMPORTED_NORETURN_C_FUNCTION(void exit(int), noexcept, \"use os::exit\")\n+FORBID_IMPORTED_NORETURN_C_FUNCTION(void _Exit(int), noexcept, \"use os::exit\")\n+\n+\/\/ Windows puts _exit in <stdlib.h>. POSIX puts it in <unistd.h>.\n+\/\/ We can't forbid it here when using clang if it's not in <stdlib.h> - see\n+\/\/ the clang definition for FORBIDDEN_FUNCTION_NORETURN_ATTRIBUTE.\n+#ifdef _WINDOWS\n+FORBID_IMPORTED_NORETURN_C_FUNCTION(void _exit(int), \/* not noexcept *\/, \"use os::exit\")\n+#endif \/\/ _WINDOWS\n+\n+\/\/ These functions return raw C-heap pointers or, in case of free(), take raw\n+\/\/ C-heap pointers.  We generally want allocation to be done through NMT, using\n+\/\/ os::malloc and friends.\n+FORBID_IMPORTED_C_FUNCTION(void* malloc(size_t), noexcept, \"use os::malloc\");\n+FORBID_IMPORTED_C_FUNCTION(void free(void*), noexcept, \"use os::free\");\n+FORBID_IMPORTED_C_FUNCTION(void* calloc(size_t, size_t), noexcept, \"use os::malloc and zero out manually\");\n+FORBID_IMPORTED_C_FUNCTION(void* realloc(void*, size_t), noexcept, \"use os::realloc\");\n+\n+\/\/ These are not provided (and are unimplementable?) by Windows.\n+\/\/ https:\/\/stackoverflow.com\/questions\/62962839\/stdaligned-alloc-missing-from-visual-studio-2019\n+\/\/ They also aren't useful for a POSIX implementation of NMT.\n+#ifndef _WINDOWS\n+FORBID_C_FUNCTION(void* aligned_alloc(size_t, size_t), noexcept, \"don't use\");\n+FORBID_C_FUNCTION(int posix_memalign(void**, size_t, size_t), noexcept, \"don't use\");\n+#endif \/\/ !_WINDOWS\n+\n+#endif \/\/ SHARE_CPPSTDLIB_CSTDLIB_HPP\n","filename":"src\/hotspot\/share\/cppstdlib\/cstdlib.hpp","additions":105,"deletions":0,"binary":false,"changes":105,"status":"added"},{"patch":"@@ -144,1 +144,1 @@\n-#include <cstdlib>\n+#include \"cppstdlib\/cstdlib.hpp\"\n","filename":"src\/hotspot\/share\/utilities\/byteswap.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -35,6 +35,0 @@\n-\/\/ Workaround for noreturn functions: exit, _exit, _Exit - see the clang\n-\/\/ definition of FORBIDDEN_FUNCTION_NORETURN_ATTRIBUTE.\n-#ifdef __clang__\n-#include <stdlib.h>\n-#endif\n-\n@@ -52,6 +46,0 @@\n-FORBID_IMPORTED_NORETURN_C_FUNCTION(void exit(int), noexcept, \"use os::exit\")\n-FORBID_IMPORTED_NORETURN_C_FUNCTION(void _Exit(int), noexcept, \"use os::exit\")\n-\n-\/\/ Windows puts _exit in <stdlib.h>, POSIX in <unistd.h>.\n-FORBID_IMPORTED_NORETURN_C_FUNCTION(void _exit(int), \/* not noexcept *\/, \"use os::exit\")\n-\n@@ -73,7 +61,2 @@\n-\/\/ All of the following functions return raw C-heap pointers (sometimes as an\n-\/\/ option, e.g. realpath or getwd) or, in case of free(), take raw C-heap\n-\/\/ pointers.  We generally want allocation to be done through NMT.\n-FORBID_IMPORTED_C_FUNCTION(void* malloc(size_t size), noexcept, \"use os::malloc\");\n-FORBID_IMPORTED_C_FUNCTION(void free(void *ptr), noexcept, \"use os::free\");\n-FORBID_IMPORTED_C_FUNCTION(void* calloc(size_t nmemb, size_t size), noexcept, \"use os::malloc and zero out manually\");\n-FORBID_IMPORTED_C_FUNCTION(void* realloc(void *ptr, size_t size), noexcept, \"use os::realloc\");\n+\/\/ All of the following functions return raw C-heap pointers.  We generally\n+\/\/ want allocation to be done through NMT.\n","filename":"src\/hotspot\/share\/utilities\/forbiddenFunctions.hpp","additions":2,"deletions":19,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -34,0 +34,2 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n+\n@@ -47,9 +49,0 @@\n-#include <stdlib.h>\n-\/\/ In stdlib.h on AIX malloc is defined as a macro causing\n-\/\/ compiler errors when resolving them in different depths as it\n-\/\/ happens in the log tags. This avoids the macro.\n-#if (defined(__VEC__) || defined(__AIXVEC)) && defined(AIX) \\\n-    && defined(__open_xl_version__) && __open_xl_version__ >= 17\n-  #undef malloc\n-  extern void *malloc(size_t) asm(\"vec_malloc\");\n-#endif\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions_gcc.hpp","additions":2,"deletions":9,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -37,0 +37,2 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n+\n@@ -48,1 +50,0 @@\n-# include <stdlib.h>\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions_visCPP.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -36,1 +37,0 @@\n-#include <stdlib.h>\n","filename":"src\/hotspot\/share\/utilities\/parseInteger.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -37,0 +38,3 @@\n+#include <stdio.h>\n+#include <string.h>\n+\n@@ -56,1 +60,0 @@\n-[[noreturn]] inline void _exit(int status) { ::_exit(status); }\n","filename":"src\/hotspot\/share\/utilities\/permitForbiddenFunctions.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -34,1 +35,0 @@\n-#include <stdlib.h>\n","filename":"test\/hotspot\/gtest\/gtestMain.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -29,1 +30,0 @@\n-#include <stdlib.h>\n","filename":"test\/hotspot\/gtest\/unittest.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -24,0 +24,1 @@\n+#include \"cppstdlib\/cstdlib.hpp\"\n@@ -32,2 +33,0 @@\n-#include <stdlib.h>\n-\n","filename":"test\/hotspot\/gtest\/utilities\/test_bitMap_setops.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}