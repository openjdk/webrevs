{"files":[{"patch":"@@ -109,2 +109,1 @@\n-    size_t shift = MetaspaceShared::oopmap_leading_zeros();\n-    narrowOop* p = _start + offset + shift;\n+    narrowOop* p = _start + offset;\n@@ -127,2 +126,1 @@\n-    size_t shift = MetaspaceShared::oopmap_leading_zeros();\n-    narrowOop* p = _start + offset + shift;\n+    narrowOop* p = _start + offset;\n@@ -150,2 +148,1 @@\n-    size_t shift = MetaspaceShared::oopmap_leading_zeros();\n-    oop* p = _start + offset + shift;\n+    oop* p = _start + offset;\n@@ -170,0 +167,1 @@\n+  narrowOop* patching_start = (narrowOop*)region.start() + MetaspaceShared::oopmap_start_pos();\n@@ -176,1 +174,1 @@\n-      PatchCompressedEmbeddedPointersQuick patcher((narrowOop*)region.start(), quick_delta);\n+      PatchCompressedEmbeddedPointersQuick patcher(patching_start, quick_delta);\n@@ -181,1 +179,1 @@\n-    PatchCompressedEmbeddedPointers patcher((narrowOop*)region.start());\n+    PatchCompressedEmbeddedPointers patcher(patching_start);\n@@ -195,1 +193,1 @@\n-    PatchUncompressedEmbeddedPointers patcher((oop*)region.start());\n+    PatchUncompressedEmbeddedPointers patcher((oop*)region.start() + MetaspaceShared::oopmap_start_pos());\n@@ -246,2 +244,1 @@\n-    size_t shift = MetaspaceShared::oopmap_leading_zeros();\n-    narrowOop* p = _start + offset + shift;\n+    narrowOop* p = _start + offset;\n@@ -316,1 +313,1 @@\n-  PatchLoadedRegionPointers patcher((narrowOop*)load_address, loaded_region);\n+  PatchLoadedRegionPointers patcher((narrowOop*)load_address + MetaspaceShared::oopmap_start_pos(), loaded_region);\n@@ -430,2 +427,1 @@\n-    size_t shift = MetaspaceShared::ptrmap_leading_zeros();\n-    Metadata** p = _start + offset + shift;\n+    Metadata** p = _start + offset;\n@@ -450,1 +446,1 @@\n-    PatchNativePointers patcher((Metadata**)r->mapped_base());\n+    PatchNativePointers patcher((Metadata**)r->mapped_base() + MetaspaceShared::ptrmap_start_pos());\n","filename":"src\/hotspot\/share\/cds\/archiveHeapLoader.cpp","additions":11,"deletions":15,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -638,1 +638,1 @@\n-  if (idx < MetaspaceShared::ptrmap_leading_zeros()) {\n+  if (idx < MetaspaceShared::ptrmap_start_pos()) {\n@@ -641,1 +641,1 @@\n-    idx -= MetaspaceShared::ptrmap_leading_zeros();\n+    idx -= MetaspaceShared::ptrmap_start_pos();\n","filename":"src\/hotspot\/share\/cds\/archiveHeapWriter.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -292,2 +292,2 @@\n-  st->print_cr(\"- heap_oopmap_leading_zeros:      \" SIZE_FORMAT, _heap_oopmap_leading_zeros);\n-  st->print_cr(\"- heap_ptrmap_leading_zeros:      \" SIZE_FORMAT, _heap_ptrmap_leading_zeros);\n+  st->print_cr(\"- _heap_oopmap_start_pos:      \" SIZE_FORMAT, _heap_oopmap_start_pos);\n+  st->print_cr(\"- _heap_ptrmap_start_pos:      \" SIZE_FORMAT, _heap_ptrmap_start_pos);\n@@ -1596,4 +1596,4 @@\n-    header()->set_heap_oopmap_leading_zeros(removed_oop_zeros);\n-    header()->set_heap_ptrmap_leading_zeros(removed_ptr_zeros);\n-    MetaspaceShared::set_heap_oopmap_leading_zeros(removed_oop_zeros);\n-    MetaspaceShared::set_heap_ptrmap_leading_zeros(removed_ptr_zeros);\n+    header()->set_heap_oopmap_start_pos(removed_oop_zeros);\n+    header()->set_heap_ptrmap_start_pos(removed_ptr_zeros);\n+    MetaspaceShared::set_heap_oopmap_start_pos(removed_oop_zeros);\n+    MetaspaceShared::set_heap_ptrmap_start_pos(removed_ptr_zeros);\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -231,2 +231,2 @@\n-  size_t _heap_oopmap_leading_zeros;    \/\/ The number of leading zero bits in the heap oopmap.\n-  size_t _heap_ptrmap_leading_zeros;    \/\/ The number of leading zero bits in the heap ptrmap.\n+  size_t _heap_oopmap_start_pos;        \/\/ The first bit in the oopmap corresponds to this position in the heap.\n+  size_t _heap_ptrmap_start_pos;        \/\/ The first bit in the ptrmap corresponds to this position in the heap.\n@@ -274,2 +274,2 @@\n-  size_t heap_oopmap_leading_zeros()       const { return _heap_oopmap_leading_zeros;}\n-  size_t heap_ptrmap_leading_zeros()       const { return _heap_ptrmap_leading_zeros;}\n+  size_t heap_oopmap_start_pos()           const { return _heap_oopmap_start_pos;}\n+  size_t heap_ptrmap_start_pos()           const { return _heap_ptrmap_start_pos;}\n@@ -288,2 +288,2 @@\n-  void set_heap_oopmap_leading_zeros(size_t n)   { _heap_oopmap_leading_zeros = n; }\n-  void set_heap_ptrmap_leading_zeros(size_t n)   { _heap_ptrmap_leading_zeros = n; }\n+  void set_heap_oopmap_start_pos(size_t n)       { _heap_oopmap_start_pos = n; }\n+  void set_heap_ptrmap_start_pos(size_t n)       { _heap_ptrmap_start_pos = n; }\n@@ -387,2 +387,2 @@\n-  size_t  heap_oopmap_leading_zeros() const { return header()->heap_oopmap_leading_zeros(); }\n-  size_t  heap_ptrmap_leading_zeros() const { return header()->heap_ptrmap_leading_zeros(); }\n+  size_t  heap_oopmap_start_pos() const { return header()->heap_oopmap_start_pos(); }\n+  size_t  heap_ptrmap_start_pos() const { return header()->heap_ptrmap_start_pos(); }\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -100,2 +100,2 @@\n-size_t MetaspaceShared::_ptrmap_leading_zeros = 0;\n-size_t MetaspaceShared::_oopmap_leading_zeros = 0;\n+size_t MetaspaceShared::_ptrmap_start_pos = 0;\n+size_t MetaspaceShared::_oopmap_start_pos = 0;\n@@ -933,2 +933,2 @@\n-    _oopmap_leading_zeros = static_mapinfo->header()->heap_oopmap_leading_zeros();\n-    _ptrmap_leading_zeros = static_mapinfo->header()->heap_ptrmap_leading_zeros();\n+    _oopmap_start_pos = static_mapinfo->header()->heap_oopmap_start_pos();\n+    _ptrmap_start_pos = static_mapinfo->header()->heap_ptrmap_start_pos();\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -56,2 +56,2 @@\n-  static size_t _ptrmap_leading_zeros;\n-  static size_t _oopmap_leading_zeros;\n+  static size_t _ptrmap_start_pos;\n+  static size_t _oopmap_start_pos;\n@@ -169,2 +169,2 @@\n-  static size_t oopmap_leading_zeros() { return _oopmap_leading_zeros; }\n-  static size_t ptrmap_leading_zeros() { return _ptrmap_leading_zeros; }\n+  static size_t oopmap_start_pos() { return _oopmap_start_pos; }\n+  static size_t ptrmap_start_pos() { return _ptrmap_start_pos; }\n@@ -172,2 +172,2 @@\n-  static void set_heap_oopmap_leading_zeros(size_t leading_zeros) { _oopmap_leading_zeros = leading_zeros; }\n-  static void set_heap_ptrmap_leading_zeros(size_t leading_zeros) { _ptrmap_leading_zeros = leading_zeros; }\n+  static void set_heap_oopmap_start_pos(size_t leading_zeros) { _oopmap_start_pos = leading_zeros; }\n+  static void set_heap_ptrmap_start_pos(size_t leading_zeros) { _ptrmap_start_pos = leading_zeros; }\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"}]}