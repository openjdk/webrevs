{"files":[{"patch":"@@ -1570,0 +1570,17 @@\n+size_t FileMapInfo::remove_bitmap_leading_zeros(CHeapBitMap* map) {\n+  size_t old_zeros = map->find_first_set_bit(0);\n+  size_t old_size = map->size_in_bytes();\n+\n+  \/\/ Slice and resize bitmap\n+  map->slice(old_zeros);\n+\n+  \/\/ Bitmap is word aligned so some leading zeros will be left over\n+  \/\/ We want to keep track of how many zeros were removed\n+  size_t new_zeros = map->find_first_set_bit(0);\n+  size_t removed_zeros = old_zeros - new_zeros;\n+\n+  assert(new_zeros <= old_zeros, \"Should have removed leading zeros\");\n+  assert(map->size_in_bytes() <= old_size, \"Map size should have decreased\");\n+  return old_zeros - new_zeros;\n+}\n+\n@@ -1576,17 +1593,2 @@\n-    size_t old_oop_zeros = heap_info->oopmap()->find_first_set_bit(0);\n-    size_t old_ptr_zeros = heap_info->ptrmap()->find_first_set_bit(0);\n-\n-    size_t old_oop_size = heap_info->oopmap()->size_in_bytes();\n-    size_t old_ptr_size = heap_info->ptrmap()->size_in_bytes();\n-\n-    \/\/ Slice and resize bitmaps\n-    heap_info->oopmap()->slice(old_oop_zeros);\n-    heap_info->ptrmap()->slice(old_ptr_zeros);\n-\n-    \/\/ Bitmap is word aligned so some leading zeros will be left over\n-    \/\/ We want to keep track of how many zeros were removed\n-    size_t new_oop_zeros = heap_info->oopmap()->find_first_set_bit(0);\n-    size_t new_ptr_zeros = heap_info->ptrmap()->find_first_set_bit(0);\n-\n-    size_t removed_oop_zeros = old_oop_zeros - new_oop_zeros;\n-    size_t removed_ptr_zeros = old_ptr_zeros - new_ptr_zeros;\n+    size_t removed_oop_zeros = remove_bitmap_leading_zeros(heap_info->oopmap());\n+    size_t removed_ptr_zeros = remove_bitmap_leading_zeros(heap_info->ptrmap());\n@@ -1599,5 +1601,0 @@\n-    assert(new_oop_zeros <= old_oop_zeros, \"Should have removed leading zeros\");\n-    assert(new_ptr_zeros <= old_ptr_zeros, \"Should have removed leading zeros\");\n-    assert(heap_info->oopmap()->size_in_bytes() <= old_oop_size, \"Heap oopmap size should have decreased\");\n-    assert(heap_info->ptrmap()->size_in_bytes() <= old_ptr_size, \"Heap ptrmap size should have decreased\");\n-\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":19,"deletions":22,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -445,0 +445,1 @@\n+  size_t remove_bitmap_leading_zeros(CHeapBitMap* map);\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}