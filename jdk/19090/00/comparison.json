{"files":[{"patch":"@@ -27,0 +27,1 @@\n+import java.time.Instant;\n@@ -29,1 +30,1 @@\n-import java.util.concurrent.atomic.AtomicLong;\n+import java.util.Collections;\n@@ -109,2 +110,2 @@\n-        AtomicLong outerCount = new AtomicLong();\n-        AtomicLong innerCount = new AtomicLong();\n+        List<String> outerStream = Collections.synchronizedList(new ArrayList<>());\n+        List<String> innerStream = Collections.synchronizedList(new ArrayList<>());\n@@ -112,1 +113,1 @@\n-            outer.onEvent(e -> outerCount.incrementAndGet());\n+            outer.onEvent(e -> outerStream.add(eventToText(e)));\n@@ -122,1 +123,1 @@\n-                inner.onEvent(e -> innerCount.incrementAndGet());\n+                inner.onEvent(e -> innerStream.add(eventToText(e)));\n@@ -141,1 +142,1 @@\n-                System.out.println(\"RecordingStream outer:\");\n+                System.out.println(\"Outer dump:\");\n@@ -143,2 +144,4 @@\n-                System.out.println(dumpOuter);\n-                System.out.println(\"RecordingStream inner:\");\n+                for (RecordedEvent e : dumpOuter) {\n+                    System.out.println(eventToText(e));\n+                }\n+                System.out.println(\"Inner dump:\");\n@@ -146,3 +149,12 @@\n-                System.out.println(dumpInner);\n-                System.out.println(\"Outer count: \" + outerCount);\n-                System.out.println(\"Inner count: \" + innerCount);\n+                for (RecordedEvent e : dumpInner) {\n+                    System.out.println(eventToText(e));\n+                }\n+                System.out.println();\n+                System.out.println(\"Outer stream:\");\n+                for (String s : outerStream) {\n+                    System.out.println(s);\n+                }\n+                System.out.println(\"Inner stream:\");\n+                for (String s : innerStream) {\n+                    System.out.println(s);\n+                }\n@@ -152,1 +164,1 @@\n-                if (outerCount.get() != 3) {\n+                if (outerStream.size() != 3) {\n@@ -158,1 +170,1 @@\n-                if (innerCount.get() != 1) {\n+                if (innerStream.size() != 1) {\n@@ -165,0 +177,8 @@\n+    private static String eventToText(RecordedEvent event) {\n+        Instant timestamp = event.getEndTime();\n+        long s = timestamp.getEpochSecond();\n+        int n = timestamp.getNano();\n+        String id = event.getString(\"id\");\n+        return id + \": n=\" + n + \" s=\" + s + \" t=\" + timestamp;\n+    }\n+\n","filename":"test\/jdk\/jdk\/jfr\/api\/consumer\/recordingstream\/TestStop.java","additions":33,"deletions":13,"binary":false,"changes":46,"status":"modified"}]}