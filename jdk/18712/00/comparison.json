{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,3 +53,3 @@\n-    private String filename;\n-    private File file;\n-    private File stopFile;\n+    private final String filename;\n+    private final File file;\n+    private final File stopFile;\n@@ -57,1 +57,0 @@\n-    private FileChannel channel;\n@@ -63,1 +62,1 @@\n-    private Semaphore lockSem = new Semaphore(1);\n+    private final Semaphore lockSem = new Semaphore(1);\n@@ -92,1 +91,0 @@\n-        channel = rwfile.getChannel();\n@@ -99,3 +97,0 @@\n-        if (channel == null) {\n-            initializeChannel();\n-        }\n@@ -103,0 +98,5 @@\n+        if (rwfile != null) {\n+            throw new IllegalStateException(\"rwfile not null\");\n+        }\n+        initializeChannel();\n+        FileChannel channel = rwfile.getChannel();\n@@ -113,2 +113,1 @@\n-            \/\/ Not locked, remain ignorant about port file contents.\n-            return;\n+            throw new IllegalStateException(\"Must lock before calling getValues\");\n@@ -159,0 +158,3 @@\n+        if (lock == null) {\n+            throw new IllegalStateException(\"Must lock before calling setValues\");\n+        }\n@@ -172,6 +174,4 @@\n-        \/\/ Access to file must be closed before deleting.\n-        rwfile.close();\n-\n-        file.delete();\n-\n-        \/\/ Wait until file has been deleted (deletes are asynchronous on Windows!) otherwise we\n+        if (!file.exists()) { \/\/ file deleted already\n+            return;\n+        }\n+        \/\/ Keep trying until file has been deleted, otherwise we\n@@ -179,1 +179,1 @@\n-        for (int i = 0; i < 10 && file.exists(); i++) {\n+        for (int i = 0; i < 10 && file.exists() && !file.delete(); i++) {\n@@ -185,0 +185,2 @@\n+        \/\/ allow some time for late clients to connect\n+        Thread.sleep(1000);\n@@ -213,1 +215,1 @@\n-            return;\n+            throw new IllegalStateException(\"Not locked\");\n@@ -217,0 +219,2 @@\n+        rwfile.close();\n+        rwfile = null;\n","filename":"make\/langtools\/tools\/javacserver\/shared\/PortFile.java","additions":24,"deletions":20,"binary":false,"changes":44,"status":"modified"}]}