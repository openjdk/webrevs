{"files":[{"patch":"@@ -1488,1 +1488,1 @@\n-    ret.waiter_count = nWant + nWait;\n+    ret.waiter_count = nWant;\n@@ -1518,1 +1518,1 @@\n-    if (ret.waiter_count > 0) {\n+    if (ret.waiter_count > 0 || ret.notify_waiter_count > 0) {\n@@ -1552,2 +1552,7 @@\n-            ret.waiters[offset + j] = (jthread)jni_reference(calling_thread, th);\n-            ret.notify_waiters[j++] = (jthread)jni_reference(calling_thread, th);\n+            if (java_lang_Thread::get_thread_status(w->threadObj()) ==\n+                JavaThreadStatus::BLOCKED_ON_MONITOR_ENTER) {\n+              \/\/ thread is re-entering the monitor in an Object.wait() call\n+              ret.waiters[nWant++] = (jthread)jni_reference(calling_thread, th);\n+            } else {\n+              ret.notify_waiters[j++] = (jthread)jni_reference(calling_thread, th);\n+            }\n@@ -1561,1 +1566,1 @@\n-    ret.waiter_count = nWant + nWait;\n+    ret.waiter_count = nWant;\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -222,1 +222,1 @@\n-            (void)outStream_writeInt(out, info.waiter_count);\n+            (void)outStream_writeInt(out, info.waiter_count + info.notify_waiter_count);\n@@ -226,0 +226,3 @@\n+            for (i = 0; i < info.notify_waiter_count; i++) {\n+                (void)outStream_writeObjectRef(env, out, info.notify_waiters[i]);\n+            }\n@@ -230,0 +233,2 @@\n+        if (info.notify_waiters != NULL )\n+            jvmtiDeallocate(info.notify_waiters);\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/ObjectReferenceImpl.c","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -97,1 +97,1 @@\n-        jthread owner, jint entryCount, jint waiterCount) {\n+        jthread owner, jint entryCount, jint notifyWaiterCount) {\n@@ -160,1 +160,1 @@\n-    if (inf.waiter_count != waiterCount) {\n+    if (inf.notify_waiter_count != notifyWaiterCount) {\n@@ -162,1 +162,1 @@\n-               i, waiterCount, inf.waiter_count);\n+               i, notifyWaiterCount, inf.notify_waiter_count);\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/GetObjectMonitorUsage\/objmonusage001\/objmonusage001.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,1 +51,1 @@\n-                             int entryCount, int waiterCount);\n+                             int entryCount, int notifyWaiterCount);\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/GetObjectMonitorUsage\/objmonusage003.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -98,1 +98,1 @@\n-        jint entryCount, jint waiterCount) {\n+        jint entryCount, jint notifyWaiterCount) {\n@@ -149,1 +149,1 @@\n-    if (inf.waiter_count != waiterCount) {\n+    if (inf.notify_waiter_count != notifyWaiterCount) {\n@@ -151,1 +151,1 @@\n-               count, waiterCount, inf.waiter_count);\n+               count, notifyWaiterCount, inf.notify_waiter_count);\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/GetObjectMonitorUsage\/objmonusage003\/objmonusage003.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}