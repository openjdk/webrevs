{"files":[{"patch":"@@ -55,0 +55,6 @@\n+    \/\/ spurious wakeup detection\n+    static boolean wasSpuriousWakeup;\n+    static boolean notifiedAll;\n+    static int notifiedCount;\n+    static int wokeupCount;\n+\n@@ -81,0 +87,1 @@\n+        task.setName(thread.getName());\n@@ -85,0 +92,7 @@\n+    static void initSpuriousWakeupDetection() {\n+        wasSpuriousWakeup = false;\n+        notifiedAll = false;\n+        notifiedCount = 0;\n+        wokeupCount = 0;\n+    }\n+\n@@ -86,0 +100,1 @@\n+        initSpuriousWakeupDetection();\n@@ -111,0 +126,1 @@\n+            Thread.sleep(400);\n@@ -127,1 +143,1 @@\n-        log(\"\\n###test0: started \" + vtag);\n+        log(\"\\n### test0: started \" + vtag);\n@@ -142,0 +158,1 @@\n+            notifiedAll = true;\n@@ -143,1 +160,0 @@\n-        setTestedMonitor(null);\n@@ -145,1 +161,2 @@\n-        log(\"###test0: finished \" + vtag);\n+        setTestedMonitor(null);\n+        log(\"### test0: finished \" + vtag);\n@@ -156,1 +173,1 @@\n-        log(\"\\n###test1: started \" + vtag);\n+        log(\"\\n### test1: started \" + vtag);\n@@ -179,1 +196,0 @@\n-        setTestedMonitor(null);\n@@ -181,1 +197,2 @@\n-        log(\"###test1: finished \" + vtag);\n+        setTestedMonitor(null);\n+        log(\"### test1: finished \" + vtag);\n@@ -192,1 +209,1 @@\n-        log(\"\\n###test2: started \" + vtag);\n+        log(\"\\n### test2: started \" + vtag);\n@@ -210,0 +227,1 @@\n+            notifiedAll = true;\n@@ -211,1 +229,0 @@\n-        setTestedMonitor(null);\n@@ -214,1 +231,2 @@\n-        log(\"###test2: finished \" + vtag);\n+        setTestedMonitor(null);\n+        log(\"### test2: finished \" + vtag);\n@@ -231,1 +249,1 @@\n-        log(\"\\n###test3: started \" + vtag);\n+        log(\"\\n### test3: started \" + vtag);\n@@ -258,0 +276,1 @@\n+                notifiedCount++;\n@@ -269,1 +288,0 @@\n-        setTestedMonitor(null);\n@@ -272,1 +290,2 @@\n-        log(\"###test3: finished \" + vtag);\n+        setTestedMonitor(null);\n+        log(\"### test3: finished \" + vtag);\n@@ -283,1 +302,1 @@\n-        log(\"\\n###main: started\\n\");\n+        log(\"\\n### main: started\\n\");\n@@ -293,1 +312,1 @@\n-        log(\"\\n###main: finished\\n\");\n+        log(\"\\n### main: finished\\n\");\n@@ -297,1 +316,3 @@\n-        public volatile boolean ready = false;\n+        volatile boolean ready = false;\n+        String name;\n+\n@@ -300,1 +321,4 @@\n-        public void waitReady() {\n+        String getName() { return name; }\n+        void setName(String name) { this.name = name; }\n+\n+        void waitReady() {\n@@ -325,0 +349,5 @@\n+                    wokeupCount++;\n+                    if (!notifiedAll && notifiedCount < wokeupCount) {\n+                        wasSpuriousWakeup = true;\n+                        log(\"WARNING: got spurious wakeup in WaitingTask thread: \" + getName()); \n+                    }\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/ObjectMonitorUsage\/ObjectMonitorUsage.java","additions":45,"deletions":16,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -49,0 +49,7 @@\n+static void log_event(jvmtiEnv *jvmti, JNIEnv *jni, jthread thread,\n+                      const char* title, int counter) {\n+  char* tname = get_thread_name(jvmti, jni, thread);\n+  LOG(\">>> %s event: %s counter: %d\\n\", title, tname, counter);\n+  deallocate(jvmti, jni, (void*)tname);\n+}\n+\n@@ -54,0 +61,1 @@\n+    log_event(jvmti, jni, thread, \"MonitorContendedEnter\", waits_to_enter);\n@@ -62,0 +70,1 @@\n+    log_event(jvmti, jni, thread, \"MonitorContendedEntered\", waits_to_enter);\n@@ -70,0 +79,1 @@\n+    log_event(jvmti, jni, thread, \"MonitorWait\", waits_to_be_notified);\n@@ -78,0 +88,1 @@\n+    log_event(jvmti, jni, thread, \"MonitorWaited\", waits_to_be_notified);\n@@ -218,0 +229,1 @@\n+  waits_to_be_notified = 0;\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/ObjectMonitorUsage\/libObjectMonitorUsage.cpp","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"}]}