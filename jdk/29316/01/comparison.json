{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,0 +50,2 @@\n+import java.util.jar.Attributes;\n+import java.util.jar.Manifest;\n@@ -103,0 +105,1 @@\n+        checkAutomaticModuleName();\n@@ -456,0 +459,30 @@\n+    \/**\n+     * Checks whether an Automatic-Module-Name entry is valid\n+     * and also verifies it to the name given by a compiled\n+     * module descriptor.\n+     *\/\n+    private void checkAutomaticModuleName() {\n+        var entry = zf.getEntry(\"META-INF\/MANIFEST.MF\");\n+        if (entry == null) {\n+            return;\n+        }\n+        try (InputStream jis = zf.getInputStream(entry)) {\n+            Attributes attributes = new Manifest(jis).getMainAttributes();\n+            String automaticModuleName = attributes.getValue(\"Automatic-Module-Name\");\n+            if (automaticModuleName == null) {\n+                return;\n+            }\n+            try {\n+                ModuleDescriptor.newAutomaticModule(automaticModuleName);\n+            } catch (IllegalArgumentException e) {\n+                errorAndInvalid(formatMsg(\"error.validator.manifest.invalid.automatic.module.name\", automaticModuleName));\n+            }\n+            if (md == null || automaticModuleName.equals(md.name())) {\n+                return;\n+            }\n+            errorAndInvalid(formatMsg(\"error.validator.manifest.inconsistent.automatic.module.name\", automaticModuleName, md.name()));\n+        } catch (IOException e) {\n+            errorAndInvalid(e.getMessage());\n+        }\n+    }\n+\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/tools\/jar\/Validator.java","additions":34,"deletions":1,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -141,0 +141,4 @@\n+error.validator.manifest.invalid.automatic.module.name=\\\n+        invalid module name of Automatic-Module-Name entry in manifest: {0}\n+error.validator.manifest.inconsistent.automatic.module.name=\\\n+        expected Automatic-Module-Name entry in manifest: {0} to match name of compiled module: {1}\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/tools\/jar\/resources\/jar.properties","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8345431\n+ * @bug 8345431 8375433\n@@ -28,4 +28,0 @@\n- * @library \/test\/lib\n- * @modules jdk.jartool\n- * @build jdk.test.lib.Platform\n- *        jdk.test.lib.util.FileUtils\n@@ -43,0 +39,1 @@\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n@@ -62,2 +59,0 @@\n-import jdk.test.lib.util.FileUtils;\n-\n@@ -69,0 +64,4 @@\n+    private static final ToolProvider JAVAC_TOOL = ToolProvider.findFirst(\"javac\")\n+        .orElseThrow(() ->\n+            new RuntimeException(\"javac tool not found\")\n+        );\n@@ -313,0 +312,38 @@\n+    @Test\n+    public void testInvalidAutomaticModuleName() throws Exception {\n+        System.out.printf(\"%n%n*****Creating Jar with invalid Automatic-Module-Name in Manifest*****%n%n\");\n+        var file = Path.of(\"InvalidAutomaticModuleName.jar\");\n+        var manifest = Path.of(\"MANIFEST.MF\");\n+        Files.writeString(manifest,\n+                \"\"\"\n+                Automatic-Module-Name: default\n+                \"\"\");\n+        jar(\"--create --file \" + file + \" --manifest \" + manifest);\n+        var e = assertThrows(IOException.class, () -> jar(\"--validate --file \" + file.toString()));\n+        var err = e.getMessage();\n+        System.out.println(err);\n+        assertTrue(err.contains(\"invalid module name of Automatic-Module-Name entry in manifest: default\"), \"missing warning for: default\");\n+    }\n+\n+    @Test\n+    public void testWrongAutomaticModuleName() throws Exception {\n+        System.out.printf(\"%n%n*****Creating Jar with wrong Automatic-Module-Name in Manifest*****%n%n\");\n+        var file = Path.of(\"WrongAutomaticModuleName.jar\");\n+        var foo = Path.of(\"module-info.java\");\n+        Files.writeString(foo,\n+                \"\"\"\n+                module foo {}\n+                \"\"\");\n+        var manifest = Path.of(\"MANIFEST.MF\");\n+        Files.writeString(manifest,\n+                \"\"\"\n+                Automatic-Module-Name: bar\n+                \"\"\");\n+        JAVAC_TOOL.run(System.out, System.err, foo.toString());\n+        jar(\"--create --file \" + file + \" --manifest \" + manifest + \" module-info.class\");\n+        var e = assertThrows(IOException.class, () -> jar(\"--validate --file \" + file.toString()));\n+        var err = e.getMessage();\n+        System.out.println(err);\n+        assertTrue(err.contains(\"expected Automatic-Module-Name entry in manifest: bar to match name of compiled module: foo\"), \"missing warning for: foo\/bar\");\n+    }\n+\n","filename":"test\/jdk\/tools\/jar\/ValidatorTest.java","additions":45,"deletions":8,"binary":false,"changes":53,"status":"modified"}]}