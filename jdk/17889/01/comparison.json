{"files":[{"patch":"@@ -88,0 +88,2 @@\n+# include <ctype.h>\n+# include <stdlib.h>\n@@ -345,0 +347,23 @@\n+void os::Linux::kernel_version(long* major, long* minor) {\n+  *major = -1;\n+  *minor = -1;\n+\n+  struct utsname buffer;\n+  int ret = uname(&buffer);\n+  if (ret != 0) {\n+    log_warning(os)(\"uname(2) failed to get kernel version: %s\", os::errno_name(ret));\n+    return;\n+  }\n+\n+  char* walker = buffer.release;\n+  long* set_v = major;\n+  while (*minor == -1 && walker != nullptr) {\n+    if (isdigit(walker[0])) {\n+      *set_v = strtol(walker, &walker, 10);\n+      set_v = minor;\n+    } else {\n+      ++walker;\n+    }\n+  }\n+}\n+\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":25,"deletions":0,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -96,0 +96,2 @@\n+  static void kernel_version(long* major, long* minor);\n+\n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-#include \"runtime\/os.hpp\"\n+#include \"os_linux.hpp\"\n@@ -64,0 +64,12 @@\n+#if defined(RISCV)\n+\/\/ RISCV port was introduced in kernel 4.4.\n+\/\/ 4.4 also made membar private expedited mandatory.\n+\/\/ But RISCV actually don't support it until 6.9.\n+  long major, minor;\n+  os::Linux::kernel_version(&major, &minor);\n+  if (!(major > 6 || (major == 6 && minor >= 9))) {\n+    log_info(os)(\"Linux kernel %ld.%ld do not support MEMBARRIER PRIVATE_EXPEDITED on RISC-V.\",\n+                 major, minor);\n+    return false;\n+  }\n+#endif\n","filename":"src\/hotspot\/os\/linux\/systemMemoryBarrier_linux.cpp","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"}]}