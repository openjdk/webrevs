{"files":[{"patch":"@@ -136,9 +136,0 @@\n-\n-    \/*\n-     * Load the MonitoredHostServices.\n-     * Access to this field MUST be guarded through synchronization on \"monitoredHosts\"\n-     * field\n-     *\/\n-    private static final ServiceLoader<MonitoredHostService> monitoredHostServiceLoader =\n-        ServiceLoader.load(MonitoredHostService.class, MonitoredHostService.class.getClassLoader());\n-\n@@ -157,0 +148,1 @@\n+        MonitoredHost mh = null;\n@@ -159,6 +151,1 @@\n-            MonitoredHost mh = monitoredHosts.get(hostId);\n-            \/\/ remove any errored MonitorHost from the cache\n-            if (mh != null && mh.isErrored()) {\n-                monitoredHosts.remove(hostId);\n-                mh = null;\n-            }\n+            mh = monitoredHosts.get(hostId);\n@@ -166,9 +153,4 @@\n-                return mh;\n-            }\n-            \/\/ not found in cache, now try to find a MonitoredHostService\n-            \/\/ which can get a MonitoredHost for the hostId\n-            hostId = resolveHostId(hostId);\n-            for (MonitoredHostService mhs : monitoredHostServiceLoader) {\n-                if (mhs.getScheme().equals(hostId.getScheme())) {\n-                    mh = mhs.getMonitoredHost(hostId);\n-                    break;\n+                if (mh.isErrored()) {\n+                    monitoredHosts.remove(hostId);\n+                } else {\n+                    return mh;\n@@ -177,3 +159,10 @@\n-            if (mh == null) {\n-                throw new IllegalArgumentException(\"Could not find MonitoredHost for scheme: \"\n-                        + hostId.getScheme());\n+        }\n+\n+        hostId = resolveHostId(hostId);\n+\n+        ServiceLoader<MonitoredHostService> services = ServiceLoader.load(\n+                MonitoredHostService.class, MonitoredHostService.class.getClassLoader());\n+        for (MonitoredHostService mhs : services) {\n+            if (mhs.getScheme().equals(hostId.getScheme())) {\n+                mh = mhs.getMonitoredHost(hostId);\n+                break;\n@@ -181,1 +170,7 @@\n-            \/\/ add it to the internal cache\n+        }\n+\n+        if (mh == null) {\n+            throw new IllegalArgumentException(\"Could not find MonitoredHost for scheme: \" + hostId.getScheme());\n+        }\n+\n+        synchronized(monitoredHosts) {\n@@ -183,1 +178,0 @@\n-            return mh;\n@@ -185,0 +179,2 @@\n+\n+        return mh;\n","filename":"src\/jdk.internal.jvmstat\/share\/classes\/sun\/jvmstat\/monitor\/MonitoredHost.java","additions":25,"deletions":29,"binary":false,"changes":54,"status":"modified"}]}