{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,4 @@\n+import java.awt.Dimension;\n+import java.awt.Point;\n+import java.awt.Robot;\n+import java.awt.event.InputEvent;\n@@ -27,0 +31,1 @@\n+import javax.swing.SwingUtilities;\n@@ -31,0 +36,1 @@\n+ * @key headful\n@@ -32,3 +38,1 @@\n- * @library \/java\/awt\/regtesthelpers\n- * @build PassFailJFrame\n- * @run main\/manual ComboPopupBug\n+ * @run main ComboPopupBug\n@@ -38,10 +42,5 @@\n-    private static final String instructionsText = \"\"\"\n-            This test is used to verify that clicking on JComboBox\n-            when frame containing it is about to close should not\n-            cause IllegalStateException.\n-\n-            A JComboBox is shown with Close button at the bottom.\n-            Click on Close and then click on JComboBox arrow button\n-            to try to show combobox popup.\n-            If IllegalStateException is thrown, test will automatically Fail\n-            otherwise click Pass.\"\"\";\n+    private static JFrame frame;\n+    private static JButton closeButton;\n+    private static JComboBox<String> comboBox;\n+    private static Robot robot;\n+    private static final int PADDING = 10;\n@@ -50,9 +49,15 @@\n-        PassFailJFrame.builder()\n-                .title(\"ComboPopup Instructions\")\n-                .instructions(instructionsText)\n-                .testTimeOut(5)\n-                .rows(10)\n-                .columns(35)\n-                .testUI(ComboPopupBug::createUI)\n-                .build()\n-                .awaitAndCheck();\n+        try {\n+            robot = new Robot();\n+            robot.setAutoDelay(50);\n+\n+            SwingUtilities.invokeAndWait(ComboPopupBug::createUI);\n+\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+\n+            SwingUtilities.invokeAndWait(() -> closeButton.doClick());\n+        } finally {\n+            if (frame != null) {\n+                SwingUtilities.invokeAndWait(() -> frame.dispose());\n+            }\n+        }\n@@ -61,2 +66,3 @@\n-    private static JFrame createUI() {\n-        JFrame frame = new JFrame(\"ComboPopup\");\n+    private static void clickComboBox() {\n+        Point comboBoxLocation = comboBox.getLocationOnScreen();\n+        Dimension comboBoxSize = comboBox.getSize();\n@@ -64,5 +70,5 @@\n-        JComboBox<String> cb = new JComboBox<>();\n-        cb.setEditable(true);\n-        cb.addItem(\"test\");\n-        cb.addItem(\"test2\");\n-        cb.addItem(\"test3\");\n+        robot.mouseMove(comboBoxLocation.x + comboBoxSize.width - PADDING,\n+                comboBoxLocation.y + comboBoxSize.height \/ 2);\n+        robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+        robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+    }\n@@ -70,9 +76,2 @@\n-        JButton b = new JButton(\"Close\");\n-        b.addActionListener(\n-                (e)->{\n-                    try {\n-                        Thread.sleep(3000);\n-                    } catch (Exception ignored) {\n-                    }\n-                    frame.setVisible(false);\n-                });\n+    private static void createUI() {\n+        frame = new JFrame(\"ComboPopup\");\n@@ -80,3 +79,5 @@\n-        frame.getContentPane().add(cb, \"North\");\n-        frame.getContentPane().add(b, \"South\");\n-        frame.setSize(200, 200);\n+        comboBox = new JComboBox<>();\n+        comboBox.setEditable(true);\n+        comboBox.addItem(\"test\");\n+        comboBox.addItem(\"test2\");\n+        comboBox.addItem(\"test3\");\n@@ -84,1 +85,11 @@\n-        return frame;\n+        closeButton = new JButton(\"Close\");\n+        closeButton.addActionListener((e) -> {\n+            clickComboBox();\n+            frame.setVisible(false);\n+        });\n+\n+        frame.getContentPane().add(comboBox, \"North\");\n+        frame.getContentPane().add(closeButton, \"South\");\n+        frame.setSize(200, 200);\n+        frame.setLocationRelativeTo(null);\n+        frame.setVisible(true);\n","filename":"test\/jdk\/javax\/swing\/JComboBox\/ComboPopupBug.java","additions":54,"deletions":43,"binary":false,"changes":97,"status":"modified"}]}