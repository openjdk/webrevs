{"files":[{"patch":"@@ -91,1 +91,0 @@\n-    guarantee(UseG1GC, \"implementation limitation\");\n@@ -433,3 +432,0 @@\n-  assert(UseG1GC, \"must be\");\n-  address heap_end = (address)G1CollectedHeap::heap()->reserved().end();\n-  log_info(cds, heap)(\"Heap end = %p\", heap_end);\n@@ -440,1 +436,0 @@\n-\n@@ -442,1 +437,9 @@\n-    _requested_bottom = align_down(heap_end - heap_region_byte_size, G1HeapRegion::GrainBytes);\n+    if (UseG1GC) {\n+      address heap_end = (address)G1CollectedHeap::heap()->reserved().end();\n+      log_info(cds, heap)(\"Heap end = %p\", heap_end);\n+      _requested_bottom = align_down(heap_end - heap_region_byte_size, G1HeapRegion::GrainBytes);\n+      _requested_bottom = align_down(_requested_bottom, MIN_GC_REGION_ALIGNMENT);\n+      assert(is_aligned(_requested_bottom, G1HeapRegion::GrainBytes), \"sanity\");\n+    } else {\n+      _requested_bottom = align_up(CompressedOops::begin(), MIN_GC_REGION_ALIGNMENT);\n+    }\n@@ -449,1 +452,1 @@\n-    _requested_bottom = (address)NOCOOPS_REQUESTED_BASE;\n+    _requested_bottom = align_up((address)NOCOOPS_REQUESTED_BASE, MIN_GC_REGION_ALIGNMENT);\n@@ -452,1 +455,1 @@\n-  assert(is_aligned(_requested_bottom, G1HeapRegion::GrainBytes), \"sanity\");\n+  assert(is_aligned(_requested_bottom, MIN_GC_REGION_ALIGNMENT), \"sanity\");\n","filename":"src\/hotspot\/share\/cds\/archiveHeapWriter.cpp","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -464,5 +464,7 @@\n-    log_info(cds)(\"Heap range = [\" PTR_FORMAT \" - \"  PTR_FORMAT \"]\",\n-                   UseCompressedOops ? p2i(CompressedOops::begin()) :\n-                                       p2i((address)G1CollectedHeap::heap()->reserved().start()),\n-                   UseCompressedOops ? p2i(CompressedOops::end()) :\n-                                       p2i((address)G1CollectedHeap::heap()->reserved().end()));\n+    if (UseCompressedOops || UseG1GC) {\n+      log_info(cds)(\"Heap range = [\" PTR_FORMAT \" - \"  PTR_FORMAT \"]\",\n+                    UseCompressedOops ? p2i(CompressedOops::begin()) :\n+                                        p2i((address)G1CollectedHeap::heap()->reserved().start()),\n+                    UseCompressedOops ? p2i(CompressedOops::end()) :\n+                                        p2i((address)G1CollectedHeap::heap()->reserved().end()));\n+    }\n","filename":"src\/hotspot\/share\/cds\/heapShared.cpp","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -146,1 +146,1 @@\n-  \/\/ Can this VM write a heap region into the CDS archive? Currently only G1+compressed{oops,cp}\n+  \/\/ Can this VM write a heap region into the CDS archive? Currently only {G1|Parallel|Serial}+compressed_cp\n@@ -152,1 +152,1 @@\n-      return (UseG1GC && UseCompressedClassPointers);\n+      return (UseG1GC || UseParallelGC || UseSerialGC) && UseCompressedClassPointers;\n","filename":"src\/hotspot\/share\/cds\/heapShared.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -111,3 +111,3 @@\n-        \/\/ incompatible GCs\n-        testDump(2, \"-XX:+UseParallelGC\", \"\", GC_WARNING, false);\n-        testDump(3, \"-XX:+UseSerialGC\", \"\", GC_WARNING, false);\n+        \/\/ Dump heap objects with ParallelGC and SerialGC\n+        testDump(2, \"-XX:+UseParallelGC\", \"\", \"\", false);\n+        testDump(3, \"-XX:+UseSerialGC\", \"\", \"\", false);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/sharedStrings\/IncompatibleOptions.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+ * @requires vm.gc.G1\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/sharedStrings\/SharedStringsHumongous.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -99,1 +99,1 @@\n-            TestCommon.concat(extraOptions, \"-XX:+UseCompressedOops\", \"-XX:+UseG1GC\",\n+            TestCommon.concat(extraOptions, \"-XX:+UseCompressedOops\",\n@@ -127,1 +127,1 @@\n-            \"-cp\", appJar, \"-XX:+UseCompressedOops\", \"-XX:+UseG1GC\", className);\n+            \"-cp\", appJar, \"-XX:+UseCompressedOops\", className);\n@@ -146,1 +146,1 @@\n-            \"-XX:+UseCompressedOops\", \"-XX:+UseG1GC\", className);\n+            \"-XX:+UseCompressedOops\", className);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/sharedStrings\/SharedStringsUtils.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}