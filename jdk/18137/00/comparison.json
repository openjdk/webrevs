{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -103,0 +103,4 @@\n+    \/**\n+     * The last elements, for an event type, that all share the same end timestamp, accurate to the second.\n+     *\/\n+    LAST_BATCH_BY_SECONDS(\"LAST_BATCH_BY_SECONDS\"),\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/query\/Aggregator.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -126,1 +126,1 @@\n-    \/\/ Used by LAST_BATCH aggregator\n+    \/\/ Used by LAST_BATCH and LAST_BATCH_BY_SECONDS aggregator\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/query\/Field.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -405,1 +405,1 @@\n-            case FIRST, LAST, LAST_BATCH -> field.label;\n+            case FIRST, LAST, LAST_BATCH, LAST_BATCH_BY_SECONDS  -> field.label;\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/query\/FieldBuilder.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -118,0 +118,3 @@\n+        if (aggregator == Aggregator.LAST_BATCH_BY_SECONDS) {\n+            return new LastBatchBySeconds(field);\n+        }\n@@ -634,2 +637,2 @@\n-    public static final class LastBatch extends Function {\n-        private final Field field;\n+    public static class LastBatch extends Function {\n+        protected final Field field;\n@@ -637,1 +640,1 @@\n-        private Instant timestamp;\n+        protected Instant timestamp;\n@@ -665,0 +668,12 @@\n+\n+    public static final class LastBatchBySeconds extends LastBatch {\n+        public LastBatchBySeconds(Field field) {\n+            super(field);\n+        }\n+\n+        @Override\n+        public void setTime(Instant timestamp) {\n+           this.timestamp = timestamp.truncatedTo(ChronoUnit.SECONDS);\n+           field.last = this.timestamp;\n+        }\n+    }\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/query\/Function.java","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -45,0 +45,1 @@\n+import jdk.jfr.internal.query.Function.LastBatchBySeconds;\n@@ -143,0 +144,3 @@\n+            if (function instanceof LastBatchBySeconds l) {\n+                l.setTime(e.getEndTime());\n+            }\n@@ -156,0 +160,3 @@\n+                if (f instanceof LastBatchBySeconds last && !last.valid()) {\n+                    valid = false;\n+                }\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/query\/Histogram.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -278,0 +278,1 @@\n+                    LAST_BATCH_BY_SECONDS: The last set of values with the same end timestamp, accurate to the second\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/query\/QueryPrinter.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-; Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+; Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,3 +43,3 @@\n-         SELECT E.id, LAST_BATCH(E.value), LAST_BATCH(T.value),\n-                LAST_BATCH(S.value), LAST_BATCH(P.value),\n-                LAST_BATCH(C.value), LAST_BATCH(U.value)\n+         SELECT E.id, LAST_BATCH_BY_SECONDS(E.value), LAST_BATCH_BY_SECONDS(T.value),\n+                LAST_BATCH_BY_SECONDS(S.value), LAST_BATCH_BY_SECONDS(P.value),\n+                LAST_BATCH_BY_SECONDS(C.value), LAST_BATCH_BY_SECONDS(U.value)\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/query\/view.ini","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}