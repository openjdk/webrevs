{"files":[{"patch":"@@ -717,0 +717,2 @@\n+  void handle_Constant        (Constant* x);\n+  void handle_IfOp            (IfOp* x);\n@@ -731,1 +733,1 @@\n-void NullCheckVisitor::do_Constant       (Constant*        x) { \/* FIXME: handle object constants *\/ }\n+void NullCheckVisitor::do_Constant       (Constant*        x) { nce()->handle_Constant(x); }\n@@ -742,1 +744,1 @@\n-void NullCheckVisitor::do_IfOp           (IfOp*            x) {}\n+void NullCheckVisitor::do_IfOp           (IfOp*            x) { nce()->handle_IfOp(x); }\n@@ -885,1 +887,2 @@\n-    if (instr->is_pinned() || instr->can_trap() || (instr->as_NullCheck() != nullptr)) {\n+    if (instr->is_pinned() || instr->can_trap() || (instr->as_NullCheck() != nullptr)\n+        || (instr->as_Constant() != nullptr && instr->as_Constant()->type()->is_object())) {\n@@ -1201,0 +1204,22 @@\n+void NullCheckEliminator::handle_Constant(Constant *x) {\n+  ObjectType* ot = x->type()->as_ObjectType();\n+  if (ot && ot->is_loaded()) {\n+    ObjectConstant* oc = ot->as_ObjectConstant();\n+    if (!oc || !oc->value()->is_null_object()) {\n+      set_put(x);\n+      if (PrintNullCheckElimination) {\n+        tty->print_cr(\"Constant %d is non-null\", x->id());\n+      }\n+    }\n+  }\n+}\n+\n+void NullCheckEliminator::handle_IfOp(IfOp *x) {\n+  if (x->type()->is_object() && set_contains(x->tval()) && set_contains(x->fval())) {\n+    set_put(x);\n+    if (PrintNullCheckElimination) {\n+      tty->print_cr(\"IfOp %d is non-null\", x->id());\n+    }\n+  }\n+}\n+\n","filename":"src\/hotspot\/share\/c1\/c1_Optimizer.cpp","additions":28,"deletions":3,"binary":false,"changes":31,"status":"modified"}]}