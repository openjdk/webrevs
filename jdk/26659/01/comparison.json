{"files":[{"patch":"@@ -41,0 +41,9 @@\n+uint G1CollectionSet::selected_groups_cur_length() const {\n+  assert(_inc_build_state == CSetBuildType::Inactive, \"must be\");\n+  return _collection_set_groups.length();\n+}\n+\n+uint G1CollectionSet::collection_groups_increment_length() const {\n+  return selected_groups_cur_length() - _selected_groups_inc_part_start;\n+}\n+\n@@ -57,1 +66,0 @@\n-  _selected_groups_cur_length(0),\n@@ -125,0 +133,7 @@\n+  assert(selected_groups_cur_length() == 0, \"Collection set groups must be empty before starting a new collection set.\");\n+  assert(_optional_groups.length() == 0, \"Collection set optional gorups must be empty before starting a new collection set.\");\n+\n+  continue_incremental_building();\n+}\n+\n+void G1CollectionSet::continue_incremental_building() {\n@@ -127,1 +142,8 @@\n-  update_incremental_marker();\n+  _inc_part_start = _collection_set_cur_length;\n+  _selected_groups_inc_part_start = selected_groups_cur_length();\n+\n+  _inc_build_state = CSetBuildType::Active;\n+}\n+\n+void G1CollectionSet::stop_incremental_building() {\n+  _inc_build_state = Inactive;\n@@ -346,3 +368,0 @@\n-  _selected_groups_cur_length = 0;\n-  _selected_groups_inc_part_start = 0;\n-\n@@ -366,3 +385,0 @@\n-  _selected_groups_cur_length = collection_set_groups()->length();\n-  stop_incremental_building();\n-\n@@ -371,2 +387,0 @@\n-\n-  QuickSort::sort(_collection_set_regions, _collection_set_cur_length, compare_region_idx);\n@@ -673,0 +687,3 @@\n+  assert(_inc_part_start == 0, \"must be\");\n+  assert(_selected_groups_inc_part_start == 0, \"must be\");\n+\n@@ -675,0 +692,3 @@\n+\n+  stop_incremental_building();\n+  QuickSort::sort(_collection_set_regions, _collection_set_cur_length, compare_region_idx);\n@@ -678,1 +698,1 @@\n-  update_incremental_marker();\n+  continue_incremental_building();\n@@ -682,1 +702,0 @@\n-  _selected_groups_cur_length = collection_set_groups()->length();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectionSet.cpp","additions":31,"deletions":12,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -152,3 +152,1 @@\n-  \/\/ Groups are added to the collection set in increments when performing optional evacuations.\n-  \/\/ We use the value below to track these increments.\n-  uint _selected_groups_cur_length;\n+  uint selected_groups_cur_length() const;\n@@ -261,6 +259,2 @@\n-  \/\/ Start a new collection set increment.\n-  void update_incremental_marker() {\n-    _inc_build_state = Active;\n-    _inc_part_start = _collection_set_cur_length;\n-    _selected_groups_inc_part_start = _selected_groups_cur_length;\n-  }\n+  \/\/ Start a new collection set increment, continuing the incremental building.\n+  void continue_incremental_building();\n@@ -268,1 +262,1 @@\n-  void stop_incremental_building() { _inc_build_state = Inactive; }\n+  void stop_incremental_building();\n@@ -279,1 +273,1 @@\n-  uint collection_groups_increment_length() const { return _selected_groups_cur_length - _selected_groups_inc_part_start; }\n+  uint collection_groups_increment_length() const;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectionSet.hpp","additions":5,"deletions":11,"binary":false,"changes":16,"status":"modified"}]}