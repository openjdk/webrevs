{"files":[{"patch":"@@ -38,1 +38,4 @@\n- *      -Xbootclasspath\/a:. -Xlog:gc=debug,gc+ergo+cset=trace,gc+phases=debug -XX:G1HeapRegionSize=1m -Xms30m  gc.g1.pinnedobjs.TestPinnedEvacEmpty\n+ *      -Xbootclasspath\/a:. -Xlog:gc=debug,gc+ergo+cset=trace,gc+phases=debug -XX:G1HeapRegionSize=1m -Xms30m  gc.g1.pinnedobjs.TestPinnedEvacEmpty regular\n+ *\n+ * @run main\/othervm -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+UseG1GC\n+ *      -Xbootclasspath\/a:. -Xlog:gc=debug,gc+ergo+cset=trace,gc+phases=debug -XX:G1HeapRegionSize=1m -Xms30m  gc.g1.pinnedobjs.TestPinnedEvacEmpty humongous\n@@ -54,1 +57,1 @@\n-    private static final long objSize = wb.getObjectSize(new Object());\n+    private static final int objSize = (int)wb.getObjectSize(new Object());\n@@ -56,2 +59,6 @@\n-    \/\/ How many j.l.Object should we allocate when creating garbage.\n-    private static final long numAllocations = 1024 * 1024 * 3 \/ objSize;\n+    private static Object allocHumongous() {\n+        final int M = 1024 * 1024;\n+        \/\/ The target object to pin. Since it is humongous, it will always be in its\n+        \/\/ own regions.\n+        return new int[M];\n+    }\n@@ -59,3 +66,3 @@\n-    public static void main(String[] args) throws Exception {\n-        \/\/ Remove garbage from VM initialization.\n-        wb.fullGC();\n+    private static Object allocRegular() {\n+        \/\/ How many j.l.Object should we allocate when creating garbage.\n+        final int numAllocations = 1024 * 1024 * 3 \/ objSize;\n@@ -75,0 +82,11 @@\n+        return o;\n+    }\n+\n+    public static void main(String[] args) throws Exception {\n+        System.out.println(\"Testing \" + args[0] + \" objects...\");\n+\n+        \/\/ Remove garbage from VM initialization.\n+        wb.fullGC();\n+\n+        \/\/ Allocate target object according to arguments.\n+        Object o = args[0].equals(\"regular\") ? allocRegular() : allocHumongous();\n@@ -95,1 +113,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/gc\/g1\/pinnedobjs\/TestPinnedEvacEmpty.java","additions":25,"deletions":8,"binary":false,"changes":33,"status":"modified"}]}