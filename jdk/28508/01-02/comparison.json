{"files":[{"patch":"@@ -27,2 +27,2 @@\n- * @test TestParallelRefProc\n- * @summary Test defaults processing for -XX:+ParallelRefProcEnabled.\n+ * @test id=Serial\n+ * @summary Test defaults processing for -XX:+ParallelRefProcEnabled with Serial GC.\n@@ -31,4 +31,20 @@\n- * @requires vm.gc == null\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI gc.arguments.TestParallelRefProc\n+ * @requires vm.gc.Serial\n+ * @run driver gc.arguments.TestParallelRefProc Serial\n+ *\/\n+\n+\/*\n+ * @test id=Parallel\n+ * @summary Test defaults processing for -XX:+ParallelRefProcEnabled with Parallel GC.\n+ * @library \/test\/lib\n+ * @library \/\n+ * @requires vm.gc.Parallel\n+ * @run driver gc.arguments.TestParallelRefProc Parallel\n+ *\/\n+\n+\/*\n+ * @test id=G1\n+ * @summary Test defaults processing for -XX:+ParallelRefProcEnabled with G1 GC.\n+ * @library \/test\/lib\n+ * @library \/\n+ * @requires vm.gc.G1\n+ * @run driver gc.arguments.TestParallelRefProc G1\n@@ -42,3 +58,0 @@\n-import jtreg.SkippedException;\n-import jdk.test.whitebox.gc.GC;\n-\n@@ -48,4 +61,2 @@\n-        boolean noneGCSupported = true;\n-        if (GC.Serial.isSupported()) {\n-            noneGCSupported = false;\n-            testFlag(new String[] { \"-XX:+UseSerialGC\" }, false);\n+        if (args.length == 0) {\n+            throw new IllegalArgumentException(\"Test type must be specified as argument\");\n@@ -53,14 +64,15 @@\n-        if (GC.Parallel.isSupported()) {\n-            noneGCSupported = false;\n-            testFlag(new String[] { \"-XX:+UseParallelGC\", \"-XX:ParallelGCThreads=1\" }, false);\n-            testFlag(new String[] { \"-XX:+UseParallelGC\", \"-XX:ParallelGCThreads=2\" }, true);\n-            testFlag(new String[] { \"-XX:+UseParallelGC\", \"-XX:-ParallelRefProcEnabled\", \"-XX:ParallelGCThreads=2\" }, false);\n-        }\n-        if (GC.G1.isSupported()) {\n-            noneGCSupported = false;\n-            testFlag(new String[] { \"-XX:+UseG1GC\", \"-XX:ParallelGCThreads=1\" }, false);\n-            testFlag(new String[] { \"-XX:+UseG1GC\", \"-XX:ParallelGCThreads=2\" }, true);\n-            testFlag(new String[] { \"-XX:+UseG1GC\", \"-XX:-ParallelRefProcEnabled\", \"-XX:ParallelGCThreads=2\" }, false);\n-        }\n-        if (noneGCSupported) {\n-            throw new SkippedException(\"Skipping test because none of Serial\/Parallel\/G1 is supported.\");\n+\n+        String testType = args[0];\n+\n+        switch (testType) {\n+            case \"Serial\":\n+                testSerial();\n+                break;\n+            case \"Parallel\":\n+                testParallel();\n+                break;\n+            case \"G1\":\n+                testG1();\n+                break;\n+            default:\n+                throw new IllegalArgumentException(\"Unknown test type \\\"\" + testType + \"\\\"\");\n@@ -70,0 +82,16 @@\n+    private static void testSerial() throws Exception {\n+        testFlag(new String[] { \"-XX:+UseSerialGC\" }, false);\n+    }\n+\n+    private static void testParallel() throws Exception {\n+        testFlag(new String[] { \"-XX:+UseParallelGC\", \"-XX:ParallelGCThreads=1\" }, false);\n+        testFlag(new String[] { \"-XX:+UseParallelGC\", \"-XX:ParallelGCThreads=2\" }, true);\n+        testFlag(new String[] { \"-XX:+UseParallelGC\", \"-XX:-ParallelRefProcEnabled\", \"-XX:ParallelGCThreads=2\" }, false);\n+    }\n+\n+    private static void testG1() throws Exception {\n+        testFlag(new String[] { \"-XX:+UseG1GC\", \"-XX:ParallelGCThreads=1\" }, false);\n+        testFlag(new String[] { \"-XX:+UseG1GC\", \"-XX:ParallelGCThreads=2\" }, true);\n+        testFlag(new String[] { \"-XX:+UseG1GC\", \"-XX:-ParallelRefProcEnabled\", \"-XX:ParallelGCThreads=2\" }, false);\n+    }\n+\n","filename":"test\/hotspot\/jtreg\/gc\/arguments\/TestParallelRefProc.java","additions":55,"deletions":27,"binary":false,"changes":82,"status":"modified"}]}