{"files":[{"patch":"@@ -33,2 +33,6 @@\n-bool CDSConfig::_enable_dumping_full_module_graph = true;\n-bool CDSConfig::_enable_loading_full_module_graph = true;\n+\n+\/\/ The ability to dump the FMG depends on many factors checked by\n+\/\/ is_dumping_full_module_graph(), but can be unconditionally disabled by\n+\/\/ _dumping_full_module_graph_disabled. (Ditto for loading the FMG).\n+bool CDSConfig::_dumping_full_module_graph_disabled = false;\n+bool CDSConfig::_loading_full_module_graph_disabled = false;\n@@ -47,3 +51,3 @@\n-  if (is_dumping_heap() &&\n-      MetaspaceShared::use_optimized_module_handling() &&\n-      _enable_dumping_full_module_graph) {\n+  if (!_dumping_full_module_graph_disabled &&\n+      is_dumping_heap() &&\n+      MetaspaceShared::use_optimized_module_handling()) {\n@@ -61,1 +65,2 @@\n-  if (UseSharedSpaces &&\n+  if (!_loading_full_module_graph_disabled && \n+      UseSharedSpaces &&\n@@ -63,2 +68,1 @@\n-      MetaspaceShared::use_optimized_module_handling() &&\n-      _enable_loading_full_module_graph) {\n+      MetaspaceShared::use_optimized_module_handling()) {\n@@ -75,2 +79,2 @@\n-  if (_enable_dumping_full_module_graph) {\n-    _enable_dumping_full_module_graph = false;\n+  if (!_dumping_full_module_graph_disabled) {\n+    _dumping_full_module_graph_disabled = true;\n@@ -84,2 +88,3 @@\n-  if (_enable_loading_full_module_graph) {\n-    _enable_loading_full_module_graph = false;\n+  assert(!ClassLoaderDataShared::is_full_module_graph_loaded(), \"you call this function too late!\");\n+  if (!_loading_full_module_graph_disabled) {\n+    _loading_full_module_graph_disabled = true;\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.cpp","additions":17,"deletions":12,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -33,3 +33,3 @@\n-  static bool     _is_dumping_dynamic_archive;\n-  static bool _enable_dumping_full_module_graph;\n-  static bool _enable_loading_full_module_graph;\n+  static bool _is_dumping_dynamic_archive;\n+  static bool _dumping_full_module_graph_disabled;\n+  static bool _loading_full_module_graph_disabled;\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}