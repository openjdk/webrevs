{"files":[{"patch":"@@ -559,18 +559,4 @@\n-     if (sym->name != NULL && offset >= sym->offset) {\n-       \/\/ __restore_rt is special case. It is known as signal trampoline.\n-       \/\/ See:\n-       \/\/   - sysdeps\/unix\/sysv\/linux\/x86_64\/libc_sigaction.c in glibc\n-       \/\/   - gdb\/amd64-linux-tdep.c in GDB\n-       \/\/ Size of signal trampoline might be zero.\n-       if (strcmp(\"__restore_rt\", sym->name) == 0 && offset == sym->offset) {\n-         if (poffset) *poffset = 0;\n-\n-         \/\/ \"<signal handler called>\" is used in LinuxAMD64CFrame to detect\n-         \/\/ whether the frame is signal handler or not. Don't forget update it\n-         \/\/ if you want to make change.\n-         static const char *sighandler_desc = \"<signal handler called>\";\n-         return sighandler_desc;\n-       } else if (offset < sym->offset + sym->size) {\n-         if (poffset) *poffset = (offset - sym->offset);\n-         return sym->name;\n-       }\n+     if (sym->name != NULL &&\n+         offset >= sym->offset && offset <= sym->offset + sym->size) {\n+        if (poffset) *poffset = (offset - sym->offset);\n+        return sym->name;\n","filename":"src\/jdk.hotspot.agent\/linux\/native\/libsaproc\/symtab.c","additions":4,"deletions":18,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,0 +36,8 @@\n+  \/\/ SIGHANDLER_NAMES holds the name of signal handler.\n+  public static final List<String> SIGHANDLER_NAMES = List.of(\n+    \/\/ For AMD64\n+    \/\/   - sysdeps\/unix\/sysv\/linux\/x86_64\/libc_sigaction.c in glibc\n+    \/\/   - gdb\/amd64-linux-tdep.c in GDB\n+    \"__restore_rt\"\n+  );\n+\n@@ -55,0 +63,1 @@\n+  public boolean      isSignalTrampoline(Address pc);\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/debugger\/linux\/LinuxDebugger.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -133,0 +133,6 @@\n+    @Override\n+    public boolean isSignalTrampoline(Address pc) {\n+      var sym = lookup(getAddressValue(pc));\n+      return sym == null ? false : SIGHANDLER_NAMES.contains(sym.getName());\n+    }\n+\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/debugger\/linux\/LinuxDebuggerLocal.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -40,4 +40,0 @@\n-   \/\/ This string will be set as function symbol in symtab.c if the frame is\n-   \/\/  signal handler. Don't forget update it if you want to make change.\n-   private static String SIGHANDLER_DESC = \"<signal handler called>\";\n-\n@@ -120,2 +116,6 @@\n-      \/\/ try native lookup in debugger.\n-      return dbg.lookup(dbg.getAddressValue(symAddr));\n+\n+      \/\/ Returns a special symbol if the address is signal handler,\n+      \/\/ otherwise returns closest symbol generated by LinuxDebugger.\n+      return dbg.isSignalTrampoline(symAddr)\n+        ? new ClosestSymbol(\"<signal handler called>\", 0)\n+        : dbg.lookup(dbg.getAddressValue(symAddr));\n@@ -142,1 +142,1 @@\n-   private boolean isValidFrame(Address nextCFA, boolean isNative, boolean isSigTrampoline) {\n+   private boolean isValidFrame(Address nextCFA, boolean isNative) {\n@@ -146,2 +146,0 @@\n-     \/\/ If caller is signal trampoline, this check should be skipped\n-     \/\/ because SP points rt_sigframe.\n@@ -149,1 +147,1 @@\n-         (isSigTrampoline || !isNative || (isNative && nextCFA.greaterThan(cfa)));\n+         (!isNative || (isNative && nextCFA.greaterThan(cfa)));\n@@ -162,1 +160,0 @@\n-     boolean isSigTrampoline = false;\n@@ -192,4 +189,0 @@\n-\n-       \/\/ Check whether caller is signal trampoline\n-       var sym = dbg.lookup(dbg.getAddressValue(senderPC));\n-       isSigTrampoline = sym != null && sym.getName().equals(SIGHANDLER_DESC);\n@@ -206,1 +199,6 @@\n-     return isValidFrame(nextCFA, isNative, isSigTrampoline) ? nextCFA : null;\n+     if (dbg.isSignalTrampoline(senderPC)) {\n+       \/\/ Return without frame check if sender is signal trampoline.\n+       return nextCFA;\n+     } else {\n+       return isValidFrame(nextCFA, isNative) ? nextCFA : null;\n+     }\n@@ -220,2 +218,1 @@\n-     var sym = closestSymbolToPC();\n-     if (sym != null && sym.getName().equals(SIGHANDLER_DESC)) {\n+     if (dbg.isSignalTrampoline(pc())) {\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/debugger\/linux\/amd64\/LinuxAMD64CFrame.java","additions":15,"deletions":18,"binary":false,"changes":33,"status":"modified"}]}