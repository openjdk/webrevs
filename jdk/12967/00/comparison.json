{"files":[{"patch":"@@ -1,1 +1,1 @@\n-## Little Color Management System (LCMS) v2.14\n+## Little Color Management System (LCMS) v2.15\n@@ -5,1 +5,0 @@\n-\n@@ -13,1 +12,1 @@\n-Copyright (c) 1998-2022 Marti Maria Saguer\n+Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -35,1 +34,0 @@\n-\n@@ -47,2 +45,1 @@\n-\n-<\/pre>\n+<pre>\n@@ -53,0 +50,1 @@\n+\n@@ -93,0 +91,3 @@\n+Amyspark\n+Lovell Fuller\n+Eli Schwartz\n@@ -98,0 +99,1 @@\n+libVIPS\n@@ -106,1 +108,0 @@\n-\n","filename":"src\/java.desktop\/share\/legal\/lcms.md","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsalpha.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -356,1 +356,1 @@\n-    M[8] = (( 0.0030 *  0.201908) + (0.0136 * 0.000008) + 0.9834);;\n+    M[8] = (( 0.0030 *  0.201908) + (0.0136 * 0.000008) + 0.9834);\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmscam02.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -1971,1 +1971,1 @@\n-    sd.Base   = (cmsUInt8Number*)  MemPtr;\n+    sd.Base   = (cmsUInt8Number*) MemPtr;\n@@ -1976,2 +1976,4 @@\n-    if (sd.Base)\n-        sd.Max  = *BytesNeeded;     \/\/ Write to memory?\n+    if (sd.Base && (*BytesNeeded > 0)) {\n+\n+        sd.Max = (*BytesNeeded) - 1;     \/\/ Write to memory?\n+    }\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmscgats.c","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -402,2 +402,2 @@\n-        _cmsReadMediaWhitePoint(&WhitePointIn,  hProfiles[i-1]);\n-        _cmsReadCHAD(&ChromaticAdaptationMatrixIn, hProfiles[i-1]);\n+        if (!_cmsReadMediaWhitePoint(&WhitePointIn, hProfiles[i - 1])) return FALSE;\n+        if (!_cmsReadCHAD(&ChromaticAdaptationMatrixIn, hProfiles[i - 1])) return FALSE;\n@@ -405,2 +405,2 @@\n-        _cmsReadMediaWhitePoint(&WhitePointOut,  hProfiles[i]);\n-        _cmsReadCHAD(&ChromaticAdaptationMatrixOut, hProfiles[i]);\n+        if (!_cmsReadMediaWhitePoint(&WhitePointOut, hProfiles[i])) return FALSE;\n+        if (!_cmsReadCHAD(&ChromaticAdaptationMatrixOut, hProfiles[i])) return FALSE;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmscnvrt.c","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmserr.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -855,0 +855,4 @@\n+    \/\/ Do some housekeeping\n+    if (nEntries == 0 || values == NULL)\n+        return NULL;\n+\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsgamma.c","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmshalf.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsintrp.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -1954,1 +1954,1 @@\n-                goto Error;\n+                TagSize = BufferSize;\n@@ -1967,1 +1967,1 @@\n-    \/\/ The data has been already read, or written. But wait!, maybe the user chose to save as\n+    \/\/ The data has been already read, or written. But wait!, maybe the user choose to save as\n@@ -1976,1 +1976,1 @@\n-                goto Error;\n+                TagSize = BufferSize;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsio0.c","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -883,0 +883,4 @@\n+    \/\/ Extended intents are not strictly CLUT-based\n+    if (Intent > INTENT_ABSOLUTE_COLORIMETRIC)\n+        return FALSE;\n+\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsio1.c","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmslut.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsmd5.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsmtrx.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -402,0 +402,2 @@\n+    if (v->StrW + v->Len > mlu->PoolSize) return NULL;\n+\n@@ -793,1 +795,7 @@\n-    cmsStage* mpe  = v ->Lut->Elements;\n+    cmsStage* mpe;\n+\n+    if (v == NULL) return NULL;\n+    if (v->Lut == NULL) return NULL;\n+\n+    mpe = v->Lut->Elements;\n+    if (mpe == NULL) return NULL;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsnamed.c","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -1727,0 +1727,4 @@\n+              \/\/ Only RGB to RGB\n+              if (Matrix1->InputChannels != 3 || Matrix1->OutputChannels != 3 ||\n+                  Matrix2->InputChannels != 3 || Matrix2->OutputChannels != 3) return FALSE;\n+\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsopt.c","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -1739,1 +1739,1 @@\n-        if (Premul && alpha_factor != 0)\n+        if (Premul)\n@@ -1808,1 +1808,1 @@\n-        if (Premul && alpha_factor != 0)\n+        if (Premul)\n@@ -1875,1 +1875,1 @@\n-        if (Premul && alpha_factor != 0)\n+        if (Premul)\n@@ -1935,1 +1935,1 @@\n-        if (Premul && alpha_factor != 0)\n+        if (Premul)\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmspack.c","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmspcs.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -828,2 +828,0 @@\n-    struct _cmsContext_struct* ctx = _cmsGetContext(ContextID);\n-\n@@ -843,3 +841,0 @@\n-   if (ctx->MemPool != NULL)\n-       _cmsSubAllocDestroy(ctx->MemPool);\n-   ctx->MemPool = NULL;\n@@ -1013,1 +1008,8 @@\n-    if (ContextID != NULL) {\n+    if (ContextID == NULL) {\n+\n+        cmsUnregisterPlugins();\n+        if (globalContext.MemPool != NULL)\n+            _cmsSubAllocDestroy(globalContext.MemPool);\n+        globalContext.MemPool = NULL;\n+    }\n+    else {\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsplugin.c","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsps2.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -155,1 +155,1 @@\n-    \/\/ Force it to be neutral, clip to max. L* of 50\n+    \/\/ Force it to be neutral, check for inconsistences\n@@ -157,2 +157,1 @@\n-    if (Lab.L > 50) Lab.L = 50;\n-    if (Lab.L < 0) Lab.L = 0;\n+    if (Lab.L > 50 || Lab.L < 0) Lab.L = 0;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmssamp.c","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmssm.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -1552,0 +1552,6 @@\n+        \/\/ Offset MUST be even because it indexes a block of utf16 chars.\n+        \/\/ Tricky profiles that uses odd positions will not work anyway\n+        \/\/ because the whole utf16 block is previously converted to wchar_t\n+        \/\/ and sizeof this type may be of 4 bytes. On Linux systems, for example.\n+        if (Offset & 1) goto Error;\n+\n@@ -1579,1 +1585,4 @@\n-        Block = (wchar_t*) _cmsMalloc(self ->ContextID, SizeOfTag);\n+        \/\/ Make sure this is an even utf16 size.\n+        if (SizeOfTag & 1) goto Error;\n+\n+        Block = (wchar_t*) _cmsCalloc(self ->ContextID, 1, SizeOfTag);\n@@ -1581,0 +1590,1 @@\n+\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmstypes.c","additions":12,"deletions":2,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsvirt.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -247,0 +247,4 @@\n+    if ((fabs(ConeSourceRGB.n[0]) < MATRIX_DET_TOLERANCE) ||\n+        (fabs(ConeSourceRGB.n[1]) < MATRIX_DET_TOLERANCE) ||\n+        (fabs(ConeSourceRGB.n[2]) < MATRIX_DET_TOLERANCE)) return FALSE;\n+\n@@ -252,1 +256,0 @@\n-\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmswtpnt.c","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsxform.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n@@ -55,1 +55,1 @@\n-\/\/ Version 2.14\n+\/\/ Version 2.15\n@@ -113,1 +113,1 @@\n-#define LCMS_VERSION        2140\n+#define LCMS_VERSION        2150\n@@ -259,1 +259,1 @@\n-#ifdef CMS_IS_WINDOWS_\n+#if defined(CMS_IS_WINDOWS_) && !defined(__GNUC__)\n","filename":"src\/java.desktop\/share\/native\/liblcms\/lcms2.h","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -30,1 +30,0 @@\n-\n@@ -33,1 +32,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/lcms2_internal.h","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2022 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/lcms2_plugin.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}