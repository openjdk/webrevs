{"files":[{"patch":"@@ -1791,1 +1791,1 @@\n-void CodeCache::write_perf_map(const char* filename) {\n+void CodeCache::write_perf_map(const char* filename, outputStream* st) {\n@@ -1804,1 +1804,1 @@\n-    log_warning(codecache)(\"Failed to create %s for perf map\", filename);\n+    st->print_cr(\"Failed to create %s for perf map\", filename);\n","filename":"src\/hotspot\/share\/code\/codeCache.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -226,1 +226,1 @@\n-  LINUX_ONLY(static void write_perf_map(const char* filename = nullptr);)\n+  LINUX_ONLY(static void write_perf_map(const char* filename, outputStream* st);)\n","filename":"src\/hotspot\/share\/code\/codeCache.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -487,1 +487,1 @@\n-    CodeCache::write_perf_map();\n+    CodeCache::write_perf_map(nullptr, tty);\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -868,1 +868,1 @@\n-  CodeCache::write_perf_map(_filename.is_set() ? _filename.value() : nullptr);\n+  CodeCache::write_perf_map(_filename.is_set() ? _filename.value() : nullptr, output());\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -116,0 +116,10 @@\n+\n+    @Test\n+    public void logErrorsDcmdOutputStream() throws IOException {\n+        String test_dir = System.getProperty(\"test.dir\", \".\");\n+        Path path = Paths.get(\"nonexistent\", test_dir);\n+        OutputAnalyzer output = new JMXExecutor().execute(\"Compiler.perfmap %s\".formatted(path));\n+        output.shouldContain(\"Failed to create nonexistent\/%s for perf map\".formatted(test_dir));\n+        output.shouldNotHaveExitValue(0);\n+        Files.deleteIfExists(path);\n+    }\n","filename":"test\/hotspot\/jtreg\/serviceability\/dcmd\/compiler\/PerfMapTest.java","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"}]}