{"files":[{"patch":"@@ -294,2 +294,1 @@\n-  $1_JAVA_ARGS := -Dextlink.spec.version=$$(VERSION_SPECIFICATION) \\\n-\t-Djspec.version=$$(VERSION_SPECIFICATION)\n+  $1_JAVA_ARGS := -Dextlink.spec.version=$$(VERSION_SPECIFICATION)\n","filename":"make\/Docs.gmk","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -36,0 +36,2 @@\n+import javax.lang.model.element.PackageElement;\n+import javax.lang.model.element.TypeElement;\n@@ -47,1 +49,1 @@\n- * A base class for block tags to insert a link to an external copy of JLS or JVMS.\n+ * A base class for block tags to insert a link to a local copy of JLS or JVMS.\n@@ -60,1 +62,2 @@\n- * will produce the following HTML for a docs build configured for Java SE 12.\n+ * will produce the following HTML, depending on the file containing\n+ * the tag.\n@@ -64,1 +67,1 @@\n- * <dd><a href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se12\/html\/jls-3.html#jls-3.4\">3.4 Line terminators<\/a>\n+ * <dd><a href=\"..\/..\/specs\/jls\/jls-3.html#jls-3.4\">3.4 Line terminators<\/a>\n@@ -67,1 +70,2 @@\n- * The version of the spec must be set in the jspec.version system property.\n+ * Copies of JLS and JVMS are expected to have been placed in the {@code specs}\n+ * folder. These documents are not included in open-source repositories.\n@@ -70,8 +74,0 @@\n-    static final String SPEC_VERSION;\n-\n-    static {\n-        SPEC_VERSION = System.getProperty(\"jspec.version\");\n-        if (SPEC_VERSION == null) {\n-            throw new RuntimeException(\"jspec.version property not set\");\n-        }\n-    }\n@@ -83,1 +79,0 @@\n-                \"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se\" + SPEC_VERSION + \"\/html\",\n@@ -92,1 +87,0 @@\n-                \"https:\/\/docs.oracle.com\/javase\/specs\/jvms\/se\" + SPEC_VERSION + \"\/html\",\n@@ -99,1 +93,0 @@\n-    private String baseURL;\n@@ -102,1 +95,1 @@\n-    JSpec(String tagName, String specTitle, String baseURL, String idPrefix) {\n+    JSpec(String tagName, String specTitle, String idPrefix) {\n@@ -105,1 +98,0 @@\n-        this.baseURL = baseURL;\n@@ -172,2 +164,2 @@\n-                String url = String.format(\"%1$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n-                        baseURL, idPrefix, chapter, section);\n+                String url = String.format(\"%1$s\/..\/specs\/%2$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n+                        docRoot(elem), idPrefix, chapter, section);\n@@ -219,0 +211,31 @@\n+\n+    private String docRoot(Element elem) {\n+        switch (elem.getKind()) {\n+            case MODULE:\n+                return \"..\";\n+\n+            case PACKAGE:\n+                PackageElement pe = (PackageElement)elem;\n+                String pkgPart = pe.getQualifiedName()\n+                        .toString()\n+                        .replace('.', '\/')\n+                        .replaceAll(\"[^\/]+\", \"..\");\n+                return pe.getEnclosingElement() != null\n+                        ? \"..\/\" + pkgPart\n+                        : pkgPart;\n+\n+            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n+                TypeElement te = (TypeElement)elem;\n+                return te.getQualifiedName()\n+                        .toString()\n+                        .replace('.', '\/')\n+                        .replaceAll(\"[^\/]+\", \"..\");\n+\n+            default:\n+                var enclosing = elem.getEnclosingElement();\n+                if (enclosing == null)\n+                    throw new IllegalArgumentException(elem.getKind().toString());\n+                return docRoot(enclosing);\n+        }\n+    }\n+\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/JSpec.java","additions":42,"deletions":19,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -159,1 +159,2 @@\n-            case CLASS:\n+\n+            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n@@ -167,1 +168,4 @@\n-                throw new IllegalArgumentException(elem.getKind().toString());\n+                var enclosing = elem.getEnclosingElement();\n+                if (enclosing == null)\n+                    throw new IllegalArgumentException(elem.getKind().toString());\n+                return docRoot(enclosing);\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/ToolGuide.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"}]}