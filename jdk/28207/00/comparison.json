{"files":[{"patch":"@@ -36,0 +36,2 @@\n+import javax.lang.model.element.PackageElement;\n+import javax.lang.model.element.TypeElement;\n@@ -60,1 +62,2 @@\n- * will produce the following HTML for a docs build configured for Java SE 12.\n+ * will produce the following HTML, depending on the file containing\n+ * the tag.\n@@ -64,1 +67,1 @@\n- * <dd><a href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se12\/html\/jls-3.html#jls-3.4\">3.4 Line terminators<\/a>\n+ * <dd><a href=\"..\/..\/specs\/jls\/jls-3.html#jls-3.4\">3.4 Line terminators<\/a>\n@@ -66,2 +69,0 @@\n- *\n- * The version of the spec must be set in the jspec.version system property.\n@@ -70,8 +71,0 @@\n-    static final String SPEC_VERSION;\n-\n-    static {\n-        SPEC_VERSION = System.getProperty(\"jspec.version\");\n-        if (SPEC_VERSION == null) {\n-            throw new RuntimeException(\"jspec.version property not set\");\n-        }\n-    }\n@@ -83,1 +76,0 @@\n-                \"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se\" + SPEC_VERSION + \"\/html\",\n@@ -92,1 +84,0 @@\n-                \"https:\/\/docs.oracle.com\/javase\/specs\/jvms\/se\" + SPEC_VERSION + \"\/html\",\n@@ -99,1 +90,0 @@\n-    private String baseURL;\n@@ -102,1 +92,1 @@\n-    JSpec(String tagName, String specTitle, String baseURL, String idPrefix) {\n+    JSpec(String tagName, String specTitle, String idPrefix) {\n@@ -105,1 +95,0 @@\n-        this.baseURL = baseURL;\n@@ -172,2 +161,2 @@\n-                String url = String.format(\"%1$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n-                        baseURL, idPrefix, chapter, section);\n+                String url = String.format(\"%1$s\/..\/specs\/%2$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n+                        docRoot(elem), idPrefix, chapter, section);\n@@ -219,0 +208,31 @@\n+\n+    private String docRoot(Element elem) {\n+        switch (elem.getKind()) {\n+            case MODULE:\n+                return \"..\";\n+\n+            case PACKAGE:\n+                PackageElement pe = (PackageElement)elem;\n+                String pkgPart = pe.getQualifiedName()\n+                        .toString()\n+                        .replace('.', '\/')\n+                        .replaceAll(\"[^\/]+\", \"..\");\n+                return pe.getEnclosingElement() != null\n+                        ? \"..\/\" + pkgPart\n+                        : pkgPart;\n+\n+            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n+                TypeElement te = (TypeElement)elem;\n+                return te.getQualifiedName()\n+                        .toString()\n+                        .replace('.', '\/')\n+                        .replaceAll(\"[^\/]+\", \"..\");\n+\n+            default:\n+                var enclosing = elem.getEnclosingElement();\n+                if (enclosing == null)\n+                    throw new IllegalArgumentException(elem.getKind().toString());\n+                return docRoot(enclosing);\n+        }\n+    }\n+\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/JSpec.java","additions":39,"deletions":19,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -159,1 +159,2 @@\n-            case CLASS:\n+\n+            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n@@ -167,1 +168,4 @@\n-                throw new IllegalArgumentException(elem.getKind().toString());\n+                var enclosing = elem.getEnclosingElement();\n+                if (enclosing == null)\n+                    throw new IllegalArgumentException(elem.getKind().toString());\n+                return docRoot(enclosing);\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/ToolGuide.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"}]}