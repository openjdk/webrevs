{"files":[{"patch":"@@ -43,1 +43,0 @@\n-import java.net.http.HttpRequest.BodyPublishers;\n@@ -51,1 +50,0 @@\n-import java.util.concurrent.TimeUnit;\n@@ -57,2 +55,1 @@\n-import jdk.httpclient.test.lib.common.HttpServerAdapters;\n-import jdk.httpclient.test.lib.common.HttpServerAdapters.HttpHeadHandler;\n+import jdk.httpclient.test.lib.common.HttpServerAdapters.HttpHeadOrGetHandler;\n@@ -272,1 +269,1 @@\n-        this.https2TestServer.addHandler(new HttpHeadHandler(), \"\/https2\/head\/\");\n+        this.https2TestServer.addHandler(new HttpHeadOrGetHandler(), \"\/https2\/head\/\");\n@@ -355,2 +352,4 @@\n-                } else fail(\"Exchange is not %s but %s\"\n-                        .formatted(FCHttp2TestExchange.class.getName(), t.getClass().getName()));\n+                } else {\n+                    fail(\"Exchange is not %s but %s\"\n+                            .formatted(FCHttp2TestExchange.class.getName(), t.getClass().getName()));\n+                }\n","filename":"test\/jdk\/java\/net\/httpclient\/http2\/StreamFlowControlTest.java","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -434,1 +434,1 @@\n-    public static class HttpHeadHandler implements HttpTestHandler {\n+    public static class HttpHeadOrGetHandler implements HttpTestHandler {\n@@ -436,1 +436,1 @@\n-        public HttpHeadHandler() {\n+        public HttpHeadOrGetHandler() {\n@@ -439,1 +439,1 @@\n-        public HttpHeadHandler(String responseBody) {\n+        public HttpHeadOrGetHandler(String responseBody) {\n@@ -445,8 +445,13 @@\n-            t.getRequestBody().readAllBytes();\n-            String method = t.getRequestMethod();\n-            switch (method) {\n-                case \"HEAD\" -> {\n-                    byte[] resp = responseBody.getBytes(StandardCharsets.UTF_8);\n-                    if (t.getExchangeVersion() != HTTP_1_1) {\n-                        \/\/ with HTTP\/2 or HTTP\/3 the server will not send content-length\n-                        t.getResponseHeaders().addHeader(\"Content-Length\", String.valueOf(resp.length));\n+            try (var exchg = t) {\n+                exchg.getRequestBody().readAllBytes();\n+                String method = exchg.getRequestMethod();\n+                switch (method) {\n+                    case \"HEAD\" -> {\n+                        byte[] resp = responseBody.getBytes(StandardCharsets.UTF_8);\n+                        if (exchg.getExchangeVersion() != HTTP_1_1) {\n+                            \/\/ with HTTP\/2 or HTTP\/3 the server will not send content-length\n+                            exchg.getResponseHeaders()\n+                                    .addHeader(\"Content-Length\", String.valueOf(resp.length));\n+                        }\n+                        exchg.sendResponseHeaders(200, resp.length);\n+                        exchg.getResponseBody().close();\n@@ -454,7 +459,10 @@\n-                    t.sendResponseHeaders(200, resp.length);\n-                }\n-                case \"GET\" -> {\n-                    byte[] resp = responseBody.getBytes(StandardCharsets.UTF_8);\n-                    t.sendResponseHeaders(200, resp.length);\n-                    try (var os = t.getResponseBody()) {\n-                        os.write(resp);\n+                    case \"GET\" -> {\n+                        byte[] resp = responseBody.getBytes(StandardCharsets.UTF_8);\n+                        exchg.sendResponseHeaders(200, resp.length);\n+                        try (var os = exchg.getResponseBody()) {\n+                            os.write(resp);\n+                        }\n+                    }\n+                    default -> {\n+                        exchg.sendResponseHeaders(405, 0);\n+                        exchg.getResponseBody().close();\n@@ -462,3 +470,0 @@\n-                }\n-                default -> {\n-                    t.sendResponseHeaders(405, 0);\n@@ -467,2 +472,0 @@\n-            t.getResponseBody().close();\n-            t.close();\n","filename":"test\/jdk\/java\/net\/httpclient\/lib\/jdk\/httpclient\/test\/lib\/common\/HttpServerAdapters.java","additions":26,"deletions":23,"binary":false,"changes":49,"status":"modified"}]}