{"files":[{"patch":"@@ -45,1 +45,1 @@\n- * @run main\/othervm -Xmx900m AbsPathsInImage\n+ * @run main AbsPathsInImage\n@@ -183,1 +183,8 @@\n-        List<String> matches = scanBytes(Files.readAllBytes(file), searchPatterns);\n+        int bytesRead;\n+        byte[] buffer = new byte[8192];\n+        List<String> matches = new ArrayList<>();\n+        try(InputStream inputStream = Files.newInputStream(file)) {\n+            while((bytesRead = inputStream.read(buffer)) != -1) {\n+                matches.addAll(scanBytes(buffer, bytesRead, searchPatterns));\n+            }\n+        }\n@@ -195,0 +202,3 @@\n+        ZipEntry zipEntry;\n+        int bytesRead;\n+        byte[] buffer = new byte[8192];\n@@ -196,1 +206,0 @@\n-            ZipEntry zipEntry;\n@@ -198,1 +207,4 @@\n-                List<String> matches = scanBytes(zipInputStream.readAllBytes(), searchPatterns);\n+                List<String> matches = new ArrayList<>();\n+                while((bytesRead = zipInputStream.read(buffer)) != -1) {\n+                    matches.addAll(scanBytes(buffer, bytesRead, searchPatterns));\n+                }\n@@ -211,1 +223,1 @@\n-    private List<String> scanBytes(byte[] data, List<byte[]> searchPatterns) {\n+    private List<String> scanBytes(byte[] data, int dataLength, List<byte[]> searchPatterns) {\n@@ -213,1 +225,1 @@\n-        for (int i = 0; i < data.length; i++) {\n+        for (int i = 0; i < dataLength; i++) {\n@@ -217,1 +229,1 @@\n-                    if ((i + j >= data.length || data[i + j] != searchPattern[j])) {\n+                    if ((i + j >= dataLength || data[i + j] != searchPattern[j])) {\n@@ -223,1 +235,1 @@\n-                    matches.add(new String(data, charsStart(data, i), charsOffset(data, i, searchPattern.length)));\n+                    matches.add(new String(data, charsStart(data, i), charsOffset(data, dataLength, i, searchPattern.length)));\n@@ -243,1 +255,1 @@\n-    private int charsOffset(byte[] data, int startIndex, int startOffset) {\n+    private int charsOffset(byte[] data, int dataLength, int startIndex, int startOffset) {\n@@ -245,1 +257,1 @@\n-        while (startIndex + ++offset < data.length) {\n+        while (startIndex + ++offset < dataLength) {\n","filename":"test\/jdk\/build\/AbsPathsInImage.java","additions":22,"deletions":10,"binary":false,"changes":32,"status":"modified"}]}