{"files":[{"patch":"@@ -27,2 +27,2 @@\n- * @library \/test\/lib \/javax\/net\/ssl\/templates ..\/..\/\n- * @summary Verify debug output for different javax.net.debug scenarios\n+ * @library \/test\/lib \/javax\/net\/ssl\/templates\n+ * @summary Correct the parsing of the ssl value in javax.net.debug\n@@ -32,0 +32,2 @@\n+\/\/ A test to verify debug output for different javax.net.debug scenarios\n+\n@@ -42,0 +44,1 @@\n+import java.util.HashMap;\n@@ -50,0 +53,28 @@\n+    private static final HashMap<String, List<String>> debugMessages = new HashMap<>();\n+\n+    static {\n+        debugMessages.put(\"handshake\",\n+                List.of(\"Produced ClientHello handshake message\",\n+                        \"supported_versions\"));\n+        debugMessages.put(\"keymanager\", List.of(\"choosing key:\"));\n+        debugMessages.put(\"plaintext\", List.of(\"Plaintext before ENCRYPTION\"));\n+        debugMessages.put(\"record\", List.of(\"handshake, length =\", \"WRITE:\"));\n+        debugMessages.put(\"sslctx\", List.of(\"trigger seeding of SecureRandom\"));\n+        debugMessages.put(\"ssl\", List.of(\"jdk.tls.keyLimits:\"));\n+        debugMessages.put(\"trustmanager\", List.of(\"adding as trusted certificates\"));\n+        debugMessages.put(\"handshake-expand\",\n+                List.of(\"\\\"logger\\\".*: \\\"javax.net.ssl\\\",\",\n+                        \"\\\"message\\\".*: \\\"Produced ClientHello handshake message\"));\n+        debugMessages.put(\"record-expand\",\n+                List.of(\"\\\"logger\\\".*: \\\"javax.net.ssl\\\",\",\n+                        \"\\\"message\\\".*: \\\"READ: TLSv1.2 application_data\"));\n+        debugMessages.put(\"help\",\n+                List.of(\"print the help messages\",\n+                        \"debugging can be widened with:\"));\n+        debugMessages.put(\"javax.net.debug\",\n+                List.of(\"properties: Initial security property:\",\n+                        \"certpath: Cert path validation succeeded\"));\n+        debugMessages.put(\"logger\",\n+                List.of(\"FINE: adding as trusted certificates\",\n+                        \"FINE: WRITE: TLSv1.3 application_data\"));\n+    }\n@@ -59,5 +90,0 @@\n-        \/\/ \"Plaintext before ENCRYPTION\" comes from \"ssl:record:plaintext\" option\n-        \/\/ \"handshake, length =\" comes from \"ssl:record\" option\n-        \/\/ \"matching alias:\" comes from ssl:keymanager option\n-        \/\/ \"trigger seeding of SecureRandom\" comes from ssl:sslctx option\n-        \/\/ \"jdk.tls.keyLimits:\" comes from the plain \"ssl\" option\n@@ -67,5 +93,2 @@\n-                        List.of(\"Plaintext before ENCRYPTION\",\n-                                \"trigger seeding of SecureRandom\",\n-                                \"adding as trusted certificates\",\n-                                \"supported_versions\"),\n-                        null),\n+                        List.of(\"handshake\", \"keymanager\", \"plaintext\", \"record\", \"ssl\",\n+                                \"sslctx\", \"trustmanager\")),\n@@ -74,4 +97,2 @@\n-                        List.of(\"adding as trusted certificates\",\n-                                \"trigger seeding of SecureRandom\",\n-                                \"supported_versions\"),\n-                        List.of(\"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"keymanager\", \"record\", \"ssl\", \"sslctx\",\n+                                \"trustmanager\")),\n@@ -80,6 +101,2 @@\n-                        List.of(\"\\\"logger\\\".*: \\\"javax.net.ssl\\\",\",\n-                                \"\\\"message\\\".*: \\\"Produced ClientHello handshake message\",\n-                                \"adding as trusted certificates\",\n-                                \"trigger seeding of SecureRandom\",\n-                                \"supported_versions\"),\n-                        List.of(\"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"handshake-expand\", \"keymanager\", \"record\",\n+                                \"record-expand\", \"ssl\", \"sslctx\", \"trustmanager\")),\n@@ -88,5 +105,2 @@\n-                        List.of(\"\\\"logger\\\".*: \\\"javax.net.ssl\\\",\",\n-                                \"\\\"message\\\".*: \\\"READ: TLSv1.2 application_data\"),\n-                        List.of(\"Plaintext before ENCRYPTION\",\n-                                \"\\\"message\\\".*: \\\"Produced ClientHello handshake message:\")),\n-                \/\/ \"all ssl\" mode only true if \"ssl\" is javax.net.debug value\n+                        List.of(\"handshake\", \"handshake-expand\", \"keymanager\", \"record\",\n+                                \"record-expand\", \"ssl\", \"sslctx\", \"trustmanager\")),\n@@ -95,4 +109,5 @@\n-                        List.of(\"handshake, length =\",\n-                                \"WRITE:\"),\n-                        List.of(\"matching alias:\",\n-                                \"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"keymanager\", \"record\", \"ssl\", \"sslctx\",\n+                                \"trustmanager\")),\n+                \/\/ example of test where no \"ssl\" value is passed\n+                Arguments.of(List.of(\"-Djavax.net.debug=record\"),\n+                        List.of(\"record\")),\n@@ -101,4 +116,2 @@\n-                        List.of(\"adding as trusted certificates\",\n-                                \"trigger seeding of SecureRandom\",\n-                                \"supported_versions\"),\n-                        List.of(\"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"keymanager\", \"record\", \"ssl\", \"sslctx\",\n+                                \"trustmanager\")),\n@@ -107,4 +120,2 @@\n-                        List.of(\"adding as trusted certificates\",\n-                                \"trigger seeding of SecureRandom\",\n-                                \"supported_versions\"),\n-                        List.of(\"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"keymanager\", \"record\", \"ssl\", \"sslctx\",\n+                                \"trustmanager\")),\n@@ -113,3 +124,2 @@\n-                        List.of(\"Plaintext before ENCRYPTION\",\n-                                \"length =\"),\n-                        List.of(\"matching alias:\")),\n+                        List.of(\"handshake\", \"keymanager\", \"plaintext\", \"record\",\n+                                \"ssl\", \"sslctx\", \"trustmanager\")),\n@@ -117,2 +127,2 @@\n-                        List.of(\"adding as trusted certificates\"),\n-                        List.of(\"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"keymanager\", \"record\", \"ssl\", \"sslctx\",\n+                                \"trustmanager\")),\n@@ -120,2 +130,2 @@\n-                        List.of(\"trigger seeding of SecureRandom\"),\n-                        List.of(\"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"keymanager\", \"record\", \"ssl\", \"sslctx\",\n+                                \"trustmanager\")),\n@@ -124,4 +134,1 @@\n-                        List.of(\"print the help messages\",\n-                                \"debugging can be widened with:\"),\n-                        List.of(\"Plaintext before ENCRYPTION\",\n-                                \"adding as trusted certificates\")),\n+                        List.of(\"help\")),\n@@ -131,4 +138,2 @@\n-                        List.of(\"adding as trusted certificates\",\n-                                \"properties: Initial security property:\",\n-                                \"certpath: Cert path validation succeeded\"),\n-                        List.of(\"Plaintext before ENCRYPTION\")),\n+                        List.of(\"handshake\", \"javax.net.debug\", \"keymanager\", \"record\",\n+                                \"ssl\", \"sslctx\", \"trustmanager\")),\n@@ -138,5 +143,3 @@\n-                        List.of(\"FINE: adding as trusted certificates\",\n-                        \"FINE: WRITE: TLSv1.3 application_data\",\n-                        \"supported_versions\"),\n-                        null)\n-                );\n+                        List.of(\"handshake\", \"keymanager\", \"logger\", \"plaintext\",\n+                                \"record\", \"ssl\", \"sslctx\", \"trustmanager\"))\n+        );\n@@ -147,2 +150,2 @@\n-    public void checkDebugOutput(List<String> params, List<String> expected,\n-                                 List<String> notExpected) throws Exception {\n+    public void checkDebugOutput(List<String> params,\n+                                 List<String> expected) throws Exception {\n@@ -154,3 +157,7 @@\n-        if (expected != null) {\n-            for (String s : expected) {\n-                outputAnalyzer.shouldMatch(s);\n+        for (String s : debugMessages.keySet()) {\n+            for (String output : debugMessages.get(s)) {\n+                if (expected.contains(s)) {\n+                    outputAnalyzer.shouldMatch(output);\n+                } else {\n+                    outputAnalyzer.shouldNotMatch(output);\n+                }\n@@ -159,11 +166,0 @@\n-        if (notExpected != null) {\n-            for (String s : notExpected) {\n-                outputAnalyzer.shouldNotMatch(s);\n-            }\n-        } else {\n-            outputAnalyzer.stderrShouldNotBeEmpty();\n-        }\n-    }\n-\n-    public static void main(String[] args) throws Exception {\n-        new DebugPropertyValuesTest().run();\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLLogger\/DebugPropertyValuesTest.java","additions":71,"deletions":75,"binary":false,"changes":146,"status":"modified"}]}