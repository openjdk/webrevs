{"files":[{"patch":"@@ -300,23 +300,0 @@\n-void\n-ParallelCompactData::summarize_dense_prefix(HeapWord* beg, HeapWord* end)\n-{\n-  assert(is_region_aligned(beg), \"not RegionSize aligned\");\n-  assert(is_region_aligned(end), \"not RegionSize aligned\");\n-\n-  size_t cur_region = addr_to_region_idx(beg);\n-  const size_t end_region = addr_to_region_idx(end);\n-  HeapWord* addr = beg;\n-  while (cur_region < end_region) {\n-    _region_data[cur_region].set_destination(addr);\n-    _region_data[cur_region].set_destination_count(0);\n-    _region_data[cur_region].set_source_region(cur_region);\n-\n-    \/\/ Update live_obj_size so the region appears completely full.\n-    size_t live_size = RegionSize - _region_data[cur_region].partial_obj_size();\n-    _region_data[cur_region].set_live_obj_size(live_size);\n-\n-    ++cur_region;\n-    addr += RegionSize;\n-  }\n-}\n-\n@@ -897,1 +874,0 @@\n-      _summary_data.summarize_dense_prefix(old_space->bottom(), dense_prefix_end);\n@@ -1542,4 +1518,3 @@\n-  RegionData* old_region = _summary_data.region(_summary_data.addr_to_region_idx(old_dense_prefix_addr));\n-  HeapWord* bump_ptr = old_region->partial_obj_size() != 0\n-                       ? old_dense_prefix_addr + old_region->partial_obj_size()\n-                       : old_dense_prefix_addr;\n+  \/\/ The destination addr for the first live obj after dense-prefix.\n+  HeapWord* bump_ptr = old_dense_prefix_addr\n+                     + _summary_data.addr_to_region_ptr(old_dense_prefix_addr)->partial_obj_size();\n@@ -1550,1 +1525,2 @@\n-    HeapWord* dense_prefix_addr = dense_prefix(SpaceId(id));\n+    \/\/ Only verify objs after dense-prefix, because those before dense-prefix are not moved (forwarded).\n+    HeapWord* cur_addr = dense_prefix(SpaceId(id));\n@@ -1552,1 +1528,0 @@\n-    HeapWord* cur_addr = dense_prefix_addr;\n","filename":"src\/hotspot\/share\/gc\/parallel\/psParallelCompact.cpp","additions":5,"deletions":30,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -363,5 +363,0 @@\n-  \/\/ Fill in the regions covering [beg, end) so that no data moves; i.e., the\n-  \/\/ destination of region n is simply the start of region n.  Both arguments\n-  \/\/ beg and end must be region-aligned.\n-  void summarize_dense_prefix(HeapWord* beg, HeapWord* end);\n-\n","filename":"src\/hotspot\/share\/gc\/parallel\/psParallelCompact.hpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"}]}