{"files":[{"patch":"@@ -1153,2 +1153,3 @@\n-      assert(count <= 2, \"change this if more element-value pairs are added to the @Deprecated annotation\");\n-      \/\/ @Deprecated can specify forRemoval=true\n+      \/\/ @Deprecated can specify forRemoval=true, which we need\n+      \/\/ to record for JFR to use. If the annotation is not well-formed\n+      \/\/ then we may not be able to determine that.\n@@ -1156,1 +1157,3 @@\n-      for (int i = 0; i < count; ++i) {\n+      \/\/ There are only 2 members in @Deprecated.\n+      int n_members = MIN2(count, 2);\n+      for (int i = 0; i < n_members; ++i) {\n@@ -1160,2 +1163,3 @@\n-        if (member == vmSymbols::since()) {\n-          assert(*((address)offset) == s_tag_val, \"invariant\");\n+        if (member == vmSymbols::since() &&\n+            (*((address)offset) == s_tag_val)) {\n+          \/\/ Found `since` first so skip over it\n@@ -1163,1 +1167,0 @@\n-          continue;\n@@ -1165,2 +1168,2 @@\n-        if (member == vmSymbols::for_removal()) {\n-          assert(*((address)offset) == b_tag_val, \"invariant\");\n+        else if (member == vmSymbols::for_removal() &&\n+                 (*((address)offset) == b_tag_val)) {\n@@ -1168,1 +1171,4 @@\n-          if (cp->int_at(boolean_value_index) == 1) {\n+          \/\/ No guarantee the entry is valid so check it refers to an int in the CP.\n+          if (cp->is_within_bounds(boolean_value_index) &&\n+              cp->tag_at(boolean_value_index).is_int() &&\n+              cp->int_at(boolean_value_index) == 1) {\n@@ -1172,0 +1178,5 @@\n+          break; \/\/ no need to check further\n+        }\n+        else {\n+          \/\/ This @Deprecated annotation is malformed so we don't try to\n+          \/\/ determine whether forRemoval is set.\n@@ -1174,1 +1185,0 @@\n-\n@@ -1176,1 +1186,1 @@\n-      continue;\n+      continue; \/\/ proceed to next annotation\n@@ -1197,2 +1207,11 @@\n-        if (cp->symbol_at(group_index)->utf8_length() == 0) {\n-          group_index = 0; \/\/ default contended group\n+        \/\/ No guarantee the group_index is valid so check it refers to a\n+        \/\/ symbol in the CP.\n+        if (cp->is_within_bounds(group_index) &&\n+            cp->tag_at(group_index).is_utf8()) {\n+          \/\/ Seems valid, so check for empty string and reset\n+          if (cp->symbol_at(group_index)->utf8_length() == 0) {\n+            group_index = 0; \/\/ default contended group\n+          }\n+        } else {\n+          \/\/ Not valid so use the default\n+          group_index = 0;\n@@ -1202,0 +1221,1 @@\n+      continue; \/\/ proceed to next annotation\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":33,"deletions":13,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -0,0 +1,123 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* Based on source:\n+ * public class ContendedField {\n+ *     @Contended(\"group1\")\n+ *     public int field;\n+ * }\n+ *\n+ * We change the value of \"value\" so it refers to an invalid CP entry\n+ *\/\n+\n+class BadContendedGroupBadCPIndex {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  65; \/\/ version\n+  [19] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"BadContendedGroupBadCPIndex\"; \/\/ #8     at 0x3C\n+    Utf8 \"field\"; \/\/ #9     at 0x4D\n+    Utf8 \"I\"; \/\/ #10     at 0x55\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #11     at 0x59\n+    Utf8 \"Ljdk\/internal\/vm\/annotation\/Contended;\"; \/\/ #12     at 0x75\n+    Utf8 \"value\"; \/\/ #13     at 0x9E\n+    Utf8 \"group1\"; \/\/ #14     at 0xA6\n+    Utf8 \"Code\"; \/\/ #15     at 0xAF\n+    Utf8 \"LineNumberTable\"; \/\/ #16     at 0xB6\n+    Utf8 \"SourceFile\"; \/\/ #17     at 0xC8\n+    Utf8 \"BadContendedGroupBadCPIndex.java\"; \/\/ #18     at 0xD5\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #7;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [1] { \/\/ Fields\n+    {  \/\/ field at 0xF5\n+      0x0001; \/\/ access\n+      #9; \/\/ name_index       : field\n+      #10; \/\/ descriptor_index : I\n+      [1] { \/\/ Attributes\n+        Attr(#11, 11) { \/\/ RuntimeVisibleAnnotations at 0xFD\n+          [1] { \/\/ annotations\n+            {  \/\/  annotation\n+              #12;\n+              [1] { \/\/ element_value_pairs\n+                {  \/\/  element value pair\n+                  #13;\n+                  {  \/\/  element_value\n+                    's';\n+                    #1400; \/\/ Changed from #14 to #1400\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+              }  \/\/  element_value_pairs\n+            }  \/\/  annotation\n+          }\n+        } \/\/ end RuntimeVisibleAnnotations\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Fields\n+\n+  [1] { \/\/ Methods\n+    {  \/\/ method at 0x0110\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#15, 29) { \/\/ Code at 0x0118\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#16, 6) { \/\/ LineNumberTable at 0x012F\n+              [1] { \/\/ line_number_table\n+                0  2; \/\/  at 0x013B\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#17, 2) { \/\/ SourceFile at 0x013D\n+      #18;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class BadContendedGroupBadCPIndex\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/BadContendedGroupBadCPIndex.jcod","additions":123,"deletions":0,"binary":false,"changes":123,"status":"added"},{"patch":"@@ -0,0 +1,123 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* Based on source:\n+ * public class ContendedField {\n+ *     @Contended(\"group1\")\n+ *     public int field;\n+ * }\n+ *\n+ * We change the value of \"value\" so it refers to the wrong type of CP entry\n+ *\/\n+\n+class BadContendedGroupWrongType {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  65; \/\/ version\n+  [19] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"BadContendedGroupWrongType\"; \/\/ #8     at 0x3C\n+    Utf8 \"field\"; \/\/ #9     at 0x4D\n+    Utf8 \"I\"; \/\/ #10     at 0x55\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #11     at 0x59\n+    Utf8 \"Ljdk\/internal\/vm\/annotation\/Contended;\"; \/\/ #12     at 0x75\n+    Utf8 \"value\"; \/\/ #13     at 0x9E\n+    Utf8 \"group1\"; \/\/ #14     at 0xA6\n+    Utf8 \"Code\"; \/\/ #15     at 0xAF\n+    Utf8 \"LineNumberTable\"; \/\/ #16     at 0xB6\n+    Utf8 \"SourceFile\"; \/\/ #17     at 0xC8\n+    Utf8 \"BadContendedGroupWrongType.java\"; \/\/ #18     at 0xD5\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #7;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [1] { \/\/ Fields\n+    {  \/\/ field at 0xF5\n+      0x0001; \/\/ access\n+      #9; \/\/ name_index       : field\n+      #10; \/\/ descriptor_index : I\n+      [1] { \/\/ Attributes\n+        Attr(#11, 11) { \/\/ RuntimeVisibleAnnotations at 0xFD\n+          [1] { \/\/ annotations\n+            {  \/\/  annotation\n+              #12;\n+              [1] { \/\/ element_value_pairs\n+                {  \/\/  element value pair\n+                  #13;\n+                  {  \/\/  element_value\n+                    's';\n+                    #7; \/\/ Changed from #14 (utf8) to #7 (class)\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+              }  \/\/  element_value_pairs\n+            }  \/\/  annotation\n+          }\n+        } \/\/ end RuntimeVisibleAnnotations\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Fields\n+\n+  [1] { \/\/ Methods\n+    {  \/\/ method at 0x0110\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#15, 29) { \/\/ Code at 0x0118\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#16, 6) { \/\/ LineNumberTable at 0x012F\n+              [1] { \/\/ line_number_table\n+                0  2; \/\/  at 0x013B\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#17, 2) { \/\/ SourceFile at 0x013D\n+      #18;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class BadContendedGroupWrongType\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/BadContendedGroupWrongType.jcod","additions":123,"deletions":0,"binary":false,"changes":123,"status":"added"},{"patch":"@@ -0,0 +1,163 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* Based on source:\n+ *\n+ * public class DeprecatedMethod {\n+ *   @Deprecated(forRemoval=true, since=\"now\")\n+ *   public static void m() {}\n+ * }\n+ *\n+ * We add an extra junk member at the end.\n+ *\/\n+\n+class BadDeprecatedExtraMemberAtEnd {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  65; \/\/ version\n+  [21] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"BadDeprecatedExtraMemberAtEnd\"; \/\/ #8     at 0x3C\n+    Utf8 \"Code\"; \/\/ #9     at 0x4F\n+    Utf8 \"LineNumberTable\"; \/\/ #10     at 0x56\n+    Utf8 \"m\"; \/\/ #11     at 0x68\n+    Utf8 \"Deprecated\"; \/\/ #12     at 0x6C\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #13     at 0x79\n+    Utf8 \"Ljava\/lang\/Deprecated;\"; \/\/ #14     at 0x95\n+    Utf8 \"forRemoval\"; \/\/ #15     at 0xAE\n+    int 0x00000001; \/\/ #16     at 0xBB\n+    Utf8 \"since\"; \/\/ #17     at 0xC0\n+    Utf8 \"now\"; \/\/ #18     at 0xC8\n+    Utf8 \"SourceFile\"; \/\/ #19     at 0xCE\n+    Utf8 \"BadDeprecatedExtraMemberAtEnd.java\"; \/\/ #20     at 0xDB\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #7;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [0] { \/\/ Fields\n+  } \/\/ Fields\n+\n+  [2] { \/\/ Methods\n+    {  \/\/ method at 0xFF\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#9, 29) { \/\/ Code at 0x0107\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x011E\n+              [1] { \/\/ line_number_table\n+                0  1; \/\/  at 0x012A\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+    ;\n+    {  \/\/ method at 0x012A\n+      0x0009; \/\/ access\n+      #11; \/\/ name_index       : m\n+      #6; \/\/ descriptor_index : ()V\n+      [3] { \/\/ Attributes\n+        Attr(#9, 25) { \/\/ Code at 0x0132\n+          0; \/\/ max_stack\n+          0; \/\/ max_locals\n+          Bytes[1]{\n+            0xB1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x0145\n+              [1] { \/\/ line_number_table\n+                0  4; \/\/  at 0x0151\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+        ;\n+        Attr(#12, 0) { \/\/ Deprecated at 0x0151\n+        } \/\/ end Deprecated\n+        ;\n+        Attr(#13, 21) { \/\/ RuntimeVisibleAnnotations at 0x0157 (length changed from 16 to 21)\n+          [1] { \/\/ annotations\n+            {  \/\/  annotation\n+              #14;\n+              [3] { \/\/ element_value_pairs <= extra pair added\n+                {  \/\/  element value pair\n+                  #15;\n+                  {  \/\/  element_value\n+                    'Z';\n+                    #16;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+                ;\n+                {  \/\/  element value pair\n+                  #17;\n+                  {  \/\/  element_value\n+                    's';\n+                    #18;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+                ;\n+                {  \/\/  Extra element value pair: now=true\n+                  #18;\n+                  {  \/\/  element_value\n+                    'Z';\n+                    #16;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+              }  \/\/  element_value_pairs\n+            }  \/\/  annotation\n+          }\n+        } \/\/ end RuntimeVisibleAnnotations\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#19, 2) { \/\/ SourceFile at 0x016F\n+      #20;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class BadDeprecatedExtraMemberAtEnd\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/BadDeprecatedExtraMemberAtEnd.jcod","additions":163,"deletions":0,"binary":false,"changes":163,"status":"added"},{"patch":"@@ -0,0 +1,163 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* Based on source:\n+ *\n+ * public class DeprecatedMethod {\n+ *   @Deprecated(forRemoval=true, since=\"now\")\n+ *   public static void m() {}\n+ * }\n+ *\n+ * We add an extra junk member at the start.\n+ *\/\n+\n+class BadDeprecatedExtraMemberAtStart {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  65; \/\/ version\n+  [21] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"BadDeprecatedExtraMemberAtStart\"; \/\/ #8     at 0x3C\n+    Utf8 \"Code\"; \/\/ #9     at 0x4F\n+    Utf8 \"LineNumberTable\"; \/\/ #10     at 0x56\n+    Utf8 \"m\"; \/\/ #11     at 0x68\n+    Utf8 \"Deprecated\"; \/\/ #12     at 0x6C\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #13     at 0x79\n+    Utf8 \"Ljava\/lang\/Deprecated;\"; \/\/ #14     at 0x95\n+    Utf8 \"forRemoval\"; \/\/ #15     at 0xAE\n+    int 0x00000001; \/\/ #16     at 0xBB\n+    Utf8 \"since\"; \/\/ #17     at 0xC0\n+    Utf8 \"now\"; \/\/ #18     at 0xC8\n+    Utf8 \"SourceFile\"; \/\/ #19     at 0xCE\n+    Utf8 \"BadDeprecatedExtraMemberAtStart.java\"; \/\/ #20     at 0xDB\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #7;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [0] { \/\/ Fields\n+  } \/\/ Fields\n+\n+  [2] { \/\/ Methods\n+    {  \/\/ method at 0xFF\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#9, 29) { \/\/ Code at 0x0107\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x011E\n+              [1] { \/\/ line_number_table\n+                0  1; \/\/  at 0x012A\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+    ;\n+    {  \/\/ method at 0x012A\n+      0x0009; \/\/ access\n+      #11; \/\/ name_index       : m\n+      #6; \/\/ descriptor_index : ()V\n+      [3] { \/\/ Attributes\n+        Attr(#9, 25) { \/\/ Code at 0x0132\n+          0; \/\/ max_stack\n+          0; \/\/ max_locals\n+          Bytes[1]{\n+            0xB1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x0145\n+              [1] { \/\/ line_number_table\n+                0  4; \/\/  at 0x0151\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+        ;\n+        Attr(#12, 0) { \/\/ Deprecated at 0x0151\n+        } \/\/ end Deprecated\n+        ;\n+        Attr(#13, 21) { \/\/ RuntimeVisibleAnnotations at 0x0157 (length changed from 16 to 21)\n+          [1] { \/\/ annotations\n+            {  \/\/  annotation\n+              #14;\n+              [3] { \/\/ element_value_pairs <= extra pair added\n+                {  \/\/  Extra element value pair: now=true\n+                  #18;\n+                  {  \/\/  element_value\n+                    'Z';\n+                    #16;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+                ;\n+                {  \/\/  element value pair\n+                  #15;\n+                  {  \/\/  element_value\n+                    'Z';\n+                    #16;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+                ;\n+                {  \/\/  element value pair\n+                  #17;\n+                  {  \/\/  element_value\n+                    's';\n+                    #18;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+              }  \/\/  element_value_pairs\n+            }  \/\/  annotation\n+          }\n+        } \/\/ end RuntimeVisibleAnnotations\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#19, 2) { \/\/ SourceFile at 0x016F\n+      #20;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class BadDeprecatedExtraMemberAtStart\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/BadDeprecatedExtraMemberAtStart.jcod","additions":163,"deletions":0,"binary":false,"changes":163,"status":"added"},{"patch":"@@ -0,0 +1,155 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* Based on source:\n+ *\n+ * public class DeprecatedMethod {\n+ *   @Deprecated(forRemoval=true, since=\"now\")\n+ *   public static void m() {}\n+ * }\n+ *\n+ * We change the CP index for the value of forRemoval to a junk value\n+ *\/\n+\n+class BadDeprecatedForRemovalBadCPIndex {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  65; \/\/ version\n+  [21] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"BadDeprecatedForRemovalBadCPIndex\"; \/\/ #8     at 0x3C\n+    Utf8 \"Code\"; \/\/ #9     at 0x4F\n+    Utf8 \"LineNumberTable\"; \/\/ #10     at 0x56\n+    Utf8 \"m\"; \/\/ #11     at 0x68\n+    Utf8 \"Deprecated\"; \/\/ #12     at 0x6C\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #13     at 0x79\n+    Utf8 \"Ljava\/lang\/Deprecated;\"; \/\/ #14     at 0x95\n+    Utf8 \"forRemoval\"; \/\/ #15     at 0xAE\n+    int 0x00000001; \/\/ #16     at 0xBB\n+    Utf8 \"since\"; \/\/ #17     at 0xC0\n+    Utf8 \"now\"; \/\/ #18     at 0xC8\n+    Utf8 \"SourceFile\"; \/\/ #19     at 0xCE\n+    Utf8 \"BadDeprecatedForRemovalBadCPIndex.java\"; \/\/ #20     at 0xDB\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #7;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [0] { \/\/ Fields\n+  } \/\/ Fields\n+\n+  [2] { \/\/ Methods\n+    {  \/\/ method at 0xFF\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#9, 29) { \/\/ Code at 0x0107\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x011E\n+              [1] { \/\/ line_number_table\n+                0  1; \/\/  at 0x012A\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+    ;\n+    {  \/\/ method at 0x012A\n+      0x0009; \/\/ access\n+      #11; \/\/ name_index       : m\n+      #6; \/\/ descriptor_index : ()V\n+      [3] { \/\/ Attributes\n+        Attr(#9, 25) { \/\/ Code at 0x0132\n+          0; \/\/ max_stack\n+          0; \/\/ max_locals\n+          Bytes[1]{\n+            0xB1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x0145\n+              [1] { \/\/ line_number_table\n+                0  4; \/\/  at 0x0151\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+        ;\n+        Attr(#12, 0) { \/\/ Deprecated at 0x0151\n+        } \/\/ end Deprecated\n+        ;\n+        Attr(#13, 16) { \/\/ RuntimeVisibleAnnotations at 0x0157\n+          [1] { \/\/ annotations\n+            {  \/\/  annotation\n+              #14;\n+              [2] { \/\/ element_value_pairs\n+                {  \/\/  element value pair\n+                  #17;\n+                  {  \/\/  element_value\n+                    's';\n+                    #18;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+                ;\n+                {  \/\/  element value pair\n+                  #15;\n+                  {  \/\/  element_value\n+                    'Z';\n+                    #1600;  \/\/ Changed from #16 to #1600\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+              }  \/\/  element_value_pairs\n+            }  \/\/  annotation\n+          }\n+        } \/\/ end RuntimeVisibleAnnotations\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#19, 2) { \/\/ SourceFile at 0x016F\n+      #20;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class BadDeprecatedForRemovalBadCPIndex\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/BadDeprecatedForRemovalBadCPIndex.jcod","additions":155,"deletions":0,"binary":false,"changes":155,"status":"added"},{"patch":"@@ -0,0 +1,155 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* Based on source:\n+ *\n+ * public class DeprecatedMethod {\n+ *   @Deprecated(forRemoval=true, since=\"now\")\n+ *   public static void m() {}\n+ * }\n+ *\n+ * We change the type of forRemoval from 'Z' to 's' but don't change the value\n+ *\/\n+\n+class BadDeprecatedForRemovalWrongType {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  65; \/\/ version\n+  [21] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"BadDeprecatedForRemovalWrongType\"; \/\/ #8     at 0x3C\n+    Utf8 \"Code\"; \/\/ #9     at 0x4F\n+    Utf8 \"LineNumberTable\"; \/\/ #10     at 0x56\n+    Utf8 \"m\"; \/\/ #11     at 0x68\n+    Utf8 \"Deprecated\"; \/\/ #12     at 0x6C\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #13     at 0x79\n+    Utf8 \"Ljava\/lang\/Deprecated;\"; \/\/ #14     at 0x95\n+    Utf8 \"forRemoval\"; \/\/ #15     at 0xAE\n+    int 0x00000001; \/\/ #16     at 0xBB\n+    Utf8 \"since\"; \/\/ #17     at 0xC0\n+    Utf8 \"now\"; \/\/ #18     at 0xC8\n+    Utf8 \"SourceFile\"; \/\/ #19     at 0xCE\n+    Utf8 \"BadDeprecatedForRemovalWrongType.java\"; \/\/ #20     at 0xDB\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #7;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [0] { \/\/ Fields\n+  } \/\/ Fields\n+\n+  [2] { \/\/ Methods\n+    {  \/\/ method at 0xFF\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#9, 29) { \/\/ Code at 0x0107\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x011E\n+              [1] { \/\/ line_number_table\n+                0  1; \/\/  at 0x012A\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+    ;\n+    {  \/\/ method at 0x012A\n+      0x0009; \/\/ access\n+      #11; \/\/ name_index       : m\n+      #6; \/\/ descriptor_index : ()V\n+      [3] { \/\/ Attributes\n+        Attr(#9, 25) { \/\/ Code at 0x0132\n+          0; \/\/ max_stack\n+          0; \/\/ max_locals\n+          Bytes[1]{\n+            0xB1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x0145\n+              [1] { \/\/ line_number_table\n+                0  4; \/\/  at 0x0151\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+        ;\n+        Attr(#12, 0) { \/\/ Deprecated at 0x0151\n+        } \/\/ end Deprecated\n+        ;\n+        Attr(#13, 16) { \/\/ RuntimeVisibleAnnotations at 0x0157\n+          [1] { \/\/ annotations\n+            {  \/\/  annotation\n+              #14;\n+              [2] { \/\/ element_value_pairs\n+                {  \/\/  element value pair\n+                  #17;\n+                  {  \/\/  element_value\n+                    's';\n+                    #18;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+                ;\n+                {  \/\/  element value pair\n+                  #15;\n+                  {  \/\/  element_value\n+                    's';  \/\/ Changed from Z to s\n+                    #16;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+              }  \/\/  element_value_pairs\n+            }  \/\/  annotation\n+          }\n+        } \/\/ end RuntimeVisibleAnnotations\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#19, 2) { \/\/ SourceFile at 0x016F\n+      #20;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class BadDeprecatedForRemovalWrongType\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/BadDeprecatedForRemovalWrongType.jcod","additions":155,"deletions":0,"binary":false,"changes":155,"status":"added"},{"patch":"@@ -0,0 +1,155 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* Based on source:\n+ *\n+ * public class DeprecatedMethod {\n+ *   @Deprecated(forRemoval=true, since=\"now\")\n+ *   public static void m() {}\n+ * }\n+ *\n+ * We change the type of since from 's' to 'Z'\n+ *\/\n+\n+class BadDeprecatedSinceWrongType {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  65; \/\/ version\n+  [21] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"BadDeprecatedSinceWrongType\"; \/\/ #8     at 0x3C\n+    Utf8 \"Code\"; \/\/ #9     at 0x4F\n+    Utf8 \"LineNumberTable\"; \/\/ #10     at 0x56\n+    Utf8 \"m\"; \/\/ #11     at 0x68\n+    Utf8 \"Deprecated\"; \/\/ #12     at 0x6C\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #13     at 0x79\n+    Utf8 \"Ljava\/lang\/Deprecated;\"; \/\/ #14     at 0x95\n+    Utf8 \"forRemoval\"; \/\/ #15     at 0xAE\n+    int 0x00000001; \/\/ #16     at 0xBB\n+    Utf8 \"since\"; \/\/ #17     at 0xC0\n+    Utf8 \"now\"; \/\/ #18     at 0xC8\n+    Utf8 \"SourceFile\"; \/\/ #19     at 0xCE\n+    Utf8 \"BadDeprecatedSinceWrongType.java\"; \/\/ #20     at 0xDB\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #7;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [0] { \/\/ Fields\n+  } \/\/ Fields\n+\n+  [2] { \/\/ Methods\n+    {  \/\/ method at 0xFF\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#9, 29) { \/\/ Code at 0x0107\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x011E\n+              [1] { \/\/ line_number_table\n+                0  1; \/\/  at 0x012A\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+    ;\n+    {  \/\/ method at 0x012A\n+      0x0009; \/\/ access\n+      #11; \/\/ name_index       : m\n+      #6; \/\/ descriptor_index : ()V\n+      [3] { \/\/ Attributes\n+        Attr(#9, 25) { \/\/ Code at 0x0132\n+          0; \/\/ max_stack\n+          0; \/\/ max_locals\n+          Bytes[1]{\n+            0xB1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#10, 6) { \/\/ LineNumberTable at 0x0145\n+              [1] { \/\/ line_number_table\n+                0  4; \/\/  at 0x0151\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+        ;\n+        Attr(#12, 0) { \/\/ Deprecated at 0x0151\n+        } \/\/ end Deprecated\n+        ;\n+        Attr(#13, 16) { \/\/ RuntimeVisibleAnnotations at 0x0157\n+          [1] { \/\/ annotations\n+            {  \/\/  annotation\n+              #14;\n+              [2] { \/\/ element_value_pairs\n+                {  \/\/  element value pair\n+                  #17;\n+                  {  \/\/  element_value\n+                    'Z';  \/\/ Changed from 's' to 'Z'\n+                    #18;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+                ;\n+                {  \/\/  element value pair\n+                  #15;\n+                  {  \/\/  element_value\n+                    'Z';\n+                    #16;\n+                  }  \/\/  element_value\n+                }  \/\/  element value pair\n+              }  \/\/  element_value_pairs\n+            }  \/\/  annotation\n+          }\n+        } \/\/ end RuntimeVisibleAnnotations\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#19, 2) { \/\/ SourceFile at 0x016F\n+      #20;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class BadDeprecatedSinceWrongType\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/BadDeprecatedSinceWrongType.jcod","additions":155,"deletions":0,"binary":false,"changes":155,"status":"added"},{"patch":"@@ -0,0 +1,64 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8339192\n+ * @summary Check that malformed annotations don't cause crashes\n+ * @compile BadDeprecatedExtraMemberAtEnd.jcod\n+ *          BadDeprecatedExtraMemberAtStart.jcod\n+ *          BadDeprecatedSinceWrongType.jcod\n+ *          BadDeprecatedForRemovalWrongType.jcod\n+ *          BadDeprecatedForRemovalBadCPIndex.jcod\n+ *          BadContendedGroupBadCPIndex.jcod\n+ *          BadContendedGroupWrongType.jcod\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @run main\/othervm -XX:-RestrictContended TestBadAnnotations\n+ *\/\n+import java.lang.annotation.Annotation;\n+import java.lang.reflect.*;\n+\n+\/\/ None of the malformed nnotations should cause assertion failures or\n+\/\/ other crashes, nor exceptions - we simply don't process them. Note that\n+\/\/ even if the annotation is malformed the class will still be marked as having\n+\/\/ that annotation; it is only the \"forRemoval\" state of @Deprecated, and\n+\/\/ the \"group\" value of @Contended that is potentially afffected.\n+\/\/ There is no API to query what annotations the VM considers applied\n+\/\/ to a class\/field\/method, so we don't try to read anything back.\n+\n+\/\/ The testcases defined reflect the changes that were made to the code under\n+\/\/ 8339192 - we do not try to define exhaustive tests for every potential\n+\/\/ malformation. Each of these test case will trigger an assert prior to\n+\/\/ the fix.\n+\n+public class TestBadAnnotations {\n+    public static void main(String[] args) throws Throwable {\n+        Class<?> c = Class.forName(\"BadDeprecatedExtraMemberAtEnd\");\n+        c = Class.forName(\"BadDeprecatedExtraMemberAtStart\");\n+        c = Class.forName(\"BadDeprecatedSinceWrongType\");\n+        c = Class.forName(\"BadDeprecatedForRemovalWrongType\");\n+        c = Class.forName(\"BadDeprecatedForRemovalBadCPIndex\");\n+        c = Class.forName(\"BadContendedGroupBadCPIndex\");\n+        c = Class.forName(\"BadContendedGroupWrongType\");\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/runtime\/Annotations\/TestBadAnnotations.java","additions":64,"deletions":0,"binary":false,"changes":64,"status":"added"}]}