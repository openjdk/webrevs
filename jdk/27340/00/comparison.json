{"files":[{"patch":"@@ -295,0 +295,19 @@\n+HeapWord* SerialHeap::mem_allocate_cas_noexpand(size_t size, bool is_tlab) {\n+  HeapWord* result = _young_gen->par_allocate(size);\n+  if (result != nullptr) {\n+    return result;\n+  }\n+  \/\/ Try old-gen allocation for non-TLAB.\n+  if (!is_tlab) {\n+    \/\/ If it's too large for young-gen or heap is too full.\n+    if (size > heap_word_size(_young_gen->capacity_before_gc()) || _is_heap_almost_full) {\n+      result = _old_gen->par_allocate(size);\n+      if (result != nullptr) {\n+        return result;\n+      }\n+    }\n+  }\n+\n+  return nullptr;\n+}\n+\n@@ -299,1 +318,1 @@\n-    result = _young_gen->par_allocate(size);\n+    result = mem_allocate_cas_noexpand(size, is_tlab);\n@@ -303,10 +322,0 @@\n-    \/\/ Try old-gen allocation for non-TLAB.\n-    if (!is_tlab) {\n-      \/\/ If it's too large for young-gen or heap is too full.\n-      if (size > heap_word_size(_young_gen->capacity_before_gc()) || _is_heap_almost_full) {\n-        result = _old_gen->par_allocate(size);\n-        if (result != nullptr) {\n-          break;\n-        }\n-      }\n-    }\n@@ -316,0 +325,8 @@\n+\n+      \/\/ Re-try after acquiring the lock, because a GC might have occurred\n+      \/\/ while waiting for this lock.\n+      result = mem_allocate_cas_noexpand(size, is_tlab);\n+      if (result != nullptr) {\n+        break;\n+      }\n+\n","filename":"src\/hotspot\/share\/gc\/serial\/serialHeap.cpp","additions":28,"deletions":11,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -225,0 +225,1 @@\n+  HeapWord* mem_allocate_cas_noexpand(size_t size, bool is_tlab);\n","filename":"src\/hotspot\/share\/gc\/serial\/serialHeap.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}