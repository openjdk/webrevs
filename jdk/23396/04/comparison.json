{"files":[{"patch":"@@ -1496,1 +1496,2 @@\n-  macro(_signers_offset,             k, \"signers\",             object_array_signature, false);\n+  macro(_signers_offset,             k, \"signers\",             object_array_signature, false); \\\n+  macro(_protection_domain_offset,   k, \"protectionDomain\",    java_security_ProtectionDomain_signature,  false);\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -231,1 +231,0 @@\n-  macro(java_lang_Class, protection_domain,      object_signature,  false) \\\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -309,0 +309,1 @@\n+  template(java_security_ProtectionDomain_signature,      \"Ljava\/security\/ProtectionDomain;\")     \\\n","filename":"src\/hotspot\/share\/classfile\/vmSymbols.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1224,16 +1224,0 @@\n-JVM_ENTRY(jobject, JVM_GetProtectionDomain(JNIEnv *env, jclass cls))\n-  oop mirror = JNIHandles::resolve_non_null(cls);\n-  if (mirror == nullptr) {\n-    THROW_(vmSymbols::java_lang_NullPointerException(), nullptr);\n-  }\n-\n-  if (java_lang_Class::is_primitive(mirror)) {\n-    \/\/ Primitive types does not have a protection domain.\n-    return nullptr;\n-  }\n-\n-  oop pd = java_lang_Class::protection_domain(mirror);\n-  return (jobject) JNIHandles::make_local(THREAD, pd);\n-JVM_END\n-\n-\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":0,"deletions":16,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -239,1 +239,1 @@\n-    private Class(ClassLoader loader, Class<?> arrayComponentType) {\n+    private Class(ClassLoader loader, Class<?> arrayComponentType, ProtectionDomain pd) {\n@@ -244,0 +244,1 @@\n+        protectionDomain = pd;\n@@ -2699,11 +2700,1 @@\n-    \/**\n-     * Returns the {@code ProtectionDomain} of this class.\n-     *\n-     * @return the ProtectionDomain of this class\n-     *\n-     * @see java.security.ProtectionDomain\n-     * @since 1.2\n-     *\/\n-    public ProtectionDomain getProtectionDomain() {\n-        return protectionDomain();\n-    }\n+    private transient final ProtectionDomain protectionDomain;\n@@ -2721,4 +2712,10 @@\n-    \/\/ package-private\n-    ProtectionDomain protectionDomain() {\n-        ProtectionDomain pd = getProtectionDomain0();\n-        if (pd == null) {\n+    \/**\n+     * Returns the {@code ProtectionDomain} of this class.\n+     *\n+     * @return the ProtectionDomain of this class\n+     *\n+     * @see java.security.ProtectionDomain\n+     * @since 1.2\n+     *\/\n+    public ProtectionDomain getProtectionDomain() {\n+        if (protectionDomain == null) {\n@@ -2727,1 +2724,1 @@\n-            return pd;\n+            return protectionDomain;\n@@ -2731,5 +2728,0 @@\n-    \/**\n-     * Returns the ProtectionDomain of this class.\n-     *\/\n-    private native ProtectionDomain getProtectionDomain0();\n-\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Class.java","additions":14,"deletions":22,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -2151,1 +2151,1 @@\n-                return c.protectionDomain();\n+                return c.getProtectionDomain();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/System.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -59,1 +59,1 @@\n-            Class.class, Set.of(\"classLoader\", \"classData\"),\n+            Class.class, Set.of(\"classLoader\", \"classData\", \"protectionDomain\"),\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/reflect\/Reflection.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -52,1 +52,0 @@\n-#define PD  \"Ljava\/security\/ProtectionDomain;\"\n@@ -68,1 +67,0 @@\n-    {\"getProtectionDomain0\", \"()\" PD,       (void *)&JVM_GetProtectionDomain},\n","filename":"src\/java.base\/share\/native\/libjava\/Class.c","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -60,1 +60,1 @@\n-  ASSERT_THAT(st.base(), HasSubstr(\"injected 'protection_domain'\")) << \"Must contain injected fields\";\n+  ASSERT_THAT(st.base(), HasSubstr(\"injected 'array_klass'\")) << \"Must contain injected fields\";\n","filename":"test\/hotspot\/gtest\/oops\/test_instanceKlass.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -932,1 +932,1 @@\n-            return f.getName().equals(\"classLoader\") || f.getName().equals(\"classData\");\n+            return f.getName().equals(\"classLoader\") || f.getName().equals(\"classData\") || f.getName().equals(\"protectionDomain\");\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/jdk.vm.ci.runtime.test\/src\/jdk\/vm\/ci\/runtime\/test\/TestResolvedJavaType.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,0 +39,1 @@\n+import java.security.ProtectionDomain;\n@@ -150,1 +151,1 @@\n-            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class);\n+            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class, ProtectionDomain.class);\n","filename":"test\/jdk\/java\/lang\/reflect\/AccessibleObject\/ModuleSetAccessibleTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,0 +44,1 @@\n+import java.security.ProtectionDomain;\n@@ -196,1 +197,1 @@\n-            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class);\n+            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class, ProtectionDomain.class);\n@@ -203,0 +204,10 @@\n+    \/**\n+     * Test that some Class fields cannot be made accessible.\n+     *\/\n+    public void testJavaLangClassFields() throws Exception {\n+        try {\n+            \/\/ This field is explicitly hidden from reflection.\n+            Class.class.getDeclaredField(\"protectionDomain\");\n+            assertTrue(false);\n+        } catch (NoSuchFieldException expected) { }\n+    }\n","filename":"test\/jdk\/java\/lang\/reflect\/AccessibleObject\/TrySetAccessibleTest.java","additions":13,"deletions":2,"binary":false,"changes":15,"status":"modified"}]}