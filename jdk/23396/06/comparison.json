{"files":[{"patch":"@@ -1503,1 +1503,2 @@\n-  macro(_modifiers_offset,           k, vmSymbols::modifiers_name(), int_signature,    false);\n+  macro(_modifiers_offset,           k, vmSymbols::modifiers_name(), int_signature,    false); \\\n+  macro(_protection_domain_offset,   k, \"protectionDomain\",    java_security_ProtectionDomain_signature,  false);\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -231,1 +231,0 @@\n-  macro(java_lang_Class, protection_domain,      object_signature,  false) \\\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -309,0 +309,1 @@\n+  template(java_security_ProtectionDomain_signature,      \"Ljava\/security\/ProtectionDomain;\")     \\\n","filename":"src\/hotspot\/share\/classfile\/vmSymbols.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1214,16 +1214,0 @@\n-JVM_ENTRY(jobject, JVM_GetProtectionDomain(JNIEnv *env, jclass cls))\n-  oop mirror = JNIHandles::resolve_non_null(cls);\n-  if (mirror == nullptr) {\n-    THROW_(vmSymbols::java_lang_NullPointerException(), nullptr);\n-  }\n-\n-  if (java_lang_Class::is_primitive(mirror)) {\n-    \/\/ Primitive types does not have a protection domain.\n-    return nullptr;\n-  }\n-\n-  oop pd = java_lang_Class::protection_domain(mirror);\n-  return (jobject) JNIHandles::make_local(THREAD, pd);\n-JVM_END\n-\n-\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":0,"deletions":16,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -239,1 +239,1 @@\n-    private Class(ClassLoader loader, Class<?> arrayComponentType, int mods) {\n+    private Class(ClassLoader loader, Class<?> arrayComponentType, int mods, ProtectionDomain pd) {\n@@ -245,0 +245,1 @@\n+        protectionDomain = pd;\n@@ -2700,11 +2701,1 @@\n-    \/**\n-     * Returns the {@code ProtectionDomain} of this class.\n-     *\n-     * @return the ProtectionDomain of this class\n-     *\n-     * @see java.security.ProtectionDomain\n-     * @since 1.2\n-     *\/\n-    public ProtectionDomain getProtectionDomain() {\n-        return protectionDomain();\n-    }\n+    private transient final ProtectionDomain protectionDomain;\n@@ -2722,4 +2713,10 @@\n-    \/\/ package-private\n-    ProtectionDomain protectionDomain() {\n-        ProtectionDomain pd = getProtectionDomain0();\n-        if (pd == null) {\n+    \/**\n+     * Returns the {@code ProtectionDomain} of this class.\n+     *\n+     * @return the ProtectionDomain of this class\n+     *\n+     * @see java.security.ProtectionDomain\n+     * @since 1.2\n+     *\/\n+    public ProtectionDomain getProtectionDomain() {\n+        if (protectionDomain == null) {\n@@ -2728,1 +2725,1 @@\n-            return pd;\n+            return protectionDomain;\n@@ -2732,5 +2729,0 @@\n-    \/**\n-     * Returns the ProtectionDomain of this class.\n-     *\/\n-    private native ProtectionDomain getProtectionDomain0();\n-\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Class.java","additions":14,"deletions":22,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -2151,1 +2151,1 @@\n-                return c.protectionDomain();\n+                return c.getProtectionDomain();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/System.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -59,1 +59,1 @@\n-            Class.class, Set.of(\"classLoader\", \"classData\", \"modifiers\"),\n+            Class.class, Set.of(\"classLoader\", \"classData\", \"modifiers\", \"protectionDomain\"),\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/reflect\/Reflection.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -52,1 +52,0 @@\n-#define PD  \"Ljava\/security\/ProtectionDomain;\"\n@@ -67,1 +66,0 @@\n-    {\"getProtectionDomain0\", \"()\" PD,       (void *)&JVM_GetProtectionDomain},\n","filename":"src\/java.base\/share\/native\/libjava\/Class.c","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -60,1 +60,1 @@\n-  ASSERT_THAT(st.base(), HasSubstr(\"injected 'protection_domain'\")) << \"Must contain injected fields\";\n+  ASSERT_THAT(st.base(), HasSubstr(\"injected 'array_klass'\")) << \"Must contain injected fields\";\n","filename":"test\/hotspot\/gtest\/oops\/test_instanceKlass.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -932,1 +932,4 @@\n-            return f.getName().equals(\"classLoader\") || f.getName().equals(\"classData\") || f.getName().equals(\"modifiers\");\n+            return f.getName().equals(\"classLoader\") ||\n+                   f.getName().equals(\"classData\") ||\n+                   f.getName().equals(\"modifiers\") ||\n+                   f.getName().equals(\"protectionDomain\");\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/jdk.vm.ci.runtime.test\/src\/jdk\/vm\/ci\/runtime\/test\/TestResolvedJavaType.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -39,0 +39,1 @@\n+import java.security.ProtectionDomain;\n@@ -150,1 +151,1 @@\n-            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class, int.class);\n+            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class, int.class, ProtectionDomain.class);\n","filename":"test\/jdk\/java\/lang\/reflect\/AccessibleObject\/ModuleSetAccessibleTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -44,0 +44,1 @@\n+import java.security.ProtectionDomain;\n@@ -196,1 +197,1 @@\n-            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class, int.class);\n+            = Class.class.getDeclaredConstructor(ClassLoader.class, Class.class, int.class, ProtectionDomain.class);\n","filename":"test\/jdk\/java\/lang\/reflect\/AccessibleObject\/TrySetAccessibleTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8210496 8346567\n+ * @bug 8210496 8349145 8346567\n@@ -59,0 +59,1 @@\n+            { Class.class, \"protectionDomain\" },\n","filename":"test\/jdk\/jdk\/internal\/reflect\/Reflection\/Filtering.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}