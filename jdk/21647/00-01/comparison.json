{"files":[{"patch":"@@ -145,0 +145,1 @@\n+  intptr_t _delta;\n@@ -147,1 +148,7 @@\n-  PatchUncompressedEmbeddedPointers(oop* start) : _start(start) {}\n+  PatchUncompressedEmbeddedPointers(oop* start, intx runtime_offset) :\n+    _start(start),\n+    _delta(runtime_offset) {}\n+\n+  PatchUncompressedEmbeddedPointers(oop* start) :\n+    _start(start),\n+    _delta(ArchiveHeapLoader::mapped_heap_delta()) {}\n@@ -153,1 +160,1 @@\n-    intptr_t runtime_oop = dumptime_oop + ArchiveHeapLoader::mapped_heap_delta();\n+    intptr_t runtime_oop = dumptime_oop + _delta;\n@@ -227,19 +234,0 @@\n-class ArchiveHeapLoader::PatchUncompressedLoadedRegionPointers: public BitMapClosure {\n-  oop* _start;\n-  intx _runtime_offset;\n-\n- public:\n-  PatchUncompressedLoadedRegionPointers(oop* start, LoadedArchiveHeapRegion* loaded_region)\n-    : _start(start),\n-      _runtime_offset(loaded_region->_runtime_offset) {}\n-\n-  bool do_bit(size_t offset) {\n-    oop* p = _start + offset;\n-    intptr_t dumptime_oop = (intptr_t)((void*)*p);\n-    assert(dumptime_oop != 0, \"null oops should have been filtered out at dump time\");\n-    intptr_t runtime_oop = dumptime_oop + _runtime_offset;\n-    RawAccess<IS_NOT_NULL>::oop_store(p, cast_to_oop(runtime_oop));\n-    return true;\n-  }\n-};\n-\n@@ -334,1 +322,1 @@\n-    PatchUncompressedLoadedRegionPointers patcher((oop*)load_address + FileMapInfo::current_info()->heap_oopmap_start_pos(), loaded_region);\n+    PatchUncompressedEmbeddedPointers patcher((oop*)load_address + FileMapInfo::current_info()->heap_oopmap_start_pos(), loaded_region->_runtime_offset);\n","filename":"src\/hotspot\/share\/cds\/archiveHeapLoader.cpp","additions":10,"deletions":22,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2137,1 +2137,1 @@\n-  assert(ArchiveHeapLoader::can_use(), \"cannot be used by ArchiveHeapLoader::can_load() mode\");\n+  assert(ArchiveHeapLoader::can_use(), \"GC must support mapping or loading\");\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}