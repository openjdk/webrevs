{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -91,1 +91,1 @@\n-         * If so add it as the final fallback component of the composite.\n+         * If so add it as the first fallback component of the composite.\n@@ -117,2 +117,2 @@\n-                for (int i=0; i<numSlots-1; i++) {\n-                    deferredInitialisation[i] = true;\n+                for (int i = 0; i < numSlots; i++) {\n+                    deferredInitialisation[i] = (i != msCnt);\n","filename":"src\/java.desktop\/share\/classes\/sun\/font\/CompositeFont.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -0,0 +1,37 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025 Azul Systems, Inc.  All Rights Reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.awt.FontMetrics;\n+import java.awt.Graphics2D;\n+import java.awt.image.BufferedImage;\n+\n+public class FallbackFontNPE {\n+    public static void main(String[] args) throws Exception {\n+        BufferedImage bi = new BufferedImage(1, 1, 1);\n+        Graphics2D g2d = bi.createGraphics();\n+        FontMetrics fm = g2d.getFontMetrics();\n+        fm.charWidth(0x1200);\n+    }\n+}\n+\n","filename":"test\/jdk\/java\/awt\/8368882\/FallbackFontNPE.java","additions":37,"deletions":0,"binary":false,"changes":37,"status":"added"},{"patch":"@@ -0,0 +1,96 @@\n+# Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2025, Azul Systems, Inc. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+\n+# @test\n+# @bug 8368882\n+# @compile FallbackFontNPE.java\n+# @requires os.family == \"windows\"\n+# @run shell\/timeout=400 FallbackFontNPE.sh\n+# @summary Check if PhysicalFont.getMapper() doesn't throw NPE\n+\n+if [ -z \"${TESTSRC}\" ]; then\n+  echo \"TESTSRC undefined: defaulting to .\"\n+  TESTSRC=.\n+fi\n+\n+if [ -z \"${TESTCLASSES}\" ]; then\n+  echo \"TESTCLASSES undefined: defaulting to .\"\n+  TESTCLASSES=.\n+fi\n+\n+if [ -z \"${TESTJAVA}\" ]; then\n+  echo \"TESTJAVA undefined: can't continue.\"\n+  exit 1\n+fi\n+\n+cd ${TESTSRC}\n+\n+echo Setup EUDC.tte font\n+reg_eudc_1252=\"HKCU\\\\EUDC\\\\1252\"\n+echo ...Write ${reg_eudc_1252} record\n+old_reg_record=\"\"\n+if Reg QUERY \"${reg_eudc_1252}\"; then\n+   old_reg_record=$(cygpath -m ${TESTCLASSES}\/eudc_1252.reg)\n+   Reg EXPORT \"${reg_eudc_1252}\" ${old_reg_record} \/y\n+   Reg DELETE \"${reg_eudc_1252}\" \/va \/f\n+fi\n+Reg ADD \"${reg_eudc_1252}\" \/v SystemDefaultEUDCFont \/d EUDC.TTE \/f\n+\n+windows_eudc_tte=$(cygpath -m ${WINDIR}\/Fonts\/EUDC.tte)\n+delete_eudc_tte=false\n+if [ ! -f ${windows_eudc_tte} ]; then\n+  echo ...Copy custom EUDC.tte file\n+  delete_eudc_tte=true\n+  cp ${WINDIR}\/Fonts\/webdings.ttf ${windows_eudc_tte}\n+fi\n+\n+echo Setup fallback font\n+fallbackfontdir=${TESTJAVA}\/lib\/fonts\/fallback\n+mkdir -p ${fallbackfontdir}\n+cp ${WINDIR}\/Fonts\/webdings.ttf ${fallbackfontdir}\n+\n+echo Run java test FallbackFontNPE\n+result=0\n+${TESTJAVA}\/bin\/java ${TESTVMOPTS} -cp $(cygpath -m ${TESTCLASSES}) FallbackFontNPE || result=1\n+\n+echo Delete fallback font\n+rm ${fallbackfontdir}\/webdings.ttf\n+\n+echo Restore registry record\n+Reg DELETE ${reg_eudc_1252} \/f\n+if [ -f \"${old_reg_record}\" ]; then\n+  Reg import ${old_reg_record}\n+  rm \"${old_reg_record}\"\n+fi\n+\n+if [ ${delete_eudc_tte} = true ]; then\n+    echo ...Delete test EUDC.tte\n+    rm \"${windows_eudc_tte}\"\n+fi\n+\n+if [ $result -ne 0 ]; then\n+      echo \"Test fails: exception thrown!\"\n+      exit 1\n+fi\n+\n+exit 0\n+\n","filename":"test\/jdk\/java\/awt\/8368882\/FallbackFontNPE.sh","additions":96,"deletions":0,"binary":false,"changes":96,"status":"added"}]}