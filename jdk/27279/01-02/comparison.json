{"files":[{"patch":"@@ -522,2 +522,7 @@\n-const TypeFunc* ShenandoahBarrierSetC2::write_barrier_pre_Type() {\n-  return OptoRuntime::write_barrier_pre_Type();\n+const TypeFunc* ShenandoahBarrierSetC2::_write_barrier_pre_Type              = nullptr;\n+const TypeFunc* ShenandoahBarrierSetC2::_clone_barrier_Type                  = nullptr;\n+const TypeFunc* ShenandoahBarrierSetC2::_load_reference_barrier_Type         = nullptr;\n+\n+inline const TypeFunc* ShenandoahBarrierSetC2::write_barrier_pre_Type() {\n+  assert(ShenandoahBarrierSetC2::_write_barrier_pre_Type != nullptr, \"should be initialized\");\n+  return ShenandoahBarrierSetC2::_write_barrier_pre_Type;\n@@ -526,2 +531,3 @@\n-const TypeFunc* ShenandoahBarrierSetC2::clone_barrier_Type() {\n-  return OptoRuntime::clone_barrier_Type();\n+inline const TypeFunc* ShenandoahBarrierSetC2::clone_barrier_Type() {\n+  assert(ShenandoahBarrierSetC2::_clone_barrier_Type != nullptr, \"should be initialized\");\n+  return ShenandoahBarrierSetC2::_clone_barrier_Type;\n@@ -531,1 +537,44 @@\n-  return OptoRuntime::load_reference_barrier_Type();\n+  assert(ShenandoahBarrierSetC2::_load_reference_barrier_Type != nullptr, \"should be initialized\");\n+  return ShenandoahBarrierSetC2::_load_reference_barrier_Type;\n+}\n+\n+void ShenandoahBarrierSetC2::make_write_barrier_pre_Type() {\n+  assert(ShenandoahBarrierSetC2::_write_barrier_pre_Type == nullptr, \"should be\");\n+  const Type **fields = TypeTuple::fields(1);\n+  fields[TypeFunc::Parms+0] = TypeInstPtr::NOTNULL; \/\/ original field value\n+  const TypeTuple *domain = TypeTuple::make(TypeFunc::Parms+1, fields);\n+\n+  \/\/ create result type (range)\n+  fields = TypeTuple::fields(0);\n+  const TypeTuple *range = TypeTuple::make(TypeFunc::Parms+0, fields);\n+\n+  ShenandoahBarrierSetC2::_write_barrier_pre_Type = TypeFunc::make(domain, range);\n+}\n+\n+void ShenandoahBarrierSetC2::make_clone_barrier_Type() {\n+  assert(ShenandoahBarrierSetC2::_clone_barrier_Type == nullptr, \"should be\");\n+  const Type **fields = TypeTuple::fields(1);\n+  fields[TypeFunc::Parms+0] = TypeOopPtr::NOTNULL; \/\/ src oop\n+  const TypeTuple *domain = TypeTuple::make(TypeFunc::Parms+1, fields);\n+\n+  \/\/ create result type (range)\n+  fields = TypeTuple::fields(0);\n+  const TypeTuple *range = TypeTuple::make(TypeFunc::Parms+0, fields);\n+\n+  ShenandoahBarrierSetC2::_clone_barrier_Type = TypeFunc::make(domain, range);\n+}\n+\n+void ShenandoahBarrierSetC2::make_load_reference_barrier_Type() {\n+  assert(ShenandoahBarrierSetC2::_load_reference_barrier_Type == nullptr, \"should be\");\n+  const Type **fields = TypeTuple::fields(2);\n+  fields[TypeFunc::Parms+0] = TypeOopPtr::BOTTOM; \/\/ original field value\n+  fields[TypeFunc::Parms+1] = TypeRawPtr::BOTTOM; \/\/ original load address\n+\n+  const TypeTuple *domain = TypeTuple::make(TypeFunc::Parms+2, fields);\n+\n+  \/\/ create result type (range)\n+  fields = TypeTuple::fields(1);\n+  fields[TypeFunc::Parms+0] = TypeOopPtr::BOTTOM;\n+  const TypeTuple *range = TypeTuple::make(TypeFunc::Parms+1, fields);\n+\n+  ShenandoahBarrierSetC2::_load_reference_barrier_Type = TypeFunc::make(domain, range);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c2\/shenandoahBarrierSetC2.cpp","additions":54,"deletions":5,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -106,0 +106,1 @@\n+  static const TypeFunc* _write_barrier_pre_Type;\n@@ -107,0 +108,3 @@\n+  static void make_write_barrier_pre_Type();\n+\n+  static const TypeFunc* _clone_barrier_Type;\n@@ -108,0 +112,3 @@\n+  static void make_clone_barrier_Type();\n+\n+  static const TypeFunc* _load_reference_barrier_Type;\n@@ -109,0 +116,2 @@\n+  static void make_load_reference_barrier_Type();\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c2\/shenandoahBarrierSetC2.hpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -269,5 +269,0 @@\n-#if INCLUDE_SHENANDOAHGC\n-const TypeFunc* OptoRuntime::_load_reference_barrier_Type         = nullptr;\n-const TypeFunc* OptoRuntime::_write_barrier_pre_Type              = nullptr;\n-const TypeFunc* OptoRuntime::_clone_barrier_Type                  = nullptr;\n-#endif \/\/ INCLUDE_SHENANDOAHGC\n@@ -2206,41 +2201,0 @@\n-#if INCLUDE_SHENANDOAHGC\n-static const TypeFunc* make_load_reference_barrier_Type() {\n-  const Type **fields = TypeTuple::fields(2);\n-  fields[TypeFunc::Parms+0] = TypeOopPtr::BOTTOM; \/\/ original field value\n-  fields[TypeFunc::Parms+1] = TypeRawPtr::BOTTOM; \/\/ original load address\n-\n-  const TypeTuple *domain = TypeTuple::make(TypeFunc::Parms+2, fields);\n-\n-  \/\/ create result type (range)\n-  fields = TypeTuple::fields(1);\n-  fields[TypeFunc::Parms+0] = TypeOopPtr::BOTTOM;\n-  const TypeTuple *range = TypeTuple::make(TypeFunc::Parms+1, fields);\n-\n-  return TypeFunc::make(domain, range);\n-}\n-\n-static const TypeFunc* make_write_barrier_pre_Type() {\n-  const Type **fields = TypeTuple::fields(1);\n-  fields[TypeFunc::Parms+0] = TypeInstPtr::NOTNULL; \/\/ original field value\n-  const TypeTuple *domain = TypeTuple::make(TypeFunc::Parms+1, fields);\n-\n-  \/\/ create result type (range)\n-  fields = TypeTuple::fields(0);\n-  const TypeTuple *range = TypeTuple::make(TypeFunc::Parms+0, fields);\n-\n-  return TypeFunc::make(domain, range);\n-}\n-\n-static const TypeFunc* make_clone_barrier_Type() {\n-  const Type **fields = TypeTuple::fields(1);\n-  fields[TypeFunc::Parms+0] = TypeOopPtr::NOTNULL; \/\/ src oop\n-  const TypeTuple *domain = TypeTuple::make(TypeFunc::Parms+1, fields);\n-\n-  \/\/ create result type (range)\n-  fields = TypeTuple::fields(0);\n-  const TypeTuple *range = TypeTuple::make(TypeFunc::Parms+0, fields);\n-\n-  return TypeFunc::make(domain, range);\n-}\n-#endif \/\/INCLUDE_SHENANDOAHGC\n-\n@@ -2413,5 +2367,0 @@\n-#if INCLUDE_SHENANDOAHGC\n-  _load_reference_barrier_Type        = make_load_reference_barrier_Type();\n-  _write_barrier_pre_Type             = make_write_barrier_pre_Type();\n-  _clone_barrier_Type                 = make_clone_barrier_Type();\n-#endif \/\/ INCLUDE_SHENANDOAHGC\n","filename":"src\/hotspot\/share\/opto\/runtime.cpp","additions":0,"deletions":51,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -203,5 +203,0 @@\n-#if INCLUDE_SHENANDOAHGC\n-  static const TypeFunc* _load_reference_barrier_Type;\n-  static const TypeFunc* _write_barrier_pre_Type;\n-  static const TypeFunc* _clone_barrier_Type;\n-#endif \/\/INCLUDE_SHENANDOAHGC\n@@ -751,17 +746,0 @@\n-#if INCLUDE_SHENANDOAHGC\n-  static inline const TypeFunc *clone_barrier_Type() {\n-    assert(_clone_barrier_Type != nullptr, \"should be initialized\");\n-    return _clone_barrier_Type;\n-  }\n-\n-  static inline const TypeFunc *write_barrier_pre_Type() {\n-    assert(_write_barrier_pre_Type != nullptr, \"should be initialized\");\n-    return _write_barrier_pre_Type;\n-  }\n-\n-  static inline const TypeFunc* load_reference_barrier_Type() {\n-    assert(_load_reference_barrier_Type != nullptr, \"should be initialized\");\n-    return _load_reference_barrier_Type;\n-  }\n-#endif \/\/INCLUDE_SHENANDOAHGC\n-\n","filename":"src\/hotspot\/share\/opto\/runtime.hpp","additions":0,"deletions":22,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -31,0 +31,3 @@\n+#if INCLUDE_SHENANDOAHGC\n+#include \"gc\/shenandoah\/c2\/shenandoahBarrierSetC2.hpp\"\n+#endif \/\/ INCLUDE_SHENANDOAHGC\n@@ -733,0 +736,6 @@\n+#if INCLUDE_SHENANDOAHGC\n+  ShenandoahBarrierSetC2::make_write_barrier_pre_Type();\n+  ShenandoahBarrierSetC2::make_clone_barrier_Type();\n+  ShenandoahBarrierSetC2::make_load_reference_barrier_Type();\n+#endif \/\/INCLUDE_SHENANDOAHGC\n+\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"}]}