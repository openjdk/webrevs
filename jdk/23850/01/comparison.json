{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import java.util.HashSet;\n@@ -36,0 +37,2 @@\n+import java.lang.classfile.CodeTransform;\n+import java.lang.classfile.Label;\n@@ -37,0 +40,1 @@\n+import java.lang.classfile.instruction.LabelTarget;\n@@ -93,5 +97,13 @@\n-                        ClassTransform.transformingMethodBodies((cob, coe) -> {\n-                            if (coe instanceof BranchInstruction)\n-                                cob.invokestatic(CD_Cancel, \"stopCheck\", ConstantDescs.MTD_void);\n-                            cob.with(coe);\n-                        }));\n+                        ClassTransform.transformingMethodBodies(\n+                            CodeTransform.ofStateful(() -> {\n+                                HashSet<Label> priorLabels = new HashSet<>();\n+                                return (builder, element) -> {\n+                                    switch (element) {\n+                                    case LabelTarget target -> priorLabels.add(target.label());\n+                                    case BranchInstruction branch when priorLabels.contains(branch.target())\n+                                        -> builder.invokestatic(CD_Cancel, \"stopCheck\", ConstantDescs.MTD_void);\n+                                    default -> { }\n+                                    }\n+                                    builder.with(element);\n+                                };\n+                            })));\n","filename":"src\/jdk.jshell\/share\/classes\/jdk\/jshell\/execution\/LocalExecutionControl.java","additions":18,"deletions":6,"binary":false,"changes":24,"status":"modified"}]}