{"files":[{"patch":"@@ -937,1 +937,0 @@\n-    bool is_top_frame = true;\n@@ -940,1 +939,1 @@\n-      assert(is_top_frame == (frame_idx == 0), \"must be\");\n+      bool is_top_frame = (frame_idx == 0);\n@@ -955,0 +954,2 @@\n+        \/\/ We can only compute OopMaps for the before state, so we need to roll forward\n+        \/\/ to the next bytecode.\n@@ -971,0 +972,2 @@\n+        \/\/ Reflect the fact that we have rolled forward and now need\n+        \/\/ top_frame_expression_stack_adjustment\n@@ -993,3 +996,3 @@\n-      int map_expr_invoke_ssize = mask.expression_stack_size() + cur_invoke_parameter_size;\n-      int expr_ssize_before = iframe_expr_ssize + (is_top_frame ? top_frame_expression_stack_adjustment : 0);\n-      int map_expr_callee_ssize = mask.expression_stack_size() + callee_size_of_parameters;\n+      int oopmap_expr_invoke_ssize = mask.expression_stack_size() + cur_invoke_parameter_size;\n+      int expr_ssize_before = iframe_expr_ssize + top_frame_expression_stack_adjustment;\n+      int oopmap_expr_callee_ssize = mask.expression_stack_size() + callee_size_of_parameters;\n@@ -997,2 +1000,2 @@\n-            (reexecute ? expr_ssize_before == map_expr_invoke_ssize :\n-                         iframe_expr_ssize == map_expr_callee_ssize))) {\n+            (reexecute ? expr_ssize_before == oopmap_expr_invoke_ssize :\n+                         iframe_expr_ssize == oopmap_expr_callee_ssize))) {\n@@ -1009,1 +1012,3 @@\n-        tty->print_cr(\"  reexecute = %s\", reexecute ? \"true\" : \"false\");\n+        tty->print_cr(\"  original should_reexecute = %s\", el->should_reexecute() ? \"true\" : \"false\");\n+        tty->print_cr(\"  reexecute = %s%s\", reexecute ? \"true\" : \"false\",\n+                      (reexecute != el->should_reexecute()) ? \" (changed)\" : \"\");\n@@ -1023,1 +1028,0 @@\n-      is_top_frame = false;\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"}]}