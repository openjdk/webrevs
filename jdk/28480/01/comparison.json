{"files":[{"patch":"@@ -77,1 +77,1 @@\n-    public static boolean isQuicCompatible(SSLParameters parameters) {\n+    private static boolean isQuicCompatible(SSLParameters parameters) {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/net\/quic\/QuicTLSContext.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -56,0 +56,1 @@\n+import java.util.Arrays;\n@@ -128,0 +129,2 @@\n+    private final boolean hasRequiredH3TLS;\n+    private final boolean hasRequiredH2TLS;\n@@ -469,4 +472,11 @@\n-        boolean sslParamsSupportedForH3 = sslParams.getProtocols() == null\n-                || sslParams.getProtocols().length == 0\n-                || isQuicCompatible(sslParams);\n-        if (version == Version.HTTP_3 && !sslParamsSupportedForH3) {\n+        String[] sslProtocols = sslParams.getProtocols();\n+        if (sslProtocols == null) {\n+            sslProtocols = requireNonNullElseGet(sslContext.getDefaultSSLParameters().getProtocols(),\n+                    () -> new String[0]);\n+        }\n+        \/\/ HTTP\/3 MUST use TLS version 1.3 or higher\n+        hasRequiredH3TLS = Arrays.asList(sslProtocols).contains(\"TLSv1.3\");\n+        \/\/ HTTP\/2 MUST use TLS version 1.2 or higher for HTTP\/2 over TLS\n+        hasRequiredH2TLS = hasRequiredH3TLS || Arrays.asList(sslProtocols).contains(\"TLSv1.2\");\n+\n+        if (version == Version.HTTP_3 && !hasRequiredH3TLS) {\n@@ -499,1 +509,1 @@\n-        boolean h3Supported = sslCtxSupportedForH3 && sslParamsSupportedForH3;\n+        boolean h3Supported = sslCtxSupportedForH3 && hasRequiredH3TLS;\n@@ -518,0 +528,16 @@\n+    \/**\n+     * Returns true if the SSL parameter protocols contains at\n+     * least one TLS version that HTTP\/3 requires.\n+     *\/\n+    boolean hasRequiredHTTP3TLSVersion() {\n+        return hasRequiredH3TLS;\n+    }\n+\n+    \/**\n+     * Returns true if the SSL parameter protocols contains at\n+     * least one TLS version that HTTP\/2 requires.\n+     *\/\n+    boolean hasRequiredHTTP2TLSVersion() {\n+        return hasRequiredH2TLS;\n+    }\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/HttpClientImpl.java","additions":31,"deletions":5,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -35,1 +35,0 @@\n-import java.util.Arrays;\n@@ -46,2 +45,0 @@\n-import java.util.function.Predicate;\n-import java.net.http.HttpClient;\n@@ -288,17 +285,0 @@\n-    \/\/ HTTP\/2 MUST use TLS version 1.2 or higher for HTTP\/2 over TLS\n-    private static final Predicate<String> testRequiredHTTP2TLSVersion = proto ->\n-            proto.equals(\"TLSv1.2\") || proto.equals(\"TLSv1.3\");\n-\n-   \/**\n-    * Returns true if the given client's SSL parameter protocols contains at\n-    * least one TLS version that HTTP\/2 requires.\n-    *\/\n-   private static final boolean hasRequiredHTTP2TLSVersion(HttpClient client) {\n-       String[] protos = client.sslParameters().getProtocols();\n-       if (protos != null) {\n-           return Arrays.stream(protos).filter(testRequiredHTTP2TLSVersion).findAny().isPresent();\n-       } else {\n-           return false;\n-       }\n-   }\n-\n@@ -362,1 +342,1 @@\n-                if (version == HTTP_2 && hasRequiredHTTP2TLSVersion(client)) {\n+                if (version == HTTP_2 && client.hasRequiredHTTP2TLSVersion()) {\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/HttpConnection.java","additions":1,"deletions":21,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-import java.net.http.HttpClient;\n@@ -38,1 +37,0 @@\n-import java.util.Arrays;\n@@ -46,1 +44,0 @@\n-import java.util.function.Predicate;\n@@ -84,3 +81,0 @@\n-    \/\/ HTTP\/2 MUST use TLS version 1.3 or higher for HTTP\/3 over TLS\n-    private static final Predicate<String> testRequiredHTTP3TLSVersion = proto ->\n-            proto.equals(\"TLSv1.3\");\n@@ -181,13 +175,0 @@\n-    \/**\n-     * Returns true if the given client's SSL parameter protocols contains at\n-     * least one TLS version that HTTP\/3 requires.\n-     *\/\n-    private static boolean hasRequiredHTTP3TLSVersion(HttpClient client) {\n-        String[] protos = client.sslParameters().getProtocols();\n-        if (protos != null) {\n-            return Arrays.stream(protos).anyMatch(testRequiredHTTP3TLSVersion);\n-        } else {\n-            return false;\n-        }\n-    }\n-\n@@ -263,1 +244,1 @@\n-        if (proxy != null || !hasRequiredHTTP3TLSVersion(client)) {\n+        if (proxy != null || !client.hasRequiredHTTP3TLSVersion()) {\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/HttpQuicConnection.java","additions":1,"deletions":20,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -34,0 +34,2 @@\n+import javax.net.ssl.SSLParameters;\n+\n@@ -52,1 +54,1 @@\n- * @bug 8239594\n+ * @bug 8239594 8371887\n@@ -104,1 +106,1 @@\n-    public void testVersionProtocols(SSLContext context,\n+    public void testVersionProtocolsNoParams(SSLContext context,\n@@ -107,0 +109,16 @@\n+        runTest(context, version, expectedProtocol, false);\n+    }\n+\n+    \/**\n+     * Tests various scenarios between client and server tls handshake with valid http,\n+     * but with empty SSLParameters\n+     *\/\n+    @Test(dataProvider = \"scenarios\")\n+    public void testVersionProtocolsEmptyParams(SSLContext context,\n+                                             Version version,\n+                                             String expectedProtocol) throws Exception {\n+        runTest(context, version, expectedProtocol, true);\n+    }\n+\n+    private void runTest(SSLContext context, Version version, String expectedProtocol,\n+                         boolean setEmptyParams) throws Exception {\n@@ -114,0 +132,3 @@\n+        if (setEmptyParams) {\n+            builder.sslParameters(new SSLParameters());\n+        }\n@@ -115,1 +136,1 @@\n-                                      .build();\n+                .build();\n","filename":"test\/jdk\/java\/net\/httpclient\/TlsContextTest.java","additions":24,"deletions":3,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,1 @@\n- * @bug 8150769 8157107\n+ * @bug 8150769 8157107 8371887\n@@ -138,0 +138,6 @@\n+            success &= expectSuccess(\n+                    \"---\\nTest #5: empty SSL parameters, \"\n+                            + \"expect successful connection\",\n+                    () -> connect(uriString, new SSLParameters()));\n+            success &= checkProtocol(handler.getSSLSession(), expectedTLSVersion(null));\n+\n","filename":"test\/jdk\/java\/net\/httpclient\/http2\/TLSConnection.java","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+ * @bug 8371887\n@@ -78,0 +79,14 @@\n+\n+    \/**\n+     * Builds a HttpClient with SSLParameters without protocol versions\n+     * and expects the build() to succeed and return a HttpClient instance\n+     *\/\n+    @Test\n+    public void testDefault() throws Exception {\n+        final SSLParameters params = new SSLParameters();\n+        final HttpClient client = HttpServerAdapters.createClientBuilderForH3()\n+                .proxy(HttpClient.Builder.NO_PROXY)\n+                .sslParameters(params)\n+                .version(HttpClient.Version.HTTP_3).build();\n+        assertNotNull(client, \"HttpClient is null\");\n+    }\n","filename":"test\/jdk\/java\/net\/httpclient\/http3\/H3UnsupportedSSLParametersTest.java","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"}]}