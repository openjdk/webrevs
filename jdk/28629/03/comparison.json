{"files":[{"patch":"@@ -894,2 +894,12 @@\n-    \/\/ Upper bound for a single step shrink\n-    size_t max_shrink_bytes = SpaceAlignment;\n+    assert(old_gen()->capacity_in_bytes() >= old_gen()->min_gen_size(), \"inv\");\n+\n+    \/\/ Old gen min_gen_size constraint.\n+    const size_t max_shrink_bytes_gen_size_constraint = old_gen()->capacity_in_bytes() - old_gen()->min_gen_size();\n+\n+    \/\/ Per-step delta to avoid too aggressive shrinking.\n+    const size_t max_shrink_bytes_per_step_constraint = SpaceAlignment;\n+\n+    \/\/ Combining the above two constraints.\n+    const size_t max_shrink_bytes = MIN2(max_shrink_bytes_gen_size_constraint,\n+                                         max_shrink_bytes_per_step_constraint);\n+\n@@ -897,0 +907,4 @@\n+\n+    assert(old_gen()->capacity_in_bytes() >= shrink_bytes, \"inv\");\n+    assert(old_gen()->capacity_in_bytes() - shrink_bytes >= old_gen()->min_gen_size(), \"inv\");\n+\n","filename":"src\/hotspot\/share\/gc\/parallel\/parallelScavengeHeap.cpp","additions":16,"deletions":2,"binary":false,"changes":18,"status":"modified"}]}