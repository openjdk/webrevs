{"files":[{"patch":"@@ -38,1 +38,1 @@\n-#ifdef __APPLE__\n+#if defined(__APPLE__) && defined(VM_MAKE_TAG) && defined(VM_MEMORY_JAVA)\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -106,6 +106,0 @@\n-  #ifdef __APPLE__\n-    \/\/ Validate BSD memory tagging for os::commit_memory path (covers pd_* functions)\n-    EXPECT_TRUE(GtestUtils::is_memory_tagged_as_java(_reserved, ZGranuleSize))\n-      << \"Memory allocated via os::commit_memory should be tagged with VM_MEMORY_JAVA on macOS\";\n-  #endif\n-\n@@ -237,8 +231,0 @@\n-#ifdef __APPLE__\n-    \/\/ Validate BSD memory tagging for ZGC allocation path (covers ZPhysicalMemoryBacking functions)\n-    if (!is_null(object)) {\n-      EXPECT_TRUE(GtestUtils::is_memory_tagged_as_java((void*)untype(object), object_size))\n-        << \"ZGC object allocation should be tagged with VM_MEMORY_JAVA on macOS\";\n-    }\n-#endif\n-\n","filename":"test\/hotspot\/gtest\/gc\/z\/test_zForwarding.cpp","additions":0,"deletions":14,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -739,6 +739,0 @@\n-\n-#ifdef __APPLE__\n-    \/\/ Validate BSD memory tagging for JVM-allocated memory\n-    EXPECT_TRUE(GtestUtils::is_memory_tagged_as_java(p, 1 * M))\n-      << \"JVM memory allocated via os::reserve_memory should be tagged with VM_MEMORY_JAVA on macOS\";\n-#endif\n@@ -1117,6 +1111,0 @@\n-#ifdef __APPLE__\n-  \/\/ Validate BSD memory tagging for JVM-allocated memory\n-  EXPECT_TRUE(GtestUtils::is_memory_tagged_as_java(base, size))\n-    << \"JVM memory allocated via os::reserve_memory should be tagged with VM_MEMORY_JAVA on macOS\";\n-#endif\n-\n@@ -1146,6 +1134,0 @@\n-#ifdef __APPLE__\n-  \/\/ Validate BSD memory tagging for JVM-allocated memory\n-  EXPECT_TRUE(GtestUtils::is_memory_tagged_as_java(base, size))\n-    << \"JVM memory allocated via os::reserve_memory should be tagged with VM_MEMORY_JAVA on macOS\";\n-#endif\n-\n@@ -1217,0 +1199,20 @@\n+\n+#if defined(__APPLE__) && defined(VM_MAKE_TAG) && defined(VM_MEMORY_JAVA)\n+\/\/ Test that JVM-allocated memory is properly tagged with VM_MEMORY_JAVA on macOS\n+\/\/ for proper memory accounting and debugging capabilities.\n+TEST_VM(os, memory_tagging_validation) {\n+  const size_t size = 1 * M;\n+\n+  \/\/ Reserve and commit memory through standard JVM allocation path\n+  char* memory = os::reserve_memory(size, mtTest);\n+  ASSERT_NOT_NULL(memory);\n+  ASSERT_TRUE(os::commit_memory(memory, size, false));\n+\n+  \/\/ Verify the memory is tagged with VM_MEMORY_JAVA\n+  EXPECT_TRUE(GtestUtils::is_memory_tagged_as_java(memory, size))\n+    << \"JVM memory should be tagged with VM_MEMORY_JAVA on macOS\";\n+\n+  \/\/ Clean up\n+  os::release_memory(memory, size);\n+}\n+#endif \/\/ defined(__APPLE__) && defined(VM_MAKE_TAG) && defined(VM_MEMORY_JAVA)\n","filename":"test\/hotspot\/gtest\/runtime\/test_os.cpp","additions":20,"deletions":18,"binary":false,"changes":38,"status":"modified"}]}