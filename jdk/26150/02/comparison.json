{"files":[{"patch":"@@ -63,1 +63,1 @@\n-  address reloc_destination(address orig_address);\n+  address reloc_destination();\n@@ -69,1 +69,1 @@\n-  bool set_destination_mt_safe(address dest, bool assert_lock = true);\n+  bool set_destination_mt_safe(address dest);\n@@ -91,1 +91,1 @@\n-  assert(cb && cb->is_nmethod(), \"sanity\");\n+  assert(cb != nullptr && cb->is_nmethod(), \"nmethod expected\");\n@@ -99,1 +99,1 @@\n-address NativeFarCall::reloc_destination(address orig_address) {\n+address NativeFarCall::reloc_destination() {\n@@ -101,0 +101,1 @@\n+  assert(NativeFarCall::is_at(call_addr), \"unexpected code at call site\");\n@@ -103,6 +104,1 @@\n-  assert(code != nullptr, \"Could not find the containing code blob\");\n-\n-  address stub_addr = nullptr;\n-  if (code != nullptr && code->is_nmethod()) {\n-    stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, (nmethod*)code);\n-  }\n+  assert(code != nullptr && code->is_nmethod(), \"nmethod expected\");\n@@ -110,0 +106,1 @@\n+  address stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, code->as_nmethod());\n@@ -113,0 +110,1 @@\n+\n@@ -131,1 +129,1 @@\n-bool NativeFarCall::set_destination_mt_safe(address dest, bool assert_lock) {\n+bool NativeFarCall::set_destination_mt_safe(address dest) {\n@@ -133,2 +131,1 @@\n-  assert(!assert_lock ||\n-         (CodeCache_lock->is_locked() || SafepointSynchronize::is_at_safepoint()) ||\n+  assert((CodeCache_lock->is_locked() || SafepointSynchronize::is_at_safepoint()) ||\n@@ -138,3 +135,0 @@\n-  address call_addr = addr_at(0);\n-  assert(NativeFarCall::is_at(call_addr), \"unexpected code at call site\");\n-\n@@ -142,1 +136,0 @@\n-\n@@ -159,2 +152,2 @@\n-  if (code != nullptr && code->is_nmethod()) {\n-    stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, (nmethod*)code);\n+  if (code->is_nmethod()) {\n+    stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, code->as_nmethod());\n@@ -162,1 +155,0 @@\n-\n@@ -212,1 +204,1 @@\n-      (MacroAssembler::extract_rd(addr + 2 * instr_size)  == x1)) {\n+      (MacroAssembler::extract_rd(addr + 2 * instr_size)   == x1)) {\n@@ -241,2 +233,2 @@\n-address NativeCall::reloc_destination(address orig_address) {\n-  return NativeFarCall::at(addr_at(0))->reloc_destination(orig_address);\n+address NativeCall::reloc_destination() {\n+  return NativeFarCall::at(addr_at(0))->reloc_destination();\n@@ -257,2 +249,2 @@\n-bool NativeCall::set_destination_mt_safe(address dest, bool assert_lock) {\n-  return NativeFarCall::at(addr_at(0))->set_destination_mt_safe(dest, assert_lock);\n+bool NativeCall::set_destination_mt_safe(address dest) {\n+  return NativeFarCall::at(addr_at(0))->set_destination_mt_safe(dest);\n","filename":"src\/hotspot\/cpu\/riscv\/nativeInst_riscv.cpp","additions":17,"deletions":25,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -137,1 +137,1 @@\n-  address reloc_destination(address orig_address);\n+  address reloc_destination();\n@@ -144,1 +144,1 @@\n-  bool set_destination_mt_safe(address dest, bool assert_lock = true);\n+  bool set_destination_mt_safe(address dest);\n","filename":"src\/hotspot\/cpu\/riscv\/nativeInst_riscv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -75,7 +75,6 @@\n-  assert(is_call(), \"should be an address instruction here\");\n-  if (NativeCall::is_at(addr())) {\n-    return nativeCall_at(addr())->reloc_destination(orig_addr);\n-  }\n-  \/\/ Non call reloc\n-  if (orig_addr != nullptr) {\n-    \/\/ the extracted address from the instructions in address orig_addr\n+  assert(is_call(), \"should be a call here\");\n+  if (orig_addr == nullptr) {\n+    if (NativeCall::is_at(addr())) {\n+      return nativeCall_at(addr())->reloc_destination();\n+    }\n+  } else {\n@@ -94,1 +93,1 @@\n-  assert(is_call(), \"should be an address instruction here\");\n+  assert(is_call(), \"should be a call here\");\n@@ -96,4 +95,5 @@\n-    NativeCall* nc = nativeCall_at(addr());\n-    if (nc->reloc_set_destination(x)) {\n-      return;\n-    }\n+    NativeCall* call = nativeCall_at(addr());\n+    call->reloc_set_destination(x);\n+  } else {\n+    MacroAssembler::pd_patch_instruction_size(addr(), x);\n+    assert(pd_call_destination(addr()) == x, \"fail in reloc\");\n@@ -101,3 +101,0 @@\n-  MacroAssembler::pd_patch_instruction_size(addr(), x);\n-  address pd_call = pd_call_destination(addr());\n-  assert(pd_call == x, \"fail in reloc\");\n","filename":"src\/hotspot\/cpu\/riscv\/relocInfo_riscv.cpp","additions":12,"deletions":15,"binary":false,"changes":27,"status":"modified"}]}