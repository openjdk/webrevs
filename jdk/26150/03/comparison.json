{"files":[{"patch":"@@ -63,1 +63,1 @@\n-  address reloc_destination(address orig_address);\n+  address reloc_destination();\n@@ -69,1 +69,1 @@\n-  bool set_destination_mt_safe(address dest, bool assert_lock = true);\n+  bool set_destination_mt_safe(address dest);\n@@ -91,1 +91,1 @@\n-  assert(cb && cb->is_nmethod(), \"sanity\");\n+  assert(cb != nullptr && cb->is_nmethod(), \"nmethod expected\");\n@@ -99,1 +99,1 @@\n-address NativeFarCall::reloc_destination(address orig_address) {\n+address NativeFarCall::reloc_destination() {\n@@ -101,0 +101,1 @@\n+  assert(NativeFarCall::is_at(call_addr), \"unexpected code at call site\");\n@@ -106,2 +107,2 @@\n-  if (code != nullptr && code->is_nmethod()) {\n-    stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, (nmethod*)code);\n+  if (code->is_nmethod()) {\n+    stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, code->as_nmethod());\n@@ -113,0 +114,1 @@\n+\n@@ -131,1 +133,1 @@\n-bool NativeFarCall::set_destination_mt_safe(address dest, bool assert_lock) {\n+bool NativeFarCall::set_destination_mt_safe(address dest) {\n@@ -133,2 +135,1 @@\n-  assert(!assert_lock ||\n-         (CodeCache_lock->is_locked() || SafepointSynchronize::is_at_safepoint()) ||\n+  assert((CodeCache_lock->is_locked() || SafepointSynchronize::is_at_safepoint()) ||\n@@ -138,3 +139,0 @@\n-  address call_addr = addr_at(0);\n-  assert(NativeFarCall::is_at(call_addr), \"unexpected code at call site\");\n-\n@@ -142,1 +140,0 @@\n-\n@@ -159,2 +156,2 @@\n-  if (code != nullptr && code->is_nmethod()) {\n-    stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, (nmethod*)code);\n+  if (code->is_nmethod()) {\n+    stub_addr = trampoline_stub_Relocation::get_trampoline_for(call_addr, code->as_nmethod());\n@@ -162,1 +159,0 @@\n-\n@@ -212,1 +208,1 @@\n-      (MacroAssembler::extract_rd(addr + 2 * instr_size)  == x1)) {\n+      (MacroAssembler::extract_rd(addr + 2 * instr_size)   == x1)) {\n@@ -241,2 +237,2 @@\n-address NativeCall::reloc_destination(address orig_address) {\n-  return NativeFarCall::at(addr_at(0))->reloc_destination(orig_address);\n+address NativeCall::reloc_destination() {\n+  return NativeFarCall::at(addr_at(0))->reloc_destination();\n@@ -257,2 +253,2 @@\n-bool NativeCall::set_destination_mt_safe(address dest, bool assert_lock) {\n-  return NativeFarCall::at(addr_at(0))->set_destination_mt_safe(dest, assert_lock);\n+bool NativeCall::set_destination_mt_safe(address dest) {\n+  return NativeFarCall::at(addr_at(0))->set_destination_mt_safe(dest);\n","filename":"src\/hotspot\/cpu\/riscv\/nativeInst_riscv.cpp","additions":17,"deletions":21,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -137,1 +137,1 @@\n-  address reloc_destination(address orig_address);\n+  address reloc_destination();\n@@ -144,1 +144,1 @@\n-  bool set_destination_mt_safe(address dest, bool assert_lock = true);\n+  bool set_destination_mt_safe(address dest);\n","filename":"src\/hotspot\/cpu\/riscv\/nativeInst_riscv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -75,1 +75,1 @@\n-  assert(is_call(), \"should be an address instruction here\");\n+  assert(is_call(), \"should be a call here\");\n@@ -77,1 +77,1 @@\n-    return nativeCall_at(addr())->reloc_destination(orig_addr);\n+    return nativeCall_at(addr())->reloc_destination();\n@@ -79,1 +79,1 @@\n-  \/\/ Non call reloc\n+\n@@ -81,1 +81,0 @@\n-    \/\/ the extracted address from the instructions in address orig_addr\n@@ -90,0 +89,1 @@\n+\n@@ -94,1 +94,1 @@\n-  assert(is_call(), \"should be an address instruction here\");\n+  assert(is_call(), \"should be a call here\");\n@@ -96,4 +96,5 @@\n-    NativeCall* nc = nativeCall_at(addr());\n-    if (nc->reloc_set_destination(x)) {\n-      return;\n-    }\n+    NativeCall* call = nativeCall_at(addr());\n+    call->reloc_set_destination(x);\n+  } else {\n+    MacroAssembler::pd_patch_instruction_size(addr(), x);\n+    assert(pd_call_destination(addr()) == x, \"fail in reloc\");\n@@ -101,3 +102,0 @@\n-  MacroAssembler::pd_patch_instruction_size(addr(), x);\n-  address pd_call = pd_call_destination(addr());\n-  assert(pd_call == x, \"fail in reloc\");\n","filename":"src\/hotspot\/cpu\/riscv\/relocInfo_riscv.cpp","additions":10,"deletions":12,"binary":false,"changes":22,"status":"modified"}]}