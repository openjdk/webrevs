{"files":[{"patch":"@@ -140,0 +140,4 @@\n+            } else {\n+                J2dTraceLn1(J2D_TRACE_WARNING,\n+                       \"CreateDC failed, so we cannot store the DC for later usage, mieInfo.szDevice is %S\",\n+                       mieInfo.szDevice);\n@@ -141,0 +145,2 @@\n+        } else {\n+            J2dTraceLn(J2D_TRACE_WARNING, \"GetMonitorInfo failed, so we cannot create the DC as well\");\n@@ -182,2 +188,16 @@\n-    HBITMAP hBM = ::CreateCompatibleBitmap(hBMDC, 1, 1);\n-    VERIFY(::GetDIBits(hBMDC, hBM, 0, 1, NULL, gpBitmapInfo, DIB_RGB_COLORS));\n+    HBITMAP hBM = NULL;\n+    if (hBMDC == NULL) {\n+        J2dTraceLn(J2D_TRACE_WARNING, \"AwtWin32GraphicsDevice::Initialize GetDC failed\");\n+    } else {\n+        hBM = ::CreateCompatibleBitmap(hBMDC, 1, 1);\n+        if (hBM == NULL) {\n+            J2dTraceLn(J2D_TRACE_WARNING, \"AwtWin32GraphicsDevice::Initialize CreateCompatibleBitmap failed\");\n+        }\n+    }\n+\n+    bool cbf = false;\n+    if (hBM != NULL) {\n+        if (::GetDIBits(hBMDC, hBM, 0, 1, NULL, gpBitmapInfo, DIB_RGB_COLORS) == 0) {\n+            cbf = true;\n+        }\n+    }\n@@ -192,1 +212,1 @@\n-            if (::GetDIBits(hBMDC, hBM, 0, 1, &foo, gpBitmapInfo,\n+            if (cbf || ::GetDIBits(hBMDC, hBM, 0, 1, &foo, gpBitmapInfo,\n@@ -296,2 +316,2 @@\n-    VERIFY(::DeleteObject(hBM));\n-    VERIFY(::DeleteDC(hBMDC));\n+    if (hBM != NULL) { VERIFY(::DeleteObject(hBM)); }\n+    if (hBMDC != NULL) { VERIFY(::DeleteDC(hBMDC)); }\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Win32GraphicsDevice.cpp","additions":25,"deletions":5,"binary":false,"changes":30,"status":"modified"}]}