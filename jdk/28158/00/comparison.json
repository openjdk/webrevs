{"files":[{"patch":"@@ -35,0 +35,1 @@\n+    \/* -- Legacy empty path behavior -- *\/\n@@ -36,1 +37,7 @@\n-    \/* -- Current Working Directory --*\/\n+    private static final String FAIL_IF_EMPTY_PATH_PROPERTY =\n+        \"jdk.io.File.failIfEmptyPath\";\n+\n+    protected static final boolean FAIL_IF_EMPTY_PATH =\n+        Boolean.getBoolean(FAIL_IF_EMPTY_PATH_PROPERTY);\n+\n+    \/* -- Current Working Directory -- *\/\n","filename":"src\/java.base\/share\/classes\/java\/io\/FileSystem.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -37,0 +37,3 @@\n+        if (FAIL_IF_EMPTY_PATH)\n+            return path;\n+\n@@ -41,0 +44,3 @@\n+        if (FAIL_IF_EMPTY_PATH)\n+            return file;\n+\n","filename":"src\/java.base\/unix\/classes\/java\/io\/UnixFileSystem.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -86,0 +86,3 @@\n+        if (FAIL_IF_EMPTY_PATH)\n+            return path;\n+\n@@ -90,0 +93,3 @@\n+        if (FAIL_IF_EMPTY_PATH)\n+            return file;\n+\n","filename":"src\/java.base\/windows\/classes\/java\/io\/WinNTFileSystem.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -25,1 +25,1 @@\n- * @bug 4842706 8024695 8361587 8362429\n+ * @bug 4842706 8024695 8361587 8362429 8370216\n@@ -28,0 +28,1 @@\n+ * @run junit\/othervm -Djdk.io.File.failIfEmptyPath=true EmptyPath\n@@ -50,0 +51,1 @@\n+import org.junit.jupiter.api.condition.DisabledIf;\n@@ -58,0 +60,2 @@\n+    static boolean failIfEmptyPath;\n+\n@@ -63,0 +67,1 @@\n+        failIfEmptyPath = Boolean.getBoolean(\"jdk.io.File.failIfEmptyPath\");\n@@ -67,0 +72,4 @@\n+    private boolean failIfEmptyPath() {\n+        return failIfEmptyPath;\n+    }\n+\n@@ -69,1 +78,1 @@\n-        assertTrue(f.canExecute());\n+        assertNotEquals(failIfEmptyPath, f.canExecute());\n@@ -74,1 +83,1 @@\n-        assertTrue(f.canRead());\n+        assertNotEquals(failIfEmptyPath, f.canRead());\n@@ -79,1 +88,1 @@\n-        assertTrue(f.canWrite());\n+        assertNotEquals(failIfEmptyPath, f.canWrite());\n@@ -110,1 +119,1 @@\n-        assertTrue(f.exists());\n+        assertNotEquals(failIfEmptyPath, f.exists());\n@@ -145,2 +154,6 @@\n-        FileStore fs = Files.getFileStore(f.toPath());\n-        checkSpace(fs.getUnallocatedSpace(), f.getFreeSpace());\n+        if (failIfEmptyPath)\n+            assertEquals(0, f.getFreeSpace());\n+        else {\n+            FileStore fs = Files.getFileStore(f.toPath());\n+            checkSpace(fs.getUnallocatedSpace(), f.getFreeSpace());\n+        }\n@@ -171,2 +184,6 @@\n-        FileStore fs = Files.getFileStore(f.toPath());\n-        checkSpace(fs.getTotalSpace(), f.getTotalSpace());\n+        if (failIfEmptyPath)\n+            assertEquals(0, f.getTotalSpace());\n+        else {\n+            FileStore fs = Files.getFileStore(f.toPath());\n+            checkSpace(fs.getTotalSpace(), f.getTotalSpace());\n+        }\n@@ -177,2 +194,6 @@\n-        FileStore fs = Files.getFileStore(f.toPath());\n-        checkSpace(fs.getUsableSpace(), f.getUsableSpace());\n+        if (failIfEmptyPath)\n+            assertEquals(0, f.getTotalSpace());\n+        else {\n+            FileStore fs = Files.getFileStore(f.toPath());\n+            checkSpace(fs.getUsableSpace(), f.getUsableSpace());\n+        }\n@@ -193,1 +214,1 @@\n-        assertTrue(f.isDirectory());\n+        assertNotEquals(failIfEmptyPath, f.isDirectory());\n@@ -208,1 +229,4 @@\n-        assertTrue(f.lastModified() > 0);\n+        if (failIfEmptyPath)\n+            assertEquals(0, f.lastModified());\n+        else\n+            assertTrue(f.lastModified() > 0);\n@@ -213,1 +237,4 @@\n-        assertEquals(Files.size(f.toPath()), f.length());\n+        if (failIfEmptyPath)\n+            assertEquals(0, f.length());\n+        else\n+            assertEquals(Files.size(f.toPath()), f.length());\n@@ -218,1 +245,4 @@\n-        list(f.list());\n+        if (failIfEmptyPath)\n+            assertNull(f.list());\n+        else\n+            list(f.list());\n@@ -223,1 +253,4 @@\n-        list(f.list((FilenameFilter)null));\n+        if (failIfEmptyPath)\n+            assertNull(f.list((FilenameFilter)null));\n+        else\n+            list(f.list((FilenameFilter)null));\n@@ -236,1 +269,4 @@\n-        listFiles(x -> x.listFiles());\n+        if (failIfEmptyPath)\n+            assertNull(f.listFiles());\n+        else\n+            listFiles(x -> x.listFiles());\n@@ -244,1 +280,4 @@\n-        listFiles(x -> x.listFiles(ff));\n+        if (failIfEmptyPath)\n+            assertNull(f.listFiles(ff));\n+        else\n+            listFiles(x -> x.listFiles(ff));\n@@ -249,1 +288,4 @@\n-        listFiles(x -> x.listFiles((FileFilter)null));\n+        if (failIfEmptyPath)\n+            assertNull(f.listFiles((FileFilter)null));\n+        else\n+            listFiles(x -> x.listFiles((FileFilter)null));\n@@ -257,1 +299,4 @@\n-        listFiles(x -> x.listFiles(fnf));\n+        if (failIfEmptyPath)\n+            assertNull(f.listFiles(fnf));\n+        else\n+            listFiles(x -> x.listFiles(fnf));\n@@ -262,1 +307,4 @@\n-        listFiles(x -> x.listFiles((FilenameFilter)null));\n+        if (failIfEmptyPath)\n+            assertNull(f.listFiles((FilenameFilter)null));\n+        else\n+            listFiles(x -> x.listFiles((FilenameFilter)null));\n@@ -320,7 +368,13 @@\n-        try {\n-            assertTrue(f.setLastModified(t));\n-            assertEquals(t, f.lastModified());\n-            assertTrue(f.setLastModified(t0));\n-            assertEquals(t0, f.lastModified());\n-        } finally {\n-            f.setLastModified(t0);\n+        if (failIfEmptyPath) {\n+            assertEquals(0, t0);\n+            assertFalse(f.setLastModified(t));\n+            assertEquals(0, f.lastModified());\n+        } else {\n+            try {\n+                assertTrue(f.setLastModified(t));\n+                assertEquals(t, f.lastModified());\n+                assertTrue(f.setLastModified(t0));\n+                assertEquals(t0, f.lastModified());\n+            } finally {\n+                f.setLastModified(t0);\n+            }\n@@ -337,3 +391,3 @@\n-        assertTrue(f.canRead());\n-        try {\n-            assertTrue(f.setReadable(false));\n+        if (failIfEmptyPath) {\n+            assertFalse(f.canRead());\n+            assertFalse(f.setReadable(false));\n@@ -341,1 +395,3 @@\n-            assertTrue(f.setReadable(true));\n+            assertFalse(f.setReadable(true));\n+            assertFalse(f.canRead());\n+        } else {\n@@ -343,2 +399,8 @@\n-        } finally {\n-            f.setReadable(true);\n+            try {\n+                assertTrue(f.setReadable(false));\n+                assertFalse(f.canRead());\n+                assertTrue(f.setReadable(true));\n+                assertTrue(f.canRead());\n+            } finally {\n+                f.setReadable(true);\n+            }\n@@ -351,6 +413,8 @@\n-        assertTrue(f.canExecute());\n-        assertTrue(f.canRead());\n-        assertTrue(f.canWrite());\n-        try {\n-            assertTrue(f.setReadOnly());\n-            assertTrue(f.canRead());\n+        if (failIfEmptyPath) {\n+            assertFalse(f.canExecute());\n+            assertFalse(f.canRead());\n+            assertFalse(f.canWrite());\n+            assertFalse(f.setReadOnly());\n+            assertFalse(f.canRead());\n+            assertFalse(f.canWrite());\n+            assertFalse(f.setWritable(true, true));\n@@ -358,1 +422,3 @@\n-            assertTrue(f.setWritable(true, true));\n+        } else {\n+            assertTrue(f.canExecute());\n+            assertTrue(f.canRead());\n@@ -360,2 +426,9 @@\n-        } finally {\n-            f.setWritable(true, true);\n+            try {\n+                assertTrue(f.setReadOnly());\n+                assertTrue(f.canRead());\n+                assertFalse(f.canWrite());\n+                assertTrue(f.setWritable(true, true));\n+                assertTrue(f.canWrite());\n+            } finally {\n+                f.setWritable(true, true);\n+            }\n@@ -368,3 +441,3 @@\n-        assertTrue(f.canWrite());\n-        try {\n-            assertTrue(f.setWritable(false, true));\n+        if (failIfEmptyPath) {\n+            assertFalse(f.canWrite());\n+            assertFalse(f.setWritable(false, true));\n@@ -372,1 +445,3 @@\n-            assertTrue(f.setWritable(true, true));\n+            assertFalse(f.setWritable(true, true));\n+            assertFalse(f.canWrite());\n+        } else {\n@@ -374,2 +449,8 @@\n-        } finally {\n-            f.setWritable(true, true);\n+            try {\n+                assertTrue(f.setWritable(false, true));\n+                assertFalse(f.canWrite());\n+                assertTrue(f.setWritable(true, true));\n+                assertTrue(f.canWrite());\n+            } finally {\n+                f.setWritable(true, true);\n+            }\n@@ -394,0 +475,1 @@\n+    @DisabledIf(\"failIfEmptyPath\")\n","filename":"test\/jdk\/java\/io\/File\/EmptyPath.java","additions":131,"deletions":49,"binary":false,"changes":180,"status":"modified"}]}