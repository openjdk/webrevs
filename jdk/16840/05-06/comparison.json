{"files":[{"patch":"@@ -2109,0 +2109,7 @@\n+\n+      \/\/ Lock to read ProfileData, and ensure lock is not broken by a safepoint\n+      \/\/ We must do this already now, since we cannot acquire this lock while\n+      \/\/ holding the tty lock (lock ordering by rank).\n+      MutexLocker ml(trap_mdo->extra_data_lock(), Mutex::_no_safepoint_check_flag);\n+      NoSafepointVerifier no_safepoint;\n+\n@@ -2110,0 +2117,1 @@\n+\n@@ -2145,9 +2153,4 @@\n-        int dos = 0;\n-        {\n-          \/\/ Lock to read ProfileData, and ensure lock is not broken by a safepoint\n-          MutexLocker ml(trap_mdo->extra_data_lock(), Mutex::_no_safepoint_check_flag);\n-          NoSafepointVerifier no_safepoint;\n-\n-          ProfileData* pdata = trap_mdo->bci_to_data(trap_bci);\n-          dos = (pdata == nullptr)? 0: pdata->trap_state();\n-        }\n+        \/\/ We need to lock to read the ProfileData. But to keep the locks ordered, we need to\n+        \/\/ lock extra_data_lock before the tty lock.\n+        ProfileData* pdata = trap_mdo->bci_to_data(trap_bci);\n+        int dos = (pdata == nullptr)? 0: pdata->trap_state();\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":12,"deletions":9,"binary":false,"changes":21,"status":"modified"}]}