{"files":[{"patch":"@@ -1434,1 +1434,1 @@\n-ProfileData* MethodData::bci_to_extra_data_helper(int bci, Method* m, DataLayout*& dp, bool concurrent) {\n+ProfileData* MethodData::bci_to_extra_data_find(int bci, Method* m, DataLayout*& dp) {\n@@ -1457,3 +1457,0 @@\n-        \/\/ data->method() may be null in case of a concurrent\n-        \/\/ allocation. Maybe it's for the same method. Try to use that\n-        \/\/ entry in that case.\n@@ -1461,4 +1458,2 @@\n-          if (data->method() == nullptr) {\n-            assert(concurrent, \"impossible because no concurrent allocation\");\n-            return nullptr;\n-          } else if (data->method() == m) {\n+          assert(data->method() == nullptr, \"method must be set\");\n+          if (data->method() == m) {\n@@ -1495,5 +1490,3 @@\n-  \/\/ Allocation in the extra data space has to be atomic because not\n-  \/\/ all entries have the same size and non atomic concurrent\n-  \/\/ allocation would result in a corrupted extra data space.\n-  ProfileData* result = bci_to_extra_data_helper(bci, m, dp, true);\n-  if (result != nullptr) {\n+  \/\/ Find if already exists\n+  ProfileData* result = bci_to_extra_data_find(bci, m, dp);\n+  if (result != nullptr || dp >= end) {\n@@ -1503,12 +1496,2 @@\n-  if (create_if_missing && dp < end) {\n-    \/\/ TODO lock is not useless, since we require lock at the beginning of the method.\n-    \/\/ \/\/ Check again now that we have the lock. Another thread may\n-    \/\/ \/\/ have added extra data entries. Do it re-entrant in case\n-    \/\/ \/\/ we already have the lock further up.\n-    \/\/ ConditionalMutexLocker ml(extra_data_lock(), !extra_data_lock()->owned_by_self());\n-    \/\/ Mutex::_no_safepoint_check_flag\n-    ProfileData* result = bci_to_extra_data_helper(bci, m, dp, false);\n-    if (result != nullptr || dp >= end) {\n-      return result;\n-    }\n-\n+  if (create_if_missing) {\n+    \/\/ Not found -> Allocate\n","filename":"src\/hotspot\/share\/oops\/methodData.cpp","additions":8,"deletions":25,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2173,1 +2173,1 @@\n-  ProfileData* bci_to_extra_data_helper(int bci, Method* m, DataLayout*& dp, bool concurrent);\n+  ProfileData* bci_to_extra_data_find(int bci, Method* m, DataLayout*& dp);\n","filename":"src\/hotspot\/share\/oops\/methodData.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}