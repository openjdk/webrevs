{"files":[{"patch":"@@ -2330,0 +2330,7 @@\n+\n+    \/\/ Lock to read ProfileData, and ensure lock is not broken by a safepoint\n+    ConditionalMutexLocker ml((trap_mdo != nullptr) ? trap_mdo->extra_data_lock() : nullptr,\n+                              (trap_mdo != nullptr),\n+                              Mutex::_no_safepoint_check_flag);\n+    NoSafepointVerifier no_safepoint;\n+    ProfileData* pdata = nullptr;\n@@ -2336,5 +2343,1 @@\n-      \/\/ Lock to read ProfileData, and ensure lock is not broken by a safepoint\n-      MutexLocker ml(trap_mdo->extra_data_lock(), Mutex::_no_safepoint_check_flag);\n-      NoSafepointVerifier no_safepoint;\n-\n-      ProfileData* pdata = query_update_method_data(trap_mdo, trap_bci, reason, true,\n+      pdata = query_update_method_data(trap_mdo, trap_bci, reason, true,\n@@ -2406,9 +2409,0 @@\n-\n-      if (make_not_entrant && pdata != nullptr) {\n-        \/\/ Record the recompilation event, if any.\n-        int tstate0 = pdata->trap_state();\n-        int tstate1 = trap_state_set_recompiled(tstate0, true);\n-        if (tstate1 != tstate0) {\n-          pdata->set_trap_state(tstate1);\n-        }\n-      }\n@@ -2425,0 +2419,8 @@\n+      if (pdata != nullptr) {\n+        \/\/ Record the recompilation event, if any.\n+        int tstate0 = pdata->trap_state();\n+        int tstate1 = trap_state_set_recompiled(tstate0, true);\n+        if (tstate1 != tstate0)\n+          pdata->set_trap_state(tstate1);\n+      }\n+\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":16,"deletions":14,"binary":false,"changes":30,"status":"modified"}]}