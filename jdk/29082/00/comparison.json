{"files":[{"patch":"@@ -29,0 +29,3 @@\n+#include \"memory\/allocation.hpp\"\n+#include \"memory\/arena.hpp\"\n+#include \"memory\/resourceArea.hpp\"\n@@ -461,1 +464,2 @@\n-  RBTree() : BaseType(), _allocator() {}\n+  template<typename... AllocArgs>\n+  RBTree(AllocArgs... alloc_args) : BaseType(), _allocator(alloc_args...) {}\n@@ -583,0 +587,25 @@\n+template <AllocFailType strategy>\n+class RBTreeArenaAllocator {\n+  Arena* _arena;\n+public:\n+  RBTreeArenaAllocator(Arena* arena) : _arena(arena) {}\n+\n+  void* allocate(size_t sz) {\n+    return _arena->Amalloc(sz, strategy);\n+  }\n+  void free(void* ptr) { \/* NOP *\/ }\n+};\n+\n+template <AllocFailType strategy>\n+class RBTreeResourceAreaAllocator {\n+  ResourceArea* _rarea;\n+public:\n+  RBTreeResourceAreaAllocator(ResourceArea* rarea) : _rarea(rarea) {}\n+  void* allocate(size_t sz) {\n+    return _rarea->Amalloc(sz, strategy);\n+  }\n+  void free(void* ptr) { \/* NOP *\/ }\n+};\n+\n+\n+\n@@ -586,0 +615,6 @@\n+template <typename K, typename V, typename COMPARATOR, AllocFailType strategy = AllocFailStrategy::EXIT_OOM>\n+using RBTreeArena = RBTree<K, V, COMPARATOR, RBTreeArenaAllocator<strategy>>;\n+\n+template <typename K, typename V, typename COMPARATOR, AllocFailType strategy = AllocFailStrategy::EXIT_OOM>\n+using RBTreeResourceArea = RBTree<K, V, COMPARATOR, RBTreeResourceAreaAllocator<strategy>>;\n+\n","filename":"src\/hotspot\/share\/utilities\/rbTree.hpp","additions":36,"deletions":1,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -1255,0 +1255,14 @@\n+\n+TEST_VM_F(RBTreeTest, ArenaAllocator) {\n+  Arena arena(mtTest);\n+  RBTreeArena<int, int, Cmp> rbtree(&arena);\n+  bool success = rbtree.upsert(5, 5);\n+  ASSERT_EQ(true, success);\n+}\n+\n+TEST_VM_F(RBTreeTest, ResourceAreaAllocator) {\n+  ResourceArea area(mtTest);\n+  RBTreeResourceArea<int, int, Cmp> rbtree(&area);\n+  bool success = rbtree.upsert(5, 5);\n+  ASSERT_EQ(true, success);\n+}\n","filename":"test\/hotspot\/gtest\/utilities\/test_rbtree.cpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"}]}