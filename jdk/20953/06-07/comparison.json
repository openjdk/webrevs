{"files":[{"patch":"@@ -52,2 +52,0 @@\n-  static DllEntry* _dll_list;\n-  static DllEntry* _dll_cursor;\n@@ -72,0 +70,1 @@\n+    assert(dll_name != nullptr, \"null dll name\");\n@@ -91,0 +90,1 @@\n+};\n@@ -92,2 +92,32 @@\n-  static int dll_cb(const char *dll_name, address low, address high, void* param) {\n-    DllEntry* entry = build((const char*)low, dll_name);\n+class DllList {\n+  DllEntry* _dll_list;\n+  DllEntry* _dll_cursor;\n+\n+  public:\n+\n+  DllList() : _dll_list(nullptr), _dll_cursor(nullptr) {}\n+  ~DllList() {\n+    \/* free any held resources *\/\n+    if (_dll_list != nullptr) {\n+      _dll_list->free();\n+      ::free(_dll_list);\n+    }\n+  }\n+\n+  DllEntry* cursor_rewind() {\n+    _dll_cursor = _dll_list;\n+    return _dll_cursor;\n+  }\n+\n+  DllEntry* cursor_current() {\n+    return _dll_cursor;\n+  }\n+\n+  DllEntry* cursor_next() {\n+    if (_dll_cursor != nullptr) {\n+      _dll_cursor = _dll_cursor->_next;\n+    }\n+    return _dll_cursor;\n+  }\n+\n+  void append(DllEntry* entry) {\n@@ -99,0 +129,6 @@\n+  }\n+\n+  static int dll_cb(const char *dll_name, address low, address high, void* param) {\n+    DllList* list = (DllList*)(param);\n+    DllEntry* entry = DllEntry::build((const char*)low, dll_name);\n+    list->append(entry);\n@@ -102,3 +138,3 @@\n-  static void add_all_dlls() {\n-    os::get_loaded_modules_info(dll_cb, nullptr);\n-    _dll_cursor = _dll_list;\n+  void add_all_dlls() {\n+    os::get_loaded_modules_info(dll_cb, this);\n+    cursor_rewind();\n@@ -108,2 +144,1 @@\n-DllEntry* DllEntry::_dll_list = nullptr;\n-DllEntry* DllEntry::_dll_cursor = nullptr;\n+DllList dll_list;\n@@ -348,2 +383,2 @@\n-      for (; DllEntry::_dll_cursor != nullptr; DllEntry::_dll_cursor = DllEntry::_dll_cursor->_next) {\n-        DllEntry* e = DllEntry::_dll_cursor;\n+      for (; dll_list.cursor_current() != nullptr; dll_list.cursor_next()) {\n+        DllEntry* e = dll_list.cursor_current();\n@@ -409,1 +444,1 @@\n-  DllEntry::add_all_dlls();\n+  dll_list.add_all_dlls();\n@@ -438,4 +473,0 @@\n-\n-  \/* free any held resources *\/\n-  DllEntry::_dll_list->free();\n-  ::free(DllEntry::_dll_list);\n","filename":"src\/hotspot\/os\/bsd\/memMapPrinter_macosx.cpp","additions":47,"deletions":16,"binary":false,"changes":63,"status":"modified"}]}