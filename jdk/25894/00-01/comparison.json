{"files":[{"patch":"@@ -67,8 +67,18 @@\n-        \/\/ Reserve three adjacent regions and release the middle one.\n-        long tmp = wb.NMTReserveMemory(reserveSize * 3);\n-        wb.NMTReleaseMemory(tmp + reserveSize, reserveSize);\n-\n-        wb.NMTReleaseMemory(addr1, reserveSize);\n-        wb.NMTReleaseMemory(addr2, reserveSize);\n-        addr1 = tmp;\n-        addr2 = addr1 + reserveSize * 2;\n+        \/\/            <---r1---><---r2---><---tmp--->\n+        \/\/ <---tmp---><---r1---><---r2--->\n+        \/\/\n+        long tmp = wb.NMTReserveMemory(reserveSize);\n+        long r1 = addr1 < addr2 ? addr1 : addr2;\n+        long r2 = addr1 > addr2 ? addr1 : addr2;\n+        long tmp_end = tmp + reserveSize;\n+        long r1_end = r1 + reserveSize;\n+        long r2_end = r2 + reserveSize;\n+        if (tmp >= r2_end) {\n+          wb.NMTReleaseMemory(r2, reserveSize);\n+          addr1 = r1;\n+          addr2 = tmp;\n+        } else if (tmp_end <= r1) {\n+          wb.NMTReleaseMemory(r1, reserveSize);\n+          addr1 = tmp;\n+          addr2 = r2;\n+        }\n","filename":"test\/hotspot\/jtreg\/runtime\/NMT\/VirtualAllocTestType.java","additions":18,"deletions":8,"binary":false,"changes":26,"status":"modified"}]}