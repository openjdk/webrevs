{"files":[{"patch":"@@ -281,0 +281,2 @@\n+                \/\/ use getOutputSize to avoid a ShortBufferException\n+                \/\/ from providers that require oversized buffers. See JDK-8368514.\n@@ -282,1 +284,1 @@\n-                        data.remaining() - GCM_TAG_LEN \/ 8);\n+                        c.getOutputSize(data.remaining()));\n@@ -294,1 +296,1 @@\n-                    SSLLogger.fine(\"Decryption failed.\" + e.getMessage());\n+                    SSLLogger.fine(\"Decryption failed.\" + e);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SessionTicketExtension.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n- * @bug 8029661 8325164 8368073\n+ * @bug 8029661 8325164 8368073 8368514\n@@ -34,3 +34,5 @@\n- *      -Djdk.tls.useExtendedMasterSecret=false FipsModeTLS12\n- * @comment SunPKCS11 does not support (TLS1.2) SunTlsExtendedMasterSecret yet\n- * @run main\/othervm\/timeout=120 -Djdk.tls.client.protocols=TLSv1.3 FipsModeTLS12\n+ *      -Djdk.tls.useExtendedMasterSecret=false\n+ *      -Djdk.tls.client.enableSessionTicketExtension=false FipsModeTLS\n+ * @comment SunPKCS11 does not support (TLS1.2) SunTlsExtendedMasterSecret yet.\n+ *   Stateless resumption doesn't currently work with NSS-FIPS, see JDK-8368669\n+ * @run main\/othervm\/timeout=120 -Djdk.tls.client.protocols=TLSv1.3 FipsModeTLS\n@@ -76,1 +78,1 @@\n-public final class FipsModeTLS12 extends SecmodTest {\n+public final class FipsModeTLS extends SecmodTest {\n@@ -104,2 +106,3 @@\n-            \/\/ Self-integrity test (complete TLS 1.2 communication)\n-            new testTLS12SunPKCS11Communication().run();\n+            \/\/ Self-integrity test (complete TLS communication)\n+            testTLSSunPKCS11Communication.initSslContext();\n+            testTLSSunPKCS11Communication.run();\n@@ -272,1 +275,1 @@\n-    private static class testTLS12SunPKCS11Communication {\n+    private static class testTLSSunPKCS11Communication {\n@@ -275,1 +278,1 @@\n-\n+            boolean firstSession = true;\n@@ -280,1 +283,4 @@\n-\n+                \/\/ The first connection needs to do a full handshake.\n+                \/\/ Verify that subsequent handshakes use resumption.\n+                clientSSLEngine.setEnableSessionCreation(firstSession);\n+                firstSession = false;\n@@ -403,8 +409,0 @@\n-            KeyManagerFactory kmf = KeyManagerFactory.getInstance(\"PKIX\", \"SunJSSE\");\n-            kmf.init(ks, passphrase);\n-\n-            TrustManagerFactory tmf = TrustManagerFactory.getInstance(\"PKIX\", \"SunJSSE\");\n-            tmf.init(ts);\n-\n-            SSLContext sslCtx = SSLContext.getInstance(\"TLS\", \"SunJSSE\");\n-            sslCtx.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);\n@@ -434,0 +432,12 @@\n+\n+        private static SSLContext sslCtx;\n+        private static void initSslContext() throws Exception {\n+            KeyManagerFactory kmf = KeyManagerFactory.getInstance(\"PKIX\", \"SunJSSE\");\n+            kmf.init(ks, passphrase);\n+\n+            TrustManagerFactory tmf = TrustManagerFactory.getInstance(\"PKIX\", \"SunJSSE\");\n+            tmf.init(ts);\n+\n+            sslCtx = SSLContext.getInstance(\"TLS\", \"SunJSSE\");\n+            sslCtx.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);\n+        }\n","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/FipsModeTLS.java","additions":28,"deletions":18,"binary":false,"changes":46,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/FipsModeTLS12.java","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/cert8.db","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/cert8.db","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/cert9.db","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/cert9.db","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/key3.db","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/key3.db","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/key4.db","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/key4.db","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/keystore","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/keystore","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/nss.cfg","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/nss.cfg","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/pkcs11.txt","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/pkcs11.txt","status":"renamed"},{"patch":"","filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/fips\/secmod.db","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"test\/jdk\/sun\/security\/pkcs11\/tls\/tls12\/secmod.db","status":"renamed"}]}