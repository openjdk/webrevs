{"files":[{"patch":"@@ -2,0 +2,1 @@\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +27,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -30,2 +32,2 @@\n-  volatile int _sum;\n-  int _max;\n+  Atomic<int> _sum;\n+  Atomic<int> _max;\n@@ -35,2 +37,2 @@\n-    AtomicAccess::add(&_sum, chunk);\n-    AtomicAccess::store(&_max, max_chunks);\n+    _sum.add_then_fetch(chunk);\n+    _max.store_relaxed(max_chunks);\n@@ -38,2 +40,2 @@\n-  int sum() { return AtomicAccess::load(&_sum); }\n-  int max() { return AtomicAccess::load(&_max); }\n+  int sum() { return _sum.load_relaxed(); }\n+  int max() { return _max.load_relaxed(); }\n","filename":"test\/hotspot\/gtest\/cds\/test_archiveWorkers.cpp","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+#include \"cppstdlib\/new.hpp\"\n@@ -27,1 +28,1 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -52,1 +53,1 @@\n-  volatile uint _num_do_work; \/\/ Amount of do_work() has been called.\n+  Atomic<uint> _num_do_work; \/\/ Amount of do_work() has been called.\n@@ -59,1 +60,1 @@\n-  bool volatile* _do_work_called_by;\n+  Atomic<bool>* _do_work_called_by;\n@@ -65,2 +66,2 @@\n-    AtomicAccess::inc(&_num_do_work);\n-    bool orig_value = AtomicAccess::cmpxchg(&_do_work_called_by[worker_id], false, true);\n+    _num_do_work.add_then_fetch(1u);\n+    bool orig_value = _do_work_called_by[worker_id].compare_exchange(false, true);\n@@ -71,1 +72,1 @@\n-    ASSERT_EQ(AtomicAccess::load(&_num_do_work), num_workers);\n+    ASSERT_EQ(_num_do_work.load_relaxed(), num_workers);\n@@ -89,1 +90,1 @@\n-    FREE_C_HEAP_ARRAY(bool, _do_work_called_by);\n+    FREE_C_HEAP_ARRAY(Atomic<bool>, _do_work_called_by);\n@@ -103,1 +104,1 @@\n-    _do_work_called_by = NEW_C_HEAP_ARRAY(bool, max_workers, mtInternal);\n+    _do_work_called_by = NEW_C_HEAP_ARRAY(Atomic<bool>, max_workers, mtInternal);\n@@ -105,1 +106,1 @@\n-      _do_work_called_by[i] = false;\n+      ::new (&_do_work_called_by[i]) Atomic<bool>{false};\n","filename":"test\/hotspot\/gtest\/gc\/g1\/test_g1BatchedGangTask.cpp","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -388,2 +389,2 @@\n-  size_t _added;\n-  size_t _found;\n+  Atomic<size_t> _added;\n+  Atomic<size_t> _found;\n@@ -416,2 +417,2 @@\n-    AtomicAccess::add(&_added, added);\n-    AtomicAccess::add(&_found, found);\n+    _added.add_then_fetch(added);\n+    _found.add_then_fetch(found);\n@@ -420,2 +421,2 @@\n-  size_t added() const { return _added; }\n-  size_t found() const { return _found; }\n+  size_t added() const { return _added.load_relaxed(); }\n+  size_t found() const { return _found.load_relaxed(); }\n","filename":"test\/hotspot\/gtest\/gc\/g1\/test_g1CardSet.cpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -54,1 +54,1 @@\n-  uint _claim_id;\n+  Atomic<uint> _claim_id;\n@@ -62,1 +62,1 @@\n-    uint index = AtomicAccess::fetch_then_add(&_claim_id, 1u);\n+    uint index = _claim_id.fetch_then_add(1u);\n","filename":"test\/hotspot\/gtest\/gc\/g1\/test_stressCommitUncommit.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -119,2 +119,2 @@\n-  volatile size_t* _total_allocations;\n-  volatile bool* _continue_running;\n+  Atomic<size_t>* _total_allocations;\n+  Atomic<bool>* _continue_running;\n@@ -127,2 +127,2 @@\n-                  volatile size_t* total_allocations,\n-                  volatile bool* continue_running) :\n+                  Atomic<size_t>* total_allocations,\n+                  Atomic<bool>* continue_running) :\n@@ -138,1 +138,1 @@\n-    while (AtomicAccess::load_acquire(_continue_running)) {\n+    while (_continue_running->load_acquire()) {\n@@ -145,1 +145,1 @@\n-    AtomicAccess::add(_total_allocations, _allocations);\n+    _total_allocations->add_then_fetch(_allocations);\n@@ -154,1 +154,1 @@\n-  volatile bool* _continue_running;\n+  Atomic<bool>* _continue_running;\n@@ -160,1 +160,1 @@\n-                  volatile bool* continue_running) :\n+                  Atomic<bool>* continue_running) :\n@@ -175,1 +175,1 @@\n-      } else if (!AtomicAccess::load_acquire(_continue_running)) {\n+      } else if (!_continue_running->load_acquire()) {\n@@ -196,3 +196,3 @@\n-  volatile size_t total_allocations = 0;\n-  volatile bool allocator_running = true;\n-  volatile bool processor_running = true;\n+  Atomic<size_t> total_allocations{0};\n+  Atomic<bool> allocator_running{true};\n+  Atomic<bool> processor_running{true};\n@@ -225,1 +225,1 @@\n-  AtomicAccess::release_store(&allocator_running, false);\n+  allocator_running.release_store(false);\n@@ -230,1 +230,1 @@\n-  AtomicAccess::release_store(&processor_running, false);\n+  processor_running.release_store(false);\n@@ -236,1 +236,1 @@\n-  tty->print_cr(\"total allocations: %zu\", total_allocations);\n+  tty->print_cr(\"total allocations: %zu\", total_allocations.load_relaxed());\n","filename":"test\/hotspot\/gtest\/gc\/shared\/test_bufferNodeAllocator.cpp","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -1172,1 +1173,1 @@\n-  size_t *_total_scanned;\n+  Atomic<size_t>* _total_scanned;\n@@ -1177,1 +1178,1 @@\n-                      size_t *total_scanned) :\n+                      Atomic<size_t>* total_scanned) :\n@@ -1187,1 +1188,1 @@\n-    AtomicAccess::add(_total_scanned, par_scan._count);\n+    _total_scanned->add_then_fetch(par_scan._count);\n@@ -1220,1 +1221,1 @@\n-    size_t total_scanned = 0;\n+    Atomic<size_t> total_scanned{0};\n@@ -1226,1 +1227,2 @@\n-     EXPECT_TRUE(total_scanned == (size_t)_num_items) << \" Should scan all inserted items: \" << total_scanned;\n+    EXPECT_TRUE(total_scanned.load_relaxed() == (size_t)_num_items)\n+        << \" Should scan all inserted items: \" << total_scanned.load_relaxed();\n","filename":"test\/hotspot\/gtest\/utilities\/test_concurrentHashtable.cpp","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -24,1 +24,1 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -42,2 +42,2 @@\n-  volatile NestedTestState _state;\n-  volatile bool _proceed;\n+  Atomic<NestedTestState> _state;\n+  Atomic<bool> _proceed;\n@@ -55,1 +55,1 @@\n-    AtomicAccess::release_store(&_state, new_state);\n+    _state.release_store(new_state);\n@@ -60,2 +60,2 @@\n-    AtomicAccess::release_store(&_state, new_state);\n-    while (!AtomicAccess::load_acquire(&_proceed)) {\n+    _state.release_store(new_state);\n+    while (!_proceed.load_acquire()) {\n@@ -64,1 +64,1 @@\n-    AtomicAccess::release_store(&_proceed, false);\n+    _proceed.release_store(false);\n@@ -69,1 +69,1 @@\n-    return AtomicAccess::load_acquire(&_state);\n+    return _state.load_acquire();\n@@ -80,1 +80,1 @@\n-    AtomicAccess::release_store(&_proceed, true);\n+    _proceed.release_store(true);\n","filename":"test\/hotspot\/gtest\/utilities\/test_globalCounter_nested.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -25,1 +25,1 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -39,2 +39,2 @@\n-  volatile uintx* _synchronized_value;\n-  volatile int* _continue_running;\n+  Atomic<uintx>* _synchronized_value;\n+  Atomic<int>* _continue_running;\n@@ -47,2 +47,2 @@\n-                                     volatile uintx* synchronized_value,\n-                                     volatile int* continue_running) :\n+                                     Atomic<uintx>* synchronized_value,\n+                                     Atomic<int>* continue_running) :\n@@ -58,1 +58,1 @@\n-    while (AtomicAccess::load_acquire(_continue_running) != 0) {\n+    while (_continue_running->load_acquire() != 0) {\n@@ -62,1 +62,1 @@\n-      uintx value = AtomicAccess::load_acquire(_synchronized_value);\n+      uintx value = _synchronized_value->load_acquire();\n@@ -65,1 +65,1 @@\n-        new_value = AtomicAccess::load_acquire(_synchronized_value);\n+        new_value = _synchronized_value->load_acquire();\n@@ -84,2 +84,2 @@\n-  volatile uintx* _synchronized_value;\n-  volatile int* _continue_running;\n+  Atomic<uintx>* _synchronized_value;\n+  Atomic<int>* _continue_running;\n@@ -90,2 +90,2 @@\n-                                     volatile uintx* synchronized_value,\n-                                     volatile int* continue_running) :\n+                                     Atomic<uintx>* synchronized_value,\n+                                     Atomic<int>* continue_running) :\n@@ -99,2 +99,2 @@\n-    while (AtomicAccess::load_acquire(_continue_running) != 0) {\n-      ++*_synchronized_value;\n+    while (_continue_running->load_acquire() != 0) {\n+      _synchronized_value->add_then_fetch(1u, memory_order_relaxed);\n@@ -104,1 +104,1 @@\n-    tty->print_cr(\"writer iterations: %zu\", *_synchronized_value);\n+    tty->print_cr(\"writer iterations: %zu\", _synchronized_value->load_relaxed());\n@@ -114,2 +114,2 @@\n-  volatile uintx synchronized_value = 0;\n-  volatile int continue_running = 1;\n+  Atomic<uintx> synchronized_value{0};\n+  Atomic<int> continue_running{1};\n@@ -140,1 +140,1 @@\n-  continue_running = 0;\n+  continue_running.store_relaxed(0);\n","filename":"test\/hotspot\/gtest\/utilities\/test_singleWriterSynchronizer.cpp","additions":18,"deletions":18,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -24,1 +24,1 @@\n-#include \"runtime\/atomicAccess.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -31,2 +31,2 @@\n-static volatile int wait_tag = 0;\n-static volatile int valid_value = 0;\n+static Atomic<int> wait_tag{0};\n+static Atomic<int> valid_value{0};\n@@ -37,1 +37,1 @@\n-  static volatile bool _exit;\n+  static Atomic<bool> _exit;\n@@ -40,1 +40,1 @@\n-  volatile int _on_barrier;\n+  Atomic<int> _on_barrier;\n@@ -49,1 +49,1 @@\n-    while (!_exit) {\n+    while (!_exit.load_relaxed()) {\n@@ -51,1 +51,1 @@\n-      tag = AtomicAccess::load_acquire(&wait_tag);\n+      tag = wait_tag.load_acquire();\n@@ -53,2 +53,2 @@\n-      AtomicAccess::release_store(&_on_barrier, tag);\n-      if (_on_barrier == 0) {\n+      _on_barrier.release_store(tag);\n+      if (_on_barrier.load_relaxed() == 0) {\n@@ -62,1 +62,1 @@\n-      vv = AtomicAccess::load_acquire(&valid_value);\n+      vv = valid_value.load_acquire();\n@@ -64,1 +64,1 @@\n-      AtomicAccess::release_store(&_on_barrier, 0);\n+      _on_barrier.release_store(0);\n@@ -70,1 +70,1 @@\n-volatile bool WBThread<WaitBarrierImpl>::_exit = false;\n+Atomic<bool> WBThread<WaitBarrierImpl>::_exit{false};\n@@ -106,1 +106,1 @@\n-      AtomicAccess::release_store_fence(&wait_tag, next_tag);\n+      wait_tag.release_store_fence(next_tag);\n@@ -109,4 +109,4 @@\n-      while (reader1->_on_barrier != wait_tag ||\n-             reader2->_on_barrier != wait_tag ||\n-             reader3->_on_barrier != wait_tag ||\n-             reader4->_on_barrier != wait_tag) {\n+      while (reader1->_on_barrier.load_relaxed() != wait_tag.load_relaxed() ||\n+             reader2->_on_barrier.load_relaxed() != wait_tag.load_relaxed() ||\n+             reader3->_on_barrier.load_relaxed() != wait_tag.load_relaxed() ||\n+             reader4->_on_barrier.load_relaxed() != wait_tag.load_relaxed()) {\n@@ -117,1 +117,1 @@\n-      AtomicAccess::release_store(&valid_value, valid_value + 1); \/\/ odd\n+      valid_value.release_store(valid_value.load_relaxed() + 1); \/\/ odd\n@@ -120,1 +120,1 @@\n-      AtomicAccess::release_store(&valid_value, valid_value + 1); \/\/ even\n+      valid_value.release_store(valid_value.load_relaxed() + 1); \/\/ even\n@@ -122,1 +122,1 @@\n-      AtomicAccess::release_store_fence(&wait_tag, 0); \/\/ Stores in WB must not float up.\n+      wait_tag.release_store_fence(0); \/\/ Stores in WB must not float up.\n@@ -126,4 +126,4 @@\n-      while (reader1->_on_barrier != 0 ||\n-             reader2->_on_barrier != 0 ||\n-             reader3->_on_barrier != 0 ||\n-             reader4->_on_barrier != 0) {\n+      while (reader1->_on_barrier.load_relaxed() != 0 ||\n+             reader2->_on_barrier.load_relaxed() != 0 ||\n+             reader3->_on_barrier.load_relaxed() != 0 ||\n+             reader4->_on_barrier.load_relaxed() != 0) {\n@@ -134,1 +134,1 @@\n-    WBThread<WaitBarrierImpl>::_exit = true;\n+    WBThread<WaitBarrierImpl>::_exit.store_relaxed(true);\n@@ -142,1 +142,1 @@\n-  WBThread<WaitBarrierDefault>::_exit = false;\n+  WBThread<WaitBarrierDefault>::_exit.store_relaxed(false);\n@@ -148,1 +148,1 @@\n-  WBThread<GenericWaitBarrier>::_exit = false;\n+  WBThread<GenericWaitBarrier>::_exit.store_relaxed(false);\n","filename":"test\/hotspot\/gtest\/utilities\/test_waitBarrier.cpp","additions":27,"deletions":27,"binary":false,"changes":54,"status":"modified"}]}