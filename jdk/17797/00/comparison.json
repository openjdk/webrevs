{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,2 +125,0 @@\n-    private static final int dump = 0; \/\/ > 0 r, > 1 rw\n-\n@@ -130,1 +128,1 @@\n-    private boolean v3 = true;       \/\/ Set in setV3()\n+    private boolean v3 = true;     \/\/ Set in setV3()\n@@ -133,1 +131,1 @@\n-                         \/\/ used by StartTlsResponse when creating an SSL socket\n+                               \/\/ used by StartTlsResponse when creating an SSL socket\n@@ -135,1 +133,1 @@\n-                         \/\/ used by StartTlsResponse when creating an SSL socket\n+                               \/\/ used by StartTlsResponse when creating an SSL socket\n@@ -327,1 +325,1 @@\n-                                          int connectTimeout) throws Exception {\n+                                          int connectTimeout) throws IOException {\n@@ -330,0 +328,1 @@\n+        \/\/ if timeout is supplied, try to use unconnected socket for connecting with timeout\n@@ -331,8 +330,0 @@\n-            \/\/ create unconnected socket and then connect it if timeout\n-            \/\/ is supplied\n-            InetSocketAddress endpoint =\n-                    createInetSocketAddress(host, port);\n-            \/\/ unconnected socket\n-            socket = factory.createSocket();\n-            \/\/ connect socket with a timeout\n-            socket.connect(endpoint, connectTimeout);\n@@ -340,2 +331,15 @@\n-                System.err.println(\"Connection: creating socket with \" +\n-                        \"a connect timeout\");\n+                System.err.println(\"Connection: creating socket with a connect timeout\");\n+            }\n+            try {\n+                \/\/ unconnected socket\n+                socket = factory.createSocket();\n+            } catch (IOException e) {\n+                \/\/ unconnected socket is likely not supported by the SocketFactory\n+                if (debug) {\n+                    System.err.println(\"Connection: unconnected socket not supported by SocketFactory\");\n+                }\n+            }\n+            if (socket != null) {\n+                InetSocketAddress endpoint = createInetSocketAddress(host, port);\n+                \/\/ connect socket with a timeout\n+                socket.connect(endpoint, connectTimeout);\n@@ -344,0 +348,2 @@\n+\n+        \/\/ either no timeout was supplied or unconnected socket did not work\n@@ -346,1 +352,0 @@\n-            socket = factory.createSocket(host, port);\n@@ -348,2 +353,1 @@\n-                System.err.println(\"Connection: creating connected socket with\" +\n-                        \" no connect timeout\");\n+                System.err.println(\"Connection: creating connected socket with no connect timeout\");\n@@ -351,0 +355,1 @@\n+            socket = factory.createSocket(host, port);\n@@ -359,1 +364,1 @@\n-    private void initialSSLHandshake(SSLSocket sslSocket , int connectTimeout) throws Exception {\n+    private void initialSSLHandshake(SSLSocket sslSocket, int connectTimeout) throws Exception {\n","filename":"src\/java.naming\/share\/classes\/com\/sun\/jndi\/ldap\/Connection.java","additions":26,"deletions":21,"binary":false,"changes":47,"status":"modified"}]}