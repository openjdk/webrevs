{"files":[{"patch":"@@ -875,1 +875,1 @@\n-                if (!reduced) {\n+                if (!reduced && !hasMatchingRecordPattern(basePatterns, inMissingPatterns, toExpand)) {\n@@ -951,1 +951,1 @@\n-                        partialSortPattern(combinatorialPatterns, basePatterns, combinatorialPatterns);\n+                        partialSortPattern(combinatorialPatterns, basePatterns, replace(inMissingPatterns, toExpand, combinatorialPatterns));\n@@ -1135,1 +1135,1 @@\n-            throw Assert.error();\n+            return null;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/ExhaustivenessComputer.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -290,6 +290,6 @@\n-                           case Triple(A p, C(Nested _, NestedBaseB _), C(Underneath _, NestedBaseA _)) -> 0;\n-                           case Triple(A p, C(Nested _, NestedBaseB _), C(Underneath _, NestedBaseB _)) -> 0;\n-                           case Triple(A p, C(Nested _, NestedBaseB _), C(Underneath _, NestedBaseC _)) -> 0;\n-                           case Triple(A p, C(Nested _, NestedBaseC _), C(Underneath _, NestedBaseA _)) -> 0;\n-                           case Triple(A p, C(Nested _, NestedBaseC _), C(Underneath _, NestedBaseB _)) -> 0;\n-\/\/                           case Path(A p, C(Nested _, NestedBaseC _), C(Underneath _, NestedBaseC _)) -> 0;\n+                           case Triple(A p, C(Nested _, NestedBaseB _), C(Nested _, NestedBaseA _)) -> 0;\n+                           case Triple(A p, C(Nested _, NestedBaseB _), C(Nested _, NestedBaseB _)) -> 0;\n+                           case Triple(A p, C(Nested _, NestedBaseB _), C(Nested _, NestedBaseC _)) -> 0;\n+                           case Triple(A p, C(Nested _, NestedBaseC _), C(Nested _, NestedBaseA _)) -> 0;\n+                           case Triple(A p, C(Nested _, NestedBaseC _), C(Nested _, NestedBaseB _)) -> 0;\n+\/\/                           case Path(A p, C(Nested _, NestedBaseC _), C(Nested _, NestedBaseC _)) -> 0;\n@@ -478,0 +478,55 @@\n+    @Test\n+    public void testNeedToExpandIfRecordExists(Path base) throws Exception {\n+        doTest(base,\n+               new String[0],\n+               \"\"\"\n+               package test;\n+                class Test {\n+                   sealed interface A { }\n+                   record B() implements A { }\n+                   record C(A a) implements A { }\n+\n+                   void test(A a) {\n+                       switch (a) {\n+                           case C(B _) -> throw null;\n+                       }\n+                   }\n+               }               \"\"\",\n+               \"test.Test.B _\",\n+               \"test.Test.C(test.Test.C _)\");\n+    }\n+\n+    @Test\n+    public void testComplex6(Path base) throws Exception {\n+        doTest(base,\n+               new String[0],\n+               \"\"\"\n+               public class Test {\n+                   sealed interface Base {}\n+                   record NoOp() implements Base {}\n+                   record Const() implements Base {}\n+                   record Pair(Base n1,\n+                               Base b2) implements Base {}\n+\n+                   int t(Base b) {\n+                       return switch (b) {\n+                           case NoOp _ -> 0;\n+                           case Const _ -> 0;\n+                           case Pair(NoOp _, _) -> 0;\n+                           case Pair(Const _, _) -> 0;\n+                           case Pair(Pair _, NoOp _) -> 0;\n+                           case Pair(Pair _, Const _) -> 0;\n+                           case Pair(Pair _, Pair(NoOp _, _)) -> 0;\n+                           case Pair(Pair _, Pair(Const _, _)) -> 0;\n+                           case Pair(Pair _, Pair(Pair(NoOp _, _), _)) -> 0;\n+                           case Pair(Pair _, Pair(Pair(Const _, _), _)) -> 0;\n+                           case Pair(Pair(NoOp _, _), Pair(Pair(Pair _, _), _)) -> 0;\n+                           case Pair(Pair(Const _, _), Pair(Pair(Pair _, _), _)) -> 0;\n+\/\/                           case Pair(Pair(Pair _, _), Pair(Pair(Pair _, _), _)) -> 0;\n+                       };\n+                   }\n+               }\n+               \"\"\",\n+               \"Test.Pair(Test.Pair(Test.Pair _, Test.Base _), Test.Pair(Test.Pair(Test.Pair _, Test.Base _), Test.Base _))\");\n+    }\n+\n@@ -516,1 +571,2 @@\n-                if (\"compiler.err.not.exhaustive.details\".equals(d.getCode())) {\n+                if (\"compiler.err.not.exhaustive.details\".equals(d.getCode()) ||\n+                    \"compiler.err.not.exhaustive.statement.details\".equals(d.getCode())) {\n","filename":"test\/langtools\/tools\/javac\/patterns\/ExhaustivenessConvenientErrors.java","additions":63,"deletions":7,"binary":false,"changes":70,"status":"modified"}]}