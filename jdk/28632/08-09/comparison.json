{"files":[{"patch":"@@ -1467,4 +1467,12 @@\n-        streams.forEach((id, stream) -> {\n-            if (id > lastProcessedStream) {\n-                stream.closeAsUnprocessed();\n-                numUnprocessed.incrementAndGet();\n+        stateLock.lock();\n+        try {\n+            streams.forEach((id, stream) -> {\n+                if (id > lastProcessedStream) {\n+                    stream.closeAsUnprocessed();\n+                    numUnprocessed.incrementAndGet();\n+                }\n+            });\n+\n+            if (debug.on()) {\n+                debug.log(\"%d stream(s) marked as unprocessed, processed streams will be closed by termination\",\n+                        numUnprocessed.get());\n@@ -1472,1 +1480,0 @@\n-        });\n@@ -1474,3 +1481,3 @@\n-        if (debug.on()) {\n-            debug.log(\"%d stream(s) marked as unprocessed, processed streams will be closed by termination\",\n-                    numUnprocessed.get());\n+            close(cause);\n+        } finally {\n+            stateLock.unlock();\n@@ -1478,2 +1485,0 @@\n-\n-        close(cause);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http2Connection.java","additions":15,"deletions":10,"binary":false,"changes":25,"status":"modified"}]}