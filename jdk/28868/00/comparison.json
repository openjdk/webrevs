{"files":[{"patch":"@@ -38,1 +38,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true <concrete-class-name>\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true <concrete-class-name>\n@@ -42,8 +42,0 @@\n-import org.testng.ITestContext;\n-import org.testng.ITestResult;\n-import org.testng.SkipException;\n-import org.testng.annotations.AfterTest;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.BeforeMethod;\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n@@ -103,3 +95,14 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n-\n+import org.junit.jupiter.api.AfterAll;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.api.extension.BeforeEachCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.junit.jupiter.api.extension.TestWatcher;\n+\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -108,10 +111,10 @@\n-    SSLContext sslContext;\n-    HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n-    HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n-    HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n-    String http2URI_fixed;\n-    String http2URI_chunk;\n-    String https2URI_fixed;\n-    String https2URI_chunk;\n-    String http3URI_fixed;\n-    String http3URI_chunk;\n+    static SSLContext sslContext;\n+    static HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n+    static HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n+    static HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n+    static String http2URI_fixed;\n+    static String http2URI_chunk;\n+    static String https2URI_fixed;\n+    static String https2URI_chunk;\n+    static String http3URI_fixed;\n+    static String http3URI_chunk;\n@@ -135,2 +138,28 @@\n-    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n-    private volatile HttpClient sharedClient;\n+    static final class TestStopper implements TestWatcher, BeforeEachCallback {\n+        final AtomicReference<String> failed = new AtomicReference<>();\n+        TestStopper() { }\n+        @Override\n+        public void testFailed(ExtensionContext context, Throwable cause) {\n+            if (stopAfterFirstFailure()) {\n+                String msg = \"Aborting due to: \" + cause;\n+                failed.compareAndSet(null, msg);\n+                FAILURES.putIfAbsent(context.getDisplayName(), cause);\n+                System.out.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+                System.err.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+            }\n+        }\n+\n+        @Override\n+        public void beforeEach(ExtensionContext context) {\n+            String msg = failed.get();\n+            Assumptions.assumeTrue(msg == null, msg);\n+        }\n+    }\n+\n+    @RegisterExtension\n+    static final TestStopper stopper = new TestStopper();\n+\n+    static final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+    private static volatile HttpClient sharedClient;\n@@ -162,1 +191,1 @@\n-    protected boolean stopAfterFirstFailure() {\n+    protected static boolean stopAfterFirstFailure() {\n@@ -166,10 +195,0 @@\n-    final AtomicReference<SkipException> skiptests = new AtomicReference<>();\n-    void checkSkip() {\n-        var skip = skiptests.get();\n-        if (skip != null) throw skip;\n-    }\n-    static String name(ITestResult result) {\n-        var params = result.getParameters();\n-        return result.getName()\n-                + (params == null ? \"()\" : Arrays.toString(result.getParameters()));\n-    }\n@@ -177,13 +196,2 @@\n-    @BeforeMethod\n-    void beforeMethod(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            if (skiptests.get() == null) {\n-                SkipException skip = new SkipException(\"some tests failed\");\n-                skip.setStackTrace(new StackTraceElement[0]);\n-                skiptests.compareAndSet(null, skip);\n-            }\n-        }\n-    }\n-\n-    @AfterClass\n-    static final void printFailedTests(ITestContext context) {\n+    @AfterAll\n+    static final void printFailedTests() {\n@@ -214,1 +222,1 @@\n-    private String[] uris() {\n+    private static String[] uris() {\n@@ -225,2 +233,1 @@\n-    @DataProvider(name = \"sanity\")\n-    public Object[][] sanity() {\n+    public static Object[][] sanity() {\n@@ -255,1 +262,1 @@\n-    private Object[][] variants(List<Thrower> throwers) {\n+    private static Object[][] variants(List<Thrower> throwers) {\n@@ -275,5 +282,1 @@\n-    @DataProvider(name = \"ioVariants\")\n-    public Object[][] ioVariants(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] ioVariants() {\n@@ -284,5 +287,1 @@\n-    @DataProvider(name = \"customVariants\")\n-    public Object[][] customVariants(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] customVariants() {\n@@ -293,1 +292,1 @@\n-    private HttpClient makeNewClient() {\n+    private static HttpClient makeNewClient() {\n@@ -295,1 +294,1 @@\n-        return TRACKER.track(newClientBuilderForH3()\n+        return TRACKER.track(HttpServerAdapters.createClientBuilderForH3()\n@@ -303,1 +302,1 @@\n-    HttpClient newHttpClient(boolean share) {\n+    static HttpClient newHttpClient(boolean share) {\n@@ -307,1 +306,1 @@\n-        synchronized (this) {\n+        synchronized (AbstractThrowingPushPromises.class) {\n@@ -316,1 +315,1 @@\n-    Http3DiscoveryMode config(String uri) {\n+    static Http3DiscoveryMode config(String uri) {\n@@ -320,1 +319,1 @@\n-    Version version(String uri) {\n+    static Version version(String uri) {\n@@ -324,1 +323,1 @@\n-    HttpRequest request(String uri) {\n+    static HttpRequest request(String uri) {\n@@ -361,1 +360,1 @@\n-            assertEquals(URI.create(body).getPath(), URI.create(uri).getPath());\n+            assertEquals(URI.create(uri).getPath(), URI.create(body).getPath());\n@@ -367,1 +366,1 @@\n-                assertEquals(promisedBody, promised.uri().toASCIIString());\n+                assertEquals(promised.uri().toASCIIString(), promisedBody);\n@@ -369,1 +368,1 @@\n-            assertEquals(pushPromises.size(), 3);\n+            assertEquals(3, pushPromises.size());\n@@ -432,1 +431,0 @@\n-        checkSkip();\n@@ -606,1 +604,1 @@\n-        assertEquals(promises.size(), expectedCount,\n+        assertEquals(expectedCount, promises.size(),\n@@ -608,1 +606,1 @@\n-        assertEquals(result, List.of(reqURI.toASCIIString()));\n+        assertEquals(List.of(reqURI.toASCIIString()), result);\n@@ -761,2 +759,2 @@\n-    @BeforeTest\n-    public void setup() throws Exception {\n+    @BeforeAll\n+    public static void setup() throws Exception {\n@@ -795,2 +793,2 @@\n-    @AfterTest\n-    public void teardown() throws Exception {\n+    @AfterAll\n+    public static void teardown() throws Exception {\n","filename":"test\/jdk\/java\/net\/httpclient\/AbstractThrowingPushPromises.java","additions":77,"deletions":79,"binary":false,"changes":156,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamCustom\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamCustom\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"customVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"customVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsInputStreamCustom.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamIO\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamIO\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"ioVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"ioVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsInputStreamIO.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesCustom\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesCustom\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"customVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"customVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsLinesCustom.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesIO\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesIO\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"ioVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"ioVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsLinesIO.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringCustom\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringCustom\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"customVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"customVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsStringCustom.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringIO\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringIO\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"ioVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"ioVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsStringIO.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesSanity\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesSanity\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"sanity\")\n+    @ParameterizedTest\n+    @MethodSource(\"sanity\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesSanity.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"}]}