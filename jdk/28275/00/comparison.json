{"files":[{"patch":"@@ -218,1 +218,2 @@\n-    public static boolean logWarning(String option, String s) {\n+    public static boolean logWarning(String option, String s,\n+            Object... params) {\n@@ -220,1 +221,19 @@\n-            SSLLogger.warning(s);\n+            SSLLogger.warning(s, params);\n+        }\n+        return false;\n+    }\n+\n+    \/\/ Logs an info message and always returns false. This method\n+    \/\/ can be used as an OR Predicate to add a log in a stream filter.\n+    public static boolean logInfo(String option, String s, Object... params) {\n+        if (SSLLogger.isOn && SSLLogger.isOn(option)) {\n+            SSLLogger.info(s, params);\n+        }\n+        return false;\n+    }\n+\n+    \/\/ Logs a fine message and always returns false. This method\n+    \/\/ can be used as an OR Predicate to add a log in a stream filter.\n+    public static boolean logFine(String option, String s, Object... params) {\n+        if (SSLLogger.isOn && SSLLogger.isOn(option)) {\n+            SSLLogger.fine(s, params);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLLogger.java","additions":21,"deletions":2,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -33,1 +33,0 @@\n-\n@@ -35,1 +34,0 @@\n-\n@@ -41,15 +39,1 @@\n-\/**\n- * This class implements the SunJSSE X.509 trust manager using the internal\n- * validator API in J2SE core. The logic in this class is minimal.<p>\n- * <p>\n- * This class supports both the Simple validation algorithm from previous\n- * JSSE versions and PKIX validation. Currently, it is not possible for the\n- * application to specify PKIX parameters other than trust anchors. This will\n- * be fixed in a future release using new APIs. When that happens, it may also\n- * make sense to separate the Simple and PKIX trust managers into separate\n- * classes.\n- *\n- * @author Andreas Sterbenz\n- *\/\n-final class X509TrustManagerImpl extends X509ExtendedTrustManager\n-        implements X509TrustManager {\n+final class X509TrustManagerImpl extends X509ExtendedTrustManager {\n@@ -84,4 +68,2 @@\n-        if (SSLLogger.isOn && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-            SSLLogger.fine(\"adding as trusted certificates\",\n-                    (Object[])trustedCerts.toArray(new X509Certificate[0]));\n-        }\n+        SSLLogger.logFine(\"ssl,trustmanager\", \"adding as trusted certificates\",\n+                (Object[]) trustedCerts.toArray(new X509Certificate[0]));\n@@ -101,4 +83,3 @@\n-        if (SSLLogger.isOn && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-            SSLLogger.fine(\"adding as trusted certificates\",\n-                    (Object[])trustedCerts.toArray(new X509Certificate[0]));\n-        }\n+        SSLLogger.logFine(\"ssl,trustmanager\",\n+                \"adding as trusted certificates\",\n+                (Object[]) trustedCerts.toArray(new X509Certificate[0]));\n@@ -211,1 +192,0 @@\n-        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -213,1 +193,4 @@\n-        X509Certificate[] trustedChain;\n+        SSLSession session = null;\n+        AlgorithmConstraints constraints = null;\n+        String identityAlg = null;\n+\n@@ -215,0 +198,6 @@\n+            session = sslSocket.getHandshakeSession();\n+            constraints = SSLAlgorithmConstraints.forSocket(\n+                    sslSocket, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n+            identityAlg = sslSocket.getSSLParameters().\n+                    getEndpointIdentificationAlgorithm();\n+        }\n@@ -216,4 +205,3 @@\n-            SSLSession session = sslSocket.getHandshakeSession();\n-            if (session == null) {\n-                throw new CertificateException(\"No handshake session\");\n-            }\n+        findTrustedCertificate(chain, authType,\n+                session, constraints, identityAlg, checkClientTrusted);\n+    }\n@@ -221,2 +209,3 @@\n-            AlgorithmConstraints constraints = SSLAlgorithmConstraints.forSocket(\n-                    sslSocket, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n+    private void checkTrusted(X509Certificate[] chain,\n+            String authType, SSLEngine engine,\n+            boolean checkClientTrusted) throws CertificateException {\n@@ -224,8 +213,3 @@\n-            \/\/ Grab any stapled OCSP responses for use in validation\n-            List<byte[]> responseList = Collections.emptyList();\n-            if (!checkClientTrusted && session instanceof ExtendedSSLSession) {\n-                responseList =\n-                        ((ExtendedSSLSession)session).getStatusResponses();\n-            }\n-            trustedChain = v.validate(chain, null, responseList,\n-                    constraints, checkClientTrusted ? null : authType);\n+        SSLSession session = null;\n+        AlgorithmConstraints constraints = null;\n+        String identityAlg = null;\n@@ -233,2 +217,5 @@\n-            \/\/ check endpoint identity\n-            String identityAlg = sslSocket.getSSLParameters().\n+        if (engine != null) {\n+            session = engine.getHandshakeSession();\n+            constraints = SSLAlgorithmConstraints.forEngine(\n+                    engine, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n+            identityAlg = engine.getSSLParameters().\n@@ -236,7 +223,0 @@\n-            if (identityAlg != null && !identityAlg.isEmpty()) {\n-                checkIdentity(session,\n-                        trustedChain, identityAlg, checkClientTrusted);\n-            }\n-        } else {\n-            trustedChain = v.validate(chain, null, Collections.emptyList(),\n-                    null, checkClientTrusted ? null : authType);\n@@ -245,4 +225,2 @@\n-        if (SSLLogger.isOn && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-            SSLLogger.fine(\"Found trusted certificate\",\n-                    trustedChain[trustedChain.length - 1]);\n-        }\n+        findTrustedCertificate(chain, authType,\n+                session, constraints, identityAlg, checkClientTrusted);\n@@ -254,1 +232,0 @@\n-        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -256,7 +233,3 @@\n-        final X509Certificate[] trustedChain;\n-        if (quicTLSEngine != null) {\n-\n-            final SSLSession session = quicTLSEngine.getHandshakeSession();\n-            if (session == null) {\n-                throw new CertificateException(\"No handshake session\");\n-            }\n+        SSLSession session = null;\n+        AlgorithmConstraints constraints = null;\n+        String identityAlg = null;\n@@ -264,2 +237,3 @@\n-            \/\/ create the algorithm constraints\n-            final AlgorithmConstraints constraints = SSLAlgorithmConstraints.forQUIC(\n+        if (quicTLSEngine != null) {\n+            session = quicTLSEngine.getHandshakeSession();\n+            constraints = SSLAlgorithmConstraints.forQUIC(\n@@ -267,14 +241,1 @@\n-            final List<byte[]> responseList;\n-            \/\/ grab any stapled OCSP responses for use in validation\n-            if (!checkClientTrusted &&\n-                    session instanceof ExtendedSSLSession extSession) {\n-                responseList = extSession.getStatusResponses();\n-            } else {\n-                responseList = Collections.emptyList();\n-            }\n-            \/\/ do the certificate chain validation\n-            trustedChain = v.validate(chain, null, responseList,\n-                    constraints, checkClientTrusted ? null : authType);\n-\n-            \/\/ check endpoint identity\n-            String identityAlg = quicTLSEngine.getSSLParameters().\n+            identityAlg = quicTLSEngine.getSSLParameters().\n@@ -282,7 +243,0 @@\n-            if (identityAlg != null && !identityAlg.isEmpty()) {\n-                checkIdentity(session, trustedChain,\n-                        identityAlg, checkClientTrusted);\n-            }\n-        } else {\n-            trustedChain = v.validate(chain, null, Collections.emptyList(),\n-                    null, checkClientTrusted ? null : authType);\n@@ -291,4 +245,2 @@\n-        if (SSLLogger.isOn && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-            SSLLogger.fine(\"Found trusted certificate\",\n-                    trustedChain[trustedChain.length - 1]);\n-        }\n+        findTrustedCertificate(chain, authType,\n+                session, constraints, identityAlg, checkClientTrusted);\n@@ -297,2 +249,3 @@\n-    private void checkTrusted(X509Certificate[] chain,\n-            String authType, SSLEngine engine,\n+    private void findTrustedCertificate(X509Certificate[] chain,\n+            String authType, SSLSession session,\n+            AlgorithmConstraints constraints, String identityAlg,\n@@ -300,1 +253,0 @@\n-        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -302,2 +254,2 @@\n-        X509Certificate[] trustedChain;\n-        if (engine != null) {\n+        final X509Certificate[] trustedChain;\n+        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -305,1 +257,1 @@\n-            SSLSession session = engine.getHandshakeSession();\n+        if (constraints != null) {\n@@ -310,3 +262,0 @@\n-            AlgorithmConstraints constraints = SSLAlgorithmConstraints.forEngine(\n-                    engine, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n-\n@@ -314,4 +263,6 @@\n-            List<byte[]> responseList = Collections.emptyList();\n-            if (!checkClientTrusted && session instanceof ExtendedSSLSession) {\n-                responseList =\n-                        ((ExtendedSSLSession)session).getStatusResponses();\n+            final List<byte[]> responseList;\n+            if (!checkClientTrusted &&\n+                    session instanceof ExtendedSSLSession extSession) {\n+                responseList = extSession.getStatusResponses();\n+            } else {\n+                responseList = Collections.emptyList();\n@@ -319,0 +270,2 @@\n+\n+            \/\/ Certificate chain validation\n@@ -322,3 +275,1 @@\n-            \/\/ check endpoint identity\n-            String identityAlg = engine.getSSLParameters().\n-                    getEndpointIdentificationAlgorithm();\n+            \/\/ Check endpoint identity\n@@ -334,4 +285,2 @@\n-        if (SSLLogger.isOn && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-            SSLLogger.fine(\"Found trusted certificate\",\n-                    trustedChain[trustedChain.length - 1]);\n-        }\n+        SSLLogger.logFine(\"ssl,trustmanager\", \"Found trusted certificate\",\n+                trustedChain[trustedChain.length - 1]);\n@@ -368,3 +317,2 @@\n-                    if (SSLLogger.isOn && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-                        SSLLogger.fine(\"Illegal server name: \" + sniName);\n-                    }\n+                    SSLLogger.logInfo(\"ssl,trustmanager\",\n+                            \"Illegal server name: \" + sniName);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/X509TrustManagerImpl.java","additions":60,"deletions":112,"binary":false,"changes":172,"status":"modified"}]}