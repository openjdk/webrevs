{"files":[{"patch":"@@ -1155,1 +1155,1 @@\n-                    ret = new VarSymbol(sym.flags() & FINAL, sym.name, sym.type, translatedSym);\n+                    ret = new VarSymbol(sym.flags() & (SYNTHETIC | FINAL), sym.name, sym.type, translatedSym);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/LambdaToMethod.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,138 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8372635\n+ * @enablePreview\n+ * @summary Verify temporary variables created for pattern matching are\n+ *          marked as synthetic.\n+ * @compile -g SyntheticVariables.java\n+ * @run main SyntheticVariables\n+ *\/\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.lang.classfile.Attributes;\n+import java.lang.classfile.ClassFile;\n+import java.lang.classfile.ClassModel;\n+import java.lang.classfile.MethodModel;\n+import java.lang.classfile.attribute.CodeAttribute;\n+import java.lang.classfile.attribute.LocalVariableTableAttribute;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+public class SyntheticVariables {\n+\n+    public static void main(String[] args) throws IOException {\n+        try (InputStream in = Test.class.getClassLoader().getResource(Test.class.getName().replace('.', '\/') + \".class\").openStream()) {\n+            ClassModel model = ClassFile.of().parse(in.readAllBytes());\n+            Map<String, MethodModel> name2Method = model.methods().stream().collect(Collectors.toMap(m -> m.methodName().stringValue(), m -> m));\n+            assertEquals(Set.of(\"str\", \"b\", \"b2\", \"this\", \"l\", \"o\"), localVars(name2Method.get(\"testInMethod\")));\n+            assertEquals(Set.of(\"str\", \"b\", \"b2\", \"l\", \"o\"), localVars(name2Method.get(\"lambda$testInLambda$0\")));\n+        }\n+    }\n+\n+    private static Set<String> localVars(MethodModel method) {\n+        CodeAttribute code = method.findAttribute(Attributes.code()).orElseThrow();\n+        LocalVariableTableAttribute lvt = code.findAttribute(Attributes.localVariableTable()).orElseThrow();\n+        return lvt.localVariables()\n+                  .stream()\n+                  .map(info -> info.name().stringValue())\n+                  .collect(Collectors.toSet());\n+    }\n+\n+    private static void assertEquals(Set<String> expected, Set<String> actual) {\n+        if (!Objects.equals(expected, actual)) {\n+            throw new AssertionError(\"Unexpected value, expected: \" + expected +\n+                                     \", got: \" + actual);\n+        }\n+    }\n+\n+    public record Test(Object o) {\n+        private void testInMethod() {\n+            Object o = create();\n+\n+            \/\/synthetic variable for the instanceof's expression\n+            boolean b = o.toString() instanceof String str && str.isEmpty();\n+\n+            System.err.println(b);\n+\n+            \/\/synthetic variable for the switch's selector and index:\n+            switch (create()) {\n+                \/\/synthetic variable for the nested component values,\n+                \/\/and for the synthetic catch over the getters\n+                case Test(Test(String str)) when str.isEmpty() -> System.err.println(1);\n+                case Test(Test(String str)) -> System.err.println(2);\n+                default -> System.err.println(2);\n+            }\n+\n+            List<Integer> l = List.of(0);\n+\n+            \/\/synthetic variable for case where the static and dynamic types\n+            \/\/don't match for primitive patterns:\n+            boolean b2 = l.get(0) instanceof int;\n+\n+            System.err.println(b2);\n+        }\n+\n+        private void testInLambda() {\n+            Object o = create();\n+            Runnable r = () -> {\n+\n+                \/\/synthetic variable for the instanceof's expression\n+                boolean b = o.toString() instanceof String str && str.isEmpty();\n+\n+                System.err.println(b);\n+\n+                \/\/synthetic variable for the switch's selector and index:\n+                switch (create()) {\n+                    \/\/synthetic variable for the nested component values,\n+                    \/\/and for the synthetic catch over the getters\n+                    case Test(Test(String str)) when str.isEmpty() -> System.err.println(1);\n+                    case Test(Test(String str)) -> System.err.println(2);\n+                    default -> System.err.println(2);\n+                }\n+\n+                List<Integer> l = List.of(0);\n+\n+                \/\/synthetic variable for case where the static and dynamic types\n+                \/\/don't match for primitive patterns:\n+                boolean b2 = l.get(0) instanceof int;\n+\n+                System.err.println(b2);\n+            };\n+        }\n+        private static String val = \"v\";\n+        public static Test create() {\n+            try {\n+                return new Test(new Test(val));\n+            } finally {\n+                val += val;\n+            }\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/patterns\/SyntheticVariables.java","additions":138,"deletions":0,"binary":false,"changes":138,"status":"added"}]}