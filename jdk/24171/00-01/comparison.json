{"files":[{"patch":"@@ -141,0 +141,1 @@\n+  const char* mode;\n@@ -143,5 +144,2 @@\n-      if (is_vm_statically_linked()) {\n-        return CDSConfig::is_using_archive() ? \"interpreted mode, static, sharing\" : \"interpreted mode, static\";\n-      } else {\n-        return CDSConfig::is_using_archive() ? \"interpreted mode, sharing\" : \"interpreted mode\";\n-      }\n+      mode = \"interpreted mode\";\n+      break;\n@@ -149,6 +147,2 @@\n-      if (is_vm_statically_linked()) {\n-        if (CompilationModeFlag::quick_only()) {\n-          return CDSConfig::is_using_archive() ? \"mixed mode, emulated-client, static, sharing\" : \"mixed mode, emulated-client, static\";\n-        } else {\n-          return CDSConfig::is_using_archive() ? \"mixed mode, static, sharing\" : \"mixed mode, static\";\n-         }\n+      if (CompilationModeFlag::quick_only()) {\n+        mode = \"mixed mode, emulated-client\";\n@@ -156,5 +150,1 @@\n-        if (CompilationModeFlag::quick_only()) {\n-          return CDSConfig::is_using_archive() ? \"mixed mode, emulated-client, sharing\" : \"mixed mode, emulated-client\";\n-        } else {\n-          return CDSConfig::is_using_archive() ? \"mixed mode, sharing\" : \"mixed mode\";\n-        }\n+        mode = \"mixed mode\";\n@@ -162,0 +152,1 @@\n+      break;\n@@ -163,5 +154,2 @@\n-      if (is_vm_statically_linked()) {\n-        if (CompilationModeFlag::quick_only()) {\n-          return CDSConfig::is_using_archive() ? \"compiled mode, emulated-client, static, sharing\" : \"compiled mode, emulated-client, static\";\n-        }\n-        return CDSConfig::is_using_archive() ? \"compiled mode, static, sharing\" : \"compiled mode, static\";\n+      if (CompilationModeFlag::quick_only()) {\n+        mode = \"compiled mode, emulated-client\";\n@@ -169,4 +157,1 @@\n-        if (CompilationModeFlag::quick_only()) {\n-          return CDSConfig::is_using_archive() ? \"compiled mode, emulated-client, sharing\" : \"compiled mode, emulated-client\";\n-        }\n-        return CDSConfig::is_using_archive() ? \"compiled mode, sharing\" : \"compiled mode\";\n+        mode = \"compiled mode\";\n@@ -174,0 +159,3 @@\n+      break;\n+    default:\n+      ShouldNotReachHere();\n@@ -175,2 +163,8 @@\n-  ShouldNotReachHere();\n-  return \"\";\n+  size_t len = strlen(mode) + (is_vm_statically_linked() ? 8 : 0) +\n+               (CDSConfig::is_using_archive() ? 9 : 0) + 1;\n+  char* vm_info = NEW_C_HEAP_ARRAY(char, len, mtInternal);\n+  \/\/ jio_snprintf places null character in the last character.\n+  jio_snprintf(vm_info, len, \"%s%s%s\", mode,\n+               is_vm_statically_linked() ? \", static\" : \"\",\n+               CDSConfig::is_using_archive() ? \", sharing\" : \"\");\n+  return vm_info;\n","filename":"src\/hotspot\/share\/runtime\/abstract_vm_version.cpp","additions":21,"deletions":27,"binary":false,"changes":48,"status":"modified"}]}