{"files":[{"patch":"@@ -4953,1 +4953,1 @@\n-      log_warning(os)(\"Could not sample thread CPU time\");\n+      log_warning(os)(\"Could not sample thread CPU time (return code %d)\", rc);\n@@ -5028,1 +5028,1 @@\n-    log_warning(os)(\"Could not sample thread CPU time\");\n+    log_warning(os)(\"Could not sample thread CPU time (nullptr)\");\n@@ -5040,1 +5040,1 @@\n-    log_warning(os)(\"Could not sample thread CPU time\");\n+    log_warning(os)(\"Could not sample thread CPU time (count != 13)\");\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -610,1 +610,1 @@\n-double calc_usage(double component_cpu_time, double process_cpu_time) {\n+double percent_of(double component_cpu_time, double process_cpu_time) {\n@@ -615,1 +615,2 @@\n-  if (!os::is_thread_cpu_time_supported()) {\n+  LogTarget(Info, cpu) cpuLog;\n+  if (!os::is_thread_cpu_time_supported() || !cpuLog.is_enabled()) {\n@@ -626,25 +627,20 @@\n-  LogTarget(Info, cpu) cpuLog;\n-  if (cpuLog.is_enabled()) {\n-    double vm_thread_cpu_time = (double) CPUTimeUsage::Runtime::vm_thread() \/ NANOSECS_PER_SEC;\n-    CPUTimeUsage::GCStatistics gc_stats = CPUTimeUsage::GC::statisics();\n-    double gc_cpu_time = (double) gc_stats.total \/ NANOSECS_PER_SEC;\n-    double gc_threads_cpu_time = (double) gc_stats.gc_threads \/ NANOSECS_PER_SEC;\n-    double gc_vm_thread_cpu_time = (double) gc_stats.vm_thread \/ NANOSECS_PER_SEC;\n-\n-    if (gc_cpu_time < process_cpu_time) {\n-      cpuLog.print(\"=== CPU time Statistics =============================================================\");\n-      cpuLog.print(\"                                                                            CPUs\");\n-      cpuLog.print(\"                                                               s       %%  utilized\");\n-      cpuLog.print(\"   Process\");\n-      cpuLog.print(\"     Total                        %30.4f  %6.2f  %8.1f\", process_cpu_time, 100.0, process_cpu_time \/ os::elapsedTime());\n-      cpuLog.print(\"     VM Thread                    %30.4f  %6.2f  %8.1f\", vm_thread_cpu_time, calc_usage(vm_thread_cpu_time, process_cpu_time), vm_thread_cpu_time \/ os::elapsedTime());\n-      cpuLog.print(\"     Garbage Collection           %30.4f  %6.2f  %8.1f\", gc_cpu_time, calc_usage(gc_cpu_time, process_cpu_time), gc_cpu_time \/ os::elapsedTime());\n-      cpuLog.print(\"       GC Threads                 %30.4f  %6.2f  %8.1f\", gc_threads_cpu_time, calc_usage(gc_threads_cpu_time, process_cpu_time), gc_threads_cpu_time \/ os::elapsedTime());\n-      cpuLog.print(\"       VM Thread                  %30.4f  %6.2f  %8.1f\", gc_vm_thread_cpu_time, calc_usage(gc_vm_thread_cpu_time, process_cpu_time), gc_vm_thread_cpu_time \/ os::elapsedTime());\n-\n-      if (UseStringDeduplication) {\n-        double string_dedup_cpu_time = (double) gc_stats.stringdedup \/ NANOSECS_PER_SEC;\n-        cpuLog.print(\"       String Deduplication       %30.4f  %6.2f  %8.1f\", string_dedup_cpu_time, calc_usage(string_dedup_cpu_time, process_cpu_time), string_dedup_cpu_time \/ os::elapsedTime());\n-      }\n-      cpuLog.print(\"=====================================================================================\");\n-\n+  double vm_thread_cpu_time = (double) CPUTimeUsage::Runtime::vm_thread() \/ NANOSECS_PER_SEC;\n+  CPUTimeUsage::GCStatistics gc_stats = CPUTimeUsage::GC::statisics();\n+  double gc_cpu_time = (double) gc_stats.total \/ NANOSECS_PER_SEC;\n+  double gc_threads_cpu_time = (double) gc_stats.gc_threads \/ NANOSECS_PER_SEC;\n+  double gc_vm_thread_cpu_time = (double) gc_stats.vm_thread \/ NANOSECS_PER_SEC;\n+\n+  if (gc_cpu_time < process_cpu_time) {\n+    cpuLog.print(\"=== CPU time Statistics =============================================================\");\n+    cpuLog.print(\"                                                                            CPUs\");\n+    cpuLog.print(\"                                                               s       %%  utilized\");\n+    cpuLog.print(\"   Process\");\n+    cpuLog.print(\"     Total                        %30.4f  %6.2f  %8.1f\", process_cpu_time, 100.0, process_cpu_time \/ os::elapsedTime());\n+    cpuLog.print(\"     VM Thread                    %30.4f  %6.2f  %8.1f\", vm_thread_cpu_time, percent_of(vm_thread_cpu_time, process_cpu_time), vm_thread_cpu_time \/ os::elapsedTime());\n+    cpuLog.print(\"     Garbage Collection           %30.4f  %6.2f  %8.1f\", gc_cpu_time, percent_of(gc_cpu_time, process_cpu_time), gc_cpu_time \/ os::elapsedTime());\n+    cpuLog.print(\"       GC Threads                 %30.4f  %6.2f  %8.1f\", gc_threads_cpu_time, percent_of(gc_threads_cpu_time, process_cpu_time), gc_threads_cpu_time \/ os::elapsedTime());\n+    cpuLog.print(\"       VM Thread                  %30.4f  %6.2f  %8.1f\", gc_vm_thread_cpu_time, percent_of(gc_vm_thread_cpu_time, process_cpu_time), gc_vm_thread_cpu_time \/ os::elapsedTime());\n+\n+    if (UseStringDeduplication) {\n+      double string_dedup_cpu_time = (double) gc_stats.stringdedup \/ NANOSECS_PER_SEC;\n+      cpuLog.print(\"       String Deduplication       %30.4f  %6.2f  %8.1f\", string_dedup_cpu_time, percent_of(string_dedup_cpu_time, process_cpu_time), string_dedup_cpu_time \/ os::elapsedTime());\n@@ -652,0 +648,1 @@\n+    cpuLog.print(\"=====================================================================================\");\n","filename":"src\/hotspot\/share\/gc\/shared\/collectedHeap.cpp","additions":24,"deletions":27,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -468,2 +468,0 @@\n-  jlong elapsed_gc_cpu_time() const;\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/collectedHeap.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"}]}