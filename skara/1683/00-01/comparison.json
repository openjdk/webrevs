{"files":[{"patch":"@@ -2501,0 +2501,63 @@\n+    @Test\n+    void testAvoidForwardportsOnResolvedIssue(TestInfo testInfo) throws IOException {\n+        try (var credentials = new HostCredentials(testInfo);\n+             var tempFolder = new TemporaryDirectory()) {\n+            var repo = credentials.getHostedRepository();\n+            var repoFolder = tempFolder.path().resolve(\"repo\");\n+            var localRepo = CheckableRepository.init(repoFolder, repo.repositoryType(), Path.of(\"appendable.txt\"), Set.of(), null);\n+            credentials.commitLock(localRepo);\n+            localRepo.pushAll(repo.authenticatedUrl());\n+\n+            var storageFolder = tempFolder.path().resolve(\"storage\");\n+            var issueProject = credentials.getIssueProject();\n+            var jbsNotifierConfig = JSON.object().put(\"fixversions\", JSON.object().put(\".*aster\", \"22\")).put(\"avoidforwardports\", true);\n+            var notifyBot = testBotBuilder(repo, issueProject, storageFolder, jbsNotifierConfig).create(\"notify\", JSON.object());\n+\n+            \/\/ Initialize history\n+            TestBotRunner.runPeriodicItems(notifyBot);\n+\n+            \/\/ Create an issue and commit a fix\n+            var issue = issueProject.createIssue(\"This is an issue\", List.of(\"Indeed\"),\n+                    Map.of(\"issuetype\", JSON.of(\"Enhancement\"),\n+                            SUBCOMPONENT, JSON.of(\"java.io\"),\n+                            RESOLVED_IN_BUILD, JSON.of(\"b07\")\n+                    ));\n+            issue.setProperty(\"fixVersions\", JSON.array().add(\"21\"));\n+            issue.setProperty(\"priority\", JSON.of(\"1\"));\n+            issue.addLabel(\"test\");\n+            issue.addLabel(\"temporary\");\n+            issue.setState(RESOLVED);\n+            issue.setAssignees(List.of(issueProject.issueTracker().currentUser()));\n+\n+            var authorEmailAddress = issueProject.issueTracker().currentUser().username() + \"@openjdk.org\";\n+            var editHash = CheckableRepository.appendAndCommit(localRepo, \"Another line\", issue.id() + \": Fix that issue\", \"Duke\", authorEmailAddress);\n+            localRepo.push(editHash, repo.authenticatedUrl(), \"master\");\n+            TestBotRunner.runPeriodicItems(notifyBot);\n+\n+            \/\/ The fixVersion of the main issue should still be 21\n+            var updatedIssue = issueProject.issue(issue.id()).orElseThrow();\n+            assertEquals(Set.of(\"21\"), fixVersions(updatedIssue));\n+            assertEquals(RESOLVED, updatedIssue.state());\n+            assertEquals(List.of(issueProject.issueTracker().currentUser()), updatedIssue.assignees());\n+\n+            \/\/ There should be a link\n+            var links = updatedIssue.links();\n+            assertEquals(1, links.size());\n+            var link = links.get(0);\n+            var backport = link.issue().orElseThrow();\n+\n+            \/\/ The backport issue should target to release 22\n+            assertEquals(Set.of(\"22\"), fixVersions(backport));\n+            assertEquals(RESOLVED, backport.state());\n+            assertEquals(List.of(issueProject.issueTracker().currentUser()), backport.assignees());\n+\n+            \/\/ Custom properties should also propagate\n+            assertEquals(\"1\", backport.properties().get(\"priority\").asString());\n+            assertEquals(\"java.io\", backport.properties().get(SUBCOMPONENT).asString());\n+            assertFalse(backport.properties().containsKey(RESOLVED_IN_BUILD));\n+\n+            \/\/ Labels should not\n+            assertEquals(0, backport.labelNames().size());\n+        }\n+    }\n+\n","filename":"bots\/notify\/src\/test\/java\/org\/openjdk\/skara\/bots\/notify\/issue\/IssueNotifierTests.java","additions":63,"deletions":0,"binary":false,"changes":63,"status":"modified"}]}