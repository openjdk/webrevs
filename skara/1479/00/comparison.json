{"files":[{"patch":"@@ -0,0 +1,32 @@\n+package org.openjdk.skara.bots.common;\n+\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+\/**\n+ * Enum for Skara command names\n+ *\/\n+public enum CommandNameEnum {\n+    help,\n+    integrate,\n+    sponsor,\n+    contributor,\n+    summary,\n+    issue,\n+    solves,\n+    reviewers,\n+    csr,\n+    jep,\n+    reviewer,\n+    label,\n+    cc,\n+    clean,\n+    open,\n+    backport,\n+    tag;\n+\n+    \/* Utility method for returning command names separated by provided deliminator *\/\n+    public static String commandNamesSepByDelim(String deliminator) {\n+        return Stream.of(CommandNameEnum.values()).map(CommandNameEnum::name).collect(Collectors.joining(deliminator));\n+    }\n+}\n","filename":"bots\/common\/src\/main\/java\/org\/openjdk\/skara\/bots\/common\/CommandNameEnum.java","additions":32,"deletions":0,"binary":false,"changes":32,"status":"added"},{"patch":"@@ -49,0 +49,2 @@\n+    implementation project(':bots:common')\n+    implementation project(path: ':jbs')\n","filename":"bots\/mlbridge\/build.gradle","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -35,0 +35,2 @@\n+    requires org.openjdk.skara.jbs;\n+    requires org.openjdk.skara.bots.common;\n","filename":"bots\/mlbridge\/src\/main\/java\/module-info.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,0 +40,2 @@\n+import static org.openjdk.skara.bots.common.CommandNameEnum.commandNamesSepByDelim;\n+\n@@ -43,1 +45,2 @@\n-    static final Pattern COMMAND_PATTERN = Pattern.compile(\"^\\\\s*\/([A-Za-z]+).*$\", Pattern.MULTILINE | Pattern.DOTALL);\n+    static final Pattern COMMAND_PATTERN = Pattern.compile(\"^\\\\s*\/([\"+ commandNamesSepByDelim(\"|\") + \"]+).*$\",\n+                                                                  Pattern.MULTILINE | Pattern.DOTALL);\n","filename":"bots\/mlbridge\/src\/main\/java\/org\/openjdk\/skara\/bots\/mlbridge\/ArchiveMessages.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -187,0 +187,10 @@\n+            \/\/skara command prefixed with non-white space - should be archived\n+            pr.addComment(\"do not ignore me \/help\");\n+            \/\/ Run another archive pass\n+            TestBotRunner.runPeriodicItems(mlBot);\n+\n+            \/\/valid skara command - should not be archived\n+            pr.addComment(\"\/help\");\n+            \/\/ Run another archive pass\n+            TestBotRunner.runPeriodicItems(mlBot);\n+\n@@ -207,0 +217,2 @@\n+            assertTrue(archiveContains(archiveFolder.path(), \"do not ignore me \/help\"));\n+            assertFalse(archiveContains(archiveFolder.path(), \"Available commands\"));\n","filename":"bots\/mlbridge\/src\/test\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListBridgeBotTests.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -37,0 +37,2 @@\n+import static org.openjdk.skara.bots.common.CommandNameEnum.*;\n+\n@@ -38,1 +40,1 @@\n-    private static final Pattern COMMAND_PATTERN = Pattern.compile(\"^\\\\s*\/([A-Za-z]+)(?:\\\\s+(.*))?\");\n+    private static final Pattern COMMAND_PATTERN = Pattern.compile(\"^\\\\s*\/([\"+ commandNamesSepByDelim(\"|\") +\"]+)(?:\\\\s+(.*))?\");\n@@ -49,17 +51,17 @@\n-            Map.entry(\"help\", new HelpCommand()),\n-            Map.entry(\"integrate\", new IntegrateCommand()),\n-            Map.entry(\"sponsor\", new SponsorCommand()),\n-            Map.entry(\"contributor\", new ContributorCommand()),\n-            Map.entry(\"summary\", new SummaryCommand()),\n-            Map.entry(\"issue\", new IssueCommand()),\n-            Map.entry(\"solves\", new IssueCommand(\"solves\")),\n-            Map.entry(\"reviewers\", new ReviewersCommand()),\n-            Map.entry(\"csr\", new CSRCommand()),\n-            Map.entry(\"jep\", new JEPCommand()),\n-            Map.entry(\"reviewer\", new ReviewerCommand()),\n-            Map.entry(\"label\", new LabelCommand()),\n-            Map.entry(\"cc\", new LabelCommand(\"cc\")),\n-            Map.entry(\"clean\", new CleanCommand()),\n-            Map.entry(\"open\", new OpenCommand()),\n-            Map.entry(\"backport\", new BackportCommand()),\n-            Map.entry(\"tag\", new TagCommand())\n+            Map.entry(help.name(), new HelpCommand()),\n+            Map.entry(integrate.name(), new IntegrateCommand()),\n+            Map.entry(sponsor.name(), new SponsorCommand()),\n+            Map.entry(contributor.name(), new ContributorCommand()),\n+            Map.entry(summary.name(), new SummaryCommand()),\n+            Map.entry(issue.name(), new IssueCommand()),\n+            Map.entry(solves.name(), new IssueCommand(solves.name())),\n+            Map.entry(reviewers.name(), new ReviewersCommand()),\n+            Map.entry(csr.name(), new CSRCommand()),\n+            Map.entry(jep.name(), new JEPCommand()),\n+            Map.entry(reviewer.name(), new ReviewerCommand()),\n+            Map.entry(label.name(), new LabelCommand()),\n+            Map.entry(cc.name(), new LabelCommand(cc.name())),\n+            Map.entry(clean.name(), new CleanCommand()),\n+            Map.entry(open.name(), new OpenCommand()),\n+            Map.entry(backport.name(), new BackportCommand()),\n+            Map.entry(tag.name(), new TagCommand())\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CommandExtractor.java","additions":20,"deletions":18,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -112,4 +112,1 @@\n-        } else {\n-            printer.print(\"Unknown command `\");\n-            printer.print(command.name());\n-            printer.println(\"` - for a list of valid commands use `\/help`.\");\n+            bot.repo().addCommitComment(commitComment.commit(), writer.toString());\n@@ -117,2 +114,0 @@\n-\n-        bot.repo().addCommitComment(commitComment.commit(), writer.toString());\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CommitCommandWorkItem.java","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -166,4 +166,3 @@\n-        } else {\n-            printer.print(\"Unknown command `\");\n-            printer.print(command.name());\n-            printer.println(\"` - for a list of valid commands use `\/help`.\");\n+            var newComment = pr.addComment(writer.toString());\n+            var latency = Duration.between(command.createdAt(), newComment.createdAt());\n+            log.log(Level.INFO, \"Time from command '\" + command.name() + \"' to reply \" + latency, latency);\n@@ -171,4 +170,0 @@\n-\n-        var newComment = pr.addComment(writer.toString());\n-        var latency = Duration.between(command.createdAt(), newComment.createdAt());\n-        log.log(Level.INFO, \"Time from command '\" + command.name() + \"' to reply \" + latency, latency);\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestCommandWorkItem.java","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -83,0 +83,1 @@\n+            \/\/ Verify that the bot did *not* reply\n@@ -84,1 +85,1 @@\n-            CommitCommandAsserts.assertLastCommentContains(replies, \"Unknown command `hello` - for a list of valid commands use `\/help`.\");\n+            CommitCommandAsserts.assertLastCommentContains(replies, \"\/hello\");\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CommitCommandTests.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -69,6 +69,2 @@\n-            \/\/ The bot should reply with an error message\n-            var error = pr.comments().stream()\n-                          .filter(comment -> comment.body().contains(\"Unknown command\"))\n-                          .filter(comment -> comment.body().contains(\"help\"))\n-                          .count();\n-            assertEquals(1, error);\n+            \/\/ Verify that the bot did *not* reply\n+            PullRequestAsserts.assertLastCommentContains(pr, \"\/howdy\");\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestCommandTests.java","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"}]}