{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+import org.openjdk.skara.json.JSONValue;\n@@ -30,0 +31,1 @@\n+import java.util.stream.Collectors;\n@@ -52,1 +54,4 @@\n-        for (var repo : specific.get(\"pruned\").fields()) {\n+        var ignoredUsers = specific.get(\"pruned\").get(\"ignored\").get(\"users\").stream()\n+                .map(JSONValue::asString)\n+                .collect(Collectors.toSet());\n+        for (var repo : specific.get(\"pruned\").get(\"repositories\").fields()) {\n@@ -57,1 +62,1 @@\n-            var bot = new PullRequestPrunerBot(pruned);\n+            var bot = new PullRequestPrunerBot(pruned, ignoredUsers);\n","filename":"bots\/bridgekeeper\/src\/main\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/BridgekeeperBotFactory.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+    private final Set<String> ignoredUsers;\n@@ -41,1 +42,1 @@\n-    PullRequestPrunerBotWorkItem(PullRequest pr, Duration maxAge) {\n+    PullRequestPrunerBotWorkItem(PullRequest pr, Duration maxAge, Set<String> ignoredUsers) {\n@@ -44,0 +45,1 @@\n+        this.ignoredUsers = ignoredUsers;\n@@ -78,1 +80,4 @@\n-            var lastComment = comments.getLast();\n+            var lastComment = comments.stream()\n+                    .filter(comment -> !ignoredUsers.contains(comment.author().username()))\n+                    .toList()\n+                    .getLast();\n@@ -125,0 +130,1 @@\n+    private Set<String> ignoredUsers;\n@@ -126,1 +132,1 @@\n-    PullRequestPrunerBot(Map<HostedRepository, Duration> maxAges) {\n+    PullRequestPrunerBot(Map<HostedRepository, Duration> maxAges, Set<String> ignoredUsers) {\n@@ -128,0 +134,1 @@\n+        this.ignoredUsers = ignoredUsers;\n@@ -156,1 +163,1 @@\n-                                     .filter(comment -> !comment.author().equals(pr.repository().forge().currentUser()))\n+                                     .filter(comment -> !ignoredUsers.contains(comment.author().username()))\n@@ -168,1 +175,1 @@\n-            var item = new PullRequestPrunerBotWorkItem(pr, actualMaxAge);\n+            var item = new PullRequestPrunerBotWorkItem(pr, actualMaxAge, ignoredUsers);\n@@ -188,0 +195,4 @@\n+\n+    public Set<String> getIgnoredUsers() {\n+        return ignoredUsers;\n+    }\n","filename":"bots\/bridgekeeper\/src\/main\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/PullRequestPrunerBot.java","additions":16,"deletions":5,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import java.util.Set;\n@@ -50,2 +51,5 @@\n-                    \"pruned1\": {\n-                      \"maxage\": \"P1D\"\n+                    \"ignored\": {\n+                        \"users\": [\n+                            \"user1\",\n+                            \"user2\"\n+                        ]\n@@ -53,5 +57,10 @@\n-                    \"pruned2\": {\n-                      \"maxage\": \"PT48H\"\n-                    },\n-                    \"pruned3\": {\n-                      \"maxage\": \"PT4320M\"\n+                    \"repositories\": {\n+                        \"pruned1\": {\n+                          \"maxage\": \"P1D\"\n+                        },\n+                        \"pruned2\": {\n+                          \"maxage\": \"PT48H\"\n+                        },\n+                        \"pruned3\": {\n+                          \"maxage\": \"PT4320M\"\n+                        }\n@@ -115,0 +124,1 @@\n+        assertEquals(Set.of(\"user1\", \"user2\"), pullRequestPrunerBot.getIgnoredUsers());\n@@ -116,1 +126,1 @@\n-}\n\\ No newline at end of file\n+}\n","filename":"bots\/bridgekeeper\/src\/test\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/BridgekeeperBotFactoryTest.java","additions":19,"deletions":9,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+import java.util.Set;\n@@ -41,1 +42,2 @@\n-            var bot = new PullRequestPrunerBot(Map.of(author, Duration.ofMillis(1)));\n+            var ignoredUser = credentials.getHostedRepository();\n+            var bot = new PullRequestPrunerBot(Map.of(author, Duration.ofMillis(1)), Set.of(\"user2\"));\n@@ -52,1 +54,1 @@\n-\n+            var ignoredUserPr = ignoredUser.pullRequest(pr.id());\n@@ -73,0 +75,3 @@\n+            \/\/ Post a comment as ignored User\n+            ignoredUserPr.addComment(\"It should be ignored\");\n+\n@@ -94,1 +99,1 @@\n-            var bot = new PullRequestPrunerBot(Map.of(author, Duration.ofDays(3)));\n+            var bot = new PullRequestPrunerBot(Map.of(author, Duration.ofDays(3)), Set.of());\n","filename":"bots\/bridgekeeper\/src\/test\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/PullRequestPrunerBotTests.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"}]}