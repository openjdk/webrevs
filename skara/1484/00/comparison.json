{"files":[{"patch":"@@ -140,1 +140,1 @@\n-        if (!baseHash.equals(lastBase) || !pr.headHash().equals(lastHead)) {\n+        if (!pr.isDraft() && (!baseHash.equals(lastBase) || !pr.headHash().equals(lastHead))) {\n","filename":"bots\/mlbridge\/src\/main\/java\/org\/openjdk\/skara\/bots\/mlbridge\/ReviewArchive.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3627,0 +3627,30 @@\n+\n+            \/\/ Push a new commit before making it as draft.\n+            var secondHash = CheckableRepository.appendAndCommit(localRepo, \"Second change\", \"Change msg\");\n+            localRepo.push(secondHash, author.url(), \"edit\", true);\n+\n+            \/\/ Make it as draft again.\n+            pr.makeDraft();\n+\n+            \/\/ Push a new commit after making it as draft.\n+            var thirdHash = CheckableRepository.appendAndCommit(localRepo, \"Third change\", \"Change msg\");\n+            localRepo.push(thirdHash, author.url(), \"edit\", true);\n+\n+            \/\/ Run another archive pass.\n+            TestBotRunner.runPeriodicItems(mlBot);\n+\n+            \/\/ The archive shouldn't contain any new commit.\n+            Repository.materialize(archiveFolder.path(), archive.url(), \"master\");\n+            assertEquals(5, archiveContainsCount(archiveFolder.path(), \"RFR: 1234: This is a pull request\"));\n+            assertFalse(archiveContains(archiveFolder.path(), \"RFR: 1234: This is a pull request \\\\[v2\\\\]\"));\n+\n+            \/\/ Make it as not draft again.\n+            pr.makeNotDraft();\n+\n+            \/\/ Run another archive pass.\n+            TestBotRunner.runPeriodicItems(mlBot);\n+\n+            \/\/ The archive should now contain all the comments.\n+            Repository.materialize(archiveFolder.path(), archive.url(), \"master\");\n+            assertEquals(6, archiveContainsCount(archiveFolder.path(), \"RFR: 1234: This is a pull request\"));\n+            assertEquals(1, archiveContainsCount(archiveFolder.path(), \"RFR: 1234: This is a pull request \\\\[v2\\\\]\"));\n","filename":"bots\/mlbridge\/src\/test\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListBridgeBotTests.java","additions":30,"deletions":0,"binary":false,"changes":30,"status":"modified"}]}