{"files":[{"patch":"@@ -651,1 +651,1 @@\n-    private boolean relaxedEquals(String s1, String s2) {\n+    static boolean relaxedEquals(String s1, String s2) {\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -61,1 +61,1 @@\n-            + \"(?::(?<space>[\\\\s\\u00A0\\u2007\\u202F]+)(?<title>.+))?$\");\n+            + \"(?::?(?<space>[\\\\s\\u00A0\\u2007\\u202F]+)(?<title>.+))?$\");\n@@ -216,0 +216,1 @@\n+                        issueData.append(issue.title());\n@@ -342,1 +343,2 @@\n-        var m = ISSUE_ID_PATTERN.matcher(pr.title());\n+        var oldPrTitle = pr.title();\n+        var m = ISSUE_ID_PATTERN.matcher(oldPrTitle.trim());\n@@ -360,0 +362,1 @@\n+                var newPrTitle = id + \": \" + issueTitle;\n@@ -363,1 +366,0 @@\n-                    var newPrTitle = id + \": \" + issueTitle;\n@@ -373,1 +375,0 @@\n-                        var newPrTitle = id + \": \" + issueTitle;\n@@ -377,1 +378,1 @@\n-                            \/\/ Remove remaning title, plus decorations\n+                            \/\/ Remove remaining title, plus decorations\n@@ -383,0 +384,10 @@\n+                    \/\/ Automatically update PR title if it's not in canonical form\n+                    if (title.equals(issueTitle) && !oldPrTitle.equals(newPrTitle)) {\n+                        pr.setTitle(newPrTitle);\n+                        return true;\n+                    }\n+                    \/\/ Automatically update PR title if titles are a relaxed match but not an exact match\n+                    if (!title.equals(issueTitle) && CheckRun.relaxedEquals(title, issueTitle)) {\n+                        pr.setTitle(newPrTitle);\n+                        return true;\n+                    }\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckWorkItem.java","additions":16,"deletions":5,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -860,1 +860,1 @@\n-            assertEquals(\"TEST-2: My second issue ending in space\", prCutOff2.store().title());\n+            assertEquals(\"2: My second issue ending in space\", prCutOff2.store().title());\n@@ -1852,0 +1852,12 @@\n+\n+            \/\/ Now update pr title to non-canonical form\n+            bugPR.setTitle(bug.id() + \" \" + bug.title());\n+            TestBotRunner.runPeriodicItems(checkBot);\n+            \/\/ Verify that the title is in canonical form\n+            assertEquals(numericId + \": \" + bug.title(), bugPR.store().title());\n+\n+            \/\/ Now update pr title to another non-canonical form\n+            bugPR.setTitle(bug.id() + \": \" + bug.title());\n+            TestBotRunner.runPeriodicItems(checkBot);\n+            \/\/ Verify that the title is in canonical form\n+            assertEquals(numericId + \": \" + bug.title(), bugPR.store().title());\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CheckTests.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -140,1 +140,3 @@\n-            \/\/ Extra run of prBot and issueBot\n+            \/\/ Update issue title and run prBot first\n+            \/\/ There should be no update in the check\n+            issue.setTitle(\"This is an Issue\");\n@@ -142,1 +144,0 @@\n-            TestBotRunner.runPeriodicItems(issueBot);\n@@ -146,0 +147,14 @@\n+\n+            \/\/ Run issueBot\n+            TestBotRunner.runPeriodicItems(issueBot);\n+            check = pr.checks(editHash).get(\"jcheck\");\n+            var completedTime8 = check.completedAt().get();\n+            assertNotEquals(completedTime7, completedTime8);\n+            assertEquals(\"1: This is an Issue\", pr.store().title());\n+\n+            \/\/ Extra run of prBot and issueBot\n+            TestBotRunner.runPeriodicItems(prBot);\n+            TestBotRunner.runPeriodicItems(issueBot);\n+            check = pr.checks(editHash).get(\"jcheck\");\n+            var completedTime9 = check.completedAt().get();\n+            assertEquals(completedTime8, completedTime9);\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/IssueBotTests.java","additions":18,"deletions":3,"binary":false,"changes":21,"status":"modified"}]}