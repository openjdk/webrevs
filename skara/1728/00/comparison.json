{"files":[{"patch":"@@ -93,0 +93,1 @@\n+    private boolean rfrPendingOnOtherWorkItems = false;\n@@ -267,8 +268,13 @@\n-        \/\/ If the bot has label configuration and the pr is already auto labelled, check if the pull request is associated with at least one component\n-        if (!workItem.bot.labelConfiguration().allowed().isEmpty() && workItem.bot.isAutoLabelled(pr)) {\n-            var existingAllowed = new HashSet<>(pr.labelNames());\n-            existingAllowed.retainAll(workItem.bot.labelConfiguration().allowed());\n-            if (existingAllowed.isEmpty()) {\n-                ret.add(\"This pull request must be associated with at least one component. \" +\n-                        \"Please use the [\/label](https:\/\/wiki.openjdk.org\/display\/SKARA\/Pull+Request+Commands#PullRequestCommands-\/label)\" +\n-                        \" pull request command.\");\n+        \/\/ If the bot has label configuration\n+        if (!workItem.bot.labelConfiguration().allowed().isEmpty()) {\n+            \/\/ If the pr is already auto labelled, check if the pull request is associated with at least one component\n+            if (workItem.bot.isAutoLabelled(pr)) {\n+                var existingAllowed = new HashSet<>(pr.labelNames());\n+                existingAllowed.retainAll(workItem.bot.labelConfiguration().allowed());\n+                if (existingAllowed.isEmpty()) {\n+                    ret.add(\"This pull request must be associated with at least one component. \" +\n+                            \"Please use the [\/label](https:\/\/wiki.openjdk.org\/display\/SKARA\/Pull+Request+Commands#PullRequestCommands-\/label)\" +\n+                            \" pull request command.\");\n+                }\n+            } else {\n+                rfrPendingOnOtherWorkItems = true;\n@@ -458,0 +464,7 @@\n+        \/\/ If rfr is still pending for other workItems, so don't mark this pr as rfr, wait for another round of CheckWorkItem\n+        if (rfrPendingOnOtherWorkItems) {\n+            newLabels.remove(\"rfr\");\n+            log.info(\"rfr is pending on other workItems for pr: \" + pr.id());\n+            return false;\n+        }\n+\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":21,"deletions":8,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -132,0 +132,7 @@\n+    \/**\n+     * Create Normal CheckWorkItem with force update\n+     *\/\n+    public static CheckWorkItem fromWorkItemWithForceUpdate(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt) {\n+        return new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, false, true, false, false);\n+    }\n+\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckWorkItem.java","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -125,1 +125,1 @@\n-            return List.of();\n+            return List.of(CheckWorkItem.fromWorkItemWithForceUpdate(bot, prId, errorHandler, triggerUpdatedAt));\n@@ -136,1 +136,1 @@\n-            return List.of();\n+            return List.of(CheckWorkItem.fromWorkItemWithForceUpdate(bot, prId, errorHandler, triggerUpdatedAt));\n@@ -144,1 +144,1 @@\n-            return List.of();\n+            return List.of(CheckWorkItem.fromWorkItemWithForceUpdate(bot, prId, errorHandler, triggerUpdatedAt));\n@@ -175,1 +175,1 @@\n-        return List.of();\n+        return List.of(CheckWorkItem.fromWorkItemWithForceUpdate(bot, prId, errorHandler, triggerUpdatedAt));\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/LabelerWorkItem.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -230,0 +230,1 @@\n+            \/\/ Since there is already a component associated, rfr should be added\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/LabelTests.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-            \/\/ Check the status - only the rfr label should be set\n+            \/\/ Check the status - rfr label should not be set since the pr is not associated with any component\n@@ -72,1 +72,1 @@\n-            assertEquals(Set.of(\"rfr\"), new HashSet<>(pr.labelNames()));\n+            assertEquals(Set.of(), new HashSet<>(pr.labelNames()));\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/LabelerTests.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}