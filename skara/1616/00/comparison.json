{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -203,0 +203,2 @@\n+        var command = nextCommand.get();\n+\n@@ -207,1 +209,23 @@\n-            throw new RuntimeException(e);\n+            var writer = new StringWriter();\n+            var printer = new PrintWriter(writer);\n+\n+            printer.println(String.format(COMMAND_REPLY_MARKER, command.id()));\n+            printer.print(\"@\");\n+            printer.print(command.user().username());\n+            printer.print(\" \");\n+            if (bot.confOverrideRepository().isEmpty()) {\n+                var branchNames = pr.repository().branches().stream().map(HostedBranch::name).toList();\n+                if (branchNames.contains(pr.targetRef())) {\n+                    printer.println(\"JCheck configuration is missing or invalid in the target branch of this pull request.\");\n+                } else {\n+                    printer.println(\"The target branch of this pull request no longer exists. Please retarget this pull request.\");\n+                }\n+            } else {\n+                log.severe(bot.confOverrideName() + \" on \" + bot.confOverrideRef() +\n+                        \" is missing or invalid in repo \" + bot.confOverrideRepository().get().name());\n+                printer.println(\"The JCheck configuration has been overridden, \" +\n+                        \"but it's missing or invalid. Skara admin has been noticed and will fix it as soon as possible.\");\n+            }\n+            printer.print(\"Please issue this command again once the problem has been resolved.\");\n+            pr.addComment(writer.toString());\n+            return List.of();\n@@ -209,1 +233,0 @@\n-        var command = nextCommand.get();\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestCommandWorkItem.java","additions":26,"deletions":3,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2380,0 +2380,19 @@\n+            var reviewerPr = reviewer.pullRequest(pr.id());\n+            \/\/ Close the pr so we can skip CheckWorkItem\n+            pr.setState(Issue.State.CLOSED);\n+            reviewerPr.addComment(\"\/reviewers 2\");\n+            TestBotRunner.runPeriodicItems(checkBot);\n+            assertEquals(\"<!-- Jmerge command reply message (1) -->\\n\" +\n+                    \"@user2 JCheck configuration is missing or invalid in the target branch of this pull request.\\n\" +\n+                    \"Please issue this command again once the problem has been resolved.\", pr.store().comments().get(2).body());\n+\n+            pr.setTargetRef(\"notExist\");\n+            reviewerPr.addComment(\"\/reviewers 2\");\n+            TestBotRunner.runPeriodicItems(checkBot);\n+            assertEquals(\"<!-- Jmerge command reply message (3) -->\\n\" +\n+                    \"@user2 The target branch of this pull request no longer exists. Please retarget this pull request.\\n\" +\n+                    \"Please issue this command again once the problem has been resolved.\", pr.store().comments().get(4).body());\n+\n+            pr.setTargetRef(\"master\");\n+            pr.setState(Issue.State.OPEN);\n+\n@@ -2407,0 +2426,1 @@\n+            var reviewer = credentials.getHostedRepository();\n@@ -2410,1 +2430,3 @@\n-                    .addAuthor(author.forge().currentUser().id());\n+                    .addAuthor(author.forge().currentUser().id())\n+                    .addReviewer(reviewer.forge().currentUser().id());\n+\n@@ -2446,0 +2468,10 @@\n+            var reviewerPr = reviewer.pullRequest(pr.id());\n+            \/\/ Close the pr so we can skip CheckWorkItem\n+            pr.setState(Issue.State.CLOSED);\n+            reviewerPr.addComment(\"\/reviewers 2\");\n+            TestBotRunner.runPeriodicItems(checkBot);\n+            assertEquals(\"<!-- Jmerge command reply message (1) -->\\n\" +\n+                    \"@user2 The JCheck configuration has been overridden, but it's missing or invalid. Skara admin has been noticed and will fix it as soon as possible.\\n\" +\n+                    \"Please issue this command again once the problem has been resolved.\", pr.store().comments().get(2).body());\n+            pr.setState(Issue.State.OPEN);\n+\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CheckTests.java","additions":33,"deletions":1,"binary":false,"changes":34,"status":"modified"}]}