{"files":[{"patch":"@@ -346,0 +346,1 @@\n+                    .onError(writeFileContentsOnError(filename, content, branch))\n@@ -351,16 +352,1 @@\n-                    .onError(response -> {\n-                        \/\/ When GitLab returns 400, it may have still performed the update, so\n-                        \/\/ need to check the current file contents.\n-                        if (response.statusCode() == 400) {\n-                            log.info(\"Received status code 400 when writing file \" + filename\n-                                    + \" in repo \" + name() + \", checking if file was stored anyway\");\n-                            var currentContents = fileContents(filename, branch.name());\n-                            if (currentContents.isPresent() && content.equals(currentContents.get())) {\n-                                \/\/ Need to return something other than empty\n-                                log.info(\"Writing file \" + filename + \" in repo \" + name()\n-                                        + \" was found to be successful in spite of return code 400\");\n-                                return Optional.of(JSON.of());\n-                            }\n-                        }\n-                        return Optional.empty();\n-                    })\n+                    .onError(writeFileContentsOnError(filename, content, branch))\n@@ -371,0 +357,19 @@\n+    private RestRequest.ErrorTransform writeFileContentsOnError(String filename, String content, Branch branch) {\n+        return response -> {\n+            \/\/ When GitLab returns 400, it may have still performed the update, so\n+            \/\/ need to check the current file contents.\n+            if (response.statusCode() == 400) {\n+                log.info(\"Received status code 400 when writing file \" + filename\n+                        + \" in repo \" + name() + \", checking if file was stored anyway\");\n+                var currentContents = fileContents(filename, branch.name());\n+                if (currentContents.isPresent() && content.equals(currentContents.get())) {\n+                    \/\/ Need to return something other than empty\n+                    log.info(\"Writing file \" + filename + \" in repo \" + name()\n+                            + \" was found to be successful in spite of return code 400\");\n+                    return Optional.of(JSON.of());\n+                }\n+            }\n+            return Optional.empty();\n+        };\n+    }\n+\n","filename":"forge\/src\/main\/java\/org\/openjdk\/skara\/forge\/gitlab\/GitLabRepository.java","additions":21,"deletions":16,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -151,1 +151,1 @@\n-    @EnabledIfTestProperties({\"gitlab.user\", \"gitlab.pat\", \"gitlab.uri\", \"gitlab.group\",\n+    @EnabledIfTestProperties({\"gitlab.user\", \"gitlab.pat\", \"gitlab.uri\",\n","filename":"forge\/src\/test\/java\/org\/openjdk\/skara\/forge\/gitlab\/GitLabIntegrationTests.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}