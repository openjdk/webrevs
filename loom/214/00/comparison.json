{"files":[{"patch":"@@ -48,1 +48,1 @@\n-                                  Register tmp1Reg, Register tmp2Reg, Register tmp3Reg) {\n+                                  Register tmp1Reg, Register tmp2Reg, Register tmp3Reg, Register tmp4Reg) {\n@@ -126,1 +126,1 @@\n-  Register tid = disp_hdr;\n+  Register tid = tmp4Reg;\n@@ -143,2 +143,0 @@\n-  \/\/ Reload markWord from object into displaced_header.\n-  ld(disp_hdr, Address(oop, oopDesc::mark_offset_in_bytes()));\n@@ -404,3 +402,4 @@\n-    \/\/ CAS owner (null => current thread).\n-    ld(tmp4, Address(xthread, JavaThread::lock_id_offset()));\n-    cmpxchg(\/*addr*\/ tmp2_owner_addr, \/*expected*\/ zr, \/*new*\/ tmp4, Assembler::int64,\n+    \/\/ CAS owner (null => current thread id).\n+    Register tid = tmp4;\n+    ld(tid, Address(xthread, JavaThread::lock_id_offset()));\n+    cmpxchg(\/*addr*\/ tmp2_owner_addr, \/*expected*\/ zr, \/*new*\/ tid, Assembler::int64,\n@@ -411,1 +410,1 @@\n-    bne(tmp3_owner, tmp4, slow_path);\n+    bne(tmp3_owner, tid, slow_path);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":7,"deletions":8,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -47,1 +47,2 @@\n-  void fast_lock(Register object, Register box, Register tmp1, Register tmp2, Register tmp3);\n+  void fast_lock(Register object, Register box,\n+                 Register tmp1, Register tmp2, Register tmp3, Register tmp4);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -10544,1 +10544,2 @@\n-instruct cmpFastLock(rFlagsReg cr, iRegP object, iRegP box, iRegPNoSp tmp1, iRegPNoSp tmp2, iRegPNoSp tmp3)\n+instruct cmpFastLock(rFlagsReg cr, iRegP object, iRegP box,\n+                     iRegPNoSp tmp1, iRegPNoSp tmp2, iRegPNoSp tmp3, iRegPNoSp tmp4)\n@@ -10548,1 +10549,1 @@\n-  effect(TEMP tmp1, TEMP tmp2, TEMP tmp3);\n+  effect(TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4);\n@@ -10551,1 +10552,1 @@\n-  format %{ \"fastlock $object,$box\\t! kills $tmp1,$tmp2,$tmp3, #@cmpFastLock\" %}\n+  format %{ \"fastlock $object,$box\\t! kills $tmp1,$tmp2,$tmp3,$tmp4 #@cmpFastLock\" %}\n@@ -10554,1 +10555,2 @@\n-    __ fast_lock($object$$Register, $box$$Register, $tmp1$$Register, $tmp2$$Register, $tmp3$$Register);\n+    __ fast_lock($object$$Register, $box$$Register,\n+                 $tmp1$$Register, $tmp2$$Register, $tmp3$$Register, $tmp4$$Register);\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"}]}