{"files":[{"patch":"@@ -232,0 +232,7 @@\n+\n+    <plugin\n+         id=\"org.openjdk.jmc.jolokia\"\n+         download-size=\"0\"\n+         install-size=\"0\"\n+         version=\"0.0.0\"\n+         unpack=\"false\"\/>\n","filename":"application\/org.openjdk.jmc.feature.core\/feature.xml","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<classpath>\n+\t<classpathentry kind=\"con\" path=\"org.eclipse.jdt.launching.JRE_CONTAINER\/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType\/JavaSE-17\">\n+\t\t<attributes>\n+\t\t\t<attribute name=\"module\" value=\"true\"\/>\n+\t\t<\/attributes>\n+\t<\/classpathentry>\n+\t<!-- Convenience: Regarding access rules. It appears that these packages are exported from jolokia standalone. Wondering whether eclipse caps at 36 access rules or something. Setting access rules on that specific plugin dependency does not seem to be persisted to the .classpath file, hence setting access policy globally for all plugin dependencies-->\n+\t<classpathentry kind=\"con\" path=\"org.eclipse.pde.core.requiredPlugins\">\n+\t\t<accessrules>\n+\t\t\t<accessrule kind=\"accessible\" pattern=\"org\/jolokia\/**\"\/>\n+\t\t\t<accessrule kind=\"accessible\" pattern=\"org\/json\/simple\/*\"\/>\n+\t\t<\/accessrules>\n+\t<\/classpathentry>\n+\t<classpathentry kind=\"src\" path=\"src\/main\/java\"\/>\n+\t<classpathentry kind=\"output\" path=\"target\/classes\"\/>\n+<\/classpath>\n","filename":"application\/org.openjdk.jmc.jolokia\/.classpath","additions":17,"deletions":0,"binary":false,"changes":17,"status":"added"},{"patch":"@@ -0,0 +1,18 @@\n+Manifest-Version: 1.0\n+Bundle-ManifestVersion: 2\n+Bundle-Name: %Bundle-Name\n+Bundle-SymbolicName: org.openjdk.jmc.jolokia;singleton:=true\n+Bundle-Version: 9.0.0.qualifier\n+Automatic-Module-Name: org.openjdk.jmc.jolokia\n+Bundle-RequiredExecutionEnvironment: JavaSE-17\n+Require-Bundle: org.eclipse.core.runtime,\n+ org.eclipse.ui,\n+ org.jolokia.jmx-adapter.standalone;bundle-version=\"1.7.2\";visibility:=reexport,\n+ org.jolokia.jvm;bundle-version=\"1.7.2\",\n+ org.openjdk.jmc.common,\n+ org.openjdk.jmc.rjmx,\n+ org.openjdk.jmc.ui\n+Export-Package:  org.openjdk.jmc.jolokia,\n+ org.openjdk.jmc.jolokia.preferences\n+Bundle-Activator: org.openjdk.jmc.jolokia.JmcJolokiaPlugin\n+Bundle-ActivationPolicy: lazy\n","filename":"application\/org.openjdk.jmc.jolokia\/META-INF\/MANIFEST.MF","additions":18,"deletions":0,"binary":false,"changes":18,"status":"added"},{"patch":"@@ -0,0 +1,3 @@\n+#Properties file for org.openjdk.jmc.jolokia\n+page.name = Jolokia\n+Bundle-Name = Jolokia JMC Connection\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.jolokia\/OSGI-INF\/l10n\/bundle.properties","additions":3,"deletions":0,"binary":false,"changes":3,"status":"added"},{"patch":"@@ -2,1 +2,2 @@\n-#  Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2024, Kantega AS. All rights reserved.\n@@ -32,1 +33,0 @@\n-#\n@@ -36,0 +36,1 @@\n+               OSGI-INF\/,\\\n@@ -38,2 +39,1 @@\n-               pages.xml\n-pde.match.rule.bundle=compatible\n+               OSGI-INF\/l10n\/bundle.properties\n","filename":"application\/org.openjdk.jmc.jolokia\/build.properties","additions":4,"deletions":4,"binary":false,"changes":8,"previous_filename":"application\/org.openjdk.jmc.flightrecorder.ext.g1\/build.properties","status":"copied"},{"patch":"@@ -0,0 +1,65 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--   \n+   Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+   Copyright (c) 2024, Kantega AS. All rights reserved.\n+   \n+   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+   \n+   The contents of this file are subject to the terms of either the Universal Permissive License \n+   v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+   \n+   or the following license:\n+   \n+   Redistribution and use in source and binary forms, with or without modification, are permitted\n+   provided that the following conditions are met:\n+   \n+   1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+   and the following disclaimer.\n+   \n+   2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+   conditions and the following disclaimer in the documentation and\/or other materials provided with\n+   the distribution.\n+   \n+   3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+   endorse or promote products derived from this software without specific prior written permission.\n+   \n+   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+   IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+   FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+   WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+   WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+-->\n+<?eclipse version=\"3.4\"?>\n+<plugin>\n+   <extension\n+         point=\"org.openjdk.jmc.rjmx.descriptorProvider\">\n+      <provider\n+            class=\"org.openjdk.jmc.jolokia.JolokiaDiscoveryListener\">\n+      <\/provider>\n+   <\/extension>\n+      <extension\n+         point=\"org.openjdk.jmc.rjmx.jmxProtocols\">\n+      <client\n+            class=\"org.openjdk.jmc.jolokia.JmcJolokiaJmxConnectionProvider\" protocol=\"jolokia\">\n+            <sysproperty name=\"running.in.jmc\" include=\"true\" \/>\n+      <\/client>\n+   <\/extension>\n+      <extension\n+            point=\"org.eclipse.ui.preferencePages\">\n+         <page\n+               category=\"org.openjdk.jmc.browser.preferences.BrowserPreferencePage\"\n+               class=\"org.openjdk.jmc.jolokia.preferences.JolokiaPreferencePage\"\n+               id=\"org.openjdk.jmc.jolokia.preferences.JolokiaPreferencePage\"\n+               name=\"%page.name\">\n+         <\/page>\n+      <\/extension>\n+      <extension\n+            point=\"org.eclipse.core.runtime.preferences\">\n+         <initializer\n+               class=\"org.openjdk.jmc.jolokia.preferences.PreferenceInitializer\">\n+         <\/initializer>\n+      <\/extension>\n+<\/plugin>\n","filename":"application\/org.openjdk.jmc.jolokia\/plugin.xml","additions":65,"deletions":0,"binary":false,"changes":65,"status":"added"},{"patch":"@@ -0,0 +1,49 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--   \n+   Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+   Copyright (c) 2024, Kantega AS. All rights reserved.\n+   \n+   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+   \n+   The contents of this file are subject to the terms of either the Universal Permissive License \n+   v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+   \n+   or the following license:\n+   \n+   Redistribution and use in source and binary forms, with or without modification, are permitted\n+   provided that the following conditions are met:\n+   \n+   1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+   and the following disclaimer.\n+   \n+   2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+   conditions and the following disclaimer in the documentation and\/or other materials provided with\n+   the distribution.\n+   \n+   3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+   endorse or promote products derived from this software without specific prior written permission.\n+   \n+   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+   IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+   FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+   WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+   WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+-->\n+<project xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\"\n+\txmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"\n+\txsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/xsd\/maven-4.0.0.xsd\">\n+\t<modelVersion>4.0.0<\/modelVersion>\n+\t<parent>\n+\t\t<groupId>org.openjdk.jmc<\/groupId>\n+\t\t<artifactId>missioncontrol.application<\/artifactId>\n+\t\t<version>${revision}${changelist}<\/version>\n+\t<\/parent>\n+\t<artifactId>org.openjdk.jmc.jolokia<\/artifactId>\n+\t<packaging>eclipse-plugin<\/packaging>\n+\t<properties>\n+\t\t<jmc.config.path>${project.basedir}\/..\/..\/configuration<\/jmc.config.path>\n+\t<\/properties>\n+<\/project>\n","filename":"application\/org.openjdk.jmc.jolokia\/pom.xml","additions":49,"deletions":0,"binary":false,"changes":49,"status":"added"},{"patch":"@@ -0,0 +1,161 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.openjdk.jmc.rjmx.descriptorprovider.AbstractDescriptorProvider;\n+import org.openjdk.jmc.rjmx.descriptorprovider.IDescriptorListener;\n+\n+\/**\n+ * The {@code AbstractCachedDescriptorProvider} keeps a list of identified JVMs that can be\n+ * refreshed in the background by some means of discovering JVMs. Listeners will be notified of any\n+ * changes.\n+ *\/\n+@SuppressWarnings(\"restriction\")\n+public abstract class AbstractCachedDescriptorProvider extends AbstractDescriptorProvider {\n+\n+\tprivate static final long LOCAL_REFRESH_INTERVAL = 20000;\n+\tprivate Scanner scanner;\n+\tprivate Thread scannerThread;\n+\t\/**\n+\t * Map<UUID, IServerDescriptor>\n+\t *\/\n+\tprivate final Map<String, ServerConnectionDescriptor> knownDescriptors = new HashMap<>();\n+\n+\t\/**\n+\t * This is where we periodically scan and report deltas to the listeners.\n+\t *\/\n+\tprivate class Scanner implements Runnable {\n+\t\tboolean isRunning;\n+\n+\t\t@Override\n+\t\tpublic void run() {\n+\t\t\tisRunning = true;\n+\t\t\twhile (isRunning) {\n+\t\t\t\ttry {\n+\t\t\t\t\tscan();\n+\t\t\t\t\tThread.sleep(LOCAL_REFRESH_INTERVAL);\n+\t\t\t\t} catch (InterruptedException ignore) {\n+\t\t\t\t\t\/\/ Don't mind being interrupted.\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n+\t\t\/**\n+\t\t * Marks this scanner as terminated.\n+\t\t *\/\n+\t\tpublic void shutdown() {\n+\t\t\tisRunning = false;\n+\t\t}\n+\n+\t\tprotected void scan() {\n+\t\t\tMap<String, ServerConnectionDescriptor> newOnes = discoverJvms();\n+\n+\t\t\tsynchronized (knownDescriptors) {\n+\t\t\t\t\/\/ Remove stale ones...\n+\t\t\t\tfor (Iterator<Entry<String, ServerConnectionDescriptor>> entryIterator = knownDescriptors.entrySet()\n+\t\t\t\t\t\t.iterator(); entryIterator.hasNext();) {\n+\t\t\t\t\tEntry<String, ServerConnectionDescriptor> entry = entryIterator.next();\n+\t\t\t\t\tif (newOnes.containsKey(entry.getKey())) {\n+\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t}\n+\t\t\t\t\tentryIterator.remove();\n+\t\t\t\t\tonDescriptorRemoved(entry.getKey());\n+\t\t\t\t}\n+\n+\t\t\t\t\/\/ Add new ones...\n+\t\t\t\tfor (Entry<String, ServerConnectionDescriptor> entry : newOnes.entrySet()) {\n+\t\t\t\t\tif (knownDescriptors.containsKey(entry.getKey())) {\n+\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t}\n+\t\t\t\t\tonDescriptorDetected(entry.getValue(), entry.getValue().getPath(), entry.getValue().serviceUrl(),\n+\t\t\t\t\t\t\tentry.getValue());\n+\t\t\t\t}\n+\t\t\t\tknownDescriptors.clear();\n+\t\t\t\tknownDescriptors.putAll(newOnes);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t\/**\n+\t * Sets up the thread.\n+\t *\/\n+\tprivate void initialize() {\n+\n+\t\tscanner = new Scanner();\n+\t\tscannerThread = new Thread(scanner, getName()); \/\/ $NON-NLS-1$\n+\t\tscannerThread.start();\n+\t}\n+\n+\tprotected abstract boolean isEnabled();\n+\n+\tprotected abstract Map<String, ServerConnectionDescriptor> discoverJvms();\n+\n+\t@Override\n+\tpublic void addDescriptorListener(IDescriptorListener l) {\n+\t\tsynchronized (m_descriptorListeners) {\n+\t\t\tif (m_descriptorListeners.size() == 0) {\n+\t\t\t\tsuper.addDescriptorListener(l);\n+\t\t\t\tinitialize();\n+\t\t\t} else {\n+\t\t\t\tsuper.addDescriptorListener(l);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void removeDescriptorListener(IDescriptorListener l) {\n+\t\tsynchronized (m_descriptorListeners) {\n+\t\t\tsuper.removeDescriptorListener(l);\n+\t\t\tif (m_descriptorListeners.size() == 0 && scanner != null) {\n+\t\t\t\tscanner.shutdown();\n+\t\t\t\tscannerThread.interrupt();\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t\/**\n+\t * Shuts down the scanner thread.\n+\t *\/\n+\tpublic void shutdown() {\n+\t\tif (scanner != null) {\n+\t\t\tscanner.shutdown();\n+\t\t}\n+\t}\n+\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/AbstractCachedDescriptorProvider.java","additions":161,"deletions":0,"binary":false,"changes":161,"status":"added"},{"patch":"@@ -0,0 +1,209 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import java.io.IOException;\n+import java.lang.management.ManagementFactory;\n+import java.util.LinkedList;\n+import java.util.Optional;\n+\n+import javax.management.AttributeNotFoundException;\n+import javax.management.Descriptor;\n+import javax.management.ImmutableDescriptor;\n+import javax.management.InstanceNotFoundException;\n+import javax.management.MBeanException;\n+import javax.management.MBeanInfo;\n+import javax.management.MBeanOperationInfo;\n+import javax.management.MBeanParameterInfo;\n+import javax.management.ObjectName;\n+import javax.management.modelmbean.DescriptorSupport;\n+import javax.management.openmbean.TabularData;\n+\n+import org.jolokia.client.J4pClient;\n+import org.jolokia.client.jmxadapter.RemoteJmxAdapter;\n+import org.jolokia.converter.Converters;\n+import org.jolokia.converter.json.JsonConvertOptions;\n+\n+\/**\n+ * Make JMC specific adjustments to Jolokia JMX connection. May consider to use the decorator\n+ * pattern if differences are big, but for now subclass\n+ *\/\n+public class JmcJolokiaJmxConnection extends RemoteJmxAdapter {\n+\n+\tprivate static final String UNKNOWN = \"Unknown\"; \/\/$NON-NLS-1$\n+\tprivate static final String DIAGNOSTIC_OPTIONS = \"com.sun.management:type=DiagnosticCommand\"; \/\/$NON-NLS-1$\n+\tprivate static final String PREFIX = \"dcmd.\"; \/\/$NON-NLS-1$\n+\tprivate static final String IMPACT = PREFIX + \"vmImpact\"; \/\/$NON-NLS-1$\n+\tprivate static final String NAME = PREFIX + \"name\"; \/\/$NON-NLS-1$\n+\tprivate static final String DESCRIPTION = PREFIX + \"description\"; \/\/$NON-NLS-1$\n+\tprivate static final String ARGUMENTS = PREFIX + \"arguments\"; \/\/$NON-NLS-1$\n+\tprivate static final String ARGUMENT_NAME = PREFIX + \"arg.name\"; \/\/$NON-NLS-1$\n+\tprivate static final String ARGUMENT_DESCRIPTION = PREFIX + \"arg.description\"; \/\/$NON-NLS-1$\n+\tprivate static final String ARGUMENT_MANDATORY = PREFIX + \"arg.isMandatory\"; \/\/$NON-NLS-1$\n+\tprivate static final String ARGUMENT_TYPE = PREFIX + \"arg.type\"; \/\/$NON-NLS-1$\n+\tprivate static final String ARGUMENT_OPTION = PREFIX + \"arg.isOption\"; \/\/$NON-NLS-1$\n+\tprivate static final String ARGUMENT_MULITPLE = PREFIX + \"arg.isMultiple\"; \/\/$NON-NLS-1$\n+\n+\tpublic JmcJolokiaJmxConnection(J4pClient client) throws IOException {\n+\t\tsuper(client);\n+\t}\n+\n+\t@Override\n+\tpublic MBeanInfo getMBeanInfo(ObjectName name) throws InstanceNotFoundException, IOException {\n+\t\tMBeanInfo mBeanInfo = super.getMBeanInfo(name);\n+\t\t\/\/ the diagnostic options tab and memory relies on descriptor info in MBeanInfo,\n+\t\t\/\/ modify descriptors the first time\n+\t\tif (DIAGNOSTIC_OPTIONS.equals(name.getCanonicalName())\n+\t\t\t\t&& mBeanInfo.getOperations()[0].getDescriptor() == ImmutableDescriptor.EMPTY_DESCRIPTOR) {\n+\n+\t\t\tMBeanOperationInfo[] modifiedOperations = new MBeanOperationInfo[mBeanInfo.getOperations().length];\n+\n+\t\t\tfor (int i = 0; i < mBeanInfo.getOperations().length; i++) {\n+\t\t\t\tmodifiedOperations[i] = stealOrBuildOperationInfo(mBeanInfo.getOperations()[i],\n+\t\t\t\t\t\tcheckForLocalOperationInfo(name));\n+\t\t\t}\n+\t\t\t\/\/create a copy with modified operations in place of the original MBeanInfo in the cache\n+\t\t\tfinal MBeanInfo modifiedMBeanInfo = new MBeanInfo(mBeanInfo.getClassName(), mBeanInfo.getDescription(),\n+\t\t\t\t\tmBeanInfo.getAttributes(), mBeanInfo.getConstructors(), modifiedOperations,\n+\t\t\t\t\tmBeanInfo.getNotifications());\n+\t\t\tthis.mbeanInfoCache.put(name, modifiedMBeanInfo);\n+\t\t\treturn modifiedMBeanInfo;\n+\t\t}\n+\t\treturn mBeanInfo;\n+\t}\n+\n+\tprivate Optional<MBeanInfo> checkForLocalOperationInfo(ObjectName name) {\n+\t\tMBeanInfo localInfo;\n+\t\ttry {\n+\t\t\tlocalInfo = ManagementFactory.getPlatformMBeanServer().getMBeanInfo(name);\n+\t\t} catch (Exception ignore) {\n+\t\t\tlocalInfo = null;\n+\t\t}\n+\t\treturn Optional.ofNullable(localInfo);\n+\t}\n+\n+\t@Override\n+\tpublic Object invoke(ObjectName name, String operationName, Object[] params, String[] signature)\n+\t\t\tthrows InstanceNotFoundException, MBeanException, IOException {\n+\t\tfor (int i = 0; i < params.length; i++) {\n+\t\t\tObject object = params[i];\n+\t\t\tif (object instanceof TabularData) {\n+\t\t\t\ttry {\n+\t\t\t\t\tparams[i] = new Converters().getToJsonConverter().convertToJson(object, new LinkedList<String>(),\n+\t\t\t\t\t\t\tJsonConvertOptions.DEFAULT);\n+\t\t\t\t} catch (AttributeNotFoundException ignore) {\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t}\n+\t\treturn super.invoke(name, operationName, params, signature);\n+\t}\n+\n+\t\/**\n+\t * Build MBeanOperationInfo by taking information from the corresponding MBean in the local JVM\n+\t * for a more precise signature. If it is not available locally, attempt to construct it from\n+\t * the metadata from Jolokia.\n+\t * \n+\t * @param original\n+\t *            MBeanInfo from Jolokia list.\n+\t * @param localInfo\n+\t *            MBeanInfo from this JVM to use for getting descriptor.\n+\t * @return Descriptor\n+\t *\/\n+\tprivate MBeanOperationInfo stealOrBuildOperationInfo(MBeanOperationInfo original, Optional<MBeanInfo> localInfo) {\n+\t\treturn localInfo.map(info -> checkForMatchingLocalOperation(original, info))\/\/ first attempt to get descriptor from local copy\n+\t\t\t\t.orElseGet(() -> reverseEngineerOperationInfo(original));\/\/ if not, reverse engineer descriptor from operation info\n+\t}\n+\n+\tprivate MBeanOperationInfo checkForMatchingLocalOperation(MBeanOperationInfo original, MBeanInfo info) {\n+\t\tfor (MBeanOperationInfo localOperation : info.getOperations()) {\n+\t\t\tif (localOperation.getName().equals(original.getName())) {\n+\t\t\t\tif (localOperation.getSignature().length == original.getSignature().length) {\n+\t\t\t\t\tfor (int i = 0; i < original.getSignature().length; i++) {\n+\t\t\t\t\t\tMBeanParameterInfo param = original.getSignature()[i];\n+\t\t\t\t\t\tif (!param.getType().equals(localOperation.getSignature()[i].getType())) {\n+\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t} else if (i == original.getSignature().length - 1) {\n+\t\t\t\t\t\t\t\/\/ whole signature matches, use as replacement\n+\t\t\t\t\t\t\treturn localOperation;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\treturn null;\n+\t}\n+\n+\tprivate MBeanOperationInfo reverseEngineerOperationInfo(MBeanOperationInfo original) {\n+\t\tDescriptorSupport result = new DescriptorSupport();\n+\t\tresult.setField(NAME, original.getName());\n+\t\tresult.setField(DESCRIPTION, original.getDescription());\n+\t\tresult.setField(IMPACT, UNKNOWN);\n+\t\tresult.setField(ARGUMENTS, buildArguments(original.getSignature()));\n+\t\treturn new MBeanOperationInfo(original.getName(), original.getDescription(), original.getSignature(),\n+\t\t\t\toriginal.getReturnType(), MBeanOperationInfo.UNKNOWN, result);\n+\t}\n+\n+\tprivate Descriptor buildArguments(MBeanParameterInfo[] signature) {\n+\t\tDescriptorSupport parameters = new DescriptorSupport();\n+\t\tfor (MBeanParameterInfo parameter : signature) {\n+\t\t\tparameters.setField(parameter.getName(), buildArgument(parameter));\n+\t\t}\n+\t\treturn parameters;\n+\t}\n+\n+\tprivate Descriptor buildArgument(MBeanParameterInfo parameter) {\n+\t\tDescriptorSupport result = new DescriptorSupport();\n+\t\tresult.setField(ARGUMENT_NAME, parameter.getName());\n+\t\tboolean isMultiple = parameter.getType().startsWith(\"[\"); \/\/$NON-NLS-1$\n+\t\tresult.setField(ARGUMENT_MULITPLE, String.valueOf(isMultiple));\n+\t\tString type = parameter.getType();\n+\t\tif (isMultiple) {\n+\t\t\tif (type.startsWith(\"[L\")) { \/\/$NON-NLS-1$\n+\t\t\t\ttype = type.substring(2);\n+\t\t\t} else {\n+\t\t\t\ttype = type.substring(1);\n+\t\t\t}\n+\n+\t\t}\n+\t\t\/\/ probably more reverse mapping of types should be done here, but we hope it is\n+\t\t\/\/ sufficient\n+\t\tresult.setField(ARGUMENT_TYPE, type);\n+\t\tresult.setField(ARGUMENT_DESCRIPTION, parameter.getDescription());\n+\t\tresult.setField(ARGUMENT_MANDATORY, \"false\"); \/\/$NON-NLS-1$\n+\t\tresult.setField(ARGUMENT_OPTION, \"false\"); \/\/$NON-NLS-1$\n+\t\treturn result;\n+\t}\n+\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/JmcJolokiaJmxConnection.java","additions":209,"deletions":0,"binary":false,"changes":209,"status":"added"},{"patch":"@@ -0,0 +1,52 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.util.Map;\n+\n+import javax.management.remote.JMXConnector;\n+import javax.management.remote.JMXConnectorProvider;\n+import javax.management.remote.JMXServiceURL;\n+\n+public class JmcJolokiaJmxConnectionProvider implements JMXConnectorProvider {\n+\t@Override\n+\tpublic JMXConnector newJMXConnector(JMXServiceURL serviceURL, Map<String, ?> environment) throws IOException {\n+\t\tif (!\"jolokia\".equals(serviceURL.getProtocol())) { \/\/$NON-NLS-1$\n+\t\t\tthrow new MalformedURLException(\"I only serve Jolokia connections\"); \/\/$NON-NLS-1$\n+\t\t}\n+\t\treturn new JmcJolokiaJmxConnector(serviceURL, environment);\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/JmcJolokiaJmxConnectionProvider.java","additions":52,"deletions":0,"binary":false,"changes":52,"status":"added"},{"patch":"@@ -0,0 +1,56 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import java.io.IOException;\n+import java.util.Map;\n+\n+import javax.management.remote.JMXServiceURL;\n+\n+import org.jolokia.client.J4pClientBuilder;\n+import org.jolokia.client.jmxadapter.JolokiaJmxConnector;\n+import org.jolokia.client.jmxadapter.RemoteJmxAdapter;\n+\n+public class JmcJolokiaJmxConnector extends JolokiaJmxConnector {\n+\n+\tpublic JmcJolokiaJmxConnector(JMXServiceURL serviceURL, Map<String, ?> environment) {\n+\t\tsuper(serviceURL, environment);\n+\t}\n+\n+\t@Override\n+\tprotected RemoteJmxAdapter instantiateAdapter(J4pClientBuilder clientBuilder, Map<String, Object> mergedEnv)\n+\t\t\tthrows IOException {\n+\t\treturn new JmcJolokiaJmxConnection(clientBuilder.build());\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/JmcJolokiaJmxConnector.java","additions":56,"deletions":0,"binary":false,"changes":56,"status":"added"},{"patch":"@@ -0,0 +1,51 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import org.openjdk.jmc.ui.MCAbstractUIPlugin;\n+\n+public class JmcJolokiaPlugin extends MCAbstractUIPlugin {\n+\n+\tpublic final static String PLUGIN_ID = \"org.openjdk.jmc.jolokia\"; \/\/$NON-NLS-1$\n+\tprivate static JmcJolokiaPlugin plugin;\n+\n+\tpublic JmcJolokiaPlugin() {\n+\t\tsuper(PLUGIN_ID);\n+\t\tplugin = this;\n+\t}\n+\n+\tpublic static JmcJolokiaPlugin getDefault() {\n+\t\treturn plugin;\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/JmcJolokiaPlugin.java","additions":51,"deletions":0,"binary":false,"changes":51,"status":"added"},{"patch":"@@ -0,0 +1,203 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import java.io.IOException;\n+import java.lang.management.ManagementFactory;\n+import java.net.MalformedURLException;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.management.Attribute;\n+import javax.management.AttributeList;\n+import javax.management.InstanceNotFoundException;\n+import javax.management.MalformedObjectNameException;\n+import javax.management.ObjectName;\n+import javax.management.openmbean.CompositeDataSupport;\n+import javax.management.openmbean.TabularDataSupport;\n+import javax.management.remote.JMXServiceURL;\n+\n+import org.jolokia.client.jmxadapter.RemoteJmxAdapter;\n+import org.openjdk.jmc.common.jvm.Connectable;\n+import org.openjdk.jmc.common.jvm.JVMArch;\n+import org.openjdk.jmc.common.jvm.JVMDescriptor;\n+import org.openjdk.jmc.common.jvm.JVMType;\n+\n+\/**\n+ * Provide data about JVMs accessed over Jolokia for the JVM browser\n+ *\/\n+public class JolokiaAgentDescriptor implements ServerConnectionDescriptor {\n+\n+\tpublic static final JVMDescriptor NULL_DESCRIPTOR = new JVMDescriptor(null, null, null, null, null, null, null,\n+\t\t\tnull, false, Connectable.UNKNOWN);\n+\tprivate final JMXServiceURL serviceUrl;\n+\tprivate final Map<String, ?> agentData;\n+\tprivate final JVMDescriptor jvmDescriptor;\n+\n+\tpublic JolokiaAgentDescriptor(Map<String, ?> agentData, JVMDescriptor jvmDescriptor)\n+\t\t\tthrows URISyntaxException, MalformedURLException {\n+\t\tsuper();\n+\t\tURI uri = new URI((String) agentData.get(\"url\")); \/\/$NON-NLS-1$\n+\t\tthis.serviceUrl = new JMXServiceURL(\n+\t\t\t\tString.format(\"service:jmx:jolokia:\/\/%s:%s%s\", uri.getHost(), uri.getPort(), uri.getPath())); \/\/$NON-NLS-1$\n+\t\tthis.agentData = agentData;\n+\t\tthis.jvmDescriptor = jvmDescriptor;\n+\t}\n+\n+\tJMXServiceURL getServiceUrl() {\n+\t\treturn serviceUrl;\n+\t}\n+\n+\t@Override\n+\tpublic String getGUID() {\n+\t\treturn String.valueOf(agentData.get(\"agent_id\")); \/\/$NON-NLS-1$\n+\t}\n+\n+\t@Override\n+\tpublic String getDisplayName() {\n+\t\treturn String.valueOf(agentData.get(\"agent_id\")); \/\/$NON-NLS-1$\n+\t}\n+\n+\t@Override\n+\tpublic JVMDescriptor getJvmInfo() {\n+\t\treturn this.jvmDescriptor;\n+\t}\n+\n+\t\/**\n+\t * Best effort to extract JVM information from a connection if everything works. Can be adjusted\n+\t * to support different flavors of JVM.\n+\t *\/\n+\tpublic static JVMDescriptor attemptToGetJvmInfo(RemoteJmxAdapter adapter) {\n+\n+\t\ttry {\n+\t\t\tAttributeList attributes = adapter.getAttributes(new ObjectName(ManagementFactory.RUNTIME_MXBEAN_NAME),\n+\t\t\t\t\tnew String[] {\"Pid\", \"Name\", \"InputArguments\", \"SystemProperties\"}); \/\/$NON-NLS-1$ \/\/$NON-NLS-2$ \/\/$NON-NLS-3$ \/\/$NON-NLS-4$\n+\t\t\tInteger pid = null;\n+\t\t\tString arguments = null, javaCommand = null, javaVersion = null, vmName = null, vmVendor = null;\n+\t\t\tboolean isDebug = false;\n+\t\t\tJVMType type = JVMType.UNKNOWN;\n+\t\t\tJVMArch arch = JVMArch.UNKNOWN;\n+\t\t\tfor (Attribute attribute : attributes.asList()) {\n+\t\t\t\t\/\/ newer JVM have pid as separate attribute, older have to parse from name\n+\t\t\t\tif (attribute.getName().equalsIgnoreCase(\"Pid\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\ttry {\n+\t\t\t\t\t\tpid = Integer.valueOf(String.valueOf(attribute.getValue()));\n+\t\t\t\t\t} catch (NumberFormatException ignore) {\n+\t\t\t\t\t}\n+\t\t\t\t} else if (attribute.getName().equalsIgnoreCase(\"Name\") && pid == null) { \/\/$NON-NLS-1$\n+\t\t\t\t\tString pidAndHost = String.valueOf(attribute.getValue());\n+\t\t\t\t\tint separator = pidAndHost.indexOf('@');\n+\t\t\t\t\tif (separator > 0) {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tpid = Integer.valueOf(pidAndHost.substring(0, separator));\n+\t\t\t\t\t\t} catch (NumberFormatException e) {\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t} else if (attribute.getName().equalsIgnoreCase(\"InputArguments\")) { \/\/$NON-NLS-1$\n+\n+\t\t\t\t\tif (attribute.getValue() instanceof String[]) {\n+\t\t\t\t\t\targuments = Arrays.toString((String[]) attribute.getValue());\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\targuments = String.valueOf(attribute.getValue());\n+\t\t\t\t\t}\n+\t\t\t\t\tif (arguments.contains(\"-agentlib:jdwp\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\tisDebug = true;\n+\t\t\t\t\t}\n+\t\t\t\t} else if (attribute.getName().equalsIgnoreCase(\"SystemProperties\") \/\/$NON-NLS-1$\n+\t\t\t\t\t\t&& attribute.getValue() instanceof TabularDataSupport) {\n+\t\t\t\t\tTabularDataSupport systemProperties = (TabularDataSupport) attribute.getValue();\n+\n+\t\t\t\t\t\/\/ quite clumsy: iterate over properties as we need to use the exact key, which is non trivial\n+\t\t\t\t\t\/\/ to reproduce\n+\t\t\t\t\tfor (Object entry : systemProperties.values()) {\n+\t\t\t\t\t\tString key = ((CompositeDataSupport) entry).get(\"key\").toString(); \/\/$NON-NLS-1$\n+\t\t\t\t\t\tString value = ((CompositeDataSupport) entry).get(\"value\").toString(); \/\/$NON-NLS-1$\n+\t\t\t\t\t\tif (key.equalsIgnoreCase(\"sun.management.compiler\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\tif (value.toLowerCase().contains(\"hotspot\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\t\ttype = JVMType.HOTSPOT;\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t} else if (key.equalsIgnoreCase(\"sun.arch.data.model\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\tString archIndicator = value;\n+\t\t\t\t\t\t\tif (archIndicator.contains(\"64\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\t\tarch = JVMArch.BIT64;\n+\t\t\t\t\t\t\t} else if (archIndicator.contains(\"32\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\t\tarch = JVMArch.BIT32;\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t} else if (key.equalsIgnoreCase(\"sun.java.command\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\tjavaCommand = value;\n+\t\t\t\t\t\t} else if (key.equalsIgnoreCase(\"java.version\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\tjavaVersion = value;\n+\t\t\t\t\t\t} else if (key.equalsIgnoreCase(\"java.vm.name\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\tvmName = value;\n+\t\t\t\t\t\t} else if (key.equalsIgnoreCase(\"java.vm.vendor\")) { \/\/$NON-NLS-1$\n+\t\t\t\t\t\t\tvmVendor = value;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\n+\t\t\t\t}\n+\n+\t\t\t}\n+\t\t\treturn new JVMDescriptor(javaVersion, type, arch, javaCommand, arguments, vmName, vmVendor, pid, isDebug,\n+\t\t\t\t\tConnectable.UNKNOWN);\n+\n+\t\t} catch (RuntimeException | IOException | InstanceNotFoundException | MalformedObjectNameException ignore) {\n+\t\t\treturn NULL_DESCRIPTOR;\n+\t\t}\n+\n+\t}\n+\n+\t@Override\n+\tpublic JMXServiceURL createJMXServiceURL() throws IOException {\n+\t\treturn serviceUrl;\n+\t}\n+\n+\t@Override\n+\tpublic Map<String, Object> getEnvironment() {\n+\t\treturn new HashMap<>();\n+\t}\n+\n+\t@Override\n+\tpublic String getPath() {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic JMXServiceURL serviceUrl() {\n+\t\treturn this.serviceUrl;\n+\t}\n+\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/JolokiaAgentDescriptor.java","additions":203,"deletions":0,"binary":false,"changes":203,"status":"added"},{"patch":"@@ -0,0 +1,99 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import java.io.IOException;\n+\n+import java.net.URISyntaxException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.jolokia.client.jmxadapter.RemoteJmxAdapter;\n+import org.jolokia.discovery.JolokiaDiscovery;\n+import org.jolokia.util.JulLogHandler;\n+import org.openjdk.jmc.common.jvm.JVMDescriptor;\n+import org.openjdk.jmc.jolokia.preferences.PreferenceConstants;\n+\n+\/**\n+ * Add found Jolokia instances to the JVM browser using the Jolokia discovery mechanism.\n+ * https:\/\/jolokia.org\/reference\/html\/protocol.html#discovery\n+ *\/\n+public class JolokiaDiscoveryListener extends AbstractCachedDescriptorProvider implements PreferenceConstants {\n+\n+\t@Override\n+\tprotected Map<String, ServerConnectionDescriptor> discoverJvms() {\n+\t\tMap<String, ServerConnectionDescriptor> found = new HashMap<>();\n+\t\tif (!JmcJolokiaPlugin.getDefault().getPreferenceStore().getBoolean(P_SCAN)) {\n+\t\t\treturn found;\n+\t\t}\n+\t\ttry {\n+\t\t\tfor (Object object : new JolokiaDiscovery(\"jmc\", new JulLogHandler()).lookupAgents()) { \/\/$NON-NLS-1$\n+\t\t\t\ttry {\n+\n+\t\t\t\t\t@SuppressWarnings(\"unchecked\")\n+\t\t\t\t\tMap<String, ?> response = (Map<String, ?>) object;\n+\t\t\t\t\tJVMDescriptor jvmInfo;\n+\t\t\t\t\ttry {\/\/ if it is connectable, see if we can get info from connection\n+\t\t\t\t\t\tjvmInfo = JolokiaAgentDescriptor\n+\t\t\t\t\t\t\t\t.attemptToGetJvmInfo(new RemoteJmxAdapter(String.valueOf(response.get(\"url\")))); \/\/$NON-NLS-1$\n+\t\t\t\t\t} catch (Exception ignore) {\n+\t\t\t\t\t\tjvmInfo = JolokiaAgentDescriptor.NULL_DESCRIPTOR;\n+\t\t\t\t\t}\n+\t\t\t\t\tJolokiaAgentDescriptor agentDescriptor = new JolokiaAgentDescriptor(response, jvmInfo);\n+\t\t\t\t\tfound.put(agentDescriptor.getGUID(), agentDescriptor);\n+\n+\t\t\t\t} catch (URISyntaxException ignore) {\n+\t\t\t\t}\n+\t\t\t}\n+\t\t} catch (IOException ignore) {\n+\t\t}\n+\t\treturn found;\n+\t}\n+\n+\t@Override\n+\tpublic String getDescription() {\n+\t\treturn Messages.JolokiaDiscoveryListener_Description;\n+\t}\n+\n+\t@Override\n+\tpublic String getName() {\n+\t\treturn \"jolokia\"; \/\/$NON-NLS-1$\n+\t}\n+\n+\t@Override\n+\tprotected boolean isEnabled() {\n+\t\treturn true;\n+\t}\n+\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/JolokiaDiscoveryListener.java","additions":99,"deletions":0,"binary":false,"changes":99,"status":"added"},{"patch":"@@ -0,0 +1,48 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import org.eclipse.osgi.util.NLS;\n+\n+public class Messages extends NLS {\n+\tprivate static final String BUNDLE_NAME = \"org.openjdk.jmc.jolokia.messages\"; \/\/$NON-NLS-1$\n+\tpublic static String JolokiaDiscoveryListener_Description;\n+\tstatic {\n+\t\t\/\/ initialize resource bundle\n+\t\tNLS.initializeMessages(BUNDLE_NAME, Messages.class);\n+\t}\n+\n+\tprivate Messages() {\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/Messages.java","additions":48,"deletions":0,"binary":false,"changes":48,"status":"added"},{"patch":"@@ -0,0 +1,48 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import javax.management.remote.JMXServiceURL;\n+\n+import org.openjdk.jmc.rjmx.common.IConnectionDescriptor;\n+import org.openjdk.jmc.rjmx.common.IServerDescriptor;\n+\n+\/**\n+ * Describes the JVM and how to connect to it.\n+ *\/\n+public interface ServerConnectionDescriptor extends IServerDescriptor, IConnectionDescriptor {\n+\tString getPath();\n+\n+\tJMXServiceURL serviceUrl();\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/ServerConnectionDescriptor.java","additions":48,"deletions":0,"binary":false,"changes":48,"status":"added"},{"patch":"@@ -0,0 +1,1 @@\n+JolokiaDiscoveryListener_Description=Uses Jolokia Discovery to report any active JVMs with Jolokia broadcasting\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/messages.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"added"},{"patch":"@@ -0,0 +1,64 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia.preferences;\n+\n+import org.eclipse.jface.preference.BooleanFieldEditor;\n+import org.eclipse.jface.preference.FieldEditorPreferencePage;\n+import org.eclipse.ui.IWorkbench;\n+import org.eclipse.ui.IWorkbenchPreferencePage;\n+import org.openjdk.jmc.jolokia.JmcJolokiaPlugin;\n+\n+public class JolokiaPreferencePage extends FieldEditorPreferencePage implements IWorkbenchPreferencePage {\n+\n+\tpublic JolokiaPreferencePage() {\n+\t\tsuper(GRID);\n+\t\tsetPreferenceStore(JmcJolokiaPlugin.getDefault().getPreferenceStore());\n+\t\tsetDescription(Messages.JolokiaPreferencePage_Description);\n+\t}\n+\n+\tpublic void createFieldEditors() {\n+\t\taddField(new BooleanFieldEditor(PreferenceConstants.P_SCAN, Messages.JolokiaPreferencePage_Label,\n+\t\t\t\tgetFieldEditorParent()));\n+\n+\t}\n+\n+\t\/*\n+\t * (non-Javadoc)\n+\t * \n+\t * @see org.eclipse.ui.IWorkbenchPreferencePage#init(org.eclipse.ui.IWorkbench)\n+\t *\/\n+\tpublic void init(IWorkbench workbench) {\n+\t}\n+\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/preferences\/JolokiaPreferencePage.java","additions":64,"deletions":0,"binary":false,"changes":64,"status":"added"},{"patch":"@@ -0,0 +1,49 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia.preferences;\n+\n+import org.eclipse.osgi.util.NLS;\n+\n+public class Messages extends NLS {\n+\tprivate static final String BUNDLE_NAME = \"org.openjdk.jmc.jolokia.preferences.messages\"; \/\/$NON-NLS-1$\n+\tpublic static String JolokiaPreferencePage_Description;\n+\tpublic static String JolokiaPreferencePage_Label;\n+\tstatic {\n+\t\t\/\/ initialize resource bundle\n+\t\tNLS.initializeMessages(BUNDLE_NAME, Messages.class);\n+\t}\n+\n+\tprivate Messages() {\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/preferences\/Messages.java","additions":49,"deletions":0,"binary":false,"changes":49,"status":"added"},{"patch":"@@ -0,0 +1,43 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia.preferences;\n+\n+\/**\n+ * Constant definitions for plug-in preferences.\n+ *\/\n+public interface PreferenceConstants {\n+\n+\tpublic static final String P_SCAN = \"discoverJolokia\"; \/\/$NON-NLS-1$\n+\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/preferences\/PreferenceConstants.java","additions":43,"deletions":0,"binary":false,"changes":43,"status":"added"},{"patch":"@@ -0,0 +1,56 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia.preferences;\n+\n+import org.eclipse.core.runtime.preferences.AbstractPreferenceInitializer;\n+import org.eclipse.jface.preference.IPreferenceStore;\n+import org.openjdk.jmc.jolokia.JmcJolokiaPlugin;\n+\n+\/**\n+ * Class used to initialize default preference values.\n+ *\/\n+public class PreferenceInitializer extends AbstractPreferenceInitializer {\n+\n+\t\/*\n+\t * (non-Javadoc)\n+\t * \n+\t * @see org.eclipse.core.runtime.preferences.AbstractPreferenceInitializer#\n+\t * initializeDefaultPreferences()\n+\t *\/\n+\tpublic void initializeDefaultPreferences() {\n+\t\tIPreferenceStore store = JmcJolokiaPlugin.getDefault().getPreferenceStore();\n+\t\tstore.setDefault(PreferenceConstants.P_SCAN, false);\n+\t}\n+\n+}\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/preferences\/PreferenceInitializer.java","additions":56,"deletions":0,"binary":false,"changes":56,"status":"added"},{"patch":"@@ -0,0 +1,2 @@\n+JolokiaPreferencePage_Description=Discover Jolokia Agents\\n\\nhttps:\/\/jolokia.org\/reference\/html\/protocol.html\\#discovery\\n\\n\n+JolokiaPreferencePage_Label=&Discover Jolokia agents\n","filename":"application\/org.openjdk.jmc.jolokia\/src\/main\/java\/org\/openjdk\/jmc\/jolokia\/preferences\/messages.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"added"},{"patch":"@@ -0,0 +1,102 @@\n+\/*\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, Red Hat Inc. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.rjmx.internal;\n+\n+import java.io.IOException;\n+import java.util.Map;\n+import java.util.logging.Level;\n+\n+import javax.management.remote.JMXConnector;\n+import javax.management.remote.JMXConnectorProvider;\n+import javax.management.remote.JMXServiceURL;\n+\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.IConfigurationElement;\n+import org.eclipse.core.runtime.IExtensionRegistry;\n+import org.eclipse.core.runtime.Platform;\n+import org.openjdk.jmc.rjmx.RJMXPlugin;\n+\n+public class ProtocolInitializer {\n+\tprivate final static String EXTENSION_POINT = \"org.openjdk.jmc.rjmx.jmxProtocols\";\/\/$NON-NLS-1$\n+\tprivate final static String EXTENSION_ELEMENT_CLIENT = \"client\";\/\/$NON-NLS-1$\n+\tprivate final static String EXTENSION_ATTRIBUTE_CLASS = \"class\";\/\/$NON-NLS-1$\n+\tprivate final static String EXTENSION_ATTRIBUTE_PROTOCOL = \"protocol\";\/\/$NON-NLS-1$\n+\tprivate final static String ATTRIBUTE_KEY = \"name\"; \/\/$NON-NLS-1$\n+\tprivate final static String TAG_SYSPROPERTY = \"sysproperty\"; \/\/$NON-NLS-1$\n+\tprivate final static String ATTRIBUTE_INCLUDE = \"include\"; \/\/$NON-NLS-1$\n+\tprivate final static String ATTRIBUTE_SEPARATOR = \"separator\"; \/\/$NON-NLS-1$\n+\n+\tpublic JMXConnector newJMXConnector(JMXServiceURL serviceURL, Map<String, ?> environment) throws IOException {\n+\t\t@SuppressWarnings(\"unchecked\")\n+\t\tJMXConnectorProvider realProvider = findProtocolExtension(serviceURL);\n+\t\tif (realProvider == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\treturn realProvider.newJMXConnector(serviceURL, environment);\n+\t}\n+\n+\tpublic JMXConnectorProvider findProtocolExtension(JMXServiceURL serviceURL) {\n+\t\ttry {\n+\t\t\tIExtensionRegistry registry = Platform.getExtensionRegistry();\n+\t\t\tfor (IConfigurationElement config : registry.getConfigurationElementsFor(EXTENSION_POINT)) {\n+\t\t\t\tif (config.getName().equals(EXTENSION_ELEMENT_CLIENT)) {\n+\t\t\t\t\tfinal String protocol = config.getAttribute(EXTENSION_ATTRIBUTE_PROTOCOL);\n+\t\t\t\t\tif (serviceURL.getProtocol().equals(protocol)) {\n+\t\t\t\t\t\tJMXConnectorProvider provider = (JMXConnectorProvider) config\n+\t\t\t\t\t\t\t\t.createExecutableExtension(EXTENSION_ATTRIBUTE_CLASS);\n+\t\t\t\t\t\tfor (IConfigurationElement prop : config.getChildren(TAG_SYSPROPERTY)) {\n+\t\t\t\t\t\t\tensureSystemProperty(prop.getAttribute(ATTRIBUTE_KEY), prop.getAttribute(ATTRIBUTE_INCLUDE),\n+\t\t\t\t\t\t\t\t\tprop.getAttribute(ATTRIBUTE_SEPARATOR));\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\treturn provider;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t} catch (CoreException e) {\n+\t\t\tRJMXPlugin.getDefault().getLogger().log(Level.SEVERE, \"Could not instantiate JMX protocol provider!\", e);\n+\t\t}\n+\t\treturn null;\n+\t}\n+\n+\tprivate static void ensureSystemProperty(String key, String include, String separator) {\n+\t\tString org = System.getProperty(key);\n+\t\tif (org == null) {\n+\t\t\tSystem.setProperty(key, include);\n+\t\t\treturn;\n+\t\t}\n+\t\tif ((separator + org + separator).indexOf(separator + include + separator) < 0) {\n+\t\t\tSystem.setProperty(key, org + separator + include);\n+\t\t}\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.rjmx\/src\/main\/java\/org\/openjdk\/jmc\/rjmx\/internal\/ProtocolInitializer.java","additions":102,"deletions":0,"binary":false,"changes":102,"status":"added"},{"patch":"@@ -35,0 +35,1 @@\n+import java.io.IOException;\n@@ -38,0 +39,4 @@\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n+import javax.management.remote.JMXConnector;\n@@ -121,0 +126,4 @@\n+\t\t\tJMXConnector overriddenConnection = this.checkForProtocolSpecificConnectorExtension();\n+\t\t\tif (overriddenConnection != null) {\n+\t\t\t\tconnection.specifyConnector(overriddenConnection);\n+\t\t\t}\n@@ -132,0 +141,11 @@\n+\tprivate JMXConnector checkForProtocolSpecificConnectorExtension() {\n+\t\tfinal IConnectionDescriptor descriptor = this.connection.getConnectionDescriptor();\n+\t\ttry {\n+\t\t\treturn new ProtocolInitializer().newJMXConnector(descriptor.createJMXServiceURL(),\n+\t\t\t\t\tdescriptor.getEnvironment());\n+\t\t} catch (IOException e) {\n+\t\t\tLogger.getLogger(getClass().getName()).log(Level.INFO, \"Error attempting JMX protocol extensions\", e);\n+\t\t\treturn null;\n+\t\t}\n+\t}\n+\n","filename":"application\/org.openjdk.jmc.rjmx\/src\/main\/java\/org\/openjdk\/jmc\/rjmx\/internal\/ServerHandle.java","additions":20,"deletions":0,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -114,0 +114,1 @@\n+\t\t<module>org.openjdk.jmc.jolokia<\/module>\n","filename":"application\/pom.xml","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -0,0 +1,20 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<classpath>\n+\t<classpathentry kind=\"src\" path=\"src\/test\/java\">\n+\t\t<attributes>\n+\t\t\t<attribute name=\"test\" value=\"true\"\/>\n+\t\t<\/attributes>\n+\t<\/classpathentry>\n+\t<classpathentry kind=\"con\" path=\"org.eclipse.jdt.launching.JRE_CONTAINER\/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType\/JavaSE-17\">\n+\t\t<attributes>\n+\t\t\t<attribute name=\"module\" value=\"true\"\/>\n+\t\t<\/attributes>\n+\t<\/classpathentry>\n+\t<classpathentry kind=\"con\" path=\"org.eclipse.pde.core.requiredPlugins\">\n+\t\t<accessrules>\n+\t\t\t<accessrule kind=\"accessible\" pattern=\"org\/jolokia\/**\"\/>\n+\t\t\t<accessrule kind=\"accessible\" pattern=\"org\/json\/simple\/*\"\/>\n+\t\t<\/accessrules>\n+\t<\/classpathentry>\n+\t<classpathentry kind=\"output\" path=\"target\/test-classes\"\/>\n+<\/classpath>\n","filename":"application\/tests\/org.openjdk.jmc.jolokia.test\/.classpath","additions":20,"deletions":0,"binary":false,"changes":20,"status":"added"},{"patch":"@@ -0,0 +1,17 @@\n+Manifest-Version: 1.0\n+Bundle-ManifestVersion: 2\n+Bundle-Name: Jolokia plugin test\n+Bundle-SymbolicName: org.openjdk.jmc.jolokia.test;singleton:=true\n+Bundle-Version: 9.0.0.qualifier\n+Bundle-Vendor: Oracle Corporation\n+Bundle-RequiredExecutionEnvironment: JavaSE-17\n+Bundle-ActivationPolicy: lazy\n+Require-Bundle: org.junit,\n+ org.openjdk.jmc.jolokia,\n+ org.eclipse.osgi;bundle-version=\"3.16.200\",\n+ org.eclipse.ui.workbench,\n+ org.openjdk.jmc.rjmx,\n+ org.eclipse.ui,\n+ org.awaitility,\n+ org.hamcrest;bundle-version=\"2.1.0\"\n+Automatic-Module-Name: org.openjdk.jmc.jolokia.test\n","filename":"application\/tests\/org.openjdk.jmc.jolokia.test\/META-INF\/MANIFEST.MF","additions":17,"deletions":0,"binary":false,"changes":17,"status":"added"},{"patch":"@@ -2,1 +2,2 @@\n-#  Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2024, Kantega AS. All rights reserved.\n@@ -32,1 +33,0 @@\n-#\n@@ -36,3 +36,1 @@\n-bin.includes = META-INF\/,\\\n-               .\n-pde.match.rule.bundle=compatible\n+bin.includes = META-INF\/,.\n","filename":"application\/tests\/org.openjdk.jmc.jolokia.test\/build.properties","additions":3,"deletions":5,"binary":false,"changes":8,"previous_filename":"application\/tests\/org.openjdk.jmc.flightrecorder.controlpanel.ui.test\/build.properties","status":"copied"},{"patch":"@@ -0,0 +1,75 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--   \n+   Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+   Copyright (c) 2024, Kantega AS. All rights reserved.\n+   \n+   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+   \n+   The contents of this file are subject to the terms of either the Universal Permissive License \n+   v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+   \n+   or the following license:\n+   \n+   Redistribution and use in source and binary forms, with or without modification, are permitted\n+   provided that the following conditions are met:\n+   \n+   1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+   and the following disclaimer.\n+   \n+   2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+   conditions and the following disclaimer in the documentation and\/or other materials provided with\n+   the distribution.\n+   \n+   3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+   endorse or promote products derived from this software without specific prior written permission.\n+   \n+   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+   IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+   FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+   WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+   WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+-->\n+<project xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\"\n+\txmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"\n+\txsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/xsd\/maven-4.0.0.xsd\">\n+\t<modelVersion>4.0.0<\/modelVersion>\n+\t<parent>\n+\t\t<groupId>org.openjdk.jmc<\/groupId>\n+\t\t<artifactId>missioncontrol.application.tests<\/artifactId>\n+\t\t<version>${revision}${changelist}<\/version>\n+\t<\/parent>\n+\t<artifactId>org.openjdk.jmc.jolokia.test<\/artifactId>\n+\t<packaging>eclipse-test-plugin<\/packaging>\n+\n+\t<properties>\n+\t\t<jmc.config.path>${project.basedir}\/..\/..\/..\/configuration<\/jmc.config.path>\n+\t<\/properties>\n+\n+\t<dependencies>\n+\t\t<dependency>\n+\t\t\t<groupId>org.awaitility<\/groupId>\n+\t\t\t<artifactId>awaitility<\/artifactId>\n+\t\t\t<version>4.0.0<\/version>\n+\t\t<\/dependency>\n+\t<\/dependencies>\n+\n+\t<build>\n+\t\t<plugins>\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.eclipse.tycho<\/groupId>\n+\t\t\t\t<artifactId>tycho-surefire-plugin<\/artifactId>\n+\t\t\t\t<version>${tycho.version}<\/version>\n+\t\t\t\t<configuration>\n+\t\t\t\t\t<includes>${test.includes}<\/includes>\n+\t\t\t\t\t<!-- Start jolokia on a random free port to avoid requiring specific ports to run test -->\n+\t\t\t\t\t<argLine>\n+\t\t\t\t\t\t-javaagent:${settings.localRepository}\/org\/jolokia\/jolokia-jvm\/${jolokia.version}\/jolokia-jvm-${jolokia.version}.jar=port=0,discover=true<\/argLine>\n+\t\t\t\t<\/configuration>\n+\t\t\t<\/plugin>\n+\n+\t\t<\/plugins>\n+\t<\/build>\n+<\/project>\n","filename":"application\/tests\/org.openjdk.jmc.jolokia.test\/pom.xml","additions":75,"deletions":0,"binary":false,"changes":75,"status":"added"},{"patch":"@@ -0,0 +1,167 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Kantega AS. All rights reserved.\n+ * \n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ * \n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ * \n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ * \n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ * \n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.jolokia;\n+\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.time.Duration;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+import javax.management.Attribute;\n+import javax.management.AttributeNotFoundException;\n+import javax.management.InstanceNotFoundException;\n+import javax.management.IntrospectionException;\n+import javax.management.InvalidAttributeValueException;\n+import javax.management.MBeanAttributeInfo;\n+import javax.management.MBeanException;\n+import javax.management.MBeanServerConnection;\n+import javax.management.MalformedObjectNameException;\n+import javax.management.ObjectName;\n+import javax.management.OperationsException;\n+import javax.management.ReflectionException;\n+import javax.management.remote.JMXConnector;\n+import javax.management.remote.JMXServiceURL;\n+\n+import org.awaitility.Awaitility;\n+import org.eclipse.core.runtime.preferences.InstanceScope;\n+import org.junit.AfterClass;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.openjdk.jmc.common.IDescribable;\n+import org.openjdk.jmc.jolokia.preferences.PreferenceConstants;\n+import org.openjdk.jmc.rjmx.common.IConnectionDescriptor;\n+import org.openjdk.jmc.rjmx.common.IServerDescriptor;\n+import org.openjdk.jmc.rjmx.descriptorprovider.IDescriptorListener;\n+\n+\/**\n+ * Tests that JMX connections done with JmcJolokiaJmxConnectionProvider are functional\n+ *\/\n+@SuppressWarnings(\"restriction\")\n+public class JolokiaTest {\n+\n+\tstatic String jolokiaUrl;\n+\n+\tprivate static Set<String> unsafeAttributes = new HashSet<>(\n+\t\t\tArrays.asList(\"BootClassPath\", \"UsageThreshold\", \"UsageThresholdExceeded\", \"UsageThresholdCount\",\n+\t\t\t\t\t\"CollectionUsageThreshold\", \"CollectionUsageThresholdExceeded\", \"CollectionUsageThresholdCount\"));\n+\n+\tprivate static JolokiaDiscoveryListener discoveryListener;\n+\n+\tprivate static MBeanServerConnection jolokiaConnection;\n+\n+\t@BeforeClass\n+\tpublic static void startServer() throws Exception {\n+\t\t\/\/ wait for Jolokia to be ready before commencing tests\n+\t\tAwaitility.await().atMost(Duration.ofSeconds(15))\/\/Note: hard code property to avoid module dependency on agent\n+\t\t\t\t.until(() -> (jolokiaUrl = System.getProperty(\"jolokia.agent\")) != null);\n+\t\tdiscoveryListener = new JolokiaDiscoveryListener();\n+\t\tjolokiaConnection = getJolokiaMBeanConnector();\n+\n+\t}\n+\n+\t@Test\n+\tpublic void testReadAttributesOverJolokia() throws MalformedURLException, IOException, OperationsException,\n+\t\t\tIntrospectionException, AttributeNotFoundException, ReflectionException, MBeanException {\n+\t\tfor (ObjectName objectName : jolokiaConnection.queryNames(null, null)) {\n+\t\t\tfor (MBeanAttributeInfo attributeInfo : getJolokiaMBeanConnector().getMBeanInfo(objectName)\n+\t\t\t\t\t.getAttributes()) {\n+\t\t\t\tif (!unsafeAttributes.contains(attributeInfo.getName())) {\n+\t\t\t\t\tSystem.out.println(\"Getting attribute \" + objectName + \"\/\" + attributeInfo.getName());\n+\t\t\t\t\tgetJolokiaMBeanConnector().getAttribute(objectName, attributeInfo.getName());\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n+\t}\n+\n+\t@Test\n+\tpublic void testExecuteOperation() throws InstanceNotFoundException, MalformedObjectNameException, MBeanException,\n+\t\t\tReflectionException, MalformedURLException, IOException {\n+\t\tjolokiaConnection.invoke(new ObjectName(\"java.lang:type=Memory\"), \"gc\", new Object[0], new String[0]);\n+\t}\n+\n+\t@Test\n+\tpublic void testWriteAttribute()\n+\t\t\tthrows InstanceNotFoundException, AttributeNotFoundException, InvalidAttributeValueException,\n+\t\t\tMalformedObjectNameException, MBeanException, ReflectionException, MalformedURLException, IOException {\n+\t\tObjectName objectName = new ObjectName(\"jolokia:type=Config\");\n+\t\tString attribute = \"Debug\";\n+\t\tjolokiaConnection.setAttribute(objectName, new Attribute(attribute, true));\n+\t\tAssert.assertEquals(true, jolokiaConnection.getAttribute(objectName, attribute));\n+\n+\t}\n+\n+\tprivate static MBeanServerConnection getJolokiaMBeanConnector() throws IOException, MalformedURLException {\n+\t\tJMXConnector connector = new JmcJolokiaJmxConnectionProvider().newJMXConnector(\n+\t\t\t\tnew JMXServiceURL(jolokiaUrl.replace(\"http\", \"service:jmx:jolokia\")), Collections.emptyMap());\n+\t\tconnector.connect();\n+\t\tMBeanServerConnection connection = connector.getMBeanServerConnection();\n+\t\treturn connection;\n+\t}\n+\n+\t@Test\n+\tpublic void testDiscover() {\n+\n+\t\tfinal AtomicInteger foundVms = new AtomicInteger(0);\n+\n+\t\t\/\/Set config so that scanning takes place\n+\t\tInstanceScope.INSTANCE.getNode(JmcJolokiaPlugin.PLUGIN_ID).put(PreferenceConstants.P_SCAN, \"true\");\n+\n+\t\tdiscoveryListener.addDescriptorListener(new IDescriptorListener() {\n+\t\t\tpublic void onDescriptorDetected(\n+\t\t\t\tIServerDescriptor serverDescriptor, String path, JMXServiceURL url,\n+\t\t\t\tIConnectionDescriptor connectionDescriptor, IDescribable provider) {\n+\t\t\t\tfoundVms.getAndIncrement();\n+\t\t\t}\n+\n+\t\t\tpublic void onDescriptorRemoved(String descriptorId) {\n+\t\t\t\tfoundVms.getAndDecrement();\n+\t\t\t}\n+\n+\t\t});\n+\t\t\/\/ Test that at least one VM (the one running the test was discovered)\n+\t\tAwaitility.await().atMost(Duration.ofSeconds(5)).until(() -> foundVms.get() > 0);\n+\t}\n+\n+\t@AfterClass\n+\tpublic static void stopServer() throws Exception {\n+\t\tdiscoveryListener.shutdown();\n+\t}\n+\n+}\n","filename":"application\/tests\/org.openjdk.jmc.jolokia.test\/src\/test\/java\/org\/openjdk\/jmc\/jolokia\/JolokiaTest.java","additions":167,"deletions":0,"binary":false,"changes":167,"status":"added"},{"patch":"@@ -3,1 +3,1 @@\n-   Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+   Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,0 +55,1 @@\n+\t\t<module>org.openjdk.jmc.jolokia.test<\/module>\n","filename":"application\/tests\/pom.xml","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -591,1 +591,4 @@\n-\t\tm_jmxc = JMXConnectorFactory.newJMXConnector(serviceURL, env);\n+\t\tif (m_jmxc == null) {\n+\t\t\t\/\/This will use Java's standard connector, which will not take JMC extensions into account\n+\t\t\tm_jmxc = JMXConnectorFactory.newJMXConnector(serviceURL, env);\n+\t\t}\n@@ -616,0 +619,4 @@\n+\tpublic void specifyConnector(final JMXConnector specificConnector) {\n+\t\tthis.m_jmxc = specificConnector;\n+\t}\n+\n","filename":"core\/org.openjdk.jmc.rjmx.common\/src\/main\/java\/org\/openjdk\/jmc\/rjmx\/common\/internal\/RJMXConnection.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -112,0 +112,1 @@\n+\t\t<jolokia.version>1.7.2<\/jolokia.version>\n","filename":"pom.xml","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -54,0 +54,3 @@\n+            <unit id=\"org.jolokia.jmx-adapter.standalone\" version=\"1.7.2\"\/>\n+            <unit id=\"org.jolokia.jvm\" version=\"1.7.2\"\/>\n+            <unit id=\"com.github.tomakehurst.wiremock-standalone\" version=\"2.27.2\"\/>\n","filename":"releng\/platform-definitions\/platform-definition-2022-09\/platform-definition-2022-09.target","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -54,0 +54,3 @@\n+            <unit id=\"org.jolokia.jmx-adapter.standalone\" version=\"1.7.2\"\/>\n+            <unit id=\"org.jolokia.jvm\" version=\"1.7.2\"\/>\n+            <unit id=\"com.github.tomakehurst.wiremock-standalone\" version=\"2.27.2\"\/>\n","filename":"releng\/platform-definitions\/platform-definition-2022-12\/platform-definition-2022-12.target","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -49,0 +49,3 @@\n+            <unit id=\"org.jolokia.jmx-adapter.standalone\" version=\"1.7.2\"\/>\n+            <unit id=\"org.jolokia.jvm\" version=\"1.7.2\"\/>\n+            <unit id=\"com.github.tomakehurst.wiremock-standalone\" version=\"2.27.2\"\/>\n","filename":"releng\/platform-definitions\/platform-definition-2023-03\/platform-definition-2023-03.target","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -48,0 +48,3 @@\n+            <unit id=\"org.jolokia.jmx-adapter.standalone\" version=\"1.7.2\"\/>\n+            <unit id=\"org.jolokia.jvm\" version=\"1.7.2\"\/>\n+            <unit id=\"com.github.tomakehurst.wiremock-standalone\" version=\"2.27.2\"\/>\n","filename":"releng\/platform-definitions\/platform-definition-2023-09\/platform-definition-2023-09.target","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -48,0 +48,3 @@\n+            <unit id=\"org.jolokia.jmx-adapter.standalone\" version=\"1.7.2\"\/>\n+            <unit id=\"org.jolokia.jvm\" version=\"1.7.2\"\/>\n+            <unit id=\"com.github.tomakehurst.wiremock-standalone\" version=\"2.27.2\"\/>\n","filename":"releng\/platform-definitions\/platform-definition-2023-12\/platform-definition-2023-12.target","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+\t\t<jolokia.version>1.7.2<\/jolokia.version>\n+\t\t<wiremock.version>2.27.2<\/wiremock.version>\n@@ -142,0 +144,12 @@\n+\t\t\t\t\t\t\t\t<artifact>\n+\t\t\t\t\t\t\t\t\t<id>org.jolokia:jolokia-jmx-adapter:jar:standalone:${jolokia.version}<\/id>\n+\t\t\t\t\t\t\t\t\t<transitive>false<\/transitive>\n+\t\t\t\t\t\t\t\t<\/artifact>\n+\t\t\t\t\t\t\t\t<artifact>\n+\t\t\t\t\t\t\t\t\t<id>org.jolokia:jolokia-jvm:${jolokia.version}<\/id>\n+\t\t\t\t\t\t\t\t\t<transitive>false<\/transitive>\n+\t\t\t\t\t\t\t\t<\/artifact>\n+\t\t\t\t\t\t\t\t<artifact>\n+\t\t\t\t\t\t\t\t\t<id>com.github.tomakehurst:wiremock-standalone:${wiremock.version}<\/id>\n+\t\t\t\t\t\t\t\t\t<transitive>false<\/transitive>\n+\t\t\t\t\t\t\t\t<\/artifact>\n","filename":"releng\/third-party\/pom.xml","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"}]}