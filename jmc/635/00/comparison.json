{"files":[{"patch":"@@ -40,0 +40,1 @@\n+\n@@ -54,0 +55,1 @@\n+import java.awt.Rectangle;\n@@ -57,0 +59,1 @@\n+import java.awt.event.MouseEvent;\n@@ -145,0 +148,1 @@\n+import io.github.bric3.fireplace.flamegraph.FlamegraphView.HoverListener;\n@@ -496,2 +500,0 @@\n-\n-\t\t\tembeddingComposite.addListener(SWT.MouseExit, event -> Display.getDefault().timerExec(300, tooltip::hide));\n@@ -715,13 +717,4 @@\n-\n-\t\tfg.setHoverListener((frameBox, frameRect, mouseEvent) -> {\n-\t\t\t\/\/ This code knows too much about Flamegraph but given tooltips\n-\t\t\t\/\/ will probably evolve it may be too early to refactor it\n-\t\t\tvar scrollPane = (JScrollPane) mouseEvent.getComponent();\n-\t\t\tvar canvas = scrollPane.getViewport().getView();\n-\n-\t\t\tvar pointOnCanvas = SwingUtilities.convertPoint(scrollPane, mouseEvent.getPoint(), canvas);\n-\t\t\tpointOnCanvas.y = frameRect.y + frameRect.height;\n-\t\t\tvar componentPoint = SwingUtilities.convertPoint(canvas, pointOnCanvas, flamegraphView.component);\n-\n-\t\t\tif (frameBox.isRoot()) {\n-\t\t\t\treturn;\n+\t\tfg.setHoverListener(new HoverListener<Node>() {\n+\t\t\t@Override\n+\t\t\tpublic void onStopHover(FrameBox<Node> frameBox, Rectangle frameRect, MouseEvent mouseEvent) {\n+\t\t\t\tDisplay.getDefault().asyncExec(tooltip::hide);\n@@ -730,1 +723,6 @@\n-\t\t\tvar method = frameBox.actualNode.getFrame().getMethod();\n+\t\t\t@Override\n+\t\t\tpublic void onFrameHover(FrameBox<Node> frameBox, Rectangle frameRect, MouseEvent mouseEvent) {\n+\t\t\t\t\/\/ This code knows too much about Flamegraph but given tooltips\n+\t\t\t\t\/\/ will probably evolve it may be too early to refactor it\n+\t\t\t\tvar scrollPane = (JScrollPane) mouseEvent.getComponent();\n+\t\t\t\tvar canvas = scrollPane.getViewport().getView();\n@@ -732,3 +730,3 @@\n-\t\t\tvar escapedMethod = frameBox.actualNode.getFrame().getHumanReadableShortString().replace(\"<\", \"&lt;\")\n-\t\t\t\t\t.replace(\">\", \"&gt;\");\n-\t\t\tvar sb = new StringBuilder().append(\"<form><p>\").append(\"<b>\").append(escapedMethod).append(\"<\/b><br\/>\");\n+\t\t\t\tvar pointOnCanvas = SwingUtilities.convertPoint(scrollPane, mouseEvent.getPoint(), canvas);\n+\t\t\t\tpointOnCanvas.y = frameRect.y + frameRect.height;\n+\t\t\t\tvar componentPoint = SwingUtilities.convertPoint(canvas, pointOnCanvas, flamegraphView.component);\n@@ -736,6 +734,3 @@\n-\t\t\tvar packageName = method.getType().getPackage();\n-\t\t\tif (packageName != null) {\n-\t\t\t\tsb.append(packageName).append(\"<br\/>\");\n-\t\t\t}\n-\t\t\tsb.append(\"<hr\/>Weight: \").append(frameBox.actualNode.getCumulativeWeight()).append(\"<br\/>\")\n-\t\t\t\t\t.append(\"Type: \").append(frameBox.actualNode.getFrame().getType()).append(\"<br\/>\");\n+\t\t\t\tif (frameBox.isRoot()) {\n+\t\t\t\t\treturn;\n+\t\t\t\t}\n@@ -743,10 +738,1 @@\n-\t\t\tvar bci = frameBox.actualNode.getFrame().getBCI();\n-\t\t\tif (bci != null) {\n-\t\t\t\tsb.append(\"BCI: \").append(bci).append(\"<br\/>\");\n-\t\t\t}\n-\t\t\tvar frameLineNumber = frameBox.actualNode.getFrame().getFrameLineNumber();\n-\t\t\tif (frameLineNumber != null) {\n-\t\t\t\tsb.append(\"Line number: \").append(frameLineNumber).append(\"<br\/>\");\n-\t\t\t}\n-\t\t\tsb.append(\"<\/p><\/form>\");\n-\t\t\tvar text = sb.toString();\n+\t\t\t\tvar method = frameBox.actualNode.getFrame().getMethod();\n@@ -754,2 +740,4 @@\n-\t\t\tDisplay.getDefault().asyncExec(() -> {\n-\t\t\t\tvar control = Display.getDefault().getCursorControl();\n+\t\t\t\tvar escapedMethod = frameBox.actualNode.getFrame().getHumanReadableShortString().replace(\"<\", \"&lt;\")\n+\t\t\t\t\t\t.replace(\">\", \"&gt;\");\n+\t\t\t\tvar sb = new StringBuilder().append(\"<form><p>\").append(\"<b>\").append(escapedMethod)\n+\t\t\t\t\t\t.append(\"<\/b><br\/>\");\n@@ -757,2 +745,6 @@\n-\t\t\t\tif (Objects.equals(owner, control)) {\n-\t\t\t\t\ttooltip.setText(text);\n+\t\t\t\tvar packageName = method.getType().getPackage();\n+\t\t\t\tif (packageName != null) {\n+\t\t\t\t\tsb.append(packageName).append(\"<br\/>\");\n+\t\t\t\t}\n+\t\t\t\tsb.append(\"<hr\/>Weight: \").append(frameBox.actualNode.getCumulativeWeight()).append(\"<br\/>\")\n+\t\t\t\t\t\t.append(\"Type: \").append(frameBox.actualNode.getFrame().getType()).append(\"<br\/>\");\n@@ -760,2 +752,3 @@\n-\t\t\t\t\ttooltip.hide();\n-\t\t\t\t\ttooltip.show(SWT_AWTBridge.toSWTPoint(componentPoint));\n+\t\t\t\tvar bci = frameBox.actualNode.getFrame().getBCI();\n+\t\t\t\tif (bci != null) {\n+\t\t\t\t\tsb.append(\"BCI: \").append(bci).append(\"<br\/>\");\n@@ -763,1 +756,17 @@\n-\t\t\t});\n+\t\t\t\tvar frameLineNumber = frameBox.actualNode.getFrame().getFrameLineNumber();\n+\t\t\t\tif (frameLineNumber != null) {\n+\t\t\t\t\tsb.append(\"Line number: \").append(frameLineNumber).append(\"<br\/>\");\n+\t\t\t\t}\n+\t\t\t\tsb.append(\"<\/p><\/form>\");\n+\t\t\t\tvar text = sb.toString();\n+\n+\t\t\t\tDisplay.getDefault().asyncExec(() -> {\n+\t\t\t\t\tvar control = Display.getDefault().getCursorControl();\n+\n+\t\t\t\t\tif (Objects.equals(owner, control)) {\n+\t\t\t\t\t\ttooltip.setText(text);\n+\t\t\t\t\t\ttooltip.hide();\n+\t\t\t\t\t\ttooltip.show(SWT_AWTBridge.toSWTPoint(componentPoint));\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t}\n","filename":"application\/org.openjdk.jmc.flightrecorder.flamegraph\/src\/main\/java\/org\/openjdk\/jmc\/flightrecorder\/flamegraph\/views\/FlamegraphSwingView.java","additions":51,"deletions":42,"binary":false,"changes":93,"status":"modified"}]}