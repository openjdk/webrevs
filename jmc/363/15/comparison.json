{"files":[{"patch":"@@ -6,2 +6,7 @@\n-  linux:\n-    runs-on: 'ubuntu-latest'\n+  unix:\n+    strategy:\n+      matrix:\n+        jdk: ['11', '17']\n+        os: ['ubuntu-latest', 'macOS-latest']\n+    runs-on: ${{ matrix.os }}\n+    name: ${{ matrix.os }} with JDK ${{ matrix.jdk }}\n@@ -12,1 +17,1 @@\n-        java-version: '11'\n+        java-version: ${{ matrix.jdk }}\n@@ -18,1 +23,1 @@\n-        key: ${{ runner.os }}-maven-${{ hashFiles('**\/pom.xml') }}\n+        key: ${{ runner.os }}-${{ matrix.jdk }}-maven-${{ hashFiles('**\/pom.xml') }}\n@@ -20,25 +25,1 @@\n-          ${{ runner.os }}-maven-\n-    - name: Check formatting\n-      run: .\/scripts\/checkformatting.sh\n-    - name: Run core tests\n-      run: .\/scripts\/runcoretests.sh\n-    - name: Run application tests\n-      run: .\/scripts\/runapptests.sh\n-    - name: Run agent tests\n-      run: .\/scripts\/runagenttests.sh\n-\n-  mac:\n-    runs-on: 'macOS-latest'\n-    steps:\n-    - uses: actions\/checkout@v1\n-    - uses: actions\/setup-java@v1\n-      with:\n-        java-version: '11'\n-        java-package: jdk\n-    - name: Cache local Maven repository\n-      uses: actions\/cache@v2\n-      with:\n-        path: ~\/.m2\/repository\n-        key: ${{ runner.os }}-maven-${{ hashFiles('**\/pom.xml') }}\n-        restore-keys: |\n-          ${{ runner.os }}-maven-\n+          ${{ runner.os }}-${{ matrix.jdk }}maven-\n@@ -55,0 +36,3 @@\n+    strategy:\n+      matrix:\n+        jdk: ['11', '17']\n@@ -56,0 +40,1 @@\n+    name: windows-latest with JDK ${{ matrix.jdk }}\n@@ -60,1 +45,1 @@\n-        java-version: '11'\n+        java-version: ${{ matrix.jdk }}\n@@ -66,1 +51,1 @@\n-        key: ${{ runner.os }}-maven-${{ hashFiles('**\/pom.xml') }}\n+        key: ${{ runner.os }}-${{ matrix.jdk }}-maven-${{ hashFiles('**\/pom.xml') }}\n@@ -68,1 +53,1 @@\n-          ${{ runner.os }}-maven-\n+          ${{ runner.os }}-${{ matrix.jdk }}-maven-\n","filename":".github\/workflows\/validate.yml","additions":17,"deletions":32,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -58,0 +58,1 @@\n+\t\t\t\t\t\t<args>-version<\/args><!-- see https:\/\/bugs.eclipse.org\/bugs\/show_bug.cgi?id=544016 -->\n","filename":"application\/org.openjdk.jmc.browser.attach\/pom.xml","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -58,0 +58,1 @@\n+\t\t\t\t\t\t<args>-version<\/args>\n","filename":"application\/org.openjdk.jmc.browser\/pom.xml","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -41,0 +41,1 @@\n+import java.util.ArrayList;\n@@ -54,0 +55,1 @@\n+import org.openjdk.jmc.common.version.JavaVersionSupport;\n@@ -69,0 +71,1 @@\n+import org.openjdk.jmc.rjmx.ConnectionToolkit;\n@@ -90,1 +93,1 @@\n-\t\t\t\tpropertyRoots, \"root\");\n+\t\t\t\tremoveUnsupportedRootNodes(propertyRoots), \"root\");\n@@ -105,1 +108,1 @@\n-\t\t\t\t\t\"org\", \"IN_CONFIGURATION\"), propertyRoots, \"root\");\n+\t\t\t\t\t\"org\", \"IN_CONFIGURATION\"), removeUnsupportedRootNodes(propertyRoots), \"root\");\n@@ -116,1 +119,1 @@\n-\t\t\t\tpropertyRoots, \"root\");\n+\t\t\t\tremoveUnsupportedRootNodes(propertyRoots), \"root\");\n@@ -125,1 +128,1 @@\n-\t\t\t\tpropertyRoots, \"root\");\n+\t\t\t\tremoveUnsupportedRootNodes(propertyRoots), \"root\");\n@@ -149,1 +152,2 @@\n-\t\t\/\/ FIXME: Should we include extraTestOption and enabledButWrongForTest here, with either IN_CONFIGURATION style, or some new disabled\/error style?\n+\t\t\/\/ FIXME: Should we include extraTestOption and enabledButWrongForTest here,\n+\t\t\/\/ with either IN_CONFIGURATION style, or some new disabled\/error style?\n@@ -151,1 +155,2 @@\n-\t\tassertOptions(threadAllocation, Arrays.asList(\"Enabled\", \"IN_BOTH\", \"Period\", \"IN_BOTH\")); \/\/ \"extraTestOption\", \"IN_CONFIGURATION\"\n+\t\tassertOptions(threadAllocation, Arrays.asList(\"Enabled\", \"IN_BOTH\", \"Period\", \"IN_BOTH\")); \/\/ \"extraTestOption\",\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ \"IN_CONFIGURATION\"\n@@ -154,1 +159,2 @@\n-\t\tassertOptions(classLoadingStatistics, Arrays.asList(\"Period\", \"IN_BOTH\", \"Enabled\", \"IN_BOTH\")); \/\/ \"enabledButWrongForTest\", \"IN_CONFIGURATION\"\n+\t\tassertOptions(classLoadingStatistics, Arrays.asList(\"Period\", \"IN_BOTH\", \"Enabled\", \"IN_BOTH\")); \/\/ \"enabledButWrongForTest\",\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ \"IN_CONFIGURATION\"\n@@ -187,1 +193,2 @@\n-\t\t\/\/ FIXME: Should we include extraTestOption and enabledButWrongForTest here, with either IN_CONFIGURATION style, or some new disabled\/error style?\n+\t\t\/\/ FIXME: Should we include extraTestOption and enabledButWrongForTest here,\n+\t\t\/\/ with either IN_CONFIGURATION style, or some new disabled\/error style?\n@@ -189,1 +196,2 @@\n-\t\tassertOptions(threadAllocation, Arrays.asList(\"Enabled\", \"IN_BOTH\", \"Period\", \"IN_BOTH\")); \/\/ \"extraTestOption\", \"IN_CONFIGURATION\"\n+\t\tassertOptions(threadAllocation, Arrays.asList(\"Enabled\", \"IN_BOTH\", \"Period\", \"IN_BOTH\")); \/\/ \"extraTestOption\",\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ \"IN_CONFIGURATION\"\n@@ -192,1 +200,2 @@\n-\t\tassertOptions(classLoadingStatistics, Arrays.asList(\"Period\", \"IN_BOTH\", \"Enabled\", \"IN_SERVER\")); \/\/ \"enabledButWrongForTest\", \"IN_CONFIGURATION\"\n+\t\tassertOptions(classLoadingStatistics, Arrays.asList(\"Period\", \"IN_BOTH\", \"Enabled\", \"IN_SERVER\")); \/\/ \"enabledButWrongForTest\",\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\/\/ \"IN_CONFIGURATION\"\n@@ -244,0 +253,5 @@\n+\t\tString[] expected = new String[] {\"Enabled\", \"Period\", \"Stack Trace\", \"Threshold\"};\n+\t\tif (ConnectionToolkit.isJavaVersionAboveOrEqual(getConnectionHandle(), JavaVersionSupport.JDK_16)) {\n+\t\t\t\/\/ probably related to https:\/\/bugs.openjdk.java.net\/browse\/JDK-8257602\n+\t\t\texpected = new String[] {\"Enabled\", \"Event Emission Throttle\", \"Period\", \"Stack Trace\", \"Threshold\"};\n+\t\t}\n@@ -245,1 +259,1 @@\n-\t\t\t\tnew String[] {\"Enabled\", \"Period\", \"Stack Trace\", \"Threshold\"}, props.toArray());\n+\t\t\t\texpected, props.toArray());\n@@ -290,1 +304,2 @@\n-\t\/\/ TODO: Add more tests: Other categories, labels, descriptions, option label and descriptions, content types.\n+\t\/\/ TODO: Add more tests: Other categories, labels, descriptions, option label\n+\t\/\/ and descriptions, content types.\n@@ -321,0 +336,12 @@\n+\tprivate <T extends PathElement> Collection<T> removeUnsupportedRootNodes(Collection<T> actualNodes) {\n+\t\tList<T> res = new ArrayList<T>();\n+\t\tfor (T pathElement : actualNodes) {\n+\t\t\tif (!pathElement.getName().equals(\"jdk\")) {\n+\t\t\t\t\/\/ jdk named root nodes are related to nodes that are not supported in newer\n+\t\t\t\t\/\/ JDKs like jdk.SafepointWaitBlocked (removed in JDK 13)\n+\t\t\t\tres.add(pathElement);\n+\t\t\t}\n+\t\t}\n+\t\treturn res;\n+\t}\n+\n@@ -338,1 +365,1 @@\n-\t\t\t\tactualNodesNames.containsAll(expectedNodesNames) && expectedNodesNames.containsAll(actualNodesNames));\n+\t\t\t\tactualNodesNames.containsAll(expectedNodesNames));\n","filename":"application\/tests\/org.openjdk.jmc.flightrecorder.controlpanel.ui.test\/src\/test\/java\/org\/openjdk\/jmc\/flightrecorder\/controlpanel\/ui\/test\/PropertyContentBuilderTest.java","additions":40,"deletions":13,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -67,0 +67,5 @@\n+\tpublic static final JavaVersion JDK_13 = new JavaVersion(13, 0);\n+\tpublic static final JavaVersion JDK_14 = new JavaVersion(14, 0);\n+\tpublic static final JavaVersion JDK_15 = new JavaVersion(15, 0);\n+\tpublic static final JavaVersion JDK_16 = new JavaVersion(16, 0);\n+\tpublic static final JavaVersion JDK_17 = new JavaVersion(17, 0);\n","filename":"core\/org.openjdk.jmc.common\/src\/main\/java\/org\/openjdk\/jmc\/common\/version\/JavaVersionSupport.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -60,0 +60,1 @@\n+\t\t<maven.javadoc.version>3.3.1<\/maven.javadoc.version>\n@@ -66,0 +67,1 @@\n+\t\t<build.helper.maven.version>3.2.0<\/build.helper.maven.version>\n","filename":"core\/tests\/pom.xml","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -20,1 +20,1 @@\n-Next set up your JDKs in your Eclipse. Download and install a JDK 8 and JDK 11 (or the very latest update of the latest JDK), then open Window | Preferences and then select Java \/ Installed JREs. Add your favourite JKD 8 and JDK 11 JDKs (Add…) and then use Java \/ Installed JREs \/ Execution Environments to set them as defaults for the JDK 8 and JDK 11 execution environments.\n+Next set up your JDKs in your Eclipse. Download and install a JDK 8 and JDK 11 (or at most JDK 17), then open Window | Preferences and then select Java \/ Installed JREs. Add your favourite JKD 8 and JDK 11 JDKs (Add…) and then use Java \/ Installed JREs \/ Execution Environments to set them as defaults for the JDK 8 and JDK 11 execution environments.\n@@ -30,1 +30,3 @@\n-Okay, we now have our JDKs set up. If you want to import not only the JMC core project, you will next need to set up a user library for things that JMC will need from the JDK. Go to Preferences | Java\/Build Path\/User Libraries and create a new library named JMC_JDK. Add (Add External JARs…) the following JARs from a JDK 8 (u40 or above) to the User Library: tools.jar (\/lib\/tools.jar) and finally jconsole.jar (\/lib\/jconsole.jar).\n+On JDK 17: you might need to change the execution environment in this tab to \"JavaSE-11\" and select a JDK 17 as the used JDK.\n+\n+Okay, we now have our JDKs set up. If you want to import not only the JMC core project, you will next need to set up a user library for things that JMC will need from the JDK. Go to Preferences | Java\/Build Path\/User Libraries and create a new library named JMC_JDK. Add (Add External JARs…) the following JARs from a JDK 8 (u40 or above) to the User Library: tools.jar (\/lib\/tools.jar) and finally jconsole.jar (\/lib\/jconsole.jar). On JDK 17 you have to get these libraries from an JDK 8 package.\n@@ -84,1 +86,3 @@\n-For dynamic working sets, see http:\/\/hirt.se\/blog\/?p=1149.\n\\ No newline at end of file\n+For dynamic working sets, see http:\/\/hirt.se\/blog\/?p=1149.\n+\n+For testing: Run all tests as \"JUnit Plugin-In Test\" tests in eclipse and use the scripts in the `scripts` folder for running the tests. Run the class `org.openjdk.jmc.rjmx.test.testutil.JVMKeepAlive` with the VM arguments `-Dcom.sun.management.jmxremote.port=7091 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false` alongside.\n","filename":"docs\/devguide\/README.md","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"}]}