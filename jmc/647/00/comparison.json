{"files":[{"patch":"@@ -125,3 +125,4 @@\n-\t\ttable.getManager().getViewer().addSelectionChangedListener(e -> buildChart());\n-\t\ttable.getManager().getViewer()\n-\t\t\t\t.addSelectionChangedListener(e -> pageContainer.showSelection(table.getSelection().getItems()));\n+\t\ttable.getManager().getViewer().addSelectionChangedListener(e -> {\n+\t\t\tbuildChart();\n+\t\t\tpageContainer.showSelection(table.getSelection().getItems());\n+\t\t});\n","filename":"application\/org.openjdk.jmc.flightrecorder.ui\/src\/main\/java\/org\/openjdk\/jmc\/flightrecorder\/ui\/pages\/ChartAndTableUI.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -248,0 +248,1 @@\n+\tprivate CompletableFuture<StacktraceModel> modelRebuildFuture;\n@@ -791,0 +792,5 @@\n+\n+\t\t\/\/ Cancel any pending rebuilds to avoid race conditions\n+\t\tif (modelRebuildFuture != null && !modelRebuildFuture.isDone()) {\n+\t\t\tmodelRebuildFuture.cancel(true);\n+\t\t}\n@@ -806,3 +812,7 @@\n-\t\tCompletableFuture<StacktraceModel> modelPreparer = getModelPreparer(createStacktraceModel(), !treeLayout);\n-\t\tmodelPreparer.thenAcceptAsync(this::setModel, DisplayToolkit.inDisplayThread())\n-\t\t\t\t.exceptionally(StacktraceView::handleModelBuildException);\n+\t\tmodelRebuildFuture = getModelPreparer(createStacktraceModel(), !treeLayout);\n+\t\tmodelRebuildFuture.thenAcceptAsync(model -> {\n+\t\t\tif (modelRebuildFuture != null && !modelRebuildFuture.isCancelled() && model != null\n+\t\t\t\t\t&& model.getRootFork() != null) {\n+\t\t\t\tsetModel(model);\n+\t\t\t}\n+\t\t}, DisplayToolkit.inDisplayThread()).exceptionally(StacktraceView::handleModelBuildException);\n@@ -826,1 +836,6 @@\n-\t\tFlightRecorderUI.getDefault().getLogger().log(Level.SEVERE, \"Failed to build stacktrace view model\", ex); \/\/$NON-NLS-1$\n+\t\t\/\/ Don't log CancellationExceptions as severe since they're expected during model rebuilding\n+\t\tif (ex.getCause() instanceof java.util.concurrent.CancellationException) {\n+\t\t\tFlightRecorderUI.getDefault().getLogger().log(Level.FINE, \"Stacktrace model build cancelled\", ex); \/\/$NON-NLS-1$\n+\t\t} else {\n+\t\t\tFlightRecorderUI.getDefault().getLogger().log(Level.SEVERE, \"Failed to build stacktrace view model\", ex); \/\/$NON-NLS-1$\n+\t\t}\n","filename":"application\/org.openjdk.jmc.flightrecorder.ui\/src\/main\/java\/org\/openjdk\/jmc\/flightrecorder\/ui\/views\/stacktrace\/StacktraceView.java","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"}]}