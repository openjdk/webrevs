{"files":[{"patch":"@@ -78,3 +78,3 @@\n-    def clang_path_include = (Os.isFamily(Os.FAMILY_UNIX) && !Os.isFamily(Os.FAMILY_MAC)) ?\n-            \"libclang.so.${clang_version}\" : \"*clang*\"\n-\n+    def isAix = Os.isName(\"AIX\") || Os.isName(\"aix\")\n+    def isUnixNotMac  = Os.isFamily(Os.FAMILY_UNIX) && !Os.isFamily(Os.FAMILY_MAC)\n+    def clang_path_include = isAix  ? \"libclang.a\" : isUnixNotMac ? \"libclang.so.${clang_version}\" : \"*clang*\"\n@@ -87,1 +87,1 @@\n-        rename(\"libclang.so.${clang_version}\", \"libclang.so\")\n+        rename(\"libclang.so.*\", \"libclang.so\")\n@@ -89,1 +89,0 @@\n-\n@@ -241,1 +240,1 @@\n-                \"-retain:fail,error\",\n+                \"-retain:fail,error\"\n@@ -279,0 +278,16 @@\n+\/\/------------------------------------------------------------\n+\/\/ Task to generate version file into jmod inputs\n+\/\/------------------------------------------------------------\n+tasks.register('writeLibClangVersion') {\n+    def confDir = file(\"$buildDir\/jmod_inputs\/conf\/jextract\")\n+    outputs.file(\"$confDir\/libclang.version\")\n+    def clang_major_version = clang_version.tokenize('.')[0]\n+    doLast {\n+        confDir.mkdirs()\n+        file(\"$confDir\/libclang.version\").text = clang_major_version + \"\\n\"\n+    }\n+}\n+\n+tasks.named(\"createJextractJmod\") {\n+    dependsOn \"writeLibClangVersion\"\n+}\n","filename":"build.gradle","additions":21,"deletions":6,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -36,1 +36,0 @@\n-\n@@ -39,0 +38,2 @@\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n@@ -83,0 +84,1 @@\n+    static final SymbolLookup SYMBOL_LOOKUP;\n@@ -85,2 +87,17 @@\n-        String libName = System.getProperty(\"os.name\").startsWith(\"Windows\") ? \"libclang\" : \"clang\";\n-        System.loadLibrary(libName);\n+        String osName = System.getProperty(\"os.name\");\n+        if (osName.startsWith(\"AIX\")) {\n+            String javaHome = System.getProperty(\"java.home\");\n+            String libName = javaHome + \"\/lib\/libclang.a\";\n+            String clangVersion;\n+            try {\n+                clangVersion = Files.readString(Path.of(javaHome + \"\/conf\/jextract\/libclang.version\"));\n+            } catch (Exception e) {\n+                throw new IllegalStateException(\"Failed to read libclang.version\", e);\n+            }\n+            String sharedMember = \"(libclang.so.\" + clangVersion.trim() + \")\";\n+            SYMBOL_LOOKUP = SymbolLookup.libraryLookup(libName + sharedMember, LIBRARY_ARENA);\n+        } else {\n+            String libName = osName.startsWith(\"Windows\") ? \"libclang\" : \"clang\";\n+            System.loadLibrary(libName);\n+            SYMBOL_LOOKUP = SymbolLookup.loaderLookup().or(Linker.nativeLinker().defaultLookup());\n+        }\n@@ -88,4 +105,0 @@\n-\n-    static final SymbolLookup SYMBOL_LOOKUP = SymbolLookup.loaderLookup()\n-            .or(Linker.nativeLinker().defaultLookup());\n-\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/clang\/libclang\/Index_h.java","additions":20,"deletions":7,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -14,1 +14,0 @@\n-\n@@ -16,0 +15,9 @@\n+    if(${CMAKE_SYSTEM_NAME} MATCHES \"AIX\")\n+      set_target_properties(${LIB_NAME} PROPERTIES\n+          PREFIX \"lib\"\n+          SUFFIX \".a\"\n+          COMPILE_FLAGS \"-q64  -qhalt=e -qcpluscmt\"\n+          LINK_FLAGS \"-q64 -G -Wl,-bnoentry,-bexpall\"\n+    \t)\n+    endif()\n+\n@@ -21,0 +29,6 @@\n+    # Link against libm to resolve sqrt() and other math symbols\n+    find_library(LIBM, m)\n+    if(LIBM)\n+      target_link_libraries(${LIB_NAME} ${LIBM})\n+    endif()\n+\n","filename":"test\/test-support\/CMakeLists.txt","additions":15,"deletions":1,"binary":false,"changes":16,"status":"modified"}]}