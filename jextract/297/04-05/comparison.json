{"files":[{"patch":"@@ -210,1 +210,0 @@\n-\n@@ -266,2 +265,0 @@\n-\n-\n@@ -286,0 +283,16 @@\n+\/\/------------------------------------------------------------\n+\/\/ Task to generate version file into jmod inputs\n+\/\/------------------------------------------------------------\n+tasks.register('writeLibClangVersion') {\n+    def confDir = file(\"$buildDir\/jmod_inputs\/conf\/jextract\")\n+    outputs.file(\"$confDir\/libclang.version\")\n+    def clang_major_version = clang_version.tokenize('.')[0]\n+    doLast {\n+        confDir.mkdirs()\n+        file(\"$confDir\/libclang.version\").text = clang_major_version + \"\\n\"\n+    }\n+}\n+\n+tasks.named(\"createJextractJmod\") {\n+    dependsOn \"writeLibClangVersion\"\n+}\n","filename":"build.gradle","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -39,1 +39,2 @@\n-import java.io.File;\n+import java.io.FileReader;\n+import java.io.BufferedReader;\n@@ -84,1 +85,1 @@\n-    static SymbolLookup SYMBOL_LOOKUP;\n+    static final SymbolLookup SYMBOL_LOOKUP;\n@@ -89,1 +90,0 @@\n-            String libName = null;\n@@ -91,3 +91,7 @@\n-            File f = new File(javaHome + \"\/lib\", \"libclang.a\"); \/\/ AIX uses .a, Linux .so\n-            if (f.exists() && !f.isDirectory()) {\n-                libName = f.getAbsolutePath();\n+            String libName = javaHome + \"\/lib\/libclang.a\";\n+            String clangVersion = \"14\";\n+            try (BufferedReader br = new BufferedReader(\n+                new FileReader(javaHome + \"\/conf\/jextract\/libclang.version\"))) {\n+                clangVersion = br.readLine().trim();\n+            } catch (Exception e) {\n+                throw new IllegalStateException(\"Failed to read libclang.version\", e);\n@@ -95,1 +99,2 @@\n-            SYMBOL_LOOKUP = SymbolLookup.libraryLookup(libName + \"(libclang.so.14)\", Arena.global());\n+            String sharedMember = \"(libclang.so.\" + clangVersion + \")\";\n+            SYMBOL_LOOKUP = SymbolLookup.libraryLookup(libName + sharedMember, LIBRARY_ARENA);\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/clang\/libclang\/Index_h.java","additions":12,"deletions":7,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -14,0 +14,1 @@\n+    add_library(${LIB_NAME} SHARED ${TEST_LIB})\n@@ -15,1 +16,0 @@\n-      add_library(${LIB_NAME} SHARED ${TEST_LIB})\n@@ -22,2 +22,0 @@\n-    else()\n-      add_library(${LIB_NAME} SHARED ${TEST_LIB})\n","filename":"test\/test-support\/CMakeLists.txt","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"}]}