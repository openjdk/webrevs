{"files":[{"patch":"@@ -76,15 +76,18 @@\n-    \/\/ make sure we only pick up the \"real\" shared library file from LLVM installation\n-    \/\/ (e.g. exclude symlinks on Linux)\n-    def clang_path_include = (Os.isFamily(Os.FAMILY_UNIX) && !Os.isFamily(Os.FAMILY_MAC)) ?\n-            \"libclang.so.${clang_version}\" : \"*clang*\"\n-\n-    from(\"${libclang_dir}\") {\n-        include(clang_path_include)\n-        include(\"libLLVM.*\")\n-        exclude(\"clang.exe\")\n-        into(\"libs\")\n-        \/\/ make sure we drop shared library version name (Linux only)\n-        rename(\"libclang.so.${clang_version}\", \"libclang.so\")\n-    }\n-\n-    from(\"$clang_include_dir\") {\n+     \/\/ make sure we only pick up the \"real\" shared library file from LLVM installation\n+     \/\/ (e.g. exclude symlinks on Linux)\n+     def isAix = Os.isName(\"AIX\") || Os.isName(\"aix\")\n+     def isUnixNotMac  = Os.isFamily(Os.FAMILY_UNIX) && !Os.isFamily(Os.FAMILY_MAC)\n+     def clang_path_include =\n+        isAix  ? \"libclang.a\" :\n+        isUnixNotMac ? \"libclang.so.${clang_version}\" :\n+                 \"*clang*\"\n+     from(\"${libclang_dir}\") {\n+         include(clang_path_include)\n+         include(\"libLLVM.*\")\n+         exclude(\"clang.exe\")\n+         into(\"libs\")\n+         \/\/ make sure we drop shared library version name (Linux only)\n+         rename(\"libclang.so.*\", \"libclang.so\")\n+\n+     }\n+     from(\"$clang_include_dir\") {\n@@ -93,1 +96,2 @@\n-    }\n+     }\n+\n@@ -206,0 +210,1 @@\n+\n@@ -241,1 +246,1 @@\n-                \"-retain:fail,error\",\n+                \"-retain:fail,error\"\n@@ -261,0 +266,2 @@\n+\n+\n","filename":"build.gradle","additions":24,"deletions":17,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -36,1 +36,0 @@\n-\n@@ -38,0 +37,1 @@\n+import java.util.StringTokenizer;\n@@ -39,0 +39,1 @@\n+import java.io.File;\n@@ -83,0 +84,1 @@\n+    static SymbolLookup SYMBOL_LOOKUP;\n@@ -85,2 +87,14 @@\n-        String libName = System.getProperty(\"os.name\").startsWith(\"Windows\") ? \"libclang\" : \"clang\";\n-        System.loadLibrary(libName);\n+        String osName = System.getProperty(\"os.name\");\n+        if (osName.startsWith(\"AIX\")) {\n+            String libName = null;\n+            String javaHome = System.getProperty(\"java.home\");\n+            File f = new File(javaHome + \"\/lib\", \"libclang.a\"); \/\/ AIX uses .a, Linux .so\n+            if (f.exists() && !f.isDirectory()) {\n+                libName = f.getAbsolutePath();\n+            }\n+            SYMBOL_LOOKUP = SymbolLookup.libraryLookup(libName + \"(libclang.so.14)\", Arena.global());\n+        } else {\n+            String libName = osName.startsWith(\"Windows\") ? \"libclang\" : \"clang\";\n+            System.loadLibrary(libName);\n+            SYMBOL_LOOKUP = SymbolLookup.loaderLookup().or(Linker.nativeLinker().defaultLookup());\n+        }\n@@ -88,4 +102,0 @@\n-\n-    static final SymbolLookup SYMBOL_LOOKUP = SymbolLookup.loaderLookup()\n-            .or(Linker.nativeLinker().defaultLookup());\n-\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/clang\/libclang\/Index_h.java","additions":17,"deletions":7,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -14,0 +14,11 @@\n+    if(${CMAKE_SYSTEM_NAME} MATCHES \"AIX\")\n+      add_library(${LIB_NAME} SHARED ${TEST_LIB})\n+      set_target_properties(${LIB_NAME} PROPERTIES\n+          PREFIX \"lib\"\n+          SUFFIX \".a\"\n+          COMPILE_FLAGS \"-q64  -qhalt=e -qcpluscmt\"\n+          LINK_FLAGS \"-q64 -G -Wl,-bnoentry,-bexpall\"\n+    \t)\n+    else()\n+      add_library(${LIB_NAME} SHARED ${TEST_LIB})\n+    endif()\n@@ -15,1 +26,0 @@\n-    add_library(${LIB_NAME} SHARED ${TEST_LIB})\n@@ -21,0 +31,6 @@\n+    # Link against libm to resolve sqrt() and other math symbols\n+    find_library(LIBM, m)\n+    if(LIBM)\n+      target_link_libraries(${LIB_NAME} ${LIBM})\n+    endif()\n+\n","filename":"test\/test-support\/CMakeLists.txt","additions":17,"deletions":1,"binary":false,"changes":18,"status":"modified"}]}