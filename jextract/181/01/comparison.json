{"files":[{"patch":"@@ -82,0 +82,1 @@\n+            import static java.lang.foreign.MemoryLayout.PathElement.*;\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/SourceFileBuilder.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -143,2 +143,3 @@\n-            emitFieldGetter(javaName, varTree, offsetField);\n-            emitFieldSetter(javaName, varTree, offsetField);\n+            String layoutField = emitLayoutFieldDecl(varTree);\n+            emitFieldGetter(javaName, varTree, layoutField, offsetField);\n+            emitFieldSetter(javaName, varTree, layoutField, offsetField);\n@@ -150,0 +151,17 @@\n+    private List<String> prefixNamesList() {\n+        return nestedAnonDeclarations.stream()\n+                .map(d -> AnonymousStruct.anonName((Declaration.Scoped)d))\n+                .toList().reversed();\n+    }\n+\n+    private String fieldElementPaths(String nativeName) {\n+        StringBuilder builder = new StringBuilder();\n+        String prefix = \"\";\n+        for (String prefixElementName : prefixNamesList()) {\n+            builder.append(prefix + \"groupElement(\\\"\" + prefixElementName + \"\\\")\");\n+            prefix = \", \";\n+        }\n+        builder.append(prefix + \"groupElement(\\\"\" + nativeName + \"\\\")\");\n+        return builder.toString();\n+    }\n+\n@@ -160,1 +178,1 @@\n-    private void emitFieldGetter(String javaName, Declaration.Variable varTree, String offsetField) {\n+    private void emitFieldGetter(String javaName, Declaration.Variable varTree, String layoutField, String offsetField) {\n@@ -167,1 +185,1 @@\n-                return \\{segmentParam}.get(\\{layoutString(varTree.type())}, \\{offsetField});\n+                return \\{segmentParam}.get(\\{layoutField}, \\{offsetField});\n@@ -172,1 +190,1 @@\n-    private void emitFieldSetter(String javaName, Declaration.Variable varTree, String offsetField) {\n+    private void emitFieldSetter(String javaName, Declaration.Variable varTree, String layoutField, String offsetField) {\n@@ -180,1 +198,1 @@\n-                \\{segmentParam}.set(\\{layoutString(varTree.type())}, \\{offsetField}, \\{valueParam});\n+                \\{segmentParam}.set(\\{layoutField}, \\{offsetField}, \\{valueParam});\n@@ -277,0 +295,9 @@\n+    private String emitLayoutFieldDecl(Declaration.Variable field) {\n+        String layoutFieldName = STR.\"\\{field.name()}$LAYOUT\";\n+        String layoutType = Utils.layoutCarrierFor(field.type()).getSimpleName();\n+        appendIndentedLines(STR.\"\"\"\n+            private static final \\{layoutType} \\{layoutFieldName} = (\\{layoutType})$LAYOUT.select(\\{fieldElementPaths(field.name())});\n+            \"\"\");\n+        return layoutFieldName;\n+    }\n+\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/StructBuilder.java","additions":33,"deletions":6,"binary":false,"changes":39,"status":"modified"}]}