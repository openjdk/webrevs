{"files":[{"patch":"@@ -990,0 +990,3 @@\n+| `-F <dir>` (macOs only)                                          | specify the framework directory include files. Defaults to the current Mac OS X SDK dir.|\n+| `-framework <framework>` (macOs only)                            | specify the name of the library, path will be expanded to that of the framework folder.|\n+\n","filename":"doc\/GUIDE.md","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1,1 +0,0 @@\n--F\/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/System\/Library\/Frameworks\n","filename":"samples\/opengl\/compile_flags.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"deleted"},{"patch":"@@ -1,2 +1,2 @@\n-jextract -t opengl -l :\/System\/Library\/Frameworks\/GLUT.framework\/GLUT \\\n-  -l :\/System\/Library\/Frameworks\/OpenGL.framework\/OpenGL \\\n+jextract -t opengl -framework GLUT \\\n+  -framework OpenGL \\\n","filename":"samples\/opengl\/compilesource.sh","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,0 @@\n-import java.io.UncheckedIOException;\n@@ -49,6 +48,1 @@\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.HashMap;\n-import java.util.Map;\n-import java.util.List;\n-import java.util.Optional;\n+import java.util.*;\n@@ -68,0 +62,2 @@\n+    private static final boolean isMacOSX =\n+            System.getProperty(\"os.name\", \"unknown\").equals(\"Mac OS X\");\n@@ -79,0 +75,1 @@\n+    private List<String> frameworkDirs;\n@@ -82,0 +79,1 @@\n+        this.frameworkDirs = new ArrayList<>();\n@@ -296,1 +294,1 @@\n-                   if (spec == null ) {\n+                   if (spec == null) {\n@@ -367,0 +365,2 @@\n+        parser.accepts(\"-F\", \"help.mac.framework\", true);\n+        parser.accepts(\"-framework\", \"help.framework.library.path\", true);\n@@ -414,3 +414,1 @@\n-        inferPlatformIncludePath().ifPresent(platformPath -> {\n-            builder.addClangArg(\"-I\" + platformPath);\n-        });\n+        inferPlatformIncludePath().ifPresent(platformPath -> builder.addClangArg(\"-I\" + platformPath));\n@@ -442,0 +440,3 @@\n+            if (!optionSet.has(\"-l\")){\n+                logger.warn(\"jextract.no.library.specified\");\n+            }\n@@ -445,19 +446,13 @@\n-        boolean librariesSpecified = optionSet.has(\"-l\");\n-        if (librariesSpecified) {\n-            for (String lib : optionSet.valuesOf(\"-l\")) {\n-                try {\n-                    Library library = Options.Library.parse(lib);\n-                    Path libPath = Paths.get(library.libSpec());\n-                    if (!useSystemLoadLibrary ||\n-                            library.specKind() == Library.SpecKind.NAME ||\n-                            (libPath.isAbsolute() && Files.isRegularFile(libPath))) {\n-                        builder.addLibrary(library);\n-                    } else {\n-                        \/\/ not an absolute path, but--use-system-load-library was specified\n-                        logger.err(\"l.option.value.absolute.path\", lib);\n-                    }\n-                } catch (IllegalArgumentException ex) {\n-                    logger.err(\"l.option.value.invalid\", lib);\n-                    return OPTION_ERROR;\n-                }\n-            }\n+        int optionError = parseLibraries(\"l\", optionSet, useSystemLoadLibrary, builder);\n+        if (optionError != 0) return optionError;\n+\n+        optionError = parseLibraries(\"framework\", optionSet, useSystemLoadLibrary, builder);\n+        if (optionError != 0) return optionError;\n+\n+\n+        if (optionSet.has(\"-F\")) {\n+            optionSet.valuesOf(\"-F\").forEach(\n+                    p -> {\n+                        builder.addClangArg(\"-F\" + p);\n+                        frameworkDirs.add(p);\n+                    });\n@@ -466,0 +461,2 @@\n+        inferMacOSFrameworkPath().ifPresent(platformPath -> builder.addClangArg(\"-F\" + platformPath));\n+\n@@ -535,0 +532,27 @@\n+    private int parseLibraries(String optionString, OptionSet optionSet, boolean useSystemLoadLibrary, Options.Builder builder) {\n+        if (optionSet.has(\"-\" + optionString)) {\n+            for (String lib : optionSet.valuesOf(\"-\" + optionString)) {\n+                try {\n+                    if (optionString.equals(\"framework\")) {\n+                        lib = formatFrameworkPath(lib);\n+                    }\n+\n+                    Library library = Library.parse(lib);\n+                    Path libPath = Paths.get(library.libSpec());\n+                    if (!useSystemLoadLibrary ||\n+                            library.specKind() == Library.SpecKind.NAME ||\n+                            (libPath.isAbsolute() && Files.isRegularFile(libPath))) {\n+                        builder.addLibrary(library);\n+                    } else {\n+                        \/\/ not an absolute path, but --use-system-load-library was specified\n+                        logger.err(\"l.option.value.absolute.path\", lib);\n+                    }\n+                } catch (IllegalArgumentException ex) {\n+                    logger.err(optionString + \".option.value.invalid\", lib);\n+                    return OPTION_ERROR;\n+                }\n+            }\n+        }\n+        return 0;\n+    }\n+\n@@ -554,2 +578,15 @@\n-        String os = System.getProperty(\"os.name\");\n-        if (os.equals(\"Mac OS X\")) {\n+        return inferMacOsPath(\"usr\", \"include\");\n+    }\n+\n+    private Optional<Path> inferMacOSFrameworkPath() {\n+        return inferMacOsPath(\"System\", \"Library\", \"Frameworks\");\n+    }\n+\n+    private static String getMacOsSDKPath() throws IOException {\n+        ProcessBuilder pb = new ProcessBuilder().\n+                command(\"\/usr\/bin\/xcrun\", \"--show-sdk-path\");\n+        return new String(pb.start().getInputStream().readAllBytes());\n+    }\n+\n+    private Optional<Path> inferMacOsPath(String... paths) {\n+        if (isMacOSX) {\n@@ -557,5 +594,2 @@\n-                ProcessBuilder pb = new ProcessBuilder().\n-                    command(\"\/usr\/bin\/xcrun\", \"--show-sdk-path\");\n-                Process proc = pb.start();\n-                String str = new String(proc.getInputStream().readAllBytes());\n-                Path dir = Paths.get(str.trim(), \"usr\", \"include\");\n+                String str = getMacOsSDKPath();\n+                Path dir = Paths.get(str.trim(), paths);\n@@ -571,1 +605,0 @@\n-\n@@ -574,0 +607,18 @@\n+\n+    private String formatFrameworkPath(String optionString) {\n+        for (String dir : frameworkDirs) {\n+            Path path = Path.of(dir, optionString + \".framework\");\n+            if (Files.exists(path)) {\n+                return \":\" + path + optionString;\n+            }\n+        }\n+\n+        String publicPath = String.format(\"\/System\/Library\/Frameworks\/%1$s.framework\/\", optionString);\n+        String privatePath = String.format(\"\/System\/Library\/PrivateFrameworks\/%1$s.framework\/\", optionString);\n+\n+        String frameworkPath = Files.exists(Path.of(privatePath)) ? privatePath :\n+                Files.exists(Path.of(publicPath)) ? publicPath :\n+                        String.valueOf(inferMacOSFrameworkPath().orElse(null));\n+\n+        return \":\" + frameworkPath + optionString;\n+    }\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/JextractTool.java","additions":90,"deletions":39,"binary":false,"changes":129,"status":"modified"},{"patch":"@@ -30,1 +30,0 @@\n-import org.openjdk.jextract.Declaration.Constant;\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/Utils.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-#  Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2020, 2025 Oracle and\/or its affiliates. All rights reserved.\n@@ -4,1 +4,1 @@\n-# \n+#\n@@ -8,1 +8,1 @@\n-# \n+#\n@@ -14,1 +14,1 @@\n-# \n+#\n@@ -18,1 +18,1 @@\n-# \n+#\n@@ -29,0 +29,1 @@\n+framework.option.value.invalid=invalid library specifier for -framework option: {0}\n@@ -50,0 +51,2 @@\n+help.mac.framework=specify the path of the framework include files\n+help.framework.library.path=specify name of framework library, jextract will infer public frameworks dir\n@@ -84,1 +87,6 @@\n---version                          print version information and exit                           \\n\n+--version                          print version information and exit                           \\n\\\n+\\                                                                                               \\n\\\n+macOS platform options for running jextract (available only when running on macOS):             \\n\\\n+-F <dir>            specify the framework directory                                     \\n\\\n+-framework <framework>                     specify framework library. -framework libGL is equivalent to         \\n\\\n+\\                                      -l :\/System\/Library\/Frameworks\/libGL.framework\/libGL\n@@ -122,0 +130,3 @@\n+\n+jextract.no.library.specified=\\\n+no library specified using -l but --use-system-load-library was used\n","filename":"src\/main\/resources\/org\/openjdk\/jextract\/impl\/resources\/Messages.properties","additions":17,"deletions":6,"binary":false,"changes":23,"status":"modified"}]}