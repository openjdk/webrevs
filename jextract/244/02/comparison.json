{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -110,3 +110,1 @@\n-        appendLines(STR.\"\"\"\n-            \\{modifiers} \\{kind.kindName} \\{className}\\{extendsExpr} {\n-            \"\"\");\n+        appendLines(\"%s %s %s%s {\", modifiers, kind.kindName, className, extendsExpr);\n@@ -135,0 +133,3 @@\n+    void appendLines(String s, String... args) {\n+        sb.appendLines(String.format(s, (Object []) args));\n+    }\n@@ -146,0 +147,4 @@\n+    void appendIndentedLines(String s, String... args) {\n+        sb.appendIndentedLines(String.format(s, (Object []) args));\n+    }\n+\n@@ -147,1 +152,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(\"\"\"\n@@ -149,1 +154,1 @@\n-            \\{className}() {\n+            %s() {\n@@ -152,1 +157,1 @@\n-            \"\"\");\n+            \"\"\", className);\n@@ -160,1 +165,1 @@\n-        appendLines(STR.\"\"\"\n+        appendLines(\"\"\"\n@@ -162,1 +167,1 @@\n-            \\{!header.isEmpty() ? STR.\" * \\{header}\\n\" : \"\"}\\\n+            %s\n@@ -164,1 +169,1 @@\n-            \\{declarationComment(decl)}\n+            %s\n@@ -167,1 +172,1 @@\n-            \"\"\");\n+            \"\"\", !header.isEmpty() ? String.format(\" * %s\\n\", header) : \"\", declarationComment(decl));\n@@ -195,2 +200,2 @@\n-            case Declared d when Utils.isStructOrUnion(d) -> alignIfNeeded(STR.\"\\{JavaName.getFullNameOrThrow(d.tree())}.layout()\", ClangAlignOf.getOrThrow(d.tree()) \/ 8, align);\n-            case Delegated d when d.kind() == Delegated.Kind.POINTER -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_POINTER\", 8, align);\n+            case Declared d when Utils.isStructOrUnion(d) -> alignIfNeeded(\"%s.layout()\", JavaName.getFullNameOrThrow(d.tree()), ClangAlignOf.getOrThrow(d.tree()) \/ 8, align);\n+            case Delegated d when d.kind() == Delegated.Kind.POINTER -> alignIfNeeded(\"%s.C_POINTER\", runtimeHelperName(), 8, align);\n@@ -198,2 +203,2 @@\n-            case Function _ -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_POINTER\", 8, align);\n-            case Array a -> STR.\"MemoryLayout.sequenceLayout(\\{a.elementCount().orElse(0L)}, \\{layoutString(a.elementType(), align)})\";\n+            case Function _ -> alignIfNeeded(\"%s.C_POINTER\", runtimeHelperName(), 8, align);\n+            case Array a -> String.format(\"MemoryLayout.sequenceLayout(%d, %s)\", a.elementCount().orElse(0L), layoutString(a.elementType(), align));\n@@ -211,1 +216,1 @@\n-            builder.append(STR.\"\\{indentString(textBoxIndent + 1)}\\{layoutString(functionType.returnType())}\");\n+            builder.append(String.format(\"%s%s\", indentString(textBoxIndent + 1), layoutString(functionType.returnType())));\n@@ -223,1 +228,1 @@\n-                builder.append(STR.\"\\{indentString(textBoxIndent + 1)}\\{layoutString(arg)}\");\n+                builder.append(String.format(\"%s%s\", indentString(textBoxIndent + 1), layoutString(arg)));\n@@ -228,1 +233,1 @@\n-        builder.append(STR.\"\\{indentString(textBoxIndent)})\");\n+        builder.append(indentString(textBoxIndent)).append(\")\");\n@@ -238,8 +243,8 @@\n-            case Bool -> STR.\"\\{runtimeHelperName()}.C_BOOL\";\n-            case Char -> STR.\"\\{runtimeHelperName()}.C_CHAR\";\n-            case Short -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_SHORT\", 2, align);\n-            case Int -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_INT\", 4, align);\n-            case Long -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_LONG\", TypeImpl.IS_WINDOWS ? 4 : 8, align);\n-            case LongLong -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_LONG_LONG\", 8, align);\n-            case Float -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_FLOAT\", 4, align);\n-            case Double -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_DOUBLE\", 8, align);\n+            case Bool -> String.format(\"%s.C_BOOL\", runtimeHelperName());\n+            case Char -> String.format(\"%s.C_CHAR\", runtimeHelperName());\n+            case Short -> alignIfNeeded(\"%s.C_SHORT\", runtimeHelperName(), 2, align);\n+            case Int -> alignIfNeeded(\"%s.C_INT\", runtimeHelperName(), 4, align);\n+            case Long -> alignIfNeeded(\"%s.C_LONG\", runtimeHelperName(), TypeImpl.IS_WINDOWS ? 4 : 8, align);\n+            case LongLong -> alignIfNeeded(\"%s.C_LONG_LONG\", runtimeHelperName(), 8, align);\n+            case Float -> alignIfNeeded(\"%s.C_FLOAT\", runtimeHelperName(), 4, align);\n+            case Double -> alignIfNeeded(\"%s.C_DOUBLE\", runtimeHelperName(), 8, align);\n@@ -247,1 +252,1 @@\n-                    alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_LONG_DOUBLE\", 8, align) :\n+                    alignIfNeeded(\"%s.C_LONG_DOUBLE\", runtimeHelperName(), 8, align) :\n@@ -255,1 +260,2 @@\n-    private String alignIfNeeded(String layoutPrefix, long align, long expectedAlign) {\n+    private String alignIfNeeded(String layout, String prefix, long align, long expectedAlign) {\n+        String layoutPrefix = String.format(layout, prefix);\n@@ -257,1 +263,1 @@\n-                STR.\"\\{runtimeHelperName()}.align(\\{layoutPrefix}, \\{expectedAlign})\" :\n+                String.format(\"%s.align(%s, %d)\", runtimeHelperName(), layoutPrefix, expectedAlign) :\n@@ -262,1 +268,1 @@\n-        return STR.\"\\{indentString(indent)}MemoryLayout.paddingLayout(\\{size})\";\n+        return String.format(\"%sMemoryLayout.paddingLayout(%d)\", indentString(indent), size);\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/ClassSourceBuilder.java","additions":36,"deletions":30,"binary":false,"changes":66,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(\"\"\"\n@@ -75,2 +75,2 @@\n-            public interface \\{fiName} {\n-                \\{methodType.returnType().getSimpleName()} apply(\\{paramExprs()});\n+            public interface %1$s {\n+                %2$s apply(%3$s);\n@@ -78,1 +78,2 @@\n-            \"\"\");\n+            \"\"\",\n+            fiName, methodType.returnType().getSimpleName(), paramExprs());\n@@ -83,1 +84,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(\"\"\"\n@@ -85,1 +86,1 @@\n-            private static final MethodHandle UP$MH = \\{runtimeHelperName()}.upcallHandle(\\{className()}.\\{fiName}.class, \"apply\", $DESC);\n+            private static final MethodHandle UP$MH = %1$s.upcallHandle(%2$s.%3$s.class, \"apply\", $DESC);\n@@ -91,1 +92,1 @@\n-            public static MemorySegment allocate(\\{className()}.\\{fiName} fi, Arena arena) {\n+            public static MemorySegment allocate(%2$s.%3$s fi, Arena arena) {\n@@ -94,1 +95,2 @@\n-            \"\"\");\n+            \"\"\",\n+            runtimeHelperName(), className(), fiName);\n@@ -101,4 +103,3 @@\n-        String paramStr = methodType.parameterCount() != 0 ? STR.\",\\{paramExprs()}\" : \"\";\n-        appendIndentedLines(STR.\"\"\"\n-\n-            private static final MethodHandle DOWN$MH = Linker.nativeLinker().downcallHandle($DESC);\n+        String paramStr = methodType.parameterCount() != 0 ? String.format(\",%s\", paramExprs()) : \"\";\n+        appendIndentedLines(\"\"\"\n+        private static final MethodHandle DOWN$MH = Linker.nativeLinker().downcallHandle($DESC);\n@@ -109,1 +110,1 @@\n-            public static \\{methodType.returnType().getSimpleName()} invoke(MemorySegment funcPtr\\{allocParam}\\{paramStr}) {\n+            public static %1$s invoke(MemorySegment funcPtr%2$s%3$s) {\n@@ -111,1 +112,1 @@\n-                    \\{retExpr()} DOWN$MH.invokeExact(funcPtr\\{allocArg}\\{otherArgExprs()});\n+                    %4$s DOWN$MH.invokeExact(funcPtr%5$s%6$s);\n@@ -116,1 +117,7 @@\n-            \"\"\");\n+            \"\"\",\n+            methodType.returnType().getSimpleName(),\n+            allocParam,\n+            paramStr,\n+            retExpr(),\n+            allocArg,\n+            otherArgExprs());\n@@ -143,1 +150,1 @@\n-            retExpr = STR.\"return (\\{methodType.returnType().getSimpleName()})\";\n+            retExpr = String.format(\"return (%s)\", methodType.returnType().getSimpleName());\n@@ -159,1 +166,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(\"\"\"\n@@ -161,1 +168,1 @@\n-            private static final FunctionDescriptor $DESC = \\{functionDescriptorString(0, funcType)};\n+            private static final FunctionDescriptor $DESC = %s;\n@@ -169,1 +176,1 @@\n-            \"\"\");\n+            \"\"\", functionDescriptorString(0, funcType));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/FunctionalInterfaceBuilder.java","additions":26,"deletions":19,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+import java.text.MessageFormat;\n@@ -169,2 +170,2 @@\n-        String returnNoCast = isVoid ? \"\" : STR.\"return \";\n-        String returnWithCast = isVoid ? \"\" : STR.\"\\{returnNoCast}(\\{retType})\";\n+        String returnNoCast = isVoid ? \"\" : \"return \";\n+        String returnWithCast = isVoid ? \"\" : String.format(\"%s(%s)\", returnNoCast, retType);\n@@ -173,2 +174,2 @@\n-                STR.\"\\\"\\{nativeName}\\\"\" :\n-                STR.\"\\\"\\{nativeName}\\\", \\{paramList}\";\n+                String.format(\"\\\"%s\\\"\", nativeName) :\n+                String.format(\"\\\"%s\\\", %s\", nativeName, paramList);\n@@ -178,1 +179,1 @@\n-            appendLines(STR.\"\"\"\n+            appendLines(\"\"\"\n@@ -180,2 +181,2 @@\n-                private static class \\{holderClass} {\n-                    public static final FunctionDescriptor DESC = \\{functionDescriptorString(1, decl.type())};\n+                private static class %1$s {\n+                    public static final FunctionDescriptor DESC = %2$s;\n@@ -183,1 +184,1 @@\n-                    public static final MemorySegment ADDR = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(decl)}\");\n+                    public static final MemorySegment ADDR = %3$s.findOrThrow(\"%4$s\");\n@@ -187,1 +188,2 @@\n-                \"\"\");\n+                \"\"\", holderClass, functionDescriptorString(1, decl.type()),\n+                    runtimeHelperName(), lookupName(decl));\n@@ -190,3 +192,3 @@\n-            appendLines(STR.\"\"\"\n-                public static FunctionDescriptor \\{javaName}$descriptor() {\n-                    return \\{holderClass}.DESC;\n+            appendLines(\"\"\"\n+                public static FunctionDescriptor %1$s$descriptor() {\n+                    return %2$s.DESC;\n@@ -194,1 +196,1 @@\n-                \"\"\");\n+                \"\"\", javaName, holderClass);\n@@ -197,3 +199,3 @@\n-            appendLines(STR.\"\"\"\n-                public static MethodHandle \\{javaName}$handle() {\n-                    return \\{holderClass}.HANDLE;\n+            appendLines(\"\"\"\n+                public static MethodHandle %1$s$handle() {\n+                    return %2$s.HANDLE;\n@@ -201,1 +203,1 @@\n-                \"\"\");\n+                \"\"\", javaName, holderClass);\n@@ -204,3 +206,3 @@\n-            appendLines(STR.\"\"\"\n-                public static MemorySegment \\{javaName}$address() {\n-                    return \\{holderClass}.ADDR;\n+            appendLines(\"\"\"\n+                public static MemorySegment %1$s$address() {\n+                    return %2$s.ADDR;\n@@ -208,1 +210,1 @@\n-                \"\"\");\n+                \"\"\", javaName, holderClass);\n@@ -211,3 +213,3 @@\n-            appendLines(STR.\"\"\"\n-            public static \\{retType} \\{javaName}(\\{paramExprs(declType, finalParamNames, isVarArg)}) {\n-                var mh$ = \\{holderClass}.HANDLE;\n+            appendLines(\"\"\"\n+            public static %1$s %2$s(%3$s) {\n+                var mh$ = %4$s.HANDLE;\n@@ -216,1 +218,1 @@\n-                        traceDowncall(\\{traceArgList});\n+                        traceDowncall(%5$s);\n@@ -218,1 +220,1 @@\n-                    \\{returnWithCast}mh$.invokeExact(\\{paramList});\n+                    %6$s mh$.invokeExact(%7$s);\n@@ -223,1 +225,3 @@\n-            \"\"\");\n+            \"\"\", retType, javaName,\n+            paramExprs(declType, finalParamNames, isVarArg),\n+            holderClass, traceArgList, returnWithCast, paramList);\n@@ -229,4 +233,4 @@\n-            appendLines(STR.\"\"\"\n-                public static class \\{invokerClassName} {\n-                    private static final FunctionDescriptor BASE_DESC = \\{functionDescriptorString(2, decl.type())};\n-                    private static final MemorySegment ADDR = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(decl)}\");\n+            appendLines(\"\"\"\n+                public static class %1$s {\n+                    private static final FunctionDescriptor BASE_DESC = %2$s;\n+                    private static final MemorySegment ADDR = %3$s.findOrThrow(\"%4$s\");\n@@ -238,1 +242,1 @@\n-                    private \\{invokerClassName}(MethodHandle handle, FunctionDescriptor descriptor, MethodHandle spreader) {\n+                    private %5$s(MethodHandle handle, FunctionDescriptor descriptor, MethodHandle spreader) {\n@@ -243,1 +247,2 @@\n-                \"\"\");\n+                \"\"\", invokerClassName, functionDescriptorString(2, decl.type()),\n+                    runtimeHelperName(), lookupName(decl), invokerClassName);\n@@ -247,2 +252,2 @@\n-            appendLines(STR.\"\"\"\n-                public static \\{invokerClassName} makeInvoker(MemoryLayout... layouts) {\n+            appendLines(\"\"\"\n+                public static %1$s makeInvoker(MemoryLayout... layouts) {\n@@ -253,1 +258,1 @@\n-                    return new \\{invokerClassName}(mh$, desc$, spreader$);\n+                    return new %1$s(mh$, desc$, spreader$);\n@@ -255,1 +260,1 @@\n-                \"\"\");\n+                \"\"\", invokerClassName);\n@@ -257,1 +262,1 @@\n-            appendLines(STR.\"\"\"\n+            appendLines(\"\"\"\n@@ -280,1 +285,1 @@\n-                    public \\{retType} apply(\\{paramExprs}) {\n+                    public %1$s apply(%2$s) {\n@@ -283,1 +288,1 @@\n-                                traceDowncall(\\{traceArgList});\n+                                traceDowncall(%3$s);\n@@ -285,1 +290,1 @@\n-                            \\{returnWithCast}spreader.invokeExact(\\{paramList});\n+                            %4$s spreader.invokeExact(%5$s);\n@@ -293,1 +298,1 @@\n-                \"\"\");\n+                \"\"\", retType, paramExprs, traceArgList, returnWithCast, paramList);\n@@ -313,2 +318,2 @@\n-                static {\n-                \"\"\");\n+            static {\n+            \"\"\");\n@@ -318,1 +323,1 @@\n-                appendIndentedLines(STR.\"System.\\{method}(\\\"\\{lib.toQuotedName()}\\\");\");\n+                appendIndentedLines(\"System.%s(\\\"%s\\\");\", method, lib.toQuotedName());\n@@ -322,2 +327,2 @@\n-                }\n-                \"\"\");\n+            }\n+            \"\"\");\n@@ -328,2 +333,2 @@\n-                            STR.\"SymbolLookup.libraryLookup(\\\"\\{l.toQuotedName()}\\\", LIBRARY_ARENA)\" :\n-                            STR.\"SymbolLookup.libraryLookup(System.mapLibraryName(\\\"\\{l.toQuotedName()}\\\"), LIBRARY_ARENA)\")\n+                            String.format(\"SymbolLookup.libraryLookup(\\\"%s\\\", LIBRARY_ARENA)\", l.toQuotedName()) :\n+                            String.format(\"SymbolLookup.libraryLookup(System.mapLibraryName(\\\"%s\\\"), LIBRARY_ARENA)\", l.toQuotedName()))\n@@ -340,1 +345,1 @@\n-            lookupCalls.add(isFirst ? lookup : STR.\".or(\\{lookup})\");\n+            lookupCalls.add(isFirst ? lookup : String.format(\".or(%s)\", lookup));\n@@ -347,1 +352,1 @@\n-                .collect(Collectors.joining(STR.\"\\n\\{indentString(2)}\", \"static final SymbolLookup SYMBOL_LOOKUP = \", \";\")));\n+                .collect(Collectors.joining(String.format(\"\\n%s\", indentString(2)), \"static final SymbolLookup SYMBOL_LOOKUP = \", \";\")));\n@@ -398,3 +403,3 @@\n-        appendLines(STR.\"\"\"\n-            public static \\{type.getSimpleName()} \\{javaName}() {\n-                return \\{holderClass}.SEGMENT.get(\\{holderClass}.LAYOUT, 0L);\n+        appendLines(\"\"\"\n+            public static %1$s %2$s() {\n+                return %3$s.SEGMENT.get(%3$s.LAYOUT, 0L);\n@@ -402,1 +407,1 @@\n-            \"\"\");\n+            \"\"\", type.getSimpleName(), javaName, holderClass);\n@@ -412,3 +417,3 @@\n-        appendLines(STR.\"\"\"\n-            public static void \\{javaName}(\\{type.getSimpleName()} varValue) {\n-                \\{holderClass}.SEGMENT.set(\\{holderClass}.LAYOUT, 0L, varValue);\n+        appendLines(\"\"\"\n+            public static void %1$s(%2$s varValue) {\n+                %3$s.SEGMENT.set(%4$s.LAYOUT, 0L, varValue);\n@@ -416,1 +421,1 @@\n-            \"\"\");\n+            \"\"\", javaName, type.getSimpleName(), holderClass, holderClass);\n@@ -425,3 +430,3 @@\n-        appendLines(STR.\"\"\"\n-            public static MemorySegment \\{javaName}() {\n-                return \\{holderClass}.SEGMENT;\n+        appendLines(\"\"\"\n+            public static MemorySegment %s() {\n+                return %s.SEGMENT;\n@@ -429,1 +434,1 @@\n-            \"\"\");\n+            \"\"\", javaName, holderClass);\n@@ -438,3 +443,3 @@\n-        appendLines(STR.\"\"\"\n-            public static void \\{javaName}(MemorySegment varValue) {\n-                MemorySegment.copy(varValue, 0L, \\{holderClass}.SEGMENT, 0L, \\{holderClass}.LAYOUT.byteSize());\n+        appendLines(\"\"\"\n+            public static void %s(MemorySegment varValue) {\n+                MemorySegment.copy(varValue, 0L, %s.SEGMENT, 0L, %s.LAYOUT.byteSize());\n@@ -442,1 +447,1 @@\n-            \"\"\");\n+            \"\"\", javaName, holderClass, holderClass);\n@@ -454,2 +459,2 @@\n-            appendLines(STR.\"\"\"\n-                public static MemorySegment \\{javaName}(\\{indexList.decl()}) {\n+            appendLines(\"\"\"\n+                public static MemorySegment %1$s(%2$s) {\n@@ -457,1 +462,1 @@\n-                        return (MemorySegment)\\{holderClass}.HANDLE.invokeExact(\\{holderClass}.SEGMENT, 0L, \\{indexList.use()});\n+                        return (MemorySegment)%3$s.HANDLE.invokeExact(%4$s.SEGMENT, 0L, %5$s);\n@@ -462,1 +467,1 @@\n-                \"\"\");\n+                \"\"\", javaName, indexList.decl(), holderClass, holderClass, indexList.use());\n@@ -464,3 +469,3 @@\n-            appendLines(STR.\"\"\"\n-                public static \\{typeCls.getSimpleName()} \\{javaName}(\\{indexList.decl()}) {\n-                    return (\\{typeCls.getSimpleName()})\\{holderClass}.HANDLE.get(\\{holderClass}.SEGMENT, 0L, \\{indexList.use()});\n+            appendLines(\"\"\"\n+                public static %1$s %2$s(%3$s) {\n+                    return (%1$s)%4$s.HANDLE.get(%4$s.SEGMENT, 0L, %5$s);\n@@ -468,1 +473,2 @@\n-                \"\"\");\n+                \"\"\", typeCls.getSimpleName(), javaName, indexList.decl(),\n+                    holderClass, indexList.use());\n@@ -481,5 +487,5 @@\n-            appendLines(STR.\"\"\"\n-                public static void \\{javaName}(\\{indexList.decl()}, MemorySegment varValue) {\n-                    MemorySegment.copy(varValue, 0L, \\{javaName}(\\{indexList.use()}), 0L, \\{layoutString(elemType)}.byteSize());\n-                }\n-                \"\"\");\n+            appendLines(MessageFormat.format(\"\"\"\n+        public static void {0}({1}, MemorySegment varValue) '{'\n+            MemorySegment.copy(varValue, 0L, {0}({2}), 0L, {3}.byteSize());\n+        '}'\n+        \"\"\", javaName, indexList.decl(), indexList.use(), layoutString(elemType)));\n@@ -487,5 +493,5 @@\n-            appendLines(STR.\"\"\"\n-                public static void \\{javaName}(\\{indexList.decl()}, \\{typeCls.getSimpleName()} varValue) {\n-                    \\{holderClass}.HANDLE.set(\\{holderClass}.SEGMENT, 0L, \\{indexList.use()}, varValue);\n-                }\n-                \"\"\");\n+            appendLines(\"\"\"\n+        public static void %1$s(%2$s, %3$s varValue) {\n+            %4$s.HANDLE.set(%4$s.SEGMENT, 0L, %5$s, varValue);\n+        }\n+        \"\"\", javaName, indexList.decl(), typeCls.getSimpleName(), holderClass, indexList.use());\n@@ -498,1 +504,1 @@\n-        String mangledName = newHolderClassName(STR.\"\\{javaName}$constants\");\n+        String mangledName = newHolderClassName(String.format(\"%s$constants\", javaName));\n@@ -507,3 +513,3 @@\n-                    STR.\"public static final MethodHandle HANDLE = LAYOUT.sliceHandle(\\{path});\" :\n-                    STR.\"public static final VarHandle HANDLE = LAYOUT.varHandle(\\{path});\\n\";\n-            String dimsString = dimensions.stream().map(d -> d.toString())\n+                    \"public static final MethodHandle HANDLE = LAYOUT.sliceHandle(\" + path + \");\" :\n+                    \"public static final VarHandle HANDLE = LAYOUT.varHandle(\" + path + \");\\n\";\n+            String dimsString = dimensions.stream().map(Object::toString)\n@@ -511,8 +517,9 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static class \\{mangledName} {\n-                    public static final \\{layoutType} LAYOUT = \\{layoutString(varType)};\n-                    public static final MemorySegment SEGMENT = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(var)}\").reinterpret(LAYOUT.byteSize());\n-                    \\{accessHandle}\n-                    public static final long[] DIMS = { \\{dimsString} };\n-                }\n-                \"\"\");\n+            appendIndentedLines(\"\"\"\n+            private static class %1$s {\n+                public static final %2$s LAYOUT = %3$s;\n+                public static final MemorySegment SEGMENT = %4$s.findOrThrow(\"%5$s\").reinterpret(LAYOUT.byteSize());\n+                %6$s\n+                public static final long[] DIMS = { %7$s };\n+            }\n+            \"\"\", mangledName, layoutType, layoutString(varType), runtimeHelperName(),\n+                    lookupName(var), accessHandle, dimsString);\n@@ -520,6 +527,6 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static class \\{mangledName} {\n-                    public static final \\{layoutType} LAYOUT = \\{layoutString(varType)};\n-                    public static final MemorySegment SEGMENT = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(var)}\").reinterpret(LAYOUT.byteSize());\n-                }\n-                \"\"\");\n+            appendIndentedLines(\"\"\"\n+            private static class %1$s {\n+                public static final %2$s LAYOUT = %3$s;\n+                public static final MemorySegment SEGMENT = %4$s.findOrThrow(\"%5$s\").reinterpret(LAYOUT.byteSize());\n+            }\n+            \"\"\", mangledName, layoutType, layoutString(varType), runtimeHelperName(), lookupName(var));\n@@ -530,5 +537,5 @@\n-        appendLines(STR.\"\"\"\n-                public static \\{layoutType} \\{javaName}$layout() {\n-                    return \\{mangledName}.LAYOUT;\n-                }\n-                \"\"\");\n+        appendLines(\"\"\"\n+        public static %s %s$layout() {\n+            return %s.LAYOUT;\n+        }\n+        \"\"\", layoutType, javaName, mangledName);\n@@ -538,5 +545,5 @@\n-            appendLines(STR.\"\"\"\n-                    public static MemorySegment \\{javaName}$segment() {\n-                        return \\{mangledName}.SEGMENT;\n-                    }\n-                    \"\"\");\n+            appendLines(\"\"\"\n+            public static MemorySegment %s$segment() {\n+                return %s.SEGMENT;\n+            }\n+            \"\"\", javaName, mangledName);\n@@ -547,5 +554,5 @@\n-            appendLines(STR.\"\"\"\n-                public static long[] \\{javaName}$dimensions() {\n-                    return \\{mangledName}.DIMS;\n-                }\n-                \"\"\");\n+            appendLines(\"\"\"\n+            public static long[] %s$dimensions() {\n+                return %s.DIMS;\n+            }\n+            \"\"\", javaName, mangledName);\n@@ -561,2 +568,2 @@\n-            appendLines(STR.\"\"\"\n-                public static \\{javaType.getSimpleName()} \\{constantName}() {\n+            appendLines(\"\"\"\n+                public static %s %s() {\n@@ -564,2 +571,2 @@\n-                        static final \\{javaType.getSimpleName()} \\{constantName}\n-                            = \\{runtimeHelperName()}.LIBRARY_ARENA.allocateFrom(\"\\{Utils.quote(Objects.toString(value))}\");\n+                        static final %s %s\n+                            = %s.LIBRARY_ARENA.allocateFrom(\"%s\");\n@@ -567,1 +574,1 @@\n-                    return Holder.\\{constantName};\n+                    return Holder.%s;\n@@ -569,1 +576,8 @@\n-                \"\"\");\n+                \"\"\",\n+                javaType.getSimpleName(),\n+                constantName,\n+                javaType.getSimpleName(),\n+                constantName,\n+                runtimeHelperName(),\n+                Utils.quote(Objects.toString(value)),\n+                constantName);\n@@ -571,7 +585,10 @@\n-            appendLines(STR.\"\"\"\n-                private static final \\{javaType.getSimpleName()} \\{constantName} = \\{constantValue(javaType, value)};\n-                \"\"\");\n-            emitDocComment(declaration);\n-            appendLines(STR.\"\"\"\n-                public static \\{javaType.getSimpleName()} \\{constantName}() {\n-                    return \\{constantName};\n+            appendLines(\"\"\"\n+                private static final %s %s = %s;\n+                \"\"\",\n+                javaType.getSimpleName(),\n+                constantName,\n+                constantValue(javaType, value));\n+                 emitDocComment(declaration);\n+            appendLines(\"\"\"\n+                public static %s %s() {\n+                    return %s;\n@@ -579,1 +596,4 @@\n-                \"\"\");\n+                \"\"\",\n+                javaType.getSimpleName(),\n+                constantName,\n+                constantName);\n@@ -586,1 +606,1 @@\n-            return STR.\"MemorySegment.ofAddress(\\{((Number)value).longValue()}L)\";\n+            return String.format(\"MemorySegment.ofAddress(%dL)\", ((Number)value).longValue());\n@@ -619,1 +639,1 @@\n-                throw new IllegalArgumentException(STR.\"Unhandled type: \\{type}, or value: \\{value}\");\n+                throw new IllegalArgumentException(String.format(\"Unhandled type: %s, or value: %s\", type, value));\n@@ -628,3 +648,4 @@\n-        appendLines(STR.\"\"\"\n-        public static final \\{Utils.layoutCarrierFor(type).getSimpleName()} \\{javaName} = \\{layoutString(type)};\n-        \"\"\");\n+        appendLines(\"\"\"\n+        public static final %s %s = %s;\n+        \"\"\",\n+        Utils.layoutCarrierFor(type).getSimpleName(), javaName, layoutString(type));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/HeaderFileBuilder.java","additions":158,"deletions":137,"binary":false,"changes":295,"status":"modified"},{"patch":"@@ -54,1 +54,1 @@\n-        errWriter.println(STR.\"ERROR: \\{format(key, args)}\");\n+        errWriter.println(String.format(\"ERROR: %s\", format(key, args)));\n@@ -59,1 +59,1 @@\n-        errWriter.println(STR.\"WARNING: \\{format(key, args)}\");\n+        errWriter.println(String.format(\"WARNING: %s\", format(key, args)));\n@@ -73,1 +73,1 @@\n-        errWriter.println(STR.\"FATAL: \\{format(msg, args)}\");\n+        errWriter.println(String.format(\"FATAL: %s\", format(msg, args)));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/Logger.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- *  Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ *  Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -177,2 +177,2 @@\n-                    STR.\"<error: \\{((TypeImpl.ErronrousTypeImpl)t).erroneousName}>\" :\n-                    STR.\"<unknown: \\{t.getClass().getName()}>\";\n+                    String.format(\"<error: %s>\", ((TypeImpl.ErronrousTypeImpl) t).erroneousName) :\n+                    String.format(\"<unknown: %s>\", t.getClass().getName());\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/PrettyPrinter.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -61,2 +61,2 @@\n-        appendLines(STR.\"\"\"\n-            \/\/ Generated by jextract\\{SHOW_GENERATING_CLASS ? STR.\" (via \\{getClass().getName()})\" : \"\"}\n+        appendLines(String.format(\"\"\"\n+            \/\/ Generated by jextract%s\n@@ -64,1 +64,1 @@\n-            \"\"\");\n+            \"\"\", SHOW_GENERATING_CLASS ? String.format(\" (via %s)\", getClass().getName()) : \"\"));\n@@ -66,2 +66,2 @@\n-            appendLines(STR.\"\"\"\n-                package \\{packageName};\n+            appendLines(String.format(\"\"\"\n+                package %s;\n@@ -69,1 +69,1 @@\n-                \"\"\");\n+                \"\"\", packageName));\n@@ -99,1 +99,1 @@\n-        return new JavaSourceFile(STR.\"\\{className}\\{suffix}\", packageName, finisher.apply(sb.toString()));\n+        return new JavaSourceFile(String.format(\"%s%s\",className,suffix),packageName,finisher.apply(sb.toString()));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/SourceFileBuilder.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+import java.text.MessageFormat;\n@@ -65,1 +66,1 @@\n-        return isEnclosedBySameName(paramName)? paramName + \"$\" : paramName;\n+        return isEnclosedBySameName(paramName) ? paramName + \"$\" : paramName;\n@@ -155,1 +156,1 @@\n-            throw new IllegalArgumentException(STR.\"Type not supported: \\{varTree.type()}\");\n+            throw new IllegalArgumentException(String.format(\"Type not supported: %s\", varTree.type()));\n@@ -191,3 +192,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static \\{type.getSimpleName()} \\{javaName}(MemorySegment \\{segmentParam}) {\n-                return \\{segmentParam}.get(\\{layoutField}, \\{offsetField});\n+        appendIndentedLines(\"\"\"\n+            public static %1$s %2$s(MemorySegment %3$s) {\n+                return %3$s.get(%4$s, %5$s);\n@@ -195,1 +196,1 @@\n-            \"\"\");\n+            \"\"\", type.getSimpleName(), javaName, segmentParam, layoutField, offsetField);\n@@ -204,3 +205,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static void \\{javaName}(MemorySegment \\{segmentParam}, \\{type.getSimpleName()} \\{valueParam}) {\n-                \\{segmentParam}.set(\\{layoutField}, \\{offsetField}, \\{valueParam});\n+        appendIndentedLines(\"\"\"\n+            public static void %1$s(MemorySegment %2$s, %3$s %4$s) {\n+                %2$s.set(%5$s, %6$s, %4$s);\n@@ -208,1 +209,1 @@\n-            \"\"\");\n+            \"\"\", javaName, segmentParam, type.getSimpleName(), valueParam, layoutField, offsetField);\n@@ -215,3 +216,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static MemorySegment \\{javaName}(MemorySegment \\{segmentParam}) {\n-                return \\{segmentParam}.asSlice(\\{offsetField}, \\{layoutField}.byteSize());\n+        appendIndentedLines(\"\"\"\n+            public static MemorySegment %1$s(MemorySegment %2$s) {\n+                return %2$s.asSlice(%3$s, %4$s.byteSize());\n@@ -219,1 +220,2 @@\n-            \"\"\");\n+            \"\"\",\n+            javaName, segmentParam, offsetField, layoutField);\n@@ -227,3 +229,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static void \\{javaName}(MemorySegment \\{segmentParam}, MemorySegment \\{valueParam}) {\n-                MemorySegment.copy(\\{valueParam}, 0L, \\{segmentParam}, \\{offsetField}, \\{layoutField}.byteSize());\n+        appendIndentedLines(\"\"\"\n+           public static void %1$s(MemorySegment %2$s, MemorySegment %3$s) {\n+                MemorySegment.copy(%3$s, 0L, %2$s, %4$s, %5$s.byteSize());\n@@ -231,1 +233,1 @@\n-            \"\"\");\n+            \"\"\", javaName, segmentParam, valueParam, offsetField, layoutField);\n@@ -235,1 +237,1 @@\n-        String arrayHandleName = STR.\"\\{javaName}$ELEM_HANDLE\";\n+        String arrayHandleName = String.format(\"%s$ELEM_HANDLE\", javaName);\n@@ -241,3 +243,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static final MethodHandle \\{arrayHandleName} = \\{fieldLayoutName}.sliceHandle(\\{path});\n-                \"\"\");\n+            appendIndentedLines(\"\"\"\n+                private static final MethodHandle %s = %s.sliceHandle(%s);\n+                \"\"\", arrayHandleName, fieldLayoutName, path);\n@@ -245,3 +247,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static final VarHandle \\{arrayHandleName} = \\{fieldLayoutName}.varHandle(\\{path});\n-                \"\"\");\n+            appendIndentedLines(\"\"\"\n+                private static final VarHandle %s = %s.varHandle(%s);\n+                \"\"\", arrayHandleName, fieldLayoutName, path);\n@@ -259,2 +261,2 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static MemorySegment \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}) {\n+            appendIndentedLines(\"\"\"\n+                public static MemorySegment %1$s(MemorySegment %2$s, %3$s) {\n@@ -262,1 +264,1 @@\n-                        return (MemorySegment)\\{arrayElementHandle}.invokeExact(\\{segmentParam}, 0L, \\{indexList.use()});\n+                        return (MemorySegment)%4$s.invokeExact(%2$s, 0L, %5$s);\n@@ -267,1 +269,1 @@\n-                \"\"\");\n+                \"\"\", javaName, segmentParam, indexList.decl(), arrayElementHandle, indexList.use());\n@@ -269,3 +271,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static \\{elemTypeCls.getSimpleName()} \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}) {\n-                    return (\\{elemTypeCls.getSimpleName()})\\{arrayElementHandle}.get(\\{segmentParam}, 0L, \\{indexList.use()});\n+            appendIndentedLines(\"\"\"\n+                public static %1$s %2$s(MemorySegment %3$s, %4$s) {\n+                    return (%1$s)%5$s.get(%3$s, 0L, %6$s);\n@@ -273,1 +275,2 @@\n-                \"\"\");\n+                \"\"\", elemTypeCls.getSimpleName(), javaName, segmentParam\n+                   ,indexList.decl(), arrayElementHandle, indexList.use());\n@@ -285,3 +288,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static void \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}, MemorySegment \\{valueParam}) {\n-                    MemorySegment.copy(\\{valueParam}, 0L, \\{javaName}(\\{segmentParam}, \\{indexList.use()}), 0L, \\{layoutString(elemType)}.byteSize());\n+            appendIndentedLines(\"\"\"\n+                public static void %1$s(MemorySegment %2$s, %3$s, MemorySegment %4$s) {\n+                    MemorySegment.copy(%4$s, 0L, %1$s(%2$s, %5$s), 0L, %6$s.byteSize());\n@@ -289,1 +292,2 @@\n-                \"\"\");\n+                \"\"\", javaName, segmentParam, indexList.decl()\n+                   ,valueParam, indexList.use(), layoutString(elemType));\n@@ -291,3 +295,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static void \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}, \\{elemTypeCls.getSimpleName()} \\{valueParam}) {\n-                    \\{arrayElementHandle}.set(\\{segmentParam}, 0L, \\{indexList.use()}, \\{valueParam});\n+            appendIndentedLines(\"\"\"\n+                public static void %1$s(MemorySegment %2$s, %3$s, %4$s %5$s) {\n+                    %6$s.set(%2$s, 0L, %7$s, %5$s);\n@@ -295,1 +299,2 @@\n-                \"\"\");\n+                \"\"\", javaName, segmentParam, indexList.decl(), elemTypeCls.getSimpleName()\n+                   ,valueParam, arrayElementHandle, indexList.use());\n@@ -301,1 +306,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(MessageFormat.format(\"\"\"\n@@ -304,2 +309,2 @@\n-             * Obtains a slice of {@code arrayParam} which selects the array element at {@code index}.\n-             * The returned segment has address {@code arrayParam.address() + index * layout().byteSize()}\n+             * Obtains a slice of {0} which selects the array element at {0}.\n+             * The returned segment has address {0}.address() + index * layout().byteSize()\n@@ -307,4 +312,4 @@\n-            public static MemorySegment asSlice(MemorySegment \\{arrayParam}, long index) {\n-                return \\{arrayParam}.asSlice(layout().byteSize() * index);\n-            }\n-            \"\"\");\n+            public static MemorySegment asSlice(MemorySegment {0}, long index) '{'\n+                return {0}.asSlice(layout().byteSize() * index);\n+            '}'\n+            \"\"\", arrayParam));\n@@ -314,2 +319,1 @@\n-        appendIndentedLines(STR.\"\"\"\n-\n+        appendIndentedLines(\"\"\"\n@@ -317,1 +321,1 @@\n-             * The size (in bytes) of this \\{kindName()}\n+             * The size (in bytes) of this %s\n@@ -320,1 +324,1 @@\n-            \"\"\");\n+            \"\"\", kindName());\n@@ -325,1 +329,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(MessageFormat.format(\"\"\"\n@@ -328,1 +332,1 @@\n-             * Allocate a segment of size {@code layout().byteSize()} using {@code \\{allocatorParam}}\n+             * Allocate a segment of size '{'@code layout().byteSize()'}' using {0}\n@@ -330,4 +334,4 @@\n-            public static MemorySegment allocate(SegmentAllocator \\{allocatorParam}) {\n-                return \\{allocatorParam}.allocate(layout());\n-            }\n-            \"\"\");\n+            public static MemorySegment allocate(SegmentAllocator {0}) '{'\n+                return {0}.allocate(layout());\n+            '}'\n+            \"\"\", allocatorParam));\n@@ -339,1 +343,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(\"\"\"\n@@ -342,2 +346,2 @@\n-             * Allocate an array of size {@code \\{elementCountParam}} using {@code \\{allocatorParam}}.\n-             * The returned segment has size {@code \\{elementCountParam} * layout().byteSize()}.\n+             * Allocate an array of size {@code %1$s} using %2$s.\n+             * The returned segment has size {@code %1$s * layout().byteSize()}.\n@@ -345,2 +349,2 @@\n-            public static MemorySegment allocateArray(long \\{elementCountParam}, SegmentAllocator \\{allocatorParam}) {\n-                return \\{allocatorParam}.allocate(MemoryLayout.sequenceLayout(\\{elementCountParam}, layout()));\n+            public static MemorySegment allocateArray(long %1$s, SegmentAllocator %2$s) {\n+                return %2$s.allocate(MemoryLayout.sequenceLayout(%1$s, layout()));\n@@ -348,1 +352,1 @@\n-            \"\"\");\n+            \"\"\", elementCountParam, allocatorParam);\n@@ -373,1 +377,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(\"\"\"\n@@ -375,1 +379,1 @@\n-            private static final GroupLayout $LAYOUT = \\{structOrUnionLayoutString(structType)};\n+            private static final GroupLayout $LAYOUT = %s;\n@@ -378,1 +382,1 @@\n-             * The layout of this \\{kindName()}\n+             * The layout of this %s\n@@ -383,1 +387,2 @@\n-            \"\"\");\n+            \"\"\",\n+            structOrUnionLayoutString(structType), kindName());\n@@ -387,4 +392,5 @@\n-        String offsetFieldName = STR.\"\\{javaName}$OFFSET\";\n-        appendIndentedLines(STR.\"\"\"\n-            private static final long \\{offsetFieldName} = \\{ClangOffsetOf.getOrThrow(field) \/ 8};\n-            \"\"\");\n+        String offsetFieldName = String.format(\"%s$OFFSET\", javaName);\n+        appendIndentedLines(String.format(\"\"\"\n+            private static final long %s = %d;\n+            \"\"\",\n+            offsetFieldName, ClangOffsetOf.getOrThrow(field) \/ 8));\n@@ -393,3 +399,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static final long \\{javaName}$offset() {\n-                return \\{offsetFieldName};\n+        appendIndentedLines(\"\"\"\n+            public static final long %s$offset() {\n+                return %s;\n@@ -397,1 +403,1 @@\n-            \"\"\");\n+            \"\"\", javaName, offsetFieldName);\n@@ -402,1 +408,1 @@\n-        String layoutFieldName = STR.\"\\{javaName}$LAYOUT\";\n+        String layoutFieldName = String.format(\"%s$LAYOUT\", javaName);\n@@ -404,3 +410,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            private static final \\{layoutType} \\{layoutFieldName} = (\\{layoutType})$LAYOUT.select(\\{fieldElementPaths(field.name())});\n-            \"\"\");\n+        appendIndentedLines(\"\"\"\n+            private static final %s %s = (%1$s)$LAYOUT.select(%s);\n+            \"\"\", layoutType, layoutFieldName, fieldElementPaths(field.name()));\n@@ -409,3 +415,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static final \\{layoutType} \\{javaName}$layout() {\n-                return \\{layoutFieldName};\n+        appendIndentedLines(\"\"\"\n+            public static final %s %s$layout() {\n+                return %s;\n@@ -413,1 +419,1 @@\n-            \"\"\");\n+            \"\"\", layoutType, javaName, layoutFieldName);\n@@ -418,1 +424,1 @@\n-        String dimsFieldName = STR.\"\\{javaName}$DIMS\";\n+        String dimsFieldName = String.format(\"%s$DIMS\", javaName);\n@@ -420,1 +426,1 @@\n-        String dimsString = dimensions.stream().map(d -> d.toString())\n+        String dimsString = dimensions.stream().map(Object::toString)\n@@ -422,1 +428,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(\"\"\"\n@@ -424,2 +430,2 @@\n-            private static long[] \\{dimsFieldName} = { \\{dimsString} };\n-            \"\"\");\n+            private static long[] %s = { %s };\n+            \"\"\", dimsFieldName, dimsString);\n@@ -428,3 +434,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static long[] \\{javaName}$dimensions() {\n-                return \\{dimsFieldName};\n+        appendIndentedLines(\"\"\"\n+            public static long[] %s$dimensions() {\n+                return %s;\n@@ -432,1 +438,1 @@\n-            \"\"\");\n+            \"\"\", javaName, dimsFieldName);\n@@ -474,1 +480,1 @@\n-                    memberLayout = STR.\"\\{indentString(indent + 1)}\\{memberLayout}.withName(\\\"\\{member.name()}\\\")\";\n+                    memberLayout = String.format(\"%s%s.withName(\\\"%s\\\")\", indentString(indent + 1), memberLayout, member.name());\n@@ -499,3 +505,3 @@\n-                STR.\"\\{indentString(indent)}MemoryLayout.structLayout(\\n\" :\n-                STR.\"\\{indentString(indent)}MemoryLayout.unionLayout(\\n\";\n-        String suffix = STR.\"\\n\\{indentString(indent)})\";\n+                String.format(\"%sMemoryLayout.structLayout(\\n\", indentString(indent)) :\n+                String.format(\"%sMemoryLayout.unionLayout(\\n\", indentString(indent));\n+        String suffix = String.format(\"\\n%s)\", indentString(indent));\n@@ -508,1 +514,1 @@\n-        return STR.\"\\{layoutString}.withName(\\\"\\{name}\\\")\";\n+        return String.format(\"%s.withName(\\\"%s\\\")\", layoutString, name);\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/StructBuilder.java","additions":104,"deletions":98,"binary":false,"changes":202,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,1 @@\n-        HeaderFileBuilder first = new HeaderFileBuilder(sfb, STR.\"\\{sfb.className()}#{SUFFIX}\", null, sfb.className());\n+        HeaderFileBuilder first = new HeaderFileBuilder(sfb, String.format(\"%s#{SUFFIX}\",sfb.className()), null, sfb.className());\n@@ -67,1 +67,1 @@\n-        first.appendIndentedLines(STR.\"\"\"\n+        first.appendIndentedLines(\"\"\"\n@@ -102,2 +102,2 @@\n-                        STR.\"_\\{suffix}\";\n-                String prevSuffix = STR.\"_\\{suffix + 1}\";\n+                        String.format(\"_%d\", suffix);\n+                String prevSuffix = String.format(\"_%d\", suffix + 1);\n@@ -106,1 +106,1 @@\n-                              .replace(\"#{PREV_SUFFIX}\", prevSuffix)));\n+                               .replace(\"#{PREV_SUFFIX}\", prevSuffix)));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/ToplevelBuilder.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -235,1 +235,1 @@\n-            valueString = STR.\"\\\"\\{valueString}\\\"\";\n+            valueString = String.format(\"\\\"%s\\\"\", valueString);\n@@ -238,1 +238,1 @@\n-            valueString = STR.\"(void*) \\{valueString}\";\n+            valueString = String.format(\"(void*) %s\", valueString);\n@@ -240,1 +240,1 @@\n-        DeclarationString.with(macro, STR.\"#define \\{name} \\{valueString}\");\n+        DeclarationString.with(macro, String.format(\"#define %s %s\", name, valueString));\n@@ -533,1 +533,1 @@\n-        return STR.\"enum \\{enumName}.\\{enumConstant.name()} = \\{enumConstant.value()}\";\n+        return String.format(\"enum %s.%s = %s\", enumName, enumConstant.name(), enumConstant.value());\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/TreeMaker.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}