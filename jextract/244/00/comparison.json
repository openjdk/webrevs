{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -110,3 +110,1 @@\n-        appendLines(STR.\"\"\"\n-            \\{modifiers} \\{kind.kindName} \\{className}\\{extendsExpr} {\n-            \"\"\");\n+        appendLines(String.format(\"%s %s %s%s {\", modifiers, kind.kindName, className, extendsExpr));\n@@ -147,1 +145,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -149,1 +147,1 @@\n-            \\{className}() {\n+            %s() {\n@@ -152,1 +150,1 @@\n-            \"\"\");\n+            \"\"\", className));\n@@ -160,1 +158,1 @@\n-        appendLines(STR.\"\"\"\n+        appendLines(String.format(\"\"\"\n@@ -162,1 +160,1 @@\n-            \\{!header.isEmpty() ? STR.\" * \\{header}\\n\" : \"\"}\\\n+            %s\n@@ -164,1 +162,1 @@\n-            \\{declarationComment(decl)}\n+            %s\n@@ -167,1 +165,1 @@\n-            \"\"\");\n+            \"\"\", !header.isEmpty() ? String.format(\" * %s\\n\", header) : \"\", declarationComment(decl)));\n@@ -195,2 +193,2 @@\n-            case Declared d when Utils.isStructOrUnion(d) -> alignIfNeeded(STR.\"\\{JavaName.getFullNameOrThrow(d.tree())}.layout()\", ClangAlignOf.getOrThrow(d.tree()) \/ 8, align);\n-            case Delegated d when d.kind() == Delegated.Kind.POINTER -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_POINTER\", 8, align);\n+            case Declared d when Utils.isStructOrUnion(d) -> alignIfNeeded(String.format(\"%s.layout()\", JavaName.getFullNameOrThrow(d.tree())), ClangAlignOf.getOrThrow(d.tree()) \/ 8, align);\n+            case Delegated d when d.kind() == Delegated.Kind.POINTER -> alignIfNeeded(String.format(\"%s.C_POINTER\", runtimeHelperName()), 8, align);\n@@ -198,2 +196,2 @@\n-            case Function _ -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_POINTER\", 8, align);\n-            case Array a -> STR.\"MemoryLayout.sequenceLayout(\\{a.elementCount().orElse(0L)}, \\{layoutString(a.elementType(), align)})\";\n+            case Function _ -> alignIfNeeded(String.format(\"%s.C_POINTER\", runtimeHelperName()), 8, align);\n+            case Array a -> String.format(\"MemoryLayout.sequenceLayout(%d, %s)\", a.elementCount().orElse(0L), layoutString(a.elementType(), align));\n@@ -211,1 +209,1 @@\n-            builder.append(STR.\"\\{indentString(textBoxIndent + 1)}\\{layoutString(functionType.returnType())}\");\n+            builder.append(String.format(\"%s%s\", indentString(textBoxIndent + 1), layoutString(functionType.returnType())));\n@@ -223,1 +221,1 @@\n-                builder.append(STR.\"\\{indentString(textBoxIndent + 1)}\\{layoutString(arg)}\");\n+                builder.append(String.format(\"%s%s\", indentString(textBoxIndent + 1), layoutString(arg)));\n@@ -228,1 +226,1 @@\n-        builder.append(STR.\"\\{indentString(textBoxIndent)})\");\n+        builder.append(indentString(textBoxIndent)).append(\")\");\n@@ -238,8 +236,8 @@\n-            case Bool -> STR.\"\\{runtimeHelperName()}.C_BOOL\";\n-            case Char -> STR.\"\\{runtimeHelperName()}.C_CHAR\";\n-            case Short -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_SHORT\", 2, align);\n-            case Int -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_INT\", 4, align);\n-            case Long -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_LONG\", TypeImpl.IS_WINDOWS ? 4 : 8, align);\n-            case LongLong -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_LONG_LONG\", 8, align);\n-            case Float -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_FLOAT\", 4, align);\n-            case Double -> alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_DOUBLE\", 8, align);\n+            case Bool -> String.format(\"%s.C_BOOL\", runtimeHelperName());\n+            case Char -> String.format(\"%s.C_CHAR\", runtimeHelperName());\n+            case Short -> alignIfNeeded(String.format(\"%s.C_SHORT\", runtimeHelperName()), 2, align);\n+            case Int -> alignIfNeeded(String.format(\"%s.C_INT\", runtimeHelperName()), 4, align);\n+            case Long -> alignIfNeeded(String.format(\"%s.C_LONG\", runtimeHelperName()), TypeImpl.IS_WINDOWS ? 4 : 8, align);\n+            case LongLong -> alignIfNeeded(String.format(\"%s.C_LONG_LONG\", runtimeHelperName()), 8, align);\n+            case Float -> alignIfNeeded(String.format(\"%s.C_FLOAT\", runtimeHelperName()), 4, align);\n+            case Double -> alignIfNeeded(String.format(\"%s.C_DOUBLE\", runtimeHelperName()), 8, align);\n@@ -247,1 +245,1 @@\n-                    alignIfNeeded(STR.\"\\{runtimeHelperName()}.C_LONG_DOUBLE\", 8, align) :\n+                    alignIfNeeded(String.format(\"%s.C_LONG_DOUBLE\", runtimeHelperName()), 8, align) :\n@@ -257,1 +255,1 @@\n-                STR.\"\\{runtimeHelperName()}.align(\\{layoutPrefix}, \\{expectedAlign})\" :\n+                String.format(\"%s.align(%s, %d)\", runtimeHelperName(), layoutPrefix, expectedAlign) :\n@@ -262,1 +260,1 @@\n-        return STR.\"\\{indentString(indent)}MemoryLayout.paddingLayout(\\{size})\";\n+        return String.format(\"%sMemoryLayout.paddingLayout(%d)\", indentString(indent), size);\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/ClassSourceBuilder.java","additions":27,"deletions":29,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -75,2 +75,2 @@\n-            public interface \\{fiName} {\n-                \\{methodType.returnType().getSimpleName()} apply(\\{paramExprs()});\n+            public interface %s {\n+                %s apply(%s);\n@@ -78,1 +78,2 @@\n-            \"\"\");\n+            \"\"\",\n+            fiName, methodType.returnType().getSimpleName(), paramExprs()));\n@@ -83,1 +84,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -85,1 +86,1 @@\n-            private static final MethodHandle UP$MH = \\{runtimeHelperName()}.upcallHandle(\\{className()}.\\{fiName}.class, \"apply\", $DESC);\n+            private static final MethodHandle UP$MH = %s.upcallHandle(%s.%s.class, \"apply\", $DESC);\n@@ -91,1 +92,1 @@\n-            public static MemorySegment allocate(\\{className()}.\\{fiName} fi, Arena arena) {\n+            public static MemorySegment allocate(%s.%s fi, Arena arena) {\n@@ -94,1 +95,2 @@\n-            \"\"\");\n+            \"\"\",\n+            runtimeHelperName(), className(), fiName, className(), fiName));\n@@ -101,4 +103,3 @@\n-        String paramStr = methodType.parameterCount() != 0 ? STR.\",\\{paramExprs()}\" : \"\";\n-        appendIndentedLines(STR.\"\"\"\n-\n-            private static final MethodHandle DOWN$MH = Linker.nativeLinker().downcallHandle($DESC);\n+        String paramStr = methodType.parameterCount() != 0 ? String.format(\",%s\", paramExprs()) : \"\";\n+        appendIndentedLines(String.format(\"\"\"\n+        private static final MethodHandle DOWN$MH = Linker.nativeLinker().downcallHandle($DESC);\n@@ -109,1 +110,1 @@\n-            public static \\{methodType.returnType().getSimpleName()} invoke(MemorySegment funcPtr\\{allocParam}\\{paramStr}) {\n+            public static %s invoke(MemorySegment funcPtr%s%s) {\n@@ -111,1 +112,1 @@\n-                    \\{retExpr()} DOWN$MH.invokeExact(funcPtr\\{allocArg}\\{otherArgExprs()});\n+                    %s DOWN$MH.invokeExact(funcPtr%s%s);\n@@ -116,1 +117,7 @@\n-            \"\"\");\n+            \"\"\",\n+            methodType.returnType().getSimpleName(),\n+            allocParam,\n+            paramStr,\n+            retExpr(),\n+            allocArg,\n+            otherArgExprs()));\n@@ -143,1 +150,1 @@\n-            retExpr = STR.\"return (\\{methodType.returnType().getSimpleName()})\";\n+            retExpr = String.format(\"return (%s)\", methodType.returnType().getSimpleName());\n@@ -159,1 +166,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -161,1 +168,1 @@\n-            private static final FunctionDescriptor $DESC = \\{functionDescriptorString(0, funcType)};\n+            private static final FunctionDescriptor $DESC = %s;\n@@ -169,1 +176,2 @@\n-            \"\"\");\n+            \"\"\",\n+            functionDescriptorString(0, funcType)));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/FunctionalInterfaceBuilder.java","additions":27,"deletions":19,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -169,2 +169,2 @@\n-        String returnNoCast = isVoid ? \"\" : STR.\"return \";\n-        String returnWithCast = isVoid ? \"\" : STR.\"\\{returnNoCast}(\\{retType})\";\n+        String returnNoCast = isVoid ? \"\" : \"return \";\n+        String returnWithCast = isVoid ? \"\" : String.format(\"%s(%s)\", returnNoCast, retType);\n@@ -173,2 +173,2 @@\n-                STR.\"\\\"\\{nativeName}\\\"\" :\n-                STR.\"\\\"\\{nativeName}\\\", \\{paramList}\";\n+                String.format(\"\\\"%s\\\"\", nativeName) :\n+                String.format(\"\\\"%s\\\", %s\", nativeName, paramList);\n@@ -178,1 +178,1 @@\n-            appendLines(STR.\"\"\"\n+            appendLines(String.format(\"\"\"\n@@ -180,2 +180,2 @@\n-                private static class \\{holderClass} {\n-                    public static final FunctionDescriptor DESC = \\{functionDescriptorString(1, decl.type())};\n+                private static class %s {\n+                    public static final FunctionDescriptor DESC = %s;\n@@ -183,1 +183,1 @@\n-                    public static final MemorySegment ADDR = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(decl)}\");\n+                    public static final MemorySegment ADDR = %s.findOrThrow(\"%s\");\n@@ -187,1 +187,2 @@\n-                \"\"\");\n+                \"\"\",\n+                holderClass, functionDescriptorString(1, decl.type()), runtimeHelperName(), lookupName(decl)));\n@@ -190,3 +191,3 @@\n-            appendLines(STR.\"\"\"\n-                public static FunctionDescriptor \\{javaName}$descriptor() {\n-                    return \\{holderClass}.DESC;\n+            appendLines(String.format(\"\"\"\n+                public static FunctionDescriptor %s$descriptor() {\n+                    return %s.DESC;\n@@ -194,1 +195,1 @@\n-                \"\"\");\n+                \"\"\", javaName, holderClass));\n@@ -197,3 +198,3 @@\n-            appendLines(STR.\"\"\"\n-                public static MethodHandle \\{javaName}$handle() {\n-                    return \\{holderClass}.HANDLE;\n+            appendLines(String.format(\"\"\"\n+                public static MethodHandle %s$handle() {\n+                    return %s.HANDLE;\n@@ -201,1 +202,2 @@\n-                \"\"\");\n+                \"\"\",\n+                javaName, holderClass));\n@@ -204,3 +206,3 @@\n-            appendLines(STR.\"\"\"\n-                public static MemorySegment \\{javaName}$address() {\n-                    return \\{holderClass}.ADDR;\n+            appendLines(String.format(\"\"\"\n+                public static MemorySegment %s$address() {\n+                    return %s.ADDR;\n@@ -208,1 +210,2 @@\n-                \"\"\");\n+                \"\"\",\n+                javaName, holderClass));\n@@ -211,3 +214,3 @@\n-            appendLines(STR.\"\"\"\n-            public static \\{retType} \\{javaName}(\\{paramExprs(declType, finalParamNames, isVarArg)}) {\n-                var mh$ = \\{holderClass}.HANDLE;\n+            appendLines(String.format(\"\"\"\n+            public static %s %s(%s) {\n+                var mh$ = %s.HANDLE;\n@@ -216,1 +219,1 @@\n-                        traceDowncall(\\{traceArgList});\n+                        traceDowncall(%s);\n@@ -218,1 +221,1 @@\n-                    \\{returnWithCast}mh$.invokeExact(\\{paramList});\n+                    %s mh$.invokeExact(%s);\n@@ -223,1 +226,3 @@\n-            \"\"\");\n+            \"\"\",\n+            retType, javaName, paramExprs(declType, finalParamNames, isVarArg),\n+            holderClass, traceArgList, returnWithCast, paramList));\n@@ -229,4 +234,4 @@\n-            appendLines(STR.\"\"\"\n-                public static class \\{invokerClassName} {\n-                    private static final FunctionDescriptor BASE_DESC = \\{functionDescriptorString(2, decl.type())};\n-                    private static final MemorySegment ADDR = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(decl)}\");\n+            appendLines(String.format(\"\"\"\n+                public static class %s {\n+                    private static final FunctionDescriptor BASE_DESC = %s;\n+                    private static final MemorySegment ADDR = %s.findOrThrow(\"%s\");\n@@ -238,1 +243,1 @@\n-                    private \\{invokerClassName}(MethodHandle handle, FunctionDescriptor descriptor, MethodHandle spreader) {\n+                    private %s(MethodHandle handle, FunctionDescriptor descriptor, MethodHandle spreader) {\n@@ -243,1 +248,2 @@\n-                \"\"\");\n+                \"\"\",\n+                invokerClassName, functionDescriptorString(2, decl.type()), runtimeHelperName(), lookupName(decl), invokerClassName));\n@@ -247,2 +253,2 @@\n-            appendLines(STR.\"\"\"\n-                public static \\{invokerClassName} makeInvoker(MemoryLayout... layouts) {\n+            appendLines(String.format(\"\"\"\n+                public static %s makeInvoker(MemoryLayout... layouts) {\n@@ -253,1 +259,1 @@\n-                    return new \\{invokerClassName}(mh$, desc$, spreader$);\n+                    return new %s(mh$, desc$, spreader$);\n@@ -255,1 +261,2 @@\n-                \"\"\");\n+                \"\"\",\n+                invokerClassName, invokerClassName));\n@@ -257,1 +264,1 @@\n-            appendLines(STR.\"\"\"\n+            appendLines(String.format(\"\"\"\n@@ -280,1 +287,1 @@\n-                    public \\{retType} apply(\\{paramExprs}) {\n+                    public %s apply(%s) {\n@@ -283,1 +290,1 @@\n-                                traceDowncall(\\{traceArgList});\n+                                traceDowncall(%s);\n@@ -285,1 +292,1 @@\n-                            \\{returnWithCast}spreader.invokeExact(\\{paramList});\n+                            %s spreader.invokeExact(%s);\n@@ -293,1 +300,2 @@\n-                \"\"\");\n+                \"\"\",\n+                retType, paramExprs, traceArgList, returnWithCast, paramList));\n@@ -311,1 +319,1 @@\n-            appendIndentedLines(\"\"\"\n+            appendIndentedLines(String.format(\"\"\"\n@@ -313,2 +321,2 @@\n-                static {\n-                \"\"\");\n+            static {\n+            \"\"\"));\n@@ -318,1 +326,1 @@\n-                appendIndentedLines(STR.\"System.\\{method}(\\\"\\{lib.toQuotedName()}\\\");\");\n+                appendIndentedLines(String.format(\"System.%s(\\\"%s\\\");\", method, lib.toQuotedName()));\n@@ -322,2 +330,2 @@\n-                }\n-                \"\"\");\n+            }\n+            \"\"\");\n@@ -328,2 +336,2 @@\n-                            STR.\"SymbolLookup.libraryLookup(\\\"\\{l.toQuotedName()}\\\", LIBRARY_ARENA)\" :\n-                            STR.\"SymbolLookup.libraryLookup(System.mapLibraryName(\\\"\\{l.toQuotedName()}\\\"), LIBRARY_ARENA)\")\n+                            String.format(\"SymbolLookup.libraryLookup(\\\"%s\\\", LIBRARY_ARENA)\", l.toQuotedName()) :\n+                            String.format(\"SymbolLookup.libraryLookup(System.mapLibraryName(\\\"%s\\\"), LIBRARY_ARENA)\", l.toQuotedName()))\n@@ -340,1 +348,1 @@\n-            lookupCalls.add(isFirst ? lookup : STR.\".or(\\{lookup})\");\n+            lookupCalls.add(isFirst ? lookup : String.format(\".or(%s)\", lookup));\n@@ -347,1 +355,1 @@\n-                .collect(Collectors.joining(STR.\"\\n\\{indentString(2)}\", \"static final SymbolLookup SYMBOL_LOOKUP = \", \";\")));\n+                .collect(Collectors.joining(String.format(\"\\n%s\", indentString(2)), \"static final SymbolLookup SYMBOL_LOOKUP = \", \";\")));\n@@ -398,3 +406,3 @@\n-        appendLines(STR.\"\"\"\n-            public static \\{type.getSimpleName()} \\{javaName}() {\n-                return \\{holderClass}.SEGMENT.get(\\{holderClass}.LAYOUT, 0L);\n+        appendLines(String.format(\"\"\"\n+            public static %s %s() {\n+                return %s.SEGMENT.get(%s.LAYOUT, 0L);\n@@ -402,1 +410,2 @@\n-            \"\"\");\n+            \"\"\", type.getSimpleName(), javaName, holderClass, holderClass));\n+\n@@ -412,3 +421,3 @@\n-        appendLines(STR.\"\"\"\n-            public static void \\{javaName}(\\{type.getSimpleName()} varValue) {\n-                \\{holderClass}.SEGMENT.set(\\{holderClass}.LAYOUT, 0L, varValue);\n+        appendLines(String.format(\"\"\"\n+            public static void %s(%s varValue) {\n+                %s.SEGMENT.set(%s.LAYOUT, 0L, varValue);\n@@ -416,1 +425,2 @@\n-            \"\"\");\n+            \"\"\", javaName, type.getSimpleName(), holderClass, holderClass));\n+\n@@ -425,3 +435,3 @@\n-        appendLines(STR.\"\"\"\n-            public static MemorySegment \\{javaName}() {\n-                return \\{holderClass}.SEGMENT;\n+        appendLines(String.format(\"\"\"\n+            public static MemorySegment %s() {\n+                return %s.SEGMENT;\n@@ -429,1 +439,2 @@\n-            \"\"\");\n+            \"\"\", javaName, holderClass));\n+\n@@ -438,3 +449,3 @@\n-        appendLines(STR.\"\"\"\n-            public static void \\{javaName}(MemorySegment varValue) {\n-                MemorySegment.copy(varValue, 0L, \\{holderClass}.SEGMENT, 0L, \\{holderClass}.LAYOUT.byteSize());\n+        appendLines(String.format(\"\"\"\n+            public static void %s(MemorySegment varValue) {\n+                MemorySegment.copy(varValue, 0L, %s.SEGMENT, 0L, %s.LAYOUT.byteSize());\n@@ -442,1 +453,1 @@\n-            \"\"\");\n+            \"\"\", javaName, holderClass, holderClass));\n@@ -454,2 +465,2 @@\n-            appendLines(STR.\"\"\"\n-                public static MemorySegment \\{javaName}(\\{indexList.decl()}) {\n+            appendLines(String.format(\"\"\"\n+                public static MemorySegment %s(%s) {\n@@ -457,1 +468,1 @@\n-                        return (MemorySegment)\\{holderClass}.HANDLE.invokeExact(\\{holderClass}.SEGMENT, 0L, \\{indexList.use()});\n+                        return (MemorySegment)%s.HANDLE.invokeExact(%s.SEGMENT, 0L, %s);\n@@ -462,1 +473,1 @@\n-                \"\"\");\n+                \"\"\", javaName, indexList.decl(), holderClass, holderClass, indexList.use()));\n@@ -464,3 +475,3 @@\n-            appendLines(STR.\"\"\"\n-                public static \\{typeCls.getSimpleName()} \\{javaName}(\\{indexList.decl()}) {\n-                    return (\\{typeCls.getSimpleName()})\\{holderClass}.HANDLE.get(\\{holderClass}.SEGMENT, 0L, \\{indexList.use()});\n+            appendLines(String.format(\"\"\"\n+                public static %s %s(%s) {\n+                    return (%s)%s.HANDLE.get(%s.SEGMENT, 0L, %s);\n@@ -468,1 +479,1 @@\n-                \"\"\");\n+                \"\"\", typeCls.getSimpleName(), javaName, indexList.decl(), typeCls.getSimpleName(), holderClass, holderClass, indexList.use()));\n@@ -481,5 +492,5 @@\n-            appendLines(STR.\"\"\"\n-                public static void \\{javaName}(\\{indexList.decl()}, MemorySegment varValue) {\n-                    MemorySegment.copy(varValue, 0L, \\{javaName}(\\{indexList.use()}), 0L, \\{layoutString(elemType)}.byteSize());\n-                }\n-                \"\"\");\n+            appendLines(String.format(\"\"\"\n+        public static void %s(%s, MemorySegment varValue) {\n+            MemorySegment.copy(varValue, 0L, %s(%s), 0L, %s.byteSize());\n+        }\n+        \"\"\", javaName, indexList.decl(), javaName, indexList.use(), layoutString(elemType)));\n@@ -487,5 +498,5 @@\n-            appendLines(STR.\"\"\"\n-                public static void \\{javaName}(\\{indexList.decl()}, \\{typeCls.getSimpleName()} varValue) {\n-                    \\{holderClass}.HANDLE.set(\\{holderClass}.SEGMENT, 0L, \\{indexList.use()}, varValue);\n-                }\n-                \"\"\");\n+            appendLines(String.format(\"\"\"\n+        public static void %s(%s, %s varValue) {\n+            %s.HANDLE.set(%s.SEGMENT, 0L, %s, varValue);\n+        }\n+        \"\"\", javaName, indexList.decl(), typeCls.getSimpleName(), holderClass, holderClass, indexList.use()));\n@@ -498,1 +509,1 @@\n-        String mangledName = newHolderClassName(STR.\"\\{javaName}$constants\");\n+        String mangledName = newHolderClassName(String.format(\"%s$constants\", javaName));\n@@ -507,3 +518,3 @@\n-                    STR.\"public static final MethodHandle HANDLE = LAYOUT.sliceHandle(\\{path});\" :\n-                    STR.\"public static final VarHandle HANDLE = LAYOUT.varHandle(\\{path});\\n\";\n-            String dimsString = dimensions.stream().map(d -> d.toString())\n+                    \"public static final MethodHandle HANDLE = LAYOUT.sliceHandle(\" + path + \");\" :\n+                    \"public static final VarHandle HANDLE = LAYOUT.varHandle(\" + path + \");\\n\";\n+            String dimsString = dimensions.stream().map(Object::toString)\n@@ -511,8 +522,8 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static class \\{mangledName} {\n-                    public static final \\{layoutType} LAYOUT = \\{layoutString(varType)};\n-                    public static final MemorySegment SEGMENT = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(var)}\").reinterpret(LAYOUT.byteSize());\n-                    \\{accessHandle}\n-                    public static final long[] DIMS = { \\{dimsString} };\n-                }\n-                \"\"\");\n+            appendIndentedLines(String.format(\"\"\"\n+            private static class %s {\n+                public static final %s LAYOUT = %s;\n+                public static final MemorySegment SEGMENT = %s.findOrThrow(\"%s\").reinterpret(LAYOUT.byteSize());\n+                %s\n+                public static final long[] DIMS = { %s };\n+            }\n+            \"\"\", mangledName, layoutType, layoutString(varType), runtimeHelperName(), lookupName(var), accessHandle, dimsString));\n@@ -520,6 +531,6 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static class \\{mangledName} {\n-                    public static final \\{layoutType} LAYOUT = \\{layoutString(varType)};\n-                    public static final MemorySegment SEGMENT = \\{runtimeHelperName()}.findOrThrow(\"\\{lookupName(var)}\").reinterpret(LAYOUT.byteSize());\n-                }\n-                \"\"\");\n+            appendIndentedLines(String.format(\"\"\"\n+            private static class %s {\n+                public static final %s LAYOUT = %s;\n+                public static final MemorySegment SEGMENT = %s.findOrThrow(\"%s\").reinterpret(LAYOUT.byteSize());\n+            }\n+            \"\"\", mangledName, layoutType, layoutString(varType), runtimeHelperName(), lookupName(var)));\n@@ -530,5 +541,5 @@\n-        appendLines(STR.\"\"\"\n-                public static \\{layoutType} \\{javaName}$layout() {\n-                    return \\{mangledName}.LAYOUT;\n-                }\n-                \"\"\");\n+        appendLines(String.format(\"\"\"\n+        public static %s %s$layout() {\n+            return %s.LAYOUT;\n+        }\n+        \"\"\", layoutType, javaName, mangledName));\n@@ -538,5 +549,5 @@\n-            appendLines(STR.\"\"\"\n-                    public static MemorySegment \\{javaName}$segment() {\n-                        return \\{mangledName}.SEGMENT;\n-                    }\n-                    \"\"\");\n+            appendLines(String.format(\"\"\"\n+            public static MemorySegment %s$segment() {\n+                return %s.SEGMENT;\n+            }\n+            \"\"\", javaName, mangledName));\n@@ -547,5 +558,5 @@\n-            appendLines(STR.\"\"\"\n-                public static long[] \\{javaName}$dimensions() {\n-                    return \\{mangledName}.DIMS;\n-                }\n-                \"\"\");\n+            appendLines(String.format(\"\"\"\n+            public static long[] %s$dimensions() {\n+                return %s.DIMS;\n+            }\n+            \"\"\", javaName, mangledName));\n@@ -561,9 +572,16 @@\n-            appendLines(STR.\"\"\"\n-                public static \\{javaType.getSimpleName()} \\{constantName}() {\n-                    class Holder {\n-                        static final \\{javaType.getSimpleName()} \\{constantName}\n-                            = \\{runtimeHelperName()}.LIBRARY_ARENA.allocateFrom(\"\\{Utils.quote(Objects.toString(value))}\");\n-                    }\n-                    return Holder.\\{constantName};\n-                }\n-                \"\"\");\n+            appendLines(String.format(\"\"\"\n+        public static %s %s() {\n+            class Holder {\n+                static final %s %s\n+                    = %s.LIBRARY_ARENA.allocateFrom(\"%s\");\n+            }\n+            return Holder.%s;\n+        }\n+        \"\"\",\n+                    javaType.getSimpleName(),\n+                    constantName,\n+                    javaType.getSimpleName(),\n+                    constantName,\n+                    runtimeHelperName(),\n+                    Utils.quote(Objects.toString(value)),\n+                    constantName));\n@@ -571,3 +589,6 @@\n-            appendLines(STR.\"\"\"\n-                private static final \\{javaType.getSimpleName()} \\{constantName} = \\{constantValue(javaType, value)};\n-                \"\"\");\n+            appendLines(String.format(\"\"\"\n+        private static final %s %s = %s;\n+        \"\"\",\n+                    javaType.getSimpleName(),\n+                    constantName,\n+                    constantValue(javaType, value)));\n@@ -575,5 +596,8 @@\n-            appendLines(STR.\"\"\"\n-                public static \\{javaType.getSimpleName()} \\{constantName}() {\n-                    return \\{constantName};\n-                }\n-                \"\"\");\n+            appendLines(String.format(\"\"\"\n+        public static %s %s() {\n+            return %s;\n+        }\n+        \"\"\",\n+                    javaType.getSimpleName(),\n+                    constantName,\n+                    constantName));\n@@ -586,1 +610,1 @@\n-            return STR.\"MemorySegment.ofAddress(\\{((Number)value).longValue()}L)\";\n+            return String.format(\"MemorySegment.ofAddress(%dL)\", ((Number)value).longValue());\n@@ -619,1 +643,1 @@\n-                throw new IllegalArgumentException(STR.\"Unhandled type: \\{type}, or value: \\{value}\");\n+                throw new IllegalArgumentException(String.format(\"Unhandled type: %s, or value: %s\", type, value));\n@@ -628,3 +652,4 @@\n-        appendLines(STR.\"\"\"\n-        public static final \\{Utils.layoutCarrierFor(type).getSimpleName()} \\{javaName} = \\{layoutString(type)};\n-        \"\"\");\n+        appendLines(String.format(\"\"\"\n+        public static final %s %s = %s;\n+        \"\"\",\n+         Utils.layoutCarrierFor(type).getSimpleName(), javaName, layoutString(type)));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/HeaderFileBuilder.java","additions":166,"deletions":141,"binary":false,"changes":307,"status":"modified"},{"patch":"@@ -54,1 +54,1 @@\n-        errWriter.println(STR.\"ERROR: \\{format(key, args)}\");\n+        errWriter.println(String.format(\"ERROR: %s\", format(key, args)));\n@@ -59,1 +59,1 @@\n-        errWriter.println(STR.\"WARNING: \\{format(key, args)}\");\n+        errWriter.println(String.format(\"WARNING: %s\", format(key, args)));\n@@ -73,1 +73,1 @@\n-        errWriter.println(STR.\"FATAL: \\{format(msg, args)}\");\n+        errWriter.println(String.format(\"FATAL: %s\", format(msg, args)));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/Logger.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- *  Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ *  Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -177,2 +177,2 @@\n-                    STR.\"<error: \\{((TypeImpl.ErronrousTypeImpl)t).erroneousName}>\" :\n-                    STR.\"<unknown: \\{t.getClass().getName()}>\";\n+                    String.format(\"<error: %s>\", ((TypeImpl.ErronrousTypeImpl) t).erroneousName) :\n+                    String.format(\"<unknown: %s>\", t.getClass().getName());\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/PrettyPrinter.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -61,2 +61,2 @@\n-        appendLines(STR.\"\"\"\n-            \/\/ Generated by jextract\\{SHOW_GENERATING_CLASS ? STR.\" (via \\{getClass().getName()})\" : \"\"}\n+        appendLines(String.format(\"\"\"\n+            \/\/ Generated by jextract%s\n@@ -64,1 +64,2 @@\n-            \"\"\");\n+            \"\"\",\n+            SHOW_GENERATING_CLASS ? String.format(\" (via %s)\", getClass().getName()) : \"\"));\n@@ -66,2 +67,2 @@\n-            appendLines(STR.\"\"\"\n-                package \\{packageName};\n+            appendLines(String.format(\"\"\"\n+                package %s;\n@@ -69,1 +70,2 @@\n-                \"\"\");\n+                \"\"\",\n+                packageName));\n@@ -99,1 +101,1 @@\n-        return new JavaSourceFile(STR.\"\\{className}\\{suffix}\", packageName, finisher.apply(sb.toString()));\n+        return new JavaSourceFile(String.format(\"%s%s\",className,suffix),packageName,finisher.apply(sb.toString()));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/SourceFileBuilder.java","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-        return isEnclosedBySameName(paramName)? paramName + \"$\" : paramName;\n+        return isEnclosedBySameName(paramName) ? paramName + \"$\" : paramName;\n@@ -155,1 +155,1 @@\n-            throw new IllegalArgumentException(STR.\"Type not supported: \\{varTree.type()}\");\n+            throw new IllegalArgumentException(String.format(\"Type not supported: %s\", varTree.type()));\n@@ -191,3 +191,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static \\{type.getSimpleName()} \\{javaName}(MemorySegment \\{segmentParam}) {\n-                return \\{segmentParam}.get(\\{layoutField}, \\{offsetField});\n+        appendIndentedLines(String.format(\"\"\"\n+            public static %s %s(MemorySegment %s) {\n+                return %s.get(%s, %s);\n@@ -195,1 +195,2 @@\n-            \"\"\");\n+            \"\"\",\n+            type.getSimpleName(), javaName, segmentParam, segmentParam, layoutField, offsetField));\n@@ -204,3 +205,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static void \\{javaName}(MemorySegment \\{segmentParam}, \\{type.getSimpleName()} \\{valueParam}) {\n-                \\{segmentParam}.set(\\{layoutField}, \\{offsetField}, \\{valueParam});\n+        appendIndentedLines(String.format(\"\"\"\n+            public static void %s(MemorySegment %s, %s %s) {\n+                %s.set(%s, %s, %s);\n@@ -208,1 +209,3 @@\n-            \"\"\");\n+            \"\"\",\n+            javaName, segmentParam, type.getSimpleName(), valueParam,\n+            segmentParam, layoutField, offsetField, valueParam));\n@@ -215,3 +218,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static MemorySegment \\{javaName}(MemorySegment \\{segmentParam}) {\n-                return \\{segmentParam}.asSlice(\\{offsetField}, \\{layoutField}.byteSize());\n+        appendIndentedLines(String.format(\"\"\"\n+            public static MemorySegment %s(MemorySegment %s) {\n+                return %s.asSlice(%s, %s.byteSize());\n@@ -219,1 +222,2 @@\n-            \"\"\");\n+            \"\"\",\n+            javaName, segmentParam, segmentParam, offsetField, layoutField));\n@@ -227,3 +231,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static void \\{javaName}(MemorySegment \\{segmentParam}, MemorySegment \\{valueParam}) {\n-                MemorySegment.copy(\\{valueParam}, 0L, \\{segmentParam}, \\{offsetField}, \\{layoutField}.byteSize());\n+        appendIndentedLines(String.format(\"\"\"\n+            public static void %s(MemorySegment %s, MemorySegment %s) {\n+                MemorySegment.copy(%s, 0L, %s, %s, %s.byteSize());\n@@ -231,1 +235,2 @@\n-            \"\"\");\n+            \"\"\",\n+            javaName, segmentParam, valueParam, valueParam, segmentParam, offsetField, layoutField));\n@@ -235,1 +240,1 @@\n-        String arrayHandleName = STR.\"\\{javaName}$ELEM_HANDLE\";\n+        String arrayHandleName = String.format(\"%s$ELEM_HANDLE\", javaName);\n@@ -241,3 +246,4 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static final MethodHandle \\{arrayHandleName} = \\{fieldLayoutName}.sliceHandle(\\{path});\n-                \"\"\");\n+            appendIndentedLines(String.format(\"\"\"\n+                private static final MethodHandle %s = %s.sliceHandle(%s);\n+                \"\"\",\n+                arrayHandleName, fieldLayoutName, path));\n@@ -245,3 +251,4 @@\n-            appendIndentedLines(STR.\"\"\"\n-                private static final VarHandle \\{arrayHandleName} = \\{fieldLayoutName}.varHandle(\\{path});\n-                \"\"\");\n+            appendIndentedLines(String.format(\"\"\"\n+                private static final VarHandle %s = %s.varHandle(%s);\n+                \"\"\",\n+                arrayHandleName, fieldLayoutName, path));\n@@ -259,2 +266,2 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static MemorySegment \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}) {\n+            appendIndentedLines(String.format(\"\"\"\n+                public static MemorySegment %s(MemorySegment %s, %s) {\n@@ -262,1 +269,1 @@\n-                        return (MemorySegment)\\{arrayElementHandle}.invokeExact(\\{segmentParam}, 0L, \\{indexList.use()});\n+                        return (MemorySegment)%s.invokeExact(%s, 0L, %s);\n@@ -267,1 +274,2 @@\n-                \"\"\");\n+                \"\"\",\n+                javaName, segmentParam, indexList.decl(), arrayElementHandle, segmentParam, indexList.use()));\n@@ -269,3 +277,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static \\{elemTypeCls.getSimpleName()} \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}) {\n-                    return (\\{elemTypeCls.getSimpleName()})\\{arrayElementHandle}.get(\\{segmentParam}, 0L, \\{indexList.use()});\n+            appendIndentedLines(String.format(\"\"\"\n+                public static %s %s(MemorySegment %s, %s) {\n+                    return (%s)%s.get(%s, 0L, %s);\n@@ -273,1 +281,3 @@\n-                \"\"\");\n+                \"\"\",\n+                elemTypeCls.getSimpleName(), javaName, segmentParam, indexList.decl(),\n+                elemTypeCls.getSimpleName(), arrayElementHandle, segmentParam, indexList.use()));\n@@ -285,3 +295,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static void \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}, MemorySegment \\{valueParam}) {\n-                    MemorySegment.copy(\\{valueParam}, 0L, \\{javaName}(\\{segmentParam}, \\{indexList.use()}), 0L, \\{layoutString(elemType)}.byteSize());\n+            appendIndentedLines(String.format(\"\"\"\n+                public static void %s(MemorySegment %s, %s, MemorySegment %s) {\n+                    MemorySegment.copy(%s, 0L, %s(%s, %s), 0L, %s.byteSize());\n@@ -289,1 +299,3 @@\n-                \"\"\");\n+                \"\"\",\n+                javaName, segmentParam, indexList.decl(), valueParam, valueParam,\n+                javaName, segmentParam, indexList.use(), layoutString(elemType)));\n@@ -291,3 +303,3 @@\n-            appendIndentedLines(STR.\"\"\"\n-                public static void \\{javaName}(MemorySegment \\{segmentParam}, \\{indexList.decl()}, \\{elemTypeCls.getSimpleName()} \\{valueParam}) {\n-                    \\{arrayElementHandle}.set(\\{segmentParam}, 0L, \\{indexList.use()}, \\{valueParam});\n+            appendIndentedLines(String.format(\"\"\"\n+                public static void %s(MemorySegment %s, %s, %s %s) {\n+                    %s.set(%s, 0L, %s, %s);\n@@ -295,1 +307,3 @@\n-                \"\"\");\n+                \"\"\",\n+                javaName, segmentParam, indexList.decl(), elemTypeCls.getSimpleName(),\n+                valueParam, arrayElementHandle, segmentParam, indexList.use(), valueParam));\n@@ -301,1 +315,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -304,2 +318,2 @@\n-             * Obtains a slice of {@code arrayParam} which selects the array element at {@code index}.\n-             * The returned segment has address {@code arrayParam.address() + index * layout().byteSize()}\n+             * Obtains a slice of %s which selects the array element at %s.\n+             * The returned segment has address %s.address() + index * layout().byteSize()\n@@ -307,2 +321,2 @@\n-            public static MemorySegment asSlice(MemorySegment \\{arrayParam}, long index) {\n-                return \\{arrayParam}.asSlice(layout().byteSize() * index);\n+            public static MemorySegment asSlice(MemorySegment %s, long index) {\n+                return %s.asSlice(layout().byteSize() * index);\n@@ -310,1 +324,2 @@\n-            \"\"\");\n+            \"\"\",\n+            arrayParam, arrayParam, arrayParam, arrayParam, arrayParam));\n@@ -314,2 +329,1 @@\n-        appendIndentedLines(STR.\"\"\"\n-\n+        appendIndentedLines(String.format(\"\"\"\n@@ -317,1 +331,1 @@\n-             * The size (in bytes) of this \\{kindName()}\n+             * The size (in bytes) of this %s\n@@ -320,1 +334,2 @@\n-            \"\"\");\n+            \"\"\",\n+            kindName()));\n@@ -325,1 +340,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -328,1 +343,1 @@\n-             * Allocate a segment of size {@code layout().byteSize()} using {@code \\{allocatorParam}}\n+             * Allocate a segment of size {@code layout().byteSize()} using %s\n@@ -330,2 +345,2 @@\n-            public static MemorySegment allocate(SegmentAllocator \\{allocatorParam}) {\n-                return \\{allocatorParam}.allocate(layout());\n+            public static MemorySegment allocate(SegmentAllocator %s) {\n+                return %s.allocate(layout());\n@@ -333,1 +348,2 @@\n-            \"\"\");\n+            \"\"\",\n+            allocatorParam, allocatorParam, allocatorParam));\n@@ -339,1 +355,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -342,2 +358,2 @@\n-             * Allocate an array of size {@code \\{elementCountParam}} using {@code \\{allocatorParam}}.\n-             * The returned segment has size {@code \\{elementCountParam} * layout().byteSize()}.\n+             * Allocate an array of size {@code %s} using %s.\n+             * The returned segment has size {@code %s * layout().byteSize()}.\n@@ -345,2 +361,2 @@\n-            public static MemorySegment allocateArray(long \\{elementCountParam}, SegmentAllocator \\{allocatorParam}) {\n-                return \\{allocatorParam}.allocate(MemoryLayout.sequenceLayout(\\{elementCountParam}, layout()));\n+            public static MemorySegment allocateArray(long %s, SegmentAllocator %s) {\n+                return %s.allocate(MemoryLayout.sequenceLayout(%s, layout()));\n@@ -348,1 +364,3 @@\n-            \"\"\");\n+            \"\"\",\n+            elementCountParam, allocatorParam, elementCountParam,\n+            elementCountParam, allocatorParam, allocatorParam, elementCountParam));\n@@ -373,1 +391,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -375,1 +393,1 @@\n-            private static final GroupLayout $LAYOUT = \\{structOrUnionLayoutString(structType)};\n+            private static final GroupLayout $LAYOUT = %s;\n@@ -378,1 +396,1 @@\n-             * The layout of this \\{kindName()}\n+             * The layout of this %s\n@@ -383,1 +401,2 @@\n-            \"\"\");\n+            \"\"\",\n+            structOrUnionLayoutString(structType), kindName()));\n@@ -387,4 +406,5 @@\n-        String offsetFieldName = STR.\"\\{javaName}$OFFSET\";\n-        appendIndentedLines(STR.\"\"\"\n-            private static final long \\{offsetFieldName} = \\{ClangOffsetOf.getOrThrow(field) \/ 8};\n-            \"\"\");\n+        String offsetFieldName = String.format(\"%s$OFFSET\", javaName);\n+        appendIndentedLines(String.format(\"\"\"\n+            private static final long %s = %d;\n+            \"\"\",\n+            offsetFieldName, ClangOffsetOf.getOrThrow(field) \/ 8));\n@@ -393,3 +413,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static final long \\{javaName}$offset() {\n-                return \\{offsetFieldName};\n+        appendIndentedLines(String.format(\"\"\"\n+            public static final long %s$offset() {\n+                return %s;\n@@ -397,1 +417,2 @@\n-            \"\"\");\n+            \"\"\",\n+            javaName, offsetFieldName));\n@@ -402,1 +423,1 @@\n-        String layoutFieldName = STR.\"\\{javaName}$LAYOUT\";\n+        String layoutFieldName = String.format(\"%s$LAYOUT\", javaName);\n@@ -404,3 +425,4 @@\n-        appendIndentedLines(STR.\"\"\"\n-            private static final \\{layoutType} \\{layoutFieldName} = (\\{layoutType})$LAYOUT.select(\\{fieldElementPaths(field.name())});\n-            \"\"\");\n+        appendIndentedLines(String.format(\"\"\"\n+            private static final %s %s = (%s)$LAYOUT.select(%s);\n+            \"\"\",\n+            layoutType, layoutFieldName, layoutType, fieldElementPaths(field.name())));\n@@ -409,3 +431,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static final \\{layoutType} \\{javaName}$layout() {\n-                return \\{layoutFieldName};\n+        appendIndentedLines(String.format(\"\"\"\n+            public static final %s %s$layout() {\n+                return %s;\n@@ -413,1 +435,2 @@\n-            \"\"\");\n+            \"\"\",\n+            layoutType, javaName, layoutFieldName));\n@@ -418,1 +441,1 @@\n-        String dimsFieldName = STR.\"\\{javaName}$DIMS\";\n+        String dimsFieldName = String.format(\"%s$DIMS\", javaName);\n@@ -420,1 +443,1 @@\n-        String dimsString = dimensions.stream().map(d -> d.toString())\n+        String dimsString = dimensions.stream().map(Object::toString)\n@@ -422,1 +445,1 @@\n-        appendIndentedLines(STR.\"\"\"\n+        appendIndentedLines(String.format(\"\"\"\n@@ -424,2 +447,3 @@\n-            private static long[] \\{dimsFieldName} = { \\{dimsString} };\n-            \"\"\");\n+            private static long[] %s = { %s };\n+            \"\"\",\n+            dimsFieldName, dimsString));\n@@ -428,3 +452,3 @@\n-        appendIndentedLines(STR.\"\"\"\n-            public static long[] \\{javaName}$dimensions() {\n-                return \\{dimsFieldName};\n+        appendIndentedLines(String.format(\"\"\"\n+            public static long[] %s$dimensions() {\n+                return %s;\n@@ -432,1 +456,2 @@\n-            \"\"\");\n+            \"\"\",\n+            javaName, dimsFieldName));\n@@ -474,1 +499,1 @@\n-                    memberLayout = STR.\"\\{indentString(indent + 1)}\\{memberLayout}.withName(\\\"\\{member.name()}\\\")\";\n+                    memberLayout = String.format(\"%s%s.withName(\\\"%s\\\")\", indentString(indent + 1), memberLayout, member.name());\n@@ -499,3 +524,3 @@\n-                STR.\"\\{indentString(indent)}MemoryLayout.structLayout(\\n\" :\n-                STR.\"\\{indentString(indent)}MemoryLayout.unionLayout(\\n\";\n-        String suffix = STR.\"\\n\\{indentString(indent)})\";\n+                String.format(\"%sMemoryLayout.structLayout(\\n\", indentString(indent)) :\n+                String.format(\"%sMemoryLayout.unionLayout(\\n\", indentString(indent));\n+        String suffix = String.format(\"\\n%s)\", indentString(indent));\n@@ -508,1 +533,1 @@\n-        return STR.\"\\{layoutString}.withName(\\\"\\{name}\\\")\";\n+        return String.format(\"%s.withName(\\\"%s\\\")\", layoutString, name);\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/StructBuilder.java","additions":121,"deletions":96,"binary":false,"changes":217,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,1 @@\n-        HeaderFileBuilder first = new HeaderFileBuilder(sfb, STR.\"\\{sfb.className()}#{SUFFIX}\", null, sfb.className());\n+        HeaderFileBuilder first = new HeaderFileBuilder(sfb, String.format(\"%s#{SUFFIX}\",sfb.className()), null, sfb.className());\n@@ -67,1 +67,1 @@\n-        first.appendIndentedLines(STR.\"\"\"\n+        first.appendIndentedLines(\"\"\"\n@@ -102,2 +102,2 @@\n-                        STR.\"_\\{suffix}\";\n-                String prevSuffix = STR.\"_\\{suffix + 1}\";\n+                        String.format(\"_%d\", suffix);\n+                String prevSuffix = String.format(\"_%d\", suffix + 1);\n@@ -106,1 +106,1 @@\n-                              .replace(\"#{PREV_SUFFIX}\", prevSuffix)));\n+                               .replace(\"#{PREV_SUFFIX}\", prevSuffix)));\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/ToplevelBuilder.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -235,1 +235,1 @@\n-            valueString = STR.\"\\\"\\{valueString}\\\"\";\n+            valueString = String.format(\"\\\"%s\\\"\", valueString);\n@@ -238,1 +238,1 @@\n-            valueString = STR.\"(void*) \\{valueString}\";\n+            valueString = String.format(\"(void*) %s\", valueString);\n@@ -240,1 +240,1 @@\n-        DeclarationString.with(macro, STR.\"#define \\{name} \\{valueString}\");\n+        DeclarationString.with(macro, String.format(\"#define %s %s\", name, valueString));\n@@ -533,1 +533,1 @@\n-        return STR.\"enum \\{enumName}.\\{enumConstant.name()} = \\{enumConstant.value()}\";\n+        return String.format(\"enum %s.%s = %s\", enumName, enumConstant.name(), enumConstant.value());\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/TreeMaker.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}