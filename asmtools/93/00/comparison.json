{"files":[{"patch":"@@ -188,2 +188,2 @@\n-                <matches pattern=\".*2[123456789]+.*\" string=\"${ant.java.version}\"\/>\n-                <matches pattern=\".*3\\d.*\" string=\"${ant.java.version}\"\/>\n+                <matches pattern=\".*1[789]+.*\" string=\"${ant.java.version}\"\/>\n+                <matches pattern=\".*[23]\\d.*\" string=\"${ant.java.version}\"\/>\n@@ -195,1 +195,1 @@\n-            The build should be started by Java 21 or above\n+            The build should be started by Java 17 or above\n","filename":"build\/build.xml","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-PRODUCT_VERSION     =9.0\n+PRODUCT_VERSION     =9.1\n@@ -30,1 +30,1 @@\n-PRODUCT_BUILDNUMBER =15\n+PRODUCT_BUILDNUMBER =01\n","filename":"build\/productinfo.properties","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-            throw new RuntimeException(\"Ended different class: %s then was started %s\".\n+            throw new RuntimeException(\"Ended with a different class: %s; then %s was started.\".\n","filename":"src\/org\/openjdk\/asmtools\/common\/outputs\/TextOutput.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+    private static final String ERROR_PREFIX = \" \/\/ The ConstantPoll Index \";\n@@ -151,1 +152,1 @@\n-            if(!ignoreException) {\n+            if (!ignoreException) {\n@@ -155,1 +156,1 @@\n-            if( printed ) {\n+            if (printed) {\n@@ -415,1 +416,1 @@\n-                name = StringUtils.Utf8ToString(getStringByIndex(idx));\n+                name = StringUtils.Utf8ToString(getNameByRefIndex(idx));\n@@ -1215,1 +1216,0 @@\n-        entityName = getStringByIndex(index);\n@@ -1218,1 +1218,1 @@\n-            environment.println(format(\"%-16s\", \"name_index\") + \" : \" + entityName);\n+            environment.println(format(\"%-16s\", \"name_index\"));\n@@ -1348,1 +1348,0 @@\n-                environment.getToolOutput().startClass(entityName, Optional.of(\".jcod\"), environment);\n@@ -1355,0 +1354,1 @@\n+                environment.getToolOutput().startClass(entityName, Optional.of(\".jcod\"), environment);\n@@ -1361,1 +1361,4 @@\n-                    out_begin(format(\"%s %s {\", entityType, entityName));\n+                    if (entityName.startsWith(ERROR_PREFIX))\n+                        out_begin(format(\"%s { %s\", entityType, entityName));\n+                    else\n+                        out_begin(format(\"%s %s {\", entityType, entityName));\n@@ -1461,3 +1464,3 @@\n-        Object str = cpool[idx];\n-        if (str instanceof String) {\n-            return (String) str;\n+        Object obj = cpool[idx];\n+        if (obj instanceof String str) {\n+            return str;\n@@ -1465,2 +1468,2 @@\n-            return \" \/\/ The ConstantPoll Index #%d refers to a ConstantPool Object: %s\".\n-                    formatted(idx, String.valueOf(str));\n+            return \"%s #%d refers to a ConstantPool Object: %s\".\n+                    formatted(ERROR_PREFIX, idx, String.valueOf(obj));\n@@ -1470,0 +1473,11 @@\n+    private String getNameByRefIndex(int idx) {\n+        Object obj = cpool[idx];\n+        if (obj instanceof Integer ref) {\n+            return getStringByIndex(ref);\n+        } else {\n+            return \"%s #%d refers to a ConstantPool Object: %s\".\n+                    formatted(ERROR_PREFIX, idx, String.valueOf(obj));\n+        }\n+\n+    }\n+\n","filename":"src\/org\/openjdk\/asmtools\/jdec\/ClassData.java","additions":26,"deletions":12,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-import org.junit.jupiter.api.Test;\n@@ -34,1 +33,0 @@\n-import org.openjdk.asmtools.lib.action.Jdec;\n@@ -41,2 +39,0 @@\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n@@ -52,1 +48,1 @@\n-public class JasmTests {\n+public class Tests {\n@@ -103,1 +99,1 @@\n-    public void testJCoderWarning(String resourceName) {\n+    public void testJdisWarning(String resourceName) {\n","filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7902696\/Tests.java","additions":2,"deletions":6,"binary":false,"changes":8,"previous_filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7902696\/JasmTests.java","status":"renamed"},{"patch":"@@ -44,1 +44,1 @@\n-public class JcodTests {\n+public class Tests {\n@@ -66,1 +66,1 @@\n-    public void testJCoderWarning() {\n+    public void testJdisWarning() {\n","filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7902820\/Tests.java","additions":2,"deletions":2,"binary":false,"changes":4,"previous_filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7902820\/JcodTests.java","status":"renamed"},{"patch":"@@ -49,1 +49,1 @@\n-public class TransformationTest {\n+public class Tests {\n","filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7903031\/Tests.java","additions":1,"deletions":1,"binary":false,"changes":2,"previous_filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7903031\/TransformationTest.java","status":"renamed"},{"patch":"@@ -39,1 +39,1 @@\n-public class NegativeJasmTests {\n+public class Tests {\n","filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7903405\/Tests.java","additions":1,"deletions":1,"binary":false,"changes":2,"previous_filename":"test\/java\/org\/openjdk\/asmtools\/jasm\/case7903405\/NegativeJasmTests.java","status":"renamed"},{"patch":"@@ -30,1 +30,1 @@\n-class JdecJcodTest {\n+class JdecJcodTests {\n","filename":"test\/java\/org\/openjdk\/asmtools\/jdec\/JdecJcodTests.java","additions":1,"deletions":1,"binary":false,"changes":2,"previous_filename":"test\/java\/org\/openjdk\/asmtools\/jdec\/JdecJcodTest.java","status":"renamed"},{"patch":"@@ -0,0 +1,108 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.asmtools.jdec.case7902055;\n+\n+import org.hamcrest.Matchers;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.openjdk.asmtools.lib.action.*;\n+import org.openjdk.asmtools.lib.log.LogAndBinResults;\n+import org.openjdk.asmtools.lib.log.LogAndTextResults;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.stream.Stream;\n+\n+import static java.lang.String.format;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.openjdk.asmtools.common.Environment.OK;\n+\n+\/**\n+ * This is the test for the issue: CODETOOLS-7902055 (https:\/\/bugs.openjdk.org\/browse\/CODETOOLS-7902055)\n+ * \"Preserve module name in jdec output\"\n+ * dec output doesn't preserve the name of the module at the start of the\n+ * declaration.\n+ *\n+ * Example:\n+ * -------------------------------\n+ * $ cat module-info.jcod\n+ * module foo.bar {\n+ * } \/\/ end module foo.bar\n+ *\n+ * $ java -jar asmtools.jar jcoder -d out module-info.jcod\n+ * $ java -jar asmtools.jar jdec out\/module-info.class > module-info.jcod.after\n+ * $ diff module-info.jcod module-info.jcod.after\n+ * 1c1\n+ * < module foo.bar {\n+ * ---\n+ * > module {\n+ * -------------------------------\n+ *\n+ * Note that the module name in the end comment (\"end module XXX\") is\n+ * preserved.\n+ *\n+ * The name given at the start of the module doesn't seem to have any effect on the .class output,\n+ * but it would be nice to preserve it for readability reasons.\n+ *\/\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n+public class Tests {\n+    private final Jcoder jcoder = new Jcoder();\n+\n+    private File resourceDir;\n+\n+    private static Stream<Arguments> getJCodParameters() {\n+        return Stream.of(\n+                Arguments.of(\"module-info.g.jcod\", \"\\\\s*module\\\\s+moduleB\\\\s*\\\\{\"),\n+                Arguments.of(\"module-info.jcod\", \"\\\\s*module\\\\s+moduleB\\\\s*\\\\{\"));\n+    }\n+\n+    @BeforeAll\n+    public void init() throws IOException {\n+        resourceDir = new File(Objects.requireNonNull(this.getClass().\n+                getResource(\"module-info.jcod\")).getFile()).getParentFile();\n+    }\n+\n+    \/\/ jcod -> .class -> jcod round trip should preserve the module name\n+    @ParameterizedTest\n+    @MethodSource(\"getJCodParameters\")\n+    public void testJCoderJdecRoundTrip(String resourceName, String jcodRegex) {\n+        \/\/ jcod to class\n+        final LogAndBinResults binResult = jcoder.compile(List.of(resourceDir + File.separator + resourceName));\n+        Assertions.assertEquals(OK, binResult.result);\n+        \/\/ class to jcod\n+        for ( EToolArguments arg : List.of(EToolArguments.JDEC, EToolArguments.JDEC_G)) {\n+            LogAndTextResults textResult = new Jdec().setArgs(arg).decode(binResult.getAsByteInput());\n+            Assertions.assertEquals(OK, textResult.result);\n+            \/\/ expected substrings\n+            String jcodOutput = textResult.output.toString();\n+            jcodOutput = jcodOutput.substring(0, jcodOutput.indexOf(\"{\")+1);\n+            assertThat(jcodOutput, Matchers.matchesRegex(jcodRegex));\n+        }\n+    }\n+}\n","filename":"test\/java\/org\/openjdk\/asmtools\/jdec\/case7902055\/Tests.java","additions":108,"deletions":0,"binary":false,"changes":108,"status":"added"},{"patch":"@@ -0,0 +1,78 @@\n+\/*\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * ORACLE PROPRIETARY\/CONFIDENTIAL. Use is subject to license terms.\n+ *\/\n+ \/* Jasm source of the test resource may look like this:\n+    module moduleB@1.2.3 version 62:0\n+    {\n+      requires mandated java.base@jck-22;\n+      exports  packB;\n+    }\n+ *\/\n+module moduleB {\n+  0xCAFEBABE;\n+  0;                                       \/\/ minor version\n+  62;                                      \/\/ version\n+  [15] {                                   \/\/ Constant Pool\n+    ;                                      \/\/ first element is empty\n+    Class #2;                              \/\/ #1     at 0x0A\n+    Utf8 \"module-info\";                    \/\/ #2     at 0x0D\n+    Utf8 \"SourceFile\";                     \/\/ #3     at 0x1B\n+    Utf8 \"module-info.jcod\";               \/\/ #4     at 0x28\n+    Utf8 \"Module\";                         \/\/ #5     at 0x3B\n+    Module #7;                             \/\/ #6     at 0x44\n+    Utf8 \"moduleB\";                        \/\/ #7     at 0x47\n+    Module #9;                             \/\/ #8     at 0x51\n+    Utf8 \"java.base\";                      \/\/ #9     at 0x54\n+    Utf8 \"jdk4jck_22\";                     \/\/ #10     at 0x60\n+    Package #12;                           \/\/ #11     at 0x6D\n+    Utf8 \"packB\";                          \/\/ #12     at 0x70\n+    Utf8 \"1.2.3\";                          \/\/ #13     at 0x78\n+    Utf8 \"ModulePackages\";                 \/\/ #14     at 0x80\n+  }                                        \/\/ end of Constant Pool\n+\n+  0x8000;                                  \/\/ access [ ACC_MODULE, 0xFFFF0000 ]\n+  #1;                                      \/\/ this_cpx\n+  #0;                                      \/\/ super_cpx\n+\n+  [0] {                                    \/\/ Interfaces\n+  }                                        \/\/ end of Interfaces\n+\n+  [0] {                                    \/\/ Fields\n+  }                                        \/\/ end of Fields\n+\n+  [0] {                                    \/\/ Methods\n+  }                                        \/\/ end of Methods\n+\n+  [2] {                                    \/\/ Attributes\n+    Attr(#3, 2) {                          \/\/ SourceFile at 0x9F\n+      #4;\n+    }                                      \/\/ end of SourceFile\n+    ;\n+    Attr(#5, 28) {                         \/\/ Module at 0xA7\n+      #6;                                  \/\/ name_index\n+      0x0000;                              \/\/ flags\n+\n+      #13;                                 \/\/ version\n+      [1] {                                \/\/ requires\n+        #8 0x8000 #10;                     \/\/ ACC_MANDATED\n+      }                                    \/\/ end of requires\n+\n+      [1] {                                \/\/ exports\n+        #11 0x0000                         \/\/ [  ]\n+        [0] {\n+        };\n+      }                                    \/\/ of exports\n+\n+      [0] {                                \/\/ opens\n+      }                                    \/\/ of opens\n+\n+      [0] {                                \/\/ uses\n+      }                                    \/\/ end of uses\n+\n+      [0] {                                \/\/ provides\n+      }                                    \/\/ end of provides\n+\n+    }                                      \/\/ end of Module\n+  }                                        \/\/ end of Attributes\n+}                                          \/\/ end of module moduleB\n","filename":"test\/resources\/org\/openjdk\/asmtools\/jdec\/case7902055\/module-info.g.jcod","additions":78,"deletions":0,"binary":false,"changes":78,"status":"added"},{"patch":"@@ -0,0 +1,78 @@\n+\/*\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * ORACLE PROPRIETARY\/CONFIDENTIAL. Use is subject to license terms.\n+ *\/\n+ \/* Jasm source of the test resource may look like this:\n+    module moduleB@1.2.3 version 62:0\n+    {\n+      requires mandated java.base@jck-22;\n+      exports  packB;\n+    }\n+ *\/\n+module {\n+  0xCAFEBABE;\n+  0;                                       \/\/ minor version\n+  62;                                      \/\/ version\n+  [] {                                     \/\/ Constant Pool\n+    ;                                      \/\/ first element is empty\n+    Class #2;                              \/\/ #1\n+    Utf8 \"module-info\";                    \/\/ #2\n+    Utf8 \"SourceFile\";                     \/\/ #3\n+    Utf8 \"module-info.jcod\";               \/\/ #4\n+    Utf8 \"Module\";                         \/\/ #5\n+    Module #7;                             \/\/ #6\n+    Utf8 \"moduleB\";                        \/\/ #7\n+    Module #9;                             \/\/ #8\n+    Utf8 \"java.base\";                      \/\/ #9\n+    Utf8 \"jdk4jck_22\";                     \/\/ #10\n+    Package #12;                           \/\/ #11\n+    Utf8 \"packB\";                          \/\/ #12\n+    Utf8 \"1.2.3\";                          \/\/ #13\n+    Utf8 \"ModulePackages\";                 \/\/ #14\n+  }\n+\n+  0x8000;                                  \/\/ access\n+  #1;                                      \/\/ this_cpx\n+  #0;                                      \/\/ super_cpx\n+\n+  [] {                                     \/\/ Interfaces\n+  }                                        \/\/ end of Interfaces\n+\n+  [] {                                     \/\/ Fields\n+  }                                        \/\/ end of Fields\n+\n+  [] {                                     \/\/ Methods\n+  }                                        \/\/ end of Methods\n+\n+  [] {                                     \/\/ Attributes\n+    Attr(#3) {                             \/\/ SourceFile\n+      #4;\n+    }                                      \/\/ end of SourceFile\n+    ;\n+    Attr(#5) {                             \/\/ Module\n+      #6;                                  \/\/ name_index\n+      0x0000;                              \/\/ flags\n+\n+      #13;                                 \/\/ version\n+      [] {                                 \/\/ requires\n+        #8 0x8000 #10;\n+      }                                    \/\/ end of requires\n+\n+      [] {                                 \/\/ exports\n+        #11 0x0000\n+        [] {\n+        };\n+      }                                    \/\/ of exports\n+\n+      [] {                                 \/\/ opens\n+      }                                    \/\/ of opens\n+\n+      [] {                                 \/\/ uses\n+      }                                    \/\/ end of uses\n+\n+      [] {                                 \/\/ provides\n+      }                                    \/\/ end of provides\n+\n+    }                                      \/\/ end of Module\n+  }                                        \/\/ end of Attributes\n+}\n","filename":"test\/resources\/org\/openjdk\/asmtools\/jdec\/case7902055\/module-info.jcod","additions":78,"deletions":0,"binary":false,"changes":78,"status":"added"}]}