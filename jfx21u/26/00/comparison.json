{"files":[{"patch":"@@ -33,0 +33,1 @@\n+import java.io.RandomAccessFile;\n@@ -34,0 +35,2 @@\n+import java.nio.channels.FileChannel;\n+import java.nio.channels.FileLock;\n@@ -44,1 +47,0 @@\n-import java.util.Locale;\n@@ -304,1 +306,16 @@\n-            Files.copy(is, path);\n+            File lockFile = new File(cacheDir, \".lock\");\n+            try (RandomAccessFile randomAccessFile = new RandomAccessFile(lockFile, \"rw\");\n+                 FileChannel fileChannel = randomAccessFile.getChannel();\n+                 FileLock fileLock = fileChannel.lock()) {\n+                try {\n+                    if (!Files.exists(path)) {\n+                        Files.copy(is, path);\n+                    }\n+                } finally {\n+                    if (fileLock != null) {\n+                        fileLock.release();\n+                    }\n+                }\n+            } catch (IOException ex) {\n+                throw new IOException(\"Error copying library \" + path + \" to cache: \" + ex.getMessage(), ex);\n+            }\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/utils\/NativeLibLoader.java","additions":19,"deletions":2,"binary":false,"changes":21,"status":"modified"}]}