{"files":[{"patch":"@@ -188,4 +188,1 @@\n-  SYMBOLS_EXCLUDE_PATTERN := %.debuginfo %.diz %.map\n-\n-  # There may be files with spaces in the names, so use ShellFindFiles\n-  # explicitly.\n+  # There may be files with spaces in the names, so use ShellFindFiles explicitly.\n@@ -193,5 +190,0 @@\n-  ifneq ($(JDK_IMAGE_DIR), $(JDK_SYMBOLS_IMAGE_DIR))\n-    ALL_JDK_SYMBOLS_FILES := $(call ShellFindFiles, $(JDK_SYMBOLS_IMAGE_DIR))\n-  else\n-    ALL_JDK_SYMBOLS_FILES := $(ALL_JDK_FILES)\n-  endif\n@@ -204,17 +196,0 @@\n-  # Create special filter rules when dealing with unzipped .dSYM directories on\n-  # macosx\n-  ifeq ($(call isTargetOs, macosx), true)\n-    ifeq ($(ZIP_EXTERNAL_DEBUG_SYMBOLS), false)\n-      JDK_SYMBOLS_EXCLUDE_PATTERN := $(addprefix %, \\\n-          $(call containing, .dSYM\/, $(patsubst $(JDK_IMAGE_DIR)\/%, %, \\\n-          $(ALL_JDK_SYMBOLS_FILES))))\n-    endif\n-  endif\n-\n-  # Create special filter rules when dealing with debug symbols on windows\n-  ifeq ($(call isTargetOs, windows), true)\n-    ifeq ($(SHIP_DEBUG_SYMBOLS), )\n-      JDK_SYMBOLS_EXCLUDE_PATTERN := %.pdb\n-    endif\n-  endif\n-\n@@ -223,1 +198,0 @@\n-          $(JDK_SYMBOLS_EXCLUDE_PATTERN) \\\n@@ -225,1 +199,0 @@\n-          $(SYMBOLS_EXCLUDE_PATTERN) \\\n@@ -231,2 +204,1 @@\n-  JDK_SYMBOLS_BUNDLE_FILES := \\\n-      $(call FindFiles, $(SYMBOLS_IMAGE_DIR))\n+  JDK_SYMBOLS_BUNDLE_FILES := $(call FindFiles, $(SYMBOLS_IMAGE_DIR))\n@@ -239,20 +211,1 @@\n-  # Create special filter rules when dealing with unzipped .dSYM directories on\n-  # macosx\n-  ifeq ($(OPENJDK_TARGET_OS), macosx)\n-    ifeq ($(ZIP_EXTERNAL_DEBUG_SYMBOLS), false)\n-      JRE_SYMBOLS_EXCLUDE_PATTERN := $(addprefix %, \\\n-          $(call containing, .dSYM\/, $(patsubst $(JRE_IMAGE_DIR)\/%, %, $(ALL_JRE_FILES))))\n-    endif\n-  endif\n-\n-  # Create special filter rules when dealing with debug symbols on windows\n-  ifeq ($(call isTargetOs, windows), true)\n-    ifeq ($(SHIP_DEBUG_SYMBOLS), )\n-      JRE_SYMBOLS_EXCLUDE_PATTERN := %.pdb\n-    endif\n-  endif\n-\n-  JRE_BUNDLE_FILES := $(filter-out \\\n-      $(JRE_SYMBOLS_EXCLUDE_PATTERN) \\\n-      $(SYMBOLS_EXCLUDE_PATTERN), \\\n-      $(ALL_JRE_FILES))\n+  JRE_BUNDLE_FILES := $(ALL_JRE_FILES)\n","filename":"make\/Bundles.gmk","additions":3,"deletions":50,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -221,1 +221,1 @@\n-    JMOD_FLAGS += --exclude '**{_the.*,_*.marker*,*.diz,*.map}'\n+    JMOD_FLAGS += --exclude '**{_the.*,_*.marker*,*.map}'\n@@ -224,1 +224,5 @@\n-  JMOD_FLAGS += --exclude '**{_the.*,_*.marker*,*.diz,*.debuginfo,*.dSYM\/**,*.dSYM}'\n+  ifeq ($(SHIP_DEBUG_SYMBOLS), )\n+    JMOD_FLAGS += --exclude '**{_the.*,_*.marker*,*.diz,*.debuginfo,*.dSYM\/**,*.dSYM}'\n+  else\n+    JMOD_FLAGS += --exclude '**{_the.*,_*.marker*}'\n+  endif\n","filename":"make\/CreateJmods.gmk","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -96,0 +96,1 @@\n+# -XDaccessInternalAPI is a temporary workaround, see 8373909\n@@ -99,1 +100,2 @@\n-    --override-methods=summary\n+    --override-methods=summary \\\n+    -XDaccessInternalAPI\n@@ -105,1 +107,2 @@\n-    -html5 -javafx --expand-requires transitive\n+    -html5 -javafx --expand-requires transitive \\\n+    -XDaccessInternalAPI\n","filename":"make\/Docs.gmk","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -319,2 +319,4 @@\n-      [which type of external native debug symbol information shall be shipped in product bundles (none, public, full)\n-      (e.g. ship full\/stripped pdbs on Windows) @<:@none@:>@])])\n+      [which type of external native debug symbol information shall be shipped with bundles\/images (none, public, full).\n+      @<:@none in release builds, full otherwise. --with-native-debug-symbols=external\/zipped is a prerequisite. public is only supported on Windows@:>@])],\n+      [],\n+      [with_external_symbols_in_bundles=default])\n@@ -325,5 +327,7 @@\n-    if test \"x$OPENJDK_TARGET_OS\" != xwindows ; then\n-      AC_MSG_ERROR([--with-external-symbols-in-bundles currently only works on windows!])\n-    elif test \"x$COPY_DEBUG_SYMBOLS\" != xtrue ; then\n-      AC_MSG_ERROR([--with-external-symbols-in-bundles only works when --with-native-debug-symbols=external is used!])\n-    elif test \"x$with_external_symbols_in_bundles\" = xfull ; then\n+    if test \"x$COPY_DEBUG_SYMBOLS\" != xtrue ; then\n+      AC_MSG_ERROR([--with-external-symbols-in-bundles only works when --with-native-debug-symbols=external\/zipped is used!])\n+    elif test \"x$with_external_symbols_in_bundles\" = xpublic && test \"x$OPENJDK_TARGET_OS\" != xwindows ; then\n+      AC_MSG_ERROR([--with-external-symbols-in-bundles=public is only supported on Windows!])\n+    fi\n+\n+    if test \"x$with_external_symbols_in_bundles\" = xfull ; then\n@@ -336,0 +340,9 @@\n+  elif test \"x$with_external_symbols_in_bundles\" = xdefault ; then\n+    if test \"x$DEBUG_LEVEL\" = xrelease ; then\n+      AC_MSG_RESULT([no (default)])\n+    elif test \"x$COPY_DEBUG_SYMBOLS\" = xtrue ; then\n+      AC_MSG_RESULT([full (default)])\n+      SHIP_DEBUG_SYMBOLS=full\n+    else\n+      AC_MSG_RESULT([no (default, native debug symbols are not external\/zipped)])\n+    fi\n","filename":"make\/autoconf\/jdk-options.m4","additions":20,"deletions":7,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import java.lang.reflect.Field;\n@@ -36,2 +37,0 @@\n-import javax.lang.model.element.PackageElement;\n-import javax.lang.model.element.TypeElement;\n@@ -163,0 +162,1 @@\n+                String rootParent = currentPath().replaceAll(\"[^\/]+\", \"..\");\n@@ -164,2 +164,2 @@\n-                String url = String.format(\"%1$s\/..\/specs\/%2$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n-                        docRoot(elem), idPrefix, chapter, section);\n+                String url = String.format(\"%1$s\/specs\/%2$s\/%2$s-%3$s.html#%2$s-%3$s%4$s\",\n+                        rootParent, idPrefix, chapter, section);\n@@ -186,0 +186,16 @@\n+    private static ThreadLocal<String> CURRENT_PATH = null;\n+\n+    private String currentPath() {\n+        if (CURRENT_PATH == null) {\n+            try {\n+                Field f = Class.forName(\"jdk.javadoc.internal.doclets.formats.html.HtmlDocletWriter\")\n+                               .getField(\"CURRENT_PATH\");\n+                @SuppressWarnings(\"unchecked\")\n+                ThreadLocal<String> tl = (ThreadLocal<String>) f.get(null);\n+                CURRENT_PATH = tl;\n+            } catch (ReflectiveOperationException e) {\n+                throw new RuntimeException(\"Cannot determine current path\", e);\n+            }\n+        }\n+        return CURRENT_PATH.get();\n+    }\n@@ -212,30 +228,0 @@\n-    private String docRoot(Element elem) {\n-        switch (elem.getKind()) {\n-            case MODULE:\n-                return \"..\";\n-\n-            case PACKAGE:\n-                PackageElement pe = (PackageElement)elem;\n-                String pkgPart = pe.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-                return pe.getEnclosingElement() != null\n-                        ? \"..\/\" + pkgPart\n-                        : pkgPart;\n-\n-            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n-                TypeElement te = (TypeElement)elem;\n-                return te.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-\n-            default:\n-                var enclosing = elem.getEnclosingElement();\n-                if (enclosing == null)\n-                    throw new IllegalArgumentException(elem.getKind().toString());\n-                return docRoot(enclosing);\n-        }\n-    }\n-\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/JSpec.java","additions":20,"deletions":34,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import java.lang.reflect.Field;\n@@ -36,2 +37,0 @@\n-import javax.lang.model.element.PackageElement;\n-import javax.lang.model.element.TypeElement;\n@@ -71,1 +70,1 @@\n-    static final String BASE_URL = \"..\/specs\/man\";\n+    static final String BASE_URL = \"specs\/man\";\n@@ -122,0 +121,1 @@\n+                String rootParent = currentPath().replaceAll(\"[^\/]+\", \"..\");\n@@ -124,1 +124,1 @@\n-                        docRoot(elem), BASE_URL, name);\n+                        rootParent, BASE_URL, name);\n@@ -145,27 +145,13 @@\n-    private String docRoot(Element elem) {\n-        switch (elem.getKind()) {\n-            case MODULE:\n-                return \"..\";\n-\n-            case PACKAGE:\n-                PackageElement pe = (PackageElement)elem;\n-                String pkgPart = pe.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-                return pe.getEnclosingElement() != null\n-                        ? \"..\/\" + pkgPart\n-                        : pkgPart;\n-\n-            case CLASS, ENUM, RECORD, INTERFACE, ANNOTATION_TYPE:\n-                TypeElement te = (TypeElement)elem;\n-                return te.getQualifiedName()\n-                        .toString()\n-                        .replace('.', '\/')\n-                        .replaceAll(\"[^\/]+\", \"..\");\n-\n-            default:\n-                var enclosing = elem.getEnclosingElement();\n-                if (enclosing == null)\n-                    throw new IllegalArgumentException(elem.getKind().toString());\n-                return docRoot(enclosing);\n+    private static ThreadLocal<String> CURRENT_PATH = null;\n+\n+    private String currentPath() {\n+        if (CURRENT_PATH == null) {\n+            try {\n+                Field f = Class.forName(\"jdk.javadoc.internal.doclets.formats.html.HtmlDocletWriter\")\n+                               .getField(\"CURRENT_PATH\");\n+                @SuppressWarnings(\"unchecked\")\n+                ThreadLocal<String> tl = (ThreadLocal<String>) f.get(null);\n+                CURRENT_PATH = tl;\n+            } catch (ReflectiveOperationException e) {\n+                throw new RuntimeException(\"Cannot determine current path\", e);\n+            }\n@@ -173,0 +159,1 @@\n+        return CURRENT_PATH.get();\n@@ -174,0 +161,1 @@\n+\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/ToolGuide.java","additions":19,"deletions":31,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -229,0 +229,1 @@\n+      LINK_TIME_OPTIMIZATION := true, \\\n","filename":"make\/modules\/java.desktop\/lib\/ClientLibraries.gmk","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -313,0 +313,10 @@\n+#ifdef R18_RESERVED\n+  \/*\n+  Do not modify r18_tls when restoring registers if it is a reserved register. On Windows,\n+  for example, r18_tls is used to store the pointer to the current thread's TEB (where TLS\n+  variables are stored). Therefore, modifying r18_tls would corrupt the TEB pointer.\n+  *\/\n+  __ pop(RegSet::range(r0, r17), sp);\n+  __ ldp(zr, r19, Address(__ post(sp, 2 * wordSize)));\n+  __ pop(RegSet::range(r20, r29), sp);\n+#else\n@@ -314,0 +324,1 @@\n+#endif\n@@ -326,0 +337,11 @@\n+#ifdef R18_RESERVED\n+  \/*\n+  Do not modify r18_tls when restoring registers if it is a reserved register. On Windows,\n+  for example, r18_tls is used to store the pointer to the current thread's TEB (where TLS\n+  variables are stored). Therefore, modifying r18_tls would corrupt the TEB pointer.\n+  *\/\n+  __ ldp(zr, r1, Address(__ post(sp, 2 * wordSize)));\n+  __ pop(RegSet::range(r2, r17), sp);\n+  __ ldp(zr, r19, Address(__ post(sp, 2 * wordSize)));\n+  __ pop(RegSet::range(r20, r29), sp);\n+#else\n@@ -328,0 +350,1 @@\n+#endif\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_Runtime1_aarch64.cpp","additions":23,"deletions":0,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2550,0 +2550,1 @@\n+\n@@ -2556,1 +2557,1 @@\n-  if (lo != min_jint && hi != max_jint) {\n+  if (lo != min_jint) {\n@@ -2559,0 +2560,2 @@\n+  }\n+  if (hi != max_jint) {\n@@ -2560,9 +2563,1 @@\n-    br(Assembler::LE, L_success);\n-  } else if (lo != min_jint) {\n-    subsw(rtmp, rval, lo);\n-    br(Assembler::GE, L_success);\n-  } else if (hi != max_jint) {\n-    subsw(rtmp, rval, hi);\n-    br(Assembler::LE, L_success);\n-  } else {\n-    ShouldNotReachHere();\n+    br(Assembler::GT, L_failure);\n@@ -2570,0 +2565,1 @@\n+  b(L_success);\n@@ -2593,0 +2589,1 @@\n+\n@@ -2599,1 +2596,1 @@\n-  if (lo != min_jlong && hi != max_jlong) {\n+  if (lo != min_jlong) {\n@@ -2602,0 +2599,2 @@\n+  }\n+  if (hi != max_jlong) {\n@@ -2603,9 +2602,1 @@\n-    br(Assembler::LE, L_success);\n-  } else if (lo != min_jlong) {\n-    subs(rtmp, rval, lo);\n-    br(Assembler::GE, L_success);\n-  } else if (hi != max_jlong) {\n-    subs(rtmp, rval, hi);\n-    br(Assembler::LE, L_success);\n-  } else {\n-    ShouldNotReachHere();\n+    br(Assembler::GT, L_failure);\n@@ -2613,0 +2604,1 @@\n+  b(L_success);\n","filename":"src\/hotspot\/cpu\/aarch64\/c2_MacroAssembler_aarch64.cpp","additions":12,"deletions":20,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2665,0 +2665,3 @@\n+  \/\/ Vector GHASH (Zvkg) Extension\n+  INSN(vghsh_vv,    0b1110111, 0b010, 0b1, 0b101100);\n+\n","filename":"src\/hotspot\/cpu\/riscv\/assembler_riscv.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -126,1 +126,2 @@\n-          \"Use PR_RISCV_CTX_SW_FENCEI_ON to avoid explicit icache flush\")\n+          \"Use PR_RISCV_CTX_SW_FENCEI_ON to avoid explicit icache flush\")        \\\n+  product(bool, UseZvkg, false, EXPERIMENTAL, \"Use Zvkg instructions\")\n","filename":"src\/hotspot\/cpu\/riscv\/globals_riscv.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -8545,1 +8545,1 @@\n-instruct convHF2F_reg_reg(fRegF dst, iRegINoSp src, iRegINoSp tmp) %{\n+instruct convHF2F_reg_reg(fRegF dst, iRegIorL2I src, iRegINoSp tmp) %{\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2658,2 +2658,1 @@\n-    assert(UseAESIntrinsics, \"Must be\");\n-    assert(UseZvkn, \"need AES instructions (Zvkned extension) support\");\n+    assert(UseAESIntrinsics, \"need AES instructions (Zvkned extension) support\");\n@@ -2748,2 +2747,1 @@\n-    assert(UseAESIntrinsics, \"Must be\");\n-    assert(UseZvkn, \"need AES instructions (Zvkned extension) support\");\n+    assert(UseAESIntrinsics, \"need AES instructions (Zvkned extension) support\");\n@@ -2953,3 +2951,1 @@\n-    assert(UseAESCTRIntrinsics, \"Must be\");\n-    assert(UseZvkn, \"need AES instructions (Zvkned extension) support\");\n-    assert(UseZbb, \"need basic bit manipulation (Zbb extension) support\");\n+    assert(UseAESCTRIntrinsics, \"need AES instructions (Zvkned extension) and Zbb extension support\");\n@@ -3004,0 +3000,57 @@\n+  \/**\n+   *  Arguments:\n+   *\n+   *  Input:\n+   *  c_rarg0   - current state address\n+   *  c_rarg1   - H key address\n+   *  c_rarg2   - data address\n+   *  c_rarg3   - number of blocks\n+   *\n+   *  Output:\n+   *  Updated state at c_rarg0\n+   *\/\n+  address generate_ghash_processBlocks() {\n+    assert(UseGHASHIntrinsics, \"need GHASH instructions (Zvkg extension) and Zvbb support\");\n+\n+    __ align(CodeEntryAlignment);\n+    StubId stub_id = StubId::stubgen_ghash_processBlocks_id;\n+    StubCodeMark mark(this, stub_id);\n+\n+    address start = __ pc();\n+    __ enter();\n+\n+    Register state   = c_rarg0;\n+    Register subkeyH = c_rarg1;\n+    Register data    = c_rarg2;\n+    Register blocks  = c_rarg3;\n+\n+    VectorRegister partial_hash = v1;\n+    VectorRegister hash_subkey  = v2;\n+    VectorRegister cipher_text  = v3;\n+\n+    const unsigned int BLOCK_SIZE = 16;\n+\n+    __ vsetivli(x0, 2, Assembler::e64, Assembler::m1);\n+    __ vle64_v(hash_subkey, subkeyH);\n+    __ vrev8_v(hash_subkey, hash_subkey);\n+    __ vle64_v(partial_hash, state);\n+    __ vrev8_v(partial_hash, partial_hash);\n+\n+    __ vsetivli(x0, 4, Assembler::e32, Assembler::m1);\n+    Label L_ghash_loop;\n+    __ bind(L_ghash_loop);\n+      __ vle32_v(cipher_text, data);\n+      __ addi(data, data, BLOCK_SIZE);\n+      __ vghsh_vv(partial_hash, hash_subkey, cipher_text);\n+      __ subi(blocks, blocks, 1);\n+      __ bnez(blocks, L_ghash_loop);\n+\n+    __ vsetivli(x0, 2, Assembler::e64, Assembler::m1);\n+    __ vrev8_v(partial_hash, partial_hash);\n+    __ vse64_v(partial_hash, state);\n+    __ leave();\n+    __ ret();\n+\n+    return start;\n+  }\n+\n@@ -7230,0 +7283,4 @@\n+    if (UseGHASHIntrinsics) {\n+      StubRoutines::_ghash_processBlocks = generate_ghash_processBlocks();\n+    }\n+\n","filename":"src\/hotspot\/cpu\/riscv\/stubGenerator_riscv.cpp","additions":64,"deletions":7,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -460,0 +460,16 @@\n+\n+  if (UseZvkg) {\n+    if (FLAG_IS_DEFAULT(UseGHASHIntrinsics) && UseZvbb) {\n+      FLAG_SET_DEFAULT(UseGHASHIntrinsics, true);\n+    }\n+\n+    if (UseGHASHIntrinsics && !UseZvbb) {\n+      warning(\"Cannot enable UseGHASHIntrinsics on cpu without UseZvbb support\");\n+      FLAG_SET_DEFAULT(UseGHASHIntrinsics, false);\n+    }\n+  } else {\n+    if (UseGHASHIntrinsics) {\n+      warning(\"Cannot enable UseGHASHIntrinsics on cpu without UseZvkg support\");\n+      FLAG_SET_DEFAULT(UseGHASHIntrinsics, false);\n+    }\n+  }\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.cpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -292,0 +292,2 @@\n+  \/* Zvkg crypto extension for ghash and gcm *\/                                                        \\\n+  decl(Zvkg        ,  RV_NO_FLAG_BIT,  true ,  UPDATE_DEFAULT_DEP(UseZvkg, &ext_v, nullptr))           \\\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -452,2 +452,2 @@\n-const int AVX10_MINMAX_MAX_COMPARE_SIGN = 0x5;\n-const int AVX10_MINMAX_MIN_COMPARE_SIGN = 0x4;\n+const int AVX10_2_MINMAX_MAX_COMPARE_SIGN = 0x5;\n+const int AVX10_2_MINMAX_MIN_COMPARE_SIGN = 0x4;\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -620,1 +620,2 @@\n-  if (hi == max_jint) {\n+\n+  if (lo != min_jint) {\n@@ -622,6 +623,3 @@\n-    jccb(Assembler::greaterEqual, succeed);\n-  } else {\n-    if (lo != min_jint) {\n-      cmpl(val, lo);\n-      jccb(Assembler::less, fail);\n-    }\n+    jccb(Assembler::less, fail);\n+  }\n+  if (hi != max_jint) {\n@@ -629,1 +627,1 @@\n-    jccb(Assembler::lessEqual, succeed);\n+    jccb(Assembler::greater, fail);\n@@ -631,0 +629,1 @@\n+  jmpb(succeed);\n@@ -669,1 +668,1 @@\n-  if (hi == max_jlong) {\n+  if (lo != min_jlong) {\n@@ -671,6 +670,3 @@\n-    jccb(Assembler::greaterEqual, succeed);\n-  } else {\n-    if (lo != min_jlong) {\n-      cmp_val(lo);\n-      jccb(Assembler::less, fail);\n-    }\n+    jccb(Assembler::less, fail);\n+  }\n+  if (hi != max_jlong) {\n@@ -678,1 +674,1 @@\n-    jccb(Assembler::lessEqual, succeed);\n+    jccb(Assembler::greater, fail);\n@@ -680,0 +676,1 @@\n+  jmpb(succeed);\n@@ -1036,2 +1033,2 @@\n-  int imm8 = (opc == Op_MinV || opc == Op_MinReductionV) ? AVX10_MINMAX_MIN_COMPARE_SIGN\n-                                                         : AVX10_MINMAX_MAX_COMPARE_SIGN;\n+  int imm8 = (opc == Op_MinV || opc == Op_MinReductionV) ? AVX10_2_MINMAX_MIN_COMPARE_SIGN\n+                                                         : AVX10_2_MINMAX_MAX_COMPARE_SIGN;\n@@ -5166,1 +5163,1 @@\n-void C2_MacroAssembler::vector_castF2X_avx10(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc) {\n+void C2_MacroAssembler::vector_castF2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc) {\n@@ -5186,1 +5183,1 @@\n-void C2_MacroAssembler::vector_castF2X_avx10(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc) {\n+void C2_MacroAssembler::vector_castF2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc) {\n@@ -5206,1 +5203,1 @@\n-void C2_MacroAssembler::vector_castD2X_avx10(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc) {\n+void C2_MacroAssembler::vector_castD2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc) {\n@@ -5226,1 +5223,1 @@\n-void C2_MacroAssembler::vector_castD2X_avx10(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc) {\n+void C2_MacroAssembler::vector_castD2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc) {\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.cpp","additions":19,"deletions":22,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -350,1 +350,1 @@\n-  void vector_castF2X_avx10(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc);\n+  void vector_castF2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc);\n@@ -352,1 +352,1 @@\n-  void vector_castF2X_avx10(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc);\n+  void vector_castF2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc);\n@@ -354,1 +354,1 @@\n-  void vector_castD2X_avx10(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc);\n+  void vector_castD2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, XMMRegister src, int vec_enc);\n@@ -356,1 +356,1 @@\n-  void vector_castD2X_avx10(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc);\n+  void vector_castD2X_avx10_2(BasicType to_elem_bt, XMMRegister dst, Address src, int vec_enc);\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -8902,1 +8902,1 @@\n-      evminmaxps(dst, mask, nds, src, merge, AVX10_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n+      evminmaxps(dst, mask, nds, src, merge, AVX10_2_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n@@ -8904,1 +8904,1 @@\n-      evminmaxpd(dst, mask, nds, src, merge, AVX10_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n+      evminmaxpd(dst, mask, nds, src, merge, AVX10_2_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n@@ -8921,1 +8921,1 @@\n-      evminmaxps(dst, mask, nds, src, merge, AVX10_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n+      evminmaxps(dst, mask, nds, src, merge, AVX10_2_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n@@ -8923,1 +8923,1 @@\n-      evminmaxpd(dst, mask, nds, src, merge, AVX10_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n+      evminmaxpd(dst, mask, nds, src, merge, AVX10_2_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n@@ -8940,1 +8940,1 @@\n-      evminmaxps(dst, mask, nds, src, merge, AVX10_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n+      evminmaxps(dst, mask, nds, src, merge, AVX10_2_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n@@ -8942,1 +8942,1 @@\n-      evminmaxpd(dst, mask, nds, src, merge, AVX10_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n+      evminmaxpd(dst, mask, nds, src, merge, AVX10_2_MINMAX_MIN_COMPARE_SIGN, vector_len); break;\n@@ -8959,1 +8959,1 @@\n-      evminmaxps(dst, mask, nds, src, merge, AVX10_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n+      evminmaxps(dst, mask, nds, src, merge, AVX10_2_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n@@ -8961,1 +8961,1 @@\n-      evminmaxps(dst, mask, nds, src, merge, AVX10_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n+      evminmaxps(dst, mask, nds, src, merge, AVX10_2_MINMAX_MAX_COMPARE_SIGN, vector_len); break;\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -7292,1 +7292,1 @@\n-instruct maxF_avx10_reg(regF dst, regF a, regF b) %{\n+instruct maxF_reg_avx10_2(regF dst, regF a, regF b) %{\n@@ -7297,1 +7297,1 @@\n-    __ eminmaxss($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_MINMAX_MAX_COMPARE_SIGN);\n+    __ eminmaxss($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_2_MINMAX_MAX_COMPARE_SIGN);\n@@ -7328,1 +7328,1 @@\n-instruct maxD_avx10_reg(regD dst, regD a, regD b) %{\n+instruct maxD_reg_avx10_2(regD dst, regD a, regD b) %{\n@@ -7333,1 +7333,1 @@\n-    __ eminmaxsd($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_MINMAX_MAX_COMPARE_SIGN);\n+    __ eminmaxsd($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_2_MINMAX_MAX_COMPARE_SIGN);\n@@ -7364,1 +7364,1 @@\n-instruct minF_avx10_reg(regF dst, regF a, regF b) %{\n+instruct minF_reg_avx10_2(regF dst, regF a, regF b) %{\n@@ -7369,1 +7369,1 @@\n-    __ eminmaxss($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_MINMAX_MIN_COMPARE_SIGN);\n+    __ eminmaxss($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_2_MINMAX_MIN_COMPARE_SIGN);\n@@ -7400,1 +7400,1 @@\n-instruct minD_avx10_reg(regD dst, regD a, regD b) %{\n+instruct minD_reg_avx10_2(regD dst, regD a, regD b) %{\n@@ -7405,1 +7405,1 @@\n-    __ eminmaxsd($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_MINMAX_MIN_COMPARE_SIGN);\n+    __ eminmaxsd($dst$$XMMRegister, $a$$XMMRegister, $b$$XMMRegister, AVX10_2_MINMAX_MIN_COMPARE_SIGN);\n@@ -14589,1 +14589,1 @@\n-instruct convF2I_reg_reg_avx10(rRegI dst, regF src)\n+instruct convF2I_reg_reg_avx10_2(rRegI dst, regF src)\n@@ -14600,1 +14600,1 @@\n-instruct convF2I_reg_mem_avx10(rRegI dst, memory src)\n+instruct convF2I_reg_mem_avx10_2(rRegI dst, memory src)\n@@ -14623,1 +14623,1 @@\n-instruct convF2L_reg_reg_avx10(rRegL dst, regF src)\n+instruct convF2L_reg_reg_avx10_2(rRegL dst, regF src)\n@@ -14634,1 +14634,1 @@\n-instruct convF2L_reg_mem_avx10(rRegL dst, memory src)\n+instruct convF2L_reg_mem_avx10_2(rRegL dst, memory src)\n@@ -14657,1 +14657,1 @@\n-instruct convD2I_reg_reg_avx10(rRegI dst, regD src)\n+instruct convD2I_reg_reg_avx10_2(rRegI dst, regD src)\n@@ -14668,1 +14668,1 @@\n-instruct convD2I_reg_mem_avx10(rRegI dst, memory src)\n+instruct convD2I_reg_mem_avx10_2(rRegI dst, memory src)\n@@ -14691,1 +14691,1 @@\n-instruct convD2L_reg_reg_avx10(rRegL dst, regD src)\n+instruct convD2L_reg_reg_avx10_2(rRegL dst, regD src)\n@@ -14702,1 +14702,1 @@\n-instruct convD2L_reg_mem_avx10(rRegL dst, memory src)\n+instruct convD2L_reg_mem_avx10_2(rRegL dst, memory src)\n@@ -19663,1 +19663,1 @@\n-instruct minmax_reduction2F_avx10(regF dst, immF src1, vec src2, vec xtmp1) %{\n+instruct minmax_reduction2F_avx10_2(regF dst, immF src1, vec src2, vec xtmp1) %{\n@@ -19681,1 +19681,1 @@\n-instruct minmax_reductionF_avx10(regF dst, immF src1, vec src2, vec xtmp1, vec xtmp2) %{\n+instruct minmax_reductionF_avx10_2(regF dst, immF src1, vec src2, vec xtmp1, vec xtmp2) %{\n@@ -19699,1 +19699,1 @@\n-instruct minmax_reduction2F_avx10_av(regF dst, vec src, vec xtmp1) %{\n+instruct minmax_reduction2F_av_avx10_2(regF dst, vec src, vec xtmp1) %{\n@@ -19715,1 +19715,1 @@\n-instruct minmax_reductionF_avx10_av(regF dst, vec src, vec xtmp1, vec xtmp2) %{\n+instruct minmax_reductionF_av_avx10_2(regF dst, vec src, vec xtmp1, vec xtmp2) %{\n@@ -19813,1 +19813,1 @@\n-instruct minmax_reduction2D_avx10(regD dst, immD src1, vec src2, vec xtmp1) %{\n+instruct minmax_reduction2D_avx10_2(regD dst, immD src1, vec src2, vec xtmp1) %{\n@@ -19831,1 +19831,1 @@\n-instruct minmax_reductionD_avx10(regD dst, immD src1, vec src2, vec xtmp1, vec xtmp2) %{\n+instruct minmax_reductionD_avx10_2(regD dst, immD src1, vec src2, vec xtmp1, vec xtmp2) %{\n@@ -19850,1 +19850,1 @@\n-instruct minmax_reduction2D_av_avx10(regD dst, vec src, vec xtmp1) %{\n+instruct minmax_reduction2D_av_avx10_2(regD dst, vec src, vec xtmp1) %{\n@@ -19866,1 +19866,1 @@\n-instruct minmax_reductionD_av_avx10(regD dst, vec src, vec xtmp1, vec xtmp2) %{\n+instruct minmax_reductionD_av_avx10_2(regD dst, vec src, vec xtmp1, vec xtmp2) %{\n@@ -20769,1 +20769,1 @@\n-instruct minmaxFP_avx10_reg(vec dst, vec a, vec b) %{\n+instruct minmaxFP_reg_avx10_2(vec dst, vec a, vec b) %{\n@@ -22116,1 +22116,1 @@\n-instruct castFtoX_reg_avx10(vec dst, vec src) %{\n+instruct castFtoX_reg_avx10_2(vec dst, vec src) %{\n@@ -22120,1 +22120,1 @@\n-  format %{ \"vector_cast_f2x_avx10 $dst, $src\\t!\" %}\n+  format %{ \"vector_cast_f2x_avx10_2 $dst, $src\\t!\" %}\n@@ -22124,1 +22124,1 @@\n-    __ vector_castF2X_avx10(to_elem_bt, $dst$$XMMRegister, $src$$XMMRegister, vlen_enc);\n+    __ vector_castF2X_avx10_2(to_elem_bt, $dst$$XMMRegister, $src$$XMMRegister, vlen_enc);\n@@ -22129,1 +22129,1 @@\n-instruct castFtoX_mem_avx10(vec dst, memory src) %{\n+instruct castFtoX_mem_avx10_2(vec dst, memory src) %{\n@@ -22133,1 +22133,1 @@\n-  format %{ \"vector_cast_f2x_avx10 $dst, $src\\t!\" %}\n+  format %{ \"vector_cast_f2x_avx10_2 $dst, $src\\t!\" %}\n@@ -22138,1 +22138,1 @@\n-    __ vector_castF2X_avx10(to_elem_bt, $dst$$XMMRegister, $src$$Address, vlen_enc);\n+    __ vector_castF2X_avx10_2(to_elem_bt, $dst$$XMMRegister, $src$$Address, vlen_enc);\n@@ -22190,1 +22190,1 @@\n-instruct castDtoX_reg_avx10(vec dst, vec src) %{\n+instruct castDtoX_reg_avx10_2(vec dst, vec src) %{\n@@ -22194,1 +22194,1 @@\n-  format %{ \"vector_cast_d2x_avx10 $dst, $src\\t!\" %}\n+  format %{ \"vector_cast_d2x_avx10_2 $dst, $src\\t!\" %}\n@@ -22198,1 +22198,1 @@\n-    __ vector_castD2X_avx10(to_elem_bt, $dst$$XMMRegister, $src$$XMMRegister, vlen_enc);\n+    __ vector_castD2X_avx10_2(to_elem_bt, $dst$$XMMRegister, $src$$XMMRegister, vlen_enc);\n@@ -22203,1 +22203,1 @@\n-instruct castDtoX_mem_avx10(vec dst, memory src) %{\n+instruct castDtoX_mem_avx10_2(vec dst, memory src) %{\n@@ -22207,1 +22207,1 @@\n-  format %{ \"vector_cast_d2x_avx10 $dst, $src\\t!\" %}\n+  format %{ \"vector_cast_d2x_avx10_2 $dst, $src\\t!\" %}\n@@ -22212,1 +22212,1 @@\n-    __ vector_castD2X_avx10(to_elem_bt, $dst$$XMMRegister, $src$$Address, vlen_enc);\n+    __ vector_castD2X_avx10_2(to_elem_bt, $dst$$XMMRegister, $src$$Address, vlen_enc);\n@@ -25184,1 +25184,1 @@\n-instruct scalar_minmax_HF_avx10_reg(regF dst, regF src1, regF src2)\n+instruct scalar_minmax_HF_reg_avx10_2(regF dst, regF src1, regF src2)\n@@ -25191,1 +25191,1 @@\n-    int function = this->ideal_Opcode() == Op_MinHF ? AVX10_MINMAX_MIN_COMPARE_SIGN : AVX10_MINMAX_MAX_COMPARE_SIGN;\n+    int function = this->ideal_Opcode() == Op_MinHF ? AVX10_2_MINMAX_MIN_COMPARE_SIGN : AVX10_2_MINMAX_MAX_COMPARE_SIGN;\n@@ -25299,1 +25299,1 @@\n-instruct vector_minmax_HF_avx10_mem(vec dst, vec src1, memory src2)\n+instruct vector_minmax_HF_mem_avx10_2(vec dst, vec src1, memory src2)\n@@ -25307,1 +25307,1 @@\n-    int function =  this->ideal_Opcode() == Op_MinVHF ? AVX10_MINMAX_MIN_COMPARE_SIGN : AVX10_MINMAX_MAX_COMPARE_SIGN;\n+    int function =  this->ideal_Opcode() == Op_MinVHF ? AVX10_2_MINMAX_MIN_COMPARE_SIGN : AVX10_2_MINMAX_MAX_COMPARE_SIGN;\n@@ -25313,1 +25313,1 @@\n-instruct vector_minmax_HF_avx10_reg(vec dst, vec src1, vec src2)\n+instruct vector_minmax_HF_reg_avx10_2(vec dst, vec src1, vec src2)\n@@ -25321,1 +25321,1 @@\n-    int function =  this->ideal_Opcode() == Op_MinVHF ? AVX10_MINMAX_MIN_COMPARE_SIGN : AVX10_MINMAX_MAX_COMPARE_SIGN;\n+    int function =  this->ideal_Opcode() == Op_MinVHF ? AVX10_2_MINMAX_MIN_COMPARE_SIGN : AVX10_2_MINMAX_MAX_COMPARE_SIGN;\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":43,"deletions":43,"binary":false,"changes":86,"status":"modified"},{"patch":"@@ -868,0 +868,84 @@\n+\/\/ Returns the uid of a process or -1 on error.\n+uid_t os::Bsd::get_process_uid(pid_t pid) {\n+  struct kinfo_proc kp;\n+  size_t size = sizeof kp;\n+  int mib_kern[4] = {CTL_KERN, KERN_PROC, KERN_PROC_PID, pid};\n+  if (sysctl(mib_kern, 4, &kp, &size, nullptr, 0) == 0) {\n+    if (size > 0 && kp.kp_proc.p_pid == pid) {\n+      return kp.kp_eproc.e_ucred.cr_uid;\n+    }\n+  }\n+  return (uid_t)-1;\n+}\n+\n+\/\/ Returns true if the process is running as root.\n+bool os::Bsd::is_process_root(pid_t pid) {\n+  uid_t uid = get_process_uid(pid);\n+  return (uid != (uid_t)-1) ? os::Posix::is_root(uid) : false;\n+}\n+\n+#ifdef __APPLE__\n+\n+\/\/ macOS has a secure per-user temporary directory.\n+\/\/ Root can attach to a non-root process, hence it needs\n+\/\/ to lookup \/var\/folders for the user specific temporary directory\n+\/\/ of the form \/var\/folders\/*\/*\/T, that contains PERFDATA_NAME_user\n+\/\/ directory.\n+static const char VAR_FOLDERS[] = \"\/var\/folders\/\";\n+int os::Bsd::get_user_tmp_dir_macos(const char* user, int vmid, char* output_path, int output_size) {\n+\n+  \/\/ read the var\/folders directory\n+  DIR* varfolders_dir = os::opendir(VAR_FOLDERS);\n+  if (varfolders_dir != nullptr) {\n+\n+    \/\/ var\/folders directory contains 2-characters subdirectories (buckets)\n+    struct dirent* bucket_de;\n+\n+    \/\/ loop until the PERFDATA_NAME_user directory has been found\n+    while ((bucket_de = os::readdir(varfolders_dir)) != nullptr) {\n+      \/\/ skip over files and special \".\" and \"..\"\n+      if (bucket_de->d_type != DT_DIR || bucket_de->d_name[0] == '.') {\n+        continue;\n+      }\n+      \/\/ absolute path to the bucket\n+      char bucket[PATH_MAX];\n+      int b = os::snprintf(bucket, PATH_MAX, \"%s%s\/\", VAR_FOLDERS, bucket_de->d_name);\n+\n+      \/\/ the total length of the absolute path must not exceed the buffer size\n+      if (b >= PATH_MAX || b < 0) {\n+        continue;\n+      }\n+      \/\/ each bucket contains next level subdirectories\n+      DIR* bucket_dir = os::opendir(bucket);\n+      if (bucket_dir == nullptr) {\n+        continue;\n+      }\n+      \/\/ read each subdirectory, skipping over regular files\n+      struct dirent* subbucket_de;\n+      while ((subbucket_de = os::readdir(bucket_dir)) != nullptr) {\n+        if (subbucket_de->d_type != DT_DIR || subbucket_de->d_name[0] == '.') {\n+          continue;\n+        }\n+        \/\/ If the PERFDATA_NAME_user directory exists in the T subdirectory,\n+        \/\/ this means the subdirectory is the temporary directory of the user.\n+        char perfdata_path[PATH_MAX];\n+        int p = os::snprintf(perfdata_path, PATH_MAX, \"%s%s\/T\/%s_%s\/\", bucket, subbucket_de->d_name, PERFDATA_NAME, user);\n+\n+        \/\/ the total length must not exceed the output buffer size\n+        if (p >= PATH_MAX || p < 0) {\n+          continue;\n+        }\n+        \/\/ check if the subdirectory exists\n+        if (os::file_exists(perfdata_path)) {\n+          \/\/ the return value of snprintf is not checked for the second time\n+          return os::snprintf(output_path, output_size, \"%s%s\/T\", bucket, subbucket_de->d_name);\n+        }\n+      }\n+      os::closedir(bucket_dir);\n+    }\n+    os::closedir(varfolders_dir);\n+  }\n+  return -1;\n+}\n+#endif\n+\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":84,"deletions":0,"binary":false,"changes":84,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -64,0 +64,6 @@\n+  static uid_t get_process_uid(pid_t pid);\n+  static bool is_process_root(pid_t pid);\n+\n+#ifdef __APPLE__\n+  static int get_user_tmp_dir_macos(const char* user, int vmid, char* output_buffer, int buffer_size);\n+#endif\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.hpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -470,3 +470,3 @@\n-  OSContainer::print_container_helper(st, kmem_limit, \"kernel_memory_limit_in_bytes\");\n-  OSContainer::print_container_helper(st, kmem_usage, \"kernel_memory_usage_in_bytes\");\n-  OSContainer::print_container_helper(st, kmem_max_usage, \"kernel_memory_max_usage_in_bytes\");\n+  OSContainer::print_container_helper(st, kmem_limit, \"kernel_memory_limit\");\n+  OSContainer::print_container_helper(st, kmem_usage, \"kernel_memory_usage\");\n+  OSContainer::print_container_helper(st, kmem_max_usage, \"kernel_memory_max_usage\");\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -381,2 +381,2 @@\n-  OSContainer::print_container_helper(st, swap_current, \"memory_swap_current_in_bytes\");\n-  OSContainer::print_container_helper(st, swap_limit, \"memory_swap_max_limit_in_bytes\");\n+  OSContainer::print_container_helper(st, swap_current, \"memory_swap_current\");\n+  OSContainer::print_container_helper(st, swap_limit, \"memory_swap_max_limit\");\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -290,0 +290,25 @@\n+template<typename T> struct metric_fmt;\n+template<> struct metric_fmt<unsigned long long int> { static constexpr const char* fmt = \"%llu\"; };\n+template<> struct metric_fmt<unsigned long int> { static constexpr const char* fmt = \"%lu\"; };\n+template<> struct metric_fmt<int> { static constexpr const char* fmt = \"%d\"; };\n+template<> struct metric_fmt<const char*> { static constexpr const char* fmt = \"%s\"; };\n+\n+template void OSContainer::print_container_metric<unsigned long long int>(outputStream*, const char*, unsigned long long int, const char*);\n+template void OSContainer::print_container_metric<unsigned long int>(outputStream*, const char*, unsigned long int, const char*);\n+template void OSContainer::print_container_metric<int>(outputStream*, const char*, int, const char*);\n+template void OSContainer::print_container_metric<const char*>(outputStream*, const char*, const char*, const char*);\n+\n+template <typename T>\n+void OSContainer::print_container_metric(outputStream* st, const char* metrics, T value, const char* unit) {\n+  constexpr int max_length = 38; \/\/ Longest \"metric: value\" string (\"maximum number of tasks: not supported\")\n+  constexpr int longest_value = max_length - 11; \/\/ Max length - shortest \"metric: \" string (\"cpu_quota: \")\n+  char value_str[longest_value + 1] = {};\n+  os::snprintf_checked(value_str, longest_value, metric_fmt<T>::fmt, value);\n+  st->print(\"%s: %*s\", metrics, max_length - static_cast<int>(strlen(metrics)) - 2, value_str); \/\/ -2 for the \": \"\n+  if (unit[0] != '\\0') {\n+    st->print_cr(\" %s\", unit);\n+  } else {\n+    st->print_cr(\"\");\n+  }\n+}\n+\n@@ -291,1 +316,0 @@\n-  st->print(\"%s: \", metrics);\n@@ -295,1 +319,1 @@\n-        st->print_cr(PHYS_MEM_TYPE_FORMAT \" k\", (physical_memory_size_type)(res.value() \/ K));\n+        print_container_metric(st, metrics, res.value() \/ K, \"kB\");\n@@ -297,1 +321,1 @@\n-        st->print_cr(PHYS_MEM_TYPE_FORMAT, res.value());\n+        print_container_metric(st, metrics, res.value(), \"B\");\n@@ -300,1 +324,1 @@\n-      st->print_cr(\"%s\", \"unlimited\");\n+      print_container_metric(st, metrics, \"unlimited\");\n@@ -304,1 +328,1 @@\n-    st->print_cr(\"%s\", \"unavailable\");\n+    print_container_metric(st, metrics, \"unavailable\");\n","filename":"src\/hotspot\/os\/linux\/osContainer_linux.cpp","additions":29,"deletions":5,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -68,0 +68,2 @@\n+  template <typename T>\n+  static void print_container_metric(outputStream* st, const char* metrics, T value, const char* unit = \"\");\n","filename":"src\/hotspot\/os\/linux\/osContainer_linux.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2435,1 +2435,1 @@\n-  st->print_cr(\"container_type: %s\", p_ct != nullptr ? p_ct : \"not supported\");\n+  OSContainer::print_container_metric(st, \"container_type\", p_ct != nullptr ? p_ct : \"not supported\");\n@@ -2438,1 +2438,1 @@\n-  st->print_cr(\"cpu_cpuset_cpus: %s\", p != nullptr ? p : \"not supported\");\n+  OSContainer::print_container_metric(st, \"cpu_cpuset_cpus\", p != nullptr ? p : \"not supported\");\n@@ -2442,1 +2442,1 @@\n-  st->print_cr(\"cpu_memory_nodes: %s\", p != nullptr ? p : \"not supported\");\n+  OSContainer::print_container_metric(st, \"cpu_memory_nodes\", p != nullptr ? p : \"not supported\");\n@@ -2447,1 +2447,0 @@\n-  st->print(\"active_processor_count: \");\n@@ -2451,1 +2450,1 @@\n-      st->print_cr(\"%d, but overridden by -XX:ActiveProcessorCount %d\", i, ActiveProcessorCount);\n+      OSContainer::print_container_metric(st, \"active_processor_count\", ActiveProcessorCount, \"(from -XX:ActiveProcessorCount)\");\n@@ -2453,1 +2452,1 @@\n-      st->print_cr(\"%d\", i);\n+      OSContainer::print_container_metric(st, \"active_processor_count\", i);\n@@ -2456,1 +2455,1 @@\n-    st->print_cr(\"not supported\");\n+    OSContainer::print_container_metric(st, \"active_processor_count\", \"not supported\");\n@@ -2461,1 +2460,0 @@\n-  st->print(\"cpu_quota: \");\n@@ -2463,1 +2461,1 @@\n-    st->print_cr(\"%d\", i);\n+    OSContainer::print_container_metric(st, \"cpu_quota\", i);\n@@ -2465,1 +2463,1 @@\n-    st->print_cr(\"%s\", !supported ? \"not supported\" : \"no quota\");\n+    OSContainer::print_container_metric(st, \"cpu_quota\", !supported ? \"not supported\" : \"no quota\");\n@@ -2469,1 +2467,0 @@\n-  st->print(\"cpu_period: \");\n@@ -2471,1 +2468,1 @@\n-    st->print_cr(\"%d\", i);\n+    OSContainer::print_container_metric(st, \"cpu_period\", i);\n@@ -2473,1 +2470,1 @@\n-    st->print_cr(\"%s\", !supported ? \"not supported\" : \"no period\");\n+    OSContainer::print_container_metric(st, \"cpu_period\", !supported ? \"not supported\" : \"no period\");\n@@ -2477,1 +2474,0 @@\n-  st->print(\"cpu_shares: \");\n@@ -2479,1 +2475,1 @@\n-    st->print_cr(\"%d\", i);\n+    OSContainer::print_container_metric(st, \"cpu_shares\", i);\n@@ -2481,1 +2477,1 @@\n-    st->print_cr(\"%s\", !supported ? \"not supported\" : \"no shares\");\n+    OSContainer::print_container_metric(st, \"cpu_shares\", !supported ? \"not supported\" : \"no shares\");\n@@ -2486,1 +2482,0 @@\n-  st->print(\"cpu_usage_in_micros: \");\n@@ -2488,1 +2483,1 @@\n-    st->print_cr(UINT64_FORMAT, j);\n+    OSContainer::print_container_metric(st, \"cpu_usage\", j, \"us\");\n@@ -2490,1 +2485,1 @@\n-    st->print_cr(\"%s\", !supported ? \"not supported\" : \"no usage\");\n+    OSContainer::print_container_metric(st, \"cpu_usage\", !supported ? \"not supported\" : \"no usage\");\n@@ -2533,8 +2528,8 @@\n-  OSContainer::print_container_helper(st, memory_limit, \"memory_limit_in_bytes\");\n-  OSContainer::print_container_helper(st, mem_swap_limit, \"memory_and_swap_limit_in_bytes\");\n-  OSContainer::print_container_helper(st, mem_soft_limit, \"memory_soft_limit_in_bytes\");\n-  OSContainer::print_container_helper(st, mem_throttle_limit, \"memory_throttle_limit_in_bytes\");\n-  OSContainer::print_container_helper(st, mem_usage, \"memory_usage_in_bytes\");\n-  OSContainer::print_container_helper(st, mem_max_usage, \"memory_max_usage_in_bytes\");\n-  OSContainer::print_container_helper(st, rss_usage, \"rss_usage_in_bytes\");\n-  OSContainer::print_container_helper(st, cache_usage, \"cache_usage_in_bytes\");\n+  OSContainer::print_container_helper(st, memory_limit, \"memory_limit\");\n+  OSContainer::print_container_helper(st, mem_swap_limit, \"memory_and_swap_limit\");\n+  OSContainer::print_container_helper(st, mem_soft_limit, \"memory_soft_limit\");\n+  OSContainer::print_container_helper(st, mem_throttle_limit, \"memory_throttle_limit\");\n+  OSContainer::print_container_helper(st, mem_usage, \"memory_usage\");\n+  OSContainer::print_container_helper(st, mem_max_usage, \"memory_max_usage\");\n+  OSContainer::print_container_helper(st, rss_usage, \"rss_usage\");\n+  OSContainer::print_container_helper(st, cache_usage, \"cache_usage\");\n@@ -2545,1 +2540,0 @@\n-  st->print(\"maximum number of tasks: \");\n@@ -2547,1 +2541,1 @@\n-    st->print_cr(UINT64_FORMAT, j);\n+    OSContainer::print_container_metric(st, \"maximum number of tasks\", j);\n@@ -2549,1 +2543,1 @@\n-    st->print_cr(\"%s\", !supported ? \"not supported\" : \"unlimited\");\n+    OSContainer::print_container_metric(st, \"maximum number of tasks\", !supported ? \"not supported\" : \"unlimited\");\n@@ -2553,1 +2547,0 @@\n-  st->print(\"current number of tasks: \");\n@@ -2555,1 +2548,1 @@\n-    st->print_cr(UINT64_FORMAT, j);\n+    OSContainer::print_container_metric(st, \"current number of tasks\", j);\n@@ -2557,1 +2550,1 @@\n-    st->print_cr(\"%s\", !supported ? \"not supported\" : \"no current tasks\");\n+    OSContainer::print_container_metric(st, \"current number of tasks\", !supported ? \"not supported\" : \"no tasks\");\n@@ -4301,7 +4294,0 @@\n-\/\/ This is the fastest way to get thread cpu time on Linux.\n-\/\/ Returns cpu time (user+sys) for any thread, not only for current.\n-\/\/ POSIX compliant clocks are implemented in the kernels 2.6.16+.\n-\/\/ It might work on 2.6.10+ with a special kernel\/glibc patch.\n-\/\/ For reference, please, see IEEE Std 1003.1-2004:\n-\/\/   http:\/\/www.unix.org\/single_unix_specification\n-\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":26,"deletions":40,"binary":false,"changes":66,"status":"modified"},{"patch":"@@ -1355,0 +1355,4 @@\n+bool os::Posix::is_current_user_root(){\n+    return is_root(geteuid());\n+}\n+\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -79,0 +79,3 @@\n+  \/\/ Returns true if the current user is root.\n+  static bool is_current_user_root();\n+\n","filename":"src\/hotspot\/os\/posix\/os_posix.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -43,0 +43,3 @@\n+#if defined(BSD)\n+#include \"os_bsd.hpp\"\n+#endif\n@@ -145,0 +148,12 @@\n+#endif\n+#ifdef __APPLE__\n+  char buffer[PATH_MAX] = {0};\n+  \/\/ Check if the current user is root and the target VM is running as non-root.\n+  \/\/ Otherwise the output of os::get_temp_directory() is used.\n+  \/\/\n+  if (os::Posix::is_current_user_root() && !os::Bsd::is_process_root(vmid)) {\n+    int path_size = os::Bsd::get_user_tmp_dir_macos(user, vmid, buffer, sizeof buffer);\n+    if (path_size > 0 && (size_t)path_size < sizeof buffer) {\n+      tmpdir = buffer;\n+    }\n+  }\n@@ -1141,1 +1156,2 @@\n-  const char* luser = get_user_name(vmid, &nspid, CHECK);\n+  const char* luser = NOT_MACOS(get_user_name(vmid, &nspid, CHECK))\n+                      MACOS_ONLY(get_user_name(os::Bsd::get_process_uid(vmid)));\n","filename":"src\/hotspot\/os\/posix\/perfMemory_posix.cpp","additions":17,"deletions":1,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -1672,4 +1672,1 @@\n-  \/\/ has not already terminated - else the following assertion\n-  \/\/ will fail because the thread is no longer a JavaThread as the ~JavaThread\n-  \/\/ destructor has completed.\n-\n+  \/\/ has not already terminated, else the osthread may already have been freed.\n@@ -1680,2 +1677,0 @@\n-  assert(thread->is_VM_thread() || thread->is_Java_thread(), \"Must be VMThread or JavaThread\");\n-\n@@ -1687,0 +1682,5 @@\n+    \/\/ Only check this on an active suspend request. It is possible to get a late delivered\n+    \/\/ signal from a cancelled suspend request that hits after the JavaThread destructor\n+    \/\/ completes, but before the Thread destructor causes `is_terminated()` to be true.\n+    assert(thread->is_VM_thread() || thread->is_Java_thread(), \"Must be VMThread or JavaThread\");\n+\n","filename":"src\/hotspot\/os\/posix\/signals_posix.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -259,0 +259,3 @@\n+  if (is_set(RISCV_HWPROBE_KEY_IMA_EXT_0, RISCV_HWPROBE_EXT_ZVKG)) {\n+    VM_Version::ext_Zvkg.enable_feature();\n+  }\n","filename":"src\/hotspot\/os_cpu\/linux_riscv\/riscv_hwprobe.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -148,1 +148,1 @@\n-  if (CDSConfig::is_initing_classes_at_dump_time()) {\n+  if (CDSConfig::is_dumping_aot_linked_classes()) {\n@@ -191,1 +191,1 @@\n-  if (CDSConfig::is_initing_classes_at_dump_time()) {\n+  if (CDSConfig::is_dumping_aot_linked_classes()) {\n@@ -261,1 +261,1 @@\n-    if (ik->is_hidden() && CDSConfig::is_initing_classes_at_dump_time()) {\n+    if (ik->is_hidden() && CDSConfig::is_dumping_aot_linked_classes()) {\n","filename":"src\/hotspot\/share\/cds\/aotArtifactFinder.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-  if (!CDSConfig::is_initing_classes_at_dump_time()) {\n+  if (!CDSConfig::is_dumping_aot_linked_classes()) {\n@@ -67,1 +67,1 @@\n-  \/\/ When CDSConfig::is_initing_classes_at_dump_time is enabled,\n+  \/\/ When CDSConfig::is_dumping_aot_linked_classes is enabled,\n@@ -313,1 +313,1 @@\n-  if (AOTInitTestClass != nullptr && CDSConfig::is_initing_classes_at_dump_time()) {\n+  if (AOTInitTestClass != nullptr && CDSConfig::is_dumping_aot_linked_classes()) {\n","filename":"src\/hotspot\/share\/cds\/aotClassInitializer.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1144,1 +1144,1 @@\n-    if (CDSConfig::is_initing_classes_at_dump_time()) {\n+    if (CDSConfig::is_dumping_aot_linked_classes()) {\n@@ -2208,1 +2208,1 @@\n-    if (HeapShared::is_loading_mapping_mode()) {\n+    if (HeapShared::is_loading() && HeapShared::is_loading_mapping_mode()) {\n","filename":"src\/hotspot\/share\/cds\/aotMetaspace.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1029,4 +1029,0 @@\n-bool CDSConfig::is_initing_classes_at_dump_time() {\n-  return is_dumping_heap() && is_dumping_aot_linked_classes();\n-}\n-\n@@ -1039,2 +1035,2 @@\n-\/\/ When we are dumping aot-linked classes and we are able to write archived heap objects, we automatically\n-\/\/ enable the archiving of MethodHandles. This will in turn enable the archiving of MethodTypes and hidden\n+\/\/ When we are dumping aot-linked classes, we automatically enable the archiving of MethodHandles.\n+\/\/ This will in turn enable the archiving of MethodTypes and hidden\n@@ -1045,1 +1041,1 @@\n-  return is_initing_classes_at_dump_time();\n+  return is_dumping_aot_linked_classes();\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.cpp","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -190,1 +190,0 @@\n-  static bool is_initing_classes_at_dump_time()              NOT_CDS_JAVA_HEAP_RETURN_(false);\n","filename":"src\/hotspot\/share\/cds\/cdsConfig.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-\/\/ !!! CDSConfig::is_initing_classes_at_dump_time()==true.\n+\/\/ !!! CDSConfig::is_dumping_aot_linked_classes()==true.\n@@ -66,1 +66,1 @@\n-  assert(!CDSConfig::is_initing_classes_at_dump_time(), \"only for legacy support of enums\");\n+  assert(!CDSConfig::is_dumping_aot_linked_classes(), \"only for legacy support of enums\");\n","filename":"src\/hotspot\/share\/cds\/cdsEnumKlass.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-\/\/ CDSConfig::is_initing_classes_at_dump_time()==true.\n+\/\/ CDSConfig::is_dumping_aot_linked_classes()==true.\n","filename":"src\/hotspot\/share\/cds\/cdsEnumKlass.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -159,1 +159,1 @@\n-  if (CDSConfig::is_initing_classes_at_dump_time()) {\n+  if (CDSConfig::is_dumping_aot_linked_classes()) {\n","filename":"src\/hotspot\/share\/cds\/cdsHeapVerifier.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -209,0 +209,2 @@\n+          ResourceMark rm(THREAD);\n+          log_info(aot, init)(\"Initializing %s\", ik->external_name());\n","filename":"src\/hotspot\/share\/cds\/finalImageRecipes.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -212,2 +212,8 @@\n-  return is_subgraph_root_class_of(archive_subgraph_entry_fields, ik) ||\n-         is_subgraph_root_class_of(fmg_archive_subgraph_entry_fields, ik);\n+  assert(CDSConfig::is_dumping_heap(), \"dump-time only\");\n+  if (!CDSConfig::is_dumping_aot_linked_classes()) {\n+    \/\/ Legacy CDS archive support (to be deprecated)\n+    return is_subgraph_root_class_of(archive_subgraph_entry_fields, ik) ||\n+           is_subgraph_root_class_of(fmg_archive_subgraph_entry_fields, ik);\n+  } else {\n+    return false;\n+  }\n@@ -937,2 +943,8 @@\n-  archive_object_subgraphs(archive_subgraph_entry_fields,\n-                           false \/* is_full_module_graph *\/);\n+  if (!CDSConfig::is_dumping_aot_linked_classes()) {\n+    archive_object_subgraphs(archive_subgraph_entry_fields,\n+                             false \/* is_full_module_graph *\/);\n+    if (CDSConfig::is_dumping_full_module_graph()) {\n+      archive_object_subgraphs(fmg_archive_subgraph_entry_fields,\n+                               true \/* is_full_module_graph *\/);\n+    }\n+  }\n@@ -941,2 +953,0 @@\n-    archive_object_subgraphs(fmg_archive_subgraph_entry_fields,\n-                             true \/* is_full_module_graph *\/);\n@@ -1298,2 +1308,4 @@\n-  resolve_classes_for_subgraphs(current, archive_subgraph_entry_fields);\n-  resolve_classes_for_subgraphs(current, fmg_archive_subgraph_entry_fields);\n+  if (!CDSConfig::is_using_aot_linked_classes()) {\n+    resolve_classes_for_subgraphs(current, archive_subgraph_entry_fields);\n+    resolve_classes_for_subgraphs(current, fmg_archive_subgraph_entry_fields);\n+  }\n@@ -1737,1 +1749,1 @@\n-  if (CDSConfig::is_initing_classes_at_dump_time()) {\n+  if (CDSConfig::is_dumping_aot_linked_classes()) {\n@@ -1743,1 +1755,1 @@\n-    \/\/ Without CDSConfig::is_initing_classes_at_dump_time(), we only allow archived objects to\n+    \/\/ Without CDSConfig::is_dumping_aot_linked_classes(), we only allow archived objects to\n@@ -1811,3 +1823,3 @@\n-  if (CDSConfig::is_initing_classes_at_dump_time()) {\n-    \/\/ The classes of all archived enum instances have been marked as aot-init,\n-    \/\/ so there's nothing else to be done in the production run.\n+  if (CDSConfig::is_dumping_aot_linked_classes()) {\n+    \/\/ The enum klasses are archived with aot-initialized mirror.\n+    \/\/ See AOTClassInitializer::can_archive_initialized_mirror().\n@@ -1952,1 +1964,1 @@\n-  if (CDSConfig::is_initing_classes_at_dump_time()) {\n+  if (CDSConfig::is_dumping_aot_linked_classes()) {\n@@ -2139,3 +2151,5 @@\n-  init_subgraph_entry_fields(archive_subgraph_entry_fields, CHECK);\n-  if (CDSConfig::is_dumping_full_module_graph()) {\n-    init_subgraph_entry_fields(fmg_archive_subgraph_entry_fields, CHECK);\n+  if (!CDSConfig::is_dumping_aot_linked_classes()) {\n+    init_subgraph_entry_fields(archive_subgraph_entry_fields, CHECK);\n+    if (CDSConfig::is_dumping_full_module_graph()) {\n+      init_subgraph_entry_fields(fmg_archive_subgraph_entry_fields, CHECK);\n+    }\n","filename":"src\/hotspot\/share\/cds\/heapShared.cpp","additions":31,"deletions":17,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -31,1 +31,1 @@\n-#include \"oops\/klass.hpp\"\n+#include \"oops\/klass.inline.hpp\"\n@@ -34,0 +34,1 @@\n+#include \"utilities\/growableArray.hpp\"\n@@ -45,0 +46,2 @@\n+  GrowableArray<InstanceKlass*> _klasses;\n+\n@@ -51,4 +54,1 @@\n-    : _class_name_pattern(class_name_pattern),\n-      _method_name_pattern(method_name_pattern),\n-      _method_signature_pattern(method_signature_pattern),\n-      _always_print_class_name(always_print_class_name),\n+    : _always_print_class_name(always_print_class_name),\n@@ -69,0 +69,21 @@\n+\n+    if (has_mode(_flags, PRINT_CLASS_DETAILS)) {\n+      _always_print_class_name = true;\n+    }\n+\n+    _class_name_pattern = copy_pattern(class_name_pattern);\n+    _method_name_pattern = copy_pattern(method_name_pattern);\n+    _method_signature_pattern = copy_pattern(method_signature_pattern);\n+  }\n+\n+  static const char* copy_pattern(const char* pattern) {\n+    if (pattern == nullptr) {\n+      return nullptr;\n+    }\n+    char* copy = ResourceArea::strdup(pattern);\n+    for (char* p = copy; *p; p++) {\n+      if (*p == '.') {\n+        *p = '\/';\n+      }\n+    }\n+    return copy;\n@@ -75,1 +96,4 @@\n-    print_instance_klass(InstanceKlass::cast(k));\n+    InstanceKlass* ik = InstanceKlass::cast(k);\n+    if (ik->is_loaded() && ik->name()->is_star_match(_class_name_pattern)) {\n+      _klasses.append(ik);\n+    }\n@@ -78,0 +102,8 @@\n+  void print() {\n+    _klasses.sort(compare_klasses_alphabetically);\n+    for (int i = 0; i < _klasses.length(); i++) {\n+      print_instance_klass(_klasses.at(i));\n+    }\n+  }\n+\n+\n@@ -82,0 +114,28 @@\n+  static int compare_klasses_alphabetically(InstanceKlass** a, InstanceKlass** b) {\n+    return compare_symbols_alphabetically((*a)->name(), (*b)->name());\n+  }\n+\n+  static int compare_methods_alphabetically(const void* a, const void* b) {\n+    Method* ma = *(Method**)a;\n+    Method* mb = *(Method**)b;\n+    int n = compare_symbols_alphabetically(ma->name(), mb->name());\n+    if (n == 0) {\n+      n = compare_symbols_alphabetically(ma->signature(), mb->signature());\n+    }\n+    return n;\n+  }\n+\n+  static int compare_symbols_alphabetically(Symbol* a, Symbol *b) {\n+    if (a == b) {\n+      return 0;\n+    }\n+    if (a != nullptr && b == nullptr) {\n+      return 1;\n+    }\n+    if (a == nullptr && b != nullptr) {\n+      return -1;\n+    }\n+\n+    return strcmp(a->as_C_string(), b->as_C_string());\n+  }\n+\n@@ -83,1 +143,2 @@\n-    _st->print(\"[%3d] \" INTPTR_FORMAT \" class %s \", _num++, p2i(ik), ik->name()->as_C_string());\n+    _st->print(\"[%3d] \" INTPTR_FORMAT \" class: %s mirror: \" INTPTR_FORMAT \" \", _num++,\n+               p2i(ik), ik->name()->as_C_string(), p2i(ik->java_mirror()));\n@@ -89,6 +150,18 @@\n-    if (ik->is_loaded() && ik->name()->is_star_match(_class_name_pattern)) {\n-      ResourceMark rm;\n-      if (_has_printed_methods) {\n-        \/\/ We have printed some methods in the previous class.\n-        \/\/ Print a new line to separate the two classes\n-        _st->cr();\n+    ResourceMark rm;\n+    if (_has_printed_methods) {\n+      \/\/ We have printed some methods in the previous class.\n+      \/\/ Print a new line to separate the two classes\n+      _st->cr();\n+    }\n+    _has_printed_methods = false;\n+    if (_always_print_class_name) {\n+      print_klass_name(ik);\n+    }\n+\n+    if (has_mode(_flags, ClassPrinter::PRINT_CLASS_DETAILS)) {\n+      _st->print(\"InstanceKlass: \");\n+      ik->print_on(_st);\n+      oop mirror = ik->java_mirror();\n+      if (mirror != nullptr) {\n+        _st->print(\"\\nJava mirror oop for %s: \", ik->name()->as_C_string());\n+        mirror->print_on(_st);\n@@ -96,3 +169,10 @@\n-      _has_printed_methods = false;\n-      if (_always_print_class_name) {\n-        print_klass_name(ik);\n+    }\n+\n+    if (has_mode(_flags, ClassPrinter::PRINT_METHOD_NAME)) {\n+      bool print_codes = has_mode(_flags, ClassPrinter::PRINT_BYTECODE);\n+      int len = ik->methods()->length();\n+      int num_methods_printed = 0;\n+\n+      Method** sorted_methods = NEW_RESOURCE_ARRAY(Method*, len);\n+      for (int index = 0; index < len; index++) {\n+        sorted_methods[index] = ik->methods()->at(index);\n@@ -101,12 +181,9 @@\n-      if (has_mode(_flags, ClassPrinter::PRINT_METHOD_NAME)) {\n-        bool print_codes = has_mode(_flags, ClassPrinter::PRINT_BYTECODE);\n-        int len = ik->methods()->length();\n-        int num_methods_printed = 0;\n-\n-        for (int index = 0; index < len; index++) {\n-          Method* m = ik->methods()->at(index);\n-          if (match(_method_name_pattern, m->name()) &&\n-              match(_method_signature_pattern, m->signature())) {\n-            if (print_codes && num_methods_printed++ > 0) {\n-              _st->cr();\n-            }\n+      qsort(sorted_methods, len, sizeof(Method*), compare_methods_alphabetically);\n+\n+      for (int index = 0; index < len; index++) {\n+        Method* m = sorted_methods[index];\n+        if (match(_method_name_pattern, m->name()) &&\n+            match(_method_signature_pattern, m->signature())) {\n+          if (print_codes && num_methods_printed++ > 0) {\n+            _st->cr();\n+          }\n@@ -114,5 +191,3 @@\n-            if (_has_printed_methods == false) {\n-              if (!_always_print_class_name) {\n-                print_klass_name(ik);\n-              }\n-              _has_printed_methods = true;\n+          if (_has_printed_methods == false) {\n+            if (!_always_print_class_name) {\n+              print_klass_name(ik);\n@@ -120,1 +195,1 @@\n-            print_method(m);\n+            _has_printed_methods = true;\n@@ -122,0 +197,1 @@\n+          print_method(m);\n@@ -128,1 +204,0 @@\n-    bool print_codes = has_mode(_flags, ClassPrinter::PRINT_BYTECODE);\n@@ -132,1 +207,6 @@\n-    if (print_codes) {\n+\n+    if (has_mode(_flags, ClassPrinter::PRINT_METHOD_DETAILS)) {\n+      m->print_on(_st);\n+    }\n+\n+    if (has_mode(_flags, ClassPrinter::PRINT_BYTECODE)) {\n@@ -145,0 +225,2 @@\n+  os->print_cr(\"   0x%02x  - print details of the C++ and Java objects that represent classes\",  PRINT_CLASS_DETAILS);\n+  os->print_cr(\"   0x%02x  - print details of the C++ objects that represent methods\",  PRINT_METHOD_DETAILS);\n@@ -149,0 +231,1 @@\n+  ResourceMark rm;\n@@ -151,0 +234,1 @@\n+  closure.print();\n@@ -177,0 +261,1 @@\n+  closure.print();\n","filename":"src\/hotspot\/share\/classfile\/classPrinter.cpp","additions":121,"deletions":36,"binary":false,"changes":157,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,0 +55,2 @@\n+    PRINT_CLASS_DETAILS     = 1 << 5, \/\/ print details of the C++ and Java objects that represent classes\n+    PRINT_METHOD_DETAILS    = 1 << 6, \/\/ print details of the C++ objects that represent methods\n","filename":"src\/hotspot\/share\/classfile\/classPrinter.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -130,4 +130,2 @@\n-  \/\/ If a message is already set, free it.\n-  if (nest_host_error() != nullptr) {\n-    FREE_C_HEAP_ARRAY(char, _nest_host_error);\n-  }\n+  assert(_nest_host_error == nullptr, \"caller should have checked\");\n+  assert_lock_strong(SystemDictionary_lock);\n","filename":"src\/hotspot\/share\/classfile\/resolutionErrors.cpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1862,1 +1862,1 @@\n-                                           const char* message) {\n+                                           const stringStream& message) {\n@@ -1871,1 +1871,1 @@\n-      ResolutionErrorTable::add_entry(pool, which, message);\n+      ResolutionErrorTable::add_entry(pool, which, message.as_string(true \/* on C-heap *\/));\n@@ -1876,3 +1876,8 @@\n-      \/\/ the message, and set it again.\n-      assert(entry->nest_host_error() == nullptr || strcmp(entry->nest_host_error(), message) == 0, \"should be the same message\");\n-      entry->set_nest_host_error(message);\n+      \/\/ the message.\n+      const char* nhe = entry->nest_host_error();\n+      if (nhe == nullptr) {\n+        entry->set_nest_host_error(message.as_string(true \/* on C-heap *\/));\n+      } else {\n+        DEBUG_ONLY(const char* msg = message.base();)\n+        assert(strcmp(nhe, msg) == 0, \"New message %s, differs from original %s\", msg, nhe);\n+      }\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -283,1 +283,1 @@\n-                                  const char* message);\n+                                  const stringStream& message);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -193,0 +193,3 @@\n+  \/* Scoped Values *\/                                                                                           \\\n+  do_klass(ScopedValue_Carrier_klass,                   java_lang_ScopedValue_Carrier                         ) \\\n+                                                                                                                \\\n","filename":"src\/hotspot\/share\/classfile\/vmClassMacros.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"runtime\/globals.hpp\"\n","filename":"src\/hotspot\/share\/compiler\/compilerDefinitions.inline.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -564,0 +564,14 @@\n+bool DirectiveSet::should_delay_inline(ciMethod* inlinee) {\n+  inlinee->check_is_loaded();\n+  VM_ENTRY_MARK;\n+  methodHandle mh(THREAD, inlinee->get_Method());\n+\n+  if (_inlinematchers != nullptr) {\n+    return matches_inline(mh, InlineMatcher::delay_inline);\n+  }\n+  if (!CompilerDirectivesIgnoreCompileCommandsOption) {\n+    return CompilerOracle::should_delay_inline(mh);\n+  }\n+  return false;\n+}\n+\n","filename":"src\/hotspot\/share\/compiler\/compilerDirectives.cpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -145,0 +145,1 @@\n+  bool should_delay_inline(ciMethod* inlinee);\n","filename":"src\/hotspot\/share\/compiler\/compilerDirectives.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -483,0 +483,4 @@\n+bool CompilerOracle::should_delay_inline(const methodHandle& method) {\n+  return (check_predicate(CompileCommandEnum::DelayInline, method));\n+}\n+\n","filename":"src\/hotspot\/share\/compiler\/compilerOracle.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -54,0 +54,1 @@\n+  option(DelayInline,  \"delayinline\", Bool) \\\n@@ -153,0 +154,3 @@\n+  \/\/ Tells whether we want to delay inlining of this method\n+  static bool should_delay_inline(const methodHandle& method);\n+\n","filename":"src\/hotspot\/share\/compiler\/compilerOracle.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -103,0 +103,1 @@\n+      delay_inline,\n","filename":"src\/hotspot\/share\/compiler\/methodMatcher.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-#include \"gc\/shared\/ptrQueue.hpp\"\n+#include \"gc\/shared\/satbMarkQueue.hpp\"\n","filename":"src\/hotspot\/share\/gc\/g1\/jvmFlagConstraintsG1.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -73,2 +73,2 @@\n-  nonstatic_field(PtrQueue,            _buf,            void**)               \\\n-  nonstatic_field(PtrQueue,            _index,          size_t)\n+  nonstatic_field(SATBMarkQueue,       _buf,            void**)               \\\n+  nonstatic_field(SATBMarkQueue,       _index,          size_t)\n@@ -99,1 +99,0 @@\n-  declare_toplevel_type(PtrQueue)                                             \\\n","filename":"src\/hotspot\/share\/gc\/g1\/vmStructs_g1.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -36,4 +36,1 @@\n-          \"for a system GC\")                                                \\\n-                                                                            \\\n-  product(bool, PSChunkLargeArrays, true,                                   \\\n-          \"(Deprecated) Process large arrays in chunks\")\n+          \"for a system GC\")\n","filename":"src\/hotspot\/share\/gc\/parallel\/parallel_globals.hpp","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -302,2 +302,1 @@\n-        klass->is_objArray_klass() &&\n-        PSChunkLargeArrays) {\n+        klass->is_objArray_klass()) {\n@@ -347,1 +346,0 @@\n-    assert(PSChunkLargeArrays, \"invariant\");\n","filename":"src\/hotspot\/share\/gc\/parallel\/psPromotionManager.inline.hpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -284,3 +284,3 @@\n-    static bool oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                      arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                      size_t length);\n+    static OopCopyResult oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                               arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                               size_t length);\n","filename":"src\/hotspot\/share\/gc\/shared\/barrierSet.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -37,3 +37,3 @@\n-inline bool BarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                                                                      arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                                                                      size_t length) {\n+inline OopCopyResult BarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                                                                               arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                                                                               size_t length) {\n@@ -45,1 +45,2 @@\n-    return Raw::oop_arraycopy(nullptr, 0, src, nullptr, 0, dst, length);\n+    Raw::oop_arraycopy(nullptr, 0, src, nullptr, 0, dst, length);\n+    return OopCopyResult::ok;\n@@ -53,1 +54,1 @@\n-      return false;\n+      return OopCopyResult::failed_check_class_cast;\n@@ -58,1 +59,1 @@\n-  return true;\n+  return OopCopyResult::ok;\n","filename":"src\/hotspot\/share\/gc\/shared\/barrierSet.inline.hpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -107,3 +107,3 @@\n-    static bool oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                      arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                      size_t length);\n+    static OopCopyResult oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                               arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                               size_t length);\n","filename":"src\/hotspot\/share\/gc\/shared\/cardTableBarrierSet.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -102,1 +102,1 @@\n-inline bool CardTableBarrierSet::AccessBarrier<decorators, BarrierSetT>::\n+inline OopCopyResult CardTableBarrierSet::AccessBarrier<decorators, BarrierSetT>::\n@@ -134,1 +134,1 @@\n-        return false;\n+        return OopCopyResult::failed_check_class_cast;\n@@ -139,1 +139,2 @@\n-  return true;\n+\n+  return OopCopyResult::ok;\n","filename":"src\/hotspot\/share\/gc\/shared\/cardTableBarrierSet.inline.hpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -1,111 +0,0 @@\n-\/*\n- * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\n- *\/\n-\n-#include \"gc\/shared\/bufferNode.hpp\"\n-#include \"gc\/shared\/ptrQueue.hpp\"\n-\n-PtrQueue::PtrQueue(PtrQueueSet* qset) :\n-  _index(0),\n-  _buf(nullptr)\n-{}\n-\n-PtrQueue::~PtrQueue() {\n-  assert(_buf == nullptr, \"queue must be flushed before delete\");\n-}\n-\n-size_t PtrQueue::current_capacity() const {\n-  if (_buf == nullptr) {\n-    return 0;\n-  } else {\n-    return BufferNode::make_node_from_buffer(_buf)->capacity();\n-  }\n-}\n-\n-PtrQueueSet::PtrQueueSet(BufferNode::Allocator* allocator) :\n-  _allocator(allocator)\n-{}\n-\n-PtrQueueSet::~PtrQueueSet() {}\n-\n-void PtrQueueSet::reset_queue(PtrQueue& queue) {\n-  queue.set_index(queue.current_capacity());\n-}\n-\n-void PtrQueueSet::flush_queue(PtrQueue& queue) {\n-  void** buffer = queue.buffer();\n-  if (buffer != nullptr) {\n-    size_t index = queue.index();\n-    queue.set_buffer(nullptr);\n-    queue.set_index(0);\n-    BufferNode* node = BufferNode::make_node_from_buffer(buffer, index);\n-    if (index == node->capacity()) {\n-      deallocate_buffer(node);\n-    } else {\n-      enqueue_completed_buffer(node);\n-    }\n-  }\n-}\n-\n-bool PtrQueueSet::try_enqueue(PtrQueue& queue, void* value) {\n-  size_t index = queue.index();\n-  if (index == 0) return false;\n-  void** buffer = queue.buffer();\n-  assert(buffer != nullptr, \"no buffer but non-zero index\");\n-  buffer[--index] = value;\n-  queue.set_index(index);\n-  return true;\n-}\n-\n-void PtrQueueSet::retry_enqueue(PtrQueue& queue, void* value) {\n-  assert(queue.index() != 0, \"precondition\");\n-  assert(queue.buffer() != nullptr, \"precondition\");\n-  size_t index = queue.index();\n-  queue.buffer()[--index] = value;\n-  queue.set_index(index);\n-}\n-\n-BufferNode* PtrQueueSet::exchange_buffer_with_new(PtrQueue& queue) {\n-  BufferNode* node = nullptr;\n-  void** buffer = queue.buffer();\n-  if (buffer != nullptr) {\n-    node = BufferNode::make_node_from_buffer(buffer, queue.index());\n-  }\n-  install_new_buffer(queue);\n-  return node;\n-}\n-\n-void PtrQueueSet::install_new_buffer(PtrQueue& queue) {\n-  BufferNode* node = _allocator->allocate();\n-  queue.set_buffer(BufferNode::make_buffer_from_node(node));\n-  queue.set_index(node->capacity());\n-}\n-\n-void** PtrQueueSet::allocate_buffer() {\n-  BufferNode* node = _allocator->allocate();\n-  return BufferNode::make_buffer_from_node(node);\n-}\n-\n-void PtrQueueSet::deallocate_buffer(BufferNode* node) {\n-  _allocator->release(node);\n-}\n","filename":"src\/hotspot\/share\/gc\/shared\/ptrQueue.cpp","additions":0,"deletions":111,"binary":false,"changes":111,"status":"deleted"},{"patch":"@@ -1,168 +0,0 @@\n-\/*\n- * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\n- *\/\n-\n-#ifndef SHARE_GC_SHARED_PTRQUEUE_HPP\n-#define SHARE_GC_SHARED_PTRQUEUE_HPP\n-\n-#include \"gc\/shared\/bufferNode.hpp\"\n-#include \"utilities\/align.hpp\"\n-#include \"utilities\/debug.hpp\"\n-#include \"utilities\/globalDefinitions.hpp\"\n-#include \"utilities\/sizes.hpp\"\n-\n-\/\/ There are various techniques that require threads to be able to log\n-\/\/ addresses.  For example, a generational write barrier might log\n-\/\/ the addresses of modified old-generation objects.  This type supports\n-\/\/ this operation.\n-\n-class PtrQueueSet;\n-class PtrQueue {\n-  friend class VMStructs;\n-\n-  NONCOPYABLE(PtrQueue);\n-\n-  \/\/ The (byte) index at which an object was last enqueued.  Starts at\n-  \/\/ capacity (in bytes) (indicating an empty buffer) and goes towards zero.\n-  \/\/ Value is always pointer-size aligned.\n-  size_t _index;\n-\n-  static const size_t _element_size = sizeof(void*);\n-\n-  static size_t byte_index_to_index(size_t ind) {\n-    assert(is_aligned(ind, _element_size), \"precondition\");\n-    return ind \/ _element_size;\n-  }\n-\n-  static size_t index_to_byte_index(size_t ind) {\n-    return ind * _element_size;\n-  }\n-\n-protected:\n-  \/\/ The buffer.\n-  void** _buf;\n-\n-  \/\/ Initialize this queue to contain a null buffer, and be part of the\n-  \/\/ given PtrQueueSet.\n-  PtrQueue(PtrQueueSet* qset);\n-\n-  \/\/ Requires queue flushed.\n-  ~PtrQueue();\n-\n-public:\n-\n-  void** buffer() const { return _buf; }\n-  void set_buffer(void** buffer) { _buf = buffer; }\n-\n-  size_t index() const {\n-    return byte_index_to_index(_index);\n-  }\n-\n-  void set_index(size_t new_index) {\n-    assert(new_index <= current_capacity(), \"precondition\");\n-    _index = index_to_byte_index(new_index);\n-  }\n-\n-  \/\/ Returns the capacity of the buffer, or 0 if the queue doesn't currently\n-  \/\/ have a buffer.\n-  size_t current_capacity() const;\n-\n-  bool is_empty() const { return index() == current_capacity(); }\n-  size_t size() const { return current_capacity() - index(); }\n-\n-protected:\n-  \/\/ To support compiler.\n-  template<typename Derived>\n-  static ByteSize byte_offset_of_index() {\n-    return byte_offset_of(Derived, _index);\n-  }\n-\n-  static constexpr ByteSize byte_width_of_index() { return in_ByteSize(sizeof(size_t)); }\n-\n-  template<typename Derived>\n-  static ByteSize byte_offset_of_buf() {\n-    return byte_offset_of(Derived, _buf);\n-  }\n-\n-  static ByteSize byte_width_of_buf() { return in_ByteSize(_element_size); }\n-};\n-\n-\/\/ A PtrQueueSet represents resources common to a set of pointer queues.\n-\/\/ In particular, the individual queues allocate buffers from this shared\n-\/\/ set, and return completed buffers to the set.\n-class PtrQueueSet {\n-  BufferNode::Allocator* _allocator;\n-\n-  NONCOPYABLE(PtrQueueSet);\n-\n-protected:\n-  \/\/ Create an empty ptr queue set.\n-  PtrQueueSet(BufferNode::Allocator* allocator);\n-  ~PtrQueueSet();\n-\n-  \/\/ Discard any buffered enqueued data.\n-  void reset_queue(PtrQueue& queue);\n-\n-  \/\/ If queue has any buffered enqueued data, transfer it to this qset.\n-  \/\/ Otherwise, deallocate queue's buffer.\n-  void flush_queue(PtrQueue& queue);\n-\n-  \/\/ Add value to queue's buffer, returning true.  If buffer is full\n-  \/\/ or if queue doesn't have a buffer, does nothing and returns false.\n-  bool try_enqueue(PtrQueue& queue, void* value);\n-\n-  \/\/ Add value to queue's buffer.  The queue must have a non-full buffer.\n-  \/\/ Used after an initial try_enqueue has failed and the situation resolved.\n-  void retry_enqueue(PtrQueue& queue, void* value);\n-\n-  \/\/ Installs a new buffer into queue.\n-  \/\/ Returns the old buffer, or null if queue didn't have a buffer.\n-  BufferNode* exchange_buffer_with_new(PtrQueue& queue);\n-\n-  \/\/ Installs a new buffer into queue.\n-  void install_new_buffer(PtrQueue& queue);\n-\n-public:\n-\n-  \/\/ Return the associated BufferNode allocator.\n-  BufferNode::Allocator* allocator() const { return _allocator; }\n-\n-  \/\/ Return the buffer for a BufferNode of size buffer_capacity().\n-  void** allocate_buffer();\n-\n-  \/\/ Return an empty buffer to the free list.  The node is required\n-  \/\/ to have been allocated with a size of buffer_capacity().\n-  void deallocate_buffer(BufferNode* node);\n-\n-  \/\/ A completed buffer is a buffer the mutator is finished with, and\n-  \/\/ is ready to be processed by the collector.  It need not be full.\n-\n-  \/\/ Adds node to the completed buffer list.\n-  virtual void enqueue_completed_buffer(BufferNode* node) = 0;\n-\n-  size_t buffer_capacity() const {\n-    return _allocator->buffer_capacity();\n-  }\n-};\n-\n-#endif \/\/ SHARE_GC_SHARED_PTRQUEUE_HPP\n","filename":"src\/hotspot\/share\/gc\/shared\/ptrQueue.hpp","additions":0,"deletions":168,"binary":false,"changes":168,"status":"deleted"},{"patch":"@@ -39,1 +39,2 @@\n-  PtrQueue(qset),\n+  _buf(nullptr),\n+  _index(0),\n@@ -46,1 +47,5 @@\n-{ }\n+{}\n+\n+SATBMarkQueue::~SATBMarkQueue() {\n+  assert(_buf == nullptr, \"queue must be flushed before delete\");\n+}\n@@ -67,1 +72,1 @@\n-  PtrQueueSet(allocator),\n+  _allocator(allocator),\n@@ -217,7 +222,0 @@\n-void SATBMarkQueueSet::flush_queue(SATBMarkQueue& queue) {\n-  \/\/ Filter now to possibly save work later.  If filtering empties the\n-  \/\/ buffer then flush_queue can deallocate the buffer.\n-  filter(queue);\n-  PtrQueueSet::flush_queue(queue);\n-}\n-\n@@ -358,0 +356,73 @@\n+\n+size_t SATBMarkQueue::current_capacity() const {\n+  if (_buf == nullptr) {\n+    return 0;\n+  } else {\n+    return BufferNode::make_node_from_buffer(_buf)->capacity();\n+  }\n+}\n+\n+void SATBMarkQueueSet::reset_queue(SATBMarkQueue& queue) {\n+  queue.set_index(queue.current_capacity());\n+}\n+\n+void SATBMarkQueueSet::flush_queue(SATBMarkQueue& queue) {\n+  \/\/ Filter now to possibly save work later.  If filtering empties the\n+  \/\/ buffer then flush_queue can deallocate the buffer.\n+  filter(queue);\n+  void** buffer = queue.buffer();\n+  if (buffer != nullptr) {\n+    size_t index = queue.index();\n+    queue.set_buffer(nullptr);\n+    queue.set_index(0);\n+    BufferNode* node = BufferNode::make_node_from_buffer(buffer, index);\n+    if (index == node->capacity()) {\n+      deallocate_buffer(node);\n+    } else {\n+      enqueue_completed_buffer(node);\n+    }\n+  }\n+}\n+\n+bool SATBMarkQueueSet::try_enqueue(SATBMarkQueue& queue, void* value) {\n+  size_t index = queue.index();\n+  if (index == 0) return false;\n+  void** buffer = queue.buffer();\n+  assert(buffer != nullptr, \"no buffer but non-zero index\");\n+  buffer[--index] = value;\n+  queue.set_index(index);\n+  return true;\n+}\n+\n+void SATBMarkQueueSet::retry_enqueue(SATBMarkQueue& queue, void* value) {\n+  assert(queue.index() != 0, \"precondition\");\n+  assert(queue.buffer() != nullptr, \"precondition\");\n+  size_t index = queue.index();\n+  queue.buffer()[--index] = value;\n+  queue.set_index(index);\n+}\n+\n+BufferNode* SATBMarkQueueSet::exchange_buffer_with_new(SATBMarkQueue& queue) {\n+  BufferNode* node = nullptr;\n+  void** buffer = queue.buffer();\n+  if (buffer != nullptr) {\n+    node = BufferNode::make_node_from_buffer(buffer, queue.index());\n+  }\n+  install_new_buffer(queue);\n+  return node;\n+}\n+\n+void SATBMarkQueueSet::install_new_buffer(SATBMarkQueue& queue) {\n+  BufferNode* node = _allocator->allocate();\n+  queue.set_buffer(BufferNode::make_buffer_from_node(node));\n+  queue.set_index(node->capacity());\n+}\n+\n+void** SATBMarkQueueSet::allocate_buffer() {\n+  BufferNode* node = _allocator->allocate();\n+  return BufferNode::make_buffer_from_node(node);\n+}\n+\n+void SATBMarkQueueSet::deallocate_buffer(BufferNode* node) {\n+  _allocator->release(node);\n+}\n","filename":"src\/hotspot\/share\/gc\/shared\/satbMarkQueue.cpp","additions":81,"deletions":10,"binary":false,"changes":91,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-#include \"gc\/shared\/ptrQueue.hpp\"\n+#include \"gc\/shared\/bufferNode.hpp\"\n@@ -33,0 +33,4 @@\n+#include \"utilities\/align.hpp\"\n+#include \"utilities\/debug.hpp\"\n+#include \"utilities\/globalDefinitions.hpp\"\n+#include \"utilities\/sizes.hpp\"\n@@ -48,2 +52,2 @@\n-\/\/ A PtrQueue whose elements are (possibly stale) pointers to object heads.\n-class SATBMarkQueue: public PtrQueue {\n+\/\/ A queue whose elements are (possibly stale) pointers to object heads.\n+class SATBMarkQueue {\n@@ -54,0 +58,21 @@\n+  NONCOPYABLE(SATBMarkQueue);\n+\n+  \/\/ The buffer.\n+  void** _buf;\n+\n+  \/\/ The (byte) index at which an object was last enqueued.  Starts at\n+  \/\/ capacity (in bytes) (indicating an empty buffer) and goes towards zero.\n+  \/\/ Value is always pointer-size aligned.\n+  size_t _index;\n+\n+  static const size_t _element_size = sizeof(void*);\n+\n+  static size_t byte_index_to_index(size_t ind) {\n+    assert(is_aligned(ind, _element_size), \"precondition\");\n+    return ind \/ _element_size;\n+  }\n+\n+  static size_t index_to_byte_index(size_t ind) {\n+    return ind * _element_size;\n+  }\n+\n@@ -61,0 +86,23 @@\n+  \/\/ Queue must be flushed\n+  ~SATBMarkQueue();\n+\n+  void** buffer() const { return _buf; }\n+\n+  void set_buffer(void** buffer) { _buf = buffer; }\n+\n+  size_t index() const {\n+    return byte_index_to_index(_index);\n+  }\n+\n+  void set_index(size_t new_index) {\n+    assert(new_index <= current_capacity(), \"precondition\");\n+    _index = index_to_byte_index(new_index);\n+  }\n+\n+  \/\/ Returns the capacity of the buffer, or 0 if the queue doesn't currently\n+  \/\/ have a buffer.\n+  size_t current_capacity() const;\n+\n+  bool is_empty() const { return index() == current_capacity(); }\n+  size_t size() const { return current_capacity() - index(); }\n+\n@@ -71,1 +119,1 @@\n-    return PtrQueue::byte_offset_of_index<SATBMarkQueue>();\n+    return byte_offset_of(SATBMarkQueue, _index);\n@@ -73,1 +121,2 @@\n-  using PtrQueue::byte_width_of_index;\n+\n+  static constexpr ByteSize byte_width_of_index() { return in_ByteSize(sizeof(size_t)); }\n@@ -76,1 +125,1 @@\n-    return PtrQueue::byte_offset_of_buf<SATBMarkQueue>();\n+    return byte_offset_of(SATBMarkQueue, _buf);\n@@ -78,1 +127,2 @@\n-  using PtrQueue::byte_width_of_buf;\n+\n+  static ByteSize byte_width_of_buf() { return in_ByteSize(_element_size); }\n@@ -87,1 +137,12 @@\n-class SATBMarkQueueSet: public PtrQueueSet {\n+\n+\/\/ A SATBMarkQueueSet represents resources common to a set of SATBMarkQueues.\n+\/\/ In particular, the individual queues allocate buffers from this shared\n+\/\/ set, and return completed buffers to the set.\n+\/\/ A completed buffer is a buffer the mutator is finished with, and\n+\/\/ is ready to be processed by the collector.  It need not be full.\n+\n+class SATBMarkQueueSet {\n+\n+  BufferNode::Allocator* _allocator;\n+\n+  NONCOPYABLE(SATBMarkQueueSet);\n@@ -102,0 +163,18 @@\n+  \/\/ Discard any buffered enqueued data.\n+  void reset_queue(SATBMarkQueue& queue);\n+\n+  \/\/ Add value to queue's buffer, returning true.  If buffer is full\n+  \/\/ or if queue doesn't have a buffer, does nothing and returns false.\n+  bool try_enqueue(SATBMarkQueue& queue, void* value);\n+\n+  \/\/ Add value to queue's buffer.  The queue must have a non-full buffer.\n+  \/\/ Used after an initial try_enqueue has failed and the situation resolved.\n+  void retry_enqueue(SATBMarkQueue& queue, void* value);\n+\n+  \/\/ Installs a new buffer into queue.\n+  \/\/ Returns the old buffer, or null if queue didn't have a buffer.\n+  BufferNode* exchange_buffer_with_new(SATBMarkQueue& queue);\n+\n+  \/\/ Installs a new buffer into queue.\n+  void install_new_buffer(SATBMarkQueue& queue);\n+\n@@ -109,0 +188,1 @@\n+\n@@ -134,0 +214,1 @@\n+\n@@ -147,1 +228,1 @@\n-  virtual void enqueue_completed_buffer(BufferNode* node);\n+  void enqueue_completed_buffer(BufferNode* node);\n@@ -160,0 +241,14 @@\n+  \/\/ Return the associated BufferNode allocator.\n+  BufferNode::Allocator* allocator() const { return _allocator; }\n+\n+  \/\/ Return the buffer for a BufferNode of size buffer_capacity().\n+  void** allocate_buffer();\n+\n+  \/\/ Return an empty buffer to the free list.  The node is required\n+  \/\/ to have been allocated with a size of buffer_capacity().\n+  void deallocate_buffer(BufferNode* node);\n+\n+  size_t buffer_capacity() const {\n+    return _allocator->buffer_capacity();\n+  }\n+\n","filename":"src\/hotspot\/share\/gc\/shared\/satbMarkQueue.hpp","additions":104,"deletions":9,"binary":false,"changes":113,"status":"modified"},{"patch":"@@ -39,1 +39,0 @@\n-#include \"runtime\/atomicAccess.hpp\"\n@@ -49,1 +48,1 @@\n-StringDedup::StorageUse* volatile StringDedup::Processor::_storage_for_requests = nullptr;\n+Atomic<StringDedup::StorageUse*> StringDedup::Processor::_storage_for_requests{};\n@@ -55,1 +54,1 @@\n-  assert(_storage_for_requests == nullptr, \"storage already created\");\n+  assert(_storage_for_requests.load_relaxed() == nullptr, \"storage already created\");\n@@ -59,1 +58,1 @@\n-  _storage_for_requests = new StorageUse(_storages[0]);\n+  _storage_for_requests.store_relaxed(new StorageUse(_storages[0]));\n@@ -78,1 +77,1 @@\n-    OopStorage* storage = AtomicAccess::load(&_storage_for_requests)->storage();\n+    OopStorage* storage = _storage_for_requests.load_relaxed()->storage();\n@@ -86,1 +85,1 @@\n-  _storage_for_processing = AtomicAccess::xchg(&_storage_for_requests, _storage_for_processing);\n+  _storage_for_processing = _storage_for_requests.exchange(_storage_for_processing);\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedupProcessor.cpp","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -54,1 +55,1 @@\n-  static StorageUse* volatile _storage_for_requests;\n+  static Atomic<StorageUse*> _storage_for_requests;\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedupProcessor.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -97,1 +97,2 @@\n-    \"%zu\/\" STRDEDUP_BYTES_FORMAT_NS \" (new), \"\n+    \"%zu (inspected), \"\n+    \"%zu\/\" STRDEDUP_BYTES_FORMAT_NS \" (new unknown), \"\n@@ -99,1 +100,2 @@\n-    \"avg \" STRDEDUP_PERCENT_FORMAT_NS \", \"\n+    \"total avg deduped\/new unknown bytes \" STRDEDUP_PERCENT_FORMAT_NS \", \"\n+    STRDEDUP_BYTES_FORMAT_NS \" (total deduped),\" STRDEDUP_BYTES_FORMAT_NS \" (total new unknown), \"\n@@ -101,0 +103,1 @@\n+    last_stat->_inspected,\n@@ -104,0 +107,1 @@\n+    STRDEDUP_BYTES_PARAM(total_stat->_deduped_bytes), STRDEDUP_BYTES_PARAM(total_stat->_new_bytes),\n@@ -213,4 +217,4 @@\n-  log_debug(stringdedup)(\"    Inspected:    %12zu\", _inspected);\n-  log_debug(stringdedup)(\"      Known:      %12zu(%5.1f%%)\", _known, known_percent);\n-  log_debug(stringdedup)(\"      Shared:     %12zu(%5.1f%%)\", _known_shared, known_shared_percent);\n-  log_debug(stringdedup)(\"      New:        %12zu(%5.1f%%)\" STRDEDUP_BYTES_FORMAT,\n+  log_debug(stringdedup)(\"    Inspected:     %12zu\", _inspected);\n+  log_debug(stringdedup)(\"      Known:       %12zu(%5.1f%%)\", _known, known_percent);\n+  log_debug(stringdedup)(\"      Shared:      %12zu(%5.1f%%)\", _known_shared, known_shared_percent);\n+  log_debug(stringdedup)(\"      New unknown: %12zu(%5.1f%%)\" STRDEDUP_BYTES_FORMAT,\n@@ -218,3 +222,3 @@\n-  log_debug(stringdedup)(\"      Replaced:   %12zu(%5.1f%%)\", _replaced, replaced_percent);\n-  log_debug(stringdedup)(\"      Deleted:    %12zu(%5.1f%%)\", _deleted, deleted_percent);\n-  log_debug(stringdedup)(\"    Deduplicated: %12zu(%5.1f%%)\" STRDEDUP_BYTES_FORMAT \"(%5.1f%%)\",\n+  log_debug(stringdedup)(\"      Replaced:    %12zu(%5.1f%%)\", _replaced, replaced_percent);\n+  log_debug(stringdedup)(\"      Deleted:     %12zu(%5.1f%%)\", _deleted, deleted_percent);\n+  log_debug(stringdedup)(\"    Deduplicated:  %12zu(%5.1f%%)\" STRDEDUP_BYTES_FORMAT \"(%5.1f%%)\",\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedupStat.cpp","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -26,1 +26,0 @@\n-#include \"runtime\/atomicAccess.hpp\"\n@@ -37,1 +36,1 @@\n-  return AtomicAccess::load_acquire(&_use_count) > 0;\n+  return _use_count.load_acquire() > 0;\n@@ -41,1 +40,1 @@\n-StringDedup::StorageUse::obtain(StorageUse* volatile* ptr) {\n+StringDedup::StorageUse::obtain(Atomic<StorageUse*>* ptr) {\n@@ -43,2 +42,2 @@\n-  StorageUse* storage = AtomicAccess::load(ptr);\n-  AtomicAccess::inc(&storage->_use_count);\n+  StorageUse* storage = ptr->load_relaxed();\n+  storage->_use_count.add_then_fetch(1u);\n@@ -49,2 +48,2 @@\n-  size_t result = AtomicAccess::sub(&_use_count, size_t(1));\n-  assert(result != SIZE_MAX, \"use count underflow\");\n+  size_t result = _use_count.fetch_then_sub(1u);\n+  assert(result != 0, \"use count underflow\");\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedupStorageUse.cpp","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -38,1 +39,1 @@\n-  volatile size_t _use_count;\n+  Atomic<size_t> _use_count;\n@@ -51,1 +52,1 @@\n-  static StorageUse* obtain(StorageUse* volatile* ptr);\n+  static StorageUse* obtain(Atomic<StorageUse*>* ptr);\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedupStorageUse.hpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-#include \"gc\/shenandoah\/shenandoahFreeSet.hpp\"\n@@ -237,1 +236,1 @@\n-  size_t available = _space_info->soft_available();\n+  size_t available = _space_info->soft_mutator_available();\n@@ -240,2 +239,3 @@\n-  log_debug(gc)(\"should_start_gc? available: %zu, soft_max_capacity: %zu\"\n-                \", allocated: %zu\", available, capacity, allocated);\n+  log_debug(gc, ergo)(\"should_start_gc calculation: available: \" PROPERFMT \", soft_max_capacity: \"  PROPERFMT \", \"\n+                \"allocated_since_gc_start: \"  PROPERFMT,\n+                PROPERFMTARGS(available), PROPERFMTARGS(capacity), PROPERFMTARGS(allocated));\n@@ -255,3 +255,2 @@\n-    log_trigger(\"Free (%zu%s) is below minimum threshold (%zu%s)\",\n-                 byte_size_in_proper_unit(available), proper_unit_for_byte_size(available),\n-                 byte_size_in_proper_unit(min_threshold), proper_unit_for_byte_size(min_threshold));\n+    log_trigger(\"Free (Soft) (\" PROPERFMT \") is below minimum threshold (\" PROPERFMT \")\",\n+                 PROPERFMTARGS(available), PROPERFMTARGS(min_threshold));\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahAdaptiveHeuristics.cpp","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-#include \"gc\/shenandoah\/shenandoahFreeSet.hpp\"\n@@ -50,1 +49,0 @@\n-  size_t max_capacity = _space_info->max_capacity();\n@@ -52,1 +50,2 @@\n-  size_t available = _space_info->available();\n+  size_t available = _space_info->soft_mutator_available();\n+  size_t bytes_allocated = _space_info->bytes_allocated_since_gc_start();\n@@ -54,3 +53,3 @@\n-  \/\/ Make sure the code below treats available without the soft tail.\n-  size_t soft_tail = max_capacity - capacity;\n-  available = (available > soft_tail) ? (available - soft_tail) : 0;\n+  log_debug(gc, ergo)(\"should_start_gc calculation: available: \" PROPERFMT \", soft_max_capacity: \"  PROPERFMT \", \"\n+                \"allocated_since_gc_start: \"  PROPERFMT,\n+                PROPERFMTARGS(available), PROPERFMTARGS(capacity), PROPERFMTARGS(bytes_allocated));\n@@ -62,1 +61,1 @@\n-    log_trigger(\"Free (%zu%s) is below minimum threshold (%zu%s)\",\n+    log_trigger(\"Free (Soft) (%zu%s) is below minimum threshold (%zu%s)\",\n@@ -69,1 +68,0 @@\n-  size_t bytes_allocated = _space_info->bytes_allocated_since_gc_start();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahCompactHeuristics.cpp","additions":6,"deletions":8,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -107,1 +107,1 @@\n-          \/\/ ShenandoahOldGarbageThreshold so it will be promoted in place, or because there is not sufficient room\n+          \/\/ old garbage threshold so it will be promoted in place, or because there is not sufficient room\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahGenerationalHeuristics.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -74,1 +74,2 @@\n-  _fragmentation_last_old_region(0)\n+  _fragmentation_last_old_region(0),\n+  _old_garbage_threshold(ShenandoahOldGarbageThreshold)\n@@ -337,1 +338,7 @@\n-    live_data += live_bytes;\n+    if (!region->was_promoted_in_place()) {\n+      \/\/ As currently implemented, region->get_live_data_bytes() represents bytes concurrently marked.\n+      \/\/ Expansion of the region by promotion during concurrent marking is above TAMS, and is not included\n+      \/\/ as live-data at [start of] old marking.\n+      live_data += live_bytes;\n+    }\n+    \/\/ else, regions that were promoted in place had 0 old live data at mark start\n@@ -376,1 +383,1 @@\n-  _old_generation->set_live_bytes_after_last_mark(live_data);\n+  _old_generation->set_live_bytes_at_last_mark(live_data);\n@@ -388,1 +395,1 @@\n-  const size_t garbage_threshold = region_size_bytes * ShenandoahOldGarbageThreshold \/ 100;\n+  const size_t garbage_threshold = region_size_bytes * get_old_garbage_threshold() \/ 100;\n@@ -658,0 +665,1 @@\n+    adjust_old_garbage_threshold();\n@@ -680,0 +688,1 @@\n+    adjust_old_garbage_threshold();\n@@ -702,1 +711,1 @@\n-      const size_t live_at_previous_old = _old_generation->get_live_bytes_after_last_mark();\n+      const size_t live_at_previous_old = _old_generation->get_live_bytes_at_last_mark();\n@@ -708,0 +717,1 @@\n+      adjust_old_garbage_threshold();\n@@ -716,1 +726,35 @@\n-  return this->ShenandoahHeuristics::should_start_gc();\n+  bool result = this->ShenandoahHeuristics::should_start_gc();\n+  if (result) {\n+    adjust_old_garbage_threshold();\n+  }\n+  return result;\n+}\n+\n+void ShenandoahOldHeuristics::adjust_old_garbage_threshold() {\n+  const uintx MinimumOldGarbageThreshold = 10;\n+  const uintx InterventionPercentage = 50;\n+\n+  const ShenandoahHeap* heap = ShenandoahHeap::heap();\n+  size_t old_regions_size = _old_generation->used_regions_size();\n+  size_t soft_max_size = heap->soft_max_capacity();\n+  uintx percent_used = (uintx) ((old_regions_size * 100) \/ soft_max_size);\n+  _old_garbage_threshold = ShenandoahOldGarbageThreshold;\n+  if (percent_used > InterventionPercentage) {\n+    uintx severity = percent_used - InterventionPercentage;    \/\/ ranges from 0 to 50\n+    if (MinimumOldGarbageThreshold < ShenandoahOldGarbageThreshold) {\n+      uintx adjustment_potential = ShenandoahOldGarbageThreshold - MinimumOldGarbageThreshold;\n+      \/\/ With default values:\n+      \/\/   if percent_used > 80, garbage_threshold is 10\n+      \/\/   else if percent_used > 65, garbage_threshold is 15\n+      \/\/   else if percent_used > 50, garbage_threshold is 20\n+      if (severity > 30) {\n+        _old_garbage_threshold = ShenandoahOldGarbageThreshold - adjustment_potential;\n+      } else if (severity > 15) {\n+        _old_garbage_threshold = ShenandoahOldGarbageThreshold - 2 * adjustment_potential \/ 3;\n+      } else {\n+        _old_garbage_threshold = ShenandoahOldGarbageThreshold - adjustment_potential \/ 3;\n+      }\n+      log_info(gc)(\"Adjusting old garbage threshold to %lu because Old Generation used regions represents %lu%% of heap\",\n+                   _old_garbage_threshold, percent_used);\n+    }\n+  }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.cpp","additions":50,"deletions":6,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -105,0 +105,11 @@\n+  \/\/ The value of command-line argument ShenandoahOldGarbageThreshold represents the percent of garbage that must\n+  \/\/ be present within an old-generation region before that region is considered a good candidate for inclusion in\n+  \/\/ the collection set under normal circumstances.  For our purposes, normal circustances are when the memory consumed\n+  \/\/ by the old generation is less than 50% of the soft heap capacity.  When the old generation grows beyond the 50%\n+  \/\/ threshold, we dynamically adjust the old garbage threshold, allowing us to invest in packing the old generation\n+  \/\/ more tightly so that more memory can be made available to the more frequent young GC cycles.  This variable\n+  \/\/ is used in place of ShenandoahOldGarbageThreshold.  Under normal circumstances, its value is equal to\n+  \/\/ ShenandoahOldGarbageThreshold.  When the GC is under duress, this value may be adjusted to a smaller value,\n+  \/\/ as scaled according to the severity of duress that we are experiencing.\n+  uintx _old_garbage_threshold;\n+\n@@ -203,0 +214,4 @@\n+  \/\/ Returns the current value of a dynamically adjusted threshold percentage of garbage above which an old region is\n+  \/\/ deemed eligible for evacuation.\n+  inline uintx get_old_garbage_threshold() { return _old_garbage_threshold; }\n+\n@@ -206,0 +221,15 @@\n+\n+  \/\/ The normal old_garbage_threshold is specified by ShenandoahOldGarbageThreshold command-line argument, with default\n+  \/\/ value 25, denoting that a region that has at least 25% garbage is eligible for evacuation.  With default values for\n+  \/\/ all command-line arguments, we make the following adjustments:\n+  \/\/  1. If the old generation has grown to consume more than 80% of the soft max capacity, adjust threshold to 10%\n+  \/\/  2. Otherwise, if the old generation has grown to consume more than 65%, adjust threshold to 15%\n+  \/\/  3. Otherwise, if the old generation has grown to consume more than 50%, adjust threshold to 20%\n+  \/\/ The effect is to compact the old generation more aggressively as the old generation consumes larger percentages\n+  \/\/ of the available heap memory.  In these circumstances, we pack the old generation more tightly in order to make\n+  \/\/ more memory avaiable to the young generation so that the more frequent young collections can operate more\n+  \/\/ efficiently.\n+  \/\/\n+  \/\/ If the ShenandoahOldGarbageThreshold is specified on the command line, the effect of adjusting the old garbage\n+  \/\/ threshold is scaled linearly.\n+  void adjust_old_garbage_threshold();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.hpp","additions":30,"deletions":0,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n-  virtual size_t soft_available() const = 0;\n+  virtual size_t soft_mutator_available() const = 0;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahSpaceInfo.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-#include \"gc\/shenandoah\/shenandoahFreeSet.hpp\"\n@@ -44,1 +43,0 @@\n-  size_t max_capacity = _space_info->max_capacity();\n@@ -46,1 +44,2 @@\n-  size_t available = _space_info->available();\n+  size_t available = _space_info->soft_mutator_available();\n+  size_t allocated = _space_info->bytes_allocated_since_gc_start();\n@@ -48,3 +47,3 @@\n-  \/\/ Make sure the code below treats available without the soft tail.\n-  size_t soft_tail = max_capacity - capacity;\n-  available = (available > soft_tail) ? (available - soft_tail) : 0;\n+  log_debug(gc, ergo)(\"should_start_gc calculation: available: \" PROPERFMT \", soft_max_capacity: \"  PROPERFMT \", \"\n+                \"allocated_since_gc_start: \"  PROPERFMT,\n+                PROPERFMTARGS(available), PROPERFMTARGS(capacity), PROPERFMTARGS(allocated));\n@@ -55,3 +54,2 @@\n-    log_trigger(\"Free (%zu%s) is below minimum threshold (%zu%s)\",\n-                 byte_size_in_proper_unit(available),           proper_unit_for_byte_size(available),\n-                 byte_size_in_proper_unit(threshold_available), proper_unit_for_byte_size(threshold_available));\n+    log_trigger(\"Free (Soft) (\" PROPERFMT \") is below minimum threshold (\" PROPERFMT \")\",\n+                 PROPERFMTARGS(available), PROPERFMTARGS(threshold_available));\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahStaticHeuristics.cpp","additions":7,"deletions":9,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -176,3 +176,3 @@\n-    static bool oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                      arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                      size_t length);\n+    static OopCopyResult oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                               arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                               size_t length);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -194,0 +194,14 @@\n+  if (_heap->is_in_young(field)) {\n+    \/\/ Young field stores do not require card mark.\n+    return;\n+  }\n+  T heap_oop = RawAccess<>::oop_load(field);\n+  if (CompressedOops::is_null(heap_oop)) {\n+    \/\/ Null reference store do not require card mark.\n+    return;\n+  }\n+  oop obj = CompressedOops::decode_not_null(heap_oop);\n+  if (!_heap->is_in_young(obj)) {\n+    \/\/ Not an old->young reference store.\n+    return;\n+  }\n@@ -371,3 +385,3 @@\n-bool ShenandoahBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                                                                         arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                                                                         size_t length) {\n+OopCopyResult ShenandoahBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                                                                                  arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                                                                                  size_t length) {\n@@ -379,1 +393,1 @@\n-  bool result = Raw::oop_arraycopy_in_heap(src_obj, src_offset_in_bytes, src_raw, dst_obj, dst_offset_in_bytes, dst_raw, length);\n+  OopCopyResult result = Raw::oop_arraycopy_in_heap(src_obj, src_offset_in_bytes, src_raw, dst_obj, dst_offset_in_bytes, dst_raw, length);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.inline.hpp","additions":18,"deletions":4,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2924,0 +2924,23 @@\n+void ShenandoahFreeSet::log_freeset_stats(ShenandoahFreeSetPartitionId partition_id, LogStream& ls) {\n+  size_t max = 0;\n+  size_t total_free = 0;\n+  size_t total_used = 0;\n+\n+  for (idx_t idx = _partitions.leftmost(partition_id);\n+        idx <= _partitions.rightmost(partition_id); idx++) {\n+    if (_partitions.in_free_set(partition_id, idx)) {\n+      ShenandoahHeapRegion *r = _heap->get_region(idx);\n+      size_t free = alloc_capacity(r);\n+      max = MAX2(max, free);\n+      total_free += free;\n+      total_used += r->used();\n+    }\n+  }\n+\n+  ls.print(\" %s freeset stats: Partition count: %zu, Reserved: \" PROPERFMT \", Max free available in a single region: \" PROPERFMT \";\",\n+            partition_name(partition_id),\n+            _partitions.count(partition_id),\n+            PROPERFMTARGS(total_free), PROPERFMTARGS(max)\n+          );\n+}\n+\n@@ -3043,5 +3066,3 @@\n-      ls.print(\"Free: %zu%s, Max: %zu%s regular, %zu%s humongous, \",\n-               byte_size_in_proper_unit(total_free),    proper_unit_for_byte_size(total_free),\n-               byte_size_in_proper_unit(max),           proper_unit_for_byte_size(max),\n-               byte_size_in_proper_unit(max_humongous), proper_unit_for_byte_size(max_humongous)\n-      );\n+      ls.print(\"Whole heap stats: Total free: \" PROPERFMT \", Total used: \" PROPERFMT \", Max free in a single region: \" PROPERFMT\n+               \", Max humongous: \" PROPERFMT \"; \",\n+               PROPERFMTARGS(total_free), PROPERFMTARGS(total_used), PROPERFMTARGS(max), PROPERFMTARGS(max_humongous));\n@@ -3049,1 +3070,1 @@\n-      ls.print(\"Frag: \");\n+      ls.print(\"Frag stats: \");\n@@ -3056,1 +3077,1 @@\n-      ls.print(\"%zu%% external, \", frag_ext);\n+      ls.print(\"External: %zu%%, \", frag_ext);\n@@ -3065,25 +3086,1 @@\n-      ls.print(\"%zu%% internal; \", frag_int);\n-      ls.print(\"Used: %zu%s, Mutator Free: %zu\",\n-               byte_size_in_proper_unit(total_used), proper_unit_for_byte_size(total_used),\n-               _partitions.count(ShenandoahFreeSetPartitionId::Mutator));\n-    }\n-\n-    {\n-      size_t max = 0;\n-      size_t total_free = 0;\n-      size_t total_used = 0;\n-\n-      for (idx_t idx = _partitions.leftmost(ShenandoahFreeSetPartitionId::Collector);\n-           idx <= _partitions.rightmost(ShenandoahFreeSetPartitionId::Collector); idx++) {\n-        if (_partitions.in_free_set(ShenandoahFreeSetPartitionId::Collector, idx)) {\n-          ShenandoahHeapRegion *r = _heap->get_region(idx);\n-          size_t free = alloc_capacity(r);\n-          max = MAX2(max, free);\n-          total_free += free;\n-          total_used += r->used();\n-        }\n-      }\n-      ls.print(\" Collector Reserve: %zu%s, Max: %zu%s; Used: %zu%s\",\n-               byte_size_in_proper_unit(total_free), proper_unit_for_byte_size(total_free),\n-               byte_size_in_proper_unit(max),        proper_unit_for_byte_size(max),\n-               byte_size_in_proper_unit(total_used), proper_unit_for_byte_size(total_used));\n+      ls.print(\"Internal: %zu%%; \", frag_int);\n@@ -3092,0 +3089,2 @@\n+    log_freeset_stats(ShenandoahFreeSetPartitionId::Mutator, ls);\n+    log_freeset_stats(ShenandoahFreeSetPartitionId::Collector, ls);\n@@ -3093,18 +3092,1 @@\n-      size_t max = 0;\n-      size_t total_free = 0;\n-      size_t total_used = 0;\n-\n-      for (idx_t idx = _partitions.leftmost(ShenandoahFreeSetPartitionId::OldCollector);\n-           idx <= _partitions.rightmost(ShenandoahFreeSetPartitionId::OldCollector); idx++) {\n-        if (_partitions.in_free_set(ShenandoahFreeSetPartitionId::OldCollector, idx)) {\n-          ShenandoahHeapRegion *r = _heap->get_region(idx);\n-          size_t free = alloc_capacity(r);\n-          max = MAX2(max, free);\n-          total_free += free;\n-          total_used += r->used();\n-        }\n-      }\n-      ls.print_cr(\" Old Collector Reserve: %zu%s, Max: %zu%s; Used: %zu%s\",\n-                  byte_size_in_proper_unit(total_free), proper_unit_for_byte_size(total_free),\n-                  byte_size_in_proper_unit(max),        proper_unit_for_byte_size(max),\n-                  byte_size_in_proper_unit(total_used), proper_unit_for_byte_size(total_used));\n+      log_freeset_stats(ShenandoahFreeSetPartitionId::OldCollector, ls);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFreeSet.cpp","additions":32,"deletions":50,"binary":false,"changes":82,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -632,0 +633,1 @@\n+  void log_freeset_stats(ShenandoahFreeSetPartitionId partition_id, LogStream& ls);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFreeSet.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -508,4 +508,4 @@\n-\/\/ Preselect for inclusion into the collection set regions whose age is at or above tenure age which contain more than\n-\/\/ ShenandoahOldGarbageThreshold amounts of garbage.  We identify these regions by setting the appropriate entry of\n-\/\/ the collection set's preselected regions array to true.  All entries are initialized to false before calling this\n-\/\/ function.\n+\/\/ Preselect for inclusion into the collection set all regions whose age is at or above tenure age and for which the\n+\/\/ garbage percentage exceeds a dynamically adjusted threshold (known as the old-garbage threshold percentage).  We\n+\/\/ identify these regions by setting the appropriate entry of the collection set's preselected regions array to true.\n+\/\/ All entries are initialized to false before calling this function.\n@@ -534,1 +534,2 @@\n-  const size_t old_garbage_threshold = (ShenandoahHeapRegion::region_size_bytes() * ShenandoahOldGarbageThreshold) \/ 100;\n+  const size_t old_garbage_threshold =\n+    (ShenandoahHeapRegion::region_size_bytes() * heap->old_generation()->heuristics()->get_old_garbage_threshold()) \/ 100;\n@@ -940,2 +941,2 @@\n-size_t ShenandoahGeneration::soft_available() const {\n-  size_t result = available(ShenandoahHeap::heap()->soft_max_capacity());\n+size_t ShenandoahGeneration::soft_mutator_available() const {\n+  size_t result = available(ShenandoahHeap::heap()->soft_max_capacity() * (100.0 - ShenandoahEvacReserve) \/ 100);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGeneration.cpp","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -74,1 +74,1 @@\n-  \/\/ Criterion 2. region garbage percentage > ShenandoahOldGarbageThreshold\n+  \/\/ Criterion 2. region garbage percentage > old garbage threshold\n@@ -129,1 +129,1 @@\n-  size_t soft_available() const override;\n+  size_t soft_mutator_available() const override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGeneration.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -148,1 +148,1 @@\n-      \/\/ more garbage than ShenandoahOldGarbageThreshold, we'll promote by evacuation.  If there is room for evacuation\n+      \/\/ more garbage than the old garbage threshold, we'll promote by evacuation.  If there is room for evacuation\n@@ -180,1 +180,2 @@\n-    const size_t old_garbage_threshold = (region_size_bytes * ShenandoahOldGarbageThreshold) \/ 100;\n+    const size_t old_garbage_threshold =\n+      (region_size_bytes * _heap->old_generation()->heuristics()->get_old_garbage_threshold()) \/ 100;\n@@ -225,1 +226,0 @@\n-\n@@ -253,0 +253,1 @@\n+    region->set_promoted_in_place();\n@@ -291,0 +292,1 @@\n+      r->set_promoted_in_place();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGenerationalEvacuationTask.cpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -86,1 +86,1 @@\n-  old->set_live_bytes_after_last_mark(old->used());\n+  old->set_live_bytes_at_last_mark(old->used());\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGenerationalFullGC.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -81,9 +81,0 @@\n-size_t ShenandoahGlobalGeneration::soft_available() const {\n-  size_t available = this->available();\n-\n-  \/\/ Make sure the code below treats available without the soft tail.\n-  assert(max_capacity() >= ShenandoahHeap::heap()->soft_max_capacity(), \"Max capacity must be greater than soft max capacity.\");\n-  size_t soft_tail = max_capacity() - ShenandoahHeap::heap()->soft_max_capacity();\n-  return (available > soft_tail) ? (available - soft_tail) : 0;\n-}\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGlobalGeneration.cpp","additions":0,"deletions":9,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -59,1 +59,0 @@\n-  size_t soft_available() const override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahGlobalGeneration.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -265,0 +265,1 @@\n+  bool _promoted_in_place;\n@@ -357,0 +358,9 @@\n+\n+  inline void set_promoted_in_place() {\n+    _promoted_in_place = true;\n+  }\n+\n+  \/\/ Returns true iff this region was promoted in place subsequent to the most recent start of concurrent old marking.\n+  inline bool was_promoted_in_place() {\n+    return _promoted_in_place;\n+  }\n@@ -382,0 +392,3 @@\n+\n+  \/\/ Represents the number of live bytes identified by most recent marking effort.  Does not include the bytes\n+  \/\/ above TAMS.\n@@ -383,0 +396,3 @@\n+\n+  \/\/ Represents the number of live words identified by most recent marking effort.  Does not include the words\n+  \/\/ above TAMS.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegion.hpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -155,0 +155,1 @@\n+  _promoted_in_place = false;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegion.inline.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -119,2 +119,1 @@\n-    _growth_before_compaction(INITIAL_GROWTH_BEFORE_COMPACTION),\n-    _min_growth_before_compaction ((ShenandoahMinOldGenGrowthPercent * FRACTIONAL_DENOMINATOR) \/ 100)\n+    _growth_percent_before_collection(INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION)\n@@ -123,1 +122,1 @@\n-  _live_bytes_after_last_mark = ShenandoahHeap::heap()->capacity() * INITIAL_LIVE_FRACTION \/ FRACTIONAL_DENOMINATOR;\n+  _live_bytes_at_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n@@ -224,2 +223,2 @@\n-size_t ShenandoahOldGeneration::get_live_bytes_after_last_mark() const {\n-  return _live_bytes_after_last_mark;\n+size_t ShenandoahOldGeneration::get_live_bytes_at_last_mark() const {\n+  return _live_bytes_at_last_mark;\n@@ -228,1 +227,1 @@\n-void ShenandoahOldGeneration::set_live_bytes_after_last_mark(size_t bytes) {\n+void ShenandoahOldGeneration::set_live_bytes_at_last_mark(size_t bytes) {\n@@ -231,2 +230,2 @@\n-    _live_bytes_after_last_mark = ShenandoahHeap::heap()->capacity() * INITIAL_LIVE_FRACTION \/ FRACTIONAL_DENOMINATOR;\n-    _growth_before_compaction = INITIAL_GROWTH_BEFORE_COMPACTION;\n+    _live_bytes_at_last_mark = (ShenandoahHeap::heap()->soft_max_capacity() * INITIAL_LIVE_PERCENT) \/ 100;\n+    _growth_percent_before_collection = INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION;\n@@ -234,4 +233,4 @@\n-    _live_bytes_after_last_mark = bytes;\n-    _growth_before_compaction \/= 2;\n-    if (_growth_before_compaction < _min_growth_before_compaction) {\n-      _growth_before_compaction = _min_growth_before_compaction;\n+    _live_bytes_at_last_mark = bytes;\n+    _growth_percent_before_collection \/= 2;\n+    if (_growth_percent_before_collection < ShenandoahMinOldGenGrowthPercent) {\n+      _growth_percent_before_collection = ShenandoahMinOldGenGrowthPercent;\n@@ -247,1 +246,13 @@\n-  size_t result = _live_bytes_after_last_mark + (_live_bytes_after_last_mark * _growth_before_compaction) \/ FRACTIONAL_DENOMINATOR;\n+  size_t threshold_by_relative_growth =\n+    _live_bytes_at_last_mark + (_live_bytes_at_last_mark * _growth_percent_before_collection) \/ 100;\n+  size_t soft_max_capacity = ShenandoahHeap::heap()->soft_max_capacity();\n+  size_t threshold_by_growth_into_percent_remaining;\n+  if (_live_bytes_at_last_mark < soft_max_capacity) {\n+    threshold_by_growth_into_percent_remaining = (size_t)\n+      (_live_bytes_at_last_mark + ((soft_max_capacity - _live_bytes_at_last_mark)\n+                                      * ShenandoahMinOldGenGrowthRemainingHeapPercent \/ 100.0));\n+  } else {\n+    \/\/ we're already consuming more than soft max capacity, so we should start old GC right away.\n+    threshold_by_growth_into_percent_remaining = soft_max_capacity;\n+  }\n+  size_t result = MIN2(threshold_by_relative_growth, threshold_by_growth_into_percent_remaining);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGeneration.cpp","additions":24,"deletions":13,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -290,2 +290,0 @@\n-  static const size_t FRACTIONAL_DENOMINATOR = 65536;\n-\n@@ -293,9 +291,7 @@\n-  \/\/ collection when old-gen usage is 50% more (INITIAL_GROWTH_BEFORE_COMPACTION) than the initial old-gen size\n-  \/\/ estimate (3.125% of heap).  The next old-gen trigger occurs when old-gen grows 25% larger than its live\n-  \/\/ memory at the end of the first old-gen collection.  Then we trigger again when old-gen grows 12.5%\n-  \/\/ more than its live memory at the end of the previous old-gen collection.  Thereafter, we trigger each time\n-  \/\/ old-gen grows more than 12.5% following the end of its previous old-gen collection.\n-  static const size_t INITIAL_GROWTH_BEFORE_COMPACTION = FRACTIONAL_DENOMINATOR \/ 2;        \/\/  50.0%\n-\n-  \/\/ INITIAL_LIVE_FRACTION represents the initial guess of how large old-gen should be.  We estimate that old-gen\n-  \/\/ needs to consume 6.25% of the total heap size.  And we \"pretend\" that we start out with this amount of live\n+  \/\/ collection when old-gen usage is 50% more (INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION) than the initial old-gen size\n+  \/\/ estimate (16% of heap).  With each successive old-gen collection, we divide the growth trigger by two, but\n+  \/\/ never use a growth trigger smaller than ShenandoahMinOldGenGrowthPercent.\n+  static const size_t INITIAL_GROWTH_PERCENT_BEFORE_COLLECTION = 50;\n+\n+  \/\/ INITIAL_LIVE_PERCENT represents the initial guess of how large old-gen should be.  We estimate that old gen\n+  \/\/ needs to consume 16% of the total heap size.  And we \"pretend\" that we start out with this amount of live\n@@ -303,3 +299,3 @@\n-  \/\/ approximation of the old-gen memory requirement, in other words when old-gen usage is 150% of 6.25%, which\n-  \/\/ is 9.375% of the total heap size.\n-  static const uint16_t INITIAL_LIVE_FRACTION = FRACTIONAL_DENOMINATOR \/ 16;                \/\/   6.25%\n+  \/\/ approximation of the old-gen memory requirement, in other words when old-gen usage is 150% of 16%, which\n+  \/\/ is 24% of the heap size.\n+  static const size_t INITIAL_LIVE_PERCENT = 16;\n@@ -307,1 +303,1 @@\n-  size_t _live_bytes_after_last_mark;\n+  size_t _live_bytes_at_last_mark;\n@@ -309,3 +305,2 @@\n-  \/\/ How much growth in usage before we trigger old collection, per FRACTIONAL_DENOMINATOR (65_536)\n-  size_t _growth_before_compaction;\n-  const size_t _min_growth_before_compaction;                                               \/\/ Default is 12.5%\n+  \/\/ How much growth in usage before we trigger old collection as a percent of soft_max_capacity\n+  size_t _growth_percent_before_collection;\n@@ -326,2 +321,2 @@\n-  size_t get_live_bytes_after_last_mark() const;\n-  void set_live_bytes_after_last_mark(size_t new_live);\n+  size_t get_live_bytes_at_last_mark() const;\n+  void set_live_bytes_at_last_mark(size_t new_live);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGeneration.hpp","additions":15,"deletions":20,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -141,2 +141,2 @@\n-size_t ShenandoahYoungGeneration::soft_available() const {\n-  size_t available = this->ShenandoahGeneration::soft_available();\n+size_t ShenandoahYoungGeneration::soft_mutator_available() const {\n+  size_t available = this->ShenandoahGeneration::soft_mutator_available();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahYoungGeneration.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -86,1 +86,1 @@\n-  size_t soft_available() const override;\n+  size_t soft_mutator_available() const override;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahYoungGeneration.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-  product(double, ShenandoahMinOldGenGrowthPercent, 12.5, EXPERIMENTAL,     \\\n+  product(double, ShenandoahMinOldGenGrowthPercent, 50, EXPERIMENTAL,       \\\n@@ -65,3 +65,2 @@\n-          \"at completion of the most recent old-generation marking \"        \\\n-          \"effort, heuristics may trigger the start of a new old-gen \"      \\\n-          \"collection.\")                                                    \\\n+          \"at the start of the previous old-generation marking effort, \"    \\\n+          \"heuristics may trigger the start of a new old-gen collection.\")  \\\n@@ -70,1 +69,16 @@\n-  product(uintx, ShenandoahIgnoreOldGrowthBelowPercentage,10, EXPERIMENTAL, \\\n+  product(double, ShenandoahMinOldGenGrowthRemainingHeapPercent,            \\\n+          35, EXPERIMENTAL,                                                 \\\n+          \"(Generational mode only) If the usage within old generation \"    \\\n+          \"has grown to exceed this percent of the remaining heap that \"    \\\n+          \"was not marked live within the old generation at the time \"      \\\n+          \"of the last old-generation marking effort, heuristics may \"      \\\n+          \"trigger the start of a new old-gen collection.  Setting \"        \\\n+          \"this value to a smaller value may cause back-to-back old \"       \\\n+          \"generation marking triggers, since the typical memory used \"     \\\n+          \"by the old generation is about 30% larger than the live \"        \\\n+          \"memory contained within the old generation (because default \"    \\\n+          \"value of ShenandoahOldGarbageThreshold is 25.\")                  \\\n+          range(0.0,100.0)                                                  \\\n+                                                                            \\\n+  product(uintx, ShenandoahIgnoreOldGrowthBelowPercentage,                  \\\n+          40, EXPERIMENTAL,                                                 \\\n@@ -80,6 +94,7 @@\n-          50, EXPERIMENTAL,                                                 \\\n-          \"(Generational mode only) Even if the usage of old generation \"   \\\n-          \"is below ShenandoahIgnoreOldGrowthBelowPercentage, \"             \\\n-          \"trigger an old-generation mark if old has grown and this \"       \\\n-          \"many consecutive young-gen collections have been \"               \\\n-          \"completed following the preceding old-gen collection.\")          \\\n+          100, EXPERIMENTAL,                                                \\\n+          \"(Generational mode only) Trigger an old-generation mark \"        \\\n+          \"if old has grown and this many consecutive young-gen \"           \\\n+          \"collections have been completed following the preceding \"        \\\n+          \"old-gen collection.  We perform this old-generation mark \"       \\\n+          \"evvort even if the usage of old generation is below \"            \\\n+          \"ShenandoahIgnoreOldGrowthBelowPercentage.\")                      \\\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoah_globals.hpp","additions":26,"deletions":11,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -91,0 +91,1 @@\n+    [[noreturn]]\n@@ -101,2 +102,2 @@\n-    static bool oop_copy_one_check_cast(zpointer* dst, zpointer* src, Klass* dst_klass);\n-    static void oop_copy_one(zpointer* dst, zpointer* src);\n+    static OopCopyResult oop_copy_one_check_cast(zpointer* dst, zpointer* src, Klass* dst_klass);\n+    static OopCopyResult oop_copy_one(zpointer* dst, zpointer* src);\n@@ -104,2 +105,2 @@\n-    static bool oop_arraycopy_in_heap_check_cast(zpointer* dst, zpointer* src, size_t length, Klass* dst_klass);\n-    static bool oop_arraycopy_in_heap_no_check_cast(zpointer* dst, zpointer* src, size_t length);\n+    static OopCopyResult oop_arraycopy_in_heap_check_cast(zpointer* dst, zpointer* src, size_t length, Klass* dst_klass);\n+    static OopCopyResult oop_arraycopy_in_heap_no_check_cast(zpointer* dst, zpointer* src, size_t length);\n@@ -137,6 +138,6 @@\n-    static bool oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, zpointer* src_raw,\n-                                      arrayOop dst_obj, size_t dst_offset_in_bytes, zpointer* dst_raw,\n-                                      size_t length);\n-    static bool oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, oop* src_raw,\n-                                      arrayOop dst_obj, size_t dst_offset_in_bytes, oop* dst_raw,\n-                                      size_t length) {\n+    static OopCopyResult oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, zpointer* src_raw,\n+                                               arrayOop dst_obj, size_t dst_offset_in_bytes, zpointer* dst_raw,\n+                                               size_t length);\n+    static OopCopyResult oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, oop* src_raw,\n+                                               arrayOop dst_obj, size_t dst_offset_in_bytes, oop* dst_raw,\n+                                               size_t length) {\n@@ -147,3 +148,3 @@\n-    static bool oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, narrowOop* src_raw,\n-                                      arrayOop dst_obj, size_t dst_offset_in_bytes, narrowOop* dst_raw,\n-                                      size_t length) { unsupported(); return false; }\n+    static OopCopyResult oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, narrowOop* src_raw,\n+                                               arrayOop dst_obj, size_t dst_offset_in_bytes, narrowOop* dst_raw,\n+                                               size_t length) { unsupported(); }\n","filename":"src\/hotspot\/share\/gc\/z\/zBarrierSet.hpp","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -331,1 +331,1 @@\n-inline void ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_copy_one(zpointer* dst, zpointer* src) {\n+inline OopCopyResult ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_copy_one(zpointer* dst, zpointer* src) {\n@@ -334,0 +334,2 @@\n+  \/\/ Future location for null-restriction check and failure reporting\n+\n@@ -335,0 +337,2 @@\n+\n+  return OopCopyResult::ok;\n@@ -338,1 +342,1 @@\n-inline bool ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_copy_one_check_cast(zpointer* dst, zpointer* src, Klass* dst_klass) {\n+inline OopCopyResult ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_copy_one_check_cast(zpointer* dst, zpointer* src, Klass* dst_klass) {\n@@ -343,1 +347,1 @@\n-    return false;\n+    return OopCopyResult::failed_check_class_cast;\n@@ -348,1 +352,1 @@\n-  return true;\n+  return OopCopyResult::ok;\n@@ -352,1 +356,1 @@\n-inline bool ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap_check_cast(zpointer* dst, zpointer* src, size_t length, Klass* dst_klass) {\n+inline OopCopyResult ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap_check_cast(zpointer* dst, zpointer* src, size_t length, Klass* dst_klass) {\n@@ -355,3 +359,3 @@\n-    if (!oop_copy_one_check_cast(dst, src, dst_klass)) {\n-      \/\/ Check cast failed\n-      return false;\n+    const OopCopyResult result = oop_copy_one_check_cast(dst, src, dst_klass);\n+    if (result != OopCopyResult::ok) {\n+      return result;\n@@ -361,1 +365,1 @@\n-  return true;\n+  return OopCopyResult::ok;\n@@ -365,1 +369,1 @@\n-inline bool ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap_no_check_cast(zpointer* dst, zpointer* src, size_t length) {\n+inline OopCopyResult ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap_no_check_cast(zpointer* dst, zpointer* src, size_t length) {\n@@ -370,1 +374,4 @@\n-      oop_copy_one(dst, src);\n+      const OopCopyResult result = oop_copy_one(dst, src);\n+      if (result != OopCopyResult::ok) {\n+        return result;\n+      }\n@@ -372,1 +379,2 @@\n-    return true;\n+\n+    return OopCopyResult::ok;\n@@ -380,1 +388,4 @@\n-      oop_copy_one(dst, src);\n+      const OopCopyResult result = oop_copy_one(dst, src);\n+      if (result != OopCopyResult::ok) {\n+        return result;\n+      }\n@@ -382,1 +393,2 @@\n-    return true;\n+\n+    return OopCopyResult::ok;\n@@ -386,1 +398,1 @@\n-  return true;\n+  return OopCopyResult::ok;\n@@ -390,3 +402,3 @@\n-inline bool ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, zpointer* src_raw,\n-                                                                                       arrayOop dst_obj, size_t dst_offset_in_bytes, zpointer* dst_raw,\n-                                                                                       size_t length) {\n+inline OopCopyResult ZBarrierSet::AccessBarrier<decorators, BarrierSetT>::oop_arraycopy_in_heap(arrayOop src_obj, size_t src_offset_in_bytes, zpointer* src_raw,\n+                                                                                                arrayOop dst_obj, size_t dst_offset_in_bytes, zpointer* dst_raw,\n+                                                                                                size_t length) {\n@@ -399,0 +411,2 @@\n+  } else {\n+    return oop_arraycopy_in_heap_no_check_cast(dst, src, length);\n@@ -400,2 +414,0 @@\n-\n-  return oop_arraycopy_in_heap_no_check_cast(dst, src, length);\n","filename":"src\/hotspot\/share\/gc\/z\/zBarrierSet.inline.hpp","additions":32,"deletions":20,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -50,4 +50,4 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrCheckFlightRecordingDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrDumpFlightRecordingDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrStartFlightRecordingDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrStopFlightRecordingDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrCheckFlightRecordingDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrDumpFlightRecordingDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrStartFlightRecordingDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrStopFlightRecordingDCmd>(full_export));\n@@ -55,3 +55,3 @@\n-  \/\/ DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrQueryFlightRecordingDCmd>(full_export, true, true));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrViewFlightRecordingDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrConfigureFlightRecorderDCmd>(full_export, true, false));\n+  \/\/ DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrQueryFlightRecordingDCmd>(full_export, \/*hidden=*\/true));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrViewFlightRecordingDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JfrConfigureFlightRecorderDCmd>(full_export));\n","filename":"src\/hotspot\/share\/jfr\/dcmd\/jfrDcmds.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -124,6 +124,0 @@\n-  if (_use_dfs) {\n-    assert(_current_parent != nullptr, \"invariant\");\n-    DFSClosure::find_leaks_from_edge(_edge_store, _mark_bits, _current_parent);\n-    return;\n-  }\n-\n@@ -131,0 +125,7 @@\n+\n+    if (_use_dfs) {\n+      assert(_current_parent != nullptr, \"invariant\");\n+      DFSClosure::find_leaks_from_edge(_edge_store, _mark_bits, _current_parent);\n+      return;\n+    }\n+\n","filename":"src\/hotspot\/share\/jfr\/leakprofiler\/chains\/bfsClosure.cpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -1292,2 +1292,2 @@\n-    <Field type=\"ulong\" name=\"newStrings\" label=\"New Strings\" \/>\n-    <Field type=\"ulong\" name=\"newSize\" contentType=\"bytes\" label=\"New Size\" \/>\n+    <Field type=\"ulong\" name=\"newStrings\" label=\"New Strings\" description=\"New unknown strings\" \/>\n+    <Field type=\"ulong\" name=\"newSize\" contentType=\"bytes\" label=\"New Size\" description=\"Size of new unknown strings\" \/>\n","filename":"src\/hotspot\/share\/jfr\/metadata\/metadata.xml","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -49,1 +49,1 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<LogDiagnosticCommand>(full_visibility, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<LogDiagnosticCommand>(full_visibility));\n","filename":"src\/hotspot\/share\/logging\/logDiagnosticCommand.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -131,3 +131,3 @@\n-  static inline bool oop_arraycopy(arrayOop src_obj, size_t src_offset_in_bytes, const T* src_raw,\n-                                   arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                   size_t length) {\n+  static inline OopCopyResult oop_arraycopy(arrayOop src_obj, size_t src_offset_in_bytes, const T* src_raw,\n+                                            arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                            size_t length) {\n@@ -319,3 +319,4 @@\n-  static inline bool oop_arraycopy(arrayOop src_obj, size_t src_offset_in_bytes,\n-                                   arrayOop dst_obj, size_t dst_offset_in_bytes,\n-                                   size_t length) {\n+  [[nodiscard]] \/\/ The caller is responsible to throw an exception on failure\n+  static inline OopCopyResult oop_arraycopy(arrayOop src_obj, size_t src_offset_in_bytes,\n+                                            arrayOop dst_obj, size_t dst_offset_in_bytes,\n+                                            size_t length) {\n@@ -328,4 +329,8 @@\n-  static inline bool oop_arraycopy_raw(T* src, T* dst, size_t length) {\n-    return AccessT::oop_arraycopy(nullptr, 0, src,\n-                                  nullptr, 0, dst,\n-                                  length);\n+  static inline void oop_arraycopy_raw(T* src, T* dst, size_t length) {\n+    static_assert((decorators & ARRAYCOPY_CHECKCAST) == 0);\n+\n+    OopCopyResult result = AccessT::oop_arraycopy(nullptr, 0, src,\n+                                                  nullptr, 0, dst,\n+                                                  length);\n+\n+    assert(result == OopCopyResult::ok, \"Should never fail\");\n","filename":"src\/hotspot\/share\/oops\/access.hpp","additions":15,"deletions":10,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -128,3 +128,3 @@\n-    static bool access_barrier(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                               arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                               size_t length) {\n+    static OopCopyResult access_barrier(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                        arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                        size_t length) {\n@@ -134,1 +134,1 @@\n-      return true;\n+      return OopCopyResult::ok;\n@@ -138,3 +138,3 @@\n-    static bool oop_access_barrier(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                   arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                   size_t length) {\n+    static OopCopyResult oop_access_barrier(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                            arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                            size_t length) {\n@@ -334,3 +334,3 @@\n-  bool RuntimeDispatch<decorators, T, BARRIER_ARRAYCOPY>::arraycopy_init(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                                                         arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                                                         size_t length) {\n+  OopCopyResult RuntimeDispatch<decorators, T, BARRIER_ARRAYCOPY>::arraycopy_init(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                                                                  arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                                                                  size_t length) {\n","filename":"src\/hotspot\/share\/oops\/access.inline.hpp","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -38,0 +38,7 @@\n+\/\/ Result from oop_arraycopy\n+enum class OopCopyResult {\n+  ok,                      \/\/ oop array copy sucessful\n+  failed_check_class_cast, \/\/ oop array copy failed subtype check (ARRAYCOPY_CHECKCAST)\n+  failed_check_null        \/\/ oop array copy failed null check (ARRAYCOPY_NOTNULL)\n+};\n+\n@@ -95,3 +102,3 @@\n-    typedef bool (*arraycopy_func_t)(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                     arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                     size_t length);\n+    typedef OopCopyResult (*arraycopy_func_t)(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                              arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                              size_t length);\n@@ -103,3 +110,3 @@\n-    typedef bool (*arraycopy_func_t)(arrayOop src_obj, size_t src_offset_in_bytes, void* src,\n-                                     arrayOop dst_obj, size_t dst_offset_in_bytes, void* dst,\n-                                     size_t length);\n+    typedef OopCopyResult (*arraycopy_func_t)(arrayOop src_obj, size_t src_offset_in_bytes, void* src,\n+                                              arrayOop dst_obj, size_t dst_offset_in_bytes, void* dst,\n+                                              size_t length);\n@@ -508,3 +515,3 @@\n-    static bool arraycopy_init(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                               arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                               size_t length);\n+    static OopCopyResult arraycopy_init(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                        arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                        size_t length);\n@@ -512,3 +519,3 @@\n-    static inline bool arraycopy(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                 arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                 size_t length) {\n+    static inline OopCopyResult arraycopy(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                          arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                          size_t length) {\n@@ -823,1 +830,1 @@\n-      HasDecorator<decorators, AS_RAW>::value && CanHardwireRaw<decorators>::value, bool>::type\n+      HasDecorator<decorators, AS_RAW>::value && CanHardwireRaw<decorators>::value, OopCopyResult>::type\n@@ -829,3 +836,3 @@\n-        return Raw::oop_arraycopy(src_obj, src_offset_in_bytes, src_raw,\n-                                  dst_obj, dst_offset_in_bytes, dst_raw,\n-                                  length);\n+        Raw::oop_arraycopy(src_obj, src_offset_in_bytes, src_raw,\n+                           dst_obj, dst_offset_in_bytes, dst_raw,\n+                           length);\n@@ -833,3 +840,3 @@\n-        return Raw::arraycopy(src_obj, src_offset_in_bytes, src_raw,\n-                              dst_obj, dst_offset_in_bytes, dst_raw,\n-                              length);\n+        Raw::arraycopy(src_obj, src_offset_in_bytes, src_raw,\n+                       dst_obj, dst_offset_in_bytes, dst_raw,\n+                       length);\n@@ -837,0 +844,2 @@\n+\n+      return OopCopyResult::ok;\n@@ -841,1 +850,1 @@\n-      HasDecorator<decorators, AS_RAW>::value && !CanHardwireRaw<decorators>::value, bool>::type\n+      HasDecorator<decorators, AS_RAW>::value && !CanHardwireRaw<decorators>::value, OopCopyResult>::type\n@@ -860,1 +869,1 @@\n-      !HasDecorator<decorators, AS_RAW>::value, bool>::type\n+      !HasDecorator<decorators, AS_RAW>::value, OopCopyResult>::type\n@@ -1004,3 +1013,3 @@\n-  inline bool arraycopy_reduce_types(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n-                                     arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                                     size_t length) {\n+  inline OopCopyResult arraycopy_reduce_types(arrayOop src_obj, size_t src_offset_in_bytes, T* src_raw,\n+                                              arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                              size_t length) {\n@@ -1013,3 +1022,3 @@\n-  inline bool arraycopy_reduce_types(arrayOop src_obj, size_t src_offset_in_bytes, HeapWord* src_raw,\n-                                     arrayOop dst_obj, size_t dst_offset_in_bytes, HeapWord* dst_raw,\n-                                     size_t length) {\n+  inline OopCopyResult arraycopy_reduce_types(arrayOop src_obj, size_t src_offset_in_bytes, HeapWord* src_raw,\n+                                              arrayOop dst_obj, size_t dst_offset_in_bytes, HeapWord* dst_raw,\n+                                              size_t length) {\n@@ -1023,3 +1032,3 @@\n-  inline bool arraycopy_reduce_types(arrayOop src_obj, size_t src_offset_in_bytes, narrowOop* src_raw,\n-                                     arrayOop dst_obj, size_t dst_offset_in_bytes, narrowOop* dst_raw,\n-                                     size_t length) {\n+  inline OopCopyResult arraycopy_reduce_types(arrayOop src_obj, size_t src_offset_in_bytes, narrowOop* src_raw,\n+                                              arrayOop dst_obj, size_t dst_offset_in_bytes, narrowOop* dst_raw,\n+                                              size_t length) {\n@@ -1163,3 +1172,3 @@\n-  inline bool arraycopy(arrayOop src_obj, size_t src_offset_in_bytes, const T* src_raw,\n-                        arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n-                        size_t length) {\n+  inline OopCopyResult arraycopy(arrayOop src_obj, size_t src_offset_in_bytes, const T* src_raw,\n+                                 arrayOop dst_obj, size_t dst_offset_in_bytes, T* dst_raw,\n+                                 size_t length) {\n","filename":"src\/hotspot\/share\/oops\/accessBackend.hpp","additions":42,"deletions":33,"binary":false,"changes":75,"status":"modified"},{"patch":"@@ -54,1 +54,1 @@\n-  DEBUG_ONLY(bool is_array_klass_slow() const { return true; })\n+  DEBUG_ONLY(bool is_array_klass_slow() const override { return true; })\n@@ -57,2 +57,2 @@\n-  ArrayKlass* array_klass(int n, TRAPS);\n-  ArrayKlass* array_klass_or_null(int n);\n+  ArrayKlass* array_klass(int n, TRAPS) override;\n+  ArrayKlass* array_klass_or_null(int n) override;\n@@ -61,2 +61,2 @@\n-  ArrayKlass* array_klass(TRAPS);\n-  ArrayKlass* array_klass_or_null();\n+  ArrayKlass* array_klass(TRAPS) override;\n+  ArrayKlass* array_klass_or_null() override;\n@@ -82,1 +82,1 @@\n-  virtual InstanceKlass* java_super() const;\n+  InstanceKlass* java_super() const override;\n@@ -90,1 +90,1 @@\n-  Klass* find_field(Symbol* name, Symbol* sig, fieldDescriptor* fd) const;\n+  Klass* find_field(Symbol* name, Symbol* sig, fieldDescriptor* fd) const override;\n@@ -96,1 +96,1 @@\n-                                 PrivateLookupMode private_mode = PrivateLookupMode::find) const;\n+                                 PrivateLookupMode private_mode = PrivateLookupMode::find) const override;\n@@ -108,1 +108,1 @@\n-                                                  Array<InstanceKlass*>* transitive_interfaces);\n+                                                  Array<InstanceKlass*>* transitive_interfaces) override;\n@@ -113,1 +113,1 @@\n-  virtual void metaspace_pointers_do(MetaspaceClosure* iter);\n+  void metaspace_pointers_do(MetaspaceClosure* iter) override;\n@@ -119,1 +119,1 @@\n-  jint jvmti_class_status() const;\n+  jint jvmti_class_status() const override;\n@@ -123,2 +123,2 @@\n-  virtual void remove_unshareable_info();\n-  virtual void remove_java_mirror();\n+  void remove_unshareable_info() override;\n+  void remove_java_mirror() override;\n@@ -131,2 +131,2 @@\n-  void print_on(outputStream* st) const;\n-  void print_value_on(outputStream* st) const;\n+  void print_on(outputStream* st) const override;\n+  void print_value_on(outputStream* st) const override;\n@@ -134,1 +134,1 @@\n-  void oop_print_on(oop obj, outputStream* st);\n+  void oop_print_on(oop obj, outputStream* st) override;\n@@ -137,1 +137,1 @@\n-  void verify_on(outputStream* st);\n+  void verify_on(outputStream* st) override;\n@@ -139,1 +139,1 @@\n-  void oop_verify_on(oop obj, outputStream* st);\n+  void oop_verify_on(oop obj, outputStream* st) override;\n","filename":"src\/hotspot\/share\/oops\/arrayKlass.hpp","additions":18,"deletions":18,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -315,1 +315,0 @@\n-      const char* msg = ss.as_string(true \/* on C-heap *\/);\n@@ -317,1 +316,1 @@\n-      SystemDictionary::add_nest_host_error(cph, _nest_host_index, msg);\n+      SystemDictionary::add_nest_host_error(cph, _nest_host_index, ss);\n@@ -320,1 +319,1 @@\n-      log_trace(class, nestmates)(\"%s\", msg);\n+      log_trace(class, nestmates)(\"%s\", ss.base());\n@@ -359,1 +358,0 @@\n-        const char* msg = ss.as_string(true \/* on C-heap *\/);\n@@ -361,2 +359,2 @@\n-        SystemDictionary::add_nest_host_error(cph, _nest_host_index, msg);\n-        log_trace(class, nestmates)(\"%s\", msg);\n+        SystemDictionary::add_nest_host_error(cph, _nest_host_index, ss);\n+        log_trace(class, nestmates)(\"%s\", ss.base());\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -316,2 +316,2 @@\n-  bool is_interface() const             { return _access_flags.is_interface(); }\n-  bool is_abstract() const              { return _access_flags.is_abstract(); }\n+  bool is_interface() const override    { return _access_flags.is_interface(); }\n+  bool is_abstract() const override     { return _access_flags.is_abstract(); }\n@@ -497,2 +497,2 @@\n-  PackageEntry* package() const     { return _package_entry; }\n-  ModuleEntry* module() const;\n+  PackageEntry* package() const override { return _package_entry; }\n+  ModuleEntry* module() const override;\n@@ -555,1 +555,1 @@\n-  bool should_be_initialized() const;  \/\/ means that initialize should be called\n+  bool should_be_initialized() const override;  \/\/ means that initialize should be called\n@@ -558,2 +558,2 @@\n-  void initialize(TRAPS);\n-  void initialize_preemptable(TRAPS);\n+  void initialize(TRAPS) override;\n+  void initialize_preemptable(TRAPS) override;\n@@ -581,1 +581,1 @@\n-  Klass* find_field(Symbol* name, Symbol* sig, fieldDescriptor* fd) const;\n+  Klass* find_field(Symbol* name, Symbol* sig, fieldDescriptor* fd) const override;\n@@ -640,1 +640,1 @@\n-                                 PrivateLookupMode private_mode = PrivateLookupMode::find) const;\n+                                 PrivateLookupMode private_mode = PrivateLookupMode::find) const override;\n@@ -663,1 +663,1 @@\n-  oop protection_domain() const;\n+  oop protection_domain() const override;\n@@ -837,1 +837,1 @@\n-  virtual void check_valid_for_instantiation(bool throwError, TRAPS);\n+  void check_valid_for_instantiation(bool throwError, TRAPS) override;\n@@ -904,3 +904,3 @@\n-                                                  Array<InstanceKlass*>* transitive_interfaces);\n-  bool can_be_primary_super_slow() const;\n-  size_t oop_size(oop obj)  const             { return size_helper(); }\n+                                                  Array<InstanceKlass*>* transitive_interfaces) override;\n+  bool can_be_primary_super_slow() const override;\n+  size_t oop_size(oop obj) const override { return size_helper(); }\n@@ -909,1 +909,1 @@\n-  DEBUG_ONLY(bool is_instance_klass_slow() const      { return true; })\n+  DEBUG_ONLY(bool is_instance_klass_slow() const override { return true; })\n@@ -935,1 +935,1 @@\n-  virtual InstanceKlass* java_super() const {\n+  InstanceKlass* java_super() const override {\n@@ -952,4 +952,4 @@\n-  int size() const                    { return size(vtable_length(),\n-                                               itable_length(),\n-                                               nonstatic_oop_map_size(),\n-                                               is_interface());\n+  int size() const override           { return size(vtable_length(),\n+                                                    itable_length(),\n+                                                    nonstatic_oop_map_size(),\n+                                                    is_interface());\n@@ -1011,1 +1011,1 @@\n-  virtual bool on_stack() const;\n+  bool on_stack() const override;\n@@ -1016,1 +1016,1 @@\n-  virtual void release_C_heap_structures(bool release_sub_metadata = true);\n+  void release_C_heap_structures(bool release_sub_metadata = true) override;\n@@ -1019,1 +1019,1 @@\n-  const char* signature_name() const;\n+  const char* signature_name() const override;\n@@ -1098,2 +1098,2 @@\n-  virtual ArrayKlass* array_klass(int n, TRAPS);\n-  virtual ArrayKlass* array_klass_or_null(int n);\n+  ArrayKlass* array_klass(int n, TRAPS) override;\n+  ArrayKlass* array_klass_or_null(int n) override;\n@@ -1102,2 +1102,2 @@\n-  virtual ArrayKlass* array_klass(TRAPS);\n-  virtual ArrayKlass* array_klass_or_null();\n+  ArrayKlass* array_klass(TRAPS) override;\n+  ArrayKlass* array_klass_or_null() override;\n@@ -1142,1 +1142,1 @@\n-  virtual void remove_unshareable_info();\n+  void remove_unshareable_info() override;\n@@ -1144,1 +1144,1 @@\n-  virtual void remove_java_mirror();\n+  void remove_java_mirror() override;\n@@ -1157,1 +1157,1 @@\n-  u2 compute_modifier_flags() const;\n+  u2 compute_modifier_flags() const override;\n@@ -1161,1 +1161,1 @@\n-  jint jvmti_class_status() const;\n+  jint jvmti_class_status() const override;\n@@ -1163,1 +1163,1 @@\n-  virtual void metaspace_pointers_do(MetaspaceClosure* iter);\n+  void metaspace_pointers_do(MetaspaceClosure* iter) override;\n@@ -1167,2 +1167,2 @@\n-  void print_on(outputStream* st) const;\n-  void print_value_on(outputStream* st) const;\n+  void print_on(outputStream* st) const override;\n+  void print_value_on(outputStream* st) const override;\n@@ -1170,1 +1170,1 @@\n-  void oop_print_value_on(oop obj, outputStream* st);\n+  void oop_print_value_on(oop obj, outputStream* st) override;\n@@ -1172,1 +1172,1 @@\n-  void oop_print_on      (oop obj, outputStream* st);\n+  void oop_print_on      (oop obj, outputStream* st) override;\n@@ -1180,1 +1180,1 @@\n-  const char* internal_name() const;\n+  const char* internal_name() const override;\n@@ -1183,1 +1183,1 @@\n-  void verify_on(outputStream* st);\n+  void verify_on(outputStream* st) override;\n@@ -1185,1 +1185,1 @@\n-  void oop_verify_on(oop obj, outputStream* st);\n+  void oop_verify_on(oop obj, outputStream* st) override;\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.hpp","additions":39,"deletions":39,"binary":false,"changes":78,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-  virtual size_t oop_size(oop obj) const;\n+  size_t oop_size(oop obj) const override;\n","filename":"src\/hotspot\/share\/oops\/instanceMirrorKlass.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -129,1 +129,1 @@\n-  void oop_verify_on(oop obj, outputStream* st);\n+  void oop_verify_on(oop obj, outputStream* st) override;\n","filename":"src\/hotspot\/share\/oops\/instanceRefKlass.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -218,1 +218,1 @@\n-  virtual bool is_klass() const { return true; }\n+  bool is_klass() const override { return true; }\n@@ -652,3 +652,0 @@\n-  \/\/ Size of klass in word size.\n-  virtual int size() const = 0;\n-\n@@ -731,2 +728,2 @@\n-  virtual void metaspace_pointers_do(MetaspaceClosure* iter);\n-  virtual MetaspaceObj::Type type() const { return ClassType; }\n+  void metaspace_pointers_do(MetaspaceClosure* iter) override;\n+  MetaspaceObj::Type type() const override { return ClassType; }\n@@ -767,1 +764,1 @@\n-  virtual void print_on(outputStream* st) const;\n+  void print_on(outputStream* st) const override;\n@@ -774,2 +771,0 @@\n-  virtual const char* internal_name() const = 0;\n-\n","filename":"src\/hotspot\/share\/oops\/klass.hpp","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -188,0 +188,18 @@\n+static void throw_array_store_exception(arrayOop src, arrayOop dst, TRAPS) {\n+  ResourceMark rm(THREAD);\n+  Klass* bound = ObjArrayKlass::cast(dst->klass())->element_klass();\n+  Klass* stype = ObjArrayKlass::cast(src->klass())->element_klass();\n+  stringStream ss;\n+  if (!bound->is_subtype_of(stype)) {\n+    ss.print(\"arraycopy: type mismatch: can not copy %s[] into %s[]\",\n+             stype->external_name(), bound->external_name());\n+  } else {\n+    \/\/ oop_arraycopy should return the index in the source array that\n+    \/\/ contains the problematic oop.\n+    ss.print(\"arraycopy: element type mismatch: can not cast one of the elements\"\n+             \" of %s[] to the type of the destination array, %s\",\n+             stype->external_name(), bound->external_name());\n+  }\n+  THROW_MSG(vmSymbols::java_lang_ArrayStoreException(), ss.as_string());\n+}\n+\n@@ -194,1 +212,2 @@\n-    ArrayAccess<>::oop_arraycopy(s, src_offset, d, dst_offset, length);\n+    OopCopyResult result = ArrayAccess<>::oop_arraycopy(s, src_offset, d, dst_offset, length);\n+    assert(result == OopCopyResult::ok, \"Should never fail\");\n@@ -199,20 +218,9 @@\n-    if (stype == bound || stype->is_subtype_of(bound)) {\n-      \/\/ elements are guaranteed to be subtypes, so no check necessary\n-      ArrayAccess<ARRAYCOPY_DISJOINT>::oop_arraycopy(s, src_offset, d, dst_offset, length);\n-    } else {\n-      \/\/ slow case: need individual subtype checks\n-      \/\/ note: don't use obj_at_put below because it includes a redundant store check\n-      if (!ArrayAccess<ARRAYCOPY_DISJOINT | ARRAYCOPY_CHECKCAST>::oop_arraycopy(s, src_offset, d, dst_offset, length)) {\n-        ResourceMark rm(THREAD);\n-        stringStream ss;\n-        if (!bound->is_subtype_of(stype)) {\n-          ss.print(\"arraycopy: type mismatch: can not copy %s[] into %s[]\",\n-                   stype->external_name(), bound->external_name());\n-        } else {\n-          \/\/ oop_arraycopy should return the index in the source array that\n-          \/\/ contains the problematic oop.\n-          ss.print(\"arraycopy: element type mismatch: can not cast one of the elements\"\n-                   \" of %s[] to the type of the destination array, %s\",\n-                   stype->external_name(), bound->external_name());\n-        }\n-        THROW_MSG(vmSymbols::java_lang_ArrayStoreException(), ss.as_string());\n+    bool type_check = stype != bound && !stype->is_subtype_of(bound);\n+\n+    auto arraycopy = [&] {\n+      if (type_check) {\n+        return ArrayAccess<ARRAYCOPY_DISJOINT | ARRAYCOPY_CHECKCAST>::\n+            oop_arraycopy(s, src_offset, d, dst_offset, length);\n+      } else {\n+        return ArrayAccess<ARRAYCOPY_DISJOINT>::\n+            oop_arraycopy(s, src_offset, d, dst_offset, length);\n@@ -220,0 +228,13 @@\n+    };\n+\n+    OopCopyResult result = arraycopy();\n+\n+    switch (result) {\n+    case OopCopyResult::ok:\n+      \/\/ Done\n+      break;\n+    case OopCopyResult::failed_check_class_cast:\n+      throw_array_store_exception(s, d, JavaThread::current());\n+      break;\n+    default:\n+      ShouldNotReachHere();\n","filename":"src\/hotspot\/share\/oops\/objArrayKlass.cpp","additions":42,"deletions":21,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -75,2 +75,2 @@\n-  ModuleEntry* module() const;\n-  PackageEntry* package() const;\n+  ModuleEntry* module() const override;\n+  PackageEntry* package() const override;\n@@ -79,1 +79,1 @@\n-  bool can_be_primary_super_slow() const;\n+  bool can_be_primary_super_slow() const override;\n@@ -81,3 +81,3 @@\n-                                                  Array<InstanceKlass*>* transitive_interfaces);\n-  DEBUG_ONLY(bool is_objArray_klass_slow()  const  { return true; })\n-  size_t oop_size(oop obj) const;\n+                                                  Array<InstanceKlass*>* transitive_interfaces) override;\n+  DEBUG_ONLY(bool is_objArray_klass_slow() const override { return true; })\n+  size_t oop_size(oop obj) const override;\n@@ -89,1 +89,1 @@\n-  oop multi_allocate(int rank, jint* sizes, TRAPS);\n+  oop multi_allocate(int rank, jint* sizes, TRAPS) override;\n@@ -92,1 +92,1 @@\n-  void  copy_array(arrayOop s, int src_pos, arrayOop d, int dst_pos, int length, TRAPS);\n+  void copy_array(arrayOop s, int src_pos, arrayOop d, int dst_pos, int length, TRAPS) override;\n@@ -95,1 +95,1 @@\n-  oop protection_domain() const { return bottom_klass()->protection_domain(); }\n+  oop protection_domain() const override { return bottom_klass()->protection_domain(); }\n@@ -97,1 +97,1 @@\n-  virtual void metaspace_pointers_do(MetaspaceClosure* iter);\n+  virtual void metaspace_pointers_do(MetaspaceClosure* iter) override;\n@@ -117,1 +117,1 @@\n-  int size() const                        { return ArrayKlass::static_size(header_size()); }\n+  int size() const override               { return ArrayKlass::static_size(header_size()); }\n@@ -120,1 +120,1 @@\n-  void initialize(TRAPS);\n+  void initialize(TRAPS) override;\n@@ -153,1 +153,1 @@\n-  u2 compute_modifier_flags() const;\n+  u2 compute_modifier_flags() const override;\n@@ -157,2 +157,2 @@\n-  void print_on(outputStream* st) const;\n-  void print_value_on(outputStream* st) const;\n+  void print_on(outputStream* st) const override;\n+  void print_value_on(outputStream* st) const override;\n@@ -160,1 +160,1 @@\n-  void oop_print_value_on(oop obj, outputStream* st);\n+  void oop_print_value_on(oop obj, outputStream* st) override;\n@@ -162,1 +162,1 @@\n-  void oop_print_on      (oop obj, outputStream* st);\n+  void oop_print_on      (oop obj, outputStream* st) override;\n@@ -165,1 +165,1 @@\n-  const char* internal_name() const;\n+  const char* internal_name() const override;\n@@ -168,1 +168,1 @@\n-  void verify_on(outputStream* st);\n+  void verify_on(outputStream* st) override;\n@@ -170,1 +170,1 @@\n-  void oop_verify_on(oop obj, outputStream* st);\n+  void oop_verify_on(oop obj, outputStream* st) override;\n","filename":"src\/hotspot\/share\/oops\/objArrayKlass.hpp","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -59,1 +59,1 @@\n-  u2 compute_modifier_flags() const;\n+  u2 compute_modifier_flags() const override;\n@@ -62,1 +62,1 @@\n-  DEBUG_ONLY(bool is_typeArray_klass_slow() const  { return true; })\n+  DEBUG_ONLY(bool is_typeArray_klass_slow() const override { return true; })\n@@ -71,1 +71,1 @@\n-  size_t oop_size(oop obj) const;\n+  size_t oop_size(oop obj) const override;\n@@ -74,1 +74,1 @@\n-  oop multi_allocate(int rank, jint* sizes, TRAPS);\n+  oop multi_allocate(int rank, jint* sizes, TRAPS) override;\n@@ -76,1 +76,1 @@\n-  oop protection_domain() const { return nullptr; }\n+  oop protection_domain() const override { return nullptr; }\n@@ -79,1 +79,1 @@\n-  void  copy_array(arrayOop s, int src_pos, arrayOop d, int dst_pos, int length, TRAPS);\n+  void  copy_array(arrayOop s, int src_pos, arrayOop d, int dst_pos, int length, TRAPS) override;\n@@ -116,1 +116,1 @@\n-  int size() const          { return ArrayKlass::static_size(header_size()); }\n+  int size() const override { return ArrayKlass::static_size(header_size()); }\n@@ -119,1 +119,1 @@\n-  void initialize(TRAPS);\n+  void initialize(TRAPS) override;\n@@ -123,1 +123,1 @@\n-  void oop_print_on(oop obj, outputStream* st);\n+  void oop_print_on(oop obj, outputStream* st) override;\n@@ -125,2 +125,2 @@\n-  void print_on(outputStream* st) const;\n-  void print_value_on(outputStream* st) const;\n+  void print_on(outputStream* st) const override;\n+  void print_value_on(outputStream* st) const override;\n@@ -129,1 +129,1 @@\n-  const char* internal_name() const;\n+  const char* internal_name() const override;\n@@ -131,2 +131,2 @@\n-  ModuleEntry* module() const;\n-  PackageEntry* package() const;\n+  ModuleEntry* module() const override;\n+  PackageEntry* package() const override;\n","filename":"src\/hotspot\/share\/oops\/typeArrayKlass.hpp","additions":14,"deletions":14,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+#include \"opto\/rangeinference.hpp\"\n@@ -35,1 +36,0 @@\n-#include \"opto\/utilities\/xor.hpp\"\n@@ -1014,29 +1014,2 @@\n-const Type *OrINode::add_ring( const Type *t0, const Type *t1 ) const {\n-  const TypeInt *r0 = t0->is_int(); \/\/ Handy access\n-  const TypeInt *r1 = t1->is_int();\n-\n-  \/\/ If both args are bool, can figure out better types\n-  if ( r0 == TypeInt::BOOL ) {\n-    if ( r1 == TypeInt::ONE) {\n-      return TypeInt::ONE;\n-    } else if ( r1 == TypeInt::BOOL ) {\n-      return TypeInt::BOOL;\n-    }\n-  } else if ( r0 == TypeInt::ONE ) {\n-    if ( r1 == TypeInt::BOOL ) {\n-      return TypeInt::ONE;\n-    }\n-  }\n-\n-  \/\/ If either input is all ones, the output is all ones.\n-  \/\/ x | ~0 == ~0 <==> x | -1 == -1\n-  if (r0 == TypeInt::MINUS_1 || r1 == TypeInt::MINUS_1) {\n-    return TypeInt::MINUS_1;\n-  }\n-\n-  \/\/ If either input is not a constant, just return all integers.\n-  if( !r0->is_con() || !r1->is_con() )\n-    return TypeInt::INT;        \/\/ Any integer, but still no symbols.\n-\n-  \/\/ Otherwise just OR them bits.\n-  return TypeInt::make( r0->get_con() | r1->get_con() );\n+const Type* OrINode::add_ring(const Type* t1, const Type* t2) const {\n+  return RangeInference::infer_or(t1->is_int(), t2->is_int());\n@@ -1090,16 +1063,2 @@\n-const Type *OrLNode::add_ring( const Type *t0, const Type *t1 ) const {\n-  const TypeLong *r0 = t0->is_long(); \/\/ Handy access\n-  const TypeLong *r1 = t1->is_long();\n-\n-  \/\/ If either input is all ones, the output is all ones.\n-  \/\/ x | ~0 == ~0 <==> x | -1 == -1\n-  if (r0 == TypeLong::MINUS_1 || r1 == TypeLong::MINUS_1) {\n-    return TypeLong::MINUS_1;\n-  }\n-\n-  \/\/ If either input is not a constant, just return all integers.\n-  if( !r0->is_con() || !r1->is_con() )\n-    return TypeLong::LONG;      \/\/ Any integer, but still no symbols.\n-\n-  \/\/ Otherwise just OR them bits.\n-  return TypeLong::make( r0->get_con() | r1->get_con() );\n+const Type* OrLNode::add_ring(const Type* t1, const Type* t2) const {\n+  return RangeInference::infer_or(t1->is_long(), t2->is_long());\n@@ -1192,18 +1151,2 @@\n-const Type *XorINode::add_ring( const Type *t0, const Type *t1 ) const {\n-  const TypeInt *r0 = t0->is_int(); \/\/ Handy access\n-  const TypeInt *r1 = t1->is_int();\n-\n-  if (r0->is_con() && r1->is_con()) {\n-    \/\/ compute constant result\n-    return TypeInt::make(r0->get_con() ^ r1->get_con());\n-  }\n-\n-  \/\/ At least one of the arguments is not constant\n-\n-  if (r0->_lo >= 0 && r1->_lo >= 0) {\n-      \/\/ Combine [r0->_lo, r0->_hi] ^ [r0->_lo, r1->_hi] -> [0, upper_bound]\n-      jint upper_bound = xor_upper_bound_for_ranges<jint, juint>(r0->_hi, r1->_hi);\n-      return TypeInt::make(0, upper_bound, MAX2(r0->_widen, r1->_widen));\n-  }\n-\n-  return TypeInt::INT;\n+const Type* XorINode::add_ring(const Type* t1, const Type* t2) const {\n+  return RangeInference::infer_xor(t1->is_int(), t2->is_int());\n@@ -1214,18 +1157,2 @@\n-const Type *XorLNode::add_ring( const Type *t0, const Type *t1 ) const {\n-  const TypeLong *r0 = t0->is_long(); \/\/ Handy access\n-  const TypeLong *r1 = t1->is_long();\n-\n-  if (r0->is_con() && r1->is_con()) {\n-    \/\/ compute constant result\n-    return TypeLong::make(r0->get_con() ^ r1->get_con());\n-  }\n-\n-  \/\/ At least one of the arguments is not constant\n-\n-  if (r0->_lo >= 0 && r1->_lo >= 0) {\n-      \/\/ Combine [r0->_lo, r0->_hi] ^ [r0->_lo, r1->_hi] -> [0, upper_bound]\n-      julong upper_bound = xor_upper_bound_for_ranges<jlong, julong>(r0->_hi, r1->_hi);\n-      return TypeLong::make(0, upper_bound, MAX2(r0->_widen, r1->_widen));\n-  }\n-\n-  return TypeLong::LONG;\n+const Type* XorLNode::add_ring(const Type* t1, const Type* t2) const {\n+  return RangeInference::infer_xor(t1->is_long(), t2->is_long());\n@@ -1404,0 +1331,4 @@\n+  Node* n = AddNode::Ideal(phase, can_reshape);\n+  if (n != nullptr) {\n+    return n;\n+  }\n","filename":"src\/hotspot\/share\/opto\/addnode.cpp","additions":13,"deletions":82,"binary":false,"changes":95,"status":"modified"},{"patch":"@@ -249,0 +249,7 @@\n+\n+#ifdef ASSERT\n+  bool address_input_has_same_base() const {\n+    Node *addp = in(Address);\n+    return !addp->is_AddP() || addp->in(Base)->is_top() || addp->in(Base) == in(Base);\n+  }\n+#endif\n","filename":"src\/hotspot\/share\/opto\/addnode.hpp","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -700,1 +700,2 @@\n-          \"Verify Iterative Global Value Numbering =DCBA, with:\"            \\\n+          \"Verify Iterative Global Value Numbering =EDCBA, with:\"           \\\n+          \"  E: verify node specific invariants\"                            \\\n","filename":"src\/hotspot\/share\/opto\/c2_globals.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -946,3 +946,2 @@\n-  CallLeafPureNode(const TypeFunc* tf, address addr, const char* name,\n-                   const TypePtr* adr_type)\n-      : CallLeafNode(tf, addr, name, adr_type) {\n+  CallLeafPureNode(const TypeFunc* tf, address addr, const char* name)\n+      : CallLeafNode(tf, addr, name, nullptr) {\n","filename":"src\/hotspot\/share\/opto\/callnode.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -316,2 +316,1 @@\n-\n-bool CastLLNode::is_inner_loop_backedge(ProjNode* proj) {\n+bool CastLLNode::is_inner_loop_backedge(IfProjNode* proj) {\n@@ -336,2 +335,2 @@\n-          ProjNode* true_proj = iff->as_If()->proj_out_or_null(true);\n-          ProjNode* false_proj = iff->as_If()->proj_out_or_null(false);\n+          IfTrueNode* true_proj = iff->as_If()->true_proj_or_null();\n+          IfFalseNode* false_proj = iff->as_If()->false_proj_or_null();\n","filename":"src\/hotspot\/share\/opto\/castnode.cpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -242,1 +242,1 @@\n-  static bool is_inner_loop_backedge(ProjNode* proj);\n+  static bool is_inner_loop_backedge(IfProjNode* proj);\n","filename":"src\/hotspot\/share\/opto\/castnode.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -936,2 +936,2 @@\n-  ProjNode* proj1 = region->in(idx1)->isa_Proj();\n-  ProjNode* proj2 = region->in(idx2)->isa_Proj();\n+  IfProjNode* proj1 = region->in(idx1)->isa_IfProj();\n+  IfProjNode* proj2 = region->in(idx2)->isa_IfProj();\n@@ -1354,0 +1354,19 @@\n+  \/\/ In rare cases, during an IGVN call to `PhiNode::Value`, `_type` and `t` have incompatible opinion on speculative type,\n+  \/\/ resulting into a too small intersection (such as AnyNull), which is removed in cleanup_speculative.\n+  \/\/ From that `ft` has no speculative type (ft->speculative() == nullptr).\n+  \/\/ After the end of the current `PhiNode::Value` call, `ft` (that is returned) is being store into `_type`\n+  \/\/ (see PhaseIterGVN::transform_old -> raise_bottom_type -> set_type).\n+  \/\/\n+  \/\/ It is possible that verification happens immediately after, without any change to the current node, or any of its inputs.\n+  \/\/ In the verification invocation of `PhiNode::Value`, `t` would be the same as the IGVN `t` (union of input types, that are unchanged),\n+  \/\/ but the new `_type` is the value returned by the IGVN invocation of `PhiNode::Value`, the former `ft`, that has no speculative type.\n+  \/\/ Thus, the result of `t->filter_speculative(_type)`, the new `ft`, gets the speculative type of `t`, which is not empty. Since the\n+  \/\/ result of the verification invocation of `PhiNode::Value` has some speculative type, it is not the same as the previously returned type\n+  \/\/ (that had no speculative type), making verification fail.\n+  \/\/\n+  \/\/ In such a case, doing the filtering one time more allows to reach a fixpoint.\n+  if (ft->speculative() == nullptr && t->speculative() != nullptr) {\n+    ft = t->filter_speculative(ft);\n+  }\n+  verify_type_stability(phase, t, ft);\n+\n@@ -1359,0 +1378,45 @@\n+#ifdef ASSERT\n+\/\/ Makes sure that a newly computed type is stable when filtered against the incoming types.\n+\/\/ Otherwise, we may have IGVN verification failures. See PhiNode::Value, and the second\n+\/\/ filtering (enforcing stability), for details.\n+void PhiNode::verify_type_stability(const PhaseGVN* const phase, const Type* const union_of_input_types, const Type* const new_type) const {\n+  const Type* doubly_filtered_type = union_of_input_types->filter_speculative(new_type);\n+  if (Type::equals(new_type, doubly_filtered_type)) {\n+    return;\n+  }\n+\n+  stringStream ss;\n+\n+  ss.print_cr(\"At node:\");\n+  this->dump(\"\\n\", false, &ss);\n+\n+  const Node* region = in(Region);\n+  for (uint i = 1; i < req(); ++i) {\n+    ss.print(\"in(%d): \", i);\n+    if (region->in(i) != nullptr && phase->type(region->in(i)) == Type::CONTROL) {\n+      const Type* ti = phase->type(in(i));\n+      ti->dump_on(&ss);\n+    }\n+    ss.print_cr(\"\");\n+  }\n+\n+  ss.print(\"t: \");\n+  union_of_input_types->dump_on(&ss);\n+  ss.print_cr(\"\");\n+\n+  ss.print(\"_type: \");\n+  _type->dump_on(&ss);\n+  ss.print_cr(\"\");\n+\n+  ss.print(\"Filter once: \");\n+  new_type->dump_on(&ss);\n+  ss.print_cr(\"\");\n+  ss.print(\"Filter twice: \");\n+  doubly_filtered_type->dump_on(&ss);\n+  ss.print_cr(\"\");\n+  tty->print(\"%s\", ss.base());\n+  tty->flush();\n+  assert(false, \"computed type would not pass verification\");\n+}\n+#endif\n+\n@@ -1486,12 +1550,3 @@\n-      if (u->is_Phi() && u->as_Phi()->type() == Type::MEMORY &&\n-          u->adr_type() == TypePtr::BOTTOM && u->in(0) == phi_reg &&\n-          u->req() == phi_len) {\n-        for (uint j = 1; j < phi_len; j++) {\n-          if (in(j) != u->in(j)) {\n-            u = nullptr;\n-            break;\n-          }\n-        }\n-        if (u != nullptr) {\n-          return u;\n-        }\n+      assert(!u->is_Phi() || u->in(0) == phi_reg, \"broken Phi\/Region subgraph\");\n+      if (u->is_Phi() && u->req() == phi_len && can_be_replaced_by(u->as_Phi())) {\n+        return u;\n@@ -2099,0 +2154,14 @@\n+\/\/ Is one of the inputs a Cast that has not been processed by igvn yet?\n+bool PhiNode::wait_for_cast_input_igvn(const PhaseIterGVN* igvn) const {\n+  for (uint i = 1, cnt = req(); i < cnt; ++i) {\n+    Node* n = in(i);\n+    while (n != nullptr && n->is_ConstraintCast()) {\n+      if (igvn->_worklist.member(n)) {\n+        return true;\n+      }\n+      n = n->in(1);\n+    }\n+  }\n+  return false;\n+}\n+\n@@ -2157,0 +2226,22 @@\n+    \/\/ If one of the inputs is a cast that has yet to be processed by igvn, delay processing of this node to give the\n+    \/\/ inputs a chance to optimize and possibly end up with identical inputs (casts included).\n+    \/\/ Say we have:\n+    \/\/ (Phi region (Cast#1 c uin) (Cast#2 c uin))\n+    \/\/ and Cast#1 and Cast#2 have not had a chance to common yet\n+    \/\/ if the unique_input() transformation below proceeds, then PhiNode::Ideal returns:\n+    \/\/ (Cast#3 region uin) (1)\n+    \/\/ If PhiNode::Ideal is delayed until Cast#1 and Cast#2 common, then it returns:\n+    \/\/ (Cast#1 c uin) (2)\n+    \/\/\n+    \/\/ In (1) the resulting cast is conservatively pinned at a later control and while Cast#3 and Cast#1\/Cast#2 still\n+    \/\/ have a chance to common, that requires proving that c dominates region in ConstraintCastNode::dominating_cast()\n+    \/\/ which may not happen if control flow is too complicated and another pass of loop opts doesn't run. Delaying the\n+    \/\/ transformation here should allow a more optimal result.\n+    \/\/ Beyond the efficiency concern, there is a risk, if the casts are CastPPs, to end up with a chain of AddPs with\n+    \/\/ different base inputs (but a unique uncasted base input). This breaks an invariant in the shape of address\n+    \/\/ subtrees.\n+    PhaseIterGVN* igvn = phase->is_IterGVN();\n+    if (wait_for_cast_input_igvn(igvn)) {\n+      igvn->_worklist.push(this);\n+      return nullptr;\n+    }\n@@ -2554,1 +2645,1 @@\n-              phi->set_req(i, mms.memory2());\n+              phi->set_req_X(i, mms.memory2(), phase);\n@@ -2563,1 +2654,3 @@\n-              if (phi->in(i) == this)  phi->set_req(i, phi);\n+              if (phi->in(i) == this) {\n+                phi->set_req_X(i, phi, phase);\n+              }\n@@ -2585,1 +2678,1 @@\n-        set_req(i, new_in);\n+        set_req_X(i, new_in, phase);\n@@ -2693,0 +2786,19 @@\n+  \/\/ PhiNode::Identity replaces a non-bottom memory phi with a bottom memory phi with the same inputs, if it exists.\n+  \/\/ If the bottom memory phi's inputs are changed (so it can now replace the non-bottom memory phi) or if it's created\n+  \/\/ only after the non-bottom memory phi is processed by igvn, PhiNode::Identity doesn't run and the transformation\n+  \/\/ doesn't happen.\n+  \/\/ Look for non-bottom Phis that should be transformed and enqueue them for igvn so that PhiNode::Identity executes for\n+  \/\/ them.\n+  if (can_reshape && type() == Type::MEMORY && adr_type() == TypePtr::BOTTOM) {\n+    PhaseIterGVN* igvn = phase->is_IterGVN();\n+    uint phi_len = req();\n+    Node* phi_reg = region();\n+    for (DUIterator_Fast imax, i = phi_reg->fast_outs(imax); i < imax; i++) {\n+      Node* u = phi_reg->fast_out(i);\n+      assert(!u->is_Phi() || (u->in(0) == phi_reg && u->req() == phi_len), \"broken Phi\/Region subgraph\");\n+      if (u->is_Phi() && u->as_Phi()->can_be_replaced_by(this)) {\n+        igvn->_worklist.push(u);\n+      }\n+    }\n+  }\n+\n@@ -2742,0 +2854,5 @@\n+bool PhiNode::can_be_replaced_by(const PhiNode* other) const {\n+  return type() == Type::MEMORY && other->type() == Type::MEMORY && adr_type() != TypePtr::BOTTOM &&\n+    other->adr_type() == TypePtr::BOTTOM && has_same_inputs_as(other);\n+}\n+\n","filename":"src\/hotspot\/share\/opto\/cfgnode.cpp","additions":134,"deletions":17,"binary":false,"changes":151,"status":"modified"},{"patch":"@@ -185,0 +185,3 @@\n+  void verify_type_stability(const PhaseGVN* phase, const Type* union_of_input_types, const Type* new_type) const NOT_DEBUG_RETURN;\n+  bool wait_for_cast_input_igvn(const PhaseIterGVN* igvn) const;\n+\n@@ -274,0 +277,1 @@\n+  bool can_be_replaced_by(const PhiNode* other) const;\n@@ -342,3 +346,3 @@\n-  bool has_shared_region(ProjNode* proj, ProjNode*& success, ProjNode*& fail);\n-  bool has_only_uncommon_traps(ProjNode* proj, ProjNode*& success, ProjNode*& fail, PhaseIterGVN* igvn);\n-  Node* merge_uncommon_traps(ProjNode* proj, ProjNode* success, ProjNode* fail, PhaseIterGVN* igvn);\n+  bool has_shared_region(IfProjNode* proj, IfProjNode*& success, IfProjNode*& fail) const;\n+  bool has_only_uncommon_traps(IfProjNode* proj, IfProjNode*& success, IfProjNode*& fail, PhaseIterGVN* igvn) const;\n+  Node* merge_uncommon_traps(IfProjNode* proj, IfProjNode* success, IfProjNode* fail, PhaseIterGVN* igvn);\n@@ -346,5 +350,5 @@\n-  bool is_cmp_with_loadrange(ProjNode* proj);\n-  bool is_null_check(ProjNode* proj, PhaseIterGVN* igvn);\n-  bool is_side_effect_free_test(ProjNode* proj, PhaseIterGVN* igvn);\n-  void reroute_side_effect_free_unc(ProjNode* proj, ProjNode* dom_proj, PhaseIterGVN* igvn);\n-  bool fold_compares_helper(ProjNode* proj, ProjNode* success, ProjNode* fail, PhaseIterGVN* igvn);\n+  bool is_cmp_with_loadrange(IfProjNode* proj) const;\n+  bool is_null_check(IfProjNode* proj, PhaseIterGVN* igvn) const;\n+  bool is_side_effect_free_test(IfProjNode* proj, PhaseIterGVN* igvn) const;\n+  static void reroute_side_effect_free_unc(IfProjNode* proj, IfProjNode* dom_proj, PhaseIterGVN* igvn);\n+  bool fold_compares_helper(IfProjNode* proj, IfProjNode* success, IfProjNode* fail, PhaseIterGVN* igvn);\n@@ -354,1 +358,1 @@\n-  ProjNode* range_check_trap_proj(int& flip, Node*& l, Node*& r);\n+  IfProjNode* range_check_trap_proj(int& flip, Node*& l, Node*& r) const;\n@@ -433,0 +437,18 @@\n+  IfTrueNode* true_proj() const {\n+    return proj_out(true)->as_IfTrue();\n+  }\n+\n+  IfTrueNode* true_proj_or_null() const {\n+    ProjNode* true_proj = proj_out_or_null(true);\n+    return true_proj == nullptr ? nullptr : true_proj->as_IfTrue();\n+  }\n+\n+  IfFalseNode* false_proj() const {\n+    return proj_out(false)->as_IfFalse();\n+  }\n+\n+  IfFalseNode* false_proj_or_null() const {\n+    ProjNode* false_proj = proj_out_or_null(false);\n+    return false_proj == nullptr ? nullptr : false_proj->as_IfFalse();\n+  }\n+\n@@ -523,1 +545,1 @@\n-    return proj_out(0)->as_IfFalse();\n+    return false_proj();\n@@ -541,0 +563,5 @@\n+  \/\/ Return the other IfProj node.\n+  IfProjNode* other_if_proj() const {\n+    return in(0)->as_If()->proj_out(1 - _con)->as_IfProj();\n+  }\n+\n","filename":"src\/hotspot\/share\/opto\/cfgnode.hpp","additions":37,"deletions":10,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -1079,2 +1079,2 @@\n-        uint vreg = _lrg_map.live_range_id(n->in(k));\n-        if (!vreg) {\n+        uint vreg_in = _lrg_map.live_range_id(n->in(k));\n+        if (!vreg_in) {\n@@ -1102,1 +1102,1 @@\n-        LRG &lrg = lrgs(vreg);\n+        LRG &lrg_in = lrgs(vreg_in);\n@@ -1117,1 +1117,1 @@\n-        const RegMask &rm = n->in_RegMask(k);\n+        const RegMask &rm_in = n->in_RegMask(k);\n@@ -1124,1 +1124,1 @@\n-          lrg.and_with(rm);\n+          lrg_in.and_with(rm_in);\n@@ -1128,1 +1128,1 @@\n-        const RegMask &lrgmask = lrg.mask();\n+        const RegMask &lrgmask_in = lrg_in.mask();\n@@ -1134,2 +1134,2 @@\n-        if (lrgmask.is_bound(kreg))\n-          lrg._is_bound = 1;\n+        if (lrgmask_in.is_bound(kreg))\n+          lrg_in._is_bound = 1;\n@@ -1144,4 +1144,4 @@\n-          if (lrg.num_regs() != 0) {\n-            assert(lrgmask.is_aligned_sets(lrg.num_regs()), \"vector should be aligned\");\n-            assert(!lrg._fat_proj, \"sanity\");\n-            assert(RegMask::num_registers(kreg) == lrg.num_regs(), \"sanity\");\n+          if (lrg_in.num_regs() != 0) {\n+            assert(lrgmask_in.is_aligned_sets(lrg_in.num_regs()), \"vector should be aligned\");\n+            assert(!lrg_in._fat_proj, \"sanity\");\n+            assert(RegMask::num_registers(kreg) == lrg_in.num_regs(), \"sanity\");\n@@ -1153,3 +1153,3 @@\n-        if (!is_vect && lrg.num_regs() == 2 && !lrg._fat_proj && rm.is_misaligned_pair()) {\n-          lrg._fat_proj = 1;\n-          lrg._is_bound = 1;\n+        if (!is_vect && lrg_in.num_regs() == 2 && !lrg_in._fat_proj && rm_in.is_misaligned_pair()) {\n+          lrg_in._fat_proj = 1;\n+          lrg_in._is_bound = 1;\n@@ -1160,3 +1160,3 @@\n-            (lrg._def == nullptr || lrg.is_multidef() || !lrg._def->is_SpillCopy()) &&\n-            lrgmask.is_misaligned_pair()) {\n-          lrg.clear();\n+            (lrg_in._def == nullptr || lrg_in.is_multidef() || !lrg_in._def->is_SpillCopy()) &&\n+            lrgmask_in.is_misaligned_pair()) {\n+          lrg_in.clear();\n@@ -1166,2 +1166,2 @@\n-        if (lrg._maxfreq < block->_freq) {\n-          lrg._maxfreq = block->_freq;\n+        if (lrg_in._maxfreq < block->_freq) {\n+          lrg_in._maxfreq = block->_freq;\n","filename":"src\/hotspot\/share\/opto\/chaitin.cpp","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -598,1 +598,3 @@\n-    root()->dump_bfs(MaxNodeLimit, nullptr, \"+S$\", &ss);\n+    \/\/ It is important that we traverse both inputs and outputs of nodes,\n+    \/\/ so that we reach all nodes that are connected to Root.\n+    root()->dump_bfs(MaxNodeLimit, nullptr, \"-+S$\", &ss);\n@@ -3421,4 +3423,1 @@\n-    assert( !addp->is_AddP() ||\n-            addp->in(AddPNode::Base)->is_top() || \/\/ Top OK for allocation\n-            addp->in(AddPNode::Base) == n->in(AddPNode::Base),\n-            \"Base pointers must match (addp %u)\", addp->_idx );\n+    assert(n->as_AddP()->address_input_has_same_base(), \"Base pointers must match (addp %u)\", addp->_idx );\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -987,1 +987,2 @@\n-    return should_delay_string_inlining(call_method, jvms) ||\n+    return C->directive()->should_delay_inline(call_method) ||\n+           should_delay_string_inlining(call_method, jvms) ||\n","filename":"src\/hotspot\/share\/opto\/compile.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-ModFloatingNode::ModFloatingNode(Compile* C, const TypeFunc* tf, address addr, const char* name) : CallLeafPureNode(tf, addr, name, TypeRawPtr::BOTTOM) {\n+ModFloatingNode::ModFloatingNode(Compile* C, const TypeFunc* tf, address addr, const char* name) : CallLeafPureNode(tf, addr, name) {\n@@ -507,0 +507,96 @@\n+template<typename IntegerType>\n+static const IntegerType* compute_signed_div_type(const IntegerType* i1, const IntegerType* i2) {\n+  typedef typename IntegerType::NativeType NativeType;\n+  assert(!i2->is_con() || i2->get_con() != 0, \"Can't handle zero constant divisor\");\n+  int widen = MAX2(i1->_widen, i2->_widen);\n+\n+  \/\/ Case A: divisor range spans zero (i2->_lo < 0 < i2->_hi)\n+  \/\/ We split into two subproblems to avoid division by 0:\n+  \/\/   - negative part: [i2->_lo, 1]\n+  \/\/   - positive part: [1, i2->_hi]\n+  \/\/ Then we union the results by taking the min of all lowerbounds and\n+  \/\/ the max of all upperbounds from the two halves.\n+  if (i2->_lo < 0 && i2->_hi > 0) {\n+    \/\/ Handle negative part of the divisor range\n+    const IntegerType* neg_part = compute_signed_div_type(i1, IntegerType::make(i2->_lo, -1, widen));\n+    \/\/ Handle positive part of the divisor range\n+    const IntegerType* pos_part = compute_signed_div_type(i1, IntegerType::make(1, i2->_hi, widen));\n+    \/\/ Merge results\n+    NativeType new_lo = MIN2(neg_part->_lo, pos_part->_lo);\n+    NativeType new_hi = MAX2(neg_part->_hi, pos_part->_hi);\n+    assert(new_hi >= new_lo, \"sanity\");\n+    return IntegerType::make(new_lo, new_hi, widen);\n+  }\n+\n+  \/\/ Case B: divisor range does NOT span zero.\n+  \/\/ Here i2 is entirely negative or entirely positive.\n+  \/\/ Then i1\/i2 is monotonic in i1 and i2 (when i2 keeps the same sign).\n+  \/\/ Therefore the extrema occur at the four corners:\n+  \/\/   (i1->_lo, i2->_hi), (i1->_lo, i2->_lo), (i1->_hi, i2->_lo), (i1->_hi, i2->_hi).\n+  \/\/ We compute all four and take the min and max.\n+  \/\/ A special case handles overflow when dividing the mostnegative value by 1.\n+\n+  \/\/ adjust i2 bounds to not include zero, as zero always throws\n+  NativeType i2_lo = i2->_lo == 0 ? 1 : i2->_lo;\n+  NativeType i2_hi = i2->_hi == 0 ? -1 : i2->_hi;\n+  constexpr NativeType min_val = std::numeric_limits<NativeType>::min();\n+  static_assert(min_val == min_jint || min_val == min_jlong, \"min has to be either min_jint or min_jlong\");\n+  constexpr NativeType max_val = std::numeric_limits<NativeType>::max();\n+  static_assert(max_val == max_jint || max_val == max_jlong, \"max has to be either max_jint or max_jlong\");\n+\n+  \/\/ Special overflow case: min_val \/ (-1) == min_val (cf. JVMS6.5 idiv\/ldiv)\n+  \/\/ We need to be careful that we never run min_val \/ (-1) in C++ code, as this overflow is UB there\n+  if (i1->_lo == min_val && i2_hi == -1) {\n+    NativeType new_lo = min_val;\n+    NativeType new_hi;\n+    \/\/ compute new_hi depending on whether divisor or dividend is non-constant.\n+    \/\/ i2 is purely in the negative domain here (as i2_hi is -1)\n+    \/\/ which means the maximum value this division can yield is either\n+    if (!i1->is_con()) {\n+      \/\/ a) non-constant dividend: i1 could be min_val + 1.\n+      \/\/ -> i1 \/ i2 = (min_val + 1) \/ -1 = max_val is possible.\n+      new_hi = max_val;\n+      assert((min_val + 1) \/ -1 == new_hi, \"new_hi should be max_val\");\n+    } else if (i2_lo != i2_hi) {\n+      \/\/ b) i1 is constant min_val, i2 is non-constant.\n+      \/\/    if i2 = -1 -> i1 \/ i2 =  min_val \/ -1 = min_val\n+      \/\/    if i2 < -1 -> i1 \/ i2 <= min_val \/ -2 = (max_val \/ 2) + 1\n+      new_hi = (max_val \/ 2) + 1;\n+      assert(min_val \/ -2 == new_hi, \"new_hi should be (max_val \/ 2) + 1)\");\n+    } else {\n+      \/\/ c) i1 is constant min_val, i2 is constant -1.\n+      \/\/    -> i1 \/ i2 = min_val \/ -1 = min_val\n+      new_hi = min_val;\n+    }\n+\n+#ifdef ASSERT\n+    \/\/ validate new_hi for non-constant divisor\n+    if (i2_lo != i2_hi) {\n+      assert(i2_lo != -1, \"Special case not possible here, as i2_lo has to be < i2_hi\");\n+      NativeType result = i1->_lo \/ i2_lo;\n+      assert(new_hi >= result, \"computed wrong value for new_hi\");\n+    }\n+\n+    \/\/ validate new_hi for non-constant dividend\n+    if (!i1->is_con()) {\n+      assert(i2_hi > min_val, \"Special case not possible here, as i1->_hi has to be > min\");\n+      NativeType result1 = i1->_hi \/ i2_lo;\n+      NativeType result2 = i1->_hi \/ i2_hi;\n+      assert(new_hi >= result1 && new_hi >= result2, \"computed wrong value for new_hi\");\n+    }\n+#endif\n+\n+    return IntegerType::make(new_lo, new_hi, widen);\n+  }\n+  assert((i1->_lo != min_val && i1->_hi != min_val) || (i2_hi != -1 && i2_lo != -1), \"should have filtered out before\");\n+\n+  \/\/ Special case not possible here, calculate all corners normally\n+  NativeType corner1 = i1->_lo \/ i2_lo;\n+  NativeType corner2 = i1->_lo \/ i2_hi;\n+  NativeType corner3 = i1->_hi \/ i2_lo;\n+  NativeType corner4 = i1->_hi \/ i2_hi;\n+\n+  NativeType new_lo = MIN4(corner1, corner2, corner3, corner4);\n+  NativeType new_hi = MAX4(corner1, corner2, corner3, corner4);\n+  return IntegerType::make(new_lo, new_hi, widen);\n+}\n@@ -552,4 +648,10 @@\n-  const Type *t1 = phase->type( in(1) );\n-  const Type *t2 = phase->type( in(2) );\n-  if( t1 == Type::TOP ) return Type::TOP;\n-  if( t2 == Type::TOP ) return Type::TOP;\n+  const Type* t1 = phase->type(in(1));\n+  const Type* t2 = phase->type(in(2));\n+  if (t1 == Type::TOP || t2 == Type::TOP) {\n+    return Type::TOP;\n+  }\n+\n+  if (t2 == TypeInt::ZERO) {\n+    \/\/ this division will always throw an exception\n+    return Type::TOP;\n+  }\n@@ -562,5 +664,2 @@\n-  \/\/ Either input is BOTTOM ==> the result is the local BOTTOM\n-  const Type *bot = bottom_type();\n-  if( (t1 == bot) || (t2 == bot) ||\n-      (t1 == Type::BOTTOM) || (t2 == Type::BOTTOM) )\n-    return bot;\n+  const TypeInt* i1 = t1->is_int();\n+  const TypeInt* i2 = t2->is_int();\n@@ -568,43 +667,1 @@\n-  \/\/ Divide the two numbers.  We approximate.\n-  \/\/ If divisor is a constant and not zero\n-  const TypeInt *i1 = t1->is_int();\n-  const TypeInt *i2 = t2->is_int();\n-  int widen = MAX2(i1->_widen, i2->_widen);\n-\n-  if( i2->is_con() && i2->get_con() != 0 ) {\n-    int32_t d = i2->get_con(); \/\/ Divisor\n-    jint lo, hi;\n-    if( d >= 0 ) {\n-      lo = i1->_lo\/d;\n-      hi = i1->_hi\/d;\n-    } else {\n-      if( d == -1 && i1->_lo == min_jint ) {\n-        \/\/ 'min_jint\/-1' throws arithmetic exception during compilation\n-        lo = min_jint;\n-        \/\/ do not support holes, 'hi' must go to either min_jint or max_jint:\n-        \/\/ [min_jint, -10]\/[-1,-1] ==> [min_jint] UNION [10,max_jint]\n-        hi = i1->_hi == min_jint ? min_jint : max_jint;\n-      } else {\n-        lo = i1->_hi\/d;\n-        hi = i1->_lo\/d;\n-      }\n-    }\n-    return TypeInt::make(lo, hi, widen);\n-  }\n-\n-  \/\/ If the dividend is a constant\n-  if( i1->is_con() ) {\n-    int32_t d = i1->get_con();\n-    if( d < 0 ) {\n-      if( d == min_jint ) {\n-        \/\/  (-min_jint) == min_jint == (min_jint \/ -1)\n-        return TypeInt::make(min_jint, max_jint\/2 + 1, widen);\n-      } else {\n-        return TypeInt::make(d, -d, widen);\n-      }\n-    }\n-    return TypeInt::make(-d, d, widen);\n-  }\n-\n-  \/\/ Otherwise we give up all hope\n-  return TypeInt::INT;\n+  return compute_signed_div_type<TypeInt>(i1, i2);\n@@ -658,4 +715,10 @@\n-  const Type *t1 = phase->type( in(1) );\n-  const Type *t2 = phase->type( in(2) );\n-  if( t1 == Type::TOP ) return Type::TOP;\n-  if( t2 == Type::TOP ) return Type::TOP;\n+  const Type* t1 = phase->type(in(1));\n+  const Type* t2 = phase->type(in(2));\n+  if (t1 == Type::TOP || t2 == Type::TOP) {\n+    return Type::TOP;\n+  }\n+\n+  if (t2 == TypeLong::ZERO) {\n+    \/\/ this division will always throw an exception\n+    return Type::TOP;\n+  }\n@@ -668,46 +731,2 @@\n-  \/\/ Either input is BOTTOM ==> the result is the local BOTTOM\n-  const Type *bot = bottom_type();\n-  if( (t1 == bot) || (t2 == bot) ||\n-      (t1 == Type::BOTTOM) || (t2 == Type::BOTTOM) )\n-    return bot;\n-\n-  \/\/ Divide the two numbers.  We approximate.\n-  \/\/ If divisor is a constant and not zero\n-  const TypeLong *i1 = t1->is_long();\n-  const TypeLong *i2 = t2->is_long();\n-  int widen = MAX2(i1->_widen, i2->_widen);\n-\n-  if( i2->is_con() && i2->get_con() != 0 ) {\n-    jlong d = i2->get_con();    \/\/ Divisor\n-    jlong lo, hi;\n-    if( d >= 0 ) {\n-      lo = i1->_lo\/d;\n-      hi = i1->_hi\/d;\n-    } else {\n-      if( d == CONST64(-1) && i1->_lo == min_jlong ) {\n-        \/\/ 'min_jlong\/-1' throws arithmetic exception during compilation\n-        lo = min_jlong;\n-        \/\/ do not support holes, 'hi' must go to either min_jlong or max_jlong:\n-        \/\/ [min_jlong, -10]\/[-1,-1] ==> [min_jlong] UNION [10,max_jlong]\n-        hi = i1->_hi == min_jlong ? min_jlong : max_jlong;\n-      } else {\n-        lo = i1->_hi\/d;\n-        hi = i1->_lo\/d;\n-      }\n-    }\n-    return TypeLong::make(lo, hi, widen);\n-  }\n-\n-  \/\/ If the dividend is a constant\n-  if( i1->is_con() ) {\n-    jlong d = i1->get_con();\n-    if( d < 0 ) {\n-      if( d == min_jlong ) {\n-        \/\/  (-min_jlong) == min_jlong == (min_jlong \/ -1)\n-        return TypeLong::make(min_jlong, max_jlong\/2 + 1, widen);\n-      } else {\n-        return TypeLong::make(d, -d, widen);\n-      }\n-    }\n-    return TypeLong::make(-d, d, widen);\n-  }\n+  const TypeLong* i1 = t1->is_long();\n+  const TypeLong* i2 = t2->is_long();\n@@ -715,2 +734,1 @@\n-  \/\/ Otherwise we give up all hope\n-  return TypeLong::LONG;\n+  return compute_signed_div_type<TypeLong>(i1, i2);\n","filename":"src\/hotspot\/share\/opto\/divnode.cpp","additions":123,"deletions":105,"binary":false,"changes":228,"status":"modified"},{"patch":"@@ -195,1 +195,1 @@\n-      bool should_delay = C->should_delay_inlining();\n+      bool should_delay = C->should_delay_inlining() || C->directive()->should_delay_inline(callee);\n","filename":"src\/hotspot\/share\/opto\/doCall.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2508,1 +2508,2 @@\n-    call = new CallLeafPureNode(call_type, call_addr, call_name, adr_type);\n+    assert(adr_type == nullptr, \"pure call does not touch memory\");\n+    call = new CallLeafPureNode(call_type, call_addr, call_name);\n","filename":"src\/hotspot\/share\/opto\/graphKit.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -490,1 +490,1 @@\n-ProjNode* IfNode::range_check_trap_proj(int& flip_test, Node*& l, Node*& r) {\n+IfProjNode* IfNode::range_check_trap_proj(int& flip_test, Node*& l, Node*& r) const {\n@@ -518,2 +518,4 @@\n-  ProjNode* iftrap = proj_out_or_null(flip_test == 2 ? true : false);\n-  return iftrap;\n+  if (flip_test == 2) {\n+    return true_proj_or_null();\n+  }\n+  return false_proj_or_null();\n@@ -531,1 +533,1 @@\n-  ProjNode* iftrap = range_check_trap_proj(flip_test, l, r);\n+  IfProjNode* iftrap = range_check_trap_proj(flip_test, l, r);\n@@ -772,1 +774,1 @@\n-    ctrl->is_Proj() &&\n+    ctrl->is_IfProj() &&\n@@ -785,2 +787,2 @@\n-bool IfNode::has_shared_region(ProjNode* proj, ProjNode*& success, ProjNode*& fail) {\n-  ProjNode* otherproj = proj->other_if_proj();\n+bool IfNode::has_shared_region(IfProjNode* proj, IfProjNode*& success, IfProjNode*& fail) const {\n+  IfProjNode* otherproj = proj->other_if_proj();\n@@ -794,3 +796,3 @@\n-      ProjNode* proj = proj_out(i);\n-      if (success == nullptr && proj->outcnt() == 1 && proj->unique_out() == region) {\n-        success = proj;\n+      IfProjNode* next_proj = proj_out(i)->as_IfProj();\n+      if (success == nullptr && next_proj->outcnt() == 1 && next_proj->unique_out() == region) {\n+        success = next_proj;\n@@ -798,1 +800,1 @@\n-        fail = proj;\n+        fail = next_proj;\n@@ -800,1 +802,2 @@\n-        success = fail = nullptr;\n+        success = nullptr;\n+        fail = nullptr;\n@@ -851,2 +854,2 @@\n-bool IfNode::has_only_uncommon_traps(ProjNode* proj, ProjNode*& success, ProjNode*& fail, PhaseIterGVN* igvn) {\n-  ProjNode* otherproj = proj->other_if_proj();\n+bool IfNode::has_only_uncommon_traps(IfProjNode* proj, IfProjNode*& success, IfProjNode*& fail, PhaseIterGVN* igvn) const {\n+  IfProjNode* otherproj = proj->other_if_proj();\n@@ -889,2 +892,2 @@\n-        success = unc_proj;\n-        fail = unc_proj->other_if_proj();\n+        success = unc_proj->as_IfProj();\n+        fail = unc_proj->as_IfProj()->other_if_proj();\n@@ -899,1 +902,1 @@\n-bool IfNode::fold_compares_helper(ProjNode* proj, ProjNode* success, ProjNode* fail, PhaseIterGVN* igvn) {\n+bool IfNode::fold_compares_helper(IfProjNode* proj, IfProjNode* success, IfProjNode* fail, PhaseIterGVN* igvn) {\n@@ -907,1 +910,1 @@\n-  ProjNode* otherproj = proj->other_if_proj();\n+  IfProjNode* otherproj = proj->other_if_proj();\n@@ -1109,1 +1112,1 @@\n-Node* IfNode::merge_uncommon_traps(ProjNode* proj, ProjNode* success, ProjNode* fail, PhaseIterGVN* igvn) {\n+Node* IfNode::merge_uncommon_traps(IfProjNode* proj, IfProjNode* success, IfProjNode* fail, PhaseIterGVN* igvn) {\n@@ -1113,1 +1116,1 @@\n-  ProjNode* otherproj = proj->other_if_proj();\n+  IfProjNode* otherproj = proj->other_if_proj();\n@@ -1240,1 +1243,1 @@\n-bool IfNode::is_cmp_with_loadrange(ProjNode* proj) {\n+bool IfNode::is_cmp_with_loadrange(IfProjNode* proj) const {\n@@ -1259,1 +1262,1 @@\n-bool IfNode::is_null_check(ProjNode* proj, PhaseIterGVN* igvn) {\n+bool IfNode::is_null_check(IfProjNode* proj, PhaseIterGVN* igvn) const {\n@@ -1276,1 +1279,1 @@\n-bool IfNode::is_side_effect_free_test(ProjNode* proj, PhaseIterGVN* igvn) {\n+bool IfNode::is_side_effect_free_test(IfProjNode* proj, PhaseIterGVN* igvn) const {\n@@ -1316,1 +1319,1 @@\n-void IfNode::reroute_side_effect_free_unc(ProjNode* proj, ProjNode* dom_proj, PhaseIterGVN* igvn) {\n+void IfNode::reroute_side_effect_free_unc(IfProjNode* proj, IfProjNode* dom_proj, PhaseIterGVN* igvn) {\n@@ -1318,1 +1321,1 @@\n-  ProjNode* otherproj = proj->other_if_proj();\n+  IfProjNode* otherproj = proj->other_if_proj();\n@@ -1349,3 +1352,3 @@\n-      ProjNode* success = nullptr;\n-      ProjNode* fail = nullptr;\n-      ProjNode* dom_cmp = ctrl->as_Proj();\n+      IfProjNode* success = nullptr;\n+      IfProjNode* fail = nullptr;\n+      IfProjNode* dom_cmp = ctrl->as_IfProj();\n@@ -1365,2 +1368,2 @@\n-      ProjNode* success = nullptr;\n-      ProjNode* fail = nullptr;\n+      IfProjNode* success = nullptr;\n+      IfProjNode* fail = nullptr;\n@@ -1368,2 +1371,2 @@\n-      ProjNode* dom_cmp = dom->isa_Proj();\n-      ProjNode* other_cmp = ctrl->isa_Proj();\n+      IfProjNode* dom_cmp = dom->isa_IfProj();\n+      IfProjNode* other_cmp = ctrl->isa_IfProj();\n@@ -1878,2 +1881,2 @@\n-  Node* old_if_f = iff->proj_out(false);\n-  Node* old_if_t = iff->proj_out(true);\n+  IfFalseNode* old_if_f = iff->false_proj();\n+  IfTrueNode* old_if_t = iff->true_proj();\n@@ -2195,1 +2198,1 @@\n-  ParsePredicateUncommonProj* uncommon_proj = proj_out(0)->as_IfFalse();\n+  ParsePredicateUncommonProj* uncommon_proj = false_proj();\n","filename":"src\/hotspot\/share\/opto\/ifnode.cpp","additions":38,"deletions":35,"binary":false,"changes":73,"status":"modified"},{"patch":"@@ -6174,1 +6174,1 @@\n-    Node* other_proj = node->as_IfProj()->other_if_proj();\n+    IfProjNode* other_proj = node->as_IfProj()->other_if_proj();\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -90,1 +90,1 @@\n-    Node* cle_out = _head->as_CountedLoop()->loopexit()->proj_out(false);\n+    IfFalseNode* cle_out = _head->as_CountedLoop()->loopexit()->false_proj();\n@@ -1467,3 +1467,2 @@\n-  Node* pre_exit = pre_end->proj_out(false);\n-  assert(pre_exit->Opcode() == Op_IfFalse, \"\");\n-  IfFalseNode *new_pre_exit = new IfFalseNode(pre_end);\n+  IfFalseNode* pre_exit = pre_end->false_proj();\n+  IfFalseNode* new_pre_exit = new IfFalseNode(pre_end);\n@@ -1710,2 +1709,1 @@\n-  Node* main_exit = outer_main_end->proj_out(false);\n-  assert(main_exit->Opcode() == Op_IfFalse, \"\");\n+  IfFalseNode* main_exit = outer_main_end->false_proj();\n@@ -1724,1 +1722,1 @@\n-  main_exit = outer_main_end->proj_out(false);\n+  main_exit = outer_main_end->false_proj();\n@@ -1789,1 +1787,1 @@\n-  const Node* if_false = main_end->proj_out(false);\n+  const IfFalseNode* if_false = main_end->false_proj();\n@@ -3947,1 +3945,1 @@\n-  Node* exit = head->loopexit()->proj_out_or_null(0);\n+  IfFalseNode* exit = head->loopexit()->false_proj_or_null();\n@@ -3991,1 +3989,1 @@\n-  Node* backedge = head->loopexit()->proj_out(1);\n+  IfTrueNode* backedge = head->loopexit()->true_proj();\n","filename":"src\/hotspot\/share\/opto\/loopTransform.cpp","additions":8,"deletions":10,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -491,1 +491,1 @@\n-  IfFalseNode* multiversion_slow_proj = multiversion_if->proj_out(0)->as_IfFalse();\n+  IfFalseNode* multiversion_slow_proj = multiversion_if->false_proj();\n","filename":"src\/hotspot\/share\/opto\/loopUnswitch.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -82,1 +82,1 @@\n-        le->proj_out_or_null(1 \/* true *\/) == l->in(LoopNode::LoopBackControl)) {\n+        le->true_proj_or_null() == l->in(LoopNode::LoopBackControl)) {\n@@ -84,3 +84,2 @@\n-      Node* exit = le->proj_out_or_null(0 \/* false *\/);\n-      if (exit != nullptr && exit->Opcode() == Op_IfFalse &&\n-          phi != nullptr && phi->is_Phi() &&\n+      IfFalseNode* exit = le->false_proj_or_null();\n+      if (exit != nullptr && phi != nullptr && phi->is_Phi() &&\n@@ -945,1 +944,1 @@\n-  Node* exit_branch = exit_test->proj_out(false);\n+  IfFalseNode* exit_branch = exit_test->false_proj();\n@@ -3090,1 +3089,1 @@\n-  Node* c = le->proj_out_or_null(false);\n+  IfFalseNode* c = le->false_proj_or_null();\n@@ -3410,1 +3409,1 @@\n-  Node* cle_tail = inner_cle->proj_out(true);\n+  IfTrueNode* cle_tail = inner_cle->true_proj();\n@@ -3552,1 +3551,1 @@\n-  Node* backedge = cle->proj_out(true);\n+  IfTrueNode* backedge = cle->true_proj();\n@@ -3633,1 +3632,1 @@\n-    Node* backedge = proj_out_or_null(true);\n+    IfTrueNode* backedge = true_proj_or_null();\n","filename":"src\/hotspot\/share\/opto\/loopnode.cpp","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -610,1 +610,1 @@\n-  IfFalseNode* inner_loop_exit() const { return inner_counted_loop_end()->proj_out(false)->as_IfFalse(); }\n+  IfFalseNode* inner_loop_exit() const { return inner_counted_loop_end()->false_proj(); }\n","filename":"src\/hotspot\/share\/opto\/loopnode.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1324,2 +1324,2 @@\n-  Node* proj_true = dom_if->proj_out(1);\n-  Node* proj_false = dom_if->proj_out(0);\n+  IfTrueNode* proj_true = dom_if->true_proj();\n+  IfFalseNode* proj_false = dom_if->false_proj();\n@@ -1588,2 +1588,2 @@\n-    ProjNode* dom_proj_true = dom_if->proj_out(1);\n-    ProjNode* dom_proj_false = dom_if->proj_out(0);\n+    IfTrueNode* dom_proj_true = dom_if->true_proj();\n+    IfFalseNode* dom_proj_false = dom_if->false_proj();\n@@ -1633,1 +1633,1 @@\n-        dominated_by(dom_proj_true->as_IfProj(), new_false_region->in(i)->in(0)->as_If());\n+        dominated_by(dom_proj_true, new_false_region->in(i)->in(0)->as_If());\n@@ -1636,1 +1636,1 @@\n-        dominated_by(dom_proj_false->as_IfProj(), new_false_region->in(i)->in(0)->as_If());\n+        dominated_by(dom_proj_false, new_false_region->in(i)->in(0)->as_If());\n@@ -2397,1 +2397,1 @@\n-    Node* cle_out = cle->proj_out(false);\n+    IfFalseNode* cle_out = cle->false_proj();\n@@ -2694,1 +2694,1 @@\n-            use = le->proj_out(false);\n+            use = le->false_proj();\n","filename":"src\/hotspot\/share\/opto\/loopopts.cpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2382,2 +2382,2 @@\n-    Node* iftrue = iff->as_If()->proj_out(1);\n-    Node* iffalse = iff->as_If()->proj_out(0);\n+    IfTrueNode* iftrue = iff->as_If()->true_proj();\n+    IfFalseNode* iffalse = iff->as_If()->false_proj();\n@@ -2661,2 +2661,1 @@\n-        CallNode* call = new CallLeafPureNode(mod_macro->tf(), mod_macro->entry_point(),\n-                                              mod_macro->_name, TypeRawPtr::BOTTOM);\n+        CallNode* call = new CallLeafPureNode(mod_macro->tf(), mod_macro->entry_point(), mod_macro->_name);\n","filename":"src\/hotspot\/share\/opto\/macro.cpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -3106,1 +3106,1 @@\n-  ProjNode* other_proj = ctrl_use->as_IfProj()->other_if_proj();\n+  IfProjNode* other_proj = ctrl_use->as_IfProj()->other_if_proj();\n","filename":"src\/hotspot\/share\/opto\/memnode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"opto\/rangeinference.hpp\"\n@@ -623,63 +624,0 @@\n-template<typename IntegerType>\n-static const IntegerType* and_value(const IntegerType* r0, const IntegerType* r1) {\n-  typedef typename IntegerType::NativeType NativeType;\n-  static_assert(std::is_signed<NativeType>::value, \"Native type of IntegerType must be signed!\");\n-\n-  int widen = MAX2(r0->_widen, r1->_widen);\n-\n-  \/\/ If both types are constants, we can calculate a constant result.\n-  if (r0->is_con() && r1->is_con()) {\n-    return IntegerType::make(r0->get_con() & r1->get_con());\n-  }\n-\n-  \/\/ If both ranges are positive, the result will range from 0 up to the hi value of the smaller range. The minimum\n-  \/\/ of the two constrains the upper bound because any higher value in the other range will see all zeroes, so it will be masked out.\n-  if (r0->_lo >= 0 && r1->_lo >= 0) {\n-    return IntegerType::make(0, MIN2(r0->_hi, r1->_hi), widen);\n-  }\n-\n-  \/\/ If only one range is positive, the result will range from 0 up to that range's maximum value.\n-  \/\/ For the operation 'x & C' where C is a positive constant, the result will be in the range [0..C]. With that observation,\n-  \/\/ we can say that for any integer c such that 0 <= c <= C will also be in the range [0..C]. Therefore, 'x & [c..C]'\n-  \/\/ where c >= 0 will be in the range [0..C].\n-  if (r0->_lo >= 0) {\n-    return IntegerType::make(0, r0->_hi, widen);\n-  }\n-\n-  if (r1->_lo >= 0) {\n-    return IntegerType::make(0, r1->_hi, widen);\n-  }\n-\n-  \/\/ At this point, all positive ranges will have already been handled, so the only remaining cases will be negative ranges\n-  \/\/ and constants.\n-\n-  assert(r0->_lo < 0 && r1->_lo < 0, \"positive ranges should already be handled!\");\n-\n-  \/\/ As two's complement means that both numbers will start with leading 1s, the lower bound of both ranges will contain\n-  \/\/ the common leading 1s of both minimum values. In order to count them with count_leading_zeros, the bits are inverted.\n-  NativeType sel_val = ~MIN2(r0->_lo, r1->_lo);\n-\n-  NativeType min;\n-  if (sel_val == 0) {\n-    \/\/ Since count_leading_zeros is undefined at 0, we short-circuit the condition where both ranges have a minimum of -1.\n-    min = -1;\n-  } else {\n-    \/\/ To get the number of bits to shift, we count the leading 0-bits and then subtract one, as the sign bit is already set.\n-    int shift_bits = count_leading_zeros(sel_val) - 1;\n-    min = std::numeric_limits<NativeType>::min() >> shift_bits;\n-  }\n-\n-  NativeType max;\n-  if (r0->_hi < 0 && r1->_hi < 0) {\n-    \/\/ If both ranges are negative, then the same optimization as both positive ranges will apply, and the smaller hi\n-    \/\/ value will mask off any bits set by higher values.\n-    max = MIN2(r0->_hi, r1->_hi);\n-  } else {\n-    \/\/ In the case of ranges that cross zero, negative values can cause the higher order bits to be set, so the maximum\n-    \/\/ positive value can be as high as the larger hi value.\n-    max = MAX2(r0->_hi, r1->_hi);\n-  }\n-\n-  return IntegerType::make(min, max, widen);\n-}\n-\n@@ -692,5 +630,2 @@\n-const Type *AndINode::mul_ring( const Type *t0, const Type *t1 ) const {\n-  const TypeInt* r0 = t0->is_int();\n-  const TypeInt* r1 = t1->is_int();\n-\n-  return and_value<TypeInt>(r0, r1);\n+const Type* AndINode::mul_ring(const Type* t1, const Type* t2) const {\n+  return RangeInference::infer_and(t1->is_int(), t2->is_int());\n@@ -825,5 +760,2 @@\n-const Type *AndLNode::mul_ring( const Type *t0, const Type *t1 ) const {\n-  const TypeLong* r0 = t0->is_long();\n-  const TypeLong* r1 = t1->is_long();\n-\n-  return and_value<TypeLong>(r0, r1);\n+const Type* AndLNode::mul_ring(const Type* t1, const Type* t2) const {\n+  return RangeInference::infer_and(t1->is_long(), t2->is_long());\n","filename":"src\/hotspot\/share\/opto\/mulnode.cpp","additions":5,"deletions":73,"binary":false,"changes":78,"status":"modified"},{"patch":"@@ -263,6 +263,1 @@\n-  return other_if_proj()->is_uncommon_trap_proj(reason);\n-}\n-\n-ProjNode* ProjNode::other_if_proj() const {\n-  assert(_con == 0 || _con == 1, \"not an if?\");\n-  return in(0)->as_If()->proj_out(1-_con);\n+  return as_IfProj()->other_if_proj()->is_uncommon_trap_proj(reason);\n","filename":"src\/hotspot\/share\/opto\/multnode.cpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -203,3 +203,0 @@\n-\n-  \/\/ Return other proj node when this is a If proj node\n-  ProjNode* other_if_proj() const;\n","filename":"src\/hotspot\/share\/opto\/multnode.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1002,0 +1002,3 @@\n+  \/\/ If we end up traversing more nodes than we actually have,\n+  \/\/ it is definitely an infinite loop.\n+  uint max_depth = Compile::current()->unique();\n@@ -1008,1 +1011,1 @@\n-    if (depth_count >= K) {\n+    if (depth_count++ >= max_depth) {\n@@ -1010,1 +1013,1 @@\n-      if (p != orig_p)\n+      if (p != orig_p) {\n@@ -1012,0 +1015,2 @@\n+      }\n+      fatal(\"infinite loop in Node::uncast_helper\");\n@@ -1013,1 +1018,0 @@\n-    assert(depth_count++ < K, \"infinite loop in Node::uncast_helper\");\n@@ -2878,10 +2882,3 @@\n-            use->req() == req()) {\n-          uint j;\n-          for (j = 0; j < use->req(); j++) {\n-            if (use->in(j) != in(j)) {\n-              break;\n-            }\n-          }\n-          if (j == use->req()) {\n-            return use;\n-          }\n+            use->req() == req() &&\n+            has_same_inputs_as(use)) {\n+          return use;\n@@ -2895,0 +2892,10 @@\n+bool Node::has_same_inputs_as(const Node* other) const {\n+  assert(req() == other->req(), \"should have same number of inputs\");\n+  for (uint j = 0; j < other->req(); j++) {\n+    if (in(j) != other->in(j)) {\n+      return false;\n+    }\n+  }\n+  return true;\n+}\n+\n","filename":"src\/hotspot\/share\/opto\/node.cpp","additions":20,"deletions":13,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -1182,0 +1182,1 @@\n+  bool has_same_inputs_as(const Node* other) const;\n","filename":"src\/hotspot\/share\/opto\/node.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -44,0 +44,1 @@\n+#include \"opto\/subtypenode.hpp\"\n@@ -1722,0 +1723,76 @@\n+\/\/ Matches exact and inexact type check IR shapes during parsing.\n+\/\/ On successful match, returns type checked object node and its type after successful check\n+\/\/ as out parameters.\n+static bool match_type_check(PhaseGVN& gvn,\n+                             BoolTest::mask btest,\n+                             Node* con, const Type* tcon,\n+                             Node* val, const Type* tval,\n+                             Node** obj, const TypeOopPtr** cast_type) { \/\/ out-parameters\n+  \/\/ Look for opportunities to sharpen the type of a node whose klass is compared with a constant klass.\n+  \/\/ The constant klass being tested against can come from many bytecode instructions (implicitly or explicitly),\n+  \/\/ and also from profile data used by speculative casts.\n+  if (btest == BoolTest::eq && tcon->isa_klassptr()) {\n+    \/\/ Found:\n+    \/\/   Bool(CmpP(LoadKlass(obj._klass), ConP(Foo.klass)), [eq])\n+    \/\/ or the narrowOop equivalent.\n+    (*obj) = extract_obj_from_klass_load(&gvn, val);\n+    (*cast_type) = tcon->isa_klassptr()->as_instance_type();\n+    return true; \/\/ found\n+  }\n+\n+  \/\/ Match an instanceof check.\n+  \/\/ During parsing its IR shape is not canonicalized yet.\n+  \/\/\n+  \/\/             obj superklass\n+  \/\/              |    |\n+  \/\/           SubTypeCheck\n+  \/\/                |\n+  \/\/               Bool [eq] \/ [ne]\n+  \/\/                |\n+  \/\/                If\n+  \/\/               \/ \\\n+  \/\/              T   F\n+  \/\/               \\ \/\n+  \/\/              Region\n+  \/\/                 \\  ConI ConI\n+  \/\/                  \\  |  \/\n+  \/\/          val ->    Phi  ConI  <- con\n+  \/\/                     \\  \/\n+  \/\/                     CmpI\n+  \/\/                      |\n+  \/\/                    Bool [btest]\n+  \/\/                      |\n+  \/\/\n+  if (tval->isa_int() && val->is_Phi() && val->in(0)->as_Region()->is_diamond()) {\n+    RegionNode* diamond = val->in(0)->as_Region();\n+    IfNode* if1 = diamond->in(1)->in(0)->as_If();\n+    BoolNode* b1 = if1->in(1)->isa_Bool();\n+    if (b1 != nullptr && b1->in(1)->isa_SubTypeCheck()) {\n+      assert(b1->_test._test == BoolTest::eq ||\n+             b1->_test._test == BoolTest::ne, \"%d\", b1->_test._test);\n+\n+      ProjNode* success_proj = if1->proj_out(b1->_test._test == BoolTest::eq ? 1 : 0);\n+      int idx = diamond->find_edge(success_proj);\n+      assert(idx == 1 || idx == 2, \"\");\n+      Node* vcon = val->in(idx);\n+\n+      assert(val->find_edge(con) > 0, \"\");\n+      if ((btest == BoolTest::eq && vcon == con) || (btest == BoolTest::ne && vcon != con)) {\n+        SubTypeCheckNode* sub = b1->in(1)->as_SubTypeCheck();\n+        Node* obj_or_subklass = sub->in(SubTypeCheckNode::ObjOrSubKlass);\n+        Node* superklass = sub->in(SubTypeCheckNode::SuperKlass);\n+\n+        if (gvn.type(obj_or_subklass)->isa_oopptr()) {\n+          const TypeKlassPtr* klass_ptr_type = gvn.type(superklass)->is_klassptr();\n+          const TypeKlassPtr* improved_klass_ptr_type = klass_ptr_type->try_improve();\n+\n+          (*obj) = obj_or_subklass;\n+          (*cast_type) = improved_klass_ptr_type->cast_to_exactness(false)->as_instance_type();\n+          return true; \/\/ found\n+        }\n+      }\n+    }\n+  }\n+  return false; \/\/ not found\n+}\n+\n@@ -1725,29 +1802,23 @@\n-  \/\/ Look for opportunities to sharpen the type of a node\n-  \/\/ whose klass is compared with a constant klass.\n-  if (btest == BoolTest::eq && tcon->isa_klassptr()) {\n-    Node* obj = extract_obj_from_klass_load(&_gvn, val);\n-    const TypeOopPtr* con_type = tcon->isa_klassptr()->as_instance_type();\n-    if (obj != nullptr && (con_type->isa_instptr() || con_type->isa_aryptr())) {\n-       \/\/ Found:\n-       \/\/   Bool(CmpP(LoadKlass(obj._klass), ConP(Foo.klass)), [eq])\n-       \/\/ or the narrowOop equivalent.\n-       const Type* obj_type = _gvn.type(obj);\n-       const TypeOopPtr* tboth = obj_type->join_speculative(con_type)->isa_oopptr();\n-       if (tboth != nullptr && tboth->klass_is_exact() && tboth != obj_type &&\n-           tboth->higher_equal(obj_type)) {\n-          \/\/ obj has to be of the exact type Foo if the CmpP succeeds.\n-          int obj_in_map = map()->find_edge(obj);\n-          JVMState* jvms = this->jvms();\n-          if (obj_in_map >= 0 &&\n-              (jvms->is_loc(obj_in_map) || jvms->is_stk(obj_in_map))) {\n-            TypeNode* ccast = new CheckCastPPNode(control(), obj, tboth);\n-            const Type* tcc = ccast->as_Type()->type();\n-            assert(tcc != obj_type && tcc->higher_equal(obj_type), \"must improve\");\n-            \/\/ Delay transform() call to allow recovery of pre-cast value\n-            \/\/ at the control merge.\n-            _gvn.set_type_bottom(ccast);\n-            record_for_igvn(ccast);\n-            \/\/ Here's the payoff.\n-            replace_in_map(obj, ccast);\n-          }\n-       }\n+  Node* obj = nullptr;\n+  const TypeOopPtr* cast_type = nullptr;\n+  \/\/ Insert a cast node with a narrowed type after a successful type check.\n+  if (match_type_check(_gvn, btest, con, tcon, val, tval,\n+                       &obj, &cast_type)) {\n+    assert(obj != nullptr && cast_type != nullptr, \"missing type check info\");\n+    const Type* obj_type = _gvn.type(obj);\n+    const TypeOopPtr* tboth = obj_type->join_speculative(cast_type)->isa_oopptr();\n+    if (tboth != nullptr && tboth != obj_type && tboth->higher_equal(obj_type)) {\n+      int obj_in_map = map()->find_edge(obj);\n+      JVMState* jvms = this->jvms();\n+      if (obj_in_map >= 0 &&\n+          (jvms->is_loc(obj_in_map) || jvms->is_stk(obj_in_map))) {\n+        TypeNode* ccast = new CheckCastPPNode(control(), obj, tboth);\n+        const Type* tcc = ccast->as_Type()->type();\n+        assert(tcc != obj_type && tcc->higher_equal(obj_type), \"must improve\");\n+        \/\/ Delay transform() call to allow recovery of pre-cast value\n+        \/\/ at the control merge.\n+        _gvn.set_type_bottom(ccast);\n+        record_for_igvn(ccast);\n+        \/\/ Here's the payoff.\n+        replace_in_map(obj, ccast);\n+      }\n","filename":"src\/hotspot\/share\/opto\/parse2.cpp","additions":100,"deletions":29,"binary":false,"changes":129,"status":"modified"},{"patch":"@@ -1079,1 +1079,2 @@\n-      is_verify_Identity()) {\n+      is_verify_Identity() ||\n+      is_verify_invariants()) {\n@@ -1091,0 +1092,1 @@\n+      if (is_verify_invariants()) { failure |= verify_node_invariants_for(n); }\n@@ -1105,1 +1107,1 @@\n-    assert(!failure, \"Missed optimization opportunity in PhaseIterGVN\");\n+    assert(!failure, \"Missed optimization opportunity\/broken graph in PhaseIterGVN\");\n@@ -2061,0 +2063,15 @@\n+\n+\/\/ Some other verifications that are not specific to a particular transformation.\n+bool PhaseIterGVN::verify_node_invariants_for(const Node* n) {\n+  if (n->is_AddP()) {\n+    if (!n->as_AddP()->address_input_has_same_base()) {\n+      stringStream ss; \/\/ Print as a block without tty lock.\n+      ss.cr();\n+      ss.print_cr(\"Base pointers must match for AddP chain:\");\n+      n->dump_bfs(2, nullptr, \"\", &ss);\n+      tty->print_cr(\"%s\", ss.as_string());\n+      return true;\n+    }\n+  }\n+  return false;\n+}\n","filename":"src\/hotspot\/share\/opto\/phaseX.cpp","additions":19,"deletions":2,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -496,0 +496,1 @@\n+  bool verify_node_invariants_for(const Node* n);\n@@ -619,0 +620,4 @@\n+  static bool is_verify_invariants() {\n+    \/\/ '-XX:VerifyIterativeGVN=10000'\n+    return ((VerifyIterativeGVN % 100000) \/ 10000) == 1;\n+  }\n","filename":"src\/hotspot\/share\/opto\/phaseX.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-  ProjNode* other_proj = success_proj->other_if_proj();\n+  IfProjNode* other_proj = success_proj->other_if_proj();\n@@ -399,1 +399,1 @@\n-  ProjNode* other_proj = success_proj->other_if_proj();\n+  IfProjNode* other_proj = success_proj->other_if_proj();\n","filename":"src\/hotspot\/share\/opto\/predicates.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-#include \"utilities\/tuple.hpp\"\n@@ -691,0 +690,2 @@\n+template class TypeIntPrototype<intn_t<5>, uintn_t<5>>;\n+template class TypeIntPrototype<intn_t<6>, uintn_t<6>>;\n@@ -712,4 +713,1 @@\n-      return CT::make_or_top(TypeIntPrototype<S, U>{{MIN2(i1->_lo, i2->_lo), MAX2(i1->_hi, i2->_hi)},\n-                                                    {MIN2(i1->_ulo, i2->_ulo), MAX2(i1->_uhi, i2->_uhi)},\n-                                                    {i1->_bits._zeros & i2->_bits._zeros, i1->_bits._ones & i2->_bits._ones}},\n-                             MAX2(i1->_widen, i2->_widen), false);\n+      return int_type_union(i1, i2);\n","filename":"src\/hotspot\/share\/opto\/rangeinference.cpp","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+#include \"cppstdlib\/limits.hpp\"\n@@ -95,13 +96,0 @@\n-private:\n-  friend class TypeInt;\n-  friend class TypeLong;\n-\n-  template <class T1, class T2>\n-  friend void test_canonicalize_constraints_exhaustive();\n-\n-  template <class T1, class T2>\n-  friend void test_canonicalize_constraints_simple();\n-\n-  template <class T1, class T2>\n-  friend void test_canonicalize_constraints_random();\n-\n@@ -161,2 +149,13 @@\n-  template <class CT>\n-  static bool int_type_is_equal(const CT* t1, const CT* t2) {\n+  template <class CTP>\n+  static CTP int_type_union(CTP t1, CTP t2) {\n+    using CT = std::conditional_t<std::is_pointer_v<CTP>, std::remove_pointer_t<CTP>, CTP>;\n+    using S = std::remove_const_t<decltype(CT::_lo)>;\n+    using U = std::remove_const_t<decltype(CT::_ulo)>;\n+    return CT::make(TypeIntPrototype<S, U>{{MIN2(t1->_lo, t2->_lo), MAX2(t1->_hi, t2->_hi)},\n+                                           {MIN2(t1->_ulo, t2->_ulo), MAX2(t1->_uhi, t2->_uhi)},\n+                                           {t1->_bits._zeros & t2->_bits._zeros, t1->_bits._ones & t2->_bits._ones}},\n+                    MAX2(t1->_widen, t2->_widen));\n+  }\n+\n+  template <class CTP>\n+  static bool int_type_is_equal(const CTP t1, const CTP t2) {\n@@ -168,2 +167,3 @@\n-  template <class CT>\n-  static bool int_type_is_subset(const CT* super, const CT* sub) {\n+  template <class CTP>\n+  static bool int_type_is_subset(const CTP super, const CTP sub) {\n+    using U = decltype(super->_ulo);\n@@ -175,1 +175,1 @@\n-           (super->_bits._zeros &~ sub->_bits._zeros) == 0 && (super->_bits._ones &~ sub->_bits._ones) == 0;\n+           (super->_bits._zeros &~ sub->_bits._zeros) == U(0) && (super->_bits._ones &~ sub->_bits._ones) == U(0);\n@@ -198,0 +198,195 @@\n+\/\/ A TypeIntMirror is structurally similar to a TypeInt or a TypeLong but it decouples the range\n+\/\/ inference from the Type infrastructure of the compiler. It also allows more flexibility with the\n+\/\/ bit width of the integer type. As a result, it is more efficient to use for intermediate steps\n+\/\/ of inference, as well as more flexible to perform testing on different integer types.\n+template <class S, class U>\n+class TypeIntMirror {\n+public:\n+  S _lo;\n+  S _hi;\n+  U _ulo;\n+  U _uhi;\n+  KnownBits<U> _bits;\n+  int _widen = 0; \/\/ dummy field to mimic the same field in TypeInt, useful in testing\n+\n+  static TypeIntMirror make(const TypeIntPrototype<S, U>& t, int widen) {\n+    auto canonicalized_t = t.canonicalize_constraints();\n+    assert(!canonicalized_t.empty(), \"must not be empty\");\n+    return TypeIntMirror{canonicalized_t._data._srange._lo, canonicalized_t._data._srange._hi,\n+                         canonicalized_t._data._urange._lo, canonicalized_t._data._urange._hi,\n+                         canonicalized_t._data._bits};\n+  }\n+\n+  \/\/ These allow TypeIntMirror to mimick the behaviors of TypeInt* and TypeLong*, so they can be\n+  \/\/ passed into RangeInference methods. These are only used in testing, so they are implemented in\n+  \/\/ the test file.\n+  const TypeIntMirror* operator->() const;\n+  TypeIntMirror meet(const TypeIntMirror& o) const;\n+  bool contains(U u) const;\n+  bool contains(const TypeIntMirror& o) const;\n+  bool operator==(const TypeIntMirror& o) const;\n+\n+  template <class T>\n+  TypeIntMirror cast() const;\n+};\n+\n+\/\/ This class contains methods for inferring the Type of the result of several arithmetic\n+\/\/ operations from those of the corresponding inputs. For example, given a, b such that the Type of\n+\/\/ a is [0, 1] and the Type of b is [-1, 3], then the Type of the sum a + b is [-1, 4].\n+\/\/ The methods in this class receive one or more template parameters which are often TypeInt* or\n+\/\/ TypeLong*, or they can be TypeIntMirror which behave similar to TypeInt* and TypeLong* during\n+\/\/ testing. This allows us to verify the correctness of the implementation without coupling with\n+\/\/ the hotspot compiler allocation infrastructure.\n+class RangeInference {\n+private:\n+  \/\/ If CTP is a pointer, get the underlying type. For the test helper classes, using the struct\n+  \/\/ directly allows straightfoward equality comparison.\n+  template <class CTP>\n+  using CT = std::remove_const_t<std::conditional_t<std::is_pointer_v<CTP>, std::remove_pointer_t<CTP>, CTP>>;\n+\n+  \/\/ The type of CT::_lo, should be jint for TypeInt* and jlong for TypeLong*\n+  template <class CTP>\n+  using S = std::remove_const_t<decltype(CT<CTP>::_lo)>;\n+\n+  \/\/ The type of CT::_ulo, should be juint for TypeInt* and julong for TypeLong*\n+  template <class CTP>\n+  using U = std::remove_const_t<decltype(CT<CTP>::_ulo)>;\n+\n+  \/\/ A TypeInt consists of 1 or 2 simple intervals, each of which will lie either in the interval\n+  \/\/ [0, max_signed] or [min_signed, -1]. It is more optimal to analyze each simple interval\n+  \/\/ separately when doing inference. For example, consider a, b whose Types are both [-2, 2]. By\n+  \/\/ analyzing the interval [-2, -1] and [0, 2] separately, we can easily see that the result of\n+  \/\/ a & b must also be in the interval [-2, 2]. This is much harder if we want to work with the\n+  \/\/ whole value range at the same time.\n+  \/\/ This class offers a convenient way to traverse all the simple interval of a TypeInt.\n+  template <class CTP>\n+  class SimpleIntervalIterable {\n+  private:\n+    TypeIntMirror<S<CTP>, U<CTP>> _first_interval;\n+    TypeIntMirror<S<CTP>, U<CTP>> _second_interval;\n+    int _interval_num;\n+\n+  public:\n+    SimpleIntervalIterable(CTP t) {\n+      if (U<CTP>(t->_lo) <= U<CTP>(t->_hi)) {\n+        _interval_num = 1;\n+        _first_interval = TypeIntMirror<S<CTP>, U<CTP>>{t->_lo, t->_hi, t->_ulo, t->_uhi, t->_bits};\n+      } else {\n+        _interval_num = 2;\n+        _first_interval = TypeIntMirror<S<CTP>, U<CTP>>::make(TypeIntPrototype<S<CTP>, U<CTP>>{{t->_lo, S<CTP>(t->_uhi)}, {U<CTP>(t->_lo), t->_uhi}, t->_bits}, 0);\n+        _second_interval = TypeIntMirror<S<CTP>, U<CTP>>::make(TypeIntPrototype<S<CTP>, U<CTP>>{{S<CTP>(t->_ulo), t->_hi}, {t->_ulo, U<CTP>(t->_hi)}, t->_bits}, 0);\n+      }\n+    }\n+\n+    class Iterator {\n+    private:\n+      const SimpleIntervalIterable& _iterable;\n+      int _current_interval;\n+\n+      Iterator(const SimpleIntervalIterable& iterable) : _iterable(iterable), _current_interval(0) {}\n+\n+      friend class SimpleIntervalIterable;\n+    public:\n+      const TypeIntMirror<S<CTP>, U<CTP>>& operator*() const {\n+        assert(_current_interval < _iterable._interval_num, \"out of bounds, %d - %d\", _current_interval, _iterable._interval_num);\n+        if (_current_interval == 0) {\n+          return _iterable._first_interval;\n+        } else {\n+          return _iterable._second_interval;\n+        }\n+      }\n+\n+      Iterator& operator++() {\n+        assert(_current_interval < _iterable._interval_num, \"out of bounds, %d - %d\", _current_interval, _iterable._interval_num);\n+        _current_interval++;\n+        return *this;\n+      }\n+\n+      bool operator!=(const Iterator& o) const {\n+        assert(&_iterable == &o._iterable, \"not on the same iterable\");\n+        return _current_interval != o._current_interval;\n+      }\n+    };\n+\n+    Iterator begin() const {\n+      return Iterator(*this);\n+    }\n+\n+    Iterator end() const {\n+      Iterator res(*this);\n+      res._current_interval = _interval_num;\n+      return res;\n+    }\n+  };\n+\n+  \/\/ Infer a result given the input types of a binary operation\n+  template <class CTP, class Inference>\n+  static CTP infer_binary(CTP t1, CTP t2, Inference infer) {\n+    CTP res;\n+    bool is_init = false;\n+\n+    SimpleIntervalIterable<CTP> t1_simple_intervals(t1);\n+    SimpleIntervalIterable<CTP> t2_simple_intervals(t2);\n+\n+    for (auto& st1 : t1_simple_intervals) {\n+      for (auto& st2 : t2_simple_intervals) {\n+        CTP current = infer(st1, st2);\n+\n+        if (is_init) {\n+          res = res->meet(current)->template cast<CT<CTP>>();\n+        } else {\n+          is_init = true;\n+          res = current;\n+        }\n+      }\n+    }\n+\n+    assert(is_init, \"must be initialized\");\n+    return res;\n+  }\n+\n+public:\n+  template <class CTP>\n+  static CTP infer_and(CTP t1, CTP t2) {\n+    return infer_binary(t1, t2, [&](const TypeIntMirror<S<CTP>, U<CTP>>& st1, const TypeIntMirror<S<CTP>, U<CTP>>& st2) {\n+      S<CTP> lo = std::numeric_limits<S<CTP>>::min();\n+      S<CTP> hi = std::numeric_limits<S<CTP>>::max();\n+      U<CTP> ulo = std::numeric_limits<U<CTP>>::min();\n+      \/\/ The unsigned value of the result of 'and' is always not greater than both of its inputs\n+      \/\/ since there is no position at which the bit is 1 in the result and 0 in either input\n+      U<CTP> uhi = MIN2(st1._uhi, st2._uhi);\n+      U<CTP> zeros = st1._bits._zeros | st2._bits._zeros;\n+      U<CTP> ones = st1._bits._ones & st2._bits._ones;\n+      return CT<CTP>::make(TypeIntPrototype<S<CTP>, U<CTP>>{{lo, hi}, {ulo, uhi}, {zeros, ones}}, MAX2(t1->_widen, t2->_widen));\n+    });\n+  }\n+\n+  template <class CTP>\n+  static CTP infer_or(CTP t1, CTP t2) {\n+    return infer_binary(t1, t2, [&](const TypeIntMirror<S<CTP>, U<CTP>>& st1, const TypeIntMirror<S<CTP>, U<CTP>>& st2) {\n+      S<CTP> lo = std::numeric_limits<S<CTP>>::min();\n+      S<CTP> hi = std::numeric_limits<S<CTP>>::max();\n+      \/\/ The unsigned value of the result of 'or' is always not less than both of its inputs since\n+      \/\/ there is no position at which the bit is 0 in the result and 1 in either input\n+      U<CTP> ulo = MAX2(st1._ulo, st2._ulo);\n+      U<CTP> uhi = std::numeric_limits<U<CTP>>::max();\n+      U<CTP> zeros = st1._bits._zeros & st2._bits._zeros;\n+      U<CTP> ones = st1._bits._ones | st2._bits._ones;\n+      return CT<CTP>::make(TypeIntPrototype<S<CTP>, U<CTP>>{{lo, hi}, {ulo, uhi}, {zeros, ones}}, MAX2(t1->_widen, t2->_widen));\n+    });\n+  }\n+\n+  template <class CTP>\n+  static CTP infer_xor(CTP t1, CTP t2) {\n+    return infer_binary(t1, t2, [&](const TypeIntMirror<S<CTP>, U<CTP>>& st1, const TypeIntMirror<S<CTP>, U<CTP>>& st2) {\n+      S<CTP> lo = std::numeric_limits<S<CTP>>::min();\n+      S<CTP> hi = std::numeric_limits<S<CTP>>::max();\n+      U<CTP> ulo = std::numeric_limits<U<CTP>>::min();\n+      U<CTP> uhi = std::numeric_limits<U<CTP>>::max();\n+      U<CTP> zeros = (st1._bits._zeros & st2._bits._zeros) | (st1._bits._ones & st2._bits._ones);\n+      U<CTP> ones = (st1._bits._zeros & st2._bits._ones) | (st1._bits._ones & st2._bits._zeros);\n+      return CT<CTP>::make(TypeIntPrototype<S<CTP>, U<CTP>>{{lo, hi}, {ulo, uhi}, {zeros, ones}}, MAX2(t1->_widen, t2->_widen));\n+    });\n+  }\n+};\n+\n","filename":"src\/hotspot\/share\/opto\/rangeinference.hpp","additions":213,"deletions":18,"binary":false,"changes":231,"status":"modified"},{"patch":"@@ -258,1 +258,1 @@\n-      C->gvn_replace_by(n->in(0)->as_If()->proj_out(false), C->top());\n+      C->gvn_replace_by(n->in(0)->as_If()->false_proj(), C->top());\n","filename":"src\/hotspot\/share\/opto\/stringopts.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -801,0 +801,1 @@\n+  static const TypeInt* make(const TypeIntPrototype<jint, juint>& t, int widen) { return make_or_top(t, widen)->is_int(); }\n@@ -882,0 +883,1 @@\n+  static const TypeLong* make(const TypeIntPrototype<jlong, julong>& t, int widen) { return make_or_top(t, widen)->is_long(); }\n","filename":"src\/hotspot\/share\/opto\/type.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1,47 +0,0 @@\n-#ifndef SHARE_OPTO_UTILITIES_XOR_HPP\n-#define SHARE_OPTO_UTILITIES_XOR_HPP\n-\n-#include \"utilities\/powerOfTwo.hpp\"\n-\/\/ Code separated into its own header to allow access from GTEST\n-\n-\/\/ Given 2 non-negative values in the ranges [0, hi_0] and [0, hi_1], respectively. The bitwise\n-\/\/ xor of these values should also be non-negative. This method calculates an upper bound.\n-\n-\/\/ S and U type parameters correspond to the signed and unsigned\n-\/\/ variants of an integer to operate on.\n-template<class S, class U>\n-static S xor_upper_bound_for_ranges(const S hi_0, const S hi_1) {\n-    static_assert(S(-1) < S(0), \"S must be signed\");\n-    static_assert(U(-1) > U(0), \"U must be unsigned\");\n-\n-    assert(hi_0 >= 0, \"must be non-negative\");\n-    assert(hi_1 >= 0, \"must be non-negative\");\n-\n-    \/\/ x ^ y cannot have any bit set that is higher than both the highest bits set in x and y\n-    \/\/ x cannot have any bit set that is higher than the highest bit set in hi_0\n-    \/\/ y cannot have any bit set that is higher than the highest bit set in hi_1\n-\n-    \/\/ We want to find a value that has all 1 bits everywhere up to and including\n-    \/\/ the highest bits set in hi_0 as well as hi_1. For this, we can take the next\n-    \/\/ power of 2 strictly greater than both hi values and subtract 1 from it.\n-\n-    \/\/ Example 1:\n-    \/\/ hi_0 = 5 (0b0101)       hi_1=1 (0b0001)\n-    \/\/    (5|1)+1       = 0b0110\n-    \/\/    round_up_pow2 = 0b1000\n-    \/\/    -1            = 0b0111 = max\n-\n-    \/\/ Example 2 - this demonstrates need for the +1:\n-    \/\/ hi_0 =  4 (0b0100)        hi_1=4 (0b0100)\n-    \/\/    (4|4)+1       = 0b0101\n-    \/\/    round_up_pow2 = 0b1000\n-    \/\/    -1            = 0b0111 = max\n-    \/\/ Without the +1, round_up_pow2 would be 0b0100, resulting in 0b0011 as max\n-\n-    \/\/ Note: cast to unsigned happens before +1 to avoid signed overflow, and\n-    \/\/ round_up is safe because high bit is unset (0 <= lo <= hi)\n-\n-    return round_up_power_of_2(U(hi_0 | hi_1) + 1) - 1;\n-}\n-\n-#endif \/\/ SHARE_OPTO_UTILITIES_XOR_HPP\n","filename":"src\/hotspot\/share\/opto\/utilities\/xor.hpp","additions":0,"deletions":47,"binary":false,"changes":47,"status":"deleted"},{"patch":"@@ -1063,0 +1063,23 @@\n+  \/\/ The speculative check also needs to create the pointer expressions for both\n+  \/\/ VPointers. We must check that we can do that, i.e. that all variables of the\n+  \/\/ VPointers are available at the speculative check (and not just pre-loop invariant).\n+  if (!this->can_make_pointer_expression_at_speculative_check()) {\n+#ifdef ASSERT\n+    if (_vloop.is_trace_speculative_aliasing_analysis()) {\n+      tty->print_cr(\"VPointer::can_make_speculative_aliasing_check_with: not all variables of VPointer are avaialbe at speculative check!\");\n+      this->print_on(tty);\n+    }\n+#endif\n+    return false;\n+  }\n+\n+  if (!other.can_make_pointer_expression_at_speculative_check()) {\n+#ifdef ASSERT\n+    if (_vloop.is_trace_speculative_aliasing_analysis()) {\n+      tty->print_cr(\"VPointer::can_make_speculative_aliasing_check_with: not all variables of VPointer are avaialbe at speculative check!\");\n+      other.print_on(tty);\n+    }\n+#endif\n+    return false;\n+  }\n+\n@@ -1150,0 +1173,2 @@\n+  assert(vp1.can_make_pointer_expression_at_speculative_check(), \"variables must be available early enough to avoid cycles\");\n+  assert(vp2.can_make_pointer_expression_at_speculative_check(), \"variables must be available early enough to avoid cycles\");\n","filename":"src\/hotspot\/share\/opto\/vectorization.cpp","additions":25,"deletions":0,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -1191,0 +1191,16 @@\n+  \/\/ We already know that all non-iv summands are pre loop invariant.\n+  \/\/ See init_are_non_iv_summands_pre_loop_invariant\n+  \/\/ That is good enough for alignment computations in the pre-loop limit. But it is not\n+  \/\/ sufficient if we want to use the variables of the VPointer at the speculative check,\n+  \/\/ which is further up before the pre-loop.\n+  bool can_make_pointer_expression_at_speculative_check() const {\n+    bool success = true;\n+    mem_pointer().for_each_non_empty_summand([&] (const MemPointerSummand& s) {\n+      Node* variable = s.variable();\n+      if (variable != _vloop.iv() && !_vloop.is_available_for_speculative_check(variable)) {\n+        success = false;\n+      }\n+    });\n+    return success;\n+  }\n+\n","filename":"src\/hotspot\/share\/opto\/vectorization.hpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -1214,9 +1214,0 @@\n-class ScopedValueBindingsResolver {\n-public:\n-  InstanceKlass* Carrier_klass;\n-  ScopedValueBindingsResolver(JavaThread* THREAD) {\n-    Klass *k = SystemDictionary::resolve_or_fail(vmSymbols::java_lang_ScopedValue_Carrier(), true, THREAD);\n-    Carrier_klass = InstanceKlass::cast(k);\n-  }\n-};\n-\n@@ -1228,2 +1219,0 @@\n-  static ScopedValueBindingsResolver resolver(THREAD);\n-\n@@ -1242,1 +1231,1 @@\n-          || holder == resolver.Carrier_klass) {\n+          || holder == vmClasses::ScopedValue_Carrier_klass()) {\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":1,"deletions":12,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -1207,0 +1207,3 @@\n+      \/\/ The other thread can block for safepoints during event callbacks, so ensure we\n+      \/\/ are safepoint-safe while waiting.\n+      ThreadBlockInVM tbivm(JavaThread::current());\n@@ -1208,1 +1211,0 @@\n-      \/\/ If another thread is posting events, let it finish\n","filename":"src\/hotspot\/share\/prims\/jvmtiTagMap.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -202,0 +202,4 @@\n+WB_ENTRY(jlong, WB_GetMinimumJavaStackSize(JNIEnv* env, jobject o))\n+  return os::get_minimum_java_stack_size();\n+WB_END\n+\n@@ -3138,1 +3142,2 @@\n-  {CC\"lockAndStuckInSafepoint\", CC\"()V\", (void*)&WB_TakeLockAndHangInSafepoint},\n+  {CC\"lockAndStuckInSafepoint\", CC\"()V\",              (void*)&WB_TakeLockAndHangInSafepoint},\n+  {CC\"getMinimumJavaStackSize\", CC\"()J\",              (void*)&WB_GetMinimumJavaStackSize},\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"runtime\/os.hpp\"\n@@ -285,0 +286,2 @@\n+      #elif _MSC_VER == 1950\n+        #define HOTSPOT_BUILD_COMPILER \"MS VC++ 18.0 (VS2026)\"\n","filename":"src\/hotspot\/share\/runtime\/abstract_vm_version.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -537,1 +537,0 @@\n-  { \"LockingMode\",                  JDK_Version::jdk(24), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n@@ -543,1 +542,0 @@\n-  { \"PSChunkLargeArrays\",           JDK_Version::jdk(26),  JDK_Version::jdk(27), JDK_Version::jdk(28) },\n@@ -553,3 +551,0 @@\n-#ifdef LINUX\n-  { \"UseOprofile\",                  JDK_Version::jdk(25), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-#endif\n@@ -557,2 +552,0 @@\n-  { \"G1UpdateBufferSize\",           JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"ShenandoahPacing\",             JDK_Version::jdk(25), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n@@ -563,19 +556,1 @@\n-  { \"AdaptiveSizeMajorGCDecayTimeScale\",                JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"AdaptiveSizePolicyInitializingSteps\",              JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"AdaptiveSizePolicyOutputInterval\",                 JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"AdaptiveSizeThroughPutPolicy\",                     JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"AdaptiveTimeWeight\",                               JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"PausePadding\",                                     JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"SurvivorPadding\",                                  JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"TenuredGenerationSizeIncrement\",                   JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"TenuredGenerationSizeSupplement\",                  JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"TenuredGenerationSizeSupplementDecay\",             JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"UseAdaptiveGenerationSizePolicyAtMajorCollection\", JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"UseAdaptiveGenerationSizePolicyAtMinorCollection\", JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"UseAdaptiveSizeDecayMajorGCCost\",                  JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"UseAdaptiveSizePolicyFootprintGoal\",               JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"UseAdaptiveSizePolicyWithSystemGC\",                JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"UsePSAdaptiveSurvivorSizePolicy\",                  JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-\n-  { \"PretenureSizeThreshold\",       JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n-  { \"HeapMaximumCompactionInterval\",JDK_Version::undefined(), JDK_Version::jdk(26), JDK_Version::jdk(27) },\n+  { \"PSChunkLargeArrays\",           JDK_Version::jdk(26),  JDK_Version::jdk(27), JDK_Version::jdk(28) },\n@@ -1120,0 +1095,7 @@\n+void Arguments::set_jvm_flags_file(const char *value) {\n+  if (_jvm_flags_file != nullptr) {\n+    os::free(_jvm_flags_file);\n+  }\n+  _jvm_flags_file = os::strdup_check_oom(value);\n+}\n+\n@@ -2872,0 +2854,4 @@\n+void Arguments::set_ext_dirs(char *value) {\n+  _ext_dirs = os::strdup_check_oom(value);\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":12,"deletions":26,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -28,2 +28,1 @@\n-#include \"logging\/logLevel.hpp\"\n-#include \"logging\/logTag.hpp\"\n+#include \"jni.h\"\n@@ -32,1 +31,1 @@\n-#include \"runtime\/globals.hpp\"\n+#include \"runtime\/flags\/jvmFlag.hpp\"\n@@ -34,3 +33,1 @@\n-#include \"runtime\/os.hpp\"\n-#include \"utilities\/debug.hpp\"\n-#include \"utilities\/vmEnums.hpp\"\n+#include \"utilities\/globalDefinitions.hpp\"\n@@ -40,0 +37,2 @@\n+template <typename E>\n+class GrowableArray;\n@@ -415,6 +414,2 @@\n-  static void set_jvm_flags_file(const char *value) {\n-    if (_jvm_flags_file != nullptr) {\n-      os::free(_jvm_flags_file);\n-    }\n-    _jvm_flags_file = os::strdup_check_oom(value);\n-  }\n+  static void set_jvm_flags_file(const char *value);\n+\n@@ -482,1 +477,1 @@\n-  static void set_ext_dirs(char *value)     { _ext_dirs = os::strdup_check_oom(value); }\n+  static void set_ext_dirs(char *value);\n","filename":"src\/hotspot\/share\/runtime\/arguments.hpp","additions":8,"deletions":13,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-#include \"metaprogramming\/enableIf.hpp\"\n@@ -92,2 +91,6 @@\n-\n-\/\/ (3) Atomic pointers and atomic integers additionally provide\n+\/\/\n+\/\/ (3) Constructors for all atomic types are constexpr, to ensure non-local\n+\/\/ atomic variables are constant initialized (C++17 6.6.2) when initialized\n+\/\/ with suitable arguments.\n+\/\/\n+\/\/ (4) Atomic pointers and atomic integers additionally provide\n@@ -105,1 +108,1 @@\n-\/\/ (4) Atomic integers additionally provide\n+\/\/ (5) Atomic integers additionally provide\n@@ -115,1 +118,1 @@\n-\/\/ (5) Atomic pointers additionally provide\n+\/\/ (6) Atomic pointers additionally provide\n@@ -220,1 +223,1 @@\n-  explicit CommonCore(T value) : _value(value) {}\n+  explicit constexpr CommonCore(T value) : _value(value) {}\n@@ -293,1 +296,1 @@\n-  explicit SupportsArithmetic(T value) : CommonCore<T>(value) {}\n+  explicit constexpr SupportsArithmetic(T value) : CommonCore<T>(value) {}\n@@ -336,1 +339,1 @@\n-  explicit Atomic(T value = 0) : SupportsArithmetic<T>(value) {}\n+  explicit constexpr Atomic(T value = 0) : SupportsArithmetic<T>(value) {}\n@@ -376,1 +379,1 @@\n-  explicit Atomic(T value = 0) : CommonCore<T>(value) {}\n+  explicit constexpr Atomic(T value = 0) : CommonCore<T>(value) {}\n@@ -392,1 +395,1 @@\n-  explicit Atomic(T value = nullptr) : SupportsArithmetic<T>(value) {}\n+  explicit constexpr Atomic(T value = nullptr) : SupportsArithmetic<T>(value) {}\n@@ -413,1 +416,10 @@\n-  static Decayed decay(T x) { return Translator::decay(x); }\n+  \/\/ The decay function and the constructors are constexpr so that a non-local\n+  \/\/ atomic object constructed with constant arguments will be a constant\n+  \/\/ initialization.  One might ask why it's not a problem that some\n+  \/\/ specializations of these functions are not constant expressions. The\n+  \/\/ answer lies in C++17 10.1.5\/6, along with us having *some* constexpr\n+  \/\/ translator decay functions, constexpr ctors for some translated types,\n+  \/\/ and constexpr ctors for some decayed types.  Also, C++23 removes those\n+  \/\/ restrictions on constexpr functions and ctors.\n+\n+  static constexpr Decayed decay(T x) { return Translator::decay(x); }\n@@ -418,1 +430,1 @@\n-  explicit Atomic(UseDecayedCtor) : _value() {}\n+  explicit constexpr Atomic(UseDecayedCtor) : _value() {}\n@@ -427,1 +439,1 @@\n-  Atomic() : Atomic(DefaultCtorSelect()) {}\n+  constexpr Atomic() : Atomic(DefaultCtorSelect()) {}\n@@ -429,1 +441,1 @@\n-  explicit Atomic(T value) : _value(decay(value)) {}\n+  explicit constexpr Atomic(T value) : _value(decay(value)) {}\n","filename":"src\/hotspot\/share\/runtime\/atomic.hpp","additions":26,"deletions":14,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"gc\/shared\/gc_globals.hpp\"\n@@ -86,1 +87,3 @@\n-      create_counter(SUN_THREADS, CPUTimeGroups::CPUTimeType::gc_total);\n+      if (UseG1GC || UseParallelGC) {\n+        create_counter(SUN_THREADS, CPUTimeGroups::CPUTimeType::gc_total);\n+      }\n","filename":"src\/hotspot\/share\/runtime\/cpuTimeCounters.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -309,1 +309,1 @@\n-  const int max_modes = 4;\n+  const int max_modes = 5;\n","filename":"src\/hotspot\/share\/runtime\/flags\/jvmFlagConstraintsCompiler.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -74,0 +74,1 @@\n+#include \"runtime\/os.hpp\"\n@@ -768,0 +769,20 @@\n+\n+void JDK_Version::set_java_version(const char* version) {\n+  _java_version = os::strdup(version);\n+}\n+\n+void JDK_Version::set_runtime_name(const char* name) {\n+  _runtime_name = os::strdup(name);\n+}\n+\n+void JDK_Version::set_runtime_version(const char* version) {\n+  _runtime_version = os::strdup(version);\n+}\n+\n+void JDK_Version::set_runtime_vendor_version(const char* vendor_version) {\n+  _runtime_vendor_version = os::strdup(vendor_version);\n+}\n+\n+void JDK_Version::set_runtime_vendor_vm_bug_url(const char* vendor_vm_bug_url) {\n+  _runtime_vendor_vm_bug_url = os::strdup(vendor_vm_bug_url);\n+}\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":21,"deletions":0,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-#include \"runtime\/os.hpp\"\n@@ -136,3 +135,1 @@\n-  static void set_java_version(const char* version) {\n-    _java_version = os::strdup(version);\n-  }\n+  static void set_java_version(const char* version);\n@@ -143,3 +140,1 @@\n-  static void set_runtime_name(const char* name) {\n-    _runtime_name = os::strdup(name);\n-  }\n+  static void set_runtime_name(const char* name);\n@@ -150,3 +145,1 @@\n-  static void set_runtime_version(const char* version) {\n-    _runtime_version = os::strdup(version);\n-  }\n+  static void set_runtime_version(const char* version);\n@@ -157,3 +150,1 @@\n-  static void set_runtime_vendor_version(const char* vendor_version) {\n-    _runtime_vendor_version = os::strdup(vendor_version);\n-  }\n+  static void set_runtime_vendor_version(const char* vendor_version);\n@@ -164,4 +155,1 @@\n-  static void set_runtime_vendor_vm_bug_url(const char* vendor_vm_bug_url) {\n-    _runtime_vendor_vm_bug_url = os::strdup(vendor_vm_bug_url);\n-  }\n-\n+  static void set_runtime_vendor_vm_bug_url(const char* vendor_vm_bug_url);\n","filename":"src\/hotspot\/share\/runtime\/java.hpp","additions":5,"deletions":17,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -1055,1 +1055,5 @@\n-  if (is_obj_deopt_suspend()) {\n+  \/\/ We mustn't block for object deopt if the thread is\n+  \/\/ currently executing in a JNI critical region, as that\n+  \/\/ can cause deadlock because allocation may be locked out\n+  \/\/ and the object deopt suspender may try to allocate.\n+  if (is_obj_deopt_suspend() && !in_critical()) {\n","filename":"src\/hotspot\/share\/runtime\/javaThread.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -370,1 +370,1 @@\n-  if (exclusive_operation_ongoing()) {\n+  if (_is_exclusive) {\n","filename":"src\/hotspot\/share\/runtime\/mountUnmountDisabler.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,308 @@\n+\/*\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+#include \"logging\/log.hpp\"\n+#include \"runtime\/interfaceSupport.inline.hpp\"\n+#include \"runtime\/javaThread.hpp\"\n+#include \"runtime\/mutexLocker.hpp\"\n+#include \"runtime\/objectMonitorTable.hpp\"\n+#include \"runtime\/safepoint.hpp\"\n+#include \"runtime\/thread.hpp\"\n+#include \"runtime\/timerTrace.hpp\"\n+#include \"runtime\/trimNativeHeap.hpp\"\n+#include \"utilities\/concurrentHashTableTasks.inline.hpp\"\n+#include \"utilities\/globalDefinitions.hpp\"\n+\n+\/\/ -----------------------------------------------------------------------------\n+\/\/ ConcurrentHashTable storing links from objects to ObjectMonitors\n+\n+using ConcurrentTable = ConcurrentHashTable<ObjectMonitorTableConfig, mtObjectMonitor>;\n+\n+static ConcurrentTable* _table = nullptr;\n+static volatile size_t _items_count = 0;\n+static size_t _table_size = 0;\n+static volatile bool _resize = false;\n+\n+class ObjectMonitorTableConfig : public AllStatic {\n+ public:\n+  using Value = ObjectMonitor*;\n+  static uintx get_hash(Value const& value, bool* is_dead) {\n+    return (uintx)value->hash();\n+  }\n+  static void* allocate_node(void* context, size_t size, Value const& value) {\n+    ObjectMonitorTable::inc_items_count();\n+    return AllocateHeap(size, mtObjectMonitor);\n+  };\n+  static void free_node(void* context, void* memory, Value const& value) {\n+    ObjectMonitorTable::dec_items_count();\n+    FreeHeap(memory);\n+  }\n+};\n+\n+class Lookup : public StackObj {\n+  oop _obj;\n+\n+ public:\n+  explicit Lookup(oop obj) : _obj(obj) {}\n+\n+  uintx get_hash() const {\n+    uintx hash = _obj->mark().hash();\n+    assert(hash != 0, \"should have a hash\");\n+    return hash;\n+  }\n+\n+  bool equals(ObjectMonitor** value) {\n+    assert(*value != nullptr, \"must be\");\n+    return (*value)->object_refers_to(_obj);\n+  }\n+\n+  bool is_dead(ObjectMonitor** value) {\n+    assert(*value != nullptr, \"must be\");\n+    return false;\n+  }\n+};\n+\n+class LookupMonitor : public StackObj {\n+  ObjectMonitor* _monitor;\n+\n+ public:\n+  explicit LookupMonitor(ObjectMonitor* monitor) : _monitor(monitor) {}\n+\n+  uintx get_hash() const {\n+    return _monitor->hash();\n+  }\n+\n+  bool equals(ObjectMonitor** value) {\n+    return (*value) == _monitor;\n+  }\n+\n+  bool is_dead(ObjectMonitor** value) {\n+    assert(*value != nullptr, \"must be\");\n+    return (*value)->object_is_dead();\n+  }\n+};\n+\n+void ObjectMonitorTable::inc_items_count() {\n+  AtomicAccess::inc(&_items_count, memory_order_relaxed);\n+}\n+\n+void ObjectMonitorTable::dec_items_count() {\n+  AtomicAccess::dec(&_items_count, memory_order_relaxed);\n+}\n+\n+double ObjectMonitorTable::get_load_factor() {\n+  size_t count = AtomicAccess::load(&_items_count);\n+  return (double)count \/ (double)_table_size;\n+}\n+\n+size_t ObjectMonitorTable::table_size(Thread* current) {\n+  return ((size_t)1) << _table->get_size_log2(current);\n+}\n+\n+size_t ObjectMonitorTable::max_log_size() {\n+  \/\/ TODO[OMTable]: Evaluate the max size.\n+  \/\/ TODO[OMTable]: Need to fix init order to use Universe::heap()->max_capacity();\n+  \/\/                Using MaxHeapSize directly this early may be wrong, and there\n+  \/\/                are definitely rounding errors (alignment).\n+  const size_t max_capacity = MaxHeapSize;\n+  const size_t min_object_size = CollectedHeap::min_dummy_object_size() * HeapWordSize;\n+  const size_t max_objects = max_capacity \/ MAX2(MinObjAlignmentInBytes, checked_cast<int>(min_object_size));\n+  const size_t log_max_objects = log2i_graceful(max_objects);\n+\n+  return MAX2(MIN2<size_t>(SIZE_BIG_LOG2, log_max_objects), min_log_size());\n+}\n+\n+\/\/ ~= log(AvgMonitorsPerThreadEstimate default)\n+size_t ObjectMonitorTable::min_log_size() {\n+  return 10;\n+}\n+\n+template<typename V>\n+size_t ObjectMonitorTable::clamp_log_size(V log_size) {\n+  return MAX2(MIN2(log_size, checked_cast<V>(max_log_size())), checked_cast<V>(min_log_size()));\n+}\n+\n+size_t ObjectMonitorTable::initial_log_size() {\n+  const size_t estimate = log2i(MAX2(os::processor_count(), 1)) + log2i(MAX2(AvgMonitorsPerThreadEstimate, size_t(1)));\n+  return clamp_log_size(estimate);\n+}\n+\n+size_t ObjectMonitorTable::grow_hint() {\n+  return ConcurrentTable::DEFAULT_GROW_HINT;\n+}\n+\n+void ObjectMonitorTable::create() {\n+  _table = new ConcurrentTable(initial_log_size(), max_log_size(), grow_hint());\n+  _items_count = 0;\n+  _table_size = table_size(Thread::current());\n+  _resize = false;\n+}\n+\n+void ObjectMonitorTable::verify_monitor_get_result(oop obj, ObjectMonitor* monitor) {\n+#ifdef ASSERT\n+  if (SafepointSynchronize::is_at_safepoint()) {\n+    bool has_monitor = obj->mark().has_monitor();\n+    assert(has_monitor == (monitor != nullptr),\n+           \"Inconsistency between markWord and ObjectMonitorTable has_monitor: %s monitor: \" PTR_FORMAT,\n+           BOOL_TO_STR(has_monitor), p2i(monitor));\n+  }\n+#endif\n+}\n+\n+ObjectMonitor* ObjectMonitorTable::monitor_get(Thread* current, oop obj) {\n+  ObjectMonitor* result = nullptr;\n+  Lookup lookup_f(obj);\n+  auto found_f = [&](ObjectMonitor** found) {\n+    assert((*found)->object_peek() == obj, \"must be\");\n+    result = *found;\n+  };\n+  _table->get(current, lookup_f, found_f);\n+  verify_monitor_get_result(obj, result);\n+  return result;\n+}\n+\n+void ObjectMonitorTable::try_notify_grow() {\n+  if (!_table->is_max_size_reached() && !AtomicAccess::load(&_resize)) {\n+    AtomicAccess::store(&_resize, true);\n+    if (Service_lock->try_lock()) {\n+      Service_lock->notify();\n+      Service_lock->unlock();\n+    }\n+  }\n+}\n+\n+bool ObjectMonitorTable::should_grow() {\n+  return get_load_factor() > GROW_LOAD_FACTOR && !_table->is_max_size_reached();\n+}\n+\n+bool ObjectMonitorTable::should_resize() {\n+  return should_grow() || should_shrink() || AtomicAccess::load(&_resize);\n+}\n+\n+template <typename Task, typename... Args>\n+bool ObjectMonitorTable::run_task(JavaThread* current, Task& task, const char* task_name, Args&... args) {\n+  if (task.prepare(current)) {\n+    log_trace(monitortable)(\"Started to %s\", task_name);\n+    TraceTime timer(task_name, TRACETIME_LOG(Debug, monitortable, perf));\n+    while (task.do_task(current, args...)) {\n+      task.pause(current);\n+      {\n+        ThreadBlockInVM tbivm(current);\n+      }\n+      task.cont(current);\n+    }\n+    task.done(current);\n+    return true;\n+  }\n+  return false;\n+}\n+\n+bool ObjectMonitorTable::grow(JavaThread* current) {\n+  ConcurrentTable::GrowTask grow_task(_table);\n+  if (run_task(current, grow_task, \"Grow\")) {\n+    _table_size = table_size(current);\n+    log_info(monitortable)(\"Grown to size: %zu\", _table_size);\n+    return true;\n+  }\n+  return false;\n+}\n+\n+bool ObjectMonitorTable::clean(JavaThread* current) {\n+  ConcurrentTable::BulkDeleteTask clean_task(_table);\n+  auto is_dead = [&](ObjectMonitor** monitor) {\n+    return (*monitor)->object_is_dead();\n+  };\n+  auto do_nothing = [&](ObjectMonitor** monitor) {};\n+  NativeHeapTrimmer::SuspendMark sm(\"ObjectMonitorTable\");\n+  return run_task(current, clean_task, \"Clean\", is_dead, do_nothing);\n+}\n+\n+bool ObjectMonitorTable::resize(JavaThread* current) {\n+  LogTarget(Info, monitortable) lt;\n+  bool success = false;\n+\n+  if (should_grow()) {\n+    lt.print(\"Start growing with load factor %f\", get_load_factor());\n+    success = grow(current);\n+  } else {\n+    if (!_table->is_max_size_reached() && AtomicAccess::load(&_resize)) {\n+      lt.print(\"WARNING: Getting resize hints with load factor %f\", get_load_factor());\n+    }\n+    lt.print(\"Start cleaning with load factor %f\", get_load_factor());\n+    success = clean(current);\n+  }\n+\n+  AtomicAccess::store(&_resize, false);\n+\n+  return success;\n+}\n+\n+ObjectMonitor* ObjectMonitorTable::monitor_put_get(Thread* current, ObjectMonitor* monitor, oop obj) {\n+  \/\/ Enter the monitor into the concurrent hashtable.\n+  ObjectMonitor* result = monitor;\n+  Lookup lookup_f(obj);\n+  auto found_f = [&](ObjectMonitor** found) {\n+    assert((*found)->object_peek() == obj, \"must be\");\n+    result = *found;\n+  };\n+  bool grow;\n+  _table->insert_get(current, lookup_f, monitor, found_f, &grow);\n+  verify_monitor_get_result(obj, result);\n+  if (grow) {\n+    try_notify_grow();\n+  }\n+  return result;\n+}\n+\n+bool ObjectMonitorTable::remove_monitor_entry(Thread* current, ObjectMonitor* monitor) {\n+  LookupMonitor lookup_f(monitor);\n+  return _table->remove(current, lookup_f);\n+}\n+\n+bool ObjectMonitorTable::contains_monitor(Thread* current, ObjectMonitor* monitor) {\n+  LookupMonitor lookup_f(monitor);\n+  bool result = false;\n+  auto found_f = [&](ObjectMonitor** found) {\n+    result = true;\n+  };\n+  _table->get(current, lookup_f, found_f);\n+  return result;\n+}\n+\n+void ObjectMonitorTable::print_on(outputStream* st) {\n+  auto printer = [&] (ObjectMonitor** entry) {\n+    ObjectMonitor* om = *entry;\n+    oop obj = om->object_peek();\n+    st->print(\"monitor=\" PTR_FORMAT \", \", p2i(om));\n+    st->print(\"object=\" PTR_FORMAT, p2i(obj));\n+    assert(obj->mark().hash() == om->hash(), \"hash must match\");\n+    st->cr();\n+    return true;\n+  };\n+  if (SafepointSynchronize::is_at_safepoint()) {\n+    _table->do_safepoint_scan(printer);\n+  } else {\n+    _table->do_scan(Thread::current(), printer);\n+  }\n+}\n","filename":"src\/hotspot\/share\/runtime\/objectMonitorTable.cpp","additions":308,"deletions":0,"binary":false,"changes":308,"status":"added"},{"patch":"@@ -0,0 +1,77 @@\n+\/*\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+#ifndef SHARE_RUNTIME_OBJECTMONITORTABLE_HPP\n+#define SHARE_RUNTIME_OBJECTMONITORTABLE_HPP\n+\n+#include \"memory\/allStatic.hpp\"\n+#include \"oops\/oopsHierarchy.hpp\"\n+#include \"utilities\/globalDefinitions.hpp\"\n+\n+class JavaThread;\n+class ObjectMonitor;\n+class ObjectMonitorTableConfig;\n+class outputStream;\n+class Thread;\n+\n+class ObjectMonitorTable : AllStatic {\n+  friend class ObjectMonitorTableConfig;\n+\n+ private:\n+  static void inc_items_count();\n+  static void dec_items_count();\n+  static double get_load_factor();\n+  static size_t table_size(Thread* current);\n+  static size_t max_log_size();\n+  static size_t min_log_size();\n+\n+  template <typename V>\n+  static size_t clamp_log_size(V log_size);\n+  static size_t initial_log_size();\n+  static size_t grow_hint();\n+\n+ public:\n+  static void create();\n+  static void verify_monitor_get_result(oop obj, ObjectMonitor* monitor);\n+  static ObjectMonitor* monitor_get(Thread* current, oop obj);\n+  static void try_notify_grow();\n+  static bool should_shrink() { return false; } \/\/ Not implemented\n+\n+  static constexpr double GROW_LOAD_FACTOR = 0.75;\n+\n+  static bool should_grow();\n+  static bool should_resize();\n+\n+  template <typename Task, typename... Args>\n+  static bool run_task(JavaThread* current, Task& task, const char* task_name, Args&... args);\n+  static bool grow(JavaThread* current);\n+  static bool clean(JavaThread* current);\n+  static bool resize(JavaThread* current);\n+  static ObjectMonitor* monitor_put_get(Thread* current, ObjectMonitor* monitor, oop obj);\n+  static bool remove_monitor_entry(Thread* current, ObjectMonitor* monitor);\n+  static bool contains_monitor(Thread* current, ObjectMonitor* monitor);\n+  static void print_on(outputStream* st);\n+};\n+\n+#endif \/\/ SHARE_RUNTIME_OBJECTMONITORTABLE_HPP\n","filename":"src\/hotspot\/share\/runtime\/objectMonitorTable.hpp","additions":77,"deletions":0,"binary":false,"changes":77,"status":"added"},{"patch":"@@ -2584,0 +2584,4 @@\n+jlong os::get_minimum_java_stack_size() {\n+  return static_cast<jlong>(_java_thread_min_stack_allowed);\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -393,0 +393,2 @@\n+  \/\/ get allowed minimum java stack size\n+  static jlong get_minimum_java_stack_size();\n@@ -983,4 +985,1 @@\n-  \/\/ Thread CPU Time - return the fast estimate on a platform\n-  \/\/ On Linux   - fast clock_gettime where available - user+sys\n-  \/\/            - otherwise: very slow \/proc fs - user+sys\n-  \/\/ On Windows - GetThreadTimes - user+sys\n+  \/\/ Thread CPU Time - return the fast estimate on a platform - user+sys\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -47,0 +47,1 @@\n+#include \"runtime\/objectMonitorTable.hpp\"\n@@ -1473,285 +1474,0 @@\n-\/\/ -----------------------------------------------------------------------------\n-\/\/ ConcurrentHashTable storing links from objects to ObjectMonitors\n-class ObjectMonitorTable : AllStatic {\n-  struct Config {\n-    using Value = ObjectMonitor*;\n-    static uintx get_hash(Value const& value, bool* is_dead) {\n-      return (uintx)value->hash();\n-    }\n-    static void* allocate_node(void* context, size_t size, Value const& value) {\n-      ObjectMonitorTable::inc_items_count();\n-      return AllocateHeap(size, mtObjectMonitor);\n-    };\n-    static void free_node(void* context, void* memory, Value const& value) {\n-      ObjectMonitorTable::dec_items_count();\n-      FreeHeap(memory);\n-    }\n-  };\n-  using ConcurrentTable = ConcurrentHashTable<Config, mtObjectMonitor>;\n-\n-  static ConcurrentTable* _table;\n-  static volatile size_t _items_count;\n-  static size_t _table_size;\n-  static volatile bool _resize;\n-\n-  class Lookup : public StackObj {\n-    oop _obj;\n-\n-   public:\n-    explicit Lookup(oop obj) : _obj(obj) {}\n-\n-    uintx get_hash() const {\n-      uintx hash = _obj->mark().hash();\n-      assert(hash != 0, \"should have a hash\");\n-      return hash;\n-    }\n-\n-    bool equals(ObjectMonitor** value) {\n-      assert(*value != nullptr, \"must be\");\n-      return (*value)->object_refers_to(_obj);\n-    }\n-\n-    bool is_dead(ObjectMonitor** value) {\n-      assert(*value != nullptr, \"must be\");\n-      return false;\n-    }\n-  };\n-\n-  class LookupMonitor : public StackObj {\n-    ObjectMonitor* _monitor;\n-\n-   public:\n-    explicit LookupMonitor(ObjectMonitor* monitor) : _monitor(monitor) {}\n-\n-    uintx get_hash() const {\n-      return _monitor->hash();\n-    }\n-\n-    bool equals(ObjectMonitor** value) {\n-      return (*value) == _monitor;\n-    }\n-\n-    bool is_dead(ObjectMonitor** value) {\n-      assert(*value != nullptr, \"must be\");\n-      return (*value)->object_is_dead();\n-    }\n-  };\n-\n-  static void inc_items_count() {\n-    AtomicAccess::inc(&_items_count, memory_order_relaxed);\n-  }\n-\n-  static void dec_items_count() {\n-    AtomicAccess::dec(&_items_count, memory_order_relaxed);\n-  }\n-\n-  static double get_load_factor() {\n-    size_t count = AtomicAccess::load(&_items_count);\n-    return (double)count \/ (double)_table_size;\n-  }\n-\n-  static size_t table_size(Thread* current = Thread::current()) {\n-    return ((size_t)1) << _table->get_size_log2(current);\n-  }\n-\n-  static size_t max_log_size() {\n-    \/\/ TODO[OMTable]: Evaluate the max size.\n-    \/\/ TODO[OMTable]: Need to fix init order to use Universe::heap()->max_capacity();\n-    \/\/                Using MaxHeapSize directly this early may be wrong, and there\n-    \/\/                are definitely rounding errors (alignment).\n-    const size_t max_capacity = MaxHeapSize;\n-    const size_t min_object_size = CollectedHeap::min_dummy_object_size() * HeapWordSize;\n-    const size_t max_objects = max_capacity \/ MAX2(MinObjAlignmentInBytes, checked_cast<int>(min_object_size));\n-    const size_t log_max_objects = log2i_graceful(max_objects);\n-\n-    return MAX2(MIN2<size_t>(SIZE_BIG_LOG2, log_max_objects), min_log_size());\n-  }\n-\n-  static size_t min_log_size() {\n-    \/\/ ~= log(AvgMonitorsPerThreadEstimate default)\n-    return 10;\n-  }\n-\n-  template<typename V>\n-  static size_t clamp_log_size(V log_size) {\n-    return MAX2(MIN2(log_size, checked_cast<V>(max_log_size())), checked_cast<V>(min_log_size()));\n-  }\n-\n-  static size_t initial_log_size() {\n-    const size_t estimate = log2i(MAX2(os::processor_count(), 1)) + log2i(MAX2(AvgMonitorsPerThreadEstimate, size_t(1)));\n-    return clamp_log_size(estimate);\n-  }\n-\n-  static size_t grow_hint () {\n-    return ConcurrentTable::DEFAULT_GROW_HINT;\n-  }\n-\n- public:\n-  static void create() {\n-    _table = new ConcurrentTable(initial_log_size(), max_log_size(), grow_hint());\n-    _items_count = 0;\n-    _table_size = table_size();\n-    _resize = false;\n-  }\n-\n-  static void verify_monitor_get_result(oop obj, ObjectMonitor* monitor) {\n-#ifdef ASSERT\n-    if (SafepointSynchronize::is_at_safepoint()) {\n-      bool has_monitor = obj->mark().has_monitor();\n-      assert(has_monitor == (monitor != nullptr),\n-          \"Inconsistency between markWord and ObjectMonitorTable has_monitor: %s monitor: \" PTR_FORMAT,\n-          BOOL_TO_STR(has_monitor), p2i(monitor));\n-    }\n-#endif\n-  }\n-\n-  static ObjectMonitor* monitor_get(Thread* current, oop obj) {\n-    ObjectMonitor* result = nullptr;\n-    Lookup lookup_f(obj);\n-    auto found_f = [&](ObjectMonitor** found) {\n-      assert((*found)->object_peek() == obj, \"must be\");\n-      result = *found;\n-    };\n-    _table->get(current, lookup_f, found_f);\n-    verify_monitor_get_result(obj, result);\n-    return result;\n-  }\n-\n-  static void try_notify_grow() {\n-    if (!_table->is_max_size_reached() && !AtomicAccess::load(&_resize)) {\n-      AtomicAccess::store(&_resize, true);\n-      if (Service_lock->try_lock()) {\n-        Service_lock->notify();\n-        Service_lock->unlock();\n-      }\n-    }\n-  }\n-\n-  static bool should_shrink() {\n-    \/\/ Not implemented;\n-    return false;\n-  }\n-\n-  static constexpr double GROW_LOAD_FACTOR = 0.75;\n-\n-  static bool should_grow() {\n-    return get_load_factor() > GROW_LOAD_FACTOR && !_table->is_max_size_reached();\n-  }\n-\n-  static bool should_resize() {\n-    return should_grow() || should_shrink() || AtomicAccess::load(&_resize);\n-  }\n-\n-  template<typename Task, typename... Args>\n-  static bool run_task(JavaThread* current, Task& task, const char* task_name, Args&... args) {\n-    if (task.prepare(current)) {\n-      log_trace(monitortable)(\"Started to %s\", task_name);\n-      TraceTime timer(task_name, TRACETIME_LOG(Debug, monitortable, perf));\n-      while (task.do_task(current, args...)) {\n-        task.pause(current);\n-        {\n-          ThreadBlockInVM tbivm(current);\n-        }\n-        task.cont(current);\n-      }\n-      task.done(current);\n-      return true;\n-    }\n-    return false;\n-  }\n-\n-  static bool grow(JavaThread* current) {\n-    ConcurrentTable::GrowTask grow_task(_table);\n-    if (run_task(current, grow_task, \"Grow\")) {\n-      _table_size = table_size(current);\n-      log_info(monitortable)(\"Grown to size: %zu\", _table_size);\n-      return true;\n-    }\n-    return false;\n-  }\n-\n-  static bool clean(JavaThread* current) {\n-    ConcurrentTable::BulkDeleteTask clean_task(_table);\n-    auto is_dead = [&](ObjectMonitor** monitor) {\n-      return (*monitor)->object_is_dead();\n-    };\n-    auto do_nothing = [&](ObjectMonitor** monitor) {};\n-    NativeHeapTrimmer::SuspendMark sm(\"ObjectMonitorTable\");\n-    return run_task(current, clean_task, \"Clean\", is_dead, do_nothing);\n-  }\n-\n-  static bool resize(JavaThread* current) {\n-    LogTarget(Info, monitortable) lt;\n-    bool success = false;\n-\n-    if (should_grow()) {\n-      lt.print(\"Start growing with load factor %f\", get_load_factor());\n-      success = grow(current);\n-    } else {\n-      if (!_table->is_max_size_reached() && AtomicAccess::load(&_resize)) {\n-        lt.print(\"WARNING: Getting resize hints with load factor %f\", get_load_factor());\n-      }\n-      lt.print(\"Start cleaning with load factor %f\", get_load_factor());\n-      success = clean(current);\n-    }\n-\n-    AtomicAccess::store(&_resize, false);\n-\n-    return success;\n-  }\n-\n-  static ObjectMonitor* monitor_put_get(Thread* current, ObjectMonitor* monitor, oop obj) {\n-    \/\/ Enter the monitor into the concurrent hashtable.\n-    ObjectMonitor* result = monitor;\n-    Lookup lookup_f(obj);\n-    auto found_f = [&](ObjectMonitor** found) {\n-      assert((*found)->object_peek() == obj, \"must be\");\n-      result = *found;\n-    };\n-    bool grow;\n-    _table->insert_get(current, lookup_f, monitor, found_f, &grow);\n-    verify_monitor_get_result(obj, result);\n-    if (grow) {\n-      try_notify_grow();\n-    }\n-    return result;\n-  }\n-\n-  static bool remove_monitor_entry(Thread* current, ObjectMonitor* monitor) {\n-    LookupMonitor lookup_f(monitor);\n-    return _table->remove(current, lookup_f);\n-  }\n-\n-  static bool contains_monitor(Thread* current, ObjectMonitor* monitor) {\n-    LookupMonitor lookup_f(monitor);\n-    bool result = false;\n-    auto found_f = [&](ObjectMonitor** found) {\n-      result = true;\n-    };\n-    _table->get(current, lookup_f, found_f);\n-    return result;\n-  }\n-\n-  static void print_on(outputStream* st) {\n-    auto printer = [&] (ObjectMonitor** entry) {\n-       ObjectMonitor* om = *entry;\n-       oop obj = om->object_peek();\n-       st->print(\"monitor=\" PTR_FORMAT \", \", p2i(om));\n-       st->print(\"object=\" PTR_FORMAT, p2i(obj));\n-       assert(obj->mark().hash() == om->hash(), \"hash must match\");\n-       st->cr();\n-       return true;\n-    };\n-    if (SafepointSynchronize::is_at_safepoint()) {\n-      _table->do_safepoint_scan(printer);\n-    } else {\n-      _table->do_scan(Thread::current(), printer);\n-    }\n-  }\n-};\n-\n-ObjectMonitorTable::ConcurrentTable* ObjectMonitorTable::_table = nullptr;\n-volatile size_t ObjectMonitorTable::_items_count = 0;\n-size_t ObjectMonitorTable::_table_size = 0;\n-volatile bool ObjectMonitorTable::_resize = false;\n-\n","filename":"src\/hotspot\/share\/runtime\/synchronizer.cpp","additions":1,"deletions":285,"binary":false,"changes":286,"status":"modified"},{"patch":"@@ -101,13 +101,13 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<HelpDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VersionDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CommandLineDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintSystemPropertiesDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintVMFlagsDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SetVMFlagDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VMDynamicLibrariesDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VMUptimeDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VMInfoDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemGCDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<RunFinalizationDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<HeapInfoDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<FinalizerInfoDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<HelpDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VersionDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CommandLineDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintSystemPropertiesDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PrintVMFlagsDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SetVMFlagDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VMDynamicLibrariesDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VMUptimeDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VMInfoDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemGCDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<RunFinalizationDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<HeapInfoDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<FinalizerInfoDCmd>(full_export));\n@@ -115,9 +115,9 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<HeapDumpDCmd>(DCmd_Source_Internal | DCmd_Source_AttachAPI, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassHistogramDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemDictionaryDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassHierarchyDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassesDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SymboltableDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<StringtableDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<metaspace::MetaspaceDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<EventLogDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<HeapDumpDCmd>(DCmd_Source_Internal | DCmd_Source_AttachAPI));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassHistogramDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemDictionaryDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassHierarchyDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassesDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SymboltableDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<StringtableDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<metaspace::MetaspaceDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<EventLogDCmd>(full_export));\n@@ -125,1 +125,1 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JVMTIAgentLoadDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JVMTIAgentLoadDCmd>(full_export));\n@@ -129,1 +129,1 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JVMTIDataDumpDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JVMTIDataDumpDCmd>(full_export));\n@@ -131,1 +131,1 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ThreadDumpDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ThreadDumpDCmd>(full_export));\n@@ -133,1 +133,1 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ThreadDumpToFileDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ThreadDumpToFileDCmd>(full_export));\n@@ -135,7 +135,7 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VThreadSchedulerDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VThreadPollersDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassLoaderStatsDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassLoaderHierarchyDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompileQueueDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CodeListDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CodeCacheDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VThreadSchedulerDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<VThreadPollersDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassLoaderStatsDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<ClassLoaderHierarchyDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompileQueueDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CodeListDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CodeCacheDCmd>(full_export));\n@@ -143,3 +143,3 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PerfMapDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<TrimCLibcHeapDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<MallocInfoDcmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<PerfMapDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<TrimCLibcHeapDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<MallocInfoDcmd>(full_export));\n@@ -148,2 +148,2 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemMapDCmd>(full_export, true,false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemDumpMapDCmd>(full_export, true,false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemMapDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<SystemDumpMapDCmd>(full_export));\n@@ -151,1 +151,1 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CodeHeapAnalyticsDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CodeHeapAnalyticsDCmd>(full_export));\n@@ -153,5 +153,5 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesPrintDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesAddDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesRemoveDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesClearDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilationMemoryStatisticDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesPrintDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesAddDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesRemoveDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilerDirectivesClearDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<CompilationMemoryStatisticDCmd>(full_export));\n@@ -162,4 +162,4 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStartRemoteDCmd>(jmx_agent_export_flags, true,false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStartLocalDCmd>(jmx_agent_export_flags, true,false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStopRemoteDCmd>(jmx_agent_export_flags, true,false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStatusDCmd>(jmx_agent_export_flags, true,false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStartRemoteDCmd>(jmx_agent_export_flags));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStartLocalDCmd>(jmx_agent_export_flags));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStopRemoteDCmd>(jmx_agent_export_flags));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<JMXStatusDCmd>(jmx_agent_export_flags));\n@@ -168,2 +168,2 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<DumpSharedArchiveDCmd>(full_export, true, false));\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<AOTEndRecordingDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<DumpSharedArchiveDCmd>(full_export));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<AOTEndRecordingDCmd>(full_export));\n@@ -172,1 +172,1 @@\n-  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<NMTDCmd>(full_export, true, false));\n+  DCmdFactory::register_DCmdFactory(new DCmdFactoryImpl<NMTDCmd>(full_export));\n@@ -195,2 +195,1 @@\n-      output()->print_cr(\"%s%s\", factory->name(),\n-                         factory->is_enabled() ? \"\" : \" [disabled]\");\n+      output()->print_cr(\"%s\", factory->name());\n@@ -206,2 +205,1 @@\n-      output()->print_cr(\"%s%s\", factory->name(),\n-                         factory->is_enabled() ? \"\" : \" [disabled]\");\n+      output()->print_cr(\"%s\", factory->name());\n@@ -226,2 +224,1 @@\n-      output()->print_cr(\"%s%s\", factory->name(),\n-                         factory->is_enabled() ? \"\" : \" [disabled]\");\n+      output()->print_cr(\"%s\", factory->name());\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":54,"deletions":57,"binary":false,"changes":111,"status":"modified"},{"patch":"@@ -566,4 +566,0 @@\n-    if (!f->is_enabled()) {\n-      THROW_MSG_NULL(vmSymbols::java_lang_IllegalArgumentException(),\n-                     f->disabled_message());\n-    }\n@@ -597,2 +593,1 @@\n-                    factory->num_arguments(),\n-                    factory->is_enabled()));\n+                    factory->num_arguments()));\n","filename":"src\/hotspot\/share\/services\/diagnosticFramework.cpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -120,1 +120,0 @@\n-  const bool        _is_enabled;     \/* True if the diagnostic command can be invoked, false otherwise *\/\n@@ -125,2 +124,1 @@\n-          int num_arguments,\n-          bool enabled)\n+          int num_arguments)\n@@ -128,1 +126,1 @@\n-    _num_arguments(num_arguments), _is_enabled(enabled) {}\n+    _num_arguments(num_arguments) {}\n@@ -134,1 +132,0 @@\n-  bool is_enabled() const           { return _is_enabled; }\n@@ -236,2 +233,0 @@\n-  static const char* disabled_message() { return \"Diagnostic command currently disabled\"; }\n-\n@@ -340,2 +335,1 @@\n-\/\/ Each diagnostic command class has its own factory. The DCmdFactory class also\n-\/\/ manages the status of the diagnostic command (hidden, enabled). A DCmdFactory\n+\/\/ Each diagnostic command class has its own factory. A DCmdFactory\n@@ -353,4 +347,0 @@\n-  \/\/ When disabled, a diagnostic command cannot be executed. Any attempt to\n-  \/\/ execute it will result in the printing of the disabled message without\n-  \/\/ instantiating the command.\n-  const bool          _enabled;\n@@ -364,2 +354,2 @@\n-  DCmdFactory(int num_arguments, uint32_t flags, bool enabled, bool hidden)\n-    : _next(nullptr), _enabled(enabled), _hidden(hidden),\n+  DCmdFactory(int num_arguments, uint32_t flags, bool hidden)\n+    : _next(nullptr), _hidden(hidden),\n@@ -367,1 +357,0 @@\n-  bool is_enabled() const       { return _enabled; }\n@@ -376,1 +365,0 @@\n-  virtual const char* disabled_message() const = 0;\n@@ -379,2 +367,0 @@\n-  \/\/ To prevent a diagnostic command from being executed, just set the\n-  \/\/ enabled flag to false.\n@@ -404,2 +390,2 @@\n-  DCmdFactoryImpl(uint32_t flags, bool enabled, bool hidden) :\n-    DCmdFactory(get_num_arguments<DCmdClass>(), flags, enabled, hidden) { }\n+  DCmdFactoryImpl(uint32_t flags, bool hidden = false) :\n+    DCmdFactory(get_num_arguments<DCmdClass>(), flags, hidden) { }\n@@ -419,3 +405,0 @@\n-  const char* disabled_message() const {\n-     return DCmdClass::disabled_message();\n-  }\n","filename":"src\/hotspot\/share\/services\/diagnosticFramework.hpp","additions":7,"deletions":24,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2035,1 +2035,5 @@\n-    infoArray[i].enabled = info->is_enabled();\n+\n+    \/\/ All registered DCmds are always enabled. We set the dcmdInfo::enabled\n+    \/\/ field to true to be compatible with the Java API\n+    \/\/ com.sun.management.internal.DiagnosticCommandInfo.\n+    infoArray[i].enabled = true;\n","filename":"src\/hotspot\/share\/services\/management.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -249,1 +250,1 @@\n-  volatile bool _size_limit_reached;\n+  Atomic<bool> _size_limit_reached;\n@@ -258,1 +259,1 @@\n-  volatile Thread* _resize_lock_owner;\n+  Atomic<Thread*> _resize_lock_owner;\n@@ -276,1 +277,1 @@\n-  volatile Thread* _invisible_epoch;\n+  Atomic<Thread*> _invisible_epoch;\n@@ -438,1 +439,1 @@\n-  bool is_max_size_reached() { return _size_limit_reached; }\n+  bool is_max_size_reached() { return _size_limit_reached.load_relaxed(); }\n@@ -442,1 +443,1 @@\n-  bool is_safepoint_safe() { return _resize_lock_owner == nullptr; }\n+  bool is_safepoint_safe() { return _resize_lock_owner.load_relaxed() == nullptr; }\n","filename":"src\/hotspot\/share\/utilities\/concurrentHashTable.hpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -224,2 +225,2 @@\n-  if (AtomicAccess::load_acquire(&_cht->_invisible_epoch) != nullptr) {\n-    AtomicAccess::release_store_fence(&_cht->_invisible_epoch, (Thread*)nullptr);\n+  if (_cht->_invisible_epoch.load_acquire() != nullptr) {\n+    _cht->_invisible_epoch.release_store_fence(nullptr);\n@@ -285,1 +286,1 @@\n-  assert(_resize_lock_owner == thread, \"Re-size lock not held\");\n+  assert(_resize_lock_owner.load_relaxed() == thread, \"Re-size lock not held\");\n@@ -288,1 +289,1 @@\n-  if (AtomicAccess::load_acquire(&_invisible_epoch) == thread) {\n+  if (_invisible_epoch.load_acquire() == thread) {\n@@ -291,1 +292,1 @@\n-  assert(_invisible_epoch == nullptr, \"Two thread doing bulk operations\");\n+  assert(_invisible_epoch.load_relaxed() == nullptr, \"Two thread doing bulk operations\");\n@@ -294,1 +295,1 @@\n-  AtomicAccess::release_store(&_invisible_epoch, thread);\n+  _invisible_epoch.release_store(thread);\n@@ -303,2 +304,2 @@\n-    if (_resize_lock_owner != nullptr) {\n-      assert(locker != _resize_lock_owner, \"Already own lock\");\n+    if (_resize_lock_owner.load_relaxed() != nullptr) {\n+      assert(locker != _resize_lock_owner.load_relaxed(), \"Already own lock\");\n@@ -312,2 +313,2 @@\n-  _invisible_epoch = nullptr;\n-  _resize_lock_owner = locker;\n+  _invisible_epoch.store_relaxed(nullptr);\n+  _resize_lock_owner.store_relaxed(locker);\n@@ -329,2 +330,2 @@\n-    if (_resize_lock_owner != nullptr) {\n-      assert(locker != _resize_lock_owner, \"Already own lock\");\n+    if (_resize_lock_owner.load_relaxed() != nullptr) {\n+      assert(locker != _resize_lock_owner.load_relaxed(), \"Already own lock\");\n@@ -338,2 +339,2 @@\n-  _resize_lock_owner = locker;\n-  _invisible_epoch = nullptr;\n+  _resize_lock_owner.store_relaxed(locker);\n+  _invisible_epoch.store_relaxed(nullptr);\n@@ -346,3 +347,3 @@\n-  _invisible_epoch = nullptr;\n-  assert(locker == _resize_lock_owner, \"Not unlocked by locker.\");\n-  _resize_lock_owner = nullptr;\n+  _invisible_epoch.store_relaxed(nullptr);\n+  assert(locker == _resize_lock_owner.load_relaxed(), \"Not unlocked by locker.\");\n+  _resize_lock_owner.store_relaxed(nullptr);\n@@ -480,2 +481,2 @@\n-  assert((is_mt && _resize_lock_owner != nullptr) ||\n-         (!is_mt && _resize_lock_owner == thread), \"Re-size lock not held\");\n+  assert((is_mt && _resize_lock_owner.load_relaxed() != nullptr) ||\n+         (!is_mt && _resize_lock_owner.load_relaxed() == thread), \"Re-size lock not held\");\n@@ -699,1 +700,1 @@\n-  assert(_resize_lock_owner == thread, \"Re-size lock not held\");\n+  assert(_resize_lock_owner.load_relaxed() == thread, \"Re-size lock not held\");\n@@ -713,1 +714,1 @@\n-  assert(_resize_lock_owner == thread, \"Re-size lock not held\");\n+  assert(_resize_lock_owner.load_relaxed() == thread, \"Re-size lock not held\");\n@@ -716,1 +717,1 @@\n-  _size_limit_reached = false;\n+  _size_limit_reached.store_relaxed(false);\n@@ -770,1 +771,1 @@\n-    assert(_resize_lock_owner != thread, \"Re-size lock held\");\n+    assert(_resize_lock_owner.load_relaxed() != thread, \"Re-size lock held\");\n@@ -773,1 +774,1 @@\n-  assert(_resize_lock_owner == thread, \"Should be locked by me\");\n+  assert(_resize_lock_owner.load_relaxed() == thread, \"Should be locked by me\");\n@@ -776,1 +777,1 @@\n-  assert(_resize_lock_owner != thread, \"Re-size lock held\");\n+  assert(_resize_lock_owner.load_relaxed() != thread, \"Re-size lock held\");\n@@ -790,1 +791,1 @@\n-  _size_limit_reached = (log2_size == _log2_size_limit);\n+  _size_limit_reached.store_relaxed(log2_size == _log2_size_limit);\n@@ -815,1 +816,1 @@\n-  _size_limit_reached = _new_table->_log2_size == _log2_size_limit;\n+  _size_limit_reached.store_relaxed(_new_table->_log2_size == _log2_size_limit);\n@@ -824,1 +825,1 @@\n-  assert(_resize_lock_owner == thread, \"Should be locked\");\n+  assert(_resize_lock_owner.load_relaxed() == thread, \"Should be locked\");\n@@ -843,1 +844,1 @@\n-    assert(_resize_lock_owner != thread, \"Re-size lock held\");\n+    assert(_resize_lock_owner.load_relaxed() != thread, \"Re-size lock held\");\n@@ -846,1 +847,1 @@\n-  assert(_resize_lock_owner == thread, \"Should be locked by me\");\n+  assert(_resize_lock_owner.load_relaxed() == thread, \"Should be locked by me\");\n@@ -849,1 +850,1 @@\n-  assert(_resize_lock_owner != thread, \"Re-size lock held\");\n+  assert(_resize_lock_owner.load_relaxed() != thread, \"Re-size lock held\");\n@@ -964,1 +965,1 @@\n-  assert(_resize_lock_owner == thread, \"Re-size lock not held\");\n+  assert(_resize_lock_owner.load_relaxed() == thread, \"Re-size lock not held\");\n@@ -1023,1 +1024,1 @@\n-  _size_limit_reached = _table->_log2_size == _log2_size_limit;\n+  _size_limit_reached.store_relaxed(_table->_log2_size == _log2_size_limit);\n@@ -1142,1 +1143,1 @@\n-  assert(_resize_lock_owner != thread, \"Re-size lock held\");\n+  assert(_resize_lock_owner.load_relaxed() != thread, \"Re-size lock held\");\n@@ -1146,1 +1147,1 @@\n-  assert(_resize_lock_owner != thread, \"Re-size lock held\");\n+  assert(_resize_lock_owner.load_relaxed() != thread, \"Re-size lock held\");\n@@ -1208,1 +1209,1 @@\n-  assert(_resize_lock_owner != thread, \"Re-size lock held\");\n+  assert(_resize_lock_owner.load_relaxed() != thread, \"Re-size lock held\");\n","filename":"src\/hotspot\/share\/utilities\/concurrentHashTable.inline.hpp","additions":37,"deletions":36,"binary":false,"changes":73,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -44,1 +45,1 @@\n-    volatile size_t _next;\n+    Atomic<size_t> _next;\n@@ -59,1 +60,1 @@\n-      _next = 0;\n+      _next.store_relaxed(0);\n@@ -65,2 +66,2 @@\n-      if (AtomicAccess::load(&_next) < _limit) {\n-        size_t claimed = AtomicAccess::fetch_then_add(&_next, _size);\n+      if (_next.load_relaxed() < _limit) {\n+        size_t claimed = _next.fetch_then_add(_size);\n@@ -81,1 +82,1 @@\n-      return AtomicAccess::load_acquire(&_next) >= _limit;\n+      return _next.load_acquire() >= _limit;\n@@ -111,1 +112,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner == thread,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() == thread,\n@@ -117,1 +118,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner == thread,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() == thread,\n@@ -125,1 +126,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner != thread,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() != thread,\n@@ -172,1 +173,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner != nullptr,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() != nullptr,\n@@ -180,1 +181,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner != nullptr,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() != nullptr,\n@@ -213,1 +214,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner != nullptr,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() != nullptr,\n@@ -219,1 +220,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner != nullptr,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() != nullptr,\n@@ -256,1 +257,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner != nullptr,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() != nullptr,\n@@ -262,1 +263,1 @@\n-    assert(BucketsOperation::_cht->_resize_lock_owner != nullptr,\n+    assert(BucketsOperation::_cht->_resize_lock_owner.load_relaxed() != nullptr,\n","filename":"src\/hotspot\/share\/utilities\/concurrentHashTableTasks.inline.hpp","additions":15,"deletions":14,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -82,0 +82,1 @@\n+  constexpr bool operator!=(intn_t o) const { return !(*this == o); }\n","filename":"src\/hotspot\/share\/utilities\/intn_t.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"utilities\/spinYield.hpp\"\n@@ -33,0 +34,2 @@\n+  SpinYield sy(4096, 5, millis_to_nanos(1));\n+\n@@ -34,2 +37,0 @@\n-  int ctr = 0;\n-  int Yields = 0;\n@@ -38,13 +39,1 @@\n-      ++ctr;\n-      if ((ctr & 0xFFF) == 0 || !os::is_MP()) {\n-        if (Yields > 5) {\n-          os::naked_short_sleep(1);\n-        }\n-        else {\n-          os::naked_yield();\n-          ++Yields;\n-        }\n-      }\n-      else {\n-        SpinPause();\n-      }\n+      sy.wait();\n","filename":"src\/hotspot\/share\/utilities\/spinCriticalSection.cpp","additions":4,"deletions":15,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -106,0 +107,1 @@\n+    @AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Byte.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -9382,0 +9383,1 @@\n+    @AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Character.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,0 +31,2 @@\n+import jdk.internal.vm.annotation.AOTRuntimeSetup;\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -894,0 +896,1 @@\n+    @AOTSafeClassInitializer\n@@ -896,1 +899,1 @@\n-        static final int high;\n+        @Stable static int high;\n@@ -898,2 +901,1 @@\n-        @Stable\n-        static final Integer[] cache;\n+        @Stable static Integer[] cache;\n@@ -903,0 +905,5 @@\n+            runtimeSetup();\n+        }\n+\n+        @AOTRuntimeSetup\n+        private static void runtimeSetup() {\n@@ -918,22 +925,9 @@\n-            \/\/ Load IntegerCache.archivedCache from archive, if possible\n-            CDS.initializeFromArchive(IntegerCache.class);\n-            int size = (high - low) + 1;\n-\n-            \/\/ Use the archived cache if it exists and is large enough\n-            if (archivedCache == null || size > archivedCache.length) {\n-                Integer[] c = new Integer[size];\n-                int j = low;\n-                \/\/ If archive has Integer cache, we must use all instances from it.\n-                \/\/ Otherwise, the identity checks between archived Integers and\n-                \/\/ runtime-cached Integers would fail.\n-                int archivedSize = (archivedCache == null) ? 0 : archivedCache.length;\n-                for (int i = 0; i < archivedSize; i++) {\n-                    c[i] = archivedCache[i];\n-                    assert j == archivedCache[i];\n-                    j++;\n-                }\n-                \/\/ Fill the rest of the cache.\n-                for (int i = archivedSize; i < size; i++) {\n-                    c[i] = new Integer(j++);\n-                }\n-                archivedCache = c;\n+            Integer[] precomputed = null;\n+            if (cache != null) {\n+                \/\/ IntegerCache has been AOT-initialized.\n+                precomputed = cache;\n+            } else {\n+                \/\/ Legacy CDS archive support (to be deprecated):\n+                \/\/ Load IntegerCache.archivedCache from archive, if possible\n+                CDS.initializeFromArchive(IntegerCache.class);\n+                precomputed = archivedCache;\n@@ -941,1 +935,3 @@\n-            cache = archivedCache;\n+\n+            cache = loadOrInitializeCache(precomputed);\n+            archivedCache = cache; \/\/ Legacy CDS archive support (to be deprecated)\n@@ -946,0 +942,27 @@\n+        private static Integer[] loadOrInitializeCache(Integer[] precomputed) {\n+            int size = (high - low) + 1;\n+\n+            \/\/ Use the precomputed cache if it exists and is large enough\n+            if (precomputed != null && size <= precomputed.length) {\n+                return precomputed;\n+            }\n+\n+            Integer[] c = new Integer[size];\n+            int j = low;\n+            \/\/ If we loading a precomputed cache (from AOT cache or CDS archive),\n+            \/\/ we must use all instances from it.\n+            \/\/ Otherwise, the Integers from the AOT cache (or CDS archive) will not\n+            \/\/ have the same object identity as items in IntegerCache.cache[].\n+            int precomputedSize = (precomputed == null) ? 0 : precomputed.length;\n+            for (int i = 0; i < precomputedSize; i++) {\n+                c[i] = precomputed[i];\n+                assert j == precomputed[i];\n+                j++;\n+            }\n+            \/\/ Fill the rest of the cache.\n+            for (int i = precomputedSize; i < size; i++) {\n+                c[i] = new Integer(j++);\n+            }\n+            return c;\n+        }\n+\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Integer.java","additions":49,"deletions":26,"binary":false,"changes":75,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -914,0 +915,1 @@\n+    @AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Long.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -72,0 +72,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -394,0 +395,1 @@\n+    @AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Module.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -56,0 +56,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -148,0 +149,1 @@\n+@AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ModuleLayer.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -233,0 +234,1 @@\n+    @AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Short.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -47,0 +47,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -158,0 +159,1 @@\n+@AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/java\/lang\/module\/Configuration.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -67,3 +67,6 @@\n- * @jls 5.7.1 Exact Testing Conversions\n- * @jls 5.7.2 Unconditionally Exact Testing Conversions\n- * @jls 15.20.2 The instanceof Operator\n+ * @see <a href=\"..\/..\/..\/..\/..\/specs\/primitive-types-in-patterns-instanceof-switch-jls.html#jls-5.7.1\">\n+ * JLS 5.7.1 Exact Testing Conversions<\/a>\n+ * @see <a href=\"..\/..\/..\/..\/..\/specs\/primitive-types-in-patterns-instanceof-switch-jls.html#jls-5.7.2\">\n+ * JLS 5.7.2 Unconditionally Exact Testing Conversions<\/a>\n+ * @see <a href=\"..\/..\/..\/..\/..\/specs\/primitive-types-in-patterns-instanceof-switch-jls.html#jls-15.20.2\">\n+ * JLS 15.20.2 The instanceof Operator<\/a>\n","filename":"src\/java.base\/share\/classes\/java\/lang\/runtime\/ExactConversionsSupport.java","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -1716,6 +1716,1 @@\n-        FormatStyle fStyle;\n-        try {\n-            fStyle = FormatStyle.fromString(style);\n-        } catch (IllegalArgumentException iae) {\n-            fStyle = FormatStyle.SUBFORMATPATTERN;\n-        }\n+        FormatStyle fStyle = FormatStyle.fromString(style);\n@@ -1979,0 +1974,1 @@\n+    \/\/ WARNING: fromString is dependent on ordinal positioning and Enum names.\n@@ -1980,25 +1976,21 @@\n-        DEFAULT(\"\"),\n-        SHORT(\"short\"),\n-        MEDIUM(\"medium\"),\n-        LONG(\"long\"),\n-        FULL(\"full\"),\n-        INTEGER(\"integer\"),\n-        CURRENCY(\"currency\"),\n-        PERCENT(\"percent\"),\n-        COMPACT_SHORT(\"compact_short\"),\n-        COMPACT_LONG(\"compact_long\"),\n-        OR(\"or\"),\n-        UNIT(\"unit\"),\n-        SUBFORMATPATTERN(null);\n-\n-        private final String text;\n-\n-        \/\/ Differs from FormatType in that the text String is\n-        \/\/ not guaranteed to match the Enum name, thus a text field is used\n-        FormatStyle(String text) {\n-            this.text = text;\n-        }\n-\n-        \/\/ This method returns a FormatStyle (excluding SUBFORMATPATTERN)\n-        \/\/ that matches the passed String. If no FormatStyle is found,\n-        \/\/ an IllegalArgumentException is thrown\n+        \/\/ Special styles\n+        DEFAULT,\n+        SUBFORMATPATTERN,\n+        \/\/ Pre-defined styles\n+        SHORT,\n+        MEDIUM,\n+        LONG,\n+        FULL,\n+        INTEGER,\n+        CURRENCY,\n+        PERCENT,\n+        COMPACT_SHORT,\n+        COMPACT_LONG,\n+        OR,\n+        UNIT;\n+\n+        \/\/ Returns a FormatStyle corresponding to the input text.\n+        \/\/ DEFAULT is the empty String.\n+        \/\/ Pre-defined styles are lower case versions of their enum name\n+        \/\/ (but compared case-insensitive for historical compatibility).\n+        \/\/ SUBFORMATPATTERN is anything else.\n@@ -2006,5 +1998,10 @@\n-            for (FormatStyle style : values()) {\n-                \/\/ Also check trimmed case-insensitive for historical reasons\n-                if (style != FormatStyle.SUBFORMATPATTERN &&\n-                        text.trim().compareToIgnoreCase(style.text) == 0) {\n-                    return style;\n+            var style = text.trim();\n+            if (style.isEmpty()) {\n+                return FormatStyle.DEFAULT;\n+            }\n+            var styles = values();\n+            \/\/ Match starting at the pre-defined styles -> [SHORT:]\n+            for (int i = SHORT.ordinal(); i < styles.length; i++) {\n+                var fStyle = styles[i];\n+                if (style.compareToIgnoreCase(fStyle.name()) == 0) {\n+                    return fStyle;\n@@ -2013,1 +2010,1 @@\n-            throw new IllegalArgumentException();\n+            return FormatStyle.SUBFORMATPATTERN;\n","filename":"src\/java.base\/share\/classes\/java\/text\/MessageFormat.java","additions":34,"deletions":37,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -45,0 +45,3 @@\n+import jdk.internal.vm.annotation.AOTRuntimeSetup;\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n+import jdk.internal.vm.annotation.ForceInline;\n@@ -55,0 +58,1 @@\n+@AOTSafeClassInitializer\n@@ -62,1 +66,1 @@\n-    private static final long SALT32L;\n+    @Stable private static long SALT32L;\n@@ -68,1 +72,2 @@\n-    private static final boolean REVERSE;\n+    @Stable private static boolean REVERSE;\n+\n@@ -70,0 +75,5 @@\n+        runtimeSetup();\n+    }\n+\n+    @AOTRuntimeSetup\n+    private static void runtimeSetup() {\n@@ -105,0 +115,1 @@\n+        \/\/ Legacy CDS archive support (to be deprecated)\n","filename":"src\/java.base\/share\/classes\/java\/util\/ImmutableCollections.java","additions":13,"deletions":2,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -35,1 +35,1 @@\n- * A class that represents an immutable universally unique identifier (UUID).\n+ * A class that represents an immutable Universally Unique IDentifier (UUID).\n@@ -38,3 +38,2 @@\n- * <p> There exist different variants of these global identifiers.  The methods\n- * of this class are for manipulating the Leach-Salz variant, although the\n- * constructors allow the creation of any variant of UUID (described below).\n+ * <p> This class is primarily designed for manipulating Leach-Salz variant UUIDs,\n+ * but it also supports the creation of UUIDs of other variants.\n","filename":"src\/java.base\/share\/classes\/java\/util\/UUID.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -39,0 +39,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -63,0 +64,1 @@\n+@AOTSafeClassInitializer\n@@ -453,0 +455,1 @@\n+    @AOTSafeClassInitializer\n@@ -672,0 +675,1 @@\n+            \/\/ Legacy CDS archive support (to be deprecated)\n","filename":"src\/java.base\/share\/classes\/java\/util\/jar\/Attributes.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -35,0 +36,1 @@\n+@AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/loader\/ArchivedClassLoaders.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -36,0 +37,1 @@\n+@AOTSafeClassInitializer\n@@ -56,0 +58,1 @@\n+        \/\/ Legacy CDS archive support (to be deprecated)\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/math\/FDBigInteger.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -32,0 +33,1 @@\n+@AOTSafeClassInitializer\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/ArchivedBootLayer.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -38,0 +39,1 @@\n+@AOTSafeClassInitializer\n@@ -129,0 +131,1 @@\n+        \/\/ Legacy CDS archive support (to be deprecated)\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/ArchivedModuleGraph.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -33,2 +33,2 @@\n-java.launcher.opt.footer = \\    -cp <Klassensuchpfad mit Verzeichnissen und ZIP-\/JAR-Dateien>\\n    -classpath <Klassensuchpfad mit Verzeichnissen und ZIP-\/JAR-Dateien>\\n    --class-path <Klassensuchpfad mit Verzeichnissen und ZIP-\/JAR-Dateien>\\n                  Eine durch \"{0}\" getrennte Liste mit Verzeichnissen, JAR-Archiven\\n                  und ZIP-Archiven, in denen nach Klassendateien gesucht wird.\\n    -p <Modulpfad>\\n    --module-path <Modulpfad>...\\n                  Eine durch \"{0}\" getrennte Liste mit Elementen, von denen jedes Element ein Dateipfad ist\\n                  zu einem Modul oder einem Verzeichnis mit Modulen ist. Jedes Modul ist entweder\\n                  ein modulares JAR oder ein entpacktes Modulverzeichnis.\\n    --upgrade-module-path <Modulpfad>...\\n                  Eine durch \"{0}\" getrennte Liste mit Elementen, von denen jedes Element ein Dateipfad ist\\n                  zu einem Modul oder einem Verzeichnis mit Modulen ist,\\n                  um upgradefhige Module im Laufzeitimage zu ersetzen. Jedes Modul ist entweder\\n                  ein modulares JAR oder ein entpacktes Modulverzeichnis.\\n    --add-modules <Modulname>[,<Modulname>...]\\n                  Root-Module, die zustzlich zum anfnglichen Modul aufgelst werden sollen.\\n                  <Modulname> kann auch wie folgt lauten: ALL-DEFAULT, ALL-SYSTEM,\\n                  ALL-MODULE-PATH.\\n    --enable-native-access <Modulname>[,<Modulname>...]\\n                  Damit kann der Code in Modulen auf Code und Daten auerhalb der JRE zugreifen.\\n                  <Modulname> kann auch ALL-UNNAMED sein, um den Code im Classpath anzugeben.\\n    --illegal-native-access=<Wert>\\n                  Zugriff auf Code und Daten auerhalb der JRE\\n                  durch Code in Modulen zulassen oder verweigern, fr die der native Zugriff nicht explizit aktiviert ist.\\n                  <Wert> ist \"deny\", \"warn\" oder \"allow\". Der Standardwert ist \"warn\".\\n                  Diese Option wird in einem zuknftigen Release entfernt.\\n    --list-modules\\n                  Listet beobachtbare Module auf und beendet den Vorgang\\n    -d <Modulname>\\n    --describe-module <Modulname>\\n                  Beschreibt ein Modul und beendet den Vorgang\\n    --dry-run     Erstellt eine VM und ldt die Hauptklasse, fhrt aber nicht die Hauptmethode aus.\\n                  Die Option \"--dry-run\" kann ntzlich sein, um die\\n                  Befehlszeilenoptionen, wie die Modulsystemkonfiguration, zu validieren.\\n    --validate-modules\\n                  Validiert alle Module und beendet den Vorgang\\n                  Die Option \"--validate-modules\" kann ntzlich sein, um\\n                  Konflikte und andere Fehler mit Modulen auf dem Modulpfad zu ermitteln.\\n    -D<Name>=<Wert>\\n                  Legt eine Systemeigenschaft fest\\n    -verbose:[class|module|gc|jni]\\n                  Aktiviert die Verbose-Ausgabe fr das angegebene Subsystem\\n    -version      Gibt die Produktversion an den Fehlerstream aus und beendet den Vorgang\\n    --version      Gibt die Produktversion an den Outputstream aus und beendet den Vorgang\\n    -showversion  Gibt die Produktversion an den Fehlerstream aus und setzt den Vorgang fort\\n    --show-version\\n                  Gibt die Produktversion an den Outputstream aus und setzt den Vorgang fort\\n    --show-module-resolution\\n                  Zeigt die Modulauflsungsausgabe beim Start an\\n    -? -h -help\\n                  Gibt diese Hilfemeldung an den Fehlerstream aus\\n    --help        Gibt diese Hilfemeldung an den Outputstream aus\\n    -X            Gibt Hilfe zu zustzlichen Optionen an den Fehlerstream aus\\n    --help-extra  Gibt Hilfe zu zustzlichen Optionen an den Outputstream aus\\n    -ea[:<packagename>...|:<classname>]\\n    -enableassertions[:<packagename>...|:<classname>]\\n                  Aktiviert Assertions mit angegebener \\\n-Granularitt\\n    -da[:<packagename>...|:<classname>]\\n    -disableassertions[:<packagename>...|:<classname>]\\n                  Deaktiviert Assertions mit angegebener Granularitt\\n    -esa | -enablesystemassertions\\n                  Aktiviert System-Assertions\\n    -dsa | -disablesystemassertions\\n                  Deaktiviert System-Assertions\\n    -agentlib:<libname>[=<options>]\\n                  Ldt die native Agent Library <libname>. Beispiel: -agentlib:jdwp\\n                  siehe auch -agentlib:jdwp=help\\n    -agentpath:<pathname>[=<options>]\\n                  Ldt die native Agent Library mit dem vollstndigen Pfadnamen\\n    -javaagent:<jarpath>[=<options>]\\n                  Ldt den Java-Programmiersprachen-Agent, siehe java.lang.instrument\\n    -splash:<imagepath>\\n                  Zeigt den Startbildschirm mit einem angegebenen Bild an\\n                  Skalierte HiDPI-Bilder werden automatisch untersttzt und verwendet,\\n                  falls verfgbar. Der nicht skalierte Bilddateiname (Beispiel: image.ext)\\n                  muss immer als Argument an die Option \"-splash\" bergeben werden.\\n                  Das am besten geeignete angegebene skalierte Bild wird\\n                  automatisch ausgewhlt.\\n                  Weitere Informationen finden Sie in der Dokumentation zur SplashScreen-API\\n    @argument files\\n                  Eine oder mehrere Argumentdateien mit Optionen\\n    --disable-@files\\n                  Verhindert die weitere Erweiterung von Argumentdateien\\n    --enable-preview\\n                  Lsst zu, das Klassen von Vorschaufeatures dieses Release abhngig sind\\nUm ein Argument fr eine lange Option anzugeben, knnen Sie --<Name>=<Wert> oder\\n--<Name> <Wert> verwenden.\\n\n+java.launcher.opt.footer = \\    -cp <Klassensuchpfad mit Verzeichnissen und ZIP-\/JAR-Dateien>\\n    -classpath <Klassensuchpfad mit Verzeichnissen und ZIP-\/JAR-Dateien>\\n    --class-path <Klassensuchpfad mit Verzeichnissen und ZIP-\/JAR-Dateien>\\n                  Eine durch \"{0}\" getrennte Liste mit Verzeichnissen, JAR-Archiven\\n                  und ZIP-Archiven, in denen nach Klassendateien gesucht wird.\\n    -p <Modulpfad>\\n    --module-path <Modulpfad>...\\n                  Eine durch \"{0}\" getrennte Liste mit Elementen, von denen jedes Element ein Dateipfad ist\\n                  zu einem Modul oder einem Verzeichnis mit Modulen ist. Jedes Modul ist entweder\\n                  ein modulares JAR oder ein entpacktes Modulverzeichnis.\\n    --upgrade-module-path <Modulpfad>...\\n                  Eine durch \"{0}\" getrennte Liste mit Elementen, von denen jedes Element ein Dateipfad ist\\n                  zu einem Modul oder einem Verzeichnis mit Modulen ist,\\n                  um upgradefhige Module im Laufzeitimage zu ersetzen. Jedes Modul ist entweder\\n                  ein modulares JAR oder ein entpacktes Modulverzeichnis.\\n    --add-modules <Modulname>[,<Modulname>...]\\n                  Root-Module, die zustzlich zum anfnglichen Modul aufgelst werden sollen.\\n                  <Modulname> kann auch wie folgt lauten: ALL-DEFAULT, ALL-SYSTEM,\\n                  ALL-MODULE-PATH.\\n    --enable-native-access <Modulname>[,<Modulname>...]\\n                  Damit kann der Code in Modulen auf Code und Daten auerhalb der JRE zugreifen.\\n                  <Modulname> kann auch ALL-UNNAMED sein, um den Code im Classpath anzugeben.\\n    --illegal-native-access=<Wert>\\n                  Zugriff auf Code und Daten auerhalb der JRE\\n                  durch Code in Modulen zulassen oder verweigern, fr die der native Zugriff nicht explizit aktiviert ist.\\n                  <Wert> ist \"deny\", \"warn\" oder \"allow\". Der Standardwert ist \"warn\".\\n                  Diese Option wird in einem zuknftigen Release entfernt.\\n    --enable-final-field-mutation <Modulname>[,<Modulname>...]\\n                  Zulassen, dass die endgltigen Instanzfelder durch Code in den angegebenen Modulen mutiert werden.\\n                  <Modulname> kann auch ALL-UNNAMED sein, um den Code im Classpath anzugeben.\\n    --illegal-final-field-mutation=<Wert>\\n                  Erlauben oder verweigern Sie die Mutation von endgltigen Feldern durch Code in Modulen, fr die die Mutation\\n                  von endgltigen Feldern nicht explizit aktiviert ist.\\n                  <Wert> ist \"deny\", \"warn\", \"debug\" oder \"allow\". Der Standardwert ist \"warn\".\\n                  Diese Option wird in einem zuknftigen Release entfernt.\\n    --list-modules\\n                  Listet beobachtbare Module auf und beendet den Vorgang\\n    -d <Modulname>\\n    --describe-module <Modulname>\\n                  Beschreibt ein Modul und beendet den Vorgang\\n    --dry-run     Erstellt eine VM und ldt die Hauptklasse, fhrt aber nicht die Hauptmethode aus.\\n                  Die Option \"--dry-run\" kann ntzlich sein, um die\\n                  Befehlszeilenoptionen, wie die Modulsystemkonfiguration, zu validieren.\\n    --validate-modules\\n                  Validiert alle Module und beendet den Vorgang\\n                  Die Option \"--validate-modules\" kann ntzlich sein, um\\n                  Konflikte und andere Fehler mit Modulen auf dem Modulpfad zu ermitteln.\\n    -D<Name>=<Wert>\\n                  Legt eine Systemeigenschaft fest\\n    -verbose:[class|module|gc|jni]\\n                  Aktiviert die Verbose-Ausgabe fr das angegebene Subsystem\\n    -version      Gibt die Produktversion an den Fehlerstream aus und beendet den Vorgang\\n    --version      Gibt die Produktversion an den Outputstream aus und beendet den Vorgang\\n    -showversion  Gibt die Produktversion an den Fehlerstream aus und \\\n+setzt den Vorgang fort\\n    --show-version\\n                  Gibt die Produktversion an den Outputstream aus und setzt den Vorgang fort\\n    --show-module-resolution\\n                  Zeigt die Modulauflsungsausgabe beim Start an\\n    -? -h -help\\n                  Gibt diese Hilfemeldung an den Fehlerstream aus\\n    --help        Gibt diese Hilfemeldung an den Outputstream aus\\n    -X            Gibt Hilfe zu zustzlichen Optionen an den Fehlerstream aus\\n    --help-extra  Gibt Hilfe zu zustzlichen Optionen an den Outputstream aus\\n    -ea[:<packagename>...|:<classname>]\\n    -enableassertions[:<packagename>...|:<classname>]\\n                  Aktiviert Assertions mit angegebener Granularitt\\n    -da[:<packagename>...|:<classname>]\\n    -disableassertions[:<packagename>...|:<classname>]\\n                  Deaktiviert Assertions mit angegebener Granularitt\\n    -esa | -enablesystemassertions\\n                  Aktiviert System-Assertions\\n    -dsa | -disablesystemassertions\\n                  Deaktiviert System-Assertions\\n    -agentlib:<libname>[=<options>]\\n                  Ldt die native Agent Library <libname>. Beispiel: -agentlib:jdwp\\n                  siehe auch -agentlib:jdwp=help\\n    -agentpath:<pathname>[=<options>]\\n                  Ldt die native Agent Library mit dem vollstndigen Pfadnamen\\n    -javaagent:<jarpath>[=<options>]\\n                  Ldt den Java-Programmiersprachen-Agent, siehe java.lang.instrument\\n    -splash:<imagepath>\\n                  Zeigt den Startbildschirm mit einem angegebenen Bild an\\n                  Skalierte HiDPI-Bilder werden automatisch untersttzt und verwendet,\\n                  falls verfgbar. Der nicht skalierte Bilddateiname (Beispiel: image.ext)\\n                  muss immer als Argument an die Option \"-splash\" bergeben werden.\\n                  Das am besten geeignete angegebene skalierte Bild wird\\n                  automatisch ausgewhlt.\\n                  Weitere Informationen finden Sie in der Dokumentation zur SplashScreen-API\\n    @argument files\\n                  Eine oder mehrere Argumentdateien mit Optionen\\n    --disable-@files\\n                  Verhindert die weitere Erweiterung von Argumentdateien\\n    --enable-preview\\n                  Lsst zu, das Klassen von Vorschaufeatures dieses Release abhngig sind\\nUm ein Argument fr eine lange Option anzugeben, knnen Sie --<Name>=<Wert> oder\\n--<Name> <Wert> verwenden.\\n\n@@ -61,0 +61,1 @@\n+java.launcher.jar.error.illegal.effm.value=Fehler: Ungltiger Wert \"{0}\" fr das Manifestattribut \"Enable-Final-Field-Mutation\". Nur \"ALL-UNNAMED\" ist zulssig\n","filename":"src\/java.base\/share\/classes\/sun\/launcher\/resources\/launcher_de.properties","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -34,2 +34,3 @@\n-<value>\"deny\"\"warn\"\"allow\"\"warn\"\\n                  \\n    --list-modules\\n                  \\n    -d <module name>\\n    --describe-module <module name>\\n                  \\n    --dry-run     VM\\n                  --dry-run:\\n                  \\n    --validate-modules\\n                  \\n                  --validate-modules:\\n                  \\n    -D<name>=<value>\\n                  \\n    -verbose:[class|module|gc|jni]\\n                  \\n    -version      \\n    --version     \\n    -showversion  \\n    --show-version\\n                  \\n    --show-module-resolution\\n                  \\n    -? -h -help\\n                  \\n    --help        \\n    -X            \\n    --help-extra  \\n    -ea[:<packagename>...|:<classname>]\\n    -enableassertions[:<packagename>...|:<classname>]\\n                  \\n    -da[:<packagename>...|:<classname>]\\n    \\\n--disableassertions[:<packagename>...|:<classname>]\\n                  \\n    -esa | -enablesystemassertions\\n                  \\n    -dsa | -disablesystemassertions\\n                  \\n    -agentlib:<libname>[=<options>]\\n                  <libname>: -agentlib:jdwp\\n                  -agentlib:jdwp=help\\n    -agentpath:<pathname>[=<options>]\\n                  \\n    -javaagent:<jarpath>[=<options>]\\n                  Javajava.lang.instrument\\n    -splash:<imagepath>\\n                  \\n                  HiDPI\\n                  ()(image.ext)\\n                  -splash\\n                  \\n                  ()\\n                  SplashScreen API\\n    @argument\\n                  1\\n    --disable-@files\\n                  \\n    --enable-preview\\n                  \\n--<name>=<value>\\n--<name> <value>\\n\n+<value>\"deny\"\"warn\"\"allow\"\"warn\"\\n                  \\n    --enable-final-field-mutation <module name>[,<module name>...]\\n                  final\\n                  <module name>ALL-UNNAMED\\n    --illegal-final-field-mutation=<value>\\n                  finalfinal\\n                  \\n                  <value>\"deny\"\"warn\"\"debug\"\"allow\"\"warn\"\\n                  \\n    --list-modules\\n                  \\n    -d <module name>\\n    --describe-module <module name>\\n                  \\n    --dry-run     VM\\n                  --dry-run:\\n                  \\n    --validate-modules\\n                  \\n                  --validate-modules:\\n                  \\n    -D<name>=<value>\\n                  \\n    -verbose:[class|module|gc|jni]\\n                  \\n    -version      \\n    --version     \\n    -showversion  \\n    --show-version\\n             \\\n+     \\n    --show-module-resolution\\n                  \\n    -? -h -help\\n                  \\n    --help        \\n    -X            \\n    --help-extra  \\n    -ea[:<packagename>...|:<classname>]\\n    -enableassertions[:<packagename>...|:<classname>]\\n                  \\n    -da[:<packagename>...|:<classname>]\\n    -disableassertions[:<packagename>...|:<classname>]\\n                  \\n    -esa | -enablesystemassertions\\n                  \\n    -dsa | -disablesystemassertions\\n                  \\n    -agentlib:<libname>[=<options>]\\n                  <libname>: -agentlib:jdwp\\n                  -agentlib:jdwp=help\\n    -agentpath:<pathname>[=<options>]\\n                  \\n    -javaagent:<jarpath>[=<options>]\\n                  Javajava.lang.instrument\\n    -splash:<imagepath>\\n                  \\n                  HiDPI\\n                  ()(image.ext)\\n                  -splash\\n                  \\n                  ()\\n                  SplashScreen API\\n    @argument\\n                  \\\n+1\\n    --disable-@files\\n                  \\n    --enable-preview\\n                  \\n--<name>=<value>\\n--<name> <value>\\n\n@@ -63,0 +64,1 @@\n+java.launcher.jar.error.illegal.effm.value=: Enable-Final-Field-Mutation\"{0}\"''ALL-UNNAMED''\n","filename":"src\/java.base\/share\/classes\/sun\/launcher\/resources\/launcher_ja.properties","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -33,2 +33,3 @@\n-java.launcher.opt.footer = \\    -cp < zip\/jar >\\n    -classpath < zip\/jar >\\n    --class-path < zip\/jar >\\n                   \"{0}\" JAR \\n                   ZIP \\n    -p <>\\n    --module-path <>...\\n                   \"{0}\" \\n                  \\n                   JAR \\n    --upgrade-module-path <>...\\n                   \"{0}\" \\n                  \\n                  \\n                   JAR \\n    --add-modules <>[,<>...]\\n                  \\n                  <>  ALL-DEFAULT, ALL-SYSTEM,\\n                  ALL-MODULE-PATH.\\n    --enable-native-access <module name>[,<module name>...]\\n                   Java \\n                  <module name>  ALL-UNNAMED\\n    --illegal-native-access=<value>\\n                  \\n                   Java \\n                  <value>  \"deny\"\"warn\"  \"allow\"  \"warn\"\\n                  \\n    --list-modules\\n                  \\n    -d <module name>\\n    --describe-module <>\\n                  \\n    --dry-run      VM ,  main \\n                   --dry-run \\n                  \\n    --validate-modules\\n                  \\n                  --validate-modules \\n                  \\n    -D<>=<>\\n                  \\n    -verbose:[class|module|gc|jni]\\n                  \\n    -version      \\n    --version     \\\n-\\n    -showversion  \\n    --show-version\\n                  \\n    --show-module-resolution\\n                  \\n    -? -h -help\\n                  \\n    --help        \\n    -X            \\n    --help-extra  \\n    -ea[:<>...|:<>]\\n    -enableassertions[:<>...|:<>]\\n                  \\n    -da[:<>...|:<>]\\n    -disableassertions[:<>...|:<>]\\n                  \\n    -esa | -enablesystemassertions\\n                  \\n    -dsa | -disablesystemassertions\\n                  \\n    -agentlib:<>[=<>]\\n                   <>,  -agentlib:jdwp\\n                   -agentlib:jdwp=help\\n    -agentpath:<>[=<>]\\n                  \\n    -javaagent:<jar >[=<>]\\n                   Java ,  java.lang.instrument\\n    -splash:<>\\n                  \\n                   HiDPI \\n                  () (, image.ext)\\n                   -splash \\n                  \\n                  \\n                  ,  SplashScreen API \\n    @argument \\n                  \\n    --disable-@files\\n                  \\n    --enable-preview\\n                  \\n,  --<>=<> \\n--<> <>\\n\n+java.launcher.opt.footer = \\    -cp < zip\/jar >\\n    -classpath < zip\/jar >\\n    --class-path < zip\/jar >\\n                   \"{0}\" JAR \\n                   ZIP \\n    -p <>\\n    --module-path <>...\\n                   \"{0}\" \\n                  \\n                   JAR \\n    --upgrade-module-path <>...\\n                   \"{0}\" \\n                  \\n                  \\n                   JAR \\n    --add-modules <>[,<>...]\\n                  \\n                  <>  ALL-DEFAULT, ALL-SYSTEM,\\n                  ALL-MODULE-PATH.\\n    --enable-native-access <module name>[,<module name>...]\\n                   Java \\n                  <module name>  ALL-UNNAMED\\n    --illegal-native-access=<value>\\n                  \\n                   Java \\n                  <value>  \"deny\"\"warn\"  \"allow\"  \"warn\"\\n                  \\n    --enable-final-field-mutation <module name>[,<module name>...]\\n                  \\n                  <module name>  ALL-UNNAMED\\n    --illegal-final-field-mutation=<value>\\n                  \\n                  \\n                  <value>  \"deny\"\"warn\"\"debug\"  \"allow\"  \"warn\"\\n                  \\n    --list-modules\\n                  \\n    -d <module name>\\n    --describe-module <>\\n                  \\n    --dry-run      VM ,  main \\n                   --dry-run \\\n+\\n                  \\n    --validate-modules\\n                  \\n                  --validate-modules \\n                  \\n    -D<>=<>\\n                  \\n    -verbose:[class|module|gc|jni]\\n                  \\n    -version      \\n    --version     \\n    -showversion  \\n    --show-version\\n                  \\n    --show-module-resolution\\n                  \\n    -? -h -help\\n                  \\n    --help        \\n    -X            \\n    --help-extra  \\n    -ea[:<>...|:<>]\\n    -enableassertions[:<>...|:<>]\\n                  \\n    -da[:<>...|:<>]\\n    -disableassertions[:<>...|:<>]\\n                  \\n    -esa | -enablesystemassertions\\n                  \\n    -dsa | -disablesystemassertions\\n                  \\n    -agentlib:<>[=<>]\\n                   <>,  -agentlib:jdwp\\n                   -agentlib:jdwp=help\\n    -agentpath:<>[=<>]\\n                  \\n    -javaagent:<jar >[=<>]\\n                   Java ,  java.lang.instrument\\n    -splash:<>\\n                  \\n                   HiDPI \\n                  () (, image.ext)\\n                   -splash \\n                  \\n                  \\n                  ,  SplashScreen API \\n    @argument \\n                  \\n    --disable-@files\\n                  \\n    --enable-preview\\n                  \\\n+\\n,  --<>=<> \\n--<> <>\\n\n@@ -52,1 +53,1 @@\n-java.launcher.cls.error6= {0} \\n\\n   public {0}()\n+java.launcher.cls.error6= {0} \\n private\\n   public {0}()\n@@ -61,0 +62,1 @@\n+java.launcher.jar.error.illegal.effm.value=Enable-Final-Field-Mutation  \"{0}\"  ''ALL-UNNAMED''\n","filename":"src\/java.base\/share\/classes\/sun\/launcher\/resources\/launcher_zh_CN.properties","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.io.IOException;\n@@ -431,1 +432,1 @@\n-     * @return true if all goes well, false if no headers were set.\n+     * @throws IOException if no headers were set\n@@ -433,1 +434,2 @@\n-    public abstract boolean setHeaders(HttpURLConnection conn, HeaderParser p, String raw);\n+    public abstract void setHeaders(HttpURLConnection conn, HeaderParser p, String raw)\n+            throws IOException;\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/AuthenticationInfo.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -128,1 +128,0 @@\n-     * @return true if all goes well, false if no headers were set.\n@@ -131,1 +130,1 @@\n-    public boolean setHeaders(HttpURLConnection conn, HeaderParser p, String raw) {\n+    public void setHeaders(HttpURLConnection conn, HeaderParser p, String raw) {\n@@ -136,1 +135,0 @@\n-        return true;\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/BasicAuthentication.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -324,1 +324,5 @@\n-        return getHeaderValueImpl(url.getFile(), method);\n+        try {\n+            return getHeaderValueImpl(url.getFile(), method);\n+        } catch (IOException _) {\n+            return null;\n+        }\n@@ -342,1 +346,5 @@\n-        return getHeaderValueImpl(requestURI, method);\n+        try {\n+            return getHeaderValueImpl(requestURI, method);\n+        } catch (IOException _) {\n+            return null;\n+        }\n@@ -372,1 +380,1 @@\n-     * @return true if all goes well, false if no headers were set.\n+     * @throws IOException if no headers were set\n@@ -375,1 +383,2 @@\n-    public boolean setHeaders(HttpURLConnection conn, HeaderParser p, String raw) {\n+    public void setHeaders(HttpURLConnection conn, HeaderParser p, String raw)\n+            throws IOException {\n@@ -383,1 +392,1 @@\n-        params.setUserhash (Boolean.valueOf(p.findValue(\"userhash\")));\n+        params.setUserhash (Boolean.parseBoolean(p.findValue(\"userhash\")));\n@@ -390,1 +399,1 @@\n-            return false;\n+            throw new IOException(\"Illegal charset in header\");\n@@ -408,1 +417,1 @@\n-            return false;\n+            throw new IOException(\"Server challenge incomplete\");\n@@ -418,2 +427,1 @@\n-        if (!setAlgorithmNames(p, params))\n-            return false;\n+        setAlgorithmNames(p, params);\n@@ -429,7 +437,3 @@\n-        String value = getHeaderValueImpl (uri, method);\n-        if (value != null) {\n-            conn.setAuthenticationProperty(getHeaderName(), value);\n-            return true;\n-        } else {\n-            return false;\n-        }\n+        String value = getHeaderValueImpl(uri, method);\n+        assert value != null;\n+        conn.setAuthenticationProperty(getHeaderName(), value);\n@@ -441,2 +445,3 @@\n-    \/\/ returns false if algorithm not supported\n-    private static boolean setAlgorithmNames(HeaderParser p, Parameters params) {\n+    \/\/ throws IOException if algorithm not supported\n+    private static void setAlgorithmNames(HeaderParser p, Parameters params)\n+            throws IOException {\n@@ -462,1 +467,1 @@\n-            return false;\n+            throw new IOException(\"Unknown algorithm: \" + algorithm);\n@@ -467,1 +472,0 @@\n-        return true;\n@@ -473,1 +477,1 @@\n-    private String getHeaderValueImpl (String uri, String method) {\n+    private String getHeaderValueImpl (String uri, String method) throws IOException {\n@@ -482,5 +486,1 @@\n-        try {\n-            validateDigest(digest);\n-        } catch (IOException e) {\n-            return null;\n-        }\n+        validateDigest(digest);\n@@ -508,1 +508,1 @@\n-            return null;\n+            throw new IOException(\"Failed to compute digest\", ex);\n@@ -537,1 +537,1 @@\n-            return null;\n+            throw new IOException(\"Failed to compute user hash\", ex);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/DigestAuthentication.java","additions":29,"deletions":29,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -64,0 +64,1 @@\n+import jdk.internal.util.Exceptions;\n@@ -1472,2 +1473,4 @@\n-                        if (!proxyAuthentication.setHeaders(this,\n-                                                        authhdr.headerParser(), raw)) {\n+                        try {\n+                            proxyAuthentication.setHeaders(this,\n+                                    authhdr.headerParser(), raw);\n+                        } catch (IOException ex) {\n@@ -1475,1 +1478,5 @@\n-                            throw new IOException (\"Authentication failure\");\n+                            if (Exceptions.enhancedNonSocketExceptions()) {\n+                                throw new IOException (\"Authentication failure\", ex);\n+                            } else {\n+                                throw new IOException (\"Authentication failure\");\n+                            }\n@@ -1477,5 +1484,12 @@\n-                        if (serverAuthentication != null && srvHdr != null &&\n-                                !serverAuthentication.setHeaders(this,\n-                                                        srvHdr.headerParser(), raw)) {\n-                            disconnectInternal ();\n-                            throw new IOException (\"Authentication failure\");\n+                        if (serverAuthentication != null && srvHdr != null) {\n+                            try {\n+                                serverAuthentication.setHeaders(this,\n+                                        srvHdr.headerParser(), raw);\n+                            } catch (IOException ex) {\n+                                disconnectInternal();\n+                                if (Exceptions.enhancedNonSocketExceptions()) {\n+                                    throw new IOException (\"Authentication failure\", ex);\n+                                } else {\n+                                    throw new IOException (\"Authentication failure\");\n+                                }\n+                            }\n@@ -1560,1 +1574,3 @@\n-                        if (!serverAuthentication.setHeaders(this, null, raw)) {\n+                        try {\n+                            serverAuthentication.setHeaders(this, null, raw);\n+                        } catch (IOException ex) {\n@@ -1562,1 +1578,5 @@\n-                            throw new IOException (\"Authentication failure\");\n+                            if (Exceptions.enhancedNonSocketExceptions()) {\n+                                throw new IOException (\"Authentication failure\", ex);\n+                            } else {\n+                                throw new IOException (\"Authentication failure\");\n+                            }\n@@ -1938,2 +1958,4 @@\n-                        if (!proxyAuthentication.setHeaders(this,\n-                                                authhdr.headerParser(), raw)) {\n+                        try {\n+                            proxyAuthentication.setHeaders(this,\n+                                    authhdr.headerParser(), raw);\n+                        } catch (IOException ex) {\n@@ -1941,1 +1963,5 @@\n-                            throw new IOException (\"Authentication failure\");\n+                            if (Exceptions.enhancedNonSocketExceptions()) {\n+                                throw new IOException (\"Authentication failure\", ex);\n+                            } else {\n+                                throw new IOException (\"Authentication failure\");\n+                            }\n@@ -2204,1 +2230,3 @@\n-                if (!ret.setHeaders(this, p, raw)) {\n+                try {\n+                    ret.setHeaders(this, p, raw);\n+                } catch (IOException e) {\n@@ -2361,1 +2389,3 @@\n-                if (!ret.setHeaders(this, p, raw)) {\n+                try {\n+                    ret.setHeaders(this, p, raw);\n+                } catch (IOException e) {\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/HttpURLConnection.java","additions":45,"deletions":15,"binary":false,"changes":60,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -171,1 +171,1 @@\n-     * @return true if all goes well, false if no headers were set.\n+     * @throws IOException if no headers were set\n@@ -174,1 +174,1 @@\n-    public boolean setHeaders(HttpURLConnection conn, HeaderParser p, String raw) {\n+    public void setHeaders(HttpURLConnection conn, HeaderParser p, String raw) throws IOException {\n@@ -179,14 +179,5 @@\n-        try {\n-            String response;\n-            byte[] incoming = null;\n-            String[] parts = raw.split(\"\\\\s+\");\n-            if (parts.length > 1) {\n-                incoming = Base64.getDecoder().decode(parts[1]);\n-            }\n-            response = hci.scheme + \" \" + Base64.getEncoder().encodeToString(\n-                        incoming==null?firstToken():nextToken(incoming));\n-\n-            conn.setAuthenticationProperty(getHeaderName(), response);\n-            return true;\n-        } catch (IOException e) {\n-            return false;\n+        String response;\n+        byte[] incoming = null;\n+        String[] parts = raw.split(\"\\\\s+\");\n+        if (parts.length > 1) {\n+            incoming = Base64.getDecoder().decode(parts[1]);\n@@ -194,0 +185,4 @@\n+        response = hci.scheme + \" \" + Base64.getEncoder().encodeToString(\n+                    incoming==null?firstToken():nextToken(incoming));\n+\n+        conn.setAuthenticationProperty(getHeaderName(), response);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/NegotiateAuthentication.java","additions":12,"deletions":17,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -1558,1 +1558,1 @@\n-    \/\/ precondition: -2^31 * MONT_Q <= a, b < 2^31, -2^31 < a * b < 2^31 * MONT_Q\n+    \/\/ precondition: -2^31 <= a, b < 2^31, -2^31 * MONT_Q <= a * b < 2^31 * MONT_Q\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/ML_DSA.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,0 @@\n-\n@@ -35,1 +34,0 @@\n-\n@@ -43,1 +41,1 @@\n- * validator API in J2SE core. The logic in this class is minimal.<p>\n+ * validator API in J2SE core. The logic in this class is minimal.\n@@ -46,5 +44,1 @@\n- * JSSE versions and PKIX validation. Currently, it is not possible for the\n- * application to specify PKIX parameters other than trust anchors. This will\n- * be fixed in a future release using new APIs. When that happens, it may also\n- * make sense to separate the Simple and PKIX trust managers into separate\n- * classes.\n+ * JSSE versions and PKIX validation.\n@@ -54,2 +48,1 @@\n-final class X509TrustManagerImpl extends X509ExtendedTrustManager\n-        implements X509TrustManager {\n+final class X509TrustManagerImpl extends X509ExtendedTrustManager {\n@@ -211,1 +204,0 @@\n-        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -213,1 +205,4 @@\n-        X509Certificate[] trustedChain;\n+        SSLSession session = null;\n+        AlgorithmConstraints constraints = null;\n+        String identityAlg = null;\n+\n@@ -215,0 +210,6 @@\n+            session = sslSocket.getHandshakeSession();\n+            constraints = SSLAlgorithmConstraints.forSocket(\n+                    sslSocket, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n+            identityAlg = sslSocket.getSSLParameters().\n+                    getEndpointIdentificationAlgorithm();\n+        }\n@@ -216,4 +217,3 @@\n-            SSLSession session = sslSocket.getHandshakeSession();\n-            if (session == null) {\n-                throw new CertificateException(\"No handshake session\");\n-            }\n+        findTrustedCertificate(chain, authType,\n+                session, constraints, identityAlg, checkClientTrusted);\n+    }\n@@ -221,2 +221,3 @@\n-            AlgorithmConstraints constraints = SSLAlgorithmConstraints.forSocket(\n-                    sslSocket, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n+    private void checkTrusted(X509Certificate[] chain,\n+            String authType, SSLEngine engine,\n+            boolean checkClientTrusted) throws CertificateException {\n@@ -224,8 +225,3 @@\n-            \/\/ Grab any stapled OCSP responses for use in validation\n-            List<byte[]> responseList = Collections.emptyList();\n-            if (!checkClientTrusted && session instanceof ExtendedSSLSession) {\n-                responseList =\n-                        ((ExtendedSSLSession)session).getStatusResponses();\n-            }\n-            trustedChain = v.validate(chain, null, responseList,\n-                    constraints, checkClientTrusted ? null : authType);\n+        SSLSession session = null;\n+        AlgorithmConstraints constraints = null;\n+        String identityAlg = null;\n@@ -233,2 +229,5 @@\n-            \/\/ check endpoint identity\n-            String identityAlg = sslSocket.getSSLParameters().\n+        if (engine != null) {\n+            session = engine.getHandshakeSession();\n+            constraints = SSLAlgorithmConstraints.forEngine(\n+                    engine, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n+            identityAlg = engine.getSSLParameters().\n@@ -236,7 +235,0 @@\n-            if (identityAlg != null && !identityAlg.isEmpty()) {\n-                checkIdentity(session,\n-                        trustedChain, identityAlg, checkClientTrusted);\n-            }\n-        } else {\n-            trustedChain = v.validate(chain, null, Collections.emptyList(),\n-                    null, checkClientTrusted ? null : authType);\n@@ -245,4 +237,2 @@\n-        if (SSLLogger.isOn() && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-            SSLLogger.fine(\"Found trusted certificate\",\n-                    trustedChain[trustedChain.length - 1]);\n-        }\n+        findTrustedCertificate(chain, authType,\n+                session, constraints, identityAlg, checkClientTrusted);\n@@ -254,1 +244,0 @@\n-        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -256,2 +245,3 @@\n-        final X509Certificate[] trustedChain;\n-        if (quicTLSEngine != null) {\n+        SSLSession session = null;\n+        AlgorithmConstraints constraints = null;\n+        String identityAlg = null;\n@@ -259,7 +249,3 @@\n-            final SSLSession session = quicTLSEngine.getHandshakeSession();\n-            if (session == null) {\n-                throw new CertificateException(\"No handshake session\");\n-            }\n-\n-            \/\/ create the algorithm constraints\n-            final AlgorithmConstraints constraints = SSLAlgorithmConstraints.forQUIC(\n+        if (quicTLSEngine != null) {\n+            session = quicTLSEngine.getHandshakeSession();\n+            constraints = SSLAlgorithmConstraints.forQUIC(\n@@ -267,14 +253,1 @@\n-            final List<byte[]> responseList;\n-            \/\/ grab any stapled OCSP responses for use in validation\n-            if (!checkClientTrusted &&\n-                    session instanceof ExtendedSSLSession extSession) {\n-                responseList = extSession.getStatusResponses();\n-            } else {\n-                responseList = Collections.emptyList();\n-            }\n-            \/\/ do the certificate chain validation\n-            trustedChain = v.validate(chain, null, responseList,\n-                    constraints, checkClientTrusted ? null : authType);\n-\n-            \/\/ check endpoint identity\n-            String identityAlg = quicTLSEngine.getSSLParameters().\n+            identityAlg = quicTLSEngine.getSSLParameters().\n@@ -282,7 +255,0 @@\n-            if (identityAlg != null && !identityAlg.isEmpty()) {\n-                checkIdentity(session, trustedChain,\n-                        identityAlg, checkClientTrusted);\n-            }\n-        } else {\n-            trustedChain = v.validate(chain, null, Collections.emptyList(),\n-                    null, checkClientTrusted ? null : authType);\n@@ -291,4 +257,2 @@\n-        if (SSLLogger.isOn() && SSLLogger.isOn(\"ssl,trustmanager\")) {\n-            SSLLogger.fine(\"Found trusted certificate\",\n-                    trustedChain[trustedChain.length - 1]);\n-        }\n+        findTrustedCertificate(chain, authType,\n+                session, constraints, identityAlg, checkClientTrusted);\n@@ -297,2 +261,3 @@\n-    private void checkTrusted(X509Certificate[] chain,\n-            String authType, SSLEngine engine,\n+    private void findTrustedCertificate(X509Certificate[] chain,\n+            String authType, SSLSession session,\n+            AlgorithmConstraints constraints, String identityAlg,\n@@ -300,1 +265,0 @@\n-        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -302,2 +266,2 @@\n-        X509Certificate[] trustedChain;\n-        if (engine != null) {\n+        final X509Certificate[] trustedChain;\n+        Validator v = checkTrustedInit(chain, authType, checkClientTrusted);\n@@ -305,1 +269,1 @@\n-            SSLSession session = engine.getHandshakeSession();\n+        if (constraints != null) {\n@@ -310,3 +274,0 @@\n-            AlgorithmConstraints constraints = SSLAlgorithmConstraints.forEngine(\n-                    engine, SIGNATURE_CONSTRAINTS_MODE.LOCAL, false);\n-\n@@ -314,4 +275,6 @@\n-            List<byte[]> responseList = Collections.emptyList();\n-            if (!checkClientTrusted && session instanceof ExtendedSSLSession) {\n-                responseList =\n-                        ((ExtendedSSLSession)session).getStatusResponses();\n+            final List<byte[]> responseList;\n+            if (!checkClientTrusted &&\n+                    session instanceof ExtendedSSLSession extSession) {\n+                responseList = extSession.getStatusResponses();\n+            } else {\n+                responseList = Collections.emptyList();\n@@ -319,0 +282,2 @@\n+\n+            \/\/ Certificate chain validation\n@@ -322,3 +287,1 @@\n-            \/\/ check endpoint identity\n-            String identityAlg = engine.getSSLParameters().\n-                    getEndpointIdentificationAlgorithm();\n+            \/\/ Check endpoint identity\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/X509TrustManagerImpl.java","additions":53,"deletions":90,"binary":false,"changes":143,"status":"modified"},{"patch":"@@ -316,1 +316,1 @@\n-jks.storetype.warning=Der %1$s-Keystore verwendet ein proprietres Format. Es wird empfohlen, auf PKCS12 zu migrieren, das ein Industriestandardformat mit \"keytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\" ist.\n+jks.storetype.warning=%1$s verwendet veraltete kryptografische Algorithmen und wird in einer zuknftigen Version entfernt. Migrieren Sie zu PKCS12 mit:\\nkeytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/resources\/keytool_de.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -316,1 +316,1 @@\n-jks.storetype.warning=%1$s\"keytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\"PKCS12\n+jks.storetype.warning=%1$sPKCS12:\\nkeytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/resources\/keytool_ja.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -316,1 +316,1 @@\n-jks.storetype.warning=%1$s  \"keytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\"  PKCS12\n+jks.storetype.warning=%1$s  PKCS12\\nkeytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/resources\/keytool_zh_CN.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-Subject.=Subjekt:\\n\n+Subject.=Subject:\\n\n@@ -77,0 +77,3 @@\n+\n+# sun.security.util.Password\n+warning.input.may.be.visible.on.screen=[Warnung: Eingabe ist mglicherweise auf dem Bildschirm sichtbar]\\u0020\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/resources\/security_de.properties","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -77,0 +77,3 @@\n+\n+# sun.security.util.Password\n+warning.input.may.be.visible.on.screen=[: ]\\u0020\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/resources\/security_ja.properties","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -77,0 +77,3 @@\n+\n+# sun.security.util.Password\n+warning.input.may.be.visible.on.screen=[]\\u0020\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/resources\/security_zh_CN.properties","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -37,0 +37,2 @@\n+import jdk.internal.vm.annotation.AOTRuntimeSetup;\n+import jdk.internal.vm.annotation.AOTSafeClassInitializer;\n@@ -42,0 +44,1 @@\n+@AOTSafeClassInitializer\n@@ -66,0 +69,1 @@\n+        \/\/ Legacy CDS archive support (to be deprecated)\n@@ -94,1 +98,8 @@\n-    private static final LazyConstant<ReferencedKeySet<BaseLocale>> CACHE =\n+    @Stable private static LazyConstant<ReferencedKeySet<BaseLocale>> CACHE;\n+    static {\n+        runtimeSetup();\n+    }\n+\n+    @AOTRuntimeSetup\n+    private static void runtimeSetup() {\n+        CACHE =\n@@ -101,0 +112,1 @@\n+    }\n","filename":"src\/java.base\/share\/classes\/sun\/util\/locale\/BaseLocale.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -3005,0 +3005,2 @@\n+-   [The `java` Command, Release 26](https:\/\/docs.oracle.com\/en\/java\/javase\/26\/docs\/specs\/man\/java.html)\n+\n","filename":"src\/java.base\/share\/man\/java.md","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -84,1 +84,1 @@\n-    IPv6_available = IPv6_supported() & (!preferIPv4Stack);\n+    IPv6_available = IPv6_supported() && !preferIPv4Stack;\n@@ -89,1 +89,0 @@\n-\n","filename":"src\/java.base\/share\/native\/libnet\/net_util.c","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,0 @@\n-import java.util.Properties;\n@@ -206,1 +205,1 @@\n-     * @return true if all goes well, false if no headers were set.\n+     * @throws IOException if no headers were set\n@@ -209,1 +208,1 @@\n-    public boolean setHeaders(HttpURLConnection conn, HeaderParser p, String raw) {\n+    public void setHeaders(HttpURLConnection conn, HeaderParser p, String raw) throws IOException {\n@@ -223,3 +222,2 @@\n-            return true;\n-        } catch (IOException | GeneralSecurityException e) {\n-            return false;\n+        } catch (GeneralSecurityException e) {\n+            throw new IOException(e);\n@@ -235,2 +233,1 @@\n-    private String buildType3Msg (String challenge) throws GeneralSecurityException,\n-                                                           IOException  {\n+    private String buildType3Msg (String challenge) throws GeneralSecurityException {\n","filename":"src\/java.base\/unix\/classes\/sun\/net\/www\/protocol\/http\/ntlm\/NTLMAuthentication.java","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -111,1 +111,2 @@\n-    error = getaddrinfo(hostname, NULL, &hints, &res);\n+    NET_RESTARTABLE(error, getaddrinfo(hostname, NULL, &hints, &res),\n+                    error == EAI_SYSTEM && errno == EINTR);\n@@ -232,4 +233,7 @@\n-    if (getnameinfo((struct sockaddr *)&sa, sizeof(struct sockaddr_in),\n-                    host, sizeof(host), NULL, 0, NI_NAMEREQD)) {\n-        JNU_ThrowByName(env, \"java\/net\/UnknownHostException\", NULL);\n-    } else {\n+    int r;\n+\n+    NET_RESTARTABLE(r, getnameinfo((struct sockaddr *)&sa, sizeof(struct sockaddr_in),\n+                                   host, sizeof(host), NULL, 0, NI_NAMEREQD),\n+                    r == EAI_SYSTEM && errno == EINTR);\n+\n+    if (r == 0) {\n@@ -237,2 +241,2 @@\n-        if (ret == NULL) {\n-            JNU_ThrowByName(env, \"java\/net\/UnknownHostException\", NULL);\n+        if (ret != NULL) {\n+            return ret;\n@@ -242,1 +246,2 @@\n-    return ret;\n+    JNU_ThrowByName(env, \"java\/net\/UnknownHostException\", NULL);\n+    return NULL;\n@@ -286,1 +291,2 @@\n-    connect_rv = connect(fd, &sa->sa, sizeof(struct sockaddr_in));\n+    NET_RESTARTABLE(connect_rv, connect(fd, &sa->sa, sizeof(struct sockaddr_in)),\n+                    connect_rv == -1 && errno == EINTR);\n@@ -400,0 +406,1 @@\n+\n@@ -401,1 +408,3 @@\n-        n = sendto(fd, sendbuf, plen, 0, &sa->sa, sizeof(struct sockaddr_in));\n+        NET_RESTARTABLE(n, sendto(fd, sendbuf, plen, 0, &sa->sa, sizeof(struct sockaddr_in)),\n+                        n == -1 && errno == EINTR)\n+\n@@ -425,2 +434,3 @@\n-                n = recvfrom(fd, recvbuf, sizeof(recvbuf), 0,\n-                             (struct sockaddr *)&sa_recv, &len);\n+                NET_RESTARTABLE(n, recvfrom(fd, recvbuf, sizeof(recvbuf), 0,\n+                                      (struct sockaddr *)&sa_recv, &len),\n+                                      n == -1 && errno == EINTR);\n","filename":"src\/java.base\/unix\/native\/libnet\/Inet4AddressImpl.c","additions":22,"deletions":12,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -230,1 +230,2 @@\n-    error = getaddrinfo(hostname, NULL, &hints, &res);\n+    NET_RESTARTABLE(error, getaddrinfo(hostname, NULL, &hints, &res),\n+                                      error == EAI_SYSTEM && errno == EINTR);\n@@ -433,3 +434,6 @@\n-    if (getnameinfo(&sa.sa, len, host, sizeof(host), NULL, 0, NI_NAMEREQD)) {\n-        JNU_ThrowByName(env, \"java\/net\/UnknownHostException\", NULL);\n-    } else {\n+    int r;\n+\n+    NET_RESTARTABLE(r, getnameinfo(&sa.sa, len, host, sizeof(host), NULL, 0, NI_NAMEREQD),\n+                    r == EAI_SYSTEM && errno == EINTR);\n+\n+    if (r == 0) {\n@@ -437,2 +441,2 @@\n-        if (ret == NULL) {\n-            JNU_ThrowByName(env, \"java\/net\/UnknownHostException\", NULL);\n+        if (ret != NULL) {\n+            return ret;\n@@ -442,1 +446,2 @@\n-    return ret;\n+    JNU_ThrowByName(env, \"java\/net\/UnknownHostException\", NULL);\n+    return NULL;\n@@ -486,1 +491,2 @@\n-    connect_rv = connect(fd, &sa->sa, sizeof(struct sockaddr_in6));\n+    NET_RESTARTABLE(connect_rv, connect(fd, &sa->sa, sizeof(struct sockaddr_in6)),\n+                    connect_rv == -1 && errno == EINTR);\n@@ -607,1 +613,4 @@\n-        n = sendto(fd, sendbuf, plen, 0, &sa->sa, sizeof(struct sockaddr_in6));\n+\n+        NET_RESTARTABLE(n, sendto(fd, sendbuf, plen, 0, &sa->sa, sizeof(struct sockaddr_in6)),\n+                        n == -1 && errno == EINTR);\n+\n@@ -631,2 +640,3 @@\n-                n = recvfrom(fd, recvbuf, sizeof(recvbuf), 0,\n-                             (struct sockaddr *)&sa_recv, &len);\n+                NET_RESTARTABLE(n, recvfrom(fd, recvbuf, sizeof(recvbuf), 0,\n+                                   (struct sockaddr *)&sa_recv, &len),\n+                                   n == -1 && errno == EINTR);\n","filename":"src\/java.base\/unix\/native\/libnet\/Inet6AddressImpl.c","additions":21,"deletions":11,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -79,3 +79,0 @@\n-    case EINTR:\n-        JNU_ThrowByName(env, JNU_JAVAIOPKG \"InterruptedIOException\", msg);\n-        break;\n@@ -630,1 +627,1 @@\n-          pfd.events |= POLLIN;\n+            pfd.events |= POLLIN;\n@@ -632,1 +629,1 @@\n-          pfd.events |= POLLOUT;\n+            pfd.events |= POLLOUT;\n@@ -634,1 +631,1 @@\n-          pfd.events |= POLLOUT;\n+            pfd.events |= POLLOUT;\n@@ -642,1 +639,1 @@\n-          return read_rv > 0 ? 0 : -1;\n+            return read_rv > 0 ? 0 : -1;\n@@ -647,1 +644,1 @@\n-          break;\n+            break;\n@@ -649,1 +646,1 @@\n-      } \/* while *\/\n+    } \/* while *\/\n","filename":"src\/java.base\/unix\/native\/libnet\/net_util_md.c","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -87,0 +87,13 @@\n+\/**\n+ * Invokes CALL in a loop, setting RET to return value.\n+ * Invokes PREDICATE for condition to restart CALL (in loop)\n+ * Return RET otherwise\n+ *\/\n+#define NET_RESTARTABLE(RET,CALL,PREDICATE)     \\\n+    while (1) {                                 \\\n+        RET = CALL;                             \\\n+        if (!(PREDICATE)) {                     \\\n+            break;                              \\\n+        }                                       \\\n+    }\n+\n","filename":"src\/java.base\/unix\/native\/libnet\/net_util_md.h","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -94,1 +94,2 @@\n-    private native byte[] getNextToken (long crdHandle, byte[] lastToken, Status returned);\n+    private native byte[] getNextToken (long crdHandle, byte[] lastToken, Status returned)\n+            throws IOException;\n","filename":"src\/java.base\/windows\/classes\/sun\/net\/www\/protocol\/http\/ntlm\/NTLMAuthSequence.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,0 @@\n-import java.net.InetAddress;\n@@ -31,1 +30,0 @@\n-import java.net.UnknownHostException;\n@@ -207,1 +205,1 @@\n-     * @return true if all goes well, false if no headers were set.\n+     * @throws IOException if no headers were set\n@@ -210,1 +208,1 @@\n-    public boolean setHeaders(HttpURLConnection conn, HeaderParser p, String raw) {\n+    public void setHeaders(HttpURLConnection conn, HeaderParser p, String raw) throws IOException {\n@@ -227,1 +225,0 @@\n-            return true;\n@@ -230,1 +227,1 @@\n-            return false;\n+            throw e;\n","filename":"src\/java.base\/windows\/classes\/sun\/net\/www\/protocol\/http\/ntlm\/NTLMAuthentication.java","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -233,0 +233,2 @@\n+        SetLastError(ss);\n+        JNU_ThrowIOExceptionWithLastError(env, \"InitializeSecurityContext\");\n@@ -241,0 +243,2 @@\n+            SetLastError(ss);\n+            JNU_ThrowIOExceptionWithLastError(env, \"CompleteAuthToken\");\n","filename":"src\/java.base\/windows\/native\/libnet\/NTLMAuthSequence.c","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -63,9 +63,3 @@\n-    \/\/ Workaround for apple bug FB13261205, since it only affects arm based macs\n-    \/\/ and arm support started with macOS 11 ignore the workaround for previous versions\n-    if (@available(macOS 11, *)) {\n-        if (architecture == -1) {\n-            architecture = [[NSRunningApplication currentApplication] executableArchitecture];\n-        }\n-        if (architecture == NSBundleExecutableArchitectureARM64) {\n-            return (CGDisplayModeGetPixelWidth(mode) >= 800);\n-        }\n+    \/\/ Workaround for apple bug FB13261205, only affects arm based macs\n+    if (architecture == -1) {\n+        architecture = [[NSRunningApplication currentApplication] executableArchitecture];\n@@ -73,0 +67,4 @@\n+    if (architecture == NSBundleExecutableArchitectureARM64) {\n+        return (CGDisplayModeGetPixelWidth(mode) >= 800);\n+    }\n+\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CGraphicsDevice.m","additions":7,"deletions":9,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,0 +125,1 @@\n+    @Override\n@@ -132,0 +133,1 @@\n+    @Override\n@@ -148,0 +150,1 @@\n+    @Override\n@@ -162,0 +165,1 @@\n+    @Override\n@@ -166,0 +170,1 @@\n+    @Override\n@@ -170,0 +175,1 @@\n+    @Override\n@@ -178,0 +184,1 @@\n+    @Override\n@@ -310,0 +317,1 @@\n+    @Override\n@@ -493,0 +501,1 @@\n+    @Override\n@@ -690,0 +699,1 @@\n+        @Override\n@@ -744,0 +754,1 @@\n+        @Override\n@@ -1262,0 +1273,1 @@\n+        @Override\n@@ -1321,0 +1333,1 @@\n+        @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKColorChooserPanel.java","additions":14,"deletions":1,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -191,0 +191,1 @@\n+    @Override\n@@ -200,0 +201,1 @@\n+    @Override\n@@ -246,0 +248,1 @@\n+    @Override\n@@ -256,0 +259,1 @@\n+    @Override\n@@ -260,0 +264,1 @@\n+    @Override\n@@ -264,0 +269,1 @@\n+    @Override\n@@ -268,0 +274,1 @@\n+    @Override\n@@ -276,0 +283,1 @@\n+    @Override\n@@ -285,0 +293,1 @@\n+        @Override\n@@ -288,0 +297,1 @@\n+        @Override\n@@ -292,0 +302,1 @@\n+        @Override\n@@ -295,0 +306,1 @@\n+        @Override\n@@ -320,0 +332,1 @@\n+    @Override\n@@ -328,0 +341,1 @@\n+    @Override\n@@ -360,0 +374,1 @@\n+    @Override\n@@ -377,0 +392,1 @@\n+    @Override\n@@ -384,0 +400,1 @@\n+    @Override\n@@ -398,0 +415,1 @@\n+    @Override\n@@ -410,0 +428,1 @@\n+    @Override\n@@ -427,0 +446,1 @@\n+    @Override\n@@ -437,0 +457,1 @@\n+        @Override\n@@ -467,0 +488,1 @@\n+        @Override\n@@ -481,0 +503,1 @@\n+    @Override\n@@ -489,0 +512,1 @@\n+        @Override\n@@ -550,0 +574,1 @@\n+    @Override\n@@ -557,0 +582,1 @@\n+    @Override\n@@ -568,0 +594,1 @@\n+    @Override\n@@ -626,0 +653,1 @@\n+            @Override\n@@ -736,0 +764,1 @@\n+            @Override\n@@ -750,0 +779,1 @@\n+            @Override\n@@ -814,0 +844,1 @@\n+    @Override\n@@ -825,0 +856,1 @@\n+    @Override\n@@ -834,0 +866,1 @@\n+        @Override\n@@ -844,0 +877,1 @@\n+    @Override\n@@ -853,0 +887,1 @@\n+    @Override\n@@ -858,0 +893,1 @@\n+    @Override\n@@ -897,0 +933,1 @@\n+    @Override\n@@ -975,0 +1012,1 @@\n+    @Override\n@@ -979,0 +1017,1 @@\n+    @Override\n@@ -983,0 +1022,1 @@\n+    @Override\n@@ -993,0 +1033,1 @@\n+        @Override\n@@ -1031,0 +1072,1 @@\n+        @Override\n@@ -1041,0 +1083,1 @@\n+        @Override\n@@ -1045,0 +1088,1 @@\n+        @Override\n@@ -1058,0 +1102,1 @@\n+        @Override\n@@ -1074,0 +1119,1 @@\n+        @Override\n@@ -1091,0 +1137,1 @@\n+        @Override\n@@ -1095,0 +1142,1 @@\n+        @Override\n@@ -1107,0 +1155,1 @@\n+        @Override\n@@ -1115,0 +1164,1 @@\n+        @Override\n@@ -1132,0 +1182,1 @@\n+        @Override\n@@ -1181,0 +1232,1 @@\n+    @Override\n@@ -1255,0 +1307,1 @@\n+        @Override\n@@ -1260,0 +1313,1 @@\n+        @Override\n@@ -1264,0 +1318,1 @@\n+        @Override\n@@ -1283,0 +1338,1 @@\n+        @Override\n@@ -1297,0 +1353,1 @@\n+        @Override\n@@ -1330,0 +1387,1 @@\n+        @Override\n@@ -1365,0 +1423,1 @@\n+        @Override\n@@ -1408,0 +1467,1 @@\n+        @Override\n@@ -1420,0 +1480,1 @@\n+        @Override\n@@ -1460,0 +1521,1 @@\n+        @Override\n@@ -1470,0 +1532,1 @@\n+        @Override\n@@ -1477,0 +1540,1 @@\n+        @Override\n@@ -1498,0 +1562,1 @@\n+        @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKFileChooserUI.java","additions":65,"deletions":0,"binary":false,"changes":65,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,0 +44,1 @@\n+    @Override\n@@ -86,0 +87,1 @@\n+    @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKGraphicsUtils.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -166,0 +166,1 @@\n+        @Override\n@@ -174,0 +175,1 @@\n+        @Override\n@@ -178,0 +180,1 @@\n+        @Override\n@@ -251,0 +254,1 @@\n+        @Override\n@@ -259,0 +263,1 @@\n+        @Override\n@@ -288,0 +293,1 @@\n+        @Override\n@@ -292,0 +298,1 @@\n+        @Override\n@@ -312,0 +319,1 @@\n+        @Override\n@@ -324,0 +332,1 @@\n+        @Override\n@@ -347,0 +356,1 @@\n+        @Override\n@@ -351,0 +361,1 @@\n+        @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKIconFactory.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -264,0 +264,1 @@\n+    @Override\n@@ -304,0 +305,1 @@\n+    @Override\n@@ -514,0 +516,1 @@\n+            @Override\n@@ -559,0 +562,1 @@\n+                @Override\n@@ -1171,0 +1175,1 @@\n+                @Override\n@@ -1187,0 +1192,1 @@\n+                @Override\n@@ -1315,0 +1321,1 @@\n+    @Override\n@@ -1495,0 +1502,1 @@\n+        @Override\n@@ -1507,0 +1515,1 @@\n+                    @Override\n@@ -1534,0 +1543,1 @@\n+    @Override\n@@ -1540,0 +1550,1 @@\n+    @Override\n@@ -1544,0 +1555,1 @@\n+    @Override\n@@ -1548,0 +1560,1 @@\n+    @Override\n@@ -1552,0 +1565,1 @@\n+    @Override\n@@ -1558,0 +1572,1 @@\n+    @Override\n@@ -1666,0 +1681,1 @@\n+    @Override\n@@ -1673,0 +1689,1 @@\n+    @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKLookAndFeel.java","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -80,0 +80,1 @@\n+    @Override\n@@ -85,0 +86,1 @@\n+    @Override\n@@ -91,0 +93,1 @@\n+    @Override\n@@ -100,0 +103,1 @@\n+    @Override\n@@ -110,0 +114,1 @@\n+    @Override\n@@ -129,0 +134,1 @@\n+    @Override\n@@ -147,0 +153,1 @@\n+    @Override\n@@ -156,0 +163,1 @@\n+    @Override\n@@ -169,0 +177,1 @@\n+    @Override\n@@ -207,0 +216,1 @@\n+    @Override\n@@ -221,0 +231,1 @@\n+    @Override\n@@ -250,0 +261,1 @@\n+    @Override\n@@ -259,0 +271,1 @@\n+    @Override\n@@ -269,0 +282,1 @@\n+    @Override\n@@ -275,0 +289,1 @@\n+    @Override\n@@ -391,0 +406,1 @@\n+    @Override\n@@ -440,0 +456,1 @@\n+    @Override\n@@ -518,0 +535,1 @@\n+    @Override\n@@ -524,0 +542,1 @@\n+    @Override\n@@ -547,0 +566,1 @@\n+    @Override\n@@ -554,0 +574,1 @@\n+    @Override\n@@ -564,0 +585,1 @@\n+    @Override\n@@ -607,0 +629,1 @@\n+    @Override\n@@ -621,0 +644,1 @@\n+    @Override\n@@ -640,0 +664,1 @@\n+    @Override\n@@ -653,0 +678,1 @@\n+    @Override\n@@ -771,0 +797,1 @@\n+    @Override\n@@ -833,0 +860,1 @@\n+    @Override\n@@ -859,0 +887,1 @@\n+    @Override\n@@ -868,0 +897,1 @@\n+    @Override\n@@ -889,0 +919,1 @@\n+    @Override\n@@ -895,0 +926,1 @@\n+    @Override\n@@ -934,0 +966,1 @@\n+    @Override\n@@ -961,0 +994,1 @@\n+    @Override\n@@ -969,0 +1003,1 @@\n+    @Override\n@@ -977,0 +1012,1 @@\n+    @Override\n@@ -1079,0 +1115,1 @@\n+    @Override\n@@ -1088,0 +1125,1 @@\n+    @Override\n@@ -1106,0 +1144,1 @@\n+    @Override\n@@ -1151,0 +1190,1 @@\n+    @Override\n@@ -1209,0 +1249,1 @@\n+    @Override\n@@ -1227,0 +1268,1 @@\n+    @Override\n@@ -1246,0 +1288,1 @@\n+    @Override\n@@ -1257,0 +1300,1 @@\n+    @Override\n@@ -1267,0 +1311,1 @@\n+    @Override\n@@ -1512,0 +1557,1 @@\n+        @Override\n@@ -1526,0 +1572,1 @@\n+        @Override\n@@ -1536,0 +1583,1 @@\n+        @Override\n@@ -1545,0 +1593,1 @@\n+        @Override\n@@ -1562,0 +1611,1 @@\n+        @Override\n@@ -1567,0 +1617,1 @@\n+        @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKPainter.java","additions":52,"deletions":1,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -145,0 +145,1 @@\n+    @Override\n@@ -295,0 +296,1 @@\n+    @Override\n@@ -1056,0 +1058,1 @@\n+        @Override\n@@ -1070,0 +1073,1 @@\n+        @Override\n@@ -1079,0 +1083,1 @@\n+        @Override\n@@ -1138,0 +1143,1 @@\n+        @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKStyle.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,0 +61,1 @@\n+    @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKStyleFactory.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -696,0 +696,1 @@\n+        @Override\n@@ -732,0 +733,1 @@\n+        @Override\n@@ -733,0 +735,1 @@\n+        @Override\n@@ -734,0 +737,1 @@\n+        @Override\n@@ -738,0 +742,1 @@\n+        @Override\n@@ -797,0 +802,1 @@\n+        @Override\n@@ -1946,0 +1952,1 @@\n+        @Override\n@@ -1950,0 +1957,1 @@\n+        @Override\n@@ -2003,0 +2011,1 @@\n+        @Override\n@@ -2007,0 +2016,1 @@\n+        @Override\n@@ -2011,0 +2021,1 @@\n+        @Override\n@@ -2015,0 +2026,1 @@\n+        @Override\n@@ -2027,0 +2039,1 @@\n+        @Override\n@@ -2031,0 +2044,1 @@\n+        @Override\n@@ -2039,0 +2053,1 @@\n+        @Override\n@@ -2043,0 +2058,1 @@\n+        @Override\n@@ -2051,0 +2067,1 @@\n+        @Override\n@@ -2055,0 +2072,1 @@\n+        @Override\n@@ -2059,0 +2077,1 @@\n+        @Override\n@@ -2151,0 +2170,1 @@\n+            @Override\n@@ -2155,0 +2175,1 @@\n+            @Override\n@@ -2159,0 +2180,1 @@\n+            @Override\n@@ -2163,0 +2185,1 @@\n+            @Override\n@@ -2179,0 +2202,1 @@\n+            @Override\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/Metacity.java","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -4457,2 +4457,0 @@\n-            rowModel = null;\n-\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/JTable.java","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -219,5 +219,3 @@\n-        if (((JProgressBar) c).isBorderPainted()) {\n-            context.getPainter().paintProgressBarBackground(context,\n-                    g, 0, 0, c.getWidth(), c.getHeight(),\n-                    progressBar.getOrientation());\n-        }\n+        context.getPainter().paintProgressBarBackground(context,\n+                g, 0, 0, c.getWidth(), c.getHeight(),\n+                progressBar.getOrientation());\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/synth\/SynthProgressBarUI.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -83,2 +83,0 @@\n-                            } else if (f.isMaximum() && f.isIcon()) {\n-                                f.setIcon(false);\n@@ -86,1 +84,6 @@\n-                                f.setMaximum(false);\n+                                \/\/ If frame being activated is set to maximised\n+                                \/\/ and iconified, let it be maximised\n+                                \/\/ else remain non-maximised\n+                                if (f.isIcon()) {\n+                                    f.setIcon(false);\n+                                }\n","filename":"src\/java.desktop\/windows\/classes\/com\/sun\/java\/swing\/plaf\/windows\/WindowsDesktopManager.java","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+import java.net.ProtocolException;\n@@ -49,0 +50,1 @@\n+import static jdk.internal.net.http.common.Utils.readContentLength;\n@@ -275,1 +277,2 @@\n-     * Read up to MAX_IGNORE bytes discarding\n+     * Reads the body, if it is present and less than {@value MAX_IGNORE} bytes.\n+     * Otherwise, just the connection is closed.\n@@ -278,2 +281,17 @@\n-        int clen = (int)headers.firstValueAsLong(\"Content-Length\").orElse(-1);\n-        if (clen == -1 || clen > MAX_IGNORE) {\n+\n+        \/\/ Read the `Content-Length` header\n+        long clen;\n+        try {\n+            clen = readContentLength(headers, \"\", -1);\n+        } catch (ProtocolException pe) {\n+            return MinimalFuture.failedFuture(pe);\n+        }\n+\n+        \/\/ Read the body, if it is present and less than `MAX_IGNORE` bytes.\n+        \/\/\n+        \/\/ We proceed with reading the body even when `Content-Length: 0` to\n+        \/\/ ensure that the happy path is taken, and upon success, the connection\n+        \/\/ is returned back to the pool.\n+        if (clen != -1 && clen <= MAX_IGNORE) {\n+            return readBody(discarding(), !request.isWebSocket(), executor);\n+        } else {\n@@ -282,2 +300,0 @@\n-        } else {\n-            return readBody(discarding(), !request.isWebSocket(), executor);\n@@ -285,0 +301,1 @@\n+\n@@ -311,1 +328,0 @@\n-\n@@ -314,2 +330,20 @@\n-        long clen0 = headers.firstValueAsLong(\"Content-Length\").orElse(-1L);\n-        final long clen = fixupContentLen(clen0);\n+        Consumer<Throwable> errorNotifier = error -> {\n+            try {\n+                subscriber.onError(error);\n+                cf.completeExceptionally(error);\n+            } finally {\n+                asyncReceiver.setRetryOnError(false);\n+                asyncReceiver.onReadError(error);\n+            }\n+        };\n+\n+        \/\/ Read the content length\n+        long clen;\n+        try {\n+            long clen0 = readContentLength(headers, \"\", -1);\n+            clen = fixupContentLen(clen0);\n+        } catch (ProtocolException pe) {\n+            errorNotifier.accept(pe);\n+            connection.close(pe);\n+            return cf;\n+        }\n@@ -401,6 +435,1 @@\n-        ResponseSubscribers.getBodyAsync(executor, p, cf, (t) -> {\n-            subscriber.onError(t);\n-            cf.completeExceptionally(t);\n-            asyncReceiver.setRetryOnError(false);\n-            asyncReceiver.onReadError(t);\n-        });\n+        ResponseSubscribers.getBodyAsync(executor, p, cf, errorNotifier);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http1Response.java","additions":43,"deletions":14,"binary":false,"changes":57,"status":"modified"},{"patch":"@@ -84,0 +84,2 @@\n+\n+import static jdk.internal.net.http.common.Utils.readContentLength;\n@@ -1296,1 +1298,4 @@\n-        long clen = promiseHeaders.firstValueAsLong(\"Content-Length\").orElse(-1);\n+\n+        \/\/ Read & validate `Content-Length`\n+        long clen = readContentLength(\n+                promiseHeaders, \"illegal push headers for pushId=%s: \".formatted(pushId), -1);\n@@ -1298,1 +1303,1 @@\n-            throw new ProtocolException(\"push headers contain non-zero Content-Length for pushId=\" + pushId);\n+            throw new ProtocolException(\"push headers contain non-zero \\\"Content-Length\\\" for pushId=\" + pushId);\n@@ -1300,0 +1305,1 @@\n+\n@@ -1301,1 +1307,1 @@\n-            throw new ProtocolException(\"push headers contain Transfer-Encoding for pushId=\" + pushId);\n+            throw new ProtocolException(\"push headers contain \\\"Transfer-Encoding\\\" for pushId=\" + pushId);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http3ExchangeImpl.java","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-import java.util.OptionalLong;\n@@ -61,0 +60,2 @@\n+import static jdk.internal.net.http.common.Utils.readContentLength;\n+import static jdk.internal.net.http.common.Utils.readStatusCode;\n@@ -609,1 +610,0 @@\n-         boolean finalResponse = false;\n@@ -611,4 +611,2 @@\n-             responseCode = (int) responseHeaders\n-                     .firstValueAsLong(\":status\")\n-                     .orElseThrow(() -> new IOException(\"no statuscode in response\"));\n-         } catch (IOException | NumberFormatException exception) {\n+             responseCode = readStatusCode(responseHeaders, \"\");\n+         } catch (ProtocolException pe) {\n@@ -618,5 +616,1 @@\n-             cancelImpl(exception, Http3Error.H3_MESSAGE_ERROR);\n-             return;\n-         }\n-         if (responseCode < 100 || responseCode > 999) {\n-             cancelImpl(new IOException(\"Unexpected :status header value\"), Http3Error.H3_MESSAGE_ERROR);\n+             cancelImpl(pe, Http3Error.H3_MESSAGE_ERROR);\n@@ -626,0 +620,1 @@\n+         boolean finalResponse = false;\n@@ -656,13 +651,14 @@\n-         try {\n-             OptionalLong cl = responseHeaders.firstValueAsLong(\"content-length\");\n-             if (finalResponse && cl.isPresent()) {\n-                 long cll = cl.getAsLong();\n-                 if (cll < 0) {\n-                     cancelImpl(new IOException(\"Invalid content-length value \"+cll), Http3Error.H3_MESSAGE_ERROR);\n-                     return;\n-                 }\n-                 if (!(exchange.request().method().equalsIgnoreCase(\"HEAD\") || responseCode == HTTP_NOT_MODIFIED)) {\n-                     \/\/ HEAD response and 304 response might have a content-length header,\n-                     \/\/ but it carries no meaning\n-                     contentLength = cll;\n-                 }\n+         if (finalResponse) {\n+             long cl;\n+             try {\n+                 cl = readContentLength(responseHeaders, \"\", -1);\n+             } catch (ProtocolException pe) {\n+                 cancelImpl(pe, Http3Error.H3_MESSAGE_ERROR);\n+                 return;\n+             }\n+             if (cl != -1 &&\n+                     !(exchange.request().method().equalsIgnoreCase(\"HEAD\") ||\n+                             responseCode == HTTP_NOT_MODIFIED)) {\n+                 \/\/ HEAD response and 304 response might have a content-length header,\n+                 \/\/ but it carries no meaning\n+                 contentLength = cl;\n@@ -670,3 +666,0 @@\n-         } catch (NumberFormatException nfe) {\n-             cancelImpl(nfe, Http3Error.H3_MESSAGE_ERROR);\n-             return;\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http3Stream.java","additions":20,"deletions":27,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -31,0 +31,2 @@\n+import java.net.ProtocolException;\n+import java.net.ProtocolException;\n@@ -33,0 +35,1 @@\n+import java.net.http.HttpHeaders;\n@@ -50,1 +53,0 @@\n-import java.net.http.HttpHeaders;\n@@ -65,0 +67,1 @@\n+import static jdk.internal.net.http.common.Utils.readContentLength;\n@@ -361,7 +364,16 @@\n-    private boolean bodyIsPresent(Response r) {\n-        HttpHeaders headers = r.headers();\n-        if (headers.firstValueAsLong(\"Content-length\").orElse(0L) != 0L)\n-            return true;\n-        if (headers.firstValue(\"Transfer-encoding\").isPresent())\n-            return true;\n-        return false;\n+    private void ensureNoBody(HttpHeaders headers) throws ProtocolException {\n+\n+        \/\/ Check `Content-Length`\n+        var contentLength = readContentLength(headers, \"\", 0);\n+        if (contentLength > 0) {\n+            throw new ProtocolException(\n+                    \"Unexpected \\\"Content-Length\\\" header in a 204 response: \" + contentLength);\n+        }\n+\n+        \/\/ Check `Transfer-Encoding`\n+        var transferEncoding = headers.firstValue(\"Transfer-Encoding\");\n+        if (transferEncoding.isPresent()) {\n+            throw new ProtocolException(\n+                    \"Unexpected \\\"Transfer-Encoding\\\" header in a 204 response: \" + transferEncoding.get());\n+        }\n+\n@@ -408,7 +420,7 @@\n-                            if (bodyIsPresent(r)) {\n-                                IOException ioe = new IOException(\n-                                    \"unexpected content length header with 204 response\");\n-                                exch.cancel(ioe);\n-                                return MinimalFuture.failedFuture(ioe);\n-                            } else\n-                                return handleNoBody(r, exch);\n+                            try {\n+                                ensureNoBody(r.headers);\n+                            } catch (ProtocolException pe) {\n+                                exch.cancel(pe);\n+                                return MinimalFuture.failedFuture(pe);\n+                            }\n+                            return handleNoBody(r, exch);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/MultiExchange.java","additions":27,"deletions":15,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -64,0 +64,1 @@\n+import static jdk.internal.net.http.common.Utils.readStatusCode;\n@@ -618,1 +619,1 @@\n-    protected void handleResponse(HeaderFrame hf) throws IOException {\n+    protected void handleResponse(HeaderFrame hf) {\n@@ -623,7 +624,3 @@\n-                responseCode = (int) responseHeaders\n-                        .firstValueAsLong(\":status\")\n-                        .orElseThrow(() -> new ProtocolException(String.format(\n-                                \"Stream %s PROTOCOL_ERROR: no status code in response\",\n-                                streamid)));\n-            } catch (ProtocolException cause) {\n-                cancelImpl(cause, ResetFrame.PROTOCOL_ERROR);\n+                responseCode = readStatusCode(responseHeaders, \"Stream %s PROTOCOL_ERROR: \".formatted(streamid));\n+            } catch (ProtocolException pe) {\n+                cancelImpl(pe, ResetFrame.PROTOCOL_ERROR);\n@@ -1733,6 +1730,10 @@\n-                responseCode = (int)responseHeaders\n-                    .firstValueAsLong(\":status\")\n-                    .orElse(-1);\n-\n-                if (responseCode == -1) {\n-                    cancelImpl(new ProtocolException(\"No status code\"), ResetFrame.PROTOCOL_ERROR);\n+                try {\n+                    responseCode = readStatusCode(responseHeaders, \"\");\n+                    if (responseCode >= 100 && responseCode < 200) {\n+                        String protocolErrorMsg = checkInterimResponseCountExceeded();\n+                        if (protocolErrorMsg != null) {\n+                            throw new ProtocolException(protocolErrorMsg);\n+                        }\n+                    }\n+                } catch (ProtocolException pe) {\n+                    cancelImpl(pe, ResetFrame.PROTOCOL_ERROR);\n@@ -1741,7 +1742,0 @@\n-                } else if (responseCode >= 100 && responseCode < 200) {\n-                    String protocolErrorMsg = checkInterimResponseCountExceeded();\n-                    if (protocolErrorMsg != null) {\n-                        cancelImpl(new ProtocolException(protocolErrorMsg), ResetFrame.PROTOCOL_ERROR);\n-                        rspHeadersConsumer.reset();\n-                        return;\n-                    }\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Stream.java","additions":15,"deletions":21,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -42,0 +42,1 @@\n+import java.net.ProtocolException;\n@@ -1357,0 +1358,41 @@\n+    public static int readStatusCode(HttpHeaders headers, String errorPrefix) throws ProtocolException {\n+        var s = headers.firstValue(\":status\").orElse(null);\n+        if (s == null) {\n+            throw new ProtocolException(errorPrefix + \"missing status code\");\n+        }\n+        Throwable t = null;\n+        int i = 0;\n+        try {\n+            i = Integer.parseInt(s);\n+        } catch (NumberFormatException nfe) {\n+            t = nfe;\n+        }\n+        if (t != null || i < 100 || i > 999) {\n+            var pe = new ProtocolException(errorPrefix + \"invalid status code: \" + s);\n+            pe.initCause(t);\n+            throw pe;\n+        }\n+        return i;\n+    }\n+\n+    public static long readContentLength(HttpHeaders headers, String errorPrefix, long defaultIfMissing) throws ProtocolException {\n+        var k = \"Content-Length\";\n+        var s = headers.firstValue(k).orElse(null);\n+        if (s == null) {\n+            return defaultIfMissing;\n+        }\n+        Throwable t = null;\n+        long i = 0;\n+        try {\n+            i = Long.parseLong(s);\n+        } catch (NumberFormatException nfe) {\n+            t = nfe;\n+        }\n+        if (t != null || i < 0) {\n+            var pe = new ProtocolException(\"%sinvalid \\\"%s\\\": %s\".formatted(errorPrefix, k, s));\n+            pe.initCause(t);\n+            throw pe;\n+        }\n+        return i;\n+    }\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/common\/Utils.java","additions":42,"deletions":0,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -347,4 +347,0 @@\n-        \/\/ remap the connection to a draining connection\n-        final QuicEndpoint endpoint = this.connection.endpoint();\n-        assert endpoint != null : \"QUIC endpoint is null\";\n-        endpoint.draining(connection);\n@@ -442,1 +438,1 @@\n-        \/\/ remap (or remove) the QuicConnectionImpl in QuicEndpoint.\n+        \/\/ remap the QuicConnectionImpl in QuicEndpoint.\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/quic\/ConnectionTerminatorImpl.java","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2814,1 +2814,1 @@\n-                \/\/ we remove the connection from the endpoint for such cases.\n+                \/\/ we switch this connection to one that does not respond to incoming packets.\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/quic\/QuicConnectionImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1512,1 +1512,2 @@\n-     * This will completely remove the connection from the connection map.\n+     * This will replace the {@link QuicConnectionImpl} with a {@link DrainingConnection} that\n+     * will discard all incoming packets.\n@@ -1521,1 +1522,1 @@\n-        removeConnection(connection);\n+        draining(connection);\n@@ -1584,1 +1585,1 @@\n-    public void draining(final QuicPacketReceiver connection) {\n+    public void draining(final QuicConnectionImpl connection) {\n@@ -1587,0 +1588,7 @@\n+\n+        final long idleTimeout = connection.peerPtoMs() * 3; \/\/ 3 PTO\n+        connection.localConnectionIdManager().close();\n+        DrainingConnection draining = new DrainingConnection(connection.connectionIds(), idleTimeout);\n+        \/\/ we can ignore stateless reset in the draining state.\n+        remapPeerIssuedResetToken(connection, draining);\n+\n@@ -1588,1 +1596,2 @@\n-                connections.compute(id, this::remapDraining));\n+                connections.compute(id, (i, r) -> remapDraining(i, r, draining)));\n+        draining.startTimer();\n@@ -1592,1 +1601,1 @@\n-    private DrainingConnection remapDraining(QuicConnectionId id, QuicPacketReceiver conn) {\n+    private DrainingConnection remapDraining(QuicConnectionId id, QuicPacketReceiver conn, DrainingConnection draining) {\n@@ -1595,1 +1604,1 @@\n-        if (conn instanceof ClosingConnection closing) {\n+        if (conn instanceof QuicConnectionImpl || conn instanceof ClosingConnection) {\n@@ -1597,14 +1606,0 @@\n-            final var draining = closing.toDraining();\n-            remapPeerIssuedResetToken(closing, draining);\n-            draining.startTimer();\n-            return draining;\n-        } else if (conn instanceof DrainingConnection draining) {\n-            return draining;\n-        } else if (conn instanceof QuicConnectionImpl impl) {\n-            final long idleTimeout = impl.peerPtoMs() * 3; \/\/ 3 PTO\n-            impl.localConnectionIdManager().close();\n-            if (debugOn) debug.log(\"remapping %s to DrainingConnection\", id);\n-            var draining = new DrainingConnection(conn.connectionIds(), idleTimeout);\n-            \/\/ we can ignore stateless reset in the draining state.\n-            remapPeerIssuedResetToken(impl, draining);\n-            draining.startTimer();\n@@ -1612,0 +1607,2 @@\n+        } else if (conn instanceof DrainingConnection d) {\n+            return d;\n@@ -1626,3 +1623,9 @@\n-        ByteBuffer closing = ByteBuffer.allocate(datagram.limit());\n-        closing.put(datagram.slice());\n-        closing.flip();\n+        ByteBuffer closingDatagram = ByteBuffer.allocate(datagram.limit());\n+        closingDatagram.put(datagram.slice());\n+        closingDatagram.flip();\n+\n+        final long idleTimeout = connection.peerPtoMs() * 3; \/\/ 3 PTO\n+        connection.localConnectionIdManager().close();\n+        var closingConnection = new ClosingConnection(connection.connectionIds(), idleTimeout, datagram);\n+        remapPeerIssuedResetToken(connection, closingConnection);\n+\n@@ -1630,1 +1633,2 @@\n-                connections.compute(id, (i, r) -> remapClosing(i, r, closing)));\n+                connections.compute(id, (i, r) -> remapClosing(i, r, closingConnection)));\n+        closingConnection.startTimer();\n@@ -1634,1 +1638,1 @@\n-    private ClosedConnection remapClosing(QuicConnectionId id, QuicPacketReceiver conn, ByteBuffer datagram) {\n+    private ClosedConnection remapClosing(QuicConnectionId id, QuicPacketReceiver conn, ClosingConnection closingConnection) {\n@@ -1637,1 +1641,4 @@\n-        if (conn instanceof ClosingConnection closing) {\n+        if (conn instanceof QuicConnectionImpl) {\n+            if (debugOn) debug.log(\"remapping %s to ClosingConnection\", id);\n+            return closingConnection;\n+        } else if (conn instanceof ClosingConnection closing) {\n@@ -1642,8 +1649,0 @@\n-        } else if (conn instanceof QuicConnectionImpl impl) {\n-            final long idleTimeout = impl.peerPtoMs() * 3; \/\/ 3 PTO\n-            impl.localConnectionIdManager().close();\n-            if (debugOn) debug.log(\"remapping %s to ClosingConnection\", id);\n-            var closing = new ClosingConnection(conn.connectionIds(), idleTimeout, datagram);\n-            remapPeerIssuedResetToken(impl, closing);\n-            closing.startTimer();\n-            return closing;\n@@ -1899,4 +1898,0 @@\n-\n-        private DrainingConnection toDraining() {\n-            return new DrainingConnection(localConnectionIds, maxIdleTimeMs);\n-        }\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/quic\/QuicEndpoint.java","additions":33,"deletions":38,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+import java.io.Serial;\n@@ -48,0 +49,1 @@\n+    @Serial\n","filename":"src\/java.security.sasl\/share\/classes\/com\/sun\/security\/sasl\/Provider.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import java.io.Serial;\n+\n@@ -82,0 +84,1 @@\n+    @Serial\n","filename":"src\/java.security.sasl\/share\/classes\/javax\/security\/sasl\/AuthenticationException.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import java.io.Serial;\n+\n@@ -144,0 +146,1 @@\n+    @Serial\n","filename":"src\/java.security.sasl\/share\/classes\/javax\/security\/sasl\/AuthorizeCallback.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import java.io.Serial;\n+\n@@ -66,0 +68,1 @@\n+    @Serial\n","filename":"src\/java.security.sasl\/share\/classes\/javax\/security\/sasl\/RealmCallback.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import java.io.Serial;\n+\n@@ -61,0 +63,1 @@\n+    @Serial\n","filename":"src\/java.security.sasl\/share\/classes\/javax\/security\/sasl\/RealmChoiceCallback.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import java.io.Serial;\n@@ -128,0 +129,1 @@\n+    @Serial\n","filename":"src\/java.security.sasl\/share\/classes\/javax\/security\/sasl\/SaslException.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -31,0 +31,2 @@\n+import sun.jvmstat.PlatformSupport;\n+\n@@ -34,0 +36,2 @@\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n@@ -42,8 +46,11 @@\n-    \/\/ \"tmpdir\" is used as a global well-known location for the files\n-    \/\/ .java_pid<pid>. and .attach_pid<pid>. It is important that this\n-    \/\/ location is the same for all processes, otherwise the tools\n-    \/\/ will not be able to find all Hotspot processes.\n-    \/\/ This is intentionally not the same as java.io.tmpdir, since\n-    \/\/ the latter can be changed by the user.\n-    \/\/ Any changes to this needs to be synchronized with HotSpot.\n-    private static final String tmpdir;\n+\n+    \/**\n+     * HotSpot PerfData file prefix\n+     *\/\n+    private static final String HSPERFDATA_PREFIX = \"hsperfdata_\";\n+\n+    \/**\n+     * Use platform specific methods for looking up temporary directories.\n+     *\/\n+    private static final PlatformSupport platformSupport = PlatformSupport.getInstance();\n+\n@@ -70,1 +77,3 @@\n-        File socket_file = new File(tmpdir, \".java_pid\" + pid);\n+        \/\/ In macOS the socket file is located in per-user temp directory.\n+        String tempdir = getTempDirFromPid(pid);\n+        File socket_file = new File(tempdir, \".java_pid\" + pid);\n@@ -73,1 +82,1 @@\n-            File f = createAttachFile(pid);\n+            File f = createAttachFile(tempdir, pid);\n@@ -214,1 +223,1 @@\n-    private File createAttachFile(int pid) throws IOException {\n+    private File createAttachFile(String tmpdir, int pid) throws IOException {\n@@ -220,0 +229,22 @@\n+    \/*\n+     * Returns a platform-specific temporary directory for a given process.\n+     * In VMs running as unprivileged user it returns the default platform-specific\n+     * temporary directory. In VMs running as root it searches over the list of\n+     * temporary directories for one containing HotSpot PerfData directory.\n+     *\/\n+    private String getTempDirFromPid(int pid) {\n+        ProcessHandle ph = ProcessHandle.of(pid).orElse(null);\n+        if (ph != null) {\n+            String user = ph.info().user().orElse(null);\n+            if (user != null) {\n+                for (String dir : platformSupport.getTemporaryDirectories(pid)) {\n+                    Path fullPath = Path.of(dir, HSPERFDATA_PREFIX + user, String.valueOf(pid));\n+                    if (Files.exists(fullPath)) {\n+                        return dir;\n+                    }\n+                }\n+            }\n+        }\n+        return PlatformSupport.getTemporaryDirectory();\n+    }\n+\n@@ -238,2 +269,0 @@\n-    static native String getTempDir();\n-\n@@ -242,1 +271,0 @@\n-        tmpdir = getTempDir();\n","filename":"src\/jdk.attach\/macosx\/classes\/sun\/tools\/attach\/VirtualMachineImpl.java","additions":42,"deletions":14,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -338,24 +338,0 @@\n-\n-\/*\n- * Class:     sun_tools_attach_BSDVirtualMachine\n- * Method:    getTempDir\n- * Signature: (V)Ljava.lang.String;\n- *\/\n-JNIEXPORT jstring JNICALL Java_sun_tools_attach_VirtualMachineImpl_getTempDir(JNIEnv *env, jclass cls)\n-{\n-    \/\/ This must be hard coded because it's the system's temporary\n-    \/\/ directory not the java application's temp directory, ala java.io.tmpdir.\n-\n-#ifdef __APPLE__\n-    \/\/ macosx has a secure per-user temporary directory.\n-    \/\/ Don't cache the result as this is only called once.\n-    char path[PATH_MAX];\n-    int pathSize = confstr(_CS_DARWIN_USER_TEMP_DIR, path, PATH_MAX);\n-    if (pathSize == 0 || pathSize > PATH_MAX) {\n-        strlcpy(path, \"\/tmp\", sizeof(path));\n-    }\n-    return JNU_NewStringPlatform(env, path);\n-#else \/* __APPLE__ *\/\n-    return (*env)->NewStringUTF(env, \"\/tmp\");\n-#endif \/* __APPLE__ *\/\n-}\n","filename":"src\/jdk.attach\/macosx\/native\/libattach\/VirtualMachineImpl.c","additions":1,"deletions":25,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -1155,1 +1155,1 @@\n-                    ret = new VarSymbol(sym.flags() & FINAL, sym.name, sym.type, translatedSym);\n+                    ret = new VarSymbol(sym.flags(), sym.name, sym.type, translatedSym);\n@@ -1167,1 +1167,2 @@\n-                    ret = new VarSymbol((sym.flags() & FINAL) | PARAMETER, sym.name, types.erasure(sym.type), translatedSym);\n+                    Assert.check((sym.flags() & PARAMETER) != 0);\n+                    ret = new VarSymbol(sym.flags(), sym.name, types.erasure(sym.type), translatedSym);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/LambdaToMethod.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -3846,0 +3846,2 @@\n+            \/\/ If the local class is defined inside a static method, and the instance creation expression\n+            \/\/ occurs in that same method, the creation occurs (technically) inside a static context, but that's ok.\n@@ -3850,0 +3852,2 @@\n+            } else if (isStatic(env1) || env1.enclClass.sym.isStatic()) {\n+                staticOnly = true;\n@@ -3851,1 +3855,0 @@\n-            if (isStatic(env1)) staticOnly = true;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Resolve.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -295,1 +295,1 @@\n-compiler.err.cant.ref.before.ctor.called={0} kann nicht referenziert werden, bevor der Supertypkonstruktor aufgerufen wurde\n+compiler.err.cant.ref.before.ctor.called=Referenz zu {0} darf nur nach einem expliziten Konstruktoraufruf angezeigt werden\n@@ -298,1 +298,1 @@\n-compiler.err.cant.assign.initialized.before.ctor.called=Initialisiertes Feld \"{0}\" kann nicht zugewiesen werden, bevor der Supertypkonstruktor aufgerufen wurde\n+compiler.err.cant.assign.initialized.before.ctor.called=Zuweisung zu initialisiertem Feld \"{0}\" darf nur nach einem expliziten Konstruktoraufruf angezeigt werden\n@@ -652,1 +652,2 @@\n-compiler.err.method.does.not.override.superclass=Methode berschreibt oder implementiert keine Methode aus einem Supertyp\n+# 0: symbol, 1: symbol\n+compiler.err.method.does.not.override.superclass={0} in {1} berschreibt oder implementiert keine Methode aus einem Supertyp\n@@ -654,1 +655,2 @@\n-compiler.err.static.methods.cannot.be.annotated.with.override=Statische Methoden knnen nicht mit @Override-Annotation versehen werden\n+# 0: symbol, 1: symbol\n+compiler.err.static.methods.cannot.be.annotated.with.override=Statische Methode {0} in {1} kann nicht mit @Override-Annotation versehen werden\n@@ -656,1 +658,2 @@\n-compiler.err.missing.meth.body.or.decl.abstract=Methodenbody fehlt oder als abstrakt deklarieren\n+# 0: symbol, 1: symbol\n+compiler.err.missing.meth.body.or.decl.abstract=In Methode {0} in {1} fehlt ein Methodenbody, oder sie muss als abstrakt deklariert werden\n@@ -1142,0 +1145,1 @@\n+# flags: default-enabled\n@@ -1201,0 +1205,1 @@\n+# flags: mandatory\n@@ -1381,1 +1386,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1386,1 +1391,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1391,1 +1396,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1399,1 +1404,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1408,1 +1413,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1413,1 +1418,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1586,0 +1591,1 @@\n+# flags: default-enabled\n@@ -1590,0 +1596,1 @@\n+# flags: default-enabled\n@@ -1606,0 +1613,1 @@\n+# flags: default-enabled\n@@ -1610,0 +1618,1 @@\n+# flags: default-enabled\n@@ -1619,0 +1628,1 @@\n+# flags: default-enabled\n@@ -1625,0 +1635,4 @@\n+# 0: symbol, 1: file object\n+# lint: classfile\n+compiler.warn.inconsistent.inner.classes=InnerClasses-Attribut fr {0} in {1} inkonsistent mit Quellcode\\n({1} muss mglicherweise mit {0} neu kompiliert werden)\n+\n@@ -1709,0 +1723,4 @@\n+# 0: type\n+# lint: try\n+compiler.warn.try.resource.can.throw.interrupted.exc=close()-Methode kann InterruptedException in automatisch schliebarer Klasse {0} auslsen\n+\n@@ -1714,1 +1732,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1719,1 +1737,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1727,1 +1745,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1732,1 +1750,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1737,1 +1755,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1775,0 +1793,4 @@\n+# 0: type, 1: long, 2: number\n+# lint: lossy-conversions\n+compiler.warn.bit.shift.out.of.range=Das Verschieben von {0} um {1} Bit entspricht einer Verschiebung um {2} Bit\n+\n@@ -2026,1 +2048,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2300,1 +2322,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2305,1 +2327,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2380,1 +2402,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2385,1 +2407,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2390,0 +2412,1 @@\n+# flags: mandatory\n@@ -2786,0 +2809,1 @@\n+# flags: default-enabled\n@@ -2797,0 +2821,1 @@\n+# flags: default-enabled\n@@ -3063,1 +3088,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler_de.properties","additions":47,"deletions":22,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -295,1 +295,1 @@\n-compiler.err.cant.ref.before.ctor.called={0}\n+compiler.err.cant.ref.before.ctor.called={0}\n@@ -298,1 +298,1 @@\n-compiler.err.cant.assign.initialized.before.ctor.called=''{0}''\n+compiler.err.cant.assign.initialized.before.ctor.called=''{0}''\n@@ -652,1 +652,2 @@\n-compiler.err.method.does.not.override.superclass=\n+# 0: symbol, 1: symbol\n+compiler.err.method.does.not.override.superclass={1}{0}\n@@ -654,1 +655,2 @@\n-compiler.err.static.methods.cannot.be.annotated.with.override=static@Override\n+# 0: symbol, 1: symbol\n+compiler.err.static.methods.cannot.be.annotated.with.override={1}static{0}@Override\n@@ -656,1 +658,2 @@\n-compiler.err.missing.meth.body.or.decl.abstract=abstract\n+# 0: symbol, 1: symbol\n+compiler.err.missing.meth.body.or.decl.abstract={1}{0}abstract\n@@ -1142,0 +1145,1 @@\n+# flags: default-enabled\n@@ -1201,0 +1205,1 @@\n+# flags: mandatory\n@@ -1381,1 +1386,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1386,1 +1391,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1391,1 +1396,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1399,1 +1404,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1408,1 +1413,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1413,1 +1418,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1586,0 +1591,1 @@\n+# flags: default-enabled\n@@ -1590,0 +1596,1 @@\n+# flags: default-enabled\n@@ -1606,0 +1613,1 @@\n+# flags: default-enabled\n@@ -1610,0 +1618,1 @@\n+# flags: default-enabled\n@@ -1619,0 +1628,1 @@\n+# flags: default-enabled\n@@ -1625,0 +1635,4 @@\n+# 0: symbol, 1: file object\n+# lint: classfile\n+compiler.warn.inconsistent.inner.classes={1}{0}InnerClasses\\n({1}{0})\n+\n@@ -1709,0 +1723,4 @@\n+# 0: type\n+# lint: try\n+compiler.warn.try.resource.can.throw.interrupted.exc=close(){0}InterruptedException\n+\n@@ -1714,1 +1732,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1719,1 +1737,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1727,1 +1745,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1732,1 +1750,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1737,1 +1755,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1775,0 +1793,4 @@\n+# 0: type, 1: long, 2: number\n+# lint: lossy-conversions\n+compiler.warn.bit.shift.out.of.range={0}{1}{2}\n+\n@@ -2026,1 +2048,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2300,1 +2322,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2305,1 +2327,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2380,1 +2402,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2385,1 +2407,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2390,0 +2412,1 @@\n+# flags: mandatory\n@@ -2786,0 +2809,1 @@\n+# flags: default-enabled\n@@ -2797,0 +2821,1 @@\n+# flags: default-enabled\n@@ -3063,1 +3088,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler_ja.properties","additions":47,"deletions":22,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -295,1 +295,1 @@\n-compiler.err.cant.ref.before.ctor.called={0}\n+compiler.err.cant.ref.before.ctor.called= {0} \n@@ -298,1 +298,1 @@\n-compiler.err.cant.assign.initialized.before.ctor.called= ''{0}''\n+compiler.err.cant.assign.initialized.before.ctor.called= ''{0}'' \n@@ -652,1 +652,2 @@\n-compiler.err.method.does.not.override.superclass=\n+# 0: symbol, 1: symbol\n+compiler.err.method.does.not.override.superclass={1}  {0} \n@@ -654,1 +655,2 @@\n-compiler.err.static.methods.cannot.be.annotated.with.override= @Override \n+# 0: symbol, 1: symbol\n+compiler.err.static.methods.cannot.be.annotated.with.override= @Override  {1}  {0} \n@@ -656,1 +658,2 @@\n-compiler.err.missing.meth.body.or.decl.abstract=, \n+# 0: symbol, 1: symbol\n+compiler.err.missing.meth.body.or.decl.abstract={1}  {0} \n@@ -1142,0 +1145,1 @@\n+# flags: default-enabled\n@@ -1201,0 +1205,1 @@\n+# flags: mandatory\n@@ -1381,1 +1386,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1386,1 +1391,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1391,1 +1396,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1399,1 +1404,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1408,1 +1413,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1413,1 +1418,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1586,0 +1591,1 @@\n+# flags: default-enabled\n@@ -1590,0 +1596,1 @@\n+# flags: default-enabled\n@@ -1606,0 +1613,1 @@\n+# flags: default-enabled\n@@ -1610,0 +1618,1 @@\n+# flags: default-enabled\n@@ -1619,0 +1628,1 @@\n+# flags: default-enabled\n@@ -1625,0 +1635,4 @@\n+# 0: symbol, 1: file object\n+# lint: classfile\n+compiler.warn.inconsistent.inner.classes={1}  {0}  InnerClasses \\n {0}  {1}\n+\n@@ -1709,0 +1723,4 @@\n+# 0: type\n+# lint: try\n+compiler.warn.try.resource.can.throw.interrupted.exc= {0} close()  InterruptedException\n+\n@@ -1714,1 +1732,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1719,1 +1737,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1727,1 +1745,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1732,1 +1750,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1737,1 +1755,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -1775,0 +1793,4 @@\n+# 0: type, 1: long, 2: number\n+# lint: lossy-conversions\n+compiler.warn.bit.shift.out.of.range= {1}  {0}  {2} \n+\n@@ -2026,1 +2048,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2300,1 +2322,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2305,1 +2327,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2380,1 +2402,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2385,1 +2407,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n@@ -2390,0 +2412,1 @@\n+# flags: mandatory\n@@ -2786,0 +2809,1 @@\n+# flags: default-enabled\n@@ -2797,0 +2821,1 @@\n+# flags: default-enabled\n@@ -3063,1 +3088,1 @@\n-# flags: aggregate\n+# flags: aggregate, mandatory, default-enabled\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler_zh_CN.properties","additions":47,"deletions":22,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -63,0 +63,2 @@\n+javac.opt.arg.Werror=<Schlssel>(,<Schlssel>)*\n+javac.opt.Werror.custom=Geben Sie Lint-Kategorien, fr die die Kompilierung durch Warnungen beendet werden soll,\\ndurch Komma getrennt an. \\nStellen Sie einem Schlssel \"-\" voran, um die angegebene Kategorie auszuschlieen. Verwenden Sie --help-lint, um die untersttzten Schlssel anzuzeigen.\n@@ -100,3 +102,3 @@\n-javac.opt.Xlint=Empfohlene Warnungskategorien aktivieren\n-javac.opt.Xlint.all=Alle Warnungskategorien aktivieren\n-javac.opt.Xlint.none=Alle Warnungskategorien deaktivieren\n+javac.opt.Xlint=Aktivieren Sie empfohlene Lint-Warnungskategorien. In diesem Release werden alle\\nverfgbaren Lint-Warnungskategorien empfohlen.\n+javac.opt.Xlint.all=Alle Lint-Warnungskategorien aktivieren\n+javac.opt.Xlint.none=Alle Lint-Warnungskategorien deaktivieren\n@@ -105,1 +107,1 @@\n-javac.opt.Xlint.custom=Durch Komma getrennte Warnungskategorien, die aktiviert oder deaktiviert werden sollen.\\nStellen Sie einem Schlssel \"-\" voran, um die angegebene Warnung zu deaktivieren.\\nVerwenden Sie \"--help-lint\", um die untersttzten Schlssel anzuzeigen.\n+javac.opt.Xlint.custom=Lint-Warnungskategorien, die aktiviert oder deaktiviert werden sollen, durch Komma getrennt. \\nStellen Sie einem Schlssel \"-\" voran, um die angegebene Kategorie zu deaktivieren. Verwenden Sie\\n''--help-lint'', um untersttzte Schlssel und die standardmig aktivierten\\nKategorien anzuzeigen.\n@@ -132,1 +134,1 @@\n-javac.opt.Xlint.desc.lossy-conversions=Warnung ber mglichen Verlust von Konvertierungen in zusammengesetzten Zuweisungen.\n+javac.opt.Xlint.desc.lossy-conversions=Warnung ber mglichen Verlust von Konvertierungen in zusammengesetzten Zuweisungen und Bitverschiebungsvorgngen.\n@@ -178,3 +180,0 @@\n-# L10N: do not localize: identity synchronization\n-javac.opt.Xlint.desc.synchronization=Warnt vor Synchronisierungsversuchen mit Instanzen wertbasierter Klassen.\\n                         Dieser Schlssel ist ein veralteter Alias fr die Kategorie \"identity\", die dieselben Verwendungen und\\n                         Effekte hat. Benutzern wird empfohlen, die Kategorie \"identity\" fr alle zuknftigen\\n                         und vorhandenen Verwendungen von \"synchronization\" zu verwenden.\n-\n@@ -183,0 +182,2 @@\n+javac.opt.Xlint.alias.of=Veralteter Alias fr \"{0}\" mit identischem Effekt. Benutzern wird empfohlen,\\n                        \"{0}\" anstatt \"{1}\" fr alle aktuellen und zuknftigen Verwendungen zu nutzen.\n+\n@@ -198,1 +199,1 @@\n-javac.opt.help.lint=Gibt die untersttzten Schlssel fr -Xlint aus\n+javac.opt.help.lint=Gibt die untersttzten Schlssel fr -Xlint und -Werror aus\n@@ -200,0 +201,2 @@\n+javac.opt.help.lint.enabled.by.default=Die folgenden Lint-Warnungskategorien sind standardmig aktiviert:\n+javac.opt.help.lint.footer=Kategorien und die zugehrigen Aliasnamen knnen austauschbar verwendet werden. Beispiel: Das Kennzeichen\\n\"-Xlint:{0},{1}\" wre redundant.\n@@ -205,1 +208,2 @@\n-javac.opt.preview=Aktiviert Vorschausprachfeatures.\\nWird in Verbindung mit -source oder --release verwendet.\n+# L10N: do not localize: ''preview''\n+javac.opt.preview=Aktiviert Vorschausprachfeatures. \\nDeaktiviert auch die Lint-Kategorie ''preview''. \\nWird in Verbindung mit -source oder --release verwendet.\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/javac_de.properties","additions":14,"deletions":10,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -62,1 +62,3 @@\n-javac.opt.Werror=\n+javac.opt.Werror=\n+javac.opt.arg.Werror=<key>(,<key>)*\n+javac.opt.Werror.custom=lint\\n\\n''-''\\n--help-lint\n@@ -100,3 +102,3 @@\n-javac.opt.Xlint=\n-javac.opt.Xlint.all=\n-javac.opt.Xlint.none=\n+javac.opt.Xlint=lint\\nlint\n+javac.opt.Xlint.all=lint\n+javac.opt.Xlint.none=lint\n@@ -105,1 +107,1 @@\n-javac.opt.Xlint.custom=()\\n''-''\\n--help-lint\n+javac.opt.Xlint.custom=Lint()\\n''-''\\n\\n''--help-lint''\n@@ -132,1 +134,1 @@\n-javac.opt.Xlint.desc.lossy-conversions=\n+javac.opt.Xlint.desc.lossy-conversions=\n@@ -178,3 +180,0 @@\n-# L10N: do not localize: identity synchronization\n-javac.opt.Xlint.desc.synchronization=\\n                         ''identity''\\n                         ''synchronization''''identity''\\n                         \n-\n@@ -183,0 +182,2 @@\n+javac.opt.Xlint.alias.of=''{0}''\\n                         ''{1}''''{0}''\n+\n@@ -198,1 +199,1 @@\n-javac.opt.help.lint=-Xlint\n+javac.opt.help.lint=-Xlint-Werror\n@@ -200,0 +201,2 @@\n+javac.opt.help.lint.enabled.by.default=lint:\n+javac.opt.help.lint.footer=\\n''-Xlint:{0},{1}''\n@@ -205,1 +208,2 @@\n-javac.opt.preview=-source--release\n+# L10N: do not localize: ''preview''\n+javac.opt.preview=\\n''preview'' lint\\n-source--release\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/javac_ja.properties","additions":15,"deletions":11,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -62,1 +62,3 @@\n-javac.opt.Werror=\n+javac.opt.Werror=\n+javac.opt.arg.Werror=<key>(,<key>)*\n+javac.opt.Werror.custom= lint \\n\\n ''-'' \\n --help-lint \n@@ -100,3 +102,3 @@\n-javac.opt.Xlint=\n-javac.opt.Xlint.all=\n-javac.opt.Xlint.none=\n+javac.opt.Xlint= lint \\n lint \n+javac.opt.Xlint.all= lint \n+javac.opt.Xlint.none= lint \n@@ -105,1 +107,1 @@\n-javac.opt.Xlint.custom=\\n ''-'' \\n --help-lint \n+javac.opt.Xlint.custom= lint \\n ''-'' \\n ''--help-lint'' \\n\n@@ -132,1 +134,1 @@\n-javac.opt.Xlint.desc.lossy-conversions=\n+javac.opt.Xlint.desc.lossy-conversions=\n@@ -178,3 +180,0 @@\n-# L10N: do not localize: identity synchronization\n-javac.opt.Xlint.desc.synchronization=\\n                          ''identity'' \\n                          ''synchronization'' \\n                          ''identity'' \n-\n@@ -183,0 +182,2 @@\n+javac.opt.Xlint.alias.of= ''{0}'' \\n                          ''{0}''  ''{1}''\n+\n@@ -198,1 +199,1 @@\n-javac.opt.help.lint= -Xlint \n+javac.opt.help.lint= -Xlint  -Werror \n@@ -200,0 +201,2 @@\n+javac.opt.help.lint.enabled.by.default= lint \n+javac.opt.help.lint.footer=\\n''-Xlint:{0},{1}'' \n@@ -205,1 +208,2 @@\n-javac.opt.preview= -source  --release \n+# L10N: do not localize: ''preview''\n+javac.opt.preview=\\n''preview''lint \\n -source  --release \n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/javac_zh_CN.properties","additions":15,"deletions":11,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -114,0 +114,3 @@\n+# 0: string\n+launcher.err.cant.use.private.constructor=Kein nicht privater Null-Argument-Konstruktor in Klasse {0} gefunden\\nEntfernen Sie die Eigenschaft \"private\" aus dem vorhandenen Konstruktor, oder definieren Sie ihn als:\\n   public {0}()\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/launcher_de.properties","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -114,0 +114,3 @@\n+# 0: string\n+launcher.err.cant.use.private.constructor=private{0}\\nprivate:\\n   public {0}()\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/launcher_ja.properties","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -114,0 +114,3 @@\n+# 0: string\n+launcher.err.cant.use.private.constructor= {0}  non-private \\n private\\n   public {0}()\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/launcher_zh_CN.properties","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -89,0 +89,2 @@\n+       Address rsp = context.getRegisterAsAddress(AMD64ThreadContext.RSP);\n+       if (rsp == null) return null;\n@@ -93,1 +95,1 @@\n-       return new BsdAMD64CFrame(dbg, rbp, pc);\n+       return new BsdAMD64CFrame(dbg, rsp, rbp, pc);\n@@ -96,0 +98,2 @@\n+       Address sp = context.getRegisterAsAddress(AARCH64ThreadContext.SP);\n+       if (sp == null) return null;\n@@ -100,1 +104,1 @@\n-       return new BsdAARCH64CFrame(dbg, fp, pc);\n+       return new BsdAARCH64CFrame(dbg, sp, fp, pc);\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/debugger\/bsd\/BsdCDebugger.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import sun.jvm.hotspot.code.*;\n@@ -34,0 +35,2 @@\n+import sun.jvm.hotspot.runtime.*;\n+import sun.jvm.hotspot.runtime.aarch64.*;\n@@ -36,1 +39,1 @@\n-   public BsdAARCH64CFrame(BsdDebugger dbg, Address fp, Address pc) {\n+   public BsdAARCH64CFrame(BsdDebugger dbg, Address sp, Address fp, Address pc) {\n@@ -38,0 +41,1 @@\n+      this.sp = sp;\n@@ -57,0 +61,1 @@\n+   @Override\n@@ -58,2 +63,2 @@\n-      AARCH64ThreadContext context = (AARCH64ThreadContext) thread.getContext();\n-      Address rsp = context.getRegisterAsAddress(AARCH64ThreadContext.SP);\n+      return sender(thread, null, null, null);\n+   }\n@@ -61,2 +66,13 @@\n-      if ((fp == null) || fp.lessThan(rsp)) {\n-        return null;\n+   @Override\n+   public CFrame sender(ThreadProxy thread, Address nextSP, Address nextFP, Address nextPC) {\n+      \/\/ Check fp\n+      \/\/ Skip if both nextFP and nextPC are given - do not need to load from fp.\n+      if (nextFP == null && nextPC == null) {\n+        if (fp == null) {\n+          return null;\n+        }\n+\n+        \/\/ Check alignment of fp\n+        if (dbg.getAddressValue(fp) % (2 * ADDRESS_SIZE) != 0) {\n+          return null;\n+        }\n@@ -65,2 +81,4 @@\n-      \/\/ Check alignment of fp\n-      if (dbg.getAddressValue(fp) % (2 * ADDRESS_SIZE) != 0) {\n+      if (nextFP == null) {\n+        nextFP = fp.getAddressAt(0);\n+      }\n+      if (nextFP == null) {\n@@ -70,3 +88,2 @@\n-      Address nextFP = fp.getAddressAt(0 * ADDRESS_SIZE);\n-      if (nextFP == null || nextFP.lessThanOrEqual(fp)) {\n-        return null;\n+      if (nextPC == null) {\n+        nextPC = fp.getAddressAt(ADDRESS_SIZE);\n@@ -74,1 +91,0 @@\n-      Address nextPC  = fp.getAddressAt(1 * ADDRESS_SIZE);\n@@ -78,1 +94,26 @@\n-      return new BsdAARCH64CFrame(dbg, nextFP, nextPC);\n+\n+      if (nextSP == null) {\n+        CodeCache cc = VM.getVM().getCodeCache();\n+        CodeBlob currentBlob = cc.findBlobUnsafe(pc());\n+\n+        \/\/ This case is different from HotSpot. See JDK-8371194 for details.\n+        if (currentBlob != null && (currentBlob.isContinuationStub() || currentBlob.isNativeMethod())) {\n+          \/\/ Use FP since it should always be valid for these cases.\n+          \/\/ TODO: These should be walked as Frames not CFrames.\n+          nextSP = fp.addOffsetTo(2 * ADDRESS_SIZE);\n+        } else {\n+          CodeBlob codeBlob = cc.findBlobUnsafe(nextPC);\n+          boolean useCodeBlob = codeBlob != null && codeBlob.getFrameSize() > 0;\n+          nextSP = useCodeBlob ? nextFP.addOffsetTo((2 * ADDRESS_SIZE) - codeBlob.getFrameSize()) : nextFP;\n+        }\n+      }\n+      if (nextSP == null) {\n+        return null;\n+      }\n+\n+      return new BsdAARCH64CFrame(dbg, nextSP, nextFP, nextPC);\n+   }\n+\n+   @Override\n+   public Frame toFrame() {\n+      return new AARCH64Frame(sp, fp, pc);\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/debugger\/bsd\/aarch64\/BsdAARCH64CFrame.java","additions":54,"deletions":13,"binary":false,"changes":67,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,2 @@\n+import sun.jvm.hotspot.runtime.*;\n+import sun.jvm.hotspot.runtime.amd64.*;\n@@ -34,1 +36,1 @@\n-   public BsdAMD64CFrame(BsdDebugger dbg, Address rbp, Address rip) {\n+   public BsdAMD64CFrame(BsdDebugger dbg, Address rsp, Address rbp, Address rip) {\n@@ -36,0 +38,1 @@\n+      this.rsp = rsp;\n@@ -55,0 +58,1 @@\n+   @Override\n@@ -56,2 +60,2 @@\n-      AMD64ThreadContext context = (AMD64ThreadContext) thread.getContext();\n-      Address rsp = context.getRegisterAsAddress(AMD64ThreadContext.RSP);\n+      return sender(thread, null, null, null);\n+   }\n@@ -59,2 +63,13 @@\n-      if ( (rbp == null) || rbp.lessThan(rsp) ) {\n-        return null;\n+   @Override\n+   public CFrame sender(ThreadProxy thread, Address sp, Address fp, Address pc) {\n+      \/\/ Check fp\n+      \/\/ Skip if both fp and pc are given - do not need to load from rbp.\n+      if (fp == null && pc == null) {\n+        if (rbp == null) {\n+          return null;\n+        }\n+\n+        \/\/ Check alignment of rbp\n+        if (dbg.getAddressValue(rbp) % ADDRESS_SIZE != 0) {\n+          return null;\n+        }\n@@ -63,2 +78,2 @@\n-      \/\/ Check alignment of rbp\n-      if (dbg.getAddressValue(rbp) % ADDRESS_SIZE != 0) {\n+      Address nextRSP = sp != null ? sp : rbp.addOffsetTo(2 * ADDRESS_SIZE);\n+      if (nextRSP == null) {\n@@ -67,3 +82,2 @@\n-\n-      Address nextRBP = rbp.getAddressAt( 0 * ADDRESS_SIZE);\n-      if (nextRBP == null || nextRBP.lessThanOrEqual(rbp)) {\n+      Address nextRBP = fp != null ? fp : rbp.getAddressAt(0);\n+      if (nextRBP == null) {\n@@ -72,1 +86,1 @@\n-      Address nextPC  = rbp.getAddressAt( 1 * ADDRESS_SIZE);\n+      Address nextPC  = pc != null ? pc : rbp.getAddressAt(ADDRESS_SIZE);\n@@ -76,1 +90,6 @@\n-      return new BsdAMD64CFrame(dbg, nextRBP, nextPC);\n+      return new BsdAMD64CFrame(dbg, nextRSP, nextRBP, nextPC);\n+   }\n+\n+   @Override\n+   public Frame toFrame() {\n+      return new AMD64Frame(rsp, rbp, rip);\n@@ -81,0 +100,1 @@\n+   private Address rsp;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/debugger\/bsd\/amd64\/BsdAMD64CFrame.java","additions":33,"deletions":13,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +43,1 @@\n-    protected Authenticator () { }\n+    protected Authenticator() { }\n@@ -53,1 +53,1 @@\n-        protected Result () {}\n+        protected Result() {}\n@@ -70,1 +70,1 @@\n-        public Failure (int responseCode) {\n+        public Failure(int responseCode) {\n@@ -97,1 +97,1 @@\n-        public Success (HttpPrincipal p) {\n+        public Success(HttpPrincipal p) {\n@@ -129,1 +129,1 @@\n-        public Retry (int responseCode) {\n+        public Retry(int responseCode) {\n@@ -161,1 +161,1 @@\n-    public abstract Result authenticate (HttpExchange exch);\n+    public abstract Result authenticate(HttpExchange exch);\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/Authenticator.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,1 @@\n- * to provide an implementation of {@link #checkCredentials(String,String)}\n+ * to provide an implementation of {@link #checkCredentials(String, String)}\n@@ -107,1 +107,1 @@\n-    public String getRealm () {\n+    public String getRealm() {\n@@ -111,1 +111,1 @@\n-    public Result authenticate (HttpExchange t)\n+    public Result authenticate(HttpExchange t)\n@@ -117,1 +117,1 @@\n-        String auth = rmap.getFirst (\"Authorization\");\n+        String auth = rmap.getFirst(\"Authorization\");\n@@ -120,1 +120,1 @@\n-            return new Authenticator.Retry (401);\n+            return new Authenticator.Retry(401);\n@@ -122,1 +122,1 @@\n-        int sp = auth.indexOf (' ');\n+        int sp = auth.indexOf(' ');\n@@ -124,1 +124,1 @@\n-            return new Authenticator.Failure (401);\n+            return new Authenticator.Failure(401);\n@@ -127,4 +127,4 @@\n-        String userpass = new String (b, charset);\n-        int colon = userpass.indexOf (':');\n-        String uname = userpass.substring (0, colon);\n-        String pass = userpass.substring (colon+1);\n+        String userpass = new String(b, charset);\n+        int colon = userpass.indexOf(':');\n+        String uname = userpass.substring(0, colon);\n+        String pass = userpass.substring(colon+1);\n@@ -132,3 +132,3 @@\n-        if (checkCredentials (uname, pass)) {\n-            return new Authenticator.Success (\n-                new HttpPrincipal (\n+        if (checkCredentials(uname, pass)) {\n+            return new Authenticator.Success(\n+                new HttpPrincipal(\n@@ -149,1 +149,1 @@\n-        map.set (\"WWW-Authenticate\", authString);\n+        map.set(\"WWW-Authenticate\", authString);\n@@ -162,1 +162,1 @@\n-    public abstract boolean checkCredentials (String username, String password);\n+    public abstract boolean checkCredentials(String username, String password);\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/BasicAuthenticator.java","additions":17,"deletions":17,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,1 @@\n-    protected Filter () {}\n+    protected Filter() {}\n@@ -79,1 +79,1 @@\n-        public Chain (List<Filter> filters, HttpHandler handler) {\n+        public Chain(List<Filter> filters, HttpHandler handler) {\n@@ -96,1 +96,1 @@\n-        public void doFilter (HttpExchange exchange) throws IOException {\n+        public void doFilter(HttpExchange exchange) throws IOException {\n@@ -98,1 +98,1 @@\n-                handler.handle (exchange);\n+                handler.handle(exchange);\n@@ -101,1 +101,1 @@\n-                f.doFilter (exchange, this);\n+                f.doFilter(exchange, this);\n@@ -138,1 +138,1 @@\n-    public abstract void doFilter (HttpExchange exchange, Chain chain)\n+    public abstract void doFilter(HttpExchange exchange, Chain chain)\n@@ -145,1 +145,1 @@\n-    public abstract String description ();\n+    public abstract String description();\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/Filter.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n- *     <li>{@link #add(String,String)} adds the given header value to the list\n+ *     <li>{@link #add(String, String)} adds the given header value to the list\n@@ -67,1 +67,1 @@\n- *     <li>{@link #set(String,String)} sets the given header field to the single\n+ *     <li>{@link #set(String, String)} sets the given header field to the single\n@@ -83,1 +83,1 @@\n-public class Headers implements Map<String,List<String>> {\n+public class Headers implements Map<String, List<String>> {\n@@ -85,1 +85,1 @@\n-    HashMap<String,List<String>> map;\n+    HashMap<String, List<String>> map;\n@@ -102,1 +102,1 @@\n-    public Headers(Map<String,List<String>> headers) {\n+    public Headers(Map<String, List<String>> headers) {\n@@ -237,1 +237,1 @@\n-            map.put(k,l);\n+            map.put(k, l);\n@@ -375,1 +375,1 @@\n-    public static Headers of(Map<String,List<String>> headers) {\n+    public static Headers of(Map<String, List<String>> headers) {\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/Headers.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -93,1 +93,1 @@\n-    public abstract Map<String,Object> getAttributes() ;\n+    public abstract Map<String, Object> getAttributes() ;\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/HttpContext.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -51,1 +51,1 @@\n- *     <li>{@link #sendResponseHeaders(int,long)} to send the response headers.\n+ *     <li>{@link #sendResponseHeaders(int, long)} to send the response headers.\n@@ -76,1 +76,1 @@\n-     * sendResponseHeaders(int,long)\n+     * sendResponseHeaders(int, long)\n@@ -166,1 +166,1 @@\n-     * written. {@link #sendResponseHeaders(int,long)}) must be called prior to\n+     * written. {@link #sendResponseHeaders(int, long)}) must be called prior to\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/HttpExchange.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,1 +47,1 @@\n-    public abstract void handle (HttpExchange exchange) throws IOException;\n+    public abstract void handle(HttpExchange exchange) throws IOException;\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/HttpHandler.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,1 +47,1 @@\n- * calling {@link #createContext(String,HttpHandler)}.\n+ * calling {@link #createContext(String, HttpHandler)}.\n@@ -120,1 +120,1 @@\n-     * {@link #bind(InetSocketAddress,int)} before it can be used.\n+     * {@link #bind(InetSocketAddress, int)} before it can be used.\n@@ -126,1 +126,1 @@\n-        return create (null, 0);\n+        return create(null, 0);\n@@ -152,1 +152,1 @@\n-        return provider.createHttpServer (addr, backlog);\n+        return provider.createHttpServer(addr, backlog);\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/HttpServer.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,1 +41,1 @@\n- * SSLContext sslContext = SSLContext.getInstance (....);\n+ * SSLContext sslContext = SSLContext.getInstance(....);\n@@ -44,2 +44,2 @@\n- * server.setHttpsConfigurator (new HttpsConfigurator(sslContext) {\n- *     public void configure (HttpsParameters params) {\n+ * server.setHttpsConfigurator(new HttpsConfigurator(sslContext) {\n+ *     public void configure(HttpsParameters params) {\n@@ -54,1 +54,1 @@\n- *         if (remote.equals (...) ) {\n+ *         if (remote.equals(...)) {\n@@ -77,1 +77,1 @@\n-            throw new NullPointerException (\"null SSLContext\");\n+            throw new NullPointerException(\"null SSLContext\");\n@@ -110,1 +110,1 @@\n-        params.setSSLParameters (getSSLContext().getDefaultSSLParameters());\n+        params.setSSLParameters(getSSLContext().getDefaultSSLParameters());\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/HttpsConfigurator.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,1 @@\n-     * {@link #bind(InetSocketAddress,int)} before it can be used. The server\n+     * {@link #bind(InetSocketAddress, int)} before it can be used. The server\n@@ -83,1 +83,1 @@\n-     *             {@link #bind(InetSocketAddress,int)} must be called to set\n+     *             {@link #bind(InetSocketAddress, int)} must be called to set\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/HttpsServer.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,1 +58,1 @@\n- * <p> The {@link #createFileServer(InetSocketAddress,Path,OutputLevel) createFileServer}\n+ * <p> The {@link #createFileServer(InetSocketAddress, Path, OutputLevel) createFileServer}\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/SimpleFileServer.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -120,2 +120,2 @@\n-    server.setHttpsConfigurator (new HttpsConfigurator(sslContext) {\n-        public void configure (HttpsParameters params) {\n+   server.setHttpsConfigurator(new HttpsConfigurator(sslContext) {\n+       public void configure(HttpsParameters params) {\n@@ -123,2 +123,2 @@\n-        \/\/ get the remote address if needed\n-        InetSocketAddress remote = params.getClientAddress();\n+           \/\/ get the remote address if needed\n+           InetSocketAddress remote = params.getClientAddress();\n@@ -126,1 +126,1 @@\n-        SSLContext c = getSSLContext();\n+           SSLContext c = getSSLContext();\n@@ -128,5 +128,5 @@\n-        \/\/ get the default parameters\n-        SSLParameters sslparams = c.getDefaultSSLParameters();\n-        if (remote.equals (...) ) {\n-            \/\/ modify the default set for client x\n-        }\n+           \/\/ get the default parameters\n+           SSLParameters sslparams = c.getDefaultSSLParameters();\n+           if (remote.equals(...)) {\n+               \/\/ modify the default set for client x\n+           }\n@@ -134,6 +134,5 @@\n-        params.setSSLParameters(sslparams);\n-        \/\/ statement above could throw IAE if any params invalid.\n-        \/\/ eg. if app has a UI and parameters supplied by a user.\n-\n-        }\n-    });\n+           params.setSSLParameters(sslparams);\n+           \/\/ statement above could throw IAE if any params invalid.\n+           \/\/ eg. if app has a UI and parameters supplied by a user.\n+       }\n+   });\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/package-info.java","additions":16,"deletions":17,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -155,1 +155,1 @@\n-    public static HttpServerProvider provider () {\n+    public static HttpServerProvider provider() {\n","filename":"src\/jdk.httpserver\/share\/classes\/com\/sun\/net\/httpserver\/spi\/HttpServerProvider.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -36,1 +36,1 @@\n-    public AuthFilter (Authenticator authenticator) {\n+    public AuthFilter(Authenticator authenticator) {\n@@ -40,1 +40,1 @@\n-    public String description () {\n+    public String description() {\n@@ -44,1 +44,1 @@\n-    public void setAuthenticator (Authenticator a) {\n+    public void setAuthenticator(Authenticator a) {\n@@ -48,1 +48,1 @@\n-    public void consumeInput (HttpExchange t) throws IOException {\n+    public void consumeInput(HttpExchange t) throws IOException {\n@@ -51,2 +51,2 @@\n-        while (i.read (b) != -1);\n-        i.close ();\n+        while (i.read(b) != -1);\n+        i.close();\n@@ -58,1 +58,1 @@\n-    public void doFilter (HttpExchange t, Filter.Chain chain) throws IOException\n+    public void doFilter(HttpExchange t, Filter.Chain chain) throws IOException\n@@ -61,1 +61,1 @@\n-            Authenticator.Result r = authenticator.authenticate (t);\n+            Authenticator.Result r = authenticator.authenticate(t);\n@@ -64,3 +64,3 @@\n-                ExchangeImpl e = ExchangeImpl.get (t);\n-                e.setPrincipal (s.getPrincipal());\n-                chain.doFilter (t);\n+                ExchangeImpl e = ExchangeImpl.get(t);\n+                e.setPrincipal(s.getPrincipal());\n+                chain.doFilter(t);\n@@ -69,2 +69,2 @@\n-                consumeInput (t);\n-                t.sendResponseHeaders (ry.getResponseCode(), RSPBODY_EMPTY);\n+                consumeInput(t);\n+                t.sendResponseHeaders(ry.getResponseCode(), RSPBODY_EMPTY);\n@@ -73,2 +73,2 @@\n-                consumeInput (t);\n-                t.sendResponseHeaders (f.getResponseCode(), RSPBODY_EMPTY);\n+                consumeInput(t);\n+                t.sendResponseHeaders(f.getResponseCode(), RSPBODY_EMPTY);\n@@ -77,1 +77,1 @@\n-            chain.doFilter (t);\n+            chain.doFilter(t);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/AuthFilter.java","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-    ChunkedInputStream (ExchangeImpl t, InputStream src) {\n+    ChunkedInputStream(ExchangeImpl t, InputStream src) {\n@@ -51,1 +51,1 @@\n-    private int numeric (char[] arr, int nchars) throws IOException {\n+    private int numeric(char[] arr, int nchars) throws IOException {\n@@ -64,1 +64,1 @@\n-                throw new IOException (\"invalid chunk length\");\n+                throw new IOException(\"invalid chunk length\");\n@@ -74,1 +74,1 @@\n-    private int readChunkHeader () throws IOException {\n+    private int readChunkHeader() throws IOException {\n@@ -77,1 +77,1 @@\n-        char[] len_arr = new char [16];\n+        char[] len_arr = new char[16];\n@@ -88,1 +88,1 @@\n-                throw new IOException (\"invalid chunk header\");\n+                throw new IOException(\"invalid chunk header\");\n@@ -92,1 +92,1 @@\n-                    int l = numeric (len_arr, len_size);\n+                    int l = numeric(len_arr, len_size);\n@@ -110,1 +110,1 @@\n-        throw new IOException (\"end of stream reading chunk header\");\n+        throw new IOException(\"end of stream reading chunk header\");\n@@ -113,1 +113,1 @@\n-    protected int readImpl (byte[]b, int off, int len) throws IOException {\n+    protected int readImpl(byte[] b, int off, int len) throws IOException {\n@@ -122,1 +122,1 @@\n-                t.getServerImpl().requestCompleted (t.getConnection());\n+                t.getServerImpl().requestCompleted(t.getConnection());\n@@ -143,1 +143,1 @@\n-    private void consumeCRLF () throws IOException {\n+    private void consumeCRLF() throws IOException {\n@@ -147,1 +147,1 @@\n-            throw new IOException (\"invalid chunk end\");\n+            throw new IOException(\"invalid chunk end\");\n@@ -151,1 +151,1 @@\n-            throw new IOException (\"invalid chunk end\");\n+            throw new IOException(\"invalid chunk end\");\n@@ -161,1 +161,1 @@\n-    public int available () throws IOException {\n+    public int available() throws IOException {\n@@ -173,1 +173,1 @@\n-    public boolean isDataBuffered () throws IOException {\n+    public boolean isDataBuffered() throws IOException {\n@@ -178,1 +178,1 @@\n-    public boolean markSupported () {return false;}\n+    public boolean markSupported() {return false;}\n@@ -180,1 +180,1 @@\n-    public void mark (int l) {\n+    public void mark(int l) {\n@@ -183,2 +183,2 @@\n-    public void reset () throws IOException {\n-        throw new IOException (\"mark\/reset not supported\");\n+    public void reset() throws IOException {\n+        throw new IOException(\"mark\/reset not supported\");\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/ChunkedInputStream.java","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -60,2 +60,2 @@\n-    ChunkedOutputStream (ExchangeImpl t, OutputStream src) {\n-        super (src);\n+    ChunkedOutputStream(ExchangeImpl t, OutputStream src) {\n+        super(src);\n@@ -65,1 +65,1 @@\n-    public void write (int b) throws IOException {\n+    public void write(int b) throws IOException {\n@@ -67,1 +67,1 @@\n-            throw new StreamClosedException ();\n+            throw new StreamClosedException();\n@@ -77,1 +77,1 @@\n-    public void write (byte[]b, int off, int len) throws IOException {\n+    public void write(byte[] b, int off, int len) throws IOException {\n@@ -83,1 +83,1 @@\n-            throw new StreamClosedException ();\n+            throw new StreamClosedException();\n@@ -87,1 +87,1 @@\n-            System.arraycopy (b,off,buf,pos,remain);\n+            System.arraycopy(b, off, buf, pos, remain);\n@@ -93,1 +93,1 @@\n-                System.arraycopy (b,off,buf,OFFSET,CHUNK_SIZE);\n+                System.arraycopy(b, off, buf, OFFSET, CHUNK_SIZE);\n@@ -101,1 +101,1 @@\n-            System.arraycopy (b,off,buf,pos,len);\n+            System.arraycopy(b, off, buf, pos, len);\n@@ -115,2 +115,2 @@\n-    private void writeChunk () throws IOException {\n-        char[] c = Integer.toHexString (count).toCharArray();\n+    private void writeChunk() throws IOException {\n+        char[] c = Integer.toHexString(count).toCharArray();\n@@ -127,1 +127,1 @@\n-        out.write (buf, startByte, i+count);\n+        out.write(buf, startByte, i+count);\n@@ -132,1 +132,1 @@\n-    public void close () throws IOException {\n+    public void close() throws IOException {\n@@ -159,1 +159,1 @@\n-        t.getHttpContext().getServerImpl().addEvent (e);\n+        t.getHttpContext().getServerImpl().addEvent(e);\n@@ -162,1 +162,1 @@\n-    public void flush () throws IOException {\n+    public void flush() throws IOException {\n@@ -164,1 +164,1 @@\n-            throw new StreamClosedException ();\n+            throw new StreamClosedException();\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/ChunkedOutputStream.java","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2006, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,1 @@\n-    static String msg (int code) {\n+    static String msg(int code) {\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/Code.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-    public synchronized void add (HttpContextImpl ctx) {\n+    public synchronized void add(HttpContextImpl ctx) {\n@@ -37,1 +37,1 @@\n-            throw new IllegalArgumentException (\"cannot add context to list\");\n+            throw new IllegalArgumentException(\"cannot add context to list\");\n@@ -39,1 +39,1 @@\n-        list.add (ctx);\n+        list.add(ctx);\n@@ -46,1 +46,1 @@\n-    public synchronized int size () {\n+    public synchronized int size() {\n@@ -53,2 +53,2 @@\n-    synchronized HttpContextImpl findContext (String protocol, String path) {\n-        return findContext (protocol, path, false);\n+    synchronized HttpContextImpl findContext(String protocol, String path) {\n+        return findContext(protocol, path, false);\n@@ -57,1 +57,1 @@\n-    synchronized HttpContextImpl findContext (String protocol, String path, boolean exact) {\n+    synchronized HttpContextImpl findContext(String protocol, String path, boolean exact) {\n@@ -66,1 +66,1 @@\n-            if (exact && !cpath.equals (path)) {\n+            if (exact && !cpath.equals(path)) {\n@@ -79,1 +79,1 @@\n-    public synchronized void remove (String protocol, String path)\n+    public synchronized void remove(String protocol, String path)\n@@ -82,1 +82,1 @@\n-        HttpContextImpl ctx = findContext (protocol, path, true);\n+        HttpContextImpl ctx = findContext(protocol, path, true);\n@@ -84,1 +84,1 @@\n-            throw new IllegalArgumentException (\"cannot remove element from list\");\n+            throw new IllegalArgumentException(\"cannot remove element from list\");\n@@ -86,1 +86,1 @@\n-        list.remove (ctx);\n+        list.remove(ctx);\n@@ -89,1 +89,1 @@\n-    public synchronized void remove (HttpContextImpl context)\n+    public synchronized void remove(HttpContextImpl context)\n@@ -93,2 +93,2 @@\n-            if (ctx.equals (context)) {\n-                list.remove (ctx);\n+            if (ctx.equals(context)) {\n+                list.remove(ctx);\n@@ -98,1 +98,1 @@\n-        throw new IllegalArgumentException (\"no such context in list\");\n+        throw new IllegalArgumentException(\"no such context in list\");\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/ContextList.java","additions":17,"deletions":17,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,2 +34,2 @@\n-    public HttpServer createHttpServer (InetSocketAddress addr, int backlog) throws IOException {\n-        return new HttpServerImpl (addr, backlog);\n+    public HttpServer createHttpServer(InetSocketAddress addr, int backlog) throws IOException {\n+        return new HttpServerImpl(addr, backlog);\n@@ -38,2 +38,2 @@\n-    public HttpsServer createHttpsServer (InetSocketAddress addr, int backlog) throws IOException {\n-        return new HttpsServerImpl (addr, backlog);\n+    public HttpsServer createHttpsServer(InetSocketAddress addr, int backlog) throws IOException {\n+        return new HttpsServerImpl(addr, backlog);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/DefaultHttpServerProvider.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -85,1 +85,1 @@\n-    final Map<String,Object> attributes;\n+    final Map<String, Object> attributes;\n@@ -90,1 +90,1 @@\n-    ExchangeImpl (\n+    ExchangeImpl(\n@@ -110,1 +110,1 @@\n-    public Headers getRequestHeaders () {\n+    public Headers getRequestHeaders() {\n@@ -114,1 +114,1 @@\n-    public Headers getResponseHeaders () {\n+    public Headers getResponseHeaders() {\n@@ -118,1 +118,1 @@\n-    public URI getRequestURI () {\n+    public URI getRequestURI() {\n@@ -122,1 +122,1 @@\n-    public String getRequestMethod (){\n+    public String getRequestMethod() {\n@@ -126,1 +126,1 @@\n-    public HttpContextImpl getHttpContext (){\n+    public HttpContextImpl getHttpContext() {\n@@ -134,1 +134,1 @@\n-    public void close () {\n+    public void close() {\n@@ -163,1 +163,1 @@\n-    public InputStream getRequestBody () {\n+    public InputStream getRequestBody() {\n@@ -168,1 +168,1 @@\n-            uis_orig = new ChunkedInputStream (this, ris);\n+            uis_orig = new ChunkedInputStream(this, ris);\n@@ -171,1 +171,1 @@\n-            uis_orig = new FixedLengthInputStream (this, ris, reqContentLen);\n+            uis_orig = new FixedLengthInputStream(this, ris, reqContentLen);\n@@ -177,1 +177,1 @@\n-    LeftOverInputStream getOriginalInputStream () {\n+    LeftOverInputStream getOriginalInputStream() {\n@@ -181,1 +181,1 @@\n-    public int getResponseCode () {\n+    public int getResponseCode() {\n@@ -185,1 +185,1 @@\n-    public OutputStream getResponseBody () {\n+    public OutputStream getResponseBody() {\n@@ -190,1 +190,1 @@\n-         *    throw new IllegalStateException (\"headers not sent\");\n+         *    throw new IllegalStateException(\"headers not sent\");\n@@ -194,1 +194,1 @@\n-            uos_orig = new PlaceholderOutputStream (null);\n+            uos_orig = new PlaceholderOutputStream(null);\n@@ -205,1 +205,1 @@\n-    PlaceholderOutputStream getPlaceholderResponseBody () {\n+    PlaceholderOutputStream getPlaceholderResponseBody() {\n@@ -210,1 +210,1 @@\n-    public void sendResponseHeaders (int rCode, long contentLen)\n+    public void sendResponseHeaders(int rCode, long contentLen)\n@@ -215,1 +215,1 @@\n-            throw new IOException (\"headers already sent\");\n+            throw new IOException(\"headers already sent\");\n@@ -218,1 +218,1 @@\n-        String statusLine = \"HTTP\/1.1 \"+rCode+Code.msg(rCode)+\"\\r\\n\";\n+        String statusLine = \"HTTP\/1.1 \" + rCode + Code.msg(rCode) + \"\\r\\n\";\n@@ -221,1 +221,1 @@\n-        tmpout.write (bytes(statusLine, 0), 0, statusLine.length());\n+        tmpout.write(bytes(statusLine, 0), 0, statusLine.length());\n@@ -228,1 +228,1 @@\n-        if ((rCode>=100 && rCode <200) \/* informational *\/\n+        if ((rCode >= 100 && rCode < 200) \/* informational *\/\n@@ -233,1 +233,1 @@\n-                String msg = \"sendResponseHeaders: rCode = \"+ rCode\n+                String msg = \"sendResponseHeaders: rCode = \" + rCode\n@@ -235,1 +235,1 @@\n-                logger.log (Level.WARNING, msg);\n+                logger.log(Level.WARNING, msg);\n@@ -248,1 +248,1 @@\n-                logger.log (Level.WARNING, msg);\n+                logger.log(Level.WARNING, msg);\n@@ -252,1 +252,1 @@\n-            o.setWrappedStream (new FixedLengthOutputStream (this, ros, contentLen));\n+            o.setWrappedStream(new FixedLengthOutputStream(this, ros, contentLen));\n@@ -256,1 +256,1 @@\n-                    o.setWrappedStream (new UndefLengthOutputStream (this, ros));\n+                    o.setWrappedStream(new UndefLengthOutputStream(this, ros));\n@@ -259,2 +259,2 @@\n-                    rspHdrs.set (\"Transfer-encoding\", \"chunked\");\n-                    o.setWrappedStream (new ChunkedOutputStream (this, ros));\n+                    rspHdrs.set(\"Transfer-encoding\", \"chunked\");\n+                    o.setWrappedStream(new ChunkedOutputStream(this, ros));\n@@ -270,1 +270,1 @@\n-                o.setWrappedStream (new FixedLengthOutputStream (this, ros, contentLen));\n+                o.setWrappedStream(new FixedLengthOutputStream(this, ros, contentLen));\n@@ -283,1 +283,1 @@\n-                logger.log (Level.DEBUG, \"Connection: close requested by handler\");\n+                logger.log(Level.DEBUG, \"Connection: close requested by handler\");\n@@ -288,1 +288,1 @@\n-        write (rspHdrs, tmpout);\n+        write(rspHdrs, tmpout);\n@@ -297,1 +297,1 @@\n-        server.logReply (rCode, req.requestLine(), null);\n+        server.logReply(rCode, req.requestLine(), null);\n@@ -300,3 +300,3 @@\n-    void write (Headers map, OutputStream os) throws IOException {\n-        Set<Map.Entry<String,List<String>>> entries = map.entrySet();\n-        for (Map.Entry<String,List<String>> entry : entries) {\n+    void write(Headers map, OutputStream os) throws IOException {\n+        Set<Map.Entry<String, List<String>>> entries = map.entrySet();\n+        for (Map.Entry<String, List<String>> entry : entries) {\n@@ -308,1 +308,1 @@\n-                buf = bytes (key, 2);\n+                buf = bytes(key, 2);\n@@ -311,2 +311,2 @@\n-                os.write (buf, 0, i);\n-                buf = bytes (val, 2);\n+                os.write(buf, 0, i);\n+                buf = bytes(val, 2);\n@@ -316,1 +316,1 @@\n-                os.write (buf, 0, i);\n+                os.write(buf, 0, i);\n@@ -319,2 +319,2 @@\n-        os.write ('\\r');\n-        os.write ('\\n');\n+        os.write('\\r');\n+        os.write('\\n');\n@@ -323,1 +323,1 @@\n-    private byte[] rspbuf = new byte [128]; \/\/ used by bytes()\n+    private byte[] rspbuf = new byte[128]; \/\/ used by bytes()\n@@ -331,1 +331,1 @@\n-    private byte[] bytes (String s, int extra) {\n+    private byte[] bytes(String s, int extra) {\n@@ -344,1 +344,1 @@\n-    public InetSocketAddress getRemoteAddress (){\n+    public InetSocketAddress getRemoteAddress() {\n@@ -348,1 +348,1 @@\n-        return new InetSocketAddress (ia, port);\n+        return new InetSocketAddress(ia, port);\n@@ -351,1 +351,1 @@\n-    public InetSocketAddress getLocalAddress (){\n+    public InetSocketAddress getLocalAddress() {\n@@ -355,1 +355,1 @@\n-        return new InetSocketAddress (ia, port);\n+        return new InetSocketAddress(ia, port);\n@@ -358,1 +358,1 @@\n-    public String getProtocol (){\n+    public String getProtocol() {\n@@ -360,2 +360,2 @@\n-        int index = reqline.lastIndexOf (' ');\n-        return reqline.substring (index+1);\n+        int index = reqline.lastIndexOf(' ');\n+        return reqline.substring(index+1);\n@@ -364,1 +364,1 @@\n-    public SSLSession getSSLSession () {\n+    public SSLSession getSSLSession() {\n@@ -372,1 +372,1 @@\n-    public Object getAttribute (String name) {\n+    public Object getAttribute(String name) {\n@@ -376,1 +376,1 @@\n-    public void setAttribute (String name, Object value) {\n+    public void setAttribute(String name, Object value) {\n@@ -385,1 +385,1 @@\n-    public void setStreams (InputStream i, OutputStream o) {\n+    public void setStreams(InputStream i, OutputStream o) {\n@@ -398,1 +398,1 @@\n-    HttpConnection getConnection () {\n+    HttpConnection getConnection() {\n@@ -402,1 +402,1 @@\n-    ServerImpl getServerImpl () {\n+    ServerImpl getServerImpl() {\n@@ -406,1 +406,1 @@\n-    public HttpPrincipal getPrincipal () {\n+    public HttpPrincipal getPrincipal() {\n@@ -410,1 +410,1 @@\n-    void setPrincipal (HttpPrincipal principal) {\n+    void setPrincipal(HttpPrincipal principal) {\n@@ -414,1 +414,1 @@\n-    static ExchangeImpl get (HttpExchange t) {\n+    static ExchangeImpl get(HttpExchange t) {\n@@ -435,1 +435,1 @@\n-    PlaceholderOutputStream (OutputStream os) {\n+    PlaceholderOutputStream(OutputStream os) {\n@@ -439,1 +439,1 @@\n-    void setWrappedStream (OutputStream os) {\n+    void setWrappedStream(OutputStream os) {\n@@ -443,1 +443,1 @@\n-    boolean isWrapped () {\n+    boolean isWrapped() {\n@@ -447,1 +447,1 @@\n-    private void checkWrap () throws IOException {\n+    private void checkWrap() throws IOException {\n@@ -449,1 +449,1 @@\n-            throw new IOException (\"response headers not sent yet\");\n+            throw new IOException(\"response headers not sent yet\");\n@@ -455,1 +455,1 @@\n-        wrapped.write (b);\n+        wrapped.write(b);\n@@ -460,1 +460,1 @@\n-        wrapped.write (b);\n+        wrapped.write(b);\n@@ -465,1 +465,1 @@\n-        wrapped.write (b, off, len);\n+        wrapped.write(b, off, len);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/ExchangeImpl.java","additions":68,"deletions":68,"binary":false,"changes":136,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,2 +42,2 @@\n-    FixedLengthInputStream (ExchangeImpl t, InputStream src, long len) {\n-        super (t, src);\n+    FixedLengthInputStream(ExchangeImpl t, InputStream src, long len) {\n+        super(t, src);\n@@ -50,1 +50,1 @@\n-    protected int readImpl (byte[]b, int off, int len) throws IOException {\n+    protected int readImpl(byte[] b, int off, int len) throws IOException {\n@@ -63,1 +63,1 @@\n-                t.getServerImpl().requestCompleted (t.getConnection());\n+                t.getServerImpl().requestCompleted(t.getConnection());\n@@ -71,1 +71,1 @@\n-    public int available () throws IOException {\n+    public int available() throws IOException {\n@@ -79,1 +79,1 @@\n-    public boolean markSupported () {return false;}\n+    public boolean markSupported() {return false;}\n@@ -81,1 +81,1 @@\n-    public void mark (int l) {\n+    public void mark(int l) {\n@@ -84,2 +84,2 @@\n-    public void reset () throws IOException {\n-        throw new IOException (\"mark\/reset not supported\");\n+    public void reset() throws IOException {\n+        throw new IOException(\"mark\/reset not supported\");\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/FixedLengthInputStream.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-    FixedLengthOutputStream (ExchangeImpl t, OutputStream src, long len) {\n+    FixedLengthOutputStream(ExchangeImpl t, OutputStream src, long len) {\n@@ -54,1 +54,1 @@\n-    public void write (int b) throws IOException {\n+    public void write(int b) throws IOException {\n@@ -56,1 +56,1 @@\n-            throw new IOException (\"stream closed\");\n+            throw new IOException(\"stream closed\");\n@@ -65,1 +65,1 @@\n-    public void write (byte[]b, int off, int len) throws IOException {\n+    public void write(byte[] b, int off, int len) throws IOException {\n@@ -71,1 +71,1 @@\n-            throw new IOException (\"stream closed\");\n+            throw new IOException(\"stream closed\");\n@@ -75,1 +75,1 @@\n-            throw new IOException (\"too many bytes to write to stream\");\n+            throw new IOException(\"too many bytes to write to stream\");\n@@ -81,1 +81,1 @@\n-    public void close () throws IOException {\n+    public void close() throws IOException {\n@@ -88,1 +88,1 @@\n-            throw new IOException (\"insufficient bytes written to stream\");\n+            throw new IOException(\"insufficient bytes written to stream\");\n@@ -98,1 +98,1 @@\n-        t.getHttpContext().getServerImpl().addEvent (e);\n+        t.getHttpContext().getServerImpl().addEvent(e);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/FixedLengthOutputStream.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -76,1 +76,1 @@\n-    HttpConnection () {\n+    HttpConnection() {\n@@ -79,1 +79,1 @@\n-    void setChannel (SocketChannel c) {\n+    void setChannel(SocketChannel c) {\n@@ -83,1 +83,1 @@\n-    void setContext (HttpContextImpl ctx) {\n+    void setContext(HttpContextImpl ctx) {\n@@ -91,1 +91,1 @@\n-    void setState (State s) {\n+    void setState(State s) {\n@@ -95,1 +95,1 @@\n-    void setParameters (\n+    void setParameters(\n@@ -113,1 +113,1 @@\n-    SocketChannel getChannel () {\n+    SocketChannel getChannel() {\n@@ -117,1 +117,1 @@\n-    synchronized void close () {\n+    synchronized void close() {\n@@ -123,1 +123,1 @@\n-            logger.log (Level.TRACE, \"Closing connection: \" + chan.toString());\n+            logger.log(Level.TRACE, \"Closing connection: \" + chan.toString());\n@@ -127,1 +127,1 @@\n-            ServerImpl.dprint (\"Channel already closed\");\n+            ServerImpl.dprint(\"Channel already closed\");\n@@ -136,1 +136,1 @@\n-            ServerImpl.dprint (e);\n+            ServerImpl.dprint(e);\n@@ -143,1 +143,1 @@\n-            ServerImpl.dprint (e);\n+            ServerImpl.dprint(e);\n@@ -150,1 +150,1 @@\n-            ServerImpl.dprint (e);\n+            ServerImpl.dprint(e);\n@@ -155,1 +155,1 @@\n-            ServerImpl.dprint (e);\n+            ServerImpl.dprint(e);\n@@ -162,1 +162,1 @@\n-    void setRemaining (int r) {\n+    void setRemaining(int r) {\n@@ -166,1 +166,1 @@\n-    int getRemaining () {\n+    int getRemaining() {\n@@ -170,1 +170,1 @@\n-    SelectionKey getSelectionKey () {\n+    SelectionKey getSelectionKey() {\n@@ -174,1 +174,1 @@\n-    InputStream getInputStream () {\n+    InputStream getInputStream() {\n@@ -178,1 +178,1 @@\n-    OutputStream getRawOutputStream () {\n+    OutputStream getRawOutputStream() {\n@@ -182,1 +182,1 @@\n-    String getProtocol () {\n+    String getProtocol() {\n@@ -186,1 +186,1 @@\n-    SSLEngine getSSLEngine () {\n+    SSLEngine getSSLEngine() {\n@@ -190,1 +190,1 @@\n-    SSLContext getSSLContext () {\n+    SSLContext getSSLContext() {\n@@ -194,1 +194,1 @@\n-    HttpContextImpl getHttpContext () {\n+    HttpContextImpl getHttpContext() {\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpConnection.java","additions":23,"deletions":23,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,1 @@\n- * HttpContext instances are created by {@link HttpServer#createContext(String,String,HttpHandler,Object)}\n+ * HttpContext instances are created by {@link HttpServer#createContext(String, String, HttpHandler, Object)}\n@@ -47,1 +47,1 @@\n-    private final Map<String,Object> attributes = new ConcurrentHashMap<>();\n+    private final Map<String, Object> attributes = new ConcurrentHashMap<>();\n@@ -58,1 +58,1 @@\n-    HttpContextImpl (String protocol, String path, HttpHandler cb, ServerImpl server) {\n+    HttpContextImpl(String protocol, String path, HttpHandler cb, ServerImpl server) {\n@@ -60,1 +60,1 @@\n-            throw new IllegalArgumentException (\"Illegal value for path or protocol\");\n+            throw new IllegalArgumentException(\"Illegal value for path or protocol\");\n@@ -64,2 +64,2 @@\n-        if (!this.protocol.equals (\"http\") && !this.protocol.equals (\"https\")) {\n-            throw new IllegalArgumentException (\"Illegal value for protocol\");\n+        if (!this.protocol.equals(\"http\") && !this.protocol.equals(\"https\")) {\n+            throw new IllegalArgumentException(\"Illegal value for protocol\");\n@@ -70,1 +70,1 @@\n-        sfilters.add (authfilter);\n+        sfilters.add(authfilter);\n@@ -77,1 +77,1 @@\n-    public HttpHandler getHandler () {\n+    public HttpHandler getHandler() {\n@@ -81,1 +81,1 @@\n-    public void setHandler (HttpHandler h) {\n+    public void setHandler(HttpHandler h) {\n@@ -83,1 +83,1 @@\n-            throw new NullPointerException (\"Null handler parameter\");\n+            throw new NullPointerException(\"Null handler parameter\");\n@@ -86,1 +86,1 @@\n-            throw new IllegalArgumentException (\"handler already set\");\n+            throw new IllegalArgumentException(\"handler already set\");\n@@ -103,1 +103,1 @@\n-    public HttpServer getServer () {\n+    public HttpServer getServer() {\n@@ -107,1 +107,1 @@\n-    ServerImpl getServerImpl () {\n+    ServerImpl getServerImpl() {\n@@ -127,1 +127,1 @@\n-    public Map<String,Object> getAttributes() {\n+    public Map<String, Object> getAttributes() {\n@@ -131,1 +131,1 @@\n-    public List<Filter> getFilters () {\n+    public List<Filter> getFilters() {\n@@ -135,1 +135,1 @@\n-    List<Filter> getSystemFilters () {\n+    List<Filter> getSystemFilters() {\n@@ -139,1 +139,1 @@\n-    public Authenticator setAuthenticator (Authenticator auth) {\n+    public Authenticator setAuthenticator(Authenticator auth) {\n@@ -142,1 +142,1 @@\n-        authfilter.setAuthenticator (auth);\n+        authfilter.setAuthenticator(auth);\n@@ -146,1 +146,1 @@\n-    public Authenticator getAuthenticator () {\n+    public Authenticator getAuthenticator() {\n@@ -149,1 +149,1 @@\n-    Logger getLogger () {\n+    Logger getLogger() {\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpContextImpl.java","additions":21,"deletions":21,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2008, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,2 +34,2 @@\n-    public HttpError (String msg) {\n-        super (msg);\n+    public HttpError(String msg) {\n+        super(msg);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpError.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2006, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,1 +41,1 @@\n-    HttpExchangeImpl (ExchangeImpl impl) {\n+    HttpExchangeImpl(ExchangeImpl impl) {\n@@ -45,1 +45,1 @@\n-    public Headers getRequestHeaders () {\n+    public Headers getRequestHeaders() {\n@@ -49,1 +49,1 @@\n-    public Headers getResponseHeaders () {\n+    public Headers getResponseHeaders() {\n@@ -53,1 +53,1 @@\n-    public URI getRequestURI () {\n+    public URI getRequestURI() {\n@@ -57,1 +57,1 @@\n-    public String getRequestMethod (){\n+    public String getRequestMethod() {\n@@ -61,1 +61,1 @@\n-    public HttpContextImpl getHttpContext (){\n+    public HttpContextImpl getHttpContext() {\n@@ -65,1 +65,1 @@\n-    public void close () {\n+    public void close() {\n@@ -69,1 +69,1 @@\n-    public InputStream getRequestBody () {\n+    public InputStream getRequestBody() {\n@@ -73,1 +73,1 @@\n-    public int getResponseCode () {\n+    public int getResponseCode() {\n@@ -77,1 +77,1 @@\n-    public OutputStream getResponseBody () {\n+    public OutputStream getResponseBody() {\n@@ -82,1 +82,1 @@\n-    public void sendResponseHeaders (int rCode, long contentLen)\n+    public void sendResponseHeaders(int rCode, long contentLen)\n@@ -85,1 +85,1 @@\n-        impl.sendResponseHeaders (rCode, contentLen);\n+        impl.sendResponseHeaders(rCode, contentLen);\n@@ -88,1 +88,1 @@\n-    public InetSocketAddress getRemoteAddress (){\n+    public InetSocketAddress getRemoteAddress() {\n@@ -92,1 +92,1 @@\n-    public InetSocketAddress getLocalAddress (){\n+    public InetSocketAddress getLocalAddress() {\n@@ -96,1 +96,1 @@\n-    public String getProtocol (){\n+    public String getProtocol() {\n@@ -100,2 +100,2 @@\n-    public Object getAttribute (String name) {\n-        return impl.getAttribute (name);\n+    public Object getAttribute(String name) {\n+        return impl.getAttribute(name);\n@@ -104,2 +104,2 @@\n-    public void setAttribute (String name, Object value) {\n-        impl.setAttribute (name, value);\n+    public void setAttribute(String name, Object value) {\n+        impl.setAttribute(name, value);\n@@ -108,2 +108,2 @@\n-    public void setStreams (InputStream i, OutputStream o) {\n-        impl.setStreams (i, o);\n+    public void setStreams(InputStream i, OutputStream o) {\n+        impl.setStreams(i, o);\n@@ -112,1 +112,1 @@\n-    public HttpPrincipal getPrincipal () {\n+    public HttpPrincipal getPrincipal() {\n@@ -116,1 +116,1 @@\n-    ExchangeImpl getExchangeImpl () {\n+    ExchangeImpl getExchangeImpl() {\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpExchangeImpl.java","additions":24,"deletions":24,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,2 +38,2 @@\n-    HttpServerImpl () throws IOException {\n-        this (new InetSocketAddress(80), 0);\n+    HttpServerImpl() throws IOException {\n+        this(new InetSocketAddress(80), 0);\n@@ -42,1 +42,1 @@\n-    HttpServerImpl (\n+    HttpServerImpl(\n@@ -45,1 +45,1 @@\n-        server = new ServerImpl (this, \"http\", addr, backlog);\n+        server = new ServerImpl(this, \"http\", addr, backlog);\n@@ -48,2 +48,2 @@\n-    public void bind (InetSocketAddress addr, int backlog) throws IOException {\n-        server.bind (addr, backlog);\n+    public void bind(InetSocketAddress addr, int backlog) throws IOException {\n+        server.bind(addr, backlog);\n@@ -52,1 +52,1 @@\n-    public void start () {\n+    public void start() {\n@@ -56,1 +56,1 @@\n-    public void setExecutor (Executor executor) {\n+    public void setExecutor(Executor executor) {\n@@ -60,1 +60,1 @@\n-    public Executor getExecutor () {\n+    public Executor getExecutor() {\n@@ -64,2 +64,2 @@\n-    public void stop (int delay) {\n-        server.stop (delay);\n+    public void stop(int delay) {\n+        server.stop(delay);\n@@ -68,2 +68,2 @@\n-    public HttpContextImpl createContext (String path, HttpHandler handler) {\n-        return server.createContext (path, handler);\n+    public HttpContextImpl createContext(String path, HttpHandler handler) {\n+        return server.createContext(path, handler);\n@@ -72,2 +72,2 @@\n-    public HttpContextImpl createContext (String path) {\n-        return server.createContext (path);\n+    public HttpContextImpl createContext(String path) {\n+        return server.createContext(path);\n@@ -76,2 +76,2 @@\n-    public void removeContext (String path) throws IllegalArgumentException {\n-        server.removeContext (path);\n+    public void removeContext(String path) throws IllegalArgumentException {\n+        server.removeContext(path);\n@@ -80,2 +80,2 @@\n-    public void removeContext (HttpContext context) throws IllegalArgumentException {\n-        server.removeContext (context);\n+    public void removeContext(HttpContext context) throws IllegalArgumentException {\n+        server.removeContext(context);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpServerImpl.java","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2006, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,1 +41,1 @@\n-    HttpsExchangeImpl (ExchangeImpl impl) throws IOException {\n+    HttpsExchangeImpl(ExchangeImpl impl) throws IOException {\n@@ -45,1 +45,1 @@\n-    public Headers getRequestHeaders () {\n+    public Headers getRequestHeaders() {\n@@ -49,1 +49,1 @@\n-    public Headers getResponseHeaders () {\n+    public Headers getResponseHeaders() {\n@@ -53,1 +53,1 @@\n-    public URI getRequestURI () {\n+    public URI getRequestURI() {\n@@ -57,1 +57,1 @@\n-    public String getRequestMethod (){\n+    public String getRequestMethod() {\n@@ -61,1 +61,1 @@\n-    public HttpContextImpl getHttpContext (){\n+    public HttpContextImpl getHttpContext() {\n@@ -65,1 +65,1 @@\n-    public void close () {\n+    public void close() {\n@@ -69,1 +69,1 @@\n-    public InputStream getRequestBody () {\n+    public InputStream getRequestBody() {\n@@ -73,1 +73,1 @@\n-    public int getResponseCode () {\n+    public int getResponseCode() {\n@@ -77,1 +77,1 @@\n-    public OutputStream getResponseBody () {\n+    public OutputStream getResponseBody() {\n@@ -82,1 +82,1 @@\n-    public void sendResponseHeaders (int rCode, long contentLen)\n+    public void sendResponseHeaders(int rCode, long contentLen)\n@@ -85,1 +85,1 @@\n-        impl.sendResponseHeaders (rCode, contentLen);\n+        impl.sendResponseHeaders(rCode, contentLen);\n@@ -88,1 +88,1 @@\n-    public InetSocketAddress getRemoteAddress (){\n+    public InetSocketAddress getRemoteAddress() {\n@@ -92,1 +92,1 @@\n-    public InetSocketAddress getLocalAddress (){\n+    public InetSocketAddress getLocalAddress() {\n@@ -96,1 +96,1 @@\n-    public String getProtocol (){\n+    public String getProtocol() {\n@@ -100,2 +100,2 @@\n-    public SSLSession getSSLSession () {\n-        return impl.getSSLSession ();\n+    public SSLSession getSSLSession() {\n+        return impl.getSSLSession();\n@@ -104,2 +104,2 @@\n-    public Object getAttribute (String name) {\n-        return impl.getAttribute (name);\n+    public Object getAttribute(String name) {\n+        return impl.getAttribute(name);\n@@ -108,2 +108,2 @@\n-    public void setAttribute (String name, Object value) {\n-        impl.setAttribute (name, value);\n+    public void setAttribute(String name, Object value) {\n+        impl.setAttribute(name, value);\n@@ -112,2 +112,2 @@\n-    public void setStreams (InputStream i, OutputStream o) {\n-        impl.setStreams (i, o);\n+    public void setStreams(InputStream i, OutputStream o) {\n+        impl.setStreams(i, o);\n@@ -116,1 +116,1 @@\n-    public HttpPrincipal getPrincipal () {\n+    public HttpPrincipal getPrincipal() {\n@@ -120,1 +120,1 @@\n-    ExchangeImpl getExchangeImpl () {\n+    ExchangeImpl getExchangeImpl() {\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpsExchangeImpl.java","additions":26,"deletions":26,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,2 +38,2 @@\n-    HttpsServerImpl () throws IOException {\n-        this (new InetSocketAddress(443), 0);\n+    HttpsServerImpl() throws IOException {\n+        this(new InetSocketAddress(443), 0);\n@@ -42,1 +42,1 @@\n-    HttpsServerImpl (\n+    HttpsServerImpl(\n@@ -45,1 +45,1 @@\n-        server = new ServerImpl (this, \"https\", addr, backlog);\n+        server = new ServerImpl(this, \"https\", addr, backlog);\n@@ -48,2 +48,2 @@\n-    public void setHttpsConfigurator (HttpsConfigurator config) {\n-        server.setHttpsConfigurator (config);\n+    public void setHttpsConfigurator(HttpsConfigurator config) {\n+        server.setHttpsConfigurator(config);\n@@ -52,1 +52,1 @@\n-    public HttpsConfigurator getHttpsConfigurator () {\n+    public HttpsConfigurator getHttpsConfigurator() {\n@@ -56,2 +56,2 @@\n-    public void bind (InetSocketAddress addr, int backlog) throws IOException {\n-        server.bind (addr, backlog);\n+    public void bind(InetSocketAddress addr, int backlog) throws IOException {\n+        server.bind(addr, backlog);\n@@ -60,1 +60,1 @@\n-    public void start () {\n+    public void start() {\n@@ -64,1 +64,1 @@\n-    public void setExecutor (Executor executor) {\n+    public void setExecutor(Executor executor) {\n@@ -68,1 +68,1 @@\n-    public Executor getExecutor () {\n+    public Executor getExecutor() {\n@@ -72,2 +72,2 @@\n-    public void stop (int delay) {\n-        server.stop (delay);\n+    public void stop(int delay) {\n+        server.stop(delay);\n@@ -76,2 +76,2 @@\n-    public HttpContextImpl createContext (String path, HttpHandler handler) {\n-        return server.createContext (path, handler);\n+    public HttpContextImpl createContext(String path, HttpHandler handler) {\n+        return server.createContext(path, handler);\n@@ -80,2 +80,2 @@\n-    public HttpContextImpl createContext (String path) {\n-        return server.createContext (path);\n+    public HttpContextImpl createContext(String path) {\n+        return server.createContext(path);\n@@ -84,2 +84,2 @@\n-    public void removeContext (String path) throws IllegalArgumentException {\n-        server.removeContext (path);\n+    public void removeContext(String path) throws IllegalArgumentException {\n+        server.removeContext(path);\n@@ -88,2 +88,2 @@\n-    public void removeContext (HttpContext context) throws IllegalArgumentException {\n-        server.removeContext (context);\n+    public void removeContext(HttpContext context) throws IllegalArgumentException {\n+        server.removeContext(context);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpsServerImpl.java","additions":23,"deletions":23,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n-    byte[] one = new byte [1];\n+    byte[] one = new byte[1];\n@@ -51,2 +51,2 @@\n-    public LeftOverInputStream (ExchangeImpl t, InputStream src) {\n-        super (src);\n+    public LeftOverInputStream(ExchangeImpl t, InputStream src) {\n+        super(src);\n@@ -59,1 +59,1 @@\n-    public boolean isDataBuffered () throws IOException {\n+    public boolean isDataBuffered() throws IOException {\n@@ -64,1 +64,1 @@\n-    public void close () throws IOException {\n+    public void close() throws IOException {\n@@ -70,1 +70,1 @@\n-            eof = drain (ServerConfig.getDrainAmount());\n+            eof = drain(ServerConfig.getDrainAmount());\n@@ -74,1 +74,1 @@\n-    public boolean isClosed () {\n+    public boolean isClosed() {\n@@ -78,1 +78,1 @@\n-    public boolean isEOF () {\n+    public boolean isEOF() {\n@@ -82,1 +82,1 @@\n-    protected abstract int readImpl (byte[]b, int off, int len) throws IOException;\n+    protected abstract int readImpl(byte[] b, int off, int len) throws IOException;\n@@ -84,1 +84,1 @@\n-    public synchronized int read () throws IOException {\n+    public synchronized int read() throws IOException {\n@@ -86,1 +86,1 @@\n-            throw new IOException (\"Stream is closed\");\n+            throw new IOException(\"Stream is closed\");\n@@ -88,1 +88,1 @@\n-        int c = readImpl (one, 0, 1);\n+        int c = readImpl(one, 0, 1);\n@@ -96,1 +96,1 @@\n-    public synchronized int read (byte[]b, int off, int len) throws IOException {\n+    public synchronized int read(byte[] b, int off, int len) throws IOException {\n@@ -98,1 +98,1 @@\n-            throw new IOException (\"Stream is closed\");\n+            throw new IOException(\"Stream is closed\");\n@@ -100,1 +100,1 @@\n-        return readImpl (b, off, len);\n+        return readImpl(b, off, len);\n@@ -135,1 +135,1 @@\n-    public boolean drain (long l) throws IOException {\n+    public boolean drain(long l) throws IOException {\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/LeftOverInputStream.java","additions":17,"deletions":17,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.net.ProtocolException;\n@@ -42,0 +43,1 @@\n+    static final byte FIRST_CHAR = 32;\n@@ -48,0 +50,1 @@\n+    private final boolean firstClearRequest;\n@@ -49,1 +52,1 @@\n-    Request (InputStream rawInputStream, OutputStream rawout) throws IOException {\n+    Request(InputStream rawInputStream, OutputStream rawout, boolean firstClearRequest) throws IOException {\n@@ -51,0 +54,1 @@\n+        this.firstClearRequest = firstClearRequest;\n@@ -60,1 +64,1 @@\n-    char[] buf = new char [BUF_LEN];\n+    char[] buf = new char[BUF_LEN];\n@@ -64,1 +68,1 @@\n-    public InputStream inputStream () {\n+    public InputStream inputStream() {\n@@ -68,1 +72,1 @@\n-    public OutputStream outputStream () {\n+    public OutputStream outputStream() {\n@@ -77,1 +81,1 @@\n-    public String readLine () throws IOException {\n+    public String readLine() throws IOException {\n@@ -81,0 +85,19 @@\n+\n+        \/\/ For the first request that comes on a clear connection\n+        \/\/ we will check that the first non CR\/LF char on the\n+        \/\/ request line is eligible. This should be the first char\n+        \/\/ of a method name, so it should be at least greater or equal\n+        \/\/ to 32 (FIRST_CHAR) which is the space character.\n+        \/\/ The main goal here is to fail fast if we receive 0x16 (22) which\n+        \/\/ happens to be the first byte of a TLS handshake record.\n+        \/\/ This is typically what would be received if a TLS client opened\n+        \/\/ a TLS connection on a non-TLS server.\n+        \/\/ If we receive 0x16 we should close the connection immediately as\n+        \/\/ it indicates we're receiving a ClientHello on a clear\n+        \/\/ connection, and we will never receive the expected CRLF that\n+        \/\/ terminates the first request line.\n+        \/\/ Though we could check only for 0x16, any characters < 32\n+        \/\/ (excluding CRLF) is not expected at this position in a\n+        \/\/ request line, so we can still fail here early if any of\n+        \/\/ those are detected.\n+        int offset = 0;\n@@ -91,2 +114,8 @@\n-                    consume (CR);\n-                    consume (c);\n+                    consume(CR);\n+                    if (firstClearRequest && offset == 0) {\n+                        if (c < FIRST_CHAR) {\n+                            throw new ProtocolException(\"Unexpected start of request line\");\n+                        }\n+                        offset++;\n+                    }\n+                    consume(c);\n@@ -99,1 +128,7 @@\n-                    consume (c);\n+                    if (firstClearRequest && offset == 0) {\n+                        if (c < FIRST_CHAR) {\n+                            throw new ProtocolException(\"Unexpected start of request line\");\n+                        }\n+                        offset++;\n+                    }\n+                    consume(c);\n@@ -109,2 +144,2 @@\n-        lineBuf.append (buf, 0, pos);\n-        return new String (lineBuf);\n+        lineBuf.append(buf, 0, pos);\n+        return new String(lineBuf);\n@@ -113,1 +148,1 @@\n-    private void consume (int c) throws IOException {\n+    private void consume(int c) throws IOException {\n@@ -115,1 +150,1 @@\n-            lineBuf.append (buf);\n+            lineBuf.append(buf);\n@@ -124,1 +159,1 @@\n-    public String requestLine () {\n+    public String requestLine() {\n@@ -130,1 +165,1 @@\n-    Headers headers () throws IOException {\n+    Headers headers() throws IOException {\n@@ -242,1 +277,1 @@\n-            hdrs.add (k,v);\n+            hdrs.add(k, v);\n@@ -265,1 +300,1 @@\n-        public ReadStream (ServerImpl server, SocketChannel chan) throws IOException {\n+        public ReadStream(ServerImpl server, SocketChannel chan) throws IOException {\n@@ -268,1 +303,1 @@\n-            chanbuf = ByteBuffer.allocate (BUFSIZE);\n+            chanbuf = ByteBuffer.allocate(BUFSIZE);\n@@ -274,2 +309,2 @@\n-        public synchronized int read (byte[] b) throws IOException {\n-            return read (b, 0, b.length);\n+        public synchronized int read(byte[] b) throws IOException {\n+            return read(b, 0, b.length);\n@@ -278,2 +313,2 @@\n-        public synchronized int read () throws IOException {\n-            int result = read (one, 0, 1);\n+        public synchronized int read() throws IOException {\n+            int result = read(one, 0, 1);\n@@ -287,1 +322,1 @@\n-        public synchronized int read (byte[] b, int off, int srclen) throws IOException {\n+        public synchronized int read(byte[] b, int off, int srclen) throws IOException {\n@@ -292,1 +327,1 @@\n-                throw new IOException (\"Stream closed\");\n+                throw new IOException(\"Stream closed\");\n@@ -303,1 +338,1 @@\n-                canreturn = markBuf.remaining ();\n+                canreturn = markBuf.remaining();\n@@ -310,1 +345,1 @@\n-                chanbuf.clear ();\n+                chanbuf.clear();\n@@ -312,1 +347,1 @@\n-                    chanbuf.limit (srclen);\n+                    chanbuf.limit(srclen);\n@@ -315,1 +350,1 @@\n-                    willreturn = channel.read (chanbuf);\n+                    willreturn = channel.read(chanbuf);\n@@ -321,1 +356,1 @@\n-                chanbuf.flip ();\n+                chanbuf.flip();\n@@ -326,1 +361,1 @@\n-                        markBuf.put (b, off, willreturn);\n+                        markBuf.put(b, off, willreturn);\n@@ -335,1 +370,1 @@\n-        public boolean markSupported () {\n+        public boolean markSupported() {\n@@ -340,1 +375,1 @@\n-        public synchronized int available () throws IOException {\n+        public synchronized int available() throws IOException {\n@@ -342,1 +377,1 @@\n-                throw new IOException (\"Stream is closed\");\n+                throw new IOException(\"Stream is closed\");\n@@ -353,1 +388,1 @@\n-        public void close () throws IOException {\n+        public void close() throws IOException {\n@@ -357,1 +392,1 @@\n-            channel.close ();\n+            channel.close();\n@@ -361,1 +396,1 @@\n-        public synchronized void mark (int readlimit) {\n+        public synchronized void mark(int readlimit) {\n@@ -365,1 +400,1 @@\n-            markBuf = ByteBuffer.allocate (readlimit);\n+            markBuf = ByteBuffer.allocate(readlimit);\n@@ -370,1 +405,1 @@\n-        public synchronized void reset () throws IOException {\n+        public synchronized void reset() throws IOException {\n@@ -374,1 +409,1 @@\n-                throw new IOException (\"Stream not marked\");\n+                throw new IOException(\"Stream not marked\");\n@@ -377,1 +412,1 @@\n-            markBuf.flip ();\n+            markBuf.flip();\n@@ -389,1 +424,1 @@\n-        public WriteStream (ServerImpl server, SocketChannel channel) throws IOException {\n+        public WriteStream(ServerImpl server, SocketChannel channel) throws IOException {\n@@ -395,1 +430,1 @@\n-            buf = ByteBuffer.allocate (4096);\n+            buf = ByteBuffer.allocate(4096);\n@@ -398,1 +433,1 @@\n-        public synchronized void write (int b) throws IOException {\n+        public synchronized void write(int b) throws IOException {\n@@ -403,1 +438,1 @@\n-        public synchronized void write (byte[] b) throws IOException {\n+        public synchronized void write(byte[] b) throws IOException {\n@@ -407,1 +442,1 @@\n-        public synchronized void write (byte[] b, int off, int len) throws IOException {\n+        public synchronized void write(byte[] b, int off, int len) throws IOException {\n@@ -410,1 +445,1 @@\n-                throw new IOException (\"stream is closed\");\n+                throw new IOException(\"stream is closed\");\n@@ -415,1 +450,1 @@\n-                buf = ByteBuffer.allocate (2*(cap+diff));\n+                buf = ByteBuffer.allocate(2*(cap+diff));\n@@ -418,2 +453,2 @@\n-            buf.put (b, off, len);\n-            buf.flip ();\n+            buf.put(b, off, len);\n+            buf.flip();\n@@ -421,1 +456,1 @@\n-            while ((n = channel.write (buf)) < l) {\n+            while ((n = channel.write(buf)) < l) {\n@@ -428,1 +463,1 @@\n-        public void close () throws IOException {\n+        public void close() throws IOException {\n@@ -431,2 +466,2 @@\n-            \/\/server.logStackTrace (\"Request.OS.close: isOpen=\"+channel.isOpen());\n-            channel.close ();\n+            \/\/server.logStackTrace(\"Request.OS.close: isOpen=\"+channel.isOpen());\n+            channel.close();\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/Request.java","additions":88,"deletions":53,"binary":false,"changes":141,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,1 @@\n-    SSLStreams (ServerImpl server, SSLContext sslctx, SocketChannel chan) throws IOException {\n+    SSLStreams(ServerImpl server, SSLContext sslctx, SocketChannel chan) throws IOException {\n@@ -62,2 +62,2 @@\n-        engine = sslctx.createSSLEngine (addr.getHostName(), addr.getPort());\n-        engine.setUseClientMode (false);\n+        engine = sslctx.createSSLEngine(addr.getHostName(), addr.getPort());\n+        engine.setUseClientMode(false);\n@@ -65,2 +65,2 @@\n-        configureEngine (cfg, addr);\n-        wrapper = new EngineWrapper (chan, engine);\n+        configureEngine(cfg, addr);\n+        wrapper = new EngineWrapper(chan, engine);\n@@ -70,1 +70,1 @@\n-    private void configureEngine(HttpsConfigurator cfg, InetSocketAddress addr){\n+    private void configureEngine(HttpsConfigurator cfg, InetSocketAddress addr) {\n@@ -72,1 +72,1 @@\n-            Parameters params = new Parameters (cfg, addr);\n+            Parameters params = new Parameters(cfg, addr);\n@@ -74,1 +74,1 @@\n-            cfg.configure (params);\n+            cfg.configure(params);\n@@ -77,1 +77,1 @@\n-                engine.setSSLParameters (sslParams);\n+                engine.setSSLParameters(sslParams);\n@@ -84,1 +84,1 @@\n-                        engine.setEnabledCipherSuites (\n+                        engine.setEnabledCipherSuites(\n@@ -96,1 +96,1 @@\n-                        engine.setEnabledProtocols (\n+                        engine.setEnabledProtocols(\n@@ -109,1 +109,1 @@\n-        Parameters (HttpsConfigurator cfg, InetSocketAddress addr) {\n+        Parameters(HttpsConfigurator cfg, InetSocketAddress addr) {\n@@ -113,1 +113,1 @@\n-        public InetSocketAddress getClientAddress () {\n+        public InetSocketAddress getClientAddress() {\n@@ -121,1 +121,1 @@\n-        public void setSSLParameters (SSLParameters p) {\n+        public void setSSLParameters(SSLParameters p) {\n@@ -124,1 +124,1 @@\n-        SSLParameters getSSLParameters () {\n+        SSLParameters getSSLParameters() {\n@@ -133,1 +133,1 @@\n-    void close () throws IOException {\n+    void close() throws IOException {\n@@ -140,1 +140,1 @@\n-    InputStream getInputStream () throws IOException {\n+    InputStream getInputStream() throws IOException {\n@@ -150,1 +150,1 @@\n-    OutputStream getOutputStream () throws IOException {\n+    OutputStream getOutputStream() throws IOException {\n@@ -157,1 +157,1 @@\n-    SSLEngine getSSLEngine () {\n+    SSLEngine getSSLEngine() {\n@@ -186,2 +186,2 @@\n-    private ByteBuffer allocate (BufType type) {\n-        return allocate (type, -1);\n+    private ByteBuffer allocate(BufType type) {\n+        return allocate(type, -1);\n@@ -190,1 +190,1 @@\n-    private ByteBuffer allocate (BufType type, int len) {\n+    private ByteBuffer allocate(BufType type, int len) {\n@@ -213,1 +213,1 @@\n-            return ByteBuffer.allocate (size);\n+            return ByteBuffer.allocate(size);\n@@ -225,1 +225,1 @@\n-    private ByteBuffer realloc (ByteBuffer b, boolean flip, BufType type) {\n+    private ByteBuffer realloc(ByteBuffer b, boolean flip, BufType type) {\n@@ -228,1 +228,1 @@\n-            ByteBuffer n = allocate (type, nsize);\n+            ByteBuffer n = allocate(type, nsize);\n@@ -255,1 +255,1 @@\n-        EngineWrapper (SocketChannel chan, SSLEngine engine) throws IOException {\n+        EngineWrapper(SocketChannel chan, SSLEngine engine) throws IOException {\n@@ -264,1 +264,1 @@\n-        void close () throws IOException {\n+        void close() throws IOException {\n@@ -278,1 +278,1 @@\n-                throw new IOException (\"Engine is closed\");\n+                throw new IOException(\"Engine is closed\");\n@@ -285,1 +285,1 @@\n-                    r.result = engine.wrap (src, wrap_dst);\n+                    r.result = engine.wrap(src, wrap_dst);\n@@ -288,1 +288,1 @@\n-                        wrap_dst = realloc (wrap_dst, true, BufType.PACKET);\n+                        wrap_dst = realloc(wrap_dst, true, BufType.PACKET);\n@@ -299,1 +299,1 @@\n-                        l -= chan.write (wrap_dst);\n+                        l -= chan.write(wrap_dst);\n@@ -316,1 +316,1 @@\n-                throw new IOException (\"Engine is closed\");\n+                throw new IOException(\"Engine is closed\");\n@@ -332,1 +332,1 @@\n-                        x = chan.read (unwrap_src);\n+                        x = chan.read(unwrap_src);\n@@ -335,1 +335,1 @@\n-                            throw new IOException (\"connection closed for reading\");\n+                            throw new IOException(\"connection closed for reading\");\n@@ -339,1 +339,1 @@\n-                    r.result = engine.unwrap (unwrap_src, r.buf);\n+                    r.result = engine.unwrap(unwrap_src, r.buf);\n@@ -344,1 +344,1 @@\n-                            unwrap_src = realloc (\n+                            unwrap_src = realloc(\n@@ -352,2 +352,2 @@\n-                            unwrap_src.position (unwrap_src.limit());\n-                            unwrap_src.limit (unwrap_src.capacity());\n+                            unwrap_src.position(unwrap_src.limit());\n+                            unwrap_src.limit(unwrap_src.capacity());\n@@ -357,1 +357,1 @@\n-                        r.buf = realloc (r.buf, true, BufType.APPLICATION);\n+                        r.buf = realloc(r.buf, true, BufType.APPLICATION);\n@@ -377,1 +377,1 @@\n-    public WrapperResult sendData (ByteBuffer src) throws IOException {\n+    public WrapperResult sendData(ByteBuffer src) throws IOException {\n@@ -383,1 +383,1 @@\n-                doClosure ();\n+                doClosure();\n@@ -402,1 +402,1 @@\n-    public WrapperResult recvData (ByteBuffer dst) throws IOException {\n+    public WrapperResult recvData(ByteBuffer dst) throws IOException {\n@@ -407,1 +407,1 @@\n-            r = wrapper.recvAndUnwrap (dst);\n+            r = wrapper.recvAndUnwrap(dst);\n@@ -411,1 +411,1 @@\n-                doClosure ();\n+                doClosure();\n@@ -419,1 +419,1 @@\n-                doHandshake (hs_status);\n+                doHandshake(hs_status);\n@@ -429,1 +429,1 @@\n-    void doClosure () throws IOException {\n+    void doClosure() throws IOException {\n@@ -438,2 +438,2 @@\n-                tmp.flip ();\n-                r = wrapper.wrapAndSendX (tmp, true);\n+                tmp.flip();\n+                r = wrapper.wrapAndSendX(tmp, true);\n@@ -455,1 +455,1 @@\n-    void doHandshake (HandshakeStatus hs_status) throws IOException {\n+    void doHandshake(HandshakeStatus hs_status) throws IOException {\n@@ -481,1 +481,1 @@\n-                        r = wrapper.recvAndUnwrap (tmp);\n+                        r = wrapper.recvAndUnwrap(tmp);\n@@ -510,2 +510,2 @@\n-        InputStream () {\n-            bbuf = allocate (BufType.APPLICATION);\n+        InputStream() {\n+            bbuf = allocate(BufType.APPLICATION);\n@@ -514,1 +514,1 @@\n-        public int read (byte[] buf, int off, int len) throws IOException {\n+        public int read(byte[] buf, int off, int len) throws IOException {\n@@ -516,1 +516,1 @@\n-                throw new IOException (\"SSL stream is closed\");\n+                throw new IOException(\"SSL stream is closed\");\n@@ -521,1 +521,1 @@\n-            int available=0;\n+            int available = 0;\n@@ -524,1 +524,1 @@\n-                needData = (available==0);\n+                needData = (available == 0);\n@@ -528,3 +528,3 @@\n-                WrapperResult r = recvData (bbuf);\n-                bbuf = r.buf== bbuf? bbuf: r.buf;\n-                if ((available=bbuf.remaining()) == 0) {\n+                WrapperResult r = recvData(bbuf);\n+                bbuf = r.buf == bbuf ? bbuf: r.buf;\n+                if ((available = bbuf.remaining()) == 0) {\n@@ -541,1 +541,1 @@\n-            bbuf.get (buf, off, len);\n+            bbuf.get(buf, off, len);\n@@ -545,1 +545,1 @@\n-        public int available () throws IOException {\n+        public int available() throws IOException {\n@@ -549,1 +549,1 @@\n-        public boolean markSupported () {\n+        public boolean markSupported() {\n@@ -553,2 +553,2 @@\n-        public void reset () throws IOException {\n-            throw new IOException (\"mark\/reset not supported\");\n+        public void reset() throws IOException {\n+            throw new IOException(\"mark\/reset not supported\");\n@@ -557,1 +557,1 @@\n-        public long skip (long s) throws IOException {\n+        public long skip(long s) throws IOException {\n@@ -560,1 +560,1 @@\n-                throw new IOException (\"SSL stream is closed\");\n+                throw new IOException(\"SSL stream is closed\");\n@@ -568,1 +568,1 @@\n-                    bbuf.position (bbuf.position()+n);\n+                    bbuf.position(bbuf.position()+n);\n@@ -573,2 +573,2 @@\n-                    WrapperResult r = recvData (bbuf);\n-                    bbuf = r.buf==bbuf? bbuf: r.buf;\n+                    WrapperResult r = recvData(bbuf);\n+                    bbuf = r.buf == bbuf ? bbuf: r.buf;\n@@ -585,1 +585,1 @@\n-        public void close () throws IOException {\n+        public void close() throws IOException {\n@@ -587,1 +587,1 @@\n-            engine.closeInbound ();\n+            engine.closeInbound();\n@@ -590,2 +590,2 @@\n-        public int read (byte[] buf) throws IOException {\n-            return read (buf, 0, buf.length);\n+        public int read(byte[] buf) throws IOException {\n+            return read(buf, 0, buf.length);\n@@ -596,1 +596,1 @@\n-        public int read () throws IOException {\n+        public int read() throws IOException {\n@@ -600,1 +600,1 @@\n-            int n = read (single, 0, 1);\n+            int n = read(single, 0, 1);\n@@ -625,1 +625,1 @@\n-            write (single, 0, 1);\n+            write(single, 0, 1);\n@@ -629,1 +629,1 @@\n-            write (b, 0, b.length);\n+            write(b, 0, b.length);\n@@ -633,1 +633,1 @@\n-                throw new IOException (\"output stream is closed\");\n+                throw new IOException(\"output stream is closed\");\n@@ -638,1 +638,1 @@\n-                buf.put (b, off, l);\n+                buf.put(b, off, l);\n@@ -642,1 +642,1 @@\n-                WrapperResult r = sendData (buf);\n+                WrapperResult r = sendData(buf);\n@@ -646,1 +646,1 @@\n-                        throw new IOException (\"output stream is closed\");\n+                        throw new IOException(\"output stream is closed\");\n@@ -657,1 +657,1 @@\n-            WrapperResult r=null;\n+            WrapperResult r = null;\n@@ -663,1 +663,1 @@\n-                r = wrapper.wrapAndSend (buf);\n+                r = wrapper.wrapAndSend(buf);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/SSLStreams.java","additions":84,"deletions":84,"binary":false,"changes":168,"status":"modified"},{"patch":"@@ -48,0 +48,1 @@\n+import java.net.ProtocolException;\n@@ -131,1 +132,1 @@\n-    ServerImpl (\n+    ServerImpl(\n@@ -137,3 +138,3 @@\n-        this.logger = System.getLogger (\"com.sun.net.httpserver\");\n-        ServerConfig.checkLegacyProperties (logger);\n-        https = protocol.equalsIgnoreCase (\"https\");\n+        this.logger = System.getLogger(\"com.sun.net.httpserver\");\n+        ServerConfig.checkLegacyProperties(logger);\n+        https = protocol.equalsIgnoreCase(\"https\");\n@@ -145,1 +146,1 @@\n-            socket.bind (addr, backlog);\n+            socket.bind(addr, backlog);\n@@ -148,3 +149,3 @@\n-        selector = Selector.open ();\n-        schan.configureBlocking (false);\n-        listenerKey = schan.register (selector, SelectionKey.OP_ACCEPT);\n+        selector = Selector.open();\n+        schan.configureBlocking(false);\n+        listenerKey = schan.register(selector, SelectionKey.OP_ACCEPT);\n@@ -152,4 +153,4 @@\n-        idleConnections = Collections.synchronizedSet (new HashSet<HttpConnection>());\n-        allConnections = Collections.synchronizedSet (new HashSet<HttpConnection>());\n-        reqConnections = Collections.synchronizedSet (new HashSet<HttpConnection>());\n-        rspConnections = Collections.synchronizedSet (new HashSet<HttpConnection>());\n+        idleConnections = Collections.synchronizedSet(new HashSet<HttpConnection>());\n+        allConnections = Collections.synchronizedSet(new HashSet<HttpConnection>());\n+        reqConnections = Collections.synchronizedSet(new HashSet<HttpConnection>());\n+        rspConnections = Collections.synchronizedSet(new HashSet<HttpConnection>());\n@@ -157,2 +158,2 @@\n-        timer = new Timer (\"idle-timeout-task\", true);\n-        timer.schedule (new IdleTimeoutTask(), IDLE_TIMER_TASK_SCHEDULE, IDLE_TIMER_TASK_SCHEDULE);\n+        timer = new Timer(\"idle-timeout-task\", true);\n+        timer.schedule(new IdleTimeoutTask(), IDLE_TIMER_TASK_SCHEDULE, IDLE_TIMER_TASK_SCHEDULE);\n@@ -160,2 +161,2 @@\n-            timer1 = new Timer (\"req-rsp-timeout-task\", true);\n-            timer1.schedule (new ReqRspTimeoutTask(), REQ_RSP_TIMER_SCHEDULE, REQ_RSP_TIMER_SCHEDULE);\n+            timer1 = new Timer(\"req-rsp-timeout-task\", true);\n+            timer1.schedule(new ReqRspTimeoutTask(), REQ_RSP_TIMER_SCHEDULE, REQ_RSP_TIMER_SCHEDULE);\n@@ -164,2 +165,2 @@\n-            logger.log (Level.DEBUG, \"MAX_REQ_TIME:  \"+MAX_REQ_TIME);\n-            logger.log (Level.DEBUG, \"MAX_RSP_TIME:  \"+MAX_RSP_TIME);\n+            logger.log(Level.DEBUG, \"MAX_REQ_TIME:  \"+MAX_REQ_TIME);\n+            logger.log(Level.DEBUG, \"MAX_RSP_TIME:  \"+MAX_RSP_TIME);\n@@ -168,1 +169,1 @@\n-        logger.log (Level.DEBUG, \"HttpServer created \"+protocol+\" \"+ addr);\n+        logger.log(Level.DEBUG, \"HttpServer created \"+protocol+\" \"+ addr);\n@@ -171,1 +172,1 @@\n-    public void bind (InetSocketAddress addr, int backlog) throws IOException {\n+    public void bind(InetSocketAddress addr, int backlog) throws IOException {\n@@ -173,1 +174,1 @@\n-            throw new BindException (\"HttpServer already bound\");\n+            throw new BindException(\"HttpServer already bound\");\n@@ -176,1 +177,1 @@\n-            throw new NullPointerException (\"null address\");\n+            throw new NullPointerException(\"null address\");\n@@ -179,1 +180,1 @@\n-        socket.bind (addr, backlog);\n+        socket.bind(addr, backlog);\n@@ -183,1 +184,1 @@\n-    public void start () {\n+    public void start() {\n@@ -185,1 +186,1 @@\n-            throw new IllegalStateException (\"server in wrong state\");\n+            throw new IllegalStateException(\"server in wrong state\");\n@@ -195,1 +196,1 @@\n-    public void setExecutor (Executor executor) {\n+    public void setExecutor(Executor executor) {\n@@ -197,1 +198,1 @@\n-            throw new IllegalStateException (\"server already started\");\n+            throw new IllegalStateException(\"server already started\");\n@@ -203,1 +204,1 @@\n-        public void execute (Runnable task) {\n+        public void execute(Runnable task) {\n@@ -208,1 +209,1 @@\n-    public Executor getExecutor () {\n+    public Executor getExecutor() {\n@@ -212,1 +213,1 @@\n-    public void setHttpsConfigurator (HttpsConfigurator config) {\n+    public void setHttpsConfigurator(HttpsConfigurator config) {\n@@ -214,1 +215,1 @@\n-            throw new NullPointerException (\"null HttpsConfigurator\");\n+            throw new NullPointerException(\"null HttpsConfigurator\");\n@@ -217,1 +218,1 @@\n-            throw new IllegalStateException (\"server already started\");\n+            throw new IllegalStateException(\"server already started\");\n@@ -223,1 +224,1 @@\n-    public HttpsConfigurator getHttpsConfigurator () {\n+    public HttpsConfigurator getHttpsConfigurator() {\n@@ -227,1 +228,1 @@\n-    private final boolean finished(){\n+    private final boolean finished() {\n@@ -245,1 +246,1 @@\n-    public void stop (int delay) {\n+    public void stop(int delay) {\n@@ -247,1 +248,1 @@\n-            throw new IllegalArgumentException (\"negative delay parameter\");\n+            throw new IllegalArgumentException(\"negative delay parameter\");\n@@ -301,1 +302,1 @@\n-    public synchronized HttpContextImpl createContext (String path, HttpHandler handler) {\n+    public synchronized HttpContextImpl createContext(String path, HttpHandler handler) {\n@@ -303,1 +304,1 @@\n-            throw new NullPointerException (\"null handler, or path parameter\");\n+            throw new NullPointerException(\"null handler, or path parameter\");\n@@ -305,3 +306,3 @@\n-        HttpContextImpl context = new HttpContextImpl (protocol, path, handler, this);\n-        contexts.add (context);\n-        logger.log (Level.DEBUG, \"context created: \" + path);\n+        HttpContextImpl context = new HttpContextImpl(protocol, path, handler, this);\n+        contexts.add(context);\n+        logger.log(Level.DEBUG, \"context created: \" + path);\n@@ -311,1 +312,1 @@\n-    public synchronized HttpContextImpl createContext (String path) {\n+    public synchronized HttpContextImpl createContext(String path) {\n@@ -313,1 +314,1 @@\n-            throw new NullPointerException (\"null path parameter\");\n+            throw new NullPointerException(\"null path parameter\");\n@@ -315,3 +316,3 @@\n-        HttpContextImpl context = new HttpContextImpl (protocol, path, null, this);\n-        contexts.add (context);\n-        logger.log (Level.DEBUG, \"context created: \" + path);\n+        HttpContextImpl context = new HttpContextImpl(protocol, path, null, this);\n+        contexts.add(context);\n+        logger.log(Level.DEBUG, \"context created: \" + path);\n@@ -321,1 +322,1 @@\n-    public synchronized void removeContext (String path) throws IllegalArgumentException {\n+    public synchronized void removeContext(String path) throws IllegalArgumentException {\n@@ -323,1 +324,1 @@\n-            throw new NullPointerException (\"null path parameter\");\n+            throw new NullPointerException(\"null path parameter\");\n@@ -325,2 +326,2 @@\n-        contexts.remove (protocol, path);\n-        logger.log (Level.DEBUG, \"context removed: \" + path);\n+        contexts.remove(protocol, path);\n+        logger.log(Level.DEBUG, \"context removed: \" + path);\n@@ -329,1 +330,1 @@\n-    public synchronized void removeContext (HttpContext context) throws IllegalArgumentException {\n+    public synchronized void removeContext(HttpContext context) throws IllegalArgumentException {\n@@ -331,1 +332,1 @@\n-            throw new IllegalArgumentException (\"wrong HttpContext type\");\n+            throw new IllegalArgumentException(\"wrong HttpContext type\");\n@@ -333,2 +334,2 @@\n-        contexts.remove ((HttpContextImpl)context);\n-        logger.log (Level.DEBUG, \"context removed: \" + context.getPath());\n+        contexts.remove((HttpContextImpl)context);\n+        logger.log(Level.DEBUG, \"context removed: \" + context.getPath());\n@@ -341,1 +342,1 @@\n-    void addEvent (Event r) {\n+    void addEvent(Event r) {\n@@ -343,1 +344,1 @@\n-            events.add (r);\n+            events.add(r);\n@@ -416,1 +417,1 @@\n-        private void handleEvent (Event r) {\n+        private void handleEvent(Event r) {\n@@ -453,1 +454,1 @@\n-                    responseCompleted (c);\n+                    responseCompleted(c);\n@@ -456,1 +457,1 @@\n-                        allConnections.remove (c);\n+                        allConnections.remove(c);\n@@ -460,2 +461,2 @@\n-                            requestStarted (c);\n-                            handle (c.getChannel(), c);\n+                            requestStarted(c);\n+                            handle(c.getChannel(), c);\n@@ -463,1 +464,1 @@\n-                            connsToRegister.add (c);\n+                            connsToRegister.add(c);\n@@ -468,1 +469,1 @@\n-                logger.log (\n+                logger.log(\n@@ -477,1 +478,1 @@\n-        void reRegister (HttpConnection c) {\n+        void reRegister(HttpConnection c) {\n@@ -481,3 +482,3 @@\n-                chan.configureBlocking (false);\n-                SelectionKey key = chan.register (selector, SelectionKey.OP_READ);\n-                key.attach (c);\n+                chan.configureBlocking(false);\n+                SelectionKey key = chan.register(selector, SelectionKey.OP_READ);\n+                key.attach(c);\n@@ -488,1 +489,1 @@\n-                logger.log (Level.TRACE, \"Dispatcher(8)\", e);\n+                logger.log(Level.TRACE, \"Dispatcher (8)\", e);\n@@ -507,1 +508,1 @@\n-                            handleEvent (r);\n+                            handleEvent(r);\n@@ -528,1 +529,1 @@\n-                        if (key.equals (listenerKey)) {\n+                        if (key.equals(listenerKey)) {\n@@ -549,1 +550,1 @@\n-                                chan.configureBlocking (false);\n+                                chan.configureBlocking(false);\n@@ -551,2 +552,2 @@\n-                                    chan.register (selector, SelectionKey.OP_READ);\n-                                HttpConnection c = new HttpConnection ();\n+                                    chan.register(selector, SelectionKey.OP_READ);\n+                                HttpConnection c = new HttpConnection();\n@@ -554,2 +555,2 @@\n-                                c.setChannel (chan);\n-                                newkey.attach (c);\n+                                c.setChannel(chan);\n+                                newkey.attach(c);\n@@ -557,1 +558,1 @@\n-                                allConnections.add (c);\n+                                allConnections.add(c);\n@@ -566,1 +567,1 @@\n-                                    chan.configureBlocking (true);\n+                                    chan.configureBlocking(true);\n@@ -574,1 +575,1 @@\n-                                        handle (chan, conn);\n+                                        handle(chan, conn);\n@@ -589,1 +590,1 @@\n-                    logger.log (Level.TRACE, \"Dispatcher (4)\", e);\n+                    logger.log(Level.TRACE, \"Dispatcher (4)\", e);\n@@ -591,1 +592,1 @@\n-                    logger.log (Level.TRACE, \"Dispatcher (7)\", e);\n+                    logger.log(Level.TRACE, \"Dispatcher (7)\", e);\n@@ -594,1 +595,1 @@\n-            try {selector.close(); } catch (Exception e) {}\n+            try { selector.close(); } catch (Exception e) {}\n@@ -597,1 +598,1 @@\n-        private void handleException (SelectionKey key, Exception e) {\n+        private void handleException(SelectionKey key, Exception e) {\n@@ -600,1 +601,1 @@\n-                logger.log (Level.TRACE, \"Dispatcher (2)\", e);\n+                logger.log(Level.TRACE, \"Dispatcher (2)\", e);\n@@ -605,1 +606,1 @@\n-        public void handle (SocketChannel chan, HttpConnection conn)\n+        public void handle(SocketChannel chan, HttpConnection conn)\n@@ -608,2 +609,2 @@\n-                Exchange t = new Exchange (chan, protocol, conn);\n-                executor.execute (t);\n+                Exchange t = new Exchange(chan, protocol, conn);\n+                executor.execute(t);\n@@ -611,1 +612,1 @@\n-                logger.log (Level.TRACE, \"Dispatcher (4)\", e1);\n+                logger.log(Level.TRACE, \"Dispatcher (4)\", e1);\n@@ -614,1 +615,1 @@\n-                logger.log (Level.TRACE, \"Dispatcher (5)\", e);\n+                logger.log(Level.TRACE, \"Dispatcher (5)\", e);\n@@ -617,1 +618,1 @@\n-                logger.log (Level.TRACE, \"Dispatcher (6)\", e);\n+                logger.log(Level.TRACE, \"Dispatcher (6)\", e);\n@@ -623,1 +624,1 @@\n-    static boolean debug = ServerConfig.debugEnabled ();\n+    static boolean debug = ServerConfig.debugEnabled();\n@@ -625,1 +626,1 @@\n-    static synchronized void dprint (String s) {\n+    static synchronized void dprint(String s) {\n@@ -627,1 +628,1 @@\n-            System.out.println (s);\n+            System.out.println(s);\n@@ -631,1 +632,1 @@\n-    static synchronized void dprint (Exception e) {\n+    static synchronized void dprint(Exception e) {\n@@ -633,1 +634,1 @@\n-            System.out.println (e);\n+            System.out.println(e);\n@@ -638,1 +639,1 @@\n-    Logger getLogger () {\n+    Logger getLogger() {\n@@ -678,1 +679,1 @@\n-        Exchange (SocketChannel chan, String protocol, HttpConnection conn) throws IOException {\n+        Exchange(SocketChannel chan, String protocol, HttpConnection conn) throws IOException {\n@@ -684,1 +685,1 @@\n-        public void run () {\n+        public void run() {\n@@ -705,1 +706,1 @@\n-                if (context != null ) {\n+                if (context != null) {\n@@ -714,1 +715,1 @@\n-                            logger.log (Level.WARNING,\n+                            logger.log(Level.WARNING,\n@@ -716,1 +717,1 @@\n-                            throw new HttpError (\"No SSL context established\");\n+                            throw new HttpError(\"No SSL context established\");\n@@ -718,1 +719,1 @@\n-                        sslStreams = new SSLStreams (ServerImpl.this, sslContext, chan);\n+                        sslStreams = new SSLStreams(ServerImpl.this, sslContext, chan);\n@@ -725,1 +726,1 @@\n-                            new Request.ReadStream (\n+                            new Request.ReadStream(\n@@ -728,1 +729,1 @@\n-                        rawout = new Request.WriteStream (\n+                        rawout = new Request.WriteStream(\n@@ -736,1 +737,10 @@\n-                Request req = new Request (rawin, rawout);\n+\n+                Request req;\n+                try {\n+                    req = new Request(rawin, rawout, newconnection && !https);\n+                } catch (ProtocolException pe) {\n+                    logger.log(Level.DEBUG, \"closing due to: \" + pe);\n+                    reject(Code.HTTP_BAD_REQUEST, \"\", pe.getMessage());\n+                    return;\n+                }\n+\n@@ -745,1 +755,1 @@\n-                int space = requestLine.indexOf (' ');\n+                int space = requestLine.indexOf(' ');\n@@ -747,1 +757,1 @@\n-                    reject (Code.HTTP_BAD_REQUEST,\n+                    reject(Code.HTTP_BAD_REQUEST,\n@@ -751,1 +761,1 @@\n-                String method = requestLine.substring (0, space);\n+                String method = requestLine.substring(0, space);\n@@ -755,1 +765,1 @@\n-                    reject (Code.HTTP_BAD_REQUEST,\n+                    reject(Code.HTTP_BAD_REQUEST,\n@@ -759,1 +769,1 @@\n-                String uriStr = requestLine.substring (start, space);\n+                String uriStr = requestLine.substring(start, space);\n@@ -762,1 +772,1 @@\n-                    uri = new URI (uriStr);\n+                    uri = new URI(uriStr);\n@@ -769,1 +779,1 @@\n-                String version = requestLine.substring (start);\n+                String version = requestLine.substring(start);\n@@ -820,1 +830,1 @@\n-                ctx = contexts.findContext (protocol, uri.getPath());\n+                ctx = contexts.findContext(protocol, uri.getPath());\n@@ -822,1 +832,1 @@\n-                    reject (Code.HTTP_NOT_FOUND,\n+                    reject(Code.HTTP_NOT_FOUND,\n@@ -826,1 +836,1 @@\n-                connection.setContext (ctx);\n+                connection.setContext(ctx);\n@@ -828,1 +838,1 @@\n-                    reject (Code.HTTP_INTERNAL_ERROR,\n+                    reject(Code.HTTP_INTERNAL_ERROR,\n@@ -832,1 +842,1 @@\n-                tx = new ExchangeImpl (\n+                tx = new ExchangeImpl(\n@@ -838,1 +848,1 @@\n-                if (chdr != null && chdr.equalsIgnoreCase (\"close\")) {\n+                if (chdr != null && chdr.equalsIgnoreCase(\"close\")) {\n@@ -841,1 +851,1 @@\n-                if (version.equalsIgnoreCase (\"http\/1.0\")) {\n+                if (version.equalsIgnoreCase(\"http\/1.0\")) {\n@@ -845,1 +855,1 @@\n-                        rheaders.set (\"Connection\", \"close\");\n+                        rheaders.set(\"Connection\", \"close\");\n@@ -855,1 +865,1 @@\n-                    connection.setParameters (\n+                    connection.setParameters(\n@@ -866,3 +876,3 @@\n-                if (exp != null && exp.equalsIgnoreCase (\"100-continue\")) {\n-                    logReply (100, requestLine, null);\n-                    sendReply (\n+                if (exp != null && exp.equalsIgnoreCase(\"100-continue\")) {\n+                    logReply(100, requestLine, null);\n+                    sendReply(\n@@ -883,1 +893,1 @@\n-                final Filter.Chain uc = new Filter.Chain(uf, new LinkHandler (sc));\n+                final Filter.Chain uc = new Filter.Chain(uf, new LinkHandler(sc));\n@@ -889,1 +899,1 @@\n-                    uc.doFilter (new HttpsExchangeImpl (tx));\n+                    uc.doFilter(new HttpsExchangeImpl(tx));\n@@ -891,1 +901,1 @@\n-                    uc.doFilter (new HttpExchangeImpl (tx));\n+                    uc.doFilter(new HttpExchangeImpl(tx));\n@@ -895,1 +905,1 @@\n-                logger.log (Level.TRACE, \"ServerImpl.Exchange\", e);\n+                logger.log(Level.TRACE, \"ServerImpl.Exchange\", e);\n@@ -910,1 +920,1 @@\n-            LinkHandler (Filter.Chain nextChain) {\n+            LinkHandler(Filter.Chain nextChain) {\n@@ -914,2 +924,2 @@\n-            public void handle (HttpExchange exchange) throws IOException {\n-                nextChain.doFilter (exchange);\n+            public void handle(HttpExchange exchange) throws IOException {\n+                nextChain.doFilter(exchange);\n@@ -919,1 +929,1 @@\n-        void reject (int code, String requestStr, String message) {\n+        void reject(int code, String requestStr, String message) {\n@@ -921,2 +931,2 @@\n-            logReply (code, requestStr, message);\n-            sendReply (\n+            logReply(code, requestStr, message);\n+            sendReply(\n@@ -927,1 +937,1 @@\n-        void sendReply (\n+        void sendReply(\n@@ -931,3 +941,3 @@\n-                StringBuilder builder = new StringBuilder (512);\n-                builder.append (\"HTTP\/1.1 \")\n-                    .append (code).append (Code.msg(code)).append (\"\\r\\n\");\n+                StringBuilder builder = new StringBuilder(512);\n+                builder.append(\"HTTP\/1.1 \")\n+                    .append(code).append(Code.msg(code)).append(\"\\r\\n\");\n@@ -936,3 +946,3 @@\n-                    builder.append (\"Content-Length: \")\n-                        .append (text.length()).append (\"\\r\\n\")\n-                        .append (\"Content-Type: text\/html\\r\\n\");\n+                    builder.append(\"Content-Length: \")\n+                        .append(text.length()).append(\"\\r\\n\")\n+                        .append(\"Content-Type: text\/html\\r\\n\");\n@@ -940,1 +950,1 @@\n-                    builder.append (\"Content-Length: 0\\r\\n\");\n+                    builder.append(\"Content-Length: 0\\r\\n\");\n@@ -944,1 +954,1 @@\n-                    builder.append (\"Connection: close\\r\\n\");\n+                    builder.append(\"Connection: close\\r\\n\");\n@@ -946,1 +956,1 @@\n-                builder.append (\"\\r\\n\").append (text);\n+                builder.append(\"\\r\\n\").append(text);\n@@ -949,1 +959,1 @@\n-                rawout.write (b);\n+                rawout.write(b);\n@@ -955,1 +965,1 @@\n-                logger.log (Level.TRACE, \"ServerImpl.sendReply\", e);\n+                logger.log(Level.TRACE, \"ServerImpl.sendReply\", e);\n@@ -962,1 +972,1 @@\n-    void logReply (int code, String requestStr, String text) {\n+    void logReply(int code, String requestStr, String text) {\n@@ -971,1 +981,1 @@\n-           r = requestStr.substring (0, 80) + \"<TRUNCATED>\";\n+           r = requestStr.substring(0, 80) + \"<TRUNCATED>\";\n@@ -977,1 +987,1 @@\n-        logger.log (Level.DEBUG, message);\n+        logger.log(Level.DEBUG, message);\n@@ -982,1 +992,1 @@\n-    synchronized void startExchange () {\n+    synchronized void startExchange() {\n@@ -990,1 +1000,1 @@\n-    synchronized int endExchange () {\n+    synchronized int endExchange() {\n@@ -996,1 +1006,1 @@\n-    HttpServer getWrapper () {\n+    HttpServer getWrapper() {\n@@ -1000,1 +1010,1 @@\n-    void requestStarted (HttpConnection c) {\n+    void requestStarted(HttpConnection c) {\n@@ -1002,2 +1012,2 @@\n-        c.setState (State.REQUEST);\n-        reqConnections.add (c);\n+        c.setState(State.REQUEST);\n+        reqConnections.add(c);\n@@ -1040,1 +1050,1 @@\n-    void requestCompleted (HttpConnection c) {\n+    void requestCompleted(HttpConnection c) {\n@@ -1043,1 +1053,1 @@\n-        reqConnections.remove (c);\n+        reqConnections.remove(c);\n@@ -1045,2 +1055,2 @@\n-        rspConnections.add (c);\n-        c.setState (State.RESPONSE);\n+        rspConnections.add(c);\n+        c.setState(State.RESPONSE);\n@@ -1050,1 +1060,1 @@\n-    void responseCompleted (HttpConnection c) {\n+    void responseCompleted(HttpConnection c) {\n@@ -1053,2 +1063,2 @@\n-        rspConnections.remove (c);\n-        c.setState (State.IDLE);\n+        rspConnections.remove(c);\n+        c.setState(State.IDLE);\n@@ -1062,1 +1072,1 @@\n-        public void run () {\n+        public void run() {\n@@ -1098,1 +1108,1 @@\n-        public void run () {\n+        public void run() {\n@@ -1105,1 +1115,1 @@\n-                            toClose.add (c);\n+                            toClose.add(c);\n@@ -1109,3 +1119,3 @@\n-                        logger.log (Level.DEBUG, \"closing: no request: \" + c);\n-                        reqConnections.remove (c);\n-                        allConnections.remove (c);\n+                        logger.log(Level.DEBUG, \"closing: no request: \" + c);\n+                        reqConnections.remove(c);\n+                        allConnections.remove(c);\n@@ -1121,1 +1131,1 @@\n-                            toClose.add (c);\n+                            toClose.add(c);\n@@ -1125,3 +1135,3 @@\n-                        logger.log (Level.DEBUG, \"closing: no response: \" + c);\n-                        rspConnections.remove (c);\n-                        allConnections.remove (c);\n+                        logger.log(Level.DEBUG, \"closing: no response: \" + c);\n+                        rspConnections.remove(c);\n+                        allConnections.remove(c);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/ServerImpl.java","additions":181,"deletions":171,"binary":false,"changes":352,"status":"modified"},{"patch":"@@ -43,2 +43,2 @@\n-    UndefLengthOutputStream (ExchangeImpl t, OutputStream src) {\n-        super (src);\n+    UndefLengthOutputStream(ExchangeImpl t, OutputStream src) {\n+        super(src);\n@@ -48,1 +48,1 @@\n-    public void write (int b) throws IOException {\n+    public void write(int b) throws IOException {\n@@ -50,1 +50,1 @@\n-            throw new IOException (\"stream closed\");\n+            throw new IOException(\"stream closed\");\n@@ -55,1 +55,1 @@\n-    public void write (byte[]b, int off, int len) throws IOException {\n+    public void write(byte[] b, int off, int len) throws IOException {\n@@ -61,1 +61,1 @@\n-            throw new IOException (\"stream closed\");\n+            throw new IOException(\"stream closed\");\n@@ -66,1 +66,1 @@\n-    public void close () throws IOException {\n+    public void close() throws IOException {\n@@ -79,1 +79,1 @@\n-        t.getHttpContext().getServerImpl().addEvent (e);\n+        t.getHttpContext().getServerImpl().addEvent(e);\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/UndefLengthOutputStream.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -65,1 +65,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -70,1 +70,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -75,1 +75,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -80,1 +80,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -85,1 +85,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -90,1 +90,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -109,1 +109,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -114,1 +114,1 @@\n-        throw new UnsupportedOperationException (\"unsupported operation\");\n+        throw new UnsupportedOperationException(\"unsupported operation\");\n@@ -118,1 +118,1 @@\n-    public boolean equals(Object o) {return headers.equals(o);}\n+    public boolean equals(Object o) { return headers.equals(o); }\n@@ -121,1 +121,1 @@\n-    public int hashCode() {return headers.hashCode();}\n+    public int hashCode() { return headers.hashCode(); }\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/UnmodifiableHeaders.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -370,1 +370,1 @@\n-    private static final Map<Integer,String> RESERVED_CHARS = Map.of(\n+    private static final Map<Integer, String> RESERVED_CHARS = Map.of(\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/simpleserver\/FileServerHandler.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -263,0 +263,3 @@\n+     * However, the range for plain notation is defined to be the interval\n+     * [10<sup>-3<\/sup>, 10<sup>3<\/sup>) rather than the interval used\n+     * for {@code float} and {@code double}.\n@@ -2109,1 +2112,1 @@\n-            if (0 < e && e <= 7) {\n+            if (0 < e && e <= 3) {\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/Float16.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -0,0 +1,91 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, BELLSOFT. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package sun.jvmstat;\n+\n+import java.io.IOException;\n+import java.nio.file.DirectoryStream;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+\/*\n+ * macOS specific implementation of the PlatformSupport routines\n+ * providing temporary directory support.\n+ *\/\n+public class PlatformSupportImpl extends PlatformSupport {\n+\n+    private static final String VAR_FOLDERS_PATH = \"\/var\/folders\";\n+    private static final String USER_NAME_SYSTEM_PROPERTY = \"user.name\";\n+    private static final String USER_NAME_ROOT = \"root\";\n+    private static final String DIRHELPER_TEMP_STR = \"T\";\n+\n+    private static final boolean isCurrentUserRoot =\n+            System.getProperty(USER_NAME_SYSTEM_PROPERTY).equals(USER_NAME_ROOT);\n+\n+    public PlatformSupportImpl() {\n+        super();\n+    }\n+\n+    \/*\n+     * Return a list of the temporary directories that the VM uses\n+     * for the attach and perf data files.\n+     *\n+     * This function returns the traditional temp directory. Additionally,\n+     * when called by root, it returns other temporary directories of non-root\n+     * users.\n+     *\n+     * macOS per-user temp directories are located under \/var\/folders\n+     * and have the form \/var\/folders\/<BUCKET>\/<ENCODED_UUID_UID>\/T\n+     *\/\n+    @Override\n+    public List<String> getTemporaryDirectories(int pid) {\n+        if (!isCurrentUserRoot) {\n+            \/\/ early exit for non-root\n+            return List.of(PlatformSupport.getTemporaryDirectory());\n+        }\n+        List<String> result = new ArrayList<>();\n+        try (DirectoryStream<Path> bs = Files.newDirectoryStream(Path.of(VAR_FOLDERS_PATH))) {\n+            for (Path bucket : bs) {\n+                try (DirectoryStream<Path> encUuids = Files.newDirectoryStream(bucket)) {\n+                    for (Path encUuid : encUuids) {\n+                        try {\n+                            Path tempDir = encUuid.resolve(DIRHELPER_TEMP_STR);\n+                            if (Files.isDirectory(tempDir) && Files.isReadable(tempDir)) {\n+                                result.add(tempDir.toString());\n+                            }\n+                        } catch (Exception ignore) { \/\/ ignored unreadable bucket\/encUuid, continue\n+                        }\n+                    }\n+                } catch (IOException ignore) { \/\/ IOException ignored, continue to the next bucket\n+                }\n+            }\n+        } catch (Exception ignore) { \/\/ var\/folders directory is inaccessible \/ other errors\n+        }\n+        return result.isEmpty() ? List.of(PlatformSupport.getTemporaryDirectory()) : result;\n+    }\n+}\n","filename":"src\/jdk.internal.jvmstat\/macosx\/classes\/sun\/jvmstat\/PlatformSupportImpl.java","additions":91,"deletions":0,"binary":false,"changes":91,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,0 +43,2 @@\n+    exports sun.jvmstat to\n+        jdk.attach;\n","filename":"src\/jdk.internal.jvmstat\/share\/classes\/module-info.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -223,0 +223,1 @@\n+jks.storetype.warning=%1$s verwendet veraltete kryptografische Algorithmen und wird in einer zuknftigen Version entfernt. Migrieren Sie zu PKCS12 mit:\\nkeytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/security\/tools\/jarsigner\/resources\/jarsigner_de.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -223,0 +223,1 @@\n+jks.storetype.warning=%1$sPKCS12:\\nkeytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/security\/tools\/jarsigner\/resources\/jarsigner_ja.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -223,0 +223,1 @@\n+jks.storetype.warning=%1$s  PKCS12\\nkeytool -importkeystore -srckeystore %2$s -destkeystore %2$s -deststoretype pkcs12\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/security\/tools\/jarsigner\/resources\/jarsigner_zh_CN.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -83,0 +83,2 @@\n+error.validator.metainf.wrong.position=Eintrag META-INF\/ an Position 0 erwartet, aber an Position {0} gefunden\n+error.validator.manifest.wrong.position=Eintrag META-INF\/MANIFEST.MF an Position 0 oder 1 erwartet, aber an Position {0} gefunden\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/tools\/jar\/resources\/jar_de.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -83,0 +83,2 @@\n+error.validator.metainf.wrong.position=META-INF\/0: {0}\n+error.validator.manifest.wrong.position=META-INF\/MANIFEST.MF01: {0}\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/tools\/jar\/resources\/jar_ja.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -83,0 +83,2 @@\n+error.validator.metainf.wrong.position= META-INF\/  0 {0}\n+error.validator.manifest.wrong.position= META-INF\/MANIFEST.MF  0  1  {0} \n","filename":"src\/jdk.jartool\/share\/classes\/sun\/tools\/jar\/resources\/jar_zh_CN.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -246,0 +246,1 @@\n+        CURRENT_PATH.set(path.getPath());\n@@ -248,0 +249,3 @@\n+    \/** Temporary workaround to share current path with taglets, see 8373909 *\/\n+    public static final ThreadLocal<String> CURRENT_PATH = new ThreadLocal<>();\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDocletWriter.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -193,0 +193,4 @@\n+doclet.theme.select_theme=Theme auswhlen\n+doclet.theme.light=Hell\n+doclet.theme.dark=Dunkel\n+doclet.theme.system=Systemeinstellung\n@@ -542,0 +546,2 @@\n+\n+doclet.selectModule=Whlen Sie das Modul aus, in dem gesucht werden soll.\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/standard_de.properties","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -193,0 +193,4 @@\n+doclet.theme.select_theme=\n+doclet.theme.light=\n+doclet.theme.dark=\n+doclet.theme.system=\n@@ -542,0 +546,2 @@\n+\n+doclet.selectModule=\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/standard_ja.properties","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -193,0 +193,4 @@\n+doclet.theme.select_theme=\n+doclet.theme.light=\n+doclet.theme.dark=\n+doclet.theme.system=\n@@ -542,0 +546,2 @@\n+\n+doclet.selectModule=\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/standard_zh_CN.properties","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -68,0 +68,1 @@\n+doclet.Toggle_member_listing=Zwischen kurzer und detaillierter Listenansicht umschalten\n@@ -117,1 +118,1 @@\n-doclet.tag_misuse=Tag {0} kann nicht in {1}-Dokumentation verwendet werden. Es kann nur in folgenden Dokumentationstypen verwendet werden: {2}.\n+doclet.tag_misuse=Tag {0} kann nicht in Dokumentation {1} verwendet werden. Es kann nur in folgenden Dokumentationstypen verwendet werden: {2}.\n@@ -229,1 +230,1 @@\n-doclet.Member=Mitglied\n+doclet.Member=Member\n@@ -243,0 +244,2 @@\n+doclet.Sort_lexicographically=Member-Details lexikographisch sortieren\n+doclet.Sort_by_source_order=Member-Details nach Quellreihenfolge sortieren\n@@ -248,0 +251,1 @@\n+doclet.sort_table_of_contents=Member-Details in lexikographischer Reihenfolge sortieren\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/resources\/doclets_de.properties","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -68,0 +68,1 @@\n+doclet.Toggle_member_listing=\n@@ -243,0 +244,2 @@\n+doclet.Sort_lexicographically=\n+doclet.Sort_by_source_order=\n@@ -248,0 +251,1 @@\n+doclet.sort_table_of_contents=\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/resources\/doclets_ja.properties","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -68,0 +68,1 @@\n+doclet.Toggle_member_listing=\n@@ -243,0 +244,2 @@\n+doclet.Sort_lexicographically=\n+doclet.Sort_by_source_order=\n@@ -248,0 +251,1 @@\n+doclet.sort_table_of_contents=\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/resources\/doclets_zh_CN.properties","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -55,1 +55,1 @@\n-main.opt.show.members.desc=Gibt an, welche Member (Felder, Methoden oder Konstruktoren) dokumentiert\\nwerden, wobei der Wert \"public\", \"protected\",\\n\"package\" oder \"private\" lauten kann. Der Standardwert ist \"protected\"\\nund zeigt ffentliche und geschtzte Member an. \"public\" zeigt nur\\nffentliche Member, \"package\" zeigt ffentliche, geschtzte und\\nPackage-Member, und \"private\" zeigt alle Member an.\n+main.opt.show.members.desc=Gibt an, welche Members (Felder, Methoden oder Konstruktoren) dokumentiert\\nwerden, wobei der Wert \"public\", \"protected\",\\n\"package\" oder \"private\" lauten kann. Der Standardwert ist \"protected\"\\nund zeigt ffentliche und geschtzte Members an. \"public\" zeigt nur\\nffentliche Members, \"package\" zeigt ffentliche, geschtzte und\\nPackage-Members, und \"private\" zeigt alle Members an.\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/tool\/resources\/javadoc_de.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -81,1 +81,2 @@\n-err.jlink.version.mismatch=jlink-Version {0}.{1} stimmt nicht mit Ziel-java.base-Version {2}.{3} berein\n+err.jlink.version.mismatch=jlink-Build \"{0}\" stimmt nicht mit dem java.base-Ziel-Build \"{1}\" berein\n+err.jlink.version.missing=jlink-Build \"{0}\" kann die Build-Signatur nicht im Modul java.base finden, das im Modulpfad angegebenen wird. Wahrscheinlich stammt es aus einem frheren Build.\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/jlink_de.properties","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -81,1 +81,2 @@\n-err.jlink.version.mismatch=jlink{0}.{1}java.base{2}.{3}\n+err.jlink.version.mismatch=jlink''{0}''java.base''{1}''\n+err.jlink.version.missing=jlink''{0}''java.base()\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/jlink_ja.properties","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -81,1 +81,2 @@\n-err.jlink.version.mismatch=jlink  {0}.{1}  java.base  {2}.{3} \n+err.jlink.version.mismatch=jlink  ''{0}''  java.base  ''{1}'' \n+err.jlink.version.missing=jlink  ''{0}''  java.base \n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/jlink_zh_CN.properties","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-release-info.description=<Datei>-Option ldt Releaseeigenschaften aus der angegebenen Datei.\\nadd: fgt der Datei \"release\" Eigenschaften hinzu.\\nEine beliebige Anzahl von <Schlssel>=<Wert>-Paaren kann bergeben werden.\\ndel: lscht die Liste der Schlssel in der Releasedatei.\n+release-info.description=Option <Datei> ldt Releaseeigenschaften aus der angegebenen Datei.\\n       Die angegebene Datei soll erwartungsgem in UTF-8 codiert sein.\\nadd: fgt der Datei \"release\" Eigenschaften hinzu.\\nEine beliebige Anzahl von <Schlssel>=<Wert>-Paaren kann bergeben werden.\\ndel: lscht die Liste der Schlssel in der Releasedatei.\n@@ -36,1 +36,1 @@\n-release-info.usage=\\  --release-info <Datei>|add:<Schlssel1>=<Wert1>:<Schlssel2>=<Wert2>:...|del:<Schlsselliste>\\n                            Option <Datei> lscht Releaseeigenschaften aus\\n                            der angegebenen Datei.\\n                            add: fgt Eigenschaften der Datei \"release\" hinzu.\\n                            Eine beliebige Anzahl <Schlssel>=<Wert>-Paare kann bergeben werden.\\n                            del: lscht die Liste der Schlssel in der Releasedatei.\n+release-info.usage=\\  --release-info <Datei>|add:<Schlssel1>=<Wert1>:<Schlssel2>=<Wert2>:...|del:<Schlsselliste>\\n                            Option <Datei> ldt Releaseeigenschaften aus\\n                            der angegebenen Datei. Die angegebene Datei soll erwartungsgem\\n                            in UTF-8 codiert sein.\\n                            add: fgt der Datei \"release\" Eigenschaften hinzu.\\n                            Eine beliebige Anzahl <Schlssel>=<Wert>-Paare kann bergeben werden.\\n                            del: lscht die Liste der Schlssel in der Releasedatei.\n@@ -44,1 +44,1 @@\n-compress.argument=<zip-[0-9]>[:filter=<Musterliste>]\n+compress.argument=<zip-'{0-9}'>[:filter=<Musterliste>]\n@@ -48,1 +48,1 @@\n-compress.usage=\\  --compress <compress>     Zu verwendende Komprimierung fr Ressourcen:\\n                            Zulssige Werte:\\n                            zip-[0-9], wobei \"zip-0\" fr keine Komprimierung\\n                            und \"zip-9\" fr die beste Komprimierung steht.\\n                            Standardwert ist \"zip-6\".\n+compress.usage=\\  --compress <Komprimierung>     Zu verwendende Komprimierung fr Ressourcen:\\n                            Zulssige Werte:\\n                            zip-'{0-9}', wobei \"zip-0\" fr keine Komprimierung\\n                            und \"zip-9\" fr die beste Komprimierung steht.\\n                            Standardwert ist \"zip-6\".\n@@ -173,1 +173,1 @@\n-plugin.opt.compress=\\      --compress <compress>             Zu verwendende Komprimierung fr Ressourcen:\\n                                        Zulssige Werte:\\n                                        zip-[0-9], wobei \"zip-0\" fr keine Komprimierung\\n                                        und \"zip-9\" fr die beste Komprimierung steht.\\n                                        Standardwert ist \"zip-6\".\\n                                        Veraltete Werte, die in einem zuknftigen Release entfernt werden:\\n                                        0: Keine Komprimierung. Entspricht \"zip-0\".\\n                                        1: Gemeinsame Verwendung konstanter Zeichenfolgen\\n                                        2: Entspricht \"zip-6\".\n+plugin.opt.compress=\\      --compress <Komprimierung>             Komprimiert alle Ressourcen im Ausgabeimage:\\n                                        Zulssige Werte:\\n                                        zip-'{0-9}', wobei \"zip-0\" fr keine Komprimierung\\n                                        und \"zip-9\" fr die beste Komprimierung steht.\\n                                        Standardwert ist \"zip-6.\"\\n                                        Veraltete Werte, die in einem zuknftigen Release entfernt werden:\\n                                        0:  Keine Komprimierung. Verwenden Sie stattdessen \"zip-0\".\\n                                        1:  Gemeinsame Verwendung konstanter Zeichenfolgen\\n                                        2:  ZIP. Verwenden Sie stattdessen \"zip-6\".\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/plugins_de.properties","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-release-info.description=<file>\\nadd:\\n<key>=<value>\\ndel:\n+release-info.description=<file>\\n       UTF-8\\nadd:\\n<key>=<value>\\ndel:\n@@ -36,1 +36,1 @@\n-release-info.usage=\\  --release-info <file>|add:<key1>=<value1>:<key2>=<value2>:...|del:<key list>\\n                            <file>\\n                            \\n                            add:\\n                            <key>=<value>\\n                            del:\n+release-info.usage=\\  --release-info <file>|add:<key1>=<value1>:<key2>=<value2>:...|del:<key list>\\n                            <file>\\n                            UTF-8\\n                            \\n                            add:\\n                            <key>=<value>\\n                            del:\n@@ -44,1 +44,1 @@\n-compress.argument=<zip-[0-9]>[:filter=<pattern-list>]\n+compress.argument=<zip-'{0-9}'>[:filter=<pattern-list>]\n@@ -48,1 +48,1 @@\n-compress.usage=\\  --compress <compress>     :\\n                            \\n                            zip-[0-9]zip-0\\n                            zip-9\\n                            zip-6\n+compress.usage=\\  --compress <compress>     :\\n                            \\n                            zip-'{0-9}'zip-0\\n                            zip-9\\n                            zip-6\n@@ -173,1 +173,1 @@\n-plugin.opt.compress=\\      --compress <compress>             :\\n                                        \\n                                        zip-[0-9]zip-0\\n                                        zip-9\\n                                        zip-6\\n                                        :\\n                                        0:  zip-0\\n                                        1:  \\n                                        2:  zip-6\n+plugin.opt.compress=\\      --compress <compress>             :\\n                                        \\n                                        zip-'{0-9}'zip-0\\n                                        zip-9\\n                                        zip-6\\n                                        :\\n                                        0:  zip-0\\n                                        1:  \\n                                        2:  ZIPzip-6\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/plugins_ja.properties","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-release-info.description=<file>  release \\nadd 'release' \\n <key>=<value> \\ndel release \n+release-info.description=<file>  release \\n        UTF-8 \\nadd 'release' \\n <key>=<value> \\ndel release \n@@ -36,1 +36,1 @@\n-release-info.usage=\\  --release-info <file>|add:<key1>=<value1>:<key2>=<value2>:...|del:<key list>\\n                            <file> \\n                             release \\n                            add 'release' \\n                             <key>=<value> \\n                            del release \n+release-info.usage=\\  --release-info <file>|add:<key1>=<value1>:<key2>=<value2>:...|del:<key list>\\n                            <file> \\n                             release \\n                             UTF-8 \\n                            add 'release' \\n                             <key>=<value> \\n                            del release \n@@ -44,1 +44,1 @@\n-compress.argument=<zip-[0-9]>[:filter=<pattern-list>]\n+compress.argument=<zip-'{0-9}'>[:filter=<pattern-list>]\n@@ -48,1 +48,1 @@\n-compress.usage=\\  --compress <compress>     \\n                            \\n                            zip-[0-9] zip-0 \\n                            zip-9 \\n                             zip-6\n+compress.usage=\\  --compress <compress>     \\n                            \\n                            zip-'{0-9}' zip-0 \\n                            zip-9 \\n                             zip-6\n@@ -173,1 +173,1 @@\n-plugin.opt.compress=\\      --compress <compress>             \\n                                        \\n                                        zip-[0-9] zip-0 \\n                                        zip-9 \\n                                         zip-6\\n                                        \\n                                        0 zip-0\\n                                        1\\n                                        2 zip-6\n+plugin.opt.compress=\\      --compress <compress>             \\n                                        \\n                                        zip-'{0-9}' zip-0 \\n                                        zip-9 \\n                                         zip-6\\n                                        \\n                                        0 zip-0\\n                                        1\\n                                        2ZIP zip-6\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/resources\/plugins_zh_CN.properties","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -26,4 +26,0 @@\n-app.bundler.name=Linux-Anwendungsimage\n-deb.bundler.name=DEB-Bundle\n-rpm.bundler.name=RPM-Bundle\n-\n@@ -31,1 +27,0 @@\n-param.menu-group.default=Unbekannt\n@@ -62,1 +57,0 @@\n-message.creating-association-with-null-extension=Verknpfung mit Nullerweiterung wird erstellt.\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/resources\/LinuxResources_de.properties","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -26,4 +26,0 @@\n-app.bundler.name=Linux\n-deb.bundler.name=DEB\n-rpm.bundler.name=RPM\n-\n@@ -31,1 +27,0 @@\n-param.menu-group.default=\n@@ -62,1 +57,0 @@\n-message.creating-association-with-null-extension=null\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/resources\/LinuxResources_ja.properties","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -26,4 +26,0 @@\n-app.bundler.name=Linux \n-deb.bundler.name=DEB \n-rpm.bundler.name=RPM \n-\n@@ -31,1 +27,0 @@\n-param.menu-group.default=\n@@ -62,1 +57,0 @@\n-message.creating-association-with-null-extension=\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/resources\/LinuxResources_zh_CN.properties","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -109,1 +109,1 @@\n-        final var appResult = Result.create(() -> createMacApplicationInternal(options));\n+        final var appResult = Result.of(() -> createMacApplicationInternal(options));\n@@ -149,1 +149,1 @@\n-                final var pkgSignConfigResult = Result.create(signingIdentityBuilder::create);\n+                final var pkgSignConfigResult = Result.of(signingIdentityBuilder::create);\n@@ -156,1 +156,1 @@\n-                    rethrowUnchecked(expiredAppCertException);\n+                    throw toUnchecked(expiredAppCertException);\n@@ -160,1 +160,1 @@\n-                rethrowUnchecked(expiredAppCertException);\n+                throw toUnchecked(expiredAppCertException);\n@@ -306,1 +306,1 @@\n-        rethrowUnchecked(ex);\n+        throw toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/MacFromOptions.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -150,2 +150,3 @@\n-                Log.error(I18N.format(\"error.cert.not.found\", certificateSelector.signingIdentities().getFirst(),\n-                        keychain.map(Keychain::name).orElse(\"\")));\n+                var errMsg = I18N.format(\"error.cert.not.found\", certificateSelector.signingIdentities().getFirst(),\n+                        keychain.map(Keychain::name).orElse(\"\"));\n+                Log.error(I18N.format(\"message.error-header\", errMsg));\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/SigningIdentityBuilder.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-    static void withKeychains(ThrowingConsumer<List<Keychain>> keychainConsumer, List<Keychain> keychains) throws Throwable {\n+    static void withKeychains(ThrowingConsumer<List<Keychain>, ? extends Exception> keychainConsumer, List<Keychain> keychains) throws Exception {\n@@ -50,1 +50,1 @@\n-    static void withKeychain(ThrowingConsumer<Keychain> keychainConsumer, Keychain keychain) throws Throwable {\n+    static void withKeychain(ThrowingConsumer<Keychain, ? extends Exception> keychainConsumer, Keychain keychain) throws Exception {\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/TempKeychain.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -26,6 +26,0 @@\n-\n-app.bundler.name=Mac-Anwendungsimage\n-store.bundler.name=Mac App Store-fhiger Bundler\n-dmg.bundler.name=Mac-DMG-Package\n-pkg.bundler.name=Mac-PKG-Package\n-\n@@ -35,3 +29,1 @@\n-error.must-sign-app-store=Mac App Store-Apps mssen signiert werden. Die Signierung wurde von der Bundler-Konfiguration deaktiviert\n-error.must-sign-app-store.advice=Verwenden Sie die Option --mac-sign mit entsprechenden Werten fr user-name und keychain\n-error.certificate.expired=Fehler: Zertifikat abgelaufen {0}\n+error.certificate.expired=Zertifikat abgelaufen {0}\n@@ -39,4 +31,6 @@\n-error.multiple.certs.found=WARNUNG: Mehrere Zertifikate gefunden, die [{0}] mit Schlsselbund [{1}] entsprechen. Es wird das erste Zertifikat verwendet\n-error.app-image.mac-sign.required=Fehler: Die Option \"--mac-sign\" ist mit einem vordefinierten Anwendungsimage und Typ [app-image] erforderlich\n-error.tool.failed.with.output=Fehler: \"{0}\" nicht erfolgreich mit folgender Ausgabe:\n-resource.bundle-config-file=Bundle-Konfigurationsdatei\n+error.multiple.certs.found=Mehrere Zertifikate mit Namen [{0}] in Schlsselbund [{1}] gefunden\n+error.app-image.mac-sign.required=Die Option --mac-sign ist mit einem vordefinierten Anwendungsimage und Typ [app-image] erforderlich\n+error.tool.failed.with.output=\"{0}\" war mit folgender Ausgabe nicht erfolgreich:\n+error.invalid-runtime-image-missing-file=Im Laufzeitimage \"{0}\" fehlt die Datei \"{1}\"\n+error.invalid-runtime-image-bin-dir=Laufzeitimage \"{0}\" darf keinen Ordner \"bin\" enthalten\n+error.invalid-runtime-image-bin-dir.advice=Verwenden Sie die jlink-Option --strip-native-commands, wenn das Laufzeitimage mit Option {0} generiert wird\n@@ -44,0 +38,1 @@\n+resource.app-runtime-info-plist=Eingebettete Info.plist von Java Runtime\n@@ -59,1 +54,0 @@\n-\n@@ -65,5 +59,1 @@\n-message.creating-association-with-null-extension=Verknpfung mit Nullerweiterung wird erstellt.\n-message.ignoring.symlink=Warnung: codesign berspringt den Symlink {0}.\n-message.already.signed=Datei ist bereits signiert: {0}.\n-message.keychain.error=Fehler: Schlsselbundliste kann nicht abgerufen werden.\n-message.building-bundle=Mac App Store-Package fr {0} wird erstellt.\n+message.keychain.error=Schlsselbundliste kann nicht abgerufen werden.\n@@ -73,1 +63,0 @@\n-message.running-script=Shellskript wird auf Anwendungsimage [{0}] ausgefhrt.\n@@ -87,0 +76,2 @@\n+warning.non.standard.contents.sub.dir=Warnung: Der Dateiname des Verzeichnisses \"{0}\", das fr die Option --app-content angegeben wurde, ist kein Standardunterverzeichnisname im Verzeichnis \"Contents\" des Anwendungs-Bundles. Mglicherweise verluft die Codesignierung und\/oder Notarisierung im Ergebnisanwendungs-Bundle nicht erfolgreich.\n+warning.app.content.is.not.dir=Warnung: Der Wert \"{0}\" der Option --app-content ist kein Verzeichnis. Mglicherweise verluft die Codesignierung und\/oder Notarisierung im Ergebnisanwendungs-Bundle nicht erfolgreich.\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/resources\/MacResources_de.properties","additions":11,"deletions":20,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -26,6 +26,0 @@\n-\n-app.bundler.name=Mac\n-store.bundler.name=Mac App Store\n-dmg.bundler.name=Mac DMG\n-pkg.bundler.name=Mac PKG\n-\n@@ -35,3 +29,1 @@\n-error.must-sign-app-store=Mac App Store\n-error.must-sign-app-store.advice=--mac-signuser-namekeychain\n-error.certificate.expired=: {0}\n+error.certificate.expired={0}\n@@ -39,4 +31,6 @@\n-error.multiple.certs.found=: [{1}][{0}]\n-error.app-image.mac-sign.required=: --mac-sign[app-image]\n-error.tool.failed.with.output=: \"{0}\":\n-resource.bundle-config-file=\n+error.multiple.certs.found=[{0}][{1}]\n+error.app-image.mac-sign.required=--mac-sign[app-image]\n+error.tool.failed.with.output=\"{0}\":\n+error.invalid-runtime-image-missing-file=\"{0}\"\"{1}\"\n+error.invalid-runtime-image-bin-dir=\"{0}\"\"bin\"\n+error.invalid-runtime-image-bin-dir.advice={0}--strip-native-commands jlink\n@@ -44,0 +38,1 @@\n+resource.app-runtime-info-plist=JavaInfo.plist\n@@ -59,1 +54,0 @@\n-\n@@ -65,5 +59,1 @@\n-message.creating-association-with-null-extension=null\n-message.ignoring.symlink=: codesignsymlink {0}\n-message.already.signed=: {0}\n-message.keychain.error=: \n-message.building-bundle={0}Mac App Store\n+message.keychain.error=\n@@ -73,1 +63,0 @@\n-message.running-script=[{0}]\n@@ -87,0 +76,2 @@\n+warning.non.standard.contents.sub.dir=: --app-content\"{0}\"\"Contents\"\/\n+warning.app.content.is.not.dir=: --app-content\"{0}\"()\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/resources\/MacResources_ja.properties","additions":11,"deletions":20,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -26,6 +26,0 @@\n-\n-app.bundler.name=Mac \n-store.bundler.name= Mac App Store \n-dmg.bundler.name=Mac DMG \n-pkg.bundler.name=Mac PKG \n-\n@@ -35,3 +29,1 @@\n-error.must-sign-app-store=Mac App Store , \n-error.must-sign-app-store.advice= --mac-sign \n-error.certificate.expired=:  {0}\n+error.certificate.expired= {0}\n@@ -39,4 +31,6 @@\n-error.multiple.certs.found= [{1}]  [{0}] \n-error.app-image.mac-sign.required= [app image]  --mac-sign \n-error.tool.failed.with.output=\"{0}\" \n-resource.bundle-config-file=\n+error.multiple.certs.found= [{1}]  [{0}] \n+error.app-image.mac-sign.required= [app-image]  --mac-sign \n+error.tool.failed.with.output=\"{0}\" \n+error.invalid-runtime-image-missing-file= \"{0}\"  \"{1}\" \n+error.invalid-runtime-image-bin-dir= \"{0}\"  \"bin\" \n+error.invalid-runtime-image-bin-dir.advice= {0}  --strip-native-commands jlink \n@@ -44,0 +38,1 @@\n+resource.app-runtime-info-plist= Java  Info.plist\n@@ -59,1 +54,0 @@\n-\n@@ -65,6 +59,2 @@\n-message.creating-association-with-null-extension=\n-message.ignoring.symlink=: codesign  {0}\n-message.already.signed={0}\n-message.keychain.error=\n-message.building-bundle= {0}  Mac App Store \n-message.invalid-identifier= Mac  [{0}]\n+message.keychain.error=\n+message.invalid-identifier=mac  [{0}] \n@@ -73,1 +63,0 @@\n-message.running-script= [{0}]  shell \n@@ -87,0 +76,2 @@\n+warning.non.standard.contents.sub.dir= --app-content  \"{0}\"  \"Contents\" \/\n+warning.app.content.is.not.dir=--app-content  \"{0}\" \/\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/resources\/MacResources_zh_CN.properties","additions":12,"deletions":21,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -201,1 +201,1 @@\n-            throw ExceptionBox.rethrowUnchecked(ex);\n+            throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/AppImageFile.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -511,1 +511,1 @@\n-            throw ExceptionBox.rethrowUnchecked(ex);\n+            throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/PackagingPipeline.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import java.io.PrintStream;\n@@ -50,0 +51,1 @@\n+import jdk.jpackage.internal.util.Slot;\n@@ -68,0 +70,15 @@\n+\n+        @Override\n+        public int run(PrintStream out, PrintStream err, String... args) {\n+            PrintWriter outWriter = new PrintWriter(out, true);\n+            PrintWriter errWriter = new PrintWriter(err, true);\n+            try {\n+                try {\n+                    return run(outWriter, errWriter, args);\n+                } finally {\n+                    outWriter.flush();\n+                }\n+            } finally {\n+                errWriter.flush();\n+            }\n+        }\n@@ -81,0 +98,4 @@\n+        Objects.requireNonNull(args);\n+        for (String arg : args) {\n+            Objects.requireNonNull(arg);\n+        }\n@@ -86,0 +107,6 @@\n+        final var runner = new Runner(t -> {\n+            new ErrorReporter(_ -> {\n+                t.printStackTrace(err);\n+            }, Log::fatalError, Log.isVerbose()).reportError(t);\n+        });\n+\n@@ -87,7 +114,15 @@\n-            try {\n-                args = CommandLine.parse(args);\n-            } catch (FileNotFoundException|NoSuchFileException ex) {\n-                Log.fatalError(I18N.format(\"ERR_CannotParseOptions\", ex.getMessage()));\n-                return 1;\n-            } catch (IOException ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            var mappedArgs = Slot.<String[]>createEmpty();\n+\n+            int preprocessStatus = runner.run(() -> {\n+                try {\n+                    mappedArgs.set(CommandLine.parse(args));\n+                    return List.of();\n+                } catch (FileNotFoundException | NoSuchFileException ex) {\n+                    return List.of(new JPackageException(I18N.format(\"ERR_CannotParseOptions\", ex.getMessage()), ex));\n+                } catch (IOException ex) {\n+                    return List.of(ex);\n+                }\n+            });\n+\n+            if (preprocessStatus != 0) {\n+                return preprocessStatus;\n@@ -99,1 +134,1 @@\n-            final var parseResult = Utils.buildParser(OperatingSystem.current(), bundlingEnv).create().apply(args);\n+            final var parseResult = Utils.buildParser(OperatingSystem.current(), bundlingEnv).create().apply(mappedArgs.get());\n@@ -101,1 +136,1 @@\n-            return new Runner().run(() -> {\n+            return runner.run(() -> {\n@@ -147,2 +182,20 @@\n-\n-    record ErrorReporter(Consumer<Throwable> stackTracePrinter, Consumer<String> messagePrinter) {\n+    \/*\n+     * Exception (error) reporting:\n+     *\n+     * There are two types of exceptions to handle:\n+     *\n+     * 1. Exceptions explicitly thrown by jpackage code with localized,\n+     *    jpackage-specific error messages. These are usually instances of\n+     *    JPackageException.\n+     *\n+     * 2. Exceptions thrown by JDK code (for example, an NPE from Optional.of(...)).\n+     *    These should normally not occur or should be handled at the point\n+     *    where they arise. If they reach this level of exception handling,\n+     *    it indicates a flaw in jpackages internal logic.\n+     *\n+     * Always print stack traces for exceptions of type #2.\n+     * Print stack traces for exceptions of type #1 only in verbose mode.\n+     * Always print the messages for exceptions of any type.\n+     *\/\n+\n+    record ErrorReporter(Consumer<Throwable> stackTracePrinter, Consumer<String> messagePrinter, boolean verbose) {\n@@ -154,0 +207,4 @@\n+        ErrorReporter(Consumer<Throwable> stackTracePrinter, Consumer<String> messagePrinter) {\n+            this(stackTracePrinter, messagePrinter, true);\n+        }\n+\n@@ -167,1 +224,5 @@\n-            stackTracePrinter.accept(t);\n+            var isAlienException = isAlienExceptionType(t);\n+\n+            if (isAlienException || verbose) {\n+                stackTracePrinter.accept(t);\n+            }\n@@ -170,1 +231,1 @@\n-            if (isAlienExceptionType(t)) {\n+            if (isAlienException) {\n@@ -199,1 +260,5 @@\n-    static final class Runner {\n+    record Runner(Consumer<Throwable> errorReporter) {\n+\n+        Runner {\n+            Objects.requireNonNull(errorReporter);\n+        }\n@@ -206,2 +271,1 @@\n-                var errorReporter = new ErrorReporter(Log::verbose, Log::fatalError);\n-                exceptions.forEach(errorReporter::reportError);\n+                exceptions.forEach(errorReporter);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/Main.java","additions":80,"deletions":16,"binary":false,"changes":96,"status":"modified"},{"patch":"@@ -90,1 +90,1 @@\n-        final var analyzerResult = Result.create(() -> new OptionsAnalyzer(untypedOptions, bundlingEnv));\n+        final var analyzerResult = Result.of(() -> new OptionsAnalyzer(untypedOptions, bundlingEnv));\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/cli\/OptionsProcessor.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,16 +27,160 @@\n-MSG_Help=Verwendung: jpackage <Optionen>\\n\\nBeispielverwendungen:\\n--------------\\n    Generiert ein fr das Hostsystem geeignetes Anwendungspackage:\\n        Fr eine modulare Anwendung:\\n            jpackage -n name -p modulePath -m moduleName\/className\\n        Fr eine nicht modulare Anwendung:\\n            jpackage -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        Aus einem vorab erstellten Anwendungsimage:\\n            jpackage -n name --app-image appImageDir\\n    Generiert ein Anwendungsimage:\\n        Fr eine modulare Anwendung:\\n            jpackage --type app-image -n name -p modulePath \\\\\\n                -m moduleName\/className\\n        Fr eine nicht modulare Anwendung:\\n            jpackage --type app-image -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        Um eigene Optionen fr jlink anzugeben, fhren Sie jlink separat aus:\\n            jlink --output appRuntimeImage -p modulePath \\\\\\n                --add-modules moduleName \\\\\\n                --no-header-files [<zustzliche jlink-Optionen>...]\\n            jpackage --type app-image -n name \\\\\\n                -m moduleName\/className --runtime-image appRuntimeImage\\n    Generiert ein Java Runtime-Package:\\n        jpackage -n name --runtime-image <Laufzeitimage>\\n{6}\\nAllgemeine Optionen:\\n  @<Dateiname > \\n          Liest Optionen und\/oder Modus aus einer Datei \\n          Diese Option kann mehrmals verwendet werden.\\n  --type -t <Typ> \\n          Der zu erstellende Packagetyp\\n          Gltige Werte: {1} \\n          Bei fehlender Angabe dieser Option wird ein plattformabhngiger\\n          Standardtyp erstellt.\\n  --app-version <Version>\\n          Version der Anwendung und\/oder des Packages\\n  --copyright <Copyright-Zeichenfolge>\\n          Copyright fr die Anwendung\\n  --description <Zeichenfolge fr Beschreibung>\\n          Beschreibung der Anwendung\\n  --help -h \\n          Gibt den Verwendungstext mit einer Liste und Beschreibung jeder gltigen\\n          Option fr die aktuelle Plattform an den Ausgabestream aus und beendet den Vorgang\\n  --icon <Dateipfad>\\n          Pfad des Symbols fr das Anwendungspackage\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n  --name -n <Name>\\n          Name der Anwendung und\/oder des Packages\\n  --dest -d <Zielpfad>\\n          Pfad, in den die generierte Ausgabedatei abgelegt wird\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n          Standardmig wird das aktuelle Arbeitsverzeichnis verwendet.\\n  --temp <Verzeichnispfad>\\n          Pfad eines neuen oder leeren Verzeichnisses zum Erstellen temporrer Dateien\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n          Falls angegeben, wird das temporre Verzeichnis beim Abschlieen der Aufgabe\\n          nicht entfernt und muss manuell entfernt werden.\\n          Bei fehlender Angabe wird ein temporres Verzeichnis erstellt und\\n          beim Abschlieen der Aufgabe entfernt.\\n  --vendor <Zeichenfolge fr Anbieter>\\n          Anbieter der Anwendung\\n  --verbose\\n          Aktiviert Ausgabe im Verbose-Modus\\n  --version\\n          Gibt die Produktversion an den Outputstream aus und beendet den Vorgang.\\n\\nOptionen fr das Erstellen des Laufzeitimages:\\n  --add-modules <Modulname>[,<Modulname>...]\\n          Eine per Komma (\",\") getrennte Liste hinzuzufgender Module\\n          Diese Modulliste wird zusammen mit dem Hauptmodul (sofern angegeben)\\n          als Argument --add-module an jlink bergeben.\\n          Bei fehlender Angabe wird entweder nur das Hauptmodul (sofern --module\\n          angegeben ist) oder das Standardset an Modulen (sofern --main-jar \\n          angegeben ist) verwendet.\\n          Diese Option kann mehrmals verwendet werden.\\n  --module-path -p <Modulpfad>...\\n          \\\n-Eine per {0} getrennte Pfadliste\\n          Jeder Pfad ist entweder ein Verzeichnis mit Modulen oder der Pfad zu einer\\n          JAR-Datei eines Moduls.\\n          (Jeder Pfad ist absolut oder relativ zum aktuellen Verzeichnis.)\\n          Diese Option kann mehrmals verwendet werden.\\n  --jlink-options <jlink-Optionen> \\n          Eine per Leerzeichen getrennte Liste mit an jlink zu bergebenden Optionen \\n          Bei fehlender Angabe wird standardmig \"--strip-native-commands \\n          --strip-debug --no-man-pages --no-header-files\" verwendet. \\n          Diese Option kann mehrmals verwendet werden.\\n  --runtime-image <Verzeichnispfad>\\n          Pfad des vordefinierten Laufzeitimages, das in\\n          das Anwendungsimage kopiert wird\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n          Wenn --runtime-image nicht angegeben wird, fhrt jpackage jlink aus, um\\n          das Laufzeitimage mit folgenden Optionen zu erstellen:\\n          --strip-debug, --no-header-files, --no-man-pages und\\n          --strip-native-commands.\\n\\nOptionen fr das Erstellen des Anwendungsimages:\\n  --input -i <Verzeichnispfad>\\n          Pfad des Eingabeverzeichnisses mit den zu verpackenden Dateien\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n          Alle Dateien im Eingabeverzeichnis werden verpackt fr das\\n          Anwendungsimage integriert.\\n  --app-content <zustzlicher Inhalt>[,<zustzlicher Inhalt>...]\\n          Eine per Komma getrennte Liste mit Pfaden zu Dateien und\/oder Verzeichnissen,\\n          die zur Anwendungs-Payload hinzugefgt werden sollen.\\n          Diese Option kann mehrmals verwendet werden.\\n\\nOptionen fr das Erstellen des Anwendungs-Launchers:\\n  --add-launcher <Launcher-Name>=<Dateipfad>\\n          Name des Launchers sowie ein Pfad zu einer Eigenschaftendatei mit\\n          einer Liste von Schlssel\/Wert-Paaren\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n          Die Schlssel \"module\", \"main-jar\", \"main-class\", \"description\",\\n          \"arguments\", \"java-options\", \"app-version\", \"icon\",\\n          \"launcher-as-service\",\\n          \"win-console\", \"win-shortcut\", \"win-menu\",\\n          \"linux-app-category\" und \"linux-shortcut\" knnen verwendet werden.\\n          Diese Optionen werden den ursprnglichen Befehlszeilenoptionen hinzugefgt\\n          (oder berschreiben diese), um einen zustzlichen, alternativen Launcher zu erstellen.\\n          Der Hauptanwendungs-Launcher wird aus den Befehlszeilenoptionen\\n          erstellt. Mit dieser Option knnen zustzliche alternative Launcher\\n          erstellt werden. Auerdem kann diese Option mehrmals verwendet werden,\\n          um mehrere zustzliche Launcher zu erstellen. \\n  --arguments <Hauptklassenargumente>\\n          Befehlszeilenargumente, die an die Hauptklasse bergeben werden, falls\\n          keine Befehlszeilenargumente an den Launcher bergeben werden\\n          Diese Option kann mehrmals verwendet werden.\\n  --java-options <Java-Optionen>\\n          Optionen, die an Java Runtime bergeben werden\\n          Diese Option kann mehrmals verwendet werden.\\n  --main-class <Klassenname>\\n          Qualifizierter Name der auszufhrenden Anwendungshauptklasse\\n          Diese Option kann nur bei Angabe von --main-jar verwendet werden.\\n  --main-jar <Haupt-JAR-Datei>\\n          Die Haupt-JAR-Datei der Anwendung, die die Hauptklasse enthlt\\n          (angegeben als Pfad relativ zum Eingabepfad)\\n          Es kann entweder die Option --module oder die Option --main-jar angegeben werden, nicht jedoch\\n          beides.\\n  --module -m <Modulname>[\/<Hauptklasse>]\\n          Das Hauptmodul (und optional die Hauptklasse) der Anwendung\\n          Dieses Modul muss unter dem Modulpfad gespeichert sein.\\n          Bei Angabe dieser Option wird das Hauptmodul\\n          \\\n-im Java Runtime-Image verknpft. Es kann entweder die Option --module oder die Option --main-jar\\n          angegeben werden, nicht jedoch beides.\\n{2}\\nOptionen fr das Erstellen des Anwendungspackages:\\n  --about-url <URL>\\n          URL der Homepage der Anwendung\\n  --app-image <Verzeichnispfad>\\n          {5}          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n  --file-associations <Dateipfad>\\n          Pfad zu einer Eigenschaftendatei mit einer Liste von Schlssel\/Wert-Paaren\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n          Mit den Schlsseln \"extension\", \"mime-type\", \"icon\" und \"description\"\\n          kann die Verknpfung beschrieben werden.\\n          Diese Option kann mehrmals verwendet werden.\\n  --install-dir <Verzeichnispfad>\\n          {4}  --license-file <Dateipfad>\\n          Pfad zur Lizenzdatei\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n  --resource-dir <Verzeichnispfad>\\n          Pfad zum berschreiben von jpackage-Ressourcen\\n          Symbole, Vorlagendateien und weitere Ressourcen von jpackage knnen\\n          durch Hinzufgen von Ersetzungsressourcen zu diesem Verzeichnis berschrieben werden.\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n  --runtime-image <Verzeichnispfad>\\n          Pfad des zu installierenden vordefinierten Laufzeitimages\\n          (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n          Option muss beim Erstellen eines Laufzeitpackages angegeben werden.\\n  --launcher-as-service\\n          Anforderung zum Erstellen eines Installationsprogramms, das den\\n          Hauptanwendungs-Launcher als Hintergrundserviceanwendung registriert.\\n\\nPlattformabhngige Optionen fr das Erstellen des Anwendungspackages:\\n{3}\n-\n-MSG_Help_win_launcher=\\nPlattformabhngige Option fr das Erstellen des Anwendungs-Launchers:\\n  --win-console\\n          Erstellt einen Konsolen-Launcher fr die Anwendung. Sollte fr\\n          Anwendungen angegeben werden, die Konsoleninteraktionen erfordern\\n\n-MSG_Help_win_install=\\  --win-dir-chooser\\n          Fgt ein Dialogfeld hinzu, in dem der Benutzer das Verzeichnis auswhlen kann, in dem\\n          das Produkt installiert wird.\\n  --win-help-url <URL>\\n          URL, unter der der Benutzer weitere Informationen oder technische Untersttzung erhlt\\n  --win-menu\\n          Anforderung zum Hinzufgen einer Startmenverknpfung fr diese Anwendung\\n  --win-menu-group <Mengruppenname>\\n          Startmengruppe, in der diese Anwendung abgelegt wird\\n  --win-per-user-install\\n          Anforderung zum Ausfhren einer Installation pro Benutzer\\n  --win-shortcut\\n          Anforderung zum Hinzufgen einer Desktopverknpfung fr diese Anwendung\\n  --win-shortcut-prompt\\n          Fgt ein Dialogfeld hinzu, in dem der Benutzer auswhlen kann, ob Verknpfungen\\n          vom Installationsprogramm erstellt werden sollen.\\n  --win-update-url <URL>\\n          URL verfgbarer Anwendungsupdateinformationen\\n  --win-upgrade-uuid <ID-Zeichenfolge>\\n          UUID, die mit Upgrades fr dieses Package verknpft ist\\n\n-MSG_Help_win_install_dir=Relativer Unterpfad unter dem Standardinstallationsverzeichnis\\n\n-MSG_Help_mac_install=\\  --mac-dmg-content <Pfad zu zustzlichem Inhalt>[,<Pfad zu zustzlichem Inhalt>...]\\n          Nimmt den gesamten referenzierten Inhalt in die DMG-Datei auf.\\n          Diese Option kann mehrmals verwendet werden. \\n\n-MSG_Help_mac_launcher=\\  --mac-package-identifier <ID-Zeichenfolge>\\n          Eine ID, die die Anwendung fr macOS eindeutig identifiziert\\n          Standardwert ist der Hauptklassenname.\\n          Es drfen nur alphanumerische Zeichen (A-Z, a-z, 0-9), Bindestriche (-)\\n          und Punkte (.) verwendet werden.\\n  --mac-package-name <Namenszeichenfolge>\\n          Name der Anwendung, wie in der Menleiste angezeigt\\n          Dieser kann vom Anwendungsnamen abweichen.\\n          Er darf maximal 15 Zeichen enthalten und muss fr die Anzeige\\n          in der Menleiste und im Infofenster der Anwendung geeignet sein.\\n          Standardwert: Anwendungsname.\\n  --mac-package-signing-prefix <Prfixzeichenfolge>\\n          Beim Signieren des Anwendungspackages wird dieser Wert\\n          allen zu signierenden Komponenten ohne vorhandene\\n          Package-ID als Prfix vorangestellt.\\n  --mac-sign\\n          Anforderung zum Signieren des Packages oder des vordefinierten\\nAnwendungsimages\\n  --mac-signing-keychain <Schlsselbundname>\\n          Name des Schlsselbundes fr die Suche nach der Signaturidentitt\\n          Bei fehlender Angabe werden die Standardschlsselbunde verwendet.\\n  --mac-signing-key-user-name <Teamname>\\n          Team- oder Benutzernamensteil der Apple-Signaturidentitten. Um direkt zu steuern,\\n          welche Signaturidentitt zum Signieren eines Anwendungsimages oder\\n          Installationsprogramms verwendet wird, verwenden Sie --mac-app-image-sign-identity und\/oder\\n          --mac-installer-sign-identity. Diese Option kann nicht mit\\n          --mac-app-image-sign-identity oder --mac-installer-sign-identity kombiniert werden.\\n  --mac-app-image-sign-identity <identity>\\n          Zum Signieren des Anwendungsimages verwendete Identitt. Dieser Wert wird\\n          direkt an die Option --sign des Tools \"codesign\" bergeben. Diese Option kann nicht\\n          mit --mac-signing-key-user-name kombiniert werden.\\n  --mac-installer-sign-identity <identity>\\n          Zum Signieren des Installationsprogramms \"pkg\" verwendete Identitt. Dieser Wert wird\\n          direkt an die Option --sign des Tools \"productbuild\" bergeben. Diese Option\\n          kann nicht mit --mac-signing-key-user-name kombiniert werden.\\n  --mac-app-store\\n          Gibt an, dass die jpackage-Ausgabe fr den\\n          Mac App Store bestimmt ist.\\n  --mac-entitlements <Dateipfad>\\n          Pfad zu einer Datei mit Berechtigungen, die beim Signieren\\n          von ausfhrbaren Dateien und Librarys im Bundle verwendet werden sollen.\\n  --mac-app-category <Kategoriezeichenfolge>\\n          Zeichenfolge fr das Erstellen von LSApplicationCategoryType in\\n          Anwendungs-plist. Standardwert: \"utilities\".\\n\n-MSG_Help_linux_install=\\  --linux-package-name <Packagename>\\n          Name fr das Linux-Package, Standardwert: Anwendungsname\\n  --linux-deb-maintainer <E-Mail-Adresse>\\n          Maintainer fr .deb-Package\\n  --linux-menu-group <Mengruppenname>\\n          Mengruppe, in der diese Anwendung abgelegt wird\\n  --linux-package-deps <package-dep-string>\\n          Erforderliche Packages oder Funktionen fr die Anwendung\\n  --linux-rpm-license-type <Typzeichenfolge>\\n          Typ der Lizenz (\"License: <Wert>\" der RPM-SPEC-Datei)\\n  --linux-app-release <Releasewert>\\n          Releasewert der RPM-Datei <Name>.spec oder \\n          Debian-Revisionswert der DEB-Kontrolldatei\\n  --linux-app-category <Kategoriewert>\\n          Gruppenwert der RPM-Datei <Name>.spec oder \\n          Abschnittswert der DEB-Kontrolldatei\\n  --linux-shortcut\\n          Erstellt einen Shortcut fr die Anwendung.\\n\n-MSG_Help_mac_linux_install_dir=Absoluter Pfad des Installationsverzeichnisses der Anwendung\\n\n-MSG_Help_default_install_dir=Absoluter Pfad des Installationsverzeichnisses der Anwendung auf OS X\\n          oder Linux. Relativer Unterpfad des Installationsverzeichnisses der\\n          Anwendung wie \"Programme\" oder \"AppData\" unter Windows.\\n\n-MSG_Help_no_args=Verwendung: jpackage <Optionen>\\nVerwenden Sie jpackage --help (oder -h), um eine Liste mglicher Optionen aufzurufen\n-MSG_Help_default_app_image=Speicherort des vordefinierten Anwendungsimages, mit dem\\n          ein installierbares Package erstellt wird\\n\n-MSG_Help_mac_app_image=Speicherort des vordefinierten Anwendungsimages, mit dem\\n          ein installierbares Package erstellt oder das vordefinierte\\n          Anwendungsimage signiert wird\\n\n-MSG_Help_mac_sign_sample_usage=\\    Vordefiniertes Anwendungsimage signieren:\\n        jpackage --type app-image --app-image <app-image> \\\\\\n            --mac-sign [<additional signing options>...]\\n        Hinweis: In diesem Modus sind nur die folgenden zustzlichen Optionen zulssig:\\n              Das Set der zustzlichen Mac-Signaturoptionen und --verbose\\n\n+help.header=Verwendung: jpackage <Optionen>\n+\n+help.short=Verwenden Sie jpackage --help (oder -h), um eine Liste mglicher Optionen aufzurufen\n+\n+help.option-group.sample.create-native-package=\\    Generieren Sie ein Anwendungspackage, das fr das Hostsystem geeignet ist:\\n        Fr eine modulare Anwendung:\\n            jpackage -n name -p modulePath -m moduleName\/className\\n        Fr eine nicht modulare Anwendung:\\n            jpackage -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        Aus einem vordefinierten Anwendungsimage:\\n            jpackage -n name --app-image appImageDir\n+\n+help.option-group.sample.create-app-image=\\    Generieren Sie ein Anwendungspackage:\\n        Fr eine modulare Anwendung:\\n            jpackage --type app-image -n name -p modulePath \\\\\\n                -m moduleName\/className\\n        Fr eine nicht modulare Anwendung:\\n            jpackage --type app-image -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        Um eigene Optionen fr jlink anzugeben, fhren Sie jlink separat aus:\\n            jlink --output appRuntimeImage -p modulePath \\\\\\n                --add-modules moduleName \\\\\\n                --no-header-files [<zustzliche jlink-Optionen>...]\\n            jpackage --type app-image -n name \\\\\\n                -m moduleName\/className --runtime-image appRuntimeImage\n+\n+help.option-group.sample.create-runtime-installer=\\    Generieren Sie ein Java-Laufzeitpackage:\\n        jpackage -n name --runtime-image <Laufzeitimage>\n+\n+help.option-group.sample.sign-app-image=\\    Vordefiniertes Anwendungsimage signieren:\\n        jpackage --type app-image --app-image <app-image> \\\\\\n            --mac-sign [<additional signing options>...]\\n        Hinweis: In diesem Modus sind nur die folgenden zustzlichen Optionen zulssig:\\n              Das Set der zustzlichen Mac-Signaturoptionen und --verbose\n+\n+help.option-group.sample=Beispielverwendungen\n+help.option-group.generic=Allgemeine Optionen\n+help.option-group.runtime-image=Optionen fr das Erstellen des Laufzeitimages\n+help.option-group.app-image=Optionen fr das Erstellen des Anwendungsimages\n+help.option-group.launcher=Optionen fr das Erstellen der Anwendungslauncher:\n+help.option-group.launcher-platform=Plattformabhngige Option fr das Erstellen des Anwendungslaunchers\n+help.option-group.package=Optionen fr das Erstellen des Anwendungspackages\n+help.option-group.package-platform=Plattformabhngige Optionen fr das Erstellen des Anwendungspackages\n+\n+help.option.argument-file=\\          Leseoptionen und\/oder -modus aus einer Datei\\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.about-url=\\          URL der Homepage der Anwendung\n+\n+help.option.add-launcher.win=\\          Name des Launchers sowie ein Pfad zu einer Eigenschaftendatei mit\\n         einer Liste von Schlssel\/Wert-Paaren\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Die Schlssel \"arguments\", \"description\", \"icon\", \"java-options\",\\n        \"launcher-as-service\", \"main-class\", \"main-jar\", \"module\",\\n        \"win-console\", \"win-menu\" und \"win-shortcut\" knnen verwendet werden. \\n        Diese Optionen werden den ursprnglichen\\n        Befehlszeilenoptionen hinzugefgt (oder berschreiben diese), um einen zustzlichen, alternativen Launcher zu erstellen.\\n        Der Hauptanwendungslauncher wird aus den Befehlszeilenoptionen\\n        erstellt. Mit dieser Option knnen zustzliche alternative Launcher\\n         erstellt werden. Auerdem kann diese Option mehrmals verwendet werden,\\n        um mehrere zustzliche Launcher zu erstellen.\n+\n+help.option.add-launcher.linux=\\          Name des Launchers sowie ein Pfad zu einer Eigenschaftendatei mit\\n         einer Liste von Schlssel\/Wert-Paaren\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Die Schlssel \"arguments\", \"description\", \"icon\", \"java-options\",\\n        \"launcher-as-service\", \"linux-shortcut\", \"main-class\", \"main-jar\"\\n        und \"module\" knnen verwendet werden. \\n        Diese Optionen werden den ursprnglichen Befehlszeilenoptionen hinzugefgt\\n        (oder berschreiben diese), um einen zustzlichen, alternativen Launcher zu erstellen. \\n        Der Hauptanwendungslauncher wird aus den Befehlszeilenoptionen\\n        erstellt. Mit dieser Option knnen zustzliche alternative Launcher\\n         erstellt werden. Auerdem kann diese Option mehrmals verwendet werden,\\n        um mehrere zustzliche Launcher zu erstellen.\n+\n+help.option.add-launcher.mac=\\          Name des Launchers sowie ein Pfad zu einer Eigenschaftendatei mit\\n         einer Liste von Schlssel\/Wert-Paaren\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Die Schlssel \"arguments\", \"description\", \"icon\", \"java-options\",\\n        \"launcher-as-service\", \"main-class\", \"main-jar\"\\n        und \"module\" knnen verwendet werden. \\n        Diese Optionen werden den ursprnglichen Befehlszeilenoptionen hinzugefgt\\n        (oder berschreiben diese), um einen zustzlichen, alternativen Launcher zu erstellen. \\n        Der Hauptanwendungslauncher wird aus den Befehlszeilenoptionen\\n        erstellt. Mit dieser Option knnen zustzliche alternative Launcher\\n         erstellt werden. Auerdem kann diese Option mehrmals verwendet werden,\\n        um mehrere zustzliche Launcher zu erstellen.\n+\n+help.option.add-modules=\\          Eine per Komma (\",\") getrennte Liste hinzuzufgender Module\\n        Diese Modulliste wird zusammen mit dem Hauptmodul (sofern angegeben)\\n        als Argument --add-module an jlink bergeben. \\n        Bei fehlender Angabe wird entweder nur das Hauptmodul (sofern --module\\n         angegeben ist) oder das Standardset an Modulen (sofern --main-jar\\n         angegeben ist) verwendet. \\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.app-content=\\          Eine per Komma getrennte Liste mit Pfaden zu Dateien und\/oder Verzeichnissen,\\n        die zur Anwendungs-Payload hinzugefgt werden sollen.\\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.app-content.mac=\\          Eine per Komma getrennte Liste mit Pfaden zu Dateien und\/oder Verzeichnissen,\\n        die zur Anwendungs-Payload hinzugefgt werden sollen. \\n        Diese Option kann mehrmals verwendet werden. \\n        Hinweis: Der Wert muss ein Verzeichnis mit dem Unterverzeichnis \"Resources\" sein\\n        Unterverzeichnis (oder ein anderes Verzeichnis, das im Verzeichnis \"Contents\"\\n        des Anwendungs-Bundles gltig ist). Andernfalls produziert jpackage mglicherweise ein\\n        ungltiges Anwendungs-Bundle, bei dem die Codesignatur und\/oder Notarisierung nicht erfolgreich\\n        verluft.\n+\n+help.option.app-image=\\          Speicherort des vordefinierten Anwendungsimages, mit dem\\n        ein installierbares Package erstellt wird\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\n+\n+help.option.app-image.mac=\\          Speicherort des vordefinierten Anwendungsimages, mit dem\\n        ein installierbares Package erstellt oder das vordefinierte\\n        Anwendungsimage signiert wird\\n        (absoluter Pfad bzw. relativ zum aktuellen Verzeichnis)\n+\n+help.option.app-version=\\          Version der Anwendung und\/oder des Packages\n+\n+help.option.arguments=\\          Befehlszeilenargumente, die an die Hauptklasse bergeben werden, falls\\n        keine Befehlszeilenargumente an den Launcher bergeben werden\\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.copyright=\\          Copyright fr die Anwendung\n+\n+help.option.description=\\          Beschreibung der Anwendung\n+\n+help.option.dest=\\          Pfad, in dem die generierte Ausgabedatei abgelegt wird\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Standardmig wird das aktuelle Arbeitsverzeichnis verwendet.\n+\n+help.option.file-associations=\\          Pfad zu einer Eigenschaftendatei mit einer Liste von Schlssel\/Wert-Paaren\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Mit den Schlsseln \"extension\", \"mime-type\", \"icon\" und \"description\"\\n        kann die Verknpfung beschrieben werden.\\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.help=\\          Gibt den Verwendungstext mit einer Liste und Beschreibung jeder gltigen\\n        Option fr die aktuelle Plattform an den Outputstream aus und beendet den Vorgang\n+\n+help.option.icon=\\          Pfad des Symbols fr das Anwendungspackage\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\n+\n+help.option.input=\\          Pfad des Eingabeverzeichnisses mit den zu verpackenden Dateien\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Alle Dateien im Eingabeverzeichnis werden als Package in das\\n        Anwendungsimage integriert.\n+\n+help.option.install-dir=\\          Absoluter Pfad des Installationsverzeichnisses der Anwendung\n+\n+help.option.install-dir.win=\\          Relativer Unterpfad des Installationsverzeichnisses der\\n        Anwendung, wie \"Programme\" oder \"AppData\".\n+\n+help.option.installer-runtime-image=\\          Pfad des zu installierenden vordefinierten Laufzeitimages\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Option muss beim Erstellen eines Laufzeitpackages angegeben werden.\n+\n+help.option.java-options=\\          Optionen, die an Java Runtime bergeben werden\\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.jlink-options=\\          Eine per Leerzeichen getrennte Liste mit an jlink zu bergebenden Optionen\\n        Bei fehlender Angabe wird standardmig \"--strip-native-commands\\n        --strip-debug --no-man-pages --no-header-files\" verwendet. \\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.launcher-as-service=\\          Anforderung zum Erstellen eines Installationsprogramms, das den\\n        Hauptanwendungslauncher als Hintergrundserviceanwendung registriert.\n+\n+help.option.license-file=\\          Pfad zur Lizenzdatei\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\n+\n+help.option.linux-app-category=\\          Gruppenwert der RPM-Datei <Name>.spec oder\\n        Abschnittswert der DEB-Kontrolldatei\n+\n+help.option.linux-app-release=\\          Releasewert der RPM-Datei <Name>.spec oder\\n        Debian-Revisionswert der DEB-Kontrolldatei\n+\n+help.option.linux-deb-maintainer=\\           Maintainer fr DEB-Package\n+\n+help.option.linux-menu-group=\\          Mengruppe, in der diese Anwendung abgelegt wird\n+\n+help.option.linux-package-deps=\\          Erforderliche Packages oder Funktionen fr die Anwendung\n+\n+help.option.linux-package-name=\\          Name fr das Linux-Package, Standardwert: Anwendungsname\n+\n+help.option.linux-rpm-license-type=\\          Lizenztyp (\"Lizenz: <Wert>\" der RPM-SPEC-Datei)\n+\n+help.option.linux-shortcut=\\          Erstellt eine Verknpfung fr die Anwendung.\n+\n+help.option.mac-app-category=\\          Zeichenfolge fr das Erstellen von LSApplicationCategoryType in\\n          Anwendungs-plist. Standardwert: \"utilities\".\n+\n+help.option.mac-app-image-sign-identity=\\          Zum Signieren des Anwendungsimages verwendete Identitt. Dieser Wert wird direkt\\n        an die Option --sign des Tools \"codesign\" bergeben. Diese Option kann nicht\\n        mit --mac-signing-key-user-name kombiniert werden.\n+\n+help.option.mac-app-store=\\          Gibt an, dass die jpackage-Ausgabe fr den\\n        Mac App Store vorgesehen ist.\n+\n+help.option.mac-dmg-content=\\          Nimmt den gesamten referenzierten Inhalt in die DMG-Datei auf.\\n          Diese Option kann mehrmals verwendet werden.\n+\n+help.option.mac-entitlements=\\          Pfad zu einer Datei mit Berechtigungen, die beim Signieren von ausfhrbaren\\n        Dateien und Librarys im Bundle verwendet werden sollen.\n+\n+help.option.mac-installer-sign-identity=\\          Zum Signieren des Installationsprogramms \"pkg\" verwendete Identitt. Dieser Wert wird direkt\\n        an die Option --sign des Tools \"productbuild\"-bergeben. Diese Option\\n        kann nicht mit --mac-signing-key-user-name kombiniert werden.\n+\n+help.option.mac-package-identifier=\\          Eine ID, die die Anwendung fr macOS eindeutig identifiziert\\n        Standardwert ist der Hauptklassenname. \\n        Es drfen nur alphanumerische Zeichen (A-Z, a-z, 0-9), Bindestriche (-)\\n          und Punkte (.) verwendet werden.\n+\n+help.option.mac-package-name=\\          Name der Anwendung, wie in der Menleiste angezeigt\\n          Dieser kann vom Anwendungsnamen abweichen.\\n          Er darf maximal 15 Zeichen enthalten und muss fr die Anzeige\\n          in der Menleiste und im Infofenster der Anwendung geeignet sein.\\n          Standardwert: Anwendungsname.\n+\n+help.option.mac-package-signing-prefix=\\          Beim Signieren des Anwendungspackages wird dieser Wert\\n          allen zu signierenden Komponenten ohne vorhandene\\n          Package-ID als Prfix vorangestellt.\n+\n+help.option.mac-sign=\\          Anforderung zum Signieren des Packages oder des vordefinierten\\n          Anwendungsimages.\n+\n+help.option.mac-signing-keychain=\\          Name des Schlsselbundes fr die Suche nach der Signaturidentitt\\n          Bei fehlender Angabe werden die Standardschlsselbunde verwendet.\n+\n+help.option.mac-signing-key-user-name=\\          Team- oder Benutzernamensteil der Apple-Signaturidentitten. Um direkt zu steuern,\\n          welche Signaturidentitt zum Signieren eines Anwendungsimages oder\\n          Installationsprogramms verwendet wird, verwenden Sie --mac-app-image-sign-identity und\/oder\\n          --mac-installer-sign-identity. Diese Option kann nicht mit\\n          --mac-app-image-sign-identity oder --mac-installer-sign-identity kombiniert werden.\n+\n+help.option.main-class=\\          Qualifizierter Name der auszufhrenden Anwendungshauptklasse\\n        Diese Option kann nur bei Angabe von --main-jar verwendet werden.\n+\n+help.option.main-jar=\\          Die Haupt-JAR-Datei der Anwendung, die die Hauptklasse enthlt\\n        (angegeben als Pfad relativ zum Eingabepfad)\\n        Es kann entweder die Option --module oder die Option --main-jar angegeben werden, nicht jedoch\\n        beides.\n+\n+help.option.module=\\          Das Hauptmodul (und optional die Hauptklasse) der Anwendung\\n        Dieses Modul muss unter dem Modulpfad gespeichert sein. \\n        Bei Angabe dieser Option wird das Hauptmodul\\n        im Java Runtime-Image verknpft. Es kann entweder die Option --module oder die Option --main-jar\\n        angegeben werden, nicht jedoch beides.\n+\n+help.option.module-path=\\          Eine per Doppelpunkt (:) getrennte Pfadliste\\n        Jeder Pfad ist entweder ein Verzeichnis mit Modulen oder der Pfad zu einer\\n        modularen JAR-Datei.\\n        (Jeder Pfad ist absolut oder relativ zum aktuellen Verzeichnis.)\\n        Diese Option kann mehrmals verwendet werden.\n+help.option.module-path.win=\\          Eine per Semikolon (;) getrennte Pfadliste\\n        Jeder Pfad ist entweder ein Verzeichnis mit Modulen oder der Pfad zu einer\\n        modularen JAR-Datei.\\n        (Jeder Pfad ist absolut oder relativ zum aktuellen Verzeichnis.)\\n        Diese Option kann mehrmals verwendet werden.\n+\n+help.option.name=\\          Name der Anwendung und\/oder des Packages\n+\n+help.option.resource-dir=\\          Pfad zum berschreiben von jpackage-Ressourcen\\n        Symbole, Vorlagendateien und weitere Ressourcen von jpackage knnen\\n         durch Hinzufgen von Ersetzungsressourcen zu diesem Verzeichnis berschrieben werden.\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\n+\n+help.option.runtime-image=\\          Pfad des vordefinierten Laufzeitimages, das in\\n        das Anwendungsimage kopiert wird\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Wenn --runtime-image nicht angegeben wird, fhrt jpackage jlink aus, um\\n         das Laufzeitimage mit folgenden Optionen zu erstellen:\\n        --strip-debug, --no-header-files, --no-man-pages und\\n        --strip-native-commands.\n+\n+help.option.temp=\\          Pfad eines neuen oder leeren Verzeichnisses zum Erstellen temporrer Dateien\\n        (absoluter Pfad oder relativ zum aktuellen Verzeichnis)\\n        Falls angegeben, wird das temporre Verzeichnis beim Abschlieen der Aufgabe\\n        nicht entfernt und muss manuell entfernt werden. \\n        Bei fehlender Angabe wird ein temporres Verzeichnis erstellt und\\n        beim Abschlieen der Aufgabe entfernt.\n+\n+help.option.type.win=\\          Der zu erstellende Packagetyp\\n        Gltige Werte sind: {\"app-image\", \"exe\", \"msi\"}\\n        Bei fehlender Angabe dieser Option wird ein plattformabhngiger\\n        Standardtyp erstellt.\n+help.option.type.linux=\\          Der zu erstellende Packagetyp\\n        Gltige Werte sind: {\"app-image\", \"deb\", \"rpm\"}\\n        Bei fehlender Angabe dieser Option wird ein plattformabhngiger\\n        Standardtyp erstellt.\n+help.option.type.mac=\\          Der zu erstellende Packagetyp\\n        Gltige Werte sind: {\"app-image\", \"dmg\", \"pkg\"}\\n        Bei fehlender Angabe dieser Option wird ein plattformabhngiger\\n        Standardtyp erstellt.\n+\n+help.option.vendor=\\          Anbieter der Anwendung\n+\n+help.option.verbose=\\          Aktiviert Ausgabe im Verbose-Modus\n+\n+help.option.version=\\          Gibt die Produktversion an den Outputstream aus und beendet den Vorgang.\n+\n+help.option.win-console=\\          Erstellt einen Konsolenlauncher fr die Anwendung. Sollte fr\\n        Anwendungen angegeben werden, die Konsoleninteraktionen erfordern\n+\n+help.option.win-dir-chooser=\\          Fgt ein Dialogfeld hinzu, in dem der Benutzer das Verzeichnis auswhlen kann, in dem\\n        das Produkt installiert wird.\n+\n+help.option.win-help-url=\\          URL, unter der der Benutzer weitere Informationen oder technische Untersttzung erhlt\n+\n+help.option.win-menu=\\          Anforderung zum Hinzufgen einer Startmenverknpfung fr diese Anwendung\n+\n+help.option.win-menu-group=\\          Startmengruppe, in der diese Anwendung abgelegt wird\n+\n+help.option.win-per-user-install=\\          Anforderung zum Ausfhren einer Installation pro Benutzer\n+\n+help.option.win-shortcut=\\          Anforderung zum Hinzufgen einer Desktopverknpfung fr diese Anwendung\n+\n+help.option.win-shortcut-prompt=\\          Fgt ein Dialogfeld hinzu, in dem der Benutzer auswhlen kann, ob Verknpfungen\\n        vom Installationsprogramm erstellt werden.\n+\n+help.option.win-update-url=\\          URL der verfgbaren Anwendungsaktualisierungsinformationen\n+\n+help.option.win-upgrade-uuid=\\          UUID fr Upgrades fr dieses Package\n+\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/HelpResources_de.properties","additions":161,"deletions":17,"binary":false,"changes":178,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,19 +27,160 @@\n-MSG_Help=: jpackage <options>\\n\\n:\\n--------------\\n    \\n        :\\n            jpackage -n name -p modulePath -m moduleName\/className\\n        :\\n            jpackage -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        :\\n            jpackage -n name --app-image appImageDir\\n    :\\n        :\\n            jpackage --type app-image -n name -p modulePath \\\\\\n                -m moduleName\/className\\n        :\\n            jpackage --type app-image -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        jlinkjlink\\n            jlink --output appRuntimeImage -p modulePath \\\\\\n                --add-modules moduleName \\\\\\n                --no-header-files [<additional jlink options>...]\\n            jpackage --type app-image -n name \\\\\\n                -m moduleName\/className --runtime-image appRuntimeImage\\n    Java\\n        jpackage -n name --runtime-image <runtime-image>\\n{6}\\n:\\n  @<filename> \\n           \\n          \\n  --type -t <type> \\n          \\n          : {1} \\n          \\n          \\n  --app-version <version>\\n          \\n  --copyright <copyright string>\\n          \\n  --description <description string>\\n          \\n  --help -h \\n          \\n          \\n  --icon <file path>\\n          \\n          ()\\n  \\\n---name -n <name>\\n          \\n  --dest -d <destination path>\\n          \\n          ()\\n          \\n  --temp <directory path>\\n          \\n          ()\\n          \\n          \\n          \\n          \\n  --vendor <vendor string>\\n          \\n  --verbose\\n          \\n  --version\\n          \\n\\n:\\n  --add-modules <module name>[,<module name>...]\\n          (\",\")\\n          ()\\n          --add-modulejlink\\n          (--module\\n          )(--main-jar \\n          )\\n          \\n  --module-path -p <module path>...\\n          {0}\\n          \\n          jar\\n          ()\\n          \\n  --jlink-options <jlink options> \\n          jlink \\n          \"--strip-native-commands \\n          --strip-debug \\\n---no-man-pages --no-header-files\" \\n          \\n  --runtime-image <directory path>\\n          \\n          \\n          ()\\n          --runtime-imagejpackagejlink\\n          :\\n          --strip-debug--no-header-files--no-man-pages\\n          --strip-native-commands\\n\\n:\\n  --input -i <directory path>\\n          \\n          ()\\n          \\n          \\n  --app-content <additional content>[,<additional content>...]\\n          ()\\n          \\n          \\n\\n:\\n  --add-launcher <launcher name>=<file path>\\n          \\n          \\n          ()\\n          \"module\"\"main-jar\"\"main-class\"\"description\"\\n          \"arguments\"\"java-options\"\"app-version\"\"icon\"\\n          \"launcher-as-service\"\\n          \"win-console\"\"win-shortcut\"\"win-menu\"\\n          \"linux-app-category\"\"linux-shortcut\"\\n          \\n          \\n          \\\n-\\n          \\n          \\n           \\n  --arguments <main class arguments>\\n          \\n          \\n          \\n  --java-options <java options>\\n          Java\\n          \\n  --main-class <class name>\\n          \\n          --main-jar\\n  --main-jar <main jar file>\\n          JAR\\n          ()\\n          --module--main-jar\\n          \\n  --module -m <module name>[\/<main class>]\\n          ()\\n          \\n          \\n          Java--module--main-jar\\n          \\n{2}\\n:\\n  --about-url <url>\\n          URL\\n  --app-image <directory path>\\n          {5}          ()\\n  --file-associations <file path>\\n          \\n          \\\n-()\\n          \"extension\"\"mime-type\"\"icon\"\"description\"\\n          \\n          \\n  --install-dir <directory path>\\n          {4}  --license-file <file path>\\n          \\n          ()\\n  --resource-dir <directory path>\\n          jpackage\\n          jpackage\\n          \\n          ()\\n  --runtime-image <directory path>\\n          \\n          ()\\n          \\n  --launcher-as-service\\n          : \\n          \\n\\n:\\n{3}\n-\n-MSG_Help_win_launcher=\\n:\\n  --win-console\\n          \\n          \\n\n-MSG_Help_win_install=\\  --win-dir-chooser\\n          \\n          \\n  --win-help-url <url>\\n          URL\\n  --win-menu\\n          \\n  --win-menu-group <menu group name>\\n          \\n  --win-per-user-install\\n          \\n  --win-shortcut\\n          \\n  --win-shortcut-prompt\\n          \\n          \\n  --win-update-url <url>\\n          URL\\n  --win-upgrade-uuid <id string>\\n          UUID\\n\n-MSG_Help_win_install_dir=\\n\n-MSG_Help_mac_install=\\  --mac-dmg-content <additional content path>[,<additional content path>...]\\n          dmg\\n           \\n\n-MSG_Help_mac_launcher=\\  --mac-package-identifier <ID string>\\n          macOSID\\n          \\n          (A-Za-z0-9)(-)(.)\\n          \\n  --mac-package-name <name string>\\n          \\n          \\n          16\\n          \\n          \\n  --mac-package-signing-prefix <prefix string>\\n          \\n          ID\\n          \\n  --mac-sign\\n          \\n          \\n  --mac-signing-keychain <keychain name>\\n          \\n          \\n  --mac-signing-key-user-name <team name>\\n          Apple\\n          \\n          --mac-app-image-sign-identity\\n          --mac-installer-sign-identity()\\n          --mac-app-image-sign-identity--mac-installer-sign-identity\\n  --mac-app-image-sign-identity <identity>\\n          \\n          \"codesign\"--sign\\n          \\\n---mac-signing-key-user-name\\n  --mac-installer-sign-identity <identity>\\n          \"pkg\"\\n          \"productbuild\"--sign\\n          --mac-signing-key-user-name\\n  --mac-app-store\\n          jpackageMac App Store\\n          \\n  --mac-entitlements <file path>\\n          \\n          \\n  --mac-app-category <category string>\\n          plistLSApplicationCategoryType\\n          \"utilities\"\\n\n-MSG_Help_linux_install=\\  --linux-package-name <package name>\\n          Linux\\n  --linux-deb-maintainer <email address>\\n          .debMaintainer\\n  --linux-menu-group <menu-group-name>\\n          \\n  --linux-package-deps <package-dep-string>\\n          \\n  --linux-rpm-license-type <type string>\\n          (RPM .spec\"License: <value>\")\\n  --linux-app-release <release value>\\n          RPM <name>.spec\\n          DEBDebian\\n  --linux-app-category <category value>\\n          RPM <name>.spec \\n           DEB\\n  --linux-shortcut\\n          \\n\n-MSG_Help_mac_linux_install_dir=\\n\n-MSG_Help_default_install_dir=OS XLinux\\n          \"\"\"AppData\"Windows\\n          \\n\n-MSG_Help_no_args=: jpackage <options>\\njpackage --help (or -h)\n-MSG_Help_default_app_image=\\n          \\n\n-MSG_Help_mac_app_image=\\n          \\n          \\n\n-MSG_Help_mac_sign_sample_usage=\\    :\\n        jpackage --type app-image --app-image <app-image> \\\\\\n            --mac-sign [<additional signing options>...]\\n        : :\\n              mac--verbose\\n\n+help.header=: jpackage <options>\n+\n+help.short=jpackage --help (or -h)\n+\n+help.option-group.sample.create-native-package=\\    :\\n        :\\n            jpackage -n name -p modulePath -m moduleName\/className\\n        :\\n            jpackage -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        :\\n            jpackage -n name --app-image appImageDir\n+\n+help.option-group.sample.create-app-image=\\    :\\n        :\\n            jpackage --type app-image -n name -p modulePath \\\\\\n                -m moduleName\/className\\n        :\\n            jpackage --type app-image -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        jlinkjlink:\\n            jlink --output appRuntimeImage -p modulePath \\\\\\n                --add-modules moduleName \\\\\\n                --no-header-files [<additional jlink options>...]\\n            jpackage --type app-image -n name \\\\\\n                -m moduleName\/className --runtime-image appRuntimeImage\n+\n+help.option-group.sample.create-runtime-installer=\\    Java:\\n        jpackage -n name --runtime-image <runtime-image>\n+\n+help.option-group.sample.sign-app-image=\\    :\\n        jpackage --type app-image --app-image <app-image> \\\\\\n            --mac-sign [<additional signing options>...]\\n        : :\\n              mac--verbose\n+\n+help.option-group.sample=\n+help.option-group.generic=\n+help.option-group.runtime-image=\n+help.option-group.app-image=\n+help.option-group.launcher=\n+help.option-group.launcher-platform=\n+help.option-group.package=\n+help.option-group.package-platform=\n+\n+help.option.argument-file=\\          ()\\n          \n+\n+help.option.about-url=\\          URL\n+\n+help.option.add-launcher.win=\\          \\n          \\n          ()\\n          \"arguments\"\"description\"\"icon\"\"java-options\"\\n          \"launcher-as-service\"\"main-class\"\"main-jar\"\"module\"\\n          \"win-console\"\"win-menu\"\"win-shortcut\"\\n          \\n          \\n          \\n          \\n          \\n          \n+\n+help.option.add-launcher.linux=\\          \\n          \\n          ()\\n          \"arguments\"\"description\"\"icon\"\"java-options\"\\n          \"launcher-as-service\"\"linux-shortcut\"\"main-class\"\"main-jar\"\\n          \"module\"\\n          \\n          \\n          \\n          \\n          \\n          \n+\n+help.option.add-launcher.mac=\\          \\n          \\n          ()\\n          \"arguments\"\"description\"\"icon\"\"java-options\"\\n          \"launcher-as-service\"\"main-class\"\"main-jar\"\"module\"\\n          \\n          \\n          \\n          \\n          \\n          \\n          \n+\n+help.option.add-modules=\\          (\",\")\\n          ()\\n          --add-modulejlink\\n          (--module\\n          )(--main-jar\\n          )\\n          \n+\n+help.option.app-content=\\          ()\\n          \\n          \n+\n+help.option.app-content.mac=\\          ()\\n          \\n          \\n          : \"Resources\"\\n          (\"Contents\")\\n          jpackage\\n          ()\\n          \n+\n+help.option.app-image=\\          \\n          \\n          ()\n+\n+help.option.app-image.mac=\\          \\n          \\n          \\n          ()\n+\n+help.option.app-version=\\          \n+\n+help.option.arguments=\\          \\n          \\n          \n+\n+help.option.copyright=\\          \n+\n+help.option.description=\\          \n+\n+help.option.dest=\\          \\n          ()\\n          \n+\n+help.option.file-associations=\\          \\n          ()\\n          \"extension\"\"mime-type\"\"icon\"\"description\"\\n          \\n          \n+\n+help.option.help=\\          \\n          \n+\n+help.option.icon=\\          \\n          ()\n+\n+help.option.input=\\          \\n          ()\\n          \\n          \n+\n+help.option.install-dir=\\          \n+\n+help.option.install-dir.win=\\          \"\"\"AppData\"\\n          \n+\n+help.option.installer-runtime-image=\\          \\n          ()\\n          \n+\n+help.option.java-options=\\          Java\\n          \n+\n+help.option.jlink-options=\\          jlink\\n          \"--strip-native-commands\\n          --strip-debug --no-man-pages --no-header-files\"\\n          \n+\n+help.option.launcher-as-service=\\          \\n          \n+\n+help.option.license-file=\\          \\n          ()\n+\n+help.option.linux-app-category=\\          RPM <name>.spec\\n          DEB\n+\n+help.option.linux-app-release=\\          RPM <name>.spec\\n          DEBDebian\n+\n+help.option.linux-deb-maintainer=\\          .deb\n+\n+help.option.linux-menu-group=\\          \n+\n+help.option.linux-package-deps=\\          \n+\n+help.option.linux-package-name=\\          Linux\n+\n+help.option.linux-rpm-license-type=\\          (RPM .spec\"License: <value>\")\n+\n+help.option.linux-shortcut=\\          \n+\n+help.option.mac-app-category=\\          plistLSApplicationCategoryType\\n          \"utilities\"\n+\n+help.option.mac-app-image-sign-identity=\\          \\n          \"codesign\"--sign\\n          --mac-signing-key-user-name\n+\n+help.option.mac-app-store=\\          jpackageMac App Store\\n          \n+\n+help.option.mac-dmg-content=\\          dmg\\n          \n+\n+help.option.mac-entitlements=\\          \\n          \n+\n+help.option.mac-installer-sign-identity=\\          \"pkg\"\\n          \"productbuild\"--sign\\n          --mac-signing-key-user-name\n+\n+help.option.mac-package-identifier=\\          MacOS\\n          \\n          (A-Za-z0-9)(-)\\n          (.)\n+\n+help.option.mac-package-name=\\          \\n          \\n          16\\n          \\n          \n+\n+help.option.mac-package-signing-prefix=\\          ID\\n          \\n          \n+\n+help.option.mac-sign=\\          \\n          \n+\n+help.option.mac-signing-keychain=\\          \\n          \n+\n+help.option.mac-signing-key-user-name=\\          Apple\\n          \\n          --mac-app-image-sign-identity\\n          --mac-installer-sign-identity()\\n          --mac-app-image-sign-identity--mac-installer-sign-identity\n+\n+help.option.main-class=\\          \\n          --main-jar\n+\n+help.option.main-jar=\\          JAR\\n          ()\\n          --module--main-jar\\n          \n+\n+help.option.module=\\          ()\\n          \\n          \\n          Java--module--main-jar\\n          \n+\n+help.option.module-path=\\          :\\n          \\n          jar\\n          ()\\n          \n+help.option.module-path.win=\\          ;\\n          \\n          jar\\n          ()\\n          \n+\n+help.option.name=\\          \n+\n+help.option.resource-dir=\\          jpackage\\n          jpackage\\n          \\n          ()\n+\n+help.option.runtime-image=\\          \\n          \\n          ()\\n          --runtime-imagejpackagejlink\\n          :\\n          --strip-debug--no-header-files--no-man-pages\\n          --strip-native-commands\n+\n+help.option.temp=\\          \\n          ()\\n          \\n          \\n          \\n          \n+\n+help.option.type.win=\\          \\n          : {\"app-image\", \"exe\", \"msi\"}\\n          \\n          \n+help.option.type.linux=\\          \\n          : {\"app-image\", \"deb\", \"rpm\"}\\n          \\n          \n+help.option.type.mac=\\          \\n          : {\"app-image\", \"dmg\", \"pkg\"}\\n          \\n          \n+\n+help.option.vendor=\\          \n+\n+help.option.verbose=\\          \n+\n+help.option.version=\\          \n+\n+help.option.win-console=\\          \\n          \n+\n+help.option.win-dir-chooser=\\          \\n          \n+\n+help.option.win-help-url=\\          URL\n+\n+help.option.win-menu=\\          \n+\n+help.option.win-menu-group=\\          \n+\n+help.option.win-per-user-install=\\          \n+\n+help.option.win-shortcut=\\          \n+\n+help.option.win-shortcut-prompt=\\          \\n          \n+\n+help.option.win-update-url=\\          URL\n+\n+help.option.win-upgrade-uuid=\\          UUID\n+\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/HelpResources_ja.properties","additions":161,"deletions":20,"binary":false,"changes":181,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,17 +27,160 @@\n-MSG_Help=jpackage <options>\\n\\n:\\n--------------\\n    \\n        \\n            jpackage -n name -p modulePath -m moduleName\/className\\n        \\n            jpackage -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        \\n            jpackage -n name --app-image appImageDir\\n    \\n        \\n            jpackage --type app-image -n name -p modulePath \\\\\\n                -m moduleName\/className\\n        \\n            jpackage --type app-image -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n         jlink  jlink\\n            jlink --output appRuntimeImage -p modulePath \\\\\\n                --add-modules moduleName \\\\\\n                --no-header-files [<additional jlink options>...]\\n            jpackage --type app-image -n name \\\\\\n                -m moduleName\/className --runtime-image appRuntimeImage\\n     Java \\n        jpackage -n name --runtime-image <runtime-image>\\n{6}\\n\\n  @<filename> \\n          \/ \\n          \\n  --type -t <type> \\n          \\n          {1} \\n          \\n          \\n  --app-version <version>\\n          \/\\n  --copyright <copyright string>\\n          \\n  --description <description string>\\n          \\n  --help -h \\n          \\n          \\n  --icon <file path>\\n          \\n          \\n  --name -n <name>\\n          \/\\n  --dest -d <destination path>\\n          \\n          \\n          \\n  --temp <directory path>\\n          \\n          \\n          \\n          \\n          \\n          \\\n-\\n  --vendor <vendor string>\\n          \\n  --verbose\\n          \\n  --version\\n          \\n\\n\\n  --add-modules <>[,<>...]\\n           (\",\") \\n          \\n           --add-module  jlink\\n           --module\\n            \\n          --main-jar\\n          \\n  --module-path -p <module path>...\\n           {0} \\n          \\n           jar \\n          \\n          \\n  --jlink-options <jlink > \\n           jlink  \\n           \"--strip-native-commands \\n          --strip-debug --no-man-pages --no-header-files\" \\n          \\n  --runtime-image <directory path>\\n          \\n          \\n          \\n           --runtime-imagejpackage  jlink \\n          \\n          --strip-debug--no-header-files--no-man-pages  \\n          --strip-native-commands\\n\\n\\n  --input -i <directory path>\\n          \\n          \\n          \\n          \\n  --app-content <additional content>[,<additional content>...]\\n          \/\\n          \\n          \\n\\n\\n  --add-launcher <launcher name>=<file path>\\n          -\\n          \\n          \\n          \\\n- \"module\"\"main-jar\"\"main-class\"\"description\"\\n          \"arguments\"\"java-options\"\"app-version\"\"icon\"\\n          \"launcher-as-service\"\\n          \"win-console\"\"win-shortcut\"\"win-menu\"\\n          \"linux-app-category\"  \"linux-shortcut\"\\n          \\n          \\n          \\n          \\n          \\n           \\n  --arguments <main class arguments>\\n          \\n          \\n          \\n  --java-options <java options>\\n           Java \\n          \\n  --main-class <class name>\\n          \\n           --main-jar \\n  --main-jar <main jar file>\\n           JAR\\n          \\n           --module  --main-jar \\n          \\n  --module -m <module name>[\/<main class>]\\n          \\n          \\n           Java \\n           --module  --main-jar \\n          \\n{2}\\n\\n  --about-url <url>\\n           URL\\n  --app-image <directory path>\\n          {5}          \\n  --file-associations <file path>\\n          -\\n          \\n           \"extension\"\"mime-type\"\"icon\"  \"description\" \\n          \\n          \\n  --install-dir <directory path>\\n          {4}  --license-file <file path>\\n          \\n          \\n  --resource-dir <directory path>\\n           jpackage \\n          \\\n- jpackage \\n          \\n          \\n  --runtime-image <directory path>\\n          \\n          \\n          \\n  --launcher-as-service\\n          \\n          \\n\\n\\n{3}\n-\n-MSG_Help_win_launcher=\\n\\n  --win-console\\n          \\n          \\n\n-MSG_Help_win_install=\\  --win-dir-chooser\\n          \\n          \\n  --win-help-url <url>\\n           URL\\n  --win-menu\\n          \\n  --win-menu-group <menu group name>\\n          \\n  --win-per-user-install\\n          \\n  --win-shortcut\\n          \\n  --win-shortcut-prompt\\n          \\n          \\n  --win-update-url <url>\\n           URL\\n  --win-upgrade-uuid <id string>\\n           UUID\\n\n-MSG_Help_win_install_dir=\\n\n-MSG_Help_mac_install=\\  --mac-dmg-content <additional content path>[,<additional content path>...]\\n           DMG \\n          \\n\n-MSG_Help_mac_launcher=\\  --mac-package-identifier <ID string>\\n           macOS \\n          \\n           (A-Z,a-z,0-9) (-) \\n           (.) \\n  --mac-package-name <name string>\\n          \\n          \\n           16 \\n          \\n          \\n  --mac-package-signing-prefix <prefix string>\\n          \\n          \\n          \\n  --mac-sign\\n          \\n          \\n  --mac-signing-keychain <keychain name>\\n          \\n          \\n  --mac-signing-key-user-name <team name>\\n          Apple \\n          \\n           --mac-app-image-sign-identity \/\\n          --mac-installer-sign-identity\\n          --mac-app-image-sign-identity  --mac-installer-sign-identity \\n  --mac-app-image-sign-identity <identity>\\n          \\n           \"codesign\"  --sign \\n           --mac-signing-key-user-name \\n  --mac-installer-sign-identity <identity>\\n           \"pkg\" \\n           \"productbuild\"  --sign \\n           --mac-signing-key-user-name \\n  --mac-app-store\\n           jpackage \\n          Mac App Store\\n  --mac-entitlements <file path>\\n          \\n          \\n  --mac-app-category <category string>\\n           plist  LSApplicationCategoryType \\n           \"utilities\"\\n\n-MSG_Help_linux_install=\\  --linux-package-name <package name>\\n          Linux \\n  --linux-deb-maintainer <email address>\\n          .deb \\n  --linux-menu-group <menu-group-name>\\n          \\n  --linux-package-deps <package-dep-string>\\n          \\n  --linux-rpm-license-type <type string>\\n          RPM .spec  \"License: <value>\"\\n  --linux-app-release <release value>\\n          RPM <name>.spec  \\n          DEB  Debian \\n  --linux-app-category <category value>\\n          RPM <name>.spec  \\n          DEB \\n  --linux-shortcut\\n          \\n\n-MSG_Help_mac_linux_install_dir=\\n\n-MSG_Help_default_install_dir=OS X  Linux \\n          Windows \\n           \"Program Files\"  \"AppData\"\\n\n-MSG_Help_no_args=jpackage <options>\\n jpackage --help -h\n-MSG_Help_default_app_image=\\n          \\n\n-MSG_Help_mac_app_image=\\n          \\n          \\n\n-MSG_Help_mac_sign_sample_usage=\\    \\n        jpackage --type app-image --app-image <app-image> \\\\\\n            --mac-sign [<additional signing options>...]\\n        \\n               mac  --verbose\\n\n+help.header=jpackage <options>\n+\n+help.short= jpackage --help -h\n+\n+help.option-group.sample.create-native-package=\\    \\n        \\n            jpackage -n name -p modulePath -m moduleName\/className\\n        \\n            jpackage -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n        \\n            jpackage -n name --app-image appImageDir\n+\n+help.option-group.sample.create-app-image=\\    \\n        \\n            jpackage --type app-image -n name -p modulePath \\\\\\n                -m moduleName\/className\\n         \\n            jpackage --type app-image -i inputDir -n name \\\\\\n                --main-class className --main-jar myJar.jar\\n         jlink  jlink\\n            jlink --output appRuntimeImage -p modulePath \\\\\\n                --add-modules moduleName \\\\\\n                --no-header-files [<additional jlink options>...]\\n            jpackage --type app-image -n name \\\\\\n                -m moduleName\/className --runtime-image appRuntimeImage\n+\n+help.option-group.sample.create-runtime-installer=\\     Java \\n        jpackage -n name --runtime-image <runtime-image>\n+\n+help.option-group.sample.sign-app-image=\\    \\n        jpackage --type app-image --app-image <app-image> \\\\\\n            --mac-sign [<additional signing options>...]\\n        \\n               mac  --verbose\n+\n+help.option-group.sample=\n+help.option-group.generic=\n+help.option-group.runtime-image=\n+help.option-group.app-image=\n+help.option-group.launcher=\n+help.option-group.launcher-platform=\n+help.option-group.package=\n+help.option-group.package-platform=\n+\n+help.option.argument-file=\\          \/\\n          \n+\n+help.option.about-url=\\           URL\n+\n+help.option.add-launcher.win=\\          \\n          \\n          \\n           \"arguments\"\"description\"\"icon\"\"java-options\"\\n          \"launcher-as-service\"\"main-class\"\"main-jar\"\"module\"\\n          \"win-console\"\"win-menu\"  \"win-shortcut\"\\n          \\n          \\n          \\n          \\n          \\n          \n+\n+help.option.add-launcher.linux=\\          \\n          \\n          \\n           \"arguments\"\"description\"\"icon\"\"java-options\"\\n          \"launcher-as-service\"\"linux-shortcut\"\"main-class\"\"main-jar\" \\n           \"module\"\\n          \\n          \\n          \\n          \\n          \\n          \n+\n+help.option.add-launcher.mac=\\          \\n          \\n          \\n           \"arguments\"\"description\"\"icon\"\"java-options\"\\n          \"launcher-as-service\"\"main-class\"\"main-jar\" \\n          \"module\"\\n          \\n          \\n          \\n          \\n          \\n          \n+\n+help.option.add-modules=\\           (\",\") \\n          \\n           --add-module  jlink\\n          \\n           --module\\n           --main-jar\\n          \n+\n+help.option.app-content=\\          \\n          \/\\n          \n+\n+help.option.app-content.mac=\\          \\n          \/\\n          \\n           \"Resources\" \\n           \"Contents\" \\n          jpackage \\n          \\n          \/\n+\n+help.option.app-image=\\          \\n          \\n          \n+\n+help.option.app-image.mac=\\          \\n          \\n          \\n          \n+\n+help.option.app-version=\\          \/\n+\n+help.option.arguments=\\          \\n          \\n          \n+\n+help.option.copyright=\\          \n+\n+help.option.description=\\          \n+\n+help.option.dest=\\          \\n          \\n          \n+\n+help.option.file-associations=\\          \\n          \\n           \"extension\"\"mime-type\"\"icon\"  \"description\"\\n          \\n          \n+\n+help.option.help=\\          \\n          \n+\n+help.option.icon=\\          \\n          \n+\n+help.option.input=\\          \\n          \\n          \\n          \n+\n+help.option.install-dir=\\          \n+\n+help.option.install-dir.win=\\          \\n           \"Program Files\"  \"AppData\"\n+\n+help.option.installer-runtime-image=\\          \\n          \\n          \n+\n+help.option.java-options=\\           Java \\n          \n+\n+help.option.jlink-options=\\           jlink \\n           \"--strip-native-commands\\n          --strip-debug --no-man-pages --no-header-files\"\\n          \n+\n+help.option.launcher-as-service=\\          \\n          \n+\n+help.option.license-file=\\          \\n          \n+\n+help.option.linux-app-category=\\          RPM <name>.spec \\n           DEB \n+\n+help.option.linux-app-release=\\          RPM <name>.spec \\n           DEB  Debian \n+\n+help.option.linux-deb-maintainer=\\          .deb \n+\n+help.option.linux-menu-group=\\          \n+\n+help.option.linux-package-deps=\\          \n+\n+help.option.linux-package-name=\\          Linux \n+\n+help.option.linux-rpm-license-type=\\          RPM .spec  \"License: <value>\"\n+\n+help.option.linux-shortcut=\\          \n+\n+help.option.mac-app-category=\\           plist  LSApplicationCategoryType \\n           \"utilities\"\n+\n+help.option.mac-app-image-sign-identity=\\          \\n           \"codesign\"  --sign \\n           --mac-signing-key-user-name \n+\n+help.option.mac-app-store=\\           jpackage \\n          Mac App Store\n+\n+help.option.mac-dmg-content=\\           dmg \\n          \n+\n+help.option.mac-entitlements=\\          \\n          \n+\n+help.option.mac-installer-sign-identity=\\           \"pkg\" \\n           \"productbuild\"  --sign \\n           --mac-signing-key-user-name \n+\n+help.option.mac-package-identifier=\\           macOS \\n          \\n           (A-Z,a-z,0-9) (-)\\n           (.) \n+\n+help.option.mac-package-name=\\          \\n          \\n           16 \\n          \\n          \n+\n+help.option.mac-package-signing-prefix=\\          \\n          \\n          \n+\n+help.option.mac-sign=\\          \\n          \n+\n+help.option.mac-signing-keychain=\\          \\n          \n+\n+help.option.mac-signing-key-user-name=\\          Apple \\n          \\n           --mac-app-image-sign-identity \/\\n          --mac-installer-sign-identity\\n          --mac-app-image-sign-identity  --mac-installer-sign-identity \n+\n+help.option.main-class=\\          \\n           --main-jar \n+\n+help.option.main-jar=\\           JAR\\n          \\n           --module  --main-jar \\n          \n+\n+help.option.module=\\          \\n          \\n           Java \\n           --module  --main-jar \\n          \n+\n+help.option.module-path=\\           : \\n          \\n           jar \\n          \\n          \n+help.option.module-path.win=\\           ; \\n          \\n           jar \\n          \\n          \n+\n+help.option.name=\\          \/\n+\n+help.option.resource-dir=\\           jpackage \\n           jpackage \\n          \\n          \n+\n+help.option.runtime-image=\\          \\n          \\n          \\n           --runtime-imagejpackage  jlink \\n          \\n          --strip-debug--no-header-files--no-man-pages \\n          --strip-native-commands\n+\n+help.option.temp=\\          \\n          \\n          \\n          \\n          \\n          \n+\n+help.option.type.win=\\          \\n          {\"app-image\", \"exe\", \"msi\"}\\n          \\n          \n+help.option.type.linux=\\          \\n          {\"app-image\", \"deb\", \"rpm\"}\\n          \\n          \n+help.option.type.mac=\\          \\n          {\"app-image\", \"dmg\", \"pkg\"}\\n          \\n          \n+\n+help.option.vendor=\\          \n+\n+help.option.verbose=\\          \n+\n+help.option.version=\\          \n+\n+help.option.win-console=\\          \\n          \n+\n+help.option.win-dir-chooser=\\          \\n          \n+\n+help.option.win-help-url=\\           URL\n+\n+help.option.win-menu=\\          \n+\n+help.option.win-menu-group=\\          \n+\n+help.option.win-per-user-install=\\          \n+\n+help.option.win-shortcut=\\          \n+\n+help.option.win-shortcut-prompt=\\          \\n          \n+\n+help.option.win-update-url=\\           URL\n+\n+help.option.win-upgrade-uuid=\\           UUID\n+\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/HelpResources_zh_CN.properties","additions":161,"deletions":18,"binary":false,"changes":179,"status":"modified"},{"patch":"@@ -51,1 +51,1 @@\n-message.error-header={0}\n+message.error-header=Error: {0}\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-jpackage.description=Eigenstndige Java-Anwendung verpacken\n-\n@@ -30,1 +28,0 @@\n-param.description.default=Kein Wert\n@@ -33,0 +30,10 @@\n+bundle-type.win-app=Windows-Anwendungsimage\n+bundle-type.win-exe=EXE-Installationsprogrammpackage\n+bundle-type.win-msi=MSI-Installationsprogrammpackage\n+bundle-type.mac-app=Mac-Anwendungsimage\n+bundle-type.mac-dmg=Mac-DMG-Package\n+bundle-type.mac-pkg=Mac-PKG-Package\n+bundle-type.linux-app=Linux-Anwendungsimage\n+bundle-type.linux-deb=DEB-Bundle\n+bundle-type.linux-rpm=RPM-Bundle\n+\n@@ -36,1 +43,1 @@\n-message.no-default-resource=Keine Standardpackageressource {0} {1} (durch Hinzufgen von {2} zu resource-dir ist eine Anpassung mglich).\n+message.no-default-resource=Keine Standardpackageressource {0} (durch Hinzufgen von {1} zu resource-dir ist eine Anpassung mglich).\n@@ -40,2 +47,0 @@\n-message.runtime-image-dir-does-not-exist=Angegebenes Laufzeitimageverzeichnis {0}: {1} ist nicht vorhanden\n-message.resource-dir-does-not-exist=Angegebenes Ressourcenverzeichnis {0}: {1} ist nicht vorhanden\n@@ -45,1 +50,3 @@\n-message.module-class=Klasse \"{0}\" aus Modul \"{1}\" wird als Anwendungshauptklasse verwendet\n+\n+message.error-header={0}\n+message.advice-header=Empfehlung zur Behebung: {0}\n@@ -53,1 +60,1 @@\n-error.root-exists=Fehler: Anwendungszielverzeichnis {0} ist bereits vorhanden\n+error.root-exists=Anwendungszielverzeichnis {0} ist bereits vorhanden\n@@ -56,2 +63,0 @@\n-error.no-main-class=Es wurde keine Hauptklasse angegeben oder in den angegebenen Anwendungsressourcen gefunden\n-error.no-main-class.advice=Geben Sie eine Anwendungsklasse an, oder stellen Sie sicher, dass die appResources eine JAR-Datei mit einer Anwendungsklasse im Manifest enthalten\n@@ -61,1 +66,0 @@\n-error.not-path-parameter=\"Ungltiger Wert fr Parameter {0}: {1}\"\n@@ -64,0 +68,17 @@\n+error.non-option-arguments={0} Argumente, die keine Option sind, in der Befehlszeile gefunden. Argumente, die keine Option sind, sind nicht zulssig\n+error.undefined-default-bundling-operation=Standard-Bundling-Vorgang ist nicht definiert\n+error.undefined-default-bundling-operation.advice=Parameter {0} zur Befehlszeile hinzufgen\n+error.parameter-not-uuid=Der fr Parameter {1} angegebene Wert \"{0}\" ist keine gltige UUID\n+error.parameter-not-path=Der fr Parameter {1} angegebene Wert \"{0}\" ist kein gltiger Pfad\n+error.parameter-not-file=Der fr Parameter {1} angegebene Wert \"{0}\" ist keine Datei\n+error.parameter-not-directory=Der fr Parameter {1} angegebene Wert \"{0}\" ist kein Verzeichnis\n+error.parameter-not-empty-directory=Der fr Parameter {1} angegebene Wert \"{0}\" ist kein leeres Verzeichnis oder kein vorhandener Pfad\n+error.parameter-not-url=Der fr Parameter {1} angegebene Wert \"{0}\" ist keine gltige URL\n+error.parameter-not-launcher-shortcut-dir=Der fr Parameter {1} angegebene Wert \"{0}\" ist kein gltiges Verknpfungsstartverzeichnis\n+error.path-parameter-ioexception=I\/O-Fehler beim Zugriff auf Pfadwert \"{0}\" von Parameter {1}\n+error.parameter-add-launcher-malformed=Der fr Parameter {1} angegebene Wert \"{0}\" stimmt nicht mit dem Muster <Name>=<Dateipfad> berein\n+error.parameter-add-launcher-not-file=Der Wert des Pfades zu einer Eigenschaftendatei \"{0}\", der fr den zustzlichen Launcher \"{1}\" bereitgestellt wird, ist kein gltiger Dateipfad\n+error.properties-parameter-not-path=Der fr Eigenschaft \"{1}\" in Datei \"{2}\" angegebene Wert \"{0}\" ist kein gltiger Pfad\n+error.properties-parameter-not-file=Der fr Eigenschaft \"{1}\" in Datei \"{2}\" angegebene Wert \"{0}\" ist keine Datei\n+error.properties-parameter-not-launcher-shortcut-dir=Der fr Eigenschaft \"{1}\" in Datei \"{2}\" angegebene Wert \"{0}\" ist kein gltiges Verknpfungsstartverzeichnis\n+\n@@ -69,4 +90,9 @@\n-error.tool-not-found={0} kann nicht gefunden werden. Grund: {1}\n-error.tool-not-found.advice=Installieren Sie {0}\n-error.tool-old-version={0} {1} oder eine neuere Version kann nicht gefunden werden\n-error.tool-old-version.advice=Installieren Sie {0} {1} oder eine neuere Version\n+error.launcher-duplicate-name=Mehrere Launcher haben denselben Namen \"{0}\". Launcher mssen eindeutige Namen haben\n+\n+error.tool-error=Validieren von \"{0}\" nicht mglich. Grund: {1}\n+error.tool-not-executable=\"{0}\" ist nicht ausfhrbar\n+error.tool-not-found=\"{0}\" kann nicht gefunden werden\n+error.tool-not-found.advice=Installieren Sie \"{0}\"\n+error.tool-old-version=\"{0}\" {1} oder eine neuere Version kann nicht gefunden werden\n+error.tool-old-version.advice=Installieren Sie \"{0}\" {1} oder eine neuere Version\n+\n@@ -78,4 +104,4 @@\n-warning.no.jdk.modules.found=Warnung: Keine JDK-Module gefunden\n-\n-error.foreign-app-image=Fehler : Fehlende .jpackage.xml-Datei in app-image-Verzeichnis \"{0}\"\n-error.invalid-app-image=Fehler: app-image-Verzeichnis \"{0}\" wurde von einer anderen jpackage-Version generiert, oder Datei \"{1}\" ist nicht wohlgeformt\n+error.missing-app-image-file=Datei \"{0}\" fehlt im vordefinierten Anwendungsimage \"{1}\"\n+error.invalid-app-image-file=Datei \"{0}\" im vordefinierten Anwendungsimage \"{1}\" ist beschdigt oder wurde von einer anderen Version von jpackage erstellt\n+error.malformed-app-image-file=Datei \"{0}\" im vordefinierten Anwendungsimage \"{1}\" enthlt nicht wohlgeformte XML-Daten\n+error.reading-app-image-file=Datei \"{0}\" konnte im vordefinierten Anwendungsimage \"{1}\" nicht gelesen werden\n@@ -85,29 +111,15 @@\n-MSG_BundlerFailed=Fehler: Bundler \"{1}\" ({0}) konnte kein Package generieren\n-MSG_BundlerConfigException=Bundler {0} aufgrund eines Konfigurationsproblems bersprungen: {1} \\nEmpfehlung zur Behebung: {2}\n-MSG_BundlerConfigExceptionNoAdvice=Bundler {0} aufgrund eines Konfigurationsproblems bersprungen: {1}\n-MSG_BundlerRuntimeException=Bundler {0} nicht erfolgreich. Grund: {1}\n-\n-ERR_NoMainClass=Fehler: Hauptanwendungsklasse fehlt\n-ERR_UnsupportedOption=Fehler: Option [{0}] ist auf dieser Plattform ungltig\n-ERR_InvalidTypeOption=Fehler: Option [{0}] ist nicht gltig mit Typ [{1}]\n-ERR_NoInstallerEntryPoint=Fehler: Option [{0}] ist nicht gltig ohne Einstiegspunktoption --module oder --main-jar\n-ERR_MutuallyExclusiveOptions=Fehler: Optionen [{0}] und [{1}] schlieen sich gegenseitig aus\n-ERR_InvalidOptionWithAppImageSigning=Fehler: Option [{0}] ist nicht gltig beim Signieren eines Anwendungsimages\n-\n-ERR_MissingArgument=Fehler: Fehlendes Argument: {0}\n-ERR_MissingRequiredArgument=Fehler: Fr das Argument {0} ist mindestens eines der folgenden Argumente erforderlich: [{1}]\n-ERR_AppImageNotExist=Fehler: Anwendungsimageverzeichnis \"{0}\" ist nicht vorhanden\n-ERR_NoAddLauncherName=Fehler: Fr Option --add-launcher mssen ein Name und ein Dateipfad angegeben werden (--add-launcher <Name>=<Dateipfad>)\n-ERR_NoUniqueName=Fehler: Fr --add-launcher <Name>=<Dateipfad> ist ein eindeutiger Name erforderlich\n-ERR_InvalidAppName=Fehler: Ungltiger Anwendungsname: {0}\n-ERR_InvalidSLName=Fehler: Ungltiger Name fr hinzuzufgenden Launcher: {0}\n-ERR_IconFileNotExit=Fehler: Die angegebene Symboldatei [{0}] ist nicht vorhanden\n-ERR_LicenseFileNotExit=Fehler: Die angegebene Lizenzdatei ist nicht vorhanden\n-ERR_BuildRootInvalid=Fehler: Das temporre Verzeichnis ({0}) darf nicht vorhanden sein oder muss leer sein\n-ERR_InvalidOption=Fehler: Ungltige Option: [{0}]\n-ERR_InvalidInstallerType=Fehler: Ungltiger oder nicht untersttzter Typ: [{0}]\n-ERR_BothMainJarAndModule=Fehler: Die Optionen --main-jar und --module drfen nicht beide vorhanden sein\n-ERR_NoEntryPoint=Fehler: Fr das Erstellen des Anwendungsimages muss entweder die Option --main-jar oder die Option --module angegeben werden\n-ERR_CannotParseOptions=Fehler: Option @filename wird verarbeitet: {0}\n-ERR_MissingJLinkOptMacAppStore=Fehler: Argument \"--mac-app-store\" erfordert eine {0}-Option fr Argument \"--jlink-options\"\n-ERR_MacAppStoreRuntimeBinExists=Fehler: Laufzeitimage \"{0}\" darf nicht den Ordner \"bin\" enthalten. Verwenden Sie die jlink-Option \"--strip-native-commands\" beim Generieren des Laufzeitimages mit dem Argument \"--mac-app-store\".\n+ERR_NoMainClass=Hauptanwendungsklasse fehlt\n+ERR_UnsupportedOption=Option [{0}] ist auf dieser Plattform ungltig\n+ERR_InvalidTypeOption=Option [{0}] ist nicht gltig mit Typ [{1}]\n+ERR_NoInstallerEntryPoint=Option [{0}] ist nicht gltig ohne Einstiegspunktoption --module oder --main-jar\n+ERR_MutuallyExclusiveOptions=Sich gegenseitig ausschlieende Optionen: [{0}] und [{1}]\n+ERR_InvalidOptionWithAppImageSigning=Option [{0}] ist nicht gltig beim Signieren eines Anwendungsimages\n+\n+ERR_MissingArgument2=Fehlendes Argument: {0} oder {1}\n+ERR_InvalidAppName=Ungltiger Anwendungsname: {0}\n+ERR_InvalidSLName=Ungltiger Name fr hinzuzufgenden Launcher: {0}\n+ERR_InvalidOption=Ungltige Option: [{0}]\n+ERR_InvalidInstallerType=Ungltiger oder nicht untersttzter Typ: [{0}]\n+ERR_NoEntryPoint=Fr das Erstellen des Anwendungsimages muss entweder die Option --main-jar oder die Option --module angegeben werden\n+ERR_CannotParseOptions=Option @filename wird verarbeitet: {0}\n+ERR_MissingJLinkOptMacAppStore=Argument \"--mac-app-store\" erfordert eine {0}-Option fr Argument \"--jlink-options\"\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources_de.properties","additions":60,"deletions":48,"binary":false,"changes":108,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-jpackage.description=Java\n-\n@@ -30,1 +28,0 @@\n-param.description.default=\n@@ -33,0 +30,10 @@\n+bundle-type.win-app=Windows\n+bundle-type.win-exe=EXE\n+bundle-type.win-msi=MSI\n+bundle-type.mac-app=Mac\n+bundle-type.mac-dmg=Mac DMG\n+bundle-type.mac-pkg=Mac PKG\n+bundle-type.linux-app=Linux\n+bundle-type.linux-deb=DEB\n+bundle-type.linux-rpm=RPM\n+\n@@ -36,1 +43,1 @@\n-message.no-default-resource={0} {1}({2}resource-dir)\n+message.no-default-resource={0}({1}resource-dir)\n@@ -40,2 +47,0 @@\n-message.runtime-image-dir-does-not-exist={0}: {1}\n-message.resource-dir-does-not-exist={0}: {1}\n@@ -45,1 +50,3 @@\n-message.module-class=\"{1}\"\"{0}\"\n+\n+message.error-header={0}\n+message.advice-header=: {0}\n@@ -53,1 +60,1 @@\n-error.root-exists=: {0}\n+error.root-exists={0}\n@@ -56,2 +63,0 @@\n-error.no-main-class=\n-error.no-main-class.advice=appResourcesjar\n@@ -61,1 +66,0 @@\n-error.not-path-parameter=\"{0}: {1}\"\n@@ -64,0 +68,17 @@\n+error.non-option-arguments={0}\n+error.undefined-default-bundling-operation=\n+error.undefined-default-bundling-operation.advice={0}\n+error.parameter-not-uuid={1}\"{0}\"UUID\n+error.parameter-not-path={1}\"{0}\"\n+error.parameter-not-file={1}\"{0}\"\n+error.parameter-not-directory={1}\"{0}\"\n+error.parameter-not-empty-directory={1}\"{0}\"\n+error.parameter-not-url={1}\"{0}\"URL\n+error.parameter-not-launcher-shortcut-dir={1}\"{0}\"\n+error.path-parameter-ioexception={1}\"{0}\"I\/O\n+error.parameter-add-launcher-malformed={1}\"{0}\"<name>=<file path>\n+error.parameter-add-launcher-not-file=\"{1}\"\"{0}\"\n+error.properties-parameter-not-path=\"{2}\"\"{1}\"\"{0}\"\n+error.properties-parameter-not-file=\"{2}\"\"{1}\"\"{0}\"\n+error.properties-parameter-not-launcher-shortcut-dir=\"{2}\"\"{1}\"\"{0}\"\n+\n@@ -69,4 +90,9 @@\n-error.tool-not-found={0}: {1}\n-error.tool-not-found.advice={0}\n-error.tool-old-version={0} {1}\n-error.tool-old-version.advice={0} {1}\n+error.launcher-duplicate-name=\"{0}\"\n+\n+error.tool-error=\"{0}\": {1}\n+error.tool-not-executable=\"{0}\"\n+error.tool-not-found=\"{0}\"\n+error.tool-not-found.advice=\"{0}\"\n+error.tool-old-version=\"{0}\" {1}\n+error.tool-old-version.advice=\"{0}\" {1}\n+\n@@ -78,4 +104,4 @@\n-warning.no.jdk.modules.found=: JDK\n-\n-error.foreign-app-image=: app-image\"{0}\".jpackage.xml\n-error.invalid-app-image=: app-image\"{0}\"jpackage\"{1}\"\n+error.missing-app-image-file=\"{1}\"\"{0}\"\n+error.invalid-app-image-file=\"{1}\"\"{0}\"jpackage\n+error.malformed-app-image-file=\"{1}\"\"{0}\"XML\n+error.reading-app-image-file=\"{1}\"\"{0}\"\n@@ -85,29 +111,15 @@\n-MSG_BundlerFailed=: \"{1}\" ({0})\n-MSG_BundlerConfigException={0}: {1} \\n: {2}\n-MSG_BundlerConfigExceptionNoAdvice={0}: {1}\n-MSG_BundlerRuntimeException={1}{0}\n-\n-ERR_NoMainClass=: \n-ERR_UnsupportedOption=: [{0}]\n-ERR_InvalidTypeOption=: [{0}][{1}]\n-ERR_NoInstallerEntryPoint=: [{0}]--module--main-jar\n-ERR_MutuallyExclusiveOptions=: [{0}][{1}]\n-ERR_InvalidOptionWithAppImageSigning=: [{0}]\n-\n-ERR_MissingArgument=: : {0}\n-ERR_MissingRequiredArgument=: {0}1[{1}]\n-ERR_AppImageNotExist=: \"{0}\"\n-ERR_NoAddLauncherName=: --add-launcher(--add-launcher <name>=<file path>)\n-ERR_NoUniqueName=: --add-launcher <name>=<file path>\n-ERR_InvalidAppName=: : {0}\n-ERR_InvalidSLName=: : {0}\n-ERR_IconFileNotExit=: [{0}]\n-ERR_LicenseFileNotExit=: \n-ERR_BuildRootInvalid=: ({0})\n-ERR_InvalidOption=: : [{0}]\n-ERR_InvalidInstallerType=: : [{0}]\n-ERR_BothMainJarAndModule=: --main-jar--module\n-ERR_NoEntryPoint=: --main-jar--module\n-ERR_CannotParseOptions=: @filename: {0}\n-ERR_MissingJLinkOptMacAppStore=: --mac-app-store--jlink-options{0}\n-ERR_MacAppStoreRuntimeBinExists=: \"{0}\"\"bin\"--mac-app-store--strip-native-commands jlink\n+ERR_NoMainClass=\n+ERR_UnsupportedOption=[{0}]\n+ERR_InvalidTypeOption=[{0}][{1}]\n+ERR_NoInstallerEntryPoint=[{0}]--module--main-jar\n+ERR_MutuallyExclusiveOptions=[{0}][{1}]\n+ERR_InvalidOptionWithAppImageSigning=[{0}]\n+\n+ERR_MissingArgument2=: {0}{1}\n+ERR_InvalidAppName=: {0}\n+ERR_InvalidSLName=: {0}\n+ERR_InvalidOption=: [{0}]\n+ERR_InvalidInstallerType=: [{0}]\n+ERR_NoEntryPoint=--main-jar--module\n+ERR_CannotParseOptions=@filename: {0}\n+ERR_MissingJLinkOptMacAppStore=--mac-app-store--jlink-options{0}\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources_ja.properties","additions":60,"deletions":48,"binary":false,"changes":108,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-jpackage.description= Java \n-\n@@ -30,1 +28,0 @@\n-param.description.default=\n@@ -33,0 +30,10 @@\n+bundle-type.win-app=Windows \n+bundle-type.win-exe=EXE \n+bundle-type.win-msi=MSI \n+bundle-type.mac-app=Mac \n+bundle-type.mac-dmg=Mac DMG \n+bundle-type.mac-pkg=Mac PKG \n+bundle-type.linux-app=Linux \n+bundle-type.linux-deb=DEB \n+bundle-type.linux-rpm=RPM \n+\n@@ -36,1 +43,1 @@\n-message.no-default-resource= {0} {1} {2}  resource-dir \n+message.no-default-resource= {0} {1}  resource-dir \n@@ -40,2 +47,0 @@\n-message.runtime-image-dir-does-not-exist= {0}{1} \n-message.resource-dir-does-not-exist= {0}{1} \n@@ -45,1 +50,3 @@\n-message.module-class= \"{1}\"  \"{0}\" \n+\n+message.error-header={0}\n+message.advice-header={0}\n@@ -53,1 +60,1 @@\n-error.root-exists= {0} \n+error.root-exists= {0} \n@@ -56,2 +63,0 @@\n-error.no-main-class=\n-error.no-main-class.advice= appResources  jar \n@@ -61,1 +66,0 @@\n-error.not-path-parameter=\"{0} {1}\"\n@@ -64,0 +68,17 @@\n+error.non-option-arguments= {0} \n+error.undefined-default-bundling-operation=\n+error.undefined-default-bundling-operation.advice= {0} \n+error.parameter-not-uuid= {1}  \"{0}\"  UUID\n+error.parameter-not-path= {1}  \"{0}\" \n+error.parameter-not-file= {1}  \"{0}\" \n+error.parameter-not-directory= {1}  \"{0}\" \n+error.parameter-not-empty-directory= {1}  \"{0}\" \n+error.parameter-not-url= {1}  \"{0}\"  URL\n+error.parameter-not-launcher-shortcut-dir= {1}  \"{0}\" \n+error.path-parameter-ioexception= {1}  \"{0}\"  I\/O \n+error.parameter-add-launcher-malformed= {1}  \"{0}\"  <name>=<file path> \n+error.parameter-add-launcher-not-file= \"{1}\"  \"{0}\" \n+error.properties-parameter-not-path= \"{2}\"  \"{1}\"  \"{0}\" \n+error.properties-parameter-not-file= \"{2}\"  \"{1}\"  \"{0}\" \n+error.properties-parameter-not-launcher-shortcut-dir= \"{2}\"  \"{1}\"  \"{0}\" \n+\n@@ -69,4 +90,9 @@\n-error.tool-not-found= {0}{1}\n-error.tool-not-found.advice= {0}\n-error.tool-old-version= {0} {1}\n-error.tool-old-version.advice= {0} {1}\n+error.launcher-duplicate-name= \"{0}\"\n+\n+error.tool-error= \"{0}\"{1}\n+error.tool-not-executable=\"{0}\" \n+error.tool-not-found= \"{0}\"\n+error.tool-not-found.advice= \"{0}\"\n+error.tool-old-version= \"{0}\" {1} \n+error.tool-old-version.advice= \"{0}\" {1} \n+\n@@ -78,4 +104,4 @@\n-warning.no.jdk.modules.found=:  JDK \n-\n-error.foreign-app-image=app-image  \"{0}\"  .jpackage.xml \n-error.invalid-app-image= jpackage  \"{1}\"  app-image  \"{0}\"\n+error.missing-app-image-file= \"{1}\"  \"{0}\" \n+error.invalid-app-image-file= \"{1}\"  \"{0}\"  jpackage \n+error.malformed-app-image-file= \"{1}\"  \"{0}\"  XML \n+error.reading-app-image-file= \"{1}\"  \"{0}\" \n@@ -85,29 +111,15 @@\n-MSG_BundlerFailed= \"{1}\" ({0}) \n-MSG_BundlerConfigException=, {0}: {1} \\n: {2}\n-MSG_BundlerConfigExceptionNoAdvice=, {0}: {1}\n-MSG_BundlerRuntimeException={1}, {0}\n-\n-ERR_NoMainClass=\n-ERR_UnsupportedOption= [{0}] \n-ERR_InvalidTypeOption= [{0}]  [{1}] \n-ERR_NoInstallerEntryPoint= --module  --main-jar  [{0}] \n-ERR_MutuallyExclusiveOptions= [{0}]  [{1}] \n-ERR_InvalidOptionWithAppImageSigning= [{0}] \n-\n-ERR_MissingArgument=: : {0}\n-ERR_MissingRequiredArgument={0}  [{1}] \n-ERR_AppImageNotExist= \"{0}\" \n-ERR_NoAddLauncherName=--add-launcher  (--add-launcher <name>=<file path>)\n-ERR_NoUniqueName=--add-launcher <name>=<file path> \n-ERR_InvalidAppName= {0} \n-ERR_InvalidSLName= {0} \n-ERR_IconFileNotExit= [{0}] \n-ERR_LicenseFileNotExit=\n-ERR_BuildRootInvalid= ({0}) \n-ERR_InvalidOption= [{0}] \n-ERR_InvalidInstallerType= [{0}] \n-ERR_BothMainJarAndModule= --main-jar  --module \n-ERR_NoEntryPoint= --main-jar  --module \n-ERR_CannotParseOptions= @filename {0}\n-ERR_MissingJLinkOptMacAppStore= --jlink-options --mac-app-store  {0} \n-ERR_MacAppStoreRuntimeBinExists= \"{0}\"  \"bin\"  --mac-app-store  --strip-native-commands jlink \n+ERR_NoMainClass=\n+ERR_UnsupportedOption= [{0}] \n+ERR_InvalidTypeOption= [{0}]  [{1}] \n+ERR_NoInstallerEntryPoint= --module  --main-jar  [{0}] \n+ERR_MutuallyExclusiveOptions= [{0}]  [{1}] \n+ERR_InvalidOptionWithAppImageSigning= [{0}] \n+\n+ERR_MissingArgument2={0}  {1}\n+ERR_InvalidAppName= {0} \n+ERR_InvalidSLName= {0} \n+ERR_InvalidOption= [{0}] \n+ERR_InvalidInstallerType= [{0}] \n+ERR_NoEntryPoint= --main-jar  --module \n+ERR_CannotParseOptions= @filename {0}\n+ERR_MissingJLinkOptMacAppStore= --jlink-options --mac-app-store  {0} \n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources_zh_CN.properties","additions":60,"deletions":48,"binary":false,"changes":108,"status":"modified"},{"patch":"@@ -40,1 +40,0 @@\n-import jdk.jpackage.internal.util.function.ExceptionBox;\n@@ -173,1 +172,1 @@\n-        private void runActionOnPath(ThrowingConsumer<Path> action, Path path) {\n+        private void runActionOnPath(ThrowingConsumer<Path, IOException> action, Path path) {\n@@ -180,2 +179,0 @@\n-            } catch (Throwable t) {\n-                throw ExceptionBox.rethrowUnchecked(t);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/FileUtils.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n-\n@@ -31,0 +29,1 @@\n+import java.util.Objects;\n@@ -35,1 +34,0 @@\n-import java.util.function.UnaryOperator;\n@@ -37,0 +35,2 @@\n+import jdk.jpackage.internal.util.function.ExceptionBox;\n+import jdk.jpackage.internal.util.function.ThrowingSupplier;\n@@ -42,5 +42,1 @@\n-            throw new IllegalArgumentException();\n-        }\n-\n-        if (value.isEmpty() && errors.isEmpty()) {\n-            throw new IllegalArgumentException(\"Error collection must be non-empty\");\n+            throw new IllegalArgumentException(\"'value' and 'errors' cannot both be non-empty or both be empty\");\n@@ -48,1 +44,0 @@\n-\n@@ -53,1 +48,1 @@\n-            rethrowUnchecked(ex);\n+            throw ExceptionBox.toUnchecked(ex);\n@@ -67,1 +62,10 @@\n-        return new Result<>(value.map(conv), errors);\n+        if (hasValue()) {\n+            var mapped = value.map(conv);\n+            if (mapped.isEmpty()) {\n+                throw new NullPointerException();\n+            } else {\n+                return new Result<>(mapped, errors);\n+            }\n+        } else {\n+            return mapErrors();\n+        }\n@@ -76,4 +80,1 @@\n-    public Result<T> mapErrors(UnaryOperator<Collection<? extends Exception>> errorsMapper) {\n-        return new Result<>(value, errorsMapper.apply(errors));\n-    }\n-\n+    @SuppressWarnings(\"unchecked\")\n@@ -81,1 +82,4 @@\n-        return new Result<>(Optional.empty(), errors);\n+        if (hasValue()) {\n+            throw new IllegalStateException(\"Can not map errors from a result without errors\");\n+        }\n+        return (Result<U>)this;\n@@ -100,1 +104,11 @@\n-    public static <T> Result<T> create(Supplier<T> supplier) {\n+    public static <T> Result<T> of(Supplier<T> supplier) {\n+        return of(supplier::get, RuntimeException.class);\n+    }\n+\n+    public static <T, E extends Exception> Result<T> of(\n+            ThrowingSupplier<T, ? extends E> supplier, Class<? extends E> supplierExceptionType) {\n+\n+        Objects.requireNonNull(supplier);\n+        Objects.requireNonNull(supplierExceptionType);\n+\n+        T value;\n@@ -102,1 +116,1 @@\n-            return ofValue(supplier.get());\n+            value = supplier.get();\n@@ -104,1 +118,8 @@\n-            return ofError(ex);\n+            if (supplierExceptionType.isInstance(ex)) {\n+                return ofError(ex);\n+            } else if (ex instanceof RuntimeException rex) {\n+                throw rex;\n+            } else {\n+                \/\/ Unreachable because the `supplier` can throw exceptions of type or supertype `E` or runtime exceptions.\n+                throw ExceptionBox.reachedUnreachable();\n+            }\n@@ -106,0 +127,2 @@\n+\n+        return ofValue(value);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/Result.java","additions":42,"deletions":19,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -83,1 +83,1 @@\n-            throw rethrowUnchecked(ex);\n+            throw toUnchecked(ex);\n@@ -104,1 +104,1 @@\n-            throw rethrowUnchecked(ex);\n+            throw toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/XmlUtils.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,7 +33,20 @@\n-    public static RuntimeException rethrowUnchecked(Throwable throwable) {\n-        if (throwable instanceof RuntimeException err) {\n-            throw err;\n-        }\n-\n-        if (throwable instanceof Error err) {\n-            throw err;\n+    public static RuntimeException toUnchecked(Exception ex) {\n+        switch (ex) {\n+            case RuntimeException rex -> {\n+                return rex;\n+            }\n+            case InvocationTargetException itex -> {\n+                var t = itex.getCause();\n+                if (t instanceof Exception cause) {\n+                    return toUnchecked(cause);\n+                } else {\n+                    throw (Error)t;\n+                }\n+            }\n+            case InterruptedException _ -> {\n+                Thread.currentThread().interrupt();\n+                return new ExceptionBox(ex);\n+            }\n+            default -> {\n+                return new ExceptionBox(ex);\n+            }\n@@ -41,0 +54,1 @@\n+    }\n@@ -42,2 +56,18 @@\n-        if (throwable instanceof InvocationTargetException err) {\n-            throw rethrowUnchecked(err.getCause());\n+    public static Exception unbox(Throwable t) {\n+        switch (t) {\n+            case ExceptionBox ex -> {\n+                return unbox(ex.getCause());\n+            }\n+            case InvocationTargetException ex -> {\n+                return unbox(ex.getCause());\n+            }\n+            case Exception ex -> {\n+                return ex;\n+            }\n+            case Error err -> {\n+                throw err;\n+            }\n+            default -> {\n+                \/\/ Unreachable\n+                throw reachedUnreachable();\n+            }\n@@ -45,0 +75,1 @@\n+    }\n@@ -46,1 +77,2 @@\n-        throw new ExceptionBox(throwable);\n+    public static Error reachedUnreachable() {\n+        return new AssertionError(\"Reached unreachable!\");\n@@ -49,2 +81,2 @@\n-    private ExceptionBox(Throwable throwable) {\n-        super(throwable);\n+    private ExceptionBox(Exception ex) {\n+        super(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ExceptionBox.java","additions":45,"deletions":13,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-public interface ThrowingBiConsumer<T, U> {\n+public interface ThrowingBiConsumer<T, U, E extends Exception> {\n@@ -32,1 +32,1 @@\n-    void accept(T t, U u) throws Throwable;\n+    void accept(T t, U u) throws E;\n@@ -35,1 +35,1 @@\n-            ThrowingBiConsumer<T, U> v) {\n+            ThrowingBiConsumer<T, U, ? extends Exception> v) {\n@@ -39,2 +39,2 @@\n-            } catch (Throwable ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            } catch (Exception ex) {\n+                throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ThrowingBiConsumer.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-public interface ThrowingBiFunction<T, U, R> {\n+public interface ThrowingBiFunction<T, U, R, E extends Exception> {\n@@ -32,1 +32,1 @@\n-    R apply(T t, U u) throws Throwable;\n+    R apply(T t, U u) throws E;\n@@ -35,1 +35,1 @@\n-            ThrowingBiFunction<T, U, R> v) {\n+            ThrowingBiFunction<T, U, R, ? extends Exception> v) {\n@@ -39,2 +39,2 @@\n-            } catch (Throwable ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            } catch (Exception ex) {\n+                throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ThrowingBiFunction.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-public interface ThrowingConsumer<T> {\n+public interface ThrowingConsumer<T, E extends Exception> {\n@@ -32,1 +32,1 @@\n-    void accept(T t) throws Throwable;\n+    void accept(T t) throws E;\n@@ -34,1 +34,1 @@\n-    public static <T> Consumer<T> toConsumer(ThrowingConsumer<T> v) {\n+    public static <T> Consumer<T> toConsumer(ThrowingConsumer<T, ? extends Exception> v) {\n@@ -38,2 +38,2 @@\n-            } catch (Throwable ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            } catch (Exception ex) {\n+                throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ThrowingConsumer.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-public interface ThrowingFunction<T, R> {\n+public interface ThrowingFunction<T, R, E extends Exception> {\n@@ -32,1 +32,1 @@\n-    R apply(T t) throws Throwable;\n+    R apply(T t) throws E;\n@@ -34,1 +34,1 @@\n-    public static <T, R> Function<T, R> toFunction(ThrowingFunction<T, R> v) {\n+    public static <T, R> Function<T, R> toFunction(ThrowingFunction<T, R, ? extends Exception> v) {\n@@ -38,2 +38,2 @@\n-            } catch (Throwable ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            } catch (Exception ex) {\n+                throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ThrowingFunction.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n-public interface ThrowingRunnable {\n+public interface ThrowingRunnable<E extends Exception> {\n@@ -30,1 +30,1 @@\n-    void run() throws Throwable;\n+    void run() throws E;\n@@ -32,1 +32,1 @@\n-    public static Runnable toRunnable(ThrowingRunnable v) {\n+    public static Runnable toRunnable(ThrowingRunnable<? extends Exception> v) {\n@@ -36,2 +36,2 @@\n-            } catch (Throwable ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            } catch (Exception ex) {\n+                throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ThrowingRunnable.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-public interface ThrowingSupplier<T> {\n+public interface ThrowingSupplier<T, E extends Exception> {\n@@ -32,1 +32,1 @@\n-    T get() throws Throwable;\n+    T get() throws E;\n@@ -34,1 +34,1 @@\n-    public static <T> Supplier<T> toSupplier(ThrowingSupplier<T> v) {\n+    public static <T> Supplier<T> toSupplier(ThrowingSupplier<T, ? extends Exception> v) {\n@@ -38,2 +38,2 @@\n-            } catch (Throwable ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            } catch (Exception ex) {\n+                throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ThrowingSupplier.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-public interface ThrowingUnaryOperator<T> {\n+public interface ThrowingUnaryOperator<T, E extends Exception> {\n@@ -32,1 +32,1 @@\n-    T apply(T t) throws Throwable;\n+    T apply(T t) throws E;\n@@ -35,1 +35,1 @@\n-            ThrowingUnaryOperator<T> v) {\n+            ThrowingUnaryOperator<T, ? extends Exception> v) {\n@@ -39,2 +39,2 @@\n-            } catch (Throwable ex) {\n-                throw ExceptionBox.rethrowUnchecked(ex);\n+            } catch (Exception ex) {\n+                throw ExceptionBox.toUnchecked(ex);\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/util\/function\/ThrowingUnaryOperator.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -37,1 +37,1 @@\n-        return Result.create(WixTool::createToolset).map(WinSystemEnvironment::new);\n+        return Result.of(WixTool::createToolset).map(WinSystemEnvironment::new);\n","filename":"src\/jdk.jpackage\/windows\/classes\/jdk\/jpackage\/internal\/WinSystemEnvironment.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,9 @@\n-            this(DottedVersion.greedy(app.version()));\n+            this(parse(app.version()));\n+        }\n+\n+        private static DottedVersion parse(String strVersion) {\n+            try {\n+                return DottedVersion.greedy(strVersion);\n+            } catch (IllegalArgumentException ex) {\n+                throw new JPackageException(ex.getMessage(), ex);\n+            }\n","filename":"src\/jdk.jpackage\/windows\/classes\/jdk\/jpackage\/internal\/model\/WinApplicationMixin.java","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -26,5 +26,0 @@\n-\n-app.bundler.name=Windows-Anwendungsimage\n-exe.bundler.name=EXE-Installationsprogrammpackage\n-msi.bundler.name=MSI-Installationsprogrammpackage\n-\n@@ -34,1 +29,0 @@\n-resource.setup-icon=Symbol fr Dialogfeld \"Setup\"\n@@ -68,1 +62,0 @@\n-message.creating-association-with-null-extension=Verknpfung mit Nullerweiterung wird erstellt.\n@@ -75,1 +68,0 @@\n-message.invalid.install.dir=Warnung: Ungltiges Installationsverzeichnis {0}. Installationsverzeichnis muss ein relativer Unterpfad unter dem Standardinstallationsverzeichnis wie \"Programme\" sein. Der Anwendungsname \"{1}\" wird als Standardwert verwendet.\n","filename":"src\/jdk.jpackage\/windows\/classes\/jdk\/jpackage\/internal\/resources\/WinResources_de.properties","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -26,5 +26,0 @@\n-\n-app.bundler.name=Windows\n-exe.bundler.name=EXE\n-msi.bundler.name=MSI\n-\n@@ -34,1 +29,0 @@\n-resource.setup-icon=\n@@ -68,1 +62,0 @@\n-message.creating-association-with-null-extension=null\n@@ -75,1 +68,0 @@\n-message.invalid.install.dir=: {0}(\"\")\"{1}\"\n","filename":"src\/jdk.jpackage\/windows\/classes\/jdk\/jpackage\/internal\/resources\/WinResources_ja.properties","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -26,5 +26,0 @@\n-\n-app.bundler.name=Windows \n-exe.bundler.name=EXE \n-msi.bundler.name=MSI \n-\n@@ -34,1 +29,0 @@\n-resource.setup-icon=\n@@ -68,1 +62,0 @@\n-message.creating-association-with-null-extension=\n@@ -75,1 +68,0 @@\n-message.invalid.install.dir= {0}  \"Program Files\" \"{1}\"\n","filename":"src\/jdk.jpackage\/windows\/classes\/jdk\/jpackage\/internal\/resources\/WinResources_zh_CN.properties","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -3365,1 +3365,13 @@\n-        try (BufferedWriter writer = Files.newBufferedWriter(toPathResolvingUserHome(filename),\n+        \/\/ Create missing parent directories before writing to target file\n+        Path target;\n+        try {\n+            target = toPathResolvingUserHome(filename);\n+            Path parent = target.getParent();\n+            if (parent != null) {\n+                Files.createDirectories(parent);\n+            }\n+        } catch (Exception e) {\n+            errormsg(\"jshell.err.file.exception\", \"\/save\", filename, e);\n+            return false;\n+        }\n+        try (BufferedWriter writer = Files.newBufferedWriter(target,\n","filename":"src\/jdk.jshell\/share\/classes\/jdk\/internal\/jshell\/tool\/JShellTool.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -138,1 +138,1 @@\n- *     <td>True if the diagnostic command is enabled, false otherwise<\/td>\n+ *     <td>This field is always true -- diagnostic commands cannot be disabled.<\/td>\n","filename":"src\/jdk.management\/share\/classes\/com\/sun\/management\/DiagnosticCommandMBean.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -42,4 +42,0 @@\n-\n-jdk\/javadoc\/doccheck\/checks\/jdkCheckLinks.java 8370249 generic-all\n-jdk\/javadoc\/doccheck\/checks\/jdkCheckHtml.java 8370970 generic-all\n-jdk\/javadoc\/doccheck\/checks\/jdkDoctypeBadcharsCheck.java 8370970 generic-all\n","filename":"test\/docs\/ProblemList.txt","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-#include \"utilities\/intn_t.hpp\"\n@@ -30,0 +29,5 @@\n+#include \"utilities\/intn_t.hpp\"\n+#include \"utilities\/rbTree.hpp\"\n+#include <array>\n+#include <limits>\n+#include <type_traits>\n@@ -32,5 +36,2 @@\n-static U uniform_random();\n-\n-template <>\n-juint uniform_random<juint>() {\n-  return os::random();\n+static U uniform_random() {\n+  return U(juint(os::random()));\n@@ -204,1 +205,1 @@\n-TEST_VM(opto, canonicalize_constraints) {\n+TEST(opto, canonicalize_constraints) {\n@@ -215,0 +216,410 @@\n+\n+\/\/ Implementations of TypeIntMirror methods for testing purposes\n+template <class S, class U>\n+const TypeIntMirror<S, U>* TypeIntMirror<S, U>::operator->() const {\n+  return this;\n+}\n+\n+template <class S, class U>\n+TypeIntMirror<S, U> TypeIntMirror<S, U>::meet(const TypeIntMirror& o) const {\n+  return TypeIntHelper::int_type_union(*this, o);\n+}\n+\n+template <class S, class U>\n+bool TypeIntMirror<S, U>::contains(U u) const {\n+  S s = S(u);\n+  return s >= _lo && s <= _hi && u >= _ulo && u <= _uhi && _bits.is_satisfied_by(u);\n+}\n+\n+template <class S, class U>\n+bool TypeIntMirror<S, U>::contains(const TypeIntMirror& o) const {\n+  return TypeIntHelper::int_type_is_subset(*this, o);\n+}\n+\n+template <class S, class U>\n+bool TypeIntMirror<S, U>::operator==(const TypeIntMirror& o) const {\n+  return TypeIntHelper::int_type_is_equal(*this, o);\n+}\n+\n+template <class S, class U>\n+template <class T>\n+TypeIntMirror<S, U> TypeIntMirror<S, U>::cast() const {\n+  static_assert(std::is_same_v<T, TypeIntMirror>);\n+  return *this;\n+}\n+\n+\/\/ The number of TypeIntMirror instances for integral types with a few bits. These values are\n+\/\/ calculated once and written down for usage in constexpr contexts.\n+template <class CTP>\n+static constexpr size_t all_instances_size() {\n+  using U = decltype(CTP::_ulo);\n+  constexpr juint max_unsigned = juint(std::numeric_limits<U>::max());\n+  if constexpr (max_unsigned == 1U) {\n+    \/\/ 1 bit\n+    return 3;\n+  } else if constexpr (max_unsigned == 3U) {\n+    \/\/ 2 bits\n+    return 15;\n+  } else if constexpr (max_unsigned == 7U) {\n+    \/\/ 3 bits\n+    return 134;\n+  } else {\n+    \/\/ 4 bits\n+    static_assert(max_unsigned == 15U);\n+    \/\/ For more than 4 bits, the number of instances is too large and it is not realistic to\n+    \/\/ compute all of them.\n+    return 1732;\n+  }\n+}\n+\n+template <class CTP>\n+static std::array<CTP, all_instances_size<CTP>()> compute_all_instances() {\n+  using S = decltype(CTP::_lo);\n+  using U = decltype(CTP::_ulo);\n+\n+  class CTPComparator {\n+  public:\n+    static RBTreeOrdering cmp(const CTP& x, const RBNode<CTP, int>* node) {\n+      \/\/ Quick helper for the tediousness below\n+      auto f = [](auto x, auto y) {\n+        assert(x != y, \"we only handle lt and gt cases\");\n+        return x < y ? RBTreeOrdering::LT : RBTreeOrdering::GT;\n+      };\n+\n+      const CTP& y = node->key();\n+      if (x._lo != y._lo) {\n+        return f(x._lo, y._lo);\n+      } else if (x._hi != y._hi) {\n+        return f(x._hi, y._hi);\n+      } else if (x._ulo != y._ulo) {\n+        return f(x._ulo, y._ulo);\n+      } else if (x._uhi != y._uhi) {\n+        return f(x._uhi, y._uhi);\n+      } else if (x._bits._zeros != y._bits._zeros) {\n+        return f(x._bits._zeros, y._bits._zeros);\n+      } else if (x._bits._ones != y._bits._ones) {\n+        return f(x._bits._ones, y._bits._ones);\n+      } else {\n+        return RBTreeOrdering::EQ;\n+      }\n+    }\n+  };\n+\n+  RBTreeCHeap<CTP, int, CTPComparator, MemTag::mtCompiler> collector;\n+  for (jint lo = jint(std::numeric_limits<S>::min()); lo <= jint(std::numeric_limits<S>::max()); lo++) {\n+    for (jint hi = lo; hi <= jint(std::numeric_limits<S>::max()); hi++) {\n+      for (juint ulo = 0; ulo <= juint(std::numeric_limits<U>::max()); ulo++) {\n+        for (juint uhi = ulo; uhi <= juint(std::numeric_limits<U>::max()); uhi++) {\n+          for (juint zeros = 0; zeros <= juint(std::numeric_limits<U>::max()); zeros++) {\n+            for (juint ones = 0; ones <= juint(std::numeric_limits<U>::max()); ones++) {\n+              TypeIntPrototype<S, U> t{{S(lo), S(hi)}, {U(ulo), U(uhi)}, {U(zeros), U(ones)}};\n+              auto canonicalized_t = t.canonicalize_constraints();\n+              if (canonicalized_t.empty()) {\n+                continue;\n+              }\n+\n+              TypeIntPrototype<S, U> ct = canonicalized_t._data;\n+              collector.upsert(CTP{ct._srange._lo, ct._srange._hi, ct._urange._lo, ct._urange._hi, ct._bits}, 0);\n+            }\n+          }\n+        }\n+      }\n+    }\n+  }\n+\n+  assert(collector.size() == all_instances_size<CTP>(), \"unexpected size of all_instance, expected %d, actual %d\", jint(all_instances_size<CTP>()), jint(collector.size()));\n+  std::array<CTP, all_instances_size<CTP>()> res;\n+  size_t idx = 0;\n+  collector.visit_in_order([&](RBNode<CTP, int>* node) {\n+    res[idx] = node->key();\n+    idx++;\n+    return true;\n+  });\n+  return res;\n+}\n+\n+template <class CTP>\n+static const std::array<CTP, all_instances_size<CTP>()>& all_instances() {\n+  static std::array<CTP, all_instances_size<CTP>()> res = compute_all_instances<CTP>();\n+  static_assert(std::is_trivially_destructible_v<decltype(res)>);\n+  return res;\n+}\n+\n+\/\/ Check the correctness, that is, if v1 is an element of input1, v2 is an element of input2, then\n+\/\/ op(v1, v2) must be an element of infer(input1, input2). This version does the check exhaustively\n+\/\/ on all elements of input1 and input2.\n+template <class InputType, class Operation, class Inference>\n+static void test_binary_instance_correctness_exhaustive(Operation op, Inference infer, const InputType& input1, const InputType& input2) {\n+  using S = std::remove_const_t<decltype(input1->_lo)>;\n+  using U = std::remove_const_t<decltype(input1->_ulo)>;\n+  InputType result = infer(input1, input2);\n+\n+  for (juint v1 = juint(std::numeric_limits<U>::min()); v1 <= juint(std::numeric_limits<U>::max()); v1++) {\n+    if (!input1.contains(U(v1))) {\n+      continue;\n+    }\n+\n+    for (juint v2 = juint(std::numeric_limits<U>::min()); v2 <= juint(std::numeric_limits<U>::max()); v2++) {\n+      if (!input2.contains(U(v2))) {\n+        continue;\n+      }\n+\n+      U r = op(U(v1), U(v2));\n+      ASSERT_TRUE(result.contains(r));\n+    }\n+  }\n+}\n+\n+\/\/ Check the correctness, that is, if v1 is an element of input1, v2 is an element of input2, then\n+\/\/ op(v1, v2) must be an element of infer(input1, input2). This version does the check randomly on\n+\/\/ a number of elements in input1 and input2.\n+template <class InputType, class Operation, class Inference>\n+static void test_binary_instance_correctness_samples(Operation op, Inference infer, const InputType& input1, const InputType& input2) {\n+  using U = std::remove_const_t<decltype(input1->_ulo)>;\n+  auto result = infer(input1, input2);\n+\n+  constexpr size_t sample_count = 6;\n+  U input1_samples[sample_count] {U(input1._lo), U(input1._hi), input1._ulo, input1._uhi, input1._ulo, input1._ulo};\n+  U input2_samples[sample_count] {U(input2._lo), U(input2._hi), input2._ulo, input2._uhi, input2._ulo, input2._ulo};\n+\n+  auto random_sample = [](U* samples, const InputType& input) {\n+    constexpr size_t max_tries = 100;\n+    constexpr size_t start_random_idx = 4;\n+    for (size_t tries = 0, idx = start_random_idx; tries < max_tries && idx < sample_count; tries++) {\n+      U n = uniform_random<U>();\n+      if (input.contains(n)) {\n+        samples[idx] = n;\n+        idx++;\n+      }\n+    }\n+  };\n+  random_sample(input1_samples, input1);\n+  random_sample(input2_samples, input2);\n+\n+  for (size_t i = 0; i < sample_count; i++) {\n+    for (size_t j = 0; j < sample_count; j++) {\n+      U r = op(input1_samples[i], input2_samples[j]);\n+      ASSERT_TRUE(result.contains(r));\n+    }\n+  }\n+}\n+\n+\/\/ Check the monotonicity, that is, if input1 is a subset of super1, input2 is a subset of super2,\n+\/\/ then infer(input1, input2) must be a subset of infer(super1, super2). This version does the\n+\/\/ check exhaustively on all supersets of input1 and input2.\n+template <class InputType, class Inference>\n+static void test_binary_instance_monotonicity_exhaustive(Inference infer, const InputType& input1, const InputType& input2) {\n+  InputType result = infer(input1, input2);\n+\n+  for (const InputType& super1 : all_instances<InputType>()) {\n+    if (!super1.contains(input1) || super1 == input1) {\n+      continue;\n+    }\n+\n+    for (const InputType& super2 : all_instances<InputType>()) {\n+      if (!super2.contains(input2) || super2 == input2) {\n+        continue;\n+      }\n+\n+      ASSERT_TRUE(infer(input1, super2).contains(result));\n+      ASSERT_TRUE(infer(super1, input2).contains(result));\n+      ASSERT_TRUE(infer(super1, super2).contains(result));\n+    }\n+  }\n+}\n+\n+\/\/ Check the monotonicity, that is, if input1 is a subset of super1, input2 is a subset of super2,\n+\/\/ then infer(input1, input2) must be a subset of infer(super1, super2). This version does the\n+\/\/ check randomly on a number of supersets of input1 and input2.\n+template <class InputType, class Inference>\n+static void test_binary_instance_monotonicity_samples(Inference infer, const InputType& input1, const InputType& input2) {\n+  using S = std::remove_const_t<decltype(input1->_lo)>;\n+  using U = std::remove_const_t<decltype(input1->_ulo)>;\n+  auto result = infer(input1, input2);\n+\n+  \/\/ The set that is a superset of all other sets\n+  InputType universe = InputType{std::numeric_limits<S>::min(), std::numeric_limits<S>::max(), U(0), U(-1), {U(0), U(0)}};\n+  ASSERT_TRUE(infer(universe, input2).contains(result));\n+  ASSERT_TRUE(infer(input1, universe).contains(result));\n+  ASSERT_TRUE(infer(universe, universe).contains(result));\n+\n+  auto random_superset = [](const InputType& input) {\n+    S lo = MIN2(input->_lo, S(uniform_random<U>()));\n+    S hi = MAX2(input->_hi, S(uniform_random<U>()));\n+    U ulo = MIN2(input->_ulo, uniform_random<U>());\n+    U uhi = MAX2(input->_uhi, uniform_random<U>());\n+    U zeros = input->_bits._zeros & uniform_random<U>();\n+    U ones = input->_bits._ones & uniform_random<U>();\n+    InputType super = InputType::make(TypeIntPrototype<S, U>{{lo, hi}, {ulo, uhi}, {zeros, ones}}, 0);\n+    assert(super.contains(input), \"impossible\");\n+    return super;\n+  };\n+\n+  InputType super1 = random_superset(input1);\n+  InputType super2 = random_superset(input2);\n+  ASSERT_TRUE(infer(super1, input2).contains(result));\n+  ASSERT_TRUE(infer(input1, super2).contains(result));\n+  ASSERT_TRUE(infer(super1, super2).contains(result));\n+}\n+\n+\/\/ Verify the correctness and monotonicity of an inference function by exhautively analyzing all\n+\/\/ instances of InputType\n+template <class InputType, class Operation, class Inference>\n+static void test_binary_exhaustive(Operation op, Inference infer) {\n+  for (const InputType& input1 : all_instances<InputType>()) {\n+    for (const InputType& input2 : all_instances<InputType>()) {\n+      test_binary_instance_correctness_exhaustive(op, infer, input1, input2);\n+      if (all_instances<InputType>().size() < 100) {\n+        \/\/ This effectively covers the cases up to uintn_t<2>\n+        test_binary_instance_monotonicity_exhaustive(infer, input1, input2);\n+      } else {\n+        \/\/ This effectively covers the cases of uintn_t<3>\n+        test_binary_instance_monotonicity_samples(infer, input1, input2);\n+      }\n+    }\n+  }\n+}\n+\n+\/\/ Verify the correctness and monotonicity of an inference function by randomly sampling instances\n+\/\/ of InputType\n+template <class InputType, class Operation, class Inference>\n+static void test_binary_random(Operation op, Inference infer) {\n+  using S = std::remove_const_t<decltype(InputType::_lo)>;\n+  using U = std::remove_const_t<decltype(InputType::_ulo)>;\n+\n+  constexpr size_t sample_count = 100;\n+  InputType samples[sample_count];\n+\n+  \/\/ Fill with {0}\n+  for (size_t i = 0; i < sample_count; i++) {\n+    samples[i] = InputType::make(TypeIntPrototype<S, U>{{S(0), S(0)}, {U(0), U(0)}, {U(0), U(0)}}, 0);\n+  }\n+\n+  \/\/ {1}\n+  samples[1] = InputType::make(TypeIntPrototype<S, U>{{S(1), S(1)}, {U(1), U(1)}, {U(0), U(0)}}, 0);\n+  \/\/ {-1}\n+  samples[2] = InputType::make(TypeIntPrototype<S, U>{{S(-1), S(-1)}, {U(-1), U(-1)}, {U(0), U(0)}}, 0);\n+  \/\/ {0, 1}\n+  samples[3] = InputType::make(TypeIntPrototype<S, U>{{S(0), S(1)}, {U(0), U(1)}, {U(0), U(0)}}, 0);\n+  \/\/ {-1, 0, 1}\n+  samples[4] = InputType::make(TypeIntPrototype<S, U>{{S(-1), S(1)}, {U(0), U(-1)}, {U(0), U(0)}}, 0);\n+  \/\/ {-1, 1}\n+  samples[5] = InputType::make(TypeIntPrototype<S, U>{{S(-1), S(1)}, {U(1), U(-1)}, {U(0), U(0)}}, 0);\n+  \/\/ {0, 1, 2}\n+  samples[6] = InputType::make(TypeIntPrototype<S, U>{{S(0), S(2)}, {U(0), U(2)}, {U(0), U(0)}}, 0);\n+  \/\/ {0, 2}\n+  samples[7] = InputType::make(TypeIntPrototype<S, U>{{S(0), S(2)}, {U(0), U(2)}, {U(1), U(0)}}, 0);\n+  \/\/ [min_signed, max_signed]\n+  samples[8] = InputType::make(TypeIntPrototype<S, U>{{std::numeric_limits<S>::min(), std::numeric_limits<S>::max()}, {U(0), U(-1)}, {U(0), U(0)}}, 0);\n+  \/\/ [0, max_signed]\n+  samples[9] = InputType::make(TypeIntPrototype<S, U>{{S(0), std::numeric_limits<S>::max()}, {U(0), U(-1)}, {U(0), U(0)}}, 0);\n+  \/\/ [min_signed, 0)\n+  samples[10] = InputType::make(TypeIntPrototype<S, U>{{std::numeric_limits<S>::min(), S(-1)}, {U(0), U(-1)}, {U(0), U(0)}}, 0);\n+\n+  constexpr size_t max_tries = 1000;\n+  constexpr size_t start_random_idx = 11;\n+  for (size_t tries = 0, idx = start_random_idx; tries < max_tries && idx < sample_count; tries++) {\n+    \/\/ Try to have lo < hi\n+    S signed_bound1 = S(uniform_random<U>());\n+    S signed_bound2 = S(uniform_random<U>());\n+    S lo = MIN2(signed_bound1, signed_bound2);\n+    S hi = MAX2(signed_bound1, signed_bound2);\n+\n+    \/\/ Try to have ulo < uhi\n+    U unsigned_bound1 = uniform_random<U>();\n+    U unsigned_bound2 = uniform_random<U>();\n+    U ulo = MIN2(unsigned_bound1, unsigned_bound2);\n+    U uhi = MAX2(unsigned_bound1, unsigned_bound2);\n+\n+    \/\/ Try to have (zeros & ones) == 0\n+    U zeros = uniform_random<U>();\n+    U ones = uniform_random<U>();\n+    U common = zeros & ones;\n+    zeros = zeros ^ common;\n+    ones = ones ^ common;\n+\n+    TypeIntPrototype<S, U> t{{lo, hi}, {ulo, uhi}, {zeros, ones}};\n+    auto canonicalized_t = t.canonicalize_constraints();\n+    if (canonicalized_t.empty()) {\n+      continue;\n+    }\n+\n+    samples[idx] = TypeIntMirror<S, U>{canonicalized_t._data._srange._lo, canonicalized_t._data._srange._hi,\n+                                       canonicalized_t._data._urange._lo, canonicalized_t._data._urange._hi,\n+                                       canonicalized_t._data._bits};\n+    idx++;\n+  }\n+\n+  for (size_t i = 0; i < sample_count; i++) {\n+    for (size_t j = 0; j < sample_count; j++) {\n+      test_binary_instance_correctness_samples(op, infer, samples[i], samples[j]);\n+      test_binary_instance_monotonicity_samples(infer, samples[i], samples[j]);\n+    }\n+  }\n+}\n+\n+template <template <class U> class Operation, template <class CTP> class Inference>\n+static void test_binary() {\n+  test_binary_exhaustive<TypeIntMirror<intn_t<1>, uintn_t<1>>>(Operation<uintn_t<1>>(), Inference<TypeIntMirror<intn_t<1>, uintn_t<1>>>());\n+  test_binary_exhaustive<TypeIntMirror<intn_t<2>, uintn_t<2>>>(Operation<uintn_t<2>>(), Inference<TypeIntMirror<intn_t<2>, uintn_t<2>>>());\n+  test_binary_exhaustive<TypeIntMirror<intn_t<3>, uintn_t<3>>>(Operation<uintn_t<3>>(), Inference<TypeIntMirror<intn_t<3>, uintn_t<3>>>());\n+  test_binary_random<TypeIntMirror<intn_t<4>, uintn_t<4>>>(Operation<uintn_t<4>>(), Inference<TypeIntMirror<intn_t<4>, uintn_t<4>>>());\n+  test_binary_random<TypeIntMirror<intn_t<5>, uintn_t<5>>>(Operation<uintn_t<5>>(), Inference<TypeIntMirror<intn_t<5>, uintn_t<5>>>());\n+  test_binary_random<TypeIntMirror<intn_t<6>, uintn_t<6>>>(Operation<uintn_t<6>>(), Inference<TypeIntMirror<intn_t<6>, uintn_t<6>>>());\n+  test_binary_random<TypeIntMirror<jint, juint>>(Operation<juint>(), Inference<TypeIntMirror<jint, juint>>());\n+  test_binary_random<TypeIntMirror<jlong, julong>>(Operation<julong>(), Inference<TypeIntMirror<jlong, julong>>());\n+}\n+\n+template <class U>\n+class OpAnd {\n+public:\n+  U operator()(U v1, U v2) const {\n+    return v1 & v2;\n+  }\n+};\n+\n+template <class CTP>\n+class InferAnd {\n+public:\n+  CTP operator()(CTP t1, CTP t2) const {\n+    return RangeInference::infer_and(t1, t2);\n+  }\n+};\n+\n+template <class U>\n+class OpOr {\n+public:\n+  U operator()(U v1, U v2) const {\n+    return v1 | v2;\n+  }\n+};\n+\n+template <class CTP>\n+class InferOr {\n+public:\n+  CTP operator()(CTP t1, CTP t2) const {\n+    return RangeInference::infer_or(t1, t2);\n+  }\n+};\n+\n+template <class U>\n+class OpXor {\n+public:\n+  U operator()(U v1, U v2) const {\n+    return v1 ^ v2;\n+  }\n+};\n+\n+template <class CTP>\n+class InferXor {\n+public:\n+  CTP operator()(CTP t1, CTP t2) const {\n+    return RangeInference::infer_xor(t1, t2);\n+  }\n+};\n+\n+TEST(opto, range_inference) {\n+  test_binary<OpAnd, InferAnd>();\n+  test_binary<OpOr, InferOr>();\n+  test_binary<OpXor, InferXor>();\n+}\n","filename":"test\/hotspot\/gtest\/opto\/test_rangeinference.cpp","additions":418,"deletions":7,"binary":false,"changes":425,"status":"modified"},{"patch":"@@ -1,102 +0,0 @@\n-\/*\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\n- *\/\n-\n-#include \"unittest.hpp\"\n-#include \"opto\/utilities\/xor.hpp\"\n-#include \"utilities\/globalDefinitions.hpp\" \/\/ For jint, juint\n-\n-jint test_calc_max(const jint hi_0, const jint hi_1) {\n-  return xor_upper_bound_for_ranges<jint, juint>(hi_0, hi_1);\n-}\n-\n-jlong test_calc_max(const jlong hi_0, const jlong hi_1) {\n-  return xor_upper_bound_for_ranges<jlong, julong>(hi_0, hi_1);\n-}\n-\n-template <class S>\n-void test_xor_bounds(S hi_0, S hi_1, S val_0, S val_1) {\n-  ASSERT_GE(hi_0, 0);\n-  ASSERT_GE(hi_1, 0);\n-\n-  \/\/ Skip out-of-bounds values for convenience\n-  if (val_0 > hi_0 || val_0 < S(0) || val_1 > hi_1 || val_1 < S(0)) {\n-    return;\n-  }\n-\n-  S v = val_0 ^ val_1;\n-  S max = test_calc_max(hi_0, hi_1);\n-  EXPECT_LE(v, max);\n-}\n-\n-template <class S>\n-void test_sample_values(S hi_0, S hi_1) {\n-  for (S i = 0; i <= 3; i++) {\n-    for (S j = 0; j <= 3; j++) {\n-      \/\/ Some bit combinations near the low and high ends of the range\n-      test_xor_bounds(hi_0, hi_1, i, j);\n-      test_xor_bounds(hi_0, hi_1, hi_0 - i, hi_1 - j);\n-    }\n-  }\n-}\n-\n-template <class S>\n-void test_in_ranges(S lo, S hi){\n-  ASSERT_GE(lo, 0);\n-  ASSERT_LE(lo, hi);\n-\n-  for (S hi_0 = lo; hi_0 <= hi; hi_0++) {\n-    for (S hi_1 = hi_0; hi_1 <=hi; hi_1++) {\n-      test_sample_values(hi_0, hi_1);\n-    }\n-  }\n-}\n-\n-template <class S>\n-void test_exhaustive(S limit) {\n-  for (S hi_0 = 0; hi_0 <= limit; hi_0++) {\n-    for (S hi_1 = hi_0; hi_1 <= limit; hi_1++) {\n-      for (S val_0 = 0; val_0 <= hi_0; val_0++) {\n-        for (S val_1 = val_0; val_1 <= hi_1; val_1++) {\n-          test_xor_bounds(hi_0, hi_1, val_0, val_1);\n-        }\n-      }\n-    }\n-  }\n-}\n-\n-template <class S>\n-void exec_tests() {\n-  S top_bit = max_power_of_2<S>();\n-  S prev_bit = top_bit >> 1;\n-\n-  test_exhaustive<S>(15);\n-\n-  test_in_ranges<S>(top_bit - 1, top_bit);\n-  test_in_ranges<S>(prev_bit - 1, prev_bit);\n-}\n-\n-TEST_VM(opto, xor_max) {\n-  exec_tests<jint>();\n-  exec_tests<jlong>();\n-}\n","filename":"test\/hotspot\/gtest\/opto\/test_xor_node.cpp","additions":0,"deletions":102,"binary":false,"changes":102,"status":"deleted"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"runtime\/os.hpp\"\n","filename":"test\/hotspot\/gtest\/runtime\/test_arguments.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+using testing::ContainsRegex;\n@@ -38,3 +39,13 @@\n-  stringStream ss;\n-  ClassPrinter::print_classes(\"java\/lang\/Object\", 0x03, &ss);\n-  const char* output = ss.freeze();\n+  stringStream s1;\n+  ClassPrinter::print_classes(\"java\/lang\/Object\", 0x03, &s1);\n+  const char* o1 = s1.freeze();\n+\n+  ASSERT_THAT(o1, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n+  ASSERT_THAT(o1, HasSubstr(\"method wait : (J)V\")) << \"must find java\/lang\/Object::wait\";\n+  ASSERT_THAT(o1, HasSubstr(\"method finalize : ()V\\n   0 return\")) << \"must find java\/lang\/Object::finalize and disasm\";\n+\n+  \/\/ \".\" should also work as separator in class name\n+  stringStream s2;\n+  ClassPrinter::print_classes(\"java.lang.Object\", 0x03, &s2);\n+  const char* o2 = s2.freeze();\n+  ASSERT_THAT(o2, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n@@ -42,3 +53,11 @@\n-  ASSERT_THAT(output, HasSubstr(\"class java\/lang\/Object loader data:\")) << \"must find java\/lang\/Object\";\n-  ASSERT_THAT(output, HasSubstr(\"method wait : (J)V\")) << \"must find java\/lang\/Object::wait\";\n-  ASSERT_THAT(output, HasSubstr(\"method finalize : ()V\\n   0 return\")) << \"must find java\/lang\/Object::finalize and disasm\";\n+  \/\/ 0x20 is PRINT_CLASS_DETAILS\n+  stringStream s3;\n+  ClassPrinter::print_classes(\"java.lang.Integer\", 0x20, &s3);\n+  const char* o3 = s3.freeze();\n+  ASSERT_THAT(o3, HasSubstr(\"class: java\/lang\/Integer mirror:\")) << \"must find java\/lang\/Integer\";\n+  ASSERT_THAT(o3, HasSubstr(\"InstanceKlass: java.lang.Integer {0x\")) << \"must print InstanceKlass\";\n+  ASSERT_THAT(o3, HasSubstr(\"Java mirror oop for java\/lang\/Integer:\")) << \"must print mirror oop\";\n+#if GTEST_USES_POSIX_RE\n+  \/\/ Complex regex not available on Windows\n+  ASSERT_THAT(o3, ContainsRegex(\"public static final 'MIN_VALUE' 'I'.* -2147483648 [(]0x80000000[)]\")) << \"must print static fields\";\n+#endif\n@@ -55,1 +74,1 @@\n-  ASSERT_THAT(o1, HasSubstr(\"class java\/lang\/Object loader data:\")) << \"must find java\/lang\/Object\";\n+  ASSERT_THAT(o1, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n@@ -63,1 +82,1 @@\n-  ASSERT_THAT(o2, HasSubstr(\"class java\/lang\/Object loader data:\")) << \"must find java\/lang\/Object\";\n+  ASSERT_THAT(o2, HasSubstr(\"class: java\/lang\/Object mirror:\")) << \"must find java\/lang\/Object\";\n@@ -67,0 +86,26 @@\n+\n+  \/\/ 0x02 is PRINT_BYTECODE\n+  \/\/ 0x04 is PRINT_BYTECODE_ADDRESS\n+  \/\/ 0x40 is PRINT_METHOD_DETAILS\n+  stringStream s3;\n+  ClassPrinter::print_methods(\"java.lang.Object\", \"wait:()V\", 0x46, &s3);\n+  const char* o3 = s3.freeze();\n+  ASSERT_THAT(o3, HasSubstr(\"method wait : ()V\")) << \"must find java\/lang\/Object::wait()\";\n+\n+#ifndef PRODUCT\n+  \/\/ PRINT_METHOD_DETAILS -- available only in debug builds\n+  ASSERT_THAT(o3, HasSubstr(\"{method}\")) << \"must print Method metadata\";\n+#if GTEST_USES_POSIX_RE\n+  \/\/ Complex regex not available on Windows\n+  ASSERT_THAT(o3, ContainsRegex(\"method holder:.*'java\/lang\/Object'\")) << \"must print Method metadata details\";\n+  ASSERT_THAT(o3, ContainsRegex(\"name: *'wait'\")) << \"must print Method metadata details\";\n+#endif\n+#endif\n+\n+#if GTEST_USES_POSIX_RE\n+  \/\/ Bytecodes: we should have at least one 'return' bytecide for Object.wait()\n+  \/\/ The print out should look like this:\n+  \/\/ 0x000000004adf73ad    5 return\n+  ASSERT_THAT(o3, ContainsRegex(\"0x[0-9a-f]+ +[0-9]+ +return\")) << \"must print return bytecode\";\n+#endif\n+\n","filename":"test\/hotspot\/gtest\/runtime\/test_classPrinter.cpp","additions":53,"deletions":8,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -52,0 +52,1 @@\n+compiler\/runtime\/Test7196199.java 8365196 windows-x64\n","filename":"test\/hotspot\/jtreg\/ProblemList.txt","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -525,0 +525,1 @@\n+ -runtime\/cds\/appcds\/cacheObject\/ArchiveHeapTestClass.java \\\n","filename":"test\/hotspot\/jtreg\/TEST.groups","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -0,0 +1,80 @@\n+\/*\n+ * Copyright (c) 2025, Red Hat, Inc. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8351889\n+ * @summary C2 crash: assertion failed: Base pointers must match (addp 344)\n+ * @run main\/othervm -XX:-BackgroundCompilation -XX:CompileOnly=TestMismatchedAddPAfterMaxUnroll::test1\n+ *                   -XX:+UnlockDiagnosticVMOptions -XX:+IgnoreUnrecognizedVMOptions -XX:-UseLoopPredicate\n+ *                   -XX:+StressIGVN -XX:StressSeed=383593806 -XX:VerifyIterativeGVN=10000\n+ *                   TestMismatchedAddPAfterMaxUnroll\n+ * @run main\/othervm -XX:-BackgroundCompilation -XX:CompileOnly=TestMismatchedAddPAfterMaxUnroll::test1\n+ *                   -XX:+UnlockDiagnosticVMOptions -XX:+IgnoreUnrecognizedVMOptions -XX:-UseLoopPredicate\n+ *                   -XX:+StressIGVN  -XX:VerifyIterativeGVN=10000 TestMismatchedAddPAfterMaxUnroll\n+ * @run main\/othervm TestMismatchedAddPAfterMaxUnroll\n+ *\/\n+\n+public class TestMismatchedAddPAfterMaxUnroll {\n+    private static C[] arrayField = new C[4];\n+\n+    public static void main(String[] args) {\n+        C c = new C();\n+        Object lock = new Object();\n+        for (int i = 0; i < 20_000; i++) {\n+            arrayField[3] = null;\n+            test1(3, c, arrayField, true, true, lock);\n+            arrayField[3] = null;\n+            test1(3, c, arrayField, true, false, lock);\n+            arrayField[3] = null;\n+            test1(3, c, arrayField, false, false, lock);\n+            arrayField[3] = c;\n+            test1(3, c, arrayField, false, false, lock);\n+        }\n+    }\n+\n+    static class C {\n+\n+    }\n+\n+    private static void test1(int j, C c, C[] otherArray, boolean flag, boolean flag2, Object lock) {\n+        C[] array = arrayField;\n+        int i = 0;\n+        for (;;) {\n+            synchronized (lock) {}\n+            if (array[j] == null) {\n+                break;\n+            }\n+            otherArray[i] = c;\n+            i++;\n+            if (i >= 3) {\n+                return;\n+            }\n+        }\n+        if (flag) {\n+            if (flag2) {\n+            }\n+        }\n+        array[j] = c;\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/TestMismatchedAddPAfterMaxUnroll.java","additions":80,"deletions":0,"binary":false,"changes":80,"status":"added"},{"patch":"@@ -0,0 +1,71 @@\n+\/*\n+ * Copyright (c) 2025 IBM Corporation. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8370200\n+ * @library \/test\/lib \/\n+ * @run driver ${test.main.class}\n+ *\/\n+\n+package compiler.c2;\n+\n+import compiler.lib.ir_framework.*;\n+import compiler.lib.ir_framework.Test;\n+\n+public class TestReplaceNarrowPhiWithBottomPhi {\n+    private int field1;\n+    private volatile int field2;\n+\n+    static public void main(String[] args) {\n+        TestFramework.run();\n+    }\n+\n+    @Test\n+    @IR(counts = { IRNode.PHI, \"2\" })\n+    public void test1() {\n+        int j;\n+        for (j = 0; j < 10; j++) {\n+\n+        }\n+        inlined1(j);\n+\n+        \/\/ Initially, there are 2 memory Phis: one for bottom, one for field1. After loop opts, both\n+        \/\/ Phis have the same inputs and the narrower Phi should be replaced by the bottom Phi.\n+        for (int i = 1; i < 100; i *= 2) {\n+            field2 = 42;\n+        }\n+    }\n+\n+    private void inlined1(int j) {\n+        if (j == 42) {\n+            field1 = 42;\n+        }\n+    }\n+\n+    @Run(test = \"test1\")\n+    private void test1Runner() {\n+        test1();\n+        inlined1(42);\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/TestReplaceNarrowPhiWithBottomPhi.java","additions":71,"deletions":0,"binary":false,"changes":71,"status":"added"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8238756\n+ * @bug 8238756 8351889\n@@ -28,1 +28,1 @@\n- * @summary Run with -Xcomp to test -XX:VerifyIterativeGVN=1111 in debug builds.\n+ * @summary Run with -Xcomp to test -XX:VerifyIterativeGVN=11111 in debug builds.\n@@ -30,1 +30,1 @@\n- * @run main\/othervm\/timeout=300 -Xcomp -XX:VerifyIterativeGVN=1111 compiler.c2.TestVerifyIterativeGVN\n+ * @run main\/othervm\/timeout=300 -Xcomp -XX:VerifyIterativeGVN=11111 compiler.c2.TestVerifyIterativeGVN\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/TestVerifyIterativeGVN.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n- * @run driver compiler.c2.irTests.TestConditionalMove\n+ * @run driver ${test.main.class}\n@@ -604,1 +604,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -622,1 +622,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -640,1 +640,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -658,1 +658,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -676,1 +676,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -694,1 +694,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -712,1 +712,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -730,1 +730,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -748,1 +748,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -766,1 +766,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -785,1 +785,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -803,1 +803,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -821,1 +821,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -839,1 +839,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -857,1 +857,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -875,1 +875,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -899,1 +899,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -928,1 +928,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -951,1 +951,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -970,1 +970,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -989,1 +989,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1007,1 +1007,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1025,1 +1025,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1043,1 +1043,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1061,1 +1061,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1079,1 +1079,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1097,1 +1097,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1116,1 +1116,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1135,1 +1135,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1154,1 +1154,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1354,1 +1354,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1376,1 +1376,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1398,1 +1398,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1420,1 +1420,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1442,1 +1442,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1464,1 +1464,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1479,1 +1479,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1493,1 +1493,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1507,1 +1507,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1521,1 +1521,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1535,1 +1535,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1549,1 +1549,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1734,1 +1734,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1748,1 +1748,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1762,1 +1762,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1776,1 +1776,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1790,1 +1790,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1804,1 +1804,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1827,1 +1827,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1850,1 +1850,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1873,1 +1873,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1896,1 +1896,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1919,1 +1919,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -1942,1 +1942,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2137,1 +2137,1 @@\n-            applyIfPlatform = {\"riscv64\", \"true\"})\n+            applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2159,1 +2159,1 @@\n-            applyIfPlatform = {\"riscv64\", \"true\"})\n+            applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2181,1 +2181,1 @@\n-            applyIfPlatform = {\"riscv64\", \"true\"})\n+            applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2203,1 +2203,1 @@\n-            applyIfPlatform = {\"riscv64\", \"true\"})\n+            applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2225,1 +2225,1 @@\n-            applyIfPlatform = {\"riscv64\", \"true\"})\n+            applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2247,1 +2247,1 @@\n-            applyIfPlatform = {\"riscv64\", \"true\"})\n+            applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2262,1 +2262,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2276,1 +2276,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2290,1 +2290,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2304,1 +2304,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2318,1 +2318,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2332,1 +2332,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2517,1 +2517,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2531,1 +2531,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2545,1 +2545,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2559,1 +2559,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2573,1 +2573,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2587,1 +2587,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2610,1 +2610,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2633,1 +2633,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2656,1 +2656,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2679,1 +2679,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2702,1 +2702,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2725,1 +2725,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2775,1 +2775,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2789,1 +2789,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2831,1 +2831,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2852,1 +2852,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2874,1 +2874,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n@@ -2895,1 +2895,1 @@\n-        applyIfPlatform = {\"riscv64\", \"true\"})\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"x64\", \"true\", \"aarch64\", \"true\"})\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/cmove\/TestConditionalMove.java","additions":85,"deletions":85,"binary":false,"changes":170,"previous_filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/TestConditionalMove.java","status":"renamed"},{"patch":"@@ -33,1 +33,0 @@\n- * @requires os.arch == \"riscv64\"\n@@ -36,1 +35,1 @@\n- * @run driver compiler.c2.irTests.TestFPComparison2\n+ * @run driver ${test.main.class}\n@@ -112,1 +111,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -127,1 +127,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -142,1 +143,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -152,1 +154,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -162,1 +165,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -172,1 +176,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -182,1 +187,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -192,1 +198,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -341,1 +348,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -356,1 +364,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -371,1 +380,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -381,1 +391,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -391,1 +402,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -401,1 +413,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -411,1 +424,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -421,1 +435,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -569,1 +584,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -584,1 +600,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -599,1 +616,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -609,1 +627,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -619,1 +638,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -629,1 +649,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -639,1 +660,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -649,1 +671,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -797,1 +820,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -812,1 +836,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -827,1 +852,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -837,1 +863,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -847,1 +874,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -857,1 +885,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -867,1 +896,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -877,1 +907,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1025,1 +1056,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1040,1 +1072,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1055,1 +1088,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1065,1 +1099,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1075,1 +1110,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1085,1 +1121,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1095,1 +1132,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1105,1 +1143,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1253,1 +1292,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1268,1 +1308,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1283,1 +1324,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1293,1 +1335,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1303,1 +1346,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1313,1 +1357,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1323,1 +1368,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1333,1 +1379,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1481,1 +1528,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1496,1 +1544,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1511,1 +1560,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1521,1 +1571,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1531,1 +1582,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1541,1 +1593,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1551,1 +1604,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1561,1 +1615,2 @@\n-    @IR(counts = {IRNode.CMOVE_I, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_I, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1709,1 +1764,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1724,1 +1780,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1739,1 +1796,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1749,1 +1807,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1759,1 +1818,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1769,1 +1829,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1779,1 +1840,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1789,1 +1851,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1937,1 +2000,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1947,1 +2011,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1957,1 +2022,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -1967,1 +2033,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -2041,1 +2108,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -2051,1 +2119,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -2061,1 +2130,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n@@ -2071,1 +2141,2 @@\n-    @IR(counts = {IRNode.CMOVE_F, \"1\"})\n+    @IR(counts = {IRNode.CMOVE_F, \"1\"},\n+        applyIfPlatformOr = {\"riscv64\", \"true\", \"aarch64\", \"true\"})\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/cmove\/TestFPComparison2.java","additions":145,"deletions":74,"binary":false,"changes":219,"previous_filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/TestFPComparison2.java","status":"renamed"},{"patch":"@@ -34,1 +34,0 @@\n- * @requires vm.simpleArch == \"riscv64\"\n@@ -36,1 +35,1 @@\n- * @run driver compiler.c2.irTests.TestScalarConditionalMoveCmpObj\n+ * @run driver ${test.main.class}\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/cmove\/TestScalarConditionalMoveCmpObj.java","additions":1,"deletions":2,"binary":false,"changes":3,"previous_filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/TestScalarConditionalMoveCmpObj.java","status":"renamed"},{"patch":"@@ -66,0 +66,6 @@\n+    \/\/ Note: we used to check for ConD nodes in the IR. But that is a bit brittle:\n+    \/\/ Constant nodes can appear during IR transformations, and then lose their outputs.\n+    \/\/ During IGNV, the constants stay in the graph even if they lose the inputs. But\n+    \/\/ CCP cleans them out because they are not in the useful set. So for now, we do not\n+    \/\/ rely on any constant counting, just on counting the operation nodes.\n+\n@@ -67,2 +73,4 @@\n-    @IR(failOn = {\"drem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_D, \"1\"})\n+    @IR(counts = {IRNode.MOD_D, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -75,2 +83,6 @@\n-    @IR(failOn = {\"drem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_D, \"1\"})\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ Only constant fold after some loop opts\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -89,2 +101,6 @@\n-    @IR(failOn = {\"drem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_D, \"1\"})\n+    @IR(counts = {IRNode.MOD_D, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"2\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ Only constant fold after some loop opts\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -103,2 +119,6 @@\n-    @IR(failOn = {\"drem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_D, \"1\"})\n+    @IR(counts = {IRNode.MOD_D, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"2\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ Only constant fold after some loop opts\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -117,2 +137,4 @@\n-    @IR(counts = {\"drem\", \"1\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_D, \"1\"})\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"1\"},\n+        phase = CompilePhase.BEFORE_MATCHING) \/\/ no constant folding\n@@ -124,2 +146,4 @@\n-    @IR(counts = {\"drem\", \"2\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_D, \"1\"})\n+    @IR(counts = {IRNode.MOD_D, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"2\"},\n+        phase = CompilePhase.BEFORE_MATCHING) \/\/ no constant folding\n@@ -131,2 +155,6 @@\n-    @IR(failOn = IRNode.MOD_D, phase = CompilePhase.ITER_GVN1)\n-    @IR(counts = {IRNode.MOD_D, \"1\"}, phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"0\"},\n+        phase = CompilePhase.ITER_GVN1) \/\/ IGVN removes unused nodes\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -138,2 +166,6 @@\n-    @IR(failOn = IRNode.MOD_D, phase = CompilePhase.ITER_GVN1)\n-    @IR(counts = {IRNode.MOD_D, \"1\"}, phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"0\"},\n+        phase = CompilePhase.ITER_GVN1) \/\/ IGVN removes unused nodes\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -152,2 +184,8 @@\n-    @IR(counts = {IRNode.MOD_D, \"1\"}, phase = CompilePhase.ITER_GVN2)\n-    @IR(failOn = IRNode.MOD_D, phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.ITER_GVN2)\n+    @IR(counts = {IRNode.MOD_D, \"0\"},\n+        phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -171,2 +209,8 @@\n-    @IR(counts = {IRNode.MOD_D, \"1\"}, phase = CompilePhase.AFTER_CLOOPS)\n-    @IR(failOn = IRNode.MOD_D, phase = CompilePhase.PHASEIDEALLOOP1)\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"1\"},\n+        phase = CompilePhase.AFTER_CLOOPS)\n+    @IR(counts = {IRNode.MOD_D, \"0\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1)\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -190,2 +234,8 @@\n-    @IR(counts = {IRNode.MOD_D, \"2\"}, phase = CompilePhase.AFTER_CLOOPS)\n-    @IR(failOn = IRNode.MOD_D, phase = CompilePhase.PHASEIDEALLOOP1)\n+    @IR(counts = {IRNode.MOD_D, \"3\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_D, \"2\"},\n+        phase = CompilePhase.AFTER_CLOOPS) \/\/ drop the useless one\n+    @IR(counts = {IRNode.MOD_D, \"0\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ drop the rest\n+    @IR(counts = {\".*CallLeaf.*drem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/ModDNodeTests.java","additions":72,"deletions":22,"binary":false,"changes":94,"status":"modified"},{"patch":"@@ -66,0 +66,6 @@\n+    \/\/ Note: we used to check for ConF nodes in the IR. But that is a bit brittle:\n+    \/\/ Constant nodes can appear during IR transformations, and then lose their outputs.\n+    \/\/ During IGNV, the constants stay in the graph even if they lose the inputs. But\n+    \/\/ CCP cleans them out because they are not in the useful set. So for now, we do not\n+    \/\/ rely on any constant counting, just on counting the operation nodes.\n+\n@@ -67,2 +73,4 @@\n-    @IR(failOn = {\"frem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_F, \"1\"})\n+    @IR(counts = {IRNode.MOD_F, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -75,2 +83,6 @@\n-    @IR(failOn = {\"frem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_F, \"1\"})\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ Only constant fold after some loop opts\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -89,2 +101,6 @@\n-    @IR(failOn = {\"frem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_F, \"1\"})\n+    @IR(counts = {IRNode.MOD_F, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"2\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ Only constant fold after some loop opts\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -103,2 +119,6 @@\n-    @IR(failOn = {\"frem\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_F, \"1\"})\n+    @IR(counts = {IRNode.MOD_F, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"2\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ Only constant fold after some loop opts\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -117,2 +137,4 @@\n-    @IR(counts = {\"frem\", \"1\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_F, \"1\"})\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"1\"},\n+        phase = CompilePhase.BEFORE_MATCHING) \/\/ no constant folding\n@@ -124,2 +146,4 @@\n-    @IR(counts = {\"frem\", \"2\"}, phase = CompilePhase.BEFORE_MATCHING)\n-    @IR(counts = {IRNode.CON_F, \"1\"})\n+    @IR(counts = {IRNode.MOD_F, \"2\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"2\"},\n+        phase = CompilePhase.BEFORE_MATCHING) \/\/ no constant folding\n@@ -131,2 +155,6 @@\n-    @IR(failOn = IRNode.MOD_F, phase = CompilePhase.ITER_GVN1)\n-    @IR(counts = {IRNode.MOD_F, \"1\"}, phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"0\"},\n+        phase = CompilePhase.ITER_GVN1) \/\/ IGVN removes unused nodes\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -138,2 +166,6 @@\n-    @IR(failOn = IRNode.MOD_F, phase = CompilePhase.ITER_GVN1)\n-    @IR(counts = {IRNode.MOD_F, \"1\"}, phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"0\"},\n+        phase = CompilePhase.ITER_GVN1) \/\/ IGVN removes unused nodes\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -152,2 +184,8 @@\n-    @IR(counts = {IRNode.MOD_F, \"1\"}, phase = CompilePhase.ITER_GVN2)\n-    @IR(failOn = IRNode.MOD_F, phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.ITER_GVN2)\n+    @IR(counts = {IRNode.MOD_F, \"0\"},\n+        phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -171,2 +209,8 @@\n-    @IR(counts = {IRNode.MOD_F, \"1\"}, phase = CompilePhase.AFTER_CLOOPS)\n-    @IR(failOn = IRNode.MOD_F, phase = CompilePhase.PHASEIDEALLOOP1)\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"1\"},\n+        phase = CompilePhase.AFTER_CLOOPS)\n+    @IR(counts = {IRNode.MOD_F, \"0\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1)\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n@@ -190,2 +234,8 @@\n-    @IR(counts = {IRNode.MOD_F, \"2\"}, phase = CompilePhase.AFTER_CLOOPS)\n-    @IR(failOn = IRNode.MOD_F, phase = CompilePhase.PHASEIDEALLOOP1)\n+    @IR(counts = {IRNode.MOD_F, \"3\"},\n+        phase = CompilePhase.AFTER_PARSING)\n+    @IR(counts = {IRNode.MOD_F, \"2\"},\n+        phase = CompilePhase.AFTER_CLOOPS) \/\/ drop the useless one\n+    @IR(counts = {IRNode.MOD_F, \"0\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1) \/\/ drop the rest\n+    @IR(counts = {\".*CallLeaf.*frem.*\", \"0\"},\n+        phase = CompilePhase.BEFORE_MATCHING)\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/irTests\/ModFNodeTests.java","additions":72,"deletions":22,"binary":false,"changes":94,"status":"modified"},{"patch":"@@ -93,1 +93,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_F2I_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_F2I_AVX10_2, \"> 0\"},\n@@ -109,1 +109,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_F2L_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_F2L_AVX10_2, \"> 0\"},\n@@ -125,1 +125,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_F2I_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_F2I_AVX10_2, \"> 0\"},\n@@ -141,1 +141,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_F2I_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_F2I_AVX10_2, \"> 0\"},\n@@ -157,1 +157,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_D2I_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_D2I_AVX10_2, \"> 0\"},\n@@ -173,1 +173,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_D2L_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_D2L_AVX10_2, \"> 0\"},\n@@ -189,1 +189,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_D2I_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_D2I_AVX10_2, \"> 0\"},\n@@ -205,1 +205,1 @@\n-    @IR(counts = {IRNode.X86_SCONV_D2I_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_SCONV_D2I_AVX10_2, \"> 0\"},\n","filename":"test\/hotspot\/jtreg\/compiler\/floatingpoint\/ScalarFPtoIntCastTest.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -0,0 +1,153 @@\n+\/*\n+ * Copyright (c) 2025, Red Hat, Inc.\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8371716\n+ * @summary Ranges can be proven to be disjoint but not orderable (thanks to unsigned range)\n+ *          Comparing such values in such range with != should always be true.\n+ * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions\n+ *                   -XX:-TieredCompilation\n+ *                   -XX:-UseOnStackReplacement\n+ *                   -XX:-BackgroundCompilation\n+ *                   -XX:CompileOnly=${test.main.class}::test1\n+ *                   -XX:CompileCommand=quiet\n+ *                   -XX:TypeProfileLevel=222\n+ *                   -XX:+AlwaysIncrementalInline\n+ *                   -XX:VerifyIterativeGVN=10\n+ *                   -XX:CompileCommand=dontinline,${test.main.class}::notInlined1\n+ *                   ${test.main.class}\n+ *\n+ * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions\n+ *                   -XX:+UnlockDiagnosticVMOptions\n+ *                   -XX:-TieredCompilation\n+ *                   -XX:-UseOnStackReplacement\n+ *                   -XX:-BackgroundCompilation\n+ *                   -XX:CompileOnly=${test.main.class}::test2\n+ *                   -XX:CompileOnly=${test.main.class}::inlined3\n+ *                   -XX:CompileCommand=quiet\n+ *                   -XX:TypeProfileLevel=200\n+ *                   -XX:+AlwaysIncrementalInline\n+ *                   -XX:VerifyIterativeGVN=10\n+ *                   -XX:CompileCommand=dontinline,${test.main.class}::notInlined1\n+ *                   -XX:+StressIncrementalInlining\n+ *                   ${test.main.class}\n+ *\n+ * @run main ${test.main.class}\n+ *\/\n+\n+package compiler.igvn;\n+\n+public class ClashingSpeculativeTypePhiNode {\n+    public static void main(String[] args) {\n+        main1();\n+        main2();\n+    }\n+\n+    \/\/ 1st case\n+\n+    static void main1() {\n+        for (int i = 0; i < 20_000; i++) {\n+            test1(false);         \/\/ returns null\n+            inlined1(true, true); \/\/ returns C1\n+            inlined2(false);      \/\/ returns C2\n+        }\n+    }\n+\n+    private static Object test1(boolean flag1) {\n+        return inlined1(flag1, false);\n+        \/\/ When inlined1 is inlined\n+        \/\/ return Phi(flag1, inlined2(flag2), null)\n+        \/\/ inlined2 is speculatively returning C1, known from the calls `inlined1(true, true)` in main1\n+        \/\/ Phi node gets speculative type C1\n+        \/\/ When inline2 is inlined\n+        \/\/ return Phi[C1](flag1, Phi(false, new C1(), notInlined1()), null)\n+        \/\/ => Phi[C1](flag1, notInlined1(), null)\n+        \/\/ notInlined1 is speculatively returning C2, known from `inline2(false)` in main1\n+        \/\/ return Phi[C1](flag1, notInlined1()[C2], null)\n+        \/\/ Clashing speculative type between Phi's _type (C1) and union of inputs (C2).\n+    }\n+\n+    private static Object inlined1(boolean flag1, boolean flag2) {\n+        if (flag1) {\n+            return inlined2(flag2); \/\/ C1\n+        }\n+        return null;\n+    }\n+\n+    private static Object inlined2(boolean flag2) {\n+        if (flag2) {\n+            return new C1();\n+        }\n+        return notInlined1(); \/\/ C2\n+    }\n+\n+    private static Object notInlined1() {\n+        return new C2();\n+    }\n+\n+    \/\/ 2nd case\n+\n+    static void main2() {\n+        for (int i = 0; i < 20_000; i++) {\n+            inlined3(new C1());\n+        }\n+        for (int i = 0; i < 20_000; i++) {\n+            test2(true, new C2());\n+            test2(false, new C2());\n+        }\n+    }\n+\n+\n+    private static Object test2(boolean flag1, Object o) {\n+        o = inlined4(o);\n+        if (flag1) {\n+            return inlined3(o);\n+        }\n+        return null;\n+        \/\/ We profile only parameters. Param o is speculated to be C2.\n+        \/\/ return Phi(flag1, inline3(inline4(o[C2])), null)\n+        \/\/ We inline inline3\n+        \/\/ return Phi(flag1, inline4(o[C2])[C1], null)\n+        \/\/ As input of inline3, inline4(o) is speculated to be C1. The Phi has C1 as speculative type in _type\n+        \/\/ return Phi[C1](flag1, o[C2], null)\n+        \/\/ Since o is speculated to be C2 as parameter of test2, we get a clash.\n+    }\n+\n+    private static Object inlined3(Object o) {\n+        return o; \/\/ C1\n+    }\n+\n+    private static Object inlined4(Object o) {\n+        return o;\n+    }\n+\n+    static class C1 {\n+\n+    }\n+\n+    static class C2 {\n+\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/igvn\/ClashingSpeculativeTypePhiNode.java","additions":153,"deletions":0,"binary":false,"changes":153,"status":"added"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8359412\n+ * @bug 8359412 8370922\n@@ -30,0 +30,1 @@\n+ * @modules jdk.incubator.vector\n@@ -58,0 +59,1 @@\n+import static compiler.lib.template_framework.library.CodeGenerationDataNameType.SCALAR_NUMERIC_TYPES;\n@@ -87,1 +89,1 @@\n-        comp.compile();\n+        comp.compile(\"--add-modules=jdk.incubator.vector\");\n@@ -90,1 +92,5 @@\n-        comp.invoke(\"compiler.igvn.templated.ExpressionFuzzerInnerTest\", \"main\", new Object[] {new String[] {}});\n+        comp.invoke(\"compiler.igvn.templated.ExpressionFuzzerInnerTest\", \"main\", new Object[] {new String[] {\n+            \"--add-modules=jdk.incubator.vector\",\n+            \"--add-opens\", \"jdk.incubator.vector\/jdk.incubator.vector=ALL-UNNAMED\",\n+            \"--add-opens\", \"java.base\/java.lang=ALL-UNNAMED\"\n+        }});\n@@ -192,1 +198,1 @@\n-                case \"float\", \"double\" -> \"val\";\n+                case \"float\", \"double\", \"Float16\" -> \"val\";\n@@ -195,1 +201,1 @@\n-                default -> throw new RuntimeException(\"should only be primitive types\");\n+                default -> throw new RuntimeException(\"type not supported yet: \" + expression.returnType.name());\n@@ -227,1 +233,1 @@\n-                case \"boolean\", \"float\", \"double\" -> \"return v;\\n\";\n+                case \"boolean\", \"float\", \"double\", \"Float16\" -> \"return v;\\n\";\n@@ -244,1 +250,1 @@\n-                default -> throw new RuntimeException(\"should only be primitive types\");\n+                default -> throw new RuntimeException(\"type not supported yet: \" + type.name());\n@@ -328,0 +334,1 @@\n+            \/\/ Prmitive expressions are most important, so let's create many expressions per output type.\n@@ -336,0 +343,15 @@\n+        \/\/ Generate expressions with any scalar numeric types.\n+        for (CodeGenerationDataNameType type : SCALAR_NUMERIC_TYPES) {\n+            \/\/ The extended set of scalar numeric expressions (incl. special types such as Float16) are relevant\n+            \/\/ but don't currently warrant the same number amount of testing time, so we only create 2 cases\n+            \/\/ per type. Note: this still produces a lot of expressions, given that we have a lot of output\n+            \/\/ types, and even if the output type is \"float\", we can still use other types in the expression,\n+            \/\/ such as \"float -> Float16 -> float\". We can consider adjusting this arbitrary count in the future.\n+            for (int i = 0; i < 2; i++) {\n+                \/\/ The depth determines roughly how many operations are going to be used in the expression.\n+                int depth = RANDOM.nextInt(1, 20);\n+                Expression expression = Expression.nestRandomly(type, Operations.SCALAR_NUMERIC_OPERATIONS, depth);\n+                tests.add(testTemplate.asToken(expression));\n+            }\n+        }\n+\n@@ -344,1 +366,2 @@\n-                   \"compiler.lib.generators.*\"),\n+                   \"compiler.lib.generators.*\",\n+                   \"jdk.incubator.vector.Float16\"),\n","filename":"test\/hotspot\/jtreg\/compiler\/igvn\/ExpressionFuzzer.java","additions":31,"deletions":8,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -0,0 +1,505 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package compiler.igvn;\n+\n+import compiler.lib.generators.*;\n+import compiler.lib.ir_framework.*;\n+import jdk.test.lib.Asserts;\n+\n+\/*\n+ * @test\n+ * @bug 8364766\n+ * @summary Test value method of DivINode and DivLNode\n+ * @key randomness\n+ * @library \/test\/lib \/\n+ * @run driver compiler.igvn.IntegerDivValueTests\n+ *\/\n+public class IntegerDivValueTests {\n+    private static final RestrictableGenerator<Integer> INTS = Generators.G.ints();\n+    private static final RestrictableGenerator<Long> LONGS = Generators.G.longs();\n+\n+    public static void main(String[] args) {\n+        TestFramework.run();\n+    }\n+\n+    @ForceInline\n+    private int getIntConstant(int value) {\n+        \/\/ Simply return the given value to avoid javac already optimizing the operation away\n+        return value;\n+    }\n+\n+    private static final int INT_CONST_1 = INTS.next();\n+    private static final int INT_CONST_2 = INTS.next();\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public int testIntConstantFolding() {\n+        \/\/ All constants available during parsing\n+        return INT_CONST_1 \/ INT_CONST_2;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public int testIntConstantFoldingSpecialCase() {\n+        \/\/ All constants available during parsing\n+        return getIntConstant(Integer.MIN_VALUE) \/ getIntConstant(-1);\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public int testIntRange(int in) {\n+        int a = (in & 7) + 16;\n+        return a \/ 12; \/\/ [16, 23] \/ 12 is constant 1\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public boolean testIntRange2(int in) {\n+        int a = (in & 7) + 16;\n+        return a \/ 4 > 3; \/\/ [16, 23] \/ 4 => [4, 5]\n+    }\n+\n+    @Test\n+    @IR(counts = {IRNode.DIV_I, \"1\"})\n+    public boolean testIntRange3(int in, int in2) {\n+        int a = (in & 31) + 16;\n+        int b = (in2 & 3) + 5;\n+        return a \/ b > 4; \/\/ [16, 47] \/ [5, 8] => [2, 9]\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public boolean testIntRange4(int in, int in2) {\n+        int a = (in & 15); \/\/ [0, 15]\n+        int b = (in2 & 3) + 1; \/\/ [1, 4]\n+        return a \/ b >= 0;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public boolean testIntRange5(int in, int in2) {\n+        int a = (in & 15) + 5; \/\/ [5, 20]\n+        int b = (in2 & 3) + 1; \/\/ [1, 4]\n+        return a \/ b > 0;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public boolean testIntRange6(int in, int in2) {\n+        int a = (in & 15) + 5; \/\/ [5, 20]\n+        int b = (in2 & 7) - 1; \/\/ [-1, 5]\n+        if (b == 0) return false;\n+        return a \/ b < -20;\n+    }\n+\n+    @Test\n+    @IR(counts = {IRNode.DIV_I, \"1\"})\n+    public boolean testIntRange7(int in, int in2) {\n+        int a = (in & 15) + 5; \/\/ [5, 20]\n+        int b = (in2 & 7) - 1; \/\/ [-1, 5]\n+        if (b == 0) return false;\n+        return a \/ b > 0;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public int testIntRange8(int in, int in2) {\n+        int a = (in & 31) + 128; \/\/ [128, 159]\n+        int b = (in2 & 15) + 100; \/\/ [100, 115]\n+        return a \/ b; \/\/ [1, 1] -> can be constant\n+    }\n+\n+    private static final int INT_LIMIT_1 = INTS.next();\n+    private static final int INT_LIMIT_2 = INTS.next();\n+    private static final int INT_LIMIT_3 = INTS.next();\n+    private static final int INT_LIMIT_4 = INTS.next();\n+    private static final int INT_LIMIT_5 = INTS.next();\n+    private static final int INT_LIMIT_6 = INTS.next();\n+    private static final int INT_LIMIT_7 = INTS.next();\n+    private static final int INT_LIMIT_8 = INTS.next();\n+    private static final int INT_RANGE_LIMIT_X_LO;\n+    private static final int INT_RANGE_LIMIT_X_HI;\n+    private static final int INT_RANGE_LIMIT_Y_LO;\n+    private static final int INT_RANGE_LIMIT_Y_HI;\n+\n+    static {\n+        int limit1 = INTS.next();\n+        int limit2 = INTS.next();\n+        if (limit2 > limit1) {\n+            INT_RANGE_LIMIT_X_LO = limit1;\n+            INT_RANGE_LIMIT_X_HI = limit2;\n+        } else {\n+            INT_RANGE_LIMIT_X_LO = limit2;\n+            INT_RANGE_LIMIT_X_HI = limit1;\n+        }\n+\n+        int limit3 = INTS.next();\n+        int limit4 = INTS.next();\n+        if (limit4 > limit3) {\n+            INT_RANGE_LIMIT_Y_LO = limit3;\n+            INT_RANGE_LIMIT_Y_HI = limit4;\n+        } else {\n+            INT_RANGE_LIMIT_Y_LO = limit4;\n+            INT_RANGE_LIMIT_Y_HI = limit3;\n+        }\n+    }\n+\n+    @ForceInline\n+    private int clampInt(int val, int lo, int hi) {\n+        return Math.min(hi, Math.max(val, lo));\n+    }\n+\n+    @ForceInline\n+    private int calculateIntSum(int z) {\n+        int sum = 0;\n+        if (z < INT_LIMIT_1) sum += 1;\n+        if (z < INT_LIMIT_2) sum += 2;\n+        if (z < INT_LIMIT_3) sum += 4;\n+        if (z < INT_LIMIT_4) sum += 8;\n+        if (z > INT_LIMIT_5) sum += 16;\n+        if (z > INT_LIMIT_6) sum += 32;\n+        if (z > INT_LIMIT_7) sum += 64;\n+        if (z > INT_LIMIT_8) sum += 128;\n+\n+        return sum;\n+    }\n+\n+    @Test\n+    public int testIntRandomLimits(int x, int y) {\n+        x = clampInt(x, INT_RANGE_LIMIT_X_LO, INT_RANGE_LIMIT_X_HI);\n+        y = clampInt(y, INT_RANGE_LIMIT_Y_LO, INT_RANGE_LIMIT_Y_HI);\n+        int z = x \/ y;\n+\n+        return calculateIntSum(z);\n+    }\n+\n+    @DontCompile\n+    public int testIntRandomLimitsInterpreted(int x, int y) {\n+        x = clampInt(x, INT_RANGE_LIMIT_X_LO, INT_RANGE_LIMIT_X_HI);\n+        y = clampInt(y, INT_RANGE_LIMIT_Y_LO, INT_RANGE_LIMIT_Y_HI);\n+        int z = x \/ y;\n+\n+        return calculateIntSum(z);\n+    }\n+\n+    @Run(test = {\"testIntConstantFolding\", \"testIntConstantFoldingSpecialCase\"})\n+    public void checkIntConstants(RunInfo info) {\n+        Asserts.assertEquals(INT_CONST_1 \/ INT_CONST_2, testIntConstantFolding());\n+        Asserts.assertEquals(Integer.MIN_VALUE, testIntConstantFoldingSpecialCase());\n+    }\n+\n+    @Run(test = {\"testIntRange\", \"testIntRange2\", \"testIntRange3\", \"testIntRange4\", \"testIntRange5\", \"testIntRange6\", \"testIntRange7\", \"testIntRange8\", \"testIntRandomLimits\"})\n+    public void checkIntRanges(RunInfo info) {\n+        for (int j = 0; j < 20; j++) {\n+            int i1 = INTS.next();\n+            int i2 = INTS.next();\n+            checkInt(i1, i2);\n+        }\n+    }\n+\n+    @DontCompile\n+    public void checkInt(int in, int in2) {\n+        int a;\n+        int b;\n+        a = (in & 7) + 16;\n+        Asserts.assertEquals(a \/ 12, testIntRange(in));\n+\n+        a = (in & 7) + 16;\n+        Asserts.assertEquals(a \/ 4 > 3, testIntRange2(in));\n+\n+        a = (in & 31) + 16;\n+        b = (in2 & 3) + 5;\n+        Asserts.assertEquals(a \/ b > 4, testIntRange3(in, in2));\n+\n+        a = (in & 15);\n+        b = (in2 & 3) + 1;\n+        Asserts.assertEquals(a \/ b >= 0, testIntRange4(in, in2));\n+\n+        a = (in & 15) + 5;\n+        b = (in2 & 3) + 1;\n+        Asserts.assertEquals(a \/ b > 0, testIntRange5(in, in2));\n+\n+        a = (in & 15) + 5;\n+        b = (in2 & 7) - 1;\n+        Asserts.assertEquals(b == 0 ? false : a \/ b < -20, testIntRange6(in, in2));\n+\n+        a = (in & 15) + 5;\n+        b = (in2 & 7) - 1;\n+        Asserts.assertEquals(b == 0 ? false : a \/ b > 0, testIntRange7(in, in2));\n+\n+        a = (in & 31) + 128;\n+        b = (in2 & 15) + 100;\n+        Asserts.assertEquals(a \/ b, testIntRange8(in, in2));\n+\n+        int res;\n+        try {\n+            res = testIntRandomLimitsInterpreted(a, b);\n+        } catch (ArithmeticException _) {\n+            try {\n+                testIntRandomLimits(a, b);\n+                Asserts.fail(\"Expected ArithmeticException\");\n+                return; \/\/ unreachable\n+            } catch (ArithmeticException _) {\n+                return; \/\/ test succeeded, no result to assert\n+            }\n+        }\n+        Asserts.assertEQ(res, testIntRandomLimits(a, b));\n+    }\n+\n+    \/\/ Long variants\n+\n+    @ForceInline\n+    private long getLongConstant(long value) {\n+        \/\/ Simply return the given value to avoid javac already optimizing the operation away\n+        return value;\n+    }\n+\n+    private static final long LONG_CONST_1 = LONGS.next();\n+    private static final long LONG_CONST_2 = LONGS.next();\n+\n+    @Test\n+    \/\/@IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    \/\/ This results in a series of nodes due to DivLNode::Ideal and in particular transform_long_divide, which operates on non-constant divisors.\n+    \/\/ transform_long_divide splits up the division into multiple other nodes, such as MulHiLNode, which does not have a good Value() implemantion.\n+    \/\/ When JDK-8366815 is fixed, these rules should be reenabled\n+    \/\/ Alternatively, a better MulHiLNode::Value() implemantion should also lead to constant folding\n+    public long testLongConstantFolding() {\n+        \/\/ All constants available during parsing\n+        return LONG_CONST_1 \/ LONG_CONST_2;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public long testLongConstantFoldingSpecialCase() {\n+        \/\/ All constants available during parsing\n+        return getLongConstant(Long.MIN_VALUE) \/ getLongConstant(-1L);\n+    }\n+\n+    @Test\n+    \/\/@IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    \/\/ This results in a series of nodes due to DivLNode::Ideal and in particular transform_long_divide, which operates on non-constant divisors.\n+    \/\/ transform_long_divide splits up the division into multiple other nodes, such as MulHiLNode, which does not have a good Value() implemantion.\n+    \/\/ When JDK-8366815 is fixed, these rules should be reenabled\n+    \/\/ Alternatively, a better MulHiLNode::Value() implemantion should also lead to constant folding\n+    @IR(counts = {IRNode.RSHIFT_L, \"> 0\", IRNode.ADD_L, \"> 0\", IRNode.AND_L, \"> 0\"}, failOn = {IRNode.DIV})\n+    public long testLongRange(long in) {\n+        long a = (in & 7L) + 16L;\n+        return a \/ 12L; \/\/ [16, 23] \/ 12 is constant 1\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public boolean testLongRange2(long in) {\n+        long a = (in & 7L) + 16L;\n+        return a \/ 4L > 3L; \/\/ [16, 23] \/ 4 => [4, 5]\n+    }\n+\n+    @Test\n+    @IR(counts = {IRNode.DIV_L, \"1\"})\n+    public boolean testLongRange3(long in, long in2) {\n+        long a = (in & 31L) + 16L;\n+        long b = (in2 & 3L) + 5L;\n+        return a \/ b > 4L; \/\/ [16, 47] \/ [5, 8] => [2, 9]\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+\n+    public boolean testLongRange4(long in, long in2) {\n+        long a = (in & 15L); \/\/ [0, 15]\n+        long b = (in2 & 3L) + 1L; \/\/ [1, 4]\n+        return a \/ b >= 0L;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public boolean testLongRange5(long in, long in2) {\n+        long a = (in & 15L) + 5L; \/\/ [5, 20]\n+        long b = (in2 & 3L) + 1L; \/\/ [1, 4]\n+        return a \/ b > 0L;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public boolean testLongRange6(long in, long in2) {\n+        long a = (in & 15L) + 5L; \/\/ [5, 20]\n+        long b = (in2 & 7L) - 1L; \/\/ [-1, 5]\n+        if (b == 0L) return false;\n+        return a \/ b < -20L;\n+    }\n+\n+    @Test\n+    @IR(counts = {IRNode.DIV_L, \"1\"})\n+    public boolean testLongRange7(long in, long in2) {\n+        long a = (in & 15L) + 5L; \/\/ [5, 20]\n+        long b = (in2 & 7L) - 1L; \/\/ [-1, 5]\n+        if (b == 0L) return false;\n+        return a \/ b > 0L;\n+    }\n+\n+    @Test\n+    @IR(failOn = {IRNode.DIV, IRNode.URSHIFT, IRNode.RSHIFT, IRNode.MUL, IRNode.ADD, IRNode.SUB, IRNode.AND})\n+    public long testLongRange8(long in, long in2) {\n+        long a = (in & 31L) + 128L; \/\/ [128, 159]\n+        long b = (in2 & 15L) + 100L; \/\/ [100, 115]\n+        return a \/ b; \/\/ [1, 1] -> can be constant\n+    }\n+\n+\n+    private static final long LONG_LIMIT_1 = LONGS.next();\n+    private static final long LONG_LIMIT_2 = LONGS.next();\n+    private static final long LONG_LIMIT_3 = LONGS.next();\n+    private static final long LONG_LIMIT_4 = LONGS.next();\n+    private static final long LONG_LIMIT_5 = LONGS.next();\n+    private static final long LONG_LIMIT_6 = LONGS.next();\n+    private static final long LONG_LIMIT_7 = LONGS.next();\n+    private static final long LONG_LIMIT_8 = LONGS.next();\n+    private static final long LONG_RANGE_LIMIT_X_LO;\n+    private static final long LONG_RANGE_LIMIT_X_HI;\n+    private static final long LONG_RANGE_LIMIT_Y_LO;\n+    private static final long LONG_RANGE_LIMIT_Y_HI;\n+\n+    static {\n+        long limit1 = LONGS.next();\n+        long limit2 = LONGS.next();\n+        if (limit2 > limit1) {\n+            LONG_RANGE_LIMIT_X_LO = limit1;\n+            LONG_RANGE_LIMIT_X_HI = limit2;\n+        } else {\n+            LONG_RANGE_LIMIT_X_LO = limit2;\n+            LONG_RANGE_LIMIT_X_HI = limit1;\n+        }\n+\n+        long limit3 = LONGS.next();\n+        long limit4 = LONGS.next();\n+        if (limit4 > limit3) {\n+            LONG_RANGE_LIMIT_Y_LO = limit3;\n+            LONG_RANGE_LIMIT_Y_HI = limit4;\n+        } else {\n+            LONG_RANGE_LIMIT_Y_LO = limit4;\n+            LONG_RANGE_LIMIT_Y_HI = limit3;\n+        }\n+    }\n+\n+    @ForceInline\n+    private long clampLong(long val, long lo, long hi) {\n+        return Math.min(hi, Math.max(val, lo));\n+    }\n+\n+    @ForceInline\n+    private int calculateLongSum(long z) {\n+        int sum = 0;\n+        if (z < LONG_LIMIT_1) sum += 1;\n+        if (z < LONG_LIMIT_2) sum += 2;\n+        if (z < LONG_LIMIT_3) sum += 4;\n+        if (z < LONG_LIMIT_4) sum += 8;\n+        if (z > LONG_LIMIT_5) sum += 16;\n+        if (z > LONG_LIMIT_6) sum += 32;\n+        if (z > LONG_LIMIT_7) sum += 64;\n+        if (z > LONG_LIMIT_8) sum += 128;\n+\n+        return sum;\n+    }\n+\n+    @Test\n+    public int testLongRandomLimits(long x, long y) {\n+        x = clampLong(x, LONG_RANGE_LIMIT_X_LO, LONG_RANGE_LIMIT_X_HI);\n+        y = clampLong(y, LONG_RANGE_LIMIT_Y_LO, LONG_RANGE_LIMIT_Y_HI);\n+        long z = x \/ y;\n+\n+        return calculateLongSum(z);\n+    }\n+\n+    @DontCompile\n+    public int testLongRandomLimitsInterpreted(long x, long y) {\n+        x = clampLong(x, LONG_RANGE_LIMIT_X_LO, LONG_RANGE_LIMIT_X_HI);\n+        y = clampLong(y, LONG_RANGE_LIMIT_Y_LO, LONG_RANGE_LIMIT_Y_HI);\n+        long z = x \/ y;\n+\n+        return calculateLongSum(z);\n+    }\n+\n+    @Run(test = {\"testLongConstantFolding\", \"testLongConstantFoldingSpecialCase\"})\n+    public void checkLongConstants(RunInfo infoLong) {\n+        Asserts.assertEquals(LONG_CONST_1 \/ LONG_CONST_2, testLongConstantFolding());\n+        Asserts.assertEquals(Long.MIN_VALUE, testLongConstantFoldingSpecialCase());\n+    }\n+\n+    @Run(test = {\"testLongRange\", \"testLongRange2\", \"testLongRange3\", \"testLongRange4\", \"testLongRange5\", \"testLongRange6\", \"testLongRange7\", \"testLongRange8\", \"testLongRandomLimits\"})\n+    public void checkLongRanges(RunInfo info) {\n+        for (int j = 0; j < 20; j++) {\n+            long l1 = LONGS.next();\n+            long l2 = LONGS.next();\n+            checkLong(l1, l2);\n+        }\n+    }\n+\n+    @DontCompile\n+    public void checkLong(long in, long in2) {\n+        long a;\n+        long b;\n+        a = (in & 7L) + 16L;\n+        Asserts.assertEquals(a \/ 12L, testLongRange(in));\n+\n+        a = (in & 7L) + 16L;\n+        Asserts.assertEquals(a \/ 4L > 3L, testLongRange2(in));\n+\n+        a = (in & 31L) + 16L;\n+        b = (in2 & 3L) + 5L;\n+        Asserts.assertEquals(a \/ b > 4L, testLongRange3(in, in2));\n+\n+        a = (in & 15L);\n+        b = (in2 & 3L) + 1L;\n+        Asserts.assertEquals(a \/ b >= 0L, testLongRange4(in, in2));\n+\n+        a = (in & 15L) + 5L;\n+        b = (in2 & 3L) + 1L;\n+        Asserts.assertEquals(a \/ b > 0L, testLongRange5(in, in2));\n+\n+        a = (in & 15L) + 5L;\n+        b = (in2 & 7L) - 1L;\n+        Asserts.assertEquals(b == 0 ? false : a \/ b < -20L, testLongRange6(in, in2));\n+\n+        a = (in & 15L) + 5L;\n+        b = (in2 & 7L) - 1L;\n+        Asserts.assertEquals(b == 0 ? false : a \/ b > 0L, testLongRange7(in, in2));\n+\n+        a = (in & 31L) + 128L;\n+        b = (in2 & 15L) + 100L;\n+        Asserts.assertEquals(a \/ b, testLongRange8(in, in2));\n+\n+        int res;\n+        try {\n+            res = testLongRandomLimitsInterpreted(a, b);\n+        } catch (ArithmeticException _) {\n+            try {\n+                testLongRandomLimits(a, b);\n+                Asserts.fail(\"Expected ArithmeticException\");\n+                return; \/\/ unreachable\n+            } catch (ArithmeticException _) {\n+                return; \/\/ test succeeded, no result to assert\n+            }\n+        }\n+        Asserts.assertEQ(res, testLongRandomLimits(a, b));\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/igvn\/IntegerDivValueTests.java","additions":505,"deletions":0,"binary":false,"changes":505,"status":"added"},{"patch":"@@ -0,0 +1,140 @@\n+\/*\n+ * Copyright (c) 2025 IBM Corporation. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8373396\n+ * @summary Verify that min\/max add ideal optimizations get applied correctly\n+ * @modules java.base\/jdk.internal.misc\n+ * @library \/test\/lib \/\n+ * @run driver ${test.main.class}\n+ *\/\n+\n+package compiler.igvn;\n+\n+import compiler.lib.compile_framework.CompileFramework;\n+import compiler.lib.template_framework.Template;\n+import compiler.lib.template_framework.TemplateToken;\n+import compiler.lib.template_framework.library.CodeGenerationDataNameType;\n+import compiler.lib.template_framework.library.PrimitiveType;\n+import compiler.lib.template_framework.library.TestFrameworkClass;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+import static compiler.lib.template_framework.Template.let;\n+import static compiler.lib.template_framework.Template.scope;\n+\n+public class TestMinMaxIdeal {\n+    public static void main(String[] args) {\n+        \/\/ Create a new CompileFramework instance.\n+        CompileFramework comp = new CompileFramework();\n+\n+        \/\/ Add a java source file.\n+        comp.addJavaSourceCode(\"compiler.igvn.templated.MinMaxIdeal\", generate(comp));\n+\n+        \/\/ Compile the source file.\n+        comp.compile();\n+\n+        comp.invoke(\"compiler.igvn.templated.MinMaxIdeal\", \"main\", new Object[] {new String[] {}});\n+    }\n+\n+    private static String generate(CompileFramework comp) {\n+        \/\/ Create a list to collect all tests.\n+        List<TemplateToken> testTemplateTokens = Stream.of(Op.values())\n+            .map(op -> new TestGenerator(op).generate())\n+            .toList();\n+\n+        \/\/ Create the test class, which runs all testTemplateTokens.\n+        return TestFrameworkClass.render(\n+            \/\/ package and class name.\n+            \"compiler.igvn.templated\", \"MinMaxIdeal\",\n+            \/\/ List of imports.\n+            Collections.emptySet(),\n+            \/\/ classpath, so the Test VM has access to the compiled class files.\n+            comp.getEscapedClassPathOfCompiledClasses(),\n+            \/\/ The list of tests.\n+            testTemplateTokens);\n+    }\n+\n+    enum Op {\n+        MIN_I(\"min\", CodeGenerationDataNameType.ints()),\n+        MAX_I(\"max\", CodeGenerationDataNameType.ints()),\n+        MIN_L(\"min\", CodeGenerationDataNameType.longs()),\n+        MAX_L(\"max\", CodeGenerationDataNameType.longs());\n+\n+        final String functionName;\n+        final PrimitiveType type;\n+\n+        Op(String functionName, PrimitiveType type) {\n+            this.functionName = functionName;\n+            this.type = type;\n+        }\n+    }\n+\n+    record TestGenerator(Op op) {\n+        TemplateToken generate() {\n+            var template = Template.make(() -> scope(\n+                let(\"boxedTypeName\", op.type.boxedTypeName()),\n+                let(\"op\", op.name()),\n+                let(\"type\", op.type.name()),\n+                let(\"functionName\", op.functionName),\n+                \"\"\"\n+                @Test\n+                @IR(counts = {IRNode.#op, \"= 1\"},\n+                    phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+                @Arguments(values = {Argument.NUMBER_42, Argument.NUMBER_42})\n+                public #type test_commute_#op(#type a, #type b) {\n+                    return #boxedTypeName.#functionName(a, b) + #boxedTypeName.#functionName(b, a);\n+                }\n+\n+                @Test\n+                @IR(counts = {IRNode.#op, \"= 1\"},\n+                    phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+                @Arguments(values = {Argument.NUMBER_42})\n+                public #type test_flatten_#op(#type a) {\n+                    return #boxedTypeName.#functionName(#boxedTypeName.#functionName(a, 1), 2);\n+                }\n+\n+                @Test\n+                @IR(counts = {IRNode.#op, \"= 2\"},\n+                    phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+                @Arguments(values = {Argument.NUMBER_42, Argument.NUMBER_42})\n+                public #type test_push_constant_left_#op(#type a, #type b) {\n+                    return #boxedTypeName.#functionName(#boxedTypeName.#functionName(a, 1), b) + #boxedTypeName.#functionName(b, a);\n+                }\n+\n+                @Test\n+                @IR(counts = {IRNode.#op, \"= 2\"},\n+                    phase = CompilePhase.BEFORE_MACRO_EXPANSION)\n+                @Arguments(values = {Argument.NUMBER_42, Argument.NUMBER_42})\n+                public #type test_push_constant_right_#op(#type a, #type b) {\n+                    return #boxedTypeName.#functionName(a, #boxedTypeName.#functionName(b, 1)) + #boxedTypeName.#functionName(b, a);\n+                }\n+                \"\"\"\n+            ));\n+            return template.asToken();\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/igvn\/TestMinMaxIdeal.java","additions":140,"deletions":0,"binary":false,"changes":140,"status":"added"},{"patch":"@@ -0,0 +1,89 @@\n+\/*\n+ * Copyright (c) 2025 IBM Corporation. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8373524\n+ * @summary C2: no reachable node should have no use\n+ * @run main\/othervm -Xbatch ${test.main.class}\n+ * @run main ${test.main.class}\n+ *\/\n+\n+package compiler.igvn;\n+\n+public class TestNodeWithNoUseAfterPhiIdeal {\n+    volatile boolean _mutatorToggle;\n+\n+    boolean _mutatorFlip() {\n+        synchronized (TestNodeWithNoUseAfterPhiIdeal.class) {\n+            _mutatorToggle = new MyBoolean(!_mutatorToggle).v;\n+            return _mutatorToggle;\n+        }\n+    }\n+\n+    class MyBoolean {\n+        boolean v;\n+        MyBoolean(boolean v) {\n+            int N = 32;\n+            for (int i = 0; i < N; i++) {\n+                this.v = v;\n+            }\n+        }\n+    }\n+\n+    int[] arr;\n+    void test() {\n+        int limit = 2;\n+        boolean flag1 = _mutatorFlip();\n+        for (; limit < 4; limit *= 2) {\n+            if (flag1) {\n+                break;\n+            }\n+        }\n+        int zero = 34;\n+        for (int peel = 2; peel < limit; peel++) {\n+            synchronized (TestNodeWithNoUseAfterPhiIdeal.class) {\n+                zero = 0;\n+            }\n+        }\n+        if (zero == 0) {\n+            arr = new int[8];\n+        } else {\n+            int M = 4;\n+            for (int i = 0; i < M; i++) {\n+                boolean flag2 = _mutatorFlip();\n+                boolean flag3 = _mutatorFlip();\n+                if (flag2) {\n+                    break;\n+                }\n+            }\n+        }\n+    }\n+\n+    public static void main(String[] args) {\n+        TestNodeWithNoUseAfterPhiIdeal t = new TestNodeWithNoUseAfterPhiIdeal();\n+        for (int i = 0; i < 10_000; i++) {\n+            t.test();\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/igvn\/TestNodeWithNoUseAfterPhiIdeal.java","additions":89,"deletions":0,"binary":false,"changes":89,"status":"added"},{"patch":"@@ -0,0 +1,479 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @summary 8372634\n+ *\n+ * @requires vm.flagless\n+ * @library \/test\/lib \/\n+ *\n+ * @run driver compiler.inlining.TestSubtypeCheckTypeInfo\n+ *\/\n+package compiler.inlining;\n+\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+import java.lang.reflect.Method;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+public class TestSubtypeCheckTypeInfo {\n+    static final Class<TestSubtypeCheckTypeInfo> THIS_CLASS = TestSubtypeCheckTypeInfo.class;\n+    static final String TEST_CLASS_NAME = THIS_CLASS.getName();\n+\n+    public static void main(String[] args) throws Exception {\n+        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n+                \"-XX:+IgnoreUnrecognizedVMOptions\", \"-showversion\",\n+                \"-XX:-TieredCompilation\", \"-Xbatch\", \"-XX:CICompilerCount=1\",\n+                \"-XX:+PrintCompilation\", \"-XX:+UnlockDiagnosticVMOptions\", \"-XX:+PrintInlining\",\n+                \"-XX:CompileCommand=quiet\",\n+                \"-XX:CompileCommand=compileonly,\" +  TEST_CLASS_NAME + \"::test*\",\n+                \"-XX:CompileCommand=delayinline,\" +  TEST_CLASS_NAME + \"::lateInline*\",\n+                TestSubtypeCheckTypeInfo.Launcher.class.getName());\n+\n+        OutputAnalyzer analyzer = new OutputAnalyzer(pb.start());\n+\n+        analyzer.shouldHaveExitValue(0);\n+\n+        \/\/ The test is applicable only to C2 (present in Server VM).\n+        if (analyzer.getStderr().contains(\"Server VM\")) {\n+            List<String> output = analyzer.asLinesWithoutVMWarnings();\n+\n+            parseOutput(output);\n+            System.out.println(\"TEST PASSED\");\n+        }\n+    }\n+\n+    static class Launcher {\n+        public static void main(String[] args) {\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOf);\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfCondPre);\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfCondPost);\n+\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstance);\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceCondPre);\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceCondPost);\n+\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfLate);\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfLateCondPre);\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfLateCondPost);\n+\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceLate);\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceLateCondPre);\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceLateCondPost);\n+\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfCondLate);\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfCondLatePre);\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfCondLatePost);\n+\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceCondLate);\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceCondLatePre);\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceCondLatePost);\n+\n+            runTestCase(TestSubtypeCheckTypeInfo::testInstanceOfNulls);\n+            runTestCase(TestSubtypeCheckTypeInfo::testIsInstanceNulls);\n+        }\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    @InlineSuccess\n+    \/\/ @ 8   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testInstanceOf(A o, boolean cond) {\n+        if (o instanceof B) {\n+            o.m();\n+        }\n+    }\n+\n+    @InlineSuccess\n+    \/\/ @ 12   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testInstanceOfCondPre(A o, boolean cond) {\n+        if (cond && (o instanceof B)) {\n+            o.m();\n+        }\n+    }\n+\n+    @InlineSuccess\n+    \/\/ @ 12   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testInstanceOfCondPost(A o, boolean cond) {\n+        if ((o instanceof B) && cond) {\n+            o.m();\n+        }\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    @InlineSuccess\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 3   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 10   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testIsInstance(A o, boolean cond) {\n+        if (B.class.isInstance(o)) {\n+            o.m();\n+        }\n+    }\n+\n+    @InlineSuccess\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 7   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 14   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testIsInstanceCondPre(A o, boolean cond) {\n+        if (cond && B.class.isInstance(o)) {\n+            o.m();\n+        }\n+    }\n+\n+    @InlineSuccess\n+    \/\/ @ 3   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 14   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testIsInstanceCondPost(A o, boolean cond) {\n+        if (B.class.isInstance(o) && cond) {\n+            o.m();\n+        }\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    @InlineSuccess\n+    \/\/ @ 5   compiler.inlining.TestSubtypeCheckTypeInfo::lateInline (9 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 5   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testInstanceOfLate(A o, boolean cond) {\n+        \/\/ if (o instanceof B) { o.m(); }\n+        lateInline(o, o instanceof B);\n+    }\n+\n+    @InlineFailure\n+    \/\/ @ 17   compiler.inlining.TestSubtypeCheckTypeInfo::lateInline (9 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 5   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testInstanceOfLateCondPre(A o, boolean cond) {\n+        \/\/ if (cond && o instanceof B) { o.m(); }\n+        lateInline(o, cond && (o instanceof B));\n+    }\n+\n+    @InlineFailure\n+    \/\/ @ 17   compiler.inlining.TestSubtypeCheckTypeInfo::lateInline (9 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 5   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testInstanceOfLateCondPost(A o, boolean cond) {\n+        \/\/ if ((o instanceof B) && cond) { o.m(); }\n+        lateInline(o, (o instanceof B) && cond);\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    @InlineSuccess\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 4   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 7   compiler.inlining.TestSubtypeCheckTypeInfo::lateInline (9 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 5   compiler.inlining.TestSubtypeCheckTypeInfo$B::m (1 bytes)   inline (hot)\n+    static void testIsInstanceLate(A o, boolean cond) {\n+        \/\/ if (B.class.isInstance(o)) { o.m(); }\n+        lateInline(o, B.class.isInstance(o));\n+    }\n+\n+    @InlineFailure\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 8   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 19   compiler.inlining.TestSubtypeCheckTypeInfo::lateInline (9 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 5   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testIsInstanceLateCondPre(A o, boolean cond) {\n+        \/\/ if (cond && B.class.isInstance(o)) { o.m(); }\n+        lateInline(o, cond && (B.class.isInstance(o)));\n+    }\n+\n+    @InlineFailure\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 4   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 19   compiler.inlining.TestSubtypeCheckTypeInfo::lateInline (9 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 5   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testIsInstanceLateCondPost(A o, boolean cond) {\n+        \/\/ if (B.class.isInstance(o) && cond) { o.m(); }\n+        lateInline(o, (B.class.isInstance(o) && cond));\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    @InlineFailure\n+    \/\/ @ 2   compiler.inlining.TestSubtypeCheckTypeInfo::lateInlineInstanceOfCondPre (17 bytes)   inline (hot)   late inline succeeded\n+    \/\/ @ 9   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testInstanceOfCondLate(A a, boolean cond) {\n+        if (lateInlineInstanceOfCondPre(a, true)) {\n+            a.m();\n+        }\n+    }\n+\n+    @InlineFailure\n+    \/\/ @ 2   compiler.inlining.TestSubtypeCheckTypeInfo::lateInlineInstanceOfCondPre (17 bytes)   inline (hot)   late inline succeeded\n+    \/\/ @ 9   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testInstanceOfCondLatePre(A a, boolean cond) {\n+        if (lateInlineInstanceOfCondPre(a, cond)) {\n+            a.m();\n+        }\n+    }\n+\n+    @InlineFailure\n+    \/\/ @ 2   compiler.inlining.TestSubtypeCheckTypeInfo::lateInlineInstanceOfCondPost (17 bytes)   inline (hot)   late inline succeeded\n+    \/\/ @ 9   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testInstanceOfCondLatePost(A a, boolean cond) {\n+        if (lateInlineInstanceOfCondPost(a, cond)) {\n+            a.m();\n+        }\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    @InlineFailure\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 2   compiler.inlining.TestSubtypeCheckTypeInfo::lateInlineIsInstanceCondPre (19 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 7   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 9   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testIsInstanceCondLate(A a, boolean cond) {\n+        if (lateInlineIsInstanceCondPre(a, true)) {\n+            a.m();\n+        }\n+    }\n+\n+    @InlineFailure\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 2   compiler.inlining.TestSubtypeCheckTypeInfo::lateInlineIsInstanceCondPre (19 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 7   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 9   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testIsInstanceCondLatePre(A a, boolean cond) {\n+        if (lateInlineIsInstanceCondPre(a, cond)) {\n+            a.m();\n+        }\n+    }\n+\n+    @InlineFailure\n+    \/\/ Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 2   compiler.inlining.TestSubtypeCheckTypeInfo::lateInlineIsInstanceCondPost (19 bytes)   inline (hot)   late inline succeeded\n+    \/\/   @ 3   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 9   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testIsInstanceCondLatePost(A a, boolean cond) {\n+        if (lateInlineIsInstanceCondPost(a, cond)) {\n+            a.m();\n+        }\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    @InlineFailure\n+    \/\/ @ 20   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testInstanceOfNulls(A o, boolean cond) {\n+        A recv = (cond ? o : null);\n+        if (recv instanceof B) {\n+            o.m();\n+        }\n+    }\n+\n+    @InlineFailure\n+    \/\/Inlining _isInstance on constant Class compiler\/inlining\/TestSubtypeCheckTypeInfo$B\n+    \/\/ @ 13   java.lang.Class::isInstance (0 bytes)   (intrinsic)\n+    \/\/ @ 20   compiler.inlining.TestSubtypeCheckTypeInfo$A::m (0 bytes)   failed to inline: virtual call\n+    static void testIsInstanceNulls(A o, boolean cond) {\n+        A recv = (cond ? o : null);\n+        if (B.class.isInstance(recv)) {\n+            o.m();\n+        }\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    static abstract class A {\n+        public abstract void m();\n+    }\n+    static abstract class B extends A {\n+        public void m() {}\n+    }\n+\n+    static class C extends A {\n+        public void m() {}\n+    }\n+\n+    static void lateInline(A o, boolean cond) {\n+        if (cond) {\n+            o.m();\n+        }\n+    }\n+\n+    static boolean lateInlineInstanceOfCondPre(A o, boolean cond) {\n+        return cond && (o instanceof B);\n+    }\n+\n+    static boolean lateInlineInstanceOfCondPost(A o, boolean cond) {\n+        return (o instanceof B) && cond;\n+    }\n+\n+    static boolean lateInlineIsInstanceCondPre(A o, boolean cond) {\n+        return cond && B.class.isInstance(o);\n+    }\n+    static boolean lateInlineIsInstanceCondPost(A o, boolean cond) {\n+        return B.class.isInstance(o) && cond;\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    static final String INLINE_SUCCESS_MESSAGE = \"B::m (1 bytes)   inline (hot)\";\n+    static final String INLINE_FAILURE_MESSAGE = \"A::m (0 bytes)   failed to inline: virtual call\";\n+\n+    @Retention(RetentionPolicy.RUNTIME)\n+    @Target(ElementType.METHOD)\n+    public @interface InlineSuccess {\n+        String[] shouldContain()    default INLINE_SUCCESS_MESSAGE;\n+        String[] shouldNotContain() default INLINE_FAILURE_MESSAGE;\n+    }\n+\n+    @Retention(RetentionPolicy.RUNTIME)\n+    @Target(ElementType.METHOD)\n+    public @interface InlineFailure {\n+        String[] shouldContain()    default INLINE_FAILURE_MESSAGE;\n+        String[] shouldNotContain() default INLINE_SUCCESS_MESSAGE;\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    \/\/ Parse compilation log (-XX:+PrintCompilation -XX:+PrintInlining output).\n+    static void parseOutput(List<String> output) {\n+        Pattern compilation = Pattern.compile(\"^\\\\d+\\\\s+\\\\d+.*\");\n+        StringBuilder inlineTree = new StringBuilder();\n+        Set<String> passedTests = new HashSet();\n+        Set<String> failedTests = new HashSet();\n+        for (String line : output) {\n+            \/\/ Detect start of next compilation.\n+            if (compilation.matcher(line).matches()) {\n+                \/\/ Parse output for previous compilation.\n+                validateInliningOutput(inlineTree.toString(), passedTests, failedTests);\n+                inlineTree = new StringBuilder(); \/\/ reset\n+            }\n+            inlineTree.append(line);\n+        }\n+        \/\/ Process last compilation\n+        validateInliningOutput(inlineTree.toString(), passedTests, failedTests);\n+\n+        if (!failedTests.isEmpty()) {\n+            String msg = String.format(\"TEST FAILED: %d test cases failed\", failedTests.size());\n+            throw new AssertionError(msg);\n+        } else if (passedTests.size() != totalTestCount()) {\n+            String msg = String.format(\"TEST FAILED: %d out of %d test cases passed\", passedTests.size(), totalTestCount());\n+            throw new AssertionError(msg);\n+        }\n+    }\n+\n+    \/\/ Sample:\n+    \/\/    213   42    b        compiler.inlining.TestSubtypeCheckTypeInfo::testIsInstanceCondLatePost (13 bytes)\n+    static final Pattern TEST_CASE = Pattern.compile(\"^\\\\d+\\\\s+\\\\d+\\\\s+b\\\\s+\" + TEST_CLASS_NAME + \"::(\\\\w+) .*\");\n+\n+    static boolean validateInliningOutput(String inlineTree, Set<String> passedTests, Set<String> failedTests) {\n+        Matcher m = TEST_CASE.matcher(inlineTree);\n+        if (m.matches()) {\n+            String testName = m.group(1);\n+            System.out.print(testName);\n+            try {\n+                Method testMethod = TestSubtypeCheckTypeInfo.class.getDeclaredMethod(testName, A.class, boolean.class);\n+                if (validate(inlineTree, testMethod.getAnnotation(InlineSuccess.class)) &&\n+                    validate(inlineTree, testMethod.getAnnotation(InlineFailure.class))) {\n+                    System.out.println(\": SUCCESS\");\n+                    passedTests.add(testName);\n+                    return true;\n+                } else {\n+                    failedTests.add(testName);\n+                    return false;\n+                }\n+            } catch (NoSuchMethodException e) {\n+                System.out.println(\": FAILURE: Missing test info for \" + testName + \": \" + inlineTree);\n+                throw new InternalError(e);\n+            }\n+        } else {\n+            return false; \/\/ not a test method; ignored\n+        }\n+    }\n+\n+    static boolean validate(String message, InlineSuccess ann) {\n+        if (ann != null) {\n+            return validatePatterns(message, ann.shouldContain(), ann.shouldNotContain());\n+        }\n+        return true; \/\/ no patterns to validate\n+    }\n+\n+    static boolean validate(String message, InlineFailure ann) {\n+        if (ann != null) {\n+            return validatePatterns(message, ann.shouldContain(), ann.shouldNotContain());\n+        }\n+        return true; \/\/ no patterns to validate\n+    }\n+\n+    static boolean validatePatterns(String message, String[] shouldContain, String[] shouldNotContain) {\n+        for (String pattern : shouldContain) {\n+            if (!message.contains(pattern)) {\n+                System.out.printf(\": FAILURE: '%s' not found in '%s'\\n\", pattern, message);\n+                return false;\n+            }\n+        }\n+        for (String pattern : shouldNotContain) {\n+            if (message.contains(pattern)) {\n+                System.out.printf(\": FAILURE: '%s' found in '%s'\\n\", pattern, message);\n+                return false;\n+            }\n+        }\n+        return true;\n+    }\n+\n+    static int totalTestCount() {\n+        int count = 0;\n+        for (Method m : THIS_CLASS.getDeclaredMethods()) {\n+            if (m.isAnnotationPresent(InlineSuccess.class) || m.isAnnotationPresent(InlineFailure.class)) {\n+                String testName = m.getName();\n+                if (testName.startsWith(\"test\")) {\n+                    count++;\n+                } else {\n+                    throw new InternalError(\"wrong test name: \" + testName);\n+                }\n+            }\n+        }\n+        return count;\n+    }\n+\n+    \/* =========================================================== *\/\n+\n+    interface TestCase {\n+        void run(A o, boolean cond);\n+    }\n+\n+    static void runTestCase(TestCase t) {\n+        A[] receivers = new A[] { new B() {}, new B() {}, new B() {}, new C() {}, new C() {}};\n+        for (int i = 0; i < 20_000; i++) {\n+            \/\/ Pollute type profile and branch frequencies.\n+            A recv = receivers[i % receivers.length];\n+            boolean cond = (i % 2 == 0);\n+            t.run(recv, cond);\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/inlining\/TestSubtypeCheckTypeInfo.java","additions":479,"deletions":0,"binary":false,"changes":479,"status":"added"},{"patch":"@@ -135,1 +135,1 @@\n-        t.runTest(methodObjClassCast,  false,  svalue);\n+        t.runTest(methodObjClassCast,  false, svalue);\n@@ -137,1 +137,1 @@\n-        t.runTest(methodIntClassCast,  true,  svalue);\n+        t.runTest(methodIntClassCast,  false, svalue);\n@@ -141,1 +141,1 @@\n-        t.runTest(methodPrimClassCast, true,  svalue);\n+        t.runTest(methodPrimClassCast, false, svalue);\n","filename":"test\/hotspot\/jtreg\/compiler\/intrinsics\/klass\/CastNullCheckDroppingsTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -693,10 +693,0 @@\n-    public static final String CON_D = PREFIX + \"CON_D\" + POSTFIX;\n-    static {\n-        beforeMatchingNameRegex(CON_D, \"ConD\");\n-    }\n-\n-    public static final String CON_F = PREFIX + \"CON_F\" + POSTFIX;\n-    static {\n-        beforeMatchingNameRegex(CON_F, \"ConF\");\n-    }\n-\n@@ -2804,1 +2794,1 @@\n-    public static final String X86_SCONV_D2I_AVX10 = PREFIX + \"X86_SCONV2_D2I_AVX10\" + POSTFIX;\n+    public static final String X86_SCONV_D2I_AVX10_2 = PREFIX + \"X86_SCONV_D2I_AVX10_2\" + POSTFIX;\n@@ -2806,1 +2796,1 @@\n-        machOnlyNameRegex(X86_SCONV_D2I_AVX10, \"convD2I_(reg_reg|reg_mem)_avx10\");\n+        machOnlyNameRegex(X86_SCONV_D2I_AVX10_2, \"convD2I_(reg_reg|reg_mem)_avx10_2\");\n@@ -2809,1 +2799,1 @@\n-    public static final String X86_SCONV_D2L_AVX10 = PREFIX + \"X86_SCONV_D2L_AVX10\" + POSTFIX;\n+    public static final String X86_SCONV_D2L_AVX10_2 = PREFIX + \"X86_SCONV_D2L_AVX10_2\" + POSTFIX;\n@@ -2811,1 +2801,1 @@\n-        machOnlyNameRegex(X86_SCONV_D2L_AVX10, \"convD2L_(reg_reg|reg_mem)_avx10\");\n+        machOnlyNameRegex(X86_SCONV_D2L_AVX10_2, \"convD2L_(reg_reg|reg_mem)_avx10_2\");\n@@ -2814,1 +2804,1 @@\n-    public static final String X86_SCONV_F2I_AVX10 = PREFIX + \"X86_SCONV_F2I_AVX10\" + POSTFIX;\n+    public static final String X86_SCONV_F2I_AVX10_2 = PREFIX + \"X86_SCONV_F2I_AVX10_2\" + POSTFIX;\n@@ -2816,1 +2806,1 @@\n-        machOnlyNameRegex(X86_SCONV_F2I_AVX10, \"convF2I_(reg_reg|reg_mem)_avx10\");\n+        machOnlyNameRegex(X86_SCONV_F2I_AVX10_2, \"convF2I_(reg_reg|reg_mem)_avx10_2\");\n@@ -2819,1 +2809,1 @@\n-    public static final String X86_SCONV_F2L_AVX10 = PREFIX + \"X86_SCONV_F2L_AVX10\" + POSTFIX;\n+    public static final String X86_SCONV_F2L_AVX10_2 = PREFIX + \"X86_SCONV_F2L_AVX10_2\" + POSTFIX;\n@@ -2821,1 +2811,1 @@\n-        machOnlyNameRegex(X86_SCONV_F2L_AVX10, \"convF2L_(reg_reg|reg_mem)_avx10\");\n+        machOnlyNameRegex(X86_SCONV_F2L_AVX10_2, \"convF2L_(reg_reg|reg_mem)_avx10_2\");\n@@ -2834,1 +2824,1 @@\n-    public static final String X86_VCAST_F2X_AVX10 = PREFIX + \"X86_VCAST_F2X_AVX10\" + POSTFIX;\n+    public static final String X86_VCAST_F2X_AVX10_2 = PREFIX + \"X86_VCAST_F2X_AVX10_2\" + POSTFIX;\n@@ -2836,1 +2826,1 @@\n-        machOnlyNameRegex(X86_VCAST_F2X_AVX10, \"castFtoX_(reg|mem)_avx10\");\n+        machOnlyNameRegex(X86_VCAST_F2X_AVX10_2, \"castFtoX_(reg|mem)_avx10_2\");\n@@ -2839,1 +2829,1 @@\n-    public static final String X86_VCAST_D2X_AVX10 = PREFIX + \"X86_VCAST_D2X_AVX10\" + POSTFIX;\n+    public static final String X86_VCAST_D2X_AVX10_2 = PREFIX + \"X86_VCAST_D2X_AVX10_2\" + POSTFIX;\n@@ -2841,1 +2831,1 @@\n-        machOnlyNameRegex(X86_VCAST_D2X_AVX10, \"castDtoX_(reg|mem)_avx10\");\n+        machOnlyNameRegex(X86_VCAST_D2X_AVX10_2, \"castDtoX_(reg|mem)_avx10_2\");\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/ir_framework\/IRNode.java","additions":12,"deletions":22,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -103,0 +103,7 @@\n+    \/**\n+     * The Float16 type.\n+     *\n+     * @return The Float16 type.\n+     *\/\n+    static CodeGenerationDataNameType float16() { return Float16Type.FLOAT16; }\n+\n@@ -157,0 +164,15 @@\n+\n+    \/**\n+     * List of all scalar numeric types.\n+     *\/\n+    List<CodeGenerationDataNameType> SCALAR_NUMERIC_TYPES = List.of(\n+        bytes(),\n+        chars(),\n+        shorts(),\n+        ints(),\n+        longs(),\n+        floats(),\n+        doubles(),\n+        booleans(),\n+        float16()\n+    );\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/template_framework\/library\/CodeGenerationDataNameType.java","additions":22,"deletions":0,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -0,0 +1,62 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package compiler.lib.template_framework.library;\n+\n+import compiler.lib.generators.Generators;\n+import compiler.lib.generators.Generator;\n+\n+import compiler.lib.template_framework.DataName;\n+\n+\/**\n+ * The {@link Float16Type} models Java's {@link Float16} type.\n+ *\/\n+final class Float16Type implements CodeGenerationDataNameType {\n+    private static final Generator<Short> GEN_FLOAT16 = Generators.G.float16s();\n+\n+    \/\/ We only need one static instance of the class.\n+    static final Float16Type FLOAT16 = new Float16Type();\n+\n+    \/\/ Private constructor so nobody can create duplicate instances.\n+    private Float16Type() {}\n+\n+    @Override\n+    public boolean isSubtypeOf(DataName.Type other) {\n+        return other instanceof Float16Type;\n+    }\n+\n+    @Override\n+    public String name() {\n+        return \"Float16\";\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return name();\n+    }\n+\n+    @Override\n+    public Object con() {\n+        return \"Float16.shortBitsToFloat16((short)\" + GEN_FLOAT16.next() + \")\";\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/template_framework\/library\/Float16Type.java","additions":62,"deletions":0,"binary":false,"changes":62,"status":"added"},{"patch":"@@ -26,1 +26,0 @@\n-import java.util.List;\n@@ -28,0 +27,2 @@\n+import java.util.Arrays;\n+import java.util.List;\n@@ -29,0 +30,2 @@\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n@@ -38,0 +41,1 @@\n+import static compiler.lib.template_framework.library.Float16Type.FLOAT16;\n@@ -48,0 +52,4 @@\n+    private static Expression.Info WITH_ARITHMETIC_EXCEPTION = new Expression.Info().withExceptions(Set.of(\"ArithmeticException\"));\n+    private static Expression.Info WITH_NONDETERMINISTIC_RESULT = new Expression.Info().withNondeterministicResult();\n+\n+\n@@ -54,0 +62,20 @@\n+    public static final List<Expression> FLOAT16_OPERATIONS = generateFloat16Operations();\n+\n+    public static final List<Expression> SCALAR_NUMERIC_OPERATIONS = concat(\n+            PRIMITIVE_OPERATIONS,\n+            FLOAT16_OPERATIONS\n+    );\n+\n+    @SafeVarargs\n+    private static List<Expression> concat(List<Expression>... lists) {\n+        return Arrays.stream(lists)\n+                     .flatMap(List::stream)\n+                     .collect(Collectors.toList());\n+    }\n+\n+    private static void addComparisonOperations(List<Expression> ops, String operatorName, CodeGenerationDataNameType type) {\n+        for (String mask : List.of(\"==\", \"!=\", \"<\", \">\", \"<=\", \">=\")) {\n+            ops.add(Expression.make(BOOLEANS, \"(\" + operatorName + \"(\", type, \", \", type, \")\" + mask + \"0)\"));\n+        }\n+    }\n+\n@@ -57,3 +85,0 @@\n-        Expression.Info withArithmeticException = new Expression.Info().withExceptions(Set.of(\"ArithmeticException\"));\n-        Expression.Info withNondeterministicResult = new Expression.Info().withNondeterministicResult();\n-\n@@ -78,2 +103,2 @@\n-            ops.add(Expression.make(type, \"(\", type, \" \/ \", type, \")\", withArithmeticException));\n-            ops.add(Expression.make(type, \"(\", type, \" % \", type, \")\", withArithmeticException));\n+            ops.add(Expression.make(type, \"(\", type, \" \/ \", type, \")\", WITH_ARITHMETIC_EXCEPTION));\n+            ops.add(Expression.make(type, \"(\", type, \" % \", type, \")\", WITH_ARITHMETIC_EXCEPTION));\n@@ -97,0 +122,2 @@\n+            addComparisonOperations(ops, type.boxedTypeName() + \".compare\", type);\n+            addComparisonOperations(ops, type.boxedTypeName() + \".compareUnsigned\", type); \/\/ ugt, uge, ule, ult\n@@ -115,0 +142,1 @@\n+            addComparisonOperations(ops, type.boxedTypeName() + \".compare\", type);\n@@ -155,1 +183,1 @@\n-        ops.add(Expression.make(INTS,  \"Integer.divideUnsigned(\", INTS, \", \", INTS, \")\", withArithmeticException));\n+        ops.add(Expression.make(INTS,  \"Integer.divideUnsigned(\", INTS, \", \", INTS, \")\", WITH_ARITHMETIC_EXCEPTION));\n@@ -163,1 +191,1 @@\n-        ops.add(Expression.make(INTS,  \"Integer.remainderUnsigned(\", INTS, \", \", INTS, \")\", withArithmeticException));\n+        ops.add(Expression.make(INTS,  \"Integer.remainderUnsigned(\", INTS, \", \", INTS, \")\", WITH_ARITHMETIC_EXCEPTION));\n@@ -181,1 +209,1 @@\n-        ops.add(Expression.make(LONGS, \"Long.divideUnsigned(\", LONGS, \", \", LONGS, \")\", withArithmeticException));\n+        ops.add(Expression.make(LONGS, \"Long.divideUnsigned(\", LONGS, \", \", LONGS, \")\", WITH_ARITHMETIC_EXCEPTION));\n@@ -189,1 +217,1 @@\n-        ops.add(Expression.make(LONGS, \"Long.remainderUnsigned(\", LONGS, \", \", LONGS, \")\", withArithmeticException));\n+        ops.add(Expression.make(LONGS, \"Long.remainderUnsigned(\", LONGS, \", \", LONGS, \")\", WITH_ARITHMETIC_EXCEPTION));\n@@ -204,1 +232,1 @@\n-        ops.add(Expression.make(INTS, \"Float.floatToRawIntBits(\", FLOATS, \")\", withNondeterministicResult));\n+        ops.add(Expression.make(INTS, \"Float.floatToRawIntBits(\", FLOATS, \")\", WITH_NONDETERMINISTIC_RESULT));\n@@ -223,1 +251,1 @@\n-        ops.add(Expression.make(LONGS,    \"Double.doubleToRawLongBits(\", DOUBLES, \")\", withNondeterministicResult));\n+        ops.add(Expression.make(LONGS,    \"Double.doubleToRawLongBits(\", DOUBLES, \")\", WITH_NONDETERMINISTIC_RESULT));\n@@ -253,0 +281,42 @@\n+\n+    private static List<Expression> generateFloat16Operations() {\n+        List<Expression> ops = new ArrayList<>();\n+\n+        \/\/ Casts.\n+        CodeGenerationDataNameType.INTEGRAL_AND_FLOATING_TYPES.stream().forEach(type -> {\n+            if (type == CHARS) { return; }\n+            ops.add(Expression.make(FLOAT16, \"Float16.valueOf(\", type, \")\"));\n+            ops.add(Expression.make(type, \"\", FLOAT16, \".\" + type.name() + \"Value()\"));\n+        });\n+\n+        ops.add(Expression.make(FLOAT16, \"Float16.abs(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.add(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        ops.add(Expression.make(INTS, \"Float16.compare(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        addComparisonOperations(ops, \"Float16.compare\", FLOAT16);\n+        ops.add(Expression.make(INTS, \"(\", FLOAT16, \").compareTo(\",  FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.copySign(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.divide(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        ops.add(Expression.make(BOOLEANS, \"\", FLOAT16, \".equals(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(SHORTS, \"Float16.float16ToRawShortBits(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(SHORTS, \"Float16.float16ToShortBits(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.fma(\", FLOAT16, \",\", FLOAT16, \", \", FLOAT16, \")\"));\n+        ops.add(Expression.make(INTS, \"Float16.getExponent(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(BOOLEANS, \"Float16.isFinite(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(BOOLEANS, \"Float16.isInfinite(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(BOOLEANS, \"Float16.isNaN(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.max(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.min(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.multiply(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.negate(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.nextDown(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.nextUp(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.scalb(\", FLOAT16, \", \", INTS, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.shortBitsToFloat16(\", SHORTS, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.signum(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.sqrt(\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.subtract(\", FLOAT16, \",\", FLOAT16, \")\"));\n+        ops.add(Expression.make(FLOAT16, \"Float16.ulp(\", FLOAT16, \")\"));\n+\n+        \/\/ Make sure the list is not modifiable.\n+        return List.copyOf(ops);\n+    }\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/template_framework\/library\/Operations.java","additions":82,"deletions":12,"binary":false,"changes":94,"status":"modified"},{"patch":"@@ -96,0 +96,1 @@\n+    @Override\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/template_framework\/library\/PrimitiveType.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -153,0 +153,2 @@\n+                } else if (isFloat16Class(ca)) {\n+                    checkEQForFloat16Class(a, b, field, aParent, bParent);\n@@ -459,0 +461,34 @@\n+    private static boolean isFloat16Class(Class<?> c) {\n+        return c.getName().equals(\"jdk.incubator.vector.Float16\");\n+    }\n+\n+    \/**\n+     * We do not want to import jdk.incubator.vector.Float16 explicitly, because it would mean we would\n+     * also have to add \"--add-modules=jdk.incubator.vector\" to the command-line of every test that uses\n+     * the Verify class. So we hack this via reflection.\n+     *\n+     * An additional challenge is the boxing and NaNs, see also isFloatEQ.\n+     *\/\n+    private void checkEQForFloat16Class(Object a, Object b, String field, Object aParent, Object bParent) {\n+        Class<?> ca = a.getClass();\n+        short bitsA;\n+        short bitsB;\n+        try {\n+            Method m = isFloatCheckWithRawBits ? ca.getMethod(\"float16ToRawShortBits\", ca)\n+                                               : ca.getMethod(\"float16ToShortBits\", ca);\n+            m.setAccessible(true);\n+            bitsA = (short)m.invoke(null, a);\n+            bitsB = (short)m.invoke(null, b);\n+        } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {\n+            throw new RuntimeException(\"Could not invoke float16ToRawShortBits on \" + ca.getName(), e);\n+        }\n+\n+        if (bitsA != bitsB) {\n+            System.err.println(\"ERROR: Equality matching failed: value mismatch. check raw: \" + isFloatCheckWithRawBits);\n+            System.err.println(\"  Values: \" + a + \" vs \" + b);\n+            System.err.println(\"  Bits:   \" + bitsA + \" vs \" + bitsB);\n+            print(a, b, field, aParent, bParent);\n+            throw new VerifyException(\"Value mismatch: \" + a + \" vs \" + b);\n+        }\n+    }\n+\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/verify\/Verify.java","additions":36,"deletions":0,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -0,0 +1,71 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test id=with-flags\n+ * @bug 8373502\n+ * @summary Test where a VPointer variable was pinned at the pre-loop, but not available at the\n+ *          Auto_Vectorization_Check, and so it should not be used for the auto vectorization\n+ *          aliasing check, to avoid a bad (circular) graph.\n+ * @run main\/othervm\n+ *      -XX:CompileCommand=compileonly,*TestAliasingCheckVPointerVariablesNotAvailable::test\n+ *      -XX:-TieredCompilation\n+ *      -Xcomp\n+ *      ${test.main.class}\n+ *\/\n+\n+\/*\n+ * @test id=vanilla\n+ * @bug 8373502\n+ * @run main ${test.main.class}\n+ *\/\n+\n+package compiler.loopopts.superword;\n+\n+public class TestAliasingCheckVPointerVariablesNotAvailable {\n+    static int iFld;\n+\n+    public static void main(String[] strArr) {\n+        test();\n+    }\n+\n+    static void test() {\n+        int iArr[] = new int[400];\n+        boolean flag = false;\n+        for (int i = 6; i < 50000; i++) { \/\/ Trigger OSR\n+            try {\n+                int x = 234 \/ iFld;\n+                iFld = iArr[3];\n+            } catch (ArithmeticException a_e) {\n+            }\n+            for (int j = i; j < 2; j++) {\n+                if (flag) {\n+                    iArr[j] = 117;\n+                } else {\n+                    iArr[1] = 34;\n+                }\n+                iArr[1] += i;\n+            }\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/loopopts\/superword\/TestAliasingCheckVPointerVariablesNotAvailable.java","additions":71,"deletions":0,"binary":false,"changes":71,"status":"added"},{"patch":"@@ -165,1 +165,1 @@\n-        applyIfCPUFeature = {\"avx\", \"true\"})\n+        applyIfCPUFeatureAnd = {\"avx\", \"true\", \"f16c\", \"true\"})\n@@ -211,1 +211,1 @@\n-        applyIfCPUFeature = {\"avx\", \"true\"})\n+        applyIfCPUFeatureAnd = {\"avx\", \"true\", \"f16c\", \"true\"})\n","filename":"test\/hotspot\/jtreg\/compiler\/loopopts\/superword\/TestReinterpretAndCast.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,66 @@\n+\/*\n+ * Copyright (c) 2025 IBM Corporation. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8370200\n+ * @summary Crash: assert(outer->outcnt() >= phis + 2 - be_loads && outer->outcnt() <= phis + 2 + stores + 1) failed: only phis\n+ * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions -XX:+UnlockDiagnosticVMOptions -XX:StressSeed=36200582 -XX:CompileCommand=quiet\n+ *                   -XX:CompileCommand=compileonly,*TestMismatchedMemoryPhis*::mainTest -XX:-TieredCompilation\n+ *                   -Xcomp -XX:+StressIGVN -XX:+StressLoopPeeling -XX:PerMethodTrapLimit=0 ${test.main.class}\n+ * @run main\/othervm -XX:+IgnoreUnrecognizedVMOptions -XX:+UnlockDiagnosticVMOptions -XX:CompileCommand=quiet\n+ *                   -XX:CompileCommand=compileonly,*TestMismatchedMemoryPhis*::mainTest -XX:-TieredCompilation\n+ *                   -Xcomp -XX:+StressIGVN -XX:+StressLoopPeeling -XX:PerMethodTrapLimit=0 ${test.main.class}\n+ * @run main ${test.main.class}\n+ *\/\n+\n+package compiler.loopstripmining;\n+\n+public class TestMismatchedMemoryPhis {\n+    long l;\n+    volatile int iArrFld[];\n+\n+    void mainTest() {\n+        int i, i1, i15 = 4, i16 = 4;\n+        for (i = 1; i < 7; ++i) {\n+            l = i;\n+        }\n+        int j = 1;\n+        while (++j < 4) {\n+            try {\n+                i1 = i15 % i16;\n+                i16 = i15;\n+                i1 = 0 % iArrFld[j];\n+            } catch (ArithmeticException a_e) {\n+            }\n+        }\n+    }\n+\n+    static public void main(String[] args) {\n+        try {\n+            new TestMismatchedMemoryPhis().mainTest();\n+        } catch (NullPointerException npe) {\n+            \/\/ Expected\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/loopstripmining\/TestMismatchedMemoryPhis.java","additions":66,"deletions":0,"binary":false,"changes":66,"status":"added"},{"patch":"@@ -93,1 +93,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -115,1 +115,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -137,1 +137,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -159,1 +159,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -181,1 +181,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n@@ -203,1 +203,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n@@ -225,1 +225,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n@@ -247,1 +247,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n","filename":"test\/hotspot\/jtreg\/compiler\/vectorapi\/VectorFPtoIntCastTest.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -301,1 +301,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -316,1 +316,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -331,1 +331,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n@@ -346,1 +346,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n@@ -364,1 +364,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -389,1 +389,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_F2X_AVX10_2, \"> 0\"},\n@@ -417,1 +417,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n@@ -438,1 +438,1 @@\n-    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10, \"> 0\"},\n+    @IR(counts = {IRNode.X86_VCAST_D2X_AVX10_2, \"> 0\"},\n","filename":"test\/hotspot\/jtreg\/compiler\/vectorization\/runner\/ArrayTypeConvertTest.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -57,3 +57,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageNameAndTag);\n-            }\n+            DockerTestUtils.removeDockerImage(imageNameAndTag);\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/DockerBasicTest.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -60,3 +60,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/ShareTmpDir.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -88,3 +88,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestCPUAwareness.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -76,12 +76,0 @@\n-    private static void shouldMatchWithValue(OutputAnalyzer output, String match, String value) {\n-        output.shouldContain(match);\n-        String str = output.getOutput();\n-        for (String s : str.split(System.lineSeparator())) {\n-            if (s.contains(match)) {\n-                if (!s.contains(value)) {\n-                    throw new RuntimeException(\"memory_swap_current_in_bytes NOT \" + value + \"! Line was : \" + s);\n-                }\n-            }\n-        }\n-    }\n-\n@@ -91,2 +79,2 @@\n-            shouldMatchWithValue(out, \"memory_swap_max_limit_in_bytes\", \"0\");\n-            shouldMatchWithValue(out, \"memory_swap_current_in_bytes\", \"0\");\n+            DockerTestUtils.shouldMatchWithValue(out, \"memory_swap_max_limit\", \"0\");\n+            DockerTestUtils.shouldMatchWithValue(out, \"memory_swap_current\", \"0\");\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestContainerInfo.java","additions":2,"deletions":14,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -66,3 +66,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n@@ -131,6 +129,6 @@\n-        targetOut.shouldContain(\"active_processor_count: 2\"); \/\/ initial value\n-        targetOut.shouldContain(\"active_processor_count: 3\"); \/\/ updated value\n-        targetOut.shouldContain(\"memory_limit_in_bytes: 512000 k\"); \/\/ initial value\n-        targetOut.shouldContain(\"memory_and_swap_limit_in_bytes: 512000 k\"); \/\/ initial value\n-        targetOut.shouldContain(\"memory_limit_in_bytes: 307200 k\"); \/\/ updated value\n-        targetOut.shouldContain(\"memory_and_swap_limit_in_bytes: 307200 k\"); \/\/ updated value\n+        DockerTestUtils.shouldMatchWithValue(targetOut, \"active_processor_count\", \"2\"); \/\/ initial value\n+        DockerTestUtils.shouldMatchWithValue(targetOut, \"active_processor_count\", \"3\"); \/\/ updated value\n+        DockerTestUtils.shouldMatchWithValue(targetOut, \"memory_limit\", \"512000 kB\"); \/\/ initial value\n+        DockerTestUtils.shouldMatchWithValue(targetOut, \"memory_and_swap_limit\", \"512000 kB\"); \/\/ initial value\n+        DockerTestUtils.shouldMatchWithValue(targetOut, \"memory_limit\", \"307200 kB\"); \/\/ updated value\n+        DockerTestUtils.shouldMatchWithValue(targetOut, \"memory_and_swap_limit\", \"307200 kB\"); \/\/ updated value\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestLimitsUpdating.java","additions":7,"deletions":9,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -105,3 +105,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n@@ -172,2 +170,2 @@\n-            .shouldMatch(\"memory_limit_in_bytes:.*\" + expectedMem)\n-            .shouldNotMatch(\"memory_and_swap_limit_in_bytes:.*not supported\")\n+            .shouldMatch(\"memory_limit:.*\" + expectedMem)\n+            .shouldNotMatch(\"memory_and_swap_limit:.*not supported\")\n@@ -176,1 +174,1 @@\n-            .shouldMatch(\"memory_and_swap_limit_in_bytes:.*(\" + expectedMem + \"|\" + expectedSwap + \")\");\n+            .shouldMatch(\"memory_and_swap_limit:.*(\" + expectedMem + \"|\" + expectedSwap + \")\");\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestMemoryAwareness.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -130,1 +130,1 @@\n-          out.shouldContain(\"cpu_shares: \" + valueExpected);\n+          DockerTestUtils.shouldMatchWithValue(out, \"cpu_shares\", String.valueOf(valueExpected));\n@@ -133,1 +133,1 @@\n-          out.shouldNotContain(\"cpu_shares: no shares\");\n+          DockerTestUtils.shouldNotMatchWithValue(out, \"cpu_shares\", \"no shares\");\n@@ -144,1 +144,1 @@\n-        out.shouldContain(\"but overridden by -XX:ActiveProcessorCount 2\");\n+        DockerTestUtils.shouldMatchWithValue(out, \"active_processor_count\", \"2 (from -XX:ActiveProcessorCount)\");\n@@ -161,1 +161,1 @@\n-            \"memory_max_usage_in_bytes\",\n+            \"memory_max_usage\",\n@@ -164,2 +164,2 @@\n-            \"rss_usage_in_bytes\",\n-            \"cache_usage_in_bytes\"\n+            \"rss_usage\",\n+            \"cache_usage\"\n@@ -173,3 +173,3 @@\n-            out.shouldContain(\"kernel_memory_usage_in_bytes\");\n-            out.shouldContain(\"kernel_memory_max_usage_in_bytes\");\n-            out.shouldContain(\"kernel_memory_limit_in_bytes\");\n+            out.shouldContain(\"kernel_memory_usage\");\n+            out.shouldContain(\"kernel_memory_max_usage\");\n+            out.shouldContain(\"kernel_memory_limit\");\n@@ -178,2 +178,2 @@\n-                out.shouldContain(\"memory_swap_current_in_bytes\");\n-                out.shouldContain(\"memory_swap_max_limit_in_bytes\");\n+                out.shouldContain(\"memory_swap_current\");\n+                out.shouldContain(\"memory_swap_max_limit\");\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestMisc.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -66,3 +66,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestPids.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -136,5 +136,1 @@\n-        long rss = WhiteBox.getWhiteBox().rss();\n-        System.out.println(\"RSS: \" + rss);\n-        long available = WhiteBox.getWhiteBox().hostAvailableMemory();\n-        System.out.println(\"Host available memory: \" + available);\n-\n+        int maxIter = 20;\n@@ -142,1 +138,0 @@\n-\n@@ -153,6 +148,22 @@\n-        if (rss == 0) {\n-            throw new SkippedException(\"cannot get RSS?\");\n-        }\n-        if (available > requiredAvailable) {\n-            Asserts.assertGreaterThan(rss, minRequiredRss, \"RSS of this process(\" + rss + \"b) should be bigger \" +\n-                                      \"than or equal to heap size(\" + heapSize + \"b) (available memory: \" + available + \"). On Linux Kernel < 4.14 RSS can be inaccurate\");\n+\n+        \/\/ RSS values we get are sometimes somewhat delayed or inaccurate\n+        for (int iter=0; iter < maxIter; iter++) {\n+            long rss = WhiteBox.getWhiteBox().rss();\n+            System.out.println(\"RSS: \" + rss);\n+            long available = WhiteBox.getWhiteBox().hostAvailableMemory();\n+            System.out.println(\"Host available memory: \" + available);\n+\n+            if (rss == 0) {\n+                throw new SkippedException(\"cannot get RSS?\");\n+            }\n+            if (available <= requiredAvailable) {\n+                throw new SkippedException(\"Available memory on host \" + available + \" is too small, not larger than required available memory \" + requiredAvailable);\n+            }\n+\n+            if ((rss < minRequiredRss) && iter < maxIter-1) {\n+                System.out.println(\"We got only an RSS value of \" + rss + \" but require \" + minRequiredRss + \", let's retry!\");\n+            } else {\n+                Asserts.assertGreaterThan(rss, minRequiredRss, \"RSS of this process(\" + rss + \"b) should be bigger \" +\n+                                          \"than or equal to heap size(\" + heapSize + \"b) (available memory: \" + available + \"). On Linux Kernel < 4.14 RSS can be inaccurate\");\n+                break;\n+            }\n","filename":"test\/hotspot\/jtreg\/gc\/TestAlwaysPreTouchBehavior.java","additions":23,"deletions":12,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,1 +71,2 @@\n-    \/\/ -XX:-ClassUnloadingWithConcurrentMark is used, so we expect a full GC instead of a concurrent cycle.\n+    \/\/ -XX:-ClassUnloadingWithConcurrentMark is used, so we expect a full GC due to Metadata GC Threshold\n+    \/\/ instead of a concurrent cycle.\n@@ -74,2 +75,2 @@\n-    out.shouldMatch(\".*Pause Full.*\");\n-    out.shouldNotMatch(\".*Pause Young \\\\(Concurrent Start\\\\).*\");\n+    out.shouldMatch(\".*Pause Full \\\\(Metadata GC Threshold\\\\).*\");\n+    out.shouldNotMatch(\".*Pause Young \\\\(Concurrent Start\\\\) \\\\(Metadata GC Threshold\\\\).*\");\n@@ -79,1 +80,2 @@\n-    \/\/ -XX:+ClassUnloadingWithConcurrentMark is used, so we expect a concurrent cycle instead of a full GC.\n+    \/\/ -XX:+ClassUnloadingWithConcurrentMark is used, so we expect a concurrent cycle due to Metadata GC Threshold\n+    \/\/ instead of a full GC.\n@@ -82,2 +84,2 @@\n-    out.shouldMatch(\".*Pause Young \\\\(Concurrent Start\\\\).*\");\n-    out.shouldNotMatch(\".*Pause Full.*\");\n+    out.shouldMatch(\".*Pause Young \\\\(Concurrent Start\\\\) \\\\(Metadata GC Threshold\\\\).*\");\n+    out.shouldNotMatch(\".*Pause Full \\\\(Metadata GC Threshold\\\\).*\");\n","filename":"test\/hotspot\/jtreg\/gc\/class_unloading\/TestG1ClassUnloadingHWM.java","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -0,0 +1,123 @@\n+\/*\n+ * Copyright Amazon.com Inc. or its affiliates. All Rights Reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+\/**\n+ * @test id=satb-adaptive\n+ * @requires vm.gc.Shenandoah\n+ * @library \/test\/lib\n+ * @bug 8372543\n+ * @summary When soft max heap size < Xmx, we had a bug reported in JBS-8372543 where available size was undercalculated.\n+ *          This caused excessive GC runs.\n+ *\n+ * @run main\/othervm -XX:SoftMaxHeapSize=512m -Xmx2g -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions\n+ *      -XX:+UseShenandoahGC -Xlog:gc=info\n+ *      -XX:ShenandoahGCMode=satb\n+ *      -XX:+ShenandoahDegeneratedGC\n+ *      -XX:ShenandoahGCHeuristics=adaptive\n+ *      TestSoftMaxHeapSizeAvailableCalc\n+ *\/\n+\n+\/**\n+ * @test id=satb-static\n+ * @requires vm.gc.Shenandoah\n+ * @library \/test\/lib\n+ *\n+ * @run main\/othervm -XX:SoftMaxHeapSize=512m -Xmx2g -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions\n+ *      -XX:+UseShenandoahGC -Xlog:gc=info\n+ *      -XX:ShenandoahGCMode=satb\n+ *      -XX:+ShenandoahDegeneratedGC\n+ *      -XX:ShenandoahGCHeuristics=static\n+ *      TestSoftMaxHeapSizeAvailableCalc\n+ *\/\n+\n+\/**\n+ * @test id=generational\n+ * @requires vm.gc.Shenandoah\n+ * @library \/test\/lib\n+ *\n+ * @run main\/othervm -XX:SoftMaxHeapSize=512m -Xmx2g -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions\n+ *      -XX:+UseShenandoahGC -Xlog:gc=info\n+ *      -XX:ShenandoahGCMode=generational\n+ *      -XX:ShenandoahGCHeuristics=adaptive\n+ *      TestSoftMaxHeapSizeAvailableCalc\n+ *\n+ *\/\n+import java.lang.management.ManagementFactory;\n+\n+import jdk.test.lib.Asserts;\n+import jdk.test.lib.Utils;\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+import jdk.test.lib.dcmd.PidJcmdExecutor;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Random;\n+\n+import com.sun.management.GarbageCollectorMXBean;\n+\n+public class TestSoftMaxHeapSizeAvailableCalc {\n+    public static void main(String[] args) throws Exception {\n+        Allocate.test();\n+    }\n+\n+    \/\/ This test runs an app that has a stable heap of ~300M and allocates temporary garbage at ~100M\/s\n+    \/\/ Soft max: 512M, ShenandoahMinFreeThreshold: 10 (default), ShenandoahEvacReserve: 5 (default)\n+    \/\/ Soft max for mutator: 512M * (100.0 - 5) \/ 100 = 486.4M\n+    \/\/ Threshold to trigger gc: 486.4M - 512 * 10 \/ 100.0 = 435.2M, just above (300 + 100)M.\n+    \/\/ Expect gc count to be less than 1 \/ sec.\n+    public static class Allocate {\n+        static final List<byte[]> longLived = new ArrayList<>();\n+\n+        public static void test() throws Exception {\n+            final int expectedMaxGcCount = Integer.getInteger(\"expectedMaxGcCount\", 30);\n+            List<java.lang.management.GarbageCollectorMXBean> collectors = ManagementFactory.getGarbageCollectorMXBeans();\n+            java.lang.management.GarbageCollectorMXBean cycleCollector = null;\n+            for (java.lang.management.GarbageCollectorMXBean bean : collectors) {\n+                if (bean.getName().contains(\"Cycles\")) {\n+                    cycleCollector = bean;\n+                }\n+            }\n+\n+            \/\/ Allocate ~300MB of long-lived objects\n+            for (int i = 0; i < 300; i++) {\n+                longLived.add(new byte[1_000_000]);\n+            }\n+\n+            \/\/ allocate short-lived garbage to the heap\n+            long end = System.currentTimeMillis() + 30_000; \/\/ 30 seconds\n+\n+            while (System.currentTimeMillis() < end) {\n+                byte[] garbage = new byte[1_000_000];\n+                garbage[0] = 1; \/\/ prevent optimization\n+\n+                Thread.sleep(10); \/\/ Pace to generate garbage at speed of ~100M\/s\n+            }\n+\n+            long gcCount = cycleCollector.getCollectionCount();\n+            Asserts.assertLessThan(gcCount, (long) expectedMaxGcCount, \"GC was triggered too many times. Expected to be less than: \" + expectedMaxGcCount + \", triggered: \" + gcCount);\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/gc\/shenandoah\/TestSoftMaxHeapSizeAvailableCalc.java","additions":123,"deletions":0,"binary":false,"changes":123,"status":"added"},{"patch":"@@ -102,0 +102,3 @@\n+                \"-XX:ShenandoahMinOldGenGrowthPercent=12.5\",\n+                \"-XX:ShenandoahIgnoreOldGrowthBelowPercentage=10\",\n+                \"-XX:ShenandoahMinOldGenGrowthRemainingHeapPercent=100\",\n@@ -103,1 +106,2 @@\n-                \"-XX:ShenandoahGuaranteedOldGCInterval=0\"\n+                \"-XX:ShenandoahGuaranteedOldGCInterval=0\",\n+                \"-XX:-UseCompactObjectHeaders\"\n@@ -113,0 +117,3 @@\n+                \"-XX:ShenandoahMinOldGenGrowthPercent=12.5\",\n+                \"-XX:ShenandoahIgnoreOldGrowthBelowPercentage=10\",\n+                \"-XX:ShenandoahMinOldGenGrowthRemainingHeapPercent=100\",\n","filename":"test\/hotspot\/jtreg\/gc\/shenandoah\/generational\/TestOldGrowthTriggers.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+ * @library \/test\/lib\n@@ -34,1 +35,3 @@\n- * @run main\/othervm -Xss384K -Xint TestStackOverflowDuringInit\n+ * @build jdk.test.whitebox.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI TestStackOverflowDuringInit\n@@ -39,0 +42,3 @@\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+import jdk.test.whitebox.WhiteBox;\n@@ -42,0 +48,3 @@\n+    static String expected = \"java.lang.NoClassDefFoundError: Could not initialize class TestStackOverflowDuringInit$LongCache\";\n+    static String cause = \"Caused by: java.lang.StackOverflowError\";\n+\n@@ -91,3 +100,2 @@\n-    public static void main(String[] args) throws Exception {\n-        String expected = \"java.lang.NoClassDefFoundError: Could not initialize class TestStackOverflowDuringInit$LongCache\";\n-        String cause = \"Caused by: java.lang.StackOverflowError\";\n+    static class Launcher {\n+        public static void main(String[] args) throws Exception {\n@@ -95,11 +103,12 @@\n-        \/\/ Pre-load, but not initialize, LongCache, else we will\n-        \/\/ hit SOE during class loading.\n-        System.out.println(\"Pre-loading ...\");\n-        Class<?> c = Class.forName(\"TestStackOverflowDuringInit$LongCache\",\n-                                   false,\n-                                   TestStackOverflowDuringInit.class.getClassLoader());\n-        try {\n-            recurse();\n-        } catch (Throwable ex) {\n-            \/\/            ex.printStackTrace();\n-            verify_stack(ex, expected, cause);\n+            \/\/ Pre-load, but not initialize, LongCache, else we will\n+            \/\/ hit SOE during class loading.\n+            System.out.println(\"Pre-loading ...\");\n+            Class<?> c = Class.forName(\"TestStackOverflowDuringInit$LongCache\",\n+                                       false,\n+                                       TestStackOverflowDuringInit.class.getClassLoader());\n+            try {\n+                recurse();\n+            } catch (Throwable ex) {\n+                \/\/            ex.printStackTrace();\n+                verify_stack(ex, expected, cause);\n+            }\n@@ -107,1 +116,0 @@\n-    }\n@@ -109,10 +117,11 @@\n-    private static void verify_stack(Throwable e, String expected, String cause) throws Exception {\n-        ByteArrayOutputStream byteOS = new ByteArrayOutputStream();\n-        try (PrintStream printStream = new PrintStream(byteOS)) {\n-            e.printStackTrace(printStream);\n-        }\n-        String stackTrace = byteOS.toString(\"ASCII\");\n-        System.out.println(stackTrace);\n-        if (!stackTrace.contains(expected) ||\n-            (cause != null && !stackTrace.contains(cause))) {\n-            throw new RuntimeException(expected + \" and\/or \" + cause + \" missing from stacktrace\");\n+        private static void verify_stack(Throwable e, String expected, String cause) throws Exception {\n+            ByteArrayOutputStream byteOS = new ByteArrayOutputStream();\n+            try (PrintStream printStream = new PrintStream(byteOS)) {\n+                e.printStackTrace(printStream);\n+            }\n+            String stackTrace = byteOS.toString(\"ASCII\");\n+            System.out.println(stackTrace);\n+            if (!stackTrace.contains(expected) ||\n+                (cause != null && !stackTrace.contains(cause))) {\n+                throw new RuntimeException(expected + \" and\/or \" + cause + \" missing from stacktrace\");\n+            }\n@@ -121,0 +130,13 @@\n+\n+    public static void main(String[] args) throws Exception {\n+        WhiteBox wb = WhiteBox.getWhiteBox();\n+        long minimumJavaStackSize = wb.getMinimumJavaStackSize();\n+        ProcessBuilder pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n+                \"-Xss\" + Long.toString(minimumJavaStackSize), \"-Xint\",\n+                Launcher.class.getName());\n+\n+        OutputAnalyzer analyzer = new OutputAnalyzer(pb.start());\n+        analyzer.shouldHaveExitValue(0);\n+        analyzer.shouldContain(expected);\n+        analyzer.shouldContain(cause);\n+    }\n","filename":"test\/hotspot\/jtreg\/runtime\/ClassInitErrors\/TestStackOverflowDuringInit.java","additions":49,"deletions":27,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -73,1 +73,5 @@\n-        assertTrue(res.length - 1 == 2, res.length - 1);\n+        if (res.length != 3) {\n+            output.reportDiagnosticSummary();\n+        }\n+\n+        assertTrue(res.length == 3, res.length);\n@@ -107,1 +111,5 @@\n-        assertTrue(res.length - 1 == 2, res.length - 1);\n+        if (res.length != 3) {\n+            output.reportDiagnosticSummary();\n+        }\n+\n+        assertTrue(res.length == 3, res.length);\n@@ -134,1 +142,1 @@\n-}\n\\ No newline at end of file\n+}\n","filename":"test\/hotspot\/jtreg\/runtime\/ErrorHandling\/StackWalkNativeToJava.java","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -0,0 +1,44 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8373411\n+ * @summary Testing -XX:+PrintSharedArchiveAndExit option with no shared heap\n+ * @requires vm.cds\n+ * @library \/test\/lib\n+ *\/\n+\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+\n+public class PrintSharedArchiveAndExitNoHeap {\n+    public static void main(String[] args) throws Exception {\n+        \/\/ This used to crash when trying to figure out if interned string should be printed\n+        OutputAnalyzer oa = ProcessTools.executeTestJava(\"-XX:AOTCacheOutput=.\/PrintSharedArchiveAndExitNoHeap.jsa\", \"-XX:+PrintSharedArchiveAndExit\", \"-version\");\n+        oa.shouldHaveExitValue(0);\n+        \/\/ AOTCacheOutput forks a process, if that crashes then the above check is not enough\n+        \/\/ and we have to check the output to figure out if it crashed.\n+        oa.shouldNotContain(\"Internal Error\");\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/PrintSharedArchiveAndExitNoHeap.java","additions":44,"deletions":0,"binary":false,"changes":44,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,2 @@\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n@@ -46,2 +48,38 @@\n-        String regex = \"Average bucket size     :     ([0-9]+\\\\.[0-9]+).*\";\n-        String s = output.firstMatch(regex, 1);\n+        \/* [1] There may be other table stats that precede the symbol tabble.\n+               Skip all thse until we find this:\n+\n+           [0.677s][info][aot,hashtables] Shared symbol table stats -------- base: 0x0000000800000000\n+           [0.677s][info][aot,hashtables] Number of entries       :     46244\n+           [0.677s][info][aot,hashtables] Total bytes used        :    393792\n+           [0.677s][info][aot,hashtables] Average bytes per entry :     8.516\n+           [0.677s][info][aot,hashtables] Average bucket size     :     7.734\n+           [0.677s][info][aot,hashtables] Variance of bucket size :     7.513\n+           [0.677s][info][aot,hashtables] Std. dev. of bucket size:     2.741\n+           [0.677s][info][aot,hashtables] Maximum bucket size     :        20\n+           [0.677s][info][aot,hashtables] Empty buckets           :         2\n+           [0.677s][info][aot,hashtables] Value_Only buckets      :        24\n+           [0.677s][info][aot,hashtables] Other buckets           :      5953\n+           ....\n+        *\/\n+        Pattern pattern0 = Pattern.compile(\"Shared symbol table stats.*\", Pattern.DOTALL);\n+        Matcher matcher0 = pattern0.matcher(output.getStdout());\n+        String stat = null;\n+        if (matcher0.find()) {\n+            stat = matcher0.group(0);\n+        }\n+        if (stat == null) {\n+            throw new Exception(\"FAILED: pattern \\\"\" + pattern0 + \"\\\" not found\");\n+        }\n+\n+        \/* (2) The first \"Average bucket size\" line in the remaining output is for the\n+               shared symbol table *\/\n+        Pattern pattern = Pattern.compile(\"Average bucket size *: *([0-9]+\\\\.[0-9]+).*\", Pattern.MULTILINE);\n+        Matcher matcher = pattern.matcher(stat);\n+        String s = null;\n+        if (matcher.find()) {\n+            s = matcher.group(1);\n+        }\n+        if (s == null) {\n+            throw new Exception(\"FAILED: pattern \\\"\" + pattern + \"\\\" not found\");\n+        }\n+\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/SharedSymbolTableBucketSize.java","additions":41,"deletions":3,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -86,11 +86,0 @@\n-        \/\/----------------------------------------------------------------------\n-        printTestCase(\"All old -Xlog:cds+heap logs have been changed to -Xlog:aot+heap should alias to -Xlog:cds+heap\");\n-        pb = ProcessTools.createLimitedTestJavaProcessBuilder(\n-            \"-XX:AOTCache=\" + aotCacheFile,\n-            \"-Xlog:aot+heap\",\n-            \"-cp\", appJar, helloClass);\n-        out = CDSTestUtils.executeAndLog(pb, \"prod\");\n-        out.shouldNotContain(\"No tag set matches selection: aot+heap\");\n-        out.shouldContain(\"[aot,heap] resolve subgraph java.lang.Integer$IntegerCache\");\n-        out.shouldHaveExitValue(0);\n-\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/aotCache\/AOTLoggingTag.java","additions":0,"deletions":11,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -0,0 +1,261 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+\/**\n+ * @test AOT cache should preserve heap object identity when required by JLS. For example, Enums and Integers.\n+ * @requires vm.cds\n+ * @requires vm.cds.supports.aot.class.linking\n+ * @requires vm.debug\n+ * @library \/test\/lib\n+ * @build HeapObjectIdentity\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller -jar dummy.jar\n+ *                 Dummy\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller -jar boot.jar\n+ *                 HeapObjectIdentityApp\n+ *                 MyAOTInitedClass\n+ *                 MyAOTInitedClass$MyEnum\n+ *                 MyAOTInitedClass$Wrapper\n+ * @run driver HeapObjectIdentity AOT --two-step-training\n+ *\/\n+\n+import jdk.test.lib.cds.CDSAppTester;\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.helpers.ClassFileInstaller;\n+\n+public class HeapObjectIdentity {\n+    static final String appJar = ClassFileInstaller.getJarPath(\"dummy.jar\");\n+    static final String bootJar = ClassFileInstaller.getJarPath(\"boot.jar\");\n+    static final String mainClass = \"HeapObjectIdentityApp\"; \/\/ Loaded from boot.jar\n+\n+    public static void main(String[] args) throws Exception {\n+        Tester t = new Tester();\n+        t.run(args);\n+\n+        \/\/ Integer$IntegerCache should preserve the object identity of cached Integer objects,\n+        \/\/ even when the cache size is different between assembly and production.\n+        t.productionRun(new String[] {\n+                \"-XX:AutoBoxCacheMax=2048\"\n+                });\n+    }\n+\n+    static class Tester extends CDSAppTester {\n+        public Tester() {\n+            super(mainClass);\n+        }\n+\n+        @Override\n+        public String classpath(RunMode runMode) {\n+            return appJar;\n+        }\n+\n+        @Override\n+        public String[] vmArgs(RunMode runMode) {\n+            String bootcp = \"-Xbootclasspath\/a:\" + bootJar;\n+            if (runMode == RunMode.ASSEMBLY) {\n+                return new String[] {\n+                    \"-Xlog:aot+class=debug\",\n+                    \"-XX:AOTInitTestClass=MyAOTInitedClass\",\n+                    bootcp\n+                };\n+            } else {\n+                return new String[] {bootcp};\n+            }\n+        }\n+\n+        @Override\n+        public String[] appCommandLine(RunMode runMode) {\n+            return new String[] {\n+                mainClass,\n+                runMode.toString(),\n+            };\n+        }\n+\n+        @Override\n+        public void checkExecution(OutputAnalyzer out, RunMode runMode) throws Exception {\n+            if (runMode == RunMode.ASSEMBLY) {\n+                out.shouldContain(\"MyAOTInitedClass aot-linked inited\");\n+            }\n+        }\n+    }\n+}\n+\n+class HeapObjectIdentityApp {\n+    public static void main(String... args) {\n+        MyAOTInitedClass.test();\n+    }\n+}\n+\n+\/\/ This class is loaded by the boot loader, as -XX:AOTInitTestClass is not too friendly\n+\/\/ with classes by other loaders.\n+class MyAOTInitedClass {\n+    static Object[] archivedObjects;\n+    static {\n+        if (archivedObjects == null) {\n+            archivedObjects = new Object[14];\n+            archivedObjects[0] = Wrapper.BOOLEAN;\n+            archivedObjects[1] = Wrapper.INT.zero();\n+            archivedObjects[2] = Wrapper.DOUBLE.zero();\n+            archivedObjects[3] = MyEnum.DUMMY1;\n+\n+            archivedObjects[4] = Boolean.class;\n+            archivedObjects[5] = Byte.class;\n+            archivedObjects[6] = Character.class;\n+            archivedObjects[7] = Short.class;\n+            archivedObjects[8] = Integer.class;\n+            archivedObjects[9] = Long.class;\n+            archivedObjects[10] = Float.class;\n+            archivedObjects[11] = Double.class;\n+            archivedObjects[12] = Void.class;\n+\n+            archivedObjects[13] = Integer.valueOf(1);\n+        } else {\n+            System.out.println(\"Initialized from CDS\");\n+        }\n+    }\n+\n+    public static void test() {\n+        if (archivedObjects[0] != Wrapper.BOOLEAN) {\n+            throw new RuntimeException(\"Huh 0\");\n+        }\n+\n+        if (archivedObjects[1] != Wrapper.INT.zero()) {\n+            throw new RuntimeException(\"Huh 1\");\n+        }\n+\n+        if (archivedObjects[2] != Wrapper.DOUBLE.zero()) {\n+            throw new RuntimeException(\"Huh 2\");\n+        }\n+\n+        if (archivedObjects[3] != MyEnum.DUMMY1) {\n+            throw new RuntimeException(\"Huh 3\");\n+        }\n+\n+        if (MyEnum.BOOLEAN != true) {\n+            throw new RuntimeException(\"Huh 10.1\");\n+        }\n+        if (MyEnum.BYTE != -128) {\n+            throw new RuntimeException(\"Huh 10.2\");\n+        }\n+        if (MyEnum.CHAR != 'c') {\n+            throw new RuntimeException(\"Huh 10.3\");\n+        }\n+        if (MyEnum.SHORT != -12345) {\n+            throw new RuntimeException(\"Huh 10.4\");\n+        }\n+        if (MyEnum.INT != -123456) {\n+            throw new RuntimeException(\"Huh 10.5\");\n+        }\n+        if (MyEnum.LONG != 0x1234567890L) {\n+            throw new RuntimeException(\"Huh 10.6\");\n+        }\n+        if (MyEnum.LONG2 != -0x1234567890L) {\n+            throw new RuntimeException(\"Huh 10.7\");\n+        }\n+        if (MyEnum.FLOAT != 567891.0f) {\n+            throw new RuntimeException(\"Huh 10.8\");\n+        }\n+        if (MyEnum.DOUBLE != 12345678905678.890) {\n+            throw new RuntimeException(\"Huh 10.9\");\n+        }\n+\n+        checkClass(4, Boolean.class);\n+        checkClass(5, Byte.class);\n+        checkClass(6, Character.class);\n+        checkClass(7, Short.class);\n+        checkClass(8, Integer.class);\n+        checkClass(9, Long.class);\n+        checkClass(10, Float.class);\n+        checkClass(11, Double.class);\n+        checkClass(12, Void.class);\n+\n+        if (archivedObjects[13] != Integer.valueOf(1)) {\n+            throw new RuntimeException(\"Integer cache identity test failed\");\n+        }\n+\n+        System.out.println(\"Success!\");\n+    }\n+\n+    static void checkClass(int index, Class c) {\n+        if (archivedObjects[index] != c) {\n+            throw new RuntimeException(\"archivedObjects[\" + index + \"] should be \" + c);\n+        }\n+    }\n+\n+    \/\/ Simplified version of sun.invoke.util.Wrapper\n+    public enum Wrapper {\n+        \/\/        wrapperType      simple     primitiveType  simple     char  emptyArray\n+        BOOLEAN(  Boolean.class,   \"Boolean\", boolean.class, \"boolean\", 'Z', new boolean[0]),\n+        INT    (  Integer.class,   \"Integer\",     int.class,     \"int\", 'I', new     int[0]),\n+        DOUBLE (   Double.class,    \"Double\",  double.class,  \"double\", 'D', new  double[0])\n+        ;\n+\n+        public static final int COUNT = 10;\n+        private static final Object DOUBLE_ZERO = (Double)(double)0;\n+\n+        private final Class<?> wrapperType;\n+        private final Class<?> primitiveType;\n+        private final char     basicTypeChar;\n+        private final String   basicTypeString;\n+        private final Object   emptyArray;\n+\n+        Wrapper(Class<?> wtype,\n+                String wtypeName,\n+                Class<?> ptype,\n+                String ptypeName,\n+                char tchar,\n+                Object emptyArray) {\n+            this.wrapperType = wtype;\n+            this.primitiveType = ptype;\n+            this.basicTypeChar = tchar;\n+            this.basicTypeString = String.valueOf(this.basicTypeChar);\n+            this.emptyArray = emptyArray;\n+        }\n+\n+        public Object zero() {\n+            return switch (this) {\n+                case BOOLEAN -> Boolean.FALSE;\n+                case INT -> (Integer)0;\n+                case DOUBLE -> DOUBLE_ZERO;\n+                default -> null;\n+            };\n+        }\n+    }\n+\n+    enum MyEnum {\n+        DUMMY1,\n+        DUMMY2;\n+\n+        static final boolean BOOLEAN = true;\n+        static final byte    BYTE    = -128;\n+        static final short   SHORT   = -12345;\n+        static final char    CHAR    = 'c';\n+        static final int     INT     = -123456;\n+        static final long    LONG    =  0x1234567890L;\n+        static final long    LONG2   = -0x1234567890L;\n+        static final float   FLOAT   = 567891.0f;\n+        static final double  DOUBLE  = 12345678905678.890;\n+    }\n+}\n+\n+class Dummy {}\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/aotCache\/HeapObjectIdentity.java","additions":261,"deletions":0,"binary":false,"changes":261,"status":"added"},{"patch":"@@ -39,1 +39,1 @@\n- *             CDSTestClassE CDSTestClassF CDSTestClassG CDSTestClassG$MyEnum CDSTestClassG$Wrapper\n+ *             CDSTestClassE CDSTestClassF\n@@ -61,1 +61,0 @@\n-    static final String CDSTestClassG_name = CDSTestClassG.class.getName();\n@@ -165,9 +164,0 @@\n-\n-        testCase(\"Complex enums\");\n-        output = dumpBootAndHello(CDSTestClassG_name, \"-XX:+AOTClassLinking\", \"-Xlog:cds+class=debug\");\n-        mustSucceed(output);\n-\n-        TestCommon.run(\"-Xbootclasspath\/a:\" + bootJar, \"-cp\", appJar, \"-Xlog:aot+heap,cds+init\",\n-                       CDSTestClassG_name)\n-            .assertNormalExit(\"init subgraph \" + CDSTestClassG_name,\n-                              \"Initialized from CDS\");\n@@ -290,144 +280,0 @@\n-\n-class CDSTestClassG {\n-    static Object[] archivedObjects;\n-    static {\n-        if (archivedObjects == null) {\n-            archivedObjects = new Object[13];\n-            archivedObjects[0] = Wrapper.BOOLEAN;\n-            archivedObjects[1] = Wrapper.INT.zero();\n-            archivedObjects[2] = Wrapper.DOUBLE.zero();\n-            archivedObjects[3] = MyEnum.DUMMY1;\n-\n-            archivedObjects[4] = Boolean.class;\n-            archivedObjects[5] = Byte.class;\n-            archivedObjects[6] = Character.class;\n-            archivedObjects[7] = Short.class;\n-            archivedObjects[8] = Integer.class;\n-            archivedObjects[9] = Long.class;\n-            archivedObjects[10] = Float.class;\n-            archivedObjects[11] = Double.class;\n-            archivedObjects[12] = Void.class;\n-        } else {\n-            System.out.println(\"Initialized from CDS\");\n-        }\n-    }\n-\n-    public static void main(String args[]) {\n-        if (archivedObjects[0] != Wrapper.BOOLEAN) {\n-            throw new RuntimeException(\"Huh 0\");\n-        }\n-\n-        if (archivedObjects[1] != Wrapper.INT.zero()) {\n-            throw new RuntimeException(\"Huh 1\");\n-        }\n-\n-        if (archivedObjects[2] != Wrapper.DOUBLE.zero()) {\n-            throw new RuntimeException(\"Huh 2\");\n-        }\n-\n-        if (archivedObjects[3] != MyEnum.DUMMY1) {\n-            throw new RuntimeException(\"Huh 3\");\n-        }\n-\n-        if (MyEnum.BOOLEAN != true) {\n-            throw new RuntimeException(\"Huh 10.1\");\n-        }\n-        if (MyEnum.BYTE != -128) {\n-            throw new RuntimeException(\"Huh 10.2\");\n-        }\n-        if (MyEnum.CHAR != 'c') {\n-            throw new RuntimeException(\"Huh 10.3\");\n-        }\n-        if (MyEnum.SHORT != -12345) {\n-            throw new RuntimeException(\"Huh 10.4\");\n-        }\n-        if (MyEnum.INT != -123456) {\n-            throw new RuntimeException(\"Huh 10.5\");\n-        }\n-        if (MyEnum.LONG != 0x1234567890L) {\n-            throw new RuntimeException(\"Huh 10.6\");\n-        }\n-        if (MyEnum.LONG2 != -0x1234567890L) {\n-            throw new RuntimeException(\"Huh 10.7\");\n-        }\n-        if (MyEnum.FLOAT != 567891.0f) {\n-            throw new RuntimeException(\"Huh 10.8\");\n-        }\n-        if (MyEnum.DOUBLE != 12345678905678.890) {\n-            throw new RuntimeException(\"Huh 10.9\");\n-        }\n-\n-        checkClass(4, Boolean.class);\n-        checkClass(5, Byte.class);\n-        checkClass(6, Character.class);\n-        checkClass(7, Short.class);\n-        checkClass(8, Integer.class);\n-        checkClass(9, Long.class);\n-        checkClass(10, Float.class);\n-        checkClass(11, Double.class);\n-        checkClass(12, Void.class);\n-\n-        System.out.println(\"Success!\");\n-    }\n-\n-    static void checkClass(int index, Class c) {\n-        if (archivedObjects[index] != c) {\n-            throw new RuntimeException(\"archivedObjects[\" + index + \"] should be \" + c);\n-        }\n-    }\n-\n-    \/\/ Simplified version of sun.invoke.util.Wrapper\n-    public enum Wrapper {\n-        \/\/        wrapperType      simple     primitiveType  simple     char  emptyArray\n-        BOOLEAN(  Boolean.class,   \"Boolean\", boolean.class, \"boolean\", 'Z', new boolean[0]),\n-        INT    (  Integer.class,   \"Integer\",     int.class,     \"int\", 'I', new     int[0]),\n-        DOUBLE (   Double.class,    \"Double\",  double.class,  \"double\", 'D', new  double[0])\n-        ;\n-\n-        public static final int COUNT = 10;\n-        private static final Object DOUBLE_ZERO = (Double)(double)0;\n-\n-        private final Class<?> wrapperType;\n-        private final Class<?> primitiveType;\n-        private final char     basicTypeChar;\n-        private final String   basicTypeString;\n-        private final Object   emptyArray;\n-\n-        Wrapper(Class<?> wtype,\n-                String wtypeName,\n-                Class<?> ptype,\n-                String ptypeName,\n-                char tchar,\n-                Object emptyArray) {\n-            this.wrapperType = wtype;\n-            this.primitiveType = ptype;\n-            this.basicTypeChar = tchar;\n-            this.basicTypeString = String.valueOf(this.basicTypeChar);\n-            this.emptyArray = emptyArray;\n-        }\n-\n-        public Object zero() {\n-            return switch (this) {\n-                case BOOLEAN -> Boolean.FALSE;\n-                case INT -> (Integer)0;\n-                case DOUBLE -> DOUBLE_ZERO;\n-                default -> null;\n-            };\n-        }\n-    }\n-\n-    enum MyEnum {\n-        DUMMY1,\n-        DUMMY2;\n-\n-        static final boolean BOOLEAN = true;\n-        static final byte    BYTE    = -128;\n-        static final short   SHORT   = -12345;\n-        static final char    CHAR    = 'c';\n-        static final int     INT     = -123456;\n-        static final long    LONG    =  0x1234567890L;\n-        static final long    LONG2   = -0x1234567890L;\n-        static final float   FLOAT   = 567891.0f;\n-        static final double  DOUBLE  = 12345678905678.890;\n-    }\n-}\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/cacheObject\/ArchiveHeapTestClass.java","additions":1,"deletions":155,"binary":false,"changes":156,"status":"modified"},{"patch":"@@ -101,2 +101,1 @@\n-            \"-notshared java\/util\/Locale\",\n-            \"-notshared sun\/util\/locale\/BaseLocale\",\n+            \"-notshared java\/util\/Calendar\",\n@@ -152,2 +151,2 @@\n-        \/\/ We will pass an option like \"-agentlib:SimpleClassFileLoadHook=java\/util\/Locale,XXX,XXX\".\n-        \/\/ The SimpleClassFileLoadHook agent would attempt to hook the java\/util\/Locale class\n+        \/\/ We will pass an option like \"-agentlib:SimpleClassFileLoadHook=java\/util\/Calendar,XXX,XXX\".\n+        \/\/ The SimpleClassFileLoadHook agent would attempt to hook the java\/util\/Calendar class\n@@ -161,1 +160,1 @@\n-        \/\/ to be updated. (You'd see the test case with java\/util\/Locale staring to fail).\n+        \/\/ to be updated. (You'd see the test case with java\/util\/Calendar staring to fail).\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/serviceability\/ReplaceCriticalClasses.java","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -72,1 +72,1 @@\n-        ProcessBuilder pb = ProcessTools.createTestJavaProcessBuilder(\"-verify\", \"-cp\", \".\",  classCName);\n+        ProcessBuilder pb = ProcessTools.createTestJavaProcessBuilder(\"-Xverify:all\", \"-cp\", \".\",  classCName);\n@@ -81,1 +81,1 @@\n-        pb = ProcessTools.createTestJavaProcessBuilder(\"-verify\", \"-cp\", \".\",  classCName);\n+        pb = ProcessTools.createTestJavaProcessBuilder(\"-Xverify:all\", \"-cp\", \".\",  classCName);\n@@ -98,1 +98,1 @@\n-        pb = ProcessTools.createTestJavaProcessBuilder(\"-verify\", \"-cp\", \".\",  classCName);\n+        pb = ProcessTools.createTestJavaProcessBuilder(\"-Xverify:all\", \"-cp\", \".\",  classCName);\n","filename":"test\/hotspot\/jtreg\/runtime\/verifier\/TestANewArray.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-        \"-Xlog:class+resolve=debug\", \"-verify\", \"-Xshare:off\", \"-version\");\n+        \"-Xlog:class+resolve=debug\", \"-Xverify:all\", \"-Xshare:off\", \"-version\");\n","filename":"test\/hotspot\/jtreg\/runtime\/verifier\/TraceClassRes.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n- * @run main\/othervm -verify StackMapTableTest\n+ * @run main\/othervm -Xverify:all StackMapTableTest\n","filename":"test\/hotspot\/jtreg\/runtime\/verifier\/stackMapTableTests\/StackMapTableTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -27,0 +27,2 @@\n+ * @comment Only need to run this once, in tier1.\n+ * @requires vm.flagless & vm.debug\n","filename":"test\/hotspot\/jtreg\/sources\/TestIncludesAreSorted.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,0 +27,2 @@\n+ * @comment Only need to run this once, in tier1.\n+ * @requires vm.flagless & vm.debug\n","filename":"test\/hotspot\/jtreg\/sources\/TestNoNULL.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,63 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package ir_framework.tests;\n+\n+import compiler.lib.ir_framework.*;\n+\n+\/*\n+ * @test\n+ * @bug 8373355\n+ * @summary Test that IR matching happens on the whole graph, not just nodes\n+ *          that can be found by traversing up from the Root.\n+ * @library \/test\/lib \/\n+ * @run main ${test.main.class}\n+ *\/\n+\n+public class TestIRFindFromAbove {\n+    public static boolean flag = false;\n+    public static int fld = 0;\n+\n+    public static void main(String[] args) {\n+        TestFramework.run();\n+    }\n+\n+    @Test\n+    @Warmup(0)\n+    \/\/ Simulate Xcomp with no warmup: ensure the flag branch is not an unstable if\n+    \/\/ but that we compile the infinite loop.\n+    @IR(counts = {IRNode.LOAD_I, \"1\", IRNode.STORE_I, \"1\", \".*NeverBranch.*\", \"0\"},\n+        phase = CompilePhase.ITER_GVN1)\n+    @IR(counts = {IRNode.LOAD_I, \"1\", IRNode.STORE_I, \"1\", \".*NeverBranch.*\", \"1\"},\n+        phase = CompilePhase.PHASEIDEALLOOP1)\n+    public static void test() {\n+        if (flag) {\n+            \/\/ This loop has no exit. So it is at first not connected down to Root.\n+            while (true) {\n+                \/\/ During PHASEIDEALLOOP1, we insert a NeverBranch here, with a fake\n+                \/\/ exit, that connects the loop down to Root.\n+                fld++; \/\/ LoadI and StoreI\n+            }\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/testlibrary_tests\/ir_framework\/tests\/TestIRFindFromAbove.java","additions":63,"deletions":0,"binary":false,"changes":63,"status":"added"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8359412\n+ * @bug 8359412 8370922\n@@ -29,0 +29,1 @@\n+ * @modules jdk.incubator.vector\n@@ -31,1 +32,1 @@\n- * @run main template_framework.examples.TestExpressions\n+ * @run main ${test.main.class}\n@@ -58,1 +59,1 @@\n-        comp.compile();\n+        comp.compile(\"--add-modules=jdk.incubator.vector\");\n@@ -61,1 +62,5 @@\n-        comp.invoke(\"p.xyz.InnerTest\", \"main\", new Object[] {new String[] {}});\n+        comp.invoke(\"p.xyz.InnerTest\", \"main\", new Object[] {new String[] {\n+            \"--add-modules=jdk.incubator.vector\",\n+            \"--add-opens\", \"jdk.incubator.vector\/jdk.incubator.vector=ALL-UNNAMED\",\n+            \"--add-opens\", \"java.base\/java.lang=ALL-UNNAMED\"\n+        }});\n@@ -124,1 +129,1 @@\n-        for (Expression operation : Operations.PRIMITIVE_OPERATIONS) {\n+        for (Expression operation : Operations.SCALAR_NUMERIC_OPERATIONS) {\n@@ -133,1 +138,1 @@\n-            Set.of(\"compiler.lib.verify.*\"),\n+            Set.of(\"compiler.lib.verify.*\", \"jdk.incubator.vector.Float16\"),\n","filename":"test\/hotspot\/jtreg\/testlibrary_tests\/template_framework\/examples\/TestExpressions.java","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @summary Test functionality of IntGenerator implementations.\n+ * @summary Test basic functionality of Verify implementations.\n@@ -29,1 +29,1 @@\n- * @run driver verify.tests.TestVerify\n+ * @run driver ${test.main.class}\n","filename":"test\/hotspot\/jtreg\/testlibrary_tests\/verify\/tests\/TestVerify.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,129 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @key randomness\n+ * @summary Test functionality of Verify implementations for Float16.\n+ * @modules jdk.incubator.vector\n+ * @library \/test\/lib \/\n+ * @run driver ${test.main.class}\n+ *\/\n+\n+package verify.tests;\n+\n+import java.lang.foreign.*;\n+import java.util.Random;\n+import jdk.test.lib.Utils;\n+\n+import jdk.incubator.vector.Float16;\n+\n+import compiler.lib.verify.*;\n+\n+public class TestVerifyFloat16 {\n+    private static final Random RANDOM = Utils.getRandomInstance();\n+\n+    public static void main(String[] args) {\n+        testArrayFloat16();\n+        testRawFloat16();\n+        testFloat16Random();\n+    }\n+\n+    public static void testArrayFloat16() {\n+        Float16[] a = new Float16[1000];\n+        Float16[] b = new Float16[1001];\n+        Float16[] c = new Float16[1000];\n+\n+        Verify.checkEQ(a, a);\n+        Verify.checkEQ(b, b);\n+        Verify.checkEQ(a, c);\n+        Verify.checkEQ(c, a);\n+\n+        \/\/ Size mismatch\n+        checkNE(a, b);\n+\n+        c[RANDOM.nextInt(c.length)] = Float16.valueOf(1f);\n+\n+        \/\/ Value mismatch\n+        checkNE(a, c);\n+    }\n+\n+    public static void testRawFloat16() {\n+        Float16 nan1 = Float16.shortBitsToFloat16((short)0xFFFF);\n+        Float16 nan2 = Float16.shortBitsToFloat16((short)0x7FFF);\n+        if (!Float16.isNaN(nan1)) { throw new RuntimeException(\"must be NaN\"); }\n+        if (!Float16.isNaN(nan2)) { throw new RuntimeException(\"must be NaN\"); }\n+        if (Float16.float16ToRawShortBits(nan1) != (short)0xFFFF) { throw new RuntimeException(\"wrong bits\"); }\n+        if (Float16.float16ToRawShortBits(nan2) != (short)0x7FFF) { throw new RuntimeException(\"wrong bits\"); }\n+\n+        Float16[] arr1 = new Float16[]{nan1};\n+        Float16[] arr2 = new Float16[]{nan2};\n+\n+        Verify.checkEQ(nan1, Float16.NaN);\n+        Verify.checkEQ(nan1, nan1);\n+        Verify.checkEQWithRawBits(nan1, nan1);\n+        Verify.checkEQ(nan1, nan2);\n+\n+        Verify.checkEQ(arr1, arr1);\n+        Verify.checkEQWithRawBits(arr1, arr1);\n+        Verify.checkEQ(arr1, arr2);\n+\n+        checkNEWithRawBits(nan1, nan2);\n+\n+        checkNEWithRawBits(arr1, arr2);\n+    }\n+\n+    public static void testFloat16Random() {\n+        \/\/ Testing all 2^16 * 2^16 = 2^32 would take a bit long, so we randomly sample instead.\n+        for (int i = 0; i < 10_000; i++) {\n+            short bitsA = (short)RANDOM.nextInt();\n+            short bitsB = (short)RANDOM.nextInt();\n+            Float16 a = Float16.shortBitsToFloat16(bitsA);\n+            Float16 b = Float16.shortBitsToFloat16(bitsB);\n+            if (bitsA == bitsB) {\n+                Verify.checkEQWithRawBits(a, b);\n+            } else {\n+                checkNEWithRawBits(a, b);\n+            }\n+            if (a.equals(b)) {\n+                Verify.checkEQ(a, b);\n+            } else {\n+                checkNE(a, b);\n+            }\n+        }\n+    }\n+\n+    public static void checkNE(Object a, Object b) {\n+         try {\n+            Verify.checkEQ(a, b);\n+            throw new RuntimeException(\"Should have thrown: \" + a + \" vs \" + b);\n+        } catch (VerifyException e) {}\n+    }\n+\n+    public static void checkNEWithRawBits(Object a, Object b) {\n+         try {\n+            Verify.checkEQWithRawBits(a, b);\n+            throw new RuntimeException(\"Should have thrown: \" + a + \" vs \" + b);\n+        } catch (VerifyException e) {}\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/testlibrary_tests\/verify\/tests\/TestVerifyFloat16.java","additions":129,"deletions":0,"binary":false,"changes":129,"status":"added"},{"patch":"@@ -155,1 +155,0 @@\n-java\/awt\/Mixing\/AWT_Mixing\/HierarchyBoundsListenerMixingTest.java 8049405 macosx-all\n@@ -164,27 +163,1 @@\n-java\/awt\/Mixing\/AWT_Mixing\/JButtonInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JButtonOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JColorChooserOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JEditorPaneInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JEditorPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JLabelInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JLabelOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JListInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JListOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JPanelInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JPanelOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JProgressBarInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JProgressBarOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JScrollBarInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JScrollBarOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JSliderInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JSliderOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JSpinnerInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JSpinnerOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JTableInGlassPaneOverlapping.java 8158801,8357360 windows-all,linux-all\n-java\/awt\/Mixing\/AWT_Mixing\/JTableOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JTextAreaInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JTextAreaOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JTextFieldInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JTextFieldOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JToggleButtonInGlassPaneOverlapping.java 8158801 windows-all\n-java\/awt\/Mixing\/AWT_Mixing\/JToggleButtonOverlapping.java 8158801 windows-all\n+java\/awt\/Mixing\/AWT_Mixing\/JTableInGlassPaneOverlapping.java 8357360 windows-all,linux-all\n@@ -644,3 +617,0 @@\n-javax\/sound\/sampled\/DirectAudio\/bug6372428.java                      8055097 generic-all\n-javax\/sound\/sampled\/Clip\/bug5070081.java                             8055097 generic-all\n-javax\/sound\/sampled\/DataLine\/LongFramePosition.java                  8055097 generic-all\n@@ -650,7 +620,0 @@\n-javax\/sound\/sampled\/Mixers\/DisabledAssertionCrash.java 7067310 generic-all\n-\n-javax\/sound\/midi\/Sequencer\/Recording.java 8167580,8265485 linux-all,macosx-aarch64\n-javax\/sound\/midi\/Sequencer\/Looping.java 8136897 generic-all\n-javax\/sound\/sampled\/Clip\/ClipIsRunningAfterStop.java 8307574 linux-x64\n-javax\/sound\/sampled\/Clip\/ClipFlushCrash.java 8308395 linux-x64\n-\n@@ -785,1 +748,0 @@\n-java\/awt\/Modal\/PrintDialogsTest\/PrintDialogsTest.java 8068378 generic-all\n","filename":"test\/jdk\/ProblemList.txt","additions":1,"deletions":39,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -96,0 +96,1 @@\n+                ee.printStackTrace(System.err);\n@@ -137,0 +138,7 @@\n+         * The \"main\" thread will be referenced during the ThreadDeathEvent, which\n+         * uses SUSPEND_NONE, so the thread might get gc'd and cause an unexpected\n+         * ObjectCollectedException. Disable it from collection to prevent problems.\n+         *\/\n+        mainThread.disableCollection();\n+\n+        \/*\n","filename":"test\/jdk\/com\/sun\/jdi\/AfterThreadDeathTest.java","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -38,0 +38,2 @@\n+\n+import java.net.SocketTimeoutException;\n@@ -85,8 +87,4 @@\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n-            futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n+            \/\/ launch a few concurrent connection attempts\n+            for (int i = 0; i < 8; i++) {\n+                futures.add(executorService.submit(() -> { attemptConnect(env); return null; }));\n+            }\n@@ -112,15 +110,29 @@\n-            LdapTimeoutTest.assertCompletion(CONNECT_MILLIS - 1000,\n-                   2 * CONNECT_MILLIS + TOLERANCE,\n-                   () -> new InitialDirContext(env));\n-        } catch (RuntimeException e) {\n-            final String msg = e.getCause() == null ? e.getMessage() : e.getCause().getMessage();\n-            \/\/ assertCompletion may wrap a CommunicationException in an RTE\n-            if (msg != null &&\n-                    (msg.contains(\"Network is unreachable\")\n-                            || msg.contains(\"No route to host\")\n-                            || msg.contains(\"Connection timed out\"))) {\n-                \/\/ got the expected exception\n-                System.out.println(\"Received expected RuntimeException message: \" + msg);\n-            } else {\n-                \/\/ propagate the unexpected exception\n-                throw e;\n+            final InitialDirContext unexpectedCtx =\n+                    LdapTimeoutTest.assertCompletion(CONNECT_MILLIS - 1000,\n+                            2 * CONNECT_MILLIS + TOLERANCE,\n+                            () -> new InitialDirContext(env));\n+            throw new RuntimeException(\"InitialDirContext construction was expected to fail,\" +\n+                    \" but returned \" + unexpectedCtx);\n+        } catch (Throwable t) {\n+            final NamingException namingEx = findNamingException(t);\n+            if (namingEx != null) {\n+                \/\/ found the NamingException, verify it's the right reason\n+                if (namingEx.getCause() instanceof SocketTimeoutException ste) {\n+                    \/\/ got the expected exception\n+                    System.out.println(\"Received expected SocketTimeoutException: \" + ste);\n+                    return;\n+                }\n+                \/\/ rely on the exception message to verify the expected exception\n+                final String msg = namingEx.getCause() == null\n+                        ? namingEx.getMessage()\n+                        : namingEx.getCause().getMessage();\n+                if (msg != null &&\n+                        (msg.contains(\"Network is unreachable\")\n+                                || msg.contains(\"No route to host\")\n+                                || msg.contains(\"Timed out waiting for lock\")\n+                                || msg.contains(\"Connect timed out\")\n+                                || msg.contains(\"Timeout exceeded while waiting for a connection\"))) {\n+                    \/\/ got the expected exception\n+                    System.out.println(\"Received expected NamingException with message: \" + msg);\n+                    return;\n+                }\n@@ -128,9 +140,3 @@\n-        } catch (NamingException ex) {\n-            final String msg = ex.getCause() == null ? ex.getMessage() : ex.getCause().getMessage();\n-            if (msg != null &&\n-                    (msg.contains(\"Network is unreachable\")\n-                        || msg.contains(\"Timed out waiting for lock\")\n-                        || msg.contains(\"Connect timed out\")\n-                        || msg.contains(\"Timeout exceeded while waiting for a connection\"))) {\n-                \/\/ got the expected exception\n-                System.out.println(\"Received expected NamingException message: \" + msg);\n+            \/\/ unexpected exception, propagate it\n+            if (t instanceof Exception e) {\n+                throw e;\n@@ -138,2 +144,1 @@\n-                \/\/ propagate the unexpected exception\n-                throw ex;\n+                throw new Exception(t);\n@@ -141,2 +146,0 @@\n-        } catch (Throwable t) {\n-            throw new RuntimeException(t);\n@@ -146,0 +149,12 @@\n+    \/\/ Find and return the NamingException from the given Throwable. Returns null if none found.\n+    private static NamingException findNamingException(final Throwable t) {\n+        Throwable cause = t;\n+        while (cause != null) {\n+            if (cause instanceof NamingException ne) {\n+                return ne;\n+            }\n+            cause = cause.getCause();\n+        }\n+        return null;\n+    }\n+\n","filename":"test\/jdk\/com\/sun\/jndi\/ldap\/LdapPoolTimeoutTest.java","additions":51,"deletions":36,"binary":false,"changes":87,"status":"modified"},{"patch":"@@ -0,0 +1,159 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8373677\n+ * @summary Tests for verifying that a non-SSL server can detect\n+ *          when a client attempts to use SSL.\n+ * @library \/test\/lib\n+ * @run junit\/othervm ${test.main.class}\n+ *\/\n+\n+import com.sun.net.httpserver.HttpExchange;\n+import com.sun.net.httpserver.HttpHandler;\n+import com.sun.net.httpserver.HttpServer;\n+import jdk.test.lib.net.SimpleSSLContext;\n+import jdk.test.lib.net.URIBuilder;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n+import java.net.Socket;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.net.http.HttpClient;\n+import java.net.http.HttpRequest;\n+import java.net.http.HttpResponse;\n+import java.util.logging.ConsoleHandler;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n+import javax.net.ssl.SSLException;\n+\n+import static com.sun.net.httpserver.HttpExchange.RSPBODY_EMPTY;\n+import static java.net.http.HttpClient.Builder.NO_PROXY;\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+public class ClearTextServerSSL {\n+\n+    static final InetAddress LOOPBACK_ADDR = InetAddress.getLoopbackAddress();\n+    static final boolean ENABLE_LOGGING = true;\n+    static final Logger logger = Logger.getLogger(\"com.sun.net.httpserver\");\n+\n+    static final String CTXT_PATH = \"\/ClearTextServerSSL\";\n+\n+    @BeforeAll\n+    public static void setup() {\n+        if (ENABLE_LOGGING) {\n+            ConsoleHandler ch = new ConsoleHandler();\n+            logger.setLevel(Level.ALL);\n+            ch.setLevel(Level.ALL);\n+            logger.addHandler(ch);\n+        }\n+    }\n+\n+    @Test\n+    public void test() throws Exception {\n+        var sslContext = new SimpleSSLContext().get();\n+        var handler = new TestHandler();\n+        var server = HttpServer.create(new InetSocketAddress(LOOPBACK_ADDR, 0), 0);\n+        server.createContext(path(\"\"), handler);\n+        server.start();\n+        try (var client = HttpClient.newBuilder()\n+                    .sslContext(sslContext)\n+                    .proxy(NO_PROXY)\n+                    .build()) {\n+            var request = HttpRequest.newBuilder()\n+                    .uri(uri(\"http\", server, path(\"\/clear\")))\n+                    .build();\n+            var response = client.send(request, HttpResponse.BodyHandlers.ofString());\n+            assertEquals(200, response.statusCode());\n+            var sslRequest = HttpRequest.newBuilder()\n+                    .uri(uri(\"https\", server, path(\"\/ssl\")))\n+                    .build();\n+            Assertions.assertThrows(SSLException.class, () -> {\n+                client.send(sslRequest, HttpResponse.BodyHandlers.ofString());\n+            });\n+            try (var socket = new Socket()) {\n+                socket.connect(server.getAddress());\n+                byte[] badRequest = {\n+                        22, 'B', 'A', 'D', ' ',\n+                        '\/', ' ' ,\n+                        'H', 'T', 'T', 'P', '\/', '1', '.', '1' };\n+                socket.getOutputStream().write(badRequest);\n+                socket.getOutputStream().flush();\n+                var reader = new InputStreamReader(socket.getInputStream());\n+                var line = reader.readAllLines();\n+                Assertions.assertEquals(\"HTTP\/1.1 400 Bad Request\", line.get(0));\n+                System.out.println(\"Got expected response:\");\n+                line.stream().map(l -> \"\\t\" + l).forEach(System.out::println);\n+            }\n+\n+        } finally {\n+            server.stop(0);\n+        }\n+    }\n+\n+    \/\/ --- infra ---\n+\n+    static String path(String path) {\n+        assert CTXT_PATH.startsWith(\"\/\");\n+        assert !CTXT_PATH.endsWith(\"\/\");\n+        if (path.startsWith(\"\/\")) {\n+            return CTXT_PATH + path;\n+        } else {\n+            return CTXT_PATH + \"\/\" + path;\n+        }\n+    }\n+\n+    static URI uri(String scheme, HttpServer server, String path) throws URISyntaxException {\n+        return URIBuilder.newBuilder()\n+                .scheme(scheme)\n+                .loopback()\n+                .port(server.getAddress().getPort())\n+                .path(path)\n+                .build();\n+    }\n+\n+    \/**\n+     * A test handler that reads any request bytes and sends\n+     * an empty 200 response\n+     *\/\n+    static class TestHandler implements HttpHandler {\n+        @java.lang.Override\n+        public void handle(HttpExchange exchange) throws IOException {\n+            try (var reqBody = exchange.getRequestBody()) {\n+                reqBody.readAllBytes();\n+                exchange.sendResponseHeaders(200, RSPBODY_EMPTY);\n+            } catch (Throwable t) {\n+                t.printStackTrace();\n+                exchange.sendResponseHeaders(500, RSPBODY_EMPTY);\n+            }\n+        }\n+    }\n+}\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/ClearTextServerSSL.java","additions":159,"deletions":0,"binary":false,"changes":159,"status":"added"},{"patch":"@@ -87,0 +87,1 @@\n+    private static final SSLContext serverSSLCtx = SimpleSSLContext.findSSLContext();\n@@ -171,2 +172,0 @@\n-        final SSLContext serverSSLCtx = new SimpleSSLContext().get();\n-        assertNotNull(serverSSLCtx, \"could not create SSLContext\");\n@@ -279,2 +278,0 @@\n-        final SSLContext serverSSLCtx = new SimpleSSLContext().get();\n-        assertNotNull(serverSSLCtx, \"could not create SSLContext\");\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/HttpsParametersClientAuthTest.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -76,1 +76,1 @@\n-    static SSLContext ctx;\n+    private static final SSLContext ctx = SimpleSSLContext.findSSLContext();\n@@ -125,1 +125,0 @@\n-            ctx = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/SANTest.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-    static SSLContext ctx;\n+    private static final SSLContext ctx = SimpleSSLContext.findSSLContext();\n@@ -87,1 +87,0 @@\n-            ctx = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/SelCacheTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -72,1 +72,1 @@\n-    static SSLContext ctx;\n+    private static final SSLContext ctx = SimpleSSLContext.findSSLContext();\n@@ -97,1 +97,0 @@\n-            ctx = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test1.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -59,1 +59,1 @@\n-    static SSLContext ctx;\n+    private static final SSLContext ctx = SimpleSSLContext.findSSLContext();\n@@ -80,1 +80,0 @@\n-            ctx = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test12.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-    static SSLContext ctx;\n+    private static final SSLContext ctx = SimpleSSLContext.findSSLContext();\n@@ -90,1 +90,0 @@\n-            ctx = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test13.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -24,1 +24,1 @@\n-\/**\n+\/*\n@@ -58,1 +58,1 @@\n-        SSLContext ssl = new SimpleSSLContext().get();\n+        SSLContext ssl = SimpleSSLContext.findSSLContext();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test6a.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-        SSLContext ssl = new SimpleSSLContext().get();\n+        SSLContext ssl = SimpleSSLContext.findSSLContext();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test7a.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -64,1 +64,1 @@\n-            SSLContext ssl = new SimpleSSLContext().get();\n+            SSLContext ssl = SimpleSSLContext.findSSLContext();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test8a.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -61,1 +61,1 @@\n-    static SSLContext ctx;\n+    private static final SSLContext ctx = SimpleSSLContext.findSSLContext();\n@@ -86,1 +86,0 @@\n-            ctx = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test9.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -59,2 +59,2 @@\n-    static SSLContext serverCtx;\n-    static volatile SSLContext clientCtx = null;\n+    private static final SSLContext serverCtx = SimpleSSLContext.findSSLContext();\n+    private static final SSLContext clientCtx = SimpleSSLContext.findSSLContext();\n@@ -79,2 +79,0 @@\n-            serverCtx = new SimpleSSLContext().get();\n-            clientCtx = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/Test9a.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,1 +66,1 @@\n-    SSLContext sslContext;\n+    private static final SSLContext sslContext = SimpleSSLContext.findSSLContext();\n@@ -80,1 +80,0 @@\n-        sslContext = new SimpleSSLContext().get();\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/bugs\/HandlerConnectionClose.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,1 +62,5 @@\n-    SSLContext sslContext;\n+    private static final SSLContext sslContext = SimpleSSLContext.findSSLContext();\n+\n+    static {\n+        SSLContext.setDefault(sslContext);\n+    }\n@@ -72,2 +76,0 @@\n-        sslContext = new SimpleSSLContext().get();\n-        SSLContext.setDefault(sslContext);\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/simpleserver\/HttpsServerAlertTest.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +43,0 @@\n-import java.util.concurrent.atomic.AtomicInteger;\n@@ -70,1 +69,5 @@\n-    SSLContext sslContext;\n+    private static final SSLContext sslContext = SimpleSSLContext.findSSLContext();\n+\n+    static {\n+        SSLContext.setDefault(sslContext);\n+    }\n@@ -80,2 +83,0 @@\n-        sslContext = new SimpleSSLContext().get();\n-        SSLContext.setDefault(sslContext);\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/simpleserver\/HttpsServerTest.java","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -81,1 +81,1 @@\n-    static SSLContext sslContext;\n+    private static final SSLContext sslContext = SimpleSSLContext.findSSLContext();\n@@ -89,4 +89,0 @@\n-\n-        sslContext = new SimpleSSLContext().get();\n-        if (sslContext == null)\n-            throw new AssertionError(\"Unexpected null sslContext\");\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/simpleserver\/jwebserver\/MaxRequestTimeTest.java","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -98,0 +98,2 @@\n+            robot.waitForIdle();\n+            robot.delay(250);\n","filename":"test\/jdk\/java\/awt\/Choice\/PopupPosTest\/PopupPosTest.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,1 +47,1 @@\n-    AtomicBoolean typed = new AtomicBoolean(false);\n+    final AtomicBoolean typed = new AtomicBoolean(false);\n@@ -117,0 +117,1 @@\n+        robot.delay(1000);\n","filename":"test\/jdk\/java\/awt\/Focus\/ClearLwQueueBreakTest\/ClearLwQueueBreakTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+import java.awt.Robot;\n@@ -38,2 +39,1 @@\n-    private static volatile boolean passed;\n-\n+    private static Robot robot;\n@@ -41,7 +41,5 @@\n-        EventQueue.invokeAndWait(() -> {\n-            try {\n-                createAndShowUI();\n-\n-                f.setSize(200, 200);\n-                passed = verifyFrameSize(new Dimension(300, 300));\n-                isFrameSizeOk(passed);\n+        robot = new Robot();\n+        try {\n+            EventQueue.invokeAndWait(FrameSetMinimumSizeTest::createAndShowUI);\n+            robot.waitForIdle();\n+            robot.delay(500);\n@@ -49,3 +47,4 @@\n-                f.setSize(200, 400);\n-                passed = verifyFrameSize(new Dimension(300, 400));\n-                isFrameSizeOk(passed);\n+            test(\n+                new Dimension(200, 200),\n+                new Dimension(300, 300)\n+            );\n@@ -53,3 +52,4 @@\n-                f.setSize(400, 200);\n-                passed = verifyFrameSize(new Dimension(400, 300));\n-                isFrameSizeOk(passed);\n+            test(\n+                new Dimension(200, 400),\n+                new Dimension(300, 400)\n+            );\n@@ -57,1 +57,4 @@\n-                f.setMinimumSize(null);\n+            test(\n+                new Dimension(400, 200),\n+                new Dimension(400, 300)\n+            );\n@@ -59,4 +62,7 @@\n-                f.setSize(200, 200);\n-                passed = verifyFrameSize(new Dimension(200, 200));\n-                isFrameSizeOk(passed);\n-            } finally {\n+            EventQueue.invokeAndWait(() -> f.setMinimumSize(null));\n+            test(\n+                new Dimension(200, 200),\n+                new Dimension(200, 200)\n+            );\n+        } finally {\n+            EventQueue.invokeAndWait(() -> {\n@@ -66,2 +72,10 @@\n-            }\n-        });\n+            });\n+        }\n+    }\n+\n+    private static void test(Dimension size, Dimension expected) throws Exception {\n+        robot.waitForIdle();\n+        robot.delay(250);\n+        EventQueue.invokeAndWait(() -> f.setSize(size));\n+        robot.waitForIdle();\n+        EventQueue.invokeAndWait(() -> verifyFrameSize(expected));\n@@ -74,0 +88,1 @@\n+        f.setLocationRelativeTo(null);\n@@ -77,2 +92,1 @@\n-    private static boolean verifyFrameSize(Dimension expected) {\n-\n+    private static void verifyFrameSize(Dimension expected) {\n@@ -80,9 +94,4 @@\n-            return false;\n-        }\n-        return true;\n-    }\n-\n-    private static void isFrameSizeOk(boolean passed) {\n-        if (!passed) {\n-            throw new RuntimeException(\"Frame's setMinimumSize not honoured for the\" +\n-                    \" frame size: \" + f.getSize());\n+            String message =\n+                    \"Frame's setMinimumSize not honoured for the frame size: %s. Expected %s\"\n+                            .formatted(f.getSize(), expected);\n+            throw new RuntimeException(message);\n","filename":"test\/jdk\/java\/awt\/Frame\/FrameSetMinimumSizeTest.java","additions":43,"deletions":34,"binary":false,"changes":77,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,1 +49,0 @@\n-    private static volatile int index;\n@@ -51,1 +50,0 @@\n-    private static Frame f;\n@@ -53,0 +51,1 @@\n+    private static volatile int frameNum;\n@@ -56,0 +55,1 @@\n+    private static final int MAX_FRAME_COUNT = 30;\n@@ -58,1 +58,2 @@\n-        gcs = GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice().getConfigurations();\n+        gcs = GraphicsEnvironment.getLocalGraphicsEnvironment()\n+                .getDefaultScreenDevice().getConfigurations();\n@@ -61,7 +62,24 @@\n-        try {\n-            EventQueue.invokeAndWait(() -> {\n-                createAndShowUI();\n-            });\n-            robot.delay(1000);\n-            System.out.println(\"frames.length: \"+frames.length);\n-            for (index = 0; index < frames.length; index++) {\n+\n+        \/\/ Limit the number of frames tested if needed\n+        if (gcs.length > MAX_FRAME_COUNT) {\n+            frames = new Frame[MAX_FRAME_COUNT];\n+        } else {\n+            frames = new Frame[gcs.length];\n+        }\n+        System.out.println(gcs.length + \" gcs found. Testing \"\n+                + frames.length + \" frame(s).\");\n+\n+        for (frameNum = 0; frameNum < frames.length; frameNum++) {\n+            try {\n+                EventQueue.invokeAndWait(() -> {\n+                    frames[frameNum] = new Frame(\"Frame w\/ gc \"\n+                            + frameNum, gcs[frameNum]);\n+                    frames[frameNum].setSize(100, 100);\n+                    frames[frameNum].setUndecorated(true);\n+                    frames[frameNum].setBackground(Color.WHITE);\n+                    frames[frameNum].setVisible(true);\n+                    System.out.println(\"Frame \" + frameNum + \" created\");\n+                });\n+\n+                robot.delay(1000);\n+\n@@ -69,2 +87,2 @@\n-                    p = frames[index].getLocation();\n-                    d = frames[index].getSize();\n+                    p = frames[frameNum].getLocation();\n+                    d = frames[frameNum].getSize();\n@@ -72,0 +90,1 @@\n+\n@@ -76,1 +95,3 @@\n-                        ImageIO.write(img, \"png\", new File(\"Frame_\" + index + \".png\"));\n+                        ImageIO.write(img, \"png\",\n+                                new File(\"Frame_\"\n+                                        + frameNum + \".png\"));\n@@ -78,1 +99,2 @@\n-                    throw new RuntimeException(\"Frame visual test failed with non-white background color\");\n+                    throw new RuntimeException(\"Frame visual test \" +\n+                            \"failed with non-white background color\");\n@@ -80,3 +102,1 @@\n-            }\n-        } finally {\n-            for (index = 0; index < frames.length; index++) {\n+            } finally {\n@@ -84,2 +104,3 @@\n-                    if (frames[index] != null) {\n-                        frames[index].dispose();\n+                    if (frames[frameNum] != null) {\n+                        frames[frameNum].dispose();\n+                        System.out.println(\"Frame \" + frameNum + \" disposed\");\n@@ -92,11 +113,0 @@\n-    private static void createAndShowUI() {\n-        frames = new Frame[gcs.length];\n-        for (int i = 0; i < frames.length; i++) {\n-            frames[i] = new Frame(\"Frame w\/ gc \" + i, gcs[i]);\n-            frames[i].setSize(100, 100);\n-            frames[i].setUndecorated(true);\n-            frames[i].setBackground(Color.WHITE);\n-            frames[i].setVisible(true);\n-        }\n-    }\n-\n@@ -104,1 +114,0 @@\n-\n","filename":"test\/jdk\/java\/awt\/Frame\/FrameVisualTest.java","additions":41,"deletions":32,"binary":false,"changes":73,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,3 +34,10 @@\n-import java.awt.*;\n-import java.awt.event.*;\n-import javax.swing.*;\n+import java.awt.FlowLayout;\n+import java.awt.Robot;\n+import javax.swing.AbstractAction;\n+import javax.swing.JButton;\n+import javax.swing.JFrame;\n+import javax.swing.JTextField;\n+import javax.swing.KeyStroke;\n+import java.awt.event.ActionEvent;\n+import java.awt.event.KeyAdapter;\n+import java.awt.event.KeyEvent;\n@@ -45,1 +52,1 @@\n-    AtomicBoolean gotEvent = new AtomicBoolean(false);\n+    final AtomicBoolean gotEvent = new AtomicBoolean(false);\n@@ -85,0 +92,1 @@\n+        robot.delay(1000);\n@@ -88,0 +96,1 @@\n+        robot.delay(500);\n","filename":"test\/jdk\/java\/awt\/KeyboardFocusmanager\/TypeAhead\/ButtonActionKeyTest\/ButtonActionKeyTest.java","additions":14,"deletions":5,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -100,0 +100,1 @@\n+            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n","filename":"test\/jdk\/java\/awt\/LightweightComponent\/LightWeightTabFocus\/LightWeightTabFocus.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import java.awt.event.InputEvent;\n@@ -30,0 +29,1 @@\n+\n@@ -33,1 +33,0 @@\n-import test.java.awt.regtesthelpers.Util;\n@@ -49,1 +48,0 @@\n-    private volatile Point ancestorLoc;\n@@ -86,0 +84,1 @@\n+        f.setLocationRelativeTo(null);\n@@ -97,0 +96,5 @@\n+    @Override\n+    protected final boolean isMultiFramesTest() {\n+        return false;\n+    }\n+\n@@ -109,33 +113,2 @@\n-        if (testResize) {\n-            wasLWClicked = false;\n-            try {\n-                SwingUtilities.invokeAndWait(new Runnable() {\n-\n-                    public void run() {\n-                        testedComponent.setBounds(0, 0, testedComponent.getPreferredSize().width, testedComponent.getPreferredSize().height + 20);\n-                        ancestorLoc = f.getLocationOnScreen();\n-                    }\n-                });\n-            } catch (InterruptedException ex) {\n-                fail(ex.getMessage());\n-            } catch (InvocationTargetException ex) {\n-                fail(ex.getMessage());\n-            }\n-            Point lLoc = testedComponent.getLocationOnScreen();\n-            lLoc.translate(1, testedComponent.getPreferredSize().height + 1);\n-\n-            \/* this is a workaround for certain jtreg(?) focus issue:\n-               tests fail starting after failing mixing tests but always pass alone.\n-             *\/\n-            Util.waitForIdle(robot);\n-            ancestorLoc.translate(isOel7orLater() ? 5 : f.getWidth() \/ 2 - 15, 2);\n-            robot.mouseMove(ancestorLoc.x, ancestorLoc.y);\n-            Util.waitForIdle(robot);\n-            robot.mousePress(InputEvent.BUTTON1_MASK);\n-            robot.delay(50);\n-            robot.mouseRelease(InputEvent.BUTTON1_MASK);\n-            Util.waitForIdle(robot);\n-\n-            clickAndBlink(robot, lLoc);\n-            return wasLWClicked;\n-        } else {\n+\n+        if (!testResize) {\n@@ -144,0 +117,24 @@\n+\n+        wasLWClicked = false;\n+        try {\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+\n+                public void run() {\n+                    testedComponent.setBounds(0, 0,\n+                            testedComponent.getPreferredSize().width,\n+                            testedComponent.getPreferredSize().height + 20);\n+                }\n+            });\n+        } catch (InterruptedException | InvocationTargetException ex) {\n+            fail(ex.getMessage());\n+        }\n+        Point lLoc = testedComponent.getLocationOnScreen();\n+        lLoc.translate(1, testedComponent.getPreferredSize().height + 1);\n+        clickAndBlink(robot, lLoc);\n+\n+        return wasLWClicked;\n+    }\n+\n+    @Override\n+    protected void cleanup() {\n+        f.dispose();\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/GlassPaneOverlappingTestBase.java","additions":34,"deletions":37,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,0 @@\n-        frame.setVisible(true);\n@@ -82,0 +81,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/JComboBoxOverlapping.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,1 +37,0 @@\n- * <p>See <a href=\"http:\/\/monaco.sfbay.sun.com\/detail.jsf?cr=6985399\">CR6768230<\/a> for details and base class for test info.\n@@ -120,0 +119,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/JInternalFrameMoveOverlapping.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -78,0 +78,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/JInternalFrameOverlapping.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,0 @@\n-import java.awt.Color;\n@@ -33,0 +32,1 @@\n+\n@@ -39,0 +39,1 @@\n+\n@@ -75,1 +76,0 @@\n-        frame.setVisible(true);\n@@ -107,0 +107,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/JMenuBarOverlapping.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,0 @@\n-import java.awt.Color;\n@@ -31,0 +30,1 @@\n+\n@@ -36,0 +36,1 @@\n+\n@@ -85,0 +86,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/JPopupMenuOverlapping.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -98,0 +98,1 @@\n+        f.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/JScrollPaneOverlapping.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -92,0 +92,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/JSplitPaneOverlapping.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+\n@@ -32,0 +33,1 @@\n+\n@@ -68,0 +70,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/MixingFrameResizing.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,7 @@\n-import java.awt.*;\n+import java.awt.BorderLayout;\n+import java.awt.Button;\n+import java.awt.Color;\n+import java.awt.Panel;\n+import java.awt.Point;\n+import java.awt.Robot;\n+import java.awt.Toolkit;\n@@ -27,2 +33,9 @@\n-import javax.swing.*;\n-import java.io.*;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+import javax.swing.JButton;\n+import javax.swing.JFrame;\n+import javax.swing.JPanel;\n+import javax.swing.SwingUtilities;\n+\n@@ -133,0 +146,1 @@\n+                frame.setLocationRelativeTo(null);\n@@ -301,0 +315,3 @@\n+\n+    static class TestPassedException extends RuntimeException {\n+    }\n@@ -302,2 +319,0 @@\n-class TestPassedException extends RuntimeException {\n-}\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/MixingPanelsResizing.java","additions":21,"deletions":6,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -59,1 +59,1 @@\n-        failMessage = \"Opacity test mismatchs\";\n+        failMessage = \"Opacity test mismatches\";\n@@ -65,1 +65,1 @@\n-    private final static String checkSeq = \"010000101\";\n+    private static final String checkSeq = \"010000101\";\n@@ -92,0 +92,1 @@\n+        frame.setLocationRelativeTo(null);\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/OpaqueOverlapping.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,0 +37,1 @@\n+import java.awt.Window;\n@@ -174,0 +175,1 @@\n+                    frame.setLocationRelativeTo(null);\n@@ -262,0 +264,3 @@\n+                if (container instanceof Window) {\n+                    ((Window) container).setLocationRelativeTo(null);\n+                }\n@@ -304,0 +309,1 @@\n+                eframe.setLocationRelativeTo(null);\n@@ -685,0 +691,3 @@\n+\n+    static class TestPassedException extends RuntimeException {\n+    }\n@@ -686,2 +695,0 @@\n-class TestPassedException extends RuntimeException {\n-}\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/OverlappingTestBase.java","additions":10,"deletions":3,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,4 +24,15 @@\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.util.regex.*;\n-import javax.swing.*;\n+import java.awt.Point;\n+import java.awt.Robot;\n+import java.awt.event.FocusAdapter;\n+import java.awt.event.FocusEvent;\n+import java.awt.event.MouseAdapter;\n+import java.awt.event.MouseEvent;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import javax.swing.JComponent;\n+import javax.swing.JFrame;\n+import javax.swing.SpringLayout;\n+\n@@ -58,0 +69,4 @@\n+    protected boolean isMultiFramesTest(){\n+        return true;\n+    }\n+\n@@ -117,0 +132,1 @@\n+        f.setLocationRelativeTo(null);\n@@ -143,11 +159,17 @@\n-        JFrame ancestor = (JFrame)(testedComponent.getTopLevelAncestor());\n-        if( ancestor != null ) {\n-            Point ancestorLoc = ancestor.getLocationOnScreen();\n-            ancestorLoc.translate(isOel7orLater() ? 5 :\n-                                             ancestor.getWidth() \/ 2 - 15, 2);\n-            robot.mouseMove(ancestorLoc.x, ancestorLoc.y);\n-            Util.waitForIdle(robot);\n-            robot.mousePress(InputEvent.BUTTON1_MASK);\n-            robot.delay(50);\n-            robot.mouseRelease(InputEvent.BUTTON1_MASK);\n-            Util.waitForIdle(robot);\n+        JFrame ancestor = (JFrame) (testedComponent.getTopLevelAncestor());\n+        if (ancestor != null) {\n+            final CountDownLatch latch = new CountDownLatch(1);\n+            ancestor.addFocusListener(new FocusAdapter() {\n+                @Override public void focusGained(FocusEvent e) {\n+                    latch.countDown();\n+                }\n+            });\n+            ancestor.requestFocus();\n+            try {\n+                if (!latch.await(1L, TimeUnit.SECONDS)) {\n+                    throw new RuntimeException(\n+                            \"Ancestor frame didn't receive focus\");\n+                }\n+            } catch (InterruptedException e) {\n+                throw new RuntimeException(e);\n+            }\n@@ -157,1 +179,3 @@\n-        Util.waitForIdle(robot);\n+        if (ancestor != null && isMultiFramesTest()) {\n+            ancestor.dispose();\n+        }\n@@ -175,1 +199,0 @@\n-\n","filename":"test\/jdk\/java\/awt\/Mixing\/AWT_Mixing\/SimpleOverlappingTestBase.java","additions":41,"deletions":18,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -52,34 +52,29 @@\n-    static final String INSTRUCTIONS = \"\"\"\n-        This test is free format, which means there is no enforced or guided sequence.\n-\n-        Please select each of\n-        (a) The dialog parent type.\n-        (b) The dialog modality type\n-        (c) The print dialog type (Print dialog or Page Setup dialog)\n-\n-        Once the choices have been made click the \"Start test\" button.\n-\n-        Three windows will appear\n-        (1) A Frame or a Dialog - in the case you selected \"Dialog\" as the parent type\n-        (2) a Window (ie an undecorated top-level)\n-        (3) A dialog with two buttons \"Open\" and \"Finish\"\n-\n-        Now check as follows whether modal blocking works as expected.\n-        Windows (1) and (2) contain a button which you should be able to press\n-        ONLY if you selected \"Non-modal\", or \"Modeless\" for modality type.\n-        In other cases window (3) will block input to (1) and (2)\n-\n-        Then push the \"Open\" button on the Dialog to show the printing dialog and check\n-        if it blocks the rest of the application - ie all of windows (1), (2) and (3)\n-        should ALWAYS be blocked when the print dialog is showing.\n-        Now cancel the printing dialog and check the correctness of modal blocking\n-        behavior for the Dialog again.\n-        To close all the 3 test windows please push the \"Finish\" button.\n-\n-        Repeat all the above for different combinations, which should include\n-        using all of the Dialog parent choices and all of the Dialog Modality types.\n-\n-        If any behave incorrectly, note the combination of choices and press Fail.\n-\n-        If all behave correctly, press Pass.\n-    \"\"\";\n+    static final String INSTRUCTIONS =\n+        \"1. On the Test UI Select:\\n\" +\n+        \"\\tThe dialog parent type. (e.g. Frame, Dialog, Hidden, Null)\\n\" +\n+        \"\\tThe dialog modality type. (e.g. Modal, Non-Modal, Toolkit modal).\\n\" +\n+        \"\\tThe print dialog type. (Print dialog or Page Setup dialog).\\n\\n\" +\n+        \"2. Next, click on 'Start test' - Three windows will appear:\\n\" +\n+        \"\\tWindow (1) -a Frame or Dialog (depending on selected parent type).\\n\" +\n+        \"\\tWindow (2) -an undecorated top-level Window.\\n\" +\n+        \"\\tWindow (3) -a Dialog containing two buttons: 'Open' and 'Finish'.\\n\" +\n+        \"\\tWindows (1) & (2) have a Dummy button.\\n\\n\" +\n+        \"3. Press the button on Window (1) & Window (2) \\n\" +\n+        \"Verification step:\\n\" +\n+        \"\\tIf Modality is 'Non-modal' or 'Modeless', Button is pressed \\n\" +\n+        \"\\tIf Modality is 'Document' & parent is not Frame\/Dialog, Button is pressed \\n\" +\n+        \"\\tIn all other cases, button is not pressed & Window (3) should \\n\" +\n+        \"\\tblock input to Windows (1) & (2).\\n\\n\" +\n+        \"4. Next, press the 'Open' button in Window (3) to open print dialog.\\n\\n\" +\n+        \"5. Press the button on Window (1) & Window (2)\\n\" +\n+        \"Verification step:\\n\" +\n+        \"\\tThe print dialog should block all three windows (1, 2, and 3).\\n\\n\" +\n+        \"6. Cancel the print dialog, Check again if Window (3) \" +\n+        \"blocks Windows (1) and (2) correctly.\\n\" +\n+        \"Verification step:\\n\" +\n+        \"\\tConditions as seen in Verification step 3 \" +\n+        \"should be seen, as before.\\n\" +\n+        \"To close all test windows, press 'Finish'.\\n\\n\" +\n+        \"7. Repeat the steps for different combinations of Dialog Parent, Dialog Modality Type, Print Dialg Type.\\n\" +\n+        \"Try every dialog parent type and every dialog modality type.\\n\\n\" +\n+        \"If any of the Verification step fails, note the combination and press 'Fail'.\\n\";\n","filename":"test\/jdk\/java\/awt\/Modal\/PrintDialogsTest\/PrintDialogsTest.java","additions":29,"deletions":34,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -194,0 +194,1 @@\n+                break;\n","filename":"test\/jdk\/java\/awt\/Modal\/PrintDialogsTest\/Test.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,0 +37,1 @@\n+ * @build jdk.test.lib.Platform\n@@ -40,0 +41,3 @@\n+import jdk.test.lib.Platform;\n+import jtreg.SkippedException;\n+\n@@ -43,0 +47,11 @@\n+        if (Platform.isOnWayland()) {\n+            \/\/ Some tested systems are still use XTEST(X11 protocol)\n+            \/\/ for key and mouse press emulation, but this will not work\n+            \/\/ outside of X11.\n+            \/\/ An emulated input event will reach X11 clients, but not the\n+            \/\/ Wayland compositor, which is responsible for window restacking.\n+            \/\/\n+            \/\/ This skip can be removed later once all systems switch to\n+            \/\/ the default remote desktop XDG portal.\n+             throw new SkippedException(\"SKIPPED: robot functionality is limited on the current platform.\");\n+        }\n","filename":"test\/jdk\/java\/awt\/Modal\/ToFront\/DialogToFrontModeless1Test.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -84,1 +84,3 @@\n-                    SINK = segment.get(ValueLayout.JAVA_INT, 0);\n+                    SINK = segment.get(ValueLayout.JAVA_INT, 0); \/\/ should throw\n+                    System.err.println(\"No exception thrown during outer memory access\");\n+                    System.exit(1);\n@@ -110,1 +112,3 @@\n-                    SINK = arena.allocate(4).get(ValueLayout.JAVA_INT, 0);\n+                    SINK = arena.allocate(4).get(ValueLayout.JAVA_INT, 0); \/\/ should throw\n+                    System.err.println(\"No exception thrown during reentrant memory access\");\n+                    System.exit(1);\n","filename":"test\/jdk\/java\/foreign\/sharedclosejvmti\/TestSharedCloseJvmti.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -26,1 +26,2 @@\n-#include <string.h>\n+#include <cstring>\n+#include <cstdlib>\n@@ -30,0 +31,1 @@\n+static jclass EXCEPTION_CLS;\n@@ -38,0 +40,2 @@\n+static const char* EXCEPTION_CLASS_NAME = \"Ljdk\/internal\/misc\/ScopedMemoryAccess$ScopedAccessError;\";\n+\n@@ -53,0 +57,8 @@\n+\n+  jclass ex_cls = jni_env->FindClass(EXCEPTION_CLASS_NAME);\n+  if (ex_cls == nullptr) {\n+    jni_env->ExceptionDescribe();\n+    return;\n+  }\n+\n+  EXCEPTION_CLS = (jclass) jni_env->NewGlobalRef(ex_cls);\n@@ -63,2 +75,3 @@\n-  if (strcmp(method_name, INTERCEPT_METHOD_NAME) != 0) {\n-    jvmti_env->Deallocate((unsigned char*) method_name);\n+  bool is_intercept_method = strcmp(method_name, INTERCEPT_METHOD_NAME) == 0;\n+  jvmti_env->Deallocate((unsigned char*) method_name);\n+  if (!is_intercept_method) {\n@@ -71,1 +84,0 @@\n-    jvmti_env->Deallocate((unsigned char*) method_name);\n@@ -78,1 +90,0 @@\n-    jvmti_env->Deallocate((unsigned char*) method_name);\n@@ -82,3 +93,3 @@\n-  if (strcmp(class_sig, INTERCEPT_CLASS_NAME) != 0) {\n-    jvmti_env->Deallocate((unsigned char*) method_name);\n-    jvmti_env->Deallocate((unsigned char*) class_sig);\n+  bool is_intercept_class = strcmp(class_sig, INTERCEPT_CLASS_NAME) == 0;\n+  jvmti_env->Deallocate((unsigned char*) class_sig);\n+  if (!is_intercept_class) {\n@@ -89,1 +100,6 @@\n-  if (jni_env->ExceptionOccurred()) {\n+  jthrowable ex = jni_env->ExceptionOccurred();\n+  if (ex != nullptr) {\n+    \/\/ we can not return with a pending exception from this JMVTI callback,\n+    \/\/ and there is no way to propagate it to the caller so that the memory\n+    \/\/ access will be interrupted.\n+    \/\/ We log the exception for testing purposes end then terminate the process.\n@@ -91,0 +107,5 @@\n+    if (jni_env->IsInstanceOf(ex, EXCEPTION_CLS)) {\n+      exit(0); \/\/ success\n+    }\n+    \/\/ else, another exception was thrown. Let the java logic handle the lack of\n+    \/\/ ScopedAccessError\n@@ -92,3 +113,0 @@\n-\n-  jvmti_env->Deallocate((unsigned char*) method_name);\n-  jvmti_env->Deallocate((unsigned char*) class_sig);\n","filename":"test\/jdk\/java\/foreign\/sharedclosejvmti\/libSharedCloseAgent.cpp","additions":30,"deletions":12,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng AbsentStreamValuesTest\n+ * @run junit AbsentStreamValuesTest\n@@ -37,2 +37,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -41,1 +39,6 @@\n-import static org.testng.Assert.*;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -47,0 +50,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -64,1 +68,0 @@\n-    @DataProvider(name = \"recordTypeAndExpectedValue\")\n@@ -84,1 +87,2 @@\n-    @Test(dataProvider = \"recordTypeAndExpectedValue\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordTypeAndExpectedValue\")\n@@ -95,1 +99,1 @@\n-        assertEquals(actualXValue, expectedXValue);\n+        assertEquals(expectedXValue, actualXValue);\n@@ -110,12 +114,12 @@\n-        assertEquals(obj.a, false);\n-        assertEquals(obj.b, 0);\n-        assertEquals(obj.c, 0);\n-        assertEquals(obj.d, '\\u0000');\n-        assertEquals(obj.e, 0);\n-        assertEquals(obj.f, 0l);\n-        assertEquals(obj.g, 0f);\n-        assertEquals(obj.h, 0d);\n-        assertEquals(obj.i, null);\n-        assertEquals(obj.j, null);\n-        assertEquals(obj.k, null);\n-        assertEquals(obj.l, null);\n+        assertEquals(false, obj.a);\n+        assertEquals(0, obj.b);\n+        assertEquals(0, obj.c);\n+        assertEquals('\\u0000', obj.d);\n+        assertEquals(0, obj.e);\n+        assertEquals(0l, obj.f);\n+        assertEquals(0f, obj.g);\n+        assertEquals(0d, obj.h);\n+        assertEquals(null, obj.i);\n+        assertEquals(null, obj.j);\n+        assertEquals(null, obj.k);\n+        assertEquals(null, obj.l);\n@@ -135,2 +139,2 @@\n-        assertEquals(obj.t, null);\n-        assertEquals(obj.u, null);\n+        assertEquals(null, obj.t);\n+        assertEquals(null, obj.u);\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/AbsentStreamValuesTest.java","additions":26,"deletions":22,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n- * @run testng BadCanonicalCtrTest\n+ * @run junit BadCanonicalCtrTest\n@@ -47,3 +47,0 @@\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -56,2 +53,7 @@\n-import static org.testng.Assert.assertTrue;\n-import static org.testng.Assert.expectThrows;\n+\n+import org.junit.jupiter.api.Assertions;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -63,0 +65,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -79,1 +82,1 @@\n-    @BeforeTest\n+    @BeforeAll\n@@ -136,1 +139,0 @@\n-    @DataProvider(name = \"recordInstances\")\n@@ -151,1 +153,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n@@ -157,1 +160,1 @@\n-        InvalidClassException ice = expectThrows(ICE, () -> deserialize(bytes, missingCtrClassLoader));\n+        InvalidClassException ice = Assertions.assertThrows(ICE, () -> deserialize(bytes, missingCtrClassLoader));\n@@ -167,1 +170,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n@@ -173,1 +177,1 @@\n-        InvalidClassException ice = expectThrows(ICE, () -> deserialize(bytes, nonCanonicalCtrClassLoader));\n+        InvalidClassException ice = Assertions.assertThrows(ICE, () -> deserialize(bytes, nonCanonicalCtrClassLoader));\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/BadCanonicalCtrTest.java","additions":17,"deletions":13,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,1 @@\n- * @run testng BadValues\n+ * @run junit BadValues\n@@ -35,1 +35,0 @@\n-import org.testng.annotations.Test;\n@@ -38,1 +37,3 @@\n-import static org.testng.Assert.*;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+import org.junit.jupiter.api.Test;\n@@ -76,1 +77,1 @@\n-        Throwable t = expectThrows(CNFE, () -> deserialize(bytes));\n+        Throwable t = assertThrows(CNFE, () -> deserialize(bytes));\n@@ -84,1 +85,1 @@\n-        Throwable t = expectThrows(CNFE, () -> deserialize(bytes));\n+        Throwable t = assertThrows(CNFE, () -> deserialize(bytes));\n@@ -92,1 +93,1 @@\n-        Throwable t = expectThrows(CNFE, () -> deserialize(bytes));\n+        Throwable t = assertThrows(CNFE, () -> deserialize(bytes));\n@@ -100,1 +101,1 @@\n-        Throwable t = expectThrows(CNFE, () -> deserialize(bytes));\n+        Throwable t = assertThrows(CNFE, () -> deserialize(bytes));\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/BadValues.java","additions":9,"deletions":8,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng BasicRecordSer\n+ * @run junit BasicRecordSer\n@@ -42,2 +42,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -47,4 +45,10 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n-import static org.testng.Assert.expectThrows;\n-import static org.testng.Assert.fail;\n+\n+import org.junit.jupiter.api.Assertions;\n+import static org.junit.jupiter.api.Assertions.assertArrayEquals;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -55,0 +59,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -104,1 +109,0 @@\n-    @DataProvider(name = \"serializable\")\n@@ -124,1 +128,2 @@\n-    @Test(dataProvider = \"serializable\")\n+    @ParameterizedTest\n+    @MethodSource(\"serializable\")\n@@ -130,2 +135,7 @@\n-        assertEquals(objToSerialize, objDeserialized);\n-        assertEquals(objDeserialized, objToSerialize);\n+        if (objToSerialize.getClass().isArray()) {\n+            assertArrayEquals((Object[]) objDeserialized, (Object[]) objToSerialize);\n+            assertArrayEquals((Object[]) objToSerialize, (Object[]) objDeserialized);\n+        } else {\n+            assertEquals(objDeserialized, objToSerialize);\n+            assertEquals(objToSerialize, objDeserialized);\n+        }\n@@ -157,2 +167,2 @@\n-        assertEquals(objToSerialize, objDeserialized);\n-        assertEquals(objDeserialized, objToSerialize);\n+        Assertions.assertArrayEquals(objDeserialized, objToSerialize);\n+        Assertions.assertArrayEquals(objToSerialize, objDeserialized);\n@@ -174,2 +184,2 @@\n-        assertEquals(objToSerialize, objDeserialized);\n-        assertEquals(objDeserialized, objToSerialize);\n+        Assertions.assertArrayEquals(objDeserialized, objToSerialize);\n+        Assertions.assertArrayEquals(objToSerialize, objDeserialized);\n@@ -195,1 +205,0 @@\n-    @DataProvider(name = \"notSerializable\")\n@@ -212,1 +221,2 @@\n-    @Test(dataProvider = \"notSerializable\")\n+    @ParameterizedTest\n+    @MethodSource(\"notSerializable\")\n@@ -216,1 +226,1 @@\n-        NotSerializableException expected = expectThrows(NSE, () -> serialize(objToSerialize));\n+        NotSerializableException expected = Assertions.assertThrows(NSE, () -> serialize(objToSerialize));\n@@ -238,1 +248,0 @@\n-        assertEquals(objToSerialize, objDeserialized);\n@@ -240,1 +249,2 @@\n-        assertEquals(e_ctrInvocationCount, 1);\n+        assertEquals(objToSerialize, objDeserialized);\n+        assertEquals(1, e_ctrInvocationCount);\n@@ -261,1 +271,1 @@\n-        NotSerializableException expected = expectThrows(NSE, () -> serialize(objToSerialize));\n+        NotSerializableException expected = Assertions.assertThrows(NSE, () -> serialize(objToSerialize));\n@@ -263,1 +273,1 @@\n-        assertEquals(g_ctrInvocationCount, 0);\n+        assertEquals(0, g_ctrInvocationCount);\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/BasicRecordSer.java","additions":33,"deletions":23,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * @run testng ConstructorAccessTest\n+ * @run junit ConstructorAccessTest\n@@ -41,2 +41,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -44,2 +42,6 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.fail;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -51,0 +53,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -78,1 +81,0 @@\n-    @DataProvider(name = \"recordInstances\")\n@@ -94,1 +96,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/ConstructorAccessTest.java","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng CycleTest\n+ * @run junit CycleTest\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -39,2 +38,4 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.Test;\n@@ -64,2 +65,2 @@\n-        assertEquals(deserializedObj.x(), 1);           \/\/ sanity\n-        assertEquals(deserializedObj.y(), 2);           \/\/ sanity\n+        assertEquals(1, deserializedObj.x());           \/\/ sanity\n+        assertEquals(2, deserializedObj.y());           \/\/ sanity\n@@ -67,1 +68,1 @@\n-        assertEquals(deserializedObj.c().obj, null);    \/\/ cycle, expect null\n+        assertEquals(null, deserializedObj.c().obj);    \/\/ cycle, expect null\n@@ -87,2 +88,2 @@\n-        assertEquals(((R)deserializedObj.obj).x(), 3);    \/\/ sanity\n-        assertEquals(((R)deserializedObj.obj).y(), 4);    \/\/ sanity\n+        assertEquals(3, ((R)deserializedObj.obj).x());    \/\/ sanity\n+        assertEquals(4, ((R)deserializedObj.obj).y());    \/\/ sanity\n@@ -108,2 +109,2 @@\n-        assertEquals(deserializedObj.x(), 5);         \/\/ sanity\n-        assertEquals(deserializedObj.y(), 6);         \/\/ sanity\n+        assertEquals(5, deserializedObj.x());         \/\/ sanity\n+        assertEquals(6, deserializedObj.y());         \/\/ sanity\n@@ -135,3 +136,3 @@\n-        assertEquals(deserializedObj.l(), 9);              \/\/ sanity\n-        assertEquals(deserializedObj.r().x(), 7);          \/\/ sanity\n-        assertEquals(deserializedObj.r().y(), 8);          \/\/ sanity\n+        assertEquals(9, deserializedObj.l());              \/\/ sanity\n+        assertEquals(7, deserializedObj.r().x());          \/\/ sanity\n+        assertEquals(8, deserializedObj.r().y());          \/\/ sanity\n@@ -139,1 +140,1 @@\n-        assertEquals(deserializedObj.r().c().obj, null);   \/\/ cycle, expect null\n+        assertEquals(null, deserializedObj.r().c().obj);   \/\/ cycle, expect null\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/CycleTest.java","additions":17,"deletions":16,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * @run testng DifferentStreamFieldsTest\n+ * @run junit DifferentStreamFieldsTest\n@@ -41,2 +41,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -44,1 +42,7 @@\n-import static org.testng.Assert.assertEquals;\n+\n+import org.junit.jupiter.api.Assertions;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -49,0 +53,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -79,1 +84,0 @@\n-    @DataProvider(name = \"recordTypeAndExpectedValue\")\n@@ -99,1 +103,2 @@\n-    @Test(dataProvider = \"recordTypeAndExpectedValue\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordTypeAndExpectedValue\")\n@@ -111,1 +116,1 @@\n-        assertEquals(actualXValue, expectedXValue);\n+        assertEquals(expectedXValue, actualXValue);\n@@ -121,1 +126,1 @@\n-        assertEquals(actualXValue, expectedXValue);\n+        assertEquals(expectedXValue, actualXValue);\n@@ -140,12 +145,12 @@\n-        assertEquals(obj.a, false);\n-        assertEquals(obj.b, 0);\n-        assertEquals(obj.c, 0);\n-        assertEquals(obj.d, '\\u0000');\n-        assertEquals(obj.e, 0);\n-        assertEquals(obj.f, 0l);\n-        assertEquals(obj.g, 0f);\n-        assertEquals(obj.h, 0d);\n-        assertEquals(obj.i, null);\n-        assertEquals(obj.j, null);\n-        assertEquals(obj.k, null);\n-        assertEquals(obj.l, null);\n+        assertEquals(false, obj.a);\n+        assertEquals(0, obj.b);\n+        assertEquals(0, obj.c);\n+        assertEquals('\\u0000', obj.d);\n+        assertEquals(0, obj.e);\n+        assertEquals(0l, obj.f);\n+        assertEquals(0f, obj.g);\n+        assertEquals(0d, obj.h);\n+        assertEquals(null, obj.i);\n+        assertEquals(null, obj.j);\n+        assertEquals(null, obj.k);\n+        assertEquals(null, obj.l);\n@@ -169,1 +174,1 @@\n-            assertEquals(deser1, r);\n+            assertEquals(r, deser1);\n@@ -171,1 +176,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -179,1 +184,1 @@\n-            assertEquals(deser1, r);\n+            assertEquals(r, deser1);\n@@ -188,1 +193,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -196,1 +201,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -206,1 +211,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -211,1 +216,1 @@\n-            assertEquals(deser1, r);\n+            assertEquals(r, deser1);\n@@ -219,1 +224,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -225,1 +230,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -237,1 +242,1 @@\n-        assertEquals(deser1, r);\n+        assertEquals(r, deser1);\n@@ -246,1 +251,1 @@\n-        assertEquals(deser2, deser1);\n+        assertEquals(deser1, deser2);\n@@ -257,1 +262,1 @@\n-        assertEquals(deser3, deser1);\n+        assertEquals(deser1, deser3);\n@@ -267,2 +272,2 @@\n-            assertEquals(deser1.ints(), r.ints());\n-            assertEquals(deser1.longs(), r.longs());\n+            Assertions.assertArrayEquals(r.ints(), deser1.ints());\n+            Assertions.assertArrayEquals(r.longs(), deser1.longs());\n@@ -277,2 +282,2 @@\n-            assertEquals(deser2.ints(), deser1.ints());\n-            assertEquals(deser2.longs(), deser1.longs());\n+            Assertions.assertArrayEquals(deser1.ints(), deser2.ints());\n+            Assertions.assertArrayEquals(deser1.longs(), deser2.longs());\n@@ -284,1 +289,1 @@\n-            assertEquals(deser1.stringArray(), r.stringArray());\n+            Assertions.assertArrayEquals(r.stringArray(), deser1.stringArray());\n@@ -292,1 +297,1 @@\n-            assertEquals(deser2.stringArray(), deser1.stringArray());\n+            Assertions.assertArrayEquals(deser1.stringArray(), deser2.stringArray());\n@@ -305,1 +310,1 @@\n-            assertEquals(deser1, r);\n+            assertEquals(r, deser1);\n@@ -313,1 +318,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -321,1 +326,1 @@\n-            assertEquals(deser1, r);\n+            assertEquals(r, deser1);\n@@ -329,1 +334,1 @@\n-            assertEquals(deser2, deser1);\n+            assertEquals(deser1, deser2);\n@@ -341,1 +346,1 @@\n-        assertEquals(deser1, r);\n+        assertEquals(r, deser1);\n@@ -365,1 +370,1 @@\n-        assertEquals(deser1, r);\n+        assertEquals(r, deser1);\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/DifferentStreamFieldsTest.java","additions":50,"deletions":45,"binary":false,"changes":95,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * @run testng ProhibitedMethods\n+ * @run junit ProhibitedMethods\n@@ -52,4 +52,0 @@\n-import org.testng.Assert;\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -58,0 +54,1 @@\n+import static java.lang.constant.ConstantDescs.CD_Object;\n@@ -60,4 +57,10 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n-import static org.testng.Assert.expectThrows;\n-import static org.testng.Assert.fail;\n+\n+import org.junit.jupiter.api.Assertions;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -70,0 +73,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -103,1 +107,1 @@\n-    @BeforeTest\n+    @BeforeAll\n@@ -168,1 +172,0 @@\n-    @DataProvider(name = \"recordInstances\")\n@@ -180,1 +183,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n@@ -248,2 +252,2 @@\n-                cob.invokestatic(Assert.class.describeConstable().orElseThrow(), \"fail\",\n-                        MethodTypeDesc.of(CD_void, CD_String));\n+                cob.invokestatic(Assertions.class.describeConstable().orElseThrow(), \"fail\",\n+                        MethodTypeDesc.of(CD_Object, CD_String));\n@@ -269,1 +273,1 @@\n-                ReflectiveOperationException t = expectThrows(ROE, () ->\n+                ReflectiveOperationException t = Assertions.assertThrows(ROE, () ->\n@@ -275,1 +279,1 @@\n-                assertEquals(assertionError.getMessage(), \"writeObject should not be invoked\");\n+                assertEquals(\"writeObject should not be invoked\", assertionError.getMessage());\n@@ -281,1 +285,1 @@\n-                ReflectiveOperationException t = expectThrows(ROE, () ->\n+                ReflectiveOperationException t = Assertions.assertThrows(ROE, () ->\n@@ -288,1 +292,1 @@\n-                assertEquals(assertionError.getMessage(), \"readObject should not be invoked\");\n+                assertEquals(\"readObject should not be invoked\", assertionError.getMessage());\n@@ -294,1 +298,1 @@\n-                ReflectiveOperationException t = expectThrows(ROE, () -> m.invoke(obj));\n+                ReflectiveOperationException t = Assertions.assertThrows(ROE, () -> m.invoke(obj));\n@@ -299,1 +303,1 @@\n-                assertEquals(assertionError.getMessage(), \"readObjectNoData should not be invoked\");\n+                assertEquals(\"readObjectNoData should not be invoked\", assertionError.getMessage());\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/ProhibitedMethods.java","additions":25,"deletions":21,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng ReadResolveTest\n+ * @run junit ReadResolveTest\n@@ -38,2 +38,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -42,1 +40,6 @@\n-import static org.testng.Assert.assertEquals;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -47,0 +50,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -97,1 +101,0 @@\n-    @DataProvider(name = \"objectsToSerialize\")\n@@ -106,1 +109,2 @@\n-    @Test(dataProvider = \"objectsToSerialize\")\n+    @ParameterizedTest\n+    @MethodSource(\"objectsToSerialize\")\n@@ -112,1 +116,1 @@\n-        assertEquals(deserializedObj, objectToSerialize);\n+        assertEquals(objectToSerialize, deserializedObj);\n@@ -131,1 +135,1 @@\n-        assertEquals(deserializedObj, null);\n+        assertEquals(null, deserializedObj);\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/ReadResolveTest.java","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng RecordClassTest\n+ * @run junit RecordClassTest\n@@ -41,2 +41,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -44,2 +42,6 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.fail;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -50,0 +52,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -77,1 +80,0 @@\n-    @DataProvider(name = \"recordClasses\")\n@@ -90,1 +92,2 @@\n-    @Test(dataProvider = \"recordClasses\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordClasses\")\n@@ -98,1 +101,0 @@\n-        assertEquals(recordClass, deserializedClass);\n@@ -100,0 +102,1 @@\n+        assertEquals(recordClass, deserializedClass);\n@@ -103,1 +106,2 @@\n-    @Test(dataProvider = \"recordClasses\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordClasses\")\n@@ -108,1 +112,1 @@\n-        assertEquals(osc.getSerialVersionUID(), expectedUID);\n+        assertEquals(expectedUID, osc.getSerialVersionUID());\n@@ -112,1 +116,1 @@\n-        assertEquals(osc.getSerialVersionUID(), expectedUID);\n+        assertEquals(expectedUID, osc.getSerialVersionUID());\n@@ -123,1 +127,0 @@\n-    @DataProvider(name = \"notSerRecordClasses\")\n@@ -133,1 +136,2 @@\n-    @Test(dataProvider = \"notSerRecordClasses\")\n+    @ParameterizedTest\n+    @MethodSource(\"notSerRecordClasses\")\n@@ -138,1 +142,1 @@\n-        assertEquals(osc, null);\n+        assertEquals(null, osc);\n@@ -142,1 +146,1 @@\n-        assertEquals(osc.getSerialVersionUID(), 0L);\n+        assertEquals(0L, osc.getSerialVersionUID());\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/RecordClassTest.java","additions":20,"deletions":16,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * @run testng SerialPersistentFieldsTest\n+ * @run junit SerialPersistentFieldsTest\n@@ -55,3 +55,0 @@\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -68,2 +65,7 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -74,0 +76,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -91,1 +94,1 @@\n-    @BeforeTest\n+    @BeforeAll\n@@ -177,1 +180,0 @@\n-    @DataProvider(name = \"recordInstances\")\n@@ -188,1 +190,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n@@ -194,1 +197,0 @@\n-        assertEquals(objToSerialize, objDeserialized);\n@@ -196,0 +198,1 @@\n+        assertEquals(objToSerialize, objDeserialized);\n@@ -293,1 +296,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/SerialPersistentFieldsTest.java","additions":16,"deletions":12,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng SerialVersionUIDTest\n+ * @run junit SerialVersionUIDTest\n@@ -42,2 +42,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -46,2 +44,0 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n@@ -49,0 +45,7 @@\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -67,1 +70,0 @@\n-    @DataProvider(name = \"recordObjects\")\n@@ -81,1 +83,2 @@\n-    @Test(dataProvider = \"recordObjects\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordObjects\")\n@@ -93,5 +96,5 @@\n-        assertEquals(dis.readShort(), STREAM_MAGIC);\n-        assertEquals(dis.readShort(), STREAM_VERSION);\n-        assertEquals(dis.readByte(), TC_OBJECT);\n-        assertEquals(dis.readByte(), TC_CLASSDESC);\n-        assertEquals(dis.readUTF(), objectToSerialize.getClass().getName());\n+        assertEquals(STREAM_MAGIC, dis.readShort());\n+        assertEquals(STREAM_VERSION, dis.readShort());\n+        assertEquals(TC_OBJECT, dis.readByte());\n+        assertEquals(TC_CLASSDESC, dis.readByte());\n+        assertEquals(objectToSerialize.getClass().getName(), dis.readUTF());\n@@ -100,1 +103,1 @@\n-        assertEquals(dis.readLong(), expectedUID);\n+        assertEquals(expectedUID, dis.readLong());\n@@ -103,1 +106,0 @@\n-    @DataProvider(name = \"recordClasses\")\n@@ -118,1 +120,2 @@\n-    @Test(dataProvider = \"recordClasses\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordClasses\")\n@@ -125,1 +128,1 @@\n-        assertEquals(obj.getClass(), cl);\n+        assertEquals(cl, obj.getClass());\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/SerialVersionUIDTest.java","additions":20,"deletions":17,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng StreamRefTest\n+ * @run junit StreamRefTest\n@@ -39,1 +39,0 @@\n-import org.testng.annotations.Test;\n@@ -41,3 +40,5 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n-import static org.testng.Assert.expectThrows;\n+\n+import org.junit.jupiter.api.Assertions;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.Test;\n@@ -126,1 +127,1 @@\n-        InvalidObjectException ioe = expectThrows(IOE, () -> deserializeOne(byteStream));\n+        InvalidObjectException ioe = Assertions.assertThrows(IOE, () -> deserializeOne(byteStream));\n@@ -133,1 +134,1 @@\n-        assertEquals(b1.a, null);\n+        assertEquals(null, b1.a);\n@@ -147,1 +148,1 @@\n-        InvalidObjectException ioe = expectThrows(IOE, () -> deserializeOne(byteStream));\n+        InvalidObjectException ioe = Assertions.assertThrows(IOE, () -> deserializeOne(byteStream));\n@@ -154,1 +155,1 @@\n-        assertEquals(a1, null);\n+        assertEquals(null, a1);\n@@ -214,1 +215,1 @@\n-        assertEquals(dis.readInt(), expectedValue);\n+        assertEquals(expectedValue, dis.readInt());\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/StreamRefTest.java","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng ThrowingConstructorTest\n+ * @run junit ThrowingConstructorTest\n@@ -38,2 +38,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -41,3 +39,7 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n-import static org.testng.Assert.expectThrows;\n+\n+import org.junit.jupiter.api.Assertions;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -49,0 +51,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -87,1 +90,0 @@\n-    @DataProvider(name = \"exceptionInstances\")\n@@ -101,1 +103,2 @@\n-    @Test(dataProvider = \"exceptionInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"exceptionInstances\")\n@@ -110,1 +113,1 @@\n-        InvalidObjectException ioe = expectThrows(IOE, () -> deserialize(bytes));\n+        InvalidObjectException ioe = Assertions.assertThrows(IOE, () -> deserialize(bytes));\n@@ -116,1 +119,1 @@\n-        assertEquals(t.getMessage(), expectedExMessage);\n+        assertEquals(expectedExMessage, t.getMessage());\n@@ -146,1 +149,0 @@\n-    @DataProvider(name = \"errorInstances\")\n@@ -160,1 +162,2 @@\n-    @Test(dataProvider = \"errorInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"errorInstances\")\n@@ -169,1 +172,1 @@\n-        Throwable t = expectThrows(expectedExType, () -> deserialize(bytes));\n+        Throwable t = Assertions.assertThrows(expectedExType, () -> deserialize(bytes));\n@@ -173,1 +176,1 @@\n-        assertEquals(t.getMessage(), expectedExMessage);\n+        assertEquals(expectedExMessage, t.getMessage());\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/ThrowingConstructorTest.java","additions":18,"deletions":15,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng UnsharedTest\n+ * @run junit UnsharedTest\n@@ -38,4 +38,5 @@\n-import org.testng.annotations.Test;\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n-import static org.testng.Assert.expectThrows;\n+import org.junit.jupiter.api.Assertions;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.Test;\n@@ -59,1 +60,1 @@\n-            assertEquals(foo1.x, foo.x);\n+            assertEquals(foo.x, foo1.x);\n@@ -61,1 +62,1 @@\n-            assertEquals(foo2.x, foo.x);\n+            assertEquals(foo.x, foo2.x);\n@@ -67,2 +68,2 @@\n-            assertEquals(foo1.x, foo.x);\n-            var expected = expectThrows(IOE, () -> deserializeOne(byteStream));\n+            assertEquals(foo.x, foo1.x);\n+            var expected = Assertions.assertThrows(IOE, () -> deserializeOne(byteStream));\n@@ -79,1 +80,1 @@\n-            assertEquals(foo1.x, foo.x);\n+            assertEquals(foo.x, foo1.x);\n@@ -81,1 +82,1 @@\n-            assertEquals(foo2.x, foo.x);\n+            assertEquals(foo.x, foo2.x);\n@@ -87,1 +88,1 @@\n-            assertEquals(foo1.x, foo.x);\n+            assertEquals(foo.x, foo1.x);\n@@ -89,1 +90,1 @@\n-            assertEquals(foo2.x, foo.x);\n+            assertEquals(foo.x, foo2.x);\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/UnsharedTest.java","additions":15,"deletions":14,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng WriteReplaceTest\n+ * @run junit WriteReplaceTest\n@@ -37,2 +37,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -40,1 +38,0 @@\n-import static org.testng.Assert.assertEquals;\n@@ -42,0 +39,7 @@\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -74,1 +78,0 @@\n-    @DataProvider(name = \"recordObjects\")\n@@ -84,1 +87,2 @@\n-    @Test(dataProvider = \"recordObjects\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordObjects\")\n@@ -93,1 +97,1 @@\n-            assertEquals(deserializedObj, objectToSerialize);\n+            assertEquals(objectToSerialize, deserializedObj);\n@@ -95,1 +99,1 @@\n-            assertEquals(deserializedObj.getClass(), expectedType);\n+            assertEquals(expectedType, deserializedObj.getClass());\n@@ -111,1 +115,1 @@\n-        assertEquals(deserializedObj, null);\n+        assertEquals(null, deserializedObj);\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/WriteReplaceTest.java","additions":14,"deletions":10,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,2 +37,3 @@\n-import org.testng.annotations.BeforeTest;\n-import static org.testng.Assert.*;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+import org.junit.jupiter.api.BeforeAll;\n@@ -57,1 +58,1 @@\n-    @BeforeTest\n+    @BeforeAll\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/migration\/AbstractTest.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng AssignableFromTest\n+ * @run junit AssignableFromTest\n@@ -37,2 +37,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -40,1 +38,5 @@\n-import static org.testng.Assert.assertEquals;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -47,0 +49,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -49,1 +52,0 @@\n-    @DataProvider(name = \"plainInstances\")\n@@ -62,1 +64,2 @@\n-    @Test(dataProvider = \"plainInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"plainInstances\")\n@@ -71,1 +74,0 @@\n-        assertEquals(objToSerialize.number(), objDeserialized.number());\n@@ -73,0 +75,1 @@\n+        assertEquals(objToSerialize.number(), objDeserialized.number());\n@@ -77,1 +80,0 @@\n-    @DataProvider(name = \"recordInstances\")\n@@ -90,1 +92,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n@@ -99,1 +102,0 @@\n-        assertEquals(objToSerialize.number(), objDeserialized.number());\n@@ -101,0 +103,1 @@\n+        assertEquals(objToSerialize.number(), objDeserialized.number());\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/migration\/AssignableFromTest.java","additions":14,"deletions":11,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n- * @run testng DefaultValuesTest\n+ * @run junit DefaultValuesTest\n@@ -36,1 +36,0 @@\n-import org.testng.annotations.Test;\n@@ -39,1 +38,4 @@\n-import static org.testng.Assert.*;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n@@ -46,0 +48,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -80,2 +83,2 @@\n-        assertEquals(point.x(), 0);\n-        assertEquals(point.y(), 0);\n+        assertEquals(0, point.x());\n+        assertEquals(0, point.y());\n@@ -85,2 +88,2 @@\n-        assertEquals(point.x(), 0);\n-        assertEquals(point.y(), 0);\n+        assertEquals(0, point.x());\n+        assertEquals(0, point.y());\n@@ -118,2 +121,2 @@\n-        assertEquals(o1.point().x(), point.x());   \/\/ sanity\n-        assertEquals(o1.point().y(), point.y());   \/\/ sanity\n+        assertEquals(point.x(), o1.point().x());   \/\/ sanity\n+        assertEquals(point.y(), o1.point().y());   \/\/ sanity\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/migration\/DefaultValuesTest.java","additions":13,"deletions":10,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n- * @run testng SuperStreamFieldsTest\n+ * @run junit SuperStreamFieldsTest\n@@ -34,2 +34,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -37,1 +35,6 @@\n-import static org.testng.Assert.assertEquals;\n+\n+import org.junit.jupiter.api.Assertions;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -42,0 +45,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -44,1 +48,0 @@\n-    @DataProvider(name = \"plainInstances\")\n@@ -54,1 +57,2 @@\n-    @Test(dataProvider = \"plainInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"plainInstances\")\n@@ -63,3 +67,3 @@\n-        assertEquals(objToSerialize.str(), objDeserialized.str());\n-        assertEquals(objToSerialize.x(),   objDeserialized.x());\n-        assertEquals(objToSerialize.y(),   objDeserialized.y());\n+        assertEquals(objDeserialized.str(), objToSerialize.str());\n+        Assertions.assertArrayEquals(objDeserialized.x(), objToSerialize.x());\n+        assertEquals(objDeserialized.y(), objToSerialize.y());\n@@ -68,1 +72,0 @@\n-    @DataProvider(name = \"recordInstances\")\n@@ -78,1 +81,2 @@\n-    @Test(dataProvider = \"recordInstances\")\n+    @ParameterizedTest\n+    @MethodSource(\"recordInstances\")\n@@ -87,3 +91,3 @@\n-        assertEquals(objToSerialize.str(), objDeserialized.str());\n-        assertEquals(objToSerialize.x(),   objDeserialized.x());\n-        assertEquals(objToSerialize.y(),   objDeserialized.y());\n+        assertEquals(objDeserialized.str(), objToSerialize.str());\n+        Assertions.assertArrayEquals(objDeserialized.x(), objToSerialize.x());\n+        assertEquals(objDeserialized.y(), objToSerialize.y());\n","filename":"test\/jdk\/java\/io\/Serializable\/records\/migration\/SuperStreamFieldsTest.java","additions":19,"deletions":15,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,1 +40,1 @@\n-import static org.testng.Assert.assertSame;\n+import static org.testng.Assert.*;\n@@ -77,1 +77,1 @@\n-        for (Field field : Holder.class.getFields()) {\n+        for (Field field : Holder.class.getDeclaredFields()) {\n@@ -85,0 +85,2 @@\n+        assertFalse(testHandles.isEmpty());\n+\n","filename":"test\/jdk\/java\/lang\/invoke\/TestVHInvokerCaching.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * @run testng Constructor\n+ * @run junit Constructor\n@@ -32,0 +32,3 @@\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n@@ -33,1 +36,0 @@\n-import org.testng.annotations.Test;\n@@ -36,1 +38,1 @@\n-    @Test(expectedExceptions=NumberFormatException.class)\n+    @Test\n@@ -38,1 +40,3 @@\n-        BigDecimal bd = new BigDecimal(\"1.2e\");\n+        Assertions.assertThrows(NumberFormatException.class, () -> {\n+            BigDecimal bd = new BigDecimal(\"1.2e\");\n+        });\n@@ -41,1 +45,1 @@\n-    @Test(expectedExceptions=NumberFormatException.class)\n+    @Test\n@@ -43,1 +47,3 @@\n-        BigDecimal bd = new BigDecimal(new char[5], -1, 4, null);\n+        Assertions.assertThrows(NumberFormatException.class, () -> {\n+            BigDecimal bd = new BigDecimal(new char[5], -1, 4, null);\n+        });\n@@ -46,1 +52,1 @@\n-    @Test(expectedExceptions=NumberFormatException.class)\n+    @Test\n@@ -48,1 +54,3 @@\n-        BigDecimal bd = new BigDecimal(new char[5], 0, -1, null);\n+        Assertions.assertThrows(NumberFormatException.class, () -> {\n+            BigDecimal bd = new BigDecimal(new char[5], 0, -1, null);\n+        });\n@@ -51,1 +59,1 @@\n-    @Test(expectedExceptions=NumberFormatException.class)\n+    @Test\n@@ -53,9 +61,11 @@\n-        try {\n-            BigDecimal bd = new BigDecimal(new char[5], Integer.MAX_VALUE - 5,\n-                6, null);\n-        } catch (NumberFormatException nfe) {\n-            if (nfe.getCause() instanceof IndexOutOfBoundsException) {\n-                throw new RuntimeException\n-                    (\"NumberFormatException should not have a cause\");\n-            } else {\n-                throw nfe;\n+        Assertions.assertThrows(NumberFormatException.class, () -> {\n+            try {\n+                BigDecimal bd = new BigDecimal(new char[5], Integer.MAX_VALUE - 5,\n+                        6, null);\n+            } catch (NumberFormatException nfe) {\n+                if (nfe.getCause() instanceof IndexOutOfBoundsException) {\n+                    throw new RuntimeException\n+                            (\"NumberFormatException should not have a cause\");\n+                } else {\n+                    throw nfe;\n+                }\n@@ -63,1 +73,1 @@\n-        }\n+        });\n@@ -66,1 +76,1 @@\n-    @Test(expectedExceptions=NumberFormatException.class)\n+    @Test\n@@ -68,1 +78,3 @@\n-        BigDecimal bd = new BigDecimal(new char[5], 1, 5, null);\n+        Assertions.assertThrows(NumberFormatException.class, () -> {\n+            BigDecimal bd = new BigDecimal(new char[5], 1, 5, null);\n+        });\n","filename":"test\/jdk\/java\/math\/BigDecimal\/Constructor.java","additions":34,"deletions":22,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n- * @run testng\/othervm\/timeout=480 -Xmx4g LargeValueExceptions\n+ * @run junit\/othervm\/timeout=480 -Xmx4g LargeValueExceptions\n@@ -31,0 +31,5 @@\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.Test;\n+\n@@ -32,0 +37,1 @@\n+\n@@ -33,3 +39,0 @@\n-import org.testng.ITestResult;\n-import org.testng.annotations.AfterMethod;\n-import org.testng.annotations.Test;\n@@ -67,7 +70,0 @@\n-    \/\/ Print the run time of each sub-test in milliseconds\n-    @AfterMethod\n-    public void getRunTime(ITestResult tr) {\n-        long time = tr.getEndMillis() - tr.getStartMillis();\n-        System.out.printf(\"Run time: %d ms%n\", time);\n-    }\n-\n@@ -77,1 +73,2 @@\n-    @Test(enabled=false)\n+    @Test\n+    @Disabled\n@@ -84,1 +81,2 @@\n-    @Test(enabled=false)\n+    @Test\n+    @Disabled\n@@ -91,1 +89,2 @@\n-    @Test(expectedExceptions=ArithmeticException.class,enabled=false)\n+    @Test\n+    @Disabled\n@@ -93,2 +92,4 @@\n-        BigInteger x = ONE.shiftLeft(16*MAX_INTS).subtract(ONE);\n-        BigInteger y = x.multiply(x);\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            BigInteger x = ONE.shiftLeft(16*MAX_INTS).subtract(ONE);\n+            BigInteger y = x.multiply(x);\n+        });\n@@ -98,1 +99,1 @@\n-    @Test(expectedExceptions=ArithmeticException.class)\n+    @Test\n@@ -100,2 +101,4 @@\n-        BigInteger x = ONE.shiftLeft(16*MAX_INTS);\n-        BigInteger y = x.multiply(x);\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            BigInteger x = ONE.shiftLeft(16*MAX_INTS);\n+            BigInteger y = x.multiply(x);\n+        });\n@@ -107,1 +110,2 @@\n-    @Test(enabled=false)\n+    @Test\n+    @Disabled\n@@ -117,1 +121,2 @@\n-    @Test(enabled=false)\n+    @Test\n+    @Disabled\n@@ -133,1 +138,2 @@\n-    @Test(expectedExceptions=ArithmeticException.class,enabled=false)\n+    @Test\n+    @Disabled\n@@ -135,2 +141,3 @@\n-        BigInteger x = ONE.shiftLeft((int)(MAX_BITS\/2)).subtract(ONE);\n-        long m = MAX_BITS - x.bitLength();\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            BigInteger x = ONE.shiftLeft((int)(MAX_BITS\/2)).subtract(ONE);\n+            long m = MAX_BITS - x.bitLength();\n@@ -138,2 +145,2 @@\n-        BigInteger y = ONE.shiftLeft((int)(MAX_BITS\/2)).subtract(ONE);\n-        long n = MAX_BITS - y.bitLength();\n+            BigInteger y = ONE.shiftLeft((int)(MAX_BITS\/2)).subtract(ONE);\n+            long n = MAX_BITS - y.bitLength();\n@@ -141,3 +148,3 @@\n-        if (m + n != MAX_BITS) {\n-            throw new RuntimeException(\"Unexpected leading zero sum\");\n-        }\n+            if (m + n != MAX_BITS) {\n+                throw new RuntimeException(\"Unexpected leading zero sum\");\n+            }\n@@ -145,1 +152,2 @@\n-        BigInteger z = x.multiply(y);\n+            BigInteger z = x.multiply(y);\n+        });\n@@ -149,1 +157,1 @@\n-    @Test(expectedExceptions=ArithmeticException.class)\n+    @Test\n@@ -151,10 +159,12 @@\n-        \/\/ multiply by 4 as MAX_INTS_HALF refers to ints\n-        byte[] xmag = new byte[4*MAX_INTS_HALF];\n-        xmag[0] = (byte)0xff;\n-        BigInteger x = new BigInteger(1, xmag);\n-\n-        byte[] ymag = new byte[4*MAX_INTS_HALF + 1];\n-        ymag[0] = (byte)0xff;\n-        BigInteger y = new BigInteger(1, ymag);\n-\n-        BigInteger z = x.multiply(y);\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            \/\/ multiply by 4 as MAX_INTS_HALF refers to ints\n+            byte[] xmag = new byte[4*MAX_INTS_HALF];\n+            xmag[0] = (byte)0xff;\n+            BigInteger x = new BigInteger(1, xmag);\n+\n+            byte[] ymag = new byte[4*MAX_INTS_HALF + 1];\n+            ymag[0] = (byte)0xff;\n+            BigInteger y = new BigInteger(1, ymag);\n+\n+            BigInteger z = x.multiply(y);\n+        });\n@@ -165,1 +175,1 @@\n-    @Test(expectedExceptions=ArithmeticException.class)\n+    @Test\n@@ -167,1 +177,3 @@\n-        BigInteger.TEN.pow(Integer.MAX_VALUE);\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            BigInteger.TEN.pow(Integer.MAX_VALUE);\n+        });\n@@ -170,1 +182,1 @@\n-    @Test(expectedExceptions=ArithmeticException.class)\n+    @Test\n@@ -172,4 +184,6 @@\n-        int shift = 20;\n-        int exponent = 1 << shift;\n-        BigInteger x = ONE.shiftLeft((int)(MAX_BITS \/ exponent));\n-        BigInteger y = x.pow(exponent);\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            int shift = 20;\n+            int exponent = 1 << shift;\n+            BigInteger x = ONE.shiftLeft((int)(MAX_BITS \/ exponent));\n+            BigInteger y = x.pow(exponent);\n+        });\n@@ -178,1 +192,1 @@\n-    @Test(expectedExceptions=ArithmeticException.class)\n+    @Test\n@@ -180,4 +194,6 @@\n-        int shift = 20;\n-        int exponent = 1 << shift;\n-        BigInteger x = ONE.shiftLeft((int)(MAX_BITS \/ exponent)).add(ONE);\n-        BigInteger y = x.pow(exponent);\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            int shift = 20;\n+            int exponent = 1 << shift;\n+            BigInteger x = ONE.shiftLeft((int)(MAX_BITS \/ exponent)).add(ONE);\n+            BigInteger y = x.pow(exponent);\n+        });\n@@ -186,1 +202,2 @@\n-    @Test(expectedExceptions=ArithmeticException.class,enabled=false)\n+    @Test\n+    @Disabled\n@@ -188,4 +205,6 @@\n-        int shift = 20;\n-        int exponent = 1 << shift;\n-        BigInteger x = ONE.shiftLeft((int)(MAX_BITS \/ exponent)).subtract(ONE);\n-        BigInteger y = x.pow(exponent);\n+        Assertions.assertThrows(ArithmeticException.class, () -> {\n+            int shift = 20;\n+            int exponent = 1 << shift;\n+            BigInteger x = ONE.shiftLeft((int)(MAX_BITS \/ exponent)).subtract(ONE);\n+            BigInteger y = x.pow(exponent);\n+        });\n@@ -194,1 +213,2 @@\n-    @Test(enabled=false)\n+    @Test\n+    @Disabled\n","filename":"test\/jdk\/java\/math\/BigInteger\/LargeValueExceptions.java","additions":79,"deletions":59,"binary":false,"changes":138,"status":"modified"},{"patch":"@@ -26,8 +26,0 @@\n-import org.testng.ITestContext;\n-import org.testng.ITestResult;\n-import org.testng.SkipException;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.AfterTest;\n-import org.testng.annotations.BeforeMethod;\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n@@ -51,1 +43,0 @@\n-import java.util.Arrays;\n@@ -64,0 +55,1 @@\n+import java.util.concurrent.atomic.AtomicBoolean;\n@@ -81,2 +73,9 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n+import org.junit.jupiter.api.AfterAll;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.extension.BeforeEachCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.junit.jupiter.api.extension.TestWatcher;\n@@ -86,17 +85,17 @@\n-    SSLContext sslContext;\n-    HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n-    HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n-    HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n-    HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n-    HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n-    String httpURI_fixed;\n-    String httpURI_chunk;\n-    String httpsURI_fixed;\n-    String httpsURI_chunk;\n-    String http2URI_fixed;\n-    String http2URI_chunk;\n-    String https2URI_fixed;\n-    String https2URI_chunk;\n-    String http3URI_fixed;\n-    String http3URI_chunk;\n-    String http3URI_head;\n+    static SSLContext sslContext;\n+    static HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n+    static HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n+    static HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n+    static HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n+    static HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n+    static String httpURI_fixed;\n+    static String httpURI_chunk;\n+    static String httpsURI_fixed;\n+    static String httpsURI_chunk;\n+    static String http2URI_fixed;\n+    static String http2URI_chunk;\n+    static String https2URI_fixed;\n+    static String https2URI_chunk;\n+    static String http3URI_fixed;\n+    static String http3URI_chunk;\n+    static String http3URI_head;\n@@ -120,2 +119,28 @@\n-    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n-    private volatile HttpClient sharedClient;\n+    final static class TestStopper implements TestWatcher, BeforeEachCallback {\n+        final AtomicReference<String> failed = new AtomicReference<>();\n+        TestStopper() { }\n+        @Override\n+        public void testFailed(ExtensionContext context, Throwable cause) {\n+            if (stopAfterFirstFailure()) {\n+                String msg = \"Aborting due to: \" + cause;\n+                failed.compareAndSet(null, msg);\n+                FAILURES.putIfAbsent(context.getDisplayName(), cause);\n+                System.out.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+                System.err.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+            }\n+        }\n+\n+        @Override\n+        public void beforeEach(ExtensionContext context) {\n+            String msg = failed.get();\n+            Assumptions.assumeTrue(msg == null, msg);\n+        }\n+    }\n+\n+    @RegisterExtension\n+    static final TestStopper stopper = new TestStopper();\n+\n+    static final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+    private static volatile HttpClient sharedClient;\n@@ -147,1 +172,1 @@\n-    protected boolean stopAfterFirstFailure() {\n+    protected static boolean stopAfterFirstFailure() {\n@@ -151,11 +176,0 @@\n-    final AtomicReference<SkipException> skiptests = new AtomicReference<>();\n-    void checkSkip() {\n-        var skip = skiptests.get();\n-        if (skip != null) throw skip;\n-    }\n-    static String name(ITestResult result) {\n-        var params = result.getParameters();\n-        return result.getName()\n-                + (params == null ? \"()\" : Arrays.toString(result.getParameters()));\n-    }\n-\n@@ -172,1 +186,1 @@\n-    HttpRequest.Builder newRequestBuilder(String uri) {\n+    static HttpRequest.Builder newRequestBuilder(String uri) {\n@@ -181,1 +195,1 @@\n-    HttpResponse<String> headRequest(HttpClient client)\n+    static HttpResponse<String> headRequest(HttpClient client)\n@@ -190,2 +204,2 @@\n-        assertEquals(response.statusCode(), 200);\n-        assertEquals(response.version(), HTTP_2);\n+        assertEquals(200, response.statusCode());\n+        assertEquals(HTTP_2, response.version());\n@@ -197,10 +211,0 @@\n-    @BeforeMethod\n-    void beforeMethod(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            if (skiptests.get() == null) {\n-                SkipException skip = new SkipException(\"some tests failed\");\n-                skip.setStackTrace(new StackTraceElement[0]);\n-                skiptests.compareAndSet(null, skip);\n-            }\n-        }\n-    }\n@@ -208,2 +212,2 @@\n-    @AfterClass\n-    static final void printFailedTests(ITestContext context) {\n+    @AfterAll\n+    static final void printFailedTests() {\n@@ -233,1 +237,1 @@\n-    private String[] uris() {\n+    private static String[] uris() {\n@@ -248,2 +252,1 @@\n-    @DataProvider(name = \"sanity\")\n-    public Object[][] sanity() {\n+    public static Object[][] sanity() {\n@@ -280,1 +283,1 @@\n-    private Object[][] variants(List<Thrower> throwers, Set<Where> whereValues) {\n+    private static Object[][] variants(List<Thrower> throwers, Set<Where> whereValues) {\n@@ -299,5 +302,1 @@\n-    @DataProvider(name = \"subscribeProvider\")\n-    public Object[][] subscribeProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] subscribeProvider() {\n@@ -310,5 +309,1 @@\n-    @DataProvider(name = \"requestProvider\")\n-    public Object[][] requestProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] requestProvider() {\n@@ -321,5 +316,1 @@\n-    @DataProvider(name = \"nextRequestProvider\")\n-    public Object[][] nextRequestProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] nextRequestProvider() {\n@@ -332,5 +323,1 @@\n-    @DataProvider(name = \"beforeCancelProviderIO\")\n-    public Object[][] beforeCancelProviderIO(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] beforeCancelProviderIO() {\n@@ -342,5 +329,1 @@\n-    @DataProvider(name = \"afterCancelProviderIO\")\n-    public Object[][] afterCancelProviderIO(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] afterCancelProviderIO() {\n@@ -352,5 +335,1 @@\n-    @DataProvider(name = \"beforeCancelProviderCustom\")\n-    public Object[][] beforeCancelProviderCustom(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] beforeCancelProviderCustom() {\n@@ -362,5 +341,1 @@\n-    @DataProvider(name = \"afterCancelProviderCustom\")\n-    public Object[][] afterCancelProvider(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] afterCancelProviderCustom() {\n@@ -372,1 +347,1 @@\n-    private HttpClient makeNewClient() {\n+    private static HttpClient makeNewClient() {\n@@ -374,1 +349,1 @@\n-        return TRACKER.track(newClientBuilderForH3()\n+        return TRACKER.track(HttpServerAdapters.createClientBuilderForH3()\n@@ -381,1 +356,1 @@\n-    HttpClient newHttpClient(boolean share) {\n+    static HttpClient newHttpClient(boolean share) {\n@@ -385,1 +360,1 @@\n-        synchronized (this) {\n+        synchronized (AbstractThrowingPublishers.class) {\n@@ -433,1 +408,1 @@\n-            assertEquals(body, Stream.of(BODY.split(\"\\\\|\")).collect(Collectors.joining()));\n+            assertEquals(Stream.of(BODY.split(\"\\\\|\")).collect(Collectors.joining()), body);\n@@ -477,1 +452,0 @@\n-        checkSkip();\n@@ -781,2 +755,2 @@\n-    @BeforeTest\n-    public void setup() throws Exception {\n+    @BeforeAll\n+    public static void setup() throws Exception {\n@@ -864,2 +838,2 @@\n-    @AfterTest\n-    public void teardown() throws Exception {\n+    @AfterAll\n+    public static void teardown() throws Exception {\n","filename":"test\/jdk\/java\/net\/httpclient\/AbstractThrowingPublishers.java","additions":81,"deletions":107,"binary":false,"changes":188,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true <concrete-class-name>\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true <concrete-class-name>\n@@ -42,8 +42,0 @@\n-import org.testng.ITestContext;\n-import org.testng.ITestResult;\n-import org.testng.SkipException;\n-import org.testng.annotations.AfterTest;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.BeforeMethod;\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n@@ -103,3 +95,14 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n-\n+import org.junit.jupiter.api.AfterAll;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.api.extension.BeforeEachCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.junit.jupiter.api.extension.TestWatcher;\n+\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -108,10 +111,10 @@\n-    SSLContext sslContext;\n-    HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n-    HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n-    HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n-    String http2URI_fixed;\n-    String http2URI_chunk;\n-    String https2URI_fixed;\n-    String https2URI_chunk;\n-    String http3URI_fixed;\n-    String http3URI_chunk;\n+    static SSLContext sslContext;\n+    static HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n+    static HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n+    static HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n+    static String http2URI_fixed;\n+    static String http2URI_chunk;\n+    static String https2URI_fixed;\n+    static String https2URI_chunk;\n+    static String http3URI_fixed;\n+    static String http3URI_chunk;\n@@ -135,2 +138,28 @@\n-    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n-    private volatile HttpClient sharedClient;\n+    static final class TestStopper implements TestWatcher, BeforeEachCallback {\n+        final AtomicReference<String> failed = new AtomicReference<>();\n+        TestStopper() { }\n+        @Override\n+        public void testFailed(ExtensionContext context, Throwable cause) {\n+            if (stopAfterFirstFailure()) {\n+                String msg = \"Aborting due to: \" + cause;\n+                failed.compareAndSet(null, msg);\n+                FAILURES.putIfAbsent(context.getDisplayName(), cause);\n+                System.out.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+                System.err.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+            }\n+        }\n+\n+        @Override\n+        public void beforeEach(ExtensionContext context) {\n+            String msg = failed.get();\n+            Assumptions.assumeTrue(msg == null, msg);\n+        }\n+    }\n+\n+    @RegisterExtension\n+    static final TestStopper stopper = new TestStopper();\n+\n+    static final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+    private static volatile HttpClient sharedClient;\n@@ -162,1 +191,1 @@\n-    protected boolean stopAfterFirstFailure() {\n+    protected static boolean stopAfterFirstFailure() {\n@@ -166,10 +195,0 @@\n-    final AtomicReference<SkipException> skiptests = new AtomicReference<>();\n-    void checkSkip() {\n-        var skip = skiptests.get();\n-        if (skip != null) throw skip;\n-    }\n-    static String name(ITestResult result) {\n-        var params = result.getParameters();\n-        return result.getName()\n-                + (params == null ? \"()\" : Arrays.toString(result.getParameters()));\n-    }\n@@ -177,13 +196,2 @@\n-    @BeforeMethod\n-    void beforeMethod(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            if (skiptests.get() == null) {\n-                SkipException skip = new SkipException(\"some tests failed\");\n-                skip.setStackTrace(new StackTraceElement[0]);\n-                skiptests.compareAndSet(null, skip);\n-            }\n-        }\n-    }\n-\n-    @AfterClass\n-    static final void printFailedTests(ITestContext context) {\n+    @AfterAll\n+    static final void printFailedTests() {\n@@ -214,1 +222,1 @@\n-    private String[] uris() {\n+    private static String[] uris() {\n@@ -225,2 +233,1 @@\n-    @DataProvider(name = \"sanity\")\n-    public Object[][] sanity() {\n+    public static Object[][] sanity() {\n@@ -255,1 +262,1 @@\n-    private Object[][] variants(List<Thrower> throwers) {\n+    private static Object[][] variants(List<Thrower> throwers) {\n@@ -275,5 +282,1 @@\n-    @DataProvider(name = \"ioVariants\")\n-    public Object[][] ioVariants(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] ioVariants() {\n@@ -284,5 +287,1 @@\n-    @DataProvider(name = \"customVariants\")\n-    public Object[][] customVariants(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] customVariants() {\n@@ -293,1 +292,1 @@\n-    private HttpClient makeNewClient() {\n+    private static HttpClient makeNewClient() {\n@@ -295,1 +294,1 @@\n-        return TRACKER.track(newClientBuilderForH3()\n+        return TRACKER.track(HttpServerAdapters.createClientBuilderForH3()\n@@ -303,1 +302,1 @@\n-    HttpClient newHttpClient(boolean share) {\n+    static HttpClient newHttpClient(boolean share) {\n@@ -307,1 +306,1 @@\n-        synchronized (this) {\n+        synchronized (AbstractThrowingPushPromises.class) {\n@@ -316,1 +315,1 @@\n-    Http3DiscoveryMode config(String uri) {\n+    static Http3DiscoveryMode config(String uri) {\n@@ -320,1 +319,1 @@\n-    Version version(String uri) {\n+    static Version version(String uri) {\n@@ -324,1 +323,1 @@\n-    HttpRequest request(String uri) {\n+    static HttpRequest request(String uri) {\n@@ -361,1 +360,1 @@\n-            assertEquals(URI.create(body).getPath(), URI.create(uri).getPath());\n+            assertEquals(URI.create(uri).getPath(), URI.create(body).getPath());\n@@ -367,1 +366,1 @@\n-                assertEquals(promisedBody, promised.uri().toASCIIString());\n+                assertEquals(promised.uri().toASCIIString(), promisedBody);\n@@ -369,1 +368,1 @@\n-            assertEquals(pushPromises.size(), 3);\n+            assertEquals(3, pushPromises.size());\n@@ -432,1 +431,0 @@\n-        checkSkip();\n@@ -606,1 +604,1 @@\n-        assertEquals(promises.size(), expectedCount,\n+        assertEquals(expectedCount, promises.size(),\n@@ -608,1 +606,1 @@\n-        assertEquals(result, List.of(reqURI.toASCIIString()));\n+        assertEquals(List.of(reqURI.toASCIIString()), result);\n@@ -761,2 +759,2 @@\n-    @BeforeTest\n-    public void setup() throws Exception {\n+    @BeforeAll\n+    public static void setup() throws Exception {\n@@ -795,2 +793,2 @@\n-    @AfterTest\n-    public void teardown() throws Exception {\n+    @AfterAll\n+    public static void teardown() throws Exception {\n","filename":"test\/jdk\/java\/net\/httpclient\/AbstractThrowingPushPromises.java","additions":77,"deletions":79,"binary":false,"changes":156,"status":"modified"},{"patch":"@@ -26,8 +26,0 @@\n-import org.testng.ITestContext;\n-import org.testng.ITestResult;\n-import org.testng.SkipException;\n-import org.testng.annotations.AfterTest;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.BeforeMethod;\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n@@ -52,1 +44,0 @@\n-import java.util.Arrays;\n@@ -79,2 +70,11 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertTrue;\n+import org.junit.jupiter.api.AfterAll;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.extension.BeforeEachCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.junit.jupiter.api.extension.TestWatcher;\n@@ -84,17 +84,17 @@\n-    SSLContext sslContext;\n-    HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n-    HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n-    HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n-    HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n-    HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n-    String httpURI_fixed;\n-    String httpURI_chunk;\n-    String httpsURI_fixed;\n-    String httpsURI_chunk;\n-    String http2URI_fixed;\n-    String http2URI_chunk;\n-    String https2URI_fixed;\n-    String https2URI_chunk;\n-    String http3URI_fixed;\n-    String http3URI_chunk;\n-    String http3URI_head;\n+    static SSLContext sslContext;\n+    static HttpTestServer httpTestServer;    \/\/ HTTP\/1.1    [ 4 servers ]\n+    static HttpTestServer httpsTestServer;   \/\/ HTTPS\/1.1\n+    static HttpTestServer http2TestServer;   \/\/ HTTP\/2 ( h2c )\n+    static HttpTestServer https2TestServer;  \/\/ HTTP\/2 ( h2  )\n+    static HttpTestServer http3TestServer;   \/\/ HTTP\/3 ( h3  )\n+    static String httpURI_fixed;\n+    static String httpURI_chunk;\n+    static String httpsURI_fixed;\n+    static String httpsURI_chunk;\n+    static String http2URI_fixed;\n+    static String http2URI_chunk;\n+    static String https2URI_fixed;\n+    static String https2URI_chunk;\n+    static String http3URI_fixed;\n+    static String http3URI_chunk;\n+    static String http3URI_head;\n@@ -119,2 +119,28 @@\n-    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n-    private volatile HttpClient sharedClient;\n+    static final class TestStopper implements TestWatcher, BeforeEachCallback {\n+        final AtomicReference<String> failed = new AtomicReference<>();\n+        TestStopper() { }\n+        @Override\n+        public void testFailed(ExtensionContext context, Throwable cause) {\n+            if (stopAfterFirstFailure()) {\n+                String msg = \"Aborting due to: \" + cause;\n+                failed.compareAndSet(null, msg);\n+                FAILURES.putIfAbsent(context.getDisplayName(), cause);\n+                System.out.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+                System.err.printf(\"%nTEST FAILED: %s%s%n\\tAborting due to %s%n%n\",\n+                        now(), context.getDisplayName(), cause);\n+            }\n+        }\n+\n+        @Override\n+        public void beforeEach(ExtensionContext context) {\n+            String msg = failed.get();\n+            Assumptions.assumeTrue(msg == null, msg);\n+        }\n+    }\n+\n+    @RegisterExtension\n+    static final TestStopper stopper = new TestStopper();\n+\n+    static final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+    private static volatile HttpClient sharedClient;\n@@ -146,1 +172,1 @@\n-    protected boolean stopAfterFirstFailure() {\n+    protected static boolean stopAfterFirstFailure() {\n@@ -150,11 +176,0 @@\n-    final AtomicReference<SkipException> skiptests = new AtomicReference<>();\n-    void checkSkip() {\n-        var skip = skiptests.get();\n-        if (skip != null) throw skip;\n-    }\n-    static String name(ITestResult result) {\n-        var params = result.getParameters();\n-        return result.getName()\n-                + (params == null ? \"()\" : Arrays.toString(result.getParameters()));\n-    }\n-\n@@ -171,1 +186,1 @@\n-    HttpRequest.Builder newRequestBuilder(String uri) {\n+    static HttpRequest.Builder newRequestBuilder(String uri) {\n@@ -180,1 +195,1 @@\n-    HttpResponse<String> headRequest(HttpClient client)\n+    static HttpResponse<String> headRequest(HttpClient client)\n@@ -189,2 +204,2 @@\n-        assertEquals(response.statusCode(), 200);\n-        assertEquals(response.version(), HTTP_2);\n+        assertEquals(200, response.statusCode());\n+        assertEquals(HTTP_2, response.version());\n@@ -196,13 +211,2 @@\n-    @BeforeMethod\n-    void beforeMethod(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            if (skiptests.get() == null) {\n-                SkipException skip = new SkipException(\"some tests failed\");\n-                skip.setStackTrace(new StackTraceElement[0]);\n-                skiptests.compareAndSet(null, skip);\n-            }\n-        }\n-    }\n-\n-    @AfterClass\n-    static final void printFailedTests(ITestContext context) {\n+    @AfterAll\n+    static final void printFailedTests() {\n@@ -233,1 +237,1 @@\n-    private String[] uris() {\n+    private static String[] uris() {\n@@ -248,1 +252,1 @@\n-    static AtomicLong URICOUNT = new AtomicLong();\n+    static final AtomicLong URICOUNT = new AtomicLong();\n@@ -250,2 +254,1 @@\n-    @DataProvider(name = \"sanity\")\n-    public Object[][] sanity() {\n+    public static Object[][] sanity() {\n@@ -264,5 +267,1 @@\n-    @DataProvider(name = \"variants\")\n-    public Object[][] variants(ITestContext context) {\n-        if (stopAfterFirstFailure() && context.getFailedTests().size() > 0) {\n-            return new Object[0][];\n-        }\n+    public static Object[][] variants() {\n@@ -285,1 +284,1 @@\n-    private HttpClient makeNewClient() {\n+    private static HttpClient makeNewClient() {\n@@ -287,1 +286,1 @@\n-        HttpClient client =  newClientBuilderForH3()\n+        HttpClient client =  HttpServerAdapters.createClientBuilderForH3()\n@@ -295,1 +294,1 @@\n-    HttpClient newHttpClient(boolean share) {\n+    static HttpClient newHttpClient(boolean share) {\n@@ -299,1 +298,1 @@\n-        synchronized (this) {\n+        synchronized (AbstractThrowingSubscribers.class) {\n@@ -360,1 +359,1 @@\n-                assertEquals(URI.create(u).getPath(), URI.create(uri2).getPath()));\n+                assertEquals(URI.create(uri2).getPath(), URI.create(u).getPath()));\n@@ -472,1 +471,0 @@\n-        checkSkip();\n@@ -554,1 +552,0 @@\n-\n@@ -822,2 +819,2 @@\n-    @BeforeTest\n-    public void setup() throws Exception {\n+    @BeforeAll\n+    public static void setup() throws Exception {\n@@ -905,2 +902,2 @@\n-    @AfterTest\n-    public void teardown() throws Exception {\n+    @AfterAll\n+    public static void teardown() throws Exception {\n","filename":"test\/jdk\/java\/net\/httpclient\/AbstractThrowingSubscribers.java","additions":76,"deletions":79,"binary":false,"changes":155,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"afterCancelProviderCustom\")\n+    @ParameterizedTest\n+    @MethodSource(\"afterCancelProviderCustom\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersCustomAfterCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"beforeCancelProviderCustom\")\n+    @ParameterizedTest\n+    @MethodSource(\"beforeCancelProviderCustom\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersCustomBeforeCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"afterCancelProviderIO\")\n+    @ParameterizedTest\n+    @MethodSource(\"afterCancelProviderIO\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersIOAfterCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"beforeCancelProviderIO\")\n+    @ParameterizedTest\n+    @MethodSource(\"beforeCancelProviderIO\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersIOBeforeCancel.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"nextRequestProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"nextRequestProvider\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersInNextRequest.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"requestProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"requestProvider\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersInRequest.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,0 @@\n-import org.testng.annotations.Test;\n@@ -40,0 +39,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,2 @@\n-    @Test(dataProvider = \"subscribeProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"subscribeProvider\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersInSubscribe.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true\n@@ -37,1 +37,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -41,1 +42,2 @@\n-    @Test(dataProvider = \"sanity\")\n+    @ParameterizedTest\n+    @MethodSource(\"sanity\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPublishersSanity.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamCustom\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamCustom\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"customVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"customVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsInputStreamCustom.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamIO\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsInputStreamIO\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"ioVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"ioVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsInputStreamIO.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesCustom\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesCustom\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"customVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"customVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsLinesCustom.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesIO\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsLinesIO\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"ioVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"ioVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsLinesIO.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringCustom\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringCustom\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"customVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"customVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsStringCustom.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringIO\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesAsStringIO\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"ioVariants\")\n+    @ParameterizedTest\n+    @MethodSource(\"ioVariants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesAsStringIO.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesSanity\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingPushPromisesSanity\n@@ -36,1 +36,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -40,1 +41,2 @@\n-    @Test(dataProvider = \"sanity\")\n+    @ParameterizedTest\n+    @MethodSource(\"sanity\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingPushPromisesSanity.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStream\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStream\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsInputStream.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStreamAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsInputStreamAsync\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsInputStreamAsync.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimiting\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimiting\n@@ -41,1 +41,0 @@\n-import org.testng.annotations.Test;\n@@ -46,0 +45,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -49,1 +50,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLimiting.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimitingAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLimitingAsync\n@@ -41,1 +41,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -46,1 +47,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLimitingAsync.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLines\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLines\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLines.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLinesAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsLinesAsync\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsLinesAsync.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsString\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsString\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsString.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsStringAsync\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersAsStringAsync\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"variants\")\n+    @ParameterizedTest\n+    @MethodSource(\"variants\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersAsStringAsync.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run testng\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersSanity\n+ * @run junit\/othervm -Djdk.internal.httpclient.debug=true ThrowingSubscribersSanity\n@@ -35,1 +35,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,2 @@\n-    @Test(dataProvider = \"sanity\")\n+    @ParameterizedTest\n+    @MethodSource(\"sanity\")\n","filename":"test\/jdk\/java\/net\/httpclient\/ThrowingSubscribersSanity.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -74,0 +74,1 @@\n+ * @bug 8373409\n","filename":"test\/jdk\/java\/net\/httpclient\/http3\/H3ErrorHandlingTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -25,1 +25,0 @@\n-import jdk.httpclient.test.lib.quic.QuicServerConnection;\n@@ -27,2 +26,2 @@\n-import jdk.internal.net.http.http3.Http3Error;\n-import jdk.internal.net.http.quic.TerminationCause;\n+import jdk.internal.net.http.common.Logger;\n+import jdk.internal.net.http.common.Utils;\n@@ -32,5 +31,4 @@\n-import jdk.test.lib.Utils;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.BeforeClass;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,0 +37,1 @@\n+import java.io.IOException;\n@@ -40,2 +39,1 @@\n-import java.net.URI;\n-import java.net.URISyntaxException;\n+import java.net.ProtocolException;\n@@ -48,3 +46,2 @@\n-import java.util.concurrent.CompletableFuture;\n-import java.util.concurrent.TimeUnit;\n-import java.util.concurrent.TimeoutException;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.function.BooleanSupplier;\n@@ -52,1 +49,1 @@\n-import static java.net.http.HttpOption.Http3DiscoveryMode.HTTP_3_URI_ONLY;\n+import static java.net.http.HttpClient.Builder.NO_PROXY;\n@@ -54,1 +51,5 @@\n-import static org.testng.Assert.*;\n+import static java.net.http.HttpOption.Http3DiscoveryMode.HTTP_3_URI_ONLY;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n@@ -58,9 +59,5 @@\n- * @summary Verifies that the HTTP client correctly handles malformed responses\n- * @library \/test\/lib \/test\/jdk\/java\/net\/httpclient\/lib\n- * @library ..\/access\n- * @build jdk.test.lib.net.SimpleSSLContext\n- *        jdk.httpclient.test.lib.common.HttpServerAdapters\n- * @build java.net.http\/jdk.internal.net.http.Http3ConnectionAccess\n- * @run testng\/othervm\n- *              -Djdk.internal.httpclient.debug=true\n- *              -Djdk.httpclient.HttpClient.log=requests,responses,errors H3MalformedResponseTest\n+ * @bug 8369595\n+ * @summary Verifies that the HTTP\/3 malformed responses are correctly handled\n+ * @library \/test\/jdk\/java\/net\/httpclient\/lib\n+ *          \/test\/lib\n+ * @run junit ${test.main.class}\n@@ -68,1 +65,0 @@\n-public class H3MalformedResponseTest implements HttpServerAdapters {\n@@ -70,3 +66,121 @@\n-    private SSLContext sslContext;\n-    private QuicStandaloneServer server;\n-    private String requestURIBase;\n+\/\/\/ Verifies that the HTTP\/3 malformed responses are correctly handled.\n+\/\/\/\n+\/\/\/ ### HTTP\/3 `HEADERS` frame & QPACK Field Section encoding crash course\n+\/\/\/\n+\/\/\/ Consider an HTTP\/3 `HEADERS` frame that carries:\n+\/\/\/\n+\/\/\/ ```\n+\/\/\/ :status: 200\n+\/\/\/ content-length: 2\n+\/\/\/ ```\n+\/\/\/\n+\/\/\/ This will be encoded as the following byte sequence:\n+\/\/\/\n+\/\/\/ ```\n+\/\/\/ 01 06 00 00 D9 54 01 32\n+\/\/\/ ```\n+\/\/\/\n+\/\/\/ Let's start with decoding the HTTP\/3 frame:\n+\/\/\/\n+\/\/\/ - `01`: Frame Type (`01` denotes `HEADERS``)\n+\/\/\/\n+\/\/\/ - `06`: Payload length (6 bytes)\n+\/\/\/\n+\/\/\/ Figured this is a `HEADERS` frame containing 6 bytes: `00 00 D9 54 01 32`.\n+\/\/\/ Let's decode the QPACK Field Section\n+\/\/\/\n+\/\/\/ - `00`: Required Insert Count (0)\n+\/\/\/\n+\/\/\/ - `00`: Base (0)\n+\/\/\/\n+\/\/\/ - `D9`:\n+\/\/\/   QPACK has a static table (indexed from 0) and `:status: 200` is at the\n+\/\/\/   static-table index 25.\n+\/\/\/\n+\/\/\/   ```\n+\/\/\/   D9 = <1101 1001>\n+\/\/\/      = <1> (Indexed Field Line)\n+\/\/\/      + <1> (Static Table)\n+\/\/\/      + <01 1001> (entry index = 25)\n+\/\/\/   ```\n+\/\/\/\n+\/\/\/ - `54 01 32`:\n+\/\/\/   `content-length: 2` can be encoded as a *literal field line with name\n+\/\/\/   reference* using the static name `content-length` (static index 4) and\n+\/\/\/   the literal value `2`.\n+\/\/\/\n+\/\/\/   ```\n+\/\/\/   54 01 32 = <0101 0100 0000 0001 0011 0010>\n+\/\/\/            = <0> (Literal Field Line)\n+\/\/\/            + <1> (Name Reference)\n+\/\/\/            + <0100> (entry index = 4)\n+\/\/\/            + <0000 0001> (value length = 1 byte)\n+\/\/\/            + <0011 0010> (value = ASCII \"2\" = 0x32 = 50)\n+\/\/\/   ```\n+\/\/\/\n+\/\/\/ Note that the `value length` field (i.e., `0000 0001`) follows a variable\n+\/\/\/ coding scheme:\n+\/\/\/\n+\/\/\/ | Prefix                | Total size | Payload size | Max value     |\n+\/\/\/ | --------------------- | ---------- | ------------ | ------------- |\n+\/\/\/ | `00xx xxxx`           | 1 byte     | 6 bits       | 63            |\n+\/\/\/ | `01xx xxxx xxxx xxxx` | 2 bytes    | 14 bits      | 16,383        |\n+\/\/\/ | `10xx xxx`           | 4 bytes    | 30 bits      | 1,073,741,823 |\n+\/\/\/ | `11xx xxx`           | 8 bytes    | 62 bits      | 4.61e18       |\n+class H3MalformedResponseTest {\n+\n+    private static final String CLASS_NAME = H3MalformedResponseTest.class.getSimpleName();\n+\n+    private static final Logger LOGGER = Utils.getDebugLogger(CLASS_NAME::toString, Utils.DEBUG);\n+\n+    private static SSLContext SSL_CONTEXT;\n+\n+    private static QuicStandaloneServer SERVER;\n+\n+    private static HttpRequest REQUEST;\n+\n+    @BeforeAll\n+    static void setUp() throws Exception {\n+\n+        \/\/ Obtain an `SSLContext`\n+        SSL_CONTEXT = new SimpleSSLContext().get();\n+        assertNotNull(SSL_CONTEXT);\n+\n+        \/\/ Create and start the server\n+        SERVER = QuicStandaloneServer.newBuilder()\n+                .availableVersions(new QuicVersion[]{QuicVersion.QUIC_V1})\n+                .sslContext(SSL_CONTEXT)\n+                .alpn(\"h3\")\n+                .build();\n+        SERVER.start();\n+        LOGGER.log(\"Server is started at {}\", SERVER.getAddress());\n+\n+        \/\/ Create the request\n+        var requestURI = URIBuilder.newBuilder()\n+                .scheme(\"https\")\n+                .loopback()\n+                .port(SERVER.getAddress().getPort())\n+                .path(\"\/\" + CLASS_NAME)\n+                .build();\n+        REQUEST = HttpRequest.newBuilder(requestURI)\n+                .version(Version.HTTP_3)\n+                .setOption(H3_DISCOVERY, HTTP_3_URI_ONLY)\n+                .build();\n+\n+    }\n+\n+    @AfterAll\n+    static void tearDown() {\n+        close(\"server\", SERVER);\n+    }\n+\n+    private static void close(String name, AutoCloseable closeable) {\n+        if (closeable != null) {\n+            LOGGER.log(\"Closing {}\", name);\n+            try {\n+                closeable.close();\n+            } catch (Exception e) {\n+                LOGGER.log(\"Could not close \" + name, e);\n+            }\n+        }\n+    }\n@@ -74,4 +188,3 @@\n-    \/\/ These responses are malformed and should not be accepted by the client,\n-    \/\/ but they should not cause connection closure\n-    @DataProvider\n-    public static Object[][] malformedResponse() {\n+    \/\/\/ Malformed responses that should not be accepted by the client, but\n+    \/\/\/ should neither cause the connection to get closed.\n+    static Object[][] malformedResponsesPreservingConnection() {\n@@ -79,17 +192,27 @@\n-                new Object[] {\"empty\", HexFormat.of().parseHex(\n-                        \"\"\n-                )},\n-                new Object[] {\"non-final response\", HexFormat.of().parseHex(\n-                        \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"ff00\" \/\/ :status:100\n-                )},\n-                new Object[] {\"uppercase header name\", HexFormat.of().parseHex(\n-                        \"01090000\"+ \/\/ headers, length 9, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"234147450130\"+ \/\/ AGE:0\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"content too long\", HexFormat.of().parseHex(\n-                        \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"c4\"+ \/\/ content-length:0\n+                {\"empty\", IOException.class, parseHex(\"\")},\n+                {\"non-final response\", IOException.class, parseHex(\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"ff00\" \/\/ :status:100\n+                )},\n+                {\"uppercase header name\", ProtocolException.class, parseHex(\n+                        \"01090000\", \/\/ headers, length 9, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"234147450130\", \/\/ AGE:0\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"content too long\", IOException.class, parseHex(\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"c4\", \/\/ content-length:0\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"content too short\", IOException.class, parseHex(\n+                        \"01060000\", \/\/ headers, length 6, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"540132\", \/\/ content-length:2\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"text in content-length\", ProtocolException.class, parseHex(\n+                        \"01060000\" + \/\/ headers, length 6, section prefix\n+                                \"d9\" + \/\/ :status:200\n+                                \"540161\" + \/\/ content-length:a\n@@ -98,16 +221,4 @@\n-                new Object[] {\"content too short\", HexFormat.of().parseHex(\n-                        \"01060000\"+ \/\/ headers, length 6, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"540132\"+ \/\/ content-length:2\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"text in content-length\", HexFormat.of().parseHex(\n-                        \"01060000\"+ \/\/ headers, length 6, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"540161\"+ \/\/ content-length:a\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"connection: close\", HexFormat.of().parseHex(\n-                        \"01150000\"+ \/\/ headers, length 21, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"2703636F6E6E656374696F6E05636C6F7365\"+ \/\/ connection:close\n+                {\"connection: close\", ProtocolException.class, parseHex(\n+                        \"01150000\", \/\/ headers, length 21, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"2703636F6E6E656374696F6E05636C6F7365\" + \/\/ connection:close\n@@ -117,37 +228,37 @@\n-                new Object[] {\":method in response\", HexFormat.of().parseHex(\n-                        \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"d1\"+ \/\/ :method:get\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\":authority in response\", HexFormat.of().parseHex(\n-                        \"01100000\"+ \/\/ headers, length 16, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"508b089d5c0b8170dc702fbce7\"+ \/\/ :authority\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\":path in response\", HexFormat.of().parseHex(\n-                        \"010a0000\"+ \/\/ headers, length 10, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"51856272d141ff\"+ \/\/ :path\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\":scheme in response\", HexFormat.of().parseHex(\n-                        \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"d7\"+ \/\/ :scheme:https\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"undefined pseudo-header\", HexFormat.of().parseHex(\n-                        \"01080000\"+ \/\/ headers, length 8, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"223A6D0130\"+ \/\/ :m:0\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"pseudo-header after regular\", HexFormat.of().parseHex(\n-                        \"011a0000\"+ \/\/ headers, length 26, section prefix\n-                                \"5f5094ca3ee35a74a6b589418b5258132b1aa496ca8747\"+ \/\/user-agent\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"trailer\", HexFormat.of().parseHex(\n+                {\":method in response\", ProtocolException.class, parseHex(\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"d1\", \/\/ :method:get\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\":authority in response\", ProtocolException.class, parseHex(\n+                        \"01100000\", \/\/ headers, length 16, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"508b089d5c0b8170dc702fbce7\", \/\/ :authority\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\":path in response\", ProtocolException.class, parseHex(\n+                        \"010a0000\", \/\/ headers, length 10, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"51856272d141ff\", \/\/ :path\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\":scheme in response\", ProtocolException.class, parseHex(\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"d7\", \/\/ :scheme:https\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"undefined pseudo-header\", ProtocolException.class, parseHex(\n+                        \"01080000\", \/\/ headers, length 8, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"223A6D0130\", \/\/ :m:0\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"pseudo-header after regular\", ProtocolException.class, parseHex(\n+                        \"011a0000\", \/\/ headers, length 26, section prefix\n+                        \"5f5094ca3ee35a74a6b589418b5258132b1aa496ca8747\", \/\/user-agent\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"trailer\", IOException.class, parseHex(\n@@ -156,3 +267,3 @@\n-                new Object[] {\"trailer+data\", HexFormat.of().parseHex(\n-                        \"01020000\"+ \/\/ headers, length 2, section prefix\n-                                \"000100\" \/\/ data, 1 byte\n+                {\"trailer+data\", IOException.class, parseHex(\n+                        \"01020000\", \/\/ headers, length 2, section prefix\n+                        \"000100\" \/\/ data, 1 byte\n@@ -161,23 +272,23 @@\n-                new Object[] {\"invalid character in field value 00\", HexFormat.of().parseHex(\n-                        \"01060000\"+ \/\/ headers, length 6, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"570100\"+ \/\/ etag:\\0\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"invalid character in field value 0a\", HexFormat.of().parseHex(\n-                        \"01060000\"+ \/\/ headers, length 6, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"57010a\"+ \/\/ etag:\\n\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"invalid character in field value 0d\", HexFormat.of().parseHex(\n-                        \"01060000\"+ \/\/ headers, length 6, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"57010d\"+ \/\/ etag:\\r\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"invalid character in field value 7f\", HexFormat.of().parseHex(\n-                        \"01060000\"+ \/\/ headers, length 6, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"57017f\"+ \/\/ etag: 0x7f\n-                                \"000100\" \/\/ data, 1 byte\n+                {\"invalid character in field value 00\", ProtocolException.class, parseHex(\n+                        \"01060000\", \/\/ headers, length 6, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"570100\", \/\/ etag:\\0\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"invalid character in field value 0a\", ProtocolException.class, parseHex(\n+                        \"01060000\", \/\/ headers, length 6, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"57010a\", \/\/ etag:\\n\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"invalid character in field value 0d\", ProtocolException.class, parseHex(\n+                        \"01060000\", \/\/ headers, length 6, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"57010d\", \/\/ etag:\\r\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"invalid character in field value 7f\", ProtocolException.class, parseHex(\n+                        \"01060000\", \/\/ headers, length 6, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"57017f\", \/\/ etag: 0x7f\n+                        \"000100\" \/\/ data, 1 byte\n@@ -188,4 +299,3 @@\n-    \/\/ These responses are malformed and should not be accepted by the client.\n-    \/\/ They might or might not cause connection closure (H3_FRAME_UNEXPECTED)\n-    @DataProvider\n-    public static Object[][] malformedResponse2() {\n+    \/\/\/ Malformed responses that should not be accepted by the client.\n+    \/\/\/ They might or might not cause the connection to get closed (`H3_FRAME_UNEXPECTED`).\n+    static Object[][] malformedResponses() {\n@@ -194,50 +304,50 @@\n-                new Object[] {\"100+data\", HexFormat.of().parseHex(\n-                        \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"ff00\"+ \/\/ :status:100\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"100+data+200\", HexFormat.of().parseHex(\n-                        \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"ff00\"+ \/\/ :status:100\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\" \/\/ :status:200\n-                )},\n-                new Object[] {\"200+data+200\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\" \/\/ :status:200\n-                )},\n-                new Object[] {\"200+data+100\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"ff00\" \/\/ :status:100\n-                )},\n-                new Object[] {\"200+data+trailers+data\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"01020000\"+ \/\/ trailers, length 2, section prefix\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"200+trailers+data\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"01020000\"+ \/\/ trailers, length 2, section prefix\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"200+200\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\" \/\/ :status:200\n-                )},\n-                new Object[] {\"200+100\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"ff00\" \/\/ :status:100\n+                {\"100+data\", IOException.class, parseHex(\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"ff00\", \/\/ :status:100\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"100+data+200\", IOException.class, parseHex(\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"ff00\", \/\/ :status:100\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\" \/\/ :status:200\n+                )},\n+                {\"200+data+200\", IOException.class, parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\" \/\/ :status:200\n+                )},\n+                {\"200+data+100\", IOException.class, parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"ff00\" \/\/ :status:100\n+                )},\n+                {\"200+data+trailers+data\", ProtocolException.class, parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"01020000\", \/\/ trailers, length 2, section prefix\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"200+trailers+data\", IOException.class, parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"01020000\", \/\/ trailers, length 2, section prefix\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"200+200\", IOException.class, parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\" \/\/ :status:200\n+                )},\n+                {\"200+100\", IOException.class, parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"ff00\" \/\/ :status:100\n@@ -248,2 +358,2 @@\n-    @DataProvider\n-    public static Object[][] wellformedResponse() {\n+    \/\/\/ Well-formed responses that should be accepted by the client.\n+    static Object[][] wellFormedResponses() {\n@@ -251,45 +361,45 @@\n-                new Object[] {\"100+200+data+reserved\", HexFormat.of().parseHex(\n-                        \"01040000\"+ \/\/ headers, length 4, section prefix\n-                                \"ff00\"+ \/\/ :status:100\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"210100\" \/\/ reserved, 1 byte\n-                )},\n-                new Object[] {\"200+data+reserved\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"210100\" \/\/ reserved, 1 byte\n-                )},\n-                new Object[] {\"200+data\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"200+user-agent+data\", HexFormat.of().parseHex(\n-                        \"011a0000\"+ \/\/ headers, length 26, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"5f5094ca3ee35a74a6b589418b5258132b1aa496ca8747\"+ \/\/user-agent\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"200\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\" \/\/ :status:200\n-                )},\n-                new Object[] {\"200+data+data\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"000100\" \/\/ data, 1 byte\n-                )},\n-                new Object[] {\"200+data+trailers\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"000100\"+ \/\/ data, 1 byte\n-                                \"01020000\" \/\/ trailers, length 2, section prefix\n-                )},\n-                new Object[] {\"200+trailers\", HexFormat.of().parseHex(\n-                        \"01030000\"+ \/\/ headers, length 3, section prefix\n-                                \"d9\"+ \/\/ :status:200\n-                                \"01020000\" \/\/ trailers, length 2, section prefix\n+                {\"100+200+data+reserved\", parseHex(\n+                        \"01040000\", \/\/ headers, length 4, section prefix\n+                        \"ff00\", \/\/ :status:100\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"210100\" \/\/ reserved, 1 byte\n+                )},\n+                {\"200+data+reserved\", parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"210100\" \/\/ reserved, 1 byte\n+                )},\n+                {\"200+data\", parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"200+user-agent+data\", parseHex(\n+                        \"011a0000\", \/\/ headers, length 26, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"5f5094ca3ee35a74a6b589418b5258132b1aa496ca8747\", \/\/user-agent\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"200\", parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\" \/\/ :status:200\n+                )},\n+                {\"200+data+data\", parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"000100\" \/\/ data, 1 byte\n+                )},\n+                {\"200+data+trailers\", parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"000100\", \/\/ data, 1 byte\n+                        \"01020000\" \/\/ trailers, length 2, section prefix\n+                )},\n+                {\"200+trailers\", parseHex(\n+                        \"01030000\", \/\/ headers, length 3, section prefix\n+                        \"d9\", \/\/ :status:200\n+                        \"01020000\" \/\/ trailers, length 2, section prefix\n@@ -300,22 +410,4 @@\n-    @BeforeClass\n-    public void beforeClass() throws Exception {\n-        sslContext = new SimpleSSLContext().get();\n-        if (sslContext == null) {\n-            throw new AssertionError(\"Unexpected null sslContext\");\n-        }\n-        server = QuicStandaloneServer.newBuilder()\n-                .availableVersions(new QuicVersion[]{QuicVersion.QUIC_V1})\n-                .sslContext(sslContext)\n-                .alpn(\"h3\")\n-                .build();\n-        server.start();\n-        System.out.println(\"Server started at \" + server.getAddress());\n-        requestURIBase = URIBuilder.newBuilder().scheme(\"https\").loopback()\n-                .port(server.getAddress().getPort()).build().toString();\n-    }\n-\n-    @AfterClass\n-    public void afterClass() throws Exception {\n-        if (server != null) {\n-            System.out.println(\"Stopping server \" + server.getAddress());\n-            server.close();\n+    private static byte[] parseHex(String... strings) {\n+        var buffer = new StringBuilder();\n+        for (String string : strings) {\n+            buffer.append(string);\n@@ -323,0 +415,1 @@\n+        return HexFormat.of().parseHex(buffer.toString());\n@@ -325,23 +418,8 @@\n-    \/**\n-     * Server sends a well-formed response\n-     *\/\n-    @Test(dataProvider = \"wellformedResponse\")\n-    public void testWellFormedResponse(String desc, byte[] response) throws Exception {\n-        CompletableFuture<TerminationCause> errorCF = new CompletableFuture<>();\n-        server.addHandler((c,s)-> {\n-            try (OutputStream outputStream = s.outputStream()) {\n-                outputStream.write(response);\n-            }\n-            \/\/ verify that the connection stays open\n-            completeUponTermination(c, errorCF);\n-        });\n-        HttpClient client = getHttpClient();\n-        try {\n-            HttpRequest request = getRequest();\n-            final HttpResponse<Void> response1 = client.send(\n-                    request,\n-                    BodyHandlers.discarding());\n-            assertEquals(response1.statusCode(), 200);\n-            assertFalse(errorCF.isDone(), \"Expected the connection to be open\");\n-        } finally {\n-            client.shutdownNow();\n+    @ParameterizedTest\n+    @MethodSource(\"wellFormedResponses\")\n+    void testWellFormedResponse(String desc, byte[] serverResponseBytes) throws Exception {\n+        var connectionTerminated = configureServerResponse(serverResponseBytes);\n+        try (var client = createClient()) {\n+            final HttpResponse<Void> response = client.send(REQUEST, BodyHandlers.discarding());\n+            assertEquals(200, response.statusCode());\n+            assertFalse(connectionTerminated.getAsBoolean(), \"Expected the connection to be open\");\n@@ -351,27 +429,11 @@\n-\n-    \/**\n-     * Server sends a malformed response that should not close connection\n-     *\/\n-    @Test(dataProvider = \"malformedResponse\")\n-    public void testMalformedResponse(String desc, byte[] response) throws Exception {\n-        CompletableFuture<TerminationCause> errorCF = new CompletableFuture<>();\n-        server.addHandler((c,s)-> {\n-            try (OutputStream outputStream = s.outputStream()) {\n-                outputStream.write(response);\n-            }\n-            \/\/ verify that the connection stays open\n-            completeUponTermination(c, errorCF);\n-        });\n-        HttpClient client = getHttpClient();\n-        try {\n-            HttpRequest request = getRequest();\n-            final HttpResponse<Void> response1 = client.send(\n-                            request,\n-                            BodyHandlers.discarding());\n-            fail(\"Expected the request to fail, got \" + response1);\n-        } catch (Exception e) {\n-            System.out.println(\"Got expected exception: \" +e);\n-            e.printStackTrace();\n-            assertFalse(errorCF.isDone(), \"Expected the connection to be open\");\n-        } finally {\n-            client.shutdownNow();\n+    @ParameterizedTest\n+    @MethodSource(\"malformedResponsesPreservingConnection\")\n+    void testMalformedResponsePreservingConnection(\n+            String desc,\n+            Class<? extends Exception> exceptionClass,\n+            byte[] serverResponseBytes) {\n+        var connectionTerminated = configureServerResponse(serverResponseBytes);\n+        try (var client = createClient()) {\n+            var exception = assertThrows(exceptionClass, () -> client.send(REQUEST, BodyHandlers.discarding()));\n+            LOGGER.log(\"Got expected exception for: \" + desc, exception);\n+            assertFalse(connectionTerminated.getAsBoolean(), \"Expected the connection to be open\");\n@@ -381,22 +443,10 @@\n-    \/**\n-     * Server sends a malformed response that might close connection\n-     *\/\n-    @Test(dataProvider = \"malformedResponse2\")\n-    public void testMalformedResponse2(String desc, byte[] response) throws Exception {\n-        server.addHandler((c,s)-> {\n-            try (OutputStream outputStream = s.outputStream()) {\n-                outputStream.write(response);\n-            }\n-        });\n-        HttpClient client = getHttpClient();\n-        try {\n-            HttpRequest request = getRequest();\n-            final HttpResponse<Void> response1 = client.send(\n-                            request,\n-                            BodyHandlers.discarding());\n-            fail(\"Expected the request to fail, got \" + response1);\n-        } catch (Exception e) {\n-            System.out.println(\"Got expected exception: \" +e);\n-            e.printStackTrace();\n-        } finally {\n-            client.shutdownNow();\n+    @ParameterizedTest\n+    @MethodSource(\"malformedResponses\")\n+    void testMalformedResponse(\n+            String desc,\n+            Class<? extends Exception> exceptionClass,\n+            byte[] serverResponseBytes) {\n+        configureServerResponse(serverResponseBytes);\n+        try (var client = createClient()) {\n+            var exception = assertThrows(exceptionClass, () -> client.send(REQUEST, BodyHandlers.discarding()));\n+            LOGGER.log(\"Got expected exception for: \" + desc, exception);\n@@ -406,11 +456,3 @@\n-    private HttpRequest getRequest() throws URISyntaxException {\n-        final URI reqURI = new URI(requestURIBase + \"\/hello\");\n-        final HttpRequest.Builder reqBuilder = HttpRequest.newBuilder(reqURI)\n-                .version(Version.HTTP_3)\n-                .setOption(H3_DISCOVERY, HTTP_3_URI_ONLY);\n-        return reqBuilder.build();\n-    }\n-\n-    private HttpClient getHttpClient() {\n-        final HttpClient client = newClientBuilderForH3()\n-                .proxy(HttpClient.Builder.NO_PROXY)\n+    private static HttpClient createClient() {\n+        return HttpServerAdapters.createClientBuilderForH3()\n+                .proxy(NO_PROXY)\n@@ -418,2 +460,2 @@\n-                .sslContext(sslContext).build();\n-        return client;\n+                .sslContext(SSL_CONTEXT)\n+                .build();\n@@ -422,2 +464,12 @@\n-    private static String toHexString(final Http3Error error) {\n-        return error.name() + \"(0x\" + Long.toHexString(error.code()) + \")\";\n+    private static BooleanSupplier configureServerResponse(byte[] serverResponseBytes) {\n+        var connectionTerminated = new AtomicBoolean();\n+        SERVER.addHandler((c, s)-> {\n+            try (OutputStream outputStream = s.outputStream()) {\n+                outputStream.write(serverResponseBytes);\n+            }\n+            c.futureTerminationCause().handle((_, _) -> {\n+                connectionTerminated.set(true);\n+                return true;\n+            });\n+        });\n+        return connectionTerminated::get;\n@@ -426,5 +478,0 @@\n-    private static void completeUponTermination(final QuicServerConnection serverConnection,\n-                                                final CompletableFuture<TerminationCause> cf) {\n-        serverConnection.futureTerminationCause().handle(\n-                (r,t) -> t != null ? cf.completeExceptionally(t) : cf.complete(r));\n-    }\n","filename":"test\/jdk\/java\/net\/httpclient\/http3\/H3MalformedResponseTest.java","additions":390,"deletions":343,"binary":false,"changes":733,"status":"modified"},{"patch":"@@ -50,0 +50,1 @@\n+import jdk.internal.net.http.quic.QuicTransportParameters;\n@@ -61,0 +62,1 @@\n+import static org.junit.jupiter.api.Assertions.assertNotEquals;\n@@ -66,0 +68,1 @@\n+ * @bug 8373877\n@@ -90,0 +93,4 @@\n+        \/\/ Use a longer max ack delay to inflate the draining time (3xPTO)\n+        final QuicTransportParameters transportParameters = new QuicTransportParameters();\n+        transportParameters.setIntParameter(QuicTransportParameters.ParameterId.max_ack_delay,\n+                (1 << 14) - 1); \/\/ 16 seconds, maximum allowed\n@@ -182,0 +189,3 @@\n+            \/\/ Check that the (closing) connection is still registered with the endpoint\n+            assertNotEquals(0, conn.endpoint().connectionCount(),\n+                    \"Expected the QUIC connection to be registered\");\n@@ -234,0 +244,2 @@\n+            \/\/ send ping in case the connection_close message gets lost\n+            conn.underlyingQuicConnection().requestSendPing();\n@@ -240,0 +252,5 @@\n+            \/\/ wait for a while to let the connection close completely\n+            Thread.sleep(10);\n+            \/\/ Check that the (draining) connection is still registered with the endpoint\n+            assertNotEquals(0, conn.endpoint().connectionCount(),\n+                    \"Expected the QUIC connection to be registered\");\n","filename":"test\/jdk\/java\/net\/httpclient\/quic\/StatelessResetReceiptTest.java","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -354,1 +354,8 @@\n-        return URI.create(\"ws:\/\/localhost:\" + address.getPort());\n+        String ip = address.getAddress().isAnyLocalAddress()\n+                ? InetAddress.getLoopbackAddress().getHostAddress()\n+                : address.getAddress().getHostAddress();\n+        if (ip.indexOf(':') >= 0) {\n+            ip = String.format(\"[%s]\", ip);\n+        }\n+\n+        return URI.create(\"ws:\/\/\" + ip + \":\" + address.getPort());\n","filename":"test\/jdk\/java\/net\/httpclient\/websocket\/DummyWebSocketServer.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,2 +24,0 @@\n-import org.testng.Assert;\n-import org.testng.annotations.Test;\n@@ -30,0 +28,2 @@\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n@@ -36,1 +36,1 @@\n- * @run testng\/othervm -Djava.locale.providers=CLDR,SPI CalendarDisplayNamesTest\n+ * @run junit\/othervm -Djava.locale.providers=CLDR,SPI CalendarDisplayNamesTest\n@@ -38,1 +38,1 @@\n- * @run testng CalendarDisplayNamesTest\n+ * @run junit CalendarDisplayNamesTest\n@@ -58,1 +58,1 @@\n-                    Assert.assertTrue(fieldValue == Calendar.AM || fieldValue == Calendar.PM,\n+                    Assertions.assertTrue(fieldValue == Calendar.AM || fieldValue == Calendar.PM,\n","filename":"test\/jdk\/java\/util\/Calendar\/CalendarDisplayNamesTest.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n- * @run testng\/othervm JapaneseLenientEraTest\n+ * @run junit\/othervm JapaneseLenientEraTest\n@@ -37,3 +37,4 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n-import static org.testng.Assert.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -41,1 +42,1 @@\n-@Test\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -44,2 +45,1 @@\n-    @DataProvider(name=\"lenientEra\")\n-    Object[][] names() {\n+    Object[][] lenientEra() {\n@@ -54,1 +54,2 @@\n-    @Test(dataProvider=\"lenientEra\")\n+    @ParameterizedTest\n+    @MethodSource(\"lenientEra\")\n@@ -64,1 +65,1 @@\n-        assertEquals(lenDate, strDate);\n+        assertEquals(strDate, lenDate);\n","filename":"test\/jdk\/java\/util\/Calendar\/JapaneseLenientEraTest.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n- * @run testng\/othervm SupplementalJapaneseEraTestRun\n+ * @run junit\/othervm SupplementalJapaneseEraTestRun\n@@ -48,2 +48,3 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -51,0 +52,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -52,1 +54,0 @@\n-    @DataProvider(name = \"validprop\")\n@@ -61,1 +62,0 @@\n-    @DataProvider(name = \"invalidprop\")\n@@ -79,1 +79,2 @@\n-    @Test(dataProvider = \"validprop\")\n+    @ParameterizedTest\n+    @MethodSource(\"validPropertyData\")\n@@ -87,1 +88,2 @@\n-    @Test(dataProvider = \"invalidprop\")\n+    @ParameterizedTest\n+    @MethodSource(\"invalidPropertyData\")\n","filename":"test\/jdk\/java\/util\/Calendar\/SupplementalJapaneseEraTestRun.java","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,4 +27,4 @@\n-import org.testng.Assert;\n-\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -35,1 +35,1 @@\n- * @run testng CompatibilityTest\n+ * @run junit CompatibilityTest\n@@ -38,0 +38,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -39,1 +40,0 @@\n-    @DataProvider(name = \"entries\")\n@@ -56,1 +56,2 @@\n-    @Test(dataProvider = \"entries\")\n+    @ParameterizedTest\n+    @MethodSource(\"getEntries\")\n@@ -58,1 +59,1 @@\n-        Assert.assertThrows(ClassCastException.class, () -> storeToXML(key, value));\n+        Assertions.assertThrows(ClassCastException.class, () -> storeToXML(key, value));\n","filename":"test\/jdk\/java\/util\/Properties\/CompatibilityTest.java","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,3 +30,4 @@\n-import org.testng.Assert;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -39,1 +40,1 @@\n- * @run testng EncodingTest\n+ * @run junit EncodingTest\n@@ -41,0 +42,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -42,1 +44,0 @@\n-    @DataProvider(name = \"parameters\")\n@@ -54,1 +55,2 @@\n-    @Test(dataProvider = \"parameters\")\n+    @ParameterizedTest\n+    @MethodSource(\"getParameters\")\n@@ -77,1 +79,1 @@\n-        Assert.assertEquals(props, p);\n+        Assertions.assertEquals(p, props);\n","filename":"test\/jdk\/java\/util\/Properties\/EncodingTest.java","additions":10,"deletions":8,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,2 @@\n-import org.testng.annotations.Test;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n@@ -32,1 +33,1 @@\n- * @run testng InitialCapacity\n+ * @run junit InitialCapacity\n@@ -35,2 +36,5 @@\n-    @Test(expectedExceptions = IllegalArgumentException.class)\n-    public void negativeInitCap() { Properties p = new Properties(-1); }\n+    @Test\n+    public void negativeInitCap() { Assertions.assertThrows(IllegalArgumentException.class, () -> {\n+        Properties p = new Properties(-1);\n+        });\n+}\n","filename":"test\/jdk\/java\/util\/Properties\/InitialCapacity.java","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * @run testng PropertiesEntrySetTest\n+ * @run junit PropertiesEntrySetTest\n@@ -32,1 +32,0 @@\n-import org.testng.annotations.Test;\n@@ -36,4 +35,5 @@\n-import static org.testng.Assert.assertEquals;\n-import static org.testng.Assert.assertFalse;\n-import static org.testng.Assert.assertThrows;\n-import static org.testng.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.Test;\n@@ -102,1 +102,1 @@\n-        assertEquals(aEntrySet.toString(), \"[]\");\n+        assertEquals(\"[]\", aEntrySet.toString());\n@@ -105,1 +105,1 @@\n-        assertEquals(aEntrySet.toString(), \"[p1=1]\");\n+        assertEquals(\"[p1=1]\", aEntrySet.toString());\n@@ -108,1 +108,1 @@\n-        assertEquals(aEntrySet.size(), 2);\n+        assertEquals(2, aEntrySet.size());\n@@ -118,1 +118,1 @@\n-        assertEquals(bEntrySet.size(), 2);\n+        assertEquals(2, bEntrySet.size());\n@@ -125,1 +125,1 @@\n-        assertEquals(bEntrySet.size(), 3);\n+        assertEquals(3, bEntrySet.size());\n@@ -129,1 +129,1 @@\n-        assertEquals(bEntrySet.size(), 2);\n+        assertEquals(2, bEntrySet.size());\n@@ -137,1 +137,1 @@\n-        assertEquals(bEntrySet.size(), 1);\n+        assertEquals(1, bEntrySet.size());\n@@ -154,1 +154,1 @@\n-        assertEquals(aEntrySet.size(), 2);\n+        assertEquals(2, aEntrySet.size());\n@@ -160,1 +160,1 @@\n-        assertEquals(aEntrySet.size(), 1);\n+        assertEquals(1, aEntrySet.size());\n@@ -175,1 +175,1 @@\n-        assertEquals(bEntrySet.size(), 2);\n+        assertEquals(2, bEntrySet.size());\n@@ -178,1 +178,1 @@\n-        assertEquals(bEntrySet.size(), 1);\n+        assertEquals(1, bEntrySet.size());\n@@ -182,1 +182,1 @@\n-        assertEquals(aEntrySet.size(), 2);\n+        assertEquals(2, aEntrySet.size());\n","filename":"test\/jdk\/java\/util\/Properties\/PropertiesEntrySetTest.java","additions":19,"deletions":19,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,3 +24,0 @@\n-import org.testng.Assert;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -48,0 +45,4 @@\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -53,1 +54,1 @@\n- * @run testng\/othervm PropertiesStoreTest\n+ * @run junit\/othervm PropertiesStoreTest\n@@ -55,0 +56,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -63,1 +65,0 @@\n-    @DataProvider(name = \"propsProvider\")\n@@ -104,1 +105,0 @@\n-    @DataProvider(name = \"localeProvider\")\n@@ -125,1 +125,2 @@\n-    @Test(dataProvider = \"propsProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"createProps\")\n@@ -139,1 +140,2 @@\n-    @Test(dataProvider = \"propsProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"createProps\")\n@@ -164,1 +166,1 @@\n-        Assert.assertEquals(loaded, props, \"Unexpected properties loaded from stored state\");\n+        Assertions.assertEquals(props, loaded, \"Unexpected properties loaded from stored state\");\n@@ -172,1 +174,1 @@\n-        Assert.assertEquals(actualOrder.size(), expectedOrder.length,\n+        Assertions.assertEquals(expectedOrder.length, actualOrder.size(),\n@@ -175,1 +177,1 @@\n-            Assert.fail(\"Unexpected order of stored property keys. Expected order: \" + Arrays.toString(expectedOrder)\n+            Assertions.fail(\"Unexpected order of stored property keys. Expected order: \" + Arrays.toString(expectedOrder)\n@@ -183,1 +185,2 @@\n-    @Test(dataProvider = \"localeProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"provideLocales\")\n@@ -205,1 +208,2 @@\n-    @Test(dataProvider = \"localeProvider\")\n+    @ParameterizedTest\n+    @MethodSource(\"provideLocales\")\n@@ -235,1 +239,1 @@\n-                        Assert.fail(\"More than one comment line found in the stored properties file \" + file);\n+                        Assertions.fail(\"More than one comment line found in the stored properties file \" + file);\n@@ -242,1 +246,1 @@\n-            Assert.fail(\"No comment line found in the stored properties file \" + file);\n+            Assertions.fail(\"No comment line found in the stored properties file \" + file);\n@@ -247,1 +251,1 @@\n-            Assert.fail(\"Unexpected date comment: \" + comment, pe);\n+            Assertions.fail(\"Unexpected date comment: \" + comment, pe);\n","filename":"test\/jdk\/java\/util\/Properties\/PropertiesStoreTest.java","additions":21,"deletions":17,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n- * @run testng BasicTest\n+ * @run junit BasicTest\n@@ -57,2 +57,0 @@\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n@@ -61,1 +59,5 @@\n-import static org.testng.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -63,1 +65,1 @@\n-@Test\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -95,1 +97,0 @@\n-    @DataProvider(name = \"basicTestData\")\n@@ -125,1 +126,2 @@\n-    @Test(dataProvider = \"basicTestData\")\n+    @ParameterizedTest\n+    @MethodSource(\"basicTestData\")\n","filename":"test\/jdk\/java\/util\/ResourceBundle\/modules\/basic\/BasicTest.java","additions":10,"deletions":8,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n- * @run testng CacheTest\n+ * @run junit CacheTest\n@@ -40,3 +40,4 @@\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.Test;\n-import static org.testng.Assert.*;\n+import static org.junit.jupiter.api.Assertions.*;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n@@ -44,1 +45,1 @@\n-@Test\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -58,1 +59,1 @@\n-    @BeforeTest\n+    @BeforeAll\n","filename":"test\/jdk\/java\/util\/ResourceBundle\/modules\/cache\/CacheTest.java","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n- * @run testng CaseInsensitiveNameClash\n+ * @run junit CaseInsensitiveNameClash\n@@ -40,3 +40,4 @@\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.Test;\n-import static org.testng.Assert.*;\n+import static org.junit.jupiter.api.Assertions.*;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n@@ -44,0 +45,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -57,1 +59,1 @@\n-    @BeforeTest\n+    @BeforeAll\n","filename":"test\/jdk\/java\/util\/ResourceBundle\/modules\/casesensitive\/CaseInsensitiveNameClash.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,1 +37,1 @@\n- * @run testng VisibilityTest\n+ * @run junit VisibilityTest\n@@ -49,3 +49,5 @@\n-import org.testng.annotations.BeforeTest;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -53,3 +55,1 @@\n-import static org.testng.Assert.assertEquals;\n-\n-@Test\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -66,1 +66,1 @@\n-    @BeforeTest\n+    @BeforeAll\n@@ -96,1 +96,0 @@\n-    @DataProvider(name = \"RunWithTestResData\")\n@@ -191,1 +190,0 @@\n-    @DataProvider(name = \"RunWithExportedResData\")\n@@ -288,1 +286,0 @@\n-    @DataProvider(name = \"RunWithPkgResData\")\n@@ -303,1 +300,2 @@\n-    @Test(dataProvider = \"RunWithTestResData\")\n+    @ParameterizedTest\n+    @MethodSource(\"RunWithTestResData\")\n@@ -306,1 +304,1 @@\n-        assertEquals(exitCode, 0, \"Execution of the tests with \"\n+        assertEquals(0, exitCode, \"Execution of the tests with \"\n@@ -314,1 +312,2 @@\n-    @Test(dataProvider = \"RunWithExportedResData\")\n+    @ParameterizedTest\n+    @MethodSource(\"RunWithExportedResData\")\n@@ -317,1 +316,1 @@\n-        assertEquals(exitCode, 0, \"Execution of the tests with \"\n+        assertEquals(0, exitCode, \"Execution of the tests with \"\n@@ -325,1 +324,2 @@\n-    @Test(dataProvider = \"RunWithPkgResData\")\n+    @ParameterizedTest\n+    @MethodSource(\"RunWithPkgResData\")\n@@ -328,1 +328,1 @@\n-        assertEquals(exitCode, 0, \"Execution of the tests with \"\n+        assertEquals(0, exitCode, \"Execution of the tests with \"\n","filename":"test\/jdk\/java\/util\/ResourceBundle\/modules\/visibility\/VisibilityTest.java","additions":18,"deletions":18,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,1 @@\n-import static org.testng.Assert.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n@@ -34,3 +34,4 @@\n-import org.testng.annotations.Test;\n-import org.testng.annotations.DataProvider;\n-import static org.testng.Assert.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,1 +44,1 @@\n- * @run testng NegativeDSTTest\n+ * @run junit NegativeDSTTest\n@@ -45,1 +46,1 @@\n-@Test\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -54,1 +55,0 @@\n-    @DataProvider\n@@ -91,1 +91,2 @@\n-    @Test(dataProvider=\"negativeDST\")\n+    @ParameterizedTest\n+    @MethodSource(\"negativeDST\")\n@@ -94,2 +95,2 @@\n-        assertEquals(tz.getOffset(d.getTime()), offset);\n-        assertEquals(tz.inDaylightTime(d), isDST);\n+        assertEquals(offset, tz.getOffset(d.getTime()));\n+        assertEquals(isDST, tz.inDaylightTime(d));\n","filename":"test\/jdk\/java\/util\/TimeZone\/NegativeDSTTest.java","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,3 +28,4 @@\n-import org.testng.annotations.Test;\n-import org.testng.annotations.DataProvider;\n-import static org.testng.Assert.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -36,1 +37,1 @@\n- * @run testng ZoneIdRoundTripTest\n+ * @run junit ZoneIdRoundTripTest\n@@ -38,1 +39,1 @@\n-@Test\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -41,1 +42,0 @@\n-    @DataProvider\n@@ -63,1 +63,2 @@\n-    @Test(dataProvider=\"testZoneIds\")\n+    @ParameterizedTest\n+    @MethodSource(\"testZoneIds\")\n@@ -66,2 +67,2 @@\n-        assertEquals(tz.getRawOffset(), offset);\n-        assertEquals(tz.toZoneId().normalized(), zid.normalized());\n+        assertEquals(offset, tz.getRawOffset());\n+        assertEquals(zid.normalized(), tz.toZoneId().normalized());\n","filename":"test\/jdk\/java\/util\/TimeZone\/ZoneIdRoundTripTest.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -9,1 +9,0 @@\n-maxOutputSize = 2500000\n","filename":"test\/jdk\/javax\/net\/ssl\/DTLS\/TEST.properties","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake,record Equals\n+ * @run main\/othervm Equals\n@@ -41,0 +41,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,handshake,record\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -44,0 +55,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,handshake,record\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/HttpsURLConnection\/Equals.java","additions":17,"deletions":2,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main\/othervm SubjectAltNameIP [::1]\n+ * @run main\/othervm SubjectAltNameIP ::1\n@@ -169,0 +169,1 @@\n+        boolean isIpv6Addr = IPAddressUtil.isIPv6LiteralAddress(args[0]);\n@@ -170,1 +171,1 @@\n-        if (IPAddressUtil.isIPv6LiteralAddress(args[0]) && !IPSupport.hasIPv6()) {\n+        if (isIpv6Addr && !IPSupport.hasIPv6()) {\n@@ -176,1 +177,5 @@\n-        new SubjectAltNameIP(args[0]);\n+        if (isIpv6Addr) { \/\/ use the URL notion wrapper\n+            new SubjectAltNameIP(\"[\" + args[0] + \"]\");\n+        } else {\n+            new SubjectAltNameIP(args[0]);\n+        }\n","filename":"test\/jdk\/javax\/net\/ssl\/HttpsURLConnection\/SubjectAltNameIP.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -102,1 +102,1 @@\n-    private static boolean debug = true;\n+    private static boolean debug = false;\n","filename":"test\/jdk\/javax\/net\/ssl\/SSLEngine\/NoAuthClientAuth.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -57,1 +57,1 @@\n-    private static final boolean debug = true;\n+    private static final boolean debug = false;\n","filename":"test\/jdk\/javax\/net\/ssl\/SSLSession\/ResumeTLS13withSNI.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,2 +46,1 @@\n- * @run main\/othervm -Djavax.net.debug=all\n- *                   ServerNameRejectedTLSSessionResumption\n+ * @run main\/othervm ServerNameRejectedTLSSessionResumption\n@@ -51,0 +50,10 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=all\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n@@ -59,0 +68,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"all\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/SSLSession\/ServerNameRejectedTLSSessionResumption.java","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,1 +74,1 @@\n-    static boolean debug = true;\n+    static boolean debug = false;\n","filename":"test\/jdk\/javax\/net\/ssl\/ServerName\/SSLEngineExplorerMatchedSNI.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -36,1 +36,5 @@\n-import java.io.*;\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.OutputStream;\n@@ -44,0 +48,1 @@\n+\n@@ -45,0 +50,1 @@\n+\n@@ -58,1 +64,10 @@\n-import java.util.*;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Base64;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.TimeZone;\n+import java.util.concurrent.CountDownLatch;\n@@ -95,4 +110,0 @@\n-    \/*\n-     * Is the server ready to serve?\n-     *\/\n-    volatile static boolean serverReady = false;\n@@ -167,1 +178,1 @@\n-        serverReady = false;\n+        CountDownLatch serverReady = new CountDownLatch(1);\n@@ -195,1 +206,1 @@\n-                servParams);\n+                servParams, serverReady);\n@@ -222,1 +233,1 @@\n-     * If the server prematurely exits, serverReady will be set to true\n+     * If the server prematurely exits, serverReady will be counted down\n@@ -225,1 +236,2 @@\n-    void doServerSide(ServerParameters servParams) throws Exception {\n+    void doServerSide(ServerParameters servParams, CountDownLatch serverReady)\n+            throws Exception {\n@@ -277,1 +289,1 @@\n-        serverReady = true;\n+        serverReady.countDown();\n@@ -309,1 +321,1 @@\n-     * If the server prematurely exits, serverReady will be set to true\n+     * If the server prematurely exits, serverReady will be counted down\n@@ -312,1 +324,2 @@\n-    void doClientSide(ClientParameters cliParams) throws Exception {\n+    void doClientSide(ClientParameters cliParams, CountDownLatch serverReady)\n+            throws Exception {\n@@ -314,7 +327,1 @@\n-        \/\/ Wait 5 seconds for server ready\n-        for (int i = 0; (i < 100 && !serverReady); i++) {\n-            Thread.sleep(50);\n-        }\n-        if (!serverReady) {\n-            throw new RuntimeException(\"Server not ready yet\");\n-        }\n+        serverReady.await();\n@@ -376,2 +383,2 @@\n-    HttpsUrlConnClient(ClientParameters cliParams,\n-            ServerParameters servParams) throws Exception {\n+    HttpsUrlConnClient(ClientParameters cliParams, ServerParameters servParams,\n+            CountDownLatch serverReady) throws Exception {\n@@ -381,2 +388,2 @@\n-                startServer(servParams, true);\n-                startClient(cliParams, false);\n+                startServer(servParams, true, serverReady);\n+                startClient(cliParams, false, serverReady);\n@@ -384,2 +391,2 @@\n-                startClient(cliParams, true);\n-                startServer(servParams, false);\n+                startClient(cliParams, true, serverReady);\n+                startServer(servParams, false, serverReady);\n@@ -456,2 +463,2 @@\n-    final void startServer(ServerParameters servParams, boolean newThread)\n-            throws Exception {\n+    final void startServer(ServerParameters servParams, boolean newThread,\n+            CountDownLatch serverReady) throws IOException {\n@@ -463,1 +470,1 @@\n-                        doServerSide(servParams);\n+                        doServerSide(servParams, serverReady);\n@@ -470,2 +477,1 @@\n-                        System.err.println(\"Server died...\");\n-                        serverReady = true;\n+                        System.err.println(\"Server died: \" + e);\n@@ -473,0 +479,2 @@\n+                    } finally {\n+                        serverReady.countDown();\n@@ -479,1 +487,1 @@\n-                doServerSide(servParams);\n+                doServerSide(servParams, serverReady);\n@@ -481,0 +489,1 @@\n+                System.err.println(\"Server died: \" + e);\n@@ -483,1 +492,1 @@\n-                serverReady = true;\n+                serverReady.countDown();\n@@ -488,2 +497,2 @@\n-    final void startClient(ClientParameters cliParams, boolean newThread)\n-            throws Exception {\n+    final void startClient(ClientParameters cliParams, boolean newThread,\n+            CountDownLatch serverReady) throws Exception {\n@@ -495,1 +504,1 @@\n-                        doClientSide(cliParams);\n+                        doClientSide(cliParams, serverReady);\n@@ -500,1 +509,1 @@\n-                        System.err.println(\"Client died...\");\n+                        System.err.println(\"Client died: \" + e);\n@@ -508,1 +517,1 @@\n-                doClientSide(cliParams);\n+                doClientSide(cliParams, serverReady);\n@@ -511,0 +520,1 @@\n+                System.err.println(\"Client died: \" + e);\n","filename":"test\/jdk\/javax\/net\/ssl\/Stapling\/HttpsUrlConnClient.java","additions":48,"deletions":38,"binary":false,"changes":86,"status":"modified"},{"patch":"@@ -102,1 +102,1 @@\n-     *     -Djavax.net.debug=all\n+     *     -Djavax.net.debug=ssl,handshake\n@@ -108,1 +108,1 @@\n-    private static final boolean debug = true;\n+    private static final boolean debug = false;\n@@ -154,1 +154,1 @@\n-            System.setProperty(\"javax.net.debug\", \"ssl:handshake\");\n+            System.setProperty(\"javax.net.debug\", \"ssl,handshake\");\n","filename":"test\/jdk\/javax\/net\/ssl\/Stapling\/SSLEngineWithStapling.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,1 @@\n+maxOutputSize=500000\n","filename":"test\/jdk\/javax\/net\/ssl\/TEST.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,record\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -38,1 +49,3 @@\n-        System.setProperty(\"javax.net.debug\", \"ssl,record\");\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,record\");\n+        }\n","filename":"test\/jdk\/javax\/net\/ssl\/TLS\/TestJSSE.java","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -52,7 +52,7 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha1 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha256 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha384 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha512 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ec_rsa_pkcs1_sha256 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ecdsa_sha1 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ecdsa_secp384r1_sha384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha1 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha256 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha384 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha512 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 ec_rsa_pkcs1_sha256 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 ecdsa_sha1 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 ecdsa_secp384r1_sha384\n@@ -60,1 +60,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ecdsa_secp521r1_sha512\n+ * @run main\/othervm TLSTest TLSv1.3 ecdsa_secp521r1_sha512\n@@ -62,6 +62,6 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_rsae_sha256 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_rsae_sha384 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_rsae_sha512 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_pss_sha256 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_pss_sha384 TLS_AES_128_GCM_SHA256\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_pss_sha512 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_rsae_sha256 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_rsae_sha384 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_rsae_sha512 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_pss_sha256 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_pss_sha384 TLS_AES_128_GCM_SHA256\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_pss_sha512 TLS_AES_128_GCM_SHA256\n@@ -69,7 +69,7 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha1 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha256 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha384 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pkcs1_sha512 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ec_rsa_pkcs1_sha256 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ecdsa_sha1 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ecdsa_secp384r1_sha384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha1 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha256 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha384 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pkcs1_sha512 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 ec_rsa_pkcs1_sha256 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 ecdsa_sha1 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 ecdsa_secp384r1_sha384\n@@ -77,1 +77,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 ecdsa_secp521r1_sha512\n+ * @run main\/othervm TLSTest TLSv1.3 ecdsa_secp521r1_sha512\n@@ -79,6 +79,6 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_rsae_sha256 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_rsae_sha384 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_rsae_sha512 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_pss_sha256 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_pss_sha384 TLS_AES_256_GCM_SHA384\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.3 rsa_pss_pss_sha512 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_rsae_sha256 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_rsae_sha384 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_rsae_sha512 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_pss_sha256 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_pss_sha384 TLS_AES_256_GCM_SHA384\n+ * @run main\/othervm TLSTest TLSv1.3 rsa_pss_pss_sha512 TLS_AES_256_GCM_SHA384\n@@ -86,2 +86,2 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pkcs1_sha1 TLS_RSA_WITH_AES_128_CBC_SHA\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pkcs1_sha256\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pkcs1_sha1 TLS_RSA_WITH_AES_128_CBC_SHA\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pkcs1_sha256\n@@ -89,1 +89,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pkcs1_sha384\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pkcs1_sha384\n@@ -91,1 +91,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pkcs1_sha512\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pkcs1_sha512\n@@ -93,1 +93,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 ec_rsa_pkcs1_sha256\n+ * @run main\/othervm TLSTest TLSv1.2 ec_rsa_pkcs1_sha256\n@@ -95,1 +95,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 ecdsa_sha1\n+ * @run main\/othervm TLSTest TLSv1.2 ecdsa_sha1\n@@ -97,1 +97,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 ecdsa_secp384r1_sha384\n+ * @run main\/othervm TLSTest TLSv1.2 ecdsa_secp384r1_sha384\n@@ -99,1 +99,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 ecdsa_secp521r1_sha512\n+ * @run main\/othervm TLSTest TLSv1.2 ecdsa_secp521r1_sha512\n@@ -101,1 +101,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pss_rsae_sha256\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pss_rsae_sha256\n@@ -103,1 +103,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pss_rsae_sha384\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pss_rsae_sha384\n@@ -105,1 +105,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pss_rsae_sha512\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pss_rsae_sha512\n@@ -107,1 +107,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pss_pss_sha256\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pss_pss_sha256\n@@ -109,1 +109,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pss_pss_sha384\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pss_pss_sha384\n@@ -111,1 +111,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.2 rsa_pss_pss_sha512\n+ * @run main\/othervm TLSTest TLSv1.2 rsa_pss_pss_sha512\n@@ -114,2 +114,2 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.1 rsa_pkcs1_sha1 TLS_RSA_WITH_AES_128_CBC_SHA\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.1 rsa_pkcs1_sha256\n+ * @run main\/othervm TLSTest TLSv1.1 rsa_pkcs1_sha1 TLS_RSA_WITH_AES_128_CBC_SHA\n+ * @run main\/othervm TLSTest TLSv1.1 rsa_pkcs1_sha256\n@@ -117,1 +117,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.1 rsa_pkcs1_sha384\n+ * @run main\/othervm TLSTest TLSv1.1 rsa_pkcs1_sha384\n@@ -119,1 +119,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.1 rsa_pkcs1_sha512\n+ * @run main\/othervm TLSTest TLSv1.1 rsa_pkcs1_sha512\n@@ -121,1 +121,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.1 rsa_pss_rsae_sha256\n+ * @run main\/othervm TLSTest TLSv1.1 rsa_pss_rsae_sha256\n@@ -123,1 +123,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.1 rsa_pss_rsae_sha384\n+ * @run main\/othervm TLSTest TLSv1.1 rsa_pss_rsae_sha384\n@@ -125,1 +125,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1.1 rsa_pss_rsae_sha512\n+ * @run main\/othervm TLSTest TLSv1.1 rsa_pss_rsae_sha512\n@@ -128,5 +128,5 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1 rsa_pkcs1_sha1 TLS_RSA_WITH_AES_128_CBC_SHA\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1 rsa_pkcs1_sha256 TLS_RSA_WITH_AES_256_CBC_SHA\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1 rsa_pkcs1_sha384 TLS_RSA_WITH_AES_128_CBC_SHA\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1 rsa_pkcs1_sha512 TLS_RSA_WITH_AES_256_CBC_SHA\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1 rsa_pss_rsae_sha256\n+ * @run main\/othervm TLSTest TLSv1 rsa_pkcs1_sha1 TLS_RSA_WITH_AES_128_CBC_SHA\n+ * @run main\/othervm TLSTest TLSv1 rsa_pkcs1_sha256 TLS_RSA_WITH_AES_256_CBC_SHA\n+ * @run main\/othervm TLSTest TLSv1 rsa_pkcs1_sha384 TLS_RSA_WITH_AES_128_CBC_SHA\n+ * @run main\/othervm TLSTest TLSv1 rsa_pkcs1_sha512 TLS_RSA_WITH_AES_256_CBC_SHA\n+ * @run main\/othervm TLSTest TLSv1 rsa_pss_rsae_sha256\n@@ -134,1 +134,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1 rsa_pss_rsae_sha384\n+ * @run main\/othervm TLSTest TLSv1 rsa_pss_rsae_sha384\n@@ -136,1 +136,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl,handshake TLSTest TLSv1 rsa_pss_rsae_sha512\n+ * @run main\/othervm TLSTest TLSv1 rsa_pss_rsae_sha512\n@@ -141,0 +141,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,handshake\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -144,0 +155,3 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,handshake\");\n+        }\n","filename":"test\/jdk\/javax\/net\/ssl\/TLSCommon\/TLSTest.java","additions":70,"deletions":56,"binary":false,"changes":126,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,2 +27,0 @@\n- * For extra debugging output, add -Djavax.net.debug=ssl:handshake into the\n- * run directive below.\n@@ -77,0 +75,12 @@\n+\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,handshake\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -559,0 +569,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,handshake\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/TLSCommon\/TLSWithEdDSA.java","additions":17,"deletions":3,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -68,1 +68,1 @@\n-    static boolean debug = true;\n+    static boolean debug = false;\n","filename":"test\/jdk\/javax\/net\/ssl\/TLSv12\/ShortRSAKey512.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,2 +25,1 @@\n-\/\/ system properties in samevm\/agentvm mode.  For further debugging output\n-\/\/ set the -Djavax.net.debug=ssl:handshake property on the @run lines.\n+\/\/ system properties in samevm\/agentvm mode.\n@@ -49,0 +48,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,handshake\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -61,0 +71,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,handshake\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/TLSv13\/ClientHelloKeyShares.java","additions":17,"deletions":3,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,2 +25,1 @@\n-\/\/ system properties in samevm\/agentvm mode.  For further debugging output\n-\/\/ set the -Djavax.net.debug=ssl:handshake property on the @run lines.\n+\/\/ system properties in samevm\/agentvm mode.\n@@ -51,0 +50,10 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,handshake\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n@@ -212,0 +221,5 @@\n+\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,handshake\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/TLSv13\/HRRKeyShares.java","additions":17,"deletions":3,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -63,0 +63,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl:handshake\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -479,1 +490,5 @@\n-        System.setProperty(\"javax.net.debug\", \"ssl:handshake\");\n+\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl:handshake\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/compatibility\/ClientHelloProcessing.java","additions":17,"deletions":2,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -57,0 +57,12 @@\n+\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=all\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -142,0 +154,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"all\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/templates\/SSLEngineTemplate.java","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -61,0 +61,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=all\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -66,0 +77,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"all\");\n+        }\n+\n","filename":"test\/jdk\/javax\/net\/ssl\/templates\/SSLSocketTemplate.java","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n- * @key intermittent\n+ * @key sound\n","filename":"test\/jdk\/javax\/sound\/midi\/Sequencer\/Looping.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -39,0 +39,1 @@\n+ * @key sound\n","filename":"test\/jdk\/javax\/sound\/sampled\/Clip\/IsRunningHang.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+ * @key sound\n","filename":"test\/jdk\/javax\/sound\/sampled\/DataLine\/LongFramePosition.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+ * @key sound\n","filename":"test\/jdk\/javax\/sound\/sampled\/DirectAudio\/bug6372428.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n- * @run main\/othervm\/timeout=600 -Xmx8m -verify bug6520101\n+ * @run main\/othervm\/timeout=600 -Xmx8m -Xverify:all bug6520101\n","filename":"test\/jdk\/javax\/swing\/JFileChooser\/6520101\/bug6520101.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,100 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 6681958\n+ * @summary Verifies Maximization state of JInternalFrames is\n+ *          not corrupted by WindowsDesktopManager\n+ * @requires (os.family == \"windows\")\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n+ * @run main\/manual JIFMaximizedTrfAttribute\n+ *\/\n+\n+import java.awt.event.ActionEvent;\n+import java.awt.event.ActionListener;\n+import java.awt.BorderLayout;\n+\n+import javax.swing.JButton;\n+import javax.swing.JDesktopPane;\n+import javax.swing.JFrame;\n+import javax.swing.JInternalFrame;\n+import javax.swing.UIManager;\n+\n+import java.beans.PropertyVetoException;\n+\n+public class JIFMaximizedTrfAttribute {\n+\n+    static final String INSTRUCTIONS = \"\"\"\n+        A maximised JInternalFrame would be shown with a\n+        button \"open another internal frame\".\n+        Press the button on the internal frame.\n+        A second internal frame is created and opened.\n+        If second internal frame is maximized,\n+        press Pass else press Fail.\"\"\";\n+\n+    public static void main(String[] args) throws Exception {\n+        \/\/ Set Windows L&F\n+        UIManager.setLookAndFeel(\"com.sun.java.swing.plaf.windows.WindowsLookAndFeel\");\n+        PassFailJFrame.builder()\n+                .title(\"Test Instructions\")\n+                .instructions(INSTRUCTIONS)\n+                .columns(50)\n+                .testUI(JIFMaximizedTrfAttribute::createUI)\n+                .position(PassFailJFrame.Position.TOP_LEFT_CORNER)\n+                .build()\n+                .awaitAndCheck();\n+    }\n+\n+    static JFrame createUI() {\n+\n+        final JDesktopPane pane = new JDesktopPane();\n+        final JInternalFrame internal = new JInternalFrame(\"the first internal frame\", true, true, true, true);\n+        pane.add(internal);\n+        internal.setBounds(0, 0, 200, 100);\n+        try {\n+            internal.setMaximum(true);\n+        } catch (PropertyVetoException e) { }\n+        internal.setVisible(true);\n+        JButton button = new JButton(\"open another internal frame\");\n+        button.addActionListener(new ActionListener() {\n+            public void actionPerformed(ActionEvent evt) {\n+                final JInternalFrame internal2 = new JInternalFrame(\"another one\", true, true, true, true);\n+                pane.add(internal2);\n+                internal2.setBounds(250, 150, 200, 100);\n+                try {\n+                    internal2.setMaximum(true);\n+                } catch (PropertyVetoException e) {}\n+                internal2.setVisible(true);\n+            }\n+        });\n+        internal.add(button, BorderLayout.SOUTH);\n+\n+        JFrame f = new JFrame(\"JIFMaximizedTrfAttribute\");\n+        f.add(pane, BorderLayout.CENTER);\n+        f.setSize(800, 600);\n+        f.setLocationRelativeTo(null);\n+        return f;\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/JInternalFrame\/JIFMaximizedTrfAttribute.java","additions":100,"deletions":0,"binary":false,"changes":100,"status":"added"},{"patch":"@@ -1,108 +0,0 @@\n-\/*\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-import java.io.File;\n-import java.io.IOException;\n-import java.lang.reflect.InvocationTargetException;\n-import java.awt.Graphics;\n-import java.awt.image.BufferedImage;\n-import javax.imageio.ImageIO;\n-import javax.swing.JComponent;\n-import javax.swing.JProgressBar;\n-import javax.swing.SwingUtilities;\n-import javax.swing.UIManager;\n-import javax.swing.UnsupportedLookAndFeelException;\n-\n-import static java.awt.image.BufferedImage.TYPE_INT_RGB;\n-\n-\/*\n- * @test\n- * @bug 8224261\n- * @key headful\n- * @library ..\/regtesthelpers\n- * @build Util\n- * @summary Verifies JProgressBar border is not painted when border\n- *          painting is set to false\n- * @run main TestProgressBarBorder\n- *\/\n-\n-public class TestProgressBarBorder {\n-    public static void main(String[] args) throws Exception {\n-        for (UIManager.LookAndFeelInfo laf :\n-                UIManager.getInstalledLookAndFeels()) {\n-            if (!laf.getName().contains(\"Nimbus\") && !laf.getName().contains(\"GTK\")) {\n-                continue;\n-            }\n-            System.out.println(\"Testing LAF: \" + laf.getName());\n-            SwingUtilities.invokeAndWait(() -> test(laf));\n-        }\n-    }\n-\n-    private static void test(UIManager.LookAndFeelInfo laf) {\n-        setLookAndFeel(laf);\n-        JProgressBar progressBar = createProgressBar();\n-        progressBar.setBorderPainted(true);\n-        BufferedImage withBorder = paintToImage(progressBar);\n-        progressBar.setBorderPainted(false);\n-        BufferedImage withoutBorder = paintToImage(progressBar);\n-\n-        boolean equal = Util.compareBufferedImages(withBorder, withoutBorder);\n-        if (equal) {\n-            try {\n-                ImageIO.write(withBorder, \"png\", new File(\"withBorder.png\"));\n-                ImageIO.write(withoutBorder, \"png\", new File(\"withoutBorder.png\"));\n-            } catch (IOException ignored) {}\n-\n-            throw new RuntimeException(\"JProgressBar border is painted when border \" +\n-                    \"painting is set to false\");\n-        }\n-    }\n-\n-    private static void setLookAndFeel(UIManager.LookAndFeelInfo laf) {\n-        try {\n-            UIManager.setLookAndFeel(laf.getClassName());\n-        } catch (UnsupportedLookAndFeelException ignored) {\n-            System.out.println(\"Unsupported LAF: \" + laf.getClassName());\n-        } catch (ClassNotFoundException | InstantiationException\n-                 | IllegalAccessException e) {\n-            throw new RuntimeException(e);\n-        }\n-    }\n-\n-    private static JProgressBar createProgressBar() {\n-        JProgressBar progressBar = new JProgressBar();\n-        progressBar.setSize(100, 50);\n-        progressBar.setValue(0);\n-        progressBar.setStringPainted(true);\n-        return progressBar;\n-    }\n-\n-    private static BufferedImage paintToImage(JComponent content) {\n-        BufferedImage im = new BufferedImage(content.getWidth(), content.getHeight(),\n-                TYPE_INT_RGB);\n-        Graphics g = im.getGraphics();\n-        content.paint(g);\n-        g.dispose();\n-        return im;\n-    }\n-}\n","filename":"test\/jdk\/javax\/swing\/JProgressBar\/TestProgressBarBorder.java","additions":0,"deletions":108,"binary":false,"changes":108,"status":"deleted"},{"patch":"@@ -0,0 +1,64 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 6292135\n+ * @summary Verifies DefaultTableModel.setColumnIdentifiers() doesn't\n+ *          clear JTable Row Heights\n+ * @run main TestRowHeightWithColIdentifier\n+ *\/\n+\n+import javax.swing.JTable;\n+import javax.swing.SwingUtilities;\n+import javax.swing.table.DefaultTableModel;\n+\n+public class TestRowHeightWithColIdentifier{\n+\n+\n+    public static void main(String[] args) throws Exception {\n+        SwingUtilities.invokeAndWait(() -> {\n+            DefaultTableModel model = new DefaultTableModel(null, new Object[] {\"FOO\", \"BAR\"});\n+            JTable table = new JTable(model);\n+\n+            model.addRow(new Object[] {\"00\", \"01\"});\n+            model.addRow(new Object[] {\"10\", \"11\"});\n+            model.addRow(new Object[] {\"20\", \"21\"});\n+            for (int row = 0; row < table.getRowCount(); row++) {\n+                table.setRowHeight(row, 100);\n+            }\n+            for (int row = 0; row < table.getRowCount(); row++) {\n+                System.out.println(\"Before table rowHeight \" + table.getRowHeight(row));\n+            }\n+            int oldRowHeight = table.getRowHeight(0);\n+            model.setColumnIdentifiers(new Object[] {\"Check\", \"it out!\"});\n+            for (int row = 0; row < table.getRowCount(); row++) {\n+                System.out.println(\"After table rowHeight \" + table.getRowHeight(row));\n+            }\n+            int curRowHeight = table.getRowHeight(0);\n+            if (curRowHeight != oldRowHeight) {\n+                throw new RuntimeException(\"DefaultTableModel.setColumnIdentifiers() Clears JTable Row Height\");\n+            }\n+        });\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/JTable\/TestRowHeightWithColIdentifier.java","additions":64,"deletions":0,"binary":false,"changes":64,"status":"added"},{"patch":"@@ -0,0 +1,123 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8192888\n+ * @key headful\n+ * @summary Verifies ProgressBar in Synth L&F renders background\n+ *          when border is not painted\n+ * @run main TestNimbusProgressBarBorder\n+ *\/\n+\n+import java.io.File;\n+\n+import java.awt.BorderLayout;\n+import java.awt.Color;\n+import java.awt.Graphics2D;\n+import java.awt.GridBagLayout;\n+import java.awt.image.BufferedImage;\n+import java.awt.Rectangle;\n+import java.awt.Robot;\n+\n+import javax.imageio.ImageIO;\n+\n+import javax.swing.JFrame;\n+import javax.swing.JPanel;\n+import javax.swing.JProgressBar;\n+import javax.swing.UIManager;\n+import javax.swing.SwingUtilities;\n+\n+public class TestNimbusProgressBarBorder {\n+\n+    private static JFrame frame;\n+    private static JProgressBar progressBar;\n+    private static boolean failure = true;\n+    private static volatile Rectangle rect;\n+\n+    public static void main(String[] args) throws Exception {\n+        int width = 200;\n+        int height = 100;\n+        try {\n+            Robot robot = new Robot();\n+            SwingUtilities.invokeAndWait(() -> {\n+                try {\n+                    \/\/ Set Nimbus L&F\n+                    UIManager.setLookAndFeel(\"javax.swing.plaf.nimbus.NimbusLookAndFeel\");\n+                } catch (Exception e) {\n+                    throw new RuntimeException(e);\n+                }\n+                frame = new JFrame(\"Nimbus JProgressBar Test\");\n+                frame.setSize(width, height);\n+\n+                \/\/ ProgressBar setup\n+                progressBar = new JProgressBar(0, 100);\n+                progressBar.setValue(0);\n+                progressBar.setBorderPainted(false);\n+\n+                JPanel center = new JPanel(new GridBagLayout());\n+                center.setBackground(Color.WHITE);\n+                center.add(progressBar);\n+\n+                frame.add(center, BorderLayout.CENTER);\n+                frame.setLocationRelativeTo(null);\n+                frame.setVisible(true);\n+            });\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+            SwingUtilities.invokeAndWait(() -> {\n+                rect = progressBar.getBounds();\n+            });\n+\n+            BufferedImage img = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);\n+            Graphics2D g2d = (Graphics2D) img.getGraphics();\n+            g2d.setColor(Color.WHITE);\n+            g2d.fillRect(0, 0, rect.width, rect.height);\n+            progressBar.paint(g2d);\n+            g2d.dispose();\n+\n+            robot.waitForIdle();\n+            robot.delay(100);\n+\n+            for (int x = 10; x < (10 + rect.width \/ 2); x++) {\n+                for (int y = 10; y < (10 + rect.height \/ 2); y++) {\n+                    Color col = new Color(img.getRGB(x, y));\n+                    if (!col.equals(Color.WHITE)) {\n+                        failure = false;\n+                        break;\n+                    }\n+                }\n+            }\n+            if (failure) {\n+                ImageIO.write(img, \"png\", new File(\"ProgressBarTest.png\"));\n+                throw new RuntimeException(\"ProgressBar background not drawn\");\n+            }\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n+        }\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/plaf\/nimbus\/TestNimbusProgressBarBorder.java","additions":123,"deletions":0,"binary":false,"changes":123,"status":"added"},{"patch":"@@ -84,3 +84,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/TestDockerMemoryMetrics.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -56,3 +56,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/TestGetFreeSwapSpaceSize.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -65,3 +65,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/TestLimitsUpdating.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -62,3 +62,1 @@\n-            if (!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n-                DockerTestUtils.removeDockerImage(imageName);\n-            }\n+            DockerTestUtils.removeDockerImage(imageName);\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/TestPidsLimit.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,195 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jfr.jcmd;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import jdk.jfr.Enabled;\n+import jdk.jfr.Recording;\n+import jdk.jfr.consumer.RecordedEvent;\n+import jdk.jfr.consumer.RecordedObject;\n+import jdk.jfr.consumer.RecordingFile;\n+import jdk.jfr.internal.test.WhiteBox;\n+import jdk.test.lib.jfr.EventNames;\n+\n+\/**\n+ * @test id=dfs-only\n+ * @summary Test dumping with path-to-gc-roots and DFS only\n+ * @bug 8373490\n+ * @requires vm.hasJFR & vm.flagless\n+ * @modules jdk.jfr\/jdk.jfr.internal.test\n+ * @library \/test\/lib \/test\/jdk\n+ *\n+ * @run main\/othervm -XX:TLABSize=2k -Xmx256m jdk.jfr.jcmd.TestJcmdDumpPathToGCRootsBFSDFS dfs-only\n+ *\/\n+\n+\/**\n+ * @test id=bfs-only\n+ * @summary Test dumping with path-to-gc-roots and BFS only\n+ * @bug 8373490\n+ * @requires vm.hasJFR & vm.flagless\n+ * @modules jdk.jfr\/jdk.jfr.internal.test\n+ * @library \/test\/lib \/test\/jdk\n+ *\n+ * @run main\/othervm -XX:TLABSize=2k -Xmx256m jdk.jfr.jcmd.TestJcmdDumpPathToGCRootsBFSDFS bfs-only\n+ *\/\n+\n+\/**\n+ * @test id=bfsdfs\n+ * @summary Test dumping with path-to-gc-roots and mixed BFS+DFS\n+ * @bug 8373490\n+ * @requires vm.hasJFR & vm.flagless\n+ * @modules jdk.jfr\/jdk.jfr.internal.test\n+ * @library \/test\/lib \/test\/jdk\n+ *\n+ * @run main\/othervm -XX:TLABSize=2k -Xmx256m jdk.jfr.jcmd.TestJcmdDumpPathToGCRootsBFSDFS bfsdfs\n+ *\/\n+public class TestJcmdDumpPathToGCRootsBFSDFS {\n+\n+    \/\/ Note:\n+    \/\/ - We start with a small heap of 256M in order to get the minimum Edge Queue size in BFS (lower cap is 32MB, enough to hold ~2mio edges)\n+    \/\/ - We build a leak with an array containing more than 2mio entries\n+    \/\/ That will hit BFS first, then fall back to DFS, showing the performance problem JDK-8373490 describes.\n+    \/\/ DFS-only mode should work well, and so should BFS-only mode.\n+\n+    \/\/ The minimum size of the edge queue in BFS (keep in sync with hotspot)\n+    private final static int minimumEdgeQueueSizeCap = 32 * 1024 * 1024;\n+    \/\/ The size of the Edge structure (keep in sync with hotspot)\n+    private final static int edgeSizeBytes = 16;\n+\n+    public static List<Object[]> leak;\n+\n+    public static void main(String[] args) throws Exception {\n+        WhiteBox.setWriteAllObjectSamples(true);\n+        String settingName = EventNames.OldObjectSample + \"#\" + \"cutoff\";\n+\n+        int edgesPerMinSizedQueue = minimumEdgeQueueSizeCap \/ 16;\n+        int lower = 1_000_000;\n+        int upper = 3_000_000;\n+        int fudge = 250_000;\n+        if (edgesPerMinSizedQueue < (lower + fudge)) {\n+            throw new RuntimeException(\"edgesPerMinSizedQueue lower bound wrong?\");\n+        }\n+        if (edgesPerMinSizedQueue > (upper - fudge)) {\n+            throw new RuntimeException(\"edgesPerMinSizedQueue upper bound wrong?\");\n+        }\n+\n+        int leakedObjectCount;\n+        boolean skipBFS;\n+        switch (args[0]) {\n+            case \"bfsdfs\" -> {\n+                \/\/ Mixed mode: enough objects to saturate BFS queue\n+                leakedObjectCount = upper;\n+                skipBFS = false;\n+            }\n+            case \"dfs-only\" -> {\n+                \/\/ DFS-only mode: object count does not matter, we enter DFS right away\n+                leakedObjectCount = upper;\n+                skipBFS = true;\n+            }\n+            case \"bfs-only\" -> {\n+                \/\/ BFS-only mode: not enough objects to saturate BFS queue\n+                leakedObjectCount = lower;\n+                skipBFS = false;\n+            }\n+            default -> {\n+                throw new RuntimeException(\"Invalid argument\");\n+            }\n+        };\n+\n+        WhiteBox.setSkipBFS(skipBFS);\n+\n+        testDump(\"path-to-gc-roots=true\", Collections.singletonMap(settingName, \"infinity\"), leakedObjectCount, true);\n+    }\n+\n+    private static void testDump(String pathToGcRoots, Map<String, String> settings, int leakedObjectCount, boolean expectedChains) throws Exception {\n+        while (true) {\n+            try (Recording r = new Recording()) {\n+                Map<String, String> p = new HashMap<>(settings);\n+                p.put(EventNames.OldObjectSample + \"#\" + Enabled.NAME, \"true\");\n+                r.setName(\"dodo\");\n+                r.setSettings(p);\n+                r.setToDisk(true);\n+                r.start();\n+                clearLeak();\n+                System.out.println(\"Recording id: \" + r.getId());\n+                System.out.println(\"Settings: \" + settings.toString());\n+                System.out.println(\"Command: JFR.dump \" + pathToGcRoots);\n+                System.out.println(\"Chains expected: \" + expectedChains);\n+                buildLeak(leakedObjectCount);\n+                System.gc();\n+                System.gc();\n+                File recording = new File(\"TestJcmdDumpPathToGCRoots\" + r.getId() + \".jfr\");\n+                recording.delete();\n+                JcmdHelper.jcmd(\"JFR.dump\", \"name=dodo\", pathToGcRoots, \"filename=\" + recording.getAbsolutePath());\n+                r.setSettings(Collections.emptyMap());\n+                List<RecordedEvent> events = RecordingFile.readAllEvents(recording.toPath());\n+                if (events.isEmpty()) {\n+                    System.out.println(\"No events found in recording. Retrying.\");\n+                    continue;\n+                }\n+                boolean chains = hasChains(events);\n+                if (expectedChains && !chains) {\n+                    System.out.println(events);\n+                    System.out.println(\"Expected chains but found none. Retrying.\");\n+                    continue;\n+                }\n+                if (!expectedChains && chains) {\n+                    System.out.println(events);\n+                    System.out.println(\"Didn't expect chains but found some. Retrying.\");\n+                    continue;\n+                }\n+                return; \/\/ Success\n+            }\n+        }\n+    }\n+\n+    private static void clearLeak() {\n+      leak = null;\n+      System.gc();\n+    }\n+\n+    private static boolean hasChains(List<RecordedEvent> events) throws IOException {\n+        for (RecordedEvent e : events) {\n+            RecordedObject ro = e.getValue(\"object\");\n+            if (ro.getValue(\"referrer\") != null) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n+    private static void buildLeak(int objectCount) {\n+        leak = new ArrayList<Object[]>(objectCount);\n+        for (int i = 0; i < objectCount;i ++) {\n+            leak.add(new Object[0]);\n+        }\n+    }\n+}\n","filename":"test\/jdk\/jdk\/jfr\/jcmd\/TestJcmdDumpPathToGCRootsBFSDFS.java","additions":195,"deletions":0,"binary":false,"changes":195,"status":"added"},{"patch":"@@ -92,0 +92,2 @@\n+    \/\/ initialize j.u.l Logger:\n+    static final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n@@ -97,2 +99,0 @@\n-        \/\/ initialize j.u.l Logger:\n-        final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n","filename":"test\/jdk\/sun\/java2d\/marlin\/Bug8341381.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -57,0 +57,3 @@\n+    \/\/ initialize j.u.l Looger:\n+    static final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n+\n@@ -60,2 +63,0 @@\n-        \/\/ initialize j.u.l Looger:\n-        final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n","filename":"test\/jdk\/sun\/java2d\/marlin\/CrashNaNTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -56,0 +56,3 @@\n+    \/\/ initialize j.u.l Looger:\n+    static final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n+\n@@ -59,2 +62,0 @@\n-        \/\/ initialize j.u.l Looger:\n-        final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n","filename":"test\/jdk\/sun\/java2d\/marlin\/CrashPaintTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -64,0 +64,3 @@\n+    \/\/ initialize j.u.l Looger:\n+    static final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n+\n@@ -67,2 +70,0 @@\n-        \/\/ initialize j.u.l Looger:\n-        final Logger log = Logger.getLogger(\"sun.java2d.marlin\");\n","filename":"test\/jdk\/sun\/java2d\/marlin\/TextClipErrorTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -0,0 +1,167 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8372731\n+ * @library \/test\/lib\n+ * @run main\/othervm NTLMFailTest\n+ * @run main\/othervm -Djdk.includeInExceptions= NTLMFailTest\n+ * @summary check that the Authentication failure exception\n+ *     honors the jdk.includeInExceptions setting\n+ *\/\n+\n+import jdk.test.lib.net.HttpHeaderParser;\n+import jdk.test.lib.net.URIBuilder;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.net.InetAddress;\n+import java.net.PasswordAuthentication;\n+import java.net.ServerSocket;\n+import java.net.Socket;\n+import java.net.URL;\n+\n+public class NTLMFailTest {\n+\n+    static final int BODY_LEN = 8192;\n+\n+    static final String RESP_SERVER_AUTH =\n+            \"HTTP\/1.1 401 Unauthorized\\r\\n\" +\n+            \"WWW-Authenticate: NTLM\\r\\n\" +\n+            \"Connection: close\\r\\n\" +\n+            \"Content-Length: \" + BODY_LEN + \"\\r\\n\" +\n+            \"\\r\\n\";\n+\n+    static final String RESP_SERVER_NTLM =\n+            \"HTTP\/1.1 401 Unauthorized\\r\\n\" +\n+            \"WWW-Authenticate: NTLM InvalidChallenge\\r\\n\" +\n+            \"Connection: Keep-Alive\\r\\n\" +\n+            \"Content-Length: \" + BODY_LEN + \"\\r\\n\" +\n+            \"\\r\\n\";\n+\n+    public static void main(String[] args) throws Exception {\n+        Authenticator.setDefault(new TestAuthenticator());\n+        try (NTLMServer server = startServer(new ServerSocket(0, 0, InetAddress.getLoopbackAddress()))) {\n+            URL url = URIBuilder.newBuilder()\n+                    .scheme(\"http\")\n+                    .loopback()\n+                    .port(server.getLocalPort())\n+                    .path(\"\/\")\n+                    .toURLUnchecked();\n+            HttpURLConnection uc = (HttpURLConnection) url.openConnection();\n+            uc.setRequestMethod(\"HEAD\");\n+            uc.getInputStream().readAllBytes();\n+            throw new RuntimeException(\"Expected exception was not thrown\");\n+        } catch (IOException e) {\n+            if (e.getMessage().contains(\"Authentication failure\")) {\n+                System.err.println(\"Got expected exception:\");\n+                e.printStackTrace();\n+                if (System.getProperty(\"jdk.includeInExceptions\") == null) {\n+                    \/\/ detailed message enabled by default\n+                    if (e.getCause() == null) {\n+                        throw new RuntimeException(\"Expected a detailed exception\", e);\n+                    }\n+                    \/\/ no checks on the detailed message; it's platform-specific and may be translated\n+                } else {\n+                    \/\/ detailed message disabled\n+                    if (e.getCause() != null) {\n+                        throw new RuntimeException(\"Unexpected detailed exception\", e);\n+                    }\n+                }\n+            } else {\n+                throw e;\n+            }\n+        }\n+    }\n+\n+    static class NTLMServer extends Thread implements AutoCloseable {\n+        final ServerSocket ss;\n+        volatile boolean closed;\n+\n+        NTLMServer(ServerSocket serverSS) {\n+            super();\n+            setDaemon(true);\n+            this.ss = serverSS;\n+        }\n+\n+        int getLocalPort() { return ss.getLocalPort(); }\n+\n+        @Override\n+        public void run() {\n+            boolean doing2ndStageNTLM = false;\n+            while (!closed) {\n+                try {\n+                    Socket s = ss.accept();\n+                    InputStream is = s.getInputStream();\n+                    OutputStream os = s.getOutputStream();\n+                    doServer(is, os, doing2ndStageNTLM);\n+                    if (!doing2ndStageNTLM) {\n+                        doing2ndStageNTLM = true;\n+                    } else {\n+                        os.close();\n+                    }\n+                } catch (IOException ioe) {\n+                    if (!closed) {\n+                        ioe.printStackTrace();\n+                    }\n+                }\n+            }\n+        }\n+\n+        @Override\n+        public void close() {\n+           if (closed) return;\n+           synchronized(this) {\n+               if (closed) return;\n+               closed = true;\n+           }\n+           try { ss.close(); } catch (IOException x) { };\n+        }\n+    }\n+\n+    static NTLMServer startServer(ServerSocket serverSS) {\n+        NTLMServer server = new NTLMServer(serverSS);\n+        server.start();\n+        return server;\n+    }\n+\n+    static void doServer(InputStream is, OutputStream os, boolean doing2ndStageNTLM) throws IOException {\n+        if (!doing2ndStageNTLM) {\n+            new HttpHeaderParser(is);\n+            os.write(RESP_SERVER_AUTH.getBytes(\"ASCII\"));\n+        } else {\n+            new HttpHeaderParser(is);\n+            os.write(RESP_SERVER_NTLM.getBytes(\"ASCII\"));\n+        }\n+    }\n+\n+    static class TestAuthenticator extends Authenticator {\n+        protected PasswordAuthentication getPasswordAuthentication() {\n+            return new PasswordAuthentication(\"test\", \"secret\".toCharArray());\n+        }\n+    }\n+}\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/http\/NTLMFailTest.java","additions":167,"deletions":0,"binary":false,"changes":167,"status":"added"},{"patch":"@@ -30,1 +30,1 @@\n- * @run main\/manual\/native\/timeout=180 TestDynamicStore\n+ * @run main\/manual\/native TestDynamicStore\n","filename":"test\/jdk\/sun\/security\/krb5\/config\/native\/TestDynamicStore.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -41,2 +41,0 @@\n- * @comment This test should be reenabled on aarch64\n- * @requires os.simpleArch == \"x64\"\n@@ -49,2 +47,5 @@\n-\/\/ To run manually: java --add-opens java.base\/sun.security.provider=ALL-UNNAMED --add-exports java.base\/sun.security.provider=ALL-UNNAMED\n-\/\/  -XX:+UnlockDiagnosticVMOptions -XX:+UseDilithiumIntrinsics test\/jdk\/sun\/security\/provider\/acvp\/ML_DSA_Intrinsic_Test.java\n+\/\/ To run manually:\n+\/\/ java --add-opens java.base\/sun.security.provider=ALL-UNNAMED\n+\/\/  --add-exports java.base\/sun.security.provider=ALL-UNNAMED\n+\/\/  -XX:+UnlockDiagnosticVMOptions -XX:+UseDilithiumIntrinsics\n+\/\/  test\/jdk\/sun\/security\/provider\/pqc\/ML_DSA_Intrinsic_Test.java\n@@ -107,1 +108,0 @@\n-        \/\/ Hint: if test fails, you can hardcode the seed to make the test more reproducible\n@@ -110,0 +110,2 @@\n+        \/\/ Hint: if a test fails, it prints the seed, so you can hardcode\n+        \/\/ it here to reproduce the failure\n@@ -120,3 +122,2 @@\n-            \/\/ Hint: if test fails, you can hardcode the seed to make the test more reproducible:\n-            \/\/ rnd.setSeed(seed);\n-            testMult(prod1, prod2, coeffs1, coeffs2, mult, multJava, rnd, seed, i);\n+            testMult(prod1, prod2, coeffs1, coeffs2,\n+                    mult, multJava, rnd, seed, i);\n@@ -124,1 +125,2 @@\n-            testDecompose(prod1, prod2, prod3, prod4, coeffs1, coeffs2, decompose, decomposeJava, rnd, seed, i);\n+            testDecompose(prod1, prod2, prod3, prod4, coeffs1, coeffs2,\n+                    decompose, decomposeJava, rnd, seed, i);\n@@ -131,2 +133,2 @@\n-    private static final int ML_DSA_N = 256;\n-    public static void testMult(int[] prod1, int[] prod2, int[] coeffs1, int[] coeffs2,\n+    public static void testMult(int[] prod1, int[] prod2,\n+        int[] coeffs1, int[] coeffs2,\n@@ -136,3 +138,7 @@\n-        for (int j = 0; j<ML_DSA_N; j++) {\n-            coeffs1[j] = rnd.nextInt();\n-            coeffs2[j] = rnd.nextInt();\n+        \/\/ This method is always called with arrays whose elements are between\n+        \/\/ -ML_DSA_Q and ML_DSA_Q, so we only test for these here (although\n+        \/\/ both versions work fine with array element sizes that satisfy the\n+        \/\/ montMul() preconditions in sun.security.provider.ML_DSA.java\n+        for (int j = 0; j < ML_DSA_N; j++) {\n+            coeffs1[j] = rnd.nextInt(2 * ML_DSA_Q) - ML_DSA_Q;\n+            coeffs2[j] = rnd.nextInt(2 * ML_DSA_Q) - ML_DSA_Q;\n@@ -145,1 +151,14 @@\n-                throw new RuntimeException(\"[Seed \"+seed+\"@\"+i+\"] Result mult mismatch: \" + formatOf(prod1) + \" != \" + formatOf(prod2));\n+            \/\/ The Java version and the intrinsic version should not produce\n+            \/\/ the exact same result (although usually they do), it is enough\n+            \/\/ if the corresponding array elements are congruent modulo ML_DSA_Q\n+            boolean modQequal = true;\n+            for (int j = 0; j < ML_DSA_N; j++) {\n+                if (prod1[j] != prod2[j]) {\n+                    modQequal &= (((prod1[j] - prod2[j]) % ML_DSA_Q) == 0);\n+                }\n+            }\n+            if (!modQequal) {\n+                throw new RuntimeException(\"[Seed \" + seed + \"@\" + i\n+                        + \"] Result mult mismatch: \"\n+                        + formatOf(prod1) + \"\\n != \" + formatOf(prod2));\n+            }\n@@ -153,1 +172,1 @@\n-        for (int j = 0; j<ML_DSA_N; j++) {\n+        for (int j = 0; j < ML_DSA_N; j++) {\n@@ -156,3 +175,4 @@\n-        \/\/ Per Algorithm 3 in https:\/\/eprint.iacr.org\/2018\/039.pdf, one of the inputs is bound, which prevents overflows\n-        int dilithium_q = 8380417;\n-        int c = rnd.nextInt(dilithium_q);\n+\n+        \/\/ Per Algorithm 3 in https:\/\/eprint.iacr.org\/2018\/039.pdf,\n+        \/\/ one of the inputs is bound, which prevents overflows\n+        int c = rnd.nextInt(ML_DSA_Q);\n@@ -164,1 +184,3 @@\n-                throw new RuntimeException(\"[Seed \"+seed+\"@\"+i+\"] Result multConst mismatch: \" + formatOf(prod1) + \" != \" + formatOf(prod2));\n+                throw new RuntimeException(\"[Seed \" + seed + \"@\" + i\n+                        + \"] Result multConst mismatch: \"\n+                        + formatOf(prod1) + \" != \" + formatOf(prod2));\n@@ -168,1 +190,2 @@\n-    public static void testDecompose(int[] low1, int[] high1, int[] low2, int[] high2, int[] coeffs1, int[] coeffs2,\n+    public static void testDecompose(int[] low1, int[] high1, int[] low2,\n+        int[] high2, int[] coeffs1, int[] coeffs2,\n@@ -172,1 +195,1 @@\n-        for (int j = 0; j<ML_DSA_N; j++) {\n+        for (int j = 0; j < ML_DSA_N; j++) {\n@@ -185,1 +208,3 @@\n-                throw new RuntimeException(\"[Seed \"+seed+\"@\"+i+\"] Result low mismatch: \" + formatOf(low1) + \" != \" + formatOf(low2));\n+                throw new RuntimeException(\"[Seed \" + seed + \"@\" + i\n+                        + \"] Result low mismatch: \"\n+                        + formatOf(low1) + \" != \" + formatOf(low2));\n@@ -189,1 +214,3 @@\n-                throw new RuntimeException(\"[Seed \"+seed+\"@\"+i+\"] Result high mismatch: \" + formatOf(high1) + \" != \" + formatOf(high2));\n+                throw new RuntimeException(\"[Seed \" + seed + \"@\" + i\n+                        + \"] Result high mismatch: \"\n+                        + formatOf(high1) + \" != \" + formatOf(high2));\n@@ -196,1 +223,1 @@\n-        for (int j = 0; j<ML_DSA_N; j++) {\n+        for (int j = 0; j < ML_DSA_N; j++) {\n@@ -204,1 +231,3 @@\n-            throw new RuntimeException(\"[Seed \"+seed+\"@\"+i+\"] Result AlmostNtt mismatch: \" + formatOf(coeffs1) + \" != \" + formatOf(coeffs2));\n+            throw new RuntimeException(\"[Seed \" + seed + \"@\" + i\n+                    +\"] Result AlmostNtt mismatch: \"\n+                    + formatOf(coeffs1) + \" != \" + formatOf(coeffs2));\n@@ -211,1 +240,1 @@\n-        for (int j = 0; j<ML_DSA_N; j++) {\n+        for (int j = 0; j < ML_DSA_N; j++) {\n@@ -219,1 +248,3 @@\n-            throw new RuntimeException(\"[Seed \"+seed+\"@\"+i+\"] Result InverseNtt mismatch: \" + formatOf(coeffs1) + \" != \" + formatOf(coeffs2));\n+            throw new RuntimeException(\"[Seed \" + seed+  \"@\" + i\n+                    +\"] Result InverseNtt mismatch: \"\n+                    + formatOf(coeffs1) + \" != \" + formatOf(coeffs2));\n@@ -233,0 +264,3 @@\n+    private static final int ML_DSA_N = 256;\n+    private static final int ML_DSA_Q = 8380417;\n+\n","filename":"test\/jdk\/sun\/security\/provider\/pqc\/ML_DSA_Intrinsic_Test.java","additions":62,"deletions":28,"binary":false,"changes":90,"previous_filename":"test\/jdk\/sun\/security\/provider\/acvp\/ML_DSA_Intrinsic_Test.java","status":"renamed"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,0 @@\n- * @run main\/othervm -Djavax.net.debug=all TestBadDNForPeerCA\n@@ -48,0 +47,10 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=all\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n@@ -88,0 +97,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"all\");\n+        }\n+\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLEngineImpl\/TestBadDNForPeerCA.java","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,0 @@\n- * @run main\/othervm -Djavax.net.debug=all TestBadDNForPeerCA12\n@@ -48,0 +47,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=all\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -111,0 +121,4 @@\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"all\");\n+        }\n+\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLEngineImpl\/TestBadDNForPeerCA12.java","additions":16,"deletions":2,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -55,0 +55,12 @@\n+\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,session\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -76,2 +88,2 @@\n-        if (System.getProperty(\"javax.net.debug\") == null) {\n-            System.setProperty(\"javax.net.debug\", \"session\");\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,session\");\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLSessionImpl\/NoInvalidateSocketException.java","additions":14,"deletions":2,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n- * @run main\/othervm -Djavax.net.debug=all ResumeClientTLS12withSNI\n+ * @run main\/othervm ResumeClientTLS12withSNI\n@@ -44,0 +44,11 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=all\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -80,0 +91,5 @@\n+\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"all\");\n+        }\n+\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLSessionImpl\/ResumeClientTLS12withSNI.java","additions":17,"deletions":1,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,1 +35,1 @@\n- * @run main\/othervm -Djavax.net.debug=all AnonCipherWithWantClientAuth\n+ * @run main\/othervm AnonCipherWithWantClientAuth\n@@ -44,0 +44,12 @@\n+\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=all\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -48,0 +60,5 @@\n+\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"all\");\n+        }\n+\n","filename":"test\/jdk\/sun\/security\/ssl\/ServerHandshaker\/AnonCipherWithWantClientAuth.java","additions":19,"deletions":2,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -59,0 +59,10 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl,handshake\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n@@ -117,1 +127,3 @@\n-        System.setProperty(\"javax.net.debug\", \"ssl:handshake\");\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl,handshake\");\n+        }\n","filename":"test\/jdk\/sun\/security\/ssl\/SignatureScheme\/SigAlgosExtTestWithTLS12.java","additions":14,"deletions":2,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -41,0 +41,10 @@\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl:handshake\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n@@ -51,1 +61,4 @@\n-        System.setProperty(\"javax.net.debug\", \"ssl:handshake\");\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl:handshake\");\n+        }\n+\n","filename":"test\/jdk\/sun\/security\/ssl\/SignatureScheme\/SigSchemePropOrdering.java","additions":14,"deletions":1,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,2 +31,1 @@\n- * @run main\/othervm -Djavax.net.debug=ssl:respmgr\n- *      java.base\/sun.security.ssl.StatusResponseManagerTests\n+ * @run main\/othervm java.base\/sun.security.ssl.StatusResponseManagerTests\n","filename":"test\/jdk\/sun\/security\/ssl\/Stapling\/StatusResponseManager.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -50,1 +50,11 @@\n-    private static final boolean debug = true;\n+    \/*\n+     * Enables the JSSE system debugging system property:\n+     *\n+     *     -Djavax.net.debug=ssl:respmgr\n+     *\n+     * This gives a lot of low-level information about operations underway,\n+     * including specific handshake messages, and might be best examined\n+     * after gaining some familiarity with this application.\n+     *\/\n+    private static final boolean debug = false;\n+\n@@ -75,0 +85,5 @@\n+\n+        if (debug) {\n+            System.setProperty(\"javax.net.debug\", \"ssl:respmgr\");\n+        }\n+\n","filename":"test\/jdk\/sun\/security\/ssl\/Stapling\/java.base\/sun\/security\/ssl\/StatusResponseManagerTests.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,1 @@\n+maxOutputSize=500000\n","filename":"test\/jdk\/sun\/security\/ssl\/TEST.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"added"},{"patch":"@@ -356,2 +356,2 @@\n-        } catch (Throwable t) {\n-            t.printStackTrace(System.err);\n+        } catch (Exception ex) {\n+            ex.printStackTrace(System.err);\n@@ -361,1 +361,1 @@\n-            throw new RuntimeException(t);\n+            throw new RuntimeException(ex);\n","filename":"test\/jdk\/tools\/jpackage\/helpers-test\/jdk\/jpackage\/test\/AnnotationsTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -213,1 +213,7 @@\n-            assertEquals(expectedCapturedSystemOut(commandWithDiscardedStreams), outputCapture.outLines());\n+            \/\/ If we dump the subprocesses's output, and the command produced both STDOUT and STDERR,\n+            \/\/ then the captured STDOUT may contain interleaved command's STDOUT and STDERR,\n+            \/\/ not in sequential order (STDOUT followed by STDERR).\n+            \/\/ In this case don't check the contents of the captured command's STDOUT.\n+            if (toolProvider || outputCapture.outLines().isEmpty() || (command.stdout().isEmpty() || command.stderr().isEmpty())) {\n+                assertEquals(expectedCapturedSystemOut(commandWithDiscardedStreams), outputCapture.outLines());\n+            }\n","filename":"test\/jdk\/tools\/jpackage\/helpers-test\/jdk\/jpackage\/test\/ExecutorTest.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -171,1 +171,1 @@\n-    private static class CountingConsumer extends TickCounter implements ThrowingConsumer<JPackageCommand> {\n+    private static class CountingConsumer extends TickCounter implements ThrowingConsumer<JPackageCommand, RuntimeException> {\n@@ -191,1 +191,1 @@\n-    private static class CountingRunnable extends TickCounter implements ThrowingRunnable {\n+    private static class CountingRunnable extends TickCounter implements ThrowingRunnable<RuntimeException> {\n@@ -211,1 +211,1 @@\n-    private static class CountingBundleVerifier extends TickCounter implements ThrowingBiConsumer<JPackageCommand, Executor.Result> {\n+    private static class CountingBundleVerifier extends TickCounter implements ThrowingBiConsumer<JPackageCommand, Executor.Result, RuntimeException> {\n","filename":"test\/jdk\/tools\/jpackage\/helpers-test\/jdk\/jpackage\/test\/PackageTestTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import java.io.IOException;\n@@ -215,1 +216,1 @@\n-    public void testCreateTempFile(CreateTempTestSpec testSpec) throws Throwable {\n+    public void testCreateTempFile(CreateTempTestSpec testSpec) throws IOException {\n@@ -221,1 +222,1 @@\n-    public void testCreateTempDirectory(CreateTempTestSpec testSpec) throws Throwable {\n+    public void testCreateTempDirectory(CreateTempTestSpec testSpec) throws IOException {\n@@ -235,1 +236,1 @@\n-        void test(ThrowingFunction<String, Path> createTempPath, Consumer<Path> assertTempPathExists) throws Throwable {\n+        void test(ThrowingFunction<String, Path, IOException> createTempPath, Consumer<Path> assertTempPathExists) throws IOException {\n@@ -336,1 +337,1 @@\n-    private static void runAssertWithExpectedLogOutput(ThrowingRunnable action,\n+    private static void runAssertWithExpectedLogOutput(ThrowingRunnable<? extends Exception> action,\n@@ -343,1 +344,1 @@\n-    private static void runWithExpectedLogOutput(ThrowingRunnable action,\n+    private static void runWithExpectedLogOutput(ThrowingRunnable<? extends Exception> action,\n","filename":"test\/jdk\/tools\/jpackage\/helpers-test\/jdk\/jpackage\/test\/TKitTest.java","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -155,1 +155,1 @@\n-            ThrowingBiConsumer<Path, Collection<Map.Entry<String, String>>> handler) {\n+            ThrowingBiConsumer<Path, Collection<Map.Entry<String, String>>, ? extends Exception> handler) {\n@@ -185,1 +185,1 @@\n-    private ThrowingConsumer<JPackageCommand> createVerifierAsConsumer() {\n+    private ThrowingConsumer<JPackageCommand, ? extends Exception> createVerifierAsConsumer() {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/AdditionalLauncher.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+import java.io.UncheckedIOException;\n@@ -45,0 +46,2 @@\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionException;\n@@ -51,0 +54,1 @@\n+import jdk.jpackage.internal.util.function.ExceptionBox;\n@@ -468,3 +472,31 @@\n-        final var output = combine(\n-                processProcessStream(outputStreamsControl.stdout(), process.getInputStream()),\n-                processProcessStream(outputStreamsControl.stderr(), process.getErrorStream()));\n+        var stdoutGobbler = CompletableFuture.<Optional<List<String>>>supplyAsync(() -> {\n+            try {\n+                return processProcessStream(outputStreamsControl.stdout(), process.getInputStream());\n+            } catch (IOException ex) {\n+                throw new UncheckedIOException(ex);\n+            }\n+        });\n+\n+        var stderrGobbler = CompletableFuture.<Optional<List<String>>>supplyAsync(() -> {\n+            try {\n+                return processProcessStream(outputStreamsControl.stderr(), process.getErrorStream());\n+            } catch (IOException ex) {\n+                throw new UncheckedIOException(ex);\n+            }\n+        });\n+\n+        final CommandOutput output;\n+\n+        try {\n+            output = combine(stdoutGobbler.join(), stderrGobbler.join());\n+        } catch (CompletionException ex) {\n+            var cause = ex.getCause();\n+            switch (cause) {\n+                case UncheckedIOException uioex -> {\n+                    throw uioex.getCause();\n+                }\n+                default -> {\n+                    throw ExceptionBox.toUnchecked(ExceptionBox.unbox(cause));\n+                }\n+            }\n+        }\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/Executor.java","additions":35,"deletions":3,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -294,1 +294,1 @@\n-        ThrowingConsumer<Path> createBulkFile = path -> {\n+        ThrowingConsumer<Path, IOException> createBulkFile = path -> {\n@@ -331,1 +331,1 @@\n-    JPackageCommand addPrerequisiteAction(ThrowingConsumer<JPackageCommand> action) {\n+    JPackageCommand addPrerequisiteAction(ThrowingConsumer<JPackageCommand, ? extends Exception> action) {\n@@ -336,1 +336,1 @@\n-    JPackageCommand addVerifyAction(ThrowingConsumer<JPackageCommand> action) {\n+    JPackageCommand addVerifyAction(ThrowingConsumer<JPackageCommand, ? extends Exception> action) {\n@@ -346,1 +346,1 @@\n-    JPackageCommand addVerifyAction(ThrowingConsumer<JPackageCommand> action, ActionRole actionRole) {\n+    JPackageCommand addVerifyAction(ThrowingConsumer<JPackageCommand, ? extends Exception> action, ActionRole actionRole) {\n@@ -351,1 +351,1 @@\n-    Stream<ThrowingConsumer<JPackageCommand>> getVerifyActionsWithRole(ActionRole actionRole) {\n+    Stream<ThrowingConsumer<JPackageCommand, ? extends Exception>> getVerifyActionsWithRole(ActionRole actionRole) {\n@@ -1651,1 +1651,1 @@\n-        void add(ThrowingConsumer<JPackageCommand> action) {\n+        void add(ThrowingConsumer<JPackageCommand, ? extends Exception> action) {\n@@ -1655,1 +1655,1 @@\n-        void add(ThrowingConsumer<JPackageCommand> action, ActionRole role) {\n+        void add(ThrowingConsumer<JPackageCommand, ? extends Exception> action, ActionRole role) {\n@@ -1660,1 +1660,1 @@\n-        Stream<ThrowingConsumer<JPackageCommand>> actionsWithRole(ActionRole role) {\n+        Stream<ThrowingConsumer<JPackageCommand, ? extends Exception>> actionsWithRole(ActionRole role) {\n@@ -1669,1 +1669,1 @@\n-            Action(ThrowingConsumer<JPackageCommand> impl, ActionRole role) {\n+            Action(ThrowingConsumer<JPackageCommand, ? extends Exception> impl, ActionRole role) {\n@@ -1678,1 +1678,1 @@\n-            ThrowingConsumer<JPackageCommand> impl() {\n+            ThrowingConsumer<JPackageCommand, ? extends Exception> impl() {\n@@ -1691,1 +1691,1 @@\n-            private final ThrowingConsumer<JPackageCommand> impl;\n+            private final ThrowingConsumer<JPackageCommand, ? extends Exception> impl;\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/JPackageCommand.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -43,1 +43,1 @@\n-            throw rethrowUnchecked(ex);\n+            throw toUnchecked(ex);\n@@ -54,1 +54,1 @@\n-            throw rethrowUnchecked(ex);\n+            throw toUnchecked(ex);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/JPackageStringBundle.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -105,1 +105,1 @@\n-        Action(ThrowingBiConsumer<LauncherVerifier, JPackageCommand> action) {\n+        Action(ThrowingBiConsumer<LauncherVerifier, JPackageCommand, ? extends Exception> action) {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/LauncherVerifier.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -648,1 +648,1 @@\n-            ThrowingConsumer<Path> consumer) {\n+            ThrowingConsumer<Path, ? extends Exception> consumer) {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/LinuxHelper.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -81,1 +81,1 @@\n-            ThrowingConsumer<Path> consumer) {\n+            ThrowingConsumer<Path, ? extends Exception> consumer) {\n@@ -84,0 +84,5 @@\n+        \/\/ Mount DMG under random temporary folder to avoid collisions when\n+        \/\/ mounting DMG with same name asynchroniusly multiple times.\n+        \/\/ See JDK-8373105. \"hdiutil\" does not handle such cases very good.\n+        final var mountRoot = TKit.createTempDirectory(\"mountRoot\");\n+\n@@ -88,2 +93,3 @@\n-                        JPackageCommand.escapeAndJoin(\n-                                cmd.outputBundle().toString()), \"-plist\")};\n+                    JPackageCommand.escapeAndJoin(cmd.outputBundle().toString()),\n+                    \"-mountroot\", PathUtils.normalizedAbsolutePathString(mountRoot),\n+                    \"-nobrowse\", \"-plist\")};\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/MacHelper.java","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+import java.security.NoSuchAlgorithmException;\n@@ -529,1 +530,1 @@\n-            Map<X509Certificate, Throwable> unmappedCertificates) {\n+            Map<X509Certificate, Exception> unmappedCertificates) {\n@@ -563,1 +564,1 @@\n-            final Map<X509Certificate, Throwable> unmappedCertificates = new HashMap<>();\n+            final Map<X509Certificate, Exception> unmappedCertificates = new HashMap<>();\n@@ -571,7 +572,1 @@\n-                        final Throwable t;\n-                        if (ex instanceof ExceptionBox) {\n-                            t = ex.getCause();\n-                        } else {\n-                            t = ex;\n-                        }\n-                        unmappedCertificates.put(cert, t);\n+                        unmappedCertificates.put(cert, ExceptionBox.unbox(ex));\n@@ -638,1 +633,1 @@\n-        DigestAlgorithm(int hashLength, ThrowingSupplier<MessageDigest> createDigest) {\n+        DigestAlgorithm(int hashLength, ThrowingSupplier<MessageDigest, NoSuchAlgorithmException> createDigest) {\n@@ -644,1 +639,1 @@\n-        final ThrowingSupplier<MessageDigest> createDigest;\n+        final ThrowingSupplier<MessageDigest, NoSuchAlgorithmException> createDigest;\n@@ -1226,1 +1221,1 @@\n-    private static void withTempDirectory(ThrowingConsumer<Path> callback) {\n+    private static void withTempDirectory(ThrowingConsumer<Path, ? extends Exception> callback) {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/MacSign.java","additions":7,"deletions":12,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -265,2 +265,2 @@\n-            } catch (Throwable t) {\n-                t.printStackTrace();\n+            } catch (Exception ex) {\n+                ex.printStackTrace();\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/MacSignVerify.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+import jdk.jpackage.internal.util.function.ExceptionBox;\n@@ -44,1 +45,1 @@\n-    public static void main(String... args) throws Throwable {\n+    public static void main(String... args) throws Exception {\n@@ -48,1 +49,1 @@\n-    public static void main(TestBuilder.Builder builder, String... args) throws Throwable {\n+    public static void main(TestBuilder.Builder builder, String... args) throws Exception {\n@@ -89,2 +90,2 @@\n-                } catch (Throwable throwable) {\n-                    TKit.unbox(throwable);\n+                } catch (Exception ex) {\n+                    throw ExceptionBox.unbox(ex);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/Main.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-class MethodCall implements ThrowingConsumer<Object> {\n+class MethodCall implements ThrowingConsumer<Object, Exception> {\n@@ -110,1 +110,1 @@\n-    public void accept(Object thiz) throws Throwable {\n+    public void accept(Object thiz) throws Exception {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/MethodCall.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -286,1 +286,1 @@\n-            throw rethrowUnchecked(ex);\n+            throw toUnchecked(ex);\n@@ -727,1 +727,1 @@\n-                rethrowUnchecked(ex);\n+                throw toUnchecked(ex);\n@@ -743,1 +743,1 @@\n-                rethrowUnchecked(ex);\n+                throw toUnchecked(ex);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/ObjectMapper.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -25,1 +25,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -146,1 +146,1 @@\n-    private PackageTest addInitializer(ThrowingConsumer<JPackageCommand> v, String id) {\n+    private PackageTest addInitializer(ThrowingConsumer<JPackageCommand, ? extends Exception> v, String id) {\n@@ -159,1 +159,1 @@\n-    private PackageTest addRunOnceInitializer(ThrowingRunnable v, String id) {\n+    private PackageTest addRunOnceInitializer(ThrowingRunnable<? extends Exception> v, String id) {\n@@ -161,1 +161,1 @@\n-        return addInitializer(new ThrowingConsumer<JPackageCommand>() {\n+        return addInitializer(new ThrowingConsumer<JPackageCommand, Exception>() {\n@@ -163,1 +163,1 @@\n-            public void accept(JPackageCommand unused) throws Throwable {\n+            public void accept(JPackageCommand unused) throws Exception {\n@@ -174,1 +174,1 @@\n-    public PackageTest addInitializer(ThrowingConsumer<JPackageCommand> v) {\n+    public PackageTest addInitializer(ThrowingConsumer<JPackageCommand, ? extends Exception> v) {\n@@ -178,1 +178,1 @@\n-    public PackageTest addRunOnceInitializer(ThrowingRunnable v) {\n+    public PackageTest addRunOnceInitializer(ThrowingRunnable<? extends Exception> v) {\n@@ -182,1 +182,1 @@\n-    public PackageTest addBundleVerifier(ThrowingBiConsumer<JPackageCommand, Executor.Result> v) {\n+    public PackageTest addBundleVerifier(ThrowingBiConsumer<JPackageCommand, Executor.Result, ? extends Exception> v) {\n@@ -188,1 +188,1 @@\n-    public PackageTest addBundleVerifier(ThrowingConsumer<JPackageCommand> v) {\n+    public PackageTest addBundleVerifier(ThrowingConsumer<JPackageCommand, ? extends Exception> v) {\n@@ -225,1 +225,1 @@\n-    public PackageTest addInstallVerifier(ThrowingConsumer<JPackageCommand> v) {\n+    public PackageTest addInstallVerifier(ThrowingConsumer<JPackageCommand, ? extends Exception> v) {\n@@ -231,1 +231,1 @@\n-    public PackageTest addUninstallVerifier(ThrowingConsumer<JPackageCommand> v) {\n+    public PackageTest addUninstallVerifier(ThrowingConsumer<JPackageCommand, ? extends Exception> v) {\n@@ -262,1 +262,1 @@\n-            ThrowingBiConsumer<FileAssociations.TestRun, List<Path>> consumer) {\n+            ThrowingBiConsumer<FileAssociations.TestRun, List<Path>, ? extends Exception> consumer) {\n@@ -863,1 +863,1 @@\n-                rethrowUnchecked(ex);\n+                throw toUnchecked(ex);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/PackageTest.java","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -36,1 +36,0 @@\n-import java.lang.reflect.InvocationTargetException;\n@@ -113,1 +112,1 @@\n-    static void withExtraLogStream(ThrowingRunnable action) {\n+    static void withExtraLogStream(ThrowingRunnable<? extends Exception> action) {\n@@ -123,1 +122,1 @@\n-    static void withExtraLogStream(ThrowingRunnable action, PrintStream logStream) {\n+    static void withExtraLogStream(ThrowingRunnable<? extends Exception> action, PrintStream logStream) {\n@@ -129,1 +128,1 @@\n-    public static void withMainLogStream(ThrowingRunnable action, PrintStream logStream) {\n+    public static void withMainLogStream(ThrowingRunnable<? extends Exception> action, PrintStream logStream) {\n@@ -135,1 +134,1 @@\n-    public static void withStackTraceStream(ThrowingRunnable action, PrintStream logStream) {\n+    public static void withStackTraceStream(ThrowingRunnable<? extends Exception> action, PrintStream logStream) {\n@@ -149,1 +148,1 @@\n-    private static void withNewState(ThrowingRunnable action, Consumer<State.Builder> stateBuilderMutator) {\n+    private static void withNewState(ThrowingRunnable<? extends Exception> action, Consumer<State.Builder> stateBuilderMutator) {\n@@ -201,1 +200,1 @@\n-    static <T> T runAdhocTest(ThrowingSupplier<T> action) {\n+    static <T> T runAdhocTest(ThrowingSupplier<T, ? extends Exception> action) {\n@@ -209,1 +208,1 @@\n-    static void runAdhocTest(ThrowingRunnable action) {\n+    static void runAdhocTest(ThrowingRunnable<? extends Exception> action) {\n@@ -230,1 +229,1 @@\n-    static Runnable ignoreExceptions(ThrowingRunnable action) {\n+    static Runnable ignoreExceptions(ThrowingRunnable<? extends Exception> action) {\n@@ -235,2 +234,2 @@\n-                } catch (Throwable ex) {\n-                    unbox(ex);\n+                } catch (Exception ex) {\n+                    throw ExceptionBox.unbox(ex);\n@@ -238,2 +237,2 @@\n-            } catch (Throwable throwable) {\n-                printStackTrace(throwable);\n+            } catch (Exception | AssertionError t) {\n+                printStackTrace(t);\n@@ -244,8 +243,0 @@\n-    static void unbox(Throwable throwable) throws Throwable {\n-        try {\n-            throw throwable;\n-        } catch (ExceptionBox | InvocationTargetException ex) {\n-            unbox(ex.getCause());\n-        }\n-    }\n-\n@@ -443,1 +434,1 @@\n-    private static Path createTempPath(Path templatePath, ThrowingUnaryOperator<Path> createPath) {\n+    private static Path createTempPath(Path templatePath, ThrowingUnaryOperator<Path, IOException> createPath) {\n@@ -461,2 +452,0 @@\n-        } catch (Throwable t) {\n-            throw ExceptionBox.rethrowUnchecked(t);\n@@ -467,1 +456,1 @@\n-            ThrowingConsumer<Path> action) {\n+            ThrowingConsumer<Path, ? extends Exception> action) {\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/TKit.java","additions":14,"deletions":25,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -131,1 +131,1 @@\n-    void processCmdLineArg(String arg) throws Throwable {\n+    void processCmdLineArg(String arg) throws Exception {\n@@ -143,1 +143,1 @@\n-            ThrowingConsumer<String> argProcessor = argProcessors.get(argName);\n+            var argProcessor = argProcessors.get(argName);\n@@ -208,2 +208,2 @@\n-        final List<ThrowingConsumer<Object>> curBeforeActions;\n-        final List<ThrowingConsumer<Object>> curAfterActions;\n+        final List<ThrowingConsumer<Object, ? extends Exception>> curBeforeActions;\n+        final List<ThrowingConsumer<Object, ? extends Exception>> curAfterActions;\n@@ -329,1 +329,1 @@\n-    private ThrowingConsumer<Object> wrap(Method method) {\n+    private ThrowingConsumer<Object, ? extends Exception> wrap(Method method) {\n@@ -378,1 +378,1 @@\n-    private final Map<String, ThrowingConsumer<String>> argProcessors;\n+    private final Map<String, ThrowingConsumer<String, ? extends Exception>> argProcessors;\n@@ -383,2 +383,2 @@\n-    private List<ThrowingConsumer<Object>> beforeActions;\n-    private List<ThrowingConsumer<Object>> afterActions;\n+    private List<ThrowingConsumer<Object, ? extends Exception>> beforeActions;\n+    private List<ThrowingConsumer<Object, ? extends Exception>> afterActions;\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/TestBuilder.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -49,1 +49,1 @@\n-final class TestInstance implements ThrowingRunnable {\n+final class TestInstance implements ThrowingRunnable<Exception> {\n@@ -152,1 +152,1 @@\n-    TestInstance(ThrowingRunnable testBody, Path workDirRoot) {\n+    TestInstance(ThrowingRunnable<? extends Exception> testBody, Path workDirRoot) {\n@@ -163,2 +163,2 @@\n-    TestInstance(MethodCall testBody, List<ThrowingConsumer<Object>> beforeActions,\n-            List<ThrowingConsumer<Object>> afterActions, boolean dryRun, Path workDirRoot) {\n+    TestInstance(MethodCall testBody, List<ThrowingConsumer<Object, ? extends Exception>> beforeActions,\n+            List<ThrowingConsumer<Object, ? extends Exception>> afterActions, boolean dryRun, Path workDirRoot) {\n@@ -229,1 +229,1 @@\n-    public void run() throws Throwable {\n+    public void run() throws Exception {\n@@ -336,4 +336,4 @@\n-    private final ThrowingFunction<ThrowingConsumer<Object>, Object> testConstructor;\n-    private final ThrowingConsumer<Object> testBody;\n-    private final List<ThrowingConsumer<Object>> beforeActions;\n-    private final List<ThrowingConsumer<Object>> afterActions;\n+    private final ThrowingFunction<ThrowingConsumer<Object, ? extends Exception>, Object, ? extends Exception> testConstructor;\n+    private final ThrowingConsumer<Object, ? extends Exception> testBody;\n+    private final List<ThrowingConsumer<Object, ? extends Exception>> beforeActions;\n+    private final List<ThrowingConsumer<Object, ? extends Exception>> afterActions;\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/TestInstance.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -25,1 +25,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -198,1 +198,1 @@\n-            throw rethrowUnchecked(ex);\n+            throw toUnchecked(ex);\n@@ -271,1 +271,1 @@\n-                throw rethrowUnchecked(ex);\n+                throw toUnchecked(ex);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/WinExecutableIconVerifier.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -25,1 +25,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -637,1 +637,1 @@\n-                throw rethrowUnchecked(ex);\n+                throw toUnchecked(ex);\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/WindowsHelper.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n-import static jdk.jpackage.internal.util.function.ExceptionBox.rethrowUnchecked;\n+import static jdk.jpackage.internal.util.function.ExceptionBox.toUnchecked;\n@@ -415,1 +415,1 @@\n-            rethrowUnchecked(expectedException);\n+            throw toUnchecked(expectedException);\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/PackagingPipelineTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -26,0 +26,2 @@\n+import static org.junit.jupiter.api.Assertions.assertNotEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n@@ -38,0 +40,1 @@\n+import java.util.Map;\n@@ -41,0 +44,3 @@\n+import java.util.function.Function;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n@@ -43,0 +49,3 @@\n+import jdk.jpackage.internal.model.ConfigException;\n+import jdk.jpackage.internal.model.JPackageException;\n+import jdk.jpackage.internal.util.function.ExceptionBox;\n@@ -47,0 +56,1 @@\n+import org.junit.jupiter.params.provider.ValueSource;\n@@ -56,0 +66,15 @@\n+    @ParameterizedTest\n+    @MethodSource\n+    public void test_ErrorReporter(ErrorReporterTestSpec test) {\n+        test.run();\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(strings = {\"message.error-header\", \"message.advice-header\"})\n+    public void test_ErrorReporter_format(String key) {\n+        var str = \"Hello!\";\n+        var msg = I18N.format(key, str);\n+        assertTrue(msg.contains(str));\n+        assertNotEquals(str, msg);\n+    }\n+\n@@ -82,0 +107,67 @@\n+    private static List<ErrorReporterTestSpec> test_ErrorReporter() {\n+        var data = new ArrayList<ErrorReporterTestSpec>();\n+\n+        for (var verbose : List.of(true, false)) {\n+            for (var makeCause : List.<UnaryOperator<Exception>>of(\n+                    ex -> ex,\n+                    \/\/ UncheckedIOException\n+                    ex -> {\n+                        if (ex instanceof IOException ioex) {\n+                            return new UncheckedIOException(ioex);\n+                        } else {\n+                            return null;\n+                        }\n+                    },\n+                    \/\/ ExceptionBox\n+                    ex -> {\n+                        var rex = ExceptionBox.toUnchecked(ex);\n+                        if (rex != ex) {\n+                            return rex;\n+                        } else {\n+                            return null;\n+                        }\n+                    }\n+            )) {\n+                for (var expect : List.of(\n+                        Map.entry(new IOException(\"I\/O error\"), true),\n+                        Map.entry(new NullPointerException(), true),\n+                        Map.entry(new JPackageException(\"Kaput!\"), false),\n+                        Map.entry(new ConfigException(\"It is broken\", \"Fix it!\"), false),\n+                        Map.entry(new ConfigException(\"It is broken. No advice how to fix it\", (String)null), false),\n+                        Map.entry(new Utils.ParseException(\"Malformed command line\"), false),\n+                        Map.entry(new StandardOption.AddLauncherIllegalArgumentException(\"Malformed value of --add-launcher option\"), false)\n+                )) {\n+                    var cause = makeCause.apply(expect.getKey());\n+                    if (cause == null) {\n+                        continue;\n+                    }\n+\n+                    var expectedOutput = new ArrayList<ExceptionFormatter>();\n+                    if (expect.getValue()) {\n+                        \/\/ An alien exception.\n+                        expectedOutput.add(ExceptionFormatter.STACK_TRACE);\n+                        expectedOutput.add(ExceptionFormatter.TO_STRING);\n+                    } else {\n+                        if (verbose) {\n+                            expectedOutput.add(ExceptionFormatter.STACK_TRACE);\n+                        }\n+                        if (expect.getKey() instanceof ConfigException cex) {\n+                            if (cex.getAdvice() != null) {\n+                                expectedOutput.add(ExceptionFormatter.MESSAGE_WITH_ADVICE);\n+                            } else {\n+                                expectedOutput.add(ExceptionFormatter.GET_MESSAGE);\n+                            }\n+                        } else {\n+                            expectedOutput.add(ExceptionFormatter.GET_MESSAGE);\n+                        }\n+                    }\n+\n+                    data.add(new ErrorReporterTestSpec(cause, expect.getKey(), verbose, expectedOutput));\n+                }\n+            }\n+        }\n+\n+        return data;\n+    }\n+\n+\n@@ -244,0 +336,91 @@\n+    private enum ExceptionFormatter {\n+        GET_MESSAGE(errorMessage(Exception::getMessage)),\n+        MESSAGE_WITH_ADVICE(ex -> {\n+            var advice = Objects.requireNonNull(((ConfigException)ex).getAdvice());\n+            var sb = new StringBuilder();\n+            sb.append(GET_MESSAGE.format(ex));\n+            sb.append(I18N.format(\"message.advice-header\", advice));\n+            sb.append(System.lineSeparator());\n+            return sb.toString();\n+        }),\n+        TO_STRING(errorMessage(Exception::toString)),\n+        STACK_TRACE(ex -> {\n+            var sink = new StringWriter();\n+            try (var pw = new PrintWriter(sink)) {\n+                ex.printStackTrace(pw);\n+            }\n+            return sink.toString();\n+        })\n+        ;\n+\n+        ExceptionFormatter(Function<Exception, String> formatter) {\n+            this.formatter = Objects.requireNonNull(formatter);\n+        }\n+\n+        String format(Exception v) {\n+            return formatter.apply(v);\n+        }\n+\n+        private static Function<Exception, String> errorMessage(Function<Exception, String> formatter) {\n+            Objects.requireNonNull(formatter);\n+            return ex -> {\n+                var msg = formatter.apply(ex);\n+                return I18N.format(\"message.error-header\", msg) + System.lineSeparator();\n+            };\n+        }\n+\n+        private final Function<Exception, String> formatter;\n+    }\n+\n+\n+    record ErrorReporterTestSpec(Exception cause, Exception expect, boolean verbose, List<ExceptionFormatter> expectOutput) {\n+\n+        ErrorReporterTestSpec {\n+            Objects.requireNonNull(cause);\n+            Objects.requireNonNull(expect);\n+            Objects.requireNonNull(expectOutput);\n+        }\n+\n+        ErrorReporterTestSpec(Exception cause, boolean verbose, List<ExceptionFormatter> expectOutput) {\n+            this(cause, cause, verbose, expectOutput);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            var tokens = new ArrayList<String>();\n+\n+            if (cause == expect) {\n+                tokens.add(cause.toString());\n+            } else {\n+                tokens.add(String.format(\"[%s] => [%s]\", cause, expect));\n+            }\n+\n+            tokens.add(expectOutput.stream().map(Enum::name).collect(Collectors.joining(\"+\")));\n+\n+            if (verbose) {\n+                tokens.add(\"verbose\");\n+            }\n+\n+            return tokens.stream().collect(Collectors.joining(\"; \"));\n+        }\n+\n+        void run() {\n+            var sink = new StringWriter();\n+\n+            try (var pw = new PrintWriter(sink)) {\n+                new Main.ErrorReporter(t -> {\n+                    t.printStackTrace(pw);\n+                }, msg -> {\n+                    pw.println(msg);\n+                }, verbose).reportError(cause);\n+            }\n+\n+            var expected = expectOutput.stream().map(formatter -> {\n+                return formatter.format(expect);\n+            }).collect(Collectors.joining(\"\"));\n+\n+            assertEquals(expected, sink.toString());\n+        }\n+    }\n+\n+\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/cli\/MainTest.java","additions":183,"deletions":0,"binary":false,"changes":183,"status":"modified"},{"patch":"@@ -163,1 +163,1 @@\n-    Stream<DynamicTest> getTestCasesFromErrorTest() throws Throwable {\n+    Stream<DynamicTest> getTestCasesFromErrorTest() throws Exception {\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/cli\/OptionsValidationFailTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,602 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jpackage.internal.util;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertSame;\n+import static org.junit.jupiter.api.Assertions.assertThrowsExactly;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import jdk.jpackage.internal.util.function.ExceptionBox;\n+import jdk.jpackage.internal.util.function.ThrowingSupplier;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.junit.jupiter.params.provider.ValueSource;\n+\n+public class ResultTest {\n+\n+    @Test\n+    public void test_ctor_with_value() {\n+        var result = new Result<String>(Optional.of(\"foo\"), List.of());\n+\n+        assertTrue(result.hasValue());\n+        assertFalse(result.hasErrors());\n+        assertEquals(Optional.of(\"foo\"), result.value());\n+        assertEquals(List.of(), result.errors());\n+        assertEquals(Optional.empty(), result.firstError());\n+    }\n+\n+    @Test\n+    public void test_ctor_with_errors() {\n+        var ex = new Exception(\"Kaput!\");\n+        var result = new Result<String>(Optional.empty(), List.of(ex));\n+\n+        assertFalse(result.hasValue());\n+        assertTrue(result.hasErrors());\n+        assertEquals(Optional.empty(), result.value());\n+        assertEquals(List.of(ex), result.errors());\n+        assertEquals(Optional.of(ex), result.firstError());\n+    }\n+\n+    @Test\n+    public void test_ctor_invalid_npe() {\n+        assertThrowsExactly(NullPointerException.class, () -> {\n+            new Result<String>(Optional.of(\"foo\"), null);\n+        });\n+\n+        assertThrowsExactly(NullPointerException.class, () -> {\n+            new Result<String>(null, List.of(new Exception()));\n+        });\n+\n+        assertThrowsExactly(NullPointerException.class, () -> {\n+            new Result<String>(null, null);\n+        });\n+    }\n+\n+    @Test\n+    public void test_ctor_invalid_both_empty() {\n+        var ex = assertThrowsExactly(IllegalArgumentException.class, () -> {\n+            new Result<String>(Optional.empty(), List.of());\n+        });\n+        assertEquals(\"'value' and 'errors' cannot both be non-empty or both be empty\", ex.getMessage());\n+    }\n+\n+    @Test\n+    public void test_ctor_invalid_both_non_empty() {\n+        var ex = assertThrowsExactly(IllegalArgumentException.class, () -> {\n+            new Result<String>(Optional.of(\"foo\"), List.of(new Exception()));\n+        });\n+        assertEquals(\"'value' and 'errors' cannot both be non-empty or both be empty\", ex.getMessage());\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_ofValue(boolean valid) {\n+        if (valid) {\n+            assertTrue(Result.ofValue(\"foo\").hasValue());\n+        } else {\n+            assertThrowsExactly(NullPointerException.class, () -> {\n+                Result.ofValue(null);\n+            });\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_ofError(boolean valid) {\n+        if (valid) {\n+            var err = new Exception(\"foo\");\n+            var result = Result.ofError(err);\n+            assertEquals(List.of(err), result.errors());\n+        } else {\n+            assertThrowsExactly(NullPointerException.class, () -> {\n+                Result.ofError(null);\n+            });\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_ofErrors(boolean valid) {\n+        if (valid) {\n+            var errors = List.of(new Exception(\"foo\"), new IllegalArgumentException(\"bar\"));\n+            var result = Result.ofErrors(errors);\n+            assertSame(errors, result.errors());\n+        } else {\n+            assertThrowsExactly(NullPointerException.class, () -> {\n+                Result.ofErrors(null);\n+            });\n+\n+            assertThrowsExactly(NullPointerException.class, () -> {\n+                var errors = new ArrayList<Exception>();\n+                errors.add(new Exception());\n+                errors.add(null);\n+                Result.ofErrors(errors);\n+            });\n+        }\n+    }\n+\n+    @Test\n+    public void test_of() {\n+        assertEquals(\"foo\", Result.<String>of(() -> {\n+            return \"foo\";\n+        }).orElseThrow());\n+    }\n+\n+    @Test\n+    public void test_of_null_value() {\n+        assertThrowsExactly(NullPointerException.class, () -> {\n+            Result.<String>of(() -> {\n+                return null;\n+            });\n+        });\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_of_throws(boolean declaredExceptionType) {\n+\n+        Exception cause;\n+        if (declaredExceptionType) {\n+            cause = new IOException(\"foo\");\n+        } else {\n+            cause = new UnsupportedOperationException(\"bar\");\n+        }\n+\n+        ThrowingSupplier<String, IOException> supplier = () -> {\n+            if (declaredExceptionType) {\n+                throw (IOException)cause;\n+            } else {\n+                throw (UnsupportedOperationException)cause;\n+            }\n+        };\n+\n+        if (declaredExceptionType) {\n+            var result = Result.<String, IOException>of(supplier, IOException.class);\n+            assertSame(cause, result.firstError().orElseThrow());\n+            assertEquals(1, result.errors().size());\n+        } else {\n+            var ex = assertThrowsExactly(cause.getClass(), () -> {\n+                Result.<String, IOException>of(supplier, IOException.class);\n+            });\n+            assertSame(cause, ex);\n+        }\n+    }\n+\n+    @Test\n+    public void test_orElseThrow_hasValue() {\n+        assertEquals(\"foo\", Result.ofValue(\"foo\").orElseThrow());\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_orElseThrow(boolean uncheckedException) {\n+        Exception ex;\n+        Class<? extends Exception> expectedType;\n+        if (uncheckedException) {\n+            ex = new RuntimeException(\"Kaput!\");\n+            expectedType = ex.getClass();\n+        } else {\n+            ex = new Exception(\"Kaput!\");\n+            expectedType = ExceptionBox.class;\n+        }\n+\n+        var actual = assertThrowsExactly(expectedType, Result.ofError(ex)::orElseThrow);\n+\n+        if (uncheckedException) {\n+            assertSame(ex, actual);\n+        } else {\n+            assertSame(ex, actual.getCause());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource\n+    public void test_map_and_flatMap(MapTestSpec spec) {\n+        spec.run();\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_peekValue(boolean hasValue) {\n+        var pickedValue = Slot.<String>createEmpty();\n+\n+        Consumer<String> consumer = v -> {\n+            assertNotNull(v);\n+            assertTrue(pickedValue.find().isEmpty());\n+            pickedValue.set(v);\n+        };\n+\n+        Result<String> result;\n+        if (hasValue) {\n+            result = Result.ofValue(\"foo\");\n+        } else {\n+            result = Result.ofError(new Exception(\"foo\"));\n+        }\n+        result.peekValue(consumer);\n+\n+        if (hasValue) {\n+            assertEquals(\"foo\", pickedValue.get());\n+        } else {\n+            assertTrue(pickedValue.find().isEmpty());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_peekErrors(boolean hasValue) {\n+        var pickedErrors = Slot.<Collection<? extends Exception>>createEmpty();\n+\n+        Consumer<Collection<? extends Exception>> consumer = v -> {\n+            assertNotNull(v);\n+            assertTrue(pickedErrors.find().isEmpty());\n+            pickedErrors.set(v);\n+        };\n+\n+        Result<String> result;\n+        if (hasValue) {\n+            result = Result.ofValue(\"foo\");\n+        } else {\n+            result = Result.ofErrors(List.of(new Exception(\"foo\"), new IOException(\"bar\")));\n+        }\n+        result.peekErrors(consumer);\n+\n+        if (hasValue) {\n+            assertTrue(pickedErrors.find().isEmpty());\n+        } else {\n+            assertSame(result.errors(), pickedErrors.get());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_mapErrors(boolean hasValue) {\n+        Result<String> result;\n+        if (hasValue) {\n+            result = Result.ofValue(\"foo\");\n+        } else {\n+            result = Result.ofErrors(List.of(new Exception(\"foo\"), new IOException(\"bar\")));\n+        }\n+\n+        if (hasValue) {\n+            var ex = assertThrowsExactly(IllegalStateException.class, result::mapErrors);\n+            assertEquals(\"Can not map errors from a result without errors\", ex.getMessage());\n+        } else {\n+            assertSame(result, result.mapErrors());\n+        }\n+    }\n+\n+    @Test\n+    public void test_allHaveValues_empty() {\n+        assertTrue(Result.allHaveValues());\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_allHaveValues(boolean expected) {\n+        if (expected) {\n+            assertTrue(Result.allHaveValues(Result.ofValue(\"foo\"), Result.ofValue(37)));\n+        } else {\n+            assertFalse(Result.allHaveValues(Result.ofValue(\"foo\"), Result.ofError(new Exception())));\n+        }\n+    }\n+\n+    enum MapFunctionType {\n+        MAP,\n+        FLAT_MAP,\n+        ;\n+    }\n+\n+    enum MapFunctionOutcome {\n+        RETURN_NON_NULL,\n+        RETURN_NULL,\n+        THROW,\n+        FLAT_MAP_NEW_ERRORS(MapFunctionType.FLAT_MAP),\n+        ;\n+\n+        MapFunctionOutcome(MapFunctionType... supportedTypes) {\n+            this.supportedTypes = Set.of(supportedTypes);\n+        }\n+\n+        MapFunctionOutcome() {\n+            this(MapFunctionType.values());\n+        }\n+\n+        private final Set<MapFunctionType> supportedTypes;\n+    }\n+\n+    record MapTestSpec(boolean hasValue, MapFunctionOutcome outcome, MapFunctionType type) {\n+        MapTestSpec {\n+            Objects.requireNonNull(outcome);\n+            Objects.requireNonNull(type);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            var tokens = new ArrayList<String>();\n+            tokens.add(outcome.name());\n+            if (type == MapFunctionType.FLAT_MAP) {\n+                tokens.add(\"flatMap\");\n+            }\n+            if (!hasValue) {\n+                tokens.add(\"no-value\");\n+            }\n+            return String.join(\", \", tokens);\n+        }\n+\n+        void run() {\n+            var builder = MapTest.<Integer, String>build();\n+            if (hasValue) {\n+                builder.initialValue(100);\n+            }\n+\n+            Function<Integer, String> plainMapper;\n+            switch (outcome) {\n+                case RETURN_NON_NULL -> {\n+                    if (hasValue) {\n+                        builder.expectValue(\"200\");\n+                    }\n+                    plainMapper = v -> {\n+                        return String.valueOf(v * 2);\n+                    };\n+                }\n+                case RETURN_NULL -> {\n+                    builder.expectExceptionOfType(NullPointerException.class);\n+                    plainMapper = _ -> {\n+                        return null;\n+                    };\n+                }\n+                case THROW -> {\n+                    var cause = new UnsupportedOperationException(\"Unsupported\");\n+                    builder.expectException(cause);\n+                    plainMapper = _ -> {\n+                        throw cause;\n+                    };\n+                }\n+                case FLAT_MAP_NEW_ERRORS -> {\n+                    if (hasValue) {\n+                        \/\/ Just a stub to make `builder.create()` pass.\n+                        builder.expectValue(\"\");\n+                    }\n+                    var mappedResult = Result.<String>ofError(new UnsupportedOperationException(\"Whoopsy-daisy\"));\n+                    var test = builder.create().copyWithMappedValue(mappedResult);\n+                    test.flatMap(v -> {\n+                        return mappedResult;\n+                    });\n+                    return;\n+                }\n+                default -> {\n+                    throw ExceptionBox.reachedUnreachable();\n+                }\n+            }\n+\n+            var test = builder.create();\n+\n+            switch (type) {\n+                case MAP -> {\n+                    test.map(plainMapper);\n+                }\n+                case FLAT_MAP -> {\n+                    test.flatMap(v -> {\n+                        return Optional.ofNullable(plainMapper.apply(v)).map(Result::ofValue).orElse(null);\n+                    });\n+                }\n+            }\n+        }\n+    }\n+\n+    private static List<MapTestSpec> test_map_and_flatMap() {\n+        var data = new ArrayList<MapTestSpec>();\n+        for (var type : MapFunctionType.values()) {\n+            for (var outcome : MapFunctionOutcome.values()) {\n+                if (outcome.supportedTypes.contains(type)) {\n+                    for (var hasValue : List.of(true, false)) {\n+                        data.add(new MapTestSpec(hasValue, outcome, type));\n+                    }\n+                }\n+            }\n+        }\n+        return data;\n+    }\n+\n+    private static final class Counter<T, U> implements Function<T, U> {\n+\n+        Counter(Function<T, U> impl) {\n+            this.impl = Objects.requireNonNull(impl);\n+        }\n+\n+        @Override\n+        public U apply(T v) {\n+            counter++;\n+            return impl.apply(v);\n+        }\n+\n+        int count() {\n+            return counter;\n+        }\n+\n+        private int counter;\n+        private final Function<T, U> impl;\n+    }\n+\n+    private record MapTest<T, U>(\n+            Result<T> initialValue,\n+            Optional<Result<U>> mappedValue,\n+            Optional<Exception> expectedException,\n+            Optional<Class<? extends Exception>> expectedExceptionType) {\n+\n+        MapTest {\n+            Objects.requireNonNull(initialValue);\n+            Objects.requireNonNull(mappedValue);\n+            Objects.requireNonNull(expectedException);\n+            Objects.requireNonNull(expectedExceptionType);\n+\n+            if (expectedExceptionType.isPresent() && mappedValue.isPresent()) {\n+                \/\/ Bad configuration: the mapping operation is expected to throw,\n+                \/\/ but it also expects it to return a value.\n+                throw new IllegalArgumentException();\n+            }\n+\n+            if (expectedExceptionType.isEmpty() && mappedValue.isEmpty()) {\n+                \/\/ Bad configuration: the mapping operation is expected to return normally (not to throw),\n+                \/\/ but it also doesn't expect a mapped value.\n+                throw new IllegalArgumentException();\n+            }\n+\n+            if (initialValue.hasErrors() && mappedValue.map(Result::hasValue).orElse(false)) {\n+                \/\/ Bad configuration: the initial value has errors but they expect a mapped value without errors.\n+                throw new IllegalArgumentException();\n+            }\n+\n+            expectedException.map(Object::getClass).ifPresent(expectedExpectedExceptionType -> {\n+                var configuredExpectedExceptionType = expectedExceptionType.orElseThrow();\n+                if (!configuredExpectedExceptionType.equals(expectedExpectedExceptionType)) {\n+                    throw new IllegalArgumentException(String.format(\n+                            \"expectedException=%s; expectedExceptionType=%s\",\n+                            expectedExpectedExceptionType, configuredExpectedExceptionType));\n+                }\n+            });\n+        }\n+\n+        MapTest<T, U> copyWithMappedValue(Result<U> v) {\n+            return new MapTest<>(initialValue, Optional.of(v), expectedException, expectedExceptionType);\n+        }\n+\n+        static <T, U> Builder<T, U> build() {\n+            return new Builder<>();\n+        }\n+\n+        void map(Function<T, U> mapper) {\n+            map(new Counter<>(mapper), initialValue::map);\n+        }\n+\n+        void flatMap(Function<T, Result<U>> mapper) {\n+            map(new Counter<>(mapper), initialValue::flatMap);\n+        }\n+\n+        private <V> void map(Counter<T, V> countingMapper, Function<Counter<T, V>, Result<U>> mapper) {\n+\n+            if (initialValue.hasErrors()) {\n+                Result<U> mapped = mapper.apply(countingMapper);\n+                assertTrue(mapped.hasErrors());\n+                assertEquals(initialValue.errors(), mapped.errors());\n+            } else {\n+                expectedExceptionType.ifPresentOrElse(theExpectedExceptionType -> {\n+                    var ex = assertThrowsExactly(theExpectedExceptionType, () -> {\n+                        initialValue.map(countingMapper);\n+                    });\n+\n+                    expectedException.ifPresent(theExpectedException -> {\n+                        assertSame(theExpectedException, ex);\n+                    });\n+                }, () -> {\n+                    Result<U> mapped = mapper.apply(countingMapper);\n+                    assertEquals(mappedValue.orElseThrow(), mapped);\n+                });\n+            }\n+\n+            if (initialValue.hasValue()) {\n+                assertEquals(1, countingMapper.count());\n+            } else {\n+                assertEquals(0, countingMapper.count());\n+            }\n+        }\n+\n+        static final class Builder<T, U> {\n+\n+            MapTest<T, U> create() {\n+\n+                var theInitialValue = Optional.ofNullable(initialValue).orElseGet(() -> {\n+                    return Result.ofError(new Exception(\"Kaput!\"));\n+                });\n+\n+                return new MapTest<>(\n+                        theInitialValue,\n+                        Optional.ofNullable(expectedValue).map(Result::ofValue).or(() -> {\n+                            if (expectedExceptionType == null) {\n+                                return Optional.of(theInitialValue.mapErrors());\n+                            } else {\n+                                return Optional.empty();\n+                            }\n+                        }),\n+                        Optional.ofNullable(expectedException),\n+                        Optional.ofNullable(expectedExceptionType));\n+            }\n+\n+            Builder<T, U> initialValue(Result<T> v) {\n+                initialValue = v;\n+                return this;\n+            }\n+\n+            Builder<T, U> initialValue(T v) {\n+                return initialValue(Result.ofValue(v));\n+            }\n+\n+            Builder<T, U> expectException(Exception v) {\n+                expectedException = v;\n+                if (expectedException != null) {\n+                    expectedExceptionType = expectedException.getClass();\n+                    expectValue(null);\n+                } else {\n+                    expectedExceptionType = null;\n+                }\n+                return this;\n+            }\n+\n+            Builder<T, U> expectExceptionOfType(Class<? extends Exception> v) {\n+                expectedException = null;\n+                expectedExceptionType = v;\n+                if (v != null) {\n+                    expectValue(null);\n+                }\n+                return this;\n+            }\n+\n+            Builder<T, U> expectValue(U v) {\n+                expectedValue = v;\n+                if (v != null) {\n+                    expectException(null);\n+                }\n+                return this;\n+            }\n+\n+            private Result<T> initialValue;\n+            private U expectedValue;\n+            private Exception expectedException;\n+            private Class<? extends Exception> expectedExceptionType;\n+        }\n+    }\n+}\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/util\/ResultTest.java","additions":602,"deletions":0,"binary":false,"changes":602,"status":"added"},{"patch":"@@ -0,0 +1,246 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jpackage.internal.util.function;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertSame;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertThrowsExactly;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.util.Objects;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.UnaryOperator;\n+import jdk.jpackage.internal.util.Slot;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.EnumSource;\n+\n+public class ExceptionBoxTest {\n+\n+    @Test\n+    public void test_unbox_RuntimeException() {\n+        var ex = new RuntimeException();\n+        assertSame(ex, ExceptionBox.unbox(ex));\n+    }\n+\n+    @Test\n+    public void test_unbox_Exception() {\n+        var ex = new Exception();\n+        assertSame(ex, ExceptionBox.unbox(ex));\n+    }\n+\n+    @Test\n+    public void test_unbox_InvocationTargetException() {\n+        var ex = new Exception();\n+        assertSame(ex, ExceptionBox.unbox(new InvocationTargetException(ex)));\n+    }\n+\n+    @Test\n+    public void test_unbox_ExceptionBox() {\n+        var ex = new Exception(\"foo\");\n+        \/\/ There is no way to directly instantiate ExceptionBox, use a workaround.\n+        var box = assertThrowsExactly(ExceptionBox.class, () -> {\n+            throw ExceptionBox.toUnchecked(ex);\n+        });\n+        assertSame(ex, ExceptionBox.unbox(box));\n+    }\n+\n+    @Test\n+    public void test_unbox_Error() {\n+        var err = new Error(\"On Fire!\");\n+        var thrown = assertThrowsExactly(Error.class, () -> {\n+            ExceptionBox.unbox(err);\n+        });\n+        assertSame(err, thrown);\n+    }\n+\n+    @Test\n+    public void test_reachedUnreachable() {\n+        var err = ExceptionBox.reachedUnreachable();\n+        assertEquals(\"Reached unreachable!\", err.getMessage());\n+    }\n+\n+    @Test\n+    public void test_toUnchecked_RuntimeException() {\n+        assertToUnchecked(new RuntimeException(), true);\n+    }\n+\n+    @Test\n+    public void test_toUnchecked_Exception() {\n+        assertToUnchecked(new Exception(), false);\n+    }\n+\n+    @Test\n+    public void test_toUnchecked_ExceptionBox() {\n+        \/\/ There is no way to directly instantiate ExceptionBox, use a workaround.\n+        var box = assertThrowsExactly(ExceptionBox.class, () -> {\n+            throw ExceptionBox.toUnchecked(new Exception(\"foo\"));\n+        });\n+        assertToUnchecked(box, true);\n+    }\n+\n+    @Test\n+    public void test_toUnchecked_InterruptedException() throws InterruptedException {\n+\n+        var workerThreadReadyToWait = Slot.<Boolean>createEmpty();\n+\n+        var workerThreadInterruptedExceptionCaught = Slot.<Boolean>createEmpty();\n+\n+        var workerThreadException = new AtomicReference<Throwable>();\n+\n+        var thread = Thread.ofVirtual().uncaughtExceptionHandler((Thread _, Throwable e) -> {\n+            trace(\"unexpected exception: %s\", e);\n+            workerThreadException.set(e);\n+        }).start(() -> {\n+            try {\n+                var lock = new Object();\n+                synchronized (lock) {\n+                    synchronized (workerThreadReadyToWait) {\n+                        workerThreadReadyToWait.set(true);\n+                        workerThreadReadyToWait.notify();\n+                    }\n+                    trace(\"wait\");\n+                    lock.wait();\n+                }\n+            } catch (InterruptedException iex) {\n+                trace(\"interrupted state cleared\");\n+                synchronized (workerThreadInterruptedExceptionCaught) {\n+                    workerThreadInterruptedExceptionCaught.set(true);\n+                    trace(\"notify about to interrupt itself\");\n+                    workerThreadInterruptedExceptionCaught.notify();\n+                }\n+                trace(\"before toUnchecked()\");\n+                var box = assertThrowsExactly(ExceptionBox.class, () -> {\n+                    throw ExceptionBox.toUnchecked(iex);\n+                });\n+                assertSame(iex, box.getCause());\n+            }\n+        });\n+\n+        \/\/ Wait until the worker thread gets to the point\n+        \/\/ when interrupting it will cause InterruptedException.\n+        synchronized (workerThreadReadyToWait) {\n+            while (workerThreadReadyToWait.find().isEmpty()) {\n+                workerThreadReadyToWait.wait();\n+            }\n+        }\n+\n+        trace(\"interrupt %s\", thread);\n+        thread.interrupt();\n+\n+        \/\/ Wait until the worker thread catches an InterruptedException.\n+        synchronized (workerThreadInterruptedExceptionCaught) {\n+            while (workerThreadInterruptedExceptionCaught.find().isEmpty()) {\n+                trace(\"wait for %s to catch InterruptedException\", thread);\n+                workerThreadInterruptedExceptionCaught.wait();\n+            }\n+        }\n+\n+        \/\/ Block waiting when ExceptionBox.toUnchecked()\n+        \/\/ called in the worker thread will interrupt the worker thread.\n+        while (!thread.isInterrupted()) {\n+            trace(\"wait %s is interrupted\", thread);\n+            Thread.sleep(100);\n+        }\n+\n+        trace(\"join interrupted %s\", thread);\n+        thread.join();\n+\n+        assertNull(workerThreadException.get());\n+    }\n+\n+    @ParameterizedTest\n+    @EnumSource(InvocationTargetExceptionType.class)\n+    public void test_rethrowUnchecked_InvocationTargetException(InvocationTargetExceptionType type)\n+            throws NoSuchMethodException, SecurityException, IllegalAccessException {\n+\n+        var m = ExceptionBoxTest.class.getMethod(type.methodName);\n+\n+        try {\n+            m.invoke(null);\n+        } catch (InvocationTargetException ex) {\n+            var cause = assertThrows(type.expectedThrownType, () -> {\n+                throw ExceptionBox.toUnchecked(ex);\n+            });\n+            assertSame(ex.getCause(), type.expectedThrowableGetter.apply(cause));\n+        }\n+    }\n+\n+    public enum InvocationTargetExceptionType {\n+        CHECKED(\"throwIOException\", t -> {\n+            return t.getCause();\n+        }, ExceptionBox.class),\n+        UNCHECKED(\"throwNPE\", x -> x, RuntimeException.class),\n+        ERROR(\"throwError\", x -> x, Error.class),\n+        ;\n+\n+        InvocationTargetExceptionType(\n+                String methodName,\n+                UnaryOperator<Throwable> expectedThrowableGetter,\n+                Class<? extends Throwable> expectedThrownType) {\n+            this.methodName = Objects.requireNonNull(methodName);\n+            this.expectedThrownType = Objects.requireNonNull(expectedThrownType);\n+            this.expectedThrowableGetter = Objects.requireNonNull(expectedThrowableGetter);\n+        }\n+\n+        final String methodName;\n+        final Class<? extends Throwable> expectedThrownType;\n+        final UnaryOperator<Throwable> expectedThrowableGetter;\n+    }\n+\n+    public static void throwIOException() throws IOException {\n+        throw new IOException(\"foo\");\n+    }\n+\n+    public static void throwNPE() {\n+        throw new NullPointerException(\"foo\");\n+    }\n+\n+    public static void throwError() {\n+        throw new Error(\"Kaput!\");\n+    }\n+\n+    private static void assertToUnchecked(Exception cause, boolean asis) {\n+        Class<? extends Throwable> expectedType;\n+        if (asis) {\n+            expectedType = cause.getClass();\n+        } else {\n+            expectedType = ExceptionBox.class;\n+        }\n+        var unchecked = ExceptionBox.toUnchecked(cause);\n+        if (asis) {\n+            assertSame(cause, unchecked);\n+        } else {\n+            assertSame(cause, unchecked.getCause());\n+        }\n+    }\n+\n+    private void trace(String format, Object... args) {\n+        Objects.requireNonNull(format);\n+        System.out.println(String.format(\"[%s]: %s\", Thread.currentThread(), String.format(format, args)));\n+    }\n+}\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/util\/function\/ExceptionBoxTest.java","additions":246,"deletions":0,"binary":false,"changes":246,"status":"added"},{"patch":"@@ -0,0 +1,189 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.jpackage.internal.util.function;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrowsExactly;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.util.Map;\n+import java.util.function.Supplier;\n+import jdk.jpackage.internal.util.Slot;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.ValueSource;\n+\n+public class FunctionalTest {\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_toRunnable(boolean error) {\n+        var reply = Slot.<Integer>createEmpty();\n+\n+        var runnable = ThrowingRunnable.toRunnable(() -> {\n+            if (error) {\n+                throw new Exception();\n+            } else {\n+                reply.set(135);\n+            }\n+        });\n+\n+        if (error) {\n+            assertThrowsExactly(ExceptionBox.class, runnable::run);\n+            assertTrue(reply.find().isEmpty());\n+        } else {\n+            runnable.run();\n+            assertEquals(135, reply.get());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_toSupplier(boolean error) {\n+        var supplier = ThrowingSupplier.<Integer>toSupplier(() -> {\n+            if (error) {\n+                throw new Exception();\n+            } else {\n+                return 135;\n+            }\n+        });\n+\n+        if (error) {\n+            assertThrowsExactly(ExceptionBox.class, supplier::get);\n+        } else {\n+            assertEquals(135, supplier.get());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_toConsumer(boolean error) {\n+        var reply = Slot.<Integer>createEmpty();\n+\n+        Runnable runnable = () -> {\n+            ThrowingConsumer.<Integer>toConsumer(v -> {\n+                if (error) {\n+                    throw new Exception();\n+                } else {\n+                    reply.set(v);\n+                }\n+            }).accept(135);\n+        };\n+\n+        if (error) {\n+            assertThrowsExactly(ExceptionBox.class, runnable::run);\n+            assertTrue(reply.find().isEmpty());\n+        } else {\n+            runnable.run();\n+            assertEquals(135, reply.get());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_toBiConsumer(boolean error) {\n+        var reply = Slot.<Integer>createEmpty();\n+        var reply2 = Slot.<String>createEmpty();\n+\n+        Runnable runnable = () -> {\n+            ThrowingBiConsumer.<Integer, String>toBiConsumer((x, y) -> {\n+                if (error) {\n+                    throw new Exception();\n+                } else {\n+                    reply.set(x);\n+                    reply2.set(y);\n+                }\n+            }).accept(456, \"Hello\");\n+        };\n+\n+        if (error) {\n+            assertThrowsExactly(ExceptionBox.class, runnable::run);\n+            assertTrue(reply.find().isEmpty());\n+            assertTrue(reply2.find().isEmpty());\n+        } else {\n+            runnable.run();\n+            assertEquals(456, reply.get());\n+            assertEquals(\"Hello\", reply2.get());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_toFunction(boolean error) {\n+        Supplier<String> supplier = () -> {\n+            return ThrowingFunction.<Integer, String>toFunction(v -> {\n+                if (error) {\n+                    throw new Exception();\n+                } else {\n+                    return String.valueOf(v);\n+                }\n+            }).apply(765);\n+        };\n+\n+        if (error) {\n+            assertThrowsExactly(ExceptionBox.class, supplier::get);\n+        } else {\n+            assertEquals(\"765\", supplier.get());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_toBiFunction(boolean error) {\n+        Supplier< Map.Entry<String, Integer>> supplier = () -> {\n+            return ThrowingBiFunction.<Integer, String, Map.Entry<String, Integer>>toBiFunction((x, y) -> {\n+                if (error) {\n+                    throw new Exception();\n+                } else {\n+                    return Map.entry(y, x + 23);\n+                }\n+            }).apply(400, \"foo\");\n+        };\n+\n+        if (error) {\n+            assertThrowsExactly(ExceptionBox.class, supplier::get);\n+        } else {\n+            assertEquals(Map.entry(\"foo\", 423), supplier.get());\n+        }\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(booleans = {true, false})\n+    public void test_toUnaryOperator(boolean error) {\n+        Supplier<Integer> supplier = () -> {\n+            return ThrowingUnaryOperator.<Integer>toUnaryOperator(v -> {\n+                if (error) {\n+                    throw new Exception();\n+                } else {\n+                    return v - 222;\n+                }\n+            }).apply(777);\n+        };\n+\n+        if (error) {\n+            assertThrowsExactly(ExceptionBox.class, supplier::get);\n+        } else {\n+            assertEquals(555, supplier.get());\n+        }\n+    }\n+}\n","filename":"test\/jdk\/tools\/jpackage\/junit\/share\/jdk.jpackage\/jdk\/jpackage\/internal\/util\/function\/FunctionalTest.java","additions":189,"deletions":0,"binary":false,"changes":189,"status":"added"},{"patch":"@@ -52,1 +52,1 @@\n-    public static Stream<DynamicTest> createJPackageTests(ClassLoader testClassLoader, String... args) throws Throwable {\n+    public static Stream<DynamicTest> createJPackageTests(ClassLoader testClassLoader, String... args) throws Exception {\n@@ -67,1 +67,1 @@\n-    Stream<DynamicTest> createJPackageTests() throws Throwable {\n+    Stream<DynamicTest> createJPackageTests() throws Exception {\n@@ -71,1 +71,1 @@\n-    static List<String> captureJPackageTestLog(ThrowingRunnable runnable) {\n+    static List<String> captureJPackageTestLog(ThrowingRunnable<? extends Exception> runnable) {\n","filename":"test\/jdk\/tools\/jpackage\/junit\/tools\/jdk\/jpackage\/test\/JUnitAdapter.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,1 +85,1 @@\n-    private static void runTest(ThrowingConsumer<JPackageCommand> initializer,\n+    private static void runTest(ThrowingConsumer<JPackageCommand, ? extends Exception> initializer,\n","filename":"test\/jdk\/tools\/jpackage\/linux\/AppAboutUrlTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -26,1 +26,0 @@\n-import jdk.jpackage.internal.util.Slot;\n@@ -55,0 +54,1 @@\n+import jdk.jpackage.internal.util.Slot;\n@@ -87,1 +87,1 @@\n-    public void testAppImage(TestConfig cfg) throws Throwable {\n+    public void testAppImage(TestConfig cfg) {\n@@ -257,0 +257,4 @@\n+                        \/\/ Ignore externally configured runtime if any.\n+                        \/\/ It may or may not have the \"bin\" directory, it also can be a bundle.\n+                        \/\/ These factors affect the runtime plist file (see JDK-8363980) which may not be the default one.\n+                        .ignoreDefaultRuntime(true)\n@@ -323,2 +327,2 @@\n-                ThrowingBiConsumer<JPackageCommand, XMLStreamWriter> inputPlistWriter,\n-                ThrowingBiConsumer<JPackageCommand, XMLStreamWriter> outputPlistWriter,\n+                ThrowingBiConsumer<JPackageCommand, XMLStreamWriter, ? extends Exception> inputPlistWriter,\n+                ThrowingBiConsumer<JPackageCommand, XMLStreamWriter, ? extends Exception> outputPlistWriter,\n","filename":"test\/jdk\/tools\/jpackage\/macosx\/CustomInfoPListTest.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -102,1 +102,1 @@\n-        EntitlementsSource(ThrowingConsumer<JPackageCommand> initializer) {\n+        EntitlementsSource(ThrowingConsumer<JPackageCommand, ? extends Exception> initializer) {\n","filename":"test\/jdk\/tools\/jpackage\/macosx\/EntitlementsTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,1 +40,0 @@\n-import java.util.Map;\n@@ -634,1 +633,1 @@\n-        FileContentFactory(ThrowingSupplier<Path> factory, Path pathInAppContentRoot) {\n+        FileContentFactory(ThrowingSupplier<Path, IOException> factory, Path pathInAppContentRoot) {\n","filename":"test\/jdk\/tools\/jpackage\/share\/AppContentTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+import jdk.jpackage.internal.util.Slot;\n@@ -64,1 +65,1 @@\n-    public void test() throws Throwable {\n+    public void test() throws Exception {\n@@ -97,1 +98,1 @@\n-            Throwable[] fatalError = new Throwable[1];\n+            var fatalError = Slot.<Exception>createEmpty();\n@@ -105,3 +106,1 @@\n-                result.throwable().filter(Predicate.not(TKit::isSkippedException)).ifPresent(t -> {\n-                    fatalError[0] = t;\n-                });\n+                result.exception().filter(Predicate.not(TKit::isSkippedException)).ifPresent(fatalError::set);\n@@ -110,2 +109,2 @@\n-            if (fatalError[0] != null) {\n-                throw fatalError[0];\n+            if (fatalError.find().isPresent()) {\n+                throw fatalError.get();\n@@ -146,1 +145,1 @@\n-    private record Result(String stdoutBuffer, String stderrBuffer, String id, Optional<Throwable> throwable) {\n+    private record Result(String stdoutBuffer, String stderrBuffer, String id, Optional<Exception> exception) {\n@@ -152,1 +151,1 @@\n-            Objects.requireNonNull(throwable);\n+            Objects.requireNonNull(exception);\n@@ -160,1 +159,1 @@\n-            ThrowingRunnable runnable,\n+            ThrowingRunnable<? extends Exception> runnable,\n@@ -170,1 +169,1 @@\n-        Workload(ThrowingRunnable runnable, String id) {\n+        Workload(ThrowingRunnable<? extends Exception> runnable, String id) {\n@@ -205,1 +204,1 @@\n-            Optional<Throwable> err = Optional.empty();\n+            Optional<Exception> err = Optional.empty();\n@@ -211,2 +210,2 @@\n-            } catch (Throwable t) {\n-                err = Optional.of(t);\n+            } catch (Exception ex) {\n+                err = Optional.of(ex);\n","filename":"test\/jdk\/tools\/jpackage\/share\/AsyncTest.java","additions":13,"deletions":14,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -310,1 +310,1 @@\n-    public void testNoOutputDir(boolean appImage) throws Throwable {\n+    public void testNoOutputDir(boolean appImage) throws IOException {\n@@ -315,1 +315,1 @@\n-        final ThrowingConsumer<JPackageCommand> initializer = cmdNoOutputDir -> {\n+        final ThrowingConsumer<JPackageCommand, IOException> initializer = cmdNoOutputDir -> {\n","filename":"test\/jdk\/tools\/jpackage\/share\/BasicTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -206,1 +206,1 @@\n-    private ThrowingBiConsumer<JPackageCommand, Executor.Result> createBundleVerifier() {\n+    private ThrowingBiConsumer<JPackageCommand, Executor.Result, IOException> createBundleVerifier() {\n@@ -279,1 +279,1 @@\n-    private ThrowingConsumer<JPackageCommand> createInstallVerifier() {\n+    private ThrowingConsumer<JPackageCommand, IOException> createInstallVerifier() {\n","filename":"test\/jdk\/tools\/jpackage\/share\/IconTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -24,0 +24,2 @@\n+import static jdk.jpackage.test.RunnablePackageTest.Action.CREATE_AND_UNPACK;\n+\n@@ -34,3 +36,1 @@\n-import jdk.jpackage.test.AppImageFile;\n-import jdk.jpackage.test.ApplicationLayout;\n-import jdk.jpackage.test.PackageFile;\n+import jdk.jpackage.internal.util.function.ThrowingConsumer;\n@@ -39,1 +39,2 @@\n-import jdk.jpackage.internal.util.function.ThrowingConsumer;\n+import jdk.jpackage.test.AppImageFile;\n+import jdk.jpackage.test.ApplicationLayout;\n@@ -42,0 +43,1 @@\n+import jdk.jpackage.test.PackageFile;\n@@ -44,1 +46,0 @@\n-import static jdk.jpackage.test.RunnablePackageTest.Action.CREATE_AND_UNPACK;\n@@ -148,1 +149,1 @@\n-    public void test() throws Throwable {\n+    public void test() throws Exception {\n@@ -152,1 +153,1 @@\n-    private static Envelope wrap(ThrowingConsumer<JPackageCommand> v, String label) {\n+    private static Envelope wrap(ThrowingConsumer<JPackageCommand, ? extends Exception> v, String label) {\n@@ -161,2 +162,2 @@\n-            ThrowingConsumer<JPackageCommand> configure) throws Throwable {\n-        ThrowingConsumer<JPackageCommand> configureWrapper = cmd -> {\n+            ThrowingConsumer<JPackageCommand, ? extends Exception> configure) throws Exception {\n+        ThrowingConsumer<JPackageCommand, Exception> configureWrapper = cmd -> {\n@@ -271,1 +272,1 @@\n-    private static final record Envelope(ThrowingConsumer<JPackageCommand> value, String label) {\n+    private static final record Envelope(ThrowingConsumer<JPackageCommand, ? extends Exception> value, String label) {\n@@ -294,1 +295,1 @@\n-    private final ThrowingConsumer<JPackageCommand> configure;\n+    private final ThrowingConsumer<JPackageCommand, ? extends Exception> configure;\n","filename":"test\/jdk\/tools\/jpackage\/share\/InOutPathTest.java","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -161,2 +161,2 @@\n-            Path outputCfgFileDir, ThrowingConsumer<JPackageCommand> action) throws\n-            Throwable {\n+            Path outputCfgFileDir, ThrowingConsumer<JPackageCommand, ? extends Exception> action) throws\n+            Exception {\n","filename":"test\/jdk\/tools\/jpackage\/share\/PerUserCfgTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-import jdk.jpackage.internal.util.function.ThrowingSupplier;\n+import java.util.function.Supplier;\n@@ -117,1 +117,1 @@\n-    private static PackageTest init(ThrowingSupplier<Path> createRuntime) {\n+    private static PackageTest init(Supplier<Path> createRuntime) {\n","filename":"test\/jdk\/tools\/jpackage\/share\/RuntimePackageTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -112,1 +112,1 @@\n-    public void test() throws Throwable {\n+    public void test() {\n@@ -120,1 +120,1 @@\n-    public void testUpdate() throws Throwable {\n+    public void testUpdate() {\n","filename":"test\/jdk\/tools\/jpackage\/share\/ServiceTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -588,0 +588,1 @@\n+            Path pathWithDirectories = compiler.getPath(\"what\/ever\/testSave.repl\");\n@@ -596,1 +597,2 @@\n-                    (a) -> assertCommand(a, \"\/save \" + path.toString(), \"\")\n+                    (a) -> assertCommand(a, \"\/save \" + path.toString(), \"\"),\n+                    (a) -> assertCommand(a, \"\/save \" + pathWithDirectories.toString(), \"\")\n@@ -599,0 +601,1 @@\n+            assertEquals(list, Files.readAllLines(pathWithDirectories));\n","filename":"test\/langtools\/jdk\/jshell\/ToolBasicTest.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -0,0 +1,72 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @bug 8373570\n+ * @summary Javac stack overflow on method-local class with nested record referring to enclosing type\n+ * @compile\/fail\/ref=NewLocalNotInInner.out -XDrawDiagnostics NewLocalNotInInner.java\n+ *\/\n+class NewLocalNotInInner {\n+    void m() {\n+        class Local {\n+            static class Foo {\n+                void m() {\n+                    new Local(); \/\/ error\n+                }\n+            }\n+        }\n+    }\n+\n+    void m_anon() {\n+        class Local {\n+            static class Foo {\n+                void m() {\n+                    new Local() { }; \/\/ error\n+                }\n+            }\n+        }\n+    }\n+\n+    void m_record() {\n+        class Local {\n+            record Foo() {\n+                void m() {\n+                    new Local(); \/\/ error\n+                }\n+            }\n+        }\n+    }\n+\n+    void m_intf() {\n+        class Local {\n+            interface Foo {\n+                default void m() {\n+                    new Local(); \/\/ error\n+                }\n+            }\n+        }\n+    }\n+\n+    void sup() {\n+        class Local {\n+            static class Foo {\n+                void m() {\n+                    class Sub extends Local { }; \/\/ error\n+                    new Sub();\n+                }\n+            }\n+        }\n+    }\n+\n+    static void staticLocal() {\n+        class Local { }\n+        new Local(); \/\/ ok\n+    }\n+\n+    static void staticLocalFromAnon() {\n+        class Local { }\n+        new Object() {\n+            Local local() {\n+                return new Local(); \/\/ ok\n+            }\n+        };\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/NewLocalNotInInner.java","additions":72,"deletions":0,"binary":false,"changes":72,"status":"added"},{"patch":"@@ -0,0 +1,6 @@\n+NewLocalNotInInner.java:12:21: compiler.err.local.cant.be.inst.static: kindname.class, Local\n+NewLocalNotInInner.java:22:21: compiler.err.local.cant.be.inst.static: kindname.class, Local\n+NewLocalNotInInner.java:32:21: compiler.err.local.cant.be.inst.static: kindname.class, Local\n+NewLocalNotInInner.java:42:21: compiler.err.local.cant.be.inst.static: kindname.class, Local\n+NewLocalNotInInner.java:52:21: compiler.err.local.cant.be.inst.static: kindname.class, Local\n+5 errors\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/NewLocalNotInInner.out","additions":6,"deletions":0,"binary":false,"changes":6,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n- * @run main\/othervm -verify VarDeclarationWithAssignment\n+ * @run main\/othervm -Xverify:all VarDeclarationWithAssignment\n","filename":"test\/langtools\/tools\/javac\/VarDeclarationWithAssignment.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,138 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8372635\n+ * @enablePreview\n+ * @summary Verify temporary variables created for pattern matching are\n+ *          marked as synthetic.\n+ * @compile -g SyntheticVariables.java\n+ * @run main SyntheticVariables\n+ *\/\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.lang.classfile.Attributes;\n+import java.lang.classfile.ClassFile;\n+import java.lang.classfile.ClassModel;\n+import java.lang.classfile.MethodModel;\n+import java.lang.classfile.attribute.CodeAttribute;\n+import java.lang.classfile.attribute.LocalVariableTableAttribute;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+public class SyntheticVariables {\n+\n+    public static void main(String[] args) throws IOException {\n+        try (InputStream in = Test.class.getClassLoader().getResource(Test.class.getName().replace('.', '\/') + \".class\").openStream()) {\n+            ClassModel model = ClassFile.of().parse(in.readAllBytes());\n+            Map<String, MethodModel> name2Method = model.methods().stream().collect(Collectors.toMap(m -> m.methodName().stringValue(), m -> m));\n+            assertEquals(Set.of(\"str\", \"b\", \"b2\", \"this\", \"l\", \"o\"), localVars(name2Method.get(\"testInMethod\")));\n+            assertEquals(Set.of(\"str\", \"b\", \"b2\", \"l\", \"o\"), localVars(name2Method.get(\"lambda$testInLambda$0\")));\n+        }\n+    }\n+\n+    private static Set<String> localVars(MethodModel method) {\n+        CodeAttribute code = method.findAttribute(Attributes.code()).orElseThrow();\n+        LocalVariableTableAttribute lvt = code.findAttribute(Attributes.localVariableTable()).orElseThrow();\n+        return lvt.localVariables()\n+                  .stream()\n+                  .map(info -> info.name().stringValue())\n+                  .collect(Collectors.toSet());\n+    }\n+\n+    private static void assertEquals(Set<String> expected, Set<String> actual) {\n+        if (!Objects.equals(expected, actual)) {\n+            throw new AssertionError(\"Unexpected value, expected: \" + expected +\n+                                     \", got: \" + actual);\n+        }\n+    }\n+\n+    public record Test(Object o) {\n+        private void testInMethod() {\n+            Object o = create();\n+\n+            \/\/synthetic variable for the instanceof's expression\n+            boolean b = o.toString() instanceof String str && str.isEmpty();\n+\n+            System.err.println(b);\n+\n+            \/\/synthetic variable for the switch's selector and index:\n+            switch (create()) {\n+                \/\/synthetic variable for the nested component values,\n+                \/\/and for the synthetic catch over the getters\n+                case Test(Test(String str)) when str.isEmpty() -> System.err.println(1);\n+                case Test(Test(String str)) -> System.err.println(2);\n+                default -> System.err.println(2);\n+            }\n+\n+            List<Integer> l = List.of(0);\n+\n+            \/\/synthetic variable for case where the static and dynamic types\n+            \/\/don't match for primitive patterns:\n+            boolean b2 = l.get(0) instanceof int;\n+\n+            System.err.println(b2);\n+        }\n+\n+        private void testInLambda() {\n+            Object o = create();\n+            Runnable r = () -> {\n+\n+                \/\/synthetic variable for the instanceof's expression\n+                boolean b = o.toString() instanceof String str && str.isEmpty();\n+\n+                System.err.println(b);\n+\n+                \/\/synthetic variable for the switch's selector and index:\n+                switch (create()) {\n+                    \/\/synthetic variable for the nested component values,\n+                    \/\/and for the synthetic catch over the getters\n+                    case Test(Test(String str)) when str.isEmpty() -> System.err.println(1);\n+                    case Test(Test(String str)) -> System.err.println(2);\n+                    default -> System.err.println(2);\n+                }\n+\n+                List<Integer> l = List.of(0);\n+\n+                \/\/synthetic variable for case where the static and dynamic types\n+                \/\/don't match for primitive patterns:\n+                boolean b2 = l.get(0) instanceof int;\n+\n+                System.err.println(b2);\n+            };\n+        }\n+        private static String val = \"v\";\n+        public static Test create() {\n+            try {\n+                return new Test(new Test(val));\n+            } finally {\n+                val += val;\n+            }\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/patterns\/SyntheticVariables.java","additions":138,"deletions":0,"binary":false,"changes":138,"status":"added"},{"patch":"@@ -41,0 +41,1 @@\n+import java.util.regex.Pattern;\n@@ -293,0 +294,1 @@\n+        if(!DockerTestUtils.RETAIN_IMAGE_AFTER_TEST) {\n@@ -294,0 +296,1 @@\n+        }\n@@ -344,0 +347,10 @@\n+    public static void shouldMatchWithValue(OutputAnalyzer output, String metric, String value) throws Exception {\n+        String pattern = \"^\" + Pattern.quote(metric) + \":\\\\s*\" + Pattern.quote(value) + \".*$\";\n+        output.shouldMatch(pattern);\n+    }\n+\n+    public static void shouldNotMatchWithValue(OutputAnalyzer output, String metric, String value) throws Exception {\n+        String pattern = \"^\" + Pattern.quote(metric) + \":\\\\s*\" + Pattern.quote(value) + \".*$\";\n+        output.shouldNotMatch(pattern);\n+    }\n+\n","filename":"test\/lib\/jdk\/test\/lib\/containers\/docker\/DockerTestUtils.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -26,0 +26,2 @@\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n@@ -29,2 +31,0 @@\n-import java.security.cert.*;\n-import java.util.function.Supplier;\n@@ -34,3 +34,1 @@\n- * Creates a simple usable SSLContext for SSLSocketFactory\n- * or a HttpsServer using either a given keystore or a default\n- * one in the test tree.\n+ * Utility for creating a simple usable {@link SSLContext} for testing purposes.\n@@ -38,1 +36,1 @@\n-public class SimpleSSLContext {\n+public final class SimpleSSLContext {\n@@ -40,1 +38,15 @@\n-    SSLContext ssl;\n+    private static final String DEFAULT_PROTOCOL = \"TLS\";\n+\n+    private static final String DEFAULT_KEY_STORE_FILE_REL_PATH = \"jdk\/test\/lib\/net\/testkeys\";\n+\n+    private final SSLContext ssl;\n+\n+    \/\/ Made `public` for backward compatibility\n+    public SimpleSSLContext() throws IOException {\n+        this.ssl = findSSLContext(DEFAULT_KEY_STORE_FILE_REL_PATH, DEFAULT_PROTOCOL);\n+    }\n+\n+    \/\/ Kept for backward compatibility\n+    public SimpleSSLContext(String keyStoreFileRelPath) throws IOException {\n+        this.ssl = findSSLContext(Objects.requireNonNull(keyStoreFileRelPath), DEFAULT_PROTOCOL);\n+    }\n@@ -43,2 +55,5 @@\n-     * loads default keystore from SimpleSSLContext\n-     * source directory\n+     * {@return a new {@link SSLContext} instance by searching for a key store\n+     * file path, and loading the first found one}\n+     *\n+     * @throws RuntimeException if no key store file can be found or the found\n+     * one cannot be loaded\n@@ -46,2 +61,2 @@\n-    public SimpleSSLContext() throws IOException {\n-        this(() -> \"TLS\");\n+    public static SSLContext findSSLContext() {\n+        return findSSLContext(DEFAULT_PROTOCOL);\n@@ -50,14 +65,13 @@\n-    private SimpleSSLContext(Supplier<String> protocols) throws IOException {\n-        String proto = protocols.get();\n-        String paths = System.getProperty(\"test.src.path\");\n-        StringTokenizer st = new StringTokenizer(paths, File.pathSeparator);\n-        while (st.hasMoreTokens()) {\n-            String path = st.nextToken();\n-            File f = new File(path, \"jdk\/test\/lib\/net\/testkeys\");\n-            if (f.exists()) {\n-                try (FileInputStream fis = new FileInputStream(f)) {\n-                    init(fis, proto);\n-                    break;\n-                }\n-            }\n-        }\n+    \/**\n+     * {@return a new {@link SSLContext} instance by searching for a key store\n+     * file path, and loading the first found one}\n+     *\n+     * @param protocol an {@link SSLContext} protocol\n+     *\n+     * @throws NullPointerException if {@code protocol} is null\n+     * @throws RuntimeException if no key store file can be found or the found\n+     * one cannot be loaded\n+     *\/\n+    public static SSLContext findSSLContext(String protocol) {\n+        Objects.requireNonNull(protocol);\n+        return findSSLContext(DEFAULT_KEY_STORE_FILE_REL_PATH, protocol);\n@@ -67,1 +81,11 @@\n-     * loads default keystore from given directory\n+     * {@return a new {@link SSLContext} instance by searching for a key store\n+     * file path, and loading the first found one}\n+     *\n+     * @param keyStoreFileRelPath a key store file path to be concatenated with\n+     *                            the search path(s) obtained from the\n+     *                            {@code test.src.path} system property\n+     * @param protocol an {@link SSLContext} protocol\n+     *\n+     * @throws NullPointerException if {@code keyStoreFileRelPath} or {@code protocol} is null\n+     * @throws RuntimeException if no key store file can be found or the found\n+     * one cannot be loaded\n@@ -69,4 +93,9 @@\n-    public SimpleSSLContext(String dir) throws IOException {\n-        String file = dir + \"\/testkeys\";\n-        try (FileInputStream fis = new FileInputStream(file)) {\n-            init(fis, \"TLS\");\n+    public static SSLContext findSSLContext(String keyStoreFileRelPath, String protocol) {\n+        Objects.requireNonNull(keyStoreFileRelPath);\n+        Objects.requireNonNull(protocol);\n+        var sourcePaths = System.getProperty(\"test.src.path\");\n+        for (var sourcePath : Collections.list(new StringTokenizer(sourcePaths, File.pathSeparator))) {\n+            var keyStoreFileAbsPath = Path.of((String) sourcePath, keyStoreFileRelPath);\n+            if (Files.exists(keyStoreFileAbsPath)) {\n+                return loadSSLContext(keyStoreFileAbsPath, protocol);\n+            }\n@@ -74,0 +103,3 @@\n+        throw new RuntimeException(\n+                \"Could not find any key store at source path(s) '%s' using key store file relative path '%s'\".formatted(\n+                        sourcePaths, keyStoreFileRelPath));\n@@ -76,2 +108,11 @@\n-    private void init(InputStream i, String protocol) throws IOException {\n-        try {\n+    \/**\n+     * {@return a new {@link SSLContext} loaded from the provided key store file\n+     * path using the given protocol}\n+     *\n+     * @param keyStoreFilePath a {@link KeyStore} file path\n+     * @param protocol an {@link SSLContext} protocol\n+     *\n+     * @throws RuntimeException if loading fails\n+     *\/\n+    private static SSLContext loadSSLContext(Path keyStoreFilePath, String protocol) {\n+        try (var storeStream = Files.newInputStream(keyStoreFilePath)) {\n@@ -80,1 +121,1 @@\n-            ks.load(i, passphrase);\n+            ks.load(storeStream, passphrase);\n@@ -88,6 +129,7 @@\n-            ssl = SSLContext.getInstance(protocol);\n-            ssl.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);\n-        } catch (KeyManagementException | KeyStoreException |\n-                UnrecoverableKeyException | CertificateException |\n-                NoSuchAlgorithmException e) {\n-            throw new RuntimeException(e.getMessage());\n+            var sslContext = SSLContext.getInstance(protocol);\n+            sslContext.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);\n+            return sslContext;\n+        } catch (Exception e) {\n+            var message = \"Failed loading 'SSLContext' from key store at location '%s' for protocol '%s'\".formatted(\n+                    keyStoreFilePath, protocol);\n+            throw new RuntimeException(message, e);\n@@ -97,0 +139,1 @@\n+    \/\/ Kept for backward compatibility\n@@ -98,5 +141,6 @@\n-        if(protocol == null || protocol.isEmpty()) {\n-            return new SimpleSSLContext().get();\n-        }\n-        else {\n-            return new SimpleSSLContext(() -> protocol).get();\n+        try {\n+            return protocol == null || protocol.isEmpty()\n+                    ? findSSLContext()\n+                    : findSSLContext(protocol);\n+        } catch (RuntimeException re) {\n+            throw new IOException(re);\n@@ -106,0 +150,1 @@\n+    \/\/ Kept for backward compatibility\n@@ -109,0 +154,1 @@\n+\n","filename":"test\/lib\/jdk\/test\/lib\/net\/SimpleSSLContext.java","additions":90,"deletions":44,"binary":false,"changes":134,"status":"modified"},{"patch":"@@ -80,0 +80,1 @@\n+  public native long getMinimumJavaStackSize();\n","filename":"test\/lib\/jdk\/test\/whitebox\/WhiteBox.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,0 +2,1 @@\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +35,0 @@\n-@State(Scope.Thread)\n@@ -39,1 +39,0 @@\n-    private static Signature signer;\n@@ -41,2 +40,35 @@\n-    @Param({\"64\", \"512\", \"2048\", \"16384\"})\n-    private static int messageLength;\n+    @State(Scope.Benchmark)\n+    public static class test01 {\n+        @Param({\"64\", \"512\", \"2048\", \"16384\"})\n+        private int messageLength;\n+        @Param({\"secp256r1\", \"secp384r1\", \"secp521r1\"})\n+        private String algorithm;\n+    }\n+    @State(Scope.Benchmark)\n+    public static class test02 {\n+        @Param({\"64\", \"512\", \"2048\", \"16384\"})\n+        private int messageLength;\n+        @Param({\"Ed25519\", \"Ed448\"})\n+        private String algorithm;\n+    }\n+    @State(Scope.Benchmark)\n+    public static class test03 {\n+        @Param({\"64\", \"512\", \"2048\", \"16384\"})\n+        private int messageLength;\n+        @Param({\"SHA256withDSA\", \"SHA384withDSA\", \"SHA512withDSA\"})\n+        private String algorithm;\n+    }\n+    @State(Scope.Benchmark)\n+    public static class test04 {\n+        @Param({\"64\", \"512\", \"2048\", \"16384\"})\n+        private int messageLength;\n+        @Param({\"SHA256withRSA\", \"SHA384withRSA\", \"SHA512withRSA\"})\n+        private String algorithm;\n+    }\n+    @State(Scope.Benchmark)\n+    public static class test05 {\n+        @Param({\"64\", \"512\", \"2048\", \"16384\"})\n+        private int messageLength;\n+        @Param({\"SHA256\", \"SHA384\", \"SHA512\"})\n+        private String algorithm;\n+    }\n@@ -44,2 +76,5 @@\n-    @Param({\"secp256r1\", \"secp384r1\", \"secp521r1\"})\n-    private String algorithm;\n+    @Benchmark\n+    public byte[] ECDSA(s1 state) throws Exception {\n+        state.signer.update(state.message);\n+        return state.signer.sign();\n+    }\n@@ -47,1 +82,5 @@\n-    private static byte[] message;\n+    @Benchmark\n+    public byte[] EdDSA(s2 state) throws Exception {\n+        state.signer.update(state.message);\n+        return state.signer.sign();\n+    }\n@@ -49,4 +88,5 @@\n-    @Setup\n-    public void setup() throws Exception {\n-        message = new byte[messageLength];\n-        (new Random(System.nanoTime())).nextBytes(message);\n+    @Benchmark\n+    public byte[] DSA(s3 state) throws Exception {\n+        state.signer.update(state.message);\n+        return state.signer.sign();\n+    }\n@@ -54,6 +94,5 @@\n-        String signName = switch (algorithm) {\n-            case \"secp256r1\" -> \"SHA256withECDSA\";\n-            case \"secp384r1\" -> \"SHA384withECDSA\";\n-            case \"secp521r1\" -> \"SHA512withECDSA\";\n-            default -> throw new RuntimeException();\n-        };\n+    @Benchmark\n+    public byte[] RSA(s4 state) throws Exception {\n+        state.signer.update(state.message);\n+        return state.signer.sign();\n+    }\n@@ -61,5 +100,5 @@\n-        AlgorithmParameters params =\n-                AlgorithmParameters.getInstance(\"EC\", \"SunEC\");\n-        params.init(new ECGenParameterSpec(algorithm));\n-        ECGenParameterSpec ecParams =\n-                params.getParameterSpec(ECGenParameterSpec.class);\n+    @Benchmark\n+    public byte[] RSASSAPSS(s5 state) throws Exception {\n+        state.signer.update(state.message);\n+        return state.signer.sign();\n+    }\n@@ -67,4 +106,4 @@\n-        KeyPairGenerator kpg =\n-                KeyPairGenerator.getInstance(\"EC\", \"SunEC\");\n-        kpg.initialize(ecParams);\n-        KeyPair kp = kpg.generateKeyPair();\n+    @State(Scope.Thread)\n+    public static class s1 {\n+        private Signature signer;\n+        private byte[] message;\n@@ -72,3 +111,4 @@\n-        signer = Signature.getInstance(signName, \"SunEC\");\n-        signer.initSign(kp.getPrivate());\n-    }\n+        @Setup\n+        public void setup(test01 test) throws Exception {\n+            message = new byte[test.messageLength];\n+            (new Random(System.nanoTime())).nextBytes(message);\n@@ -76,4 +116,21 @@\n-    @Benchmark\n-    public byte[] sign() throws SignatureException {\n-        signer.update(message);\n-        return signer.sign();\n+            String signName = switch (test.algorithm) {\n+                case \"secp256r1\" -> \"SHA256withECDSA\";\n+                case \"secp384r1\" -> \"SHA384withECDSA\";\n+                case \"secp521r1\" -> \"SHA512withECDSA\";\n+                default -> throw new RuntimeException();\n+            };\n+\n+            AlgorithmParameters params =\n+                    AlgorithmParameters.getInstance(\"EC\", \"SunEC\");\n+            params.init(new ECGenParameterSpec(test.algorithm));\n+            ECGenParameterSpec ecParams =\n+                    params.getParameterSpec(ECGenParameterSpec.class);\n+\n+            KeyPairGenerator kpg =\n+                    KeyPairGenerator.getInstance(\"EC\", \"SunEC\");\n+            kpg.initialize(ecParams);\n+            KeyPair kp = kpg.generateKeyPair();\n+\n+            signer = Signature.getInstance(signName, \"SunEC\");\n+            signer.initSign(kp.getPrivate());\n+        }\n@@ -82,3 +139,4 @@\n-    public static class EdDSA extends Signatures {\n-        @Param({\"Ed25519\", \"Ed448\"})\n-        private String algorithm;\n+    @State(Scope.Thread)\n+    public static class s2 {\n+        private Signature signer;\n+        private byte[] message;\n@@ -87,2 +145,2 @@\n-        public void setup() throws Exception {\n-            message = new byte[messageLength];\n+        public void setup(test02 test) throws Exception {\n+            message = new byte[test.messageLength];\n@@ -92,2 +150,2 @@\n-                    KeyPairGenerator.getInstance(algorithm, \"SunEC\");\n-            NamedParameterSpec spec = new NamedParameterSpec(algorithm);\n+                    KeyPairGenerator.getInstance(test.algorithm, \"SunEC\");\n+            NamedParameterSpec spec = new NamedParameterSpec(test.algorithm);\n@@ -97,1 +155,1 @@\n-            signer = Signature.getInstance(algorithm, \"SunEC\");\n+            signer = Signature.getInstance(test.algorithm, \"SunEC\");\n@@ -102,3 +160,4 @@\n-    public static class DSA extends Signatures {\n-        @Param({\"SHA256withDSA\", \"SHA384withDSA\", \"SHA512withDSA\"})\n-        private String algorithm;\n+    @State(Scope.Thread)\n+    public static class s3 {\n+        private Signature signer;\n+        private byte[] message;\n@@ -107,2 +166,2 @@\n-        public void setup() throws Exception {\n-            message = new byte[messageLength];\n+        public void setup(test03 test) throws Exception {\n+            message = new byte[test.messageLength];\n@@ -111,1 +170,1 @@\n-            int keyLength = switch (algorithm) {\n+            int keyLength = switch (test.algorithm) {\n@@ -122,1 +181,1 @@\n-            signer = Signature.getInstance(algorithm);\n+            signer = Signature.getInstance(test.algorithm);\n@@ -127,3 +186,4 @@\n-    public static class RSA extends Signatures {\n-        @Param({\"SHA256withRSA\", \"SHA384withRSA\", \"SHA512withRSA\"})\n-        private String algorithm;\n+    @State(Scope.Thread)\n+    public static class s4 {\n+        private Signature signer;\n+        private byte[] message;\n@@ -132,2 +192,2 @@\n-        public void setup() throws Exception {\n-            message = new byte[messageLength];\n+        public void setup(test04 test) throws Exception {\n+            message = new byte[test.messageLength];\n@@ -136,1 +196,1 @@\n-            int keyLength = switch (algorithm) {\n+            int keyLength = switch (test.algorithm) {\n@@ -147,1 +207,1 @@\n-            signer = Signature.getInstance(algorithm);\n+            signer = Signature.getInstance(test.algorithm);\n@@ -152,3 +212,4 @@\n-    public static class RSASSAPSS extends Signatures {\n-        @Param({\"SHA256\", \"SHA384\", \"SHA512\"})\n-        private String algorithm;\n+    @State(Scope.Thread)\n+    public static class s5 {\n+        private Signature signer;\n+        private byte[] message;\n@@ -157,2 +218,2 @@\n-        public void setup() throws Exception {\n-            message = new byte[messageLength];\n+        public void setup(test05 test) throws Exception {\n+            message = new byte[test.messageLength];\n@@ -161,1 +222,1 @@\n-            int keyLength = switch (algorithm) {\n+            int keyLength = switch (test.algorithm) {\n@@ -168,1 +229,1 @@\n-            PSSParameterSpec spec = switch (algorithm) {\n+            PSSParameterSpec spec = switch (test.algorithm) {\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/security\/Signatures.java","additions":123,"deletions":62,"binary":false,"changes":185,"status":"modified"},{"patch":"@@ -2,0 +2,1 @@\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -54,0 +55,2 @@\n+    private String choicePattern;\n+    private String numberPattern;\n@@ -63,0 +66,2 @@\n+        choicePattern = \"{0,choice,0#|1#{1}|2#{1} ({2})}\";\n+        numberPattern = \"{0,number,000}\";\n@@ -75,0 +80,10 @@\n+    @Benchmark\n+    public MessageFormat testSubformatChoice() {\n+        return new MessageFormat(choicePattern);\n+    }\n+\n+    @Benchmark\n+    public MessageFormat testSubformatNumber() {\n+        return new MessageFormat(numberPattern);\n+    }\n+\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/text\/MessageFormatterBench.java","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -0,0 +1,774 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.bench.vm.compiler;\n+\n+import org.openjdk.jmh.annotations.*;\n+import org.openjdk.jmh.infra.*;\n+\n+import java.util.concurrent.TimeUnit;\n+import java.util.Random;\n+import java.util.Arrays;\n+\n+\/**\n+ * This benchmark is here to measure vectorized peformance for some simple bulk operations:\n+ * - fill\n+ * - copy\n+ *\n+ * We may add more in the future, for example:\n+ * - comparison\n+ * - find index\n+ * - filter\n+ * - ...\n+ *\n+ * One important feature of this benchmark, is that we control for alignment and 4k-aliasing,\n+ * something almost no benchmarks have considered up to now. But it is important to get more\n+ * precise, clean and reliable results.\n+ *\n+ * Note, you may want to play with \"-XX:-OptimizeFill\" for the fill benchmarks, so that we do\n+ * not use the fill-intrinsic, but auto-vectorize. Though I'm currently not seeing a difference,\n+ * maybe the loop is not recognized properly? Maybe the alignment \"randomization\" prevents it.\n+ *\n+ * Please also look at the companion benchmark:\n+ *   VectorBulkOperationsMemorySegment.java\n+ *\/\n+@BenchmarkMode(Mode.AverageTime)\n+@OutputTimeUnit(TimeUnit.NANOSECONDS)\n+@State(Scope.Thread)\n+@Warmup(iterations = 3, time = 1000, timeUnit = TimeUnit.MILLISECONDS)\n+@Measurement(iterations = 5, time = 1000, timeUnit = TimeUnit.MILLISECONDS)\n+@Fork(value = 1)\n+public class VectorBulkOperationsArray {\n+    @Param({  \"0\",  \"1\",  \"2\",  \"3\",  \"4\",  \"5\",  \"6\",  \"7\",  \"8\",  \"9\",\n+             \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\",\n+             \"20\", \"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\",\n+             \"30\", \"31\", \"32\", \"33\", \"34\", \"35\", \"36\", \"37\", \"38\", \"39\",\n+             \"40\", \"41\", \"42\", \"43\", \"44\", \"45\", \"46\", \"47\", \"48\", \"49\",\n+             \"50\", \"51\", \"52\", \"53\", \"54\", \"55\", \"56\", \"57\", \"58\", \"59\",\n+             \"60\", \"61\", \"62\", \"63\", \"64\", \"65\", \"66\", \"67\", \"68\", \"69\",\n+             \"70\", \"71\", \"72\", \"73\", \"74\", \"75\", \"76\", \"77\", \"78\", \"79\",\n+             \"80\", \"81\", \"82\", \"83\", \"84\", \"85\", \"86\", \"87\", \"88\", \"89\",\n+             \"90\", \"91\", \"92\", \"93\", \"94\", \"95\", \"96\", \"97\", \"98\", \"99\",\n+            \"100\",\"101\",\"102\",\"103\",\"104\",\"105\",\"106\",\"107\",\"108\",\"109\",\n+            \"110\",\"111\",\"112\",\"113\",\"114\",\"115\",\"116\",\"117\",\"118\",\"119\",\n+            \"120\",\"121\",\"122\",\"123\",\"124\",\"125\",\"126\",\"127\",\"128\",\"129\",\n+            \"130\",\"131\",\"132\",\"133\",\"134\",\"135\",\"136\",\"137\",\"138\",\"139\",\n+            \"140\",\"141\",\"142\",\"143\",\"144\",\"145\",\"146\",\"147\",\"148\",\"149\",\n+            \"150\",\"151\",\"152\",\"153\",\"154\",\"155\",\"156\",\"157\",\"158\",\"159\",\n+            \"160\",\"161\",\"162\",\"163\",\"164\",\"165\",\"166\",\"167\",\"168\",\"169\",\n+            \"170\",\"171\",\"172\",\"173\",\"174\",\"175\",\"176\",\"177\",\"178\",\"179\",\n+            \"180\",\"181\",\"182\",\"183\",\"184\",\"185\",\"186\",\"187\",\"188\",\"189\",\n+            \"190\",\"191\",\"192\",\"193\",\"194\",\"195\",\"196\",\"197\",\"198\",\"199\",\n+            \"200\",\"201\",\"202\",\"203\",\"204\",\"205\",\"206\",\"207\",\"208\",\"209\",\n+            \"210\",\"211\",\"212\",\"213\",\"214\",\"215\",\"216\",\"217\",\"218\",\"219\",\n+            \"220\",\"221\",\"222\",\"223\",\"224\",\"225\",\"226\",\"227\",\"228\",\"229\",\n+            \"230\",\"231\",\"232\",\"233\",\"234\",\"235\",\"236\",\"237\",\"238\",\"239\",\n+            \"240\",\"241\",\"242\",\"243\",\"244\",\"245\",\"246\",\"247\",\"248\",\"249\",\n+            \"250\",\"251\",\"252\",\"253\",\"254\",\"255\",\"256\",\"257\",\"258\",\"259\",\n+            \"260\",\"261\",\"262\",\"263\",\"264\",\"265\",\"266\",\"267\",\"268\",\"269\",\n+            \"270\",\"271\",\"272\",\"273\",\"274\",\"275\",\"276\",\"277\",\"278\",\"279\",\n+            \"280\",\"281\",\"282\",\"283\",\"284\",\"285\",\"286\",\"287\",\"288\",\"289\",\n+            \"290\",\"291\",\"292\",\"293\",\"294\",\"295\",\"296\",\"297\",\"298\",\"299\",\n+            \"300\"})\n+    public static int NUM_ACCESS_ELEMENTS;\n+    \/\/ This is just a default to investigate small iteration loops.\n+\n+    \/\/ Every array has two regions:\n+    \/\/ - read region\n+    \/\/ - write region\n+    \/\/ We should make sure that the region is a multiple of 4k, so that the\n+    \/\/ 4k-aliasing prevention trick can work. If we used two arrays, then\n+    \/\/ we would not know what the relative offset is between them, so we could\n+    \/\/ not do anything about the 4k-aliasing effects.\n+    \/\/ Background on 4k-aliasing: many modern CPUs have a store-to-load-forwarding\n+    \/\/ mechanism that speeds up loads if the memory locations that were recently\n+    \/\/ stored to. For this, the CPU needs to check if there is a store in the store\n+    \/\/ buffer with the same address and size. There are various implementations\n+    \/\/ with different performance characteristics on various CPUs. For x86, there\n+    \/\/ is a special mechanism that quickly checks the lowest 12bits of the address,\n+    \/\/ to see if there is a match. If there is a match on the 12bits, we then\n+    \/\/ have to eventually check the rest of the bits. There seems to be something\n+    \/\/ speculative going on, and so if we eventually find that there is a match\n+    \/\/ things are really fast. But if we eventually find that the rest of the\n+    \/\/ bits do not match, we have to abort and redo the load from memory\/cache,\n+    \/\/ and that can be slower than if we had gone to memory\/cache directly. Hence,\n+    \/\/ if we regularly have matches on the 12bits, but mismatches on the other\n+    \/\/ bits, we can be slower than expected. 12bits of address gives us a cyclic\n+    \/\/ patterns every 4k bytes. So if you load\/store with a distance of 4k or\n+    \/\/ a multiple, you can see slower performance than expected, you get a dip\/\n+    \/\/ spike in the curve that is a strange artifact. We would like to avoid this\n+    \/\/ in our benchmark. That is why we make sure to have k * 4k + 2k offset\n+    \/\/ between load and store.\n+    \/\/\n+    \/\/ It would be ince to set REGION_SIZE statically, but we want to keep it rather small if possible,\n+    \/\/ to avoid running out of cache. But it might be quite large if NUM_ACCESS_ELEMENTS is large.\n+    public static int REGION_SIZE = -1024;\n+    public static final int REGION_2_BYTE_OFFSET   = 1024 * 2; \/\/ prevent 4k-aliasing\n+    public static final int REGION_2_SHORT_OFFSET  = REGION_2_BYTE_OFFSET \/ 2;\n+    public static final int REGION_2_CHAR_OFFSET   = REGION_2_BYTE_OFFSET \/ 2;\n+    public static final int REGION_2_INT_OFFSET    = REGION_2_BYTE_OFFSET \/ 4;\n+    public static final int REGION_2_LONG_OFFSET   = REGION_2_BYTE_OFFSET \/ 8;\n+    public static final int REGION_2_FLOAT_OFFSET  = REGION_2_BYTE_OFFSET \/ 4;\n+    public static final int REGION_2_DOUBLE_OFFSET = REGION_2_BYTE_OFFSET \/ 8;\n+    \/\/ For Objects, it could be 4 or 8 bytes. Dividing by 8 gives us something\n+    \/\/ reasonable for both cases.\n+    public static final int REGION_2_OBJECT_OFFSET = REGION_2_BYTE_OFFSET \/ 8;\n+\n+    \/\/ The arrays with the two regions each\n+    private byte[] aB;\n+    private short[] aS;\n+    private char[] aC;\n+    private int[] aI;\n+    private long[] aL;\n+    private float[] aF;\n+    private double[] aD;\n+\n+    \/\/ Used when we need variable values in fill.\n+    private byte varB = 42;\n+    private short varS = 42;\n+    private char varC = 42;\n+    private int varI = 42;\n+    private long varL = 42;\n+    private float varF = 42;\n+    private double varD = 42;\n+\n+    \/\/ Classes for Object arrays.\n+    static class A {\n+        int x;\n+        A(int x) {\n+            this.x = x;\n+        }\n+    }\n+    static class B extends A {\n+        int y;\n+        B(int x, int y) {\n+            super(x);\n+            this.y = y;\n+        }\n+    }\n+    private A[] aOA;\n+    private B[] aOB;\n+    private A varOA = new A(-1);\n+    private B varOB = new B(-1, -1);\n+\n+    \/\/ Number of repetitions, to randomize the offsets.\n+    public static final int REPETITIONS = 64 * 64;\n+\n+    @CompilerControl(CompilerControl.Mode.INLINE)\n+    public static int offsetLoad(int i) { return i & 63; } \/\/ bits 0-7, value from 0-63\n+\n+    @CompilerControl(CompilerControl.Mode.INLINE)\n+    public static int offsetStore(int i) { return (i >> 8) & 63; } \/\/ bits 8-15, value from 0-63\n+\n+    @Param(\"42\")\n+    private int seed;\n+    private Random r = new Random(seed);\n+\n+    public static int roundUp4k(int i) {\n+        return (i + 4*1024-1) & (-4*1024);\n+    }\n+\n+    @Setup\n+    public void init() {\n+        \/\/ Make sure we can fit the longs, and then some whiggle room for alignment.\n+        REGION_SIZE = roundUp4k(NUM_ACCESS_ELEMENTS * 8 + 1024 + REGION_2_BYTE_OFFSET);\n+        aB = new byte[2 * REGION_SIZE];\n+        aC = new char[2 * REGION_SIZE];\n+        aS = new short[2 * REGION_SIZE];\n+        aI = new int[2 * REGION_SIZE];\n+        aL = new long[2 * REGION_SIZE];\n+        aF = new float[2 * REGION_SIZE];\n+        aD = new double[2 * REGION_SIZE];\n+        aOA = new A[2 * REGION_SIZE];\n+        aOB = new B[2 * REGION_SIZE];\n+\n+        for (int i = 0; i < 2 * REGION_SIZE; i++) {\n+            aB[i] = (byte) r.nextInt();\n+            aS[i] = (short) r.nextInt();\n+            aC[i] = (char) r.nextInt();\n+            aI[i] = r.nextInt();\n+            aL[i] = r.nextLong();\n+            aF[i] = r.nextFloat();\n+            aD[i] = r.nextDouble();\n+            aOA[i] = switch (i % 4) {\n+                case 0, 1 -> new A(i);\n+                case 2    -> new B(i, i);\n+                default   -> null;\n+            };\n+            aOB[i] = (i % 3 != 0) ? new B(i, i) : null;\n+        }\n+    }\n+\n+    \/\/ -------------------------------- BYTE ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_byte_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aB[i + offset_store] = 0;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_byte_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aB[i + offset_store] = varB;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_byte_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            Arrays.fill(aB, offset_store, offset_store + NUM_ACCESS_ELEMENTS, (byte)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_byte_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            Arrays.fill(aB, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varB);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_byte_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aB[i + offset_store] = aB[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_byte_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            System.arraycopy(aB, offset_load, aB, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- CHAR ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_char_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_CHAR_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aC[i + offset_store] = 0;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_char_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_CHAR_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aC[i + offset_store] = varC;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_char_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_CHAR_OFFSET;\n+            Arrays.fill(aC, offset_store, offset_store + NUM_ACCESS_ELEMENTS, (char)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_char_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_CHAR_OFFSET;\n+            Arrays.fill(aC, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varC);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_char_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_CHAR_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aC[i + offset_store] = aC[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_char_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_CHAR_OFFSET;\n+            System.arraycopy(aC, offset_load, aC, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- SHORT ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_short_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_SHORT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aS[i + offset_store] = 0;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_short_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_SHORT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aS[i + offset_store] = varS;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_short_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_SHORT_OFFSET;\n+            Arrays.fill(aS, offset_store, offset_store + NUM_ACCESS_ELEMENTS, (short)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_short_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_SHORT_OFFSET;\n+            Arrays.fill(aS, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varS);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_short_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_SHORT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aS[i + offset_store] = aS[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_short_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_SHORT_OFFSET;\n+            System.arraycopy(aS, offset_load, aS, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- INT ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_int_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_INT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aI[i + offset_store] = 0;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_int_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_INT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aI[i + offset_store] = varI;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_int_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_INT_OFFSET;\n+            Arrays.fill(aI, offset_store, offset_store + NUM_ACCESS_ELEMENTS, (int)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_int_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_INT_OFFSET;\n+            Arrays.fill(aI, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varI);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_int_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_INT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aI[i + offset_store] = aI[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_int_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_INT_OFFSET;\n+            System.arraycopy(aI, offset_load, aI, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- LONG ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_long_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_LONG_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aL[i + offset_store] = 0;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_long_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_LONG_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aL[i + offset_store] = varL;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_long_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_LONG_OFFSET;\n+            Arrays.fill(aL, offset_store, offset_store + NUM_ACCESS_ELEMENTS, (long)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_long_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_LONG_OFFSET;\n+            Arrays.fill(aL, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varL);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_long_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_LONG_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aL[i + offset_store] = aL[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_long_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_LONG_OFFSET;\n+            System.arraycopy(aL, offset_load, aL, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- FLOAT ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_float_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_FLOAT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aF[i + offset_store] = 0;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_float_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_FLOAT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aF[i + offset_store] = varF;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_float_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_FLOAT_OFFSET;\n+            Arrays.fill(aF, offset_store, offset_store + NUM_ACCESS_ELEMENTS, (float)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_float_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_FLOAT_OFFSET;\n+            Arrays.fill(aF, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varF);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_float_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_FLOAT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aF[i + offset_store] = aF[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_float_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_FLOAT_OFFSET;\n+            System.arraycopy(aF, offset_load, aF, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- DOUBLE ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_double_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_DOUBLE_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aD[i + offset_store] = 0;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_double_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_DOUBLE_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aD[i + offset_store] = varD;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_double_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_DOUBLE_OFFSET;\n+            Arrays.fill(aD, offset_store, offset_store + NUM_ACCESS_ELEMENTS, (double)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_double_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_DOUBLE_OFFSET;\n+            Arrays.fill(aD, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varD);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_double_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_DOUBLE_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aD[i + offset_store] = aD[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_double_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_DOUBLE_OFFSET;\n+            System.arraycopy(aD, offset_load, aD, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- OBJECT ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_null_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aOA[i + offset_store] = null;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_A2A_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aOA[i + offset_store] = varOA;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_B2A_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aOA[i + offset_store] = varOB;\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_null_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            Arrays.fill(aOA, offset_store, offset_store + NUM_ACCESS_ELEMENTS, null);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_A2A_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            Arrays.fill(aOA, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varOA);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_B2A_arrays_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            Arrays.fill(aOA, offset_store, offset_store + NUM_ACCESS_ELEMENTS, varOB);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_A2A_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aOA[i + offset_store] = aOA[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_B2A_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            for (int i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                aOA[i + offset_store] = aOB[i + offset_load];\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_A2A_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            System.arraycopy(aOA, offset_load, aOA, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_B2A_system_arraycopy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            int offset_load = offsetLoad(r);\n+            int offset_store = offsetStore(r) + REGION_SIZE + REGION_2_OBJECT_OFFSET;\n+            System.arraycopy(aOB, offset_load, aOA, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/vm\/compiler\/VectorBulkOperationsArray.java","additions":774,"deletions":0,"binary":false,"changes":774,"status":"added"},{"patch":"@@ -0,0 +1,374 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.bench.vm.compiler;\n+\n+import org.openjdk.jmh.annotations.*;\n+import org.openjdk.jmh.infra.*;\n+\n+import java.lang.foreign.*;\n+import java.util.concurrent.TimeUnit;\n+import java.util.Random;\n+import java.util.Arrays;\n+\n+\/**\n+ * This benchmark is here to measure vectorized peformance for some simple bulk operations:\n+ * - fill\n+ * - copy\n+ *\n+ * We may add more in the future, for example:\n+ * - comparison\n+ * - find index\n+ * - filter\n+ * - ...\n+ *\n+ * One important feature of this benchmark, is that we control for alignment and 4k-aliasing,\n+ * something almost no benchmarks have considered up to now. But it is important to get more\n+ * precise, clean and reliable results.\n+ *\n+ * Please also look at the companion benchmark:\n+ *   VectorBulkOperationsArray.java\n+ *\/\n+@BenchmarkMode(Mode.AverageTime)\n+@OutputTimeUnit(TimeUnit.NANOSECONDS)\n+@State(Scope.Thread)\n+@Warmup(iterations = 3, time = 1000, timeUnit = TimeUnit.MILLISECONDS)\n+@Measurement(iterations = 5, time = 1000, timeUnit = TimeUnit.MILLISECONDS)\n+@Fork(value = 1)\n+public class VectorBulkOperationsMemorySegment {\n+    @Param({  \"0\",  \"1\",  \"2\",  \"3\",  \"4\",  \"5\",  \"6\",  \"7\",  \"8\",  \"9\",\n+             \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\",\n+             \"20\", \"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\",\n+             \"30\", \"31\", \"32\", \"33\", \"34\", \"35\", \"36\", \"37\", \"38\", \"39\",\n+             \"40\", \"41\", \"42\", \"43\", \"44\", \"45\", \"46\", \"47\", \"48\", \"49\",\n+             \"50\", \"51\", \"52\", \"53\", \"54\", \"55\", \"56\", \"57\", \"58\", \"59\",\n+             \"60\", \"61\", \"62\", \"63\", \"64\", \"65\", \"66\", \"67\", \"68\", \"69\",\n+             \"70\", \"71\", \"72\", \"73\", \"74\", \"75\", \"76\", \"77\", \"78\", \"79\",\n+             \"80\", \"81\", \"82\", \"83\", \"84\", \"85\", \"86\", \"87\", \"88\", \"89\",\n+             \"90\", \"91\", \"92\", \"93\", \"94\", \"95\", \"96\", \"97\", \"98\", \"99\",\n+            \"100\",\"101\",\"102\",\"103\",\"104\",\"105\",\"106\",\"107\",\"108\",\"109\",\n+            \"110\",\"111\",\"112\",\"113\",\"114\",\"115\",\"116\",\"117\",\"118\",\"119\",\n+            \"120\",\"121\",\"122\",\"123\",\"124\",\"125\",\"126\",\"127\",\"128\",\"129\",\n+            \"130\",\"131\",\"132\",\"133\",\"134\",\"135\",\"136\",\"137\",\"138\",\"139\",\n+            \"140\",\"141\",\"142\",\"143\",\"144\",\"145\",\"146\",\"147\",\"148\",\"149\",\n+            \"150\",\"151\",\"152\",\"153\",\"154\",\"155\",\"156\",\"157\",\"158\",\"159\",\n+            \"160\",\"161\",\"162\",\"163\",\"164\",\"165\",\"166\",\"167\",\"168\",\"169\",\n+            \"170\",\"171\",\"172\",\"173\",\"174\",\"175\",\"176\",\"177\",\"178\",\"179\",\n+            \"180\",\"181\",\"182\",\"183\",\"184\",\"185\",\"186\",\"187\",\"188\",\"189\",\n+            \"190\",\"191\",\"192\",\"193\",\"194\",\"195\",\"196\",\"197\",\"198\",\"199\",\n+            \"200\",\"201\",\"202\",\"203\",\"204\",\"205\",\"206\",\"207\",\"208\",\"209\",\n+            \"210\",\"211\",\"212\",\"213\",\"214\",\"215\",\"216\",\"217\",\"218\",\"219\",\n+            \"220\",\"221\",\"222\",\"223\",\"224\",\"225\",\"226\",\"227\",\"228\",\"229\",\n+            \"230\",\"231\",\"232\",\"233\",\"234\",\"235\",\"236\",\"237\",\"238\",\"239\",\n+            \"240\",\"241\",\"242\",\"243\",\"244\",\"245\",\"246\",\"247\",\"248\",\"249\",\n+            \"250\",\"251\",\"252\",\"253\",\"254\",\"255\",\"256\",\"257\",\"258\",\"259\",\n+            \"260\",\"261\",\"262\",\"263\",\"264\",\"265\",\"266\",\"267\",\"268\",\"269\",\n+            \"270\",\"271\",\"272\",\"273\",\"274\",\"275\",\"276\",\"277\",\"278\",\"279\",\n+            \"280\",\"281\",\"282\",\"283\",\"284\",\"285\",\"286\",\"287\",\"288\",\"289\",\n+            \"290\",\"291\",\"292\",\"293\",\"294\",\"295\",\"296\",\"297\",\"298\",\"299\",\n+            \"300\"})\n+    public static long NUM_ACCESS_ELEMENTS;\n+\n+    @Param({\"native\", \"array_byte\", \"array_int\", \"array_long\"})\n+    public static String BACKING_TYPE;\n+\n+    \/\/ Every array has two regions:\n+    \/\/ - read region\n+    \/\/ - write region\n+    \/\/ We should make sure that the region is a multiple of 4k, so that the\n+    \/\/ 4k-aliasing prevention trick can work.\n+    \/\/ See VectorBulkOperationsArray.java for a deeper explanation.\n+    \/\/\n+    \/\/ It would be ince to set REGION_SIZE statically, but we want to keep it rather small if possible,\n+    \/\/ to avoid running out of cache. But it might be quite large if NUM_ACCESS_ELEMENTS is large.\n+    public static long REGION_SIZE = -1024;\n+    public static final long REGION_2_BYTE_OFFSET   = 1024 * 2; \/\/ prevent 4k-aliasing\n+\n+    \/\/ TDOO: see what is still actie up here.\n+\n+    \/\/ Just one MemorySegment for all cases, backed by whatever BACKING_TYPE.\n+    MemorySegment ms;\n+\n+    \/\/ Used when we need variable values in fill.\n+    private byte varB = 42;\n+    private short varS = 42;\n+    private char varC = 42;\n+    private int varI = 42;\n+    private long varL = 42;\n+    private float varF = 42;\n+    private double varD = 42;\n+\n+    \/\/ Number of repetitions, to randomize the offsets.\n+    public static final int REPETITIONS = 64 * 64;\n+\n+    @CompilerControl(CompilerControl.Mode.INLINE)\n+    public static long offsetLoad(long i) { return i & 63; } \/\/ bits 0-7, value from 0-63\n+\n+    @CompilerControl(CompilerControl.Mode.INLINE)\n+    public static long offsetStore(long i) { return (i >> 8) & 63; } \/\/ bits 8-15, value from 0-63\n+\n+    @Param(\"42\")\n+    private int seed;\n+    private Random r = new Random(seed);\n+\n+    public static long roundUp4k(long i) {\n+        return (i + 4*1024-1) & (-4*1024L);\n+    }\n+\n+    @Setup\n+    public void init() {\n+        \/\/ Make sure we can fit the longs, and then some whiggle room for alignment.\n+        REGION_SIZE = roundUp4k(NUM_ACCESS_ELEMENTS * 8 + 1024 + REGION_2_BYTE_OFFSET);\n+        ms = switch(BACKING_TYPE) {\n+            case \"native\"     -> Arena.ofAuto().allocate(2 * REGION_SIZE, 4 * 1024);\n+            case \"array_byte\" -> MemorySegment.ofArray(new byte[(int)(2 * REGION_SIZE)]);\n+            case \"array_int\"  -> MemorySegment.ofArray(new int[(int)(2 * REGION_SIZE \/ 4)]);\n+            case \"array_long\" -> MemorySegment.ofArray(new long[(int)(2 * REGION_SIZE \/ 8)]);\n+            default -> throw new RuntimeException(\"not implemented: \" + BACKING_TYPE);\n+        };\n+    }\n+\n+    \/\/ -------------------------------- BYTE ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_byte_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_BYTE, i + offset_store, (byte)0);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_byte_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_BYTE, i + offset_store, varB);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_zero_byte_MS_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            \/\/ The API does not allow us to fill a sub-segment directly, so we have to slice.\n+            MemorySegment slice = ms.asSlice(offset_store, NUM_ACCESS_ELEMENTS);\n+            slice.fill((byte)0);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_byte_MS_fill() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            \/\/ The API does not allow us to fill a sub-segment directly, so we have to slice.\n+            MemorySegment slice = ms.asSlice(offset_store, NUM_ACCESS_ELEMENTS);\n+            slice.fill(varB);\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_byte_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = offsetLoad(r);\n+            long offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                byte v = ms.get(ValueLayout.JAVA_BYTE, i + offset_load);\n+                ms.set(ValueLayout.JAVA_BYTE, i + offset_store, v);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_byte_MemorySegment_copy() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = offsetLoad(r);\n+            long offset_store = offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            MemorySegment.copy(ms, offset_load, ms, offset_store, NUM_ACCESS_ELEMENTS);\n+        }\n+    }\n+\n+    \/\/ -------------------------------- CHAR ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_char_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = 2L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_CHAR_UNALIGNED, 2L * i + offset_store, varC);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_char_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = 2L * offsetLoad(r);\n+            long offset_store = 2L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                char v = ms.get(ValueLayout.JAVA_CHAR_UNALIGNED, 2L * i + offset_load);\n+                ms.set(ValueLayout.JAVA_CHAR_UNALIGNED, 2L * i + offset_store, v);\n+            }\n+        }\n+    }\n+\n+    \/\/ -------------------------------- SHORT ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_short_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = 2L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_SHORT_UNALIGNED, 2L * i + offset_store, varS);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_short_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = 2L * offsetLoad(r);\n+            long offset_store = 2L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                short v = ms.get(ValueLayout.JAVA_SHORT_UNALIGNED, 2L * i + offset_load);\n+                ms.set(ValueLayout.JAVA_SHORT_UNALIGNED, 2L * i + offset_store, v);\n+            }\n+        }\n+    }\n+\n+    \/\/ -------------------------------- INT ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_int_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = 4L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_INT_UNALIGNED, 4L * i + offset_store, varI);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_int_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = 4L * offsetLoad(r);\n+            long offset_store = 4L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                int v = ms.get(ValueLayout.JAVA_INT_UNALIGNED, 4L * i + offset_load);\n+                ms.set(ValueLayout.JAVA_INT_UNALIGNED, 4L * i + offset_store, v);\n+            }\n+        }\n+    }\n+\n+    \/\/ -------------------------------- LONG ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_long_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = 8L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_LONG_UNALIGNED, 8L * i + offset_store, varL);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_long_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = 8L * offsetLoad(r);\n+            long offset_store = 8L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                long v = ms.get(ValueLayout.JAVA_LONG_UNALIGNED, 8L * i + offset_load);\n+                ms.set(ValueLayout.JAVA_LONG_UNALIGNED, 8L * i + offset_store, v);\n+            }\n+        }\n+    }\n+\n+    \/\/ -------------------------------- FLOAT ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_float_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = 4L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_FLOAT_UNALIGNED, 4L * i + offset_store, varS);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_float_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = 4L * offsetLoad(r);\n+            long offset_store = 4L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                float v = ms.get(ValueLayout.JAVA_FLOAT_UNALIGNED, 4L * i + offset_load);\n+                ms.set(ValueLayout.JAVA_FLOAT_UNALIGNED, 4L * i + offset_store, v);\n+            }\n+        }\n+    }\n+\n+    \/\/ -------------------------------- DOUBLE ------------------------------\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void fill_var_double_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_store = 8L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                ms.set(ValueLayout.JAVA_DOUBLE_UNALIGNED, 8L * i + offset_store, varS);\n+            }\n+        }\n+    }\n+\n+    @Benchmark\n+    @OperationsPerInvocation(REPETITIONS)\n+    public void copy_double_loop() {\n+        for (int r = 0; r < REPETITIONS; r++) {\n+            long offset_load = 8L * offsetLoad(r);\n+            long offset_store = 8L * offsetStore(r) + REGION_SIZE + REGION_2_BYTE_OFFSET;\n+            for (long i = 0; i < NUM_ACCESS_ELEMENTS; i++) {\n+                double v = ms.get(ValueLayout.JAVA_DOUBLE_UNALIGNED, 8L * i + offset_load);\n+                ms.set(ValueLayout.JAVA_DOUBLE_UNALIGNED, 8L * i + offset_store, v);\n+            }\n+        }\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/vm\/compiler\/VectorBulkOperationsMemorySegment.java","additions":374,"deletions":0,"binary":false,"changes":374,"status":"added"}]}