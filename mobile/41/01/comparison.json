{"files":[{"patch":"@@ -26,1 +26,0 @@\n-#include <stdbool.h>\n@@ -245,18 +244,5 @@\n-    \/\/ Some macOS versions require special handling. For example,\n-    \/\/ when the NSOperatingSystemVersion reports 10.16 as the version\n-    \/\/ then it should be treated as 11. Similarly, when it reports 16.0\n-    \/\/ as the version then it should be treated as 26.\n-    \/\/ If the SYSTEM_VERSION_COMPAT environment variable (a macOS construct)\n-    \/\/ is set to 1, then we don't do any special handling for any versions\n-    \/\/ and just literally use the value that NSOperatingSystemVersion reports.\n-    const char* envVal = getenv(\"SYSTEM_VERSION_COMPAT\");\n-    const bool versionCompatEnabled = envVal != NULL\n-                                      && strncmp(envVal, \"1\", 1) == 0;\n-    const bool requiresSpecialHandling =\n-            ((long) osVer.majorVersion == 10 && (long) osVer.minorVersion >= 16)\n-            || ((long) osVer.majorVersion == 16 && (long) osVer.minorVersion >= 0);\n-    if (!requiresSpecialHandling || versionCompatEnabled) {\n-        \/\/ no special handling - just use the version reported\n-        \/\/ by NSOperatingSystemVersion\n-        if (osVer.patchVersion == 0) {\n-            \/\/ Omit trailing \".0\"\n+    \/\/ Copy out the char* if running on version other than 10.16 Mac OS (10.16 == 11.x)\n+    \/\/ or explicitly requesting version compatibility\n+    if (!((long)osVer.majorVersion == 10 && (long)osVer.minorVersion >= 16) ||\n+            (getenv(\"SYSTEM_VERSION_COMPAT\") != NULL)) {\n+        if (osVer.patchVersion == 0) { \/\/ Omit trailing \".0\"\n@@ -267,2 +253,1 @@\n-                    (long)osVer.majorVersion, (long)osVer.minorVersion,\n-                    (long)osVer.patchVersion];\n+                    (long)osVer.majorVersion, (long)osVer.minorVersion, (long)osVer.patchVersion];\n@@ -271,8 +256,5 @@\n-        \/\/ Requires special handling. We ignore the version reported\n-        \/\/ by the NSOperatingSystemVersion API and instead read the\n-        \/\/ *real* ProductVersion from\n-        \/\/ \/System\/Library\/CoreServices\/.SystemVersionPlatform.plist.\n-        \/\/ If not found there, then as a last resort we fallback to\n-        \/\/ \/System\/Library\/CoreServices\/SystemVersion.plist\n-        NSDictionary *version = [NSDictionary dictionaryWithContentsOfFile:\n-            @\"\/System\/Library\/CoreServices\/.SystemVersionPlatform.plist\"];\n+        \/\/ Version 10.16, without explicit env setting of SYSTEM_VERSION_COMPAT\n+        \/\/ AKA 11+ Read the *real* ProductVersion from the hidden link to avoid SYSTEM_VERSION_COMPAT\n+        \/\/ If not found, fallback below to the SystemVersion.plist\n+        NSDictionary *version = [NSDictionary dictionaryWithContentsOfFile :\n+                         @\"\/System\/Library\/CoreServices\/.SystemVersionPlatform.plist\"];\n@@ -280,1 +262,1 @@\n-            nsVerStr = [version objectForKey: @\"ProductVersion\"];\n+            nsVerStr = [version objectForKey : @\"ProductVersion\"];\n@@ -283,1 +265,1 @@\n-    \/\/ Last resort - fallback to reading the SystemVersion.plist\n+    \/\/ Fallback to reading the SystemVersion.plist\n@@ -285,2 +267,2 @@\n-        NSDictionary *version = [NSDictionary dictionaryWithContentsOfFile:\n-            @\"\/System\/Library\/CoreServices\/SystemVersion.plist\"];\n+        NSDictionary *version = [NSDictionary dictionaryWithContentsOfFile :\n+                                 @\"\/System\/Library\/CoreServices\/SystemVersion.plist\"];\n@@ -288,1 +270,1 @@\n-            nsVerStr = [version objectForKey: @\"ProductVersion\"];\n+            nsVerStr = [version objectForKey : @\"ProductVersion\"];\n","filename":"src\/java.base\/macosx\/native\/libjava\/java_props_macosx.c","additions":16,"deletions":34,"binary":false,"changes":50,"status":"modified"}]}