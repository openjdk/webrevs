{"files":[{"patch":"@@ -101,0 +101,3 @@\n+#ifdef _WIN32\n+extern LONG WINAPI topLevelExceptionFilter(_EXCEPTION_POINTERS* );\n+#endif\n@@ -5255,1 +5258,1 @@\n-_JNI_IMPORT_OR_EXPORT_ jint JNICALL JNI_CreateJavaVM(JavaVM **vm, void **penv, void *args) {\n+static jint JNI_CreateJavaVM_inner(JavaVM **vm, void **penv, void *args) {\n@@ -5259,2 +5262,1 @@\n-  HOTSPOT_JNI_CREATEJAVAVM_ENTRY(\n-                                 (void **) vm, penv, args);\n+  HOTSPOT_JNI_CREATEJAVAVM_ENTRY((void **) vm, penv, args);\n@@ -5332,4 +5334,0 @@\n-  #ifndef CALL_TEST_FUNC_WITH_WRAPPER_IF_NEEDED\n-    #define CALL_TEST_FUNC_WITH_WRAPPER_IF_NEEDED(f) f()\n-  #endif\n-\n@@ -5342,2 +5340,2 @@\n-    CALL_TEST_FUNC_WITH_WRAPPER_IF_NEEDED(test_error_handler);\n-    CALL_TEST_FUNC_WITH_WRAPPER_IF_NEEDED(execute_internal_vm_tests);\n+    test_error_handler();\n+    execute_internal_vm_tests();\n@@ -5363,0 +5361,16 @@\n+\n+}\n+\n+_JNI_IMPORT_OR_EXPORT_ jint JNICALL JNI_CreateJavaVM(JavaVM **vm, void **penv, void *args) {\n+  jint result = JNI_ERR;\n+  \/\/ On Windows, let CreateJavaVM run with SEH protection\n+#ifdef _WIN32\n+  __try {\n+#endif\n+    result = JNI_CreateJavaVM_inner(vm, penv, args);\n+#ifdef _WIN32\n+  } __except(topLevelExceptionFilter((_EXCEPTION_POINTERS*)_exception_info())) {\n+    \/\/ Nothing to do.\n+  }\n+#endif\n+  return result;\n@@ -5405,1 +5419,1 @@\n-jint JNICALL jni_DestroyJavaVM(JavaVM *vm) {\n+static jint JNICALL jni_DestroyJavaVM_inner(JavaVM *vm) {\n@@ -5409,2 +5423,1 @@\n-  HOTSPOT_JNI_DESTROYJAVAVM_ENTRY(\n-                                  vm);\n+  HOTSPOT_JNI_DESTROYJAVAVM_ENTRY(vm);\n@@ -5446,0 +5459,14 @@\n+jint JNICALL jni_DestroyJavaVM(JavaVM *vm) {\n+  jint result = JNI_ERR;\n+  \/\/ On Windows, we need SEH protection\n+#ifdef _WIN32\n+  __try {\n+#endif\n+    result = jni_DestroyJavaVM_inner(vm);\n+#ifdef _WIN32\n+  } __except(topLevelExceptionFilter((_EXCEPTION_POINTERS*)_exception_info())) {\n+    \/\/ Nothing to do.\n+  }\n+#endif\n+  return result;\n+}\n","filename":"hotspot\/src\/share\/vm\/prims\/jni.cpp","additions":39,"deletions":12,"binary":false,"changes":51,"status":"modified"}]}