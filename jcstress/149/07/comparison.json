{"files":[{"patch":"@@ -59,0 +59,29 @@\n+        ConfigsWithScheduler configs = getConfigs();\n+        if (configs == null) {\n+            return;\n+        }\n+\n+        TimeBudget timeBudget = new TimeBudget(configsWithScheduler.configs.size(), opts.timeBudget());\n+        timeBudget.printOn(out);\n+\n+        ConsoleReportPrinter printer = new ConsoleReportPrinter(opts, new PrintWriter(out, true), configsWithScheduler.configs.size(), timeBudget);\n+        DiskWriteCollector diskCollector = new DiskWriteCollector(opts.getResultFile());\n+        TestResultCollector mux = MuxCollector.of(printer, diskCollector);\n+        SerializedBufferCollector sink = new SerializedBufferCollector(mux);\n+\n+        TestExecutor executor = new TestExecutor(opts.verbosity(), sink, configsWithScheduler.scheduler, timeBudget);\n+        printer.setExecutor(executor);\n+\n+        executor.runAll(configsWithScheduler.configs);\n+\n+        sink.close();\n+        diskCollector.close();\n+\n+        printer.printFinishLine();\n+\n+        out.println();\n+        out.println();\n+\n+        parseResults();\n+    }\n+    public ConfigsWithScheduler getConfigs() {\n@@ -66,1 +95,1 @@\n-            return;\n+            return null;\n@@ -86,1 +115,1 @@\n-            return;\n+            return null;\n@@ -89,17 +118,2 @@\n-        TimeBudget timeBudget = new TimeBudget(configs.size(), opts.timeBudget());\n-        timeBudget.printOn(out);\n-\n-        ConsoleReportPrinter printer = new ConsoleReportPrinter(opts, new PrintWriter(out, true), configs.size(), timeBudget);\n-        DiskWriteCollector diskCollector = new DiskWriteCollector(opts.getResultFile());\n-        TestResultCollector mux = MuxCollector.of(printer, diskCollector);\n-        SerializedBufferCollector sink = new SerializedBufferCollector(mux);\n-\n-        TestExecutor executor = new TestExecutor(opts.verbosity(), sink, scheduler, timeBudget);\n-        printer.setExecutor(executor);\n-\n-        executor.runAll(configs);\n-\n-        sink.close();\n-        diskCollector.close();\n-\n-        printer.printFinishLine();\n+        return new ConfigsWithScheduler(scheduler, configs);\n+    }\n@@ -107,2 +121,3 @@\n-        out.println();\n-        out.println();\n+    public static class ConfigsWithScheduler {\n+        public final Scheduler scheduler;\n+        public final List<TestConfig> configs;\n@@ -110,1 +125,4 @@\n-        parseResults();\n+        public ConfigsWithScheduler(Scheduler scheduler, List<TestConfig> configs) {\n+            this.scheduler = scheduler;\n+            this.configs = configs;\n+        }\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/JCStress.java","additions":40,"deletions":22,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -27,0 +27,2 @@\n+import org.openjdk.jcstress.infra.runners.TestConfig;\n+\n@@ -31,0 +33,2 @@\n+import java.util.Set;\n+import java.util.TreeSet;\n@@ -54,3 +58,1 @@\n-            for (String test : jcstress.getTests()) {\n-                System.out.println(test);\n-            }\n+            listTests(opts, jcstress);\n@@ -64,0 +66,20 @@\n+    private static void listTests(Options opts, JCStress jcstress) {\n+        JCStress.ConfigsWithScheduler configsWithScheduler = jcstress.getConfigs();\n+        Set<String> testsToPrint = new TreeSet<>();\n+        for (TestConfig test : configsWithScheduler.configs) {\n+            if (opts.verbosity().printAllTests()) {\n+                testsToPrint.add(test.toDetailedTest());\n+            } else {\n+                testsToPrint.add(test.name);\n+            }\n+        }\n+        if (opts.verbosity().printAllTests()) {\n+            System.out.println(\"All matching tests combinations - \" + testsToPrint.size());\n+        } else {\n+            System.out.println(\"All matching tests - \" + testsToPrint.size());\n+        }\n+        for (String test : testsToPrint) {\n+            System.out.println(test);\n+        }\n+    }\n+\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/Main.java","additions":25,"deletions":3,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -42,1 +42,0 @@\n-import java.util.concurrent.TimeUnit;\n@@ -85,1 +84,2 @@\n-        OptionSpec<Boolean> list = parser.accepts(\"l\", \"List the available tests matching the requested settings.\")\n+        OptionSpec<Boolean> list = parser.accepts(\"l\", \"List the available tests matching the requested settings, \" +\n+                        \"after all filters (like CPU count) are applied. In verbose mode it prints all real combinations which will run.\")\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/Options.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -247,0 +247,22 @@\n+\n+\n+    public String toDetailedTest() {\n+        \/\/binaryName have correct $ instead of . in name; omitted\n+        \/\/generatedRunnerName name with suffix (usually _Test_jcstress) omitted\n+        \/\/super.toString() as TestConfig@hash - omitted\n+        StringBuilder verboseOutput = new StringBuilder(name);\n+        verboseOutput.append(\" {\")\n+                .append(actorNames)\n+                .append(\", spinLoopStyle: \").append(spinLoopStyle)\n+                .append(\", threads: \").append(threads)\n+                .append(\", forkId: \").append(forkId)\n+                .append(\", maxFootprintMB: \").append(maxFootprintMB)\n+                .append(\", compileMode: \").append(compileMode)\n+                .append(\", shClass: \").append(shClass)\n+                .append(\", strideSize: \").append(strideSize)\n+                .append(\", strideCount: \").append(strideCount)\n+                .append(\", cpuMap: \").append(cpuMap)\n+                .append(\", \").append(jvmArgs)\n+                .append(\"}\");\n+        return verboseOutput.toString();\n+    }\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/infra\/runners\/TestConfig.java","additions":22,"deletions":0,"binary":false,"changes":22,"status":"modified"}]}