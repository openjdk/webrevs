{"files":[{"patch":"@@ -44,2 +44,6 @@\n-                \"org.openjdk.jcstress.tests.seqcst.volatiles\",\n-                Target.VOLATILE);\n+                \"org.openjdk.jcstress.tests.seqcst.volatiles.prim\",\n+                Target.VOLATILE_PRIM);\n+        SeqCstTraceGenerator.generate(\n+                dst,\n+                \"org.openjdk.jcstress.tests.seqcst.volatiles.ref\",\n+                Target.VOLATILE_REF);\n","filename":"jcstress-test-gen\/src\/main\/java\/org\/openjdk\/jcstress\/chapters\/Chapter0bTestGenerator.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -183,1 +183,11 @@\n-        Arrays.fill(klasses, int.class);\n+        switch (target) {\n+            case SYNCHRONIZED:\n+            case VOLATILE_PRIM:\n+                Arrays.fill(klasses, int.class);\n+                break;\n+            case VOLATILE_REF:\n+                Arrays.fill(klasses, Object.class);\n+                break;\n+            default:\n+                throw new IllegalStateException(\"Unknown target: \" + target);\n+        }\n@@ -210,1 +220,1 @@\n-                mappedValues.add(v.toString());\n+                mappedValues.add(convertValue(v));\n@@ -213,1 +223,1 @@\n-                mappedValues.add(v.toString());\n+                mappedValues.add(convertValue(v));\n@@ -228,1 +238,1 @@\n-                        case VOLATILE:\n+                        case VOLATILE_PRIM:\n@@ -231,0 +241,3 @@\n+                        case VOLATILE_REF:\n+                            pw.println(\"    volatile String x\" + op.getVarId() + \";\");\n+                            break;\n@@ -266,1 +279,2 @@\n-                        pw.println(\"        x\" + op.getVarId() + \" = \" + op.getValue() + \";\");\n+                        String quotes = (target == Target.VOLATILE_REF) ? \"\\\"\" : \"\";\n+                        pw.println(\"        x\" + op.getVarId() + \" = \" + quotes + op.getValue() + quotes + \";\");\n@@ -300,0 +314,12 @@\n+    private String convertValue(Value v) {\n+        switch (target) {\n+            case SYNCHRONIZED:\n+            case VOLATILE_PRIM:\n+                return v.toString();\n+            case VOLATILE_REF:\n+                return v.equals(Value.defaultOne()) ? \"null\" : v.toString();\n+            default:\n+                throw new IllegalStateException(\"Unknown target: \" + target);\n+        }\n+    }\n+\n","filename":"jcstress-test-gen\/src\/main\/java\/org\/openjdk\/jcstress\/generator\/seqcst\/SeqCstTraceGenerator.java","additions":31,"deletions":5,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -28,1 +28,2 @@\n-    VOLATILE,\n+    VOLATILE_PRIM,\n+    VOLATILE_REF,\n","filename":"jcstress-test-gen\/src\/main\/java\/org\/openjdk\/jcstress\/generator\/seqcst\/Target.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}