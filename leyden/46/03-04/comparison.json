{"files":[{"patch":"@@ -40,2 +40,8 @@\n-JMODS_DIR := $(IMAGES_OUTPUTDIR)\/jmods\n-JMODS_SUPPORT_DIR := $(SUPPORT_OUTPUTDIR)\/images\/jmods\n+ifeq ($(STATIC_JMOD), true)\n+  JMODS_DIR := $(IMAGES_OUTPUTDIR)\/static-jmods\n+  JMODS_SUPPORT_DIR := $(SUPPORT_OUTPUTDIR)\/images\/static-jmods\n+  JMOD_TYPE_MSG := static $(SPACE)\n+else\n+  JMODS_DIR := $(IMAGES_OUTPUTDIR)\/jmods\n+  JMODS_SUPPORT_DIR := $(SUPPORT_OUTPUTDIR)\/images\/jmods\n+endif\n@@ -46,0 +52,2 @@\n+STATIC_LIBS_DIR ?= $(firstword $(wildcard $(addsuffix \/$(MODULE), \\\n+    $(SUPPORT_OUTPUTDIR)\/modules_static-libs $(IMPORT_MODULES_STATIC_LIBS))))\n@@ -57,1 +65,1 @@\n-    $(LIBS_DIR) $(CMDS_DIR) $(CONF_DIR) $(CLASSES_DIR) \\\n+    $(LIBS_DIR) $(STATIC_LIBS_DIR) $(CMDS_DIR) $(CONF_DIR) $(CLASSES_DIR) \\\n@@ -80,0 +88,16 @@\n+\n+ifeq ($(STATIC_JMOD), true)\n+  ifneq ($(STATIC_LIBS_DIR), )\n+    STATIC_LIB_FILES := $(filter %$(STATIC_LIBRARY_SUFFIX), \\\n+          $(call FindFiles, $(SUPPORT_OUTPUTDIR)\/native\/$(MODULE)\/*\/static))\n+    $(eval $(call SetupCopyFiles, COPY_STATIC_LIBS, \\\n+        FLATTEN := true, \\\n+        SRC := $(SUPPORT_OUTPUTDIR)\/native\/$(MODULE), \\\n+        DEST := $(SUPPORT_OUTPUTDIR)\/modules_static-libs\/$(MODULE), \\\n+        FILES := $(STATIC_LIB_FILES), \\\n+    ))\n+    DEPS += $(COPY_STATIC_LIBS)\n+    JMOD_FLAGS += --static-libs $(STATIC_LIBS_DIR)\n+  endif\n+endif\n+\n@@ -214,1 +238,1 @@\n-  INTERIM_MSG := interim$(SPACE)\n+  JMOD_TYPE_MSG := interim$(SPACE)\n@@ -257,1 +281,1 @@\n-    WARN := Creating $(INTERIM_MSG)$(JMOD_FILE), \\\n+    WARN := Creating $(JMOD_TYPE_MSG)$(JMOD_FILE), \\\n","filename":"make\/CreateJmods.gmk","additions":29,"deletions":5,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -388,0 +388,1 @@\n+STATIC_JMOD_TARGETS := $(addsuffix -static-jmod, $(JMOD_MODULES))\n@@ -394,0 +395,4 @@\n+  $1-static-jmod:\n+\t+($(CD) $(TOPDIR)\/make && $(MAKE) $(MAKE_ARGS) \\\n+\t    $(patsubst %,-I%\/modules\/$1,$(PHASE_MAKEDIRS)) \\\n+\t    -f CreateJmods.gmk MODULE=$1 STATIC_JMOD=true)\n@@ -398,1 +403,1 @@\n-ALL_TARGETS += $(JMOD_TARGETS)\n+ALL_TARGETS += $(JMOD_TARGETS) $(STATIC_JMOD_TARGETS)\n@@ -1017,0 +1022,4 @@\n+    java.base-static-jmod: jrtfs-jar $(addsuffix -static-jmod, $(filter-out java.base, $(sort \\\n+        $(foreach m, $(filter-out $(call FindAllUpgradeableModules), $(JMOD_MODULES)), \\\n+          $m $(call FindTransitiveDepsForModules, $m) \\\n+        ))))\n@@ -1024,0 +1033,1 @@\n+  java.base-static-jmod: $(JVM_MAIN_TARGETS)\n@@ -1031,0 +1041,1 @@\n+\n@@ -1032,0 +1043,4 @@\n+\n+  $(foreach m, $(STATIC_LIBS_MODULES), $(eval $m_STATIC_JMOD_DEPS += $m-static-libs))\n+  $(foreach m, $(ALL_MODULES), $(eval $m-static-jmod: $($(m)_JMOD_DEPS) $($(m)_STATIC_JMOD_DEPS)))\n+\n@@ -1062,1 +1077,1 @@\n-      $(JMOD_TARGETS): create-buildjdk\n+      $(JMOD_TARGETS) $(STATIC_JMOD_TARGETS): create-buildjdk\n@@ -1073,1 +1088,1 @@\n-      $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): java.base-libs java.base-copy \\\n+      $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS) $(STATIC_JMOD_TARGETS): java.base-libs java.base-copy \\\n@@ -1079,1 +1094,1 @@\n-    $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): exploded-image\n+    $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS) $(STATIC_JMOD_TARGETS): exploded-image\n@@ -1086,1 +1101,1 @@\n-  $(JMOD_TARGETS): java.base-copy\n+  $(JMOD_TARGETS) $(STATIC_JMOD_TARGETS): java.base-copy\n@@ -1105,2 +1120,4 @@\n-    # The generated classlist needs to go into java.base-jmod.\n-    java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data\n+    # The generated classlist is needed by images and core jmods.\n+    java.base-jmod jdk.jlink-jmod: generate-link-opt-data\n+    java.base-static-jmod jdk.jlink-static-jmod: generate-link-opt-data\n+    jdk-image legacy-jre-image: generate-link-opt-data\n@@ -1182,0 +1199,2 @@\n+static-jmods: $(STATIC_JMOD_TARGETS)\n+\n@@ -1192,0 +1211,1 @@\n+$(foreach m, $(STATIC_LIBS_MODULES), $(eval $m: $m-static-libs))\n@@ -1334,1 +1354,1 @@\n-    copy java libs static-libs launchers jmods \\\n+    copy java libs static-libs launchers jmods static-jmods \\\n","filename":"make\/Main.gmk","additions":28,"deletions":8,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -68,0 +68,3 @@\n+  if test -d \"$IMPORT_MODULES_TOPDIR\/modules_libs\"; then\n+    IMPORT_MODULES_STATIC_LIBS=\"$IMPORT_MODULES_TOPDIR\/modules_static-libs\"\n+  fi\n@@ -87,0 +90,1 @@\n+  AC_SUBST(IMPORT_MODULES_STATIC_LIBS)\n","filename":"make\/autoconf\/source-dirs.m4","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -179,0 +179,1 @@\n+IMPORT_MODULES_STATIC_LIBS := @IMPORT_MODULES_STATIC_LIBS@\n","filename":"make\/autoconf\/spec.gmk.template","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}