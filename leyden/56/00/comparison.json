{"files":[{"patch":"@@ -460,0 +460,5 @@\n+  if (ref->msotype() == MetaspaceObj::MethodDataType) {\n+    MethodData* md = (MethodData*)ref->obj();\n+    md->clean_method_data(true);\n+  }\n+\n","filename":"src\/hotspot\/share\/cds\/archiveBuilder.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"classfile\/systemDictionaryShared.hpp\"\n@@ -1841,1 +1842,2 @@\n-    lock = new Mutex(Mutex::nosafepoint, \"MDOExtraData_lock\");\n+    \/\/ This lock could be acquired while we are holding DumpTimeTable_lock\/nosafepoint\n+    lock = new Mutex(Mutex::nosafepoint-1, \"MDOExtraData_lock\");\n@@ -1867,1 +1869,6 @@\n-      if (!cl->is_live(m)) {\n+      bool exclude = false;\n+      if (SafepointSynchronize::is_at_safepoint() && CDSConfig::is_dumping_archive()) {\n+        InstanceKlass* holder = m->method_holder();\n+        exclude = (holder == nullptr || !holder->is_loaded() || SystemDictionaryShared::check_for_exclusion(holder, nullptr));\n+      }\n+      if (exclude || !cl->is_live(m)) {\n","filename":"src\/hotspot\/share\/oops\/methodData.cpp","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -208,0 +208,3 @@\n+  if (m->method_holder() == nullptr) {\n+    return nullptr; \/\/ do not record (dynamically generated method)\n+  }\n","filename":"src\/hotspot\/share\/oops\/trainingData.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}