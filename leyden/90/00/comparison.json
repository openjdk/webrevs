{"files":[{"patch":"@@ -966,1 +966,1 @@\n-    _load_entries = (AOTCodeEntry*)(_search_entries + 2 * count);\n+    _load_entries = (AOTCodeEntry*)(align_up(_search_entries + 2 * count, DATA_ALIGNMENT));\n@@ -1034,1 +1034,1 @@\n-  assert(entry->is_loaded(), \"invalidate only AOT code in use\");\n+  assert(entry->is_loaded() || entry->for_preload(), \"invalidate only AOT code in use or a preload code\");\n@@ -1072,7 +1072,0 @@\n-void AOTCodeEntry::update_method_for_writing() {\n-  if (_method != nullptr) {\n-    _method_offset = AOTCacheAccess::delta_from_base_address((address)_method);\n-    _method = nullptr;\n-  }\n-}\n-\n@@ -1085,0 +1078,9 @@\n+void AOTCodeCache::mark_method_pointer(AOTCodeEntry* entries, int count) {\n+  for (int i = 0; i < count; i++) {\n+    Method* m = entries[i].method();\n+    if (m != nullptr) {\n+      AOTCacheAccess::set_pointer(entries[i].method_addr(), m);\n+    }\n+  }\n+}\n+\n@@ -1163,1 +1165,0 @@\n-        entry->update_method_for_writing();\n@@ -1223,0 +1224,1 @@\n+    current = align_up(current, DATA_ALIGNMENT);\n@@ -1225,0 +1227,1 @@\n+    mark_method_pointer((AOTCodeEntry*)current, entries_count);\n@@ -1924,1 +1927,1 @@\n-    _load_entries = (AOTCodeEntry*)(_search_entries + 2 * count);\n+    _load_entries = (AOTCodeEntry*)(align_up(_search_entries + 2 * count, DATA_ALIGNMENT));\n@@ -1938,2 +1941,0 @@\n-      Method* m = AOTCacheAccess::convert_offset_to_method(entry->method_offset());\n-      entry->set_method(m);\n","filename":"src\/hotspot\/share\/code\/aotCodeCache.cpp","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -96,1 +96,0 @@\n-  uint   _method_offset;\n@@ -186,1 +185,2 @@\n-  Method*   method()  const { return _method; }\n+  Method* method()  const { return _method; }\n+  Method** method_addr() { return &_method; }\n@@ -188,2 +188,0 @@\n-  void update_method_for_writing();\n-  uint method_offset() const { return _method_offset; }\n@@ -528,0 +526,2 @@\n+  void mark_method_pointer(AOTCodeEntry* entries, int count);\n+\n","filename":"src\/hotspot\/share\/code\/aotCodeCache.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}