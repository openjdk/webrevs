{"files":[{"patch":"@@ -929,1 +929,1 @@\n-    uint hash = java_lang_String::hash_code((const jbyte*)target_name, (int)strlen(target_name));\n+    uint hash = (uint)pointer_delta((address)method(), (address)SharedBaseAddress, 1);\n@@ -934,7 +934,2 @@\n-    } else {\n-      uint name_offset = entry->offset() + entry->name_offset();\n-      uint name_size   = entry->name_size(); \/\/ Includes '\/0'\n-      const char* name = _cache->cache_buffer() + name_offset;\n-      if (strncmp(target_name, name, name_size) != 0) {\n-        assert(false, \"AOTCodeCache: saved nmethod's name '%s' is different from '%s', hash: \" UINT32_FORMAT_X_0, name, target_name, hash);\n-      }\n+    } else if (method() != entry->method()) {\n+      assert(false, \"AOTCodeCache: saved nmethod's method %p (hash: \" UINT32_FORMAT_X_0 \") is different from the method %p being looked up\" , entry->method(), hash, method());\n@@ -1631,1 +1626,0 @@\n-  bool method_in_cds = MetaspaceShared::is_in_shared_metaspace((address)method);\n@@ -1633,1 +1627,0 @@\n-  bool klass_in_cds = holder->is_shared() && !holder->defined_by_other_loaders();\n@@ -1641,7 +1634,1 @@\n-  if (for_preload && !(method_in_cds && klass_in_cds)) {\n-    ResourceMark rm;\n-    log_info(aot, codecache, nmethod)(\"%d (L%d): Skip method '%s' for preload: not in CDS\", comp_id, (int)comp_level, method->name_and_sig_as_C_string());\n-    assert(!for_preload || (method_in_cds && klass_in_cds), \"sanity\");\n-    return nullptr;\n-  }\n-  assert(!for_preload || (method_in_cds && klass_in_cds), \"sanity\");\n+\n@@ -1695,1 +1682,0 @@\n-    hash = java_lang_String::hash_code((const jbyte*)name, (int)strlen(name));\n@@ -1697,0 +1683,1 @@\n+  hash = AOTCacheAccess::delta_from_base_address((address)nm->method());\n@@ -1779,3 +1766,1 @@\n-  if (method_in_cds) {\n-    entry->set_method(method);\n-  }\n+  entry->set_method(method);\n@@ -1820,1 +1805,1 @@\n-    uint hash = java_lang_String::hash_code((const jbyte*)target_name, (int)strlen(target_name));\n+    uint hash = (uint)pointer_delta((address)method(), (address)SharedBaseAddress, 1);\n","filename":"src\/hotspot\/share\/code\/aotCodeCache.cpp","additions":7,"deletions":22,"binary":false,"changes":29,"status":"modified"}]}