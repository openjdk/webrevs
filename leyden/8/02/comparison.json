{"files":[{"patch":"@@ -235,1 +235,2 @@\n-### Only G1GC, SerialGC, ParallelGC, EpsilonGC are Supported\n+### Only G1GC, SerialGC, ParallelGC, EpsilonGC, ShenandoahGC are Supported\n+=======\n@@ -244,1 +245,1 @@\n-must be G1, Parallel, Serial, or Epsilon\n+must be G1, Parallel, Serial, Epsilon, or Shenandoah\n","filename":"README.md","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -147,1 +147,1 @@\n-  \/\/ Can this VM write a heap region into the CDS archive? Currently only {G1|Parallel|Serial|Epsilon}+compressed_cp\n+  \/\/ Can this VM write a heap region into the CDS archive? Currently only {G1|Parallel|Serial|Epsilon|Shenandoah}+compressed_cp\n@@ -153,1 +153,1 @@\n-      return (UseG1GC || UseParallelGC || UseSerialGC || UseEpsilonGC) && UseCompressedClassPointers;\n+      return (UseG1GC || UseParallelGC || UseSerialGC || UseEpsilonGC || UseShenandoahGC) && UseCompressedClassPointers;\n","filename":"src\/hotspot\/share\/cds\/heapShared.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -276,1 +276,1 @@\n-    if (!((UseG1GC || UseParallelGC || UseSerialGC || UseEpsilonGC) && UseCompressedClassPointers)) {\n+    if (!((UseG1GC || UseParallelGC || UseSerialGC || UseEpsilonGC || UseShenandoahGC) && UseCompressedClassPointers)) {\n@@ -278,1 +278,1 @@\n-                                    \"UseCompressedClassPointers must be enabled, and collector must be G1, Parallel, Serial, or Epsilon\");\n+                                    \"UseCompressedClassPointers must be enabled, and collector must be G1, Parallel, Serial, Epsilon, or Shenandoah\");\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -78,0 +78,3 @@\n+#if INCLUDE_SHENANDOAHGC\n+#include \"gc\/shenandoah\/c1\/shenandoahBarrierSetC1.hpp\"\n+#endif\n@@ -86,0 +89,3 @@\n+#if INCLUDE_SHENANDOAHGC\n+#include \"gc\/shenandoah\/shenandoahRuntime.hpp\"\n+#endif\n@@ -3520,3 +3526,3 @@\n-#define _blobs_max 80\n-#define _shared_blobs_max 15\n-#define _C2_blobs_max 22\n+#define _blobs_max 100\n+#define _shared_blobs_max 24\n+#define _C2_blobs_max 25\n@@ -3524,1 +3530,1 @@\n-#define _all_max 280\n+#define _all_max 300\n@@ -3566,0 +3572,13 @@\n+#if INCLUDE_SHENANDOAHGC\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::arraycopy_barrier_oop_entry);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::arraycopy_barrier_narrow_oop_entry);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::write_ref_field_pre_entry);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::shenandoah_clone_barrier);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::load_reference_barrier_strong);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::load_reference_barrier_strong_narrow);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::load_reference_barrier_weak);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::load_reference_barrier_weak_narrow);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::load_reference_barrier_phantom);\n+  SET_ADDRESS(_extrs, ShenandoahRuntime::load_reference_barrier_phantom_narrow);\n+#endif\n+\n@@ -3897,0 +3916,10 @@\n+#if INCLUDE_SHENANDOAHGC\n+  if (UseShenandoahGC) {\n+    ShenandoahBarrierSetC1* bs = (ShenandoahBarrierSetC1*)BarrierSet::barrier_set()->barrier_set_c1();\n+    SET_ADDRESS(_C1_blobs, bs->pre_barrier_c1_runtime_code_blob()->code_begin());\n+    SET_ADDRESS(_C1_blobs, bs->load_reference_barrier_strong_rt_code_blob()->code_begin());\n+    SET_ADDRESS(_C1_blobs, bs->load_reference_barrier_strong_native_rt_code_blob()->code_begin());\n+    SET_ADDRESS(_C1_blobs, bs->load_reference_barrier_weak_rt_code_blob()->code_begin());\n+    SET_ADDRESS(_C1_blobs, bs->load_reference_barrier_phantom_rt_code_blob()->code_begin());\n+  }\n+#endif \/\/ INCLUDE_SHENANDOAHGC\n","filename":"src\/hotspot\/share\/code\/SCCache.cpp","additions":33,"deletions":4,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -192,0 +192,2 @@\n+class SCAddressTable;\n+\n@@ -193,0 +195,1 @@\n+  friend class SCAddressTable;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c1\/shenandoahBarrierSetC1.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -30,3 +30,0 @@\n- * @requires vm.gc.ZSinglegen\n- * @requires vm.gc.Serial\n- * @requires vm.gc.Parallel\n@@ -35,0 +32,1 @@\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n@@ -36,1 +34,1 @@\n- * @run driver LeydenGCFlags\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI LeydenGCFlags\n@@ -39,0 +37,3 @@\n+import jdk.test.whitebox.WhiteBox;\n+import jdk.test.whitebox.gc.GC;\n+\n@@ -47,1 +48,1 @@\n-    static final String ERROR_GC_SUPPORTED = \"Cannot create the CacheDataStore: UseCompressedClassPointers must be enabled, and collector must be G1, Parallel, Serial, or Epsilon\";\n+    static final String ERROR_GC_SUPPORTED = \"Cannot create the CacheDataStore: UseCompressedClassPointers must be enabled, and collector must be G1, Parallel, Serial, Epsilon, or Shenandoah\";\n@@ -58,2 +59,4 @@\n-        \/\/ ZGC not supported for now\n-        fail_dump(\"-XX:+UseZGC\",  \"-Xmx8g\",  ERROR_GC_SUPPORTED);\n+        if (GC.Z.isSupported()) {\n+            \/\/ ZGC not supported for now\n+            fail_dump(\"-XX:+UseZGC\",  \"-Xmx8g\",  ERROR_GC_SUPPORTED);\n+        }\n@@ -61,4 +64,11 @@\n-        \/\/ Serial and Parallel collector are allowed to be used, as long as the same one is used\n-        \/\/ between training and production\n-        good(\"-XX:+UseSerialGC\",   \"-XX:+UseSerialGC\");\n-        good(\"-XX:+UseParallelGC\", \"-XX:+UseParallelGC\");\n+        \/\/ Serial, Parallel and Shenandoah collectors are allowed to be used,\n+        \/\/ as long as the same one is used between training and production\n+        if (GC.Serial.isSupported()) {\n+            good(\"-XX:+UseSerialGC\",   \"-XX:+UseSerialGC\");\n+        }\n+        if (GC.Parallel.isSupported()) {\n+            good(\"-XX:+UseParallelGC\", \"-XX:+UseParallelGC\");\n+        }\n+        if (GC.Shenandoah.isSupported()) {\n+            good(\"-XX:+UseShenandoahGC\", \"-XX:+UseShenandoahGC\");\n+        }\n@@ -67,3 +77,6 @@\n-        fail_run(\"-XX:+UseParallelGC\", \"-XX:+UseG1GC\",        ERROR_GC_MISMATCH );\n-        fail_run(null,                 \"-XX:+UseParallelGC\",  ERROR_GC_MISMATCH );\n-\n+        if (GC.Parallel.isSupported() && GC.G1.isSupported()) {\n+            fail_run(\"-XX:+UseParallelGC\", \"-XX:+UseG1GC\",        ERROR_GC_MISMATCH );\n+        }\n+        if (GC.Parallel.isSupported()) {\n+            fail_run(null,                 \"-XX:+UseParallelGC\",  ERROR_GC_MISMATCH );\n+        }\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/leyden\/LeydenGCFlags.java","additions":27,"deletions":14,"binary":false,"changes":41,"status":"modified"}]}