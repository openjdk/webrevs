{"files":[{"patch":"@@ -421,3 +421,0 @@\n-  bool added_stale_tasks = false;\n-  bool added_new_tasks = false;\n-\n@@ -431,1 +428,0 @@\n-      added_stale_tasks = true;\n@@ -434,1 +430,0 @@\n-      added_new_tasks = true;\n@@ -437,12 +432,0 @@\n-\n-  if (added_stale_tasks && !added_new_tasks) {\n-    \/\/ We have added stale tasks. There might be waiters that want\n-    \/\/ the notification these tasks have failed. Normally, this would\n-    \/\/ be done by a compiler thread that would perform the purge at\n-    \/\/ the end of some compilation. But, if we never added any tasks,\n-    \/\/ there is no guarantee compilers would run and do the purge.\n-    \/\/ Do the purge here and now to unblock the waiters.\n-    \/\/ NOTE: The call below recurses back to this method, unless\n-    \/\/ we explicitly ask it not to.\n-    purge_stale_tasks(\/* do_transfer_pending = *\/ false);\n-  }\n@@ -516,0 +499,16 @@\n+    \/\/ If we have added stale tasks, there might be waiters that want\n+    \/\/ the notification these tasks have failed. Normally, this would\n+    \/\/ be done by a compiler thread that would perform the purge at\n+    \/\/ the end of some compilation. But, if compile queue is empty,\n+    \/\/ there is no guarantee compilers would run and do the purge.\n+    \/\/ Do the purge here and now to unblock the waiters.\n+    \/\/ Perform this until we run out of stale tasks.\n+    while (_first_stale != nullptr) {\n+      purge_stale_tasks();\n+    }\n+    if (_first != nullptr) {\n+      \/\/ Purge stale tasks may have transferred some new tasks,\n+      \/\/ so check again.\n+      break;\n+    }\n+\n@@ -562,1 +561,1 @@\n-void CompileQueue::purge_stale_tasks(bool do_transfer_pending) {\n+void CompileQueue::purge_stale_tasks() {\n@@ -580,3 +579,1 @@\n-    if (do_transfer_pending) {\n-      transfer_pending(); \/\/ transfer pending after reacquiring MCQ lock\n-    }\n+    transfer_pending(); \/\/ transfer pending after reacquiring MCQ lock\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.cpp","additions":18,"deletions":21,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -101,1 +101,1 @@\n-  void purge_stale_tasks(bool do_transfer_pending = true);\n+  void purge_stale_tasks();\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}