{"files":[{"patch":"@@ -49,1 +49,1 @@\n-        String[] senseCmd = { PerfSupport.PERF_EXEC, \"record\", \"-q\", \"--event\", Utils.join(requestedEventNames, \",\"), \"-o\", \"-\", \"true\"};\n+        String[] senseCmd = { PerfSupport.PERF_EXEC, \"record\", \"-q\", \"--event\", Utils.join(requestedEventNames, \",\"), \"-o\", \"-\", \"echo\", \"1\"};\n@@ -56,11 +56,4 @@\n-        String statsCmd = String.format(\"%s | %s report -i - --stats | grep -E '%s' | sort | uniq | wc -l\", String.join(\" \", senseCmd), PerfSupport.PERF_EXEC, Utils.join(requestedEventNames, \"|\"));\n-        String[] tunnelCmd = { \"\/bin\/sh\", \"-c\", statsCmd };\n-        Collection<String> output = Utils.runWith(tunnelCmd);\n-        if (output.isEmpty()) {\n-            throw new ProfilerException(\"No events recorded for \" + requestedEventNames);\n-        }\n-\n-        try {\n-            final int count = Integer.parseInt(output.iterator().next().trim());\n-            if (count != requestedEventNames.size()) {\n-                throw new ProfilerException(\"One or several events unsupported: \" + requestedEventNames);\n+        Collection<String> passMsg = Utils.runWith(senseCmd);\n+        for (String ev : requestedEventNames) {\n+            if (PerfSupport.containsUnsupported(passMsg, ev)) {\n+                throw new ProfilerException(\"Unsupported event: \" + ev);\n@@ -68,2 +61,0 @@\n-        } catch (NumberFormatException e) {\n-            throw new ProfilerException(\"Perf event count not a number for one of events \" + requestedEventNames + \": \" + output);\n","filename":"jmh-core\/src\/main\/java\/org\/openjdk\/jmh\/profile\/LinuxPerfAsmProfiler.java","additions":5,"deletions":14,"binary":false,"changes":19,"status":"modified"}]}