{"files":[{"patch":"@@ -40,2 +40,1 @@\n-        try {\n-            CommandLineOptions cmdOptions = new CommandLineOptions(argv);\n+        Main main = new Main();\n@@ -43,1 +42,1 @@\n-            Runner runner = new Runner(cmdOptions);\n+        CommandLineOptions cmdOptions = main.createCommandLineOptions(argv);\n@@ -45,4 +44,1 @@\n-            if (cmdOptions.shouldHelp()) {\n-                cmdOptions.showHelp();\n-                return;\n-            }\n+        Runner runner = new Runner(cmdOptions);\n@@ -50,4 +46,2 @@\n-            if (cmdOptions.shouldList()) {\n-                runner.list();\n-                return;\n-            }\n+        main.run(cmdOptions, runner);\n+    }\n@@ -55,4 +49,11 @@\n-            if (cmdOptions.shouldListWithParams()) {\n-                runner.listWithParams(cmdOptions);\n-                return;\n-            }\n+    protected CommandLineOptions createCommandLineOptions(String[] argv)\n+    {\n+        try {\n+            return new CommandLineOptions(argv);\n+        } catch (CommandLineOptionException e) {\n+            System.err.println(\"Error parsing command line:\");\n+            System.err.println(\" \" + e.getMessage());\n+            System.exit(1);\n+            return null;\n+        }\n+    }\n@@ -60,4 +61,5 @@\n-            if (cmdOptions.shouldListProfilers()) {\n-                cmdOptions.listProfilers();\n-                return;\n-            }\n+    protected void run(CommandLineOptions cmdOptions, Runner runner) throws IOException {\n+        if (cmdOptions.shouldHelp()) {\n+            cmdOptions.showHelp();\n+            return;\n+        }\n@@ -65,4 +67,4 @@\n-            if (cmdOptions.shouldListResultFormats()) {\n-                cmdOptions.listResultFormats();\n-                return;\n-            }\n+        if (cmdOptions.shouldList()) {\n+            runner.list();\n+            return;\n+        }\n@@ -70,4 +72,4 @@\n-            try {\n-                runner.run();\n-            } catch (NoBenchmarksException e) {\n-                System.err.println(\"No matching benchmarks. Miss-spelled regexp?\");\n+        if (cmdOptions.shouldListWithParams()) {\n+            runner.listWithParams(cmdOptions);\n+            return;\n+        }\n@@ -75,15 +77,28 @@\n-                if (cmdOptions.verbosity().orElse(Defaults.VERBOSITY) != VerboseMode.EXTRA) {\n-                    System.err.println(\"Use \" + VerboseMode.EXTRA + \" verbose mode to debug the pattern matching.\");\n-                } else {\n-                    runner.list();\n-                }\n-                System.exit(1);\n-            } catch (ProfilersFailedException e) {\n-                \/\/ This is not exactly an error, print all messages and set the non-zero exit code.\n-                Throwable ex = e;\n-                while (ex != null) {\n-                    System.err.println(ex.getMessage());\n-                    for (Throwable supp : ex.getSuppressed()) {\n-                        System.err.println(supp.getMessage());\n-                    }\n-                    ex = ex.getCause();\n+        if (cmdOptions.shouldListProfilers()) {\n+            cmdOptions.listProfilers();\n+            return;\n+        }\n+\n+        if (cmdOptions.shouldListResultFormats()) {\n+            cmdOptions.listResultFormats();\n+            return;\n+        }\n+\n+        try {\n+            runner.run();\n+        } catch (NoBenchmarksException e) {\n+            System.err.println(\"No matching benchmarks. Miss-spelled regexp?\");\n+\n+            if (cmdOptions.verbosity().orElse(Defaults.VERBOSITY) != VerboseMode.EXTRA) {\n+                System.err.println(\"Use \" + VerboseMode.EXTRA + \" verbose mode to debug the pattern matching.\");\n+            } else {\n+                runner.list();\n+            }\n+            System.exit(1);\n+        } catch (ProfilersFailedException e) {\n+            \/\/ This is not exactly an error, print all messages and set the non-zero exit code.\n+            Throwable ex = e;\n+            while (ex != null) {\n+                System.err.println(ex.getMessage());\n+                for (Throwable supp : ex.getSuppressed()) {\n+                    System.err.println(supp.getMessage());\n@@ -91,5 +106,1 @@\n-                System.exit(1);\n-            } catch (RunnerException e) {\n-                System.err.print(\"ERROR: \");\n-                e.printStackTrace(System.err);\n-                System.exit(1);\n+                ex = ex.getCause();\n@@ -97,4 +108,4 @@\n-\n-        } catch (CommandLineOptionException e) {\n-            System.err.println(\"Error parsing command line:\");\n-            System.err.println(\" \" + e.getMessage());\n+            System.exit(1);\n+        } catch (RunnerException e) {\n+            System.err.print(\"ERROR: \");\n+            e.printStackTrace(System.err);\n","filename":"jmh-core\/src\/main\/java\/org\/openjdk\/jmh\/Main.java","additions":62,"deletions":51,"binary":false,"changes":113,"status":"modified"}]}