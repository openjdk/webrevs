{"files":[{"patch":"@@ -226,1 +226,1 @@\n-        if (ok && isEmpty(dir) && deleteDir) {\n+        if (ok && isEmpty(dir, log) && deleteDir) {\n@@ -292,2 +292,6 @@\n-\n-        for (File file: fromDir.listFiles()) {\n+        final File[] children = fromDir.listFiles();\n+        if (children == null) {\n+            log.println(\"warning: cannot list contents of directory \" + fromDir);\n+            return result;\n+        }\n+        for (File file: children) {\n@@ -330,2 +334,14 @@\n-    private static boolean isEmpty(File dir) {\n-        return dir.isDirectory() && (dir.listFiles().length == 0);\n+    \/\/ returns true only if the dir is determined to be directory and has no\n+    \/\/ files\/directories within that directory\n+    private static boolean isEmpty(File dir, PrintWriter log) {\n+        if (!dir.isDirectory()) {\n+            return false;\n+        }\n+        final File[] children = dir.listFiles();\n+        if (children == null) {\n+            \/\/ the dir doesn't represent a directory or an I\/O error occurred.\n+            \/\/ we can't say for certain if the dir is empty, so we return false.\n+            log.println(\"warning: cannot list contents of directory \" + dir);\n+            return false;\n+        }\n+        return children.length == 0;\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/ScratchDirectory.java","additions":21,"deletions":5,"binary":false,"changes":26,"status":"modified"}]}