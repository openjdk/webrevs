{"files":[{"patch":"@@ -5,0 +5,3 @@\n+* Remove problematic implementation for `LIBRARY.properties` support [CODETOOLS-7903940](https:\/\/bugs.openjdk.org\/browse\/CODETOOLS-7903940)\n+\n+\n","filename":"CHANGELOG.md","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1,72 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package com.sun.javatest.regtest.config;\n-\n-import java.io.IOException;\n-import java.io.UncheckedIOException;\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n-import java.util.Properties;\n-\n-\/**\n- * Provide access to properties defined in LIBRARY.properties files.\n- *\/\n-public final class LibraryProperties {\n-    private final boolean enablePreview;\n-\n-    public LibraryProperties(boolean enablePreview) {\n-        this.enablePreview = enablePreview;\n-    }\n-\n-    public static LibraryProperties of(Locations.LibLocn libLocn) throws UncheckedIOException {\n-        \/\/ default values being used when no LIBRARY.properties is present\n-        boolean enablePreview = false;\n-\n-        \/\/ read LIBRARY.properties file and initialize fields accordingly\n-        Path root = libLocn.absSrcDir;\n-        if (root != null && Files.isDirectory(root)) {\n-            Path file = root.resolve(\"LIBRARY.properties\");\n-            if (Files.exists(file)) {\n-                var properties = new Properties();\n-                try (var stream = Files.newInputStream(file)) {\n-                    properties.load(stream);\n-                } catch (IOException exception) {\n-                    throw new UncheckedIOException(\"Reading from file failed: \" + file.toUri(), exception);\n-                }\n-                enablePreview = initEnablePreview(properties);\n-            }\n-        }\n-        return new LibraryProperties(enablePreview);\n-    }\n-\n-    private static boolean initEnablePreview(Properties properties) {\n-        return Boolean.parseBoolean(properties.getProperty(\"enablePreview\", \"false\"));\n-    }\n-\n-    public boolean isEnablePreview() {\n-        return enablePreview;\n-    }\n-}\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/config\/LibraryProperties.java","additions":0,"deletions":72,"binary":false,"changes":72,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,2 +58,0 @@\n-import com.sun.javatest.regtest.config.LibraryProperties;\n-import com.sun.javatest.regtest.config.Locations;\n@@ -701,7 +699,0 @@\n-    protected boolean usesLibraryCompiledWithPreviewEnabled() {\n-        return script.locations.getLibs().stream()\n-                .filter(Locations.LibLocn::isLibrary)\n-                .map(LibraryProperties::of) \/\/ cache library properties object in LibLocn ?\n-                .anyMatch(LibraryProperties::isEnablePreview);\n-    }\n-\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/Action.java","additions":1,"deletions":10,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,0 @@\n-import java.io.UncheckedIOException;\n@@ -43,1 +42,0 @@\n-import com.sun.javatest.regtest.config.LibraryProperties;\n@@ -306,17 +304,0 @@\n-        \/\/ read and add library-specific compilation properties\n-        if (libLocn.isLibrary()) {\n-            try {\n-                var properties = LibraryProperties.of(libLocn);\n-                if (properties.isEnablePreview()) {\n-                    compArgs.add(\"--enable-preview\");\n-                    \/\/ \"--enable-preview\" requires either \"--source\" or \"--release\" to\n-                    \/\/ confirm the expected source level. \"--release\" restricts\n-                    \/\/ the visible API to the exported API, so use \"--source\" instead.\n-                    compArgs.add(\"-source\"); \/\/ use \"-source\" \"N\" for Java 11 and lower\n-                    compArgs.add(String.valueOf(script.getTestJDKVersion().major));\n-                }\n-            } catch (UncheckedIOException exception) {\n-                throw new TestRunException(\"Reading library properties failed: \" + libLocn, exception);\n-            }\n-        }\n-\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/BuildAction.java","additions":1,"deletions":20,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -369,1 +369,1 @@\n-                && (script.enablePreview() || usesLibraryCompiledWithPreviewEnabled())\n+                && (script.enablePreview())\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/CompileAction.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -235,1 +235,1 @@\n-            boolean needsEnablePreview = script.enablePreview() || usesLibraryCompiledWithPreviewEnabled();\n+            boolean needsEnablePreview = script.enablePreview();\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/MainAction.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1,42 +0,0 @@\n-#\n-# Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.  Oracle designates this\n-# particular file as subject to the \"Classpath\" exception as provided\n-# by Oracle in the LICENSE file that accompanied this code.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-$(BUILDTESTDIR)\/LibPropertiesEnablePreviewTest.ok: \\\n-\t\t\t\t$(JTREG_IMAGEDIR)\/lib\/jtreg.jar \\\n-\t\t$(JTREG_IMAGEDIR)\/lib\/javatest.jar\n-\t$(RM) $(@:%.ok=%\/work) $(@:%.ok=%\/report)\n-\t$(MKDIR) -p $(@:%.ok=%)\n-\t$(JDKHOME)\/bin\/java \\\n-\t\t-jar $(JTREG_IMAGEDIR)\/lib\/jtreg.jar \\\n-\t\t-w:$(@:%.ok=%\/work) \\\n-\t\t-r:$(@:%.ok=%\/report) \\\n-\t\t$(TESTDIR)\/libPropertiesEnablePreview \\\n-\t\t> $(@:%.ok=%\/log 2>&1) \\\n-\t\t|| (cat $(@:%.ok=%\/log) ; exit 1)\n-\techo $@ passed at `date` > $@\n-\n-\n-TESTS.jtreg += \\\n-\t$(BUILDTESTDIR)\/LibPropertiesEnablePreviewTest.ok\n","filename":"test\/libPropertiesEnablePreview\/LibPropertiesEnablePreviewTest.gmk","additions":0,"deletions":42,"binary":false,"changes":42,"status":"deleted"},{"patch":"","filename":"test\/libPropertiesEnablePreview\/TEST.ROOT","additions":0,"deletions":0,"binary":false,"changes":0,"status":"deleted"},{"patch":"@@ -1,32 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @run junit TestNoLibraries\n- *\/\n-public class TestNoLibraries {\n-    public static void main(String... args) {\n-        System.out.println(new TestNoLibraries());\n-    }\n-}\n","filename":"test\/libPropertiesEnablePreview\/TestNoLibraries.java","additions":0,"deletions":32,"binary":false,"changes":32,"status":"deleted"},{"patch":"@@ -1,59 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @bug 7903808\n- * @library lib-with-preview\n- * @build TestProcessor WithPreview\n- * @compile -cp . -processor TestProcessor -proc:only TestProcessor.java\n- * @compile\/process -cp . -processor TestProcessor -proc:only Test\n- *\/\n-\n-import java.util.*;\n-import javax.annotation.processing.*;\n-import javax.lang.model.*;\n-import javax.lang.model.element.*;\n-import javax.lang.model.util.*;\n-\n-public class TestProcessor extends AbstractProcessor {\n-    @Override\n-    public SourceVersion getSupportedSourceVersion() {\n-        return SourceVersion.latest();\n-    }\n-\n-    @Override\n-    public Set<String> getSupportedAnnotationTypes() {\n-        return Set.of();\n-    }\n-\n-    public boolean process(Set<? extends TypeElement> types, RoundEnvironment env) {\n-        return true;\n-    }\n-}\n-\n-class Test {\n-    static {\n-        WithPreview.class.toString();\n-    }\n-}\n","filename":"test\/libPropertiesEnablePreview\/TestProcessor.java","additions":0,"deletions":59,"binary":false,"changes":59,"status":"deleted"},{"patch":"@@ -1,37 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @library lib-no-properties lib-with-preview lib-without-preview\n- * @build TestUsingAllLibraries NoProperties WithPreview WithoutPreview\n- * @run main TestUsingAllLibraries\n- *\/\n-public class TestUsingAllLibraries {\n-    public static void main(String... args) {\n-        System.out.println(new TestUsingAllLibraries());\n-        System.out.println(new NoProperties());\n-        System.out.println(new WithPreview());\n-        System.out.println(new WithoutPreview());\n-    }\n-}\n","filename":"test\/libPropertiesEnablePreview\/TestUsingAllLibraries.java","additions":0,"deletions":37,"binary":false,"changes":37,"status":"deleted"},{"patch":"@@ -1,39 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @bug 7903809\n- * @library lib-with-preview\n- * @compile --release 11 TestUsingPreviewLibrary.java\n- * @compile  -source 1.8 TestUsingPreviewLibrary.java\n- * @compile --source 1.8 TestUsingPreviewLibrary.java\n- * @build TestUsingPreviewLibrary WithPreview\n- * @run main TestUsingPreviewLibrary\n- *\/\n-public class TestUsingPreviewLibrary {\n-    public static void main(String... args) {\n-        System.out.println(new TestUsingPreviewLibrary());\n-        System.out.println(new WithPreview());\n-    }\n-}\n","filename":"test\/libPropertiesEnablePreview\/TestUsingPreviewLibrary.java","additions":0,"deletions":39,"binary":false,"changes":39,"status":"deleted"},{"patch":"@@ -1,48 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @bug 7903813\n- * @enablePreview false\n- * @library lib-with-preview\n- * @build TestWithDisabledPreview WithPreview\n- * @run main TestWithDisabledPreview\n- *\/\n-\n-import java.io.ByteArrayInputStream;\n-import java.io.DataInputStream;\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n-\n-public class TestWithDisabledPreview {\n-    public static void main(String... args) throws Exception {\n-        var location = TestWithDisabledPreview.class.getProtectionDomain().getCodeSource().getLocation();\n-        var classFile = Path.of(location.toURI()).resolve(TestWithDisabledPreview.class.getSimpleName() + \".class\");\n-        try (var dis = new DataInputStream(new ByteArrayInputStream(Files.readAllBytes(classFile)))) {\n-            dis.skipBytes(4); \/\/ 0xCAFEBABE\n-            var minor = dis.readUnsignedShort();\n-            if (minor != 0) throw new AssertionError(\"Unexpected minor version: \" + minor);\n-        }\n-    }\n-}\n","filename":"test\/libPropertiesEnablePreview\/TestWithDisabledPreview.java","additions":0,"deletions":48,"binary":false,"changes":48,"status":"deleted"},{"patch":"@@ -1,36 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @enablePreview\n- * @library lib-without-preview\n- * @build TestWithEnablePreview WithoutPreview\n- * @run main TestWithEnablePreview\n- *\/\n-public class TestWithEnablePreview {\n-    public static void main(String... args) {\n-        System.out.println(new TestWithEnablePreview());\n-        System.out.println(new WithoutPreview());\n-    }\n-}\n","filename":"test\/libPropertiesEnablePreview\/TestWithEnablePreview.java","additions":0,"deletions":36,"binary":false,"changes":36,"status":"deleted"},{"patch":"@@ -1,1 +0,0 @@\n-class NoProperties {}\n","filename":"test\/libPropertiesEnablePreview\/lib-no-properties\/NoProperties.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"deleted"},{"patch":"@@ -1,1 +0,0 @@\n-enablePreview = true\n","filename":"test\/libPropertiesEnablePreview\/lib-with-preview\/LIBRARY.properties","additions":0,"deletions":1,"binary":false,"changes":1,"status":"deleted"},{"patch":"@@ -1,1 +0,0 @@\n-class WithPreview {}\n","filename":"test\/libPropertiesEnablePreview\/lib-with-preview\/WithPreview.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"deleted"},{"patch":"@@ -1,1 +0,0 @@\n-enablePreview = false\n","filename":"test\/libPropertiesEnablePreview\/lib-without-preview\/LIBRARY.properties","additions":0,"deletions":1,"binary":false,"changes":1,"status":"deleted"},{"patch":"@@ -1,1 +0,0 @@\n-class WithoutPreview {}\n","filename":"test\/libPropertiesEnablePreview\/lib-without-preview\/WithoutPreview.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"deleted"}]}