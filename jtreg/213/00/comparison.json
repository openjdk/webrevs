{"files":[{"patch":"@@ -58,0 +58,2 @@\n+import com.sun.javatest.regtest.config.LibraryProperties;\n+import com.sun.javatest.regtest.config.Locations;\n@@ -699,0 +701,7 @@\n+    protected boolean usesLibraryCompiledWithPreviewEnabled() {\n+        return script.locations.getLibs().stream()\n+                .filter(Locations.LibLocn::isLibrary)\n+                .map(LibraryProperties::of) \/\/ cache library properties object in LibLocn ?\n+                .anyMatch(LibraryProperties::isEnablePreview);\n+    }\n+\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/Action.java","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -62,1 +62,0 @@\n-import com.sun.javatest.regtest.config.LibraryProperties;\n@@ -369,1 +368,2 @@\n-        if (runJavac && needsEnablePreview && !seenEnablePreview && libLocn.isTest()) {\n+        if (runJavac && needsEnablePreview && !seenEnablePreview\n+                && (libLocn == null || libLocn.isTest())) {\n@@ -373,1 +373,2 @@\n-                javacArgs.add(insertPos + 1, \"--source=\" + v);\n+                javacArgs.add(insertPos + 1, \"-source\");\n+                javacArgs.add(insertPos + 2, String.valueOf(v));\n@@ -422,7 +423,0 @@\n-    private boolean usesLibraryCompiledWithPreviewEnabled() {\n-        return script.locations.getLibs().stream()\n-                .filter(LibLocn::isLibrary)\n-                .map(LibraryProperties::of) \/\/ cache library properties object in LibLocn ?\n-                .anyMatch(LibraryProperties::isEnablePreview);\n-    }\n-\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/CompileAction.java","additions":4,"deletions":10,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -234,1 +234,2 @@\n-        if (script.enablePreview() && !seenEnablePreview) {\n+        boolean needsEnablePreview = script.enablePreview() || usesLibraryCompiledWithPreviewEnabled();\n+        if (needsEnablePreview && !seenEnablePreview) {\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/MainAction.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}