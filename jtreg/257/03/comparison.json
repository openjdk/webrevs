{"files":[{"patch":"@@ -29,0 +29,1 @@\n+import java.io.IOException;\n@@ -45,0 +46,1 @@\n+import java.util.Optional;\n@@ -470,2 +472,0 @@\n-    private static final Pattern namePattern = Pattern.compile(\"\\\\$\\\\{([A-Za-z0-9._]+)}\");\n-\n@@ -474,1 +474,1 @@\n-        Matcher m = namePattern.matcher(arg);\n+        Matcher m = SMART_ACTION_NAME_PATTERN.matcher(arg);\n@@ -1143,0 +1143,1 @@\n+        computeMainClassNameFromTestFile().ifPresent(name -> p.put(\"test.main.class\", name));\n@@ -1184,6 +1185,21 @@\n-\/\/    \/\/ where\n-\/\/    private String toString(List<File> files) {\n-\/\/        return files.stream()\n-\/\/                .map(File::getPath)\n-\/\/                .collect(Collectors.joining(File.pathSeparator));\n-\/\/    }\n+\n+    private Optional<String> computeMainClassNameFromTestFile() {\n+        Path file = locations.absTestFile();\n+        \/\/ Take file name as basis for class name.\n+        String fileName = file.getFileName().toString();\n+        int fileNameLength = fileName.length(); \/\/ including \".java\".length() = 5\n+        if (fileNameLength <= 5 && !fileName.endsWith(\".java\")) {\n+            return Optional.empty();\n+        }\n+        String className = fileName.substring(0, fileNameLength - 5);\n+        \/\/ Scan .java file for \"package NAME;\" without taking comments into account.\n+        try {\n+            \/\/ Assume non-large files in UTF-8 encoding.\n+            String charContent = Files.readString(file);\n+            Matcher packageMatcher = PACKAGE_NAME_PATTERN.matcher(charContent);\n+            String packageName = packageMatcher.find() ? packageMatcher.group(1) + \".\" : \"\";\n+            return Optional.of(packageName + className);\n+        } catch (IOException ignored) {\n+            return Optional.empty();\n+        }\n+    }\n@@ -1329,0 +1345,4 @@\n+    private static final Pattern\n+        SMART_ACTION_NAME_PATTERN = Pattern.compile(\"\\\\$\\\\{([A-Za-z0-9._]+)}\"),\n+        PACKAGE_NAME_PATTERN = Pattern.compile(\"package\\\\s+([\\\\w.]+);\");\n+\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/RegressionScript.java","additions":29,"deletions":9,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n- Copyright (c) 2006, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ Copyright (c) 2006, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -1252,0 +1252,6 @@\n+<tr>\n+<td><code>test.main.class<\/code>\n+<td><i>Not Available<\/i>\n+<td>The computed name of the main entry-point of the current Java source file.\n+It can be used action tags, for example:<code>@run main ${test.main.class}<\/code>\n+\n","filename":"src\/share\/doc\/javatest\/regtest\/tag-spec.html","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n-\t$(MKDIR) $(@:%.ok=%)\n+\t$(MKDIR) -p $(@:%.ok=%)\n@@ -38,1 +38,1 @@\n-\t$(GREP) -s 'Test results: passed: 6' $(@:%.ok=%\/jt.log)  > \/dev\/null\n+\t$(GREP) -s 'Test results: passed: 7' $(@:%.ok=%\/jt.log)  > \/dev\/null\n","filename":"test\/smartActionArgs\/SmartActionArgs.gmk","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @run main Test ${os.name} --os=${os.name} x${os.name}x${os.version}x\n+ * @run main ${test.main.class} ${os.name} --os=${os.name} x${os.name}x${os.version}x\n","filename":"test\/smartActionArgs\/optAuto\/Test.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @run main Test2 --test.src ${test.src}\n+ * @run main ${test.main.class} --test.src ${test.src}\n","filename":"test\/smartActionArgs\/optAuto\/Test2.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,2 @@\n+package p;\n+\n@@ -26,1 +28,1 @@\n- * @run main Test2 --test.src ${test.src}\n+ * @run main ${test.main.class} --test.src ${test.src}\n@@ -32,1 +34,1 @@\n-public class Test2 {\n+public class Test3 {\n","filename":"test\/smartActionArgs\/optAuto\/p\/Test3.java","additions":5,"deletions":3,"binary":false,"changes":8,"previous_filename":"test\/smartActionArgs\/optAuto\/Test2.java","status":"copied"}]}