{"files":[{"patch":"@@ -330,1 +330,1 @@\n-        int insertPos = -1;\n+        String sourceOrReleaseVersion = \"not-seen\";\n@@ -338,3 +338,0 @@\n-                if (insertPos == -1) {\n-                    insertPos = javacArgs.size();\n-                }\n@@ -356,3 +353,0 @@\n-                        if (insertPos == -1) {\n-                            insertPos = javacArgs.size();\n-                        }\n@@ -360,1 +354,10 @@\n-                        break;\n+                        if (eq != -1) {\n+                            sourceOrReleaseVersion = currArg.substring(eq + 1).trim();\n+                        } else {\n+                            sourceOrReleaseVersion = \"next-argument\";\n+                        }\n+                        javacArgs.add(currArg);\n+                        continue; \/\/ with next argument\n+                }\n+                if (sourceOrReleaseVersion.equals(\"next-argument\")) {\n+                    sourceOrReleaseVersion = currArg;\n@@ -371,4 +374,2 @@\n-            if (insertPos == -1) { \/\/ happens for example in \"-proc:only CLASS\" cases\n-                insertPos = 0;     \/\/ prepend in order to not mess with variadic arguments\n-            }\n-            javacArgs.add(insertPos, \"--enable-preview\");\n+            String version = script.getTestJDKVersion().name();\n+            \/\/ always prepend in order to not mess with variadic arguments\n@@ -376,3 +377,6 @@\n-                int v = script.getTestJDKVersion().major;\n-                javacArgs.add(insertPos + 1, \"-source\");\n-                javacArgs.add(insertPos + 2, String.valueOf(v));\n+                javacArgs.add(0, version);\n+                javacArgs.add(0, \"-source\");\n+            }\n+            \/\/ 7903809: prevent invalid source release errors\n+            if (!seenSourceOrRelease || version.equals(sourceOrReleaseVersion)) {\n+                javacArgs.add(0, \"--enable-preview\");\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/CompileAction.java","additions":19,"deletions":15,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+ * @bug 7903809\n@@ -27,0 +28,1 @@\n+ * @compile --release 11 TestUsingPreviewLibrary.java\n","filename":"test\/libPropertiesEnablePreview\/TestUsingPreviewLibrary.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}