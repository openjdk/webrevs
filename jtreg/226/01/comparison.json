{"files":[{"patch":"@@ -330,1 +330,1 @@\n-        int insertPos = -1;\n+        int sourceOrReleaseFeatureNumber = -1;\n@@ -338,3 +338,0 @@\n-                if (insertPos == -1) {\n-                    insertPos = javacArgs.size();\n-                }\n@@ -356,3 +353,0 @@\n-                        if (insertPos == -1) {\n-                            insertPos = javacArgs.size();\n-                        }\n@@ -360,1 +354,11 @@\n-                        break;\n+                        if (eq != -1) {\n+                            var number = currArg.substring(eq + 1).trim();\n+                            sourceOrReleaseFeatureNumber = Integer.parseInt(number);\n+                        } else {\n+                            sourceOrReleaseFeatureNumber = -2;\n+                        }\n+                        javacArgs.add(currArg);\n+                        continue; \/\/ with next argument\n+                }\n+                if (sourceOrReleaseFeatureNumber == -2) {\n+                    sourceOrReleaseFeatureNumber = Integer.parseInt(currArg);\n@@ -371,4 +375,2 @@\n-            if (insertPos == -1) { \/\/ happens for example in \"-proc:only CLASS\" cases\n-                insertPos = 0;     \/\/ prepend in order to not mess with variadic arguments\n-            }\n-            javacArgs.add(insertPos, \"--enable-preview\");\n+            int major = script.getTestJDKVersion().major;\n+            \/\/ always prepend in order to not mess with variadic arguments\n@@ -376,3 +378,6 @@\n-                int v = script.getTestJDKVersion().major;\n-                javacArgs.add(insertPos + 1, \"-source\");\n-                javacArgs.add(insertPos + 2, String.valueOf(v));\n+                javacArgs.add(0, String.valueOf(major));\n+                javacArgs.add(0, \"-source\");\n+            }\n+            \/\/ 7903809: prevent invalid source release errors\n+            if (!seenSourceOrRelease || major == sourceOrReleaseFeatureNumber) {\n+                javacArgs.add(0, \"--enable-preview\");\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/CompileAction.java","additions":20,"deletions":15,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+ * @bug 7903809\n@@ -27,0 +28,1 @@\n+ * @compile --release 11 TestUsingPreviewLibrary.java\n","filename":"test\/libPropertiesEnablePreview\/TestUsingPreviewLibrary.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}