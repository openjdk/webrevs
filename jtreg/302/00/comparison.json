{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.io.BufferedOutputStream;\n@@ -29,0 +30,1 @@\n+import java.io.OutputStream;\n@@ -31,0 +33,4 @@\n+import java.nio.file.Files;\n+import java.nio.file.InvalidPathException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n@@ -39,1 +45,1 @@\n-  *   java GetJDKProperties [--system-properties] [--modules] <class-name>*\n+  *   java GetJDKProperties --output-file=<file> [--system-properties] [--modules] <class-name>*\n@@ -45,0 +51,5 @@\n+\n+        ClientCodeException(String msg) {\n+            super(msg);\n+        }\n+\n@@ -69,0 +80,1 @@\n+        Path outputFile = null;\n@@ -75,0 +87,7 @@\n+            } else if (arg.startsWith(\"--output-file=\")) {\n+                String val = arg.substring(arg.indexOf(\"=\") + 1);\n+                try {\n+                    outputFile = Paths.get(val);\n+                } catch (InvalidPathException ipe) {\n+                    throw new IOException(\"invalid output file path: \" + val, ipe);\n+                }\n@@ -76,0 +95,3 @@\n+                if (outputFile == null) {\n+                    throw new ClientCodeException(\"--output-file not specified\");\n+                }\n@@ -101,2 +123,5 @@\n-\n-        p.store(System.out, \"jdk properties\");\n+        assert outputFile != null : \"outputFile is null\";\n+        try (OutputStream os = Files.newOutputStream(outputFile);\n+             BufferedOutputStream bos = new BufferedOutputStream(os)) {\n+            p.store(bos, \"jdk properties\");\n+        }\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/agent\/GetJDKProperties.java","additions":29,"deletions":4,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,0 @@\n-import java.io.StringReader;\n@@ -635,8 +634,0 @@\n-        List<String> cmdArgs = new ArrayList<>();\n-        cmdArgs.add(getJavaProg().toString());\n-        cmdArgs.addAll(jdkOpts.toList());\n-        cmdArgs.add(GetJDKProperties.class.getName());\n-\n-        cmdArgs.addAll(opts);\n-        cmdArgs.addAll(epd.getClasses());\n-\n@@ -644,0 +635,5 @@\n+            List<String> cmdArgs = new ArrayList<>();\n+            cmdArgs.add(getJavaProg().toString());\n+            cmdArgs.addAll(jdkOpts.toList());\n+            cmdArgs.add(GetJDKProperties.class.getName());\n+\n@@ -648,0 +644,9 @@\n+            \/\/ create a temporary file into which the properties will be written\n+            \/\/ by the GetJDKProperties program\n+            Path tmpOutputFile = Files.createTempFile(scratchDir.toPath(),\n+                    \"jtreg-tmp-\", \".properties\");\n+            cmdArgs.add(\"--output-file=\" + tmpOutputFile);\n+\n+            cmdArgs.addAll(opts);\n+            cmdArgs.addAll(epd.getClasses());\n+\n@@ -664,2 +669,10 @@\n-\n-            return loadProperties(lines, logger);\n+            Properties props = new Properties();\n+            props.load(Files.newBufferedReader(tmpOutputFile));\n+            \/\/ delete the temp file\n+            try {\n+                Files.delete(tmpOutputFile);\n+            } catch (IOException ioe) {\n+                \/\/ ignore\n+                logger.accept(\"failed to delete temp file: \" + tmpOutputFile + \", cause: \" + ioe);\n+            }\n+            return props;\n@@ -685,12 +698,0 @@\n-    private Properties loadProperties(List<String> lines, Consumer<String> logger) throws Fault {\n-        Properties props = new Properties();\n-        try {\n-            props.load(new StringReader(String.join(\"\\n\", lines)));\n-        } catch (IOException e) {\n-            logger.accept(\"Error loading extra property definitions: \" + e);\n-            lines.forEach(logger::accept);\n-            throw new Fault(\"Error loading extra property definitions: \" + e);\n-        }\n-        return props;\n-    }\n-\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/config\/JDK.java","additions":25,"deletions":24,"binary":false,"changes":49,"status":"modified"}]}