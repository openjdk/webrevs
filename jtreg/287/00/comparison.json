{"files":[{"patch":"@@ -31,0 +31,2 @@\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n@@ -34,0 +36,1 @@\n+import com.sun.javatest.regtest.exec.Action;\n@@ -44,0 +47,4 @@\n+    \/\/ example \"11:12:22.256\"\n+    private static final DateTimeFormatter HOUR_MIN_SEC_MS_FORMAT =\n+            DateTimeFormatter.ofPattern(\"HH:mm:ss.SSS\");\n+\n@@ -114,0 +121,2 @@\n+        final String startedAt = HOUR_MIN_SEC_MS_FORMAT.format(ZonedDateTime.now());\n+        log.println(\"[\" + startedAt + \"] starting timeout handler action(s)\");\n@@ -125,0 +134,2 @@\n+            final String endedAt = HOUR_MIN_SEC_MS_FORMAT.format(ZonedDateTime.now());\n+            log.println(\"[\" + endedAt + \"] timeout handler action(s) completed\");\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/TimeoutHandler.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -57,0 +57,1 @@\n+import java.util.Optional;\n@@ -92,0 +93,22 @@\n+\n+        private final Status suppressedStatus;\n+\n+        private ActionTimeout() {\n+            this(null);\n+        }\n+\n+        \/**\n+         * @param suppressedStatus action completion status which will be suppressed in favour\n+         *                         of timed out error status. Can be null.\n+         *\/\n+        private ActionTimeout(Status suppressedStatus) {\n+            this.suppressedStatus = suppressedStatus;\n+        }\n+\n+        \/**\n+         * {@return the action's completion status that was suppressed in favour of reporting\n+         * the timed out error status}\n+         *\/\n+        Optional<Status> getSuppressedStatus() {\n+            return Optional.ofNullable(this.suppressedStatus);\n+        }\n@@ -384,0 +407,1 @@\n+        Status actionStatus = null;\n@@ -391,1 +415,2 @@\n-            return readResults(trs);\n+            actionStatus = readResults(trs);\n+            return actionStatus;\n@@ -401,1 +426,1 @@\n-                throw new ActionTimeout();\n+                throw new ActionTimeout(actionStatus);\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/Agent.java","additions":27,"deletions":2,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -726,1 +726,1 @@\n-            final String msg = \"\\\"\" + getName() + \"\\\" action timed out with a timeout of \"\n+            String msg = \"\\\"\" + getName() + \"\\\" action timed out with a timeout of \"\n@@ -728,0 +728,4 @@\n+            if (te.getSuppressedStatus().isPresent()) {\n+                Status suppressed = te.getSuppressedStatus().get();\n+                msg += \"; but completed after timeout - suppressed status: \\\"\" + suppressed + \"\\\"\";\n+            }\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/CompileAction.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -722,2 +722,2 @@\n-        } catch (Agent.ActionTimeout e) {\n-            final String msg = \"\\\"\" + getName() + \"\\\" action timed out with a timeout of \"\n+        } catch (Agent.ActionTimeout te) {\n+            String msg = \"\\\"\" + getName() + \"\\\" action timed out with a timeout of \"\n@@ -725,0 +725,4 @@\n+            if (te.getSuppressedStatus().isPresent()) {\n+                Status suppressed = te.getSuppressedStatus().get();\n+                msg += \"; but completed after timeout - suppressed status: \\\"\" + suppressed + \"\\\"\";\n+            }\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/MainAction.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -270,1 +270,1 @@\n-\n+            Status status = null;\n@@ -285,2 +285,2 @@\n-                return getStatus(exitCode, statusScanner.exitStatus());\n-\n+                status = getStatus(exitCode, statusScanner.exitStatus());\n+                return status;\n@@ -298,1 +298,1 @@\n-                    String msg = \"Program `\" + cmd.get(0) + \"' timed out\";\n+                    String msg = \"'\" + cmd.get(0) + \"' timed out after \" + timeout + \" ms\";\n@@ -303,1 +303,5 @@\n-                    msg += \" (timeout set to \" + timeout + \"ms, elapsed time including timeout handling was \" + (end - start) + \"ms).\";\n+                    msg += \" (elapsed time including timeout handling \" + (end - start) + \" ms)\";\n+                    if (status != null) {\n+                        \/\/ the command completed after the timeout had fired\n+                        msg += \"; but completed after timeout - suppressed status: \\\"\" + status + \"\\\"\";\n+                    }\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/ProcessCommand.java","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"}]}