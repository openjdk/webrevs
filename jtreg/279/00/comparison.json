{"files":[{"patch":"@@ -3,1 +3,2 @@\n-_nothing noteworthy, yet_\n+* `XAUTHORITY` environment variable is now preserved when launching tests on Unix-like platforms.\n+  [CODETOOLS-7904016](https:\/\/bugs.openjdk.org\/browse\/CODETOOLS-7904016)\n","filename":"CHANGELOG.md","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2463,1 +2463,2 @@\n-            \"XMODIFIERS\"\n+            \"XMODIFIERS\",\n+            \"XAUTHORITY\"\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/tool\/Tool.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2413,0 +2413,2 @@\n+        `DBUS_SESSION_BUS_ADDRESS`,\n+        `DESKTOP_SESSION`,\n@@ -2414,0 +2416,3 @@\n+        `GDMSESSION`,\n+        `GNOME_DESKTOP_SESSION_ID`,\n+        `GNOME_SHELL_SESSION_MODE`,\n@@ -2420,3 +2425,4 @@\n-        `TZ` and\n-        `XMODIFIERS`\n-\n+        `TZ`,\n+        `WAYLAND_DISPLAY`,\n+        `XMODIFIERS`,\n+        `XAUTHORITY`\n@@ -2428,1 +2434,4 @@\n-        `SystemRoot`\n+        `SystemRoot`,\n+        `TMP`,\n+        `TEMP`,\n+        `TZ`,\n","filename":"src\/share\/doc\/javatest\/regtest\/faq.md","additions":13,"deletions":4,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -1413,0 +1413,2 @@\n+<li><code>DBUS_SESSION_BUS_ADDRESS<\/code>,\n+<li><code>DESKTOP_SESSION<\/code>,\n@@ -1414,0 +1416,1 @@\n+<li><code>GDMSESSION<\/code>,\n@@ -1415,0 +1418,1 @@\n+<li><code>GNOME_SHELL_SESSION_MODE<\/code>,\n@@ -1421,2 +1425,4 @@\n-<li><code>TZ<\/code> and\n-<li><code>XMODIFIERS<\/code>.\n+<li><code>TZ<\/code>,\n+<li><code>WAYLAND_DISPLAY<\/code>,\n+<li><code>XMODIFIERS<\/code>,\n+<li><code>XAUTHORITY<\/code>\n","filename":"src\/share\/doc\/javatest\/regtest\/tag-spec.html","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -86,0 +86,13 @@\n+$(BUILDTESTDIR)\/EnvTest.assert.envs.ok: \\\n+\t\t$(JTREG_IMAGEDIR)\/lib\/javatest.jar \\\n+\t\t$(JTREG_IMAGEDIR)\/lib\/jtreg.jar \\\n+\t\t$(JTREG_IMAGEDIR)\/bin\/jtreg\n+\n+\tPRINTER=foo XAUTHORITY=bar DESKTOP_SESSION=foobar \\\n+\tSystemRoot=barfoo windir=hello \\\n+\t\t$(JTREG_IMAGEDIR)\/bin\/jtreg $(JTREG_OPTS) \\\n+            -jdk:$(JDKHOME) \\\n+            -w $(@:%.ok=%)\/work\/ \\\n+            -r $(@:%.ok=%)\/report\/ \\\n+            -verbose:fail \\\n+            $(TESTDIR)\/env\/EnvVarAssertTest.java\n@@ -96,0 +109,2 @@\n+\n+TESTS.jtreg += $(BUILDTESTDIR)\/EnvTest.assert.envs.ok\n","filename":"test\/env\/EnvTest.gmk","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -0,0 +1,66 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.util.Map;\n+import java.util.Set;\n+\n+\/*\n+ * @test\n+ * @run main EnvVarAssertTest\n+ *\/\n+public class EnvVarAssertTest {\n+\n+    private static final Set<String> UNIX_EXPECTED_ENV_VARS = Set.of(\n+            \"XAUTHORITY\", \"PRINTER\", \"DESKTOP_SESSION\"\n+    );\n+\n+    private static final Set<String> WINDOWS_EXPECTED_ENV_VARS = Set.of(\n+            \"SystemRoot\", \"windir\"\n+    );\n+\n+    public static void main(final String[] args) throws Exception {\n+        final String os = System.getProperty(\"os.name\");\n+        if (os.startsWith(\"Linux\") || os.startsWith(\"Mac\")) {\n+            assertEnvVars(UNIX_EXPECTED_ENV_VARS);\n+        } else if (os.startsWith(\"Windows\")) {\n+            assertEnvVars(WINDOWS_EXPECTED_ENV_VARS);\n+        } else {\n+            throw new jtreg.SkippedException(\"Skipping test on OS: \" + os);\n+        }\n+    }\n+\n+    private static void assertEnvVars(final Set<String> expected) {\n+        final Map<String, String> actual = System.getenv();\n+        for (final String envVar : expected) {\n+            if (!actual.containsKey(envVar)) {\n+                throw new AssertionError(\"environment variable \\\"\" + envVar + \"\\\" is not set\");\n+            }\n+            final String val = actual.get(envVar);\n+            if (val == null) {\n+                throw new AssertionError(\"null value for environment variable \\\"\" + envVar);\n+            }\n+            System.out.println(\"found expected environment variable \\\"\"\n+                    + envVar + \"\\\", set to \\\"\" + val + \"\\\"\");\n+        }\n+    }\n+}\n","filename":"test\/env\/EnvVarAssertTest.java","additions":66,"deletions":0,"binary":false,"changes":66,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,1 +23,0 @@\n-\n@@ -27,1 +26,1 @@\n-    public SkippedException(String msg) {\n+    public SkippedException(final String msg) {\n@@ -30,1 +29,1 @@\n-}\n\\ No newline at end of file\n+}\n","filename":"test\/env\/jtreg\/SkippedException.java","additions":3,"deletions":4,"binary":false,"changes":7,"previous_filename":"test\/share\/basic\/lib\/jtreg\/SkippedException.java","status":"copied"}]}