{"files":[{"patch":"@@ -50,0 +50,1 @@\n+\n@@ -102,0 +103,2 @@\n+        \/\/ Don't perform service bindings by default as outlined by JEP 343\n+        \/\/ and JEP 392\n@@ -103,1 +106,1 @@\n-                .resolveAndBind(finder, ModuleFinder.of(), roots)\n+                .resolve(finder, ModuleFinder.of(), roots)\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/JLinkBundlerHelper.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -17,1 +17,2 @@\n-        java.base\/jdk.internal.util\n+        java.base\/jdk.internal.util \\\n+        jdk.jlink\/jdk.tools.jlink.internal\n","filename":"test\/jdk\/tools\/jpackage\/TEST.properties","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -30,0 +30,2 @@\n+import java.util.Collection;\n+import java.util.Collections;\n@@ -44,0 +46,1 @@\n+import jdk.jpackage.test.Annotations.ParameterSupplier;\n@@ -45,0 +48,1 @@\n+import jdk.tools.jlink.internal.LinkableRuntimeImage;\n@@ -58,0 +62,26 @@\n+\n+    public static Collection addModulesParams() {\n+        List<Object[][]> params = new ArrayList<>();\n+        params.add(new Object[][] { new String[] { \"--add-modules\", \"ALL-DEFAULT\"  } });\n+        params.add(new Object[][] { new String[] { \"--add-modules\", \"java.desktop\" } });\n+        params.add(new Object[][] { new String[] { \"--add-modules\", \"java.desktop,jdk.jartool\" } });\n+        params.add(new Object[][] { new String[] { \"--add-modules\", \"java.desktop\", \"--add-modules\", \"jdk.jartool\" } });\n+        if (isAllModulePathCapable()) {\n+            final Path jmods = Path.of(System.getProperty(\"java.home\"), \"jmods\");\n+            params.add(new Object[][] { new String[] { \"--add-modules\", \"ALL-MODULE-PATH\",\n+                                                       \/\/ Since JDK-8345259 ALL-MODULE-PATH requires --module-path arg\n+                                                       \"--module-path\", jmods.toString() } });\n+        }\n+        return Collections.unmodifiableList(params);\n+    }\n+\n+    private static boolean isAllModulePathCapable() {\n+        Path jmods = Path.of(System.getProperty(\"java.home\"), \"jmods\");\n+        boolean noJmods = Files.notExists(jmods);\n+        if (LinkableRuntimeImage.isLinkableRuntime() && noJmods) {\n+           TKit.trace(\"ALL-MODULE-PATH test skipped for linkable run-time image\");\n+           return false;\n+        }\n+        return true;\n+    }\n+\n@@ -309,6 +339,2 @@\n-    @Parameter(\"ALL-MODULE-PATH\")\n-    @Parameter(\"ALL-DEFAULT\")\n-    @Parameter(\"java.desktop\")\n-    @Parameter(\"java.desktop,jdk.jartool\")\n-    @Parameter({ \"java.desktop\", \"jdk.jartool\" })\n-    public void testAddModules(String... addModulesArg) {\n+    @ParameterSupplier(\"addModulesParams\")\n+    public void testAddModules(String[] addModulesArg) {\n@@ -318,2 +344,1 @@\n-        Stream.of(addModulesArg).map(v -> Stream.of(\"--add-modules\", v)).flatMap(\n-                s -> s).forEachOrdered(cmd::addArgument);\n+        Stream.of(addModulesArg).forEachOrdered(cmd::addArgument);\n","filename":"test\/jdk\/tools\/jpackage\/share\/BasicTest.java","additions":33,"deletions":8,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -61,1 +61,1 @@\n-                    \"--bind-services\",\n+                    \"--verbose --bind-services --limit-modules java.smartcardio,jdk.crypto.cryptoki,java.desktop\",\n@@ -63,1 +63,1 @@\n-                    \/\/ with bind-services should have some services\n+                    \/\/ with limit-modules and bind-services should have them in the result\n@@ -69,1 +69,2 @@\n-                    \"--jlink-options\", \"--bind-services\",\n+                    \"--jlink-options\",\n+                    \"--bind-services --limit-modules jdk.jartool,jdk.unsupported,java.desktop\",\n@@ -71,1 +72,1 @@\n-                    \/\/ non modular should have everything\n+                    \/\/ non modular should have at least the module limits\n@@ -78,1 +79,2 @@\n-                    \"--jlink-options\", \"--bind-services\",\n+                    \"--jlink-options\",\n+                    \"--bind-services --limit-modules java.smartcardio,jdk.crypto.cryptoki,java.desktop\",\n","filename":"test\/jdk\/tools\/jpackage\/share\/JLinkOptionsTest.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -54,1 +54,0 @@\n-        final Path jmods = Path.of(System.getProperty(\"java.home\"), \"jmods\");\n@@ -64,2 +63,1 @@\n-                \"--add-modules\", \"ALL-MODULE-PATH\",\n-                \"--module-path\", jmods.toString(),\n+                \"--add-modules\", \"java.desktop\",\n","filename":"test\/jdk\/tools\/jpackage\/share\/RuntimeImageSymbolicLinksTest.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -47,1 +47,0 @@\n-        final Path jmods = Path.of(System.getProperty(\"java.home\"), \"jmods\");\n@@ -57,2 +56,1 @@\n-                \"--add-modules\", \"ALL-MODULE-PATH\",\n-                \"--module-path\", jmods.toString(),\n+                \"--add-modules\", \"java.desktop\",\n","filename":"test\/jdk\/tools\/jpackage\/share\/RuntimeImageTest.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -104,1 +104,0 @@\n-            final Path jmods = Path.of(System.getProperty(\"java.home\"), \"jmods\");\n@@ -116,2 +115,1 @@\n-                        \"--add-modules\", \"ALL-MODULE-PATH\",\n-                        \"--module-path\", jmods.toString(),\n+                        \"--add-modules\", \"java.desktop\",\n","filename":"test\/jdk\/tools\/jpackage\/share\/RuntimePackageTest.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"}]}