{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,13 +28,2 @@\n- * @run main\/manual Password\n- *\/\n-\n-\/*\n- * This scenario cannot be automated because util\/Password.java verifies the given input stream is\n- * equal to the initialSystemIn. This prevents the test from providing a custom input stream.\n- *\n- *  Steps to run the test:\n- *  1) Compile the class using the JDK version being tested: '<JdkBin>\/javac Password.java'\n- *  2) Run the test using the JDK version being tested: '<JdkBin>\/java -cp . Password'\n- *  3) Type in the first password, it should not be visible in the console\n- *  4) Type in the second password, it should be visible in the console\n- *  5) The final output line displays the entered passwords, both should be visible\n+ * @library \/test\/lib\n+ * @run main\/manual\/othervm Password\n@@ -44,0 +33,2 @@\n+\n+\n@@ -45,0 +36,5 @@\n+import javax.swing.*;\n+\n+import jdk.test.lib.UIBuilder;\n+\n+import java.util.Arrays;\n@@ -47,4 +43,0 @@\n-   public static void main(String args[]) throws Exception {\n-        TextCallbackHandler h = new TextCallbackHandler();\n-        PasswordCallback nc = new PasswordCallback(\"Invisible: \", false);\n-        PasswordCallback nc2 = new PasswordCallback(\"Visible: \", true);\n@@ -52,3 +44,13 @@\n-        System.out.println(\"Two passwords will be prompted for. The first one \" +\n-                \"should have echo off, the second one on. Otherwise, this test fails\");\n-        Callback[] callbacks = { nc, nc2 };\n+    private static final int TIMEOUT_MS = 240000;\n+    private volatile boolean failed = false;\n+    private volatile boolean aborted = false;\n+    private Thread currentThread = null;\n+\n+    public static void password() throws Exception {\n+\n+        TextCallbackHandler h = new TextCallbackHandler();\n+        PasswordCallback nc =\n+                new PasswordCallback(\"Please input something, your input should be VISIBLE: \", true);\n+        PasswordCallback nc2 =\n+                new PasswordCallback(\"Please input something again, your input should be INVISIBLE: \", false);\n+        Callback[] callbacks = {nc, nc2};\n@@ -58,1 +60,82 @@\n-   }\n+    }\n+\n+    public static void main(String[] args) throws Exception {\n+        if (Arrays.asList(args).contains(\"--password\")) {\n+            password();\n+        } else {\n+            final String instructions = String.format(\"%s\/bin\/java -cp \\\"%s\\\" Password --password\",\n+                    System.getProperty(\"java.home\").replace(\"\\\\\",\"\/\"),\n+                    System.getProperty(\"java.class.path\").replace(\"\\\\\",\"\/\")\n+            );\n+\n+            boolean testFailed = new Password().validate(\n+                    \"Please copy and execute the following script in the terminal \/ Windows Command Prompt window. \" +\n+                            \"Two passwords will be prompted for.\\n\" +\n+                            \"Enter something at each prompt and press Enter\/Return.\\n\" +\n+                            \"If the first input is visible and the second is invisible, this test PASSES. Otherwise, this test FAILS.\\n\" +\n+                            \"Once the test is complete please select whether the test has passed.\\n\",\n+                    instructions);\n+\n+            if (testFailed) {\n+                throw new RuntimeException(\"Test has failed\");\n+            }\n+        }\n+    }\n+\n+    public boolean validate(String instruction, String message) {\n+        failed = false;\n+        currentThread = Thread.currentThread();\n+        final JDialog dialog = new UIBuilder.DialogBuilder()\n+                .setTitle(\"Password\")\n+                .setInstruction(instruction)\n+                .setMessage(message)\n+                .setPassAction(e -> pass())\n+                .setFailAction(e -> fail())\n+                .setCloseAction(this::abort)\n+                .build();\n+\n+        SwingUtilities.invokeLater(() -> {\n+            try {\n+                dialog.setVisible(true);\n+            } catch (Exception e) {\n+                throw new RuntimeException(e);\n+            }\n+        });\n+\n+        try {\n+            Thread.sleep(TIMEOUT_MS);\n+            \/\/Timed out, so fail the test\n+            throw new RuntimeException(\n+                    \"Timed out after \" + TIMEOUT_MS \/ 1000 + \" seconds\");\n+        } catch (final InterruptedException e) {\n+            if (aborted) {\n+                throw new RuntimeException(\"TEST ABORTED\");\n+            }\n+\n+            if (failed) {\n+                System.out.println(\"TEST FAILED\");\n+                System.out.println(message);\n+            } else {\n+                System.out.println(\"TEST PASSED\");\n+            }\n+        } finally {\n+            dialog.dispose();\n+        }\n+\n+        return failed;\n+    }\n+\n+    public void pass() {\n+        failed = false;\n+        currentThread.interrupt();\n+    }\n+\n+    public void fail() {\n+        failed = true;\n+        currentThread.interrupt();\n+    }\n+\n+    public void abort() {\n+        aborted = true;\n+        currentThread.interrupt();\n+    }\n","filename":"test\/jdk\/com\/sun\/security\/auth\/callback\/TextCallbackHandler\/Password.java","additions":105,"deletions":22,"binary":false,"changes":127,"status":"modified"}]}