{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,18 @@\n+\/*\n+ * @test\n+ * @bug     4982128\n+ * @summary Test low memory detection of non-heap memory pool\n+ *\n+ * @run main\/othervm\/timeout=600 -noclassgc -XX:MaxMetaspaceSize=32m\n+ * LowMemoryTest2\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug     4982128\n+ * @summary Test low memory detection of non-heap memory pool\n+ *\n+ * @run main\/othervm\/timeout=600 -noclassgc -XX:MaxMetaspaceSize=16m\n+ * -XX:CompressedClassSpaceSize=4m LowMemoryTest2\n+ *\/\n+\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/LowMemoryTest2.java","additions":19,"deletions":1,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -1,80 +0,0 @@\n-#\n-# Copyright (c) 2004, 2019, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     4982128\n-# @summary Test low memory detection of non-heap memory pool\n-#\n-# @requires vm.gc==\"null\"\n-#\n-# @run build LowMemoryTest2 MemoryUtil\n-# @run shell\/timeout=600 LowMemoryTest2.sh\n-#\n-\n-if [ ! -z \"${TESTJAVA}\" ] ; then\n-     JAVA=${TESTJAVA}\/bin\/java\n-     CLASSPATH=${TESTCLASSES}\n-     export CLASSPATH\n-else\n-     echo \"--Error: TESTJAVA must be defined as the pathname of a jdk to test.\"\n-     exit 1\n-fi\n-\n-# Test execution\n-\n-failures=0\n-\n-go() {\n-    echo ''\n-    sh -xc \"$JAVA $TESTVMOPTS $*\" 2>&1\n-    if [ $? != 0 ]; then failures=`expr $failures + 1`; fi\n-}\n-\n-# Run test with each GC configuration\n-#\n-# Notes: To ensure that metaspace fills up we disable class unloading.\n-# Also we set the max metaspace to 16MB\/32MB - otherwise the test takes too\n-# long to run. The 32MB setting is required for running with CDS archive.\n-\n-go -noclassgc -XX:MaxMetaspaceSize=32m -XX:+UseSerialGC LowMemoryTest2\n-go -noclassgc -XX:MaxMetaspaceSize=32m -XX:+UseParallelGC LowMemoryTest2\n-\n-# Test class metaspace - might hit MaxMetaspaceSize instead if\n-# UseCompressedClassPointers is off or if 32 bit.\n-#\n-# (note: This is very shaky and that shakiness exposes a problem with MemoryMXBean:\n-#\n-#  MemoryMXBean defines \"used\" \"committed\" and \"max\" (see java\/lang\/management\/MemoryUsage.java)\n-#  This abstraction misses a definition for \"address space exhausted\" which with the new Metaspace (jep387)\n-#  can happen before committed\/used hits any trigger. We now commit only on demand and therefore class loaders\n-#  can sit atop of uncommitted address space, denying new loaders address space. In the old Metaspace,\n-#  we would have committed the space right away and therefore the MemoryMXBean \"committed\" trigger\n-#  would have fired. In the new Metaspace, we don't commit, so the MemoryMXBean does not fire.\n-go -noclassgc -XX:MaxMetaspaceSize=16m -XX:CompressedClassSpaceSize=4m LowMemoryTest2\n-\n-echo ''\n-if [ $failures -gt 0 ];\n-  then echo \"$failures test(s) failed\";\n-  else echo \"All test(s) passed\"; fi\n-exit $failures\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/LowMemoryTest2.sh","additions":0,"deletions":80,"binary":false,"changes":80,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,2 @@\n+ * @requires vm.gc == null | vm.gc == \"G1\"\n+ *\n@@ -34,2 +36,17 @@\n- * @build MemoryManagement MemoryUtil\n- * @run main\/othervm\/timeout=600 -Xmn8m -XX:+IgnoreUnrecognizedVMOptions -XX:G1HeapRegionSize=1 -XX:-UseLargePages MemoryManagement\n+ *\n+ * @run main\/othervm\/timeout=600 -Xmn8m -XX:+IgnoreUnrecognizedVMOptions\n+ * -XX:G1HeapRegionSize=1 -XX:-UseLargePages MemoryManagement\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug     4530538 6980984\n+ * @summary Basic unit test of memory management testing:\n+ *          1) setUsageThreshold() and getUsageThreshold()\n+ *          2) test low memory detection on the old generation.\n+ *\n+ * @author  Mandy Chung\n+ *\n+ * @modules jdk.management\n+ *\n+ * @run main\/timeout=600 MemoryManagement\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/MemoryManagement.java","additions":20,"deletions":3,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -1,54 +0,0 @@\n-#\n-# Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     4530538\n-# @summary Run MemoryManagement test with parallel GC\n-# @author  Mandy Chung\n-#\n-# @requires vm.gc==\"Parallel\" | vm.gc==\"null\"\n-#\n-# @run build MemoryManagement\n-# @run shell\/timeout=600 MemoryManagementParallelGC.sh\n-#\n-\n-#Set appropriate jdk\n-\n-if [ ! -z \"${TESTJAVA}\" ] ; then\n-     jdk=\"$TESTJAVA\"\n-else\n-     echo \"--Error: TESTJAVA must be defined as the pathname of a jdk to test.\"\n-     exit 1\n-fi\n-\n-runOne()\n-{\n-   echo \"runOne $@\"\n-   $TESTJAVA\/bin\/java ${TESTVMOPTS} -classpath $TESTCLASSES $@ || exit 2\n-}\n-\n-# Test MemoryManagement with parallel collector\n-runOne -XX:+UseParallelGC MemoryManagement\n-\n-exit 0\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/MemoryManagementParallelGC.sh","additions":0,"deletions":54,"binary":false,"changes":54,"status":"deleted"},{"patch":"@@ -1,54 +0,0 @@\n-#\n-# Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     4530538\n-# @summary Run MemoryManagement test with serial GC\n-# @author  Mandy Chung\n-#\n-# @requires vm.gc==\"Serial\" | vm.gc==\"null\"\n-#\n-# @run build MemoryManagement\n-# @run shell\/timeout=600 MemoryManagementSerialGC.sh\n-#\n-\n-#Set appropriate jdk\n-\n-if [ ! -z \"${TESTJAVA}\" ] ; then\n-     jdk=\"$TESTJAVA\"\n-else\n-     echo \"--Error: TESTJAVA must be defined as the pathname of a jdk to test.\"\n-     exit 1\n-fi\n-\n-runOne()\n-{\n-   echo \"runOne $@\"\n-   $TESTJAVA\/bin\/java ${TESTVMOPTS} -classpath $TESTCLASSES $@ || exit 2\n-}\n-\n-# Test MemoryManagement with serial collector\n-runOne -XX:+UseSerialGC MemoryManagement\n-\n-exit 0\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/MemoryManagementSerialGC.sh","additions":0,"deletions":54,"binary":false,"changes":54,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/MemoryTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1,58 +0,0 @@\n-#\n-# Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     4530538\n-# @summary\n-# @author  Mandy Chung\n-#\n-# @requires vm.gc==\"Parallel\" | vm.gc==\"null\"\n-#\n-# @run compile MemoryTest.java\n-# @run shell MemoryTestAllGC.sh\n-#\n-\n-#Set appropriate jdk\n-\n-if [ ! -z \"${TESTJAVA}\" ] ; then\n-     jdk=\"$TESTJAVA\"\n-else\n-     echo \"--Error: TESTJAVA must be defined as the pathname of a jdk to test.\"\n-     exit 1\n-fi\n-\n-runOne()\n-{\n-   echo \"runOne $@\"\n-   $TESTJAVA\/bin\/java ${TESTVMOPTS} -classpath $TESTCLASSES $@ || exit 2\n-}\n-\n-# Test MemoryTest with default collector\n-runOne MemoryTest 2 3\n-\n-# Test MemoryTest with parallel scavenger collector\n-runOne -XX:+UseParallelGC MemoryTest 2 3\n-\n-\n-exit 0\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/MemoryTestAllGC.sh","additions":0,"deletions":58,"binary":false,"changes":58,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,2 @@\n+ *\n+ * @run main Pending\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/Pending.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1,57 +0,0 @@\n-#\n-# Copyright (c) 2003, 2019, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     4530538\n-# @summary \n-# @author  Mandy Chung\n-# @requires vm.gc==\"null\"\n-# @modules java.base\/jdk.internal.misc\n-#          java.management\n-# @run compile Pending.java\n-# @run shell PendingAllGC.sh\n-#\n-\n-#Set appropriate jdk\n-\n-if [ ! -z \"${TESTJAVA}\" ] ; then\n-     jdk=\"$TESTJAVA\"\n-else\n-     echo \"--Error: TESTJAVA must be defined as the pathname of a jdk to test.\"\n-     exit 1\n-fi\n-\n-runOne()\n-{ \n-   echo \"runOne $@\"\n-   $TESTJAVA\/bin\/java ${TESTVMOPTS} -classpath $TESTCLASSES $@ || exit 2\n-}\n-\n-# Test Pending with default collector\n-runOne Pending\n-\n-# Test Pending with parallel scavenger collector\n-runOne -XX:+UseParallelGC Pending \n-\n-exit 0\n","filename":"test\/jdk\/java\/lang\/management\/MemoryMXBean\/PendingAllGC.sh","additions":0,"deletions":57,"binary":false,"changes":57,"status":"deleted"}]}