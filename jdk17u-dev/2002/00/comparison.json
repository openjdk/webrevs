{"files":[{"patch":"@@ -279,3 +279,1 @@\n-  if (periodMillis > 0) {\n-    JfrEventSetting::set_enabled(typed_event_id, true); \/\/ ensure sampling event is enabled\n-  }\n+  JfrEventSetting::set_enabled(typed_event_id, periodMillis > 0);\n","filename":"src\/hotspot\/share\/jfr\/jni\/jfrJniMethod.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -296,2 +296,4 @@\n-    for (uint i = 0; i < _added_java; ++i) {\n-      _events[i].commit();\n+    if (EventExecutionSample::is_enabled()) {\n+      for (uint i = 0; i < _added_java; ++i) {\n+        _events[i].commit();\n+      }\n@@ -302,2 +304,4 @@\n-    for (uint i = 0; i < _added_native; ++i) {\n-      _events_native[i].commit();\n+    if (EventNativeMethodSample::is_enabled()) {\n+      for (uint i = 0; i < _added_native; ++i) {\n+        _events_native[i].commit();\n+      }\n","filename":"src\/hotspot\/share\/jfr\/periodic\/sampling\/jfrThreadSampler.cpp","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -66,1 +66,0 @@\n-  bool _started;\n@@ -73,1 +72,1 @@\n-                                          _started(false), _untimed(timing == UNTIMED),\n+                                          _untimed(timing == UNTIMED),\n@@ -79,5 +78,2 @@\n-    if (T::is_enabled()) {\n-      _started = true;\n-      if (TIMED == timing && !T::isInstant) {\n-        set_starttime(JfrTicks::now());\n-      }\n+    if (!T::isInstant && !_untimed && is_enabled()) {\n+      set_starttime(JfrTicks::now());\n@@ -149,2 +145,2 @@\n-  bool is_started() const {\n-    return _started;\n+  bool is_started() {\n+    return is_instant() || _start_time != 0 || _untimed;\n@@ -154,1 +150,1 @@\n-    if (!_started) {\n+    if (!is_enabled()) {\n@@ -160,3 +156,0 @@\n-    if (_evaluated) {\n-      return _should_commit;\n-    }\n@@ -170,1 +163,7 @@\n-    return _started && (_evaluated ? _should_commit : evaluate());\n+    if (_evaluated) {\n+      return _should_commit;\n+    }\n+    if (!is_enabled()) {\n+      return false;\n+    }\n+    return evaluate();\n@@ -174,1 +173,0 @@\n-    assert(_started, \"invariant\");\n","filename":"src\/hotspot\/share\/jfr\/recorder\/service\/jfrEvent.hpp","additions":13,"deletions":15,"binary":false,"changes":28,"status":"modified"}]}