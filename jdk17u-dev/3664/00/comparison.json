{"files":[{"patch":"@@ -3196,1 +3196,1 @@\n-        Index<K,V> h; Node<K,V> n; long est;\n+        Index<K,V> h; Node<K,V> hn, n; long est;\n@@ -3198,1 +3198,1 @@\n-        if ((h = head) == null) {\n+        if ((h = head) == null || (hn = h.node) == null) {\n@@ -3203,1 +3203,1 @@\n-            n = h.node;\n+            n = hn.next;\n@@ -3282,1 +3282,1 @@\n-        Index<K,V> h; Node<K,V> n; long est;\n+        Index<K,V> h; Node<K,V> hn, n; long est;\n@@ -3284,1 +3284,1 @@\n-        if ((h = head) == null) {\n+        if ((h = head) == null || (hn = h.node) == null) {\n@@ -3289,1 +3289,1 @@\n-            n = h.node;\n+            n = hn.next;\n@@ -3386,1 +3386,1 @@\n-        Index<K,V> h; Node<K,V> n; long est;\n+        Index<K,V> h; Node<K,V> hn, n; long est;\n@@ -3388,1 +3388,1 @@\n-        if ((h = head) == null) {\n+        if ((h = head) == null || (hn = h.node) == null) {\n@@ -3393,1 +3393,1 @@\n-            n = h.node;\n+            n = hn.next;\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ConcurrentSkipListMap.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -1326,0 +1326,31 @@\n+    \/**\n+     * Spliterators.trySplit() returns null with an empty map and non-null when\n+     * it is not empty.\n+     *\/\n+    public void testSpliterators() {\n+        \/\/ To test JDK-8343426\n+        ConcurrentSkipListMap<Integer, Integer> map = new ConcurrentSkipListMap<>();\n+        for (int i = 1; i <= 1000; i++) map.put(i, i);\n+        \/\/ ensure that the splits do happen\n+        assertNotNull(map.keySet().spliterator().trySplit());\n+        assertNotNull(map.entrySet().spliterator().trySplit());\n+        assertNotNull(map.values().spliterator().trySplit());\n+        \/\/ ensure that the splits return *all* the items in the set\n+        assertEquals(500_500, map.keySet()\n+                .parallelStream()\n+                .mapToInt(Integer::valueOf)\n+                .sum());\n+        assertEquals(500_500, map.values()\n+                .parallelStream()\n+                .mapToInt(Integer::valueOf)\n+                .sum());\n+        assertEquals(500_500 * 2, map.entrySet()\n+                .parallelStream()\n+                .mapToInt(entry -> entry.getKey() + entry.getValue())\n+                .sum());\n+        map.clear();\n+        assertNull(map.keySet().spliterator().trySplit());\n+        assertNull(map.entrySet().spliterator().trySplit());\n+        assertNull(map.values().spliterator().trySplit());\n+    }\n+\n","filename":"test\/jdk\/java\/util\/concurrent\/tck\/ConcurrentSkipListMapTest.java","additions":31,"deletions":0,"binary":false,"changes":31,"status":"modified"}]}