{"files":[{"patch":"@@ -28,0 +28,1 @@\n+import java.io.File;\n@@ -46,1 +47,1 @@\n-      * headless mode, in the case the application did specify\n+      * headless mode, in the case the application did not specify\n@@ -51,1 +52,1 @@\n-        return\n+        boolean noDisplay =\n@@ -55,1 +56,25 @@\n-               return  display == null || display.trim().isEmpty();\n+               return display == null || display.trim().isEmpty();\n+            });\n+        if (noDisplay) {\n+            return true;\n+        }\n+        \/*\n+         * If we positively identify a separate headless library support being present\n+         * but no corresponding headful library, then we can support headless but\n+         * not headful, so report that back to the caller.\n+         * This does require duplication of knowing the name of the libraries\n+         * also in libawt's OnLoad() but we need to make sure that the Java\n+         * code is also set up as headless from the start - it is not so easy\n+         * to try headful and then unwind that and then retry as headless.\n+         *\/\n+        boolean headless =\n+            AccessController.doPrivileged((PrivilegedAction<Boolean>) () -> {\n+                String[] libDirs = System.getProperty(\"sun.boot.library.path\", \"\").split(\":\");\n+                for (String libDir : libDirs) {\n+                    File headlessLib = new File(libDir, \"libawt_headless.so\");\n+                    File xawtLib = new File(libDir, \"libawt_xawt.so\");\n+                    if (headlessLib.exists() && !xawtLib.exists()) {\n+                        return true;\n+                    }\n+                }\n+                return false;\n@@ -57,0 +82,1 @@\n+        return headless;\n@@ -66,2 +92,6 @@\n-            \"\\nNo X11 DISPLAY variable was set,\\n\" +\n-            \"but this program performed an operation which requires it.\";\n+            \"\"\"\n+\n+            No X11 DISPLAY variable was set,\n+            or no headful library support was found,\n+            but this program performed an operation which requires it,\n+            \"\"\";\n","filename":"src\/java.desktop\/unix\/classes\/sun\/awt\/PlatformGraphicsInfo.java","additions":35,"deletions":5,"binary":false,"changes":40,"status":"modified"}]}