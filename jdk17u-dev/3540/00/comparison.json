{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,0 @@\n- * @author  Konstantin Eremin\n@@ -35,2 +34,3 @@\n-import javax.swing.*;\n-import java.awt.*;\n+import java.awt.BorderLayout;\n+import java.awt.Dimension;\n+import java.awt.Robot;\n@@ -39,0 +39,6 @@\n+import javax.swing.JButton;\n+import javax.swing.JFrame;\n+import javax.swing.JPanel;\n+import javax.swing.JTextField;\n+import javax.swing.JToolBar;\n+import javax.swing.SwingUtilities;\n@@ -40,1 +46,1 @@\n-public class bug4529206 extends JFrame {\n+public class bug4529206 {\n@@ -43,3 +49,5 @@\n-    public bug4529206() {\n-        setDefaultCloseOperation(EXIT_ON_CLOSE);\n-        JPanel jPanFrame = (JPanel) this.getContentPane();\n+    static JButton jButton1;\n+\n+    private static void test() {\n+        frame = new JFrame();\n+        JPanel jPanFrame = (JPanel) frame.getContentPane();\n@@ -47,3 +55,2 @@\n-        this.setSize(new Dimension(200, 100));\n-        this.setLocation(125, 75);\n-        this.setTitle(\"Test Floating Toolbar\");\n+        frame.setSize(new Dimension(200, 100));\n+        frame.setTitle(\"Test Floating Toolbar\");\n@@ -51,1 +58,1 @@\n-        JButton jButton1 = new JButton(\"Float\");\n+        jButton1 = new JButton(\"Float\");\n@@ -61,2 +68,4 @@\n-        makeToolbarFloat();\n-        setVisible(true);\n+\n+        frame.setUndecorated(true);\n+        frame.setLocationRelativeTo(null);\n+        frame.setVisible(true);\n@@ -65,1 +74,1 @@\n-    private void makeToolbarFloat() {\n+    private static void makeToolbarFloat() {\n@@ -73,1 +82,1 @@\n-    private void buttonPressed(ActionEvent e) {\n+    private static void buttonPressed(ActionEvent e) {\n@@ -78,11 +87,4 @@\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            public void run() {\n-                frame = new bug4529206();\n-            }\n-        });\n-        Robot robot = new Robot();\n-        robot.waitForIdle();\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            public void run() {\n-                if (frame.isFocused()) {\n-                    throw (new RuntimeException(\"setFloating does not work correctly\"));\n+        try {\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                public void run() {\n+                    test();\n@@ -90,2 +92,25 @@\n-            }\n-        });\n+            });\n+            Robot robot = new Robot();\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+\n+            SwingUtilities.invokeAndWait(() -> {\n+                makeToolbarFloat();\n+            });\n+\n+            robot.waitForIdle();\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                public void run() {\n+                    if (frame.isFocused()) {\n+                        throw\n+                          new RuntimeException(\"setFloating does not work correctly\");\n+                    }\n+                }\n+            });\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n+        }\n","filename":"test\/jdk\/javax\/swing\/JToolBar\/4529206\/bug4529206.java","additions":54,"deletions":29,"binary":false,"changes":83,"status":"modified"}]}