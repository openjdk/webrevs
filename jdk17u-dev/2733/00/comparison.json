{"files":[{"patch":"@@ -476,1 +476,0 @@\n-java\/awt\/Toolkit\/DesktopProperties\/rfe4758438.java 8193547 linux-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+ * @requires os.family == \"linux\"\n@@ -46,0 +47,1 @@\n+                \"org.gnome.desktop.peripherals.mouse  drag-threshold\",\n@@ -52,0 +54,1 @@\n+                \"org.gnome.desktop.peripherals.mouse double-click\",\n@@ -59,0 +62,1 @@\n+                null,\n@@ -65,0 +69,1 @@\n+                null,\n@@ -71,0 +76,1 @@\n+                null,\n@@ -77,0 +83,1 @@\n+        public final String gsettingsFallback;\n@@ -82,1 +89,8 @@\n-        PROPS(String gsettings, String gconftool, String java, String type, String[] values){\n+        PROPS(\n+                String gsettings,\n+                String gsettingsFallback,\n+                String gconftool,\n+                String java,\n+                String type,\n+                String[] values\n+        ){\n@@ -84,0 +98,1 @@\n+            this.gsettingsFallback = gsettingsFallback;\n@@ -93,1 +108,1 @@\n-    Toolkit toolkit = Toolkit.getDefaultToolkit();\n+    final Toolkit toolkit = Toolkit.getDefaultToolkit();\n@@ -96,1 +111,1 @@\n-    Object lock = new Object();\n+    final Object lock = new Object();\n@@ -108,1 +123,1 @@\n-            } catch (Exception e) {\n+            } catch (Exception ignored) {\n@@ -135,0 +150,28 @@\n+    String prepareCommand(PROPS property, boolean useMain) {\n+        \/\/Create the command to execute\n+        StringBuffer sb = new StringBuffer(tool);\n+        if (useGsettings) {\n+            sb.append(\" set \");\n+            sb.append( useMain\n+                    ? property.gsettings\n+                    : property.gsettingsFallback\n+            );\n+            sb.append(\" \");\n+        } else {\n+            sb.append(\" --set --type=\");\n+            sb.append(property.type);\n+            sb.append(\" \");\n+            sb.append(property.gconftool);\n+            sb.append(\" \");\n+        }\n+        return sb.toString();\n+    }\n+\n+    int doTestCommand(String cmd) throws Exception {\n+        \/\/Initialize the variables and execute the command\n+        changedProperty = \"\";\n+        changedValue = null;\n+\n+        return executeCommand(cmd);\n+    }\n+\n@@ -149,2 +192,2 @@\n-            if (obj.equals(new Integer(1))) {\n-                obj = new String(\"true\");\n+            if (obj.equals(1)) {\n+                obj = \"true\";\n@@ -152,1 +195,1 @@\n-                obj = new String(\"false\");\n+                obj = \"false\";\n@@ -160,15 +203,1 @@\n-        \/\/Create the command to execute\n-        StringBuffer sb = new StringBuffer(tool);\n-        if (useGsettings) {\n-            sb.append(\" set \");\n-            sb.append(property.gsettings);\n-            sb.append(\" \");\n-        } else {\n-            sb.append(\" --set --type=\");\n-            sb.append(property.type);\n-            sb.append(\" \");\n-            sb.append(property.gconftool);\n-            sb.append(\" \");\n-        }\n-        String tempCommand = sb.toString();\n-        sb.append(value.toString());\n+        String tempCommand = prepareCommand(property, true);\n@@ -176,5 +205,15 @@\n-        \/\/Initialize the variables and execute the command\n-        changedProperty = \"\";\n-        changedValue = null;\n-        if (executeCommand(sb.toString()) != 0)\n-            throw new RuntimeException(\"Could not execute the command\");\n+        int retVal = doTestCommand(tempCommand + value);\n+\n+        if (retVal != 0) {\n+            if (useGsettings && property.gsettingsFallback != null) {\n+                System.out.printf(\"Failed:\\n\\t%s\\nTrying fallback:\\n\\t\", tempCommand);\n+                tempCommand = prepareCommand(property, false);\n+                System.out.println(tempCommand);\n+\n+                retVal = doTestCommand(tempCommand + value);\n+            }\n+\n+            if (retVal != 0) {\n+                throw new RuntimeException(\"Could not execute the command\");\n+            }\n+        }\n@@ -185,1 +224,1 @@\n-            } catch (Exception e) {\n+            } catch (Exception ignored) {\n@@ -188,0 +227,1 @@\n+\n@@ -189,2 +229,2 @@\n-            if (changedValue.equals(new Integer(1))) {\n-                changedValue = new String(\"true\");\n+            if (changedValue.equals(1)) {\n+                changedValue = \"true\";\n@@ -192,1 +232,1 @@\n-                changedValue = new String(\"false\");\n+                changedValue = \"false\";\n@@ -199,1 +239,1 @@\n-            executeCommand(tempCommand + obj.toString());\n+            executeCommand(tempCommand + obj);\n@@ -203,1 +243,1 @@\n-            executeCommand(tempCommand + obj.toString());\n+            executeCommand(tempCommand + obj);\n@@ -209,1 +249,1 @@\n-        executeCommand(tempCommand + obj.toString());\n+        executeCommand(tempCommand + obj);\n@@ -234,1 +274,1 @@\n-            System.out.println(stdout.toString());\n+            System.out.println(stdout);\n@@ -236,1 +276,1 @@\n-            System.err.println(stderr.toString());\n+            System.err.println(stderr);\n","filename":"test\/jdk\/java\/awt\/Toolkit\/DesktopProperties\/rfe4758438.java","additions":77,"deletions":37,"binary":false,"changes":114,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-# Copyright (c) 2014, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,6 @@\n-        GNOMESID=`pgrep gnome-session`\n+        GNOMESID=`pgrep gnome-session | head -n1`\n+\n+        printf \"\\n\/* gnome-session environ\\n\"\n+        cat \"\/proc\/$GNOMESID\/environ\" | tr '\\0' '\\n'\n+        printf \"\\n*\/\\n\\n\"\n+\n@@ -34,0 +39,1 @@\n+\n@@ -36,7 +42,3 @@\n-        ;;\n-    Sun* )\n-        GNOMESID=`pgrep gnome-session`\n-        DBUS_SESSION_BUS_ADDRESS=`pargs -e $GNOMESID | grep DBUS_SESSION_BUS_ADDRESS | cut -d= -f2-`\n-        export DBUS_SESSION_BUS_ADDRESS\n-        DISPLAY=`pargs -e $GNOMESID | grep DISPLAY | cut -d= -f2-`\n-        export DISPLAY\n+\n+        XDG_CURRENT_DESKTOP=`grep -z XDG_CURRENT_DESKTOP \/proc\/$GNOMESID\/environ | cut -d= -f2-`\n+        export XDG_CURRENT_DESKTOP\n@@ -50,1 +52,9 @@\n-if [ ${GNOME_DESKTOP_SESSION_ID:-nonset} = \"nonset\" ];\n+printf \"\\n\/* Test env:\\n\\n\"\n+env\n+printf \"\\n*\/\\n\\n\"\n+\n+XDG_GNOME=$(echo $XDG_CURRENT_DESKTOP | grep -i gnome)\n+\n+if [ -z \"$XDG_GNOME\" ] \\\n+     && [ ${GNOME_DESKTOP_SESSION_ID:-nonset} = \"nonset\" ] \\\n+     && [ ${GNOME_SESSION_NAME:-nonset} = \"nonset\" ]\n@@ -52,5 +62,2 @@\n-    if [ ${GNOME_SESSION_NAME:-nonset} = \"nonset\" ];\n-    then\n-        echo \"This test should run under Gnome\"\n-        exit 0\n-    fi\n+    echo \"This test should run under Gnome\"\n+    exit 0\n@@ -73,0 +80,2 @@\n+\n+set -e\n@@ -74,0 +83,2 @@\n+set +e\n+\n","filename":"test\/jdk\/java\/awt\/Toolkit\/DesktopProperties\/rfe4758438.sh","additions":26,"deletions":15,"binary":false,"changes":41,"status":"modified"}]}