{"files":[{"patch":"@@ -29,1 +29,0 @@\n- * @author Oleg Mokhovikov\n@@ -35,4 +34,1 @@\n-import java.awt.*;\n-import javax.swing.*;\n-import javax.swing.event.MenuListener;\n-import javax.swing.event.MenuEvent;\n+import java.awt.Robot;\n@@ -40,0 +36,12 @@\n+import java.util.concurrent.CountDownLatch;\n+\n+import javax.swing.JFrame;\n+import javax.swing.JMenu;\n+import javax.swing.JMenuBar;\n+import javax.swing.SwingUtilities;\n+import javax.swing.UIManager;\n+import javax.swing.UnsupportedLookAndFeelException;\n+import javax.swing.event.MenuEvent;\n+import javax.swing.event.MenuListener;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n@@ -42,1 +50,0 @@\n-    static volatile boolean bMenuSelected = false;\n@@ -45,0 +52,2 @@\n+    private static final CountDownLatch menuSelected = new CountDownLatch(1);\n+\n@@ -46,0 +55,1 @@\n+        @Override\n@@ -47,0 +57,1 @@\n+        @Override\n@@ -48,0 +59,2 @@\n+\n+        @Override\n@@ -50,1 +63,1 @@\n-            bMenuSelected = true;\n+            menuSelected.countDown();\n@@ -59,1 +72,3 @@\n-        frame = new JFrame();\n+        menu.addMenuListener(new TestMenuListener());\n+\n+        frame = new JFrame(\"bug4983388\");\n@@ -62,1 +77,1 @@\n-        frame.pack();\n+        frame.setSize(250, 100);\n@@ -64,2 +79,0 @@\n-        MenuListener listener = new TestMenuListener();\n-        menu.addMenuListener(listener);\n@@ -69,1 +82,0 @@\n-\n@@ -73,1 +85,2 @@\n-            System.err.println(\"GTKLookAndFeel is not supported on this platform. Using defailt LaF for this platform.\");\n+            System.err.println(\"GTKLookAndFeel is not supported on this platform. \"\n+                               + \"Using default LaF for this platform.\");\n@@ -76,5 +89,1 @@\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            public void run() {\n-                createAndShowGUI();\n-            }\n-        });\n+        SwingUtilities.invokeAndWait(bug4983388::createAndShowGUI);\n@@ -88,4 +97,0 @@\n-        robot.waitForIdle();\n-        robot.delay(500);\n-\n-        SwingUtilities.invokeAndWait(() -> frame.dispose());\n@@ -93,2 +98,6 @@\n-        if (!bMenuSelected) {\n-            throw new RuntimeException(\"shortcuts on menus do not work\");\n+        try {\n+            if (!menuSelected.await(1, SECONDS)) {\n+                throw new RuntimeException(\"shortcuts on menus do not work\");\n+            }\n+        } finally {\n+            SwingUtilities.invokeAndWait(frame::dispose);\n","filename":"test\/jdk\/javax\/swing\/plaf\/basic\/BasicMenuUI\/4983388\/bug4983388.java","additions":33,"deletions":24,"binary":false,"changes":57,"status":"modified"}]}