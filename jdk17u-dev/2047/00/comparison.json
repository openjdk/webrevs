{"files":[{"patch":"@@ -39,1 +39,0 @@\n-    _start_addr(start_address),\n@@ -55,2 +54,3 @@\n-    char* touch_addr = Atomic::fetch_and_add(&_cur_addr, _chunk_size);\n-    if (touch_addr < _start_addr || touch_addr >= _end_addr) {\n+    char* cur_start = Atomic::load(&_cur_addr);\n+    char* cur_end = cur_start + MIN2(_chunk_size, pointer_delta(_end_addr, cur_start, 1));\n+    if (cur_start >= cur_end) {\n@@ -58,5 +58,3 @@\n-    }\n-\n-    char* end_addr = touch_addr + MIN2(_chunk_size, pointer_delta(_end_addr, touch_addr, sizeof(char)));\n-\n-    os::pretouch_memory(touch_addr, end_addr, _page_size);\n+    } else if (cur_start == Atomic::cmpxchg(&_cur_addr, cur_start, cur_end)) {\n+      os::pretouch_memory(cur_start, cur_end, _page_size);\n+    } \/\/ Else attempt to claim chunk failed, so try again.\n","filename":"src\/hotspot\/share\/gc\/shared\/pretouchTask.cpp","additions":6,"deletions":8,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,0 @@\n-  char* const _start_addr;\n","filename":"src\/hotspot\/share\/gc\/shared\/pretouchTask.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}