{"files":[{"patch":"@@ -1,110 +0,0 @@\n-\/*\n- * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package org.openjdk.bench.java.util.zip;\n-\n-import org.openjdk.jmh.annotations.*;\n-\n-import java.io.File;\n-import java.io.FileOutputStream;\n-import java.io.IOException;\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n-import java.util.concurrent.TimeUnit;\n-import java.util.zip.ZipEntry;\n-import java.util.zip.ZipFile;\n-import java.util.zip.ZipOutputStream;\n-\n-\/**\n- * Simple benchmark measuring cost of opening zip files, parsing CEN\n- * entries.\n- *\/\n-@BenchmarkMode(Mode.AverageTime)\n-@OutputTimeUnit(TimeUnit.NANOSECONDS)\n-@State(Scope.Thread)\n-@Warmup(iterations = 10, time = 500, timeUnit = TimeUnit.MILLISECONDS)\n-@Measurement(iterations = 5, time = 1000, timeUnit = TimeUnit.MILLISECONDS)\n-@Fork(3)\n-public class ZipFileOpen {\n-\n-    @Param({\"512\", \"1024\"})\n-    private int size;\n-\n-    public File zipFile;\n-    public File relativePathFile;\n-\n-    @Setup(Level.Trial)\n-    public void beforeRun() throws IOException {\n-        \/\/ Create a test Zip file with the number of entries.\n-        File tempFile = Files.createTempFile(\"zip-micro\", \".zip\").toFile();\n-        tempFile.deleteOnExit();\n-        try (FileOutputStream fos = new FileOutputStream(tempFile);\n-             ZipOutputStream zos = new ZipOutputStream(fos)) {\n-\n-            \/\/ Vary dir and entry sizes, with a bias towards shorter entries.\n-            String[] dirPrefixes = new String[] { \"dir1\", \"dir2\", \"dir3\",\n-                    \"longer-directory-name-\", \"ridiculously-long-pathname-to-help-exercize-vectorized-subroutines-\"};\n-            String[] entryPrefixes = new String[] { \"e\", \"long-entry-name-\",\n-                    \"ridiculously-long-entry-name-to-help-exercize-vectorized-subroutines-\"};\n-\n-            for (int i = 0; i < size; i++) {\n-                String ename = dirPrefixes[i % dirPrefixes.length] + i + \"\/\";\n-                zos.putNextEntry(new ZipEntry(ename));\n-\n-                ename += entryPrefixes[i % entryPrefixes.length] + \"-\" + i;\n-                zos.putNextEntry(new ZipEntry(ename));\n-            }\n-        }\n-        zipFile = tempFile;\n-        relativePathFile = Path.of(System.getProperty(\"user.dir\"))\n-                                .relativize(zipFile.toPath()).toFile();\n-    }\n-\n-    @Benchmark\n-    public ZipFile openCloseZipFile() throws Exception {\n-        \/\/ Some shared resources in ZipFile are cached in a shared structure\n-        \/\/ and needs to be cleaned up to properly capture overhead of creating\n-        \/\/ a ZipFile - otherwise opening the same zip file again will reuse the\n-        \/\/ cached data and look artificially fast. By including the ZipFile.close()\n-        \/\/ we aggressively clear those resources pre-emptively. The operations\n-        \/\/ appears to be complex enough to not be subject to DCE but care needs\n-        \/\/ to be taken to check that things like initCEN is properly accounted\n-        \/\/ for if\/when the ZipFile setup improves.\n-        ZipFile zf = new ZipFile(zipFile);\n-        zf.close();\n-        return zf;\n-    }\n-\n-    @Benchmark\n-    public void openCloseZipFilex2() throws Exception {\n-        \/\/ A follow on from the openCloseZipFile benchmark.\n-        \/\/ The initCEN logic should be called once per file, if\n-        \/\/ opened multiple times and not closed, for the ZipFile\n-        \/\/ under test if that file is identified by a unique value\n-        \/\/ returned via attrs.fileKey()\n-        ZipFile zf = new ZipFile(zipFile);\n-        ZipFile zf2 = new ZipFile(relativePathFile);\n-        zf.close();\n-        zf2.close();\n-    }\n-}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/util\/zip\/ZipFileOpen.java","additions":0,"deletions":110,"binary":false,"changes":110,"status":"deleted"}]}