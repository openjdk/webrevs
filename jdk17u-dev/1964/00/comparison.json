{"files":[{"patch":"@@ -363,1 +363,4 @@\n-    _preserved_marks->push_if_necessary(obj, obj_mark);\n+    \/\/ Save the markWord of promotion-failed objs in _preserved_marks for later\n+    \/\/ restoration. This way we don't have to walk the young-gen to locate\n+    \/\/ these promotion-failed objs.\n+    _preserved_marks->push_always(obj, obj_mark);\n","filename":"src\/hotspot\/share\/gc\/parallel\/psPromotionManager.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -708,2 +708,0 @@\n-\/\/ This method iterates over all objects in the young generation,\n-\/\/ removing all forwarding references. It then restores any preserved marks.\n@@ -711,6 +709,0 @@\n-  ParallelScavengeHeap* heap = ParallelScavengeHeap::heap();\n-  PSYoungGen* young_gen = heap->young_gen();\n-\n-  RemoveForwardedPointerClosure remove_fwd_ptr_closure;\n-  young_gen->object_iterate(&remove_fwd_ptr_closure);\n-\n@@ -720,1 +712,1 @@\n-  NOT_PRODUCT(heap->reset_promotion_should_fail();)\n+  NOT_PRODUCT(ParallelScavengeHeap::heap()->reset_promotion_should_fail();)\n","filename":"src\/hotspot\/share\/gc\/parallel\/psScavenge.cpp","additions":1,"deletions":9,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -127,2 +127,4 @@\n-\n-    log_trace(gc)(\"Restored %zu marks\", _total_size);\n+    size_t mem_size = _total_size * (sizeof(oop) + sizeof(markWord));\n+    log_trace(gc)(\"Restored %zu marks, occupying %zu %s\", _total_size,\n+                                                          byte_size_in_proper_unit(mem_size),\n+                                                          proper_unit_for_byte_size(mem_size));\n","filename":"src\/hotspot\/share\/gc\/shared\/preservedMarks.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+  inline void push_always(oop obj, markWord m);\n","filename":"src\/hotspot\/share\/gc\/shared\/preservedMarks.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -50,0 +50,6 @@\n+inline void PreservedMarks::push_always(oop obj, markWord m) {\n+  assert(!m.is_marked(), \"precondition\");\n+  OopAndMarkWord elem(obj, m);\n+  _stack.push(elem);\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/shared\/preservedMarks.inline.hpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"}]}