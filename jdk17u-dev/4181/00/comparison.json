{"files":[{"patch":"@@ -64,0 +64,2 @@\n+import static java.time.LocalTime.MICROS_PER_SECOND;\n+import static java.time.LocalTime.MILLIS_PER_SECOND;\n@@ -1146,11 +1148,11 @@\n-            switch (chronoUnit) {\n-                case NANOS: return nanosUntil(end);\n-                case MICROS: return nanosUntil(end) \/ 1000;\n-                case MILLIS: return Math.subtractExact(end.toEpochMilli(), toEpochMilli());\n-                case SECONDS: return secondsUntil(end);\n-                case MINUTES: return secondsUntil(end) \/ SECONDS_PER_MINUTE;\n-                case HOURS: return secondsUntil(end) \/ SECONDS_PER_HOUR;\n-                case HALF_DAYS: return secondsUntil(end) \/ (12 * SECONDS_PER_HOUR);\n-                case DAYS: return secondsUntil(end) \/ (SECONDS_PER_DAY);\n-            }\n-            throw new UnsupportedTemporalTypeException(\"Unsupported unit: \" + unit);\n+            return switch (chronoUnit) {\n+                case NANOS     -> nanosUntil(end);\n+                case MICROS    -> microsUntil(end);\n+                case MILLIS    -> millisUntil(end);\n+                case SECONDS   -> secondsUntil(end);\n+                case MINUTES   -> secondsUntil(end) \/ SECONDS_PER_MINUTE;\n+                case HOURS     -> secondsUntil(end) \/ SECONDS_PER_HOUR;\n+                case HALF_DAYS -> secondsUntil(end) \/ (12 * SECONDS_PER_HOUR);\n+                case DAYS      -> secondsUntil(end) \/ (SECONDS_PER_DAY);\n+                default -> throw new UnsupportedTemporalTypeException(\"Unsupported unit: \" + unit);\n+            };\n@@ -1167,0 +1169,12 @@\n+    private long microsUntil(Instant end) {\n+        long secsDiff = Math.subtractExact(end.seconds, seconds);\n+        long totalMicros = Math.multiplyExact(secsDiff, MICROS_PER_SECOND);\n+        return Math.addExact(totalMicros, (end.nanos - nanos) \/ 1000);\n+    }\n+\n+    private long millisUntil(Instant end) {\n+        long secsDiff = Math.subtractExact(end.seconds, seconds);\n+        long totalMillis = Math.multiplyExact(secsDiff, MILLIS_PER_SECOND);\n+        return Math.addExact(totalMillis, (end.nanos - nanos) \/ 1000_000);\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/time\/Instant.java","additions":25,"deletions":11,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -185,0 +185,4 @@\n+    \/**\n+     * Milliseconds per second.\n+     *\/\n+    static final long MILLIS_PER_SECOND = 1000L;\n@@ -188,1 +192,5 @@\n-    static final long MILLIS_PER_DAY = SECONDS_PER_DAY * 1000L;\n+    static final long MILLIS_PER_DAY = MILLIS_PER_SECOND * SECONDS_PER_DAY;\n+    \/**\n+     * Microseconds per second.\n+     *\/\n+    static final long MICROS_PER_SECOND = 1000_000L;\n@@ -192,1 +200,1 @@\n-    static final long MICROS_PER_DAY = SECONDS_PER_DAY * 1000_000L;\n+    static final long MICROS_PER_DAY = MICROS_PER_SECOND * SECONDS_PER_DAY;\n","filename":"src\/java.base\/share\/classes\/java\/time\/LocalTime.java","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -63,0 +63,1 @@\n+import java.time.temporal.ChronoUnit;\n@@ -70,0 +71,1 @@\n+ * @bug 8273369\n@@ -99,0 +101,22 @@\n+    \/**\n+     * Checks whether Instant.until() returning microseconds does not throw\n+     * an ArithmeticException for Instants apart for more than Long.MAX_VALUE\n+     * nanoseconds.\n+     *\/\n+    @Test\n+    public void test_microsUntil() {\n+        var nanoMax = Instant.EPOCH.plusNanos(Long.MAX_VALUE);\n+        var totalMicros = Instant.EPOCH.until(nanoMax, ChronoUnit.MICROS);\n+        var plusOneMicro = Instant.EPOCH.until(nanoMax.plusNanos(1000), ChronoUnit.MICROS);\n+        assertEquals(plusOneMicro - totalMicros, 1L);\n+    }\n+\n+    \/**\n+     * Checks whether Instant.until() returning milliseconds does not throw\n+     * an ArithmeticException for very large\/small Instants\n+     *\/\n+    @Test\n+    public void test_millisUntil() {\n+        assertEquals(Instant.MIN.until(Instant.MIN.plusSeconds(1), ChronoUnit.MILLIS), 1000L);\n+        assertEquals(Instant.MAX.plusSeconds(-1).until(Instant.MAX, ChronoUnit.MILLIS), 1000L);\n+    }\n","filename":"test\/jdk\/java\/time\/test\/java\/time\/TestInstant.java","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"}]}