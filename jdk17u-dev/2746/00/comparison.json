{"files":[{"patch":"@@ -121,0 +121,1 @@\n+import static com.sun.source.doctree.DocTree.Kind.START_ELEMENT;\n@@ -1276,1 +1277,10 @@\n-    boolean ignoreNonInlineTag(DocTree dtree) {\n+    \/\/ helper methods because jdk21 functionality is not allowed\n+    private static Name getLastHelper(List<Name> l) {\n+        return l.get(l.size() - 1);\n+    }\n+\n+    private static Name removeLastHelper(List<Name> l) {\n+        return l.remove(l.size() - 1);\n+    }\n+\n+    boolean ignoreNonInlineTag(DocTree dtree, List<Name> openTags) {\n@@ -1278,6 +1288,5 @@\n-        if (dtree.getKind() == Kind.START_ELEMENT) {\n-            StartElementTree setree = (StartElementTree)dtree;\n-            name = setree.getName();\n-        } else if (dtree.getKind() == Kind.END_ELEMENT) {\n-            EndElementTree eetree = (EndElementTree)dtree;\n-            name = eetree.getName();\n+        Kind kind = dtree.getKind();\n+        if (kind == Kind.START_ELEMENT) {\n+            name = ((StartElementTree)dtree).getName();\n+        } else if (kind == Kind.END_ELEMENT) {\n+            name = ((EndElementTree)dtree).getName();\n@@ -1288,3 +1297,11 @@\n-            if (htmlTag != null &&\n-                    htmlTag.blockType != jdk.javadoc.internal.doclint.HtmlTag.BlockType.INLINE) {\n-                return true;\n+            if (htmlTag != null) {\n+                if (htmlTag.blockType != HtmlTag.BlockType.INLINE) {\n+                    return true;\n+                }\n+                \/\/ Keep track of open inline tags that need to be closed, see 8326332\n+                if (kind == START_ELEMENT && htmlTag.endKind == HtmlTag.EndKind.REQUIRED) {\n+                    openTags.add(name);\n+                } else if (kind == Kind.END_ELEMENT && !openTags.isEmpty()\n+                        && getLastHelper(openTags).equals(name)) {\n+                    removeLastHelper(openTags);\n+                }\n@@ -1380,0 +1397,1 @@\n+        List<Name> openTags = new ArrayList<>();\n@@ -1388,1 +1406,1 @@\n-                if (ignoreNonInlineTag(tag))\n+                if (ignoreNonInlineTag(tag, openTags)) {\n@@ -1390,0 +1408,1 @@\n+                }\n@@ -1394,1 +1413,1 @@\n-                        && isAllWhiteSpace(ch.getText(tag)))\n+                        && isAllWhiteSpace(ch.getText(tag))) {\n@@ -1396,0 +1415,1 @@\n+                }\n@@ -1641,0 +1661,4 @@\n+        \/\/ Close any open inline tags\n+        while (!openTags.isEmpty()) {\n+            result.add(RawHtml.endElement(removeLastHelper(openTags)));\n+        }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDocletWriter.java","additions":36,"deletions":12,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -129,0 +129,10 @@\n+\n+    \/**\n+     * Creates HTML for the end of an element.\n+     *\n+     * @param name the name of the element\n+     * @return the HTML\n+     *\/\n+    public static RawHtml endElement(CharSequence name) {\n+        return new RawHtml(\"<\/\" + name + \">\");\n+    }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/RawHtml.java","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 4165985\n+ * @bug 4165985 8326332\n@@ -79,0 +79,5 @@\n+\n+        checkOutput(\"pkg\/BreakIteratorTest.html\", true,\n+                \"\"\"\n+                    <div class=\"block\">Inline tags <i><a href=\"..\/index-all.html\">extending\n+                     beyond the first sentence.<\/a><\/i><\/div>\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testBreakIterator\/TestBreakIterator.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -59,0 +59,5 @@\n+    \/**\n+     * Inline tags <i><a href=\"{@docRoot}\/index-all.html\">extending\n+     * beyond the first sentence. Tags are closed here.<\/a><\/i>\n+     *\/\n+    public void meh(){}\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testBreakIterator\/pkg\/BreakIteratorTest.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}