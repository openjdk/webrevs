{"files":[{"patch":"@@ -0,0 +1,76 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+super public class LongCountedLoopInInfiniteLoop\n+{\n+  public Method \"<init>\":\"()V\"\n+    stack 1 locals 1\n+  {\n+        aload_0;\n+        invokespecial    Method java\/lang\/Object.\"<init>\":\"()V\";\n+        return;\n+  }\n+  Method test:\"()V\"\n+    stack 3 locals 3\n+  {\n+        \/\/ #1 = 0;\n+        iconst_0;\n+        istore_1;\n+\n+    LOOPa:\n+        \/\/ if #1 >= 10: goto END\n+        iload_1;\n+        bipush    10;\n+        if_icmpge    END;\n+\n+        \/\/ if #1 > 1: goto LOOPc\n+        iload_1;\n+        iconst_1;\n+        if_icmpgt    LOOPc;\n+\n+        \/\/ #2 = 0;\n+        iconst_0;\n+        istore_2;\n+\n+    LOOPb:\n+        \/\/ if #2 > 2: goto LOOPa\n+        iload_2;\n+        iconst_2;\n+        if_icmpgt    LOOPa;\n+\n+        \/\/ #2 ++\n+        iinc    2, 1;\n+\n+        goto    LOOPb;\n+\n+    LOOPc:\n+        \/\/ #1 ++\n+        iinc    1, 1;\n+\n+        goto    LOOPa;\n+\n+    END:\n+        return;\n+    \n+  }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/loopopts\/LongCountedLoopInInfiniteLoop.jasm","additions":76,"deletions":0,"binary":false,"changes":76,"status":"added"},{"patch":"@@ -0,0 +1,74 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+super public class MoveStoreAfterInfiniteLoop\n+{\n+  static Field a:I;\n+  static Field b:I;\n+  static Field c:S;\n+\n+  public Method \"<init>\":\"()V\"\n+\tstack 1 locals 1\n+  {\n+\t\taload_0;\n+\t\tinvokespecial\tMethod java\/lang\/Object.\"<init>\":\"()V\";\n+\t\treturn;\n+  }\n+\n+public static Method test:\"()V\"\n+    stack 3 locals 3\n+  {\n+    LTOP:\n+        iconst_0;\n+        istore_1;\n+\n+    LOUTER:\n+        iload_1;\n+        bipush    10;\n+        if_icmpge    LTOP;\n+\n+        getstatic    Field c:\"S\";\n+        putstatic    Field a:\"I\";\n+\n+        iconst_0;\n+        istore_2;\n+\n+    LINNER:\n+        iload_2;\n+        iconst_2;\n+        if_icmpge    LBOTTOM;\n+\n+        getstatic    Field b:\"I\";\n+        i2s;\n+        putstatic    Field c:\"S\";\n+\n+        iinc    2, 1;\n+\n+        goto    LINNER;\n+\n+    LBOTTOM:\n+        iinc    1, 1;\n+\n+        goto    LOUTER;\n+  }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/loopopts\/MoveStoreAfterInfiniteLoop.jasm","additions":74,"deletions":0,"binary":false,"changes":74,"status":"added"},{"patch":"@@ -0,0 +1,45 @@\n+\/*\n+ * Copyright (c) 2024, Red Hat, Inc. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8336478\n+ * @summary C2: assert(!n->as_Loop()->is_loop_nest_inner_loop() || _loop_opts_cnt == 0) failed: should have been turned into a counted loop\n+ * @compile LongCountedLoopInInfiniteLoop.jasm\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -Xcomp -XX:PerMethodTrapLimit=0 -XX:PerMethodSpecTrapLimit=0\n+ *                   -XX:+IgnoreUnrecognizedVMOptions -XX:StressLongCountedLoop=2000000\n+ *                   -XX:CompileCommand=compileonly,TestLongCountedLoopInInfiniteLoop::test TestLongCountedLoopInInfiniteLoop\n+ *\/\n+\n+public class TestLongCountedLoopInInfiniteLoop {\n+    public static void main(String[] args) {\n+        LongCountedLoopInInfiniteLoop obj = new LongCountedLoopInInfiniteLoop();\n+        test(false, obj);\n+    }\n+\n+    private static void test(boolean flag, LongCountedLoopInInfiniteLoop obj) {\n+        if (flag) {\n+            obj.test();\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/loopopts\/TestLongCountedLoopInInfiniteLoop.java","additions":45,"deletions":0,"binary":false,"changes":45,"status":"added"},{"patch":"@@ -0,0 +1,44 @@\n+\/*\n+ * Copyright (c) 2024, Red Hat, Inc. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8338100\n+ * @summary C2: assert(!n_loop->is_member(get_loop(lca))) failed: control must not be back in the loop\n+ * @compile MoveStoreAfterInfiniteLoop.jasm\n+ * @run main\/othervm -Xcomp -XX:-TieredCompilation -XX:CompileOnly=TestMoveStoreAfterInfiniteLoop::test\n+ *                   -XX:CompileCommand=inline,MoveStoreAfterInfiniteLoop::test TestMoveStoreAfterInfiniteLoop\n+ *\/\n+\n+public class TestMoveStoreAfterInfiniteLoop {\n+    public static void main(String[] args) {\n+        new MoveStoreAfterInfiniteLoop();\n+        test(false);\n+    }\n+\n+    private static void test(boolean flag) {\n+        if (flag) {\n+            MoveStoreAfterInfiniteLoop.test();\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/loopopts\/TestMoveStoreAfterInfiniteLoop.java","additions":44,"deletions":0,"binary":false,"changes":44,"status":"added"}]}