{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import java.util.concurrent.CountDownLatch;\n@@ -54,1 +55,1 @@\n-    Object barrier;\n+    final CountDownLatch lookupLatch;\n@@ -57,1 +58,1 @@\n-    SuccessfulLookup(Class<?> cl, long suid, Object barrier) {\n+    SuccessfulLookup(Class<?> cl, long suid, CountDownLatch lookupLatch) {\n@@ -60,1 +61,1 @@\n-        this.barrier = barrier;\n+        this.lookupLatch = lookupLatch;\n@@ -64,3 +65,4 @@\n-        synchronized (barrier) {\n-            try { barrier.wait(); } catch (InterruptedException ex) {}\n-        }\n+        lookupLatch.countDown(); \/\/ let others know we are ready\n+        try {\n+            lookupLatch.await(); \/\/ await for others\n+        } catch (InterruptedException ex) {}\n@@ -78,1 +80,1 @@\n-    final Object barrier;\n+    final CountDownLatch lookupLatch;\n@@ -81,1 +83,1 @@\n-    FailingLookup(Class<?> cl, Object barrier) {\n+    FailingLookup(Class<?> cl, CountDownLatch lookupLatch) {\n@@ -83,1 +85,1 @@\n-        this.barrier = barrier;\n+        this.lookupLatch = lookupLatch;\n@@ -87,3 +89,4 @@\n-        synchronized (barrier) {\n-            try { barrier.wait(); } catch (InterruptedException ex) {}\n-        }\n+        lookupLatch.countDown(); \/\/ let others know we are ready\n+        try {\n+            lookupLatch.await(); \/\/ await for others\n+        } catch (InterruptedException ex) {}\n@@ -105,2 +108,3 @@\n-        Object barrier = new Object();\n-        SuccessfulLookup[] slookups = new SuccessfulLookup[50];\n+        int numSuccessfulLookups = 50;\n+        CountDownLatch sLookupLatch = new CountDownLatch(numSuccessfulLookups);\n+        SuccessfulLookup[] slookups = new SuccessfulLookup[numSuccessfulLookups];\n@@ -108,2 +112,1 @@\n-            slookups[i] =\n-                new SuccessfulLookup(cl, 6319710844400051132L, barrier);\n+            slookups[i] = new SuccessfulLookup(cl, 6319710844400051132L, sLookupLatch);\n@@ -112,4 +115,1 @@\n-        Thread.sleep(1000);\n-        synchronized (barrier) {\n-            barrier.notifyAll();\n-        }\n+        System.out.println(\"awaiting completion of \" + slookups.length + \" SuccessfulLookup\");\n@@ -122,1 +122,1 @@\n-\n+        System.out.println(\"all \" + slookups.length + \" SuccessfulLookup completed\");\n@@ -124,1 +124,3 @@\n-        FailingLookup[] flookups = new FailingLookup[50];\n+        int numFailingLookups = 50;\n+        CountDownLatch fLookupLatch = new CountDownLatch(numFailingLookups);\n+        FailingLookup[] flookups = new FailingLookup[numFailingLookups];\n@@ -126,1 +128,1 @@\n-            flookups[i] = new FailingLookup(cl, barrier);\n+            flookups[i] = new FailingLookup(cl, fLookupLatch);\n@@ -129,5 +131,2 @@\n-        Thread.sleep(1000);\n-        synchronized (barrier) {\n-            barrier.notifyAll();\n-        }\n-        for (int i = 0; i < slookups.length; i++) {\n+        System.out.println(\"awaiting completion of \" + flookups.length + \" FailingLookup\");\n+        for (int i = 0; i < flookups.length; i++) {\n@@ -139,0 +138,1 @@\n+        System.out.println(\"all \" + flookups.length + \" FailingLookup completed\");\n","filename":"test\/jdk\/java\/io\/Serializable\/concurrentClassDescLookup\/ConcurrentClassDescLookup.java","additions":29,"deletions":29,"binary":false,"changes":58,"status":"modified"}]}