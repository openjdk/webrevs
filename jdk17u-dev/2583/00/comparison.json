{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -225,1 +225,1 @@\n-            return ForceGC.wait(() -> weakRef.refersTo(null));\n+            return ForceGC.waitFor(() -> weakRef.refersTo(null), 2000L);\n","filename":"test\/jdk\/java\/lang\/invoke\/defineHiddenClass\/UnloadingTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,2 +41,12 @@\n-     * returns true, or a specific waiting time elapses.  The waiting time\n-     * is 1 second scaled with the jtreg testing timeout factor.\n+     * returns true, or the waiting time elapses.  The waiting time\n+     * is 1 second scaled with the jtreg testing timeout factor. This method\n+     * is equivalent to calling {@link #waitFor(BooleanSupplier, long)\n+     * waitFor(booleanSupplier, Math.round(1000L * JTREG_TIMEOUT_FACTOR)}\n+     * where {@code JTREG_TIMEOUT_FACTOR} is the value of\n+     * \"test.timeout.factor\" system property.\n+     *\n+     * @apiNote If the given {@code booleanSupplier} is expected to never\n+     * return true, for example to check if an object that is expected\n+     * to be strongly reachable is still alive,\n+     * {@link #waitFor(BooleanSupplier, long)} can be used to specify\n+     * the timeout for the wait method to return.\n@@ -46,1 +56,2 @@\n-     *     if did not complete after the specific waiting time.\n+     *     if did not complete after the waiting time.\n+\n@@ -49,0 +60,18 @@\n+        return waitFor(booleanSupplier, Math.round(1000L * TIMEOUT_FACTOR));\n+    }\n+\n+    \/**\n+     * Causes the current thread to wait until the {@code booleanSupplier}\n+     * returns true, or the specified waiting time elapses.\n+     *\n+     * @apiNote If the given {@code booleanSupplier} is expected to never\n+     * return true, for example to check if an object that is expected\n+     * to be strongly reachable is still alive, this method can be used\n+     * to specify the timeout independent of the jtreg timeout factor.\n+     *\n+     * @param booleanSupplier boolean supplier\n+     * @param timeout the maximum time to wait, in milliseconds\n+     * @return true if the {@code booleanSupplier} returns true, or false\n+     *     if did not complete after the specified waiting time.\n+     *\/\n+    public static boolean waitFor(BooleanSupplier booleanSupplier, long timeout) {\n@@ -56,1 +85,1 @@\n-        int retries = (int)(Math.round(1000L * TIMEOUT_FACTOR) \/ 200);\n+        int retries = (int)(timeout \/ 200);\n","filename":"test\/lib\/jdk\/test\/lib\/util\/ForceGC.java","additions":34,"deletions":5,"binary":false,"changes":39,"status":"modified"}]}