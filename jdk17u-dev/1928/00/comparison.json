{"files":[{"patch":"@@ -1793,4 +1793,10 @@\n-    VERIFY(::WideCharToMultiByte(CP_ACP, 0, szFamilyName, -1,\n-        szTmpName, sizeof(szTmpName), NULL, NULL));\n-    LONG lStatus = ::RegQueryValueExA(hKey, (LPCSTR) szTmpName,\n-        NULL, &dwType, szFileName, &dwBytes);\n+    int nb = ::WideCharToMultiByte(CP_ACP, 0, szFamilyName, -1,\n+        szTmpName, sizeof(szTmpName), NULL, NULL);\n+    VERIFY(nb);\n+\n+    LONG lStatus = 1;\n+    if (nb > 0) {\n+        lStatus = ::RegQueryValueExA(hKey, (LPCSTR) szTmpName,\n+                                     NULL, &dwType, szFileName, &dwBytes);\n+    }\n+\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Font.cpp","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -3928,1 +3928,1 @@\n-    WideCharToMultiByte(CP_UTF8, 0, t_errStr, -1,\n+    int nb = WideCharToMultiByte(CP_UTF8, 0, t_errStr, -1,\n@@ -3930,1 +3930,5 @@\n-    JNU_ThrowByName(env, PRINTEREXCEPTION_STR, errStr);\n+    if (nb > 0) {\n+        JNU_ThrowByName(env, PRINTEREXCEPTION_STR, errStr);\n+    } else {\n+        JNU_ThrowByName(env, PRINTEREXCEPTION_STR, \"secondary error during OS message extraction\");\n+    }\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_PrintJob.cpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,0 +38,1 @@\n+    if (lpUTF8Str == NULL) return NULL;\n@@ -39,2 +40,6 @@\n-    WideCharToMultiByte(CP_UTF8, 0, lpUnicodeStr, -1, lpUTF8Str, dwUTF8Len, nullptr, nullptr);\n-    return lpUTF8Str;\n+    int nb = WideCharToMultiByte(CP_UTF8, 0, lpUnicodeStr, -1, lpUTF8Str, dwUTF8Len, nullptr, nullptr);\n+    if (nb > 0) {\n+        return lpUTF8Str;\n+    }\n+    delete[] lpUTF8Str;\n+    return NULL;\n@@ -45,3 +50,7 @@\n-    strncpy(dest, utf8EncodedName, maxLength - 1);\n-    delete[] utf8EncodedName;\n-    dest[maxLength - 1] = '\\0';\n+    if (utf8EncodedName != NULL) {\n+        strncpy(dest, utf8EncodedName, maxLength - 1);\n+        delete[] utf8EncodedName;\n+        dest[maxLength - 1] = '\\0';\n+    } else {\n+        if (maxLength > 0) dest[0] = '\\0';\n+    }\n","filename":"src\/java.desktop\/windows\/native\/libjsound\/PLATFORM_API_WinOS_Charset_Util.cpp","additions":15,"deletions":6,"binary":false,"changes":21,"status":"modified"}]}