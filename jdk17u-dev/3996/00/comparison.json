{"files":[{"patch":"@@ -93,4 +93,2 @@\n-\n-      if (written == sz * sizeof(char)) {\n-        return fclose(f) == 0;\n-      }\n+      \/\/ at least see \"header\"\n+      return fclose(f) == 0 && sz == written && sz >= 6;\n@@ -243,0 +241,1 @@\n+  fprintf(stdout, \"header\");\n@@ -249,1 +248,1 @@\n-  EXPECT_TRUE(write_to_file(testing::internal::GetCapturedStdout()));\n+  fflush(nullptr);\n@@ -251,3 +250,5 @@\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n+  if (write_to_file(testing::internal::GetCapturedStdout())) {\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"header\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n@@ -255,2 +256,3 @@\n-  if (AsyncLogWriter::instance() != nullptr) {\n-    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    if (AsyncLogWriter::instance() != nullptr) {\n+      EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    }\n@@ -262,0 +264,1 @@\n+  fprintf(stderr, \"header\");\n@@ -268,1 +271,1 @@\n-  EXPECT_TRUE(write_to_file(testing::internal::GetCapturedStderr()));\n+  fflush(nullptr);\n@@ -270,3 +273,5 @@\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n+  if (write_to_file(testing::internal::GetCapturedStderr())) {\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"header\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n@@ -274,2 +279,3 @@\n-  if (AsyncLogWriter::instance() != nullptr) {\n-    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    if (AsyncLogWriter::instance() != nullptr) {\n+      EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    }\n","filename":"test\/hotspot\/gtest\/logging\/test_asynclog.cpp","additions":22,"deletions":16,"binary":false,"changes":38,"status":"modified"}]}