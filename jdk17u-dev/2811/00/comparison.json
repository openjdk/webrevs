{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,0 +44,1 @@\n+import java.nio.file.Path;\n@@ -56,1 +57,1 @@\n-            File flagsFile = File.createTempFile(\"CheckOriginFlags\", null);\n+            File flagsFile = File.createTempFile(\"CheckOriginFlags\", null, Path.of(\".\").toFile());\n","filename":"test\/jdk\/com\/sun\/management\/HotSpotDiagnosticMXBean\/CheckOrigin.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -365,1 +365,1 @@\n-        File tmpFile = File.createTempFile(CHECK_PERMISSION_TEST, null);\n+        File tmpFile = File.createTempFile(CHECK_PERMISSION_TEST, null, new File(\".\"));\n@@ -371,1 +371,1 @@\n-        tmpFile = File.createTempFile(CHECK_PERMISSION_TEST, null, null);\n+        tmpFile = File.createTempFile(CHECK_PERMISSION_TEST, null, new File(\".\"));\n","filename":"test\/jdk\/java\/io\/File\/CheckPermission.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,4 +49,6 @@\n-        try (BufferedWriter writer =\n-            Files.newBufferedWriter(tmp, Charset.defaultCharset())) {\n-            for (int i = 0; i < SIZE; i++) {\n-                writer.write('1');\n+        try {\n+            try (BufferedWriter writer =\n+                         Files.newBufferedWriter(tmp, Charset.defaultCharset())) {\n+                for (int i = 0; i < SIZE; i++) {\n+                    writer.write('1');\n+                }\n@@ -54,1 +56,0 @@\n-        }\n@@ -56,5 +57,13 @@\n-        File tempFile = tmp.toFile();\n-        try (FileInputStream fis = new FileInputStream(tempFile)) {\n-            if (tempFile.length() != SIZE) {\n-                throw new RuntimeException(\"unexpected file size = \"\n-                                           + tempFile.length());\n+            File tempFile = tmp.toFile();\n+            try (FileInputStream fis = new FileInputStream(tempFile)) {\n+                if (tempFile.length() != SIZE) {\n+                    throw new RuntimeException(\"unexpected file size = \"\n+                            + tempFile.length());\n+                }\n+                long space = skipBytes(fis, SKIP, SIZE);\n+                space = skipBytes(fis, NEGATIVE_SKIP, space);\n+                space = skipBytes(fis, SKIP, space);\n+                space = skipBytes(fis, SKIP, space);\n+                space = skipBytes(fis, SKIP, space);\n+                space = skipBytes(fis, NEGATIVE_SKIP, space);\n+                space = skipBytes(fis, NEGATIVE_SKIP, space);\n@@ -62,7 +71,2 @@\n-            long space = skipBytes(fis, SKIP, SIZE);\n-            space = skipBytes(fis, NEGATIVE_SKIP, space);\n-            space = skipBytes(fis, SKIP, space);\n-            space = skipBytes(fis, SKIP, space);\n-            space = skipBytes(fis, SKIP, space);\n-            space = skipBytes(fis, NEGATIVE_SKIP, space);\n-            space = skipBytes(fis, NEGATIVE_SKIP, space);\n+        } finally {\n+            Files.deleteIfExists(tmp);\n@@ -70,1 +74,0 @@\n-        Files.deleteIfExists(tmp);\n","filename":"test\/jdk\/java\/io\/FileInputStream\/NegativeAvailable.java","additions":22,"deletions":19,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -162,2 +162,1 @@\n-            server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n-            UnixDomainSocketAddress usa =  UnixDomainSocketAddress.of(\"with space\"); \/\/ relative to CWD\n+            UnixDomainSocketAddress usa = UnixDomainSocketAddress.of(\"with space\");\n@@ -165,4 +164,9 @@\n-            server.bind(usa);\n-            client = SocketChannel.open(usa);\n-            Files.delete(usa.getPath());\n-            assertAddress(client.getRemoteAddress(), usa, \"address\");\n+            try {\n+                server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n+                \/\/ relative to CWD\n+                server.bind(usa);\n+                client = SocketChannel.open(usa);\n+                assertAddress(client.getRemoteAddress(), usa, \"address\");\n+            } finally {\n+                Files.deleteIfExists(usa.getPath());\n+            }\n@@ -188,6 +192,13 @@\n-            server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n-            server.bind(null);\n-            UnixDomainSocketAddress usa = (UnixDomainSocketAddress)server.getLocalAddress();\n-            if (usa.getPath().toString().isEmpty())\n-                throw new RuntimeException(\"expected non zero address length\");\n-            System.out.println(\"Null server address: \" + server.getLocalAddress());\n+            UnixDomainSocketAddress usa = null;\n+            try {\n+                server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n+                server.bind(null);\n+                usa = (UnixDomainSocketAddress) server.getLocalAddress();\n+                if (usa.getPath().toString().isEmpty())\n+                    throw new RuntimeException(\"expected non zero address length\");\n+                System.out.println(\"Null server address: \" + server.getLocalAddress());\n+            } finally {\n+                if (usa != null) {\n+                    Files.deleteIfExists(usa.getPath());\n+                }\n+            }\n@@ -310,6 +321,9 @@\n-            ServerSocketChannel server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n-            server.bind(address);\n-            SocketChannel client = SocketChannel.open(address);\n-            assertAddress(server.getLocalAddress(), address, \"server\");\n-            assertAddress(client.getRemoteAddress(), address, \"client\");\n-            Files.delete(address.getPath());\n+            try {\n+                ServerSocketChannel server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n+                server.bind(address);\n+                SocketChannel client = SocketChannel.open(address);\n+                assertAddress(server.getLocalAddress(), address, \"server\");\n+                assertAddress(client.getRemoteAddress(), address, \"client\");\n+            } finally {\n+                Files.deleteIfExists(address.getPath());\n+            }\n@@ -320,7 +334,13 @@\n-            server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n-            server.bind(null);\n-            UnixDomainSocketAddress usa = (UnixDomainSocketAddress)server.getLocalAddress();\n-            client = SocketChannel.open(usa);\n-            accept1 = server.accept();\n-            assertAddress(client.getRemoteAddress(), usa, \"server\");\n-            Files.delete(usa.getPath());\n+            UnixDomainSocketAddress usa = null;\n+            try {\n+                server = ServerSocketChannel.open(StandardProtocolFamily.UNIX);\n+                server.bind(null);\n+                usa = (UnixDomainSocketAddress) server.getLocalAddress();\n+                client = SocketChannel.open(usa);\n+                accept1 = server.accept();\n+                assertAddress(client.getRemoteAddress(), usa, \"server\");\n+            } finally {\n+                if (usa != null) {\n+                    Files.deleteIfExists(usa.getPath());\n+                }\n+            }\n","filename":"test\/jdk\/java\/nio\/channels\/unixdomain\/Bind.java","additions":46,"deletions":26,"binary":false,"changes":72,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import java.net.UnixDomainSocketAddress;\n@@ -34,0 +35,2 @@\n+import java.nio.file.Files;\n+\n@@ -51,0 +54,1 @@\n+        UnixDomainSocketAddress addr = null;\n@@ -57,0 +61,1 @@\n+            addr = (UnixDomainSocketAddress) serverSocketChannel.getLocalAddress();\n@@ -62,0 +67,4 @@\n+        } finally {\n+            if (addr != null) {\n+                Files.deleteIfExists(addr.getPath());\n+            }\n","filename":"test\/jdk\/java\/nio\/channels\/unixdomain\/NonBlockingAccept.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,0 +43,2 @@\n+import jdk.test.lib.Utils;\n+\n@@ -48,0 +50,1 @@\n+ * @library \/test\/lib\n@@ -53,13 +56,13 @@\n-        Path path = Files.createTempFile(\"bad\", \".zip\");\n-        try (OutputStream os = Files.newOutputStream(path);\n-                ZipOutputStream zos = new ZipOutputStream(os)) {\n-            ZipEntry e = new ZipEntry(\"x\");\n-            zos.putNextEntry(e);\n-            zos.write((int) 'x');\n-        }\n-        int len = (int) Files.size(path);\n-        byte[] data = new byte[len];\n-        try (InputStream is = Files.newInputStream(path)) {\n-            is.read(data);\n-        }\n-        Files.delete(path);\n+        Path path = Utils.createTempFile(\"bad\", \".zip\");\n+        try {\n+            try (OutputStream os = Files.newOutputStream(path);\n+                 ZipOutputStream zos = new ZipOutputStream(os)) {\n+                ZipEntry e = new ZipEntry(\"x\");\n+                zos.putNextEntry(e);\n+                zos.write((int) 'x');\n+            }\n+            int len = (int) Files.size(path);\n+            byte[] data = new byte[len];\n+            try (InputStream is = Files.newInputStream(path)) {\n+                is.read(data);\n+            }\n@@ -67,11 +70,14 @@\n-        \/\/ year, month, day are zero\n-        testDate(data.clone(), 0, LocalDate.of(1979, 11, 30).atStartOfDay());\n-        \/\/ only year is zero\n-        testDate(data.clone(), 0 << 25 | 4 << 21 | 5 << 16, LocalDate.of(1980, 4, 5).atStartOfDay());\n-        \/\/ month is greater than 12\n-        testDate(data.clone(), 0 << 25 | 13 << 21 | 1 << 16, LocalDate.of(1981, 1, 1).atStartOfDay());\n-        \/\/ 30th of February\n-        testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16, LocalDate.of(1980, 3, 1).atStartOfDay());\n-        \/\/ 30th of February, 24:60:60\n-        testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16 | 24 << 11 | 60 << 5 | 60 >> 1,\n-                LocalDateTime.of(1980, 3, 2, 1, 1, 0));\n+            \/\/ year, month, day are zero\n+            testDate(data.clone(), 0, LocalDate.of(1979, 11, 30).atStartOfDay());\n+            \/\/ only year is zero\n+            testDate(data.clone(), 0 << 25 | 4 << 21 | 5 << 16, LocalDate.of(1980, 4, 5).atStartOfDay());\n+            \/\/ month is greater than 12\n+            testDate(data.clone(), 0 << 25 | 13 << 21 | 1 << 16, LocalDate.of(1981, 1, 1).atStartOfDay());\n+            \/\/ 30th of February\n+            testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16, LocalDate.of(1980, 3, 1).atStartOfDay());\n+            \/\/ 30th of February, 24:60:60\n+            testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16 | 24 << 11 | 60 << 5 | 60 >> 1,\n+                    LocalDateTime.of(1980, 3, 2, 1, 1, 0));\n+        } finally {\n+            Files.delete(path);\n+        }\n@@ -89,1 +95,1 @@\n-        Path path = Files.createTempFile(\"out\", \".zip\");\n+        Path path = Utils.createTempFile(\"out\", \".zip\");\n","filename":"test\/jdk\/java\/util\/zip\/ZipFile\/ZeroDate.java","additions":32,"deletions":26,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,0 @@\n-import java.nio.file.Files;\n@@ -38,0 +37,1 @@\n+import jdk.test.lib.Utils;\n@@ -145,1 +145,1 @@\n-            Path p = Files.createTempFile(\"recording\", \".jfr\");\n+            Path p = Utils.createTempFile(\"recording\", \".jfr\");\n","filename":"test\/jdk\/jdk\/jfr\/api\/consumer\/filestream\/TestOrdered.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,0 +37,1 @@\n+import jdk.test.lib.Utils;\n@@ -121,1 +122,1 @@\n-            Path p = Files.createTempFile(\"recording\", \".jfr\");\n+            Path p = Utils.createTempFile(\"recording\", \".jfr\");\n","filename":"test\/jdk\/jdk\/jfr\/api\/consumer\/filestream\/TestReuse.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,0 +47,2 @@\n+import jdk.test.lib.Utils;\n+\n@@ -53,0 +55,1 @@\n+ * @library \/test\/lib\n@@ -58,13 +61,13 @@\n-        Path path = Files.createTempFile(\"bad\", \".zip\");\n-        try (OutputStream os = Files.newOutputStream(path);\n-                ZipOutputStream zos = new ZipOutputStream(os)) {\n-            ZipEntry e = new ZipEntry(\"x\");\n-            zos.putNextEntry(e);\n-            zos.write((int) 'x');\n-        }\n-        int len = (int) Files.size(path);\n-        byte[] data = new byte[len];\n-        try (InputStream is = Files.newInputStream(path)) {\n-            is.read(data);\n-        }\n-        Files.delete(path);\n+        Path path = Utils.createTempFile(\"bad\", \".zip\");\n+        try {\n+            try (OutputStream os = Files.newOutputStream(path);\n+                 ZipOutputStream zos = new ZipOutputStream(os)) {\n+                ZipEntry e = new ZipEntry(\"x\");\n+                zos.putNextEntry(e);\n+                zos.write((int) 'x');\n+            }\n+            int len = (int) Files.size(path);\n+            byte[] data = new byte[len];\n+            try (InputStream is = Files.newInputStream(path)) {\n+                is.read(data);\n+            }\n@@ -72,11 +75,14 @@\n-        \/\/ year, month, day are zero\n-        testDate(data.clone(), 0, LocalDate.of(1979, 11, 30).atStartOfDay());\n-        \/\/ only year is zero\n-        testDate(data.clone(), 0 << 25 | 4 << 21 | 5 << 16, LocalDate.of(1980, 4, 5).atStartOfDay());\n-        \/\/ month is greater than 12\n-        testDate(data.clone(), 0 << 25 | 13 << 21 | 1 << 16, LocalDate.of(1981, 1, 1).atStartOfDay());\n-        \/\/ 30th of February\n-        testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16, LocalDate.of(1980, 3, 1).atStartOfDay());\n-        \/\/ 30th of February, 24:60:60\n-        testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16 | 24 << 11 | 60 << 5 | 60 >> 1,\n-                LocalDateTime.of(1980, 3, 2, 1, 1, 0));\n+            \/\/ year, month, day are zero\n+            testDate(data.clone(), 0, LocalDate.of(1979, 11, 30).atStartOfDay());\n+            \/\/ only year is zero\n+            testDate(data.clone(), 0 << 25 | 4 << 21 | 5 << 16, LocalDate.of(1980, 4, 5).atStartOfDay());\n+            \/\/ month is greater than 12\n+            testDate(data.clone(), 0 << 25 | 13 << 21 | 1 << 16, LocalDate.of(1981, 1, 1).atStartOfDay());\n+            \/\/ 30th of February\n+            testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16, LocalDate.of(1980, 3, 1).atStartOfDay());\n+            \/\/ 30th of February, 24:60:60\n+            testDate(data.clone(), 0 << 25 | 2 << 21 | 30 << 16 | 24 << 11 | 60 << 5 | 60 >> 1,\n+                    LocalDateTime.of(1980, 3, 2, 1, 1, 0));\n+        } finally {\n+            Files.delete(path);\n+        }\n@@ -94,1 +100,1 @@\n-        Path path = Files.createTempFile(\"out\", \".zip\");\n+        Path path = Utils.createTempFile(\"out\", \".zip\");\n","filename":"test\/jdk\/jdk\/nio\/zipfs\/ZeroDate.java","additions":32,"deletions":26,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,0 +36,1 @@\n+import java.nio.file.Files;\n@@ -69,4 +70,0 @@\n-        try (FileOutputStream fos = new FileOutputStream(ksFile)) {\n-            ks.store(fos, pw);\n-            fos.flush();\n-        }\n@@ -74,12 +71,19 @@\n-        \/\/ now see if we can get it back\n-        try (FileInputStream fis = new FileInputStream(ksFile)) {\n-            KeyStore ks2 = KeyStore.getInstance(keystoreType);\n-            ks2.load(fis, pw);\n-            KeyStore.Entry entry = ks2.getEntry(ALIAS, kspp);\n-            SecretKey keyIn = ((KeyStore.SecretKeyEntry)entry).getSecretKey();\n-            if (Arrays.equals(key.getEncoded(), keyIn.getEncoded())) {\n-                System.err.println(\"OK: worked just fine with \" + keystoreType +\n-                                   \" keystore\");\n-            } else {\n-                System.err.println(\"ERROR: keys are NOT equal after storing in \"\n-                                   + keystoreType + \" keystore\");\n+        try {\n+            try (FileOutputStream fos = new FileOutputStream(ksFile)) {\n+                ks.store(fos, pw);\n+                fos.flush();\n+            }\n+\n+            \/\/ now see if we can get it back\n+            try (FileInputStream fis = new FileInputStream(ksFile)) {\n+                KeyStore ks2 = KeyStore.getInstance(keystoreType);\n+                ks2.load(fis, pw);\n+                KeyStore.Entry entry = ks2.getEntry(ALIAS, kspp);\n+                SecretKey keyIn = ((KeyStore.SecretKeyEntry) entry).getSecretKey();\n+                if (Arrays.equals(key.getEncoded(), keyIn.getEncoded())) {\n+                    System.err.println(\"OK: worked just fine with \" + keystoreType +\n+                            \" keystore\");\n+                } else {\n+                    System.err.println(\"ERROR: keys are NOT equal after storing in \"\n+                            + keystoreType + \" keystore\");\n+                }\n@@ -87,0 +91,2 @@\n+        } finally {\n+            Files.deleteIfExists(ksFile.toPath());\n","filename":"test\/jdk\/sun\/security\/pkcs12\/P12SecretKey.java","additions":23,"deletions":17,"binary":false,"changes":40,"status":"modified"}]}