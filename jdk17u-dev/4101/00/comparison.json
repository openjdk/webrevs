{"files":[{"patch":"@@ -89,0 +89,1 @@\n+import static java.lang.System.err;\n@@ -359,5 +360,13 @@\n-                assertTrue(CancellationException.class.isAssignableFrom(wrapped.getClass()));\n-                Throwable cause = wrapped.getCause();\n-                out.println(\"CancellationException cause: \" + x);\n-                assertTrue(IOException.class.isAssignableFrom(cause.getClass()));\n-                if (cause instanceof HttpConnectTimeoutException) {\n+                Throwable cause = wrapped;\n+                if (mayInterruptIfRunning) {\n+                    assertTrue(CancellationException.class.isAssignableFrom(wrapped.getClass()),\n+                            \"Unexpected exception: \" + wrapped);\n+                    cause = wrapped.getCause();\n+                    out.println(\"CancellationException cause: \" + x);\n+                    if (cause instanceof HttpConnectTimeoutException) {\n+                        cause.printStackTrace(out);\n+                        throw new RuntimeException(\"Unexpected timeout exception\", cause);\n+                    }\n+                }\n+                if (!IOException.class.isInstance(cause)) {\n+                    out.println(\"Unexpected cause: \" + cause.getClass());\n@@ -365,1 +374,0 @@\n-                    throw new RuntimeException(\"Unexpected timeout exception\", cause);\n@@ -367,0 +375,1 @@\n+                assertTrue(IOException.class.isAssignableFrom(cause.getClass()));\n@@ -384,1 +393,1 @@\n-            var error = TRACKER.check(tracker, 200,\n+            var error = TRACKER.check(tracker, 1000,\n@@ -496,1 +505,1 @@\n-            var error = TRACKER.check(tracker, 200,\n+            var error = TRACKER.check(tracker, 1000,\n@@ -518,0 +527,1 @@\n+            var uriStr = uri + \"\/post\/req=\" + i;\n@@ -520,1 +530,2 @@\n-                out.printf(\"%s Interrupting main from: %s (%s)\", now(), current, uri);\n+                out.printf(\"%s Interrupting main from: %s (%s)%n\", now(), current, uriStr);\n+                err.printf(\"%s Interrupting main from: %s (%s)%n\", now(), current, uriStr);\n@@ -531,1 +542,1 @@\n-            HttpRequest req = HttpRequest.newBuilder(URI.create(uri))\n+            HttpRequest req = HttpRequest.newBuilder(URI.create(uriStr))\n@@ -537,0 +548,1 @@\n+                out.println(\"Sending: \" + uriStr);\n@@ -541,1 +553,1 @@\n-\n+            out.println(uriStr + \": got result or exception\");\n@@ -543,1 +555,1 @@\n-                out.println(\"Got expected exception: \" + failed);\n+                out.println(uriStr + \": Got expected exception: \" + failed);\n@@ -545,0 +557,1 @@\n+                out.println(uriStr + \": got IOException: \" + failed);\n@@ -549,2 +562,2 @@\n-                if (interruptingThread.get() == main) {\n-                    out.println(\"Accepting IOException: \" + failed);\n+                if (interruptingThread.isDone() && interruptingThread.get() == main) {\n+                    out.println(uriStr + \": Accepting IOException: \" + failed);\n@@ -553,0 +566,1 @@\n+                    out.println(uriStr + \": unexpected exception: \" + failed);\n@@ -556,1 +570,1 @@\n-                assertEquals(body, Stream.of(BODY.split(\"\\\\|\")).collect(Collectors.joining()));\n+                out.println(uriStr + \": unexpected exception: \" + failed);\n@@ -558,0 +572,4 @@\n+            } else {\n+                assert failed == null;\n+                out.println(uriStr + \": got body: \" + body);\n+                assertEquals(body, Stream.of(BODY.split(\"\\\\|\")).collect(Collectors.joining()));\n@@ -559,0 +577,1 @@\n+            out.println(\"next iteration\");\n@@ -560,1 +579,1 @@\n-            var error = TRACKER.check(tracker, 200,\n+            var error = TRACKER.check(tracker, 1000,\n","filename":"test\/jdk\/java\/net\/httpclient\/CancelRequestTest.java","additions":35,"deletions":16,"binary":false,"changes":51,"status":"modified"}]}