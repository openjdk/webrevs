{"files":[{"patch":"@@ -0,0 +1,105 @@\n+\/*\n+ * Copyright (c) 2001, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 4401480\n+ * @summary Tests that closing ProgressMonitor dialog cancels it\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n+ * @run main\/manual bug4401480\n+ *\/\n+\n+import java.lang.reflect.InvocationTargetException;\n+import javax.swing.JButton;\n+import javax.swing.JPanel;\n+import javax.swing.ProgressMonitor;\n+import javax.swing.SwingUtilities;\n+\n+public class bug4401480 {\n+    private static ProgressMonitor monitor;\n+    private static volatile boolean cancelled = false;\n+\n+    private static final String INSTRUCTIONS = \"\"\"\n+            This is a semi-automated test which automatically\n+            passes if closing the JProgressBar dialog cancels it.\n+            Read the following test instructions and when ready\n+            click on the Start button below.\n+\n+            After clicking on Start button wait for few seconds for\n+            progress monitor (a dialog with progress bar) to appear.\n+            Close it by clicking on the window close button.\n+            DO NOT click on Cancel button.\n+\n+            NOTE:\n+            Ensure to click on the window close button before\n+            progress bar reaches its max limit.\n+            \"\"\";\n+\n+    public static void main(String[] args) throws Exception {\n+        PassFailJFrame.builder()\n+                .title(\"JProgress Monitor Instructions\")\n+                .instructions(INSTRUCTIONS)\n+                .columns(35)\n+                .splitUIBottom(bug4401480::createTestUI)\n+                .build()\n+                .awaitAndCheck();\n+    }\n+\n+    private static JPanel createTestUI() {\n+        JPanel panel = new JPanel();\n+        JButton startButton = new JButton(\"Start\");\n+        startButton.addActionListener(e -> {\n+            monitor = new ProgressMonitor(null, \"Progress\", \"Running ...\", 0, 10);\n+            monitor.setProgress(0);\n+\n+            new Thread(() -> {\n+                for (int i = 0; i < 10; i++) {\n+                    int count = i;\n+                    try {\n+                        SwingUtilities.invokeAndWait(() ->\n+                                        monitor.setProgress(count));\n+                        Thread.sleep(2000);\n+                        SwingUtilities.invokeAndWait(() ->\n+                                        cancelled = monitor.isCanceled());\n+                    } catch (InterruptedException\n+                             | InvocationTargetException ex) {\n+                        throw new RuntimeException(ex);\n+                    }\n+                    if (cancelled) {\n+                        break;\n+                    }\n+                }\n+\n+                if (cancelled) {\n+                    PassFailJFrame.forcePass();\n+                } else {\n+                    PassFailJFrame.forceFail(\"Test Failed! JProgress Monitor\"\n+                                             + \" was not cancelled\");\n+                }\n+            }).start();\n+        });\n+        panel.add(startButton);\n+        return panel;\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/ProgressMonitor\/bug4401480.java","additions":105,"deletions":0,"binary":false,"changes":105,"status":"added"}]}