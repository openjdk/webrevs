{"files":[{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final double RELATIVE_ROUNDING_ERROR = (double)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(double[] r, double rc, double[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            double relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(double[] r, double rc, double[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            double relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -989,0 +1004,8 @@\n+            withToString(\"double[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n+            withToString(\"double[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n@@ -2138,1 +2161,1 @@\n-                Double128VectorTests::ADDReduce, Double128VectorTests::ADDReduceAll);\n+                Double128VectorTests::ADDReduce, Double128VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2182,1 +2205,1 @@\n-                Double128VectorTests::ADDReduceMasked, Double128VectorTests::ADDReduceAllMasked);\n+                Double128VectorTests::ADDReduceMasked, Double128VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2223,1 +2246,1 @@\n-                Double128VectorTests::MULReduce, Double128VectorTests::MULReduceAll);\n+                Double128VectorTests::MULReduce, Double128VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2267,1 +2290,1 @@\n-                Double128VectorTests::MULReduceMasked, Double128VectorTests::MULReduceAllMasked);\n+                Double128VectorTests::MULReduceMasked, Double128VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double128VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final double RELATIVE_ROUNDING_ERROR = (double)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(double[] r, double rc, double[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            double relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(double[] r, double rc, double[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            double relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -989,0 +1004,8 @@\n+            withToString(\"double[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n+            withToString(\"double[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n@@ -2138,1 +2161,1 @@\n-                Double256VectorTests::ADDReduce, Double256VectorTests::ADDReduceAll);\n+                Double256VectorTests::ADDReduce, Double256VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2182,1 +2205,1 @@\n-                Double256VectorTests::ADDReduceMasked, Double256VectorTests::ADDReduceAllMasked);\n+                Double256VectorTests::ADDReduceMasked, Double256VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2223,1 +2246,1 @@\n-                Double256VectorTests::MULReduce, Double256VectorTests::MULReduceAll);\n+                Double256VectorTests::MULReduce, Double256VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2267,1 +2290,1 @@\n-                Double256VectorTests::MULReduceMasked, Double256VectorTests::MULReduceAllMasked);\n+                Double256VectorTests::MULReduceMasked, Double256VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double256VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final double RELATIVE_ROUNDING_ERROR = (double)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(double[] r, double rc, double[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            double relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(double[] r, double rc, double[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            double relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -989,0 +1004,8 @@\n+            withToString(\"double[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n+            withToString(\"double[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n@@ -2138,1 +2161,1 @@\n-                Double512VectorTests::ADDReduce, Double512VectorTests::ADDReduceAll);\n+                Double512VectorTests::ADDReduce, Double512VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2182,1 +2205,1 @@\n-                Double512VectorTests::ADDReduceMasked, Double512VectorTests::ADDReduceAllMasked);\n+                Double512VectorTests::ADDReduceMasked, Double512VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2223,1 +2246,1 @@\n-                Double512VectorTests::MULReduce, Double512VectorTests::MULReduceAll);\n+                Double512VectorTests::MULReduce, Double512VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2267,1 +2290,1 @@\n-                Double512VectorTests::MULReduceMasked, Double512VectorTests::MULReduceAllMasked);\n+                Double512VectorTests::MULReduceMasked, Double512VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double512VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final double RELATIVE_ROUNDING_ERROR = (double)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(double[] r, double rc, double[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            double relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(double[] r, double rc, double[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            double relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -989,0 +1004,8 @@\n+            withToString(\"double[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n+            withToString(\"double[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n@@ -2138,1 +2161,1 @@\n-                Double64VectorTests::ADDReduce, Double64VectorTests::ADDReduceAll);\n+                Double64VectorTests::ADDReduce, Double64VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2182,1 +2205,1 @@\n-                Double64VectorTests::ADDReduceMasked, Double64VectorTests::ADDReduceAllMasked);\n+                Double64VectorTests::ADDReduceMasked, Double64VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2223,1 +2246,1 @@\n-                Double64VectorTests::MULReduce, Double64VectorTests::MULReduceAll);\n+                Double64VectorTests::MULReduce, Double64VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2267,1 +2290,1 @@\n-                Double64VectorTests::MULReduceMasked, Double64VectorTests::MULReduceAllMasked);\n+                Double64VectorTests::MULReduceMasked, Double64VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Double64VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -68,0 +68,3 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final double RELATIVE_ROUNDING_ERROR = (double)0.000001;\n+\n@@ -126,0 +129,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(double[] r, double rc, double[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            double relativeError) {\n@@ -128,1 +137,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -130,1 +139,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -133,2 +142,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -148,0 +157,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (double)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(double[] r, double rc, double[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            double relativeError) {\n@@ -150,1 +165,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -152,1 +167,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -155,2 +171,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -612,1 +628,0 @@\n-\n@@ -994,0 +1009,8 @@\n+            withToString(\"double[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n+            withToString(\"double[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (double)0.01 + ((double)i \/ (i + 1)));\n+            }),\n@@ -2143,1 +2166,1 @@\n-                DoubleMaxVectorTests::ADDReduce, DoubleMaxVectorTests::ADDReduceAll);\n+                DoubleMaxVectorTests::ADDReduce, DoubleMaxVectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2187,1 +2210,1 @@\n-                DoubleMaxVectorTests::ADDReduceMasked, DoubleMaxVectorTests::ADDReduceAllMasked);\n+                DoubleMaxVectorTests::ADDReduceMasked, DoubleMaxVectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2228,1 +2251,1 @@\n-                DoubleMaxVectorTests::MULReduce, DoubleMaxVectorTests::MULReduceAll);\n+                DoubleMaxVectorTests::MULReduce, DoubleMaxVectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2272,1 +2295,1 @@\n-                DoubleMaxVectorTests::MULReduceMasked, DoubleMaxVectorTests::MULReduceAllMasked);\n+                DoubleMaxVectorTests::MULReduceMasked, DoubleMaxVectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/DoubleMaxVectorTests.java","additions":36,"deletions":13,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final float RELATIVE_ROUNDING_ERROR = (float)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(float[] r, float rc, float[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            float relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(float[] r, float rc, float[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            float relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -999,0 +1014,8 @@\n+            withToString(\"float[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n+            withToString(\"float[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n@@ -2148,1 +2171,1 @@\n-                Float128VectorTests::ADDReduce, Float128VectorTests::ADDReduceAll);\n+                Float128VectorTests::ADDReduce, Float128VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2192,1 +2215,1 @@\n-                Float128VectorTests::ADDReduceMasked, Float128VectorTests::ADDReduceAllMasked);\n+                Float128VectorTests::ADDReduceMasked, Float128VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2233,1 +2256,1 @@\n-                Float128VectorTests::MULReduce, Float128VectorTests::MULReduceAll);\n+                Float128VectorTests::MULReduce, Float128VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2277,1 +2300,1 @@\n-                Float128VectorTests::MULReduceMasked, Float128VectorTests::MULReduceAllMasked);\n+                Float128VectorTests::MULReduceMasked, Float128VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float128VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final float RELATIVE_ROUNDING_ERROR = (float)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(float[] r, float rc, float[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            float relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(float[] r, float rc, float[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            float relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -999,0 +1014,8 @@\n+            withToString(\"float[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n+            withToString(\"float[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n@@ -2148,1 +2171,1 @@\n-                Float256VectorTests::ADDReduce, Float256VectorTests::ADDReduceAll);\n+                Float256VectorTests::ADDReduce, Float256VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2192,1 +2215,1 @@\n-                Float256VectorTests::ADDReduceMasked, Float256VectorTests::ADDReduceAllMasked);\n+                Float256VectorTests::ADDReduceMasked, Float256VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2233,1 +2256,1 @@\n-                Float256VectorTests::MULReduce, Float256VectorTests::MULReduceAll);\n+                Float256VectorTests::MULReduce, Float256VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2277,1 +2300,1 @@\n-                Float256VectorTests::MULReduceMasked, Float256VectorTests::MULReduceAllMasked);\n+                Float256VectorTests::MULReduceMasked, Float256VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float256VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final float RELATIVE_ROUNDING_ERROR = (float)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(float[] r, float rc, float[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            float relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(float[] r, float rc, float[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            float relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -999,0 +1014,8 @@\n+            withToString(\"float[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n+            withToString(\"float[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n@@ -2148,1 +2171,1 @@\n-                Float512VectorTests::ADDReduce, Float512VectorTests::ADDReduceAll);\n+                Float512VectorTests::ADDReduce, Float512VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2192,1 +2215,1 @@\n-                Float512VectorTests::ADDReduceMasked, Float512VectorTests::ADDReduceAllMasked);\n+                Float512VectorTests::ADDReduceMasked, Float512VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2233,1 +2256,1 @@\n-                Float512VectorTests::MULReduce, Float512VectorTests::MULReduceAll);\n+                Float512VectorTests::MULReduce, Float512VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2277,1 +2300,1 @@\n-                Float512VectorTests::MULReduceMasked, Float512VectorTests::MULReduceAllMasked);\n+                Float512VectorTests::MULReduceMasked, Float512VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float512VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -62,0 +62,2 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final float RELATIVE_ROUNDING_ERROR = (float)0.000001;\n@@ -121,0 +123,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(float[] r, float rc, float[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            float relativeError) {\n@@ -123,1 +131,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -125,1 +133,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -128,2 +136,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -143,0 +151,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(float[] r, float rc, float[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            float relativeError) {\n@@ -145,1 +159,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -147,1 +161,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -150,2 +165,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -999,0 +1014,8 @@\n+            withToString(\"float[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n+            withToString(\"float[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n@@ -2148,1 +2171,1 @@\n-                Float64VectorTests::ADDReduce, Float64VectorTests::ADDReduceAll);\n+                Float64VectorTests::ADDReduce, Float64VectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2192,1 +2215,1 @@\n-                Float64VectorTests::ADDReduceMasked, Float64VectorTests::ADDReduceAllMasked);\n+                Float64VectorTests::ADDReduceMasked, Float64VectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2233,1 +2256,1 @@\n-                Float64VectorTests::MULReduce, Float64VectorTests::MULReduceAll);\n+                Float64VectorTests::MULReduce, Float64VectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2277,1 +2300,1 @@\n-                Float64VectorTests::MULReduceMasked, Float64VectorTests::MULReduceAllMasked);\n+                Float64VectorTests::MULReduceMasked, Float64VectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/Float64VectorTests.java","additions":35,"deletions":12,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -68,0 +68,3 @@\n+    \/\/ for floating point reduction ops that may introduce rounding errors\n+    private static final float RELATIVE_ROUNDING_ERROR = (float)0.000001;\n+\n@@ -126,0 +129,6 @@\n+        assertReductionArraysEquals(r, rc, a, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEquals(float[] r, float rc, float[] a,\n+                                            FReductionOp f, FReductionAllOp fa,\n+                                            float relativeError) {\n@@ -128,1 +137,1 @@\n-            Assert.assertEquals(rc, fa.apply(a));\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError));\n@@ -130,1 +139,1 @@\n-                Assert.assertEquals(r[i], f.apply(a, i));\n+                Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError));\n@@ -133,2 +142,2 @@\n-            Assert.assertEquals(rc, fa.apply(a), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -148,0 +157,6 @@\n+        assertReductionArraysEqualsMasked(r, rc, a, mask, f, fa, (float)0.0);\n+    }\n+\n+    static void assertReductionArraysEqualsMasked(float[] r, float rc, float[] a, boolean[] mask,\n+                                            FReductionMaskedOp f, FReductionAllMaskedOp fa,\n+                                            float relativeError) {\n@@ -150,1 +165,1 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask));\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError));\n@@ -152,1 +167,2 @@\n-                Assert.assertEquals(r[i], f.apply(a, i, mask));\n+                Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] *\n+relativeError));\n@@ -155,2 +171,2 @@\n-            Assert.assertEquals(rc, fa.apply(a, mask), \"Final result is incorrect!\");\n-            Assert.assertEquals(r[i], f.apply(a, i, mask), \"at index #\" + i);\n+            Assert.assertEquals(rc, fa.apply(a, mask), Math.abs(rc * relativeError), \"Final result is incorrect!\");\n+            Assert.assertEquals(r[i], f.apply(a, i, mask), Math.abs(r[i] * relativeError), \"at index #\" + i);\n@@ -612,1 +628,0 @@\n-\n@@ -1004,0 +1019,8 @@\n+            withToString(\"float[0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n+            withToString(\"float[i -> i % 17 == 0 ? cornerCaseValue(i) : 0.01 + (i \/ (i + 1))]\", (int s) -> {\n+                return fill(s * BUFFER_REPS,\n+                            i -> i % 17 == 0 ? cornerCaseValue(i) : (float)0.01 + ((float)i \/ (i + 1)));\n+            }),\n@@ -2153,1 +2176,1 @@\n-                FloatMaxVectorTests::ADDReduce, FloatMaxVectorTests::ADDReduceAll);\n+                FloatMaxVectorTests::ADDReduce, FloatMaxVectorTests::ADDReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2197,1 +2220,1 @@\n-                FloatMaxVectorTests::ADDReduceMasked, FloatMaxVectorTests::ADDReduceAllMasked);\n+                FloatMaxVectorTests::ADDReduceMasked, FloatMaxVectorTests::ADDReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n@@ -2238,1 +2261,1 @@\n-                FloatMaxVectorTests::MULReduce, FloatMaxVectorTests::MULReduceAll);\n+                FloatMaxVectorTests::MULReduce, FloatMaxVectorTests::MULReduceAll, RELATIVE_ROUNDING_ERROR);\n@@ -2282,1 +2305,1 @@\n-                FloatMaxVectorTests::MULReduceMasked, FloatMaxVectorTests::MULReduceAllMasked);\n+                FloatMaxVectorTests::MULReduceMasked, FloatMaxVectorTests::MULReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n","filename":"test\/jdk\/jdk\/incubator\/vector\/FloatMaxVectorTests.java","additions":36,"deletions":13,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -5,0 +5,3 @@\n+#if[FP]\n+                $vectorteststype$::[[TEST]]ReduceMasked, $vectorteststype$::[[TEST]]ReduceAllMasked, RELATIVE_ROUNDING_ERROR);\n+#else[FP]\n@@ -6,0 +9,1 @@\n+#end[FP]\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Unit-Reduction-Masked-op.template","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -5,0 +5,3 @@\n+#if[FP]\n+                $vectorteststype$::[[TEST]]Reduce, $vectorteststype$::[[TEST]]ReduceAll, RELATIVE_ROUNDING_ERROR);\n+#else[FP]\n@@ -6,0 +9,1 @@\n+#end[FP]\n","filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Unit-Reduction-op.template","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}