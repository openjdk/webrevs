{"files":[{"patch":"@@ -1663,0 +1663,3 @@\n+                if (end.cenlen + ENDHDR >= Integer.MAX_VALUE) {\n+                    zerror(\"invalid END header (central directory size too large)\");\n+                }\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipFile.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,89 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/* @test\n+ * @bug 8272746\n+ * @summary ZipFile can't open big file (NegativeArraySizeException)\n+ * @requires (sun.arch.data.model == \"64\" & os.maxMemory > 8g)\n+ * @run testng\/manual\/othervm -Xmx8g TestTooManyEntries\n+ *\/\n+\n+import org.testng.annotations.BeforeTest;\n+import org.testng.annotations.Test;\n+\n+import java.io.File;\n+import java.io.BufferedOutputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipException;\n+import java.util.zip.ZipFile;\n+import java.util.zip.ZipOutputStream;\n+import java.util.UUID;\n+\n+import static org.testng.Assert.assertThrows;\n+\n+public class TestTooManyEntries {\n+    \/\/ Number of directories in the zip file\n+    private static final int DIR_COUNT = 25000;\n+    \/\/ Number of entries per directory\n+    private static final int ENTRIES_IN_DIR = 1000;\n+\n+    \/\/ Zip file to create for testing\n+    private File hugeZipFile;\n+\n+    \/**\n+     * Create a zip file and add entries that exceed the CEN limit.\n+     * @throws IOException if an error occurs creating the ZIP File\n+     *\/\n+    @BeforeTest\n+    public void setup() throws IOException {\n+        hugeZipFile = File.createTempFile(\"hugeZip\", \".zip\", new File(\".\"));\n+        hugeZipFile.deleteOnExit();\n+        long startTime = System.currentTimeMillis();\n+        try (ZipOutputStream zip = new ZipOutputStream(new BufferedOutputStream(new FileOutputStream(hugeZipFile)))) {\n+            for (int dirN = 0; dirN < DIR_COUNT; dirN++) {\n+                String dirName = UUID.randomUUID() + \"\/\";\n+                for (int fileN = 0; fileN < ENTRIES_IN_DIR; fileN++) {\n+                    ZipEntry entry = new ZipEntry(dirName + UUID.randomUUID());\n+                    zip.putNextEntry(entry);\n+                    zip.closeEntry(); \/\/ all files are empty\n+                }\n+                if ((dirN + 1) % 1000 == 0) {\n+                    System.out.printf(\"%s \/ %s of entries written, file size is %sMb (%ss)%n\",\n+                            (dirN + 1) * ENTRIES_IN_DIR, DIR_COUNT * ENTRIES_IN_DIR, hugeZipFile.length() \/ 1024 \/ 1024,\n+                            (System.currentTimeMillis() - startTime) \/ 1000);\n+                }\n+            }\n+        }\n+    }\n+\n+    \/**\n+     * Validates that the ZipException is thrown when the ZipFile class\n+     * is initialized with a zip file whose entries exceed the CEN limit.\n+     *\/\n+    @Test\n+    public void test() {\n+        assertThrows(ZipException.class, () -> new ZipFile(hugeZipFile));\n+    }\n+}\n","filename":"test\/jdk\/java\/util\/zip\/ZipFile\/TestTooManyEntries.java","additions":89,"deletions":0,"binary":false,"changes":89,"status":"added"}]}