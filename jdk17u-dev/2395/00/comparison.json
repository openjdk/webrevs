{"files":[{"patch":"@@ -30,1 +30,1 @@\n- * @run testng\/othervm -ea -esa MaxStreams\n+ * @run testng\/othervm MaxStreams\n@@ -48,1 +48,0 @@\n-import java.util.concurrent.Semaphore;\n@@ -77,1 +76,0 @@\n-    volatile CountDownLatch latch;\n@@ -79,1 +77,0 @@\n-    final Semaphore canStartTestRun = new Semaphore(1);\n@@ -101,1 +98,1 @@\n-    @Test(dataProvider = \"uris\", timeOut=20000)\n+    @Test(dataProvider = \"uris\")\n@@ -103,3 +100,1 @@\n-        System.err.println(\"Semaphore acquire\");\n-        canStartTestRun.acquire();\n-        latch = new CountDownLatch(1);\n+        CountDownLatch latch = new CountDownLatch(1);\n@@ -212,1 +207,0 @@\n-            int c = -1;\n@@ -217,1 +211,1 @@\n-                c = counter.getAndIncrement();\n+                int c = counter.getAndIncrement();\n@@ -226,0 +220,6 @@\n+                } else if (c == MAX_STREAMS + 1) {\n+                    \/\/ client issues MAX_STREAMS + 3 requests in total\n+                    \/\/ but server should only see MAX_STREAMS + 2 in total. One is rejected by client\n+                    \/\/ counter c captured before increment so final value is MAX_STREAMS + 1\n+                    System.err.println(\"Counter reset\");\n+                    counter.set(0);\n@@ -229,9 +229,0 @@\n-            } finally {\n-                \/\/ client issues MAX_STREAMS + 3 requests in total\n-                \/\/ but server should only see MAX_STREAMS + 2 in total. One is rejected by client\n-                \/\/ counter c captured before increment so final value is MAX_STREAMS + 1\n-                if (c == MAX_STREAMS + 1) {\n-                    System.err.println(\"Semaphore release\");\n-                    counter.set(0);\n-                    canStartTestRun.release();\n-                }\n","filename":"test\/jdk\/java\/net\/httpclient\/MaxStreams.java","additions":10,"deletions":19,"binary":false,"changes":29,"status":"modified"}]}