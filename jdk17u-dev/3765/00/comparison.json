{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -1093,0 +1093,4 @@\n+     *\n+     * @implNote If {@link #CANON_EQ} is specified and the number of combining\n+     * marks for any character is too large, an {@link java.lang.OutOfMemoryError}\n+     * is thrown.\n@@ -1126,0 +1130,7 @@\n+     *\n+     * @implNote When a {@link Pattern} is deserialized, compilation is deferred\n+     * until a direct or indirect invocation of this method. Thus, if a\n+     * deserialized pattern has {@link #CANON_EQ} among its flags and the number\n+     * of combining marks for any character is too large, an\n+     * {@link java.lang.OutOfMemoryError} is thrown,\n+     * as in {@link #compile(String, int)}.\n@@ -1599,1 +1610,11 @@\n-        int length = 1;\n+        \/*\n+         * Since\n+         *      12! =   479_001_600 < Integer.MAX_VALUE\n+         *      13! = 6_227_020_800 > Integer.MAX_VALUE\n+         * the computation of n! using int arithmetic will overflow iff\n+         *      n < 0 or n > 12\n+         *\n+         * Here, nCodePoints! is computed in the next for-loop below.\n+         * As nCodePoints >= 0, the computation overflows iff nCodePoints > 12.\n+         * In that case, throw OOME to simulate length > Integer.MAX_VALUE.\n+         *\/\n@@ -1601,2 +1622,3 @@\n-        for(int x=1; x<nCodePoints; x++)\n-            length = length * (x+1);\n+        if (nCodePoints > 12) {\n+            throw new OutOfMemoryError(\"Pattern too complex\");\n+        }\n@@ -1604,0 +1626,5 @@\n+        \/* Compute length = nCodePoints! *\/\n+        int length = 1;\n+        for (int x = 2; x <= nCodePoints; ++x) {\n+            length *= x;\n+        }\n@@ -1606,1 +1633,1 @@\n-        int combClass[] = new int[nCodePoints];\n+        int[] combClass = new int[nCodePoints];\n","filename":"src\/java.base\/share\/classes\/java\/util\/regex\/Pattern.java","additions":32,"deletions":5,"binary":false,"changes":37,"status":"modified"}]}