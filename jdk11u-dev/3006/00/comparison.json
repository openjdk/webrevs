{"files":[{"patch":"@@ -1,47 +0,0 @@\n-\/*\n- * Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-import static java.lang.ProcessBuilder.Redirect.*;\n-\n-class InheritIO {\n-\n-    public static class TestInheritIO {\n-        public static void main(String args[]) throws Throwable {\n-            int err = new ProcessBuilder(args).inheritIO().start().waitFor();\n-            System.err.print(\"exit value: \" + err);\n-            System.exit(err);\n-        }\n-    }\n-\n-    public static class TestRedirectInherit {\n-        public static void main(String args[]) throws Throwable {\n-            int err = new ProcessBuilder(args)\n-                    .redirectInput(INHERIT)\n-                    .redirectOutput(INHERIT)\n-                    .redirectError(INHERIT)\n-                    .start().waitFor();\n-            System.err.print(\"exit value: \" + err);\n-            System.exit(err);\n-        }\n-    }\n-}\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/InheritIO\/InheritIO.java","additions":0,"deletions":47,"binary":false,"changes":47,"status":"deleted"},{"patch":"@@ -1,84 +0,0 @@\n-#\n-# Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-# @test\n-# @bug 8023130\n-# @summary (process) ProcessBuilder#inheritIO does not work on Windows\n-# @run shell InheritIO.sh\n-\n-if [ \"x${TESTSRC}\" = \"x\" ]; then\n-  echo \"TESTSRC not set.  Test cannot execute.  Failed.\"\n-  exit 1\n-fi\n-\n-if [ \"x${TESTJAVA}\" = \"x\" ]; then\n-  echo \"TESTJAVA not set.  Test cannot execute.  Failed.\"\n-  exit 1\n-fi\n-\n-if [ \"x${COMPILEJAVA}\" = \"x\" ]; then\n-  COMPILEJAVA=\"${TESTJAVA}\"\n-fi\n-\n-JAVA=\"${TESTJAVA}\/bin\/java\"\n-JAVAC=\"${COMPILEJAVA}\/bin\/javac\"\n-\n-cp -f ${TESTSRC}\/InheritIO.java .\n-\n-# compile the class ourselves, so this can run as a standalone test\n-\n-${JAVAC} InheritIO.java\n-RES=\"$?\"\n-if [ ${RES} != 0 ]; then\n-    echo 'FAIL: Cannot compile InheritIO.java'\n-    exit ${RES}\n-fi\n-\n-\n-for TEST_NAME in TestInheritIO TestRedirectInherit\n-do\n-    ${JAVA} ${TESTVMOPTS} -classpath . \\\n-        'InheritIO$'${TEST_NAME} printf message > stdout.txt 2> stderr.txt\n-\n-    RES=\"$?\"\n-    if [ ${RES} != 0 ]; then\n-        echo 'FAIL: InheritIO$'${TEST_NAME}' failed with '${RES}\n-        exit ${RES}\n-    fi\n-\n-    OUT_EXPECTED='message'\n-    OUT_RECEIVED=`cat stdout.txt`\n-    if [ \"x${OUT_RECEIVED}\" != \"x${OUT_EXPECTED}\" ]; then\n-        echo \"FAIL: unexpected '${OUT_RECEIVED}' in stdout\"\n-        exit 1\n-    fi\n-\n-    ERR_EXPECTED='exit value: 0'\n-    ERR_RECEIVED=`cat stderr.txt`\n-    if [ \"x${ERR_RECEIVED}\" != \"x${ERR_EXPECTED}\" ]; then\n-        echo \"FAIL: unexpected '${ERR_RECEIVED}' in stderr\"\n-        exit 1\n-    fi\n-done\n-\n-echo 'PASS: InheritIO works as expected'\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/InheritIO\/InheritIO.sh","additions":0,"deletions":84,"binary":false,"changes":84,"status":"deleted"},{"patch":"@@ -0,0 +1,84 @@\n+\/*\n+ * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8023130 8166026\n+ * @summary Unit test for java.lang.ProcessBuilder inheritance of standard output and standard error streams\n+ * @library \/test\/lib\n+ * @build jdk.test.lib.process.*\n+ * @run testng InheritIOTest\n+ *\/\n+\n+import java.util.List;\n+import static java.lang.ProcessBuilder.Redirect.INHERIT;\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+import static org.testng.Assert.*;\n+\n+public class InheritIOTest {\n+\n+    private static final String EXIT_VALUE_TEMPLATE = \"exit value: %d\";\n+    private static final String EXPECTED_RESULT_STDOUT = \"message\";\n+    private static final String EXPECTED_RESULT_STDERR = EXIT_VALUE_TEMPLATE.formatted(0);\n+\n+    @DataProvider\n+    public Object[][] testCases() {\n+        return new Object[][]{\n+             new Object[] { List.of(\"InheritIOTest$TestInheritIO\", \"printf\", EXPECTED_RESULT_STDOUT) },\n+             new Object[] { List.of(\"InheritIOTest$TestRedirectInherit\", \"printf\", EXPECTED_RESULT_STDOUT) }\n+        };\n+    }\n+\n+    @Test(dataProvider = \"testCases\")\n+    public void testInheritWithoutRedirect(List<String> arguments) throws Throwable {\n+        ProcessBuilder processBuilder = ProcessTools.createJavaProcessBuilder(arguments);\n+        OutputAnalyzer outputAnalyzer = ProcessTools.executeCommand(processBuilder);\n+        outputAnalyzer.shouldHaveExitValue(0);\n+        assertEquals(outputAnalyzer.getStdout(), EXPECTED_RESULT_STDOUT);\n+        assertEquals(outputAnalyzer.getStderr(), EXPECTED_RESULT_STDERR);\n+    }\n+\n+    public static class TestInheritIO {\n+        public static void main(String args[]) throws Throwable {\n+            int err = new ProcessBuilder(args).inheritIO().start().waitFor();\n+            System.err.printf(EXIT_VALUE_TEMPLATE, err);\n+            System.exit(err);\n+        }\n+    }\n+\n+    public static class TestRedirectInherit {\n+        public static void main(String args[]) throws Throwable {\n+            int err = new ProcessBuilder(args)\n+                    .redirectInput(INHERIT)\n+                    .redirectOutput(INHERIT)\n+                    .redirectError(INHERIT)\n+                    .start().waitFor();\n+            System.err.printf(EXIT_VALUE_TEMPLATE, err);\n+            System.exit(err);\n+        }\n+    }\n+\n+}\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/InheritIOTest.java","additions":84,"deletions":0,"binary":false,"changes":84,"status":"added"}]}