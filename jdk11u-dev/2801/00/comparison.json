{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import java.util.concurrent.CountDownLatch;\n@@ -52,1 +53,1 @@\n-    Object barrier;\n+    final CountDownLatch lookupLatch;\n@@ -55,1 +56,1 @@\n-    SuccessfulLookup(Class cl, long suid, Object barrier) {\n+    SuccessfulLookup(Class<?> cl, long suid, CountDownLatch lookupLatch) {\n@@ -58,1 +59,1 @@\n-        this.barrier = barrier;\n+        this.lookupLatch = lookupLatch;\n@@ -62,3 +63,4 @@\n-        synchronized (barrier) {\n-            try { barrier.wait(); } catch (InterruptedException ex) {}\n-        }\n+        lookupLatch.countDown(); \/\/ let others know we are ready\n+        try {\n+            lookupLatch.await(); \/\/ await for others\n+        } catch (InterruptedException ex) {}\n@@ -76,1 +78,1 @@\n-    Object barrier;\n+    final CountDownLatch lookupLatch;\n@@ -79,1 +81,1 @@\n-    FailingLookup(Class cl, Object barrier) {\n+    FailingLookup(Class<?> cl, CountDownLatch lookupLatch) {\n@@ -81,1 +83,1 @@\n-        this.barrier = barrier;\n+        this.lookupLatch = lookupLatch;\n@@ -85,3 +87,4 @@\n-        synchronized (barrier) {\n-            try { barrier.wait(); } catch (InterruptedException ex) {}\n-        }\n+        lookupLatch.countDown(); \/\/ let others know we are ready\n+        try {\n+            lookupLatch.await(); \/\/ await for others\n+        } catch (InterruptedException ex) {}\n@@ -103,2 +106,3 @@\n-        Object barrier = new Object();\n-        SuccessfulLookup[] slookups = new SuccessfulLookup[50];\n+        int numSuccessfulLookups = 50;\n+        CountDownLatch sLookupLatch = new CountDownLatch(numSuccessfulLookups);\n+        SuccessfulLookup[] slookups = new SuccessfulLookup[numSuccessfulLookups];\n@@ -106,2 +110,1 @@\n-            slookups[i] =\n-                new SuccessfulLookup(cl, 6319710844400051132L, barrier);\n+            slookups[i] = new SuccessfulLookup(cl, 6319710844400051132L, sLookupLatch);\n@@ -110,4 +113,1 @@\n-        Thread.sleep(1000);\n-        synchronized (barrier) {\n-            barrier.notifyAll();\n-        }\n+        System.out.println(\"awaiting completion of \" + slookups.length + \" SuccessfulLookup\");\n@@ -120,1 +120,1 @@\n-\n+        System.out.println(\"all \" + slookups.length + \" SuccessfulLookup completed\");\n@@ -122,1 +122,3 @@\n-        FailingLookup[] flookups = new FailingLookup[50];\n+        int numFailingLookups = 50;\n+        CountDownLatch fLookupLatch = new CountDownLatch(numFailingLookups);\n+        FailingLookup[] flookups = new FailingLookup[numFailingLookups];\n@@ -124,1 +126,1 @@\n-            flookups[i] = new FailingLookup(cl, barrier);\n+            flookups[i] = new FailingLookup(cl, fLookupLatch);\n@@ -127,5 +129,2 @@\n-        Thread.sleep(1000);\n-        synchronized (barrier) {\n-            barrier.notifyAll();\n-        }\n-        for (int i = 0; i < slookups.length; i++) {\n+        System.out.println(\"awaiting completion of \" + flookups.length + \" FailingLookup\");\n+        for (int i = 0; i < flookups.length; i++) {\n@@ -137,0 +136,1 @@\n+        System.out.println(\"all \" + flookups.length + \" FailingLookup completed\");\n","filename":"test\/jdk\/java\/io\/Serializable\/concurrentClassDescLookup\/ConcurrentClassDescLookup.java","additions":29,"deletions":29,"binary":false,"changes":58,"status":"modified"}]}