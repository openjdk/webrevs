{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import java.util.concurrent.CountDownLatch;\n@@ -33,0 +34,2 @@\n+    private static final long serialVersionUID = 6319710844400051132L;\n+\n@@ -50,1 +53,1 @@\n-    Class cl;\n+    Class<?> cl;\n@@ -52,1 +55,1 @@\n-    Object barrier;\n+    final CountDownLatch lookupLatch;\n@@ -55,1 +58,1 @@\n-    SuccessfulLookup(Class cl, long suid, Object barrier) {\n+    SuccessfulLookup(Class<?> cl, long suid, CountDownLatch lookupLatch) {\n@@ -58,1 +61,1 @@\n-        this.barrier = barrier;\n+        this.lookupLatch = lookupLatch;\n@@ -62,3 +65,4 @@\n-        synchronized (barrier) {\n-            try { barrier.wait(); } catch (InterruptedException ex) {}\n-        }\n+        lookupLatch.countDown(); \/\/ let others know we are ready\n+        try {\n+            lookupLatch.await(); \/\/ await for others\n+        } catch (InterruptedException ex) {}\n@@ -75,2 +79,2 @@\n-    Class cl;\n-    Object barrier;\n+    Class<?> cl;\n+    final CountDownLatch lookupLatch;\n@@ -79,1 +83,1 @@\n-    FailingLookup(Class cl, Object barrier) {\n+    FailingLookup(Class<?> cl, CountDownLatch lookupLatch) {\n@@ -81,1 +85,1 @@\n-        this.barrier = barrier;\n+        this.lookupLatch = lookupLatch;\n@@ -85,3 +89,4 @@\n-        synchronized (barrier) {\n-            try { barrier.wait(); } catch (InterruptedException ex) {}\n-        }\n+        lookupLatch.countDown(); \/\/ let others know we are ready\n+        try {\n+            lookupLatch.await(); \/\/ await for others\n+        } catch (InterruptedException ex) {}\n@@ -102,3 +107,4 @@\n-        Class cl = Class.forName(\"Good\", false, loader);\n-        Object barrier = new Object();\n-        SuccessfulLookup[] slookups = new SuccessfulLookup[50];\n+        Class<?> cl = Class.forName(\"Good\", false, loader);\n+        int numSuccessfulLookups = 50;\n+        CountDownLatch sLookupLatch = new CountDownLatch(numSuccessfulLookups);\n+        SuccessfulLookup[] slookups = new SuccessfulLookup[numSuccessfulLookups];\n@@ -106,2 +112,1 @@\n-            slookups[i] =\n-                new SuccessfulLookup(cl, 6319710844400051132L, barrier);\n+            slookups[i] = new SuccessfulLookup(cl, 6319710844400051132L, sLookupLatch);\n@@ -110,4 +115,1 @@\n-        Thread.sleep(1000);\n-        synchronized (barrier) {\n-            barrier.notifyAll();\n-        }\n+        System.out.println(\"awaiting completion of \" + slookups.length + \" SuccessfulLookup\");\n@@ -120,1 +122,1 @@\n-\n+        System.out.println(\"all \" + slookups.length + \" SuccessfulLookup completed\");\n@@ -122,1 +124,3 @@\n-        FailingLookup[] flookups = new FailingLookup[50];\n+        int numFailingLookups = 50;\n+        CountDownLatch fLookupLatch = new CountDownLatch(numFailingLookups);\n+        FailingLookup[] flookups = new FailingLookup[numFailingLookups];\n@@ -124,1 +128,1 @@\n-            flookups[i] = new FailingLookup(cl, barrier);\n+            flookups[i] = new FailingLookup(cl, fLookupLatch);\n@@ -127,5 +131,2 @@\n-        Thread.sleep(1000);\n-        synchronized (barrier) {\n-            barrier.notifyAll();\n-        }\n-        for (int i = 0; i < slookups.length; i++) {\n+        System.out.println(\"awaiting completion of \" + flookups.length + \" FailingLookup\");\n+        for (int i = 0; i < flookups.length; i++) {\n@@ -137,0 +138,1 @@\n+        System.out.println(\"all \" + flookups.length + \" FailingLookup completed\");\n","filename":"test\/jdk\/java\/io\/Serializable\/concurrentClassDescLookup\/ConcurrentClassDescLookup.java","additions":34,"deletions":32,"binary":false,"changes":66,"status":"modified"}]}