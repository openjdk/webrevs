{"files":[{"patch":"@@ -69,0 +69,1 @@\n+import sun.nio.fs.DefaultFileSystemProvider;\n@@ -1408,1 +1409,6 @@\n-\n+        \/**\n+         * Use the platform's default file system to avoid\n+         * issues when the VM is configured to use a custom file system provider.\n+         *\/\n+        private static final java.nio.file.FileSystem builtInFS =\n+                DefaultFileSystemProvider.theFileSystem();\n@@ -1414,1 +1420,2 @@\n-                        Files.readAttributes(file.toPath(), BasicFileAttributes.class));\n+                        Files.readAttributes(builtInFS.getPath(file.getPath()),\n+                                BasicFileAttributes.class));\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipFile.java","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+ * @bug 4313887 7006126 8142968 8178380 8183320 8210112 8266345 8263940\n@@ -39,0 +40,2 @@\n+import java.util.ArrayList;\n+import java.util.List;\n@@ -40,0 +43,2 @@\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n@@ -43,1 +48,0 @@\n-import org.testng.annotations.BeforeTest;\n@@ -75,0 +79,39 @@\n+    \/**\n+     * Test override of default FileSystemProvider with a\n+     * FileSystemProvider jar and the main application on the class path.\n+     *\/\n+    public void testClassPathWithFileSystemProviderJar() throws Exception {\n+        String testClasses = System.getProperty(\"test.classes\");\n+        Path jar = Path.of(\"testFileSystemProvider.jar\");\n+        Files.deleteIfExists(jar);\n+        createFileSystemProviderJar(jar, Path.of(testClasses));\n+        String classpath = jar + File.pathSeparator + testClasses\n+                + File.separator + \"modules\" + File.separator + \"m\";\n+        int exitValue = exec(SET_DEFAULT_FSP, \"-cp\", classpath, \"p.Main\");\n+        assertTrue(exitValue == 0);\n+    }\n+\n+    \/**\n+     * Creates a JAR containing the FileSystemProvider used to override the\n+     * default FileSystemProvider\n+     *\/\n+    private void createFileSystemProviderJar(Path jar, Path dir) throws IOException {\n+\n+        List<String>  args = new ArrayList<>();\n+        args.add(\"--create\");\n+        args.add(\"--file=\" + jar);\n+        try (Stream<Path> stream = Files.list(dir)) {\n+            List<String> paths = stream\n+                    .map(path -> path.getFileName().toString())\n+                    .filter(f -> f.startsWith(\"TestProvider\"))\n+                    .collect(Collectors.toList());\n+            for(var p : paths) {\n+                args.add(\"-C\");\n+                args.add(dir.toString());\n+                args.add(p);\n+            }\n+        }\n+        int ret = JAR_TOOL.run(System.out, System.out, args.toArray(new String[0]));\n+        assertTrue(ret == 0);\n+    }\n+\n","filename":"test\/jdk\/java\/nio\/file\/spi\/SetDefaultProvider.java","additions":44,"deletions":1,"binary":false,"changes":45,"status":"modified"}]}