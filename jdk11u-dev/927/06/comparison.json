{"files":[{"patch":"@@ -2886,1 +2886,0 @@\n-    size_t heap_used_bytes_before_gc = used();\n@@ -3047,1 +3046,1 @@\n-        g1_policy()->record_collection_pause_end(pause_time_ms, total_cards_scanned, heap_used_bytes_before_gc);\n+        g1_policy()->record_collection_pause_end(pause_time_ms, total_cards_scanned);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -85,1 +85,1 @@\n-void G1ParScanThreadState::flush(size_t* surviving_young_words) {\n+size_t G1ParScanThreadState::flush(size_t* surviving_young_words) {\n@@ -91,0 +91,1 @@\n+  size_t sum = 0;\n@@ -93,1 +94,2 @@\n-    surviving_young_words[region_index] += _surviving_young_words[region_index];\n+    surviving_young_words[region_index] += G1ParScanThreadState::surviving_young_words()[region_index];\n+    sum += G1ParScanThreadState::surviving_young_words()[region_index];\n@@ -95,0 +97,1 @@\n+  return sum;\n@@ -342,0 +345,1 @@\n+  size_t copied_words = 0;\n@@ -349,1 +353,1 @@\n-    pss->flush(_surviving_young_words_total);\n+    copied_words += pss->flush(_surviving_young_words_total);\n@@ -353,0 +357,1 @@\n+  _g1h->g1_policy()->record_copied_bytes(copied_words << LogBytesPerWord);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ParScanThreadState.cpp","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -135,1 +135,1 @@\n-  void flush(size_t* surviving_young_words);\n+  size_t flush(size_t* surviving_young_words);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ParScanThreadState.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -63,0 +63,1 @@\n+  _copied_bytes(0),\n@@ -556,1 +557,1 @@\n-void G1Policy::record_collection_pause_end(double pause_time_ms, size_t cards_scanned, size_t heap_used_bytes_before_gc) {\n+void G1Policy::record_collection_pause_end(double pause_time_ms, size_t cards_scanned) {\n@@ -559,2 +560,0 @@\n-  size_t cur_used_bytes = _g1h->used();\n-  assert(cur_used_bytes == _g1h->recalculate_used(), \"It should!\");\n@@ -668,4 +667,1 @@\n-    size_t freed_bytes = heap_used_bytes_before_gc - cur_used_bytes;\n-\n-    if (_collection_set->bytes_used_before() > freed_bytes) {\n-      size_t copied_bytes = _collection_set->bytes_used_before() - freed_bytes;\n+    if (_copied_bytes > 0) {\n@@ -673,1 +669,1 @@\n-      double cost_per_byte_ms = average_copy_time \/ (double) copied_bytes;\n+      double cost_per_byte_ms = average_copy_time \/ (double) _copied_bytes;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":4,"deletions":8,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -109,0 +109,2 @@\n+  size_t _copied_bytes;\n+\n@@ -136,0 +138,4 @@\n+  void record_copied_bytes(size_t copied_bytes) {\n+    _copied_bytes = copied_bytes;\n+  }\n+\n@@ -311,1 +317,1 @@\n-  void record_collection_pause_end(double pause_time_ms, size_t cards_scanned, size_t heap_used_bytes_before_gc);\n+  void record_collection_pause_end(double pause_time_ms, size_t cards_scanned);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}