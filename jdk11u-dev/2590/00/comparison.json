{"files":[{"patch":"@@ -557,0 +557,12 @@\n+# Native files needed by the testlib\n+build-test-lib-native:\n+\t+($(CD) $(TOPDIR)\/make\/test && $(MAKE) $(MAKE_ARGS) -f BuildTestLibNative.gmk \\\n+\t    build-test-lib-native)\n+\n+test-image-lib-native:\n+\t+($(CD) $(TOPDIR)\/make\/test && $(MAKE) $(MAKE_ARGS) -f BuildTestLibNative.gmk \\\n+\t    test-image-lib-native)\n+\n+# Native files needed when testing the testlib itself\n+# ... build-test-libtest-jtreg-native etc not yet backported\n+\n@@ -599,1 +611,2 @@\n-    test-image-jdk-jtreg-native build-test-lib build-test-failure-handler \\\n+    test-image-jdk-jtreg-native build-test-lib-native test-image-lib-native \\\n+    build-test-lib build-test-failure-handler \\\n@@ -979,0 +992,2 @@\n+  build-test-lib-native: buildtools-jdk java.base-libs\n+\n@@ -985,0 +1000,2 @@\n+  test-image-lib-native: build-test-lib-native\n+\n@@ -1144,1 +1161,2 @@\n-    test-image-jdk-jtreg-native test-image-failure-handler \\\n+    test-image-jdk-jtreg-native test-image-lib-native \\\n+    test-image-failure-handler \\\n","filename":"make\/Main.gmk","additions":20,"deletions":2,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -48,1 +48,0 @@\n-# test-lib.jar will contain only hprof classes until JDK-8081381 is resolved\n@@ -51,1 +50,2 @@\n-    SRC := $(TEST_LIB_SOURCE_DIR)\/jdk\/test\/lib\/hprof, \\\n+    SRC := $(TEST_LIB_SOURCE_DIR), \\\n+    EXCLUDES := jdk\/test\/lib\/containers jdk\/test\/lib\/security, \\\n@@ -53,0 +53,1 @@\n+    HEADERS := $(TEST_LIB_SUPPORT)\/test-lib_headers, \\\n@@ -54,0 +55,1 @@\n+    DISABLED_WARNINGS := try deprecation rawtypes unchecked serial cast, \\\n","filename":"make\/test\/BuildTestLib.gmk","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,83 @@\n+#\n+# Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.  Oracle designates this\n+# particular file as subject to the \"Classpath\" exception as provided\n+# by Oracle in the LICENSE file that accompanied this code.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+################################################################################\n+# This file builds the native component of testlib.\n+# It also covers the test-image part, where the built files are copied to the\n+# test image.\n+################################################################################\n+\n+default: all\n+\n+include $(SPEC)\n+include MakeBase.gmk\n+include TestFilesCompilation.gmk\n+\n+################################################################################\n+# Targets for building the native tests themselves.\n+################################################################################\n+\n+BUILD_LIBTEST_NATIVE_SRC := $(TOPDIR)\/test\/lib\n+\n+BUILD_LIBTEST_OUTPUT_DIR := $(OUTPUTDIR)\/support\/test\/lib\/native\n+\n+BUILD_LIBTEST_IMAGE_DIR := $(TEST_IMAGE_DIR)\/lib\n+\n+# This evaluation is expensive and should only be done if this target was\n+# explicitly called.\n+ifneq ($(filter build-test-lib-native, $(MAKECMDGOALS)), )\n+  $(eval $(call SetupTestFilesCompilation, BUILD_LIBTEST_LIBRARIES, \\\n+      TYPE := LIBRARY, \\\n+      SOURCE_DIRS := $(BUILD_LIBTEST_NATIVE_SRC), \\\n+      OUTPUT_DIR := $(BUILD_LIBTEST_OUTPUT_DIR), \\\n+  ))\n+endif\n+\n+build-test-lib-native: $(BUILD_LIBTEST_LIBRARIES)\n+\n+################################################################################\n+# Targets for building test-image.\n+################################################################################\n+\n+# Copy to testlib test image. We need it in both hotspot and jdk.\n+$(eval $(call SetupCopyFiles, COPY_LIBTEST_NATIVE_TO_HOTSPOT, \\\n+    SRC := $(BUILD_LIBTEST_OUTPUT_DIR), \\\n+    DEST := $(TEST_IMAGE_DIR)\/hotspot\/jtreg\/native, \\\n+    FILES := $(wildcard $(addprefix $(BUILD_LIBTEST_OUTPUT_DIR), \/lib\/*)), \\\n+    FLATTEN := true, \\\n+))\n+\n+$(eval $(call SetupCopyFiles, COPY_LIBTEST_NATIVE_TO_JDK, \\\n+    SRC := $(BUILD_LIBTEST_OUTPUT_DIR), \\\n+    DEST := $(TEST_IMAGE_DIR)\/jdk\/jtreg\/native, \\\n+    FILES := $(wildcard $(addprefix $(BUILD_LIBTEST_OUTPUT_DIR), \/lib\/*)), \\\n+    FLATTEN := true, \\\n+))\n+\n+test-image-lib-native: $(COPY_LIBTEST_NATIVE_TO_HOTSPOT) $(COPY_LIBTEST_NATIVE_TO_JDK)\n+\n+all: build-test-lib-native\n+\n+.PHONY: default all build-test-lib-native test-image-lib-native\n","filename":"make\/test\/BuildTestLibNative.gmk","additions":83,"deletions":0,"binary":false,"changes":83,"status":"added"},{"patch":"@@ -0,0 +1,42 @@\n+\/*\n+ * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#include <jni.h>\n+\n+\/\/ Borrowed from hotspot vmError.cpp.\n+\/\/ Returns an address which is guaranteed to generate a SIGSEGV on read,\n+\/\/ which is not NULL and contains bits in every word\n+void* get_segfault_address() {\n+  return (void*)\n+#ifdef _LP64\n+    0xABC0000000000ABCULL;\n+#else\n+    0x00000ABC;\n+#endif\n+}\n+\n+JNIEXPORT jint JNICALL\n+Java_jdk_test_lib_apps_LingeredApp_crash(JNIEnv *env, jclass clss)\n+{\n+    return *(jint *)get_segfault_address();\n+}\n","filename":"test\/lib\/jdk\/test\/lib\/apps\/libLingeredApp.c","additions":42,"deletions":0,"binary":false,"changes":42,"status":"added"}]}