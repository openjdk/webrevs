{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -338,14 +338,16 @@\n-                    int newSize = newFileCache.size();\n-                    int oldSize = fileCache.size();\n-\n-                    if (newSize > oldSize) {\n-                        \/\/see if interval is added\n-                        int start = oldSize;\n-                        int end = newSize;\n-                        for (int i = 0; i < oldSize; i++) {\n-                            if (!newFileCache.get(i).equals(fileCache.get(i))) {\n-                                start = i;\n-                                for (int j = i; j < newSize; j++) {\n-                                    if (newFileCache.get(j).equals(fileCache.get(i))) {\n-                                        end = j;\n-                                        break;\n+                    synchronized (fileCache) {\n+                        int newSize = newFileCache.size();\n+                        int oldSize = fileCache.size();\n+\n+                        if (newSize > oldSize) {\n+                            \/\/see if interval is added\n+                            int start = oldSize;\n+                            int end = newSize;\n+                            for (int i = 0; i < oldSize; i++) {\n+                                if (!newFileCache.get(i).equals(fileCache.get(i))) {\n+                                    start = i;\n+                                    for (int j = i; j < newSize; j++) {\n+                                        if (newFileCache.get(j).equals(fileCache.get(i))) {\n+                                            end = j;\n+                                            break;\n+                                        }\n@@ -353,0 +355,1 @@\n+                                    break;\n@@ -354,1 +357,0 @@\n-                                break;\n@@ -356,1 +358,0 @@\n-                        }\n@@ -358,3 +359,3 @@\n-                        if (start >= 0 && end > start) {\n-                            List<File> listStart_OldSize = new Vector<>(fileCache.subList(start, oldSize));\n-                            if (newFileCache.subList(end, newSize).equals(listStart_OldSize)) {\n+                            if (start >= 0 && end > start\n+                                    && newFileCache.subList(end, newSize)\n+                                                   .equals(fileCache.subList(start, oldSize))) {\n@@ -364,1 +365,2 @@\n-                                return new DoChangeContents(newFileCache.subList(start, end), start, null, 0, fid);\n+                                return new DoChangeContents(newFileCache.subList(start, end),\n+                                                            start, null, 0, fid);\n@@ -366,10 +368,10 @@\n-                        }\n-                    } else if (newSize < oldSize) {\n-                        \/\/see if interval is removed\n-                        int start = -1;\n-                        int end = -1;\n-                        for (int i = 0; i < newSize; i++) {\n-                            if (!newFileCache.get(i).equals(fileCache.get(i))) {\n-                                start = i;\n-                                end = i + oldSize - newSize;\n-                                break;\n+                        } else if (newSize < oldSize) {\n+                            \/\/see if interval is removed\n+                            int start = -1;\n+                            int end = -1;\n+                            for (int i = 0; i < newSize; i++) {\n+                                if (!newFileCache.get(i).equals(fileCache.get(i))) {\n+                                    start = i;\n+                                    end = i + oldSize - newSize;\n+                                    break;\n+                                }\n@@ -377,1 +379,0 @@\n-                        }\n@@ -379,3 +380,3 @@\n-                        if (start >= 0 && end > start) {\n-                            List<File> listEnd_OldSize = new Vector<>(fileCache.subList(end, oldSize));\n-                            if (listEnd_OldSize.equals(newFileCache.subList(start, newSize))) {\n+                            if (start >= 0 && end > start\n+                                    && fileCache.subList(end, oldSize)\n+                                                .equals(newFileCache.subList(start, newSize))) {\n@@ -385,1 +386,2 @@\n-                                return new DoChangeContents(null, 0, new Vector<>(fileCache.subList(start, end)), start, fid);\n+                                return new DoChangeContents(null, 0,\n+                                        new Vector<>(fileCache.subList(start, end)), start, fid);\n@@ -388,4 +390,5 @@\n-                    }\n-                    if (!fileCache.equals(newFileCache)) {\n-                        if (loadThread.isInterrupted()) {\n-                            cancelRunnables();\n+                        if (!fileCache.equals(newFileCache)) {\n+                            if (loadThread.isInterrupted()) {\n+                                cancelRunnables();\n+                            }\n+                            return new DoChangeContents(newFileCache, 0, fileCache, 0, fid);\n@@ -393,1 +396,1 @@\n-                        return new DoChangeContents(newFileCache, 0, fileCache, 0, fid);\n+                        return null;\n@@ -395,1 +398,0 @@\n-                    return null;\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/basic\/BasicDirectoryModel.java","additions":44,"deletions":42,"binary":false,"changes":86,"status":"modified"}]}