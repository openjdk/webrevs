{"files":[{"patch":"@@ -1365,0 +1365,13 @@\n+        \/\/ Some webpage passes 3 digit color code as in #fff which is\n+        \/\/ decoded as #000FFF resulting in blue background.\n+        \/\/ As per https:\/\/www.w3.org\/TR\/CSS1\/#color-units,\n+        \/\/ The three-digit RGB notation (#rgb) is converted into six-digit form\n+        \/\/ (#rrggbb) by replicating digits, not by adding zeros.\n+        \/\/ This makes sure that white (#ffffff) can be specified with the short notation\n+        \/\/ (#fff) and removes any dependencies on the color depth of the display.\n+        if (digits.length() == 3) {\n+            final String r = digits.substring(0, 1);\n+            final String g = digits.substring(1, 2);\n+            final String b = digits.substring(2, 3);\n+            digits = String.format(\"%s%s%s%s%s%s\", r, r, g, g, b, b);\n+        }\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/CSS.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -0,0 +1,116 @@\n+\/*\n+ * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @key headful\n+ * @bug 8213781\n+ * @summary Verify webpage background color renders correctly in JEditorPane\n+ *\/\n+\n+import java.awt.Toolkit;\n+import java.awt.event.WindowAdapter;\n+import java.awt.event.WindowEvent;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import javax.swing.JDialog;\n+import javax.swing.JEditorPane;\n+import javax.swing.JFrame;\n+import javax.swing.JScrollPane;\n+import javax.swing.SwingUtilities;\n+import javax.swing.event.HyperlinkEvent;\n+import javax.swing.event.HyperlinkListener;\n+import javax.swing.text.html.HTMLFrameHyperlinkEvent;\n+import javax.swing.text.html.HTMLDocument;\n+import java.awt.Color;\n+import java.awt.Insets;\n+import java.awt.Point;\n+import java.awt.Robot;\n+\n+public class TestBrowserBGColor extends JFrame implements HyperlinkListener {\n+\n+    private static TestBrowserBGColor b;\n+    private static JEditorPane browser;\n+\n+    public static void main(final String[] args) throws Exception {\n+        Robot r = new Robot();\n+        SwingUtilities.invokeAndWait(() -> {\n+            try {\n+                b = new TestBrowserBGColor();\n+            } catch (Exception e) {\n+                throw new RuntimeException(e);\n+            }\n+            b.setSize(Toolkit.getDefaultToolkit().getScreenSize());\n+            b.setVisible(true);\n+            b.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);\n+            b.addWindowListener(new WindowAdapter() {\n+                public void windowClosing(WindowEvent e) {\n+                    b.dispose();\n+                    b = null;\n+                }\n+            });\n+        });\n+\n+        r.waitForIdle();\n+        r.delay(500);\n+\n+        SwingUtilities.invokeAndWait(() -> {\n+            Insets insets = browser.getInsets();\n+            Point loc = browser.getLocationOnScreen();\n+            Color c = r.getPixelColor( loc.x + insets.left+100,\n+                                  loc.y + insets.top + 100);\n+            b.dispose();\n+            if (!c.equals(Color.WHITE)) {\n+                throw new RuntimeException(\"webpage background color wrong\");\n+            }\n+        });\n+    }\n+\n+\n+    String htmlDoc = \" <!DOCTYPE html> <html><style> body { background: #FFF; } <\/style> <head> <title>Title<\/title> <\/head> <body> <\/body> <\/html>\";\n+\n+    public TestBrowserBGColor() throws IOException, MalformedURLException {\n+        browser = new JEditorPane(\"text\/html\", htmlDoc);\n+        browser.setEditable(false);\n+        browser.addHyperlinkListener(this);\n+        JScrollPane scroll = new JScrollPane(browser);\n+        getContentPane().add(scroll);\n+    }\n+\n+    public void hyperlinkUpdate(final HyperlinkEvent e) {\n+        if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED) {\n+            JEditorPane pane = (JEditorPane) e.getSource();\n+            if (e instanceof HTMLFrameHyperlinkEvent) {\n+                HTMLFrameHyperlinkEvent evt = (HTMLFrameHyperlinkEvent) e;\n+                HTMLDocument doc = (HTMLDocument) pane.getDocument();\n+                doc.processHTMLFrameHyperlinkEvent(evt);\n+            } else {\n+                try {\n+                    pane.setPage(e.getURL());\n+                } catch (Throwable t) {\n+                    t.printStackTrace();\n+                }\n+            }\n+        }\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/JEditorPane\/TestBrowserBGColor.java","additions":116,"deletions":0,"binary":false,"changes":116,"status":"added"}]}