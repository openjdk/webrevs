{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -82,0 +82,1 @@\n+                CoreUtils.getAlwaysPretouchArg(true),\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/ClhsdbCDSCore.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -88,1 +88,1 @@\n-                LingeredApp.startApp(List.of(\"-Xcomp\"), theApp);\n+                LingeredApp.startApp(List.of(\"-Xcomp\", CoreUtils.getAlwaysPretouchArg(withCore)), theApp);\n@@ -90,1 +90,1 @@\n-                LingeredApp.startApp(List.of(\"-Xint\"), theApp);\n+                LingeredApp.startApp(List.of(\"-Xint\", CoreUtils.getAlwaysPretouchArg(withCore)), theApp);\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/ClhsdbFindPC.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import jdk.test.lib.util.CoreUtils;\n@@ -49,1 +50,1 @@\n-            theApp = LingeredApp.startApp();\n+            theApp = LingeredApp.startApp(List.of(CoreUtils.getAlwaysPretouchArg(false)));\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/ClhsdbPmap.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import jdk.test.lib.util.CoreUtils;\n@@ -48,1 +49,1 @@\n-            theApp = LingeredApp.startApp();\n+            theApp = LingeredApp.startApp(List.of(CoreUtils.getAlwaysPretouchArg(false)));\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/ClhsdbPstack.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -77,0 +77,1 @@\n+                CoreUtils.getAlwaysPretouchArg(true),\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/TestJmapCore.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -233,1 +233,11 @@\n-}\n\\ No newline at end of file\n+    public static String getAlwaysPretouchArg(boolean withCore) {\n+        \/\/ macosx-aarch64 has an issue where sometimes the java heap will not be dumped to the\n+        \/\/ core file. Using -XX:+AlwaysPreTouch fixes the problem.\n+        if (withCore && Platform.isOSX() && Platform.isAArch64()) {\n+            return \"-XX:+AlwaysPreTouch\";\n+        } else {\n+            return \"-XX:-AlwaysPreTouch\";\n+        }\n+    }\n+\n+}\n","filename":"test\/lib\/jdk\/test\/lib\/util\/CoreUtils.java","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"}]}