{"files":[{"patch":"@@ -336,7 +336,0 @@\n-        # Hack to get hold of the api environment variables that are only defined for actions\n-      - name: 'Get API configuration'\n-        id: api\n-        uses: actions\/github-script@v7\n-        with:\n-          script: 'return { url: process.env[\"ACTIONS_RUNTIME_URL\"], token: process.env[\"ACTIONS_RUNTIME_TOKEN\"] }'\n-\n@@ -346,11 +339,15 @@\n-          ALL_ARTIFACT_URLS=\"$(curl -s \\\n-              -H 'Accept: application\/json;api-version=6.0-preview' \\\n-              -H 'Authorization: Bearer ${{ fromJson(steps.api.outputs.result).token }}' \\\n-              '${{ fromJson(steps.api.outputs.result).url }}_apis\/pipelines\/workflows\/${{ github.run_id }}\/artifacts?api-version=6.0-preview')\"\n-          BUNDLE_ARTIFACT_URLS=\"$(echo \"$ALL_ARTIFACT_URLS\" | jq -r -c '.value | map(select(.name|startswith(\"bundles-\"))) | .[].url')\"\n-          for url in $BUNDLE_ARTIFACT_URLS; do\n-            echo \"Removing $url\"\n-            curl -s \\\n-                -H 'Accept: application\/json;api-version=6.0-preview' \\\n-                -H 'Authorization: Bearer ${{ fromJson(steps.api.outputs.result).token }}' \\\n-                -X DELETE \"$url\" \\\n+          # See: https:\/\/docs.github.com\/en\/rest\/actions\/artifacts?apiVersion=2022-11-28\n+          ALL_ARTIFACT_IDS=\"$(curl -sL \\\n+              -H 'Accept: application\/vnd.github+json' \\\n+              -H 'Authorization: Bearer ${{ github.token }}' \\\n+              -H 'X-GitHub-Api-Version: 2022-11-28' \\\n+              '${{ github.api_url }}\/repos\/${{ github.repository }}\/actions\/runs\/${{ github.run_id }}\/artifacts')\"\n+          BUNDLE_ARTIFACT_IDS=\"$(echo \"$ALL_ARTIFACT_IDS\" | jq -r -c '.artifacts | map(select(.name|startswith(\"bundles-\"))) | .[].id')\"\n+          for id in $BUNDLE_ARTIFACT_IDS; do\n+            echo \"Removing $id\"\n+            curl -sL \\\n+                -X DELETE \\\n+                -H 'Accept: application\/vnd.github+json' \\\n+                -H 'Authorization: Bearer ${{ github.token }}' \\\n+                -H 'X-GitHub-Api-Version: 2022-11-28' \\\n+                \"${{ github.api_url }}\/repos\/${{ github.repository }}\/actions\/artifacts\/$id\" \\\n","filename":".github\/workflows\/main.yml","additions":15,"deletions":18,"binary":false,"changes":33,"status":"modified"}]}