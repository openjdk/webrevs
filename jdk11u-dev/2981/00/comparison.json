{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,3 @@\n-import java.nio.file.*;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n@@ -35,0 +37,1 @@\n+import java.util.spi.ToolProvider;\n@@ -62,0 +65,10 @@\n+\n+    private static final ToolProvider JAR_TOOL = ToolProvider.findFirst(\"jar\")\n+            .orElseThrow(()\n+                    -> new RuntimeException(\"jar tool not found\")\n+            );\n+    private static final ToolProvider JAVAC_TOOL = ToolProvider.findFirst(\"javac\")\n+            .orElseThrow(()\n+                    -> new RuntimeException(\"javac tool not found\")\n+            );\n+\n@@ -936,1 +949,1 @@\n-        if (stdinSource != null)\n+        if (stdinSource != null) {\n@@ -938,0 +951,1 @@\n+        }\n@@ -942,1 +956,1 @@\n-        return jarWithStdin(null, args);\n+        return run(JAR_TOOL, args);\n@@ -1030,1 +1044,0 @@\n-        String javac = getJDKTool(\"javac\");\n@@ -1033,1 +1046,0 @@\n-        commands.add(javac);\n@@ -1051,1 +1063,7 @@\n-        quickFail(run(new ProcessBuilder(commands)));\n+        StringWriter sw = new StringWriter();\n+        try (PrintWriter pw = new PrintWriter(sw)) {\n+            int rc = JAVAC_TOOL.run(pw, pw, commands.toArray(new String[0]));\n+            if(rc != 0) {\n+                throw new RuntimeException(sw.toString());\n+            }\n+        }\n@@ -1097,3 +1115,7 @@\n-    static void quickFail(Result r) {\n-        if (r.ec != 0)\n-            throw new RuntimeException(r.output);\n+    static Result run(ToolProvider tp, String[] commands) {\n+        int rc = 0;\n+        StringWriter sw = new StringWriter();\n+        try (PrintWriter pw = new PrintWriter(sw)) {\n+            rc = tp.run(pw, pw, commands);\n+        }\n+        return new Result(rc, sw.toString());\n","filename":"test\/jdk\/tools\/jar\/modularJar\/Basic.java","additions":32,"deletions":10,"binary":false,"changes":42,"status":"modified"}]}