{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -54,1 +54,0 @@\n-    StepRequest stepRequest = null;\n@@ -56,1 +55,2 @@\n-    boolean mainIsDead;\n+    volatile boolean mainIsDead = false;\n+    volatile boolean gotExpectedThreadStart = false;\n@@ -71,4 +71,4 @@\n-        if (stepRequest != null) {\n-            erm.deleteEventRequest(stepRequest);\n-            stepRequest = null;\n-            println(\"Deleted stepRequest\");\n+        \/\/ We don't want to attempt the StepRequest.enable() until we recieve\n+        \/\/ the ThreadStartEvent for the \"DestroyJavaVM\" thread. See JDK-8232839.\n+        if (!event.thread().name().equals(\"DestroyJavaVM\")) {\n+            return;\n@@ -76,0 +76,1 @@\n+        gotExpectedThreadStart = true;\n@@ -77,1 +78,3 @@\n-        if (mainIsDead) {\n+        if (!mainIsDead) {\n+            failure(\"FAILED: Got expected ThreadStartEvent before \\\"main\\\" ThreadDeathEvent\");\n+        } else {\n@@ -82,3 +85,3 @@\n-            stepRequest = erm.createStepRequest(mainThread,\n-                                                StepRequest.STEP_LINE,\n-                                                StepRequest.STEP_OVER);\n+            StepRequest stepRequest = erm.createStepRequest(mainThread,\n+                                                            StepRequest.STEP_LINE,\n+                                                            StepRequest.STEP_OVER);\n@@ -149,0 +152,7 @@\n+        if (!gotExpectedThreadStart) {\n+            failure(\"FAILED: never got expected ThreadStartEvent\");\n+        }\n+        if (!mainIsDead) {\n+            failure(\"FAILED: never got ThreadDeathEvent for \\\"main\\\" thread\");\n+        }\n+\n","filename":"test\/jdk\/com\/sun\/jdi\/AfterThreadDeathTest.java","additions":21,"deletions":11,"binary":false,"changes":32,"status":"modified"}]}