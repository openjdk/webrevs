{"files":[{"patch":"@@ -63,0 +63,2 @@\n+ * <p>\n+ * Adding data with multiple occurences of a category to a series shows the last occurence.\n@@ -212,0 +214,28 @@\n+            int seriesCount = getDataSize();\n+            int categoryCount = categoryAxis.getCategories().size();\n+\n+            int categoryIndex;\n+            if (seriesCount == 1 && itemIndex == categoryCount) {\n+                \/\/ shortcut if there is only one series and data contains no duplicates\n+                categoryIndex = categoryCount;\n+            } else {\n+                \/\/ There may be data items with duplicate categories. Find category insertion index on the axis\n+                \/\/ by looking at the concatenation of the data of all series, skipping duplicate categories.\n+                categoryIndex = 0;\n+                var uniqueCategories = new HashSet<String>();\n+                for (var entry : seriesCategoryMap.entrySet()) {\n+                    Series s = entry.getKey();\n+                    Map<String, Data<X,Y>> catMap = entry.getValue();\n+                    int i = 0;\n+                    for (String cat : catMap.keySet()) {\n+                        if (s == series && i >= itemIndex) {\n+                            break;\n+                        }\n+                        if (uniqueCategories.add(cat)) {\n+                            categoryIndex++;\n+                        }\n+                        i++;\n+                    }\n+                }\n+            }\n+\n@@ -213,1 +243,1 @@\n-            categoryAxis.getCategories().add(itemIndex, category);\n+            categoryAxis.getCategories().add(categoryIndex, category);\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/BarChart.java","additions":31,"deletions":1,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -29,0 +29,2 @@\n+import java.util.List;\n+\n@@ -181,0 +183,91 @@\n+\n+    @Test\n+    public void testAddingNonEmptySeries() {\n+        startApp();\n+        ObservableList<XYChart.Data<String, Number>> list = FXCollections.observableArrayList();\n+        list.add(new XYChart.Data<>(\"1\", 1));\n+        list.add(new XYChart.Data<>(\"2\", 2));\n+        list.add(new XYChart.Data<>(\"3\", 3));\n+        BarChart<String, Number> bc = new BarChart<>(new CategoryAxis(), new NumberAxis());\n+        bc.getData().add(new Series<>());\n+        bc.getData().getFirst().setData(list);\n+        assertEquals(3, XYChartShim.Series_getDataSize(bc.getData().getFirst()));\n+    }\n+\n+    @Test\n+    public void testAddingDuplicateCategory() {\n+        startApp();\n+        ObservableList<XYChart.Data<String, Number>> list = FXCollections.observableArrayList();\n+        list.add(new XYChart.Data<>(\"1\", 1));\n+        list.add(new XYChart.Data<>(\"1\", 2));\n+        list.add(new XYChart.Data<>(\"2\", 3));\n+        BarChart<String, Number> bc = new BarChart<>(new CategoryAxis(), new NumberAxis());\n+        bc.getData().add(new Series<>());\n+        bc.getData().getFirst().setData(list);\n+        assertEquals(2, XYChartShim.Series_getDataSize(bc.getData().getFirst()));\n+    }\n+\n+    @Test\n+    public void testAddingDataAtIndex() {\n+        startApp();\n+        ObservableList<XYChart.Data<String, Number>> list = FXCollections.observableArrayList();\n+        list.add(new XYChart.Data<>(\"1\", 1));\n+        list.add(new XYChart.Data<>(\"2\", 2));\n+        list.add(new XYChart.Data<>(\"3\", 3));\n+        BarChart<String, Number> bc = new BarChart<>(new CategoryAxis(), new NumberAxis());\n+        bc.getData().add(new Series<>());\n+        bc.getData().getFirst().setData(list);\n+        assertEquals(3, XYChartShim.Series_getDataSize(bc.getData().getFirst()));\n+\n+        \/\/ insert new data before data item \"3\":\n+        bc.getData().getFirst().getData().add(2, new XYChart.Data<>(\"4\", 4));\n+\n+        var categories = ((CategoryAxis)bc.getXAxis()).getCategories();\n+        assertEquals(4, categories.size());\n+        assertEquals(\"1\", categories.get(0));\n+        assertEquals(\"2\", categories.get(1));\n+        assertEquals(\"4\", categories.get(2));\n+        assertEquals(\"3\", categories.get(3));\n+    }\n+\n+    @Test\n+    public void testAddingMultipleSeriesWithDuplicateCategories() {\n+        startApp();\n+        var series1 = new Series<String, Number>();\n+        var series2 = new Series<String, Number>();\n+        BarChart<String, Number> bc = new BarChart<>(new CategoryAxis(), new NumberAxis());\n+        bc.getData().add(series1);\n+        bc.getData().add(series2);\n+\n+        series1.getData().addAll(List.of(\n+            new XYChart.Data<>(\"1\", 1),\n+            new XYChart.Data<>(\"1\", 2), \/\/ duplicate category\n+            new XYChart.Data<>(\"2\", 3)\n+        ));\n+\n+        series2.getData().addAll(List.of(\n+            new XYChart.Data<>(\"3\", 4),\n+            new XYChart.Data<>(\"2\", 5), \/\/ duplicate category with series1\n+            new XYChart.Data<>(\"4\", 6)\n+        ));\n+\n+        assertEquals(2, XYChartShim.Series_getDataSize(series1));\n+        assertEquals(3, XYChartShim.Series_getDataSize(series2));\n+        assertEquals(5, XYChartShim.getPlotChildren(bc).size());\n+\n+        var categories = ((CategoryAxis)bc.getXAxis()).getCategories();\n+        assertEquals(4, categories.size());\n+        assertEquals(\"1\", categories.get(0));\n+        assertEquals(\"2\", categories.get(1));\n+        assertEquals(\"3\", categories.get(2));\n+        assertEquals(\"4\", categories.get(3));\n+\n+        \/\/ insert new data before data item \"4\" in series2:\n+        series2.getData().add(2, new XYChart.Data<>(\"5\", 7));\n+\n+        assertEquals(\"1\", categories.get(0));\n+        assertEquals(\"2\", categories.get(1));\n+        assertEquals(\"3\", categories.get(2));\n+        assertEquals(\"5\", categories.get(3));\n+        assertEquals(\"4\", categories.get(4));\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/chart\/BarChartTest.java","additions":93,"deletions":0,"binary":false,"changes":93,"status":"modified"}]}