{"files":[{"patch":"@@ -601,0 +601,1 @@\n+                int index = -1;\n@@ -602,0 +603,8 @@\n+                T editorValue;\n+\n+                try {\n+                    editorValue = comboBox.getConverter().fromString(comboBox.getEditor().getText());\n+                } catch (RuntimeException ex) {\n+                    editorValue = null;\n+                }\n+\n@@ -606,1 +615,3 @@\n-                        \/\/ no-op\n+                        index = -1;\n+                    } else if (c.wasAdded() && editorValue != null && c.getAddedSubList().contains(editorValue)) {\n+                        index = c.getFrom() + c.getAddedSubList().indexOf(editorValue);\n@@ -608,0 +619,2 @@\n+                        index = -1;\n+\n@@ -614,1 +627,3 @@\n-                if (shift != 0) {\n+                if (index >= 0) {\n+                    clearAndSelect(index);\n+                } else if (shift != 0) {\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ComboBox.java","additions":17,"deletions":2,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -1309,0 +1309,8 @@\n+                    int addedItemOffset = -1;\n+\n+                    if (c.wasAdded()\n+                            && selectedItem != null\n+                            && (addedItemOffset = c.getAddedSubList().indexOf(selectedItem)) >= 0\n+                            && selectedIndex == c.getFrom() + addedItemOffset) {\n+                        doSelectionUpdate = false;\n+                    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ListView.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -662,0 +662,42 @@\n+    @Test public void ensureEditorValueDoesNotChangeWhenCurrentEditorValueIsAddedToItemsList() {\n+        @SuppressWarnings(\"unchecked\")\n+        var listView = (ListView<String>)((ComboBoxListViewSkin<String>)comboBox.getSkin()).getPopupContent();\n+        comboBox.setEditable(true);\n+        comboBox.getItems().setAll(\"a\", \"b\", \"c\");\n+        comboBox.getSelectionModel().select(1);\n+        assertEquals(\"b\", comboBox.getEditor().getText());\n+        assertEquals(\"b\", comboBox.getValue());\n+        assertEquals(\"b\", listView.getSelectionModel().getSelectedItem());\n+        assertEquals(1, listView.getSelectionModel().getSelectedIndex());\n+\n+        comboBox.getEditor().setText(\"d\");\n+        comboBox.getItems().add(0, comboBox.getEditor().getText());\n+        assertEquals(List.of(\"d\", \"a\", \"b\", \"c\"), comboBox.getItems());\n+        assertEquals(0, comboBox.getSelectionModel().getSelectedIndex());\n+        assertEquals(0, listView.getSelectionModel().getSelectedIndex());\n+        assertEquals(\"d\", comboBox.getSelectionModel().getSelectedItem());\n+        assertEquals(\"d\", listView.getSelectionModel().getSelectedItem());\n+        assertEquals(\"d\", comboBox.getEditor().getText());\n+        assertEquals(\"d\", comboBox.getValue());\n+\n+        comboBox.getEditor().setText(\"e\");\n+        comboBox.getItems().addAll(0, List.of(comboBox.getEditor().getText(), \"f\"));\n+        assertEquals(List.of(\"e\", \"f\", \"d\", \"a\", \"b\", \"c\"), comboBox.getItems());\n+        assertEquals(0, comboBox.getSelectionModel().getSelectedIndex());\n+        assertEquals(0, listView.getSelectionModel().getSelectedIndex());\n+        assertEquals(\"e\", comboBox.getSelectionModel().getSelectedItem());\n+        assertEquals(\"e\", listView.getSelectionModel().getSelectedItem());\n+        assertEquals(\"e\", comboBox.getEditor().getText());\n+        assertEquals(\"e\", comboBox.getValue());\n+\n+        comboBox.getEditor().setText(\"h\");\n+        comboBox.getItems().addAll(0, List.of(\"g\", comboBox.getEditor().getText(), \"i\"));\n+        assertEquals(List.of(\"g\", \"h\", \"i\", \"e\", \"f\", \"d\", \"a\", \"b\", \"c\"), comboBox.getItems());\n+        assertEquals(1, comboBox.getSelectionModel().getSelectedIndex());\n+        assertEquals(1, listView.getSelectionModel().getSelectedIndex());\n+        assertEquals(\"h\", comboBox.getSelectionModel().getSelectedItem());\n+        assertEquals(\"h\", listView.getSelectionModel().getSelectedItem());\n+        assertEquals(\"h\", comboBox.getEditor().getText());\n+        assertEquals(\"h\", comboBox.getValue());\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ComboBoxTest.java","additions":42,"deletions":0,"binary":false,"changes":42,"status":"modified"}]}