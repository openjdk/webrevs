{"files":[{"patch":"@@ -1012,0 +1012,8 @@\n+\n+        \/*\n+         * Subtract the width of trailing spaces for the new TextLine so they're not taken into account\n+         * for alignment calculations:\n+         *\/\n+\n+        width -= computeTrailingSpaceWidth(startOffset, length, lineRuns);\n+\n@@ -1017,0 +1025,37 @@\n+    private float computeTrailingSpaceWidth(int startOffset, int length, TextRun[] lineRuns) {\n+        char[] chars = getText();\n+        int trailingSpaces = 0;\n+\n+        for (int i = length + startOffset - 1; i >= startOffset; i--) {\n+            if (chars[i] != ' ') {\n+                break;\n+            }\n+\n+            trailingSpaces++;\n+        }\n+\n+        float trailingSpaceWidth = 0;\n+\n+        if (trailingSpaces > 0) {\n+            int lineRunCount = lineRuns.length;\n+\n+            for (int j = 0; j < lineRunCount; j++) {\n+                TextRun textRun = lineRuns[j];\n+                int runStart = textRun.getStart();\n+                int runEnd = textRun.getEnd();\n+\n+                for (int k = runStart; k < runEnd; k++) {\n+                    if (Character.isWhitespace(chars[k])) {\n+                        trailingSpaceWidth += textRun.positions[k];\n+\n+                        if (--trailingSpaces == 0) {\n+                            return trailingSpaceWidth;\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        return trailingSpaceWidth;\n+    }\n+\n@@ -1195,1 +1240,3 @@\n-                while (offset + 1 < runEnd && chars[offset] == ' ') {\n+\n+                \/\/ Don't take spaces into account at the preferred wrap index:\n+                while (offset + 1 < runEnd && Character.isWhitespace(chars[offset])) {\n@@ -1197,4 +1244,0 @@\n-                    \/* Preserve behaviour: only keep one white space in the line\n-                     * before wrapping. Needed API to allow change.\n-                     *\/\n-                    break;\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/text\/PrismTextLayout.java","additions":48,"deletions":5,"binary":false,"changes":53,"status":"modified"}]}