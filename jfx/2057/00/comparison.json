{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2025, Oracle and\/or its affiliates.\n+ * Copyright (c) 2023, 2026, Oracle and\/or its affiliates.\n@@ -49,0 +49,1 @@\n+import javafx.scene.control.ContextMenu;\n@@ -50,0 +51,1 @@\n+import javafx.scene.control.MenuBar;\n@@ -51,0 +53,1 @@\n+import javafx.scene.input.KeyCombination;\n@@ -56,0 +59,1 @@\n+import com.oracle.demo.richtext.editor.settings.EndKey;\n@@ -92,0 +96,1 @@\n+    public final FxAction paragraphStyle = new FxAction(this::showParagraphDialog);\n@@ -105,1 +110,0 @@\n-    private final RichTextArea control;\n@@ -111,2 +115,6 @@\n-    public Actions(RichTextArea control) {\n-        this.control = control;\n+    private final RichEditorToolbar toolbar;\n+    private final RichTextArea editor;\n+\n+    public Actions(RichEditorToolbar tb, RichTextArea ed) {\n+        this.toolbar = tb;\n+        this.editor = ed;\n@@ -115,2 +123,2 @@\n-        redo.disabledProperty().bind(control.redoableProperty().not());\n-        undo.disabledProperty().bind(control.undoableProperty().not());\n+        redo.disabledProperty().bind(editor.redoableProperty().not());\n+        undo.disabledProperty().bind(editor.undoableProperty().not());\n@@ -119,2 +127,2 @@\n-            return !control.isUndoable();\n-        }, control.undoableProperty()));\n+            return !editor.isUndoable();\n+        }, editor.undoableProperty()));\n@@ -123,2 +131,2 @@\n-            return !control.isRedoable();\n-        }, control.redoableProperty()));\n+            return !editor.isRedoable();\n+        }, editor.redoableProperty()));\n@@ -126,2 +134,1 @@\n-        highlightCurrentLine.selectedProperty().bindBidirectional(control.highlightCurrentParagraphProperty());\n-        wrapText.selectedProperty().bindBidirectional(control.wrapTextProperty());\n+        highlightCurrentLine.selectedProperty().bindBidirectional(editor.highlightCurrentParagraphProperty());\n@@ -129,3 +136,1 @@\n-        lineNumbers.selectedProperty().addListener((s,p,on) -> {\n-            control.setLeftDecorator(on ? new LineNumberDecorator() : null);\n-        });\n+        \/\/ editor\n@@ -133,1 +138,1 @@\n-        control.getModel().addListener(new StyledTextModel.Listener() {\n+        editor.getModel().addListener(new StyledTextModel.Listener() {\n@@ -140,2 +145,14 @@\n-        control.caretPositionProperty().addListener((x) -> {\n-            handleCaret();\n+        editor.insertStylesProperty().bind(Bindings.createObjectBinding(\n+            this::getInsertStyles,\n+            toolbar.bold.selectedProperty(),\n+            toolbar.fontFamily.getSelectionModel().selectedItemProperty(),\n+            toolbar.fontSize.getSelectionModel().selectedItemProperty(),\n+            toolbar.italic.selectedProperty(),\n+            toolbar.strikeThrough.selectedProperty(),\n+            toolbar.underline.selectedProperty(),\n+            toolbar.textColor.valueProperty()\n+        ));\n+\n+        editor.selectionProperty().addListener((p) -> {\n+            updateSourceStyles();\n+            handleSelection();\n@@ -143,0 +160,1 @@\n+        updateSourceStyles();\n@@ -144,2 +162,32 @@\n-        control.selectionProperty().addListener((p) -> {\n-            updateSourceStyles();\n+        \/\/ toolbar\n+\n+        toolbar.bold.selectedProperty().bindBidirectional(bold.selectedProperty());\n+        toolbar.bold.setOnAction((_) -> bold());\n+\n+        toolbar.italic.selectedProperty().bindBidirectional(italic.selectedProperty());\n+        toolbar.italic.setOnAction((_) -> italic());\n+\n+        toolbar.strikeThrough.selectedProperty().bindBidirectional(strikeThrough.selectedProperty());\n+        toolbar.strikeThrough.setOnAction((_) -> strikeThrough());\n+\n+        toolbar.underline.selectedProperty().bindBidirectional(underline.selectedProperty());\n+        toolbar.underline.setOnAction((_) -> underline());\n+\n+        paragraphStyle.attach(toolbar.paragraphButton);\n+        paragraphStyle.disabledProperty().bind(Bindings.createBooleanBinding(() -> {\n+            return editor.getSelection() == null;\n+        }, editor.selectionProperty()));\n+\n+        toolbar.lineNumbers.selectedProperty().bindBidirectional(lineNumbers.selectedProperty());\n+        toolbar.lineNumbers.setOnAction((_) -> focusEditor());\n+        lineNumbers.selectedProperty().addListener((s,p,on) -> {\n+            editor.setLeftDecorator(on ? new LineNumberDecorator() : null);\n+        });\n+\n+        toolbar.wrapText.selectedProperty().bindBidirectional(wrapText.selectedProperty());\n+        toolbar.wrapText.setOnAction((_) -> focusEditor());\n+        wrapText.selectedProperty().bindBidirectional(editor.wrapTextProperty());\n+\n+        toolbar.fontFamily.setOnAction((ev) -> {\n+            setFontFamily(toolbar.fontFamily.getSelectionModel().getSelectedItem());\n+            editor.requestFocus();\n@@ -148,5 +196,3 @@\n-        styles.addListener((s,p,a) -> {\n-            bold.setSelected(hasStyle(a, StyleAttributeMap.BOLD), false);\n-            italic.setSelected(hasStyle(a, StyleAttributeMap.ITALIC), false);\n-            strikeThrough.setSelected(hasStyle(a, StyleAttributeMap.STRIKE_THROUGH), false);\n-            underline.setSelected(hasStyle(a, StyleAttributeMap.UNDERLINE), false);\n+        toolbar.fontSize.setOnAction((ev) -> {\n+            setFontSize(toolbar.fontSize.getSelectionModel().getSelectedItem());\n+            editor.requestFocus();\n@@ -155,1 +201,16 @@\n-        updateSourceStyles();\n+        toolbar.textColor.setOnAction((ev) -> {\n+            setTextColor(toolbar.textColor.getValue());\n+            editor.requestFocus();\n+        });\n+\n+        toolbar.textStyle.setOnAction((ev) -> {\n+            updateTextStyle();\n+            editor.requestFocus();\n+        });\n+\n+        textStyleProperty().addListener((s,p,c) -> {\n+            toolbar.setTextStyle(c);\n+        });\n+\n+        \/\/ settings\n+        Settings.endKey.subscribe(this::setEndKey);\n@@ -162,1 +223,1 @@\n-        handleCaret();\n+        handleSelection();\n@@ -166,0 +227,65 @@\n+    public MenuBar createMenu() {\n+        MenuBar m = new MenuBar();\n+        \/\/ file\n+        FX.menu(m, \"File\");\n+        FX.item(m, \"New\", newDocument).setAccelerator(KeyCombination.keyCombination(\"shortcut+N\"));\n+        FX.item(m, \"Open...\", open);\n+        FX.separator(m);\n+        FX.item(m, \"Save\", save).setAccelerator(KeyCombination.keyCombination(\"shortcut+S\"));\n+        FX.item(m, \"Save As...\", saveAs).setAccelerator(KeyCombination.keyCombination(\"shortcut+A\"));\n+        FX.item(m, \"Quit\", this::quit);\n+\n+        \/\/ edit\n+        FX.menu(m, \"Edit\");\n+        FX.item(m, \"Undo\", undo);\n+        FX.item(m, \"Redo\", redo);\n+        FX.separator(m);\n+        FX.item(m, \"Cut\", cut);\n+        FX.item(m, \"Copy\", copy);\n+        FX.item(m, \"Paste\", paste);\n+        FX.item(m, \"Paste and Retain Style\", pasteUnformatted);\n+\n+        \/\/ format\n+        FX.menu(m, \"Format\");\n+        FX.item(m, \"Bold\", bold).setAccelerator(KeyCombination.keyCombination(\"shortcut+B\"));\n+        FX.item(m, \"Italic\", italic).setAccelerator(KeyCombination.keyCombination(\"shortcut+I\"));\n+        FX.item(m, \"Strike Through\", strikeThrough);\n+        FX.item(m, \"Underline\", underline).setAccelerator(KeyCombination.keyCombination(\"shortcut+U\"));\n+        FX.separator(m);\n+        FX.item(m, \"Paragraph...\", paragraphStyle);\n+\n+        \/\/ view\n+        FX.menu(m, \"View\");\n+        FX.checkItem(m, \"Highlight Current Paragraph\", highlightCurrentLine);\n+        FX.checkItem(m, \"Show Line Numbers\", lineNumbers);\n+        FX.checkItem(m, \"Wrap Text\", wrapText);\n+        \/\/ TODO line spacing\n+\n+        \/\/ tools\n+        FX.menu(m, \"Tools\");\n+        FX.item(m, \"Settings\", this::openSettings);\n+\n+        \/\/ help\n+        FX.menu(m, \"Help\");\n+        FX.item(m, \"About\"); \/\/ TODO\n+\n+        return m;\n+    }\n+\n+    public ContextMenu createContextMenu() {\n+        ContextMenu m = new ContextMenu();\n+        FX.item(m, \"Undo\", undo);\n+        FX.item(m, \"Redo\", redo);\n+        FX.separator(m);\n+        FX.item(m, \"Cut\", cut);\n+        FX.item(m, \"Copy\", copy);\n+        FX.item(m, \"Paste\", paste);\n+        FX.item(m, \"Paste and Retain Style\", pasteUnformatted);\n+        FX.separator(m);\n+        FX.item(m, \"Select All\", selectAll);\n+        FX.separator(m);\n+        \/\/ TODO Font...\n+        FX.item(m, \"Paragraph...\", paragraphStyle);\n+        return m;\n+    }\n+\n@@ -198,4 +324,2 @@\n-    private void handleCaret() {\n-        boolean sel = control.hasNonEmptySelection();\n-        StyleAttributeMap a = control.getActiveStyleAttributeMap();\n-\n+    private void handleSelection() {\n+        boolean sel = editor.hasNonEmptySelection();\n@@ -205,39 +329,2 @@\n-        bold.setSelected(a.getBoolean(StyleAttributeMap.BOLD), false);\n-        italic.setSelected(a.getBoolean(StyleAttributeMap.ITALIC), false);\n-        underline.setSelected(a.getBoolean(StyleAttributeMap.UNDERLINE), false);\n-        strikeThrough.setSelected(a.getBoolean(StyleAttributeMap.STRIKE_THROUGH), false);\n-    }\n-\n-    private void toggle(StyleAttribute<Boolean> attr) {\n-        TextPos start = control.getAnchorPosition();\n-        TextPos end = control.getCaretPosition();\n-        if (start == null) {\n-            return;\n-        } else if (start.equals(end)) {\n-            \/\/ apply to the whole paragraph\n-            int ix = start.index();\n-            start = TextPos.ofLeading(ix, 0);\n-            end = control.getParagraphEnd(ix);\n-        }\n-\n-        StyleAttributeMap a = control.getActiveStyleAttributeMap();\n-        boolean on = !a.getBoolean(attr);\n-        a = StyleAttributeMap.builder().set(attr, on).build();\n-        control.applyStyle(start, end, a);\n-    }\n-\n-    private <T> void apply(StyleAttribute<T> attr, T value) {\n-        TextPos start = control.getAnchorPosition();\n-        TextPos end = control.getCaretPosition();\n-        if (start == null) {\n-            return;\n-        } else if (start.equals(end)) {\n-            \/\/ apply to the whole paragraph\n-            int ix = start.index();\n-            start = TextPos.ofLeading(ix, 0);\n-            end = control.getParagraphEnd(ix);\n-        }\n-\n-        StyleAttributeMap a = control.getActiveStyleAttributeMap();\n-        a = StyleAttributeMap.builder().set(attr, value).build();\n-        control.applyStyle(start, end, a);\n+        StyleAttributeMap a = editor.getActiveStyleAttributeMap();\n+        toolbar.updateStyles(a);\n@@ -246,3 +333,2 @@\n-    \/\/ TODO need to bind selected item in the combo\n-    public void setFontSize(Integer size) {\n-        apply(StyleAttributeMap.FONT_SIZE, size.doubleValue());\n+    public void setFontSize(Double size) {\n+        apply(StyleAttributeMap.FONT_SIZE, size);\n@@ -251,2 +337,1 @@\n-    \/\/ TODO need to bind selected item in the combo\n-    public void setFontName(String name) {\n+    public void setFontFamily(String name) {\n@@ -260,1 +345,1 @@\n-    void newDocument() {\n+    private void newDocument() {\n@@ -264,1 +349,1 @@\n-        control.setModel(new RichTextModel());\n+        editor.setModel(new RichTextModel());\n@@ -268,1 +353,1 @@\n-    void open() {\n+    private void open() {\n@@ -287,1 +372,1 @@\n-                new ExceptionDialog(control, e).open();\n+                new ExceptionDialog(editor, e).open();\n@@ -292,1 +377,1 @@\n-    void save() {\n+    private void save() {\n@@ -305,1 +390,1 @@\n-            new ExceptionDialog(control, e).open();\n+            new ExceptionDialog(editor, e).open();\n@@ -309,1 +394,1 @@\n-    boolean saveAs() {\n+    private boolean saveAs() {\n@@ -317,1 +402,1 @@\n-                new ExceptionDialog(control, e).open();\n+                new ExceptionDialog(editor, e).open();\n@@ -342,1 +427,1 @@\n-            control.read(fmt, in);\n+            editor.read(fmt, in);\n@@ -344,1 +429,1 @@\n-            control.setEditable(f.canWrite());\n+            editor.setEditable(f.canWrite());\n@@ -352,1 +437,1 @@\n-            control.write(fmt, out);\n+            editor.write(fmt, out);\n@@ -358,2 +443,2 @@\n-    void copy() {\n-        control.copy();\n+    private void copy() {\n+        editor.copy();\n@@ -362,2 +447,2 @@\n-    void cut() {\n-        control.cut();\n+    private void cut() {\n+        editor.cut();\n@@ -366,2 +451,2 @@\n-    void paste() {\n-        control.paste();\n+    private void paste() {\n+        editor.paste();\n@@ -370,2 +455,2 @@\n-    void pasteUnformatted() {\n-        control.pastePlainText();\n+    private void pasteUnformatted() {\n+        editor.pastePlainText();\n@@ -374,2 +459,2 @@\n-    void selectAll() {\n-        control.selectAll();\n+    private void selectAll() {\n+        editor.selectAll();\n@@ -378,2 +463,2 @@\n-    void redo() {\n-       control.redo();\n+    private void redo() {\n+       editor.redo();\n@@ -382,2 +467,2 @@\n-    void undo() {\n-        control.undo();\n+    private void undo() {\n+        editor.undo();\n@@ -386,2 +471,2 @@\n-    void bold() {\n-        toggleStyle(StyleAttributeMap.BOLD);\n+    private void bold() {\n+        toggleStyle(bold, StyleAttributeMap.BOLD);\n@@ -390,2 +475,2 @@\n-    void italic() {\n-        toggleStyle(StyleAttributeMap.ITALIC);\n+    private void italic() {\n+        toggleStyle(italic, StyleAttributeMap.ITALIC);\n@@ -394,2 +479,2 @@\n-    void strikeThrough() {\n-        toggleStyle(StyleAttributeMap.STRIKE_THROUGH);\n+    private void strikeThrough() {\n+        toggleStyle(strikeThrough, StyleAttributeMap.STRIKE_THROUGH);\n@@ -398,2 +483,2 @@\n-    void underline() {\n-        toggleStyle(StyleAttributeMap.UNDERLINE);\n+    private void underline() {\n+        toggleStyle(underline, StyleAttributeMap.UNDERLINE);\n@@ -402,3 +487,3 @@\n-    private void toggleStyle(StyleAttribute<Boolean> attr) {\n-        TextPos start = control.getAnchorPosition();\n-        TextPos end = control.getCaretPosition();\n+    private <T> void apply(StyleAttribute<T> attr, T value) {\n+        TextPos start = editor.getAnchorPosition();\n+        TextPos end = editor.getCaretPosition();\n@@ -408,4 +493,13 @@\n-            \/\/ apply to the whole paragraph\n-            int ix = start.index();\n-            start = TextPos.ofLeading(ix, 0);\n-            end = control.getParagraphEnd(ix);\n+            return;\n+        }\n+\n+        StyleAttributeMap a = editor.getActiveStyleAttributeMap();\n+        a = StyleAttributeMap.builder().set(attr, value).build();\n+        editor.applyStyle(start, end, a);\n+    }\n+\n+    private void toggleStyle(FxAction action, StyleAttribute<Boolean> attr) {\n+        TextPos start = editor.getAnchorPosition();\n+        TextPos end = editor.getCaretPosition();\n+        if (start == null) {\n+            return;\n@@ -414,1 +508,1 @@\n-        StyleAttributeMap a = control.getActiveStyleAttributeMap();\n+        StyleAttributeMap a = editor.getActiveStyleAttributeMap();\n@@ -416,3 +510,11 @@\n-        a = StyleAttributeMap.builder().set(attr, on).build();\n-        control.applyStyle(start, end, a);\n-        updateSourceStyles();\n+\n+        if (start.equals(end)) {\n+            if(on != action.isSelected()) {\n+                action.setSelected(on, false);\n+            }\n+        } else {\n+            a = StyleAttributeMap.builder().set(attr, on).build();\n+            editor.applyStyle(start, end, a);\n+            updateSourceStyles();\n+        }\n+        focusEditor();\n@@ -422,2 +524,2 @@\n-        TextPos start = control.getAnchorPosition();\n-        TextPos end = control.getCaretPosition();\n+        TextPos start = editor.getAnchorPosition();\n+        TextPos end = editor.getCaretPosition();\n@@ -427,1 +529,1 @@\n-            TextStyle cur = Styles.guessTextStyle(control.getActiveStyleAttributeMap());\n+            TextStyle cur = Styles.guessTextStyle(editor.getActiveStyleAttributeMap());\n@@ -434,1 +536,1 @@\n-            end = control.getParagraphEnd(ix);\n+            end = editor.getParagraphEnd(ix);\n@@ -438,1 +540,1 @@\n-        control.applyStyle(start, end, a);\n+        editor.applyStyle(start, end, a);\n@@ -453,1 +555,1 @@\n-        SelectionSegment sel = control.getSelection();\n+        SelectionSegment sel = editor.getSelection();\n@@ -457,1 +559,1 @@\n-        return control.getActiveStyleAttributeMap();\n+        return editor.getActiveStyleAttributeMap();\n@@ -460,1 +562,1 @@\n-    static FileChooser.ExtensionFilter filterAll() {\n+    private static FileChooser.ExtensionFilter filterAll() {\n@@ -464,1 +566,1 @@\n-    static FileChooser.ExtensionFilter filterRich() {\n+    private static FileChooser.ExtensionFilter filterRich() {\n@@ -468,1 +570,1 @@\n-    static FileChooser.ExtensionFilter filterRtf() {\n+    private static FileChooser.ExtensionFilter filterRtf() {\n@@ -472,1 +574,1 @@\n-    static FileChooser.ExtensionFilter filterTxt() {\n+    private static FileChooser.ExtensionFilter filterTxt() {\n@@ -543,1 +645,75 @@\n-        return FX.getParentWindow(control);\n+        return FX.getParentWindow(editor);\n+    }\n+\n+    private void updateTextStyle() {\n+        TextStyle st = toolbar.textStyle.getSelectionModel().getSelectedItem();\n+        if (st != null) {\n+            setTextStyle(st);\n+        }\n+    }\n+\n+    private void setEndKey(EndKey v) {\n+        switch(v) {\n+        case END_OF_LINE:\n+            editor.getInputMap().restoreDefaultFunction(RichTextArea.Tag.MOVE_TO_LINE_END);\n+            break;\n+        case END_OF_TEXT:\n+            editor.getInputMap().registerFunction(RichTextArea.Tag.MOVE_TO_LINE_END, this::moveToEndOfText);\n+            break;\n+        }\n+    }\n+\n+    \/\/ this is an illustration.  we could publish the MOVE_TO_END_OF_TEXT_ON_LINE function tag\n+    private void moveToEndOfText() {\n+        TextPos p = editor.getCaretPosition();\n+        if (p != null) {\n+            editor.executeDefault(RichTextArea.Tag.MOVE_TO_LINE_END);\n+            TextPos p2 = editor.getCaretPosition();\n+            if (p2 != null) {\n+                String text = editor.getPlainText(p2.index());\n+                int ix = findLastText(text, p2.charIndex());\n+                if (ix > p.charIndex()) {\n+                    editor.select(TextPos.ofLeading(p2.index(), ix));\n+                }\n+            }\n+        }\n+    }\n+\n+    private static int findLastText(String text, int start) {\n+        int i = start - 1;\n+        while (i >= 0) {\n+            char c = text.charAt(i);\n+            if (!Character.isWhitespace(c)) {\n+                return i + 1;\n+            }\n+            --i;\n+        }\n+        return i;\n+    }\n+\n+    private StyleAttributeMap getInsertStyles() {\n+        StyleAttributeMap.Builder b = StyleAttributeMap.builder();\n+        b.\n+            setBold(bold.isSelected()).\n+            setFontFamily(toolbar.fontFamily.getSelectionModel().getSelectedItem()).\n+            setItalic(italic.isSelected()).\n+            setStrikeThrough(strikeThrough.isSelected()).\n+            setTextColor(toolbar.textColor.getValue()).\n+            setUnderline(underline.isSelected());\n+        if (toolbar.fontSize.getSelectionModel().getSelectedItem() != null) {\n+            b.setFontSize(toolbar.fontSize.getSelectionModel().getSelectedItem());\n+        }\n+        return b.build();\n+    }\n+\n+    private void focusEditor() {\n+        editor.requestFocus();\n+    }\n+\n+    private void showParagraphDialog() {\n+        new ParagraphDialog(editor).show();\n+    }\n+\n+    private void openSettings() {\n+        Window w = FX.getParentWindow(editor);\n+        new SettingsWindow(w).show();\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/editor\/Actions.java","additions":307,"deletions":131,"binary":false,"changes":438,"status":"modified"},{"patch":"@@ -0,0 +1,284 @@\n+\/*\n+ * Copyright (c) 2026, Oracle and\/or its affiliates.\n+ * All rights reserved. Use is subject to license terms.\n+ *\n+ * This file is available and licensed under the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ *  - Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *  - Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and\/or other materials provided with the distribution.\n+ *  - Neither the name of Oracle Corporation nor the names of its\n+ *    contributors may be used to endorse or promote products derived\n+ *    from this software without specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n+ * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+\n+package com.oracle.demo.richtext.editor;\n+\n+import javafx.geometry.Insets;\n+import javafx.scene.Scene;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonBar;\n+import javafx.scene.control.ButtonBar.ButtonData;\n+import javafx.scene.control.ColorPicker;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.RadioButton;\n+import javafx.scene.control.Separator;\n+import javafx.scene.control.ToggleGroup;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.BorderPane;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Priority;\n+import javafx.scene.text.TextAlignment;\n+import javafx.stage.Modality;\n+import javafx.stage.Stage;\n+import com.oracle.demo.richtext.util.FX;\n+import jfx.incubator.scene.control.richtext.RichTextArea;\n+import jfx.incubator.scene.control.richtext.TextPos;\n+import jfx.incubator.scene.control.richtext.model.ParagraphDirection;\n+import jfx.incubator.scene.control.richtext.model.StyleAttributeMap;\n+\n+\/**\n+ * Rich Editor Demo paragraph formatting dialog.\n+ *\n+ * @author Andy Goryachev\n+ *\/\n+public class ParagraphDialog extends Stage {\n+    private final RichTextArea editor;\n+    private final ColorPicker background;\n+    private final ComboBox<TextAlignment> alignment;\n+    private final ComboBox<String> bullet;\n+    private final RadioButton ltrButton;\n+    private final RadioButton rtlButton;\n+    private final ComboBox<Double> beforeText;\n+    private final ComboBox<Double> afterText;\n+    private final ComboBox<Double> spaceAbove;\n+    private final ComboBox<Double> spaceBelow;\n+    \/\/ TODO FIRST_LINE_INDENT (* broken)\n+\n+    public ParagraphDialog(RichTextArea editor) {\n+        this.editor = editor;\n+        initOwner(FX.getParentWindow(editor));\n+        initModality(Modality.APPLICATION_MODAL);\n+\n+        \/\/ FIX cannot set <null> value\n+        background = new ColorPicker();\n+        background.setStyle(\"-fx-color-label-visible: false;\");\n+        background.setValue(null);\n+\n+        alignment = new ComboBox<>();\n+        alignment.getItems().setAll(TextAlignment.values());\n+        alignment.setConverter(FX.converter(this::toString));\n+\n+        bullet = new ComboBox<>();\n+        bullet.setEditable(true);\n+        bullet.getItems().setAll(\n+            null,\n+            \"‚Ä¢\",\n+            \"‚óã\",\n+            \"‚óè\",\n+            \"‚òë\",\n+            \"‚òê\",\n+            \"‚¶æ\",\n+            \"‚¶ø\",\n+            \"‚óâ\",\n+            \"‚Ä£\"\n+        );\n+\n+        beforeText = combo();\n+        afterText = combo();\n+        spaceAbove = combo();\n+        spaceBelow = combo();\n+\n+        ltrButton = new RadioButton(\"Left-to-right\");\n+        rtlButton = new RadioButton(\"Right-to-left\");\n+        new ToggleGroup().getToggles().setAll(ltrButton, rtlButton);\n+\n+        Button tabsButton = new Button(\"Tabs...\");\n+        tabsButton.setDisable(true); \/\/ TODO\n+        ButtonBar.setButtonData(tabsButton, ButtonData.LEFT);\n+\n+        Button cancelButton = new Button(\"Cancel\");\n+        cancelButton.setOnAction((_) -> hide());\n+        ButtonBar.setButtonData(cancelButton, ButtonData.CANCEL_CLOSE);\n+\n+        Button okButton = new Button(\"OK\");\n+        okButton.setOnAction((_) -> commit());\n+        okButton.setDefaultButton(true);\n+        ButtonBar.setButtonData(okButton, ButtonData.OK_DONE);\n+\n+        GridPane g = new GridPane();\n+        g.getColumnConstraints().setAll(\n+            FX.cc().fixed(20),\n+            FX.cc(),\n+            FX.cc().fill()\n+        );\n+        g.setHgap(10);\n+        g.setVgap(10);\n+        g.setMaxWidth(Double.MAX_VALUE);\n+        int r = 0;\n+        g.add(heading(\"General\"), 0, r, 3, 1);\n+        r++;\n+        g.add(new Label(\"Background:\"), 1, r);\n+        g.add(background, 2, r);\n+        r++;\n+        g.add(new Label(\"Bullet:\"), 1, r);\n+        g.add(bullet, 2, r);\n+        r++;\n+        g.add(new Label(\"Alignment:\"), 1, r);\n+        g.add(alignment, 2, r);\n+        r++;\n+        g.add(new Label(\"Direction:\"), 1, r);\n+        g.add(new HBox(10, ltrButton, rtlButton), 2, r);\n+        r++;\n+        g.add(separator(), 0, r, 3, 1);\n+        r++;\n+        g.add(heading(\"Indentation\"), 0, r, 3, 1);\n+        r++;\n+        g.add(new Label(\"Before Text:\"), 1, r);\n+        g.add(beforeText, 2, r);\n+        r++;\n+        g.add(new Label(\"After Text:\"), 1, r);\n+        g.add(afterText, 2, r);\n+        r++;\n+        g.add(separator(), 0, r, 3, 1);\n+        r++;\n+        g.add(heading(\"Spacing\"), 0, r, 3, 1);\n+        r++;\n+        g.add(new Label(\"Before:\"), 1, r);\n+        g.add(spaceAbove, 2, r);\n+        r++;\n+        g.add(new Label(\"After:\"), 1, r);\n+        g.add(spaceBelow, 2, r);\n+\n+        ButtonBar bb = new ButtonBar();\n+        bb.getButtons().setAll(\n+            tabsButton,\n+            cancelButton,\n+            okButton\n+        );\n+\n+        BorderPane bp = new BorderPane();\n+        bp.setPadding(new Insets(10));\n+        bp.setCenter(g);\n+        bp.setBottom(bb);\n+\n+        setScene(new Scene(bp, 400, 500));\n+        setTitle(\"Paragraph\");\n+        addEventHandler(KeyEvent.KEY_PRESSED, (ev) -> {\n+            if (ev.getCode() == KeyCode.ESCAPE) {\n+                hide();\n+            }\n+        });\n+\n+        \/\/ TODO center in window\n+\n+        load();\n+    }\n+\n+    private String toString(TextAlignment a) {\n+        if (a == null) {\n+            return \"\";\n+        }\n+        return switch (a) {\n+        case CENTER -> \"Center\";\n+        case JUSTIFY -> \"Justify\";\n+        case LEFT -> \"Left\";\n+        case RIGHT -> \"Right\";\n+        };\n+    }\n+\n+    private static Label heading(String text) {\n+        Label n = new Label(text);\n+        n.setStyle(\"-fx-font-weight:bold;\");\n+        n.setMaxWidth(Double.MAX_VALUE);\n+        GridPane.setHgrow(n, Priority.ALWAYS);\n+        return n;\n+    }\n+\n+    private static Separator separator() {\n+        Separator n = new Separator();\n+        n.setMaxWidth(Double.MAX_VALUE);\n+        GridPane.setHgrow(n, Priority.ALWAYS);\n+        return n;\n+    }\n+\n+    private static ComboBox<Double> combo() {\n+        ComboBox<Double> c = new ComboBox<>();\n+        c.getItems().setAll(\n+            null,\n+            0.0,\n+            10.0,\n+            50.0,\n+            100.0\n+        );\n+        c.setEditable(true);\n+        c.setConverter(FX.numberConverter());\n+        return c;\n+    }\n+\n+    private void load() {\n+        StyleAttributeMap a = editor.getActiveStyleAttributeMap();\n+\n+        background.setValue(a.getBackground());\n+        bullet.setValue(a.getBullet());\n+\n+        FX.select(alignment, a.getTextAlignment(), TextAlignment.LEFT);\n+\n+        ParagraphDirection dir = a.getParagraphDirection();\n+        if(dir == null) {\n+            dir = ParagraphDirection.LEFT_TO_RIGHT;\n+        }\n+        ltrButton.setSelected(dir == ParagraphDirection.LEFT_TO_RIGHT);\n+        rtlButton.setSelected(dir == ParagraphDirection.RIGHT_TO_LEFT);\n+        beforeText.setValue(a.getSpaceLeft());\n+        afterText.setValue(a.getSpaceRight());\n+        spaceAbove.setValue(a.getSpaceAbove());\n+        spaceBelow.setValue(a.getSpaceBelow());\n+    }\n+\n+    private StyleAttributeMap getAttributes() {\n+        StyleAttributeMap.Builder b = StyleAttributeMap.builder();\n+        b.setBackground(background.getValue());\n+        b.setBullet(bullet.getValue());\n+        b.setParagraphDirection(rtlButton.isSelected() ? ParagraphDirection.RIGHT_TO_LEFT : ParagraphDirection.LEFT_TO_RIGHT);\n+        b.setTextAlignment(alignment.getSelectionModel().getSelectedItem());\n+        \/\/ perhaps Builder.setXXX(double) should accept a Double instead\n+        b.set(StyleAttributeMap.SPACE_LEFT, beforeText.getValue());\n+        b.set(StyleAttributeMap.SPACE_RIGHT, afterText.getValue());\n+        b.set(StyleAttributeMap.SPACE_ABOVE, spaceAbove.getValue());\n+        b.set(StyleAttributeMap.SPACE_BELOW, spaceBelow.getValue());\n+        return b.build();\n+    }\n+\n+    private void commit() {\n+        TextPos p = editor.getCaretPosition();\n+        if (p == null) {\n+            \/\/ TODO default attributes?\n+        } else {\n+            StyleAttributeMap a = getAttributes();\n+            editor.applyStyle(p, p, a);\n+        }\n+        hide();\n+    }\n+}\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/editor\/ParagraphDialog.java","additions":284,"deletions":0,"binary":false,"changes":284,"status":"added"},{"patch":"@@ -1,231 +0,0 @@\n-\/*\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates.\n- * All rights reserved. Use is subject to license terms.\n- *\n- * This file is available and licensed under the following license:\n- *\n- * Redistribution and use in source and binary forms, with or without\n- * modification, are permitted provided that the following conditions\n- * are met:\n- *\n- *  - Redistributions of source code must retain the above copyright\n- *    notice, this list of conditions and the following disclaimer.\n- *  - Redistributions in binary form must reproduce the above copyright\n- *    notice, this list of conditions and the following disclaimer in\n- *    the documentation and\/or other materials provided with the distribution.\n- *  - Neither the name of Oracle Corporation nor the names of its\n- *    contributors may be used to endorse or promote products derived\n- *    from this software without specific prior written permission.\n- *\n- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n- * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n- * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n- * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n- * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n- * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n- * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n- * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n- *\/\n-\n-package com.oracle.demo.richtext.editor;\n-\n-import java.util.List;\n-import javafx.scene.control.ColorPicker;\n-import javafx.scene.control.ComboBox;\n-import javafx.scene.control.ContextMenu;\n-import javafx.scene.control.ToolBar;\n-import javafx.scene.input.KeyCode;\n-import javafx.scene.layout.BorderPane;\n-import javafx.scene.text.Font;\n-import com.oracle.demo.richtext.common.TextStyle;\n-import com.oracle.demo.richtext.editor.settings.EndKey;\n-import com.oracle.demo.richtext.util.FX;\n-import jfx.incubator.scene.control.input.KeyBinding;\n-import jfx.incubator.scene.control.richtext.RichTextArea;\n-import jfx.incubator.scene.control.richtext.TextPos;\n-\n-\/**\n- * Main Panel.\n- *\n- * @author Andy Goryachev\n- *\/\n-public class RichEditorDemoPane extends BorderPane {\n-    public final RichTextArea editor;\n-    public final Actions actions;\n-    private final ComboBox<String> fontName;\n-    private final ComboBox<Integer> fontSize;\n-    private final ColorPicker textColor;\n-    private final ComboBox<TextStyle> textStyle;\n-\n-    public RichEditorDemoPane() {\n-        FX.name(this, \"RichEditorDemoPane\");\n-\n-        editor = new RichTextArea();\n-        \/\/ custom function\n-        editor.getInputMap().register(KeyBinding.shortcut(KeyCode.W), () -> {\n-            System.out.println(\"Custom function: W key is pressed\");\n-        });\n-\n-        actions = new Actions(editor);\n-        editor.setContextMenu(createContextMenu());\n-\n-        fontName = new ComboBox<>();\n-        fontName.getItems().setAll(collectFonts());\n-        fontName.setOnAction((ev) -> {\n-            actions.setFontName(fontName.getSelectionModel().getSelectedItem());\n-        });\n-\n-        fontSize = new ComboBox<>();\n-        fontSize.getItems().setAll(\n-            7,\n-            8,\n-            9,\n-            10,\n-            11,\n-            12,\n-            13,\n-            14,\n-            16,\n-            18,\n-            20,\n-            22,\n-            24,\n-            28,\n-            32,\n-            36,\n-            48,\n-            72,\n-            96,\n-            128\n-        );\n-        fontSize.setOnAction((ev) -> {\n-            actions.setFontSize(fontSize.getSelectionModel().getSelectedItem());\n-        });\n-\n-        textColor = new ColorPicker();\n-        \/\/ TODO save\/restore custom colors\n-        FX.tooltip(textColor, \"Text Color\");\n-        \/\/ FIX there is no API for this!  why is this a property of a skin, not the control??\n-        \/\/ https:\/\/stackoverflow.com\/questions\/21246137\/remove-text-from-colour-picker\n-        textColor.setStyle(\"-fx-color-label-visible: false ;\");\n-        textColor.setOnAction((ev) -> {\n-            actions.setTextColor(textColor.getValue());\n-        });\n-\n-        textStyle = new ComboBox<>();\n-        textStyle.getItems().setAll(TextStyle.values());\n-        textStyle.setConverter(TextStyle.converter());\n-        textStyle.setOnAction((ev) -> {\n-            updateTextStyle();\n-            editor.requestFocus();\n-        });\n-\n-        setTop(createToolBar());\n-        setCenter(editor);\n-\n-        actions.textStyleProperty().addListener((s,p,c) -> {\n-            setTextStyle(c);\n-        });\n-\n-        Settings.endKey.subscribe(this::setEndKey);\n-    }\n-\n-    private ToolBar createToolBar() {\n-        ToolBar t = new ToolBar();\n-        FX.add(t, fontName);\n-        FX.add(t, fontSize);\n-        FX.add(t, textColor);\n-        FX.space(t);\n-        \/\/ TODO background\n-        \/\/ TODO alignment\n-        \/\/ TODO bullet\n-        \/\/ TODO space left (indent left, indent right)\n-        \/\/ TODO line spacing\n-        FX.toggleButton(t, \"ùêÅ\", \"Bold text\", actions.bold);\n-        FX.toggleButton(t, \"ùêº\", \"Bold text\", actions.italic);\n-        FX.toggleButton(t, \"S\\u0336\", \"Strike through text\", actions.strikeThrough);\n-        FX.toggleButton(t, \"U\\u0332\", \"Underline text\", actions.underline);\n-        FX.add(t, textStyle);\n-        FX.space(t);\n-        FX.toggleButton(t, \"W\", \"Wrap Text\", actions.wrapText);\n-        \/\/ TODO line numbers\n-        return t;\n-    }\n-\n-    private ContextMenu createContextMenu() {\n-        ContextMenu m = new ContextMenu();\n-        FX.item(m, \"Undo\", actions.undo);\n-        FX.item(m, \"Redo\", actions.redo);\n-        FX.separator(m);\n-        FX.item(m, \"Cut\", actions.cut);\n-        FX.item(m, \"Copy\", actions.copy);\n-        FX.item(m, \"Paste\", actions.paste);\n-        FX.item(m, \"Paste and Retain Style\", actions.pasteUnformatted);\n-        FX.separator(m);\n-        FX.item(m, \"Select All\", actions.selectAll);\n-        FX.separator(m);\n-        \/\/ TODO under \"Style\" submenu?\n-        FX.item(m, \"Bold\", actions.bold);\n-        FX.item(m, \"Italic\", actions.italic);\n-        FX.item(m, \"Strike Through\", actions.strikeThrough);\n-        FX.item(m, \"Underline\", actions.underline);\n-        return m;\n-    }\n-\n-    private static List<String> collectFonts() {\n-        return Font.getFamilies();\n-    }\n-\n-    private void updateTextStyle() {\n-        TextStyle st = textStyle.getSelectionModel().getSelectedItem();\n-        if (st != null) {\n-            actions.setTextStyle(st);\n-        }\n-    }\n-\n-    public void setTextStyle(TextStyle v) {\n-        textStyle.setValue(v);\n-    }\n-\n-    void setEndKey(EndKey v) {\n-        switch(v) {\n-        case END_OF_LINE:\n-            editor.getInputMap().restoreDefaultFunction(RichTextArea.Tag.MOVE_TO_LINE_END);\n-            break;\n-        case END_OF_TEXT:\n-            editor.getInputMap().registerFunction(RichTextArea.Tag.MOVE_TO_LINE_END, this::moveToEndOfText);\n-            break;\n-        }\n-    }\n-\n-    \/\/ this is an illustration.  we could publish the MOVE_TO_END_OF_TEXT_ON_LINE function tag\n-    void moveToEndOfText() {\n-        TextPos p = editor.getCaretPosition();\n-        if (p != null) {\n-            editor.executeDefault(RichTextArea.Tag.MOVE_TO_LINE_END);\n-            TextPos p2 = editor.getCaretPosition();\n-            if (p2 != null) {\n-                String text = editor.getPlainText(p2.index());\n-                int ix = findLastText(text, p2.charIndex());\n-                if (ix > p.charIndex()) {\n-                    editor.select(TextPos.ofLeading(p2.index(), ix));\n-                }\n-            }\n-        }\n-    }\n-\n-    private static int findLastText(String text, int start) {\n-        int i = start - 1;\n-        while (i >= 0) {\n-            char c = text.charAt(i);\n-            if (!Character.isWhitespace(c)) {\n-                return i + 1;\n-            }\n-            --i;\n-        }\n-        return i;\n-    }\n-}\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/editor\/RichEditorDemoPane.java","additions":0,"deletions":231,"binary":false,"changes":231,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates.\n+ * Copyright (c) 2023, 2026, Oracle and\/or its affiliates.\n@@ -36,1 +36,1 @@\n-import javafx.application.Platform;\n+import javafx.beans.binding.Bindings;\n@@ -39,0 +39,1 @@\n+import javafx.scene.control.ContextMenu;\n@@ -41,0 +42,1 @@\n+import javafx.scene.input.KeyCode;\n@@ -45,1 +47,0 @@\n-import com.oracle.demo.richtext.rta.RichTextAreaWindow;\n@@ -47,0 +48,1 @@\n+import jfx.incubator.scene.control.input.KeyBinding;\n@@ -56,1 +58,3 @@\n-    public final RichEditorDemoPane pane;\n+    public final RichEditorToolbar toolbar;\n+    public final RichTextArea editor;\n+    public final Actions actions;\n@@ -60,1 +64,7 @@\n-        pane = new RichEditorDemoPane();\n+        editor = new RichTextArea();\n+        toolbar = new RichEditorToolbar();\n+\n+        \/\/ example of a custom function\n+        editor.getInputMap().register(KeyBinding.shortcut(KeyCode.W), () -> {\n+            System.out.println(\"Custom function: W key is pressed\");\n+        });\n@@ -65,0 +75,6 @@\n+        actions = new Actions(toolbar, editor);\n+\n+        BorderPane cp = new BorderPane();\n+        cp.setTop(toolbar);\n+        cp.setCenter(editor);\n+\n@@ -66,2 +82,2 @@\n-        bp.setTop(createMenu());\n-        bp.setCenter(pane);\n+        bp.setTop(actions.createMenu());\n+        bp.setCenter(cp);\n@@ -76,9 +92,0 @@\n-        pane.editor.caretPositionProperty().addListener((x) -> {\n-            updateStatus();\n-        });\n-        pane.actions.modifiedProperty().addListener((x) -> {\n-            updateTitle();\n-        });\n-        pane.actions.fileNameProperty().addListener((x) -> {\n-            updateTitle();\n-        });\n@@ -86,1 +93,1 @@\n-            if (pane.actions.askToSave()) {\n+            if (actions.askToSave()) {\n@@ -91,49 +98,17 @@\n-        updateStatus();\n-        updateTitle();\n-    }\n-\n-    private MenuBar createMenu() {\n-        Actions actions = pane.actions;\n-        MenuBar m = new MenuBar();\n-        \/\/ file\n-        FX.menu(m, \"File\");\n-        FX.item(m, \"New\", actions.newDocument).setAccelerator(KeyCombination.keyCombination(\"shortcut+N\"));\n-        FX.item(m, \"Open...\", actions.open);\n-        FX.separator(m);\n-        FX.item(m, \"Save\", actions.save).setAccelerator(KeyCombination.keyCombination(\"shortcut+S\"));\n-        FX.item(m, \"Save As...\", actions.saveAs).setAccelerator(KeyCombination.keyCombination(\"shortcut+A\"));\n-        FX.item(m, \"Quit\", actions::quit);\n-\n-        \/\/ edit\n-        FX.menu(m, \"Edit\");\n-        FX.item(m, \"Undo\", actions.undo);\n-        FX.item(m, \"Redo\", actions.redo);\n-        FX.separator(m);\n-        FX.item(m, \"Cut\", actions.cut);\n-        FX.item(m, \"Copy\", actions.copy);\n-        FX.item(m, \"Paste\", actions.paste);\n-        FX.item(m, \"Paste and Retain Style\", actions.pasteUnformatted);\n-\n-        \/\/ format\n-        FX.menu(m, \"Format\");\n-        FX.item(m, \"Bold\", actions.bold).setAccelerator(KeyCombination.keyCombination(\"shortcut+B\"));\n-        FX.item(m, \"Italic\", actions.italic).setAccelerator(KeyCombination.keyCombination(\"shortcut+I\"));\n-        FX.item(m, \"Strike Through\", actions.strikeThrough);\n-        FX.item(m, \"Underline\", actions.underline).setAccelerator(KeyCombination.keyCombination(\"shortcut+U\"));\n-\n-        \/\/ view\n-        FX.menu(m, \"View\");\n-        FX.checkItem(m, \"Highlight Current Paragraph\", actions.highlightCurrentLine);\n-        FX.checkItem(m, \"Show Line Numbers\", actions.lineNumbers);\n-        FX.checkItem(m, \"Wrap Text\", actions.wrapText);\n-        \/\/ TODO line spacing\n-\n-        \/\/ view\n-        FX.menu(m, \"Tools\");\n-        FX.item(m, \"Settings\", this::openSettings);\n-\n-        \/\/ help\n-        FX.menu(m, \"Help\");\n-        FX.item(m, \"About\"); \/\/ TODO\n-\n-        return m;\n+        status.textProperty().bind(Bindings.createStringBinding(\n+            () -> {\n+                return statusString(editor.getCaretPosition());\n+            },\n+            editor.caretPositionProperty()\n+        ));\n+        titleProperty().bind(Bindings.createStringBinding(\n+            () -> {\n+                return titleString(actions.getFile(), actions.isModified());\n+            },\n+            actions.modifiedProperty(),\n+            actions.fileNameProperty()\n+        ));\n+\n+        editor.setContextMenu(actions.createContextMenu());\n+        editor.requestFocus();\n+        editor.select(TextPos.ZERO);\n@@ -142,9 +117,3 @@\n-    private void updateStatus() {\n-        RichTextArea ed = pane.editor;\n-        TextPos p = ed.getCaretPosition();\n-\n-        StringBuilder sb = new StringBuilder();\n-\n-        if (p != null) {\n-            sb.append(\" Line: \").append(p.index() + 1);\n-            sb.append(\"  Column: \").append(p.offset() + 1);\n+    private String statusString(TextPos p) {\n+        if (p == null) {\n+            return null;\n@@ -152,2 +121,4 @@\n-\n-        status.setText(sb.toString());\n+        StringBuilder sb = new StringBuilder();\n+        sb.append(\" Line: \").append(p.index() + 1);\n+        sb.append(\"  Column: \").append(p.offset() + 1);\n+        return sb.toString();\n@@ -156,4 +127,1 @@\n-    private void updateTitle() {\n-        File f = pane.actions.getFile();\n-        boolean modified = pane.actions.isModified();\n-\n+    private String titleString(File f, boolean modified) {\n@@ -169,5 +137,1 @@\n-        setTitle(sb.toString());\n-    }\n-\n-    void openSettings() {\n-        new SettingsWindow(this).show();\n+        return sb.toString();\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/editor\/RichEditorDemoWindow.java","additions":50,"deletions":86,"binary":false,"changes":136,"status":"modified"},{"patch":"@@ -0,0 +1,154 @@\n+\/*\n+ * Copyright (c) 2023, 2026, Oracle and\/or its affiliates.\n+ * All rights reserved. Use is subject to license terms.\n+ *\n+ * This file is available and licensed under the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ *  - Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *  - Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and\/or other materials provided with the distribution.\n+ *  - Neither the name of Oracle Corporation nor the names of its\n+ *    contributors may be used to endorse or promote products derived\n+ *    from this software without specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n+ * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+\n+package com.oracle.demo.richtext.editor;\n+\n+import java.util.List;\n+import javafx.geometry.Insets;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ColorPicker;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.control.ToolBar;\n+import javafx.scene.layout.BorderPane;\n+import javafx.scene.text.Font;\n+import com.oracle.demo.richtext.common.TextStyle;\n+import com.oracle.demo.richtext.util.FX;\n+import jfx.incubator.scene.control.richtext.model.StyleAttribute;\n+import jfx.incubator.scene.control.richtext.model.StyleAttributeMap;\n+\n+\/**\n+ * Rich editor toolbar.\n+ *\n+ * @author Andy Goryachev\n+ *\/\n+public class RichEditorToolbar extends BorderPane {\n+    public final ComboBox<String> fontFamily = new ComboBox<>();\n+    public final ComboBox<Double> fontSize = new ComboBox<>();\n+    public final ColorPicker textColor = new ColorPicker();\n+    public final ComboBox<TextStyle> textStyle = new ComboBox<>();\n+    public final ToggleButton bold;\n+    public final ToggleButton italic;\n+    public final ToggleButton strikeThrough;\n+    public final ToggleButton underline;\n+    public final Button paragraphButton;\n+    public final ToggleButton lineNumbers;\n+    public final ToggleButton wrapText;\n+\n+    public RichEditorToolbar() {\n+        FX.name(this, \"RichEditorToolbar\");\n+        setStyle(\"-fx-spacing: 1px;\");\n+        setPadding(new Insets(2, 2, 2, 2));\n+\n+        fontFamily.getItems().setAll(collectFonts());\n+        fontFamily.setMaxWidth(170);\n+        fontFamily.setPrefWidth(170);\n+\n+        fontSize.setEditable(true);\n+        fontSize.setMaxWidth(70);\n+        fontSize.setPrefWidth(70);\n+        fontSize.setConverter(FX.numberConverter());\n+        fontSize.getItems().setAll(\n+            8.0,\n+            9.0,\n+            10.0,\n+            11.0,\n+            12.0,\n+            13.0,\n+            14.0,\n+            16.0,\n+            18.0,\n+            24.0,\n+            32.0,\n+            48.0,\n+            96.0\n+        );\n+\n+        \/\/ TODO save\/restore custom colors\n+        FX.tooltip(textColor, \"Text Color\");\n+        \/\/ there is no API for this!  why is this a property of a skin, not the control??\n+        \/\/ https:\/\/stackoverflow.com\/questions\/21246137\/remove-text-from-colour-picker\n+        textColor.setStyle(\"-fx-color-label-visible: false;\");\n+        textColor.setMaxHeight(Double.MAX_VALUE);\n+\n+        textStyle.getItems().setAll(TextStyle.values());\n+        textStyle.setConverter(TextStyle.converter());\n+\n+        ToolBar toolbar = new ToolBar();\n+        FX.add(toolbar, fontFamily);\n+        FX.add(toolbar, fontSize);\n+        FX.add(toolbar, textColor);\n+        FX.space(toolbar);\n+        \/\/ TODO background\n+        \/\/ TODO alignment\n+        \/\/ TODO bullet\n+        \/\/ TODO space left (indent left, indent right)\n+        \/\/ TODO line spacing\n+        bold = FX.toggleButton(toolbar, \"ùêÅ\", \"Bold text\");\n+        italic = FX.toggleButton(toolbar, \"ùêº\", \"Bold text\");\n+        strikeThrough = FX.toggleButton(toolbar, \"S\\u0336\", \"Strike through text\");\n+        underline = FX.toggleButton(toolbar, \"U\\u0332\", \"Underline text\");\n+        FX.add(toolbar, textStyle);\n+        paragraphButton = FX.button(toolbar, \"P\", \"Paragraph Styles\", null);\n+        FX.space(toolbar);\n+        lineNumbers = FX.toggleButton(toolbar, \"N\", \"Line Numbers\");\n+        wrapText = FX.toggleButton(toolbar, \"W\", \"Wrap Text\");\n+\n+        FX.name(lineNumbers, \"lineNumbers\");\n+        FX.name(wrapText, \"wrapText\");\n+\n+        setCenter(toolbar);\n+    }\n+\n+    private static List<String> collectFonts() {\n+        return Font.getFamilies();\n+    }\n+\n+    public void setTextStyle(TextStyle v) {\n+        textStyle.setValue(v);\n+    }\n+\n+    private static boolean getBoolean(StyleAttributeMap m, StyleAttribute<Boolean> a) {\n+        Boolean v = m.getBoolean(a);\n+        return v == null ? false : v.booleanValue();\n+    }\n+\n+    public void updateStyles(StyleAttributeMap a) {\n+        bold.setSelected(getBoolean(a, StyleAttributeMap.BOLD));\n+        italic.setSelected(getBoolean(a, StyleAttributeMap.ITALIC));\n+        underline.setSelected(getBoolean(a, StyleAttributeMap.UNDERLINE));\n+        strikeThrough.setSelected(getBoolean(a, StyleAttributeMap.STRIKE_THROUGH));\n+        FX.select(fontFamily, a.getFontFamily());\n+        FX.select(fontSize, a.getFontSize());\n+        textColor.setValue(a.getTextColor());\n+    }\n+}\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/editor\/RichEditorToolbar.java","additions":154,"deletions":0,"binary":false,"changes":154,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates.\n+ * Copyright (c) 2023, 2026, Oracle and\/or its affiliates.\n@@ -44,0 +44,1 @@\n+import javafx.scene.control.ButtonBase;\n@@ -51,0 +52,2 @@\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.control.ToolBar;\n@@ -218,0 +221,2 @@\n+            } else if (n instanceof ButtonBase) {\n+                return null;\n@@ -243,0 +248,6 @@\n+        } else if (n instanceof ToolBar t) {\n+            for (Node ch : t.getItems()) {\n+                storeNode(ch);\n+            }\n+        } else if (n instanceof ToggleButton t) {\n+            storeToggleButton(t);\n@@ -246,1 +257,1 @@\n-            for (Node ch: p.getChildrenUnmodifiable()) {\n+            for (Node ch : p.getChildrenUnmodifiable()) {\n@@ -267,0 +278,6 @@\n+        } else if (n instanceof ToolBar t) {\n+            for (Node ch : t.getItems()) {\n+                restoreNode(ch);\n+            }\n+        } else if (n instanceof ToggleButton t) {\n+            restoreToggleButton(t);\n@@ -270,1 +287,1 @@\n-            for (Node ch: p.getChildrenUnmodifiable()) {\n+            for (Node ch : p.getChildrenUnmodifiable()) {\n@@ -449,0 +466,22 @@\n+    private static void storeToggleButton(ToggleButton n) {\n+        String name = computeName(n);\n+        if (name != null) {\n+            boolean sel = n.isSelected();\n+            FxSettings.setBoolean(PREFIX + name, sel);\n+        }\n+    }\n+\n+    private static void restoreToggleButton(ToggleButton n) {\n+        if (checkNoScene(n)) {\n+            return;\n+        }\n+\n+        String name = computeName(n);\n+        if (name != null) {\n+            Boolean sel = FxSettings.getBoolean(PREFIX + name);\n+            if (sel != null) {\n+                n.setSelected(sel);\n+            }\n+        }\n+    }\n+\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/settings\/FxSettingsSchema.java","additions":42,"deletions":3,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -0,0 +1,64 @@\n+\/*\n+ * Copyright (c) 2026, Oracle and\/or its affiliates.\n+ * All rights reserved. Use is subject to license terms.\n+ *\n+ * This file is available and licensed under the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ *  - Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *  - Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and\/or other materials provided with the distribution.\n+ *  - Neither the name of Oracle Corporation nor the names of its\n+ *    contributors may be used to endorse or promote products derived\n+ *    from this software without specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n+ * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+\n+package com.oracle.demo.richtext.util;\n+\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.Priority;\n+\n+\/\/\/ Column Constraints with builder-like methods.\n+public class CC extends ColumnConstraints {\n+    public CC() {\n+    }\n+\n+    public CC fill() {\n+        setFillWidth(true);\n+        setHgrow(Priority.ALWAYS);\n+        return this;\n+    }\n+\n+    public CC width(double width) {\n+        if (width < 1.0) {\n+            setPercentWidth(width);\n+        } else {\n+            setPrefWidth(width);\n+        }\n+        return this;\n+    }\n+\n+    public CC fixed(double width) {\n+        setMinWidth(width);\n+        setPrefWidth(width);\n+        setMaxWidth(width);\n+        return this;\n+    }\n+}\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/util\/CC.java","additions":64,"deletions":0,"binary":false,"changes":64,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates.\n+ * Copyright (c) 2023, 2026, Oracle and\/or its affiliates.\n@@ -35,0 +35,1 @@\n+import java.text.DecimalFormat;\n@@ -37,0 +38,1 @@\n+import java.util.function.Function;\n@@ -135,0 +137,8 @@\n+    public static MenuItem item(ContextMenu cm, String text, Runnable action) {\n+        MenuItem mi = new MenuItem(text);\n+        applyMnemonic(mi);\n+        cm.getItems().add(mi);\n+        mi.setOnAction((ev) -> action.run());\n+        return mi;\n+    }\n+\n@@ -240,1 +250,0 @@\n-        b.setDisable(true);\n@@ -248,1 +257,3 @@\n-        a.attach(b);\n+        if (a != null) {\n+            a.attach(b);\n+        }\n@@ -285,0 +296,7 @@\n+    public static <T> void select(ComboBox<T> cb, T value, T defaultValue) {\n+        if (value == null) {\n+            value = defaultValue;\n+        }\n+        cb.getSelectionModel().select(value);\n+    }\n+\n@@ -470,2 +488,1 @@\n-                    \/\/ not supported\n-                    return null;\n+                    throw new UnsupportedOperationException();\n@@ -477,0 +494,40 @@\n+\n+    public static <T> StringConverter<T> converter(Function<T, String> conv) {\n+        return new StringConverter<>() {\n+            @Override\n+            public String toString(T v) {\n+                return conv.apply(v);\n+            }\n+\n+            @Override\n+            public T fromString(String s) {\n+                throw new UnsupportedOperationException();\n+            }\n+        };\n+    }\n+\n+    public static StringConverter<Double> numberConverter() {\n+        return new StringConverter<Double>() {\n+            private final DecimalFormat format1dp = new DecimalFormat(\"0.#\");\n+\n+            @Override\n+            public String toString(Double v) {\n+                if (v == null) {\n+                    return null;\n+                }\n+                return format1dp.format(v);\n+            }\n+\n+            @Override\n+            public Double fromString(String s) {\n+                if ((s == null) || (s.trim().length() == 0)) {\n+                    return null;\n+                }\n+                return Double.parseDouble(s.trim());\n+            }\n+        };\n+    }\n+\n+    public static CC cc() {\n+        return new CC();\n+    }\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/util\/FX.java","additions":62,"deletions":5,"binary":false,"changes":67,"status":"modified"},{"patch":"@@ -4,1 +4,1 @@\n-[RichTextArea](src\/main\/java\/jfx\/incubator\/scene\/control\/rich\/RichTextArea.java)\n+[RichTextArea](src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/RichTextArea.java)\n@@ -6,1 +6,1 @@\n-[CodeArea](src\/main\/java\/jfx\/incubator\/scene\/control\/rich\/code\/CodeArea.java)\n+[CodeArea](src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/CodeArea.java)\n","filename":"modules\/jfx.incubator.richtext\/README.md","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2376,15 +2376,3 @@\n-            TextPos pos = getCaretPosition();\n-            if (pos != null) {\n-                if (hasNonEmptySelection()) {\n-                    TextPos an = getAnchorPosition();\n-                    if (pos.compareTo(an) > 0) {\n-                        pos = an;\n-                    }\n-                } else if (!TextPos.ZERO.equals(pos)) {\n-                    int ix = pos.offset() - 1;\n-                    if (ix < 0) {\n-                        \/\/ FIX find previous symbol\n-                        ix = 0;\n-                    }\n-                    pos = TextPos.ofLeading(pos.index(), ix);\n-                }\n+            SelectionSegment sel = getSelection();\n+            if (sel != null) {\n+                TextPos pos = sel.getMax();\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/RichTextArea.java","additions":3,"deletions":15,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -337,0 +337,1 @@\n+            int last = ct - 1;\n@@ -341,1 +342,1 @@\n-                if ((offset <= pos) || (i + 1 == ct)) {\n+                if ((offset <= pos) || (i == last)) {\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/model\/RichTextModel.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -555,0 +555,1 @@\n+        \/\/            BB.B.IB\n@@ -567,2 +568,0 @@\n-        assertEquals(BOLD, control.getActiveStyleAttributeMap());\n-        control.select(TextPos.ofLeading(0, 5));\n@@ -570,0 +569,2 @@\n+        control.select(TextPos.ofLeading(0, 5));\n+        assertEquals(BOLD, control.getActiveStyleAttributeMap());\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/RichTextAreaTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}