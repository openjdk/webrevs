{"files":[{"patch":"@@ -29,0 +29,1 @@\n+import java.util.concurrent.TimeUnit;\n@@ -50,0 +51,1 @@\n+    static CountDownLatch eventReceivedLatch;\n@@ -56,1 +58,1 @@\n-    static boolean receivedEvent = false;\n+    static Stage theStage = null;\n@@ -65,0 +67,2 @@\n+            theStage = stage;\n+\n@@ -69,2 +73,3 @@\n-                if (e.getCode() == KeyCode.A)\n-                    receivedEvent = true;\n+                if (e.getCode() == KeyCode.A) {\n+                    eventReceivedLatch.countDown();\n+                }\n@@ -88,0 +93,1 @@\n+        eventReceivedLatch = new CountDownLatch(1);\n@@ -108,1 +114,2 @@\n-    public void testStageHasFocusAfterShow() {\n+    public void testStageHasFocusAfterShow() throws InterruptedException {\n+        \/\/ ensures UI finished showing the Stage\n@@ -110,0 +117,2 @@\n+        assertTrue(theStage.isFocused());\n+\n@@ -113,2 +122,5 @@\n-        assertTrue(receivedEvent, \"Expected key press has NOT been received! Stage did not have focus after showing. Some tests might fail because of this.\" +\n-                                  \"If that is the case, try re-running the tests with '--no-daemon' flag in Gradle.\");\n+        assertTrue(\n+            eventReceivedLatch.await(2000, TimeUnit.MILLISECONDS),\n+            \"Event received latch timed out! Stage most probably did not have focus after showing. Some tests might fail because of this.\" +\n+            \"If that is the case, try re-running the tests with '--no-daemon' flag in Gradle.\"\n+        );\n","filename":"tests\/system\/src\/test\/java\/test\/robot\/javafx\/stage\/StageFocusTest.java","additions":18,"deletions":6,"binary":false,"changes":24,"status":"modified"}]}