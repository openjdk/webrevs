{"files":[{"patch":"@@ -698,1 +698,2 @@\n-                    x += snapSizeY(node.prefHeight(-1)) + getSpacing();\n+                    x = snapPositionY(x + snapSizeY(node.prefHeight(-1)) + getSpacing());\n+                    length = snapPositionY(length);\n@@ -700,1 +701,2 @@\n-                    x += snapSizeX(node.prefWidth(-1)) + getSpacing();\n+                    x = snapPositionX(x + snapSizeX(node.prefWidth(-1)) + getSpacing());\n+                    length = snapPositionX(length);\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/ToolBarSkin.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -31,0 +31,2 @@\n+\n+import java.util.stream.Stream;\n@@ -35,0 +37,1 @@\n+import javafx.scene.Parent;\n@@ -37,0 +40,1 @@\n+import javafx.scene.control.Separator;\n@@ -39,0 +43,1 @@\n+import javafx.scene.layout.BorderPane;\n@@ -45,0 +50,3 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -79,10 +87,21 @@\n-    @Test\n-    public void overflowMenuNotShowingWithDifferentRenderScales() {\n-        double[] renderScales = {\n-            1.0,\n-            1.25,\n-            1.5,\n-            1.75,\n-            2.0,\n-            2.25\n-        };\n+    \/\/ Tests that floating-point precision errors do not trigger the overflow menu.\n+    \/\/ For example, a calculation may yield 117.60000000000001, which should not be\n+    \/\/ treated as greater than 117.6 when determining whether there is sufficient space.\n+    @ParameterizedTest\n+    @MethodSource(\"renderScalesAndOrientations\")\n+    public void overflowMenuNotShowingDueToFloatPrecisionErrors(double scale, Orientation orientation) {\n+        \/\/ These pref height\/width values can cause getOverflowNodeIndex() to compute a combined\n+        \/\/ child length of 117.60000000000001, while the toolbar length is 117.6 (for both horizontal\n+        \/\/ and vertical orientations), unless snapPositionX\/Y() is applied correctly.\n+        double buttonPrefDimension = 99.2;\n+        double separatorPrefDimension = 10.4;\n+\n+        Button btn = new Button(\"123456 123456\");\n+        btn.setPrefWidth(buttonPrefDimension);\n+        btn.setPrefHeight(buttonPrefDimension);\n+\n+        \/\/ Set up a separator in opposite orientation\n+        Separator sep = new Separator(orientation == Orientation.VERTICAL ? Orientation.HORIZONTAL\n+                : Orientation.VERTICAL);\n+        sep.setPrefWidth(separatorPrefDimension);\n+        sep.setPrefHeight(separatorPrefDimension);\n@@ -90,0 +109,12 @@\n+        ToolBar toolBar = new ToolBar(sep, btn);\n+        toolBar.setOrientation(orientation);\n+\n+        BorderPane bp = new BorderPane();\n+        bp.setTop(new HBox(toolBar));\n+\n+        assertOverflowNotShown(bp, toolBar, scale);\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"renderScalesAndOrientations\")\n+    public void overflowMenuNotShowingWithDifferentRenderScales(double scale, Orientation orientation) {\n@@ -93,0 +124,1 @@\n+        toolBar.setOrientation(orientation);\n@@ -94,17 +126,7 @@\n-        for (var orientation : Orientation.values()) {\n-            toolBar.setOrientation(orientation);\n-\n-            for (double scale : renderScales) {\n-                Stage stage = new Stage();\n-                stage.renderScaleXProperty().bind(DoubleConstant.valueOf(scale));\n-                stage.renderScaleYProperty().bind(DoubleConstant.valueOf(scale));\n-                stage.setScene(new Scene(new HBox(toolBar), 600, 600));\n-                stage.show();\n-\n-                try {\n-                    assertOverflowNotShown(toolBar);\n-                } finally {\n-                    stage.hide();\n-                }\n-            }\n-        }\n+        assertOverflowNotShown(new HBox(toolBar), toolBar, scale);\n+    }\n+\n+    private static Stream<Arguments> renderScalesAndOrientations() {\n+        return Stream.of(1.0, 1.25, 1.5, 1.75, 2.0, 2.25)\n+            .flatMap(scale -> Stream.of(Orientation.values())\n+                .map(orientation -> Arguments.of(scale, orientation)));\n@@ -113,4 +135,14 @@\n-    private static void assertOverflowNotShown(ToolBar tb) {\n-        Pane p = (Pane)tb.queryAccessibleAttribute(AccessibleAttribute.OVERFLOW_BUTTON);\n-        assertNotNull(p, \"failed to obtain the overflow button\");\n-        assertFalse(p.isVisible(), \"the overflow button is expected to be hidden\");\n+    private static void assertOverflowNotShown(Parent rootNode, ToolBar tb, double scale) {\n+        Stage stage = new Stage();\n+        stage.renderScaleXProperty().bind(DoubleConstant.valueOf(scale));\n+        stage.renderScaleYProperty().bind(DoubleConstant.valueOf(scale));\n+        stage.setScene(new Scene(rootNode, 600, 600));\n+        stage.show();\n+\n+        try {\n+            Pane p = (Pane) tb.queryAccessibleAttribute(AccessibleAttribute.OVERFLOW_BUTTON);\n+            assertNotNull(p, \"failed to obtain the overflow button\");\n+            assertFalse(p.isVisible(), \"the overflow button is expected to be hidden\");\n+        } finally {\n+            stage.hide();\n+        }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/ToolBarSkinTest.java","additions":63,"deletions":31,"binary":false,"changes":94,"status":"modified"}]}