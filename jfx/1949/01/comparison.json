{"files":[{"patch":"@@ -521,2 +521,2 @@\n-    if (cache->RVT) {\n-    xmlDocPtr tmp, cur = cache->RVT;\n+    if (cache->rvtList) {\n+        xsltRVTListPtr tmp, cur = cache->rvtList;\n@@ -525,2 +525,2 @@\n-        cur = (xmlDocPtr) cur->next;\n-        if (tmp->_private != NULL) {\n+            cur = cur->next;\n+            if (tmp->RVT->_private != NULL) {\n@@ -528,1 +528,1 @@\n-        * Tree the document info.\n+                * Free the document info.\n@@ -530,2 +530,2 @@\n-        xsltFreeDocumentKeys((xsltDocumentPtr) tmp->_private);\n-        xmlFree(tmp->_private);\n+                xsltFreeDocumentKeys((xsltDocumentPtr) tmp->RVT->_private);\n+                xmlFree(tmp->RVT->_private);\n@@ -533,1 +533,2 @@\n-        xmlFreeDoc(tmp);\n+            xmlFreeDoc(tmp->RVT);\n+            xmlFree(tmp);\n@@ -2266,1 +2267,1 @@\n-xsltReleaseLocalRVTs(xsltTransformContextPtr ctxt, xmlDocPtr base)\n+xsltReleaseLocalRVTs(xsltTransformContextPtr ctxt, xsltRVTListPtr base)\n@@ -2268,1 +2269,1 @@\n-    xmlDocPtr cur = ctxt->localRVT, tmp;\n+    xsltRVTListPtr cur = ctxt->localRVTList, tmp;\n@@ -2272,2 +2273,0 @@\n-    if (cur->prev != NULL)\n-        xsltTransformError(ctxt, NULL, NULL, \"localRVT not head of list\\n\");\n@@ -2275,4 +2274,2 @@\n-    \/* Reset localRVT early because some RVTs might be registered again. *\/\n-    ctxt->localRVT = base;\n-    if (base != NULL)\n-        base->prev = NULL;\n+    \/* Reset localRVTList early because some RVTs might be registered again. *\/\n+    ctxt->localRVTList = base;\n@@ -2282,6 +2279,7 @@\n-        cur = (xmlDocPtr) cur->next;\n-        if (tmp->compression == XSLT_RVT_LOCAL) {\n-            xsltReleaseRVT(ctxt, tmp);\n-        } else if (tmp->compression == XSLT_RVT_GLOBAL) {\n-            xsltRegisterPersistRVT(ctxt, tmp);\n-        } else if (tmp->compression == XSLT_RVT_FUNC_RESULT) {\n+        cur = cur->next;\n+        if (tmp->RVT->compression == XSLT_RVT_LOCAL) {\n+            xsltReleaseRVTList(ctxt, tmp);\n+        } else if (tmp->RVT->compression == XSLT_RVT_GLOBAL) {\n+            xsltRegisterPersistRVT(ctxt, tmp->RVT);\n+            xmlFree(tmp);\n+        } else if (tmp->RVT->compression == XSLT_RVT_FUNC_RESULT) {\n@@ -2292,2 +2290,3 @@\n-            xsltRegisterLocalRVT(ctxt, tmp);\n-            tmp->compression = XSLT_RVT_FUNC_RESULT;\n+            xsltRegisterLocalRVT(ctxt, tmp->RVT);\n+            tmp->RVT->compression = XSLT_RVT_FUNC_RESULT;\n+            xmlFree(tmp);\n@@ -2296,2 +2295,2 @@\n-                    \"xsltReleaseLocalRVTs: Unexpected RVT flag %p\\n\",\n-                    tmp->psvi);\n+                    \"xsltReleaseLocalRVTs: Unexpected RVT flag %d\\n\",\n+                    tmp->RVT->compression);\n@@ -2325,1 +2324,1 @@\n-    xmlDocPtr oldLocalFragmentTop;\n+    xsltRVTListPtr oldLocalFragmentTop;\n@@ -2371,1 +2370,1 @@\n-    oldLocalFragmentTop = ctxt->localRVT;\n+    oldLocalFragmentTop = ctxt->localRVTList;\n@@ -2605,2 +2604,2 @@\n-            if (oldLocalFragmentTop != ctxt->localRVT)\n-            xsltReleaseLocalRVTs(ctxt, oldLocalFragmentTop);\n+            if (oldLocalFragmentTop != ctxt->localRVTList)\n+                xsltReleaseLocalRVTs(ctxt, oldLocalFragmentTop);\n@@ -2700,1 +2699,1 @@\n-            if (oldLocalFragmentTop != ctxt->localRVT)\n+                    if (oldLocalFragmentTop != ctxt->localRVTList)\n@@ -2766,1 +2765,1 @@\n-        if (oldLocalFragmentTop != ctxt->localRVT)\n+                if (oldLocalFragmentTop != ctxt->localRVTList)\n@@ -2896,1 +2895,1 @@\n-        if (oldLocalFragmentTop != ctxt->localRVT)\n+                if (oldLocalFragmentTop != ctxt->localRVTList)\n@@ -3075,1 +3074,1 @@\n-    xmlDocPtr oldUserFragmentTop;\n+    xsltRVTListPtr oldUserFragmentTop;\n@@ -3123,2 +3122,2 @@\n-    oldUserFragmentTop = ctxt->tmpRVT;\n-    ctxt->tmpRVT = NULL;\n+    oldUserFragmentTop = ctxt->tmpRVTList;\n+    ctxt->tmpRVTList = NULL;\n@@ -3235,2 +3234,2 @@\n-    if (ctxt->tmpRVT) {\n-    xmlDocPtr curdoc = ctxt->tmpRVT, tmp;\n+    if (ctxt->tmpRVTList) {\n+        xsltRVTListPtr curRVTList = ctxt->tmpRVTList, tmp;\n@@ -3238,4 +3237,4 @@\n-    while (curdoc != NULL) {\n-        tmp = curdoc;\n-        curdoc = (xmlDocPtr) curdoc->next;\n-        xsltReleaseRVT(ctxt, tmp);\n+        while (curRVTList != NULL) {\n+            tmp = curRVTList;\n+            curRVTList = curRVTList->next;\n+            xsltReleaseRVTList(ctxt, tmp);\n@@ -3244,1 +3243,1 @@\n-    ctxt->tmpRVT = oldUserFragmentTop;\n+    ctxt->tmpRVTList = oldUserFragmentTop;\n@@ -5322,1 +5321,1 @@\n-    xmlDocPtr oldLocalFragmentTop = ctxt->localRVT;\n+        xsltRVTListPtr oldLocalFragmentTop = ctxt->localRVTList;\n@@ -5330,1 +5329,1 @@\n-    if (oldLocalFragmentTop != ctxt->localRVT)\n+    if (oldLocalFragmentTop != ctxt->localRVTList)\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/ThirdParty\/libxslt\/src\/libxslt\/transform.c","additions":44,"deletions":45,"binary":false,"changes":89,"status":"modified"},{"patch":"@@ -50,0 +50,15 @@\n+static xsltRVTListPtr\n+xsltRVTListCreate(void)\n+{\n+    xsltRVTListPtr ret;\n+\n+    ret = (xsltRVTListPtr) xmlMalloc(sizeof(xsltRVTList));\n+    if (ret == NULL) {\n+        xsltTransformError(NULL, NULL, NULL,\n+            \"xsltRVTListCreate: malloc failed\\n\");\n+        return(NULL);\n+    }\n+    memset(ret, 0, sizeof(xsltRVTList));\n+    return(ret);\n+}\n+\n@@ -67,0 +82,1 @@\n+    xsltRVTListPtr rvtList;\n@@ -79,6 +95,5 @@\n-    if (ctxt->cache->RVT) {\n-    container = ctxt->cache->RVT;\n-    ctxt->cache->RVT = (xmlDocPtr) container->next;\n-    \/* clear the internal pointers *\/\n-    container->next = NULL;\n-    container->prev = NULL;\n+    if (ctxt->cache->rvtList) {\n+        rvtList = ctxt->cache->rvtList;\n+        container = ctxt->cache->rvtList->RVT;\n+        ctxt->cache->rvtList = rvtList->next;\n+        xmlFree(rvtList);\n@@ -122,0 +137,2 @@\n+    xsltRVTListPtr list;\n+\n@@ -125,1 +142,3 @@\n-    RVT->prev = NULL;\n+    list = xsltRVTListCreate();\n+    if (list == NULL) return(-1);\n+\n@@ -127,0 +146,1 @@\n+    list->RVT = RVT;\n@@ -134,2 +154,2 @@\n-    RVT->next = (xmlNodePtr) XSLT_TCTXT_VARIABLE(ctxt)->fragment;\n-    XSLT_TCTXT_VARIABLE(ctxt)->fragment = RVT;\n+        list->next = XSLT_TCTXT_VARIABLE(ctxt)->fragment;\n+        XSLT_TCTXT_VARIABLE(ctxt)->fragment = list;\n@@ -139,4 +159,2 @@\n-    RVT->next = (xmlNodePtr) ctxt->tmpRVT;\n-    if (ctxt->tmpRVT != NULL)\n-    ctxt->tmpRVT->prev = (xmlNodePtr) RVT;\n-    ctxt->tmpRVT = RVT;\n+    list->next = ctxt->tmpRVTList;\n+    ctxt->tmpRVTList = list;\n@@ -162,0 +180,2 @@\n+    xsltRVTListPtr list;\n+\n@@ -165,1 +185,3 @@\n-    RVT->prev = NULL;\n+    list = xsltRVTListCreate();\n+    if (list == NULL) return(-1);\n+\n@@ -167,0 +189,1 @@\n+    list->RVT = RVT;\n@@ -177,2 +200,2 @@\n-    RVT->next = (xmlNodePtr) XSLT_TCTXT_VARIABLE(ctxt)->fragment;\n-    XSLT_TCTXT_VARIABLE(ctxt)->fragment = RVT;\n+        list->next = XSLT_TCTXT_VARIABLE(ctxt)->fragment;\n+        XSLT_TCTXT_VARIABLE(ctxt)->fragment = list;\n@@ -186,4 +209,2 @@\n-    RVT->next = (xmlNodePtr) ctxt->localRVT;\n-    if (ctxt->localRVT != NULL)\n-    ctxt->localRVT->prev = (xmlNodePtr) RVT;\n-    ctxt->localRVT = RVT;\n+    list->next = ctxt->localRVTList;\n+    ctxt->localRVTList = list;\n@@ -347,2 +368,3 @@\n- * Either frees the RVT (which is an xmlDoc) or stores\n- * it in the context's cache for later reuse.\n+ * Either frees the RVT (which is an xmlDoc) or stores it in the context's\n+ * cache for later reuse. Preserved for ABI\/API compatibility; internal use\n+ * has all migrated to xsltReleaseRVTList().\n@@ -356,0 +378,28 @@\n+    xsltRVTListPtr list = xsltRVTListCreate();\n+    if (list == NULL) {\n+        if (RVT->_private != NULL) {\n+            xsltFreeDocumentKeys((xsltDocumentPtr) RVT->_private);\n+            xmlFree(RVT->_private);\n+        }\n+        xmlFreeDoc(RVT);\n+        return;\n+    }\n+\n+    xsltReleaseRVTList(ctxt, list);\n+}\n+\n+\/**\n+ * xsltReleaseRVTList:\n+ * @ctxt:  an XSLT transformation context\n+ * @list:  a list node containing a result value tree (Result Tree Fragment)\n+ *\n+ * Either frees the list node or stores it in the context's cache for later\n+ * reuse. Optimization to avoid adding a fallible allocation path when the\n+ * caller already has a RVT list node.\n+ *\/\n+void\n+xsltReleaseRVTList(xsltTransformContextPtr ctxt, xsltRVTListPtr list)\n+{\n+    if (list == NULL)\n+        return;\n+\n@@ -361,4 +411,4 @@\n-    if (RVT->_private != NULL) {\n-        xsltFreeDocumentKeys((xsltDocumentPtr) RVT->_private);\n-        xmlFree(RVT->_private);\n-        RVT->_private = NULL;\n+        if (list->RVT->_private != NULL) {\n+            xsltFreeDocumentKeys((xsltDocumentPtr) list->RVT->_private);\n+            xmlFree(list->RVT->_private);\n+            list->RVT->_private = NULL;\n@@ -369,4 +419,4 @@\n-    if (RVT->children != NULL) {\n-        xmlFreeNodeList(RVT->children);\n-        RVT->children = NULL;\n-        RVT->last = NULL;\n+        if (list->RVT->children != NULL) {\n+            xmlFreeNodeList(list->RVT->children);\n+            list->RVT->children = NULL;\n+            list->RVT->last = NULL;\n@@ -374,3 +424,3 @@\n-    if (RVT->ids != NULL) {\n-        xmlFreeIDTable((xmlIDTablePtr) RVT->ids);\n-        RVT->ids = NULL;\n+        if (list->RVT->ids != NULL) {\n+            xmlFreeIDTable((xmlIDTablePtr) list->RVT->ids);\n+            list->RVT->ids = NULL;\n@@ -382,1 +432,1 @@\n-    RVT->compression = 0;\n+        list->RVT->compression = 0;\n@@ -384,2 +434,2 @@\n-    RVT->next = (xmlNodePtr) ctxt->cache->RVT;\n-    ctxt->cache->RVT = RVT;\n+        list->next = ctxt->cache->rvtList;\n+        ctxt->cache->rvtList = list;\n@@ -397,3 +447,3 @@\n-    if (RVT->_private != NULL) {\n-    xsltFreeDocumentKeys((xsltDocumentPtr) RVT->_private);\n-    xmlFree(RVT->_private);\n+    if (list->RVT->_private != NULL) {\n+        xsltFreeDocumentKeys((xsltDocumentPtr) list->RVT->_private);\n+        xmlFree(list->RVT->_private);\n@@ -401,1 +451,2 @@\n-    xmlFreeDoc(RVT);\n+    xmlFreeDoc(list->RVT);\n+    xmlFree(list);\n@@ -419,0 +470,2 @@\n+    xsltRVTListPtr list;\n+\n@@ -421,0 +474,3 @@\n+    list = xsltRVTListCreate();\n+    if (list == NULL) return(-1);\n+\n@@ -422,5 +478,3 @@\n-    RVT->prev = NULL;\n-    RVT->next = (xmlNodePtr) ctxt->persistRVT;\n-    if (ctxt->persistRVT != NULL)\n-    ctxt->persistRVT->prev = (xmlNodePtr) RVT;\n-    ctxt->persistRVT = RVT;\n+    list->RVT = RVT;\n+    list->next = ctxt->persistRVTList;\n+    ctxt->persistRVTList = list;\n@@ -441,1 +495,1 @@\n-    xmlDocPtr cur, next;\n+    xsltRVTListPtr cur, next;\n@@ -448,1 +502,1 @@\n-    cur = ctxt->localRVT;\n+    cur = ctxt->localRVTList;\n@@ -450,4 +504,4 @@\n-        next = (xmlDocPtr) cur->next;\n-    if (cur->_private != NULL) {\n-        xsltFreeDocumentKeys(cur->_private);\n-        xmlFree(cur->_private);\n+        next = cur->next;\n+        if (cur->RVT->_private != NULL) {\n+            xsltFreeDocumentKeys(cur->RVT->_private);\n+            xmlFree(cur->RVT->_private);\n@@ -455,1 +509,2 @@\n-    xmlFreeDoc(cur);\n+        xmlFreeDoc(cur->RVT);\n+        xmlFree(cur);\n@@ -458,1 +513,1 @@\n-    ctxt->localRVT = NULL;\n+    ctxt->localRVTList = NULL;\n@@ -462,1 +517,1 @@\n-    cur = ctxt->tmpRVT;\n+    cur = ctxt->tmpRVTList;\n@@ -464,4 +519,4 @@\n-        next = (xmlDocPtr) cur->next;\n-    if (cur->_private != NULL) {\n-        xsltFreeDocumentKeys(cur->_private);\n-        xmlFree(cur->_private);\n+        next = cur->next;\n+        if (cur->RVT->_private != NULL) {\n+            xsltFreeDocumentKeys(cur->RVT->_private);\n+            xmlFree(cur->RVT->_private);\n@@ -469,1 +524,2 @@\n-    xmlFreeDoc(cur);\n+        xmlFreeDoc(cur->RVT);\n+        xmlFree(cur);\n@@ -472,1 +528,1 @@\n-    ctxt->tmpRVT = NULL;\n+    ctxt->tmpRVTList = NULL;\n@@ -476,1 +532,1 @@\n-    cur = ctxt->persistRVT;\n+    cur = ctxt->persistRVTList;\n@@ -478,4 +534,4 @@\n-        next = (xmlDocPtr) cur->next;\n-    if (cur->_private != NULL) {\n-        xsltFreeDocumentKeys(cur->_private);\n-        xmlFree(cur->_private);\n+        next = cur->next;\n+        if (cur->RVT->_private != NULL) {\n+            xsltFreeDocumentKeys(cur->RVT->_private);\n+            xmlFree(cur->RVT->_private);\n@@ -483,1 +539,2 @@\n-    xmlFreeDoc(cur);\n+        xmlFreeDoc(cur->RVT);\n+        xmlFree(cur);\n@@ -486,1 +543,1 @@\n-    ctxt->persistRVT = NULL;\n+    ctxt->persistRVTList = NULL;\n@@ -574,1 +631,1 @@\n-    xmlDocPtr cur;\n+        xsltRVTListPtr cur;\n@@ -578,7 +635,8 @@\n-        elem->fragment = (xmlDocPtr) cur->next;\n-\n-            if (cur->compression == XSLT_RVT_LOCAL) {\n-        xsltReleaseRVT(elem->context, cur);\n-            } else if (cur->compression == XSLT_RVT_FUNC_RESULT) {\n-                xsltRegisterLocalRVT(elem->context, cur);\n-                cur->compression = XSLT_RVT_FUNC_RESULT;\n+            elem->fragment = cur->next;\n+\n+            if (cur->RVT->compression == XSLT_RVT_LOCAL) {\n+                xsltReleaseRVTList(elem->context, cur);\n+            } else if (cur->RVT->compression == XSLT_RVT_FUNC_RESULT) {\n+                xsltRegisterLocalRVT(elem->context, cur->RVT);\n+                cur->RVT->compression = XSLT_RVT_FUNC_RESULT;\n+                xmlFree(cur);\n@@ -588,1 +646,1 @@\n-                        cur->compression);\n+                        cur->RVT->compression);\n@@ -947,0 +1005,1 @@\n+                xsltRVTListPtr rvtList;\n@@ -971,1 +1030,5 @@\n-        variable->fragment = container;\n+                rvtList = xsltRVTListCreate();\n+                if (rvtList == NULL)\n+                    goto error;\n+                rvtList->RVT = container;\n+                variable->fragment = rvtList;\n@@ -2364,2 +2427,0 @@\n-\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/ThirdParty\/libxslt\/src\/libxslt\/variables.c","additions":140,"deletions":79,"binary":false,"changes":219,"status":"modified"},{"patch":"@@ -1413,0 +1413,2 @@\n+typedef struct _xsltRVTList xsltRVTList;\n+typedef xsltRVTList *xsltRVTListPtr;\n@@ -1430,1 +1432,1 @@\n-    xmlDocPtr fragment;        \/* The Result Tree Fragments (needed for XSLT 1.0)\n+    xsltRVTListPtr fragment;    \/* The Result Tree Fragments (needed for XSLT 1.0)\n@@ -1642,0 +1644,5 @@\n+struct _xsltRVTList {\n+  xmlDocPtr RVT;\n+  xsltRVTListPtr next;\n+};\n+\n@@ -1645,1 +1652,1 @@\n-    xmlDocPtr RVT;\n+    xsltRVTListPtr rvtList;\n@@ -1752,2 +1759,2 @@\n-    xmlDocPtr       tmpRVT;        \/* list of RVT without persistance *\/\n-    xmlDocPtr       persistRVT;        \/* list of persistant RVTs *\/\n+    xsltRVTListPtr  tmpRVTList;         \/* list of RVT without persistance *\/\n+    xsltRVTListPtr  persistRVTList;     \/* list of persistant RVTs *\/\n@@ -1786,1 +1793,1 @@\n-    xmlDocPtr localRVT; \/* list of local tree fragments; will be freed when\n+    xsltRVTListPtr localRVTList; \/* list of local tree fragments; will be freed when\n@@ -1935,1 +1942,1 @@\n-            xsltReleaseRVT        (xsltTransformContextPtr ctxt,\n+                        xsltReleaseRVT          (xsltTransformContextPtr ctxt,\n@@ -1937,0 +1944,3 @@\n+XSLTPUBFUN void XSLTCALL\n+                        xsltReleaseRVTList      (xsltTransformContextPtr ctxt,\n+                                                 xsltRVTListPtr list);\n@@ -1995,1 +2005,0 @@\n-\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/ThirdParty\/libxslt\/src\/libxslt\/xsltInternals.h","additions":16,"deletions":7,"binary":false,"changes":23,"status":"modified"}]}