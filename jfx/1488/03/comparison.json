{"files":[{"patch":"@@ -314,0 +314,1 @@\n+                applyNegativeStyleClass(item);\n@@ -320,2 +321,0 @@\n-        \/\/ create entry in the map\n-        Map<String, Data<X,Y>> categoryMap = new HashMap<>();\n@@ -324,19 +323,1 @@\n-            Node bar = createBar(series, seriesIndex, item, j);\n-            String category;\n-            if (orientation == Orientation.VERTICAL) {\n-                category = (String)item.getXValue();\n-            } else {\n-                category = (String)item.getYValue();\n-            }\n-            categoryMap.put(category, item);\n-            if (shouldAnimate()) {\n-                animateDataAdd(item, bar);\n-            } else {\n-                \/\/ RT-21164 check if bar value is negative to add NEGATIVE_STYLE style class\n-                double barVal = (orientation == Orientation.VERTICAL) ? ((Number)item.getYValue()).doubleValue() :\n-                        ((Number)item.getXValue()).doubleValue();\n-                if (barVal < 0) {\n-                    bar.getStyleClass().add(NEGATIVE_STYLE);\n-                }\n-                getPlotChildren().add(bar);\n-            }\n+            dataItemAdded(series, j, item);\n@@ -344,1 +325,0 @@\n-        if (categoryMap.size() > 0) seriesCategoryMap.put(series, categoryMap);\n@@ -465,3 +445,0 @@\n-            if (barVal < 0) {\n-                bar.getStyleClass().add(NEGATIVE_STYLE);\n-            }\n@@ -481,3 +458,0 @@\n-            if (barVal < 0) {\n-                bar.getStyleClass().add(NEGATIVE_STYLE);\n-            }\n@@ -592,0 +566,1 @@\n+        applyNegativeStyleClass(item);\n@@ -595,0 +570,9 @@\n+    private void applyNegativeStyleClass(Data<X,Y> item) {\n+        double barVal = (orientation == Orientation.VERTICAL) ? ((Number)item.getYValue()).doubleValue() :\n+            ((Number)item.getXValue()).doubleValue();\n+        if (barVal < 0) {\n+            var bar = item.getNode();\n+            bar.getStyleClass().add(NEGATIVE_STYLE);\n+        }\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/BarChart.java","additions":12,"deletions":28,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -32,1 +32,0 @@\n-import javafx.scene.Scene;\n@@ -35,1 +34,1 @@\n-import javafx.stage.Stage;\n+import org.junit.Assert;\n@@ -154,1 +153,1 @@\n-        for (int i = 0; i != 10; i++) {\n+        for (int i = 1; i != 10; i++) {\n@@ -279,0 +278,83 @@\n+    @Test\n+    public void testNegativeStyleIsAddedToNewData() {\n+        startApp();\n+        Series<String, Number> series = bc.getData().getFirst();\n+        series.getData().addFirst(new XYChart.Data<>(\"1\", -1));\n+        pulse();\n+        Node bar = series.getData().getFirst().getNode();\n+        checkStyleClass(bar, \"negative\");\n+    }\n+\n+    @Test\n+    public void testNegativeStyleIsAddedToDataOfNewSeries() {\n+        startApp();\n+        Series<String, Number> series = new Series<>();\n+        series.getData().addFirst(new XYChart.Data<>(\"1\", -1));\n+        bc.getData().add(series);\n+        pulse();\n+        Node bar = series.getData().getFirst().getNode();\n+        checkStyleClass(bar, \"negative\");\n+    }\n+\n+    @Test\n+    public void testNegativeStyleIsRemovedWhenChangingData() {\n+        startApp();\n+        Series<String, Number> series = bc.getData().getFirst();\n+\n+        series.getData().getFirst().setYValue(-1);\n+        Node bar = series.getData().getFirst().getNode();\n+        checkStyleClass(bar, \"negative\");\n+\n+        series.getData().getFirst().setYValue(1);\n+        Assert.assertFalse(bar.getStyleClass().contains(\"negative\"));\n+    }\n+\n+    @Test\n+    public void testAddingDataToEmptySeries() {\n+        Thread.currentThread().setUncaughtExceptionHandler((t, e) -> Assert.fail(\"Exception: \" + e));\n+        startApp();\n+        BarChart<String, Number> chart = new BarChart<>(new CategoryAxis(), new NumberAxis());\n+        XYChart.Series<String, Number> series = new XYChart.Series<>();\n+        chart.getData().add(series);\n+        series.getData().add(new XYChart.Data<>(\"1\", 1));\n+        series.getData().add(new XYChart.Data<>(\"2\", -2));\n+        series.getData().add(new XYChart.Data<>(\"3\", 3));\n+        assertEquals(3, XYChartShim.Series_getDataSize(series));\n+        assertEquals(3, XYChartShim.getPlotChildren(chart).size());\n+        Node bar2 = series.getData().get(1).getNode();\n+        checkStyleClass(bar2, \"negative\");\n+    }\n+\n+    @Test\n+    public void testAddingDataToNonEmptySeries() {\n+        Thread.currentThread().setUncaughtExceptionHandler((t, e) -> Assert.fail(\"Exception: \" + e));\n+        startApp();\n+        BarChart<String, Number> chart = new BarChart<>(new CategoryAxis(), new NumberAxis());\n+        XYChart.Series<String, Number> series = new XYChart.Series<>();\n+        series.getData().add(new XYChart.Data<>(\"1\", 1));\n+        chart.getData().add(series);\n+        series.getData().add(new XYChart.Data<>(\"2\", -2));\n+        assertEquals(2, XYChartShim.Series_getDataSize(series));\n+        assertEquals(2, XYChartShim.getPlotChildren(chart).size());\n+        Node bar2 = series.getData().get(1).getNode();\n+        checkStyleClass(bar2, \"negative\");\n+    }\n+\n+    @Test\n+    public void testAddingDataToSeriesContainingDuplicateCategories() {\n+        Thread.currentThread().setUncaughtExceptionHandler((t, e) -> Assert.fail(\"Exception: \" + e));\n+        startApp();\n+        BarChart<String, Number> chart = new BarChart<>(new CategoryAxis(), new NumberAxis());\n+        XYChart.Series<String, Number> series = new XYChart.Series<>();\n+        series.getData().add(new XYChart.Data<>(\"1\", 1));\n+        series.getData().add(new XYChart.Data<>(\"1\", 2));\n+        series.getData().add(new XYChart.Data<>(\"2\", 3));\n+        chart.getData().add(series);\n+        series.getData().add(new XYChart.Data<>(\"3\", -3));\n+        assertEquals(3, XYChartShim.Series_getDataSize(series));\n+        assertEquals(3, XYChartShim.getPlotChildren(chart).size());\n+        assertEquals(4, series.getData().size());\n+        Node bar3 = series.getData().get(3).getNode();\n+        checkStyleClass(bar3, \"negative\");\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/chart\/BarChartTest.java","additions":85,"deletions":3,"binary":false,"changes":88,"status":"modified"}]}