{"files":[{"patch":"@@ -27,5 +27,2 @@\n-import static org.junit.jupiter.api.Assertions.assertEquals;\n-import static org.junit.jupiter.api.Assertions.assertFalse;\n-import static org.junit.jupiter.api.Assertions.assertNotNull;\n-import static org.junit.jupiter.api.Assertions.assertTrue;\n-import java.util.List;\n+import com.sun.javafx.scene.control.LabeledText;\n+import com.sun.javafx.scene.control.VirtualScrollBar;\n@@ -49,2 +46,7 @@\n-import com.sun.javafx.scene.control.LabeledText;\n-import com.sun.javafx.scene.control.VirtualScrollBar;\n+\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n@@ -335,5 +337,0 @@\n-        StageLoader sl = null;\n-        if (control.getScene() == null) {\n-            sl = new StageLoader(control);\n-        }\n-\n@@ -349,2 +346,3 @@\n-        if (sl != null) {\n-            sl.dispose();\n+        if (flow == null) {\n+            throw new IllegalArgumentException(\"VirtualFlow could not be found for: \" + control + \". \"\n+                    + \"Make sure that the Control is inside a Scene.\");\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/com\/sun\/javafx\/scene\/control\/infrastructure\/VirtualFlowTestUtils.java","additions":12,"deletions":14,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -71,0 +71,2 @@\n+\n+        stageLoader = new StageLoader(listView);\n@@ -135,0 +137,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -149,0 +153,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -175,0 +181,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -186,0 +194,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -256,0 +266,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -282,0 +294,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -307,0 +321,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -324,1 +340,1 @@\n-        listView.getItems().clear();\n+        listView = new ListView<>();\n@@ -367,0 +383,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -395,2 +413,0 @@\n-        stageLoader = new StageLoader(listView);\n-\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListViewMouseInputTest.java","additions":19,"deletions":3,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -570,0 +570,2 @@\n+        stageLoader = new StageLoader(list);\n+\n@@ -578,0 +580,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -665,0 +668,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -670,0 +675,1 @@\n+\n@@ -671,0 +677,2 @@\n+        Toolkit.getToolkit().firePulse();\n+\n@@ -680,0 +688,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -685,0 +695,1 @@\n+\n@@ -686,0 +697,2 @@\n+        Toolkit.getToolkit().firePulse();\n+\n@@ -702,0 +715,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -726,0 +741,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -774,0 +791,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -794,0 +813,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -874,0 +895,2 @@\n+        stageLoader = new StageLoader(listView);\n+\n@@ -1020,0 +1043,2 @@\n+        stageLoader = new StageLoader(textFieldListView);\n+\n@@ -1581,0 +1606,2 @@\n+        stageLoader = new StageLoader(stringListView);\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListViewTest.java","additions":27,"deletions":0,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -70,1 +70,0 @@\n-import org.junit.jupiter.api.AfterAll;\n@@ -117,0 +116,2 @@\n+    private StageLoader stageLoader;\n+\n@@ -126,2 +127,6 @@\n-    @AfterAll\n-    public static void tearDownClass() throws Exception {    }\n+    @AfterEach\n+    public void cleanup() {\n+        if (stageLoader != null) {\n+            stageLoader.dispose();\n+        }\n+    }\n@@ -1114,0 +1119,1 @@\n+        stageLoader = new StageLoader(currentControl);\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/MultipleSelectionModelImplTest.java","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -68,0 +68,1 @@\n+import test.com.sun.javafx.scene.control.infrastructure.StageLoader;\n@@ -114,0 +115,2 @@\n+    private StageLoader stageLoader;\n+\n@@ -127,2 +130,6 @@\n-    @AfterAll\n-    public static void tearDownClass() throws Exception {    }\n+    @AfterEach\n+    public void cleanup() {\n+        if (stageLoader != null) {\n+            stageLoader.dispose();\n+        }\n+    }\n@@ -454,0 +461,2 @@\n+            stageLoader = new StageLoader(currentControl);\n+\n@@ -511,0 +520,1 @@\n+            stageLoader = new StageLoader(currentControl);\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/SelectionModelImplTest.java","additions":12,"deletions":2,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -78,0 +78,2 @@\n+    private StageLoader stageLoader;\n+\n@@ -91,0 +93,2 @@\n+\n+        stageLoader = new StageLoader(tableView);\n@@ -95,0 +99,3 @@\n+        if (stageLoader != null) {\n+            stageLoader.dispose();\n+        }\n@@ -162,0 +169,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -177,0 +186,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -204,0 +215,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -215,0 +228,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -246,0 +261,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -263,0 +280,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -285,0 +304,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -307,0 +328,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -329,0 +352,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -351,0 +376,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -376,1 +403,1 @@\n-        StageLoader sl = new StageLoader(tableView);\n+        stageLoader = new StageLoader(tableView);\n@@ -394,2 +421,0 @@\n-\n-        sl.dispose();\n@@ -406,0 +431,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -439,0 +466,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -458,0 +487,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -473,0 +504,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -496,0 +529,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -508,1 +543,1 @@\n-        tableView.getItems().clear();\n+        tableView = new TableView<>();\n@@ -517,2 +552,2 @@\n-        StageLoader sl = new StageLoader(vbox);\n-        sl.getStage().requestFocus();\n+        stageLoader = new StageLoader(vbox);\n+        stageLoader.getStage().requestFocus();\n@@ -521,1 +556,0 @@\n-        Scene scene = sl.getStage().getScene();\n@@ -532,2 +566,0 @@\n-\n-        sl.dispose();\n@@ -571,0 +603,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -639,0 +673,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -702,0 +738,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -780,0 +818,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -782,1 +822,0 @@\n-        TableCell cell_0_2 = (TableCell) VirtualFlowTestUtils.getCell(table, 0, 2);\n@@ -868,0 +907,2 @@\n+        stageLoader = new StageLoader(table);\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TableViewMouseInputTest.java","additions":51,"deletions":10,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -1074,0 +1074,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -1082,0 +1084,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -1421,0 +1424,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -1430,0 +1435,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -1442,0 +1448,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -1477,0 +1484,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -1504,0 +1513,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -1530,0 +1541,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -1562,0 +1575,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -1723,0 +1738,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -1816,0 +1833,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -1858,0 +1877,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -1963,0 +1984,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -4829,1 +4852,1 @@\n-        StageLoader sl = new StageLoader(stringTableView);\n+        stageLoader = new StageLoader(stringTableView);\n@@ -4868,2 +4891,0 @@\n-\n-        sl.dispose();\n@@ -5521,0 +5542,2 @@\n+        stageLoader = new StageLoader(t);\n+\n@@ -5824,1 +5847,1 @@\n-        StageLoader sl = new StageLoader(table);\n+        stageLoader = new StageLoader(table);\n@@ -5852,2 +5875,0 @@\n-\n-        sl.dispose();\n@@ -5919,0 +5940,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -5953,0 +5976,2 @@\n+        stageLoader = new StageLoader(stringTableView);\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TableViewTest.java","additions":31,"deletions":6,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+import org.junit.jupiter.api.AfterEach;\n@@ -49,1 +50,1 @@\n-import test.com.sun.javafx.scene.control.infrastructure.VirtualFlowTestUtils;\n+import test.com.sun.javafx.scene.control.infrastructure.StageLoader;\n@@ -56,0 +57,10 @@\n+\n+    private StageLoader stageLoader;\n+\n+    @AfterEach\n+    public void cleanup() {\n+        if (stageLoader != null) {\n+            stageLoader.dispose();\n+        }\n+    }\n+\n@@ -72,2 +83,1 @@\n-        \/\/ important: actually creates cells\n-        VirtualFlowTestUtils.getCell(table, 0);\n+        stageLoader = new StageLoader(table);\n@@ -146,2 +156,1 @@\n-        \/\/ important: actually creates cells\n-        VirtualFlowTestUtils.getCell(tree, 0);\n+        stageLoader = new StageLoader(tree);\n@@ -220,8 +229,0 @@\n-    protected static <T extends Node> List<T> collectNodes(Node root, String selector, Class<T> type) {\n-        return (List<T>)root.\n-            lookupAll(selector).\n-            stream().\n-            filter((n) -> (n.getClass().isAssignableFrom(type))).\n-            collect(Collectors.toList());\n-    }\n-\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeAndTableViewTest.java","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -95,0 +95,2 @@\n+    private StageLoader stageLoader;\n+\n@@ -151,0 +153,3 @@\n+        if (stageLoader != null) {\n+            stageLoader.dispose();\n+        }\n@@ -227,0 +232,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -242,0 +249,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -270,0 +279,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -282,0 +293,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -313,0 +326,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -330,0 +345,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -353,0 +370,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -374,0 +393,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -397,0 +418,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -418,0 +441,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -443,0 +468,1 @@\n+        tableView.setShowRoot(true);\n@@ -444,1 +470,1 @@\n-\/\/        StageLoader sl = new StageLoader(tableView);\n+        stageLoader = new StageLoader(tableView);\n@@ -446,1 +472,0 @@\n-        tableView.setShowRoot(true);\n@@ -476,1 +501,0 @@\n-\n@@ -478,0 +502,3 @@\n+\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -547,1 +574,0 @@\n-\n@@ -549,0 +575,3 @@\n+\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -583,0 +612,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -604,0 +635,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -621,0 +654,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -645,0 +680,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -664,0 +701,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -748,0 +787,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -816,0 +857,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -883,0 +926,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -965,0 +1010,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -1061,0 +1108,2 @@\n+        stageLoader = new StageLoader(table);\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeTableViewMouseInputTest.java","additions":53,"deletions":4,"binary":false,"changes":57,"status":"modified"},{"patch":"@@ -1731,0 +1731,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -1739,0 +1741,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -2167,0 +2170,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -2176,0 +2181,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -2188,0 +2194,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -2230,0 +2237,1 @@\n+        stageLoader = new StageLoader(table);\n@@ -2446,0 +2454,2 @@\n+        stageLoader = new StageLoader(tableView);\n+\n@@ -2467,0 +2477,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -2491,0 +2503,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -2506,0 +2520,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -2529,0 +2545,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -2534,0 +2552,2 @@\n+        Toolkit.getToolkit().firePulse();\n+\n@@ -2550,0 +2570,2 @@\n+        Toolkit.getToolkit().firePulse();\n+\n@@ -2706,0 +2728,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -2794,0 +2818,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -2833,0 +2859,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -4366,0 +4394,2 @@\n+        stageLoader = new StageLoader(treeTableView);\n+\n@@ -5292,1 +5322,1 @@\n-        StageLoader sl = new StageLoader(stringTreeView);\n+        stageLoader = new StageLoader(stringTreeView);\n@@ -5338,2 +5368,0 @@\n-\n-        sl.dispose();\n@@ -6339,0 +6367,2 @@\n+        stageLoader = new StageLoader(t);\n+\n@@ -6893,0 +6923,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -7012,0 +7044,2 @@\n+        stageLoader = new StageLoader(table);\n+\n@@ -7057,0 +7091,2 @@\n+        stageLoader = new StageLoader(stringTreeView);\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeTableViewTest.java","additions":39,"deletions":3,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -75,0 +75,2 @@\n+    private StageLoader stageLoader;\n+\n@@ -124,0 +126,2 @@\n+\n+        stageLoader = new StageLoader(treeView);\n@@ -128,0 +132,3 @@\n+        if (stageLoader != null) {\n+            stageLoader.dispose();\n+        }\n@@ -188,0 +195,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -202,0 +211,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -228,0 +239,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -239,0 +252,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -338,1 +353,0 @@\n-\n@@ -340,0 +354,3 @@\n+\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -368,1 +385,0 @@\n-\n@@ -370,0 +386,3 @@\n+\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -397,0 +416,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -421,0 +442,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -437,1 +460,2 @@\n-        root.getChildren().clear();\n+        treeView = new TreeView<>(new TreeItem<>());\n+        root = treeView.getRoot();\n@@ -448,2 +472,2 @@\n-        StageLoader sl = new StageLoader(vbox);\n-        sl.getStage().requestFocus();\n+        stageLoader= new StageLoader(vbox);\n+        stageLoader.getStage().requestFocus();\n@@ -452,1 +476,0 @@\n-        Scene scene = sl.getStage().getScene();\n@@ -463,2 +486,0 @@\n-\n-        sl.dispose();\n@@ -489,0 +510,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeViewMouseInputTest.java","additions":31,"deletions":8,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -755,0 +755,2 @@\n+        stageLoader = new StageLoader(tree);\n+\n@@ -763,0 +765,1 @@\n+        Toolkit.getToolkit().firePulse();\n@@ -793,0 +796,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -993,0 +998,1 @@\n+        stageLoader = new StageLoader(treeView);\n@@ -1129,0 +1135,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -1143,0 +1151,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -1162,0 +1172,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -1173,0 +1185,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -1248,0 +1262,2 @@\n+        stageLoader = new StageLoader(treeView);\n+\n@@ -1850,0 +1866,2 @@\n+        stageLoader = new StageLoader(textFieldTreeView);\n+\n@@ -2789,1 +2807,1 @@\n-        StageLoader sl = new StageLoader(stringTreeView);\n+        stageLoader = new StageLoader(stringTreeView);\n@@ -2829,2 +2847,0 @@\n-\n-        sl.dispose();\n@@ -4145,1 +4161,3 @@\n-        IndexedCell expandedCell = VirtualFlowTestUtils.getCell(treeView, 100);\n+\n+        stageLoader = new StageLoader(treeView);\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeViewTest.java","additions":22,"deletions":4,"binary":false,"changes":26,"status":"modified"}]}