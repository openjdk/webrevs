{"files":[{"patch":"@@ -75,1 +75,1 @@\n-            StyledOutput out = StyledOutput.forPlainText();\n+            StyledOutput out = StyledOutput.forPlainText(getLineEnding());\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/notebook\/CodeCellTextModel.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -73,1 +73,1 @@\n-            StyledOutput out = StyledOutput.forPlainText();\n+            StyledOutput out = StyledOutput.forPlainText(getLineEnding());\n","filename":"apps\/samples\/RichTextAreaDemo\/src\/com\/oracle\/demo\/richtext\/notebook\/TextCellTextModel.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,2 @@\n+import com.sun.jfx.incubator.scene.control.richtext.util.RichUtils;\n+import jfx.incubator.scene.control.richtext.LineEnding;\n@@ -34,1 +36,1 @@\n-    private String newline = System.getProperty(\"line.separator\");\n+    private final String newline;\n@@ -36,10 +38,3 @@\n-    public StringBuilderStyledOutput(int initialCapacity) {\n-        sb = new StringBuilder(initialCapacity);\n-    }\n-\n-    public StringBuilderStyledOutput() {\n-        this(1024);\n-    }\n-\n-    public void setLineSeparator(String s) {\n-        newline = s;\n+    public StringBuilderStyledOutput(LineEnding lineEnding) {\n+        sb = new StringBuilder(1024);\n+        newline = lineEnding.getText();\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/StringBuilderStyledOutput.java","additions":7,"deletions":12,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -428,2 +428,1 @@\n-        try (StringBuilderStyledOutput out = new StringBuilderStyledOutput()) {\n-            out.setLineSeparator(\"\\n\");\n+        try (StringBuilderStyledOutput out = new StringBuilderStyledOutput(m.getLineEnding())) {\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/CodeArea.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,76 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jfx.incubator.scene.control.richtext;\n+\n+\/**\n+ * Specifies line separator (line ending) characters.\n+ *\n+ * @since 26\n+ *\/\n+public enum LineEnding {\n+    \/** Legacy Mac OS line ending, ASCII CR (0x0d). *\/\n+    CR,\n+    \/** Windows line ending, sequence of CR\/LF (0x0d 0x0a). *\/\n+    CRLF,\n+    \/** macOS\/Unix line ending, ASCII LF (0x0a). *\/\n+    LF;\n+\n+    private static final LineEnding system = init();\n+\n+    \/**\n+     * Returns the line ending as a {@code String}.\n+     * @return the line ending string\n+     *\/\n+    public String getText() {\n+        return switch(this) {\n+            case CR -> \"\\r\";\n+            case CRLF -> \"\\r\\n\";\n+            case LF -> \"\\n\";\n+        };\n+    }\n+\n+    \/**\n+     * Returns the {@code LineEnding} based on the value of system line separator string\n+     * {@link System#lineSeparator()}.\n+     * @return the system default line ending\n+     *\/\n+    public static LineEnding system() {\n+        return system;\n+    }\n+\n+    private static LineEnding init() {\n+        String s = System.lineSeparator();\n+        if (s != null) {\n+            return switch (s) {\n+                case \"\\r\" -> CR;\n+                case \"\\r\\n\" -> CRLF;\n+                case \"\\n\" -> LF;\n+                default -> LF;\n+            };\n+        }\n+        return LineEnding.LF;\n+    }\n+}\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/LineEnding.java","additions":76,"deletions":0,"binary":false,"changes":76,"status":"added"},{"patch":"@@ -622,0 +622,29 @@\n+    \/**\n+     * Convenience method which delegates to {@link StyledTextModel#getLineEnding()}.\n+     * Returns {@link LineEnding#system()} value if the model is {@code null}.\n+     *\n+     * @return the model's line ending value\n+     * @since 26\n+     *\/\n+    public final LineEnding getLineEnding() {\n+        StyledTextModel m = getModel();\n+        return (m == null ? LineEnding.system() : m.getLineEnding());\n+    }\n+\n+    \/**\n+     * Sets the model's line ending characters.\n+     * Delegates to {@link StyledTextModel#setLineEnding(LineEnding)}.\n+     * This method does nothing if the model is {@code null}.\n+     *\n+     * @param value the line ending value, cannot be null\n+     * @throws NullPointerException if the value is null\n+     * @since 26\n+     *\/\n+    public final void setLineEnding(LineEnding value) {\n+        Objects.requireNonNull(value, \"line ending must not be null\");\n+        StyledTextModel m = getModel();\n+        if (m != null) {\n+            m.setLineEnding(value);\n+        }\n+    }\n+\n@@ -1482,3 +1511,1 @@\n-        \/\/ TODO JDK-8370140 (line separator property)\n-        String lineSeparator = System.getProperty(\"line.separator\");\n-\n+        String lineSeparator = m.getLineEnding().getText();\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/RichTextArea.java","additions":30,"deletions":3,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n@@ -64,1 +64,1 @@\n-        StringBuilderStyledOutput out = new StringBuilderStyledOutput();\n+        StringBuilderStyledOutput out = new StringBuilderStyledOutput(m.getLineEnding());\n@@ -71,2 +71,1 @@\n-        Charset charset = Charset.forName(\"utf-8\");\n-        byte[] newline = System.getProperty(\"line.separator\").getBytes(charset);\n+        byte[] newline = m.getLineEnding().getText().getBytes(StandardCharsets.UTF_8);\n@@ -83,1 +82,1 @@\n-                    byte[] b = text.getBytes(charset);\n+                    byte[] b = text.getBytes(StandardCharsets.UTF_8);\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/model\/PlainTextFormatHandler.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import jfx.incubator.scene.control.richtext.LineEnding;\n@@ -54,1 +55,1 @@\n-     * Creates an instance of a plain text StyledOutput.\n+     * Creates an instance of a plain text StyledOutput with the platform line ending.\n@@ -58,1 +59,11 @@\n-        return new StringBuilderStyledOutput();\n+        return new StringBuilderStyledOutput(LineEnding.system());\n+    }\n+\n+    \/**\n+     * Creates an instance of a plain text StyledOutput with the specified line ending characters.\n+     * @param lineEnding the line ending characters\n+     * @return the instance of a plain text StyledOutput\n+     * @since 26\n+     *\/\n+    public static StyledOutput forPlainText(LineEnding lineEnding) {\n+        return new StringBuilderStyledOutput(lineEnding);\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/model\/StyledOutput.java","additions":14,"deletions":3,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -52,0 +52,1 @@\n+import jfx.incubator.scene.control.richtext.LineEnding;\n@@ -291,0 +292,1 @@\n+    private LineEnding lineEnding = LineEnding.system();\n@@ -1063,0 +1065,22 @@\n+\n+    \/**\n+     * Specifies the line ending characters.\n+     *\n+     * @return the line ending value\n+     * @defaultValue {@link LineEnding#system()}\n+     * @since 26\n+     *\/\n+    public final LineEnding getLineEnding() {\n+        return lineEnding;\n+    }\n+\n+    \/**\n+     * Sets the line ending characters.\n+     * @param value the line ending value, cannot be null\n+     * @throws NullPointerException if the value is null\n+     * @since 26\n+     *\/\n+    public final void setLineEnding(LineEnding value) {\n+        Objects.requireNonNull(value, \"line ending must not be null\");\n+        lineEnding = value;\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/model\/StyledTextModel.java","additions":24,"deletions":0,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+import jfx.incubator.scene.control.richtext.LineEnding;\n@@ -222,0 +223,1 @@\n+        control.setLineEnding(LineEnding.LF);\n@@ -266,0 +268,43 @@\n+\n+    @Test\n+    public void lineEnding() {\n+        control.setText(\"1\\n2\\n3\");\n+        assertEquals(3, control.getParagraphCount());\n+        t(LineEnding.CR, \"1\\r2\\r3\");\n+        t(LineEnding.CRLF, \"1\\r\\n2\\r\\n3\");\n+        t(LineEnding.LF, \"1\\n2\\n3\");\n+    }\n+\n+    @Test\n+    public void lineEndingNull() {\n+        assertThrows(NullPointerException.class, () -> {\n+            control.setLineEnding(null);\n+        });\n+    }\n+\n+    private void t(LineEnding lineEnding, String expected) {\n+        control.setLineEnding(lineEnding);\n+        assertEquals(lineEnding, control.getLineEnding());\n+        assertEquals(expected, control.getText());\n+        control.select(TextPos.ZERO, control.getDocumentEnd());\n+        control.copy();\n+        assertEquals(expected, Clipboard.getSystemClipboard().getString());\n+    }\n+\n+    @Test\n+    public void setText() {\n+        String expected = \"1\\n2\\n3\\n4\";\n+        String[] variants = {\n+            \"1\\n2\\n3\\n4\",\n+            \"1\\r2\\r3\\r4\",\n+            \"1\\r\\n2\\r\\n3\\r\\n4\",\n+            \"1\\r2\\n3\\r\\n4\"\n+        };\n+        control.setLineEnding(LineEnding.LF);\n+        for (int i = 0; i < variants.length; i++) {\n+            String s = variants[i];\n+            control.setText(s);\n+            String text = control.getText();\n+            assertEquals(expected, text, \"variant=\" + i);\n+        }\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/CodeAreaTest.java","additions":45,"deletions":0,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n@@ -55,0 +56,1 @@\n+import jfx.incubator.scene.control.richtext.LineEnding;\n@@ -65,0 +67,1 @@\n+import jfx.incubator.scene.control.richtext.model.StyledTextModel;\n@@ -360,0 +363,37 @@\n+    @Test\n+    public void lineEndingCopy() {\n+        control.appendText(\"1\\n2\\n3\");\n+        assertEquals(3, control.getParagraphCount());\n+        t(LineEnding.CR, \"1\\r2\\r3\");\n+        t(LineEnding.CRLF, \"1\\r\\n2\\r\\n3\");\n+        t(LineEnding.LF, \"1\\n2\\n3\");\n+    }\n+\n+    @Test\n+    public void lineEndingNull() {\n+        assertThrows(NullPointerException.class, () -> {\n+            control.getModel().setLineEnding(null);\n+        });\n+    }\n+\n+    @Test\n+    public void lineEndingNullModel() {\n+        control.setModel(null);\n+        assertEquals(LineEnding.system(), control.getLineEnding());\n+        control.setLineEnding(LineEnding.CR);\n+        assertEquals(LineEnding.system(), control.getLineEnding());\n+        assertThrows(NullPointerException.class, () -> {\n+            control.setLineEnding(null);\n+        });\n+    }\n+\n+    private void t(LineEnding lineEnding, String expected) {\n+        StyledTextModel m = control.getModel();\n+        m.setLineEnding(lineEnding);\n+        assertEquals(lineEnding, m.getLineEnding());\n+        assertEquals(expected, text());\n+        control.select(TextPos.ZERO, control.getDocumentEnd());\n+        control.copy();\n+        assertEquals(expected, Clipboard.getSystemClipboard().getString());\n+    }\n+\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/RichTextAreaTest.java","additions":40,"deletions":0,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n@@ -35,0 +36,1 @@\n+import jfx.incubator.scene.control.richtext.LineEnding;\n@@ -43,0 +45,1 @@\n+import test.jfx.incubator.scene.control.richtext.support.RTUtil;\n@@ -275,0 +278,25 @@\n+\n+    @Test\n+    public void lineEnding() {\n+        RichTextModel m = createModel(\"1\\n2\\n3\");\n+        assertEquals(LineEnding.system(), m.getLineEnding());\n+        assertEquals(3, m.size());\n+        m.setLineEnding(LineEnding.CR);\n+        assertEquals(LineEnding.CR, m.getLineEnding());\n+        assertEquals(\"1\\r2\\r3\", RTUtil.getText(m));\n+        m.setLineEnding(LineEnding.CRLF);\n+        assertEquals(LineEnding.CRLF, m.getLineEnding());\n+        assertEquals(\"1\\r\\n2\\r\\n3\", RTUtil.getText(m));\n+        m.setLineEnding(LineEnding.LF);\n+        assertEquals(LineEnding.LF, m.getLineEnding());\n+        assertEquals(\"1\\n2\\n3\", RTUtil.getText(m));\n+    }\n+\n+    @Test\n+    public void lineEndingNull() {\n+        RichTextModel m = createModel(\"1\\n2\\n3\");\n+        assertThrows(NullPointerException.class, () -> {\n+            m.setLineEnding(null);\n+        });\n+        assertEquals(LineEnding.system(), m.getLineEnding());\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/model\/TestRichTextModel.java","additions":28,"deletions":0,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+import jfx.incubator.scene.control.richtext.model.StyledTextModel;\n@@ -64,0 +65,16 @@\n+        try (ByteArrayOutputStream out = new ByteArrayOutputStream()) {\n+            control.write(DataFormat.PLAIN_TEXT, out);\n+            byte[] b = out.toByteArray();\n+            return new String(b, StandardCharsets.UTF_8);\n+        } catch (IOException e) {\n+            throw new AssertionError(e);\n+        }\n+    }\n+\n+    \/**\n+     * Extracts plain text from the supplied StyledTextModel, using {@code write(DataFormat.PLAIN_TEXT)} method.\n+     *\n+     * @param model the model\n+     * @return the plain text\n+     *\/\n+    public static String getText(StyledTextModel model) {\n@@ -67,1 +84,1 @@\n-                control.write(DataFormat.PLAIN_TEXT, out);\n+                model.write(null, DataFormat.PLAIN_TEXT, out);\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/support\/RTUtil.java","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"}]}