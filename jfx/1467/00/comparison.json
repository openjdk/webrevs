{"files":[{"patch":"@@ -124,0 +124,1 @@\n+    \/** contains MenuBarButton's children only *\/\n@@ -125,0 +126,2 @@\n+    \/** index of *focused* MenuBarButton *\/\n+    private int focusedMenuIndex = -1;\n@@ -130,5 +133,0 @@\n-    \/\/ represents the currently _focused_ menu. If openMenu is non-null, this should equal\n-    \/\/ openMenu. If openMenu is null, this can be any menu in the menu bar.\n-    private Menu focusedMenu;\n-    private int focusedMenuIndex = -1;\n-\n@@ -298,1 +296,1 @@\n-                    if (focusedMenu != null) {\n+                    if (focusedMenuIndex >= 0) {\n@@ -432,1 +430,1 @@\n-                MenuButton menuButton = getNodeForMenu(focusedMenuIndex);\n+                MenuButton menuButton = menuBarButtonAt(focusedMenuIndex);\n@@ -448,1 +446,0 @@\n-        focusedMenu = (focusedMenuIndex != -1) ? getSkinnable().getMenus().get(index) : null;\n@@ -736,2 +733,2 @@\n-    \/\/ For testing purpose only.\n-    MenuButton getNodeForMenu(int i) {\n+    \/\/ package protected for testing purposes\n+    MenuBarButton menuBarButtonAt(int i) {\n@@ -1086,0 +1083,1 @@\n+        Menu focusedMenu = menuBarButtonAt(focusedMenuIndex).menu;\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/MenuBarSkin.java","additions":8,"deletions":10,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-        return skin.getNodeForMenu(i);\n+        return skin.menuBarButtonAt(i);\n","filename":"modules\/javafx.controls\/src\/shims\/java\/javafx\/scene\/control\/skin\/MenuBarSkinShim.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -719,0 +719,64 @@\n+\n+    \/** Tests keyboard navigation with invisible menu JDK-8330304 *\/\n+    @Test\n+    public void testKeyNavigationWithInvisibleMenuItem() {\n+        Menu menu1 = mkMenu(\"1\", 3);\n+        Menu menu2 = mkMenu(\"2\", 3);\n+        Menu menu3 = mkMenu(\"3\", 3);\n+        Menu menu4 = mkMenu(\"4\", 3);\n+        menuBar.getMenus().setAll(menu1, menu2, menu3, menu4);\n+\n+        menu2.setVisible(false);\n+\n+        VBox root = new VBox(menuBar);\n+        startApp(root);\n+        tk.firePulse();\n+\n+        MenuBarSkin skin = (MenuBarSkin)menuBar.getSkin();\n+        assertTrue(skin != null);\n+\n+        double x = (menuBar.localToScene(menuBar.getLayoutBounds())).getMinX();\n+        double y = (menuBar.localToScene(menuBar.getLayoutBounds())).getMinY();\n+\n+        \/\/ show menu1 using mouse\n+        MenuButton mb = MenuBarSkinShim.getNodeForMenu(skin, 0);\n+        mb.getScene().getWindow().requestFocus();\n+        SceneHelper.processMouseEvent(scene,\n+            MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, x+20, y+20));\n+        SceneHelper.processMouseEvent(scene,\n+            MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_RELEASED, x+20, y+20));\n+        assertTrue(menu1.isShowing());\n+\n+        \/\/ show menu3 with RIGHT key press, menu2 is hidden and should be skipped\n+        KeyEventFirer keyboard = new KeyEventFirer(mb.getScene());\n+        keyboard.doKeyPress(KeyCode.RIGHT);\n+        tk.firePulse();\n+\n+        assertTrue(menu3.isShowing());\n+\n+        \/\/ show menu4\n+        keyboard.doKeyPress(KeyCode.RIGHT);\n+        tk.firePulse();\n+\n+        assertTrue(menu4.isShowing());\n+\n+        \/\/ show menu3\n+        keyboard.doKeyPress(KeyCode.LEFT);\n+        tk.firePulse();\n+\n+        assertTrue(menu3.isShowing());\n+\n+        \/\/ show menu1 (menu2 is hidden)\n+        keyboard.doKeyPress(KeyCode.LEFT);\n+        tk.firePulse();\n+\n+        assertTrue(menu1.isShowing());\n+    }\n+\n+    private Menu mkMenu(String name, int itemCount) {\n+        Menu m = new Menu(\"Menu\" + name);\n+        for (int i = 0; i < itemCount; i++) {\n+            m.getItems().add(new MenuItem(\"Menu\" + name + \"Item\" + i));\n+        }\n+        return m;\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/MenuBarTest.java","additions":65,"deletions":1,"binary":false,"changes":66,"status":"modified"}]}