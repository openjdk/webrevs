{"files":[{"patch":"@@ -33,0 +33,1 @@\n+import java.util.concurrent.TimeUnit;\n@@ -42,0 +43,2 @@\n+import javafx.stage.Stage;\n+import javafx.stage.WindowEvent;\n@@ -49,1 +52,0 @@\n-import javafx.stage.Stage;\n@@ -57,0 +59,1 @@\n+import static test.util.Util.TIMEOUT;\n@@ -67,2 +70,4 @@\n-    static final ByteArrayOutputStream out = new ByteArrayOutputStream(2048 * 1024);\n-    static final PrintStream defaultErrorStream = System.err;\n+    static CountDownLatch launchLatch = new CountDownLatch(1);\n+\n+    static final ByteArrayOutputStream out = new ByteArrayOutputStream(1024 * 1024);\n+    static PrintStream defaultErrorStream = System.err;\n@@ -80,0 +85,4 @@\n+        defaultErrorStream = System.err;\n+        \/\/ Capture stderr:\n+        System.setErr(new PrintStream(out, true));\n+\n@@ -89,0 +98,1 @@\n+        System.setErr(defaultErrorStream);\n@@ -94,1 +104,0 @@\n-\n@@ -97,3 +106,0 @@\n-        \/\/ Capture stderr:\n-        System.setErr(new PrintStream(out, true));\n-\n@@ -103,0 +109,1 @@\n+            stage.addEventHandler(WindowEvent.WINDOW_SHOWN, e -> Platform.runLater(launchLatch::countDown));\n@@ -107,1 +114,6 @@\n-            Thread.sleep(2000L);\n+            if (!launchLatch.await(TIMEOUT, TimeUnit.MILLISECONDS)) {\n+                Assert.fail(\"Timeout waiting for stage to show\");\n+            }\n+            \/\/ Wait to ensure stderr will contain the potential exception:\n+            Thread.sleep(500L);\n+\n@@ -113,0 +125,1 @@\n+        System.err.flush();\n","filename":"tests\/system\/src\/test\/java\/test\/com\/sun\/marlin\/ScaleX0Test.java","additions":21,"deletions":8,"binary":false,"changes":29,"status":"modified"}]}