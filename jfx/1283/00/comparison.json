{"files":[{"patch":"@@ -43,0 +43,2 @@\n+import java.util.HashMap;\n+import java.util.Map;\n@@ -60,0 +62,2 @@\n+    private final Map <Menu, ListChangeListener> menuListeners = new HashMap<>();\n+    private final Map <ListChangeListener, ObservableList> listenerItems  = new HashMap<>();\n@@ -114,0 +118,8 @@\n+        ListChangeListener lcl = menuListeners.get(menu);\n+        if (lcl != null) {\n+            ObservableList target = listenerItems.get(lcl);\n+            target.removeListener(lcl);\n+            menuListeners.remove(menu);\n+            listenerItems.remove(lcl);\n+        }\n+\n@@ -116,1 +128,0 @@\n-\n@@ -119,0 +130,1 @@\n+                menu.remove(i);\n@@ -151,1 +163,27 @@\n-        filteredItems.addListener((ListChangeListener.Change<? extends MenuItemBase> change) -> {\n+        ListChangeListener menuItemListener = createListener(glassMenu);\n+        filteredItems.addListener(menuItemListener);\n+        menuListeners.put(glassMenu, menuItemListener);\n+        listenerItems.put(menuItemListener, filteredItems);\n+\n+        for (MenuItemBase item : items) {\n+            if (item instanceof MenuBase) {\n+                \/\/ submenu\n+                addMenu(glassMenu, (MenuBase)item);\n+            } else {\n+                \/\/ menu item\n+                addMenuItem(glassMenu, item);\n+            }\n+        }\n+        glassMenu.setPixels(getPixels(mb));\n+\n+        setMenuBindings(glassMenu, mb);\n+\n+        if (parent != null) {\n+            parent.insert(glassMenu, pos);\n+        } else {\n+            glassSystemMenuBar.insert(glassMenu, pos);\n+        }\n+    }\n+\n+    private ListChangeListener createListener(final Menu glassMenu) {\n+        ListChangeListener<MenuItemBase> answer = ((ListChangeListener.Change<? extends MenuItemBase> change) -> {\n@@ -173,19 +211,1 @@\n-\n-        for (MenuItemBase item : items) {\n-            if (item instanceof MenuBase) {\n-                \/\/ submenu\n-                addMenu(glassMenu, (MenuBase)item);\n-            } else {\n-                \/\/ menu item\n-                addMenuItem(glassMenu, item);\n-            }\n-        }\n-        glassMenu.setPixels(getPixels(mb));\n-\n-        setMenuBindings(glassMenu, mb);\n-\n-        if (parent != null) {\n-            parent.insert(glassMenu, pos);\n-        } else {\n-            glassSystemMenuBar.insert(glassMenu, pos);\n-        }\n+        return answer;\n@@ -194,0 +214,1 @@\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/GlassSystemMenu.java","additions":42,"deletions":21,"binary":false,"changes":63,"status":"modified"}]}