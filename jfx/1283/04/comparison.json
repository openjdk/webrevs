{"files":[{"patch":"@@ -43,0 +43,2 @@\n+import java.util.HashMap;\n+import java.util.Map;\n@@ -48,0 +50,2 @@\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n@@ -60,0 +64,3 @@\n+    private final Map<Menu, ListChangeListener> menuListeners = new HashMap<>();\n+    private final Map<ListChangeListener, ObservableList> listenerItems = new HashMap<>();\n+    private BooleanProperty active;\n@@ -88,0 +95,4 @@\n+        if (active != null) {\n+            active.set(false);\n+        }\n+        active = new SimpleBooleanProperty(true);\n@@ -114,0 +125,8 @@\n+        ListChangeListener lcl = menuListeners.get(menu);\n+        if (lcl != null) {\n+            ObservableList target = listenerItems.get(lcl);\n+            target.removeListener(lcl);\n+            menuListeners.remove(menu);\n+            listenerItems.remove(lcl);\n+        }\n+\n@@ -116,1 +135,0 @@\n-\n@@ -119,0 +137,1 @@\n+                menu.remove(i);\n@@ -151,1 +170,27 @@\n-        filteredItems.addListener((ListChangeListener.Change<? extends MenuItemBase> change) -> {\n+        ListChangeListener menuItemListener = createListener(glassMenu);\n+        filteredItems.addListener(menuItemListener);\n+        menuListeners.put(glassMenu, menuItemListener);\n+        listenerItems.put(menuItemListener, filteredItems);\n+\n+        for (MenuItemBase item : items) {\n+            if (item instanceof MenuBase) {\n+                \/\/ submenu\n+                addMenu(glassMenu, (MenuBase)item);\n+            } else {\n+                \/\/ menu item\n+                addMenuItem(glassMenu, item);\n+            }\n+        }\n+        glassMenu.setPixels(getPixels(mb));\n+\n+        setMenuBindings(glassMenu, mb);\n+\n+        if (parent != null) {\n+            parent.insert(glassMenu, pos);\n+        } else {\n+            glassSystemMenuBar.insert(glassMenu, pos);\n+        }\n+    }\n+\n+    private ListChangeListener<MenuItemBase> createListener(final Menu glassMenu) {\n+        return (ListChangeListener.Change<? extends MenuItemBase> change) -> {\n@@ -172,20 +217,1 @@\n-        });\n-\n-        for (MenuItemBase item : items) {\n-            if (item instanceof MenuBase) {\n-                \/\/ submenu\n-                addMenu(glassMenu, (MenuBase)item);\n-            } else {\n-                \/\/ menu item\n-                addMenuItem(glassMenu, item);\n-            }\n-        }\n-        glassMenu.setPixels(getPixels(mb));\n-\n-        setMenuBindings(glassMenu, mb);\n-\n-        if (parent != null) {\n-            parent.insert(glassMenu, pos);\n-        } else {\n-            glassSystemMenuBar.insert(glassMenu, pos);\n-        }\n+        };\n@@ -194,0 +220,1 @@\n+\n@@ -195,3 +222,3 @@\n-        mb.textProperty().addListener(valueModel -> glassMenu.setTitle(parseText(mb)));\n-        mb.disableProperty().addListener(valueModel -> glassMenu.setEnabled(!mb.isDisable()));\n-        mb.mnemonicParsingProperty().addListener(valueModel -> glassMenu.setTitle(parseText(mb)));\n+        mb.textProperty().when(active).addListener(valueModel -> glassMenu.setTitle(parseText(mb)));\n+        mb.disableProperty().when(active).addListener(valueModel -> glassMenu.setEnabled(!mb.isDisable()));\n+        mb.mnemonicParsingProperty().when(active).addListener(valueModel -> glassMenu.setTitle(parseText(mb)));\n@@ -252,1 +279,1 @@\n-            menuitem.textProperty().addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n+            menuitem.textProperty().when(active).addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n@@ -255,1 +282,1 @@\n-            menuitem.graphicProperty().addListener(valueModel -> {\n+            menuitem.graphicProperty().when(active).addListener(valueModel -> {\n@@ -260,1 +287,1 @@\n-            menuitem.disableProperty().addListener(valueModel -> glassSubMenuItem.setEnabled(!menuitem.isDisable()));\n+            menuitem.disableProperty().when(active).addListener(valueModel -> glassSubMenuItem.setEnabled(!menuitem.isDisable()));\n@@ -263,1 +290,1 @@\n-            menuitem.acceleratorProperty().addListener(valueModel -> setShortcut(glassSubMenuItem, menuitem));\n+            menuitem.acceleratorProperty().when(active).addListener(valueModel -> setShortcut(glassSubMenuItem, menuitem));\n@@ -265,1 +292,1 @@\n-            menuitem.mnemonicParsingProperty().addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n+            menuitem.mnemonicParsingProperty().when(active).addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n@@ -270,1 +297,1 @@\n-                checkItem.selectedProperty().addListener(valueModel -> glassSubMenuItem.setChecked(checkItem.isSelected()));\n+                checkItem.selectedProperty().when(active).addListener(valueModel -> glassSubMenuItem.setChecked(checkItem.isSelected()));\n@@ -274,1 +301,1 @@\n-                radioItem.selectedProperty().addListener(valueModel -> glassSubMenuItem.setChecked(radioItem.isSelected()));\n+                radioItem.selectedProperty().when(active).addListener(valueModel -> glassSubMenuItem.setChecked(radioItem.isSelected()));\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/GlassSystemMenu.java","additions":59,"deletions":32,"binary":false,"changes":91,"status":"modified"}]}