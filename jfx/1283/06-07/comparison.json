{"files":[{"patch":"@@ -205,0 +205,2 @@\n+                        Object item = menuItemList.get(i);\n+                        if (item instanceof Menu menu) clearMenu(menu);\n@@ -279,1 +281,1 @@\n-            menuitem.textProperty().when(active).addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n+            menuitem.textProperty().addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n@@ -282,1 +284,1 @@\n-            menuitem.graphicProperty().when(active).addListener(valueModel -> {\n+            menuitem.graphicProperty().addListener(valueModel -> {\n@@ -286,2 +288,2 @@\n-            glassSubMenuItem.setEnabled(! menuitem.isDisable());\n-            menuitem.disableProperty().when(active).addListener(valueModel -> glassSubMenuItem.setEnabled(!menuitem.isDisable()));\n+            glassSubMenuItem.setEnabled(!menuitem.isDisable());\n+            menuitem.disableProperty().addListener(valueModel -> glassSubMenuItem.setEnabled(!menuitem.isDisable()));\n@@ -290,1 +292,1 @@\n-            menuitem.acceleratorProperty().when(active).addListener(valueModel -> setShortcut(glassSubMenuItem, menuitem));\n+            menuitem.acceleratorProperty().addListener(valueModel -> setShortcut(glassSubMenuItem, menuitem));\n@@ -292,1 +294,1 @@\n-            menuitem.mnemonicParsingProperty().when(active).addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n+            menuitem.mnemonicParsingProperty().addListener(valueModel -> glassSubMenuItem.setTitle(parseText(menuitem)));\n@@ -295,1 +297,1 @@\n-                final CheckMenuItemBase checkItem = (CheckMenuItemBase)menuitem;\n+                final CheckMenuItemBase checkItem = (CheckMenuItemBase) menuitem;\n@@ -297,1 +299,1 @@\n-                checkItem.selectedProperty().when(active).addListener(valueModel -> glassSubMenuItem.setChecked(checkItem.isSelected()));\n+                checkItem.selectedProperty().addListener(valueModel -> glassSubMenuItem.setChecked(checkItem.isSelected()));\n@@ -299,1 +301,1 @@\n-                final RadioMenuItemBase radioItem = (RadioMenuItemBase)menuitem;\n+                final RadioMenuItemBase radioItem = (RadioMenuItemBase) menuitem;\n@@ -301,1 +303,1 @@\n-                radioItem.selectedProperty().when(active).addListener(valueModel -> glassSubMenuItem.setChecked(radioItem.isSelected()));\n+                radioItem.selectedProperty().addListener(valueModel -> glassSubMenuItem.setChecked(radioItem.isSelected()));\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/GlassSystemMenu.java","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -235,0 +235,44 @@\n+    CountDownLatch removeMenuLatch = new CountDownLatch(1);\n+\n+    @Test\n+    public void testRemoveMenu() throws InterruptedException {\n+        failed.set(false);\n+        Util.runAndWait(() -> {\n+            Thread.currentThread().setUncaughtExceptionHandler((t,e) -> {\n+                e.printStackTrace();\n+                failed.set(true);\n+                removeMenuLatch.countDown();\n+            });\n+            createRemoveMenuStage();\n+        });\n+        removeMenuLatch.await();\n+        assertFalse(failed.get());\n+    }\n+\n+    public void createRemoveMenuStage() {\n+        Stage stage = new Stage();\n+        VBox root = new VBox();\n+\n+        final MenuBar menuBar = new MenuBar();\n+\n+        Menu mainMenu = new Menu(\"MainMenu\");\n+        Menu subMenu = new Menu(\"SubMenu\");\n+        subMenu.getItems().addAll(new MenuItem(\"submenuitem1\"), new MenuItem(\"submenuitem2\"));\n+        mainMenu.getItems().add(subMenu);\n+        menuBar.getMenus().add(mainMenu);\n+\n+        menuBar.setUseSystemMenuBar(true);\n+        root.getChildren().add(menuBar);\n+\n+        Scene scene = new Scene(root);\n+        stage.setScene(scene);\n+        stage.show();\n+\n+        Platform.runLater(() -> {\n+            mainMenu.getItems().clear();\n+            mainMenu.getItems().add(subMenu);\n+            subMenu.getItems().addAll(new MenuItem(\"new item 1\"), new MenuItem(\"new item 2\"));\n+            removeMenuLatch.countDown();\n+        });\n+    }\n+\n","filename":"tests\/system\/src\/test\/java\/test\/com\/sun\/javafx\/tk\/quantum\/SystemMenuBarTest.java","additions":44,"deletions":0,"binary":false,"changes":44,"status":"modified"}]}