{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -267,0 +267,1 @@\n+    pthread_mutex_init(&mBandLock, NULL);\n@@ -287,0 +288,2 @@\n+\n+    pthread_mutex_destroy(&mBandLock);\n@@ -302,0 +305,1 @@\n+    lockBands();\n@@ -309,1 +313,3 @@\n-    return mEQBands[frequency];\n+    CEqualizerBand *band = mEQBands[frequency];\n+    unlockBands();\n+    return band;\n@@ -313,0 +319,1 @@\n+    lockBands();\n@@ -318,0 +325,1 @@\n+        unlockBands();\n@@ -320,0 +328,1 @@\n+    unlockBands();\n@@ -324,0 +333,1 @@\n+    lockBands();\n@@ -334,0 +344,1 @@\n+    unlockBands();\n@@ -395,0 +406,1 @@\n+    lockBands();\n@@ -401,0 +413,1 @@\n+    unlockBands();\n","filename":"modules\/javafx.media\/src\/main\/native\/jfxmedia\/platform\/osx\/avf\/AVFAudioEqualizer.cpp","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+#include <pthread.h>\n@@ -151,0 +152,9 @@\n+    pthread_mutex_t mBandLock;\n+\n+    void lockBands() {\n+        pthread_mutex_lock(&mBandLock);\n+    }\n+\n+    void unlockBands() {\n+        pthread_mutex_unlock(&mBandLock);\n+    }\n","filename":"modules\/javafx.media\/src\/main\/native\/jfxmedia\/platform\/osx\/avf\/AVFAudioEqualizer.h","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,0 +61,2 @@\n+\n+    pthread_mutex_destroy(&mBandLock);\n","filename":"modules\/javafx.media\/src\/main\/native\/jfxmedia\/platform\/osx\/avf\/AVFAudioSpectrumUnit.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -769,14 +769,3 @@\n-    AVAssetResourceLoadingContentInformationRequest* contentRequest = loadingRequest.contentInformationRequest;\n-    AVAssetResourceLoadingDataRequest* dataRequest = loadingRequest.dataRequest;\n-\n-    if (locatorStream == NULL) {\n-        return NO;\n-    }\n-\n-    if (contentRequest != nil) {\n-        contentRequest.contentType = [self getContentTypeFromURL:loadingRequest.request.URL.absoluteString];\n-        contentRequest.contentLength = locatorStream->GetSizeHint();\n-        contentRequest.byteRangeAccessSupported = YES;\n-    }\n-\n-    if (dataRequest != nil) {\n+    @synchronized(self) {\n+        AVAssetResourceLoadingContentInformationRequest* contentRequest = loadingRequest.contentInformationRequest;\n+        AVAssetResourceLoadingDataRequest* dataRequest = loadingRequest.dataRequest;\n@@ -784,8 +773,2 @@\n-        \/\/ If requestsAllDataToEndOfResource is YES, than requestedLength is\n-        \/\/ invalid and we need to provide all data to the end of file.\n-        long requestedLength = 0;\n-        if (dataRequest.requestsAllDataToEndOfResource) {\n-           int64_t sizeHint = locatorStream->GetSizeHint();\n-           requestedLength = sizeHint - dataRequest.requestedOffset;\n-        } else {\n-           requestedLength = dataRequest.requestedLength;\n+        if (locatorStream == NULL) {\n+            return NO;\n@@ -794,5 +777,4 @@\n-        \/\/ Do not provide more then MAX_READ_SIZE at one call, otherwise\n-        \/\/ AVFoundation might fail if we provide too much data.\n-        \/\/ We will be requested again if not all data provided.\n-        if (requestedLength > MAX_READ_SIZE) {\n-           requestedLength = MAX_READ_SIZE;\n+        if (contentRequest != nil) {\n+            contentRequest.contentType = [self getContentTypeFromURL:loadingRequest.request.URL.absoluteString];\n+            contentRequest.contentLength = locatorStream->GetSizeHint();\n+            contentRequest.byteRangeAccessSupported = YES;\n@@ -801,9 +783,9 @@\n-        NSMutableData* readData = nil;\n-        bool isRandomAccess = locatorStream->GetCallbacks()->IsRandomAccess();\n-        int64_t position = -1;\n-        if (isRandomAccess) {\n-            position = dataRequest.requestedOffset;\n-        } else {\n-            position = locatorStream->GetCallbacks()->Seek(dataRequest.requestedOffset);\n-            if (position != dataRequest.requestedOffset) {\n-                return NO;\n+        if (dataRequest != nil) {\n+            \/\/ If requestsAllDataToEndOfResource is YES, than requestedLength is\n+            \/\/ invalid and we need to provide all data to the end of file.\n+            long requestedLength = 0;\n+            if (dataRequest.requestsAllDataToEndOfResource) {\n+               int64_t sizeHint = locatorStream->GetSizeHint();\n+               requestedLength = sizeHint - dataRequest.requestedOffset;\n+            } else {\n+                requestedLength = dataRequest.requestedLength;\n@@ -811,3 +793,11 @@\n-        }\n-        while (requestedLength > 0) {\n-            unsigned int blockSize = -1;\n+\n+            \/\/ Do not provide more then MAX_READ_SIZE at one call, otherwise\n+            \/\/ AVFoundation might fail if we provide too much data.\n+            \/\/ We will be requested again if not all data provided.\n+            if (requestedLength > MAX_READ_SIZE) {\n+                requestedLength = MAX_READ_SIZE;\n+            }\n+\n+            NSMutableData* readData = nil;\n+            bool isRandomAccess = locatorStream->GetCallbacks()->IsRandomAccess();\n+            int64_t position = -1;\n@@ -815,1 +805,1 @@\n-                blockSize = locatorStream->GetCallbacks()->ReadBlock(position, requestedLength);\n+                position = dataRequest.requestedOffset;\n@@ -817,4 +807,4 @@\n-                blockSize = locatorStream->GetCallbacks()->ReadNextBlock();\n-            }\n-            if (blockSize <= 0) {\n-                break;\n+                position = locatorStream->GetCallbacks()->Seek(dataRequest.requestedOffset);\n+                if (position != dataRequest.requestedOffset) {\n+                    return NO;\n+                }\n@@ -823,4 +813,10 @@\n-            unsigned int readSize =\n-                    (blockSize > (unsigned int)dataRequest.requestedLength) ?\n-                    (unsigned int)dataRequest.requestedLength : blockSize;\n-            readData = [NSMutableData dataWithLength:readSize];\n+            while (requestedLength > 0) {\n+                unsigned int blockSize = -1;\n+                if (isRandomAccess) {\n+                    blockSize = locatorStream->GetCallbacks()->ReadBlock(position, requestedLength);\n+                } else {\n+                    blockSize = locatorStream->GetCallbacks()->ReadNextBlock();\n+                }\n+                if (blockSize <= 0) {\n+                    break;\n+                }\n@@ -828,2 +824,4 @@\n-            locatorStream->GetCallbacks()->CopyBlock((void*)[readData bytes], readSize);\n-            [loadingRequest.dataRequest respondWithData:readData];\n+                unsigned int readSize =\n+                        (blockSize > (unsigned int)dataRequest.requestedLength) ?\n+                        (unsigned int)dataRequest.requestedLength : blockSize;\n+                readData = [NSMutableData dataWithLength:readSize];\n@@ -831,3 +829,2 @@\n-            requestedLength -= readSize;\n-            position += readSize;\n-        }\n+                locatorStream->GetCallbacks()->CopyBlock((void*)[readData bytes], readSize);\n+                [loadingRequest.dataRequest respondWithData:readData];\n@@ -835,1 +832,3 @@\n-        [loadingRequest finishLoading];\n+                requestedLength -= readSize;\n+                position += readSize;\n+            }\n@@ -837,2 +836,4 @@\n-        return YES;\n-    }\n+            [loadingRequest finishLoading];\n+\n+            return YES;\n+        }\n@@ -840,1 +841,2 @@\n-    return NO;\n+        return NO;\n+    }\n","filename":"modules\/javafx.media\/src\/main\/native\/jfxmedia\/platform\/osx\/avf\/AVFMediaPlayer.mm","additions":59,"deletions":57,"binary":false,"changes":116,"status":"modified"}]}