{"files":[{"patch":"@@ -31,0 +31,1 @@\n+import com.sun.javafx.css.parser.Token;\n@@ -50,1 +51,1 @@\n-    public static MediaQuery discreteQueryExpression(String featureName, String featureValue) {\n+    public static MediaQuery discreteQueryExpression(String featureName, Token featureValue) {\n@@ -52,1 +53,0 @@\n-        String lowerCaseFeatureValue = lowerCaseTextValue(featureValue);\n@@ -56,1 +56,1 @@\n-            case \"min-width\" -> rangeQueryExpression(SizeQueryType.WIDTH, lowerCaseFeatureValue,\n+            case \"min-width\" -> rangeQueryExpression(SizeQueryType.WIDTH, featureValue,\n@@ -59,1 +59,1 @@\n-            case \"max-width\" -> rangeQueryExpression(SizeQueryType.WIDTH, lowerCaseFeatureValue,\n+            case \"max-width\" -> rangeQueryExpression(SizeQueryType.WIDTH, featureValue,\n@@ -62,1 +62,1 @@\n-            case \"min-height\" -> rangeQueryExpression(SizeQueryType.HEIGHT, lowerCaseFeatureValue,\n+            case \"min-height\" -> rangeQueryExpression(SizeQueryType.HEIGHT, featureValue,\n@@ -65,1 +65,1 @@\n-            case \"max-height\" -> rangeQueryExpression(SizeQueryType.HEIGHT, lowerCaseFeatureValue,\n+            case \"max-height\" -> rangeQueryExpression(SizeQueryType.HEIGHT, featureValue,\n@@ -68,1 +68,1 @@\n-            case \"min-aspect-ratio\" -> rangeQueryExpression(SizeQueryType.ASPECT_RATIO, lowerCaseFeatureValue,\n+            case \"min-aspect-ratio\" -> rangeQueryExpression(SizeQueryType.ASPECT_RATIO, featureValue,\n@@ -71,1 +71,1 @@\n-            case \"max-aspect-ratio\" -> rangeQueryExpression(SizeQueryType.ASPECT_RATIO, lowerCaseFeatureValue,\n+            case \"max-aspect-ratio\" -> rangeQueryExpression(SizeQueryType.ASPECT_RATIO, featureValue,\n@@ -80,2 +80,1 @@\n-                                                        lowerCaseFeatureValue,\n-                                                        ComparisonOp.EQUAL.getExpressionSupplier());\n+                                                        featureValue, ComparisonOp.EQUAL.getExpressionSupplier());\n@@ -85,1 +84,1 @@\n-                boolean portrait = switch (checkNotNullValue(lowerCaseFeatureName, lowerCaseFeatureValue)) {\n+                boolean portrait = switch (checkNotNullValue(lowerCaseFeatureName, lowerCaseTextValue(featureValue))) {\n@@ -88,1 +87,1 @@\n-                    default -> throw unknownValue(\"orientation\", featureValue);\n+                    default -> throw unknownValue(\"orientation\", featureValue.getText());\n@@ -92,1 +91,1 @@\n-                    lowerCaseFeatureName, lowerCaseFeatureValue,\n+                    lowerCaseFeatureName, lowerCaseTextValue(featureValue),\n@@ -101,1 +100,1 @@\n-                boolean fullscreen = switch (checkNotNullValue(lowerCaseFeatureName, lowerCaseFeatureValue)) {\n+                boolean fullscreen = switch (checkNotNullValue(lowerCaseFeatureName, lowerCaseTextValue(featureValue))) {\n@@ -104,1 +103,1 @@\n-                    default -> throw unknownValue(\"display-mode\", featureValue);\n+                    default -> throw unknownValue(\"display-mode\", featureValue.getText());\n@@ -108,1 +107,1 @@\n-                    lowerCaseFeatureName, lowerCaseFeatureValue,\n+                    lowerCaseFeatureName, lowerCaseTextValue(featureValue),\n@@ -115,1 +114,1 @@\n-                checkNotNullValue(lowerCaseFeatureName, lowerCaseFeatureValue),\n+                checkNotNullValue(lowerCaseFeatureName, lowerCaseTextValue(featureValue)),\n@@ -117,1 +116,1 @@\n-                enumValue(ColorScheme::valueOf, lowerCaseFeatureName, featureValue));\n+                enumValue(ColorScheme::valueOf, lowerCaseFeatureName, featureValue.getText()));\n@@ -120,1 +119,2 @@\n-                lowerCaseFeatureName, lowerCaseFeatureValue, \"reduce\", MediaQueryContext::isReducedMotion);\n+                lowerCaseFeatureName, lowerCaseTextValue(featureValue),\n+                \"reduce\", MediaQueryContext::isReducedMotion);\n@@ -123,1 +123,2 @@\n-                lowerCaseFeatureName, lowerCaseFeatureValue, \"reduce\", MediaQueryContext::isReducedTransparency);\n+                lowerCaseFeatureName, lowerCaseTextValue(featureValue),\n+                \"reduce\", MediaQueryContext::isReducedTransparency);\n@@ -126,1 +127,2 @@\n-                lowerCaseFeatureName, lowerCaseFeatureValue, \"reduce\", MediaQueryContext::isReducedData);\n+                lowerCaseFeatureName, lowerCaseTextValue(featureValue),\n+                \"reduce\", MediaQueryContext::isReducedData);\n@@ -129,1 +131,2 @@\n-                lowerCaseFeatureName, lowerCaseFeatureValue, \"persistent\", MediaQueryContext::isPersistentScrollBars);\n+                lowerCaseFeatureName, lowerCaseTextValue(featureValue),\n+                \"persistent\", MediaQueryContext::isPersistentScrollBars);\n@@ -147,1 +150,1 @@\n-                                                  String featureValue,\n+                                                  Token featureValue,\n@@ -150,2 +153,1 @@\n-                                    lowerCaseTextValue(featureValue),\n-                                    comparison.getExpressionSupplier());\n+                                    featureValue, comparison.getExpressionSupplier());\n@@ -167,2 +169,2 @@\n-                                                  String featureValue1,\n-                                                  String featureValue2,\n+                                                  Token featureValue1,\n+                                                  Token featureValue2,\n@@ -177,1 +179,1 @@\n-                                                   String lowerCaseFeatureValue,\n+                                                   Token featureValue,\n@@ -180,1 +182,1 @@\n-            checkNotNullValue(featureType.getFeatureName(), lowerCaseFeatureValue),\n+            checkNotNullValue(featureType.getFeatureName(), featureValue),\n@@ -220,0 +222,4 @@\n+    private static String lowerCaseTextValue(Token token) {\n+        return token != null ? lowerCaseTextValue(token.getText()) : null;\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/css\/media\/MediaFeatures.java","additions":35,"deletions":29,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -288,3 +288,1 @@\n-            return MediaFeatures.discreteQueryExpression(\n-                featureName.getText(),\n-                featureValue != null ? featureValue.getText() : null);\n+            return MediaFeatures.discreteQueryExpression(featureName.getText(), featureValue);\n@@ -341,2 +339,1 @@\n-                    return MediaFeatures.rangeQueryExpression(\n-                        featureName.getText(), featureValue.getText(), operator);\n+                    return MediaFeatures.rangeQueryExpression(featureName.getText(), featureValue, operator);\n@@ -384,1 +381,1 @@\n-                            featureName.getText(), featureValue1.getText(), operator1.flipped());\n+                            featureName.getText(), featureValue1, operator1.flipped());\n@@ -400,1 +397,1 @@\n-                        featureValue1.getText(), featureValue2.getText(),\n+                        featureValue1, featureValue2,\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/css\/media\/MediaQueryParser.java","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -39,0 +39,2 @@\n+import com.sun.javafx.css.parser.CssLexer;\n+import com.sun.javafx.css.parser.Token;\n@@ -150,1 +152,1 @@\n-                yield MediaFeatures.discreteQueryExpression(featureName, featureValue);\n+                yield MediaFeatures.discreteQueryExpression(featureName, new Token(CssLexer.IDENT, featureValue));\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/css\/media\/MediaQuerySerializer.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -29,0 +29,3 @@\n+import com.sun.javafx.css.parser.CssLexer;\n+import com.sun.javafx.css.parser.CssParserHelper;\n+import com.sun.javafx.css.parser.Token;\n@@ -30,1 +33,0 @@\n-import javafx.css.SizeUnits;\n@@ -55,1 +57,1 @@\n-                                               String featureValue,\n+                                               Token featureValue,\n@@ -58,1 +60,5 @@\n-            return rangeExpressionSupplier.getNumberExpression(queryType, Double.parseDouble(featureValue));\n+            if (featureValue.getType() != CssLexer.NUMBER) {\n+                throw invalidValue(queryType.getFeatureName(), featureValue.getText());\n+            }\n+\n+            return rangeExpressionSupplier.getNumberExpression(queryType, Double.parseDouble(featureValue.getText()));\n@@ -60,1 +66,1 @@\n-            throw invalidValue(queryType.getFeatureName(), featureValue);\n+            throw invalidValue(queryType.getFeatureName(), featureValue.getText());\n@@ -65,1 +71,1 @@\n-                                             String featureValue,\n+                                             Token featureValue,\n@@ -68,2 +74,6 @@\n-            return rangeExpressionSupplier.getSizeExpression(\n-                queryType, sizeValue(queryType.getFeatureName(), featureValue));\n+            Size size = CssParserHelper.parseSize(featureValue);\n+            if (size == null) {\n+                throw invalidValue(queryType.getFeatureName(), featureValue.getText());\n+            }\n+\n+            return rangeExpressionSupplier.getSizeExpression(queryType, size);\n@@ -71,1 +81,1 @@\n-            throw invalidValue(queryType.getFeatureName(), featureValue);\n+            throw invalidValue(queryType.getFeatureName(), featureValue.getText());\n@@ -83,1 +93,1 @@\n-    public MediaQuery getQueryExpression(String featureValue, RangeExpression.Supplier rangeExpressionSupplier) {\n+    public MediaQuery getQueryExpression(Token featureValue, RangeExpression.Supplier rangeExpressionSupplier) {\n@@ -91,34 +101,0 @@\n-    \/*\n-     * As per CSS specification (https:\/\/www.w3.org\/TR\/css-values-4\/#lengths), a <length> value (called <size>\n-     * in JavaFX) always requires a unit. The only exception is the zero value, which can be specified without\n-     * a unit. However, JavaFX's CssParser accepts sizes without a unit by implicitly treating them as pixels.\n-     *\/\n-    private static Size sizeValue(String featureName, String lowerCaseText) {\n-        int unitIndex = -1;\n-\n-        for (int i = 0; i < lowerCaseText.length(); i++) {\n-            if (!Character.isDigit(lowerCaseText.charAt(i))) {\n-                unitIndex = i;\n-                break;\n-            }\n-        }\n-\n-        if (unitIndex == -1) {\n-            return new Size(Double.parseDouble(lowerCaseText), SizeUnits.PX);\n-        }\n-\n-        double value = Double.parseDouble(lowerCaseText.substring(0, unitIndex));\n-\n-        return new Size(value, switch (lowerCaseText.substring(unitIndex)) {\n-            case \"px\" -> SizeUnits.PX;\n-            case \"em\" -> SizeUnits.EM;\n-            case \"ex\" -> SizeUnits.EX;\n-            case \"cm\" -> SizeUnits.CM;\n-            case \"mm\" -> SizeUnits.MM;\n-            case \"in\" -> SizeUnits.IN;\n-            case \"pt\" -> SizeUnits.PT;\n-            case \"pc\" -> SizeUnits.PC;\n-            default -> throw invalidValue(featureName, lowerCaseText);\n-        });\n-    }\n-\n@@ -131,1 +107,1 @@\n-        MediaQuery get(SizeQueryType queryType, String featureValue, RangeExpression.Supplier supplier);\n+        MediaQuery get(SizeQueryType queryType, Token featureValue, RangeExpression.Supplier supplier);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/css\/media\/SizeQueryType.java","additions":20,"deletions":44,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -0,0 +1,53 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package com.sun.javafx.css.parser;\n+\n+import com.sun.javafx.util.Utils;\n+import javafx.css.CssParser;\n+import javafx.css.Size;\n+\n+public final class CssParserHelper {\n+\n+    private static Accessor accessor;\n+\n+    static {\n+        Utils.forceInit(CssParser.class);\n+    }\n+\n+    private CssParserHelper() {}\n+\n+    public static void setAccessor(Accessor accessor) {\n+        CssParserHelper.accessor = accessor;\n+    }\n+\n+    public static Size parseSize(Token token) {\n+        return accessor.parseSize(token);\n+    }\n+\n+    public interface Accessor {\n+        Size parseSize(Token token);\n+    }\n+}\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/css\/parser\/CssParserHelper.java","additions":53,"deletions":0,"binary":false,"changes":53,"status":"added"},{"patch":"@@ -40,0 +40,1 @@\n+import com.sun.javafx.css.parser.CssParserHelper;\n@@ -126,0 +127,9 @@\n+    static {\n+        CssParserHelper.setAccessor(new CssParserHelper.Accessor() {\n+            @Override\n+            public Size parseSize(Token token) {\n+                return sizeImpl(token);\n+            }\n+        });\n+    }\n+\n@@ -578,0 +588,15 @@\n+        Size size = sizeImpl(token);\n+        if (size == null) {\n+            if (LOGGER.isLoggable(Level.FINEST)) {\n+                LOGGER.finest(\"Expected \\'<number>\\'\");\n+            }\n+\n+            ParseException re = new ParseException(\"Expected \\'<number>\\'\", token, this);\n+            reportError(createError(re.toString()));\n+            throw re;\n+        }\n+\n+        return size;\n+    }\n+\n+    private static Size sizeImpl(final Token token) {\n@@ -641,6 +666,1 @@\n-            if (LOGGER.isLoggable(Level.FINEST)) {\n-                LOGGER.finest(\"Expected \\'<number>\\'\");\n-            }\n-            ParseException re = new ParseException(\"Expected \\'<number>\\'\",token, this);\n-            reportError(createError(re.toString()));\n-            throw re;\n+            return null;\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/css\/CssParser.java","additions":26,"deletions":6,"binary":false,"changes":32,"status":"modified"}]}