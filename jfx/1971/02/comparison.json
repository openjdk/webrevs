{"files":[{"patch":"@@ -72,1 +72,1 @@\n-\n+    private boolean treeStructureDirty;\n@@ -149,0 +149,5 @@\n+                    } else if (eventType.equals(TreeItem.<T>childrenModificationEvent())) {\n+                        markItemCountDirty();\n+                        treeStructureDirty = true;\n+                        control.requestLayout();\n+                        break;\n@@ -350,0 +355,4 @@\n+            treeStructureDirty = false;\n+        } else if (treeStructureDirty) {\n+            requestRebuildCells();\n+            treeStructureDirty = false;\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TreeTableViewSkin.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -6442,0 +6442,51 @@\n+    \/**\n+     * Reparenting a TreeItem must update its indentation in the TreeTableView.\n+     * See also: <a href=\"https:\/\/bugs.openjdk.org\/browse\/JDK-8356770\">JDK-8356770<\/a>\n+     *\/\n+    @Test\n+    void testIndentationUpdateAfterReparenting() {\n+        TreeItem<String> itemA1 = new TreeItem<>(\"item A1\");\n+        TreeItem<String> itemA2 = new TreeItem<>(\"item A2\");\n+        TreeItem<String> itemA  = new TreeItem<>(\"item A\");\n+        itemA.getChildren().addAll(itemA1, itemA2);\n+        itemA.setExpanded(true);\n+\n+        TreeItem<String> itemB1 = new TreeItem<>(\"item B1\");\n+        TreeItem<String> itemB2 = new TreeItem<>(\"item B2\");\n+        TreeItem<String> itemB  = new TreeItem<>(\"item B\");\n+        itemB.getChildren().addAll(itemB1, itemB2);\n+        itemB.setExpanded(true);\n+\n+        TreeItem<String> root = new TreeItem<>(\"Root\");\n+        root.getChildren().addAll(itemA, itemB);\n+        root.setExpanded(true);\n+\n+        TreeTableView<String> table = new TreeTableView<>();\n+        TreeTableColumn<String, String> col = new TreeTableColumn<>(\"Name\");\n+        col.setCellValueFactory(cd -> new SimpleStringProperty(cd.getValue().getValue()));\n+        table.getColumns().add(col);\n+        table.setRoot(root);\n+        table.setShowRoot(true);\n+\n+        stageLoader = new StageLoader(table);\n+\n+        \/\/ Find \"item B\" row and record its disclosure node indent\n+        double xBefore = disclosureIndent(table,4);\n+\n+        \/\/ Reparenting \"item B\" under \"item A\"\n+        root.getChildren().remove(itemB);\n+        itemA.getChildren().add(itemB);\n+        Toolkit.getToolkit().firePulse();\n+\n+        double xAfter = disclosureIndent(table,4);\n+\n+        assertTrue(xAfter > xBefore,\n+                \"Indentation of item B must increase after reparenting\");\n+    }\n+\n+    private double disclosureIndent(TreeTableView<String> table, int index) {\n+        TreeTableRow<String> row = (TreeTableRow<String>) VirtualFlowTestUtils.getVirtualFlow(table).getVisibleCell(index);\n+        Node disclosureNode = row.getDisclosureNode();\n+        return disclosureNode == null ? 0.0 : (disclosureNode.getLayoutX() + disclosureNode.getTranslateX());\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeTableViewTest.java","additions":51,"deletions":0,"binary":false,"changes":51,"status":"modified"}]}