{"files":[{"patch":"@@ -35,1 +35,0 @@\n-import javafx.beans.property.DoubleProperty;\n@@ -96,1 +95,1 @@\n-        setupTreeTableViewListeners();\n+        setupTableViewListeners();\n@@ -99,2 +98,1 @@\n-    \/\/ FIXME: replace listener to fixedCellSize with direct lookup - JDK-8277000\n-    private void setupTreeTableViewListeners() {\n+    private void setupTableViewListeners() {\n@@ -105,1 +103,1 @@\n-                setupTreeTableViewListeners();\n+                setupTableViewListeners();\n@@ -108,9 +106,1 @@\n-            DoubleProperty fixedCellSizeProperty = tableView.fixedCellSizeProperty();\n-            if (fixedCellSizeProperty != null) {\n-                registerChangeListener(fixedCellSizeProperty, e -> {\n-                    fixedCellSize = fixedCellSizeProperty.get();\n-                    fixedCellSizeEnabled = fixedCellSize > 0;\n-                });\n-                fixedCellSize = fixedCellSizeProperty.get();\n-                fixedCellSizeEnabled = fixedCellSize > 0;\n-\n+            if (getFixedCellSize() > 0) {\n@@ -123,1 +113,1 @@\n-                    registerChangeListener(virtualFlow.widthProperty(), e -> tableView.requestLayout());\n+                    registerChangeListener(virtualFlow.widthProperty(), e -> getTableView().requestLayout());\n@@ -234,0 +224,6 @@\n+    @Override\n+    double getFixedCellSize() {\n+        TableView<T> tableView = getTableView();\n+        return tableView != null ? tableView.getFixedCellSize() : super.getFixedCellSize();\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TableRowSkin.java","additions":11,"deletions":15,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -44,0 +44,1 @@\n+import javafx.scene.layout.Region;\n@@ -132,4 +133,0 @@\n-    \/\/ FIXME: replace cached values with direct lookup - JDK-8277000\n-    double fixedCellSize;\n-    boolean fixedCellSizeEnabled;\n-\n@@ -321,0 +318,1 @@\n+        double fixedCellSize = getFixedCellSize();\n@@ -326,1 +324,1 @@\n-            if (fixedCellSizeEnabled) {\n+            if (fixedCellSize > 0) {\n@@ -345,1 +343,1 @@\n-                if (fixedCellSizeEnabled && tableCell.getParent() == null) {\n+                if (fixedCellSize > 0 && tableCell.getParent() == null) {\n@@ -423,6 +421,4 @@\n-                if (fixedCellSizeEnabled) {\n-                    \/\/ we only add\/remove to the scenegraph if the fixed cell\n-                    \/\/ length support is enabled - otherwise we keep all\n-                    \/\/ TableCells in the scenegraph\n-                    getChildren().remove(tableCell);\n-                }\n+                \/\/ we only add\/remove to the scenegraph if the fixed cell\n+                \/\/ length support is enabled - otherwise we keep all\n+                \/\/ TableCells in the scenegraph\n+                getChildren().remove(tableCell);\n@@ -435,0 +431,4 @@\n+    double getFixedCellSize() {\n+        return Region.USE_COMPUTED_SIZE;\n+    }\n+\n@@ -522,1 +522,1 @@\n-        if (fixedCellSizeEnabled) {\n+        if (getFixedCellSize() > 0) {\n@@ -562,1 +562,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -595,1 +596,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -625,1 +627,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TableRowSkinBase.java","additions":19,"deletions":16,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -100,4 +100,0 @@\n-        lh.addChangeListener(control.indexProperty(), (ev) -> {\n-            updateCells = true;\n-        });\n-\n@@ -114,1 +110,0 @@\n-    \/\/ FIXME: replace listener to fixedCellSize with direct lookup - JDK-8277000\n@@ -133,7 +128,1 @@\n-            DoubleProperty fixedCellSizeProperty = getTreeTableView().fixedCellSizeProperty();\n-            if (fixedCellSizeProperty != null) {\n-                registerChangeListener(fixedCellSizeProperty, (x) -> {\n-                    updateCachedFixedSize();\n-                });\n-                updateCachedFixedSize();\n-\n+            if (getFixedCellSize() > 0) {\n@@ -146,6 +135,1 @@\n-                    registerChangeListener(getVirtualFlow().widthProperty(), (x) -> {\n-                        if (getSkinnable() != null) {\n-                            TreeTableView<T> t = getSkinnable().getTreeTableView();\n-                            t.requestLayout();\n-                        }\n-                    });\n+                    registerChangeListener(getVirtualFlow().widthProperty(), e -> getTreeTableView().requestLayout());\n@@ -157,10 +141,0 @@\n-    private void updateCachedFixedSize() {\n-        if (getSkinnable() != null) {\n-            TreeTableView<T> t = getSkinnable().getTreeTableView();\n-            if (t != null) {\n-                fixedCellSize = t.getFixedCellSize();\n-                fixedCellSizeEnabled = fixedCellSize > 0.0;\n-            }\n-        }\n-    }\n-\n@@ -354,0 +328,6 @@\n+    @Override\n+    double getFixedCellSize() {\n+        TreeTableView<T> treeTableView = getTreeTableView();\n+        return treeTableView != null ? treeTableView.getFixedCellSize() : super.getFixedCellSize();\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TreeTableRowSkin.java","additions":8,"deletions":28,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -120,2 +120,1 @@\n-        TableRowSkin<T> skin = (TableRowSkin<T>) tableRow.getSkin();\n-        return skin.fixedCellSizeEnabled;\n+        return tableRow.getTableView().getFixedCellSize() > 0;\n@@ -125,2 +124,1 @@\n-        TreeTableRowSkin<T> skin = (TreeTableRowSkin<T>) tableRow.getSkin();\n-        return skin.fixedCellSizeEnabled;\n+        return tableRow.getTreeTableView().getFixedCellSize() > 0;\n","filename":"modules\/javafx.controls\/src\/shims\/java\/javafx\/scene\/control\/skin\/TableSkinShim.java","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -124,1 +124,0 @@\n-    @Disabled(\"JDK-8277000\")\n@@ -274,0 +273,31 @@\n+    @Test\n+    public void testTreeTableRowVirtualFlowWidthListenerReplaceSkin() {\n+        TreeTableView<Person> tableView = createPersonTreeTable(false);\n+        tableView.setFixedCellSize(24);\n+        showControl(tableView, true);\n+        VirtualFlow<?> flow = getVirtualFlow(tableView);\n+        TreeTableRow<?> tableRow = (TreeTableRow<?>) getCell(tableView, 1);\n+        replaceSkin(tableRow);\n+        Toolkit.getToolkit().firePulse();\n+        TreeTableRowSkin<?> rowSkin = (TreeTableRowSkin<?>) tableRow.getSkin();\n+        assertNotNull(\n+                unregisterChangeListeners(rowSkin, flow.widthProperty()),\n+                \"row skin must have listener to virtualFlow width\");\n+    }\n+\n+    \/**\n+     * Sanity test: listener to flow's width is registered.\n+     *\/\n+    @Test\n+    public void testTreeTableRowVirtualFlowWidthListener() {\n+        TreeTableView<Person> tableView = createPersonTreeTable(false);\n+        tableView.setFixedCellSize(24);\n+        showControl(tableView, true);\n+        VirtualFlow<?> flow = getVirtualFlow(tableView);\n+        TreeTableRow<?> tableRow = (TreeTableRow<?>) getCell(tableView, 1);\n+        TreeTableRowSkin<?> rowSkin = (TreeTableRowSkin<?>) tableRow.getSkin();\n+        assertNotNull(\n+                unregisterChangeListeners(rowSkin, flow.widthProperty()),\n+                \"row skin must have listener to virtualFlow width\");\n+    }\n+\n@@ -553,1 +583,0 @@\n-    @Disabled(\"JDK-8277000\")\n@@ -647,0 +676,1 @@\n+        tableView.setFixedCellSize(24);\n@@ -664,0 +694,1 @@\n+        tableView.setFixedCellSize(24);\n@@ -673,0 +704,25 @@\n+    @Test\n+    public void testTableRowTracksVirtualFlowReplaceSkin() {\n+        TableView<Person> tableView = createPersonTable(false);\n+        showControl(tableView, true);\n+        VirtualFlow<?> flow = getVirtualFlow(tableView);\n+        TableRow<?> tableRow = (TableRow<?>) getCell(tableView, 1);\n+        replaceSkin(tableRow);\n+        Toolkit.getToolkit().firePulse();\n+        TableRowSkin<?> rowSkin = (TableRowSkin<?>) tableRow.getSkin();\n+        checkFollowsWidth(flow, (Region) rowSkin.getNode());\n+    }\n+\n+    \/**\n+     * Sanity test checks that tree table row skin tracks the virtual flow width.\n+     *\/\n+    @Test\n+    public void testTableRowTracksVirtualFlowWidth() {\n+        TableView<Person> tableView = createPersonTable(false);\n+        showControl(tableView, true);\n+        VirtualFlow<?> flow = getVirtualFlow(tableView);\n+        TableRow<?> tableRow = (TableRow<?>) getCell(tableView, 1);\n+        TableRowSkin<?> rowSkin = (TableRowSkin<?>) tableRow.getSkin();\n+        checkFollowsWidth(flow, (Region) rowSkin.getNode());\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinCleanupTest.java","additions":58,"deletions":2,"binary":false,"changes":60,"status":"modified"}]}