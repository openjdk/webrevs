{"files":[{"patch":"@@ -318,3 +318,4 @@\n-        \/\/ There are no Metal rendering pipeline states changed as a\n-        \/\/ result of this call, hence the method is no-op.\n-        \/\/ But overriding the method here for any future reference.\n+        \/\/ We are using this call in Metal to only initialise the\n+        \/\/ default 3D texture sampler's filter and addressing states\n+        if (checkDisposed()) return;\n+        nSetDeviceParametersFor3D(pContext);\n@@ -360,2 +361,4 @@\n-    void setMap(long nativePhongMaterial, int mapType, long nativeTexture) {\n-        nSetMap(pContext, nativePhongMaterial, mapType, nativeTexture);\n+    void setMap(long nativePhongMaterial, int mapType,\n+                long nativeTexture, boolean useMipmap) {\n+        nSetMap(pContext, nativePhongMaterial,\n+            mapType, nativeTexture, useMipmap);\n@@ -524,0 +527,1 @@\n+    private static native void nSetDeviceParametersFor3D(long pContext);\n@@ -537,1 +541,1 @@\n-                                       int mapType, long texID);\n+                                       int mapType, long texID, boolean useMipmap);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/prism\/mtl\/MTLContext.java","additions":10,"deletions":6,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -85,1 +85,1 @@\n-        context.setMap(nativeHandle, map.getType().ordinal(), hTexture);\n+        context.setMap(nativeHandle, map.getType().ordinal(), hTexture, useMipmap);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/prism\/mtl\/MTLPhongMaterial.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -110,0 +110,2 @@\n+    id<MTLSamplerState> nonMipmappedSamplerState;\n+    id<MTLSamplerState> mipmappedSamplerState;\n@@ -186,0 +188,1 @@\n+- (id<MTLSamplerState>) get3DSamplerState:(bool)mipmapped;\n","filename":"modules\/javafx.graphics\/src\/main\/native-prism-mtl\/MetalContext.h","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -238,0 +238,26 @@\n+- (void) create3DSamplerStates\n+{\n+    MTLSamplerDescriptor *samplerDescriptor = [MTLSamplerDescriptor new];\n+    samplerDescriptor.minFilter = MTLSamplerMinMagFilterLinear;\n+    samplerDescriptor.magFilter = MTLSamplerMinMagFilterLinear;\n+    samplerDescriptor.rAddressMode = MTLSamplerAddressModeRepeat;\n+    samplerDescriptor.sAddressMode = MTLSamplerAddressModeRepeat;\n+    samplerDescriptor.tAddressMode = MTLSamplerAddressModeRepeat;\n+    samplerDescriptor.mipFilter = MTLSamplerMipFilterNotMipmapped;\n+    nonMipmappedSamplerState = [[self getDevice] newSamplerStateWithDescriptor:samplerDescriptor];\n+\n+    samplerDescriptor.mipFilter = MTLSamplerMipFilterLinear;\n+    mipmappedSamplerState = [[self getDevice] newSamplerStateWithDescriptor:samplerDescriptor];\n+\n+    [samplerDescriptor release];\n+}\n+\n+- (id<MTLSamplerState>) get3DSamplerState:(bool)mipmapped\n+{\n+    if (mipmapped) {\n+        return mipmappedSamplerState;\n+    } else {\n+        return nonMipmappedSamplerState;\n+    }\n+}\n+\n@@ -840,0 +866,10 @@\n+    if (nonMipmappedSamplerState != nil) {\n+        [nonMipmappedSamplerState release];\n+        nonMipmappedSamplerState = nil;\n+    }\n+\n+    if (mipmappedSamplerState != nil) {\n+        [mipmappedSamplerState release];\n+        mipmappedSamplerState = nil;\n+    }\n+\n@@ -1112,0 +1148,12 @@\n+\/*\n+ * Class:     com_sun_prism_mtl_MTLContext\n+ * Method:    nSetDeviceParametersFor3D\n+ * Signature: (J)J\n+ *\/\n+JNIEXPORT void JNICALL Java_com_sun_prism_mtl_MTLContext_nSetDeviceParametersFor3D\n+    (JNIEnv *env, jclass jClass, jlong ctx)\n+{\n+    MetalContext *pCtx = (MetalContext*) jlong_to_ptr(ctx);\n+    [pCtx create3DSamplerStates];\n+}\n+\n@@ -1293,1 +1341,1 @@\n-    jint mapType, jlong nativeTexture)\n+    jint mapType, jlong nativeTexture, jboolean useMipmap)\n@@ -1298,1 +1346,1 @@\n-    [phongMaterial setMap:mapType map:[texMap getTexture]];\n+    [phongMaterial setMap:mapType map:[texMap getTexture] useMipmap:useMipmap];\n","filename":"modules\/javafx.graphics\/src\/main\/native-prism-mtl\/MetalContext.m","additions":50,"deletions":2,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -231,0 +231,2 @@\n+    [phongEncoder setFragmentSamplerState:[material getSamplerState:DIFFUSE]\n+                                  atIndex:0];\n@@ -233,0 +235,2 @@\n+    [phongEncoder setFragmentSamplerState:[material getSamplerState:SPECULAR]\n+                                  atIndex:0];\n@@ -235,0 +239,2 @@\n+    [phongEncoder setFragmentSamplerState:[material getSamplerState:BUMP]\n+                                  atIndex:0];\n@@ -237,0 +243,2 @@\n+    [phongEncoder setFragmentSamplerState:[material getSamplerState:SELFILLUMINATION]\n+                                  atIndex:0];\n","filename":"modules\/javafx.graphics\/src\/main\/native-prism-mtl\/MetalMeshView.m","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -48,0 +48,1 @@\n+    id<MTLSamplerState> samplerState[4];\n@@ -69,1 +70,2 @@\n-            map:(id<MTLTexture>)texMap;\n+            map:(id<MTLTexture>)texMap\n+      useMipmap:(bool)mipmapped;\n@@ -71,0 +73,1 @@\n+- (id<MTLSamplerState>) getSamplerState:(int)mapID;\n","filename":"modules\/javafx.graphics\/src\/main\/native-prism-mtl\/MetalPhongMaterial.h","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -116,0 +116,1 @@\n+      useMipmap:(bool)mipmapped\n@@ -120,0 +121,1 @@\n+        samplerState[mapID] = [context get3DSamplerState:mipmapped];\n@@ -134,0 +136,5 @@\n+\n+- (id<MTLSamplerState>) getSamplerState:(int)mapID\n+{\n+    return samplerState[mapID];\n+}\n","filename":"modules\/javafx.graphics\/src\/main\/native-prism-mtl\/MetalPhongMaterial.m","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"}]}