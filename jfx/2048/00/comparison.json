{"files":[{"patch":"@@ -42,1 +42,2 @@\n-    HEADER_BAR(\"HeaderBar\");\n+    HEADER_BAR(\"HeaderBar\"),\n+    WINDOW_BACKDROP(\"WindowBackdrop\");\n","filename":"modules\/javafx.base\/src\/main\/java\/com\/sun\/javafx\/PreviewFeature.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -722,0 +722,9 @@\n+    protected boolean _supportsWindowBackdrops() {\n+        return false;\n+    }\n+\n+    public final boolean supportsWindowBackdrops() {\n+        checkEventThread();\n+        return _supportsWindowBackdrops();\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/Application.java","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -181,0 +181,8 @@\n+    \/**\n+     * The backdrop styles take up two bits. 0 is no backdrop.\n+     *\/\n+    @Native public static final int BACKDROP_MASK      = 3 << 12;\n+    @Native public static final int WINDOW_BACKDROP    = 1 << 12;\n+    @Native public static final int TABBED_BACKDROP    = 2 << 12;\n+    @Native public static final int TRANSIENT_BACKDROP = 3 << 12;\n+\n@@ -284,0 +292,5 @@\n+        if (((styleMask & BACKDROP_MASK) != 0)\n+            && !Application.GetApplication().supportsWindowBackdrops()) {\n+            styleMask &= ~BACKDROP_MASK;\n+        }\n+\n@@ -753,0 +766,5 @@\n+    public boolean hasBackdrop() {\n+        \/\/ The backdrop flags are only set if backdrops are supported.\n+        return (this.styleMask & Window.BACKDROP_MASK) != 0;\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/Window.java","additions":18,"deletions":0,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -407,0 +407,5 @@\n+    @Override\n+    protected boolean _supportsWindowBackdrops() {\n+        return true;\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/mac\/MacApplication.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -383,0 +383,2 @@\n+    @Override native protected boolean _supportsWindowBackdrops();\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/win\/WinApplication.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -47,0 +47,1 @@\n+import javafx.stage.StageBackdrop;\n@@ -105,1 +106,2 @@\n-                                 Modality modality, TKStage owner, boolean rtl, boolean darkFrame) {\n+                                 Modality modality, TKStage owner, boolean rtl, boolean darkFrame,\n+                                 StageBackdrop backdrop) {\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/DummyToolkit.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -54,0 +54,1 @@\n+import javafx.stage.StageBackdrop;\n@@ -364,1 +365,2 @@\n-                                          Modality modality, TKStage owner, boolean rtl, boolean darkFrame);\n+                                          Modality modality, TKStage owner, boolean rtl, boolean darkFrame,\n+                                          StageBackdrop backdrop);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/Toolkit.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -320,1 +320,1 @@\n-                    windowStage.getPlatformWindow().isUnifiedWindow())) {\n+                    windowStage.allowsTransparentFill())) {\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/GlassScene.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -57,0 +57,1 @@\n+import javafx.stage.StageBackdrop;\n@@ -617,1 +618,2 @@\n-                                           Modality modality, TKStage owner, boolean rtl, boolean darkFrame) {\n+                                           Modality modality, TKStage owner, boolean rtl, boolean darkFrame,\n+                                           StageBackdrop backdrop) {\n@@ -619,1 +621,1 @@\n-        WindowStage stage = new WindowStage(peerWindow, stageStyle, modality, owner, darkFrame);\n+        WindowStage stage = new WindowStage(peerWindow, stageStyle, modality, owner, darkFrame, backdrop);\n@@ -702,1 +704,1 @@\n-        WindowStage stage = new WindowStage(peerWindow, popupStyle, null, owner, false);\n+        WindowStage stage = new WindowStage(peerWindow, popupStyle, null, owner, false, StageBackdrop.DEFAULT);\n@@ -1268,0 +1270,2 @@\n+            case WINDOW_BACKDROP:\n+                return Application.GetApplication().supportsWindowBackdrops();\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/QuantumToolkit.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import javafx.stage.StageBackdrop;\n@@ -65,0 +66,1 @@\n+    private StageBackdrop backdrop = StageBackdrop.DEFAULT;\n@@ -90,1 +92,1 @@\n-                       TKStage owner, boolean darkFrame) {\n+                       TKStage owner, boolean darkFrame, final StageBackdrop backdrop) {\n@@ -95,0 +97,1 @@\n+        this.backdrop = backdrop;\n@@ -186,0 +189,14 @@\n+            switch (backdrop) {\n+                case DEFAULT:\n+                    break;\n+                case WINDOW:\n+                    windowMask |= Window.WINDOW_BACKDROP;\n+                    break;\n+                case TABBED:\n+                    windowMask |= Window.TABBED_BACKDROP;\n+                    break;\n+                case TRANSIENT:\n+                    windowMask |= Window.TRANSIENT_BACKDROP;\n+                    break;\n+            }\n+\n@@ -922,0 +939,4 @@\n+\n+    public boolean allowsTransparentFill() {\n+        return transparent || platformWindow.isUnifiedWindow() || platformWindow.hasBackdrop();\n+    }\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/WindowStage.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -166,0 +166,10 @@\n+    \/**\n+     * Indicates that a system supports the use of a {@code StageBackdrop}.\n+     * <p>\n+     * This feature is currently supported on Windows 11 and macOS.\n+     * @since 27\n+     * @deprecated This is a preview feature which may be changed or removed in a future release.\n+     *\/\n+    @Deprecated(since = \"27\")\n+    WINDOW_BACKDROP,\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/application\/ConditionalFeature.java","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -570,0 +570,33 @@\n+    private StageBackdrop backdrop = StageBackdrop.DEFAULT;\n+\n+    \/**\n+     * Specifies the backdrop for this stage. This must be done prior to\n+     * making the stage visible.\n+     *\n+     * @param backdrop the backdrop for this stage.\n+     *\n+     * @throws IllegalStateException if this property is set after the stage\n+     * has ever been made visible.\n+     *\n+     * @defaultValue StageBackdrop.DEFAULT\n+     *\/\n+    @SuppressWarnings(\"deprecation\")\n+    public final void initBackdrop(StageBackdrop backdrop) {\n+        PreviewFeature.WINDOW_BACKDROP.checkEnabled();\n+\n+        if (hasBeenVisible) {\n+            throw new IllegalStateException(\"Cannot set backdrop once stage has been set visible\");\n+        }\n+\n+        this.backdrop = backdrop;\n+    }\n+\n+    \/**\n+     * Retrieves the backdrop for this stage.\n+     *\n+     * @return the backdrop.\n+     *\/\n+    public final StageBackdrop getBackdrop() {\n+        return backdrop;\n+    }\n+\n@@ -1120,1 +1153,0 @@\n-\n@@ -1123,1 +1155,2 @@\n-                    getModality(), tkStage, rtl, colorScheme == ColorScheme.DARK));\n+                    getModality(), tkStage, rtl, colorScheme == ColorScheme.DARK,\n+                    this.backdrop));\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/stage\/Stage.java","additions":35,"deletions":2,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -0,0 +1,71 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package javafx.stage;\n+\n+import javafx.application.ConditionalFeature;\n+import javafx.application.Platform;\n+\n+\/**\n+ * This enum defines the possible backdrops for a {@code Stage}. Backdrops are\n+ * typically drawn by the operating system and appear behind the Scene's fill\n+ * and background. The specific effects vary but in general the backdrop will\n+ * track the window's color scheme.\n+ *\n+ * Backdrops are a conditional feature. Currently they are only supported\n+ * on Windows 11 and macOS.\n+ *\n+ * @since 27\n+ *\/\n+@Deprecated(since = \"27\")\n+public enum StageBackdrop {\n+\n+    \/**\n+     * The default backdrop consistent with earlier versions of JavaFX.\n+     *\/\n+    DEFAULT,\n+\n+    \/**\n+     * A backdrop to be used when the backdrop is visible across most of the\n+     * window. This is opaque enough that you can draw text on it using the\n+     * platform's foreground color.\n+     *\/\n+    WINDOW,\n+\n+    \/**\n+     * A backdrop to be used when the backdrop is visible along one edge of\n+     * the window, like behind a sidebar or tab bar. This is opaque enough\n+     * that you can draw text on it using the platform's foreground color.\n+     *\/\n+    TABBED,\n+\n+    \/**\n+     * A backdrop useful for transient windows or heads-up displays. On some\n+     * platform this backdrop is so translucent that you cannot reliably draw\n+     * text on it. It's recommended that you set the Scene's fill to a\n+     * non-opaque color to overlay on this backdrop.\n+     *\/\n+    TRANSIENT\n+}\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/stage\/StageBackdrop.java","additions":71,"deletions":0,"binary":false,"changes":71,"status":"added"},{"patch":"@@ -29,1 +29,0 @@\n-\/\/ host view to which our views attach, so we can move our view in\/out\n@@ -32,2 +31,3 @@\n-@public\n-        NSView *view;\n+@private\n+    NSView *jfxView;\n+    NSView *backdropView;\n@@ -35,1 +35,2 @@\n-\n+-(void)setJFXView:(NSView*)view;\n+-(void)setBackdrop:(NSVisualEffectMaterial)material;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassHostView.h","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -29,0 +29,24 @@\n+- (void)setJFXView:(NSView*)view\n+{\n+    if (jfxView != nil) {\n+        [jfxView removeFromSuperview];\n+    }\n+    jfxView = view;\n+    if (jfxView) {\n+        [self addSubview: jfxView positioned: NSWindowAbove relativeTo: backdropView];\n+    }\n+}\n+\n+\/\/ Called when the window is first created.\n+-(void)setBackdrop:(NSVisualEffectMaterial)material\n+{\n+    NSVisualEffectView* effect = [[NSVisualEffectView alloc] initWithFrame: self.bounds];\n+    effect.material = material;\n+    [self addSubview: effect];\n+}\n+\n+- (void)resizeSubviewsWithOldSize:(NSSize) oldSize {\n+    for (NSView* child in self.subviews) {\n+        child.frame = self.bounds;\n+    }\n+}\n@@ -75,15 +99,0 @@\n-- (void)addSubview:(NSView *)aView\n-{\n-    [super addSubview:aView];\n-    self->view = aView;\n-}\n-\n-- (void)drawRect:(NSRect)rect\n-{\n-    \/\/NSLog(@\"Sparkle: drawRect: [%@] %.2f,%.2f %.2fx%.2f,\", self, rect.origin.x, rect.origin.y, rect.size.width, rect.size.height);\n-    \/\/NSLog(@\"Sparkle: frame: [%@] %.2f,%.2f %.2fx%.2f,\", self, [self frame].origin.x, [self frame].origin.y, [self frame].size.width, [self frame].size.height);\n-    \/\/NSLog(@\"Sparkle: bounds: [%@] %.2f,%.2f %.2fx%.2f,\", self, [self bounds].origin.x, [self bounds].origin.y, [self bounds].size.width, [self bounds].size.height);\n-    \/\/[[NSColor redColor] set];\n-    \/\/NSRectFill([self bounds]);\n-}\n-\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassHostView.m","additions":24,"deletions":15,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -291,4 +291,1 @@\n-        \/\/ embed ourselves into GlassHostView, so we can later swap our view between windows (ex. fullscreen mode)\n-        NSView *hostView = [[GlassHostView alloc] initWithFrame:NSMakeRect(0, 0, 0, 0)]; \/\/ alloc creates ref count of 1\n-        [hostView setAutoresizingMask:(NSViewWidthSizable|NSViewHeightSizable)];\n-        [hostView setAutoresizesSubviews:YES];\n+        NSView* view = [[GlassView3D alloc] initWithFrame:NSMakeRect(0, 0, 10, 10) withJview:jView withJproperties:jCapabilities];\n@@ -296,6 +293,0 @@\n-        \/\/NSLog(@\"--- hostView bounds = (%f, %f) - (%f, %f)\", [hostView bounds].origin.x, [hostView bounds].origin.y, [hostView bounds].size.width, [hostView bounds].size.height);\n-\n-        NSView* view = [[GlassView3D alloc] initWithFrame:[hostView bounds] withJview:jView withJproperties:jCapabilities];\n-        [view setAutoresizingMask:(NSViewWidthSizable|NSViewHeightSizable)];\n-\n-        [hostView addSubview:view];\n@@ -444,4 +435,4 @@\n-        NSView * host = [view superview];\n-        if (host != nil) {\n-            [view removeFromSuperview];\n-            [host release];\n+        NSView *superView = [view superview];\n+        if ([superView isKindOfClass: [GlassHostView class]]) {\n+            GlassHostView* host = (GlassHostView*) superView;\n+            [host setJFXView: nil];\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassView.m","additions":5,"deletions":14,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -47,1 +47,0 @@\n-    GlassHostView           *parentHost;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassViewDelegate.h","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -186,3 +186,0 @@\n-    [self->parentHost release];\n-    self->parentHost = nil;\n-\n@@ -219,4 +216,0 @@\n-        if (self->parentHost == nil)\n-        {\n-            self->parentHost = (GlassHostView*)[[self->nsView superview] retain];\n-        }\n@@ -1251,12 +1244,0 @@\n-\/*\n- The hierarchy for our view is view -> superview (host) -> window\n-\n- 1. create superview (new host) for our view\n- 2. create fullscreen window with the new superview\n- 3. create the background window (for fading out the desktop)\n- 4. remove our view from the window superview and insert it into the fullscreen window superview\n- 5. show our fullscreen window (and hide the original window)\n- 6. attach to it our background window (which will show it as well)\n- 7. zoom out our fullscreen window and at the same time animate the background window transparency\n- 8. enter fullscreen\n- *\/\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassViewDelegate.m","additions":0,"deletions":19,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -47,0 +47,1 @@\n+    GlassHostView       *hostView;\n@@ -92,0 +93,1 @@\n+- (void)setJFXView:(GlassView3D<GlassView>*)view;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassWindow.h","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -448,1 +448,5 @@\n-\n+- (void)setJFXView:(GlassView3D<GlassView>*)newView\n+{\n+    [hostView setJFXView: newView];\n+    view = newView;\n+}\n@@ -594,0 +598,15 @@\n+        window->hostView = [[GlassHostView alloc] initWithFrame: NSMakeRect(0, 0, 0, 0)];\n+        window->nsWindow.contentView = window->hostView;\n+\n+        switch (jStyleMask & com_sun_glass_ui_Window_BACKDROP_MASK) {\n+            case com_sun_glass_ui_Window_WINDOW_BACKDROP:\n+                [window->hostView setBackdrop: NSVisualEffectMaterialUnderWindowBackground];\n+                break;\n+            case com_sun_glass_ui_Window_TABBED_BACKDROP:\n+                [window->hostView setBackdrop: NSVisualEffectMaterialSidebar];\n+                break;\n+            case com_sun_glass_ui_Window_TRANSIENT_BACKDROP:\n+                [window->hostView setBackdrop: NSVisualEffectMaterialHUDWindow];\n+                break;\n+        }\n+\n@@ -919,0 +938,1 @@\n+        [window setJFXView: getMacView(env, jview)];\n@@ -939,9 +959,0 @@\n-            CALayer *layer = [window->view getLayer];\n-            LOG(\"   layer: %p\", layer);\n-            \/\/ TODO : Move below logic to CGL specific View\/Layer class\n-            if (([layer.sublayers[0] isKindOfClass:[CAOpenGLLayer class]] == YES) &&\n-                (([window->nsWindow styleMask] & NSWindowStyleMaskTexturedBackground) == NO))\n-            {\n-                [((CAOpenGLLayer*)layer) setOpaque:[window->nsWindow isOpaque]];\n-            }\n-\n@@ -959,1 +970,0 @@\n-                [window->nsWindow setContentView:[window->view superview]]; \/\/ use our superview not ourselves!\n@@ -965,7 +975,0 @@\n-        else\n-        {\n-            \/\/ If the contentView is set to nil within performKeyEquivalent: the OS will crash.\n-            NSView* dummy = [[NSView alloc] initWithFrame: NSMakeRect(0, 0, 10, 10)];\n-            [window->nsWindow performSelectorOnMainThread:@selector(setContentView:) withObject:dummy waitUntilDone:YES];\n-            [dummy release];\n-        }\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassWindow.m","additions":21,"deletions":18,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -150,0 +150,27 @@\n+\/*static*\/\n+BOOL BaseWnd::BackdropsSupported()\n+{\n+    HINSTANCE hInst = ::GetModuleHandle(NULL);\n+    TCHAR* szClassName = L\"GLASSDEFAULTWINDOW\";\n+    BOOL supported = FALSE;\n+\n+    WNDCLASS wndcls;\n+    ::ZeroMemory(&wndcls, sizeof(WNDCLASS));\n+    wndcls.lpfnWndProc      = StaticWindowProc;\n+    wndcls.hInstance        = hInst;\n+    wndcls.lpszClassName    = szClassName;\n+    ::RegisterClass(&wndcls);\n+\n+    HWND hwnd = ::CreateWindow(szClassName, L\"\", WS_OVERLAPPED,\n+                               CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,\n+                               0, 0, 0, 0);\n+\n+    DWM_SYSTEMBACKDROP_TYPE type = DWMSBT_AUTO;\n+    supported = SUCCEEDED(DwmSetWindowAttribute(hwnd, DWMWA_SYSTEMBACKDROP_TYPE, &type, sizeof(type)));\n+\n+    ::DestroyWindow(hwnd);\n+    ::UnregisterClass(szClassName, hInst);\n+\n+    return supported;\n+}\n+\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/win\/BaseWnd.cpp","additions":27,"deletions":0,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -53,0 +53,1 @@\n+    static BOOL BackdropsSupported();\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/win\/BaseWnd.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -510,0 +510,12 @@\n+\/*\n+ * Class:     com_sun_glass_ui_Application\n+ * Method:    _supportsWindowBackdrops\n+ * Signature: ()Z\n+ *\/\n+JNIEXPORT jboolean JNICALL Java_com_sun_glass_ui_win_WinApplication__1supportsWindowBackdrops\n+    (JNIEnv * env, jobject japplication)\n+{\n+    static bool supported = BaseWnd::BackdropsSupported();\n+    return supported;\n+}\n+\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/win\/GlassApplication.cpp","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -77,1 +77,0 @@\n-    m_isResizable(true),\n@@ -82,0 +81,2 @@\n+    m_isResizable(true),\n+    m_hasBackdrop(false),\n@@ -341,1 +342,1 @@\n-            if (m_isUnified && (IS_WINVISTA)) {\n+            if (m_isUnified || m_hasBackdrop) {\n@@ -1442,0 +1443,25 @@\n+void GlassWindow::EnableBackdrop(BackdropStyle style)\n+{\n+    m_hasBackdrop = true;\n+\n+    DWM_SYSTEMBACKDROP_TYPE type = DWMSBT_TRANSIENTWINDOW;\n+    switch (style) {\n+        case Window:\n+            type = DWMSBT_MAINWINDOW;\n+            break;\n+        case Tabbed:\n+            type = DWMSBT_TABBEDWINDOW;\n+            break;\n+        case Transient:\n+            type = DWMSBT_TRANSIENTWINDOW;\n+            break;\n+    }\n+    DwmSetWindowAttribute(GetHWND(), DWMWA_SYSTEMBACKDROP_TYPE, &type, sizeof(type));\n+\n+    \/\/ In case the user asks for the accent color to tint the title bar. We\n+    \/\/ don't want DWM to draw this since it doesn't know the correct title\n+    \/\/ bar height.\n+    COLORREF captionColor = DWMWA_COLOR_NONE;\n+    DwmSetWindowAttribute(GetHWND(), DWMWA_CAPTION_COLOR, &captionColor, sizeof(captionColor));\n+}\n+\n@@ -1578,1 +1604,1 @@\n-            mask |= com_sun_glass_ui_Window_TITLED;\n+            dwExStyle = WS_EX_WINDOWEDGE;\n@@ -1618,0 +1644,4 @@\n+        if (mask & com_sun_glass_ui_Window_EXTENDED) {\n+            mask |= com_sun_glass_ui_Window_TITLED;\n+        }\n+\n@@ -1642,0 +1672,12 @@\n+\n+            switch (mask & com_sun_glass_ui_Window_BACKDROP_MASK) {\n+                case com_sun_glass_ui_Window_WINDOW_BACKDROP:\n+                    pWindow->EnableBackdrop(GlassWindow::BackdropStyle::Window);\n+                    break;\n+                case com_sun_glass_ui_Window_TABBED_BACKDROP:\n+                    pWindow->EnableBackdrop(GlassWindow::BackdropStyle::Tabbed);\n+                    break;\n+                case com_sun_glass_ui_Window_TRANSIENT_BACKDROP:\n+                    pWindow->EnableBackdrop(GlassWindow::BackdropStyle::Transient);\n+                    break;\n+            }\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/win\/GlassWindow.cpp","additions":45,"deletions":3,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -106,0 +106,8 @@\n+\n+    enum BackdropStyle {\n+        Window,\n+        Tabbed,\n+        Transient\n+    };\n+    void EnableBackdrop(BackdropStyle style);\n+\n@@ -153,0 +161,1 @@\n+    bool m_hasBackdrop;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/win\/GlassWindow.h","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -42,0 +42,1 @@\n+    params.BackBufferFormat = D3DFMT_A8R8G8B8;\n","filename":"modules\/javafx.graphics\/src\/main\/native-prism-d3d\/D3DContextInit.cc","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -559,0 +559,1 @@\n+    newParams.BackBufferFormat = D3DFMT_A8R8G8B8;\n","filename":"modules\/javafx.graphics\/src\/main\/native-prism-d3d\/D3DResourceManager.cc","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+import javafx.stage.StageBackdrop;\n@@ -149,1 +150,2 @@\n-                                 Modality modality, TKStage owner, boolean rtl, boolean darkFrame) {\n+                                 Modality modality, TKStage owner, boolean rtl,\n+                                 boolean darkFrame, StageBackdrop backdrop) {\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/com\/sun\/javafx\/pgstub\/StubToolkit.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,319 @@\n+\/*\n+ * Copyright (c) 2025 Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import javafx.application.Application;\n+import javafx.application.Platform;\n+import javafx.application.ColorScheme;\n+import javafx.application.Platform.Preferences;\n+import javafx.geometry.Pos;\n+import javafx.geometry.Insets;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ChoiceBox;\n+import javafx.scene.control.Label;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.layout.BorderPane;\n+import javafx.scene.layout.HeaderBar;\n+import javafx.scene.paint.Color;\n+import javafx.scene.Node;\n+import javafx.scene.Parent;\n+import javafx.scene.Scene;\n+import javafx.stage.Stage;\n+import javafx.stage.StageStyle;\n+import javafx.stage.StageBackdrop;\n+import javafx.stage.Window;\n+\n+public class BackdropTest extends Application {\n+    public static void main(String[] args) {\n+        launch(BackdropTest.class, args);\n+    }\n+\n+    private enum StageStyleChoice {\n+        DECORATED(\"Decorated\", StageStyle.DECORATED),\n+        UNDECORATED(\"Undecorated\", StageStyle.UNDECORATED),\n+        EXTENDED(\"Extended\", StageStyle.EXTENDED),\n+        UTILITY(\"Utility\", StageStyle.UTILITY),\n+        TRANSPARENT(\"Transparent\", StageStyle.TRANSPARENT),\n+        UNIFIED(\"Unified\", StageStyle.UNIFIED);\n+\n+        private String label;\n+        private StageStyle stageStyle;\n+\n+        StageStyleChoice(String label, StageStyle style) {\n+            this.label = label;\n+            this.stageStyle = style;\n+        }\n+\n+        public StageStyle getStageStyle() {\n+            return stageStyle;\n+        }\n+\n+        public String toString() {\n+            return label;\n+        }\n+    }\n+\n+    private enum StageBackdropChoice {\n+        DEFAULT(\"Default\", StageBackdrop.DEFAULT),\n+        WINDOW(\"Window\", StageBackdrop.WINDOW),\n+        TABBED(\"Tabbed\", StageBackdrop.TABBED),\n+        TRANSIENT(\"Transient\", StageBackdrop.TRANSIENT);\n+\n+        private String label;\n+        private StageBackdrop backdrop;\n+\n+        StageBackdropChoice(String label, StageBackdrop backdrop) {\n+            this.label = label;\n+            this.backdrop = backdrop;\n+        }\n+\n+        public StageBackdrop getBackdrop() {\n+            return backdrop;\n+        }\n+\n+        public String toString() {\n+            return label;\n+        }\n+    }\n+\n+    private enum FillChoice {\n+        NONE(\"None\", null),\n+        TRANSPARENT(\"Transparent\", Color.TRANSPARENT),\n+        BLUE(\"Light blue\", Color.LIGHTBLUE),\n+        TRANSLUCENT_RED(\"Red (50% opaque)\", new Color(1.0, 0.0, 0.0, 0.5)),\n+        TRANSLUCENT_GREEN(\"Green (20% opaque)\", new Color(0.0, 1.0, 0.0, 0.2));\n+\n+        private String label;\n+        private Color color;\n+\n+        FillChoice(String label, Color color) {\n+            this.label = label;\n+            this.color = color;\n+        }\n+\n+        Color getFill() {\n+            return color;\n+        }\n+\n+        public String toString() {\n+            return label;\n+        }\n+    }\n+\n+    private enum ColorSchemeChoice {\n+        LIGHT(\"Light\", ColorScheme.LIGHT),\n+        DARK(\"Dark\", ColorScheme.DARK);\n+\n+        private String label;\n+        private ColorScheme scheme;\n+\n+        ColorSchemeChoice(String label, ColorScheme scheme) {\n+            this.label = label;\n+            this.scheme = scheme;\n+        }\n+\n+        ColorScheme getColorScheme() {\n+            return scheme;\n+        }\n+\n+        public String toString() {\n+            return label;\n+        }\n+    }\n+\n+    private enum OpacityChoice {\n+        P100(\"100%\", 1.0),\n+        P75(\"75%\", 0.75),\n+        P50(\"50%\", 0.50);\n+\n+        private String label;\n+        private double opacity;\n+\n+        OpacityChoice(String label, double opacity) {\n+            this.label = label;\n+            this.opacity = opacity;\n+        }\n+\n+        double getOpacity() {\n+            return opacity;\n+        }\n+\n+        public String toString() {\n+            return label;\n+        }\n+    }\n+\n+    private Label newLabel(String text) {\n+        var label = new Label(text);\n+        label.textFillProperty().bind(Platform.getPreferences().foregroundColorProperty());\n+        return label;\n+    }\n+\n+    private Parent labeledSection(String text, Parent section) {\n+        var label = newLabel(text);\n+        VBox box = new VBox(label, section);\n+        box.setSpacing(5);\n+        return box;\n+    }\n+\n+    private Parent labeledSection(String text) {\n+        var label = newLabel(text);\n+        VBox box = new VBox(label);\n+        box.setSpacing(5);\n+        return box;\n+    }\n+\n+    private void buildScene(Stage stage, StageStyleChoice stageStyle, StageBackdropChoice backdrop) {\n+\n+        var iconifyButton = new Button(\"Iconify\");\n+        iconifyButton.setOnAction(e -> {\n+            stage.setIconified(!stage.isIconified());\n+        });\n+\n+        var maximizeButton = new Button(\"Maximize\");\n+        maximizeButton.setOnAction(e -> {\n+            stage.setMaximized(!stage.isMaximized());\n+        });\n+\n+        var fullscreenButton = new Button(\"Fullscreen\");\n+        fullscreenButton.setOnAction(e -> {\n+            stage.setFullScreen(!stage.isFullScreen());\n+        });\n+\n+        var closeButton = new Button(\"Close\");\n+        closeButton.setOnAction(e -> {\n+            stage.close();\n+        });\n+\n+        var actionButtons = new HBox(fullscreenButton, maximizeButton, iconifyButton, closeButton);\n+        actionButtons.setSpacing(5);\n+        actionButtons.setAlignment(Pos.BASELINE_RIGHT);\n+\n+        \/\/ For creating new stages\n+        var styleLabel = newLabel(\"Style\");\n+        ChoiceBox<StageStyleChoice> stageStyleChoice = new ChoiceBox<>();\n+        stageStyleChoice.getItems().setAll(StageStyleChoice.values());\n+        stageStyleChoice.setValue(stageStyle);\n+\n+        var backdropLabel = newLabel(\"backdrop\");\n+        ChoiceBox<StageBackdropChoice> backdropChoice = new ChoiceBox<>();\n+        backdropChoice.getItems().setAll(StageBackdropChoice.values());\n+        backdropChoice.setValue(backdrop);\n+\n+        Button createButton = new Button(\"Create!\");\n+        createButton.setOnAction(e -> {\n+            createAndShowStage(stageStyleChoice.getValue(), backdropChoice.getValue());\n+        });\n+\n+        HBox stageCreationControls = new HBox(styleLabel, stageStyleChoice, backdropLabel, backdropChoice, createButton);\n+        stageCreationControls.setAlignment(Pos.BASELINE_LEFT);\n+        stageCreationControls.setSpacing(10);\n+\n+        ChoiceBox<FillChoice> fillChoice = new ChoiceBox<>();\n+        fillChoice.getItems().setAll(FillChoice.values());\n+\n+        ChoiceBox<ColorSchemeChoice> schemeChoice = new ChoiceBox<>();\n+        schemeChoice.getItems().setAll(ColorSchemeChoice.values());\n+\n+        ChoiceBox<OpacityChoice> opacityChoice = new ChoiceBox<>();\n+        opacityChoice.getItems().setAll(OpacityChoice.values());\n+\n+        \/\/ Pull it together\n+        VBox controls = new VBox(\n+            labeledSection(\"This stage is \" + stageStyle + \" and the backdrop is \" + backdrop),\n+            labeledSection(\"New stage\", stageCreationControls),\n+            labeledSection(\"Fill color for this stage\", fillChoice),\n+            labeledSection(\"Color scheme for this stage\", schemeChoice),\n+            labeledSection(\"Opacity of this stage\", opacityChoice)\n+        );\n+\n+        controls.setAlignment(Pos.BASELINE_LEFT);\n+        controls.setSpacing(10);\n+        controls.setPadding(new Insets(10, 10, 10, 10));\n+\n+        var borderPane = new BorderPane();\n+        borderPane.setTop(actionButtons);\n+        borderPane.setCenter(controls);\n+        borderPane.setBackground(null);\n+        borderPane.setPadding(new Insets(10, 10, 10, 10));\n+        borderPane.setOnMousePressed(pressEvent -> {\n+            borderPane.setOnMouseDragged(dragEvent -> {\n+                stage.setX(dragEvent.getScreenX() - pressEvent.getSceneX());\n+                stage.setY(dragEvent.getScreenY() - pressEvent.getSceneY());\n+            });\n+        });\n+\n+        Parent root = borderPane;\n+        if (stage.getStyle() == StageStyle.EXTENDED) {\n+            var headerBar = new HeaderBar();\n+            headerBar.setCenter(new Label(stage.getTitle()));\n+            var box = new VBox(headerBar, borderPane);\n+            box.setBackground(null);\n+            root = box;\n+        }\n+\n+        Scene scene = new Scene(root, 640, 480, Color.TRANSPARENT);\n+\n+        fillChoice.setOnAction(e -> {\n+            scene.setFill(fillChoice.getValue().getFill());\n+        });\n+        schemeChoice.setOnAction(e -> {\n+            scene.getPreferences().setColorScheme(schemeChoice.getValue().getColorScheme());\n+        });\n+        opacityChoice.setOnAction(e -> {\n+            stage.setOpacity(opacityChoice.getValue().getOpacity());\n+        });\n+\n+        fillChoice.setValue(FillChoice.TRANSPARENT);\n+        if (Platform.getPreferences().getColorScheme() == ColorScheme.LIGHT) {\n+            schemeChoice.setValue(ColorSchemeChoice.LIGHT);\n+        } else {\n+            schemeChoice.setValue(ColorSchemeChoice.DARK);\n+        }\n+        opacityChoice.setValue(OpacityChoice.P100);\n+\n+        stage.setScene(scene);\n+    }\n+\n+    private void showStage(Stage stage, StageStyleChoice style, StageBackdropChoice backdrop)\n+    {\n+        stage.setTitle(style.toString());\n+        stage.initStyle(style.getStageStyle());\n+        stage.initBackdrop(backdrop.getBackdrop());\n+        buildScene(stage, style, backdrop);\n+        stage.show();\n+    }\n+\n+    private void createAndShowStage(StageStyleChoice style, StageBackdropChoice backdrop)\n+    {\n+        Stage stage = new Stage();\n+        showStage(stage, style, backdrop);\n+    }\n+\n+    @Override\n+    public void start(Stage stage) {\n+        showStage(stage, StageStyleChoice.EXTENDED, StageBackdropChoice.WINDOW);\n+    }\n+}\n","filename":"tests\/manual\/stage\/BackdropTest.java","additions":319,"deletions":0,"binary":false,"changes":319,"status":"added"}]}