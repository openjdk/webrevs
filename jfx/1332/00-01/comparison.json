{"files":[{"patch":"@@ -195,1 +195,1 @@\n-        return lights == null || lights[0] == null;\n+        return lights == null || lights.length == 0 || lights[0] == null;\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/sg\/prism\/NGShape3D.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -95,0 +95,1 @@\n+import java.util.stream.Stream;\n@@ -1301,13 +1302,0 @@\n-    \/*\n-     * Shared between Scene and SubScene\n-     *\/\n-    static NGLightBase[] accumulateLightsForSnapshot(List<LightBase> lights) {\n-        if (lights == null || lights.isEmpty()) return null;\n-\n-        NGLightBase[] l = new NGLightBase[lights.size()];\n-        for (int i = 0; i < lights.size(); i++) {\n-            l[i] = lights.get(i).getPeer();\n-        }\n-        return l;\n-    }\n-\n@@ -1363,2 +1351,4 @@\n-        context.lights = null;\n-        int totalLightCount = 0;\n+        Stream<NGLightBase> lights = Stream.concat(\n+            Optional.ofNullable(scene).stream().flatMap(s -> s.lights.stream()).map(LightBase::getPeer),\n+            Optional.ofNullable(subScene).stream().flatMap(s -> s.getLights().stream()).map(LightBase::getPeer)\n+        );\n@@ -1366,25 +1356,1 @@\n-        NGLightBase[] sceneLights = (scene != null) ? accumulateLightsForSnapshot(scene.lights) : null;\n-        NGLightBase[] subSceneLights = (subScene != null) ? accumulateLightsForSnapshot(subScene.getLights()) : null;\n-        if (sceneLights != null) {\n-            totalLightCount += sceneLights.length;\n-        }\n-        if (subSceneLights != null) {\n-            totalLightCount += subSceneLights.length;\n-        }\n-\n-        if (totalLightCount > 0) {\n-            context.lights = new NGLightBase[totalLightCount];\n-\n-            int totalLightsAdded = 0;\n-            if (sceneLights != null) {\n-                for (int i = 0; i < sceneLights.length; i++) {\n-                    context.lights[i] = sceneLights[i];\n-                }\n-                totalLightsAdded += sceneLights.length;\n-            }\n-            if (subSceneLights != null) {\n-                for (int i = 0; i < subSceneLights.length; i++) {\n-                    context.lights[i + totalLightsAdded] = subSceneLights[i];\n-                }\n-            }\n-        }\n+        context.lights = lights.toArray(NGLightBase[]::new);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/Scene.java","additions":6,"deletions":40,"binary":false,"changes":46,"status":"modified"}]}