{"files":[{"patch":"@@ -27,0 +27,1 @@\n+import com.sun.glass.events.MouseEvent;\n@@ -271,0 +272,1 @@\n+    native private void _showSystemMenu(long ptr, int x, int y);\n@@ -372,1 +374,11 @@\n-            return overlay.handleMouseEvent(type, button, wx, wy);\n+            boolean handled = overlay.handleMouseEvent(type, button, wx, wy);\n+\n+            \/\/ A right click on a non-client header bar area opens the system menu.\n+            if (!handled && type == MouseEvent.NC_UP && button == MouseEvent.BUTTON_RIGHT) {\n+                View.EventHandler eventHandler = view != null ? view.getEventHandler() : null;\n+                if (eventHandler != null && eventHandler.handleDragAreaHitTestEvent(wx, wy)) {\n+                    _showSystemMenu(getRawHandle(), x, y);\n+                }\n+            }\n+\n+            return handled;\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/win\/WinWindow.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1221,0 +1221,42 @@\n+void GlassWindow::ShowSystemMenu(int x, int y)\n+{\n+    WINDOWPLACEMENT placement;\n+    if (!::GetWindowPlacement(GetHWND(), &placement)) {\n+        return;\n+    }\n+\n+    HMENU systemMenu = GetSystemMenu(GetHWND(), FALSE);\n+    bool maximized = placement.showCmd == SW_SHOWMAXIMIZED;\n+\n+    MENUITEMINFO menuItemInfo { sizeof(MENUITEMINFO) };\n+    menuItemInfo.fMask = MIIM_STATE;\n+    menuItemInfo.fType = MFT_STRING;\n+\n+    menuItemInfo.fState = maximized ? MF_ENABLED : MF_DISABLED;\n+    SetMenuItemInfo(systemMenu, SC_RESTORE, FALSE, &menuItemInfo);\n+\n+    menuItemInfo.fState = maximized ? MF_DISABLED : MF_ENABLED;\n+    SetMenuItemInfo(systemMenu, SC_MOVE, FALSE, &menuItemInfo);\n+\n+    menuItemInfo.fState = maximized ? MF_DISABLED : MF_ENABLED;\n+    SetMenuItemInfo(systemMenu, SC_SIZE, FALSE, &menuItemInfo);\n+\n+    menuItemInfo.fState = MF_ENABLED;\n+    SetMenuItemInfo(systemMenu, SC_MINIMIZE, FALSE, &menuItemInfo);\n+\n+    menuItemInfo.fState = maximized ? MF_DISABLED : MF_ENABLED;\n+    SetMenuItemInfo(systemMenu, SC_MAXIMIZE, FALSE, &menuItemInfo);\n+\n+    menuItemInfo.fState = MF_ENABLED;\n+    SetMenuItemInfo(systemMenu, SC_CLOSE, FALSE, &menuItemInfo);\n+    SetMenuDefaultItem(systemMenu, UINT_MAX, FALSE);\n+\n+    POINT ptAbs = { x, y };\n+    ::ClientToScreen(GetHWND(), &ptAbs);\n+\n+    BOOL menuItem = TrackPopupMenu(systemMenu, TPM_RETURNCMD, ptAbs.x, ptAbs.y, 0, GetHWND(), NULL);\n+    if (menuItem != 0) {\n+        PostMessage(GetHWND(), WM_SYSCOMMAND, menuItem, 0);\n+    }\n+}\n+\n@@ -2051,0 +2093,23 @@\n+\/*\n+ * Class:     com_sun_glass_ui_win_WinWindow\n+ * Method:    _showSystemMenu\n+ * Signature: (JII)V\n+ *\/\n+JNIEXPORT void JNICALL Java_com_sun_glass_ui_win_WinWindow__1showSystemMenu\n+    (JNIEnv *env, jobject jThis, jlong ptr, jint x, jint y)\n+{\n+    ENTER_MAIN_THREAD()\n+    {\n+        GlassWindow *pWindow = GlassWindow::FromHandle(hWnd);\n+        if (pWindow) {\n+            pWindow->ShowSystemMenu(x, y);\n+        }\n+    }\n+    jint x, y;\n+    LEAVE_MAIN_THREAD_WITH_hWnd;\n+\n+    ARG(x) = x;\n+    ARG(y) = y;\n+    PERFORM();\n+}\n+\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/win\/GlassWindow.cpp","additions":65,"deletions":0,"binary":false,"changes":65,"status":"modified"},{"patch":"@@ -106,0 +106,1 @@\n+    void ShowSystemMenu(int x, int y);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/win\/GlassWindow.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}