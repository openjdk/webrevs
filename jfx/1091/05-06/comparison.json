{"files":[{"patch":"@@ -107,1 +107,0 @@\n-    static CountDownLatch textSetLatch;\n@@ -128,2 +127,0 @@\n-    CountDownLatch mouseClickLatch;\n-\n@@ -135,1 +132,0 @@\n-            mouseClickLatch.countDown();\n@@ -140,1 +136,0 @@\n-        mouseClickLatch = new CountDownLatch(1);\n@@ -143,1 +138,0 @@\n-        Util.waitForLatch(mouseClickLatch, 5, \"Timeout waiting for mouse click\");\n@@ -147,1 +141,0 @@\n-        textSetLatch = new CountDownLatch(1);\n@@ -153,2 +146,0 @@\n-\n-            textSetLatch.countDown();\n@@ -156,1 +147,0 @@\n-        Util.waitForLatch(textSetLatch, 5, \"Timeout waiting for text intialization.\");\n@@ -160,1 +150,0 @@\n-        textSetLatch = new CountDownLatch(1);\n@@ -162,1 +151,1 @@\n-            text = new Text(\"ðŸ˜ŠðŸ˜‡â¤ï¸ðŸ’™ðŸ¦‹ðŸðŸ”¥\");\n+            text = new Text(\"ðŸ˜ŠðŸ˜‡ðŸ’™ðŸ¦‹ðŸðŸ”¥\");\n@@ -166,2 +155,0 @@\n-\n-            textSetLatch.countDown();\n@@ -169,1 +156,0 @@\n-        Util.waitForLatch(textSetLatch, 5, \"Timeout waiting for text intialization.\");\n@@ -173,1 +159,0 @@\n-        textSetLatch = new CountDownLatch(1);\n@@ -175,1 +160,1 @@\n-            text = new Text(\"Text ðŸ˜ŠðŸ˜‡â¤ï¸ðŸ’™ðŸ¦‹ðŸ”¥\");\n+            text = new Text(\"Text ðŸ˜ŠðŸ˜‡ðŸ’™ðŸ¦‹ðŸ”¥\");\n@@ -179,2 +164,0 @@\n-\n-            textSetLatch.countDown();\n@@ -182,1 +165,0 @@\n-        Util.waitForLatch(textSetLatch, 5, \"Timeout waiting for text intialization.\");\n@@ -186,1 +168,0 @@\n-        textSetLatch = new CountDownLatch(1);\n@@ -196,2 +177,0 @@\n-\n-            textSetLatch.countDown();\n@@ -199,1 +178,0 @@\n-        Util.waitForLatch(textSetLatch, 5, \"Timeout waiting for text intialization.\");\n@@ -203,1 +181,0 @@\n-        textSetLatch = new CountDownLatch(1);\n@@ -210,2 +187,0 @@\n-\n-            textSetLatch.countDown();\n@@ -213,1 +188,0 @@\n-        Util.waitForLatch(textSetLatch, 5, \"Timeout waiting for text intialization.\");\n@@ -219,1 +193,1 @@\n-        Thread.sleep(500);\n+        Util.waitForIdle(scene);\n@@ -233,1 +207,1 @@\n-        Thread.sleep(500);\n+        Util.waitForIdle(scene);\n@@ -251,1 +225,1 @@\n-        Thread.sleep(500);\n+        Util.waitForIdle(scene);\n@@ -271,1 +245,1 @@\n-        Thread.sleep(500);\n+        Util.waitForIdle(scene);\n@@ -292,1 +266,1 @@\n-        Thread.sleep(500);\n+        Util.waitForIdle(scene);\n@@ -309,1 +283,1 @@\n-        Thread.sleep(500);\n+        Util.waitForIdle(scene);\n","filename":"tests\/system\/src\/test\/java\/test\/robot\/javafx\/scene\/TextFlowSurrogatePairInsertionIndexTest.java","additions":8,"deletions":34,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+import javafx.scene.Scene;\n@@ -425,0 +426,32 @@\n+\n+    \/**\n+     * Triggers and waits for 10 pulses to complete in the specified scene.\n+     *\/\n+    public static void waitForIdle(Scene scene) {\n+        waitForIdle(scene, 10);\n+    }\n+\n+    \/**\n+     * Triggers and waits for specified number of pulses (pulseCount)\n+     * to complete in the specified scene.\n+     *\/\n+    public static void waitForIdle(Scene scene, int pulseCount) {\n+        CountDownLatch latch = new CountDownLatch(pulseCount);\n+        Runnable pulseListener = () -> {\n+            latch.countDown();\n+            Platform.requestNextPulse();\n+        };\n+\n+        runAndWait(() -> {\n+            scene.addPostLayoutPulseListener(pulseListener);\n+        });\n+\n+        try {\n+            Platform.requestNextPulse();\n+            waitForLatch(latch, TIMEOUT, \"Timeout waiting for post layout pulse\");\n+        } finally {\n+            runAndWait(() -> {\n+                scene.removePostLayoutPulseListener(pulseListener);\n+            });\n+        }\n+    }\n","filename":"tests\/system\/src\/test\/java\/test\/util\/Util.java","additions":33,"deletions":0,"binary":false,"changes":33,"status":"modified"}]}