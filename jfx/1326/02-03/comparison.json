{"files":[{"patch":"@@ -131,14 +131,2 @@\n-            double oldValue = flow.getPosition();\n-            double newValue = ((getMax() - getMin()) * Utils.clamp(0, pos, 1)) + getMin();\n-            \/*\n-             * Scroll the block increment further in the direction the user has clicked if only one cell is shown.\n-             * Otherwise, a click on the trough would have no effect when cell height > viewport height.\n-             *\/\n-            IndexedCell<?> firstVisibleCell = flow.getFirstVisibleCell();\n-            IndexedCell<?> lastVisibleCell = flow.getLastVisibleCell();\n-            if (firstVisibleCell != null && firstVisibleCell == lastVisibleCell) {\n-                if (newValue < oldValue) {\n-                    flow.scrollPixels(-flow.getBlockIncrement());\n-                } else {\n-                    flow.scrollPixels(flow.getBlockIncrement());\n-                }\n+            if (pos < getValue()) {\n+                flow.scrollPixels(-flow.getBlockIncrement());\n@@ -146,13 +134,1 @@\n-                if (newValue < oldValue) {\n-                    IndexedCell<?> cell = firstVisibleCell;\n-                    if (cell == null) {\n-                        return;\n-                    }\n-                    flow.scrollToBottom(cell);\n-                } else if (newValue > oldValue) {\n-                    IndexedCell<?> cell = lastVisibleCell;\n-                    if (cell == null) {\n-                        return;\n-                    }\n-                    flow.scrollToTop(cell);\n-                }\n+                flow.scrollPixels(flow.getBlockIncrement());\n","filename":"modules\/javafx.controls\/src\/main\/java\/com\/sun\/javafx\/scene\/control\/VirtualScrollBar.java","additions":3,"deletions":27,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -1809,2 +1809,1 @@\n-        \/\/ For reasons of backward compatibility, we use the cell length of the empty cell (cell index -1)\n-        return getCellLength(-1);\n+        return getViewportLength();\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/VirtualFlow.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -61,0 +61,5 @@\n+    @Override\n+    public double getCellSize(int idx) {\n+        return super.getCellSize(idx);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/shims\/java\/javafx\/scene\/control\/skin\/VirtualFlowShim.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -49,0 +49,1 @@\n+import test.com.sun.javafx.scene.control.infrastructure.MouseEventFirer;\n@@ -59,0 +60,4 @@\n+import java.util.function.DoubleSupplier;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n@@ -1844,4 +1849,4 @@\n-        testScrollBarValueAdjustment(1, 1.0, 0.2, -100);\n-        testScrollBarValueAdjustment(3, 1.0, 0.2, -100);\n-        testScrollBarValueAdjustment(1, 0.5, 0.2, -100);\n-        testScrollBarValueAdjustment(3, 0.5, 0.2, -100);\n+        testScrollBarValueAdjustment(1, 1.0, 0.2, () -> -flow.getBlockIncrement());\n+        testScrollBarValueAdjustment(3, 1.0, 0.2, () -> -flow.getBlockIncrement());\n+        testScrollBarValueAdjustment(1, 0.5, 0.2, () -> -flow.getBlockIncrement());\n+        testScrollBarValueAdjustment(3, 0.5, 0.2, () -> -flow.getBlockIncrement());\n@@ -1852,4 +1857,4 @@\n-        testScrollBarValueAdjustment(1, 0.0, 0.8, 100);\n-        testScrollBarValueAdjustment(3, 0.0, 0.8, 100);\n-        testScrollBarValueAdjustment(1, 0.5, 0.8, 100);\n-        testScrollBarValueAdjustment(3, 0.5, 0.8, 100);\n+        testScrollBarValueAdjustment(1, 0.0, 0.8, () -> flow.getBlockIncrement());\n+        testScrollBarValueAdjustment(3, 0.0, 0.8, () -> flow.getBlockIncrement());\n+        testScrollBarValueAdjustment(1, 0.5, 0.8, () -> flow.getBlockIncrement());\n+        testScrollBarValueAdjustment(3, 0.5, 0.8, () -> flow.getBlockIncrement());\n@@ -1858,1 +1863,1 @@\n-    public void testScrollBarValueAdjustment(int cellCount, double position, double adjust, double targetMovement) {\n+    public void testScrollBarValueAdjustment(int cellCount, double position, double adjust, DoubleSupplier targetMovement) {\n@@ -1864,0 +1869,1 @@\n+\n@@ -1886,2 +1892,15 @@\n-        IndexedCell<?> cell = flow.getFirstVisibleCell();\n-        double position1 = flow.getCellPosition(cell);\n+        Supplier<double[]> cellPositionsCalculater = () -> {\n+            double[] positions = new double[cellCount];\n+            IndexedCell<?> cell = flow.getFirstVisibleCell();\n+            positions[cell.getIndex()] = flow.getCellPosition(cell);\n+            for (int i = cell.getIndex() + 1; i < cellCount; i++) {\n+                positions[i] = positions[i - 1] + flow.getCellSize(i - 1);\n+            }\n+            for (int i = cell.getIndex() - 1; i >= 0; i--) {\n+                positions[i] = positions[i + 1] - flow.getCellSize(i);\n+            }\n+            return positions;\n+        };\n+\n+        double[] positionsBefore = cellPositionsCalculater.get();\n+\n@@ -1891,3 +1910,5 @@\n-        double position2 = flow.getCellPosition(cell);\n-        double movement = position1 - position2;\n-        assertEquals(targetMovement, movement, 0.1);\n+        double[] positionsAfter = cellPositionsCalculater.get();\n+\n+        for (int i = 0; i < positionsBefore.length; i++) {\n+            assertEquals(targetMovement.getAsDouble(), positionsBefore[i] - positionsAfter[i], 0.1);\n+        }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/VirtualFlowTest.java","additions":35,"deletions":14,"binary":false,"changes":49,"status":"modified"}]}