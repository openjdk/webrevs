{"files":[{"patch":"@@ -142,1 +142,1 @@\n-                    index = Math.max(0, index - 1);\n+                    flow.scrollTo(index - 1);\n@@ -144,1 +144,1 @@\n-                    index = Math.min(flow.getCellCount(), index + 1);\n+                    flow.scrollTo(index + 1);\n@@ -146,1 +146,0 @@\n-                flow.scrollTo(index);\n","filename":"modules\/javafx.controls\/src\/main\/java\/com\/sun\/javafx\/scene\/control\/VirtualScrollBar.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1555,8 +1555,10 @@\n-            T cell = getAvailableCell(targetIndex);\n-            setCellIndex(cell, targetIndex);\n-            resizeCell(cell);\n-            setMaxPrefBreadth(Math.max(getMaxPrefBreadth(), getCellBreadth(cell)));\n-            cell.setVisible(true);\n-            if (downOrRight) {\n-                cells.addLast(cell);\n-                scrollPixels(getCellLength(cell));\n+            if (targetIndex < 0) {\n+                T cell = getCell(targetIndex);\n+                setMaxPrefBreadth(Math.max(getMaxPrefBreadth(), getCellBreadth(cell)));\n+                if (downOrRight) {\n+                    scrollPixels(getCellLength(cell));\n+                } else {\n+                    \/\/ up or left\n+                    scrollPixels(-getCellLength(cell));\n+                }\n+                releaseCell(cell);\n@@ -1564,3 +1566,13 @@\n-                \/\/ up or left\n-                cells.addFirst(cell);\n-                scrollPixels(-getCellLength(cell));\n+                T cell = getAvailableCell(targetIndex);\n+                setCellIndex(cell, targetIndex);\n+                resizeCell(cell);\n+                setMaxPrefBreadth(Math.max(getMaxPrefBreadth(), getCellBreadth(cell)));\n+                cell.setVisible(true);\n+                if (downOrRight) {\n+                    cells.addLast(cell);\n+                    scrollPixels(getCellLength(cell));\n+                } else {\n+                    \/\/ up or left\n+                    cells.addFirst(cell);\n+                    scrollPixels(-getCellLength(cell));\n+                }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/VirtualFlow.java","additions":23,"deletions":11,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import com.sun.javafx.scene.control.VirtualScrollBar;\n@@ -1841,0 +1842,54 @@\n+    @Test\n+    public void testScrollBarValueAdjustmentMovementUp() {\n+        testScrollBarValueAdjustment(1, 1.0, 0.2, -100);\n+        testScrollBarValueAdjustment(3, 1.0, 0.2, -100);\n+        testScrollBarValueAdjustment(1, 0.5, 0.2, -100);\n+        testScrollBarValueAdjustment(3, 0.5, 0.2, -100);\n+    }\n+\n+    @Test\n+    public void testScrollBarValueAdjustmentMovementDown() {\n+        testScrollBarValueAdjustment(1, 0.0, 0.8, 100);\n+        testScrollBarValueAdjustment(3, 0.0, 0.8, 100);\n+        testScrollBarValueAdjustment(1, 0.5, 0.8, 100);\n+        testScrollBarValueAdjustment(3, 0.5, 0.8, 100);\n+    }\n+\n+    public void testScrollBarValueAdjustment(int cellCount, double position, double adjust, double targetMovement) {\n+        flow = new VirtualFlowShim<>();\n+        class C extends CellStub {\n+            public C(VirtualFlowShim flow) {\n+                super(flow);\n+            }\n+            @Override\n+            protected double computePrefHeight(double width) {\n+                return getIndex() == 0 ? 1000 : 100;\n+            }\n+\n+            @Override\n+            protected double computeMinHeight(double width) {\n+                return computePrefHeight(width);\n+            }\n+\n+            @Override\n+            protected double computeMaxHeight(double width) {\n+                return computePrefHeight(width);\n+            }\n+        }\n+        flow.setCellFactory(fw -> new C(flow));\n+        flow.setCellCount(cellCount);\n+        flow.resize(256, 200);\n+\n+        flow.setPosition(position);\n+        pulse();\n+\n+        IndexedCell<?> cell = flow.getFirstVisibleCell();\n+        double position1 = flow.getCellPosition(cell);\n+        flow.shim_getVbar().adjustValue(adjust);\n+        pulse();\n+\n+        double position2 = flow.getCellPosition(cell);\n+        double movement = position1 - position2;\n+        assertEquals(targetMovement, movement, 0.1);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/VirtualFlowTest.java","additions":55,"deletions":0,"binary":false,"changes":55,"status":"modified"}]}