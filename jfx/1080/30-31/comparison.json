{"files":[{"patch":"@@ -105,1 +105,0 @@\n-    virtual void setOnPreEdit(bool) = 0;\n@@ -178,1 +177,0 @@\n-        bool on_preedit;\n@@ -180,0 +178,1 @@\n+        guint keyval;\n@@ -220,1 +219,0 @@\n-    void setOnPreEdit(bool);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.h","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,5 +33,0 @@\n-static void on_preedit_start(GtkIMContext *im_context, gpointer user_data) {\n-    WindowContext *ctx = (WindowContext *) user_data;\n-    ctx->setOnPreEdit(true);\n-}\n-\n@@ -80,5 +75,0 @@\n-static void on_preedit_end(GtkIMContext *im_context, gpointer user_data) {\n-    WindowContext *ctx = (WindowContext *) user_data;\n-    ctx->setOnPreEdit(false);\n-}\n-\n@@ -90,9 +80,0 @@\n-\/\/ Note: JavaFX did not have surround support at this time\n-static gboolean on_delete_surrounding(GtkIMContext* self, gint offset, gint n_chars, gpointer user_data) {\n-    return TRUE;\n-}\n-\n-static gboolean on_retrieve_surrounding(GtkIMContext* self, gpointer user_data) {\n-    return TRUE;\n-}\n-\n@@ -100,1 +81,7 @@\n-    if (im_ctx.on_preedit) {\n+    int len = g_utf8_strlen(str, -1);\n+    gunichar unicode_char = g_utf8_get_char(str);\n+\n+    \/\/ The committed IME is the same as keypress, so send keypress\n+    if (len == 1 && unicode_char == gdk_keyval_to_unicode(im_ctx.keyval)) {\n+        im_ctx.send_keypress = true;\n+    } else {\n@@ -103,1 +90,0 @@\n-        jsize slen = mainEnv->GetStringLength(jstr);\n@@ -108,2 +94,2 @@\n-                slen,\n-                slen,\n+                len,\n+                len,\n@@ -112,2 +98,0 @@\n-    } else {\n-        im_ctx.send_keypress = true;\n@@ -126,1 +110,5 @@\n-    bool filtered = gtk_im_context_filter_keypress(im_ctx.ctx, &event->key);\n+    GdkEventKey* ke = &event->key;\n+\n+    im_ctx.send_keypress = false;\n+    im_ctx.keyval = ke->keyval;\n+    bool filtered = gtk_im_context_filter_keypress(im_ctx.ctx, ke);\n@@ -129,2 +117,1 @@\n-        process_key(&event->key);\n-        im_ctx.send_keypress = false;\n+        return false;\n@@ -136,4 +123,0 @@\n-void WindowContextBase::setOnPreEdit(bool preedit) {\n-    im_ctx.on_preedit = preedit;\n-}\n-\n@@ -162,1 +145,1 @@\n-    if (im_ctx.on_preedit) {\n+    if (im_ctx.enabled) {\n@@ -169,1 +152,0 @@\n-        g_signal_connect(im_ctx.ctx, \"preedit-start\", G_CALLBACK(on_preedit_start), this);\n@@ -171,1 +153,0 @@\n-        g_signal_connect(im_ctx.ctx, \"preedit-end\", G_CALLBACK(on_preedit_end), this);\n@@ -173,2 +154,0 @@\n-        g_signal_connect(im_ctx.ctx, \"retrieve-surrounding\", G_CALLBACK(on_retrieve_surrounding), this);\n-        g_signal_connect(im_ctx.ctx, \"delete-surrounding\", G_CALLBACK(on_delete_surrounding), this);\n@@ -180,1 +159,0 @@\n-    im_ctx.on_preedit = false;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window_ime.cpp","additions":16,"deletions":38,"binary":false,"changes":54,"status":"modified"}]}