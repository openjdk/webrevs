{"files":[{"patch":"@@ -658,4 +658,0 @@\n-    public boolean canStartNestedEventLoop() {\n-        return true;\n-    }\n-\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/Application.java","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -218,5 +218,0 @@\n-    native private boolean _canStartNestedEventLoop();\n-    @Override public boolean canStartNestedEventLoop() {\n-        return _canStartNestedEventLoop();\n-    }\n-\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/mac\/MacApplication.java","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+import javafx.application.Platform;\n@@ -622,0 +623,7 @@\n+    private boolean maxNestedEventLoopsHit() {\n+        if (eventLoopMap == null) {\n+            return false;\n+        }\n+        return eventLoopMap.size() >= Platform.MAX_NESTED_EVENT_LOOPS;\n+    }\n+\n@@ -625,1 +633,1 @@\n-        return inPulse == 0 && Application.GetApplication().canStartNestedEventLoop();\n+        return inPulse == 0 && !maxNestedEventLoopsHit();\n@@ -636,2 +644,3 @@\n-            if (!Application.GetApplication().canStartNestedEventLoop()) {\n-                throw new RuntimeException(\"Exceeded limit on nested event loops\");\n+            if (maxNestedEventLoopsHit()) {\n+                throw new RuntimeException(\"Exceeded limit on number of nested event loops (\" +\n+                    Platform.MAX_NESTED_EVENT_LOOPS + \")\");\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/QuantumToolkit.java","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -274,0 +274,7 @@\n+    \/**\n+     * The maximum number of nested event loops.\n+     *\n+     * @since 25\n+     *\/\n+    public static final int MAX_NESTED_EVENT_LOOPS = 200;\n+\n@@ -305,0 +312,3 @@\n+     * @throws RuntimeException if this call would exceed the maximum\n+     * number of nested event loops.\n+     *\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/application\/Platform.java","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -66,1 +66,0 @@\n-+ (BOOL)canStartNestedEventLoop;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassApplication.h","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -56,1 +56,0 @@\n-static NSInteger nestedRunLoopRunCount = 0;\n@@ -757,10 +756,0 @@\n-+ (BOOL)canStartNestedEventLoop\n-{\n-    \/\/ Starting with macOS 15 there is an undocumented limit of 255 nested\n-    \/\/ calls to CFRunLoopRun. Exceeding that limit will crash the app with a\n-    \/\/ log that contains the phrase \"Too many nested CFRunLoopRuns\". We use a\n-    \/\/ lower value here to account for calls in the Java runtime and testing\n-    \/\/ environment.\n-    return nestedRunLoopRunCount <= 244;\n-}\n-\n@@ -776,15 +765,7 @@\n-    while (shouldKeepRunningNestedLoop) {\n-        \/\/ Platform.runLater runnables are executed from the runMode:beforeDate: call.\n-        nestedRunLoopRunCount += 1;\n-        BOOL ran = [theRL runMode:NSDefaultRunLoopMode\n-                       beforeDate:[NSDate dateWithTimeIntervalSinceNow:0.010]];\n-        nestedRunLoopRunCount -= 1;\n-        if (ran) {\n-            NSEvent * event = [app nextEventMatchingMask: 0xFFFFFFFF untilDate:nil inMode:NSDefaultRunLoopMode dequeue:YES];\n-\n-            if (event != nil) {\n-                [app sendEvent: event];\n-            }\n-        }\n-        else {\n-            break;\n+    while (shouldKeepRunningNestedLoop && [theRL runMode:NSDefaultRunLoopMode\n+                                              beforeDate:[NSDate dateWithTimeIntervalSinceNow:0.010]])\n+    {\n+        NSEvent * event = [app nextEventMatchingMask: 0xFFFFFFFF untilDate:nil inMode:NSDefaultRunLoopMode dequeue:YES];\n+\n+        if (event != nil) {\n+            [app sendEvent: event];\n@@ -1121,14 +1102,0 @@\n-\/*\n- * Class:     com_sun_glass_ui_mac_MacApplication\n- * Method:    _canStartNestedEventLoop\n- * Signature: ()Z\n- *\/\n-JNIEXPORT jboolean JNICALL Java_com_sun_glass_ui_mac_MacApplication__1canStartNestedEventLoop\n-(JNIEnv *env, jobject japplication)\n-{\n-    LOG(\"Java_com_sun_glass_ui_mac_MacApplication__1canStartNestedEventLoop\");\n-\n-    GLASS_ASSERT_MAIN_JAVA_THREAD(env);\n-    return (jboolean) [GlassApplication canStartNestedEventLoop];\n-}\n-\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassApplication.m","additions":7,"deletions":40,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -44,1 +44,0 @@\n-import com.sun.javafx.PlatformUtil;\n@@ -316,2 +315,2 @@\n-    \/\/ On some platforms there is a limit on the number of nested event loops.\n-    \/\/ An exception is thrown if we exceed this limit.\n+    \/\/ Verify that an exception is thrown if we exceed the maximum number of\n+    \/\/ nested event loops.\n@@ -352,1 +351,1 @@\n-            createManyNestedLoops(260, null, expectedException);\n+            createManyNestedLoops(Platform.MAX_NESTED_EVENT_LOOPS + 1, null, expectedException);\n@@ -356,1 +355,1 @@\n-            createManyNestedLoops(240, null, noExceptionExpected);\n+            createManyNestedLoops(Platform.MAX_NESTED_EVENT_LOOPS, null, noExceptionExpected);\n@@ -359,1 +358,1 @@\n-            assertEquals(expectedException.get(), PlatformUtil.isMac());\n+            assertTrue(expectedException.get());\n","filename":"tests\/system\/src\/test\/java\/test\/javafx\/stage\/NestedEventLoopTest.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"}]}