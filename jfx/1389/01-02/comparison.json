{"files":[{"patch":"@@ -0,0 +1,45 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package com.sun.javafx.scene.control;\n+\n+\/**\n+ * Table Cell Helper\n+ *\/\n+public class TableCellHelper {\n+    \/**\n+     * Setting this flag to true causes\n+     * TableCellSkinBase.computePrefWidth() and\n+     * TreeTableCellSkin.computePrefWidth()\n+     * to compute the actual content width rather than table column width.\n+     * (We should have never used such a logic without exposing the way to obtain\n+     * the content width!).\n+     * It is safe to use a public global flag because:\n+     * a) it's an implementation detail and\n+     * b) we are always in the content of the FX app thread\n+     * This functionality is made separate from Properties.DEFER_TO_PARENT_PREF_WIDTH which\n+     * by itself looks rather weird.\n+     *\/\n+    public static boolean useContentWidth;\n+}\n","filename":"modules\/javafx.controls\/src\/main\/java\/com\/sun\/javafx\/scene\/control\/TableCellHelper.java","additions":45,"deletions":0,"binary":false,"changes":45,"status":"added"},{"patch":"@@ -70,0 +70,1 @@\n+import com.sun.javafx.scene.control.TableCellHelper;\n@@ -837,3 +838,13 @@\n-            textTruncated.bind(Bindings.createBooleanBinding(() -> {\n-                    if (isWrapText()) {\n-                        return (getHeight() < prefHeight(getWidth()));\n+            textTruncated.bind(\n+                Bindings.createBooleanBinding(() -> {\n+                    \/\/ make sure prefWidth always returns the actual content width\n+                    \/\/ rather than the column width if inside a table\n+                    TableCellHelper.useContentWidth = true;\n+                    try {\n+                        if (isWrapText()) {\n+                            return (getHeight() < prefHeight(getWidth()));\n+                        }\n+\n+                        return (getWidth() < prefWidth(getHeight()));\n+                    } finally {\n+                        TableCellHelper.useContentWidth = false;\n@@ -841,1 +852,0 @@\n-                    return (getWidth() < prefWidth(-1));\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/Labeled.java","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-import com.sun.javafx.scene.control.Properties;\n@@ -36,0 +35,2 @@\n+import com.sun.javafx.scene.control.Properties;\n+import com.sun.javafx.scene.control.TableCellHelper;\n@@ -152,2 +153,3 @@\n-    @Override protected double computePrefWidth(double height, double topInset, double rightInset, double bottomInset, double leftInset) {\n-        if (isDeferToParentForPrefWidth) {\n+    @Override\n+    protected double computePrefWidth(double height, double topInset, double rightInset, double bottomInset, double leftInset) {\n+        if (TableCellHelper.useContentWidth || isDeferToParentForPrefWidth) {\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TableCellSkinBase.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,0 @@\n-import com.sun.javafx.scene.control.behavior.BehaviorBase;\n-import com.sun.javafx.scene.control.behavior.TreeTableCellBehavior;\n@@ -33,1 +31,10 @@\n-import javafx.scene.control.*;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.TableColumnBase;\n+import javafx.scene.control.TreeItem;\n+import javafx.scene.control.TreeTableCell;\n+import javafx.scene.control.TreeTableColumn;\n+import javafx.scene.control.TreeTableRow;\n+import javafx.scene.control.TreeTableView;\n+import com.sun.javafx.scene.control.TableCellHelper;\n+import com.sun.javafx.scene.control.behavior.BehaviorBase;\n+import com.sun.javafx.scene.control.behavior.TreeTableCellBehavior;\n@@ -126,1 +133,1 @@\n-        if (isDeferToParentForPrefWidth) {\n+        if (TableCellHelper.useContentWidth || isDeferToParentForPrefWidth) {\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TreeTableCellSkin.java","additions":12,"deletions":5,"binary":false,"changes":17,"status":"modified"}]}