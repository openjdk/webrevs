{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,2 +48,1 @@\n-    private static final DataFormat DATA_FORMAT_COLOR =\n-            new DataFormat(\"javafx.scene.color\");\n+    private static final DataFormat DATA_FORMAT_COLOR = DataFormat.of(\"javafx.scene.color\");\n","filename":"apps\/toys\/DragDrop\/src\/dragdrop\/DragDropColor.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -75,2 +75,2 @@\n-    final static DataFormat customBytes = new DataFormat(\"dndwithcontrols.custom.bytes\");\n-    final static DataFormat customString = new DataFormat(\"dndwithcontrols.custom.string\");\n+    final static DataFormat customBytes = DataFormat.of(\"dndwithcontrols.custom.bytes\");\n+    final static DataFormat customString = DataFormat.of(\"dndwithcontrols.custom.string\");\n","filename":"apps\/toys\/DragDrop\/src\/dragdrop\/DragDropWithControls.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -82,2 +82,2 @@\n-    final static DataFormat customBytes = new DataFormat(\"dndwithcontrolsswing.custom.bytes\");\n-    final static DataFormat customString = new DataFormat(\"dndwithcontrolsswing.custom.string\");\n+    final static DataFormat customBytes = DataFormat.of(\"dndwithcontrolsswing.custom.bytes\");\n+    final static DataFormat customString = DataFormat.of(\"dndwithcontrolsswing.custom.string\");\n","filename":"apps\/toys\/DragDrop\/src\/dragdrop\/DragDropWithControlsSwing.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -430,5 +430,1 @@\n-                DataFormat dataFormat = DataFormat.lookupMimeType(t);\n-                if (dataFormat == null) {\n-                    \/\/The user is interested in any format.\n-                    dataFormat = new DataFormat(t);\n-                }\n+                DataFormat dataFormat = DataFormat.of(t);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/QuantumClipboard.java","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,3 +28,0 @@\n-import java.util.Arrays;\n-import java.util.Collections;\n-import java.util.HashSet;\n@@ -33,2 +30,0 @@\n-\n-import com.sun.javafx.util.WeakReferenceQueue;\n@@ -36,0 +31,1 @@\n+import com.sun.javafx.util.WeakReferenceQueue;\n@@ -127,1 +123,4 @@\n-     * <\/p>\n+     * <p>\n+     * This constructor is deprecated and should not be used, please use {@link #of(String...)}\n+     * instead.\n+     *\n@@ -131,0 +130,1 @@\n+     * @deprecated since 27\n@@ -132,12 +132,9 @@\n-    public DataFormat(@NamedArg(\"ids\") String... ids) {\n-        DATA_FORMAT_LIST.cleanup();\n-        if (ids != null) {\n-            for (String id : ids) {\n-                if (lookupMimeType(id) != null) {\n-                    throw new IllegalArgumentException(\"DataFormat '\" + id +\n-                            \"' already exists.\");\n-                }\n-            }\n-            this.identifier = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(ids)));\n-        } else {\n-            this.identifier = Collections.<String>emptySet();\n+    @Deprecated(since = \"27\")\n+    private DataFormat(@NamedArg(\"ids\") String... ids) {\n+        Set<String> normalized = normalize(ids);\n+        synchronized (DataFormat.class) {\n+            DATA_FORMAT_LIST.cleanup();\n+            \/\/ throws IllegalArgumentException if one of the ids has already been registered\n+            lookup(true, normalized);\n+            this.identifier = normalized;\n+            DATA_FORMAT_LIST.add(this);\n@@ -145,0 +142,1 @@\n+    }\n@@ -146,2 +144,2 @@\n-        \/\/ Add to the statis data format list.\n-        DATA_FORMAT_LIST.add(this);\n+    private DataFormat(Set<String> unmodifiedNormalizedMimeTypes) {\n+        this.identifier = unmodifiedNormalizedMimeTypes;\n@@ -221,0 +219,1 @@\n+     * @deprecated since 27\n@@ -222,0 +221,1 @@\n+    @Deprecated(since = \"27\")\n@@ -226,0 +226,5 @@\n+        Set<String> ids = normalize(mimeType);\n+        synchronized (DataFormat.class) {\n+            return lookup(false, ids);\n+        }\n+    }\n@@ -227,0 +232,2 @@\n+    \/\/ requires external synchronization\n+    private static DataFormat lookup(boolean validate, Set<String> mimeTypes) {\n@@ -229,3 +236,8 @@\n-            DataFormat dataFormat = (DataFormat) itr.next();\n-            if (dataFormat.getIdentifiers().contains(mimeType)) {\n-                return dataFormat;\n+            DataFormat dataFormat = (DataFormat)itr.next();\n+            for (String id : mimeTypes) {\n+                if (dataFormat.getIdentifiers().contains(id)) {\n+                    if (validate) {\n+                        throw new IllegalArgumentException(\"DataFormat '\" + id + \"' already exists.\");\n+                    }\n+                    return dataFormat;\n+                }\n@@ -236,0 +248,48 @@\n+\n+    \/\/ returns unmodified set\n+    \/\/ can probably be inlined\n+    private static Set<String> normalize(String ... mimeTypes) {\n+        \/\/ TODO normalize? trim?\n+        return Set.of(mimeTypes);\n+    }\n+\n+    \/**\n+     * Returns an instance of DataFormat, specifying the set of ids that are associated with\n+     * this data format. Typically the ids are one or more mime types. For each\n+     * id, any data associated with this DataFormat will be registered on the\n+     * clipboard. For example, suppose I had the following:\n+     * <pre>{@code\n+     *     DataFormat fmt = new DataFormat(\"text\/foo\", \"text\/bar\");\n+     *     Clipboard clipboard = Clipboard.getSystemClipboard();\n+     *     ClipboardContent content = new ClipboardContent();\n+     *     content.put(fmt, \"Hello\");\n+     *     clipboard.setContent(content);\n+     * }<\/pre>\n+     *\n+     * With the above code, if I were to look on the clipboard, I'd find the String \"Hello\"\n+     * listed both for \"text\/foo\" and \"text\/bar\" on the clipboard.\n+     *\n+     * <p>\n+     * Note that the ids may be subject to platform restrictions in some cases.\n+     * For instance, Swing requires a mime type so if an {@code id} is not\n+     * of the \"type\/subtype\" format it won't be possible\n+     * to drag data of this type from\/to {@link javafx.embed.swing.JFXPanel}.\n+     * <\/p>\n+     * @return the new or cached DataFormat instance\n+     * @param ids The set of ids used to represent this DataFormat on the clipboard.\n+     * @throws IllegalArgumentException if one of the given mime types is already\n+     *         assigned to another DataFormat.\n+     * @since 27\n+     *\/\n+    public static DataFormat of(String ... ids) {\n+        Set<String> types = normalize(ids);\n+        synchronized (DataFormat.class) {\n+            \/\/ throws IllegalArgumentException if one of the ids has already been registered\n+            DataFormat f = lookup(true, types);\n+            if (f == null) {\n+                f = new DataFormat(types);\n+                DATA_FORMAT_LIST.add(f);\n+            }\n+            return f;\n+        }\n+    }\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/input\/DataFormat.java","additions":84,"deletions":24,"binary":false,"changes":108,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,6 +28,0 @@\n-import java.util.stream.Stream;\n-import javafx.scene.input.DataFormat;\n-\n-import org.junit.jupiter.params.ParameterizedTest;\n-import org.junit.jupiter.params.provider.Arguments;\n-import org.junit.jupiter.params.provider.MethodSource;\n@@ -38,1 +32,0 @@\n-import static org.junit.jupiter.api.Assertions.assertTrue;\n@@ -40,0 +33,7 @@\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.util.stream.Stream;\n+import javafx.scene.input.DataFormat;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n@@ -43,2 +43,2 @@\n-    static DataFormat customFormat = new DataFormat(\"Custom1\", \"Custom2\");\n-    static DataFormat uniqueFormat = new DataFormat(\"Unique\");\n+    private static final DataFormat customFormat = DataFormat.of(\"Custom1\", \"Custom2\");\n+    private static final DataFormat uniqueFormat = DataFormat.of(\"Unique\");\n@@ -46,2 +46,1 @@\n-\n-    public static Stream<Arguments> getParams() {\n+    private static Stream<Arguments> getParams() {\n@@ -89,1 +88,1 @@\n-            DataFormat customEqual = new DataFormat(format.getIdentifiers().toArray(\n+            DataFormat customEqual = DataFormat.of(format.getIdentifiers().toArray(\n@@ -94,1 +93,0 @@\n-\n@@ -104,0 +102,6 @@\n+\n+    @Test\n+    public void noMoreNullMimeTypes() {\n+        String mime = null;\n+        assertThrows(NullPointerException.class, () -> DataFormat.of(mime));\n+    }\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/javafx\/scene\/input\/DataFormatTest.java","additions":18,"deletions":14,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -83,5 +83,1 @@\n-        DataFormat dataFormat = DataFormat.lookupMimeType(mimeType);\n-        if (dataFormat == null) {\n-            dataFormat = new DataFormat(mimeType); \/\/ are we ready for this yet?\n-        }\n-        return dataFormat;\n+        return DataFormat.of(mimeType);\n","filename":"modules\/javafx.swing\/src\/main\/java\/com\/sun\/javafx\/embed\/swing\/DataFlavorUtils.java","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -291,2 +291,3 @@\n-                \/\/TODO: what to do if f == null?\n-                if (f != null) fxData.put(f, activeDSContextPeer.transferable.getData(mt));\n+                if (f != null) {\n+                    fxData.put(f, activeDSContextPeer.transferable.getData(mt));\n+                }\n","filename":"modules\/javafx.swing\/src\/main\/java\/com\/sun\/javafx\/embed\/swing\/newimpl\/FXDnDInteropN.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -299,9 +299,0 @@\n-    private static DataFormat getDataFormat(String mimeType) {\n-        synchronized (DataFormat.class) {\n-            DataFormat ret = DataFormat.lookupMimeType(mimeType);\n-            if (ret == null) {\n-                ret = new DataFormat(mimeType);\n-            }\n-            return ret;\n-        }\n-    }\n@@ -310,2 +301,2 @@\n-    private final static DataFormat DF_DRAG_IMAGE = getDataFormat(DRAG_IMAGE);\n-    private final static DataFormat DF_DRAG_IMAGE_OFFSET = getDataFormat(DRAG_IMAGE_OFFSET);\n+    private final static DataFormat DF_DRAG_IMAGE = DataFormat.of(DRAG_IMAGE);\n+    private final static DataFormat DF_DRAG_IMAGE_OFFSET = DataFormat.of(DRAG_IMAGE_OFFSET);\n@@ -321,1 +312,1 @@\n-                content.put(getDataFormat(mimeTypes[i]),\n+                content.put(DataFormat.of(mimeTypes[i]),\n","filename":"modules\/javafx.web\/src\/main\/java\/com\/sun\/javafx\/webkit\/UIClientImpl.java","additions":4,"deletions":13,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -113,1 +113,1 @@\n-    public static final DataFormat DATA_FORMAT = new DataFormat(\"application\/x-com-oracle-editable-rich-text\");\n+    public static final DataFormat DATA_FORMAT = DataFormat.of(\"application\/x-com-oracle-editable-rich-text\");\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/model\/RichTextFormatHandler.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}