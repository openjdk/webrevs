{"files":[{"patch":"@@ -39,1 +39,1 @@\n-        public TextPos replace(StyledTextModel m, StyleResolver r, TextPos start, TextPos end, StyledInput in, boolean allowUndo);\n+        public TextPos replace(StyledTextModel m, StyleResolver r, TextPos start, TextPos end, StyledInput in, boolean allowUndo, boolean isEdit);\n@@ -55,2 +55,2 @@\n-    public static TextPos replace(StyledTextModel m, StyleResolver r, TextPos start, TextPos end, StyledInput in, boolean allowUndo) {\n-        return accessor.replace(m, r, start, end, in, allowUndo);\n+    public static TextPos replace(StyledTextModel m, StyleResolver r, TextPos start, TextPos end, StyledInput in, boolean allowUndo, boolean isEdit) {\n+        return accessor.replace(m, r, start, end, in, allowUndo, isEdit);\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/StyledTextModelHelper.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -41,0 +41,1 @@\n+    private final boolean isEdit;\n@@ -47,1 +48,1 @@\n-    private UndoableChange(StyledTextModel model, TextPos start, TextPos end, StyledSegment[] undo) {\n+    private UndoableChange(StyledTextModel model, TextPos start, TextPos end, StyledSegment[] undo, boolean isEdit) {\n@@ -52,0 +53,1 @@\n+        this.isEdit = isEdit;\n@@ -64,0 +66,1 @@\n+     * @param isEdit determines whether it's a content change (true) or a style change (false)\n@@ -66,1 +69,1 @@\n-    public static UndoableChange create(StyledTextModel model, TextPos start, TextPos end) {\n+    public static UndoableChange create(StyledTextModel model, TextPos start, TextPos end, boolean isEdit) {\n@@ -71,1 +74,1 @@\n-            return new UndoableChange(model, start, end, ss);\n+            return new UndoableChange(model, start, end, ss, isEdit);\n@@ -79,1 +82,1 @@\n-        return new UndoableChange(null, null, null, null);\n+        return new UndoableChange(null, null, null, null, false);\n@@ -105,1 +108,1 @@\n-        StyledTextModelHelper.replace(model, resolver, start, endAfter, in, false);\n+        StyledTextModelHelper.replace(model, resolver, start, endAfter, in, false, isEdit);\n@@ -110,1 +113,1 @@\n-        StyledTextModelHelper.replace(model, resolver, start, endBefore, in, false);\n+        StyledTextModelHelper.replace(model, resolver, start, endBefore, in, false, isEdit);\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/UndoableChange.java","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -312,2 +312,2 @@\n-            public TextPos replace(StyledTextModel m, StyleResolver r, TextPos start, TextPos end, StyledInput in, boolean allowUndo) {\n-                return m.replace(r, start, end, in, allowUndo);\n+            public TextPos replace(StyledTextModel m, StyleResolver r, TextPos start, TextPos end, StyledInput in, boolean allowUndo, boolean isEdit) {\n+                return m.replace(r, start, end, in, allowUndo, isEdit);\n@@ -668,1 +668,1 @@\n-        return replace(resolver, start, end, input, isUndoRedoEnabled());\n+        return replace(resolver, start, end, input, isUndoRedoEnabled(), true);\n@@ -672,1 +672,1 @@\n-    private final TextPos replace(StyleResolver resolver, TextPos start, TextPos end, StyledInput input, boolean allowUndo) {\n+    private final TextPos replace(StyleResolver resolver, TextPos start, TextPos end, StyledInput input, boolean allowUndo, boolean isEdit) {\n@@ -683,1 +683,1 @@\n-        UndoableChange ch = allowUndo ? UndoableChange.create(this, start, end) : null;\n+        UndoableChange ch = allowUndo ? UndoableChange.create(this, start, end, isEdit) : null;\n@@ -737,1 +737,5 @@\n-        fireChangeEvent(start, end, top, lines, btm);\n+        if (isEdit) {\n+            fireChangeEvent(start, end, top, lines, btm);\n+        } else {\n+            fireStyleChangeEvent(start, end);\n+        }\n@@ -788,1 +792,1 @@\n-        UndoableChange ch = allowUndo ? UndoableChange.create(this, evStart, evEnd) : null;\n+        UndoableChange ch = allowUndo ? UndoableChange.create(this, evStart, evEnd, false) : null;\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/jfx\/incubator\/scene\/control\/richtext\/model\/StyledTextModel.java","additions":11,"deletions":7,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+import jfx.incubator.scene.control.richtext.model.ContentChange;\n@@ -766,0 +767,38 @@\n+    @Test\n+    public void undoStyleChange() {\n+        ArrayList<ContentChange> changes = new ArrayList<>();\n+        String text = \"BOLD\";\n+        TextPos p = control.appendText(text);\n+        control.getModel().addListener((ch) -> {\n+            changes.add(ch);\n+        });\n+        TextPos p2 = TextPos.ofLeading(0, 2);\n+        assertEquals(text, text());\n+        control.applyStyle(TextPos.ZERO, p, BOLD);\n+        control.select(p2);\n+        assertEquals(BOLD, control.getActiveStyleAttributeMap());\n+        control.undo();\n+        assertEquals(text, text());\n+        assertEquals(StyleAttributeMap.EMPTY, control.getActiveStyleAttributeMap());\n+        assertEquals(2, changes.size());\n+        control.redo();\n+        assertEquals(text, text());\n+        assertEquals(BOLD, control.getActiveStyleAttributeMap());\n+        \/\/ changes\n+        assertEquals(3, changes.size());\n+        ContentChange ch0 = changes.get(0);\n+        assertEquals(TextPos.ZERO, ch0.getStart());\n+        assertEquals(p, ch0.getEnd());\n+        assertFalse(ch0.isEdit());\n+        \/\/\n+        ContentChange ch1 = changes.get(1);\n+        assertFalse(ch1.isEdit());\n+        assertEquals(TextPos.ZERO, ch1.getStart());\n+        assertEquals(p, ch1.getEnd());\n+        \/\/\n+        ContentChange ch2 = changes.get(2);\n+        assertFalse(ch2.isEdit());\n+        assertEquals(TextPos.ZERO, ch2.getStart());\n+        assertEquals(p, ch2.getEnd());\n+    }\n+\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/RichTextAreaTest.java","additions":39,"deletions":0,"binary":false,"changes":39,"status":"modified"}]}