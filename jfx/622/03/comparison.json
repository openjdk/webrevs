{"files":[{"patch":"@@ -55,3 +55,0 @@\n-+ (void)enterFullScreenExitingLoop;\n-+ (void)leaveFullScreenExitingLoopIfNeeded;\n-\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassApplication.h","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -733,26 +733,0 @@\n-+ (void)enterFullScreenExitingLoop\n-{\n-    if (isFullScreenExitingLoop) {\n-        return;\n-    }\n-    isFullScreenExitingLoop = YES;\n-    GET_MAIN_JENV;\n-    (*env)->CallStaticObjectMethod(env, jApplicationClass,\n-            javaIDs.Application.enterNestedEventLoop);\n-    if ((*env)->ExceptionCheck(env) == JNI_TRUE) {\n-        (*env)->ExceptionDescribe(env);\n-        (*env)->ExceptionClear(env);\n-    }\n-    isFullScreenExitingLoop = NO;\n-}\n-\n-+ (void)leaveFullScreenExitingLoopIfNeeded\n-{\n-    if (!isFullScreenExitingLoop) {\n-        return;\n-    }\n-    GET_MAIN_JENV;\n-    (*env)->CallStaticVoidMethod(env, jApplicationClass,\n-            javaIDs.Application.leaveNestedEventLoop, (jobject)NULL);\n-}\n-\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassApplication.m","additions":0,"deletions":26,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -1234,2 +1234,0 @@\n-        \/\/ wait until the operation is complete\n-        [GlassApplication enterFullScreenExitingLoop];\n@@ -1348,2 +1346,0 @@\n-            \/\/ wait until the operation is complete\n-            [GlassApplication enterFullScreenExitingLoop];\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassViewDelegate.m","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -208,1 +208,0 @@\n-    [GlassApplication leaveFullScreenExitingLoopIfNeeded];\n@@ -224,1 +223,0 @@\n-    [GlassApplication leaveFullScreenExitingLoopIfNeeded];\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassWindow+Overrides.m","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -940,3 +940,0 @@\n-\n-            \/\/ Wait until the FS mode has really exited\n-            [GlassApplication enterFullScreenExitingLoop];\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassWindow.m","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,66 @@\n+package test.javafx.scene;\n+\n+import junit.framework.Assert;\n+import org.junit.Test;\n+import javax.swing.*;\n+import javafx.application.Platform;\n+import javafx.scene.control.Button;\n+import javafx.embed.swing.JFXPanel;\n+import javafx.scene.layout.VBox;\n+import javafx.stage.Stage;\n+import javafx.scene.Scene;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public class MacFullscreenDeadlock {\n+\n+    JFrame jframe;\n+    VBox swingVBox;\n+    CountDownLatch finishedLatch = new CountDownLatch(1);\n+\n+    @Test\n+    public void JDK_8273485() {\n+        JFrame jframe = new JFrame();\n+\n+        JFXPanel jfxpanel = new JFXPanel();\n+        Platform.runLater(() -> {\n+            swingVBox = new VBox();\n+            Scene scene = new Scene(swingVBox, 500,500);\n+            jfxpanel.setScene(scene);\n+        });\n+\n+        jframe.add(jfxpanel);\n+        jframe.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n+        jframe.setSize(300,300);\n+        jframe.show();\n+\n+        Platform.runLater(() -> {\n+            createJavaFXDialogAndClose();\n+        });\n+\n+        try {\n+            Assert.assertTrue(\"Timeout, JavaFX-Thread blocked.\", finishedLatch.await(15, TimeUnit.SECONDS));\n+        } catch (InterruptedException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    public void createJavaFXDialogAndClose() {\n+        VBox pin = new VBox();\n+        Scene scene = new Scene(pin, 200,200);\n+        Stage stage = new Stage();\n+        stage.setScene(scene);\n+        stage.show();\n+        Platform.runLater(() -> {\n+            stage.setFullScreen(true);\n+            Platform.runLater(() -> {\n+                swingVBox.getChildren().add(new Button());\n+                stage.close();\n+\n+                Platform.runLater (() -> {\n+                    finishedLatch.countDown();\n+                });\n+            });\n+        });\n+    }\n+}\n","filename":"tests\/system\/src\/test\/java\/test\/javafx\/scene\/MacFullscreenDeadlock.java","additions":66,"deletions":0,"binary":false,"changes":66,"status":"added"}]}