{"files":[{"patch":"@@ -29,0 +29,1 @@\n+import javafx.collections.MapChangeListener;\n@@ -48,2 +49,0 @@\n-    private Map<String, Object> cachedPreferences;\n-\n@@ -84,8 +83,1 @@\n-        cachedPreferences = new HashMap<>(Platform.getPreferences());\n-        textArea.setText(\"preferences = \" + formatPrefs(cachedPreferences.entrySet()));\n-\n-        Platform.getPreferences().addListener(\n-            (InvalidationListener)observable -> {\n-                Set<Map.Entry<String, Object>> changed = Platform.getPreferences().entrySet().stream()\n-                        .filter(entry -> !Objects.equals(entry.getValue(), cachedPreferences.get(entry.getKey())))\n-                        .collect(Collectors.toSet());\n+        appendText(textArea, \"preferences: \" + formatPrefs(Platform.getPreferences().entrySet()));\n@@ -93,3 +85,3 @@\n-                double scrollTop = textArea.getScrollTop();\n-                textArea.setText(textArea.getText() + \"changed = \" + formatPrefs(changed));\n-                textArea.setScrollTop(scrollTop);\n+        Platform.getPreferences().addListener((InvalidationListener)observable -> {\n+            appendText(textArea, \"\\r\\nchanged:\");\n+        });\n@@ -97,2 +89,3 @@\n-                cachedPreferences = new HashMap<>(Platform.getPreferences());\n-            });\n+        Platform.getPreferences().addListener((MapChangeListener<String, Object>)change -> {\n+            appendText(textArea, \"\\t\" + change.getKey() + \" = \" + change.getValueAdded());\n+        });\n@@ -104,0 +97,6 @@\n+    private void appendText(TextArea textArea, String text) {\n+        double scrollTop = textArea.getScrollTop();\n+        textArea.setText(textArea.getText() + text + \"\\r\\n\");\n+        textArea.setScrollTop(scrollTop);\n+    }\n+\n@@ -119,1 +118,1 @@\n-        return \"{\\r\\n\\t\" + entries + \"\\r\\n}\\r\\n\";\n+        return \"\\r\\n\\t\" + entries;\n","filename":"tests\/manual\/events\/PlatformPreferencesChangedTest.java","additions":15,"deletions":16,"binary":false,"changes":31,"status":"modified"}]}