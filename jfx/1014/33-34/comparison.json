{"files":[{"patch":"@@ -164,0 +164,13 @@\n+\/\/ assert there is no outstanding java exception pending, return otherwise\n+#define GLASS_CHECK_EXCEPTIONALLY_RETURN(ENV)                                      \\\n+do {                                                                               \\\n+    jthrowable t = (*ENV)->ExceptionOccurred(ENV);                                 \\\n+    if (t) {                                                                       \\\n+        (*ENV)->ExceptionClear(ENV);                                               \\\n+        (*ENV)->CallStaticVoidMethod(                                              \\\n+            ENV, jApplicationClass, javaIDs.Application.reportException, t);       \\\n+        (*ENV)->ExceptionClear(ENV);                                               \\\n+        return;                                                                    \\\n+    };                                                                             \\\n+} while (0)\n+\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassMacros.h","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -29,3 +29,0 @@\n-#define MACOS_10_13 @available(macOS 10.13, *)\n-#define MACOS_10_14 @available(macOS 10.14, *)\n-\n@@ -129,4 +126,2 @@\n-    if (MACOS_10_14) {\n-        [PlatformSupport putColor:preferences key:\"macOS.NSColor.unemphasizedSelectedTextColor\" value:[NSColor unemphasizedSelectedTextColor]];\n-        [PlatformSupport putColor:preferences key:\"macOS.NSColor.unemphasizedSelectedTextBackgroundColor\" value:[NSColor unemphasizedSelectedTextBackgroundColor]];\n-    }\n+    [PlatformSupport putColor:preferences key:\"macOS.NSColor.unemphasizedSelectedTextColor\" value:[NSColor unemphasizedSelectedTextColor]];\n+    [PlatformSupport putColor:preferences key:\"macOS.NSColor.unemphasizedSelectedTextBackgroundColor\" value:[NSColor unemphasizedSelectedTextBackgroundColor]];\n@@ -136,5 +131,3 @@\n-    if (MACOS_10_14) {\n-        [PlatformSupport putColor:preferences key:\"macOS.NSColor.separatorColor\" value:[NSColor separatorColor]];\n-        [PlatformSupport putColor:preferences key:\"macOS.NSColor.selectedContentBackgroundColor\" value:[NSColor selectedContentBackgroundColor]];\n-        [PlatformSupport putColor:preferences key:\"macOS.NSColor.unemphasizedSelectedContentBackgroundColor\" value:[NSColor unemphasizedSelectedContentBackgroundColor]];\n-    }\n+    [PlatformSupport putColor:preferences key:\"macOS.NSColor.separatorColor\" value:[NSColor separatorColor]];\n+    [PlatformSupport putColor:preferences key:\"macOS.NSColor.selectedContentBackgroundColor\" value:[NSColor selectedContentBackgroundColor]];\n+    [PlatformSupport putColor:preferences key:\"macOS.NSColor.unemphasizedSelectedContentBackgroundColor\" value:[NSColor unemphasizedSelectedContentBackgroundColor]];\n@@ -148,3 +141,1 @@\n-    if (MACOS_10_14) {\n-        [PlatformSupport putColors:preferences key:\"macOS.NSColor.alternatingContentBackgroundColors\" value:[NSColor alternatingContentBackgroundColors]];\n-    }\n+    [PlatformSupport putColors:preferences key:\"macOS.NSColor.alternatingContentBackgroundColors\" value:[NSColor alternatingContentBackgroundColors]];\n@@ -153,3 +144,1 @@\n-    if (MACOS_10_14) {\n-        [PlatformSupport putColor:preferences key:\"macOS.NSColor.controlAccentColor\" value:[NSColor controlAccentColor]];\n-    }\n+    [PlatformSupport putColor:preferences key:\"macOS.NSColor.controlAccentColor\" value:[NSColor controlAccentColor]];\n@@ -181,3 +170,1 @@\n-    if (MACOS_10_13) {\n-        [PlatformSupport putColor:preferences key:\"macOS.NSColor.findHighlightColor\" value:[NSColor findHighlightColor]];\n-    }\n+    [PlatformSupport putColor:preferences key:\"macOS.NSColor.findHighlightColor\" value:[NSColor findHighlightColor]];\n@@ -229,0 +216,1 @@\n+            GLASS_CHECK_EXCEPTION(env);\n@@ -232,1 +220,0 @@\n-\n@@ -241,3 +228,11 @@\n-    (*env)->CallObjectMethod(env, preferences, jMapPutMethod,\n-        (*env)->NewStringUTF(env, key),\n-        value != nil ? (*env)->NewStringUTF(env, value) : nil);\n+    jobject prefKey = (*env)->NewStringUTF(env, key);\n+    GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n+\n+    jobject prefValue = nil;\n+    if (value != nil) {\n+        prefValue = (*env)->NewStringUTF(env, value);\n+        GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n+    }\n+\n+    (*env)->CallObjectMethod(env, preferences, jMapPutMethod, prefKey, prefValue);\n+    GLASS_CHECK_EXCEPTION(env);\n@@ -249,0 +244,3 @@\n+    jobject prefKey = (*env)->NewStringUTF(env, colorName);\n+    GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n+\n@@ -250,8 +248,10 @@\n-    (*env)->CallObjectMethod(env, preferences, jMapPutMethod,\n-        (*env)->NewStringUTF(env, colorName),\n-        (*env)->CallStaticObjectMethod(\n-            env, jColorClass, jColorRgbMethod,\n-            (int)([c redComponent] * 255.0f),\n-            (int)([c greenComponent] * 255.0f),\n-            (int)([c blueComponent] * 255.0f),\n-            (double)[c alphaComponent]));\n+    jobject prefValue = (*env)->CallStaticObjectMethod(\n+        env, jColorClass, jColorRgbMethod,\n+        (int)([c redComponent] * 255.0f),\n+        (int)([c greenComponent] * 255.0f),\n+        (int)([c blueComponent] * 255.0f),\n+        (double)[c alphaComponent]);\n+    GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n+\n+    (*env)->CallObjectMethod(env, preferences, jMapPutMethod, prefKey, prefValue);\n+    GLASS_CHECK_EXCEPTION(env);\n@@ -263,0 +263,3 @@\n+    jobject prefKey = (*env)->NewStringUTF(env, colorName);\n+    GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n+\n@@ -264,1 +267,2 @@\n-    jobjectArray res = (*env)->NewObjectArray(env, count, jColorClass, nil);\n+    jobjectArray prefValue = (*env)->NewObjectArray(env, count, jColorClass, nil);\n+    GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n@@ -274,0 +278,1 @@\n+        GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n@@ -275,1 +280,2 @@\n-        (*env)->SetObjectArrayElement(env, res, i, fxcolor);\n+        (*env)->SetObjectArrayElement(env, prefValue, i, fxcolor);\n+        GLASS_CHECK_EXCEPTIONALLY_RETURN(env);\n@@ -278,1 +284,2 @@\n-    (*env)->CallObjectMethod(env, preferences, jMapPutMethod, (*env)->NewStringUTF(env, colorName), res);\n+    (*env)->CallObjectMethod(env, preferences, jMapPutMethod, prefKey, prefValue);\n+    GLASS_CHECK_EXCEPTION(env);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/PlatformSupport.m","additions":43,"deletions":36,"binary":false,"changes":79,"status":"modified"}]}