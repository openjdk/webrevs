{"files":[{"patch":"@@ -862,1 +862,0 @@\n-        private boolean cssForced = false;\n@@ -999,10 +998,7 @@\n-                        \/\/ Force the CSS to be processed for the tooltip so that it uses the\n-                        \/\/ appropriate timings for showDelay, showDuration, and hideDelay.\n-                        if (!cssForced) {\n-                            double opacity = t.getOpacity();\n-                            t.setOpacity(0);\n-                            t.show(owner);\n-                            t.hide();\n-                            t.setOpacity(opacity);\n-                            cssForced = true;\n-                        }\n+                        \/\/ We need to copy the stylesheet from the owner so that we get all the defined tooltip styles.\n+                        \/\/ Note that this is normally done when showing the tooltip,\n+                        \/\/ which is too late for some properties.\n+                        PopupWindowHelper.applyStylesheetFromOwner(t, owner);\n+                        \/\/ Force the CSS to be processed for the tooltip so that it uses the appropriate timings for\n+                        \/\/ showDelay, showDuration, and hideDelay.\n+                        t.bridge.applyCss();\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/Tooltip.java","additions":7,"deletions":11,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+\n@@ -31,0 +32,2 @@\n+import javafx.scene.input.MouseEvent;\n+import javafx.util.Duration;\n@@ -50,1 +53,0 @@\n-import static org.junit.Assert.*;\n@@ -52,0 +54,1 @@\n+import static org.junit.Assert.*;\n@@ -54,0 +57,1 @@\n+import org.junit.After;\n@@ -56,0 +60,5 @@\n+import test.com.sun.javafx.scene.control.infrastructure.MouseEventGenerator;\n+import test.com.sun.javafx.scene.control.infrastructure.StageLoader;\n+\n+import java.nio.charset.StandardCharsets;\n+import java.util.Base64;\n@@ -61,2 +70,2 @@\n-    @Before public void setup() {\n-        assertTrue(Toolkit.getToolkit() instanceof StubToolkit);  \/\/ Ensure StubToolkit is loaded\n+    private StageLoader stageLoader;\n+    private StubToolkit toolkit;\n@@ -64,0 +73,2 @@\n+    @Before\n+    public void setup() {\n@@ -66,1 +77,0 @@\n-    }\n@@ -68,0 +78,3 @@\n+        toolkit = (StubToolkit) Toolkit.getToolkit();\n+        toolkit.setAnimationTime(0);\n+    }\n@@ -69,0 +82,6 @@\n+    @After\n+    public void tearDown() {\n+        if (stageLoader != null) {\n+            stageLoader.dispose();\n+        }\n+    }\n@@ -321,1 +340,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -331,1 +350,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -334,1 +353,1 @@\n-          assertFalse(styleable.isSettable(toolTip.get_bridge()));\n+        assertFalse(styleable.isSettable(toolTip.get_bridge()));\n@@ -339,1 +358,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -352,1 +371,1 @@\n-          assertFalse(styleable.isSettable(toolTip.get_bridge()));\n+        assertFalse(styleable.isSettable(toolTip.get_bridge()));\n@@ -357,1 +376,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -369,1 +388,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -372,1 +391,1 @@\n-          assertFalse(styleable.isSettable(toolTip.get_bridge()));\n+        assertFalse(styleable.isSettable(toolTip.get_bridge()));\n@@ -374,1 +393,1 @@\n-     @Test public void whenContentDisplayIsSpecifiedViaCSSAndIsNotBound_CssMetaData_isSettable_ReturnsTrue() {\n+    @Test public void whenContentDisplayIsSpecifiedViaCSSAndIsNotBound_CssMetaData_isSettable_ReturnsTrue() {\n@@ -376,1 +395,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -386,1 +405,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -389,1 +408,1 @@\n-          assertFalse(styleable.isSettable(toolTip.get_bridge()));\n+        assertFalse(styleable.isSettable(toolTip.get_bridge()));\n@@ -394,1 +413,1 @@\n-          assertTrue(styleable.isSettable(toolTip.get_bridge()));\n+        assertTrue(styleable.isSettable(toolTip.get_bridge()));\n@@ -534,0 +553,156 @@\n+    \/**\n+     * A {@link Tooltip} once was showing and quickly hiding itself in order to process the CSS.\n+     * This was changed in <a href=\"https:\/\/bugs.openjdk.org\/browse\/JDK-8296387\">JDK-8296387<\/a>\n+     * and this test ensure that this is the case.\n+     *\/\n+    @Test\n+    public void testTooltipShouldNotBeShownBeforeDelayIsUp() {\n+        toolTip.showingProperty().addListener(inv -> fail());\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        MouseEvent mouseEvent = MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_MOVED, 1, 1);\n+        rect.fireEvent(mouseEvent);\n+    }\n+\n+    @Test\n+    public void testTooltipShouldNotBeShownBeforeDefaultDelay() {\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        MouseEvent mouseEvent = MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_MOVED, 1, 1);\n+        rect.fireEvent(mouseEvent);\n+\n+        assertFalse(toolTip.isShowing());\n+\n+        toolkit.setAnimationTime(999);\n+\n+        assertFalse(toolTip.isShowing());\n+    }\n+\n+    @Test\n+    public void testTooltipShouldBeShownAfterDefaultDelay() {\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        assertFalse(toolTip.isShowing());\n+\n+        assertTooltipShownAfter(rect, 1000);\n+        assertTooltipHiddenAfter(rect, 200);\n+    }\n+\n+    @Test\n+    public void testTooltipShouldBeHiddenAfterHideDelay() {\n+        int delay = 50;\n+        toolTip.setHideDelay(Duration.millis(delay));\n+\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        assertFalse(toolTip.isShowing());\n+\n+        assertTooltipShownAfter(rect, 1000);\n+        assertTooltipHiddenAfter(rect, delay);\n+    }\n+\n+    @Test\n+    public void testTooltipShouldBeShownAfterSetShowDelay() {\n+        int delay = 200;\n+        toolTip.setShowDelay(Duration.millis(delay));\n+\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        assertFalse(toolTip.isShowing());\n+\n+        assertTooltipShownAfter(rect, delay);\n+        assertTooltipHiddenAfter(rect, 200);\n+    }\n+\n+    @Test\n+    public void testTooltipShouldBeShownAfterSetStyleShowDelay() {\n+        toolTip.setStyle(\"-fx-show-delay: 200ms;\");\n+\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        assertFalse(toolTip.isShowing());\n+\n+        assertTooltipShownAfter(rect, 200);\n+        assertTooltipHiddenAfter(rect, 200);\n+    }\n+\n+    @Test\n+    public void testTooltipShouldBeShownAfterSetCssShowDelay() {\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+        stageLoader.getStage().getScene().getStylesheets().setAll(toBase64(\".tooltip { -fx-show-delay: 200ms; }\"));\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        assertFalse(toolTip.isShowing());\n+\n+        assertTooltipShownAfter(rect, 200);\n+        assertTooltipHiddenAfter(rect, 200);\n+    }\n+\n+    @Test\n+    public void testTooltipChangeShowDelayCss() {\n+        Rectangle rect = new Rectangle(0, 0, 100, 100);\n+\n+        stageLoader = new StageLoader(rect);\n+        stageLoader.getStage().getScene().getStylesheets().setAll(toBase64(\".tooltip { -fx-show-delay: 200ms; }\"));\n+\n+        Tooltip.install(rect, toolTip);\n+\n+        assertFalse(toolTip.isShowing());\n+\n+        assertTooltipShownAfter(rect, 200);\n+        assertTooltipHiddenAfter(rect, 200);\n+\n+        stageLoader.getStage().getScene().getStylesheets().setAll(toBase64(\".tooltip { -fx-show-delay: 450ms; }\"));\n+\n+        assertTooltipShownAfter(rect, 450);\n+        assertTooltipHiddenAfter(rect, 200);\n+    }\n+\n+    private void assertTooltipShownAfter(Rectangle rect, int millis) {\n+        MouseEvent mouseEvent = MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_MOVED, 1, 1);\n+        rect.fireEvent(mouseEvent);\n+\n+        toolkit.setAnimationTime(toolkit.getCurrentTime() + millis);\n+\n+        assertTrue(toolTip.isShowing());\n+    }\n+\n+    private void assertTooltipHiddenAfter(Rectangle rect, int millis) {\n+        MouseEvent mouseEvent = MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_EXITED, -1, -1);\n+        rect.fireEvent(mouseEvent);\n+\n+        toolkit.setAnimationTime(toolkit.getCurrentTime() + millis);\n+\n+        assertFalse(toolTip.isShowing());\n+    }\n+\n+    private String toBase64(String css) {\n+        return \"data:base64,\" + Base64.getUrlEncoder().encodeToString(css.getBytes(StandardCharsets.UTF_8));\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TooltipTest.java","additions":193,"deletions":18,"binary":false,"changes":211,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,4 @@\n+    public static void applyStylesheetFromOwner(PopupWindow popupWindow, Window owner) {\n+        popupWindowAccessor.applyStylesheetFromOwner(popupWindow, owner);\n+    }\n+\n@@ -82,0 +86,1 @@\n+        void applyStylesheetFromOwner(PopupWindow popupWindow, Window owner);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/stage\/PopupWindowHelper.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -119,0 +119,5 @@\n+\n+            @Override\n+            public void applyStylesheetFromOwner(PopupWindow popupWindow, Window owner) {\n+                popupWindow.applyStylesheetFromOwner(owner);\n+            }\n@@ -460,1 +465,3 @@\n-        \/\/ RT-28447\n+        \/\/ JDK-8116444\n+        applyStylesheetFromOwner(owner);\n+\n@@ -463,4 +470,0 @@\n-            if (ownerScene.getUserAgentStylesheet() != null) {\n-                sceneValue.setUserAgentStylesheet(ownerScene.getUserAgentStylesheet());\n-            }\n-            sceneValue.getStylesheets().setAll(ownerScene.getStylesheets());\n@@ -482,0 +485,17 @@\n+    \/**\n+     * Applies the stylesheet from the scene of the root owner {@link Window} to the {@link Scene}\n+     * associated with that window.\n+     *\n+     * @param owner the owner {@link Window}\n+     *\/\n+    void applyStylesheetFromOwner(Window owner) {\n+        Scene scene = getScene();\n+        final Scene ownerScene = getRootWindow(owner).getScene();\n+        if (ownerScene != null) {\n+            if (ownerScene.getUserAgentStylesheet() != null) {\n+                scene.setUserAgentStylesheet(ownerScene.getUserAgentStylesheet());\n+            }\n+            scene.getStylesheets().setAll(ownerScene.getStylesheets());\n+        }\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/stage\/PopupWindow.java","additions":26,"deletions":6,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,0 +56,4 @@\n+    public long getCurrentTime() {\n+        return currentTimeMillis;\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/com\/sun\/javafx\/pgstub\/StubPrimaryTimer.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -671,0 +671,5 @@\n+    \/**\n+     * Sets the current time of the {@link StubPrimaryTimer}.\n+     *\n+     * @param millis the time in milliseconds\n+     *\/\n@@ -675,0 +680,9 @@\n+    \/**\n+     * Returns the current time of the {@link StubPrimaryTimer}.\n+     *\n+     * @return the time in milliseconds\n+     *\/\n+    public long getCurrentTime() {\n+        return primaryTimer.getCurrentTime();\n+    }\n+\n@@ -689,0 +703,6 @@\n+    \/**\n+     * Sets the current time of the {@link StubPrimaryTimer} and handles all pending animations.\n+     * Useful for unit-testing things that involves animations (e.g. Timeline).\n+     *\n+     * @param millis the time in milliseconds\n+     *\/\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/com\/sun\/javafx\/pgstub\/StubToolkit.java","additions":21,"deletions":1,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -0,0 +1,293 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package test.robot.javafx.scene;\n+\n+import javafx.application.Application;\n+import javafx.application.Platform;\n+import javafx.scene.Scene;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.input.MouseButton;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.robot.Robot;\n+import javafx.stage.Stage;\n+import javafx.stage.StageStyle;\n+import javafx.stage.Window;\n+import javafx.util.Duration;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import test.util.Util;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+class TooltipTest {\n+\n+    private static final int DELTA = 100;\n+\n+    static CountDownLatch startupLatch = new CountDownLatch(1);\n+    static CountDownLatch tooltipShownLatch;\n+    static volatile long tooltipStartTime;\n+    static volatile long tooltipShownTime;\n+    static Robot robot;\n+    static Button button;\n+    static Tooltip tooltip;\n+\n+    static volatile Stage stage;\n+    static volatile Scene scene;\n+\n+    private static void assertTooltipShowDelay(long tooltipShowTime, long expectedTime) {\n+        \/\/ To avoid any small timing error we rather check if the value is between.\n+        long maximumTime = expectedTime + DELTA;\n+\n+        assertTrue(tooltipShowTime >= expectedTime, tooltipShowTime + \" >= \" + expectedTime);\n+        assertTrue(tooltipShowTime <= maximumTime, tooltipShowTime + \" <= \" + maximumTime);\n+    }\n+\n+    @BeforeAll\n+    static void initFX() {\n+        Util.launch(startupLatch, TestApp.class);\n+    }\n+\n+    @AfterAll\n+    static void exit() {\n+        Util.shutdown();\n+    }\n+\n+    @Test\n+    void testDefaultTooltip() {\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+        assertTooltipShowDelay(tooltipShowTime, 1000);\n+    }\n+\n+    @Test\n+    void testCssStylesheetTooltip() {\n+        scene.getStylesheets().add(getClass().getResource(\"tooltip.css\").toExternalForm());\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+\n+        assertTooltipShowDelay(tooltipShowTime, 30);\n+    }\n+\n+    @Test\n+    void testCssStylesheetChangeTooltip() {\n+        scene.getStylesheets().add(getClass().getResource(\"tooltip.css\").toExternalForm());\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+\n+        assertTooltipShowDelay(tooltipShowTime, 30);\n+\n+        scene.getStylesheets().setAll(getClass().getResource(\"tooltip2.css\").toExternalForm());\n+        reset();\n+        tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+\n+        assertTooltipShowDelay(tooltipShowTime, 200);\n+    }\n+\n+    @Test\n+    void testSmallShowDelayTooltip() {\n+        tooltip.setShowDelay(Duration.millis(100));\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+        assertTooltipShowDelay(tooltipShowTime, 100);\n+    }\n+\n+    @Test\n+    void testSmallShowDelayCssTooltip() {\n+        tooltip.setStyle(\"-fx-show-delay: 100ms;\");\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+        assertTooltipShowDelay(tooltipShowTime, 100);\n+    }\n+\n+    @Test\n+    void testChangeShowDelayTooltip() {\n+        tooltip.setShowDelay(Duration.millis(100));\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+        assertTooltipShowDelay(tooltipShowTime, 100);\n+\n+        \/\/ Try again with a bigger show delay.\n+        tooltip.setShowDelay(Duration.millis(2000));\n+        reset();\n+        tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+        assertTooltipShowDelay(tooltipShowTime, 2000);\n+    }\n+\n+    @Test\n+    void testChangeShowDelayCssTooltip() throws Throwable {\n+        tooltip.setStyle(\"-fx-show-delay: 100ms;\");\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+        assertTooltipShowDelay(tooltipShowTime, 100);\n+\n+        \/\/ Try again with a bigger show delay.\n+        tooltip.setStyle(\"-fx-show-delay: 2000ms;\");\n+        reset();\n+        tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+        assertTooltipShowDelay(tooltipShowTime, 2000);\n+    }\n+\n+    @Test\n+    void testShowDelayCssShowTooltipTwice() {\n+        tooltip.setStyle(\"-fx-show-delay: 100ms;\");\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        long tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+\n+        assertTooltipShowDelay(tooltipShowTime, 100);\n+\n+        \/\/ Try again.\n+        reset();\n+        tooltipShowTime = waitForTooltip();\n+\n+        assertTrue(tooltip.isShowing());\n+\n+        assertTooltipShowDelay(tooltipShowTime, 100);\n+    }\n+\n+    private void reset() {\n+        tooltipShownLatch = new CountDownLatch(1);\n+        tooltipStartTime = 0;\n+        tooltipShownTime = 0;\n+    }\n+\n+    private long waitForTooltip() {\n+        Util.runAndWait(() -> {\n+            \/\/ Click somewhere in the Stage to ensure that it is active\n+            Window window = scene.getWindow();\n+            robot.mouseMove(window.getX() + scene.getX(), window.getY() + scene.getY());\n+            robot.mouseClick(MouseButton.PRIMARY);\n+        });\n+\n+        \/\/ Make sure that a previous tooltip is hidden by now.\n+        Util.sleep(500);\n+\n+        assertFalse(tooltip.isShowing());\n+\n+        Util.runAndWait(() -> {\n+            Window window = scene.getWindow();\n+            robot.mouseMove(\n+                    window.getX() + scene.getX() + button.getLayoutX() + button.getLayoutBounds().getWidth() \/ 2,\n+                    window.getY() + scene.getY() + button.getLayoutY() + button.getLayoutBounds().getHeight() \/ 2);\n+            tooltipStartTime = System.currentTimeMillis();\n+        });\n+\n+        Util.waitForLatch(tooltipShownLatch, 5, \"Timeout waiting for tooltip to display\");\n+\n+        long finalTime = tooltipShownTime - tooltipStartTime;\n+\n+        Util.sleep(250);\n+\n+        return finalTime;\n+    }\n+\n+    @AfterEach\n+    void resetUI() {\n+        Util.runAndWait(() -> {\n+            button.setTooltip(null);\n+            tooltip = null;\n+\n+            scene.getStylesheets().clear();\n+        });\n+    }\n+\n+    @BeforeEach\n+    void setupUI() {\n+        Util.runAndWait(() -> {\n+            tooltipShownLatch = new CountDownLatch(1);\n+\n+            tooltip = new Tooltip(\"tooltip\");\n+            tooltip.showingProperty().addListener((obs, oldV, isShowing) -> {\n+                if (isShowing) {\n+                    tooltipShownTime = System.currentTimeMillis();\n+                    tooltipShownLatch.countDown();\n+                }\n+            });\n+            button.setTooltip(tooltip);\n+        });\n+    }\n+\n+    public static class TestApp extends Application {\n+\n+        @Override\n+        public void start(Stage primaryStage) {\n+            robot = new Robot();\n+            stage = primaryStage;\n+\n+            button = new Button(\"Button\");\n+\n+            scene = new Scene(new StackPane(button), 250, 250);\n+            stage.setScene(scene);\n+            stage.initStyle(StageStyle.UNDECORATED);\n+            stage.setAlwaysOnTop(true);\n+            stage.setOnShown(event -> Platform.runLater(startupLatch::countDown));\n+            stage.show();\n+        }\n+    }\n+}\n","filename":"tests\/system\/src\/test\/java\/test\/robot\/javafx\/scene\/TooltipTest.java","additions":293,"deletions":0,"binary":false,"changes":293,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,3 +26,2 @@\n-package myapp4.pkg3;\n-\n-public class RefClass {\n+.tooltip {\n+    -fx-show-delay: 30ms;\n","filename":"tests\/system\/src\/test\/resources\/test\/robot\/javafx\/scene\/tooltip.css","additions":3,"deletions":4,"binary":false,"changes":7,"previous_filename":"tests\/system\/src\/testapp4\/java\/mymod\/myapp4\/pkg3\/RefClass.java","status":"copied"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,3 +26,2 @@\n-package myapp4.pkg3;\n-\n-public class RefClass {\n+.tooltip {\n+    -fx-show-delay: 200ms;\n","filename":"tests\/system\/src\/test\/resources\/test\/robot\/javafx\/scene\/tooltip2.css","additions":3,"deletions":4,"binary":false,"changes":7,"previous_filename":"tests\/system\/src\/testapp4\/java\/mymod\/myapp4\/pkg3\/RefClass.java","status":"copied"}]}