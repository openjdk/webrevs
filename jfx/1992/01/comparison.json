{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -327,0 +327,16 @@\n+    \/*\n+     * Both parallel and perspective projections introduce denominators derived from the view dimensions.\n+     * If a view dimension is zero, these divisions can produce NaN or Infinity. For example, the parallel\n+     * projection computes terms proportional to 1\/viewWidth and 1\/viewHeight, and the perspective projection\n+     * depends on the aspect ratio viewWidth\/viewHeight. Once a transform contains NaN or Infinity, downstream\n+     * coordinate conversion APIs that rely on these transforms (such as Node.localToScreen()) can return\n+     * unusable results.\n+     *\n+     * The intent here is not to define semantics for a mathematically degenerate 0x0 view, but to prevent the\n+     * transform pipeline from being poisoned by NaN or Infinity. For this purpose, we clamp the view width\n+     * and height to ulp(1), guaranteeing non-zero view dimensions while keeping the clamp very small.\n+     *\/\n+    private static double safeSize(double size) {\n+        return Math.max(Math.ulp(1.0), size);\n+    }\n+\n@@ -328,1 +344,1 @@\n-        this.viewWidth = width;\n+        this.viewWidth = safeSize(width);\n@@ -337,1 +353,1 @@\n-        this.viewHeight = height;\n+        this.viewHeight = safeSize(height);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/Camera.java","additions":19,"deletions":3,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,0 +79,4 @@\n+    public TestScene(final Parent root, final double width, final double height) {\n+        this(\"SCENE\", root, width, height);\n+    }\n+\n@@ -80,1 +84,5 @@\n-        super(root);\n+        this(name, root, -1, -1);\n+    }\n+\n+    public TestScene(final String name, final Parent root, final double width, final double height) {\n+        super(root, width, height);\n@@ -82,0 +90,1 @@\n+\n@@ -83,1 +92,3 @@\n-        SceneHelper.preferredSize(this);\n+        if (width < 0 || height < 0) {\n+            SceneHelper.preferredSize(this);\n+        }\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/com\/sun\/javafx\/test\/objects\/TestScene.java","additions":14,"deletions":3,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,0 +85,2 @@\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.CsvSource;\n@@ -1352,2 +1354,8 @@\n-    @Test\n-    public void testLocalToScreen() {\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+        -1, -1\n+        0, 0\n+        1, 1\n+        100, 100\n+    \"\"\")\n+    public void testLocalToScreen(double sceneWidth, double sceneHeight) {\n@@ -1359,1 +1367,1 @@\n-        TestScene scene = new TestScene(new Group(rect));\n+        TestScene scene = new TestScene(new Group(rect), sceneWidth, sceneHeight);\n@@ -1374,2 +1382,11 @@\n-    @Test\n-    public void testLocalToScreen3D() {\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+         -1,   -1,  111.420,  223.140,  110.661,  221.080,  1.879,   4.300\n+          0,    0,  100.000,  200.000,  100.000,  200.000,  0.000,   0.000\n+          1,    1,   94.248,  187.699,   93.653,  186.508,  9.973,  20.379\n+        100,  100,  109.926,  221.229,  109.926,  221.229,  3.065,   3.449\n+    \"\"\")\n+    public void testLocalToScreen3D(double sceneWidth, double sceneHeight,\n+                                    double x, double y,\n+                                    double minX, double minY,\n+                                    double width, double height) {\n@@ -1377,1 +1394,0 @@\n-\n@@ -1381,1 +1397,1 @@\n-        TestScene scene = new TestScene(new Group(box));\n+        TestScene scene = new TestScene(new Group(box), sceneWidth, sceneHeight);\n@@ -1389,9 +1405,2 @@\n-        assertEquals(111.42, p.getX(), 0.1);\n-        assertEquals(223.14, p.getY(), 0.1);\n-        Bounds b = box.localToScreen(new BoundingBox(1, 2, -5, 1, 2, 10));\n-        assertEquals(110.66, b.getMinX(), 0.1);\n-        assertEquals(221.08, b.getMinY(), 0.1);\n-        assertEquals(1.88, b.getWidth(), 0.1);\n-        assertEquals(4.3, b.getHeight(), 0.1);\n-        assertEquals(0.0, b.getDepth(), 0.0001);\n-    }\n+        assertEquals(x, p.getX(), 0.0005);\n+        assertEquals(y, p.getY(), 0.0005);\n@@ -1399,2 +1408,16 @@\n-    @Test\n-    public void testScreenToLocal() {\n+        Bounds b = box.localToScreen(new BoundingBox(1, 2, -5, 1, 2, 10));\n+        assertEquals(minX, b.getMinX(), 0.0005);\n+        assertEquals(minY, b.getMinY(), 0.0005);\n+        assertEquals(width, b.getWidth(), 0.0005);\n+        assertEquals(height, b.getHeight(), 0.0005);\n+        assertEquals(0, b.getDepth(), 0.00005);\n+    }\n+\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+        -1, -1\n+        0, 0\n+        1, 1\n+        100, 100\n+    \"\"\")\n+    public void testScreenToLocal(double sceneWidth, double sceneHeight) {\n@@ -1402,1 +1425,0 @@\n-\n@@ -1406,1 +1428,1 @@\n-        TestScene scene = new TestScene(new Group(rect));\n+        TestScene scene = new TestScene(new Group(rect), sceneWidth, sceneHeight);\n@@ -1416,2 +1438,8 @@\n-    @Test\n-    public void testLocalToScreenWithTranslatedCamera() {\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+        -1, -1\n+        0, 0\n+        1, 1\n+        100, 100\n+    \"\"\")\n+    public void testLocalToScreenWithTranslatedCamera(double sceneWidth, double sceneHeight) {\n@@ -1419,1 +1447,0 @@\n-\n@@ -1424,1 +1451,1 @@\n-        TestScene scene = new TestScene(new Group(rect, cam));\n+        TestScene scene = new TestScene(new Group(rect, cam), sceneWidth, sceneHeight);\n@@ -1443,2 +1470,8 @@\n-    @Test\n-    public void testScreenToLocalWithTranslatedCamera() {\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+        -1, -1\n+        0, 0\n+        1, 1\n+        100, 100\n+    \"\"\")\n+    public void testScreenToLocalWithTranslatedCamera(double sceneWidth, double sceneHeight) {\n@@ -1451,1 +1484,1 @@\n-        TestScene scene = new TestScene(new Group(rect, cam));\n+        TestScene scene = new TestScene(new Group(rect, cam), sceneWidth, sceneHeight);\n@@ -1464,2 +1497,7 @@\n-    @Test\n-    public void testLocalToScreenInsideSubScene() {\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+        0, 0\n+        1, 1\n+        100, 100\n+    \"\"\")\n+    public void testLocalToScreenInsideSubScene(double subSceneWidth, double subSceneHeight) {\n@@ -1469,1 +1507,2 @@\n-        SubScene subScene = new SubScene(new Group(rect), 100, 100);\n+\n+        SubScene subScene = new SubScene(new Group(rect), subSceneWidth, subSceneHeight);\n@@ -1489,2 +1528,7 @@\n-    @Test\n-    public void testScreenToLocalInsideSubScene() {\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+        0, 0\n+        1, 1\n+        100, 100\n+    \"\"\")\n+    public void testScreenToLocalInsideSubScene(double subSceneWidth, double subSceneHeight) {\n@@ -1494,1 +1538,2 @@\n-        SubScene subScene = new SubScene(new Group(rect), 100, 100);\n+\n+        SubScene subScene = new SubScene(new Group(rect), subSceneWidth, subSceneHeight);\n@@ -1508,2 +1553,10 @@\n-    @Test\n-    public void test2DLocalToScreenOn3DRotatedSubScene() {\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+          0,    0,  111.445,  226.429,  111.445,  226.429,  4.670,  9.007\n+          1,    1,  111.122,  225.433,  111.122,  225.433,  4.179,  8.003\n+        100,  100,  124.365,  225.996,  124.365,  225.755,  1.851,  3.757\n+    \"\"\")\n+    public void test2DLocalToScreenOn3DRotatedSubScene(double subSceneWidth, double subSceneHeight,\n+                                                       double x, double y,\n+                                                       double minX, double minY,\n+                                                       double width, double height) {\n@@ -1513,1 +1566,2 @@\n-        SubScene subScene = new SubScene(new Group(rect), 100, 100);\n+\n+        SubScene subScene = new SubScene(new Group(rect), subSceneWidth, subSceneHeight);\n@@ -1527,8 +1581,2 @@\n-        assertEquals(124.36, p.getX(), 0.1);\n-        assertEquals(226.0, p.getY(), 0.1);\n-        Bounds b = rect.localToScreen(new BoundingBox(1, 2, 3, 4));\n-        assertEquals(124.36, b.getMinX(), 0.1);\n-        assertEquals(225.75, b.getMinY(), 0.1);\n-        assertEquals(1.85, b.getWidth(), 0.1);\n-        assertEquals(3.76, b.getHeight(), 0.1);\n-    }\n+        assertEquals(x, p.getX(), 0.0005);\n+        assertEquals(y, p.getY(), 0.0005);\n@@ -1536,2 +1584,17 @@\n-    @Test\n-    public void test2DScreenToLocalTo3DRotatedSubScene() {\n+        Bounds b = rect.localToScreen(new BoundingBox(1, 2, 3, 4));\n+        assertEquals(minX, b.getMinX(), 0.0005);\n+        assertEquals(minY, b.getMinY(), 0.0005);\n+        assertEquals(width, b.getWidth(), 0.0005);\n+        assertEquals(height, b.getHeight(), 0.0005);\n+    }\n+\n+    @ParameterizedTest\n+    @CsvSource(textBlock = \"\"\"\n+          0,    0,  7.745,  -3.219,  7.745,  -3.828,  0.656,  2.578\n+          1,    1,  8.627,  -2.427,  8.627,  -3.036,  0.729,  2.677\n+        100,  100,  0.992,   2.003,  0.992,   1.719,  2.998,  4.518\n+    \"\"\")\n+    public void test2DScreenToLocalTo3DRotatedSubScene(double subSceneWidth, double subSceneHeight,\n+                                                       double x, double y,\n+                                                       double minX, double minY,\n+                                                       double width, double height) {\n@@ -1541,1 +1604,2 @@\n-        SubScene subScene = new SubScene(new Group(rect), 100, 100);\n+\n+        SubScene subScene = new SubScene(new Group(rect), subSceneWidth, subSceneHeight);\n@@ -1555,2 +1619,3 @@\n-        assertEquals(1, p.getX(), 0.1);\n-        assertEquals(2, p.getY(), 0.1);\n+        assertEquals(x, p.getX(), 0.0005);\n+        assertEquals(y, p.getY(), 0.0005);\n+\n@@ -1558,4 +1623,4 @@\n-        assertEquals(1, b.getMinX(), 0.1);\n-        assertEquals(1.72, b.getMinY(), 0.1);\n-        assertEquals(3, b.getWidth(), 0.1);\n-        assertEquals(4.52, b.getHeight(), 0.1);\n+        assertEquals(minX, b.getMinX(), 0.0005);\n+        assertEquals(minY, b.getMinY(), 0.0005);\n+        assertEquals(width, b.getWidth(), 0.0005);\n+        assertEquals(height, b.getHeight(), 0.0005);\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/javafx\/scene\/NodeTest.java","additions":119,"deletions":54,"binary":false,"changes":173,"status":"modified"}]}