{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,6 @@\n-import java.util.*;\n-\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n@@ -35,1 +39,0 @@\n-import javafx.application.Platform;\n@@ -43,0 +46,5 @@\n+import javafx.css.CssMetaData;\n+import javafx.css.Styleable;\n+import javafx.css.StyleableBooleanProperty;\n+import javafx.css.StyleableProperty;\n+import javafx.css.converter.BooleanConverter;\n@@ -46,0 +54,1 @@\n+import javafx.scene.chart.LineChart.SortingPolicy;\n@@ -54,1 +63,0 @@\n-\n@@ -56,6 +64,0 @@\n-import javafx.css.converter.BooleanConverter;\n-import javafx.css.CssMetaData;\n-import javafx.css.Styleable;\n-import javafx.css.StyleableBooleanProperty;\n-import javafx.css.StyleableProperty;\n-import javafx.scene.chart.LineChart.SortingPolicy;\n@@ -544,1 +546,1 @@\n-            symbol.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n+            symbol.setFocusTraversable(isAccessibilityActive());\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/AreaChart.java","additions":14,"deletions":12,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,3 +28,7 @@\n-import java.util.*;\n-\n-import javafx.scene.AccessibleRole;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n@@ -38,1 +42,0 @@\n-import javafx.application.Platform;\n@@ -42,0 +45,1 @@\n+import javafx.collections.ListChangeListener;\n@@ -43,0 +47,6 @@\n+import javafx.css.CssMetaData;\n+import javafx.css.PseudoClass;\n+import javafx.css.Styleable;\n+import javafx.css.StyleableDoubleProperty;\n+import javafx.css.StyleableProperty;\n+import javafx.css.converter.SizeConverter;\n@@ -44,0 +54,1 @@\n+import javafx.scene.AccessibleRole;\n@@ -47,1 +58,0 @@\n-\n@@ -50,10 +60,0 @@\n-import javafx.css.StyleableDoubleProperty;\n-import javafx.css.CssMetaData;\n-import javafx.css.PseudoClass;\n-\n-import javafx.css.converter.SizeConverter;\n-import javafx.collections.ListChangeListener;\n-\n-import javafx.css.Styleable;\n-import javafx.css.StyleableProperty;\n-\n@@ -562,1 +562,1 @@\n-            bar.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n+            bar.setFocusTraversable(isAccessibilityActive());\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/BarChart.java","additions":17,"deletions":17,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,0 @@\n-\n@@ -34,1 +33,0 @@\n-import javafx.application.Platform;\n@@ -44,1 +42,0 @@\n-\n@@ -273,1 +270,1 @@\n-            bubble.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n+            bubble.setFocusTraversable(isAccessibilityActive());\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/BubbleChart.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,3 +31,0 @@\n-\n-import com.sun.javafx.scene.control.skin.Utils;\n-\n@@ -43,0 +40,2 @@\n+import javafx.beans.value.ChangeListener;\n+import javafx.beans.value.ObservableValue;\n@@ -45,0 +44,7 @@\n+import javafx.css.CssMetaData;\n+import javafx.css.Styleable;\n+import javafx.css.StyleableBooleanProperty;\n+import javafx.css.StyleableObjectProperty;\n+import javafx.css.StyleableProperty;\n+import javafx.css.converter.BooleanConverter;\n+import javafx.css.converter.EnumConverter;\n@@ -48,0 +54,1 @@\n+import javafx.scene.Scene;\n@@ -51,1 +58,2 @@\n-\n+import javafx.stage.Window;\n+import javafx.util.Subscription;\n@@ -55,10 +63,1 @@\n-\n-import javafx.css.StyleableBooleanProperty;\n-import javafx.css.StyleableObjectProperty;\n-import javafx.css.CssMetaData;\n-\n-import javafx.css.converter.BooleanConverter;\n-import javafx.css.converter.EnumConverter;\n-\n-import javafx.css.Styleable;\n-import javafx.css.StyleableProperty;\n+import com.sun.javafx.scene.control.skin.Utils;\n@@ -107,0 +106,3 @@\n+    \/\/ SimpleBooleanProperty or Subscription\n+    private volatile Object accessibilityActive;\n+\n@@ -277,1 +279,0 @@\n-        titleLabel.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n@@ -514,1 +515,4 @@\n-}\n+    private void handleAccessibilityActive(boolean on) {\n+        titleLabel.setFocusTraversable(on);\n+        updateSymbolFocusable(on);\n+    }\n@@ -516,0 +520,9 @@\n+    \/**\n+     * Invoked in the FX application thread when accessibility active platform property changes.\n+     * The child classes should override this method to set focus traversable flag on every symbol, as well as\n+     * other elements that need to be focusable.\n+     * @param on whether the accessibility is active\n+     *\/\n+    \/\/ package protected: custom charts must handle accessbility on their own\n+    void updateSymbolFocusable(boolean on) {\n+    }\n@@ -517,0 +530,44 @@\n+    \/**\n+     * When called from JavaFX application thread, returns the value of the property.\n+     * When called from any other thread, returns false and sets up the machinery to\n+     * invoke {@code updateSymbolFocusable()} when needed.\n+     * The chart implementations should use this method to set focus travesable flags on the nodes\n+     * which needs to be focus traversable when accessibility is on.\n+     * @return\n+     *\/\n+    \/\/ package protected: custom charts must handle accessbility on their own\n+    final boolean isAccessibilityActive() {\n+        if (Platform.isFxApplicationThread()) {\n+            if (accessibilityActive instanceof SimpleBooleanProperty p) {\n+                return p.get();\n+            } else {\n+                if (accessibilityActive instanceof Subscription sub) {\n+                    sub.unsubscribe();\n+                }\n+                SimpleBooleanProperty active = new SimpleBooleanProperty();\n+                accessibilityActive = active;\n+                active.addListener((src, prev, on) -> {\n+                    handleAccessibilityActive(on);\n+                });\n+                active.bind(Platform.accessibilityActiveProperty());\n+                return active.get();\n+            }\n+        } else {\n+            \/\/ chart and its data are allowed to be constructed in a background thread\n+            if (accessibilityActive == null) {\n+                \/\/ set up a subscription to be fired once the chart becomes a part of the scene graph\n+                accessibilityActive = sceneProperty()\n+                    .flatMap(Scene::windowProperty)\n+                    .subscribe((w) -> {\n+                        if (w != null) {\n+                            \/\/ will unsubscribe when appears in a window, in the fx app thread\n+                            if (isAccessibilityActive()) {\n+                                handleAccessibilityActive(true);\n+                            }\n+                        }\n+                    });\n+            }\n+            return false;\n+        }\n+    }\n+}\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/Chart.java","additions":74,"deletions":17,"binary":false,"changes":91,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import java.util.Collections;\n@@ -32,1 +33,1 @@\n-\n+import javafx.animation.Animation;\n@@ -38,2 +39,0 @@\n-import javafx.animation.Animation;\n-import javafx.application.Platform;\n@@ -49,0 +48,5 @@\n+import javafx.css.CssMetaData;\n+import javafx.css.Styleable;\n+import javafx.css.StyleableBooleanProperty;\n+import javafx.css.StyleableProperty;\n+import javafx.css.converter.BooleanConverter;\n@@ -56,1 +60,0 @@\n-\n@@ -59,10 +62,0 @@\n-import javafx.css.StyleableBooleanProperty;\n-import javafx.css.CssMetaData;\n-\n-import javafx.css.converter.BooleanConverter;\n-\n-import java.util.*;\n-\n-import javafx.css.Styleable;\n-import javafx.css.StyleableProperty;\n-\n@@ -533,1 +526,1 @@\n-            symbol.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n+            symbol.setFocusTraversable(isAccessibilityActive());\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/LineChart.java","additions":9,"deletions":16,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,2 +34,0 @@\n-\n-import com.sun.javafx.scene.control.skin.resources.ControlResources;\n@@ -42,1 +40,0 @@\n-import javafx.application.Platform;\n@@ -57,0 +54,7 @@\n+import javafx.css.CssMetaData;\n+import javafx.css.Styleable;\n+import javafx.css.StyleableBooleanProperty;\n+import javafx.css.StyleableDoubleProperty;\n+import javafx.css.StyleableProperty;\n+import javafx.css.converter.BooleanConverter;\n+import javafx.css.converter.SizeConverter;\n@@ -74,1 +78,0 @@\n-\n@@ -78,10 +81,1 @@\n-\n-import javafx.css.StyleableBooleanProperty;\n-import javafx.css.StyleableDoubleProperty;\n-import javafx.css.CssMetaData;\n-\n-import javafx.css.converter.BooleanConverter;\n-import javafx.css.converter.SizeConverter;\n-\n-import javafx.css.Styleable;\n-import javafx.css.StyleableProperty;\n+import com.sun.javafx.scene.control.skin.resources.ControlResources;\n@@ -419,0 +413,1 @@\n+        item.textNode.setFocusTraversable(isAccessibilityActive());\n@@ -1002,1 +997,1 @@\n-        public Data(java.lang.String name, double value) {\n+        public Data(String name, double value) {\n@@ -1008,1 +1003,0 @@\n-            textNode.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n@@ -1131,0 +1125,6 @@\n+    @Override\n+    void updateSymbolFocusable(boolean on) {\n+        for (Data d : getData()) {\n+            d.textNode.setFocusTraversable(on);\n+        }\n+    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/PieChart.java","additions":17,"deletions":17,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.util.Iterator;\n@@ -30,1 +31,0 @@\n-import javafx.application.Platform;\n@@ -38,1 +38,0 @@\n-\n@@ -41,2 +40,0 @@\n-import java.util.Iterator;\n-\n@@ -88,1 +85,1 @@\n-            symbol.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n+            symbol.setFocusTraversable(isAccessibilityActive());\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/ScatterChart.java","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,5 +28,14 @@\n-\n-import java.util.*;\n-\n-import javafx.animation.*;\n-import javafx.application.Platform;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.NavigableMap;\n+import java.util.TreeMap;\n+import javafx.animation.FadeTransition;\n+import javafx.animation.Interpolator;\n+import javafx.animation.KeyFrame;\n+import javafx.animation.KeyValue;\n+import javafx.animation.Timeline;\n@@ -34,0 +43,1 @@\n+import javafx.beans.property.BooleanProperty;\n@@ -39,0 +49,5 @@\n+import javafx.css.CssMetaData;\n+import javafx.css.Styleable;\n+import javafx.css.StyleableBooleanProperty;\n+import javafx.css.StyleableProperty;\n+import javafx.css.converter.BooleanConverter;\n@@ -43,1 +58,5 @@\n-import javafx.scene.shape.*;\n+import javafx.scene.shape.ClosePath;\n+import javafx.scene.shape.LineTo;\n+import javafx.scene.shape.MoveTo;\n+import javafx.scene.shape.Path;\n+import javafx.scene.shape.StrokeLineJoin;\n@@ -45,1 +64,0 @@\n-\n@@ -47,7 +65,0 @@\n-import javafx.css.converter.BooleanConverter;\n-\n-import javafx.beans.property.BooleanProperty;\n-import javafx.css.CssMetaData;\n-import javafx.css.Styleable;\n-import javafx.css.StyleableBooleanProperty;\n-import javafx.css.StyleableProperty;\n@@ -801,1 +812,1 @@\n-            symbol.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n+            symbol.setFocusTraversable(isAccessibilityActive());\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/StackedAreaChart.java","additions":27,"deletions":16,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,4 +29,12 @@\n-import java.util.*;\n-\n-import javafx.animation.*;\n-import javafx.application.Platform;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import javafx.animation.FadeTransition;\n+import javafx.animation.Interpolator;\n+import javafx.animation.KeyFrame;\n+import javafx.animation.KeyValue;\n+import javafx.animation.ParallelTransition;\n+import javafx.animation.Timeline;\n@@ -36,0 +44,1 @@\n+import javafx.collections.ListChangeListener;\n@@ -37,0 +46,6 @@\n+import javafx.css.CssMetaData;\n+import javafx.css.PseudoClass;\n+import javafx.css.Styleable;\n+import javafx.css.StyleableDoubleProperty;\n+import javafx.css.StyleableProperty;\n+import javafx.css.converter.SizeConverter;\n@@ -42,1 +57,0 @@\n-\n@@ -45,10 +59,0 @@\n-import javafx.css.StyleableDoubleProperty;\n-import javafx.css.CssMetaData;\n-import javafx.css.PseudoClass;\n-\n-import javafx.css.converter.SizeConverter;\n-\n-import javafx.collections.ListChangeListener;\n-import javafx.css.Styleable;\n-import javafx.css.StyleableProperty;\n-\n@@ -538,1 +542,1 @@\n-            bar.focusTraversableProperty().bind(Platform.accessibilityActiveProperty());\n+            bar.setFocusTraversable(isAccessibilityActive());\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/StackedBarChart.java","additions":21,"deletions":17,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -1735,0 +1735,11 @@\n+    @Override\n+    void updateSymbolFocusable(boolean on) {\n+        for (Series<X, Y> s : getData()) {\n+            for (Data<X, Y> d : s.getData()) {\n+                Node n = d.getNode();\n+                if (n != null) {\n+                    n.setFocusTraversable(on);\n+                }\n+            }\n+        }\n+    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/chart\/XYChart.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -202,1 +202,0 @@\n-import org.junit.jupiter.api.Disabled;\n@@ -221,0 +220,3 @@\n+ * Some tests employ repeated actions, such as setting the chart data, in order to exercise both addition\n+ * and removal code paths.\n+ *\n@@ -289,1 +291,0 @@\n-    @Disabled(\"JDK-8349091\") \/\/ FIX\n@@ -298,1 +299,0 @@\n-            c.getData().setAll(createNumberSeries());\n@@ -300,0 +300,2 @@\n+            c.getData().setAll(createNumberSeries());\n+            c.getData().setAll(createNumberSeries());\n@@ -303,1 +305,0 @@\n-    @Disabled(\"JDK-8349091\") \/\/ FIX\n@@ -309,1 +310,3 @@\n-            c.getData().setAll(createCategorySeries());\n+            if (nextBoolean()) {\n+                c.getData().setAll(createCategorySeries());\n+            }\n@@ -312,1 +315,0 @@\n-            c.getData().setAll(createCategorySeries());\n@@ -314,0 +316,2 @@\n+            c.getData().setAll(createCategorySeries());\n+            c.getData().setAll(createCategorySeries());\n@@ -343,1 +347,0 @@\n-    @Disabled(\"JDK-8349091\") \/\/ FIX\n@@ -352,1 +355,0 @@\n-            c.getData().setAll(createNumberSeries());\n@@ -354,0 +356,2 @@\n+            c.getData().setAll(createNumberSeries());\n+            c.getData().setAll(createNumberSeries());\n@@ -698,1 +702,0 @@\n-    @Disabled(\"JDK-8349091\") \/\/ FIX\n@@ -707,1 +710,0 @@\n-            c.getData().setAll(createNumberSeries());\n@@ -709,0 +711,2 @@\n+            c.getData().setAll(createNumberSeries());\n+            c.getData().setAll(createNumberSeries());\n@@ -859,1 +863,0 @@\n-    @Disabled(\"JDK-8349090\") \/\/ FIX\n@@ -981,1 +984,0 @@\n-    @Disabled(\"JDK-8349091\") \/\/ FIX\n@@ -990,1 +992,0 @@\n-            c.getData().setAll(createNumberSeries());\n@@ -992,0 +993,2 @@\n+            c.getData().setAll(createNumberSeries());\n+            c.getData().setAll(createNumberSeries());\n@@ -1069,1 +1072,0 @@\n-    @Disabled(\"JDK-8349091\") \/\/ FIX\n@@ -1078,1 +1080,0 @@\n-            c.getData().setAll(createNumberSeries());\n@@ -1080,0 +1081,2 @@\n+            c.getData().setAll(createNumberSeries());\n+            c.getData().setAll(createNumberSeries());\n@@ -1083,1 +1086,0 @@\n-    @Disabled(\"JDK-8349091\") \/\/ FIX\n@@ -1092,0 +1094,1 @@\n+            c.getData().setAll(createCategorySeries());\n@@ -1369,1 +1372,1 @@\n-        c.setAnimated(true);\n+        c.setAnimated(nextBoolean());\n","filename":"tests\/system\/src\/test\/java\/test\/robot\/javafx\/scene\/NodeInitializationStressTest.java","additions":20,"deletions":17,"binary":false,"changes":37,"status":"modified"}]}