{"files":[{"patch":"@@ -62,0 +62,2 @@\n+import com.sun.javafx.gradle.CompileTarget\n+\n@@ -168,10 +170,0 @@\n-\/**\n- * Struct used to contain some information passed to the closure\n- * passed to compileTargets.\n- *\/\n-class CompileTarget {\n-    String name;\n-    String upper;\n-    String capital;\n-}\n-\n@@ -345,2 +337,0 @@\n-ext.MAVEN_GROUP_ID = \"org.openjfx\"\n-\n@@ -529,4 +519,0 @@\n-\/\/ Specifies whether to enable the Maven publishing tasks\n-defineProperty(\"MAVEN_PUBLISH\", \"false\")\n-ext.IS_MAVEN_PUBLISH = Boolean.parseBoolean(MAVEN_PUBLISH)\n-\n@@ -700,1 +686,0 @@\n-defineProperty(\"MAVEN_VERSION\", IS_MAVEN_PUBLISH ? (IS_MILESTONE_FCS ? \"${RELEASE_VERSION_SHORT}\" : \"${RELEASE_VERSION_LONG}\") : \"\")\n@@ -819,1 +804,0 @@\n-\n@@ -1552,2 +1536,0 @@\n-logger.quiet(\"MAVEN_PUBLISH: $MAVEN_PUBLISH\")\n-logger.quiet(\"MAVEN_VERSION: $MAVEN_VERSION\")\n@@ -1772,107 +1754,0 @@\n-void addMavenPublication(Project project, List<String> projectDependencies) {\n-    if (!IS_MAVEN_PUBLISH) {\n-        return\n-    }\n-\n-    if (!project.hasProperty(\"moduleName\")) {\n-        fail(\"Project ${project} has no module name\")\n-    }\n-    projectDependencies.each { projName ->\n-        def dep = project.project(\":$projName\")\n-        if (!dep.hasProperty(\"moduleName\")) {\n-            fail(\"${project} dependency ${dep} has no module name\")\n-        }\n-    }\n-\n-    project.apply plugin: 'maven-publish'\n-\n-    project.group = MAVEN_GROUP_ID\n-    project.version = MAVEN_VERSION\n-\n-    if (project.name == 'base') {\n-        project.publishing {\n-            publications {\n-                javafx(MavenPublication) {\n-                    artifactId = 'javafx'\n-                    artifacts = []\n-                }\n-            }\n-        }\n-    }\n-\n-    gradle.taskGraph.whenReady { g ->\n-        project.tasks.findAll { it.name == 'generatePomFileForJavafxPublication'}.each { it ->\n-            it.doLast {\n-                copy {\n-                    into project.file(\"${project.buildDir}\/publications\/javafx\")\n-                    from file(\"${rootProject.projectDir}\/javafx.pom\")\n-                    rename \"javafx.pom\", \"pom-default.xml\"\n-                    filter { line ->\n-                        line.replaceAll(\"@VERSION@\", MAVEN_VERSION)\n-                    }\n-                }\n-            }\n-        }\n-    }\n-\n-    project.publishing {\n-        repositories {\n-            maven {\n-                def repositoryUrl = project.hasProperty('repositoryUrl') ? project.getProperty('repositoryUrl') : \"\"\n-                def repositoryUsername = project.hasProperty('repositoryUsername') ? project.getProperty('repositoryUsername') : \"\"\n-                def repositoryPassword = project.hasProperty('repositoryPassword') ? project.getProperty('repositoryPassword') : \"\"\n-                url repositoryUrl\n-                credentials {\n-                   username repositoryUsername\n-                   password repositoryPassword\n-                }\n-            }\n-        }\n-    }\n-\n-    compileTargets { t ->\n-        project.publishing {\n-            publications {\n-                maven(MavenPublication) {\n-                    def artifactName = project.moduleName.replace('.', '-')\n-                    artifactId = artifactName\n-\n-                    afterEvaluate {\n-                        artifact project.tasks.\"moduleEmptyPublicationJar$t.capital\"\n-                        artifact project.tasks.\"modularPublicationJar$t.capital\" {\n-                            archiveClassifier.set(\"$t.name\")\n-                        }\n-                    }\n-\n-                    pom.withXml {\n-                        Node parent = asNode().appendNode(\"parent\")\n-                        parent.appendNode(\"groupId\", MAVEN_GROUP_ID)\n-                        parent.appendNode(\"artifactId\", \"javafx\")\n-                        parent.appendNode(\"version\", MAVEN_VERSION)\n-\n-                        Node dependencies = asNode().appendNode(\"dependencies\")\n-\n-                        Node projectDependencyPlatform = dependencies.appendNode(\"dependency\")\n-                        projectDependencyPlatform.appendNode(\"groupId\", MAVEN_GROUP_ID)\n-                        projectDependencyPlatform.appendNode(\"artifactId\", artifactName)\n-                        projectDependencyPlatform.appendNode(\"version\", MAVEN_VERSION)\n-                        projectDependencyPlatform.appendNode(\"classifier\", \"\\${javafx.platform}\")\n-\n-                        if (!projectDependencies.empty) {\n-                            projectDependencies.each { projName ->\n-                                def dep = project.project(\":$projName\")\n-                                def depName = dep.moduleName.replace('.', '-')\n-                                Node projectDependency = dependencies.appendNode(\"dependency\")\n-                                projectDependency.appendNode(\"groupId\", MAVEN_GROUP_ID)\n-                                projectDependency.appendNode(\"artifactId\", depName)\n-                                projectDependency.appendNode(\"version\", MAVEN_VERSION)\n-                           }\n-                        }\n-                    }\n-                }\n-            }\n-\n-        }\n-    }\n-}\n-\n@@ -2234,0 +2109,2 @@\n+    println \"build: base\"\n+\n@@ -2297,1 +2174,0 @@\n-    addMavenPublication(project, [])\n@@ -2895,2 +2771,0 @@\n-    addMavenPublication(project, [ 'base' ])\n-\n@@ -2973,2 +2847,0 @@\n-    addMavenPublication(project, [ 'graphics' ])\n-\n@@ -3043,2 +2915,0 @@\n-    addMavenPublication(project, [ 'controls' ])\n-\n@@ -3102,2 +2972,0 @@\n-    addMavenPublication(project, [ 'controls', 'incubator.input' ])\n-\n@@ -3161,4 +3029,0 @@\n-    if (COMPILE_SWING) {\n-        addMavenPublication(project, [ 'graphics' ])\n-    }\n-\n@@ -3282,1 +3146,0 @@\n-    addMavenPublication(project, [ 'controls' ])\n@@ -3890,1 +3753,0 @@\n-    addMavenPublication(project, [ 'graphics' ])\n@@ -3914,2 +3776,0 @@\n-    addMavenPublication(project, [])\n-\n@@ -4218,2 +4078,0 @@\n-    addMavenPublication(project, [ 'controls', 'media', 'jsobject' ])\n-\n@@ -4477,0 +4335,3 @@\n+\/\/ Apply Maven Publishing (if enabled) right after all projects are defined.\n+apply from: 'maven-publish.gradle'\n+\n@@ -5518,3 +5379,1 @@\n-    \/\/ Maven Publications\n-    def publicationDirName = \"${platformPrefix}publications\"\n-    def publicationDir = \"${rootProject.buildDir}\/${publicationDirName}\"\n+    configureMavenPublication(moduleProjList, t, buildModulesTask)\n@@ -5522,32 +5381,0 @@\n-    moduleProjList.each { project ->\n-        \/\/ Create publications to be uploaded\n-\n-        def moduleName = project.ext.moduleName\n-        def buildDir = project.buildDir\n-\n-        def dstModularJarDir=\"${publicationDir}\"\n-        def srcClassesDir = \"${buildDir}\/${platformPrefix}module-classes\"\n-        def srcLibsDir = \"${buildDir}\/${platformPrefix}module-lib\"\n-\n-        def modularEmptyPublicationJarName = \"${moduleName}.jar\"\n-        def modularEmptyPublicationJarTask = project.task(\"moduleEmptyPublicationJar${t.capital}\", type: Jar) {\n-            destinationDirectory = file(\"${dstModularJarDir}\")\n-            archiveFileName = modularEmptyPublicationJarName\n-            manifest {\n-                attributes(\n-                        'Automatic-Module-Name':\"${moduleName}Empty\"\n-                )\n-            }\n-        }\n-\n-        def modularPublicationJarName = \"${moduleName}-${t.name}.jar\"\n-        def modularPublicationJarTask = project.task(\"modularPublicationJar${t.capital}\", type: Jar, dependsOn: modularEmptyPublicationJarTask) {\n-            destinationDirectory = file(\"${dstModularJarDir}\")\n-            archiveFileName = modularPublicationJarName\n-            from srcLibsDir\n-            from srcClassesDir\n-        }\n-\n-        buildModulesTask.dependsOn(modularPublicationJarTask)\n-\n-    }\n@@ -5703,3 +5530,0 @@\n-        if (project.tasks.getByName(\"modularPublicationJar$t.capital\") != null) {\n-            project.tasks.getByName(\"modularPublicationJar$t.capital\").dependsOn(buildModuleClassesTask)\n-        }\n@@ -5775,1 +5599,0 @@\n-        baseProject.tasks.getByName(\"modularPublicationJar$t.capital\").dependsOn(buildModuleBaseTask)\n@@ -5850,1 +5673,0 @@\n-        graphicsProject.tasks.getByName(\"modularPublicationJar$t.capital\").dependsOn(buildModuleGraphicsTask)\n@@ -5925,1 +5747,0 @@\n-        mediaProject.tasks.getByName(\"modularPublicationJar$t.capital\").dependsOn(buildModuleMediaTask)\n@@ -5978,1 +5799,0 @@\n-        webProject.tasks.getByName(\"modularPublicationJar$t.capital\").dependsOn(buildModuleWeb)\n@@ -6003,1 +5823,0 @@\n-        graphicsProject.tasks.getByName(\"modularPublicationJar$t.capital\").dependsOn(buildModuleSWT)\n","filename":"build.gradle","additions":8,"deletions":189,"binary":false,"changes":197,"status":"modified"},{"patch":"@@ -0,0 +1,35 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package com.sun.javafx.gradle;\n+\n+\/**\n+ * Struct used to contain some information passed to the closure\n+ * passed to compileTargets.\n+ *\/\n+public class CompileTarget {\n+    public String name;\n+    public String upper;\n+    public String capital;\n+}\n","filename":"buildSrc\/src\/main\/groovy\/com\/sun\/javafx\/gradle\/CompileTarget.java","additions":35,"deletions":0,"binary":false,"changes":35,"status":"added"},{"patch":"@@ -0,0 +1,233 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+import com.sun.javafx.gradle.CompileTarget\n+\n+\/**\n+ * If the given named property is not defined, then this method will define\n+ * it with the given defaultValue. Any properties defined by this method can\n+ * be substituted on the command line by using -P, or by specifying a\n+ * gradle.properties file in the user home dir\n+ *\n+ * @param name The name of the property to define\n+ * @param defaultValue The default value to assign the property\n+ *\/\n+void defineProperty(String name, String defaultValue) {\n+    if (!project.hasProperty(name)) {\n+        project.ext.set(name, defaultValue)\n+    }\n+}\n+\n+static void fail(String msg) {\n+    throw new GradleException(\"FAIL: \" + msg)\n+}\n+\n+defineProperty(\"MAVEN_PUBLISH\", \"false\")\n+ext.IS_MAVEN_PUBLISH = Boolean.parseBoolean(MAVEN_PUBLISH)\n+defineProperty(\"MAVEN_VERSION\", IS_MAVEN_PUBLISH ? (ext.IS_MILESTONE_FCS ? project.ext.RELEASE_VERSION_SHORT : project.ext.RELEASE_VERSION_LONG) : \"\")\n+ext.MAVEN_GROUP_ID = \"org.openjfx\"\n+\n+logger.quiet(\"MAVEN_PUBLISH: $MAVEN_PUBLISH\")\n+logger.quiet(\"MAVEN_VERSION: $MAVEN_VERSION\")\n+\n+registerModules()\n+\n+void registerModules() {\n+    if (!IS_MAVEN_PUBLISH) {\n+        return\n+    }\n+\n+    Project base = project(\":base\")\n+    Project graphics = project(\":graphics\")\n+    Project controls = project(\":controls\")\n+    Project fxml = project(\":fxml\")\n+    Project media = project(\":media\")\n+\n+    addMavenPublication(base, [])\n+    addMavenPublication(graphics, [ base ])\n+    addMavenPublication(controls, [ graphics ])\n+    addMavenPublication(fxml, [ controls ])\n+    addMavenPublication(media, [ graphics ])\n+\n+    if (ext.COMPILE_SWING) {\n+        addMavenPublication(project(\":swing\"), [ graphics ])\n+    }\n+\n+    Project jsobject = project(\":jsobject\")\n+\n+    addMavenPublication(jsobject, [])\n+    addMavenPublication(project(\":web\"), [ controls, media, jsobject ])\n+\n+    \/\/ Incubator modules\n+    Project incubatorInput = project(\":incubator.input\")\n+\n+    addMavenPublication(incubatorInput, [ controls ])\n+    addMavenPublication(project(\":incubator.richtext\"), [ controls, incubatorInput ])\n+}\n+\n+ext.configureMavenPublication = { List<Project> projects, CompileTarget t, Task dependingTask ->\n+    if (!IS_MAVEN_PUBLISH) {\n+        return\n+    }\n+\n+    def targetProperties = project.ext[t.upper]\n+    def platformPrefix = targetProperties.platformPrefix\n+\n+    \/\/ Maven Publications\n+    def publicationDirName = \"${platformPrefix}publications\"\n+    def publicationDir = \"${rootProject.layout.buildDirectory.get()}\/${publicationDirName}\"\n+\n+    projects.each { Project project ->\n+        def moduleName = project.ext.moduleName\n+        def buildDir = project.layout.buildDirectory.get()\n+\n+        def dstModularJarDir=\"${publicationDir}\"\n+        def srcClassesDir = \"${buildDir}\/${platformPrefix}module-classes\"\n+        def srcLibsDir = \"${buildDir}\/${platformPrefix}module-lib\"\n+\n+        def modularEmptyPublicationJarName = \"${moduleName}.jar\"\n+        def modularEmptyPublicationJarTask = project.tasks.register(\"moduleEmptyPublicationJar${t.capital}\", Jar) {\n+            destinationDirectory = file(\"${dstModularJarDir}\")\n+            archiveFileName = modularEmptyPublicationJarName\n+            manifest {\n+                attributes(\n+                        'Automatic-Module-Name':\"${moduleName}Empty\"\n+                )\n+            }\n+        }\n+\n+        def modularPublicationJarName = \"${moduleName}-${t.name}.jar\"\n+        def modularPublicationJarTask = project.tasks.register(\"modularPublicationJar${t.capital}\", Jar) {\n+            dependsOn modularEmptyPublicationJarTask\n+\n+            destinationDirectory = file(\"${dstModularJarDir}\")\n+            archiveFileName = modularPublicationJarName\n+            from srcLibsDir\n+            from srcClassesDir\n+        }\n+\n+        dependingTask.dependsOn(modularPublicationJarTask)\n+    }\n+}\n+\n+void addMavenPublication(Project project, List<Project> projectDependencies) {\n+    if (!project.hasProperty(\"moduleName\")) {\n+        fail(\"Project ${project} has no module name\")\n+    }\n+    projectDependencies.each { dep ->\n+        if (!dep.hasProperty(\"moduleName\")) {\n+            fail(\"${project} dependency ${dep} has no module name\")\n+        }\n+    }\n+\n+    project.apply plugin: 'maven-publish'\n+\n+    project.group = MAVEN_GROUP_ID\n+    project.version = MAVEN_VERSION\n+\n+    if (project.name == 'base') {\n+        project.publishing {\n+            publications {\n+                javafx(MavenPublication) {\n+                    artifactId = 'javafx'\n+                    artifacts = []\n+                }\n+            }\n+        }\n+    }\n+\n+    gradle.taskGraph.whenReady { g ->\n+        project.tasks.findAll { it.name == 'generatePomFileForJavafxPublication' }.each { it ->\n+            it.doLast {\n+                copy {\n+                    into project.file(\"${project.layout.buildDirectory.get()}\/publications\/javafx\")\n+                    from file(\"${rootProject.projectDir}\/javafx.pom\")\n+                    rename \"javafx.pom\", \"pom-default.xml\"\n+                    filter {\n+                        line -> line.replaceAll(\"@VERSION@\", MAVEN_VERSION)\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    project.publishing {\n+        repositories {\n+            maven {\n+                def repositoryUrl = project.hasProperty('repositoryUrl') ? project.getProperty('repositoryUrl') : \"\"\n+                def repositoryUsername = project.hasProperty('repositoryUsername') ? project.getProperty('repositoryUsername') : \"\"\n+                def repositoryPassword = project.hasProperty('repositoryPassword') ? project.getProperty('repositoryPassword') : \"\"\n+                url repositoryUrl\n+                credentials {\n+                    username repositoryUsername\n+                    password repositoryPassword\n+                }\n+            }\n+        }\n+    }\n+\n+    compileTargets { t ->\n+        project.publishing {\n+            publications {\n+                maven(MavenPublication) {\n+                    String artifactName = project.moduleName.replace('.', '-')\n+                    artifactId = artifactName\n+\n+                    afterEvaluate {\n+                        artifact project.tasks.\"moduleEmptyPublicationJar$t.capital\"\n+                        artifact project.tasks.\"modularPublicationJar$t.capital\" {\n+                            archiveClassifier.set(\"$t.name\")\n+                        }\n+                    }\n+\n+                    pom.withXml {\n+                        Node parent = asNode().appendNode(\"parent\")\n+                        parent.appendNode(\"groupId\", MAVEN_GROUP_ID)\n+                        parent.appendNode(\"artifactId\", \"javafx\")\n+                        parent.appendNode(\"version\", MAVEN_VERSION)\n+\n+                        Node dependencies = asNode().appendNode(\"dependencies\")\n+\n+                        Node projectDependencyPlatform = dependencies.appendNode(\"dependency\")\n+                        projectDependencyPlatform.appendNode(\"groupId\", MAVEN_GROUP_ID)\n+                        projectDependencyPlatform.appendNode(\"artifactId\", artifactName)\n+                        projectDependencyPlatform.appendNode(\"version\", MAVEN_VERSION)\n+                        projectDependencyPlatform.appendNode(\"classifier\", \"\\${javafx.platform}\")\n+\n+                        if (!projectDependencies.empty) {\n+                            projectDependencies.each { dep ->\n+                                String depName = dep.moduleName.replace('.', '-')\n+                                Node projectDependency = dependencies.appendNode(\"dependency\")\n+                                projectDependency.appendNode(\"groupId\", MAVEN_GROUP_ID)\n+                                projectDependency.appendNode(\"artifactId\", depName)\n+                                projectDependency.appendNode(\"version\", MAVEN_VERSION)\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+\n+        }\n+    }\n+}\n","filename":"maven-publish.gradle","additions":233,"deletions":0,"binary":false,"changes":233,"status":"added"}]}