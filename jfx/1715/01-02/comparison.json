{"files":[{"patch":"@@ -226,4 +226,6 @@\n-                    for (IndexedCell cell : flow.cells) {\n-                        if (cell == null || cell.isEmpty()) continue;\n-                        cell.requestLayout();\n-                        cell.layout();\n+                    if (flow != null) {\n+                        for (IndexedCell cell : flow.cells) {\n+                            if (cell == null || cell.isEmpty()) continue;\n+                            cell.requestLayout();\n+                            cell.layout();\n+                        }\n@@ -261,2 +263,2 @@\n-            if (p instanceof VirtualFlow) {\n-                return (VirtualFlow<?>) p;\n+            if (p instanceof VirtualFlow vf) {\n+                return vf;\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TreeCellSkin.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -38,0 +38,2 @@\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n@@ -4078,0 +4080,44 @@\n+    \/\/ JDK-8340344\n+    @Test\n+    public void testTreeItemsAlignment() {\n+        root = new TreeItem<>(\"Root\");\n+        child1 = new TreeItem<>(\"Child 1\");\n+        child2 = new TreeItem<>(\"Child 2\");\n+        child3 = new TreeItem<>(\"Child 3\");\n+\n+        TreeItem<String> child4 = new TreeItem<>(\"Child 4\");\n+        child3.getChildren().add(child4);\n+        root.getChildren().addAll(child1, child2, child3);\n+        root.setExpanded(true);\n+\n+        treeView = new TreeView<>(root);\n+        treeView.setShowRoot(false);\n+\n+        Map<String, Double> layoutXMap = new LinkedHashMap<>();\n+\n+        treeView.setCellFactory(tv -> new TreeCell<>() {\n+            @Override\n+            protected void layoutChildren() {\n+                super.layoutChildren();\n+                if (getItem() != null && !isEmpty()) {\n+                    Node container = lookup(\".tree-cell > *\");\n+                    if (container != null) {\n+                        layoutXMap.put(getItem(), container.getLayoutX());\n+                    }\n+                }\n+            }\n+        });\n+\n+        stageLoader = new StageLoader(treeView);\n+        Toolkit.getToolkit().firePulse();\n+\n+        List<Double> values = new ArrayList<>(layoutXMap.values());\n+        assertFalse(values.isEmpty(), \"Expected layoutX values to be collected\");\n+\n+        double first = values.get(0);\n+        for (Map.Entry<String, Double> entry : layoutXMap.entrySet()) {\n+            double x = entry.getValue();\n+            assertEquals(first, x, \"Alignment mismatch for item: \" + entry.getKey());\n+        }\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeViewTest.java","additions":46,"deletions":0,"binary":false,"changes":46,"status":"modified"}]}