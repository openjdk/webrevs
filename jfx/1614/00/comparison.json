{"files":[{"patch":"@@ -36,0 +36,1 @@\n+import com.sun.javafx.tk.Toolkit;\n@@ -166,1 +167,1 @@\n-    public DisposerRecord createSwingNodeDisposer(Object frame) {\n+    public DisposerRecord createSwingNodeDisposer(Object frame, SwingNodeInteropN swNodeIOP) {\n@@ -168,1 +169,1 @@\n-        return new SwingNodeDisposer(lwFrame);\n+        return new SwingNodeDisposer(lwFrame, swNodeIOP);\n@@ -236,0 +237,1 @@\n+        Runnable tkShutdownHook;\n@@ -237,1 +239,1 @@\n-        SwingNodeDisposer(LightweightFrameWrapper ref) {\n+        SwingNodeDisposer(LightweightFrameWrapper ref, SwingNodeInteropN swNodeIOP) {\n@@ -239,0 +241,9 @@\n+\n+            \/\/ Reset and notify FX stage handle to JLightweightFrame\n+            \/\/ so that CPlatformWindow doesn't try to create AWT child window\n+            \/\/ once FX is shutdown\n+            final Runnable shutdownHook = () -> {\n+                swNodeIOP.overrideNativeWindowHandle(lwFrame, 0L, null);\n+            };\n+            Toolkit.getToolkit().addShutdownHook(shutdownHook);\n+            tkShutdownHook = shutdownHook;\n@@ -243,0 +254,1 @@\n+            Toolkit.getToolkit().removeShutdownHook(tkShutdownHook);\n","filename":"modules\/javafx.swing\/src\/main\/java\/com\/sun\/javafx\/embed\/swing\/newimpl\/SwingNodeInteropN.java","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -390,1 +390,1 @@\n-            rec = swNodeIOP.createSwingNodeDisposer(lwFrame);\n+            rec = swNodeIOP.createSwingNodeDisposer(lwFrame, swNodeIOP);\n","filename":"modules\/javafx.swing\/src\/main\/java\/javafx\/embed\/swing\/SwingNode.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+import org.junit.jupiter.api.AfterAll;\n@@ -39,1 +40,0 @@\n-    @Disabled(\"JDK-8340849\")\n@@ -54,0 +54,6 @@\n+\n+    @AfterAll\n+    public static void teardownOnce() {\n+        \/\/ No-op as Toolkit shutdown is already done in Platform.exit\n+        \/\/ and calling superclass teardownOnce will cause hang\n+    }\n","filename":"tests\/system\/src\/test\/java\/test\/robot\/javafx\/embed\/swing\/SwingNodePlatformExitCrashTest.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}