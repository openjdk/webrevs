{"files":[{"patch":"@@ -28,0 +28,5 @@\n+\/\/ Glass Gtk is built with GTK+ 3. It is not compatible with other major GTK versions (e.g., GTK 2 or GTK 4).\n+def gtk3MinMinorVersion = \"20\"\n+def gtk3MinMicroVersion = \"0\"\n+def gtk3MinVersion = \"3.%s.%s\".formatted(gtk3MinMinorVersion, gtk3MinMicroVersion)\n+\n@@ -85,1 +90,3 @@\n-def gtk3CCFlags = [ \"-Wno-deprecated-declarations\" ];\n+def gtk3CCFlags = [ \"-Wno-deprecated-declarations\",\n+                    \"-DGTK_3_MIN_MINOR_VERSION=\"+gtk3MinMinorVersion,\n+                    \"-DGTK_3_MIN_MICRO_VERSION=\"+gtk3MinMicroVersion];\n@@ -90,0 +97,10 @@\n+        def checkGTK3Version = exec {\n+            commandLine \"${toolchainDir}pkg-config\", \"--exists\", \"gtk+-3.0 >= \" + gtk3MinVersion\n+            ignoreExitValue = true\n+        }\n+\n+        if (checkGTK3Version.exitValue != 0) {\n+            throw new IllegalStateException(\"GTK3 \" + gtk3MinVersion + \"+ development packages not found.\"\n+                    + \" If GTK3 packages are installed, please remove the build directory and try again.\")\n+        }\n+\n@@ -112,2 +129,0 @@\n-        } else {\n-            throw new IllegalStateException(\"GTK3 development packages not found. If GTK3 packages are installed, please remove the build directory and try again.\")\n","filename":"buildSrc\/linux.gradle","additions":18,"deletions":3,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include <sstream>\n@@ -55,0 +56,18 @@\n+void checkGtkVersion(JNIEnv* env, jint reqMajor) {\n+    \/\/ Major version is checked before loading\n+    \/\/ GTK_3_MIN_MINOR_VERSION and GTK_3_MIN_MICRO_VERSION comes from the build system\n+    if (reqMajor == 3\n+        && gtk_check_version(reqMajor, GTK_3_MIN_MINOR_VERSION, GTK_3_MIN_MICRO_VERSION)) {\n+\n+        std::ostringstream oss;\n+        oss << \"Minimum GTK version required is \" << reqMajor << \".\" << GTK_3_MIN_MINOR_VERSION\n+            << \".\" << GTK_3_MIN_MICRO_VERSION << \". System has \" << gtk_major_version << \".\"\n+            << gtk_minor_version << \".\" << gtk_micro_version << \".\";\n+\n+        jclass uoe = env->FindClass(\"java\/lang\/UnsupportedOperationException\");\n+        if (uoe != nullptr) {\n+            env->ThrowNew(uoe, oss.str().c_str());\n+        }\n+    }\n+}\n+\n@@ -117,14 +136,1 @@\n-    \/\/ Major version is checked before loading\n-    if (version == 3\n-        && gtk_check_version(version, GTK_3_MIN_MINOR_VERSION, GTK_3_MIN_MICRO_VERSION)) {\n-        char message[100];\n-        snprintf(message, sizeof(message),\n-                 \"Minimum GTK version required is %d.%d.%d. System has %d.%d.%d.\",\n-                 version, GTK_3_MIN_MINOR_VERSION, GTK_3_MIN_MICRO_VERSION,\n-                 gtk_major_version, gtk_minor_version, gtk_micro_version);\n-\n-        jclass uoe = env->FindClass(\"java\/lang\/UnsupportedOperationException\");\n-        env->ThrowNew(uoe, message);\n-\n-        return;\n-    }\n+    checkGtkVersion(env, version);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/GlassApplication.cpp","additions":20,"deletions":14,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -38,4 +38,0 @@\n-#if GTK_CHECK_VERSION(3, 0, 0)\n-#if ! GTK_CHECK_VERSION(3, 8, 0)\n-#error GTK development version is not the minimum 3.8\n-#endif\n@@ -43,4 +39,0 @@\n-#endif\n-\n-#define GTK_3_MIN_MINOR_VERSION 8\n-#define GTK_3_MIN_MICRO_VERSION 0\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_general.h","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"}]}