{"files":[{"patch":"@@ -336,2 +336,0 @@\n-      # FIXME: hard-code the location of VS 2022 for now\n-      VS150COMNTOOLS: \"C:\\\\Program Files\\\\Microsoft Visual Studio\\\\2022\\\\Enterprise\\\\VC\\\\Auxiliary\\\\Build\"\n@@ -382,1 +380,0 @@\n-          echo \"VS150COMNTOOLS=$env:VS150COMNTOOLS\"\n@@ -385,2 +382,0 @@\n-          echo \"dir VS150COMNTOOLS\"\n-          dir \"$env:VS150COMNTOOLS\"\n@@ -389,2 +384,0 @@\n-          # echo \"dir VS150COMNTOOLS\"\n-          # dir \"$env:VS150COMNTOOLS\"\n","filename":".github\/workflows\/submit.yml","additions":0,"deletions":7,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -217,1 +217,1 @@\n-    if (!propFile.exists()) {\n+    if (!propFile.exists() || propFile.length() == 0) {\n@@ -955,1 +955,0 @@\n-                    \"DXSDK_DIR\"            : WINDOWS_DXSDK_DIR,\n@@ -5392,1 +5391,1 @@\n-                targetProperties.VS2017DLLs.each { vslib ->\n+                targetProperties.VSDLLs.each { vslib ->\n@@ -5407,1 +5406,1 @@\n-                    \/\/ exclude the Microsoft DLLs (VS2017DLLNames and WinSDKDLLNames)\n+                    \/\/ exclude the Microsoft DLLs (VSDLLNames and WinSDKDLLNames)\n@@ -5424,1 +5423,1 @@\n-                    \/\/ exclude the Microsoft DLLs (VS2017DLLNames and WinSDKDLLNames)\n+                    \/\/ exclude the Microsoft DLLs (VSDLLNames and WinSDKDLLNames)\n@@ -5499,1 +5498,1 @@\n-                    \/\/ exclude the Microsoft DLLs (VS2017DLLNames and WinSDKDLLNames)\n+                    \/\/ exclude the Microsoft DLLs (VSDLLNames and WinSDKDLLNames)\n@@ -5552,1 +5551,1 @@\n-                    \/\/ exclude the Microsoft DLLs (VS2017DLLNames and WinSDKDLLNames)\n+                    \/\/ exclude the Microsoft DLLs (VSDLLNames and WinSDKDLLNames)\n","filename":"build.gradle","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-REM Copyright (c) 2009, 2021, Oracle and\/or its affiliates. All rights reserved.\n+REM Copyright (c) 2009, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,3 +24,5 @@\n-REM Windows bat file that runs vcvars32.bat for Visual Studio 2003\n-REM   and echos out a property file with the values of the environment\n-REM   variables we want, e.g. PATH, INCLUDE, LIB, and LIBPATH.\n+setlocal ENABLEDELAYEDEXPANSION\n+\n+REM Windows bat file that runs vcvars64.bat for Visual Studio\n+REM and echoes out a property file with the values of the environment\n+REM variables we want, e.g. PATH, INCLUDE, LIB, and LIBPATH.\n@@ -33,9 +35,14 @@\n-REM Run the vsvars32.bat (12.0) \/ vcvars32.bat (15.0) file, sending it's output to neverland.\n-REM The current officially supported Visual Studio version is 15.0.\n-REM Handling of 11.0 and 14.0 is excluded here.\n-REM The previous officially supported VS version was 12.0\n-REM So, the search order is 150, then 120, then 100\n-set VSVER=150\n-set \"VSVARS32FILE=C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\VC\\Auxiliary\\Build\\vcvars32.bat\"\n-if not \"%VS150COMNTOOLS%\"==\"\" (\n-    set \"VS150COMNTOOLS=%VS150COMNTOOLS%\"\n+REM The current officially supported Visual Studio version is VS 2022\n+\n+REM Try the following in order of priority:\n+REM 1. The VSCOMNTOOLS env var\n+REM 2. The legacy VS150COMNTOOLS env var\n+REM 3. Look in standard locations for Visual Studio (2022,2019,2017)\n+\n+\n+set AUXBUILD=VC\\Auxiliary\\Build\n+\n+if not \"%VSCOMNTOOLS%\"==\"\" (\n+    set \"VSTOOLSDIR=%VSCOMNTOOLS%\"\n+) else if not \"%VS150COMNTOOLS%\"==\"\" (\n+    set \"VSTOOLSDIR=%VS150COMNTOOLS%\"\n@@ -43,1 +50,14 @@\n-  if exist \"%VSVARS32FILE%\" set \"VS150COMNTOOLS=C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\VC\\Auxiliary\\Build\"\n+    for %%a in (2022, 2019, 2017) do (\n+        set year=%%a\n+        for %%b in (Enterprise, Professional, Community, BuildTools) do (\n+            set edition=%%b\n+            for %%c in (\"Program Files\", \"Program Files (x86)\") do (\n+                set ProgramFiles=%%~c\n+                set \"TMPDIR=C:\\!ProgramFiles!\\Microsoft Visual Studio\\!year!\\!edition!\\%AUXBUILD%\"\n+                if exist \"!TMPDIR!\" (\n+                    set \"VSTOOLSDIR=!TMPDIR!\"\n+                    goto FOUNDVS\n+                )\n+            )\n+        )\n+    )\n@@ -45,9 +65,0 @@\n-set VSVARSDIR=%VS150COMNTOOLS%\n-if \"%VSVARSDIR%\"==\"\" set VSVER=120\n-if \"%VSVARSDIR%\"==\"\" set VSVARSDIR=%VS120COMNTOOLS%\n-if \"%VSVARSDIR%\"==\"\" set VSVER=100\n-if \"%VSVARSDIR%\"==\"\" set VSVARSDIR=%VS100COMNTOOLS%\n-\n-REM We shouldn't depend on VSVARS32 as it's 32-bit only.\n-REM   However, this var is still used somewhere in FX (e.g.\n-REM   to build media), so we set it here.\n@@ -55,4 +66,1 @@\n-if \"%VSVER%\"==\"100\" set VSVARS32=%VSVARSDIR%\\vsvars32.bat\n-if \"%VSVER%\"==\"120\" set VSVARS32=%VSVARSDIR%\\vsvars32.bat\n-if \"%VSVER%\"==\"150\" set VSVARS32=%VSVARSDIR%\\vcvars32.bat\n-call \"%VSVARS32%\" > NUL\n+:FOUNDVS\n@@ -60,4 +68,2 @@\n-if \"%VSVER%\"==\"100\" set VCVARSALL=%VCINSTALLDIR%\\vcvarsall.bat\n-if \"%VSVER%\"==\"120\" set VCVARSALL=%VCINSTALLDIR%\\vcvarsall.bat\n-if \"%VSVER%\"==\"150\" set VCVARSALL=%VSVARSDIR%\\vcvarsall.bat\n-call \"%VCVARSALL%\" %VCARCH% > NUL\n+if \"%VSTOOLSDIR%\"==\"\" exit\n+if not exist \"%VSTOOLSDIR%\" exit\n@@ -65,8 +71,1 @@\n-REM Some vars are reset by vcvarsall.bat, so save them here.\n-set TEMPDEVENVDIR=%DEVENVDIR%\n-set TEMPVCINSTALLDIR=%VCINSTALLDIR%\n-set TEMPVSINSTALLDIR=%VSINSTALLDIR%\n-if NOT \"%WINSDKPATH%\"==\"\" call \"%WINSDKPATH%\\Bin\\SetEnv.Cmd\" %SDKARCH% %CONF% > NUL\n-set DEVENVDIR=%TEMPDEVENVDIR%\n-set VSINSTALLDIR=%TEMPVSINSTALLDIR%\n-set VCINSTALLDIR=%TEMPVCINSTALLDIR%\n+call \"%VSTOOLSDIR%\\vcvars64.bat\" > NUL\n@@ -74,1 +73,1 @@\n-REM Create some vars that are not set with VS Express 2008\n+REM Set legacy MSVCDIR variable in case some Makefiles still need it\n@@ -76,7 +75,0 @@\n-REM Try using exe, com might be hanging in ssh environment?\n-REM     set DEVENVCMD=%DEVENVDIR%\\devenv.exe\n-set DEVENVCMD=%DEVENVDIR%\\devenv.com\n-\n-REM Adjust for lack of devenv in express editions.  This needs more work.\n-REM VCExpress is the correct executable, but cmd line is different...\n-if not exist \"%DEVENVCMD%\" set DEVENVCMD=%DEVENVDIR%\\VCExpress.exe\n@@ -88,1 +80,0 @@\n-echo windows.vs.DEVENVCMD=%DEVENVCMD%@@ENDOFLINE@@\n@@ -96,1 +87,0 @@\n-echo windows.vs.VER=%VSVER%@@ENDOFLINE@@\n","filename":"buildSrc\/genVSproperties.bat","additions":39,"deletions":49,"binary":false,"changes":88,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,0 +50,11 @@\n+        if (System.getenv(\"VS150COMNTOOLS\") != null) {\n+            println \"***********************************************************************\"\n+            if (System.getenv(\"VSCOMNTOOLS\") != null) {\n+                println \"*** Using VSCOMNTOOLS and ignoring obsolete VS150COMNTOOLS.         ***\"\n+            } else {\n+                println \"*** VS150COMNTOOLS is deprecated and will be ignored in the future. ***\"\n+                println \"*** Set VSCOMNTOOLS to your Visual Studio installation instead.     ***\"\n+            }\n+            println \"***********************************************************************\"\n+        }\n+\n@@ -77,3 +88,3 @@\n-        defineProperty(\"WINDOWS_VS_VSINSTALLDIR\", properties, \"c:\/Program Files (x86)\/Microsoft Visual Studio\/2017\/Professional\");\n-        defineProperty(\"WINDOWS_VS_WINSDKDLLINSTALLDIR\", properties, \"c:\/Program Files (x86)\/Windows Kits\/10\/Redist\/ucrt\/DLLs\");\n-        defineProperty(\"WINDOWS_SDK_DIR\", properties, System.getenv().get(\"WINSDK_DIR\"))\n+        defineProperty(\"WINDOWS_VS_VSINSTALLDIR\", properties, \"\")\n+        defineProperty(\"WINDOWS_VS_WINSDKDLLINSTALLDIR\", properties, \"\")\n+        defineProperty(\"WINDOWS_SDK_DIR\", properties, \"\")\n@@ -83,1 +94,0 @@\n-        defineProperty(\"WINDOWS_VS_DEVENVCMD\", properties, \"$WINDOWS_VS_DEVENVDIR\/VCExpress.exe\")\n@@ -87,14 +97,5 @@\n-        defineProperty(\"WINDOWS_DXSDK_DIR\", properties, System.getenv().get(\"DXSDK_DIR\"))\n-        defineProperty(\"WINDOWS_VS_INCLUDE\", properties, \"$WINDOWS_VS_VCINSTALLDIR\/INCLUDE;\" + \"$WINDOWS_SDK_DIR\/include;\")\n-        defineProperty(\"WINDOWS_VS_VER\", properties, \"150\")\n-        defineProperty(\"WINDOWS_CRT_VER\", properties, \"150\")\n-        defineProperty(\"WINDOWS_VS_LIB\", properties, \"$WINDOWS_VS_VCINSTALLDIR\/LIB;\" + \"$WINDOWS_SDK_DIR\/lib;\")\n-        defineProperty(\"WINDOWS_VS_LIBPATH\", properties, \"$WINDOWS_VS_VCINSTALLDIR\/LIB;\")\n-        def parfaitPath = IS_COMPILE_PARFAIT ? System.getenv().get(\"PARFAIT_PATH\") + \";\" : \"\";\n-        defineProperty(\"WINDOWS_VS_PATH\", properties, parfaitPath + \"$WINDOWS_VS_DEVENVDIR;\" +\n-                \"$WINDOWS_VS_VSINSTALLDIR\/VC\/BIN;\" +\n-                \"$WINDOWS_VS_VSINSTALLDIR\/Common7\/Tools;\" +\n-                \"$WINDOWS_VS_VCINSTALLDIR\/VCPackages;\" +\n-                \"$WINDOWS_SDK_DIR\/bin\/NETFX 4.0 Tools;\" +\n-                \"$WINDOWS_SDK_DIR\/bin;\" +\n-                System.getenv().get(\"PATH\"))\n+        defineProperty(\"WINDOWS_VS_INCLUDE\", properties, \"\")\n+        defineProperty(\"WINDOWS_CRT_VER\", properties, \"143\")\n+        defineProperty(\"WINDOWS_VS_LIB\", properties, \"\")\n+        defineProperty(\"WINDOWS_VS_LIBPATH\", properties, \"\")\n+        defineProperty(\"WINDOWS_VS_PATH\", properties, \"\")\n@@ -105,1 +106,1 @@\n-    throw new GradleException(\"FAIL: WINSDK_DIR not defined\");\n+    throw new GradleException(\"Cannot locate Visual Studio compilers; set the 'VSCOMNTOOLS' env var\\nto the 'VC\/Auxiliary\/Build' dir in your Visual Studio installation\");\n@@ -112,5 +113,2 @@\n-def winVsVer = Integer.parseInt(WINDOWS_VS_VER)\n-if (winVsVer >= 120) {\n-    \/\/ Serialize access to PDB file for debug builds if on VS2013 or later\n-    if (IS_DEBUG_NATIVE) ccDebugFlags += \"\/FS\"\n-}\n+\/\/ Serialize access to PDB file for debug builds\n+if (IS_DEBUG_NATIVE) ccDebugFlags += \"\/FS\"\n@@ -142,4 +140,2 @@\n-\/\/ Remove C++ static linking if not on VS2010\n-if (WINDOWS_VS_VER != \"100\") {\n-    ccFlags -= [\"\/D_STATIC_CPPLIB\", \"\/D_DISABLE_DEPRECATE_STATIC_CPPLIB\"]\n-}\n+\/\/ Remove C++ static linking\n+ccFlags -= [\"\/D_STATIC_CPPLIB\", \"\/D_DISABLE_DEPRECATE_STATIC_CPPLIB\"]\n@@ -152,1 +148,0 @@\n-        \"VS_VER\"               : WINDOWS_VS_VER,\n@@ -157,1 +152,0 @@\n-        \"DXSDK_DIR\"            : WINDOWS_DXSDK_DIR\n@@ -163,1 +157,1 @@\n-} else if (winVsVer == 150) {\n+} else {\n@@ -171,4 +165,0 @@\n-} else if (winVsVer <= 120) {\n-    msvcBinDir = (IS_64\n-                      ? \"$WINDOWS_VS_VSINSTALLDIR\/VC\/BIN\/amd64\"\n-                      : \"$WINDOWS_VS_VSINSTALLDIR\/VC\/BIN\")\n@@ -179,3 +169,1 @@\n-if (WINDOWS_VS_VER != \"100\") {\n-    winSdkBinDir += \"\/$TARGET_ARCH\"\n-}\n+winSdkBinDir += \"\/$TARGET_ARCH\"\n@@ -185,3 +173,1 @@\n-    if (WINDOWS_VS_VER != \"100\") {\n-        winSdkBinDir += \"\/$TARGET_ARCH\"\n-    }\n+    winSdkBinDir += \"\/$TARGET_ARCH\"\n@@ -195,8 +181,0 @@\n-ext.FXC = cygpath(\"$winSdkBinDir\/fxc.exe\")\n-\n-if (!file(FXC).exists()) {\n-    if (WINDOWS_DXSDK_DIR == null || WINDOWS_DXSDK_DIR == \"\") {\n-        throw new GradleException(\"FAIL: DXSDK_DIR not defined\");\n-    }\n-    ext.FXC = cygpath(\"$WINDOWS_DXSDK_DIR\/utilities\/bin\/x86\/fxc.exe\")\n-}\n@@ -204,0 +182,1 @@\n+ext.FXC = cygpath(\"$winSdkBinDir\/fxc.exe\")\n@@ -222,3 +201,3 @@\n-def winSdkDllDir = \"$WINDOWS_VS_WINSDKDLLINSTALLDIR\/$TARGET_ARCH\"\n-\n-def WINDOWS_DLL_VER = WINDOWS_VS_VER\n+def winSdkDllDir = WINDOWS_VS_WINSDKDLLINSTALLDIR != \"\" ?\n+    \"$WINDOWS_VS_WINSDKDLLINSTALLDIR\/$TARGET_ARCH\" :\n+    \"${WINDOWS_SDK_DIR}\/Redist\/${WINDOWS_SDK_VERSION}\/ucrt\/DLLs\/$TARGET_ARCH\"\n@@ -227,3 +206,0 @@\n-if (WINDOWS_VS_VER == \"150\") {\n-    WINDOWS_DLL_VER = \"140\"\n-}\n@@ -231,3 +207,3 @@\n-def vs2017DllPath = cygpath(\"${msvcRedstDir}\/Microsoft.VC${windowsCRTVer}.CRT\")\n-if (file(vs2017DllPath).exists()) {\n-    ext.WIN.VS2017DLLNames = [\n+def vsDllPath = cygpath(\"${msvcRedstDir}\/Microsoft.VC${windowsCRTVer}.CRT\")\n+if (file(vsDllPath).exists()) {\n+    ext.WIN.VSDLLNames = [\n@@ -240,3 +216,3 @@\n-    ext.WIN.VS2017DLLs = []\n-    ext.WIN.VS2017DLLNames.each { vsdll->\n-        ext.WIN.VS2017DLLs += \"$vs2017DllPath\/$vsdll\"\n+    ext.WIN.VSDLLs = []\n+    ext.WIN.VSDLLNames.each { vsdll->\n+        ext.WIN.VSDLLs += \"$vsDllPath\/$vsdll\"\n@@ -246,1 +222,1 @@\n-    ext.WIN.VS2017DLLNames = [\n+    ext.WIN.VSDLLNames = [\n@@ -248,1 +224,1 @@\n-    ext.WIN.VS2017DLLs = [\n+    ext.WIN.VSDLLs = [\n@@ -348,2 +324,1 @@\n-WIN.glass.ccFlags = [ccFlags, \"\/WX\"].flatten()\n-if (WINDOWS_VS_VER != \"100\") WIN.glass.ccFlags -= [\"\/WX\"]\n+WIN.glass.ccFlags = [ccFlags].flatten()\n","filename":"buildSrc\/win.gradle","additions":41,"deletions":66,"binary":false,"changes":107,"status":"modified"},{"patch":"@@ -88,4 +88,0 @@\n-ifeq ($(VS_VER), 100)\n-    CFLAGS += -D_STATIC_CPPLIB -D_DISABLE_DEPRECATE_STATIC_CPPLIB\n-endif\n-\n","filename":"modules\/javafx.media\/src\/main\/native\/jfxmedia\/projects\/win\/Makefile","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"}]}