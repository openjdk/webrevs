{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,2 +35,0 @@\n-\n-import java.util.ArrayList;\n@@ -204,24 +202,0 @@\n-\n-    \/\/ Given a listen of removed elements, we create the minimal number of changes by coalescing elements that are\n-    \/\/ adjacent\n-    static void reducingChange(MultipleSelectionModelBase<?>.SelectedIndicesList selectedIndices, List<Integer> removed) {\n-        if (removed.isEmpty()) return;\n-\n-        int startPos = 0;\n-        int endPos = 1;\n-        boolean firedOnce = false;\n-        while (endPos < removed.size()) {\n-            if (removed.get(startPos) == removed.get(endPos) - 1) {\n-                endPos++;\n-                continue;\n-            }\n-            selectedIndices._nextRemove(selectedIndices.indexOf(removed.get(startPos)), removed.subList(startPos, endPos));\n-            startPos = endPos;\n-            endPos = startPos + 1;\n-            firedOnce = true;\n-        }\n-\n-        if (!firedOnce) {\n-            selectedIndices._nextRemove(selectedIndices.indexOf(removed.get(0)), removed);\n-        }\n-    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ControlUtils.java","additions":1,"deletions":27,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -802,0 +802,1 @@\n+            int indicesIndex = indexOf(index);\n@@ -804,1 +805,1 @@\n-            _nextRemove(index, index);\n+            _nextRemove(indicesIndex, index);\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/MultipleSelectionModelBase.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2554,1 +2554,3 @@\n-                        ControlUtils.reducingChange(selectedIndices, removed);\n+                        if (!removed.isEmpty()) {\n+                            selectedIndices._nextRemove(selectedIndices.indexOf(removed.get(0)), removed);\n+                        }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/TreeTableView.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1378,1 +1378,3 @@\n-                    ControlUtils.reducingChange(selectedIndices, removed);\n+                    if (!removed.isEmpty()) {\n+                        selectedIndices._nextRemove(selectedIndices.indexOf(removed.get(0)), removed);\n+                    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/TreeView.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,0 +41,1 @@\n+import test.javafx.collections.MockListObserver;\n@@ -345,0 +346,12 @@\n+    @Test public void selectedIndicesListenerReportsCorrectIndexOnClearSelection() {\n+        model.setSelectionMode(SelectionMode.MULTIPLE);\n+        model.select(1);\n+        model.select(5);\n+        MockListObserver<Integer> observer = new MockListObserver<>();\n+        model.getSelectedIndices().addListener(observer);\n+        model.clearSelection(5);\n+\n+        observer.check1();\n+        observer.checkAddRemove(0, model.getSelectedIndices(), List.of(5), 1, 1);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/MultipleSelectionModelImplTest.java","additions":14,"deletions":1,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,0 +49,1 @@\n+import test.javafx.collections.MockListObserver;\n@@ -6644,0 +6645,20 @@\n+\n+    @Test public void testRemovedSelectedItemsWhenBranchIsCollapsed() {\n+        TreeItem<String> c1, c2, c3;\n+        TreeItem<String> root = new TreeItem<>(\"foo\");\n+        root.getChildren().add(c1 = new TreeItem<>(\"bar\"));\n+        root.getChildren().add(c2 = new TreeItem<>(\"baz\"));\n+        root.getChildren().add(c3 = new TreeItem<>(\"qux\"));\n+        root.setExpanded(true);\n+\n+        TreeTableView<String> treeView = new TreeTableView<>(root);\n+        treeView.getSelectionModel().setSelectionMode(SelectionMode.MULTIPLE);\n+        treeView.getSelectionModel().selectAll();\n+\n+        MockListObserver<TreeItem<String>> observer = new MockListObserver<>();\n+        treeView.getSelectionModel().getSelectedItems().addListener(observer);\n+        root.setExpanded(false);\n+\n+        observer.check1();\n+        observer.checkAddRemove(0, treeView.getSelectionModel().getSelectedItems(), List.of(c1, c2, c3), 1, 1);\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeTableViewTest.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import test.javafx.collections.MockListObserver;\n@@ -3684,0 +3685,20 @@\n+\n+    @Test public void testRemovedSelectedItemsWhenBranchIsCollapsed() {\n+        TreeItem<String> c1, c2, c3;\n+        TreeItem<String> root = new TreeItem<>(\"foo\");\n+        root.getChildren().add(c1 = new TreeItem<>(\"bar\"));\n+        root.getChildren().add(c2 = new TreeItem<>(\"baz\"));\n+        root.getChildren().add(c3 = new TreeItem<>(\"qux\"));\n+        root.setExpanded(true);\n+\n+        TreeView<String> treeView = new TreeView<>(root);\n+        treeView.getSelectionModel().setSelectionMode(SelectionMode.MULTIPLE);\n+        treeView.getSelectionModel().selectAll();\n+\n+        MockListObserver<TreeItem<String>> observer = new MockListObserver<>();\n+        treeView.getSelectionModel().getSelectedItems().addListener(observer);\n+        root.setExpanded(false);\n+\n+        observer.check1();\n+        observer.checkAddRemove(0, treeView.getSelectionModel().getSelectedItems(), List.of(c1, c2, c3), 1, 1);\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeViewTest.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"}]}