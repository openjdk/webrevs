{"files":[{"patch":"@@ -32,0 +32,1 @@\n+import java.util.function.Function;\n@@ -45,0 +46,1 @@\n+import javafx.beans.property.SimpleObjectProperty;\n@@ -69,1 +71,0 @@\n-import javafx.scene.control.Control;\n@@ -164,1 +165,1 @@\n-     * nodes into the Control {@link Control#getChildren() children} list, as\n+     * nodes into the Control {@link TabPane#getChildren() children} list, as\n@@ -167,1 +168,1 @@\n-     * @param control The control that this skin should be installed onto.\n+     * @param control The TabPane that this skin should be installed onto.\n@@ -258,0 +259,39 @@\n+    \/**\n+     * This property allows to control the graphic for the overflow menu items,\n+     * by generating graphic {@code Node}s when the menu is shown.\n+     * <p>\n+     * When this property is {@code null}, the menu provides only the basic graphic copied from the corresponding\n+     * {@link Tab} - either an {@link ImageView} or a {@link Label} with an {@link ImageView} as its graphic.\n+     * <p>\n+     * Changing this property while the menu is shown has no effect.\n+     *\n+     * @since 25\n+     * @defaultValue null\n+     *\/\n+    private ObjectProperty<Function<Tab, Node>> menuGraphicFactory;\n+\n+    public final ObjectProperty<Function<Tab, Node>> menuGraphicFactoryProperty() {\n+        if (menuGraphicFactory == null) {\n+            menuGraphicFactory = new SimpleObjectProperty<>() {\n+                @Override\n+                public Object getBean() {\n+                    return TabPaneSkin.this;\n+                }\n+\n+                @Override\n+                public String getName() {\n+                    return \"menuGraphicFactory\";\n+                }\n+            };\n+        }\n+        return menuGraphicFactory;\n+    }\n+\n+    public final Function<Tab,Node> getMenuGraphicFactory() {\n+        return menuGraphicFactory == null ? null : menuGraphicFactory.get();\n+    }\n+\n+    public final void setMenuGraphicFactory(Function<Tab,Node> f) {\n+        menuGraphicFactoryProperty().set(f);\n+    }\n+\n@@ -479,7 +519,4 @@\n-    \/**\n-     * VERY HACKY - this lets us 'duplicate' Label and ImageView nodes to be used in a\n-     * Tab and the tabs menu at the same time.\n-     *\/\n-    private static Node clone(Node n) {\n-        if (n == null) {\n-            return null;\n+    private Node prepareGraphic(Tab t) {\n+        Function<Tab, Node> f = getMenuGraphicFactory();\n+        if (f != null) {\n+            return f.apply(t);\n@@ -487,2 +524,7 @@\n-        if (n instanceof ImageView) {\n-            ImageView iv = (ImageView) n;\n+\n+        Node n = t.getGraphic();\n+        return extractGraphic(n);\n+    }\n+\n+    private Node extractGraphic(Node n) {\n+        if (n instanceof ImageView v) {\n@@ -490,1 +532,1 @@\n-            imageview.imageProperty().bind(iv.imageProperty());\n+            imageview.imageProperty().bind(v.imageProperty());\n@@ -492,4 +534,2 @@\n-        }\n-        if (n instanceof Label) {\n-            Label l = (Label)n;\n-            Label label = new Label(l.getText(), clone(l.getGraphic()));\n+        } else if (n instanceof Label l) {\n+            Label label = new Label(l.getText(), extractGraphic(l.getGraphic()));\n@@ -498,0 +538,2 @@\n+        } else {\n+            return null;\n@@ -499,1 +541,0 @@\n-        return null;\n@@ -1503,1 +1544,0 @@\n-            getProperties().put(ContextMenu.class, tab.getContextMenu());\n@@ -1761,2 +1801,0 @@\n-            setupPopupMenu();\n-\n@@ -1824,1 +1862,0 @@\n-            getProperties().put(ContextMenu.class, popup);\n@@ -1922,1 +1959,2 @@\n-                TabMenuItem item = new TabMenuItem(tab);\n+                Node graphic = prepareGraphic(tab);\n+                TabMenuItem item = new TabMenuItem(tab, graphic);\n@@ -1938,0 +1976,3 @@\n+            if (popup == null) {\n+                setupPopupMenu();\n+            }\n@@ -1947,4 +1988,0 @@\n-    } \/* End TabControlButtons*\/\n-\n-    static class TabMenuItem extends RadioMenuItem {\n-        Tab tab;\n@@ -1952,3 +1989,3 @@\n-        private InvalidationListener disableListener = new InvalidationListener() {\n-            @Override public void invalidated(Observable o) {\n-                setDisable(tab.isDisable());\n+        private ContextMenu test_getTabsMenu() {\n+            if (popup == null) {\n+                setupPopupMenu();\n@@ -1956,1 +1993,3 @@\n-        };\n+            return popup;\n+        }\n+    } \/* End TabControlButtons*\/\n@@ -1958,2 +1997,3 @@\n-        private WeakInvalidationListener weakDisableListener =\n-                new WeakInvalidationListener(disableListener);\n+    \/** The MenuItem for use in the overflow menu *\/\n+    static class TabMenuItem extends RadioMenuItem {\n+        private Tab tab;\n@@ -1961,2 +2001,2 @@\n-        public TabMenuItem(final Tab tab) {\n-            super(tab.getText(), TabPaneSkin.clone(tab.getGraphic()));\n+        public TabMenuItem(Tab tab, Node graphic) {\n+            super(tab.getText(), graphic);\n@@ -1964,2 +2004,1 @@\n-            setDisable(tab.isDisable());\n-            tab.disableProperty().addListener(weakDisableListener);\n+            disableProperty().bind(tab.disableProperty());\n@@ -1973,0 +2012,1 @@\n+        \/\/ is this really necessary?\n@@ -1975,1 +2015,1 @@\n-            tab.disableProperty().removeListener(weakDisableListener);\n+            disableProperty().unbind();\n@@ -2341,1 +2381,1 @@\n-        return tabHeaderArea.controlButtons.popup;\n+        return tabHeaderArea.controlButtons.test_getTabsMenu();\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TabPaneSkin.java","additions":79,"deletions":39,"binary":false,"changes":118,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,0 +44,1 @@\n+import java.util.function.Function;\n@@ -58,0 +59,1 @@\n+import javafx.scene.Node;\n@@ -61,0 +63,1 @@\n+import javafx.scene.control.MenuItem;\n@@ -76,0 +79,1 @@\n+import javafx.scene.shape.Path;\n@@ -1341,0 +1345,45 @@\n+\n+    private ContextMenu setupMenuGraphicFactory() {\n+        TabPaneSkin skin = new TabPaneSkin(tabPane);\n+        skin.setMenuGraphicFactory(new Function<Tab, Node>() {\n+            @Override\n+            public Node apply(Tab t) {\n+                return new Path();\n+            }\n+        });\n+        tabPane.setSkin(skin);\n+\n+        tabPane.setMaxSize(20, 20);\n+        root.getChildren().add(tabPane);\n+        tabPane.getTabs().addAll(tab1, tab2, tab3);\n+        show();\n+        tk.firePulse();\n+\n+        ContextMenu menu = TabPaneSkinShim.getTabsMenu(skin);\n+        assertNotNull(menu);\n+        assertEquals(3, menu.getItems().size());\n+        return menu;\n+    }\n+\n+    @Test\n+    public void menuGraphicFactory() {\n+        ContextMenu menu = setupMenuGraphicFactory();\n+        for (MenuItem mi : menu.getItems()) {\n+            assertTrue(mi.getGraphic() instanceof Path);\n+        }\n+    }\n+\n+    @Test\n+    public void menuBindings() {\n+        ContextMenu menu = setupMenuGraphicFactory();\n+        MenuItem mi = menu.getItems().get(0);\n+\n+        assertFalse(mi.isDisable());\n+        assertEquals(\"one\", mi.getText());\n+\n+        tab1.setText(\"yo\");\n+        tab1.setDisable(true);\n+\n+        assertTrue(mi.isDisable());\n+        assertEquals(\"yo\", mi.getText());\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TabPaneTest.java","additions":50,"deletions":1,"binary":false,"changes":51,"status":"modified"}]}