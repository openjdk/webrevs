{"files":[{"patch":"@@ -111,12 +111,20 @@\n-        char *scale_str = getenv(\"GDK_SCALE\");\n-        int gdk_scale = (scale_str == NULL) ? -1 : atoi(scale_str);\n-        if (gdk_scale > 0) {\n-            uiScale = (jfloat) gdk_scale;\n-        } else {\n-            uiScale = (jfloat) glass_settings_get_guint_opt(\"org.gnome.desktop.interface\",\n-                                                            \"scaling-factor\", 0);\n-            if (uiScale < 1) {\n-                uiScale = (jfloat) (gdk_screen_get_resolution(screen) \/ DEFAULT_DPI);\n-            }\n-            if (uiScale < 1) {\n-                uiScale = 1;\n+        gdouble resolution = gdk_screen_get_resolution(screen);\n+        uiScale = (jfloat) (resolution \/ DEFAULT_DPI);\n+        if (int(resolution) == DEFAULT_DPI) {\n+            \/\/ These legacy settings should only be consulted if the DPI is\n+            \/\/ 96. They are global and affect all monitors and only allow\n+            \/\/ integers. And they are not reliable when scaling is\n+            \/\/ fractional. KDE in Ubuntu 22 sets GDK_SCALE to the floor of\n+            \/\/ the actual scaling factor. KDE in Ubuntu 24 sets the\n+            \/\/ Gnome \"scaling-factor\" instead. Both settings are obsolete in\n+            \/\/ their respective toolkits and are not trustworthy.\n+            char *scale_str = getenv(\"GDK_SCALE\");\n+            int gdk_scale = (scale_str == NULL) ? -1 : atoi(scale_str);\n+            if (gdk_scale > 0) {\n+                uiScale = (jfloat) gdk_scale;\n+            } else {\n+                guint gnome_scale = glass_settings_get_guint_opt(\"org.gnome.desktop.interface\",\n+                                                                 \"scaling-factor\", 0);\n+                if (gnome_scale > 0) {\n+                    uiScale = (jfloat) gnome_scale;\n+                }\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_screen.cpp","additions":20,"deletions":12,"binary":false,"changes":32,"status":"modified"}]}