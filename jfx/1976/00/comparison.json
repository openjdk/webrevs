{"files":[{"patch":"@@ -410,1 +410,0 @@\n-                            lineY,\n@@ -412,0 +411,1 @@\n+                            lineY,\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/text\/PrismTextLayout.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -50,1 +50,0 @@\n-import org.junit.jupiter.api.AfterEach;\n@@ -101,0 +100,70 @@\n+    \/\/ tests split caret with mixed text\n+    @Test\n+    public void testSplitCaret() {\n+        String s = \"Arabic:العربية:Arabic: العربية\";\n+        setText(s);\n+        waitForIdle();\n+\n+        CaretInfo c1;\n+        CaretInfo c2;\n+\n+        LayoutInfo la = textFlow.getLayoutInfo();\n+        c1 = la.caretInfoAt(0, true);\n+        assertEquals(1, c1.getSegmentCount());\n+        double h1 = c1.getSegmentAt(0).getHeight() * 0.25;\n+        double h3 = c1.getSegmentAt(0).getHeight() * 0.75;\n+\n+        \/\/ 6 leading x=64.9453125, y=0.0, h=28.265625\n+        \/\/ 6 trailing x=70.1015625, y=0.0, h=14.1328125 + x=130.44143676757812, y=14.1328125, h=14.1328125\n+        c1 = la.caretInfoAt(6, true);\n+        c2 = la.caretInfoAt(6, false);\n+        assertEquals(1, c1.getSegmentCount());\n+        assertTrue(c1.getSegmentAt(0).getHeight() > h3);\n+        assertEquals(2, c2.getSegmentCount());\n+        assertTrue(c2.getSegmentAt(0).getHeight() < h3);\n+        assertTrue(c2.getSegmentAt(0).getMinY() < h1);\n+        assertTrue(c2.getSegmentAt(1).getHeight() < h3);\n+        assertTrue(c2.getSegmentAt(1).getMinY() > h1);\n+        assertTrue(c2.getSegmentAt(0).getMinX() < c2.getSegmentAt(1).getMinX());\n+\n+        \/\/ 7 leading x=130.44143676757812, y=0.0, h=14.1328125 + x=70.1015625, y=14.1328125, h=14.1328125\n+        \/\/ 7 trailing x=124.7748794555664, y=0.0, h=28.265625\n+        c1 = la.caretInfoAt(7, true);\n+        assertEquals(2, c1.getSegmentCount());\n+        assertTrue(Util.isNear(c2.getSegmentAt(1).getMinX(), c1.getSegmentAt(0).getMinX()));\n+        assertTrue(c1.getSegmentAt(0).getMinY() < c2.getSegmentAt(1).getMinY());\n+\n+        c2 = la.caretInfoAt(7, false);\n+        assertTrue(c1.getSegmentAt(0).getHeight() < h3);\n+        assertTrue(c1.getSegmentAt(0).getMinY() < h1);\n+        assertTrue(c1.getSegmentAt(1).getHeight() < h3);\n+        assertTrue(c1.getSegmentAt(1).getMinY() > h1);\n+        assertTrue(c1.getSegmentAt(0).getMinX() > c1.getSegmentAt(1).getMinX());\n+        assertEquals(1, c2.getSegmentCount());\n+        assertTrue(c2.getSegmentAt(0).getHeight() > h3);\n+\n+        \/** if we ever need to debug this again\n+        for(int i=0; i<s.length(); i++) {\n+            CaretInfo c = la.caretInfoAt(i, true);\n+            System.out.println(i + \" leading \" + f(c));\n+            c = la.caretInfoAt(i, false);\n+            System.out.println(i + \" trailing \" + f(c));\n+        }\n+        *\/\n+    }\n+\n+    private static String f(CaretInfo c) {\n+        if(c.getSegmentCount() == 2) {\n+            Rectangle2D r0 = c.getSegmentAt(0);\n+            Rectangle2D r1 = c.getSegmentAt(1);\n+            return\n+                \"x=\" + r0.getMinX() + \", y=\" + r0.getMinY() + \", h=\" + r0.getHeight() +\n+                \" + \" +\n+                \"x=\" + r1.getMinX() + \", y=\" + r1.getMinY() + \", h=\" + r1.getHeight();\n+        } else {\n+            Rectangle2D r0 = c.getSegmentAt(0);\n+            return\n+                \"x=\" + r0.getMinX() + \", y=\" + r0.getMinY() + \", h=\" + r0.getHeight();\n+        }\n+    }\n+\n","filename":"tests\/system\/src\/test\/java\/test\/robot\/javafx\/scene\/TextFlow_TextLayout_Test.java","additions":70,"deletions":1,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -46,1 +46,0 @@\n-import javafx.scene.text.TextFlow;\n@@ -51,1 +50,0 @@\n-import org.junit.jupiter.api.AfterEach;\n@@ -53,1 +51,0 @@\n-import org.junit.jupiter.api.BeforeEach;\n@@ -103,0 +100,70 @@\n+    \/\/ tests split caret with mixed text\n+    @Test\n+    public void testSplitCaret() {\n+        String s = \"Arabic:العربية:Arabic: العربية\";\n+        setText(s);\n+        waitForIdle();\n+\n+        CaretInfo c1;\n+        CaretInfo c2;\n+\n+        LayoutInfo la = text.getLayoutInfo();\n+        c1 = la.caretInfoAt(0, true);\n+        assertEquals(1, c1.getSegmentCount());\n+        double h1 = c1.getSegmentAt(0).getHeight() * 0.25;\n+        double h3 = c1.getSegmentAt(0).getHeight() * 0.75;\n+\n+        \/\/ 6 leading x=64.9453125, y=0.0, h=28.265625\n+        \/\/ 6 trailing x=70.1015625, y=0.0, h=14.1328125 + x=130.44143676757812, y=14.1328125, h=14.1328125\n+        c1 = la.caretInfoAt(6, true);\n+        c2 = la.caretInfoAt(6, false);\n+        assertEquals(1, c1.getSegmentCount());\n+        assertTrue(c1.getSegmentAt(0).getHeight() > h3);\n+        assertEquals(2, c2.getSegmentCount());\n+        assertTrue(c2.getSegmentAt(0).getHeight() < h3);\n+        assertTrue(c2.getSegmentAt(0).getMinY() < h1);\n+        assertTrue(c2.getSegmentAt(1).getHeight() < h3);\n+        assertTrue(c2.getSegmentAt(1).getMinY() > h1);\n+        assertTrue(c2.getSegmentAt(0).getMinX() < c2.getSegmentAt(1).getMinX());\n+\n+        \/\/ 7 leading x=130.44143676757812, y=0.0, h=14.1328125 + x=70.1015625, y=14.1328125, h=14.1328125\n+        \/\/ 7 trailing x=124.7748794555664, y=0.0, h=28.265625\n+        c1 = la.caretInfoAt(7, true);\n+        assertEquals(2, c1.getSegmentCount());\n+        assertTrue(Util.isNear(c2.getSegmentAt(1).getMinX(), c1.getSegmentAt(0).getMinX()));\n+        assertTrue(c1.getSegmentAt(0).getMinY() < c2.getSegmentAt(1).getMinY());\n+\n+        c2 = la.caretInfoAt(7, false);\n+        assertTrue(c1.getSegmentAt(0).getHeight() < h3);\n+        assertTrue(c1.getSegmentAt(0).getMinY() < h1);\n+        assertTrue(c1.getSegmentAt(1).getHeight() < h3);\n+        assertTrue(c1.getSegmentAt(1).getMinY() > h1);\n+        assertTrue(c1.getSegmentAt(0).getMinX() > c1.getSegmentAt(1).getMinX());\n+        assertEquals(1, c2.getSegmentCount());\n+        assertTrue(c2.getSegmentAt(0).getHeight() > h3);\n+\n+        \/** if we ever need to debug this again\n+        for(int i=0; i<s.length(); i++) {\n+            CaretInfo c = la.caretInfoAt(i, true);\n+            System.out.println(i + \" leading \" + f(c));\n+            c = la.caretInfoAt(i, false);\n+            System.out.println(i + \" trailing \" + f(c));\n+        }\n+        *\/\n+    }\n+\n+    private static String f(CaretInfo c) {\n+        if(c.getSegmentCount() == 2) {\n+            Rectangle2D r0 = c.getSegmentAt(0);\n+            Rectangle2D r1 = c.getSegmentAt(1);\n+            return\n+                \"x=\" + r0.getMinX() + \", y=\" + r0.getMinY() + \", h=\" + r0.getHeight() +\n+                \" + \" +\n+                \"x=\" + r1.getMinX() + \", y=\" + r1.getMinY() + \", h=\" + r1.getHeight();\n+        } else {\n+            Rectangle2D r0 = c.getSegmentAt(0);\n+            return\n+                \"x=\" + r0.getMinX() + \", y=\" + r0.getMinY() + \", h=\" + r0.getHeight();\n+        }\n+    }\n+\n","filename":"tests\/system\/src\/test\/java\/test\/robot\/javafx\/scene\/Text_TextLayout_Test.java","additions":70,"deletions":3,"binary":false,"changes":73,"status":"modified"},{"patch":"@@ -456,0 +456,11 @@\n+\n+    \/**\n+     * Returns true if two pixel values are \"near\", i.e. the distance between them is less than\n+     * an arbitrarily chosen constant (0.1).\n+     * @param a the first coordinate\n+     * @param b the second coordinate\n+     * @return true if two coordinates are near\n+     *\/\n+    public static boolean isNear(double a, double b) {\n+        return Math.abs(a - b) < 0.1;\n+    }\n","filename":"tests\/system\/src\/test\/java\/test\/util\/Util.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"}]}