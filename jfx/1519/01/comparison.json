{"files":[{"patch":"@@ -65,2 +65,0 @@\n-    private final Element<E> tempElement = new Element<>(null, -1);\n-\n@@ -301,1 +299,6 @@\n-            return comparator.compare(o1.e, o2.e);\n+            int result = comparator.compare(o1.e, o2.e);\n+            if (result != 0) {\n+                return result;\n+            } else {\n+                return Integer.compare(o1.index, o2.index);\n+            }\n@@ -328,1 +331,1 @@\n-    private int findPosition(E e) {\n+    private int findPosition(Element<E> element) {\n@@ -332,3 +335,1 @@\n-        tempElement.e = e;\n-        int pos = Arrays.binarySearch(sorted, 0, size, tempElement, elementComparator);\n-        return pos;\n+        return Arrays.binarySearch(sorted, 0, size, element, elementComparator);\n@@ -338,1 +339,2 @@\n-        int pos = findPosition(e);\n+        Element<E> newElement = new Element<>(e, idx);\n+        int pos = findPosition(newElement);\n@@ -345,1 +347,1 @@\n-        sorted[pos] = new Element<>(e, idx);\n+        sorted[pos] = newElement;\n","filename":"modules\/javafx.base\/src\/main\/java\/javafx\/collections\/transformation\/SortedList.java","additions":11,"deletions":9,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -612,0 +612,22 @@\n+\n+    @Test\n+    public void testSortingMaintainsInsertionOrderForEqualElements() {\n+        ObservableList<Person> list = FXCollections.observableArrayList();\n+\n+        Person p1 = new Person(\"a\");\n+        Person p2 = new Person(\"b\");\n+        Person p3 = new Person(\"a\");\n+\n+        list.addAll(p2, p1);\n+        \/\/ After adding p2 and p1, list= [p2, p1], sorted list= [p1, p2]\n+        SortedList<Person> sorted = new SortedList<>(list, Comparator.comparing(p -> p.name.get()));\n+\n+        list.add(p3);\n+        \/\/ After adding p3, list= [p2, p1, p3]\n+        \/\/ p1 and p3 have equal names, but p3 was added after p1, so p3 should come after p1 in the sorted list\n+        \/\/ Expected sorted list= [p1, p3, p2]\n+\n+        assertSame(sorted.get(0), p1);\n+        assertSame(sorted.get(1), p3);\n+        assertSame(sorted.get(2), p2);\n+    }\n","filename":"modules\/javafx.base\/src\/test\/java\/test\/javafx\/collections\/SortedListTest.java","additions":22,"deletions":0,"binary":false,"changes":22,"status":"modified"}]}