{"files":[{"patch":"@@ -149,4 +149,0 @@\n-\n-            if (ax == bx) {\n-                return ay;\n-            }\n@@ -160,4 +156,0 @@\n-\n-            if (ax == bx) {\n-                return by;\n-            }\n@@ -197,3 +189,5 @@\n-        \/\/ Linearly interpolate (or extrapolate) along the segment (ax, ay) -> (bx, by).\n-        if (ax == bx) {\n-            \/\/ Degenerate segment; just treat as a step.\n+        double dx = bx - ax;\n+        double dy = by - ay;\n+\n+        \/\/ Degenerate vertical segment -> step\n+        if (dx == 0) {\n@@ -203,2 +197,18 @@\n-        double proportion = (t - ax) \/ (bx - ax);\n-        return ay + (by - ay) * proportion;\n+        \/\/ Horizontal segment -> constant, avoids 0 * inf NaN\n+        if (dy == 0) {\n+            return ay;\n+        }\n+\n+        \/\/ Linearly interpolate (or extrapolate) along the segment (ax, ay) -> (bx, by).\n+        double proportion = (t - ax) \/ dx;\n+        if (Double.isFinite(proportion)) {\n+            return ay + dy * proportion;\n+        }\n+\n+        \/\/ In case we overflow\/underflow to infinity, we return the signed infinity consistent with the line.\n+        double sign =\n+            Math.signum(dy)       \/\/ tells us whether we are extrapolating left or right of A\n+            * Math.signum(t - ax) \/\/ tells us the direction from A to B\n+            * Math.signum(dx);    \/\/ tells us whether the line goes up or down\n+\n+        return sign >= 0 ? Double.POSITIVE_INFINITY : Double.NEGATIVE_INFINITY;\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/scenario\/animation\/LinearInterpolator.java","additions":23,"deletions":13,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-import java.lang.reflect.Field;\n+import test.javafx.util.ReflectionUtils;\n@@ -38,10 +38,0 @@\n-    private static double[] getControlPoints(LinearInterpolator li) {\n-        try {\n-            Field f = LinearInterpolator.class.getDeclaredField(\"controlPoints\");\n-            f.setAccessible(true);\n-            return (double[]) f.get(li);\n-        } catch (ReflectiveOperationException e) {\n-            throw new AssertionError(e);\n-        }\n-    }\n-\n@@ -67,7 +57,7 @@\n-            double[] cp = getControlPoints(interpolator);\n-\n-            \/\/ [x0, y0, x1, y1]\n-            assertEquals(0.0, cp[0]); \/\/ first x -> 0\n-            assertEquals(0.2, cp[1], 1e-9);\n-            assertEquals(1.0, cp[2]); \/\/ last x -> 1\n-            assertEquals(0.8, cp[3], 1e-9);\n+            assertArrayEquals(\n+                new double[] {\n+                    0.0, 0.2, \/\/ first x: 0\n+                    1.0, 0.8 \/\/ last x: 1\n+                },\n+                ReflectionUtils.getFieldValue(interpolator, \"controlPoints\"),\n+                1e-9);\n@@ -79,1 +69,1 @@\n-            LinearInterpolator li = new LinearInterpolator(new Point2D[] {\n+            LinearInterpolator interpolator = new LinearInterpolator(new Point2D[] {\n@@ -91,1 +81,2 @@\n-                getControlPoints(li), 1e-9);\n+                ReflectionUtils.getFieldValue(interpolator, \"controlPoints\"),\n+                1e-9);\n@@ -105,1 +96,2 @@\n-                getControlPoints(interpolator), 1e-9);\n+                ReflectionUtils.getFieldValue(interpolator, \"controlPoints\"),\n+                1e-9);\n@@ -128,1 +120,3 @@\n-                }, getControlPoints(interpolator), 1e-9);\n+                },\n+                ReflectionUtils.getFieldValue(interpolator, \"controlPoints\"),\n+                1e-9);\n@@ -159,1 +153,3 @@\n-                }, getControlPoints(interpolator), 1e-9);\n+                },\n+                ReflectionUtils.getFieldValue(interpolator, \"controlPoints\"),\n+                1e-9);\n@@ -249,0 +245,12 @@\n+\n+        @Test\n+        void curveHandlesNumericOverflowToInfinity() {\n+            var interpolator = new LinearInterpolator(new Point2D[] {\n+                new Point2D(0, 0.5),\n+                new Point2D(9e-310, 1)\n+            });\n+\n+            assertEquals(0.5, interpolator.curve(0));\n+            assertEquals(Double.POSITIVE_INFINITY, interpolator.curve(0.5));\n+            assertEquals(Double.NEGATIVE_INFINITY, interpolator.curve(-0.5));\n+        }\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/com\/sun\/scenario\/animation\/LinearInterpolatorTest.java","additions":31,"deletions":23,"binary":false,"changes":54,"status":"modified"}]}