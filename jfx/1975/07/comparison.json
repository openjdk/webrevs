{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,0 +40,1 @@\n+import javafx.scene.text.Text;\n@@ -60,0 +61,1 @@\n+    private boolean embedsNode;\n@@ -65,0 +67,1 @@\n+     * @param embedsNode whether the content is a paragraph\n@@ -66,1 +69,1 @@\n-    public TextCell(int index, Region content) {\n+    public TextCell(int index, Region content, boolean embedsNode) {\n@@ -70,0 +73,1 @@\n+        this.embedsNode = embedsNode;\n@@ -79,1 +83,1 @@\n-        this(index, textFlow());\n+        this(index, textFlow(), false);\n@@ -97,1 +101,1 @@\n-     * Adds a node to the text flow.\n+     * Adds a non-text node to the text flow.\n@@ -102,0 +106,9 @@\n+        embedsNode = true;\n+    }\n+\n+    \/**\n+     * Adds a text segment to the text flow.\n+     * @param t the text segment\n+     *\/\n+    public void addTextSegment(Text t) {\n+        flow().getChildren().add(t);\n@@ -461,0 +474,12 @@\n+\n+    @Override\n+    public void requestLayout() {\n+        super.requestLayout();\n+\n+        if (embedsNode) {\n+            VFlow vf = RichUtils.getParentOfClass(VFlow.class, this);\n+            if (vf != null) {\n+                vf.requestLayout();\n+            }\n+        }\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/TextCell.java","additions":29,"deletions":4,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -790,1 +790,1 @@\n-            cell = new TextCell(index, content);\n+            cell = new TextCell(index, content, true);\n@@ -816,1 +816,1 @@\n-                cell.add(createTextNode(\"\", StyleAttributeMap.EMPTY));\n+                cell.addTextSegment(createTextNode(\"\", StyleAttributeMap.EMPTY));\n@@ -829,1 +829,1 @@\n-                        cell.add(t);\n+                        cell.addTextSegment(t);\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/VFlow.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2023, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -744,0 +744,15 @@\n+\n+    \/\/ borrowed from\n+    \/\/ https:\/\/github.com\/andy-goryachev\/AppFramework\/blob\/1e9f2197ce510a77ec5f719a2cb7112b0b6cf7be\/src\/goryachev\/fx\/FX.java#L1081\n+    \/\/ with the author's permission\n+    \/** returns a parent of the specified type, or null.  if node is an instance of the specified class, returns node *\/\n+    public static <T extends Node> T getParentOfClass(Class<T> c, Node node) {\n+        while (node != null) {\n+            if (c.isInstance(node)) {\n+                return (T)node;\n+            }\n+\n+            node = node.getParent();\n+        }\n+        return null;\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/util\/RichUtils.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -39,0 +39,1 @@\n+import javafx.beans.property.SimpleDoubleProperty;\n@@ -53,0 +54,1 @@\n+import javafx.scene.layout.Region;\n@@ -70,0 +72,1 @@\n+import jfx.incubator.scene.control.richtext.model.SimpleViewOnlyStyledModel;\n@@ -988,0 +991,31 @@\n+    @Test\n+    public void withEmbeddedNodes() {\n+        class ARegion extends Region {\n+            public ARegion(SimpleDoubleProperty height) {\n+                setPrefWidth(10);\n+                minHeightProperty().bind(height);\n+                maxHeightProperty().bind(height);\n+            }\n+        }\n+\n+        SimpleDoubleProperty height = new SimpleDoubleProperty(10.0);\n+        SimpleViewOnlyStyledModel m = new SimpleViewOnlyStyledModel();\n+        m.addSegment(\"Trailing node: \");\n+        m.addNodeSegment(() -> new ARegion(height));\n+        m.addParagraph(() -> new ARegion(height));\n+        control.setModel(m);\n+        control.setWrapText(false);\n+        control.setUseContentHeight(true);\n+        control.layout();\n+\n+        double h1 = control.prefHeight(-1);\n+        control.getHeight();\n+\n+        height.set(100.0);\n+        control.layout();\n+\n+        double h2 = control.prefHeight(-1);\n+        control.getHeight();\n+        assertTrue(h1 != h2, \"heights should differ: h1=\" + h1 + \" h2=\" + h2);\n+    }\n+\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/RichTextAreaTest.java","additions":34,"deletions":0,"binary":false,"changes":34,"status":"modified"}]}