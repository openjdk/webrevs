{"files":[{"patch":"@@ -60,0 +60,1 @@\n+    private boolean embedsNode;\n@@ -65,0 +66,1 @@\n+     * @param embedsNode whether the content is a paragraph\n@@ -66,1 +68,1 @@\n-    public TextCell(int index, Region content) {\n+    public TextCell(int index, Region content, boolean embedsNode) {\n@@ -70,0 +72,1 @@\n+        this.embedsNode = embedsNode;\n@@ -79,1 +82,1 @@\n-        this(index, textFlow());\n+        this(index, textFlow(), false);\n@@ -102,0 +105,1 @@\n+        embedsNode = true;\n@@ -461,0 +465,12 @@\n+\n+    @Override\n+    public void requestLayout() {\n+        super.requestLayout();\n+\n+        if (embedsNode) {\n+            VFlow vf = RichUtils.getAncestorOfClass(VFlow.class, this);\n+            if (vf != null) {\n+                vf.requestLayout();\n+            }\n+        }\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/TextCell.java","additions":18,"deletions":2,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -790,1 +790,1 @@\n-            cell = new TextCell(index, content);\n+            cell = new TextCell(index, content, true);\n@@ -1720,0 +1720,3 @@\n+        if (ci == null) {\n+            return new Point2D(0, 0);\n+        }\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/VFlow.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -65,0 +65,2 @@\n+import javafx.stage.Stage;\n+import javafx.stage.Window;\n@@ -744,0 +746,33 @@\n+\n+    \/\/ borrowed from\n+    \/\/ https:\/\/github.com\/andy-goryachev\/AppFramework\/blob\/1e9f2197ce510a77ec5f719a2cb7112b0b6cf7be\/src\/goryachev\/fx\/FX.java#L1081\n+    \/\/ with the author's permission\n+    \/** returns a parent of the specified type, or null.  if node is an instance of the specified class, returns node *\/\n+    public static <T> T getAncestorOfClass(Class<T> c, Node node) {\n+        if (Window.class.isAssignableFrom(c)) {\n+            Scene sc = node.getScene();\n+            if (sc != null) {\n+                Window w = sc.getWindow();\n+                while (w != null) {\n+                    if (w.getClass().isAssignableFrom(c)) {\n+                        return (T)w;\n+                    }\n+\n+                    \/\/ the window can be a dialog, check the owner\n+                    if (w instanceof Stage stage) {\n+                        w = stage.getOwner();\n+                    }\n+                }\n+            }\n+            return null;\n+        } else {\n+            while (node != null) {\n+                if (c.isInstance(node)) {\n+                    return (T)node;\n+                }\n+\n+                node = node.getParent();\n+            }\n+        }\n+        return null;\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/main\/java\/com\/sun\/jfx\/incubator\/scene\/control\/richtext\/util\/RichUtils.java","additions":35,"deletions":0,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -39,0 +39,1 @@\n+import javafx.beans.property.SimpleDoubleProperty;\n@@ -51,0 +52,1 @@\n+import javafx.scene.layout.Region;\n@@ -66,0 +68,1 @@\n+import jfx.incubator.scene.control.richtext.model.SimpleViewOnlyStyledModel;\n@@ -950,0 +953,27 @@\n+\n+    @Test\n+    public void withEmbeddedNode() {\n+        SimpleDoubleProperty height = new SimpleDoubleProperty(10.0);\n+        SimpleViewOnlyStyledModel m = new SimpleViewOnlyStyledModel();\n+        m.addSegment(\"Trailing node: \");\n+        m.addNodeSegment(() -> {\n+            Region r = new Region();\n+            r.setPrefWidth(10);\n+            r.minHeightProperty().bind(height);\n+            r.maxHeightProperty().bind(height);\n+            return r;\n+        });\n+        control.setModel(m);\n+        control.setWrapText(false);\n+        control.setUseContentHeight(true);\n+        control.layout();\n+\n+        double h1 = control.prefHeight(-1);\n+        control.getHeight();\n+        height.set(100.0);\n+        control.layout();\n+\n+        double h2 = control.prefHeight(-1);\n+        control.getHeight();\n+        assertTrue(h1 != h2);\n+    }\n","filename":"modules\/jfx.incubator.richtext\/src\/test\/java\/test\/jfx\/incubator\/scene\/control\/richtext\/RichTextAreaTest.java","additions":30,"deletions":0,"binary":false,"changes":30,"status":"modified"}]}