{"files":[{"patch":"@@ -56,1 +56,0 @@\n-    unichar insertTextChar;\n@@ -58,0 +57,5 @@\n+\n+    \/\/ These fields track state for the Keyman input method.\n+    BOOL keymanActive;\n+    BOOL sendKeyEvent;\n+    unichar insertTextChar;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassView3D.h","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -250,1 +250,0 @@\n-        self->insertTextChar = 0;\n@@ -253,0 +252,4 @@\n+\n+        keymanActive = NO;\n+        sendKeyEvent = NO;\n+        insertTextChar = 0;\n@@ -517,0 +520,8 @@\n+\n+    \/\/ The Keyman input method expects us to ignore key events that don't lead\n+    \/\/ to NSTextInputClient calls. For Keyman the NSEvent refers to some\n+    \/\/ internal Roman layout and not the chosen Keyman layout. The correct\n+    \/\/ Keyman character will be passed to insertText. We detect this input\n+    \/\/ method using the same method as AWT.\n+    keymanActive = [self.inputContext.selectedKeyboardInputSource containsString: @\"keyman\"];\n+    sendKeyEvent = NO;\n@@ -518,0 +529,1 @@\n+\n@@ -535,0 +547,10 @@\n+    }\n+    else if (keymanActive) {\n+        \/\/ We do not call registerKeyEvent: for keyman which means shortcuts\n+        \/\/ based on symbols and punctuation (like Cmd++) will not work\n+        \/\/ correctly. We don't see changes to the Keyman layout so\n+        \/\/ registerKeyEvent: would accumulate stale information. Keyman does\n+        \/\/ not set marked text so we don't need to check nsAttrBuffer.\n+        if (sendKeyEvent) {\n+            wasConsumed = [self->_delegate sendJavaKeyEvent:theEvent isDown:YES character:insertTextChar];\n+        }\n@@ -537,1 +559,1 @@\n-        wasConsumed = [self->_delegate sendJavaKeyEvent:theEvent isDown:YES character:insertTextChar];\n+        wasConsumed = [self->_delegate sendJavaKeyEvent:theEvent isDown:YES character:0];\n@@ -540,0 +562,2 @@\n+    keymanActive = NO;\n+\n@@ -771,1 +795,1 @@\n-- (void)commitString:(NSString*)aString\n+- (void)commitString:(id)aString\n@@ -782,0 +806,3 @@\n+    if (keymanActive) {\n+        sendKeyEvent = YES;\n+    }\n@@ -792,5 +819,1 @@\n-    \/\/ The Keyman input method sends different characters to keyDown than to\n-    \/\/ insertText. If the layout is Hebrew the NSEvent sent to keyDown will\n-    \/\/ contain Roman characters but Hebrew will be sent to insertText. Like\n-    \/\/ AWT we special-case this layout.\n-    if ([self.inputContext.selectedKeyboardInputSource containsString: @\"keyman\"]) {\n+    if (keymanActive) {\n@@ -799,1 +822,2 @@\n-            \/\/ Longer strings are sent out above as commits.\n+            \/\/ A longer string would be sent out above as an InputMethod\n+            \/\/ commit rather than a multi-unit KeyEvent.\n@@ -801,1 +825,2 @@\n-                self->insertTextChar = [nsString characterAtIndex: 0];\n+                insertTextChar = [nsString characterAtIndex: 0];\n+                sendKeyEvent = YES;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassView3D.m","additions":35,"deletions":10,"binary":false,"changes":45,"status":"modified"}]}