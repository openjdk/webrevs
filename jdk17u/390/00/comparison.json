{"files":[{"patch":"@@ -24,19 +24,0 @@\n-\/*\n- * @test\n- * @summary Basic test for ofFileDownload\n- * @bug 8196965 8302475\n- * @modules java.base\/sun.net.www.http\n- *          java.net.http\/jdk.internal.net.http.common\n- *          java.net.http\/jdk.internal.net.http.frame\n- *          java.net.http\/jdk.internal.net.http.hpack\n- *          java.logging\n- *          jdk.httpserver\n- * @library \/test\/lib http2\/server\n- * @build Http2TestServer\n- * @build jdk.test.lib.net.SimpleSSLContext\n- * @build jdk.test.lib.Platform\n- * @build jdk.test.lib.util.FileUtils\n- * @run testng\/othervm AsFileDownloadTest\n- * @run testng\/othervm\/java.security.policy=AsFileDownloadTest.policy AsFileDownloadTest\n- *\/\n-\n@@ -84,0 +65,19 @@\n+\/*\n+ * @test\n+ * @summary Basic test for ofFileDownload\n+ * @bug 8196965 8302475\n+ * @modules java.base\/sun.net.www.http\n+ *          java.net.http\/jdk.internal.net.http.common\n+ *          java.net.http\/jdk.internal.net.http.frame\n+ *          java.net.http\/jdk.internal.net.http.hpack\n+ *          java.logging\n+ *          jdk.httpserver\n+ * @library \/test\/lib http2\/server\n+ * @build Http2TestServer\n+ * @build jdk.test.lib.net.SimpleSSLContext\n+ * @build jdk.test.lib.Platform\n+ * @build jdk.test.lib.util.FileUtils\n+ * @run testng\/othervm AsFileDownloadTest\n+ * @run testng\/othervm\/java.security.policy=AsFileDownloadTest.policy AsFileDownloadTest\n+ *\/\n+\n@@ -270,2 +270,4 @@\n-        return InetAddress.getLoopbackAddress().getHostName() + \":\"\n-                + server.getAddress().getPort();\n+        final String hostIP = InetAddress.getLoopbackAddress().getHostAddress();\n+        \/\/ escape for ipv6\n+        final String h = hostIP.contains(\":\") ? \"[\" + hostIP + \"]\" : hostIP;\n+        return h + \":\" + server.getAddress().getPort();\n","filename":"test\/jdk\/java\/net\/httpclient\/AsFileDownloadTest.java","additions":23,"deletions":21,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -37,1 +37,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n@@ -45,4 +46,9 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/afdt\",   \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/afdt\", \"POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/afdt\",   \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/afdt\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/afdt\",   \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/afdt\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/afdt\",   \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/afdt\", \"POST\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/afdt\",   \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/afdt\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/afdt\",   \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/afdt\", \"POST\";\n@@ -61,1 +67,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/AsFileDownloadTest.policy","additions":13,"deletions":6,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -37,1 +37,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n@@ -42,8 +43,17 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/http1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"GET\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"GET\";\n@@ -72,1 +82,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/FilePublisher\/FilePublisherPermsTest1.policy","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -39,1 +39,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n@@ -44,8 +45,17 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/http1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"GET\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"GET\";\n@@ -77,1 +87,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/FilePublisher\/FilePublisherPermsTest2.policy","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -44,1 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n@@ -49,8 +50,17 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/http1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"GET\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"GET\";\n@@ -80,1 +90,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/FilePublisher\/FilePublisherPermsTest3.policy","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -37,1 +37,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n@@ -42,8 +43,17 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/http1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"GET\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"GET\";\n@@ -65,1 +75,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/FilePublisher\/FilePublisherTest.policy","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -533,2 +533,9 @@\n-            return InetAddress.getLoopbackAddress().getHostName() + \":\"\n-                    + getAddress().getPort();\n+            InetSocketAddress address = getAddress();\n+            String hostString = address.getHostString();\n+            hostString = address.getAddress().isLoopbackAddress() || hostString.equals(\"localhost\")\n+                    ? address.getAddress().getHostAddress() \/\/ use the raw IP address, if loopback\n+                    : hostString; \/\/ use whatever host string was used to construct the address\n+            hostString = hostString.contains(\":\")\n+                    ? \"[\" + hostString + \"]\"\n+                    : hostString;\n+            return hostString + \":\" + address.getPort();\n","filename":"test\/jdk\/java\/net\/httpclient\/HttpServerAdapters.java","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -122,2 +122,2 @@\n-        httproot = \"http:\/\/localhost:\" + port + \"\/\";\n-        httpsroot = \"https:\/\/localhost:\" + httpsport + \"\/\";\n+        httproot = \"http:\/\/\" + makeServerAuthority(httpServer.getAddress()) + \"\/\";\n+        httpsroot = \"https:\/\/\" + makeServerAuthority(httpsServer.getAddress()) + \"\/\";\n@@ -130,0 +130,7 @@\n+    private static String makeServerAuthority(final InetSocketAddress addr) {\n+        final String hostIP = addr.getAddress().getHostAddress();\n+        \/\/ escape for ipv6\n+        final String h = hostIP.contains(\":\") ? \"[\" + hostIP + \"]\" : hostIP;\n+        return h + \":\" + addr.getPort();\n+    }\n+\n","filename":"test\/jdk\/java\/net\/httpclient\/LightWeightHttpServer.java","additions":10,"deletions":3,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -48,1 +48,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n@@ -53,8 +54,17 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/http1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"GET\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"GET\";\n@@ -80,1 +90,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/PathSubscriber\/ofFile.policy","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -48,1 +48,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n@@ -53,8 +54,17 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/http1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/echo\", \"GET\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/echo\", \"GET\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/echo\", \"GET\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/http1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/echo\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/echo\", \"GET\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/echo\", \"GET\";\n@@ -77,1 +87,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/PathSubscriber\/ofFileDownload.policy","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -24,18 +24,0 @@\n-\/*\n- * @test\n- * @bug 8087112\n- * @modules java.net.http\n- *          java.logging\n- *          jdk.httpserver\n- * @library \/test\/lib\n- * @compile ..\/..\/..\/com\/sun\/net\/httpserver\/LogFilter.java\n- * @compile ..\/..\/..\/com\/sun\/net\/httpserver\/EchoHandler.java\n- * @compile ..\/..\/..\/com\/sun\/net\/httpserver\/FileServerHandler.java\n- * @build jdk.test.lib.net.SimpleSSLContext\n- * @build LightWeightHttpServer\n- * @build jdk.test.lib.Platform\n- * @build jdk.test.lib.util.FileUtils\n- * @run testng\/othervm RequestBodyTest\n- * @run testng\/othervm\/java.security.policy=RequestBodyTest.policy RequestBodyTest\n- *\/\n-\n@@ -77,0 +59,17 @@\n+\/*\n+ * @test\n+ * @bug 8087112\n+ * @modules java.net.http\n+ *          java.logging\n+ *          jdk.httpserver\n+ * @library \/test\/lib\n+ * @compile ..\/..\/..\/com\/sun\/net\/httpserver\/LogFilter.java\n+ * @compile ..\/..\/..\/com\/sun\/net\/httpserver\/EchoHandler.java\n+ * @compile ..\/..\/..\/com\/sun\/net\/httpserver\/FileServerHandler.java\n+ * @build jdk.test.lib.net.SimpleSSLContext\n+ * @build LightWeightHttpServer\n+ * @build jdk.test.lib.Platform\n+ * @build jdk.test.lib.util.FileUtils\n+ * @run testng\/othervm RequestBodyTest\n+ * @run testng\/othervm\/java.security.policy=RequestBodyTest.policy RequestBodyTest\n+ *\/\n","filename":"test\/jdk\/java\/net\/httpclient\/RequestBodyTest.java","additions":17,"deletions":18,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,2 +41,4 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/echo\/foo\",   \"POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/echo\/foo\",  \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/echo\/foo\",   \"POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/echo\/foo\",  \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/echo\/foo\",   \"POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/echo\/foo\",  \"POST\";\n@@ -48,1 +50,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/RequestBodyTest.policy","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -37,1 +37,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"listen,accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"listen,accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"listen,accept,resolve\";\n@@ -45,5 +46,9 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http1\/-\",   \"GET,POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https1\/-\", \"GET,POST\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/http2\/-\",   \"GET,POST\";\n-    permission java.net.URLPermission \"https:\/\/localhost:*\/https2\/-\", \"GET,POST\";\n-\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http1\/-\",   \"GET,POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https1\/-\", \"GET,POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/http2\/-\",   \"GET,POST\";\n+    permission java.net.URLPermission \"https:\/\/127.0.0.1:*\/https2\/-\", \"GET,POST\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http1\/-\",   \"GET,POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https1\/-\", \"GET,POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/http2\/-\",   \"GET,POST\";\n+    permission java.net.URLPermission \"https:\/\/[::1]:*\/https2\/-\", \"GET,POST\";\n@@ -61,1 +66,2 @@\n-    permission java.net.SocketPermission \"localhost:*\", \"listen,accept,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:*\", \"listen,accept,resolve\";\n+    permission java.net.SocketPermission \"[::1]:*\", \"listen,accept,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/dependent.policy","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -84,2 +84,5 @@\n-        return InetAddress.getLoopbackAddress().getHostName() + \":\"\n-                + getAddress().getPort();\n+        final InetSocketAddress inetSockAddr = getAddress();\n+        final String hostIP = inetSockAddr.getAddress().getHostAddress();\n+        \/\/ escape for ipv6\n+        final String h = hostIP.contains(\":\") ? \"[\" + hostIP + \"]\" : hostIP;\n+        return h + \":\" + inetSockAddr.getPort();\n","filename":"test\/jdk\/java\/net\/httpclient\/http2\/server\/Http2TestServer.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -42,2 +43,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/0.policy","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:${port.number}\/files\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:${port.number}\/files\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:${port.number}\/files\/foo.txt\", \"GET\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/1.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -36,1 +37,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:${port.number}\/files\/foo.txt\", \"GET:*\";\n@@ -41,2 +43,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/10.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -36,1 +37,8 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"socket:\/\/127.0.0.1:${port.number1}\", \"CONNECT\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"socket:\/\/[::1]:${port.number1}\", \"CONNECT\";\n+    \/\/ this specific test uses a proxy configured to loopback address. the httpclient implementation\n+    \/\/ during permissions check uses the InetAddress.hostString() API which can return resolved\n+    \/\/ hostname, so we use include a permission for \"localhost\" to cover that case too\n@@ -43,2 +51,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/11.policy","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -36,1 +37,8 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"socket:\/\/127.0.0.1:${port.number1}\", \"CONNECT\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:${port.number}\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"socket:\/\/[::1]:${port.number1}\", \"CONNECT\";\n+    \/\/ this specific test uses a proxy configured to loopback address. the httpclient implementation\n+    \/\/ during permissions check uses the InetAddress.hostString() API which can return resolved\n+    \/\/ hostname, so we use include a permission for \"localhost\" to cover that case too\n@@ -43,2 +51,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/12.policy","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/files\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/files\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/files\/foo.txt\", \"GET\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/14.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -36,1 +37,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/files\/foo.txt\", \"GET:*\";\n@@ -45,2 +47,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/15.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -38,1 +39,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:${port.number}\/files\/foo.txt\", \"GET:Host\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:${port.number}\/files\/foo.txt\", \"GET:Host\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:${port.number}\/files\/foo.txt\", \"GET:Host\";\n@@ -43,2 +45,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/16.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:${port.number}\/files\/foo.txt\", \"GET:Host\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:${port.number}\/files\/foo.txt\", \"GET:Host\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:${port.number}\/files\/foo.txt\", \"GET:Host\";\n@@ -43,2 +45,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/17.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/files\/*\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/files\/*\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/files\/*\", \"GET\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/2.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/redirect\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/redirect\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/redirect\/foo.txt\", \"GET\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/3.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,2 +38,5 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/redirect\/foo.txt\", \"GET\";\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/redirect\/bar.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/redirect\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/redirect\/bar.txt\", \"GET\";\n+    \/\/ ipv6\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/redirect\/foo.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/redirect\/bar.txt\", \"GET\";\n@@ -43,2 +47,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/4.policy","additions":10,"deletions":6,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/redirect\/bar.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/redirect\/bar.txt\", \"GET\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/redirect\/bar.txt\", \"GET\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/5.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/files\/foo.txt\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/files\/foo.txt\", \"POST\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/files\/foo.txt\", \"POST\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/6.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,3 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/files\/foo.txt\", \"GET:X-Bar\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/files\/foo.txt\", \"GET:X-Bar\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/files\/foo.txt\", \"GET:X-Bar\";\n+\n@@ -42,2 +45,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/7.policy","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/files\/foo.txt\", \"GET:X-Foo1,X-Foo,X-Bar\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/files\/foo.txt\", \"GET:X-Foo1,X-Foo,X-Bar\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/files\/foo.txt\", \"GET:X-Foo1,X-Foo,X-Bar\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/8.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen\";\n@@ -37,1 +38,2 @@\n-    permission java.net.URLPermission \"http:\/\/localhost:*\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/127.0.0.1:*\/files\/foo.txt\", \"GET:*\";\n+    permission java.net.URLPermission \"http:\/\/[::1]:*\/files\/foo.txt\", \"GET:*\";\n@@ -42,2 +44,2 @@\n-    permission java.net.SocketPermission \"localhost:1024-\", \"accept,listen,connect\";\n-    permission java.net.SocketPermission \"localhost:1024-\", \"connect,resolve\";\n+    permission java.net.SocketPermission \"127.0.0.1:1024-\", \"accept,listen,connect,resolve\";\n+    permission java.net.SocketPermission \"[::1]:1024-\", \"accept,listen,connect,resolve\";\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/9.policy","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -106,0 +106,1 @@\n+    static String serverAuthority;\n@@ -204,1 +205,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -211,1 +212,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -218,1 +219,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -225,1 +226,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/redirect\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/redirect\/foo.txt\");\n@@ -232,1 +233,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/redirect\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/redirect\/foo.txt\");\n@@ -239,1 +240,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/redirect\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/redirect\/foo.txt\");\n@@ -246,1 +247,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -253,1 +254,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -263,1 +264,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -273,1 +274,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -295,1 +296,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -310,1 +311,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -316,2 +317,2 @@\n-                    if (e.getCause() instanceof SecurityException) {\n-                        throw (SecurityException)e.getCause();\n+                    if (e.getCause() instanceof SecurityException se) {\n+                        throw se;\n@@ -326,1 +327,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -372,2 +373,2 @@\n-                    if (t instanceof SecurityException)\n-                        throw (SecurityException)t;\n+                    if (t instanceof SecurityException se)\n+                        throw se;\n@@ -375,2 +376,2 @@\n-                              && (t.getCause() instanceof SecurityException))\n-                        throw ((SecurityException)t.getCause());\n+                              && (t.getCause() instanceof SecurityException se))\n+                        throw se;\n@@ -383,1 +384,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -392,1 +393,1 @@\n-                URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+                URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -429,2 +430,1 @@\n-        InetSocketAddress addr = new InetSocketAddress(InetAddress.getLoopbackAddress(),\n-                                                       p);\n+        InetSocketAddress addr = new InetSocketAddress(InetAddress.getLoopbackAddress(), p);\n@@ -436,1 +436,1 @@\n-        URI u = URI.create(\"http:\/\/localhost:\" + port + \"\/files\/foo.txt\");\n+        URI u = URI.create(\"http:\/\/\" + serverAuthority + \"\/files\/foo.txt\");\n@@ -501,3 +501,4 @@\n-        System.out.println(\"HTTP server port = \" + port);\n-        httproot = \"http:\/\/localhost:\" + port + \"\/files\/\";\n-        redirectroot = \"http:\/\/localhost:\" + port + \"\/redirect\/\";\n+        serverAuthority = makeServerAuthority(addr.getAddress().getHostAddress(), port);\n+        System.out.println(\"HTTP server started at \" + serverAuthority);\n+        httproot = \"http:\/\/\" + serverAuthority + \"\/files\/\";\n+        redirectroot = \"http:\/\/\" + serverAuthority + \"\/redirect\/\";\n@@ -508,0 +509,6 @@\n+    private static String makeServerAuthority(final String host, final int port) {\n+        \/\/ escape for ipv6\n+        final String h = host.contains(\":\") ? \"[\" + host + \"]\" : host;\n+        return h + \":\" + port;\n+    }\n+\n","filename":"test\/jdk\/java\/net\/httpclient\/security\/Security.java","additions":35,"deletions":28,"binary":false,"changes":63,"status":"modified"}]}