{"files":[{"patch":"@@ -4335,0 +4335,5 @@\n+# 0: symbol, 1: string\n+compiler.warn.reflectable.method.unsupported=\\\n+    unsupported reflectable method in class {0}\\n\\\n+    {1}\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler.properties","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -158,0 +158,1 @@\n+    private final boolean reflectAll;\n@@ -176,0 +177,1 @@\n+        reflectAll = options.isSet(\"reflectAll\");\n@@ -203,1 +205,1 @@\n-            if (currentClassSym.type.getEnclosingType().hasTag(CLASS)) {\n+            if (currentClassSym.type.getEnclosingType().hasTag(CLASS) || currentClassSym.isDirectlyOrIndirectlyLocal()) {\n@@ -211,4 +213,18 @@\n-                CoreOp.FuncOp funcOp = bodyScanner.scanMethod();\n-                if (dumpIR) {\n-                    \/\/ dump the method IR if requested\n-                    log.note(ReflectableMethodIrDump(tree.sym.enclClass(), tree.sym, funcOp.toText()));\n+                try {\n+                    CoreOp.FuncOp funcOp = bodyScanner.scanMethod();\n+                    if (dumpIR) {\n+                        \/\/ dump the method IR if requested\n+                        log.note(ReflectableMethodIrDump(tree.sym.enclClass(), tree.sym, funcOp.toText()));\n+                    }\n+                    \/\/ create a static method that returns the op\n+                    Name methodName = methodName(symbolToMethodRef(tree.sym));\n+                    opMethodDecls.add(opMethodDecl(methodName));\n+                    ops.put(methodName.toString(), funcOp);\n+                } catch (RuntimeException e) {\n+                    if (reflectAll) {\n+                        \/\/ log as warning for debugging purposses when reflectAll enabled\n+                        log.warning(tree, ReflectableMethodUnsupported(currentClassSym.enclClass(), e.toString()));\n+                        super.visitMethodDef(tree);\n+                        return;\n+                    }\n+                    throw e;\n@@ -216,4 +232,0 @@\n-                \/\/ create a static method that returns the op\n-                Name methodName = methodName(symbolToMethodRef(tree.sym));\n-                opMethodDecls.add(opMethodDecl(methodName));\n-                ops.put(methodName.toString(), funcOp);\n@@ -2521,1 +2533,1 @@\n-        return codeReflectionEnabled ||\n+        return reflectAll || codeReflectionEnabled ||\n@@ -2527,1 +2539,1 @@\n-        return codeReflectionEnabled ||\n+        return reflectAll || codeReflectionEnabled ||\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/internal\/ReflectMethods.java","additions":23,"deletions":11,"binary":false,"changes":34,"status":"modified"}]}