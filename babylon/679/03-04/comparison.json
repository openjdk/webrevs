{"files":[{"patch":"@@ -53,1 +53,0 @@\n-import java.util.stream.Stream;\n@@ -560,3 +559,1 @@\n-            var cls = Stream.of(method.getDeclaringClass().getDeclaredClasses()).filter(c -> c.getName().endsWith(\"$$CM\")).findFirst();\n-            if (cls.isEmpty()) return Optional.empty();\n-            opMethod = cls.get().getDeclaredMethod(opMethodName);\n+            opMethod = method.getDeclaringClass().getDeclaredMethod(opMethodName);\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/Op.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -156,0 +156,1 @@\n+    private ListBuffer<JCTree> classOps;\n@@ -198,0 +199,1 @@\n+                classOps.add(opMethodDecl(methodName));\n@@ -211,0 +213,1 @@\n+        ListBuffer<JCTree> prevClassOps = classOps;\n@@ -219,0 +222,1 @@\n+            classOps = new ListBuffer<>();\n@@ -222,0 +226,1 @@\n+            tree.defs = tree.defs.prependList(classOps.toList());\n@@ -228,0 +233,1 @@\n+            classOps = prevClassOps;\n@@ -255,0 +261,1 @@\n+            classOps.add(opMethodDecl(lambdaName));\n@@ -287,0 +294,1 @@\n+            classOps.add(opMethodDecl(lambdaName));\n@@ -367,0 +375,13 @@\n+    private JCMethodDecl opMethodDecl(Name methodName) {\n+        \/\/ Create the method that constructs the code model stored in the class file\n+        var mt = new MethodType(com.sun.tools.javac.util.List.nil(), crSyms.opType,\n+                com.sun.tools.javac.util.List.nil(), syms.methodClass);\n+        var ms = new MethodSymbol(PRIVATE | STATIC | SYNTHETIC, methodName, mt, currentClassSym);\n+        currentClassSym.members().enter(ms);\n+\n+        \/\/ Create the method body calling the synthetic inner class method of the same name\n+        var body = make.Return(make.App(make.Ident(new MethodSymbol(PRIVATE | STATIC | SYNTHETIC, methodName, mt, synthClassSym))));\n+        var md = make.MethodDef(ms, make.Block(0, com.sun.tools.javac.util.List.of(body)));\n+        return md;\n+    }\n+\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/internal\/ReflectMethods.java","additions":21,"deletions":0,"binary":false,"changes":21,"status":"modified"}]}