{"files":[{"patch":"@@ -43,2 +43,0 @@\n-import java.util.Objects;\n-\n@@ -88,2 +86,2 @@\n-                .buildByteKernelFunction()\n-                .build_builtin_bfloat162float(\"bf16\")\n+                .build_builtin_byteCopy()\n+                .build_builtin_bfloat16ToFloat(\"bf16\")\n@@ -268,1 +266,1 @@\n-            builtin_bfloat162float().oparen();\n+            builtin_bfloat16ToFloat().oparen();\n","filename":"hat\/backends\/ffi\/opencl\/src\/main\/java\/hat\/backend\/ffi\/OpenCLHATKernelBuilder.java","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -221,1 +221,1 @@\n-            builder.cbrace().suffix_t(dsName).semicolon().nl();\n+            builder.cbrace().suffix_t(dsName).semicolon().nl().nl();\n","filename":"hat\/backends\/ffi\/shared\/src\/main\/java\/hat\/backend\/ffi\/C99FFIBackend.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -96,4 +96,5 @@\n-                .charTypeDefs(\"byte\", \"boolean\")\n-                .typedefStructOrUnion(true, KernelContext.class, _ -> {\n-                    intDeclaration(\"dimensions\").semicolon().nl();\n-                });\n+                .charTypeDefs(\"byte\", \"boolean\").nl()\n+                .typedefStructOrUnion(true, KernelContext.class, _ ->\n+                    intDeclaration(\"dimensions\").semicolon()\n+                )\n+                .nl();\n@@ -185,1 +186,1 @@\n-        return suffix_t(localArrayDeclaration.classType()).space().varName(localArrayDeclaration.varOp()).nl();\n+        return suffix_t(localArrayDeclaration.classType()).space().varName(localArrayDeclaration.varOp());\n@@ -320,1 +321,1 @@\n-            builtin_bfloat162float().oparen();\n+            builtin_bfloat16ToFloat().oparen();\n@@ -339,1 +340,1 @@\n-            builtin_bfloat162float().oparen();\n+            builtin_bfloat16ToFloat().oparen();\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/C99HATKernelBuilder.java","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -44,0 +44,3 @@\n+    public T semicolonNl() {\n+        return semicolon().nl();\n+    }\n@@ -65,0 +68,6 @@\n+    public T rightShift(int v) {\n+        return rightShift().intValue(v);\n+    }\n+    public T leftShift(int v) {\n+        return leftShift().intValue(v);\n+    }\n@@ -69,0 +78,3 @@\n+    public T assign() {\n+        return space().equals().space();\n+    }\n@@ -164,1 +176,3 @@\n-\n+    public T returnKeyword(String identifier) {\n+        return returnKeyword().space().identifier(identifier);\n+    }\n@@ -191,1 +205,3 @@\n-\n+    public T addressOf(String identifier) {\n+        return ampersand().identifier(identifier);\n+    }\n@@ -195,0 +211,3 @@\n+    public T dereference(String identifier) {\n+        return asterisk().identifier(identifier);\n+    }\n@@ -485,1 +504,12 @@\n-\n+    public final T voidPtrType() {\n+        return voidType().space().asterisk();\n+    }\n+    public final T voidPtrType(String identifier) {\n+        return voidPtrType().identifier(identifier);\n+    }\n+    public final T size_t() {\n+        return typeName(\"size_t\");\n+    }\n+    public final T size_t(String identifier) {\n+        return size_t().space().identifier(identifier);\n+    }\n@@ -494,0 +524,3 @@\n+    public final T floatType(String identifier) {\n+        return floatType().space().identifier(identifier);\n+    }\n@@ -511,0 +544,3 @@\n+    public final T shortType(String identifier) {\n+        return shortType().space().identifier(identifier);\n+    }\n@@ -579,1 +615,3 @@\n-\n+    public T sizeof(String identifier) {\n+        return sizeof(_->paren(_->identifier(identifier)));\n+    }\n@@ -581,1 +619,1 @@\n-        return emitText(\"sizeof\").paren(consumer);\n+        return sizeof().paren(consumer);\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/CodeBuilder.java","additions":43,"deletions":5,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -40,3 +40,3 @@\n-    public static final String HAT_BUILT_IN_FLOAT_TO_BFLOAT16 = \"floatTobfloat16\";\n-    public static final String HAT_BUILT_IN_BFLOAT16_TO_FLOAT = \"bfloat16Tofloat\";\n-    public static final String HAT_BUILT_IN_COPY_BYTES = \"byteCopy\";\n+\n+\n+\n@@ -218,1 +218,1 @@\n-        identifier(HAT_BUILT_IN_FLOAT_TO_BFLOAT16);\n+        identifier(\"floatTobfloat16\");\n@@ -222,2 +222,2 @@\n-    public T builtin_bfloat162float() {\n-        identifier(HAT_BUILT_IN_BFLOAT16_TO_FLOAT);\n+    public T builtin_bfloat16ToFloat() {\n+        identifier(\"bfloat16Tofloat\");\n@@ -285,0 +285,9 @@\n+    public final T unsignedCharType(String identifier) {\n+        return unsignedCharType().space().identifier(identifier);\n+    }\n+    public final T unsignedCharPtrType() {\n+        return unsignedCharType().space().asterisk();\n+    }\n+    public final T unsignedCharPtrType(String identifier) {\n+        return unsignedCharPtrType().identifier(identifier);\n+    }\n@@ -344,0 +353,4 @@\n+    public final T unsignedIntType(String identifier ) {\n+        return unsignedIntType().space().identifier(identifier);\n+    }\n+\n@@ -351,0 +364,3 @@\n+    public final T unsignedShortType(String identifier) {\n+        return unsignedShortType().space().identifier(identifier);\n+    }\n@@ -421,0 +437,4 @@\n+    public T builtin_byteCopy(){\n+        return identifier(\"byteCopy\");\n+    }\n+\n@@ -433,5 +453,3 @@\n-    public T buildByteKernelFunction() {\n-        voidType().space().identifier(HAT_BUILT_IN_COPY_BYTES)\n-                .paren(_-> voidType().space().asterisk().identifier(\"dest\").comma()\n-                            .voidType().space().asterisk().identifier(\"src\").comma()\n-                            .typeName(\"size_t\").space().identifier(\"size\"));\n+    public T build_builtin_byteCopy() {\n+        voidType().space().builtin_byteCopy()\n+                .paren(_-> voidPtrType(\"dest\").commaSpace().voidPtrType(\"src\").commaSpace().size_t(\"size\"));\n@@ -439,6 +457,7 @@\n-                semicolonNlTerminated( _ -> unsignedCharType().space().asterisk().identifier(\"c\").space()\n-                        .equals().space().paren( _ -> unsignedCharType().asterisk()).identifier(\"dest\"))\n-                .semicolonNlTerminated( _ ->unsignedCharType().space().asterisk().identifier(\"s\").space()\n-                        .equals().space().paren( _ -> unsignedCharType().asterisk()).identifier(\"src\"))\n-                    .buildForLoopHeader(\"i\", \"0\", \"size\")\n-                            .braceNlIndented(_ -> semicolonNlTerminated( _ -> asterisk().identifier(\"c\").plusplus().space().equals().space().asterisk().identifier(\"s\").plusplus())));\n+                         unsignedCharPtrType(\"c\").equals().paren( _ -> unsignedCharPtrType()).identifier(\"dest\").semicolonNl()\n+                        .unsignedCharPtrType(\"s\").equals().paren( _ -> unsignedCharPtrType()).identifier(\"src\").semicolonNl()\n+                        .buildForLoopHeader(\"i\", \"0\", \"size\").braceNlIndented(_ ->\n+                                         dereference(\"c\").plusplus().equals().dereference(\"s\").plusplus().semicolon()\n+                                 )\n+        );\n+        nl();\n@@ -461,2 +480,2 @@\n-    public T build_builtin_bfloat162float(String parameterName) {\n-        floatType().space().identifier(HAT_BUILT_IN_BFLOAT16_TO_FLOAT).paren(_ -> unsignedShortType().space().identifier(parameterName))\n+    public T build_builtin_bfloat16ToFloat(String parameterName) {\n+        floatType().space().builtin_bfloat16ToFloat().paren(_ -> unsignedShortType(parameterName))\n@@ -464,4 +483,5 @@\n-                        semicolonNlTerminated( _ -> nl().unsignedIntType().space().identifier(\"bits\").space().equals().space().identifier(parameterName).leftShift().constant(\"16\"))\n-                        .semicolonNlTerminated( _ -> floatType().space().identifier(\"r\").space().equals().space().identifier(\"bits\"))\n-                        .semicolonNlTerminated(_ -> identifier(HAT_BUILT_IN_COPY_BYTES).paren( _ -> ampersand().identifier(\"r\").comma().space().ampersand().identifier(\"bits\").comma().sizeof(_ -> identifier(\"r\"))))\n-                        .semicolonNlTerminated(_-> returnKeyword().space().identifier(\"r\"))\n+                        nl()\n+                        .unsignedIntType(\"bits\").equals().identifier(parameterName).leftShift(12).semicolonNl()\n+                        .floatType(\"r\").equals().identifier(\"bits\").semicolonNl()\n+                        .builtin_byteCopy().paren(_ -> addressOf(\"r\").commaSpace().addressOf(\"bits\").comma().sizeof(\"r\")).semicolonNl()\n+                        .returnKeyword(\"r\").semicolonNl()\n@@ -469,0 +489,1 @@\n+        nl();\n@@ -485,7 +506,9 @@\n-        shortType().space().identifier(HAT_BUILT_IN_FLOAT_TO_BFLOAT16).paren(_ -> floatType().space().identifier(parameterName))\n-                .brace( _ ->\n-                             semicolonNlTerminated( _ -> nl().unsignedIntType().space().identifier(\"bits\"))\n-                            .semicolonNlTerminated(_ -> identifier(HAT_BUILT_IN_COPY_BYTES).paren( _ -> ampersand().identifier(\"bits\").comma().space().ampersand().identifier(parameterName).comma().sizeof(_ -> identifier(\"bits\"))))\n-                            .semicolonNlTerminated( _ -> shortType().space().identifier(\"bf16\").space().equals().space().identifier(\"bits\").rightShift().constant(\"16\"))\n-                            .semicolonNlTerminated(_-> returnKeyword().space().identifier(\"bf16\"))\n-                        );\n+        shortType().space().builtin_float2bfloat16().paren(_ -> floatType().space().identifier(parameterName))\n+                .brace( _ -> nl()\n+                        .unsignedIntType(\"bits\").semicolonNl()\n+                        .builtin_byteCopy().paren(_ ->\n+                                addressOf(\"bits\").commaSpace().addressOf(parameterName).commaSpace().sizeof(\"bits\")).semicolonNl()\n+                                .shortType(\"bf16\").equals().identifier(\"bits\").rightShift(16).semicolonNl()\n+                                .returnKeyword(\"bf16\").semicolonNl()\n+                );\n+        nl();\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/HATCodeBuilder.java","additions":53,"deletions":30,"binary":false,"changes":83,"status":"modified"},{"patch":"@@ -365,1 +365,1 @@\n-                    separated(ifaceType.fields, (_) -> nl(), field -> {\n+                    separated(ifaceType.fields, (_) -> semicolon().nl(), field -> {\n@@ -432,1 +432,1 @@\n-                            emitText(padding.toC99()).semicolon().nl();\n+                            emitText(padding.toC99());\n@@ -436,1 +436,0 @@\n-                        semicolon();\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/HATCodeBuilderWithContext.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"}]}