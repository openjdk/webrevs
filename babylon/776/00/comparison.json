{"files":[{"patch":"@@ -39,9 +39,0 @@\n-    private CudaHATKernelBuilder threadDimId(int id) {\n-        return keyword(switch(id){\n-            case 0->\"x\";\n-            case 1->\"y\";\n-            case 2->\"z\";\n-            default -> throw new RuntimeException(\"Thread Dimension not supported\");\n-        });\n-    }\n-\n@@ -63,1 +54,20 @@\n-\n+    private CudaHATKernelBuilder threadIdx() {\n+        return keyword(\"threadIdx\");\n+    }\n+    private CudaHATKernelBuilder threadIdxX() {return threadIdx().dot().identifier(\"x\");}\n+    private CudaHATKernelBuilder threadIdxY() {return threadIdx().dot().identifier(\"y\");}\n+    private CudaHATKernelBuilder threadIdxZ() {return threadIdx().dot().identifier(\"z\");}\n+    private CudaHATKernelBuilder gridDim() {\n+        return keyword(\"gridDim\");\n+    }\n+    private CudaHATKernelBuilder gridDimX() {return gridDim().dot().identifier(\"x\");}\n+    private CudaHATKernelBuilder gridDimY() {return gridDim().dot().identifier(\"y\");}\n+    private CudaHATKernelBuilder gridDimZ() {return gridDim().dot().identifier(\"z\");}\n+    private CudaHATKernelBuilder blockDim() {return keyword(\"blockDim\");}\n+    private CudaHATKernelBuilder blockDimX() {return blockDim().dot().identifier(\"x\");}\n+    private CudaHATKernelBuilder blockDimY() {return blockDim().dot().identifier(\"y\");}\n+    private CudaHATKernelBuilder blockDimZ() {return blockDim().dot().identifier(\"z\");}\n+    private CudaHATKernelBuilder blockId() {return keyword(\"blockId\");}\n+    private CudaHATKernelBuilder blockIdX() {return blockId().dot().identifier(\"x\");}\n+    private CudaHATKernelBuilder blockIdY() {return blockId().dot().identifier(\"y\");}\n+    private CudaHATKernelBuilder blockIdZ() {return blockId().dot().identifier(\"z\");}\n@@ -72,15 +82,15 @@\n-                .hashDefine(\"HAT_GIX\", _ -> paren(_->blockId(0).asterisk().localSize(0).plus().localId(0)))\n-                .hashDefine(\"HAT_GIY\", _ -> paren(_->blockId(1).asterisk().localSize(1).plus().localId(1)))\n-                .hashDefine(\"HAT_GIZ\", _ -> paren(_->blockId(2).asterisk().localSize(2).plus().localId(2)))\n-                .hashDefine(\"HAT_LIX\", _ -> keyword(\"threadIdx\").dot().threadDimId(0))\n-                .hashDefine(\"HAT_LIY\", _ -> keyword(\"threadIdx\").dot().threadDimId(1))\n-                .hashDefine(\"HAT_LIZ\", _ -> keyword(\"threadIdx\").dot().threadDimId(2))\n-                .hashDefine(\"HAT_GSX\", _ -> keyword(\"gridDim\").dot().threadDimId(0).asterisk().localSize(0))\n-                .hashDefine(\"HAT_GSY\", _ -> keyword(\"gridDim\").dot().threadDimId(1).asterisk().localSize(1))\n-                .hashDefine(\"HAT_GSZ\", _ -> keyword(\"gridDim\").dot().threadDimId(2).asterisk().localSize(2))\n-                .hashDefine(\"HAT_LSX\", _ -> keyword(\"blockDim\").dot().threadDimId(0))\n-                .hashDefine(\"HAT_LSY\", _ -> keyword(\"blockDim\").dot().threadDimId(1))\n-                .hashDefine(\"HAT_LSZ\", _ -> keyword(\"blockDim\").dot().threadDimId(2))\n-                .hashDefine(\"HAT_BIX\", _ -> keyword(\"blockIdx\").dot().threadDimId(0))\n-                .hashDefine(\"HAT_BIY\", _ -> keyword(\"blockIdx\").dot().threadDimId(1))\n-                .hashDefine(\"HAT_BIZ\", _ -> keyword(\"blockIdx\").dot().threadDimId(2))\n+                .hashDefine(\"HAT_GIX\", _ -> paren(_-> HAT_BIX().asterisk().HAT_LSX().plus().HAT_LIX())\n+                .hashDefine(\"HAT_GIY\", _ -> paren(_-> HAT_BIY().asterisk().HAT_LSY().plus().HAT_LIY()))\n+                .hashDefine(\"HAT_GIZ\", _ -> paren(_-> HAT_BIZ().asterisk().HAT_LSZ().plus().HAT_LIZ()))\n+                .hashDefine(\"HAT_LIX\", _ -> threadIdxX())\n+                .hashDefine(\"HAT_LIY\", _ -> threadIdxY())\n+                .hashDefine(\"HAT_LIZ\", _ -> threadIdxZ())\n+                .hashDefine(\"HAT_GSX\", _ -> gridDimX().asterisk().HAT_LSX())\n+                .hashDefine(\"HAT_GSY\", _ -> gridDimY().asterisk().HAT_LSY())\n+                .hashDefine(\"HAT_GSZ\", _ -> gridDimZ().asterisk().HAT_LSZ())\n+                .hashDefine(\"HAT_LSX\", _ -> blockDimX())\n+                .hashDefine(\"HAT_LSY\", _ -> blockDimY())\n+                .hashDefine(\"HAT_LSZ\", _ -> blockDimZ())\n+                .hashDefine(\"HAT_BIX\", _ -> blockIdX())\n+                .hashDefine(\"HAT_BIY\", _ -> blockIdY())\n+                .hashDefine(\"HAT_BIZ\", _ -> blockIdZ())\n@@ -91,1 +101,1 @@\n-                .typedefSingleValueStruct(\"BF16\",  \"BFLOAT16\");\n+                .typedefSingleValueStruct(\"BF16\",  \"BFLOAT16\"));\n","filename":"hat\/backends\/ffi\/cuda\/src\/main\/java\/hat\/backend\/ffi\/CudaHATKernelBuilder.java","additions":36,"deletions":26,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -66,0 +66,95 @@\n+\n+    public T HAT_GIX(){\n+        return identifier(\"HAT_GIX\");\n+    }\n+    public T HAT_GIY(){\n+        return identifier(\"HAT_GIY\");\n+    }\n+    public T HAT_GIZ(){\n+        return identifier(\"HAT_GIZ\");\n+    }\n+    public T HAT_GSX(){\n+        return identifier(\"HAT_GSX\");\n+    }\n+    public T HAT_GSY(){\n+        return identifier(\"HAT_GSY\");\n+    }\n+    public T HAT_GSZ(){\n+        return identifier(\"HAT_GSZ\");\n+    }\n+    public T HAT_GS(int id) {\n+        return (switch (id) {\n+            case 0 -> HAT_GSX();\n+            case 1 -> HAT_GSY();\n+            case 2 -> HAT_GSZ();\n+            default -> throw new RuntimeException(\"globalSize id = \" + id);\n+        });\n+    }\n+    public T HAT_GI(int id) {\n+        switch (id) {\n+            case 0 -> HAT_GIX();\n+            case 1 -> HAT_GIY();\n+            case 2 -> HAT_GIZ();\n+            default -> throw new RuntimeException(\"globalId id = \" + id);\n+        }\n+        return self();\n+    }\n+    public T HAT_LIX(){\n+        return identifier(\"HAT_LIX\");\n+    }\n+    public T HAT_LIY(){\n+        return identifier(\"HAT_LIY\");\n+    }\n+    public T HAT_LIZ(){\n+        return identifier(\"HAT_LIZ\");\n+    }\n+    public T HAT_LSX(){\n+        return identifier(\"HAT_LSX\");\n+    }\n+    public T HAT_LSY(){\n+        return identifier(\"HAT_LSY\");\n+    }\n+    public T HAT_LSZ(){\n+        return identifier(\"HAT_LSZ\");\n+    }\n+    public T HAT_LI(int id) {\n+        return (switch (id) {\n+            case 0 -> HAT_LIX();\n+            case 1 -> HAT_LIY();\n+            case 2 -> HAT_LIZ();\n+            default -> throw new RuntimeException(\"localId id = \" + id);\n+        });\n+    }\n+\n+\n+\n+    public T HAT_LS(int id) {\n+        return (switch (id) {\n+            case 0 -> HAT_LSX();\n+            case 1 -> HAT_LSY();\n+            case 2 -> HAT_LSZ();\n+            default -> throw new RuntimeException(\"localSize id = \" + id);\n+        });\n+    }\n+    public T HAT_BIX(){\n+        return identifier(\"HAT_BIX\");\n+    }\n+    public T HAT_BIY(){\n+        return identifier(\"HAT_BIY\");\n+    }\n+    public T HAT_BIZ(){\n+        return identifier(\"HAT_BIZ\");\n+    }\n+\n+    public T HAT_BI(int id) {\n+        return (switch (id) {\n+            case 0 -> HAT_BIX();\n+            case 1 -> HAT_BIY();\n+            case 2 -> HAT_BIZ();\n+            default -> throw new RuntimeException(\"blockId id = \" + id);\n+        });\n+    }\n+\n+\n+\n+\n@@ -294,1 +389,1 @@\n-        return globalId(globalThreadIdOp.getDimension());\n+        return HAT_GI(globalThreadIdOp.getDimension());\n@@ -299,1 +394,1 @@\n-        return globalSize(globalSizeOp.getDimension());\n+        return HAT_GS(globalSizeOp.getDimension());\n@@ -304,1 +399,1 @@\n-        return localId(localThreadIdOp.getDimension());\n+        return HAT_LI(localThreadIdOp.getDimension());\n@@ -309,1 +404,1 @@\n-        return localSize(hatLocalSizeOp.getDimension());\n+        return HAT_LS(hatLocalSizeOp.getDimension());\n@@ -314,1 +409,1 @@\n-        return blockId(hatBlockThreadIdOp.getDimension());\n+        return HAT_BI(hatBlockThreadIdOp.getDimension());\n@@ -317,46 +412,0 @@\n-    public T globalId(int id) {\n-        switch (id) {\n-            case 0 -> identifier(\"HAT_GIX\");\n-            case 1 -> identifier(\"HAT_GIY\");\n-            case 2 -> identifier(\"HAT_GIZ\");\n-            default -> throw new RuntimeException(\"globalId id = \" + id);\n-        }\n-        return self();\n-    }\n-\n-    public T localId(int id) {\n-        return (switch (id) {\n-            case 0 -> identifier(\"HAT_LIX\");\n-            case 1 -> identifier(\"HAT_LIY\");\n-            case 2 -> identifier(\"HAT_LIZ\");\n-            default -> throw new RuntimeException(\"localId id = \" + id);\n-        });\n-    }\n-\n-    public T globalSize(int id) {\n-        return (switch (id) {\n-            case 0 -> identifier(\"HAT_GSX\");\n-            case 1 -> identifier(\"HAT_GSY\");\n-            case 2 -> identifier(\"HAT_GSZ\");\n-            default -> throw new RuntimeException(\"globalSize id = \" + id);\n-        });\n-    }\n-\n-    public T localSize(int id) {\n-        return (switch (id) {\n-            case 0 -> identifier(\"HAT_LSX\");\n-            case 1 -> identifier(\"HAT_LSY\");\n-            case 2 -> identifier(\"HAT_LSZ\");\n-            default -> throw new RuntimeException(\"localSize id = \" + id);\n-        });\n-    }\n-\n-\n-    public T blockId(int id) {\n-        return (switch (id) {\n-            case 0 -> identifier(\"HAT_BIX\");\n-            case 1 -> identifier(\"HAT_BIY\");\n-            case 2 -> identifier(\"HAT_BIZ\");\n-            default -> throw new RuntimeException(\"blockId id = \" + id);\n-        });\n-    }\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/C99HATKernelBuilder.java","additions":100,"deletions":51,"binary":false,"changes":151,"status":"modified"}]}