{"files":[{"patch":"@@ -51,0 +51,14 @@\n+        default  int[] asInts(int from, int count) {\n+            int[] ints = new int[count];\n+            for (int i = 0; i<count; i++) {\n+                ints[i]= Integer.parseInt(string(from + i));\n+            }\n+            return ints;\n+        }\n+        default  float[] asFloats(int from, int count) {\n+            float[] floats = new float[count];\n+            for (int i = 0; i<count; i++) {\n+                floats[i]=Float.parseFloat(string(from + i));\n+            }\n+            return floats;\n+        }\n","filename":"hat\/core\/src\/main\/java\/hat\/util\/Regex.java","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -0,0 +1,220 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ *  Based on mesh descriptions found here\n+ *      https:\/\/6502disassembly.com\/a2-elite\/\n+ *      https:\/\/6502disassembly.com\/a2-elite\/meshes.html\n+ *\n+ *\/\n+package view;\n+\n+import hat.util.Regex;\n+import hat.util.StreamMutable;\n+import view.f32.F32;\n+import view.f32.F32Mesh3D;\n+import java.io.BufferedReader;\n+import java.io.InputStreamReader;\n+import java.nio.charset.StandardCharsets;\n+import java.util.regex.Matcher;\n+\n+class EliteMeshParser {\n+\n+    interface State {\n+\n+        String hexRegexStr = \"((?:-?&[0-9a-fA-F][0-9a-fA-F])|0)\";\n+        String commaRegexStr = \" *, *\";\n+        String hexOrColorCommaRegexStr = \"(\" + hexRegexStr + \"|(?:(?:[a-zA-Z][a-zA-Z0-9]*)))\" + commaRegexStr;\n+        String hexCommaRegexStr = hexRegexStr + commaRegexStr;\n+        String decRegexStr = \"([0-9]+)\";\n+        String decCommaRegexStr = decRegexStr + commaRegexStr;\n+\n+        Regex hexagonRegex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"6\", commaRegexStr, decCommaRegexStr.repeat(5), decRegexStr, \" *$\");\n+        Regex pentagonRegex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"5\", commaRegexStr, decCommaRegexStr.repeat(4), decRegexStr, \" *$\");\n+        Regex quadRegex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"4\", commaRegexStr, decCommaRegexStr.repeat(3), decRegexStr, \" *$\");\n+        Regex triangleRegex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"3\", commaRegexStr, decCommaRegexStr.repeat(2), decRegexStr, \" *$\");\n+\n+        Regex vertexRegex = Regex.of(\"^ *\" + hexCommaRegexStr + hexCommaRegexStr + hexRegexStr + \" *$\");\n+        Regex emptyRegex = Regex.of(\"^ *$\");\n+        Regex remRegex = Regex.of(\"^ *REM(.*)$\");\n+        Regex colonRegex = Regex.of(\"^ *(:) *$\");\n+        Regex facesRegex = Regex.of(\"^ *(faces) *$\");\n+\n+        default String name() {\n+            return this.getClass().getSimpleName();\n+        }\n+\n+        record awaiting_name(Regex r) implements State {\n+        }\n+\n+        record awaiting_lazer(Regex r) implements State {\n+        }\n+\n+        record awaiting_counts(Regex r) implements State {\n+        }\n+\n+        record awaiting_vertices(Regex r) implements State {\n+        }\n+\n+        record awaiting_hue_lig_sat(Regex r) implements State {\n+        }\n+\n+        record awaiting_faces() implements State {\n+            public Regex r() {\n+                return null;\n+            }\n+        }\n+\n+        record done() implements State {\n+            public Regex r() {\n+                return null;\n+            }\n+        }\n+\n+        record none() implements State {\n+            public Regex r() {\n+                return null;\n+            }\n+        }\n+\n+        awaiting_name awaiting_name = new awaiting_name(Regex.of(\"^ *([A-Za-z][0-9A-Za-z]+) *$\"));\n+        awaiting_lazer awaiting_lazer = new awaiting_lazer(Regex.of(\"^ *\" + hexRegexStr + \" *$\"));\n+        awaiting_counts awaiting_counts = new awaiting_counts(Regex.of(\"^ *\" + hexCommaRegexStr + hexRegexStr + \" *$\"));\n+        awaiting_vertices awaiting_vertices = new awaiting_vertices(Regex.of(\"^ *(vertices) *$\"));\n+        awaiting_hue_lig_sat awaiting_hue_lig_sat = new awaiting_hue_lig_sat(Regex.of(\"^ *(hue-lig-sat) *$\"));\n+        awaiting_faces awaiting_faces = new awaiting_faces();\n+        done done = new done();\n+        none none = new none();\n+\n+        class Machine {\n+            State state = none;\n+\n+            private Machine state(State state) {\n+                this.state = state;\n+                return this;\n+            }\n+\n+            Machine() {\n+                state(none);\n+            }\n+\n+            Machine awaiting_name() {\n+                return state(awaiting_name);\n+            }\n+\n+            Machine awaiting_lazer() {\n+                return state(awaiting_lazer);\n+            }\n+\n+            Machine awaiting_counts() {\n+                return state(awaiting_counts);\n+            }\n+\n+            Machine awaiting_vertices() {\n+                return state(awaiting_vertices);\n+            }\n+\n+            Machine awaiting_faces() {\n+                return state(awaiting_faces);\n+            }\n+\n+            Machine awaiting_hue_lig_sat() {\n+                return state(awaiting_hue_lig_sat);\n+            }\n+\n+            Machine done() {\n+                return state(done);\n+            }\n+        }\n+    }\n+\n+    record F32x3(Regex regex, Matcher matcher, boolean matched) implements Regex.OK {\n+        float f(int idx) {\n+            var s = string(idx);\n+            return (s.startsWith(\"-\")) ?\n+                    (-Integer.parseInt(s.substring(2), 16) \/ 64f) : (Integer.parseInt(s.substring(1), 16) \/ 64f);\n+        }\n+\n+        F32x3(Regex r, Matcher m) {\n+            this(r, m, true);\n+        }\n+    }\n+\n+    record S32xN (Regex regex, Matcher matcher, boolean matched) implements Regex.OK {\n+        S32xN(Regex r, Matcher m) {\n+            this(r, m, true);\n+        }\n+    }\n+\n+    void load(F32 f32, String name) {\n+        final var mesh = StreamMutable.of((F32Mesh3D) null);\n+        final var sm = new State.Machine().awaiting_name();\n+        new BufferedReader(\n+                new InputStreamReader(EliteMeshParser.class.getResourceAsStream(\"\/meshes\/Elite.txt\"), StandardCharsets.UTF_8))\n+                .lines()\n+                .map(String::trim)\n+                .forEach(line -> {\n+                    switch(sm.state){\n+                        case State.awaiting_name s when s.r().matches(line, whoseMatcher -> whoseMatcher.group(1).equals(name))->{\n+                            sm.awaiting_lazer();\n+                            mesh.set(F32Mesh3D.of(f32,name));\n+                        }\n+                        case State.awaiting_lazer s when s.r().matches(line) -> sm.awaiting_counts();\n+                        case State.awaiting_counts s when s.r().matches(line) -> sm.awaiting_vertices();\n+                        case State.awaiting_vertices s when s.r().matches(line) -> sm.awaiting_faces();\n+                        case State.awaiting_faces _ when State.vertexRegex.is(line, F32x3::new) instanceof F32x3 f32x3 ->{\n+                            mesh.get().vec3(f32x3.f(1), f32x3.f(2), f32x3.f(3));\n+                        }\n+                        case State.awaiting_faces _ when State.facesRegex.matchesOrThrow(line) -> {\n+                            sm.awaiting_hue_lig_sat();\n+                        }\n+                        case State.awaiting_hue_lig_sat _ when State.hexagonRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n+                            mesh.get().hex(s32xN.asInts(6,6), 0xff7f00);\n+                        }\n+                        case State.awaiting_hue_lig_sat _ when State.pentagonRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n+                            mesh.get().pent(s32xN.asInts(6,5), 0x7fff00);\n+                        }\n+                        case State.awaiting_hue_lig_sat _ when State.quadRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n+                                mesh.get().quad(s32xN.asInts(6,4), 0x00ff7f);\n+\n+                        }\n+                        case State.awaiting_hue_lig_sat _ when State.triangleRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n+                                mesh.get().tri(s32xN.asInts(6,3), 0x007fff);\n+                        }\n+                        case State.awaiting_hue_lig_sat s when s.r().matches(line) -> {\n+                            mesh.get().fin();\n+                            sm.done();\n+                        }\n+                        case State.awaiting_hue_lig_sat _ when !State.remRegex.matches(line) ->{\n+                                System.out.println(\"UNHANDLED \" + line);\n+                        }\n+                        case State.done _-> {}\n+                        case State _ when Regex.any(line, State.remRegex, State.emptyRegex, State.colonRegex).matched()->{}\n+                        case State _ ->{}\n+                    }\n+                });\n+    }\n+\n+}\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/EliteMeshParser.java","additions":220,"deletions":0,"binary":false,"changes":220,"status":"added"},{"patch":"@@ -1,320 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- *  Based on mesh descriptions found here\n- *      https:\/\/6502disassembly.com\/a2-elite\/\n- *      https:\/\/6502disassembly.com\/a2-elite\/meshes.html\n- *\n- *\/\n-package view;\n-\n-import hat.util.Regex;\n-import hat.util.StreamMutable;\n-import view.f32.F32Mesh3D;\n-import java.io.BufferedReader;\n-import java.io.InputStreamReader;\n-import java.nio.charset.StandardCharsets;\n-import java.util.List;\n-import java.util.regex.Matcher;\n-\n-class EliteMeshReader {\n-\n-    interface State {\n-\n-        String hexRegexStr = \"((?:-?&[0-9a-fA-F][0-9a-fA-F])|0)\";\n-        String commaRegexStr = \" *, *\";\n-        String hexOrColorCommaRegexStr = \"(\" + hexRegexStr + \"|(?:(?:[a-zA-Z][a-zA-Z0-9]*)))\" + commaRegexStr;\n-        String hexCommaRegexStr = hexRegexStr + commaRegexStr;\n-        String decRegexStr = \"([0-9]+)\";\n-        String decCommaRegexStr = decRegexStr + commaRegexStr;\n-\n-        Regex face6Regex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"6\", commaRegexStr, decCommaRegexStr.repeat(5), decRegexStr, \" *$\");\n-        Regex face5Regex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"5\", commaRegexStr, decCommaRegexStr.repeat(4), decRegexStr, \" *$\");\n-        Regex face4Regex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"4\", commaRegexStr, decCommaRegexStr.repeat(3), decRegexStr, \" *$\");\n-        Regex face3Regex = Regex.of(\"^ *\", hexOrColorCommaRegexStr, hexCommaRegexStr.repeat(3), \"3\", commaRegexStr, decCommaRegexStr.repeat(2), decRegexStr, \" *$\");\n-\n-        Regex vertexRegex = Regex.of(\"^ *\" + hexCommaRegexStr + hexCommaRegexStr + hexRegexStr + \" *$\");\n-        Regex emptyRegex = Regex.of(\"^ *$\");\n-        Regex remRegex = Regex.of(\"^ *REM(.*)$\");\n-        Regex colonRegex = Regex.of(\"^ *(:) *$\");\n-        Regex facesRegex = Regex.of(\"^ *(faces) *$\");\n-\n-        default String name() {\n-            return this.getClass().getSimpleName();\n-        }\n-\n-        record awaiting_name(Regex r) implements State {\n-        }\n-\n-        record awaiting_lazer(Regex r) implements State {\n-        }\n-\n-        record awaiting_counts(Regex r) implements State {\n-        }\n-\n-        record awaiting_vertices(Regex r) implements State {\n-        }\n-\n-        record awaiting_hue_lig_sat(Regex r) implements State {\n-        }\n-\n-        record awaiting_faces() implements State {\n-            public Regex r() {\n-                return null;\n-            }\n-        }\n-\n-        record done() implements State {\n-            public Regex r() {\n-                return null;\n-            }\n-        }\n-\n-        record none() implements State {\n-            public Regex r() {\n-                return null;\n-            }\n-        }\n-\n-        awaiting_name awaiting_name = new awaiting_name(Regex.of(\"^ *([A-Za-z][0-9A-Za-z]+) *$\"));\n-        awaiting_lazer awaiting_lazer = new awaiting_lazer(Regex.of(\"^ *\" + hexRegexStr + \" *$\"));\n-        awaiting_counts awaiting_counts = new awaiting_counts(Regex.of(\"^ *\" + hexCommaRegexStr + hexRegexStr + \" *$\"));\n-        awaiting_vertices awaiting_vertices = new awaiting_vertices(Regex.of(\"^ *(vertices) *$\"));\n-        awaiting_hue_lig_sat awaiting_hue_lig_sat = new awaiting_hue_lig_sat(Regex.of(\"^ *(hue-lig-sat) *$\"));\n-        awaiting_faces awaiting_faces = new awaiting_faces();\n-        done done = new done();\n-        none none = new none();\n-\n-        class Machine {\n-            State state = none;\n-\n-            private Machine state(State state) {\n-                \/\/  System.out.println(\"from \" + this.state.name() + \" to \" + state.name());\n-                this.state = state;\n-                return this;\n-            }\n-\n-            Machine() {\n-                state(none);\n-            }\n-\n-            Machine awaiting_name() {\n-                return state(awaiting_name);\n-            }\n-\n-            Machine awaiting_lazer() {\n-                return state(awaiting_lazer);\n-            }\n-\n-            Machine awaiting_counts() {\n-                return state(awaiting_counts);\n-            }\n-\n-            Machine awaiting_vertices() {\n-                return state(awaiting_vertices);\n-            }\n-\n-            Machine awaiting_faces() {\n-                return state(awaiting_faces);\n-            }\n-\n-            Machine awaiting_hue_lig_sat() {\n-                return state(awaiting_hue_lig_sat);\n-            }\n-\n-            Machine done() {\n-                return state(done);\n-            }\n-        }\n-    }\n-\n-    record F32x3(Regex regex, Matcher matcher, boolean matched) implements Regex.OK {\n-        float f(int idx) {\n-            var s = string(idx);\n-            return (s.startsWith(\"-\")) ?\n-                    (-Integer.parseInt(s.substring(2), 16) \/ 64f) : (Integer.parseInt(s.substring(1), 16) \/ 64f);\n-        }\n-\n-        F32x3(Regex r, Matcher m) {\n-            this(r, m, true);\n-        }\n-    }\n-\n-    record S32xN (Regex regex, Matcher matcher, boolean matched) implements Regex.OK {\n-        S32xN(Regex r, Matcher m) {\n-            this(r, m, true);\n-        }\n-        int count(){\n-            return matcher.groupCount();\n-        }\n-    }\n-\/*\n-    record hex(F32.Vec3 v0,F32.Vec3 v1,F32.Vec3 v2,F32.Vec3 v3,F32.Vec3 v4,F32.Vec3 v5){\n-        static hex of(List<F32.Vec3> vecEntries, S32xN s32xN){\n-            int i6 = s32xN.asInt(6);\n-            int i7 = s32xN.asInt(7);\n-            int i8 = s32xN.asInt(8);\n-            int i9 = s32xN.asInt(9);\n-            int i10 = s32xN.asInt(10);\n-            int i11 = s32xN.asInt(11);\n-            return new hex(\n-                    vecEntries.get(i6),\n-                    vecEntries.get(i7),\n-                    vecEntries.get(i8),\n-                    vecEntries.get(i9),\n-                    vecEntries.get(i10),\n-                    vecEntries.get(i11)\n-            );\n-\n-        }\n-    }\n-    record pent(F32.Vec3 v0,F32.Vec3 v1,F32.Vec3 v2,F32.Vec3 v3,F32.Vec3 v4){\n-        static pent of(List<F32.Vec3> vecEntries, S32xN s32xN){\n-            int i6 = s32xN.asInt(6);\n-            int i7 = s32xN.asInt(7);\n-            int i8 = s32xN.asInt(8);\n-            int i9 = s32xN.asInt(9);\n-            int i10 = s32xN.asInt(10);\n-            return new pent(\n-                    vecEntries.get(i6),\n-                    vecEntries.get(i7),\n-                    vecEntries.get(i8),\n-                    vecEntries.get(i9),\n-                    vecEntries.get(i10)\n-            );\n-\n-        }\n-    }\n-    record quad(F32.Vec3 v0,F32.Vec3 v1,F32.Vec3 v2,F32.Vec3 v3){\n-        static quad of(List<F32.Vec3> vecEntries, S32xN s32xN){\n-            int i6 = s32xN.asInt(6);\n-            int i7 = s32xN.asInt(7);\n-            int i8 = s32xN.asInt(8);\n-            int i9 = s32xN.asInt(9);\n-            return new quad(\n-                    vecEntries.get(i6),\n-                    vecEntries.get(i7),\n-                    vecEntries.get(i8),\n-                    vecEntries.get(i9)\n-            );\n-\n-        }\n-    }\n-    record tri(F32.Vec3 v0,F32.Vec3 v1,F32.Vec3 v2){\n-        static tri of(List<F32.Vec3> vecEntries, S32xN s32xN){\n-            int i6 = s32xN.asInt(6);\n-            int i7 = s32xN.asInt(7);\n-            int i8 = s32xN.asInt(8);\n-            return new tri(\n-                    vecEntries.get(i6),\n-                    vecEntries.get(i7),\n-                    vecEntries.get(i8)\n-            );\n-\n-        }\n-    }\n-*\/\n-    void load(String name) {\n-        final var oldMesh = StreamMutable.of((F32Mesh3D) null);\n-      \/\/  final var newMesh = StreamMutable.of((F32.Mesh) null);\n-        final var sm = new State.Machine().awaiting_name();\n-        new BufferedReader(\n-                new InputStreamReader(EliteMeshReader.class.getResourceAsStream(\"\/meshes\/Elite.txt\"), StandardCharsets.UTF_8))\n-                .lines()\n-                .map(String::trim)\n-                .forEach(line -> {\n-                    switch(sm.state){\n-                        case State.awaiting_name s when s.r().matches(line, whoseMatcher -> whoseMatcher.group(1).equals(name))->{\n-                            sm.awaiting_lazer();\n-                                oldMesh.set(F32Mesh3D.of(name));\n-                        }\n-                        case State.awaiting_lazer s when s.r().matches(line) -> sm.awaiting_counts();\n-                        case State.awaiting_counts s when s.r().matches(line) -> sm.awaiting_vertices();\n-                        case State.awaiting_vertices s when s.r().matches(line) -> sm.awaiting_faces();\n-                        case State.awaiting_faces _ when State.vertexRegex.is(line, F32x3::new) instanceof F32x3 f32x3 ->{\n-\n-                                oldMesh.get().vec3(f32x3.f(1), f32x3.f(2), f32x3.f(3));\n-\n-                        }\n-                        case State.awaiting_faces _ when State.facesRegex.matchesOrThrow(line) ->\n-                                sm.awaiting_hue_lig_sat();\n-                        case State.awaiting_hue_lig_sat _ when State.face6Regex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-\n-                                oldMesh.get().hex(\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(6)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(7)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(8)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(9)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(10)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(11)),\n-                                        0xff7f00);\n-\n-                        }\n-                        case State.awaiting_hue_lig_sat _ when State.face5Regex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-\n-                                   oldMesh.get().pent(\n-                                           oldMesh.get().vecEntries.get(s32xN.asInt(6)),\n-                                           oldMesh.get().vecEntries.get(s32xN.asInt(7)),\n-                                           oldMesh.get().vecEntries.get(s32xN.asInt(8)),\n-                                           oldMesh.get().vecEntries.get(s32xN.asInt(9)),\n-                                           oldMesh.get().vecEntries.get(s32xN.asInt(10)),\n-                                           0x7fff00);\n-\n-                        }\n-                        case State.awaiting_hue_lig_sat _ when State.face4Regex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-\n-                                oldMesh.get().quad(\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(6)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(7)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(8)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(9)),\n-                                        0x00ff7f);\n-\n-                        }\n-                        case State.awaiting_hue_lig_sat _ when State.face3Regex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-\n-                                oldMesh.get().tri(\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(6)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(7)),\n-                                        oldMesh.get().vecEntries.get(s32xN.asInt(8)),\n-                                        0x007fff);\n-\n-                        }\n-                        case State.awaiting_hue_lig_sat s when s.r().matches(line) -> {\n-                                oldMesh.get().fin();\n-                            sm.done();\n-                        }\n-                        case State.awaiting_hue_lig_sat _ when !State.remRegex.matches(line) ->\n-                                System.out.println(\"UNHANDLED \" + line);\n-\n-                        case State.done _-> {}\n-                        case State _ when Regex.any(line, State.remRegex, State.emptyRegex, State.colonRegex).matched()->{}\n-                        case State _ ->{}\n-                    }\n-                });\n-    }\n-\n-}\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/EliteMeshReader.java","additions":0,"deletions":320,"binary":false,"changes":320,"status":"deleted"},{"patch":"@@ -38,0 +38,1 @@\n+import view.f32.F32;\n@@ -39,0 +40,6 @@\n+import view.f32.pool.F32PoolBased;\n+import view.f32.pool.F32x2Pool;\n+import view.f32.pool.F32x2TrianglePool;\n+import view.f32.pool.F32x3Pool;\n+import view.f32.pool.F32x3TrianglePool;\n+import view.f32.pool.F32x4x4Pool;\n@@ -47,5 +54,11 @@\n-       args.add(\"COBRA\");\n-        var eliteReader = new EliteMeshReader();\n-\n-        var wire = RasterizingRenderer.wireOf(1024, 1024);\n-        var fill = RasterizingRenderer.fillOf(1024, 1024);\n+        args.add(\"THARGOID\");\n+        var eliteReader = new EliteMeshParser();\n+        F32 f32 = new F32PoolBased(\n+                new F32x4x4Pool(100),\n+                new F32x3Pool(90000),\n+                new F32x2Pool(12000),\n+                new F32x3TrianglePool(12800),\n+                new F32x2TrianglePool(12800)\n+        );\n+        var wire = RasterizingRenderer.wireOf(f32, 1024, 1024);\n+        var fill = RasterizingRenderer.fillOf(f32, 1024, 1024);\n@@ -56,1 +69,1 @@\n-                            F32Mesh3D.of(\"cubeoctahedron\").cubeoctahedron(0, y, z, 2).fin();\n+                            F32Mesh3D.of(f32,\"cubeoctahedron\").cubeoctahedron(x, y, z, 2).fin();\n@@ -61,1 +74,2 @@\n-        Runnable elite = ()->eliteReader.load(args.getFirst());\n+        Runnable elite = ()->eliteReader.load(f32,args.getFirst());\n+\n@@ -63,2 +77,2 @@\n-                ? ViewFrame.of(\"view\",fill, elite)\n-                : ViewFrame.of(\"true\", fill,cubeoctahedron));\n+                ? ViewFrame.of(f32,\"view\",fill, elite)\n+                : ViewFrame.of(f32,\"true\", fill,cubeoctahedron));\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/Main.java","additions":23,"deletions":9,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -35,1 +35,0 @@\n-import view.f32.F32x2Triangle;\n@@ -37,0 +36,1 @@\n+import view.f32.pool.Pool;\n@@ -43,1 +43,1 @@\n-public record RasterizingRenderer(int width, int height, DisplayMode displayMode, BufferedImage image,\n+public record RasterizingRenderer(F32 f32, int width, int height, DisplayMode displayMode, BufferedImage image,\n@@ -45,1 +45,1 @@\n-    static private Renderer of(int width, int height, DisplayMode displayMode) {\n+    static private Renderer of(F32 f32, int width, int height, DisplayMode displayMode) {\n@@ -47,1 +47,1 @@\n-        return new RasterizingRenderer(width, height, displayMode, image, new int[((DataBufferInt) image.getRaster().getDataBuffer()).getData().length]);\n+        return new RasterizingRenderer(f32,width, height, displayMode, image, new int[((DataBufferInt) image.getRaster().getDataBuffer()).getData().length]);\n@@ -50,2 +50,2 @@\n-    static public Renderer wireOf(int width, int height) {\n-        return of(width, height, DisplayMode.WIRE);\n+    static public Renderer wireOf(F32 f32, int width, int height) {\n+        return of(f32, width, height, DisplayMode.WIRE);\n@@ -54,2 +54,2 @@\n-    static public Renderer fillOf(int width, int height) {\n-        return of(width, height, DisplayMode.FILL);\n+    static public Renderer fillOf(F32 f32, int width, int height) {\n+        return of(f32,width, height, DisplayMode.FILL);\n@@ -62,2 +62,2 @@\n-        for (int t = 0; t < ((F32x2TrianglePool)ViewFrame.f32.f32x2TriangleFactory()).count; t++) {\n-            col = F32.rgb(displayMode.filled,x, y, ((F32x2TrianglePool)ViewFrame.f32.f32x2TriangleFactory()).entry(t),col);\n+        for (int t = 0; t < ((Pool<?,?>) f32.f32x2TriangleFactory()).count(); t++) {\n+            col = F32.rgb(displayMode.filled,x, y, ((F32x2TrianglePool) f32.f32x2TriangleFactory()).entry(t),col);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/RasterizingRenderer.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -28,3 +28,0 @@\n-import view.f32.F32x2;\n-import view.f32.F32x2Triangle;\n-import view.f32.F32x4x4;\n@@ -32,0 +29,1 @@\n+import view.f32.F32x4x4;\n@@ -36,5 +34,2 @@\n-import view.f32.pool.F32x2Pool;\n-import view.f32.pool.F32x2TrianglePool;\n-import view.f32.pool.F32x3Pool;\n-import view.f32.pool.F32x3TrianglePool;\n-import view.f32.pool.F32x4x4Pool;\n+import view.f32.pool.F32PoolBased;\n+import view.f32.pool.Pool;\n@@ -50,2 +45,0 @@\n-import java.awt.event.WindowAdapter;\n-import java.awt.event.WindowEvent;\n@@ -79,5 +72,1 @@\n-    record poolF32(F32x4x4.Factory f32x4x4Factory,\n-                   F32x3.Factory f32x3Factory,\n-                   F32x2.Factory f32x2Factory,\n-                   F32x3Triangle.Factory f32x3TriangleFactory,\n-                   F32x2Triangle.Factory f32x2TriangleFactory\n+    public F32 f32;\n@@ -85,11 +74,3 @@\n-    ) implements F32 {\n-    }\n-    public static F32 f32 = new poolF32(\n-             new F32x4x4Pool(100),\n-            new F32x3Pool(90000),\n-            new F32x2Pool(12000),\n-            new F32x3TrianglePool(12800),\n-            new F32x2TrianglePool(12800)\n- );\n-\n-    private ViewFrame(String name, Renderer renderer, Runnable sceneBuilder) {\n+\n+\n+    private ViewFrame(F32 f32, String name, Renderer renderer, Runnable sceneBuilder) {\n@@ -97,0 +78,1 @@\n+        this.f32 = f32;\n@@ -119,6 +101,1 @@\n-        addWindowListener(new WindowAdapter() {\n-            @Override\n-            public void windowClosing(WindowEvent _windowEvent) {\n-                System.exit(0);\n-            }\n-        });\n+        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n@@ -136,1 +113,1 @@\n-        cameraVec3 = ViewFrame.f32.f32x3Factory().of(originX, originY, originZ);\n+        cameraVec3 = f32.f32x3(originX, originY, originZ);\n@@ -140,2 +117,2 @@\n-        moveAwayVec3 = ViewFrame.f32.f32x3Factory().of(originX, originY, moveAwayZ);\n-        mark = new ModelHighWaterMark();\/\/ mark all buffers.  transforms create new points so this allows us to garbage colect\n+        moveAwayVec3 = f32.f32x3(originX, originY, moveAwayZ);\n+        mark = ModelHighWaterMark.of((F32PoolBased) f32);\/\/ mark all buffers.  transforms create new points so this allows us to garbage colect\n@@ -144,2 +121,2 @@\n-    public static ViewFrame of(String name, Renderer renderer, Runnable sceneBuilder) {\n-        return new ViewFrame(name, renderer, sceneBuilder);\n+    public static ViewFrame of(F32 f32, String name, Renderer renderer, Runnable sceneBuilder) {\n+        return new ViewFrame(f32, name, renderer, sceneBuilder);\n@@ -157,1 +134,1 @@\n-        boolean showHidden = renderer.displayMode() == Renderer.DisplayMode.WIRE_SHOW_HIDDEN;\n+       \/\/ boolean showHidden = ;\n@@ -160,1 +137,1 @@\n-        ModelHighWaterMark resetMark = new ModelHighWaterMark();\n+        ModelHighWaterMark resetMark = ModelHighWaterMark.of((F32PoolBased) f32);\n@@ -164,2 +141,2 @@\n-        for (int tidx = 0; tidx < ((F32x3TrianglePool)ViewFrame.f32.f32x3TriangleFactory()).count; tidx++) {\n-            var t = (F32x3Triangle) ((F32x3TrianglePool)ViewFrame.f32.f32x3TriangleFactory()).entry(tidx);\n+        for (int i = 0; i < ((Pool<?,?>) f32.f32x3TriangleFactory()).count(); i++) {\n+            var f32x3Triangle = (F32x3Triangle) ((Pool<?,?>) f32.f32x3TriangleFactory()).entry(i);\n@@ -168,1 +145,1 @@\n-            t = f32.add(f32.mul(t, xyzRot4x4), moveAwayVec3);\n+            f32x3Triangle = f32.add(f32.mul(f32x3Triangle, xyzRot4x4), moveAwayVec3);\n@@ -170,2 +147,2 @@\n-            boolean isVisible = showHidden;\n-            if (!showHidden) {\n+            boolean isVisible = renderer.displayMode().equals(Renderer.DisplayMode.WIRE_SHOW_HIDDEN);\n+            if (!isVisible) {\n@@ -182,2 +159,1 @@\n-\n-                F32x3 cameraDeltaVec3 = f32.sub(f32.centre(t), cameraVec3);\/\/ clearly our default camera is 0,0,0\n+                F32x3 cameraDeltaVec3 = f32.sub(f32.centre(f32x3Triangle), cameraVec3);\/\/ clearly our default camera is 0,0,0\n@@ -188,1 +164,1 @@\n-                howVisible = f32.dotProd(cameraDeltaVec3, f32.normal(t));\n+                howVisible = f32.dotProd(cameraDeltaVec3, f32.normal(f32x3Triangle));\n@@ -200,1 +176,1 @@\n-                t = f32.mul(t, projF32Mat4x4);\/\/  projection matrix also scales to screen and translate half a screen\n+                f32x3Triangle = f32.mul(f32x3Triangle, projF32Mat4x4);\/\/  projection matrix also scales to screen and translate half a screen\n@@ -202,1 +178,1 @@\n-                zpos.add(new ZPos(t, howVisible));\n+                zpos.add(new ZPos(f32,f32x3Triangle, howVisible));\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/ViewFrame.java","additions":25,"deletions":49,"binary":false,"changes":74,"status":"modified"},{"patch":"@@ -35,3 +35,26 @@\n-    \/\/  https:\/\/stackoverflow.com\/questions\/28075743\/how-do-i-compose-a-rotation-matrix-with-human-readable-angles-from-scratch\/28084380#28084380\n-     default F32x4x4 mul(F32x4x4 lhs, F32x4x4 rhs) {\n-        return f32x4x4Factory().of(\n+\n+    default F32x4x4 f32x4x4(\n+            float x0y0, float x1y0,float x2y0, float x3y0,\n+            float x0y1, float x1y1,float x2y1, float x3y1,\n+            float x0y2, float x1y2,float x2y2, float x3y2,\n+            float x0y3, float x1y3,float x2y3, float x3y3\n+    ){\n+        return f32x4x4Factory().of(x0y0, x1y0,x2y0, x3y0,\n+        x0y1, x1y1,x2y1, x3y1,\n+        x0y2, x1y2,x2y2, x3y2,\n+        x0y3, x1y3,x2y3, x3y3);\n+    }\n+    default F32x2 f32x2(float x, float y){\n+        return f32x2Factory().of(x,y);\n+    }\n+    default F32x3 f32x3(float x, float y,float z){\n+        return f32x3Factory().of(x,y,z);\n+    }\n+    default F32x3Triangle f32x3Triangle(F32x3 v0, F32x3 v1,F32x3 v2,int rgb){\n+        return f32x3TriangleFactory().of(v0,v1,v2,rgb);\n+    }\n+    default F32x2Triangle f32x2Triangle(F32x2 v0, F32x2 v1,F32x2 v2,int rgb){\n+        return f32x2TriangleFactory().of(v0,v1,v2,rgb);\n+    }\n+    default F32x4x4 mul(F32x4x4 lhs, F32x4x4 rhs) {\n+        return f32x4x4(\n@@ -61,0 +84,3 @@\n+    \/\/  https:\/\/stackoverflow.com\/questions\/28075743\/how-do-i-compose-a-rotation-matrix-with-human-readable-angles-from-scratch\/28084380#28084380\n+\n+\n@@ -62,3 +88,2 @@\n-    \/\/ record Transformation(F32Matrix4x4Pool id) implements Impl {\n-     default F32x4x4 transformation(float x, float y, float z) {\n-        return f32x4x4Factory().of(\n+    default F32x4x4 transformation(float x, float y, float z) {\n+        return f32x4x4(\n@@ -76,2 +101,2 @@\n-     default F32x4x4 scale(float x, float y, float z) {\n-        return f32x4x4Factory().of(\n+    default F32x4x4 scale(float x, float y, float z) {\n+        return f32x4x4(\n@@ -82,1 +107,0 @@\n-\n@@ -89,2 +113,1 @@\n-\n-     default F32x4x4 rotX(float thetaRadians) {\n+    default F32x4x4 rotX(float thetaRadians) {\n@@ -93,1 +116,1 @@\n-        return f32x4x4Factory().of(\n+        return f32x4x4(\n@@ -102,1 +125,1 @@\n-     default F32x4x4 rotZ(float thetaRadians) {\n+    default F32x4x4 rotZ(float thetaRadians) {\n@@ -105,1 +128,1 @@\n-        return f32x4x4Factory().of(\n+        return f32x4x4(\n@@ -113,1 +136,1 @@\n-     default F32x4x4 rotY(float thetaRadians) {\n+    default F32x4x4 rotY(float thetaRadians) {\n@@ -116,1 +139,1 @@\n-        return f32x4x4Factory().of(\n+        return f32x4x4(\n@@ -146,2 +169,1 @@\n-\n-     default F32x4x4 projection(float width, float height, float near, float far, float fieldOfViewDeg) {\n+    default F32x4x4 projection(float width, float height, float near, float far, float fieldOfViewDeg) {\n@@ -150,1 +172,1 @@\n-        return f32x4x4Factory().of(\n+        return f32x4x4(\n@@ -154,2 +176,1 @@\n-                    0f, 0f, (-far * near) \/ (far - near), 0f);\n-\n+                0f, 0f, (-far * near) \/ (far - near), 0f);\n@@ -214,1 +235,1 @@\n-\n+    float deltaSquare = 2000f;\n@@ -216,3 +237,3 @@\n-        return onLine(x, y, tri.v0(), tri.v1(), F32x2Triangle.deltaSquare)\n-                || onLine(x, y,tri.v1(),tri.v2(), F32x2Triangle.deltaSquare)\n-                || onLine(x, y, tri.v2(),tri.v0(), F32x2Triangle.deltaSquare);\n+        return onLine(x, y, tri.v0(), tri.v1(), deltaSquare)\n+                || onLine(x, y,tri.v1(),tri.v2(), deltaSquare)\n+                || onLine(x, y, tri.v2(),tri.v0(), deltaSquare);\n@@ -246,1 +267,1 @@\n-        return f32x3TriangleFactory().of(mul(i.v0(), m4), mul(i.v1(), m4), mul(i.v2(), m4), i.rgb());\n+        return f32x3Triangle(mul(i.v0(), m4), mul(i.v1(), m4), mul(i.v2(), m4), i.rgb());\n@@ -250,1 +271,1 @@\n-        return f32x3TriangleFactory().of(add(i.v0(), v3), add(i.v1(), v3), add(i.v2(), v3), i.rgb());\n+        return f32x3Triangle(add(i.v0(), v3), add(i.v1(), v3), add(i.v2(), v3), i.rgb());\n@@ -254,1 +275,1 @@\n-        return f32x3TriangleFactory().of(mul(i.v0(), s), mul(i.v1(), s), mul(i.v2(), s), i.rgb());\n+        return f32x3Triangle(mul(i.v0(), s), mul(i.v1(), s), mul(i.v2(), s), i.rgb());\n@@ -258,1 +279,1 @@\n-        return f32x3TriangleFactory().of(add(i.v0(), s), add(i.v1(), s), add(i.v2(), s), i.rgb());\n+        return f32x3Triangle(add(i.v0(), s), add(i.v1(), s), add(i.v2(), s), i.rgb());\n@@ -283,1 +304,1 @@\n-        F32x3 o = f32x3Factory().of(\n+        F32x3 o = f32x3(\n@@ -296,1 +317,1 @@\n-        return f32x3Factory().of(i.x() * s, i.y() * s, i.z() * s);\n+        return f32x3(i.x() * s, i.y() * s, i.z() * s);\n@@ -301,1 +322,1 @@\n-        return f32x3Factory().of(i.x() + s, i.y() + s, i.z() + s);\n+        return f32x3(i.x() + s, i.y() + s, i.z() + s);\n@@ -308,1 +329,1 @@\n-        return f32x3Factory().of(i.x() \/ s, i.y() \/ s, i.z() \/ s);\n+        return f32x3(i.x() \/ s, i.y() \/ s, i.z() \/ s);\n@@ -312,1 +333,1 @@\n-        return f32x3Factory().of(lhs.x() + rhs.x(), lhs.y() + rhs.y(), lhs.z() + rhs.z());\n+        return f32x3(lhs.x() + rhs.x(), lhs.y() + rhs.y(), lhs.z() + rhs.z());\n@@ -316,1 +337,1 @@\n-        return f32x3Factory().of(lhs.x() - rhs.x(), lhs.y() - rhs.y(), lhs.z() - rhs.z());\n+        return f32x3(lhs.x() - rhs.x(), lhs.y() - rhs.y(), lhs.z() - rhs.z());\n@@ -320,1 +341,1 @@\n-        return f32x3Factory().of(lhs.x() * rhs.x(), lhs.y() * rhs.y(), lhs.z() * rhs.z());\n+        return f32x3(lhs.x() * rhs.x(), lhs.y() * rhs.y(), lhs.z() * rhs.z());\n@@ -324,1 +345,1 @@\n-        return f32x3Factory().of(lhs.x() \/ rhs.x(), lhs.y() \/ rhs.y(), lhs.z() \/ rhs.z());\n+        return f32x3(lhs.x() \/ rhs.x(), lhs.y() \/ rhs.y(), lhs.z() \/ rhs.z());\n@@ -340,1 +361,1 @@\n-        return f32x3Factory().of(\n+        return f32x3(\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32.java","additions":59,"deletions":38,"binary":false,"changes":97,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-import view.ViewFrame;\n@@ -36,1 +35,3 @@\n-    private F32Mesh3D(String name){\n+    F32 f32;\n+    private F32Mesh3D(F32 f32, String name){\n+        this.f32 = f32;\n@@ -39,2 +40,2 @@\n-    public static F32Mesh3D of(String name){\n-        return new F32Mesh3D(name);\n+    public static F32Mesh3D of(F32 f32, String name){\n+        return new F32Mesh3D(f32,name);\n@@ -43,2 +44,2 @@\n-        static Face of (F32x3Triangle tri){\n-           return  new Face(tri, ViewFrame.f32.centre(tri), ViewFrame.f32.normal(tri),tri.v0());\n+        static Face of (F32 f32, F32x3Triangle tri){\n+           return  new Face(tri, f32.centre(tri), f32.normal(tri),tri.v0());\n@@ -49,0 +50,1 @@\n+    public List<F32x3> vecEntries = new ArrayList<>();\n@@ -50,1 +52,0 @@\n-    public List<F32x3> vecEntries = new ArrayList<>();\/\/ F32Vec3.F32Vec3Pool.Idx[MAX];\n@@ -53,6 +54,0 @@\n-    public Face tri(F32x3 v0, F32x3 v1, F32x3 v2, int rgb) {\n-        Face face =Face.of(ViewFrame.f32.f32x3TriangleFactory().of(v0, v1, v2, rgb));\n-        faces.add(face);\n-        return face;\n-    }\n-\n@@ -62,1 +57,1 @@\n-            triSumIdx.set(ViewFrame.f32.add(triSumIdx.get(), face.centerVec3Idx));\n+            triSumIdx.set(f32.add(triSumIdx.get(), face.centerVec3Idx));\n@@ -64,1 +59,1 @@\n-        var meshCenterVec3 = ViewFrame.f32.div(triSumIdx.get(), faces.size());\n+        var meshCenterVec3 = f32.div(triSumIdx.get(), faces.size());\n@@ -66,2 +61,2 @@\n-            var v0CenterDiff = ViewFrame.f32.sub(meshCenterVec3,face.v0VecIdx);\n-            float normDotProd = ViewFrame.f32.dotProd(v0CenterDiff, face.normalIdx);\n+            var v0CenterDiff = f32.sub(meshCenterVec3,face.v0VecIdx);\n+            float normDotProd = f32.dotProd(v0CenterDiff, face.normalIdx);\n@@ -74,0 +69,18 @@\n+    public F32Mesh3D tri(int[] indices,int rgb){\n+        return tri(indices[0], indices[1], indices[2],rgb);\n+    }\n+    private F32Mesh3D tri(int idx0, int idx1, int idx2,int rgb){\n+        return tri(vecEntries.get(idx0), vecEntries.get(idx1), vecEntries.get(idx2),rgb);\n+    }\n+    private F32Mesh3D tri(F32x3 v0, F32x3 v1, F32x3 v2, int rgb) {\n+        Face face =Face.of(f32, f32.f32x3Triangle(v0, v1, v2, rgb));\n+        faces.add(face);\n+        return this;\n+    }\n+    public F32Mesh3D quad(int[] indices,int rgb){\n+        return quad(indices[0], indices[1], indices[2],indices[3],rgb);\n+    }\n+    private F32Mesh3D quad(int idx0, int idx1, int idx2, int idx3,int rgb){\n+        return quad(vecEntries.get(idx0), vecEntries.get(idx1),\n+                vecEntries.get(idx2), vecEntries.get(idx3),rgb);\n+    }\n@@ -75,1 +88,1 @@\n-    public F32Mesh3D quad(F32x3 v0, F32x3 v1, F32x3 v2, F32x3 v3, int rgb) {\n+    private F32Mesh3D quad(F32x3 v0, F32x3 v1, F32x3 v2, F32x3 v3, int rgb) {\n@@ -90,2 +103,8 @@\n-\n-    public F32Mesh3D pent(F32x3 v0, F32x3 v1, F32x3 v2, F32x3 v3, F32x3 v4, int rgb) {\n+    public F32Mesh3D pent(int[] indices,int rgb){\n+        return pent(indices[0], indices[1], indices[2],indices[3],indices[4],rgb);\n+    }\n+    private F32Mesh3D pent(int idx0, int idx1, int idx2, int idx3, int idx4,int rgb){\n+        return pent(vecEntries.get(idx0), vecEntries.get(idx1),\n+                vecEntries.get(idx2), vecEntries.get(idx3),vecEntries.get(idx4),rgb);\n+    }\n+    private F32Mesh3D pent(F32x3 v0, F32x3 v1, F32x3 v2, F32x3 v3, F32x3 v4, int rgb) {\n@@ -107,1 +126,8 @@\n-    public F32Mesh3D hex(F32x3 v0, F32x3 v1, F32x3 v2, F32x3 v3, F32x3 v4, F32x3 v5, int rgb) {\n+    public F32Mesh3D hex(int[] indices,int rgb){\n+        return hex(indices[0], indices[1], indices[2],indices[3],indices[4],indices[5],rgb);\n+    }\n+    private F32Mesh3D hex(int idx0, int idx1, int idx2, int idx3, int idx4, int idx5,int rgb){\n+        return hex(vecEntries.get(idx0), vecEntries.get(idx1),\n+                vecEntries.get(idx2), vecEntries.get(idx3),vecEntries.get(idx4),vecEntries.get(idx5),rgb);\n+    }\n+    private F32Mesh3D hex(F32x3 v0, F32x3 v1, F32x3 v2, F32x3 v3, F32x3 v4, F32x3 v5, int rgb) {\n@@ -222,1 +248,1 @@\n-        var newVec = ViewFrame.f32.f32x3Factory().of(x,y, z);\n+        var newVec = f32.f32x3(x,y, z);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32Mesh3D.java","additions":48,"deletions":22,"binary":false,"changes":70,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-\n-import view.f32.factories.Factory16;\n@@ -30,1 +28,0 @@\n-import view.f32.pool.F32x2Pool;\n@@ -35,2 +32,0 @@\n-\n-\n@@ -40,1 +35,1 @@\n-   \/\/ Factory factory = f32x2Pool;\n+\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x2.java","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-import view.f32.factories.Factory3;\n@@ -29,1 +28,0 @@\n-import view.f32.pool.F32x2TrianglePool;\n@@ -33,1 +31,0 @@\n-\n@@ -35,1 +32,0 @@\n-\n@@ -37,1 +33,0 @@\n-\n@@ -39,2 +34,1 @@\n-\n-      @FunctionalInterface\n+    @FunctionalInterface\n@@ -43,5 +37,0 @@\n-\n-\n-    float deltaSquare = 2000f;\n-\n-\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x2Triangle.java","additions":1,"deletions":12,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -26,2 +26,0 @@\n-\n-import view.f32.factories.Factory2;\n@@ -29,1 +27,0 @@\n-import view.f32.pool.F32x3Pool;\n@@ -33,1 +30,0 @@\n-\n@@ -35,1 +31,0 @@\n-\n@@ -37,2 +32,0 @@\n-\n-\n@@ -42,3 +35,1 @@\n-\n-\n-     @FunctionalInterface\n+    @FunctionalInterface\n@@ -47,2 +38,0 @@\n-\n-\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x3.java","additions":1,"deletions":12,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -32,1 +32,0 @@\n-\n@@ -34,1 +33,0 @@\n-\n@@ -36,1 +34,0 @@\n-\n@@ -38,1 +35,0 @@\n-\n@@ -42,2 +38,0 @@\n-\n-\n@@ -47,2 +41,0 @@\n-\n-\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x3Triangle.java","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -26,2 +26,0 @@\n-\n-\n@@ -29,1 +27,0 @@\n-import view.f32.pool.F32x4x4Pool;\n@@ -78,2 +75,0 @@\n-\n-\n@@ -86,1 +81,0 @@\n-\n@@ -88,2 +82,0 @@\n-\n-\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x4x4.java","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -26,7 +26,2 @@\n-\n-import view.ViewFrame;\n-import view.f32.pool.F32x2Pool;\n-import view.f32.pool.F32x2TrianglePool;\n-import view.f32.pool.F32x3Pool;\n-import view.f32.pool.F32x3TrianglePool;\n-import view.f32.pool.F32x4x4Pool;\n+import view.f32.pool.F32PoolBased;\n+import view.f32.pool.Pool;\n@@ -35,0 +30,1 @@\n+        F32PoolBased f32,\n@@ -41,7 +37,10 @@\n-    public ModelHighWaterMark() {\n-        this(\n-                ((F32x3TrianglePool)ViewFrame.f32.f32x3TriangleFactory()).count,\n-                ((F32x2TrianglePool)ViewFrame.f32.f32x2TriangleFactory()).count,\n-                ((F32x2Pool)ViewFrame.f32.f32x2Factory()).count,\n-                ((F32x3Pool)ViewFrame.f32.f32x3Factory()).count,\n-                ((F32x4x4Pool)ViewFrame.f32.f32x4x4Factory()).count);\n+    public static ModelHighWaterMark of(F32PoolBased f32){\n+        return new ModelHighWaterMark(\n+                f32,\n+                ((Pool<?,?>) f32.f32x3TriangleFactory()).count(),\n+                ((Pool<?,?>) f32.f32x2TriangleFactory()).count(),\n+                ((Pool<?,?>) f32.f32x2Factory()).count(),\n+                ((Pool<?,?>) f32.f32x3Factory()).count(),\n+                ((Pool<?,?>) f32.f32x4x4Factory()).count()\n+        );\n+\n@@ -52,2 +51,2 @@\n-        ((F32x2TrianglePool)ViewFrame.f32.f32x2TriangleFactory()).reset(markedTriangles2D);\n-        ((F32x2Pool)ViewFrame.f32.f32x2Factory()).reset(markedVec2);\n+        ((Pool<?,?>) f32.f32x2TriangleFactory()).reset(markedTriangles2D);\n+        ((Pool<?,?>) f32.f32x2Factory()).reset(markedVec2);\n@@ -57,3 +56,3 @@\n-        ((F32x3TrianglePool)ViewFrame.f32.f32x3TriangleFactory()).count = markedTriangles3D;\n-        ((F32x3Pool)ViewFrame.f32.f32x3Factory()).count = markedVec3;\n-        ((F32x4x4Pool)ViewFrame.f32.f32x4x4Factory()).count = markedMat4;\n+        ((Pool<?,?>) f32.f32x3TriangleFactory()).reset(markedTriangles3D);\n+        ((Pool<?,?>) f32.f32x3Factory()).reset(markedVec3);\n+        ((Pool<?,?>) f32.f32x4x4Factory()).reset(markedMat4);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/ModelHighWaterMark.java","additions":18,"deletions":19,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -28,2 +28,0 @@\n-import view.ViewFrame;\n-\n@@ -33,6 +31,9 @@\n-\n-    float x0, y0, x1, y1, x2, y2;\n-    float z0, z1, z2;\n-    float z;\n-    float howVisible;\n-    int rgb;\n+    F32 f32;\n+    final F32x3 v0;\n+    final F32x3 v1;\n+    final F32x3 v2;\n+    final float x0, y0, x1, y1, x2, y2;\n+    final float z0, z1, z2;\n+    final float z;\n+    final float howVisible;\n+    final int rgb;\n@@ -45,13 +46,14 @@\n-    public ZPos(F32x3Triangle t, float howVisible) {\n-        F32x3 v0 = t.v0();\n-        F32x3 v1 = t.v1();\n-        F32x3 v2 = t.v2();\n-        x0 = v0.x();\n-        y0 = v0.y();\n-        z0 = v0.z();\n-        x1 = v1.x();\n-        y1 =  v1.y();\n-        z1 = v1.z();\n-        x2 =  v2.x();\n-        y2 =  v2.y();\n-        z2 = v2.z();\n+    public ZPos(F32 f32, F32x3Triangle t, float howVisible) {\n+        this.f32 = f32;\n+        this.v0 = t.v0();\n+        this.v1 = t.v1();\n+        this.v2 = t.v2();\n+        this.x0 = v0.x();\n+        this.y0 = v0.y();\n+        this.z0 = v0.z();\n+        this.x1 = v1.x();\n+        this.y1 =  v1.y();\n+        this.z1 = v1.z();\n+        this.x2 =  v2.x();\n+        this.y2 =  v2.y();\n+        this.z2 = v2.z();\n@@ -60,1 +62,1 @@\n-        z = Math.min(z0, Math.min(z1, z2));\n+        this.z = Math.min(z0, Math.min(z1, z2));\n@@ -84,4 +86,4 @@\n-        F32x2 v0 = ViewFrame.f32.f32x2Factory().of(x0,y0);\n-        F32x2 v1 = ViewFrame.f32.f32x2Factory().of(x1,y1);\n-        F32x2 v2 = ViewFrame.f32.f32x2Factory().of(x2,y2);\n-        return ViewFrame.f32.f32x2TriangleFactory().of(v0,v1,v2, (r & 0xff) << 16 | (g & 0xff) << 8 | (b & 0xff));\n+        F32x2 v0 = f32.f32x2(x0,y0);\n+        F32x2 v1 = f32.f32x2(x1,y1);\n+        F32x2 v2 = f32.f32x2(x2,y2);\n+        return f32.f32x2Triangle(v0,v1,v2, (r & 0xff) << 16 | (g & 0xff) << 8 | (b & 0xff));\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/ZPos.java","additions":28,"deletions":26,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-public abstract class F32Pool<T extends F32Pool<T>> extends Pool<T> {\n+public abstract class F32Pool<T, P extends F32Pool<T, P>> extends Pool<T, P> {\n@@ -29,2 +29,2 @@\n-    protected final int stride;\n-    F32Pool(int stride, int max) {\n+    protected final int floatStride;\n+    F32Pool(int floatStride, int max) {\n@@ -32,2 +32,2 @@\n-        this.stride=stride;\n-        this.floatEntries = new float[max * stride];\n+        this.floatStride = floatStride;\n+        this.floatEntries = new float[max * floatStride];\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32Pool.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -0,0 +1,41 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package view.f32.pool;\n+\n+import view.f32.F32;\n+import view.f32.F32x2;\n+import view.f32.F32x2Triangle;\n+import view.f32.F32x3;\n+import view.f32.F32x3Triangle;\n+import view.f32.F32x4x4;\n+\n+public record F32PoolBased(F32x4x4.Factory f32x4x4Factory,\n+                           F32x3.Factory f32x3Factory,\n+                           F32x2.Factory f32x2Factory,\n+                           F32x3Triangle.Factory f32x3TriangleFactory,\n+                           F32x2Triangle.Factory f32x2TriangleFactory\n+\n+) implements F32 {\n+}\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32PoolBased.java","additions":41,"deletions":0,"binary":false,"changes":41,"status":"added"},{"patch":"@@ -28,1 +28,0 @@\n-import view.f32.factories.Factory2;\n@@ -30,1 +29,1 @@\n-public class F32x2Pool extends F32Pool<F32x2Pool> implements F32x2.Factory {\n+public class F32x2Pool extends F32Pool<F32x2,F32x2Pool> implements F32x2.Factory {\n@@ -34,4 +33,1 @@\n-\n-\n-\n-    public record PoolEntry(F32x2Pool pool, int idx) implements Pool.PoolEntry<F32x2Pool>, F32x2 {\n+    public record PoolEntry(F32x2Pool pool, int idx) implements Pool.PoolEntry<F32x2,F32x2Pool>, F32x2 {\n@@ -39,1 +35,1 @@\n-            return pool.stride * idx + X;\n+            return pool.floatStride * idx + X;\n@@ -48,1 +44,1 @@\n-            return pool.stride * idx + Y;\n+            return pool.floatStride * idx + Y;\n@@ -63,1 +59,1 @@\n-    PoolEntry entry(int idx) {\n+    public F32x2 entry(int idx) {\n@@ -69,1 +65,1 @@\n-        PoolEntry i = entry(count++);\n+        PoolEntry i = (PoolEntry) entry(count++);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x2Pool.java","additions":6,"deletions":10,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -30,2 +30,0 @@\n-import view.f32.F32x3Triangle;\n-import view.f32.factories.Factory4;\n@@ -33,1 +31,1 @@\n-public class F32x2TrianglePool extends Pool<F32x2TrianglePool> implements F32x2Triangle.Factory {\n+public class F32x2TrianglePool extends Pool<F32x2Triangle,F32x2TrianglePool> implements F32x2Triangle.Factory {\n@@ -37,4 +35,1 @@\n-\n-\n-\n-    public record PoolEntry(F32x2TrianglePool pool, int idx) implements Pool.PoolEntry<F32x2TrianglePool>, F32x2Triangle {\n+    public record PoolEntry(F32x2TrianglePool pool, int idx) implements Pool.PoolEntry<F32x2Triangle,F32x2TrianglePool>, F32x2Triangle {\n@@ -42,1 +37,1 @@\n-            return pool.vecStride * idx + V0;\n+            return pool.f32x2Stride * idx + V0;\n@@ -44,1 +39,0 @@\n-\n@@ -48,3 +42,2 @@\n-\n-        int v1Idx() {\n-            return pool.vecStride * idx + V1;\n+        private int v1Idx() {\n+            return pool.f32x2Stride * idx + V1;\n@@ -52,1 +45,0 @@\n-\n@@ -56,3 +48,2 @@\n-\n-        int v2Idx() {\n-            return pool.vecStride * idx + V2;\n+        private int v2Idx() {\n+            return pool.f32x2Stride * idx + V2;\n@@ -60,1 +51,0 @@\n-\n@@ -64,2 +54,1 @@\n-\n-        int rgbIdx() {\n+        private int rgbIdx() {\n@@ -68,1 +57,0 @@\n-\n@@ -75,1 +63,1 @@\n-    private final int vecStride = 3;\n+    private final int f32x2Stride = 3;\n@@ -81,1 +69,1 @@\n-        this.f32X2Entries = new F32x2[max * vecStride];\n+        this.f32X2Entries = new F32x2[max * f32x2Stride];\n@@ -86,1 +74,1 @@\n-    public PoolEntry entry(int idx) {\n+    public F32x2Triangle entry(int idx) {\n@@ -93,1 +81,1 @@\n-        var i = entry(count++);\n+        var i = (PoolEntry) entry(count++);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x2TrianglePool.java","additions":12,"deletions":24,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-import view.f32.F32x2;\n@@ -29,1 +28,0 @@\n-import view.f32.factories.Factory3;\n@@ -31,1 +29,1 @@\n-public class F32x3Pool extends F32Pool<F32x3Pool> implements F32x3.Factory {\n+public class F32x3Pool extends F32Pool<F32x3,F32x3Pool> implements F32x3.Factory {\n@@ -36,1 +34,1 @@\n-    public record PoolEntry(F32x3Pool pool, int idx) implements Pool.PoolEntry<F32x3Pool>, F32x3 {\n+    public record PoolEntry(F32x3Pool pool, int idx) implements Pool.PoolEntry<F32x3, F32x3Pool>, F32x3 {\n@@ -38,1 +36,1 @@\n-            return pool.stride * idx + X;\n+            return pool.floatStride * idx + X;\n@@ -47,1 +45,1 @@\n-            return pool.stride * idx + Y;\n+            return pool.floatStride * idx + Y;\n@@ -56,1 +54,1 @@\n-            return pool.stride * idx + Z;\n+            return pool.floatStride * idx + Z;\n@@ -70,1 +68,1 @@\n-    PoolEntry entry(int idx) {\n+    public F32x3 entry(int idx) {\n@@ -76,1 +74,1 @@\n-        PoolEntry i = entry(count++);\n+        PoolEntry i = (PoolEntry) entry(count++);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x3Pool.java","additions":7,"deletions":9,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -26,1 +26,0 @@\n-\n@@ -29,1 +28,0 @@\n-import view.f32.factories.Factory4;\n@@ -31,1 +29,1 @@\n-public class F32x3TrianglePool extends Pool<F32x3TrianglePool> implements F32x3Triangle.Factory{\n+public class F32x3TrianglePool extends Pool<F32x3Triangle,F32x3TrianglePool> implements F32x3Triangle.Factory{\n@@ -36,4 +34,2 @@\n-\n-\n-    public record PoolEntry(F32x3TrianglePool pool,\n-                            int idx) implements Pool.PoolEntry<F32x3TrianglePool>, F32x3Triangle {\n+    public record PoolEntry(F32x3TrianglePool pool, int idx)\n+            implements Pool.PoolEntry<F32x3Triangle,F32x3TrianglePool>, F32x3Triangle {\n@@ -41,1 +37,1 @@\n-            return F32x3TrianglePool.vecStride * idx + V0;\n+            return F32x3TrianglePool.f32x3Stride * idx + V0;\n@@ -49,1 +45,1 @@\n-            return F32x3TrianglePool.vecStride * idx + V1;\n+            return F32x3TrianglePool.f32x3Stride * idx + V1;\n@@ -57,1 +53,1 @@\n-            return F32x3TrianglePool.vecStride * idx + V2;\n+            return F32x3TrianglePool.f32x3Stride * idx + V2;\n@@ -74,1 +70,1 @@\n-    private final static int vecStride = 3;\n+    private final static int f32x3Stride = 3;\n@@ -80,1 +76,1 @@\n-        this.f32x3Entries = new F32x3[max * vecStride];\n+        this.f32x3Entries = new F32x3[max * f32x3Stride];\n@@ -85,1 +81,1 @@\n-    public PoolEntry entry(int idx) {\n+    public F32x3Triangle entry(int idx) {\n@@ -92,1 +88,1 @@\n-        var i = entry(count++);\n+        var i = (PoolEntry)entry(count++);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x3TrianglePool.java","additions":10,"deletions":14,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-public class F32x4x4Pool extends F32Pool<F32x4x4Pool> implements F32x4x4.Factory {\n+public class F32x4x4Pool extends F32Pool<F32x4x4,F32x4x4Pool> implements F32x4x4.Factory {\n@@ -50,1 +50,1 @@\n-    public record PoolEntry(F32x4x4Pool pool, int idx) implements Pool.PoolEntry<F32x4x4Pool>, F32x4x4 {\n+    public record PoolEntry(F32x4x4Pool pool, int idx) implements Pool.PoolEntry<F32x4x4, F32x4x4Pool>, F32x4x4 {\n@@ -52,1 +52,1 @@\n-            return idx * pool.stride + X0Y0;\n+            return idx * pool.floatStride + X0Y0;\n@@ -56,1 +56,1 @@\n-            return idx * pool.stride + X1Y0;\n+            return idx * pool.floatStride + X1Y0;\n@@ -60,1 +60,1 @@\n-            return idx * pool.stride + X2Y0;\n+            return idx * pool.floatStride + X2Y0;\n@@ -64,1 +64,1 @@\n-            return idx * pool.stride + X3Y0;\n+            return idx * pool.floatStride + X3Y0;\n@@ -68,1 +68,1 @@\n-            return idx * pool.stride + X0Y1;\n+            return idx * pool.floatStride + X0Y1;\n@@ -72,1 +72,1 @@\n-            return idx * pool.stride + X1Y1;\n+            return idx * pool.floatStride + X1Y1;\n@@ -76,1 +76,1 @@\n-            return idx * pool.stride + X2Y1;\n+            return idx * pool.floatStride + X2Y1;\n@@ -80,1 +80,1 @@\n-            return idx * pool.stride + X3Y1;\n+            return idx * pool.floatStride + X3Y1;\n@@ -84,1 +84,1 @@\n-            return idx * pool.stride + X0Y2;\n+            return idx * pool.floatStride + X0Y2;\n@@ -88,1 +88,1 @@\n-            return idx * pool.stride + X1Y2;\n+            return idx * pool.floatStride + X1Y2;\n@@ -92,1 +92,1 @@\n-            return idx * pool.stride + X2Y2;\n+            return idx * pool.floatStride + X2Y2;\n@@ -96,1 +96,1 @@\n-            return idx * pool.stride + X3Y2;\n+            return idx * pool.floatStride + X3Y2;\n@@ -100,1 +100,1 @@\n-            return idx * pool.stride + X0Y3;\n+            return idx * pool.floatStride + X0Y3;\n@@ -104,1 +104,1 @@\n-            return idx * pool.stride + X1Y3;\n+            return idx * pool.floatStride + X1Y3;\n@@ -108,1 +108,1 @@\n-            return idx * pool.stride + X2Y3;\n+            return idx * pool.floatStride + X2Y3;\n@@ -112,1 +112,1 @@\n-            return idx * pool.stride + X3Y3;\n+            return idx * pool.floatStride + X3Y3;\n@@ -201,1 +201,1 @@\n-    PoolEntry entry(int idx) {\n+    public F32x4x4 entry(int idx) {\n@@ -209,1 +209,1 @@\n-        var i = entry(count++);\n+        var i = (PoolEntry)entry(count++);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x4x4Pool.java","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -27,3 +27,3 @@\n-public abstract class Pool<T extends Pool<T>> {\n-    interface PoolEntry<T extends Pool<T>>{\n-        T pool();\n+public abstract class Pool<T, P extends Pool<T,P>> {\n+    interface PoolEntry<T, P >{\n+        P pool();\n@@ -33,3 +33,6 @@\n-    public int count = 0;\n-    public final void reset(int newCount) {\n-        count = newCount;\n+    protected int count = 0;\n+    public int count(){\n+        return this.count;\n+    }\n+    public final void reset(int count) {\n+        this.count = count;\n@@ -40,1 +43,1 @@\n-    abstract PoolEntry<T> entry(int idx);\n+    public abstract T entry(int idx);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/Pool.java","additions":10,"deletions":7,"binary":false,"changes":17,"status":"modified"}]}