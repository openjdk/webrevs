{"files":[{"patch":"@@ -70,1 +70,0 @@\n-        var here = CallSite.of(FFIBackend.class, \"dispatchCompute\");\n@@ -73,1 +72,1 @@\n-                    lower(here, computeContext.computeEntrypoint().funcOp());\n+                    lower(CallSite.of(FFIBackend.class), computeContext.computeEntrypoint().funcOp());\n@@ -75,1 +74,0 @@\n-\n@@ -86,1 +84,0 @@\n-              \/\/  System.out.println(computeContext.computeEntrypoint().lowered.toText());\n@@ -141,1 +138,0 @@\n-            var lookup = computeMethod.callGraph.lookup();\n@@ -147,1 +143,1 @@\n-                    if (isIfaceBufferMethod(lookup, invokeOp)&& javaReturnType(invokeOp).equals(JavaType.VOID)) {                    \/\/ iface.v(newV)\n+                    if (isIfaceBufferMethod(lookup(), invokeOp) && javaReturnType(invokeOp).equals(JavaType.VOID)) {                    \/\/ iface.v(newV)\n@@ -152,1 +148,1 @@\n-                    } else if (isIfaceBufferMethod(lookup, invokeOp)\n+                    } else if (isIfaceBufferMethod(lookup(), invokeOp)\n@@ -155,1 +151,1 @@\n-                                            && classTypeToTypeOrThrow(lookup, returnClassType) instanceof Class<?> type\n+                                            && classTypeToTypeOrThrow(lookup(), returnClassType) instanceof Class<?> type\n@@ -166,1 +162,1 @@\n-                    } else if (isComputeContextMethod(lookup,invokeOp) || OpTk.isKernelContextInvokeOp(lookup,invokeOp,OpTkl.AnyInvoke)) { \/\/dispatchKernel\n+                    } else if (isComputeContextMethod(lookup(),invokeOp) || OpTk.isKernelContextInvokeOp(lookup(),invokeOp,OpTkl.AnyInvoke)) { \/\/dispatchKernel\n@@ -171,1 +167,1 @@\n-                            System.out.println(\"Escape! with args \" +invokeOp.toText());\n+                          \/\/  System.out.println(\"Escape! with args \" +invokeOp.toText());\n@@ -173,1 +169,3 @@\n-                            Annotation[][] parameterAnnotations = methodOrThrow(lookup, invokeOp).getParameterAnnotations();\n+                            var m = methodOrThrow(lookup(), invokeOp);\n+\n+                            Annotation[][] parameterAnnotations = m.getParameterAnnotations();\n@@ -182,1 +180,1 @@\n-                                    .filter(typeAndAccess -> typeAndAccess.isIface(lookup))\/\/InvokeOpWrapper.isIfaceUsingLookup(prevFOW.lookup, typeAndAccess.javaType))\n+                                    .filter(typeAndAccess -> typeAndAccess.isIface(lookup()))\/\/InvokeOpWrapper.isIfaceUsingLookup(prevFOW.lookup, typeAndAccess.javaType))\n@@ -192,1 +190,1 @@\n-                                    .filter(typeAndAccess -> isAssignable(lookup, typeAndAccess.javaType, MappableIface.class))\n+                                    .filter(typeAndAccess -> isAssignable(lookup(), typeAndAccess.javaType, MappableIface.class))\n","filename":"hat\/backends\/ffi\/shared\/src\/main\/java\/hat\/backend\/ffi\/FFIBackend.java","additions":11,"deletions":13,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -72,1 +72,1 @@\n-     void update(long now, @MappableIface.RO Main.CellGrid cellGrid, int from) {\n+     public void update(long now, @MappableIface.RO Main.CellGrid cellGrid, int from) {\n","filename":"hat\/examples\/life\/src\/main\/java\/life\/Viewer.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n-  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_X\" project-jdk-name=\"Babylon Dec15\" project-jdk-type=\"JavaSDK\">\n+  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_X\" project-jdk-name=\"Babylon Dec 23\" project-jdk-type=\"JavaSDK\">\n","filename":"hat\/intellij\/.idea\/misc.xml","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -14,0 +14,2 @@\n+    <orderEntry type=\"module\" module-name=\"backend_ffi_shared\" \/>\n+    <orderEntry type=\"module\" module-name=\"backend_ffi_opencl\" \/>\n","filename":"hat\/intellij\/example_life.iml","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -41,0 +41,1 @@\n+import optkl.annotations.Kernel;\n@@ -121,1 +122,6 @@\n-           .findFirst().orElseThrow();\n+           .filter(invokeOp -> invokeOp.invokeKind().equals(JavaOp.InvokeOp.InvokeKind.STATIC))\n+           .filter(invokeOp -> invokeOp.operands().get(0).type() instanceof ClassType classType\n+                   && classType.toClassName() instanceof String name\n+                   && (name.equals(\"hat.ComputeContext\")||name.equals(\"hat.KernelContext\")))\n+           .findFirst()\n+           .orElseThrow();\n","filename":"hat\/optkl\/src\/main\/java\/optkl\/OpTkl.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}