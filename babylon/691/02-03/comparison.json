{"files":[{"patch":"@@ -332,1 +332,0 @@\n-            \/\/ Lambda parameter types as first sequence of function parameter types\n@@ -334,1 +333,0 @@\n-            \/\/ Lambda capture types as subsequence sequence of function parameter types\n@@ -336,6 +334,2 @@\n-                if (v.type() instanceof VarType vt) {\n-                    \/\/ Unpack var type\n-                    parameters.add(vt.valueType());\n-                } else {\n-                    parameters.add(v.type());\n-                }\n+                TypeElement capturedType = v.type() instanceof VarType varType ? varType.valueType() : v.type();\n+                parameters.add(capturedType);\n@@ -343,1 +337,0 @@\n-\n@@ -345,8 +338,5 @@\n-                int pos = this.invokableType().parameterTypes().size();\n-                \/\/ Map captured values, creating inlined var operations\n-                for (Value capturedValue : this.capturedValues()) {\n-                    Block.Parameter p = builder.parameters().get(pos++);\n-                    Value functionValue = capturedValue.type() instanceof VarType\n-                            ? builder.op(CoreOp.var(p))\n-                            : p;\n-                    builder.context().mapValue(capturedValue, functionValue);\n+                int idx = this.invokableType().parameterTypes().size();\n+                for (Value v : capturedValues()) {\n+                    Block.Parameter p = builder.parameters().get(idx++);\n+                    Value functionValue = v.type() instanceof VarType ? builder.op(CoreOp.var(p)) : p;\n+                    builder.context().mapValue(v, functionValue);\n@@ -354,3 +344,0 @@\n-\n-                \/\/ Copy the lambda body into the function body\n-                \/\/ Mapping the lambda's operands to first sequence of function parameters\n@@ -362,19 +349,0 @@\n-\n-        \/\/ public CoreOp.FuncOp toFuncOp(String lambdaName) {\n-        \/\/     List<TypeElement> parameters = new ArrayList<>(this.invokableType().parameterTypes());\n-        \/\/     for (Value v : this.capturedValues()) {\n-        \/\/         TypeElement capturedType = v.type() instanceof VarType varType ? varType.valueType() : v.type();\n-        \/\/         parameters.add(capturedType);\n-        \/\/     }\n-        \/\/     return CoreOp.func(lambdaName, CoreType.functionType(this.invokableType().returnType(), parameters)).body(builder -> {\n-        \/\/         int idx = this.invokableType().parameterTypes().size();\n-        \/\/         for (Value v : capturedValues()) {\n-        \/\/             Block.Parameter p = builder.parameters().get(idx++);\n-        \/\/             Value functionValue = v.type() instanceof VarType ? builder.op(CoreOp.var(p)) : p;\n-        \/\/             builder.context().mapValue(v, functionValue);\n-        \/\/         }\n-        \/\/         List<Block.Parameter> outputValues = builder.parameters().subList(0, this.invokableType().parameterTypes().size());\n-        \/\/         builder.body(this.body(), outputValues, CodeTransformer.COPYING_TRANSFORMER);\n-        \/\/     });\n-        \/\/ }\n-\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/dialect\/java\/JavaOp.java","additions":7,"deletions":39,"binary":false,"changes":46,"status":"modified"}]}