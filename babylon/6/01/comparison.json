{"files":[{"patch":"@@ -142,1 +142,1 @@\n-            super(block, op.descriptor().returnType());\n+            super(block, op.resultType()); \/\/ we can call resultType\n@@ -174,2 +174,0 @@\n-    final TypeDesc resultType;\n-\n@@ -185,1 +183,1 @@\n-        this(that.name, that.resultType, cc.getValues(that.operands));\n+        this(that.name, cc.getValues(that.operands));\n@@ -226,1 +224,1 @@\n-     * Constructs an operation with a name, operation result type, and list of operands.\n+     * Constructs an operation with a name and list of operands.\n@@ -229,1 +227,0 @@\n-     * @param resultType the operation result type.\n@@ -232,1 +229,1 @@\n-    protected Op(String name, TypeDesc resultType, List<? extends Value> operands) {\n+    protected Op(String name, List<? extends Value> operands) {\n@@ -234,1 +231,0 @@\n-        this.resultType = resultType;\n@@ -322,3 +318,1 @@\n-    public TypeDesc resultType() {\n-        return resultType;\n-    }\n+    public abstract TypeDesc resultType();\n@@ -336,1 +330,1 @@\n-        return MethodTypeDesc.methodType(resultType, operandTypes);\n+        return MethodTypeDesc.methodType(resultType(), operandTypes);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/Op.java","additions":6,"deletions":12,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -127,1 +127,1 @@\n-            super(name, TypeDesc.VOID, List.of());\n+            super(name, List.of());\n@@ -142,0 +142,7 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            \/\/ I chose VOID, because bytecode instructions manipulate the stack\n+            \/\/ plus the type of what an operation will push\/pop mayn not be known, e.g. pop instruction\n+            return TypeDesc.VOID;\n+        }\n@@ -2280,0 +2287,2 @@\n+        private final TypeDesc resultType;\n+\n@@ -2282,0 +2291,1 @@\n+            this.resultType = that.resultType;\n@@ -2285,1 +2295,2 @@\n-            super(name, resultType, operands);\n+            super(name, operands);\n+            this.resultType = resultType;\n@@ -2299,0 +2310,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return resultType;\n+        }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/bytecode\/BytecodeInstructionOps.java","additions":18,"deletions":2,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-import java.lang.constant.ClassDesc;\n@@ -140,1 +139,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -180,0 +179,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return body().yieldType();\n+        }\n@@ -193,0 +197,1 @@\n+        final TypeDesc resultType;\n@@ -208,0 +213,1 @@\n+            this.resultType = def.resultType();\n@@ -214,0 +220,1 @@\n+            this.resultType = that.resultType;\n@@ -222,1 +229,1 @@\n-            super(NAME, resultType, args);\n+            super(NAME, args);\n@@ -225,0 +232,1 @@\n+            this.resultType = resultType;\n@@ -237,0 +245,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return resultType;\n+        }\n@@ -295,1 +308,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -317,0 +330,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -361,1 +379,1 @@\n-            super(NAME, QUOTED_TYPE,\n+            super(NAME,\n@@ -421,0 +439,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return QUOTED_TYPE;\n+        }\n@@ -472,1 +495,1 @@\n-            super(NAME, functionalInterface,\n+            super(NAME,\n@@ -540,0 +563,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return functionalInterface();\n+        }\n@@ -609,1 +637,1 @@\n-            super(NAME, closureType(bodyC.descriptor()),\n+            super(NAME,\n@@ -679,0 +707,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return closureType(body().descriptor());\n+        }\n@@ -705,1 +738,1 @@\n-            super(NAME, resultType(args), args);\n+            super(NAME, args);\n@@ -724,0 +757,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return resultType(operands());\n+        }\n@@ -753,1 +791,1 @@\n-            super(NAME, TypeDesc.VOID, List.of());\n+            super(NAME, List.of());\n@@ -757,1 +795,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -769,0 +807,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -796,1 +839,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -803,0 +846,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -832,1 +880,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -835,0 +883,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -865,1 +918,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -870,1 +923,1 @@\n-            super(NAME, TypeDesc.VOID, operands);\n+            super(NAME, operands);\n@@ -881,0 +934,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -916,1 +974,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -930,0 +988,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -970,1 +1033,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -993,0 +1056,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -1005,0 +1073,1 @@\n+        final TypeDesc type;\n@@ -1080,0 +1149,1 @@\n+            this.type = def.resultType();\n@@ -1086,0 +1156,1 @@\n+            this.type = that.type;\n@@ -1095,1 +1166,1 @@\n-            super(NAME, type, List.of());\n+            super(NAME, List.of());\n@@ -1097,0 +1168,1 @@\n+            this.type = type;\n@@ -1110,0 +1182,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return type;\n+        }\n@@ -1132,0 +1209,1 @@\n+        final TypeDesc resultType;\n@@ -1148,0 +1226,1 @@\n+            this.resultType = def.resultType();\n@@ -1154,0 +1233,1 @@\n+            this.resultType = that.resultType;\n@@ -1166,1 +1246,1 @@\n-            super(NAME, resultType, args);\n+            super(NAME, args);\n@@ -1169,0 +1249,1 @@\n+            this.resultType = resultType;\n@@ -1185,0 +1266,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return resultType;\n+        }\n@@ -1195,0 +1281,2 @@\n+        final TypeDesc resultType;\n+\n@@ -1197,0 +1285,2 @@\n+\n+            this.resultType = def.resultType();\n@@ -1201,0 +1291,2 @@\n+\n+            this.resultType = that.resultType;\n@@ -1209,1 +1301,8 @@\n-            super(NAME, resultType, List.of(arg));\n+            super(NAME, List.of(arg));\n+\n+            this.resultType = resultType;\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return resultType;\n@@ -1222,0 +1321,1 @@\n+        final TypeDesc resultType;\n@@ -1237,0 +1337,1 @@\n+            this.resultType = def.resultType();\n@@ -1243,0 +1344,1 @@\n+            this.resultType = that.resultType;\n@@ -1255,1 +1357,1 @@\n-            super(NAME, resultType, args);\n+            super(NAME, args);\n@@ -1258,0 +1360,1 @@\n+            this.resultType = resultType;\n@@ -1274,0 +1377,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return resultType;\n+        }\n@@ -1302,1 +1410,1 @@\n-        FieldAccessOp(String name, TypeDesc resultType, List<Value> operands,\n+        FieldAccessOp(String name, List<Value> operands,\n@@ -1304,1 +1412,1 @@\n-            super(name, resultType, operands);\n+            super(name, operands);\n@@ -1357,1 +1465,1 @@\n-                super(NAME, descriptor.type(),\n+                super(NAME,\n@@ -1363,1 +1471,1 @@\n-                super(NAME, descriptor.type(),\n+                super(NAME,\n@@ -1366,0 +1474,5 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                return fieldDescriptor().type();\n+            }\n@@ -1405,1 +1518,1 @@\n-                super(NAME, TypeDesc.VOID,\n+                super(NAME,\n@@ -1411,1 +1524,1 @@\n-                super(NAME, TypeDesc.VOID,\n+                super(NAME,\n@@ -1414,0 +1527,5 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                return TypeDesc.VOID;\n+            }\n@@ -1439,1 +1557,6 @@\n-            super(NAME, TypeDesc.INT, List.of(array));\n+            super(NAME, List.of(array));\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.INT;\n@@ -1460,1 +1583,1 @@\n-            super(that.opName(), resultType(operands.get(0), operands.size() == 2 ? null : operands.get(2)), operands);\n+            super(that.opName(), operands);\n@@ -1465,1 +1588,1 @@\n-            super(name, resultType(array, v), operands(array, index, v));\n+            super(name, operands(array, index, v));\n@@ -1513,0 +1636,6 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                Value array = operands().get(0);\n+                return resultType(array, null);\n+            }\n@@ -1539,0 +1668,7 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                Value array = operands().get(0);\n+                Value value = operands().get(2);\n+                return resultType(array, value);\n+            }\n@@ -1585,1 +1721,1 @@\n-            super(NAME, TypeDesc.BOOLEAN,\n+            super(NAME,\n@@ -1601,0 +1737,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.BOOLEAN;\n+        }\n@@ -1611,1 +1752,1 @@\n-        final TypeDesc typeDescriptor;\n+        final TypeDesc type;\n@@ -1618,1 +1759,1 @@\n-            TypeDesc typeDescriptor = def.extractAttributeValue(ATTRIBUTE_TYPE_DESCRIPTOR, true,\n+            TypeDesc type = def.extractAttributeValue(ATTRIBUTE_TYPE_DESCRIPTOR, true,\n@@ -1624,1 +1765,1 @@\n-            return new CastOp(def, typeDescriptor);\n+            return new CastOp(def, type);\n@@ -1627,1 +1768,1 @@\n-        CastOp(OpDefinition def, TypeDesc typeDescriptor) {\n+        CastOp(OpDefinition def, TypeDesc type) {\n@@ -1630,1 +1771,1 @@\n-            this.typeDescriptor = typeDescriptor;\n+            this.type = type;\n@@ -1636,1 +1777,1 @@\n-            this.typeDescriptor = that.typeDescriptor;\n+            this.type = that.type;\n@@ -1644,3 +1785,2 @@\n-        CastOp(TypeDesc resultType, TypeDesc t, Value v) {\n-            super(NAME, resultType,\n-                    List.of(v));\n+        CastOp(TypeDesc t, Value v) {\n+            super(NAME, List.of(v));\n@@ -1648,1 +1788,1 @@\n-            this.typeDescriptor = t;\n+            this.type = t;\n@@ -1654,1 +1794,1 @@\n-            m.put(\"\", typeDescriptor);\n+            m.put(\"\", type);\n@@ -1659,1 +1799,6 @@\n-            return typeDescriptor;\n+            return type;\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return type();\n@@ -1744,2 +1889,2 @@\n-        VarOp(String varName, TypeDesc type, Value init) {\n-            super(NAME, Var.type(type), List.of(init));\n+        VarOp(String varName, Value init) {\n+            super(NAME, List.of(init));\n@@ -1768,0 +1913,6 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            TypeDesc valueType = operands().get(0).type();\n+            return Var.type(valueType);\n+        }\n@@ -1779,2 +1930,2 @@\n-        VarAccessOp(String name, TypeDesc resultType, List<Value> operands) {\n-            super(name, resultType, operands);\n+        VarAccessOp(String name, List<Value> operands) {\n+            super(name, operands);\n@@ -1819,1 +1970,1 @@\n-                super(NAME, getresultType(checkIsVarOp(varValue.get(0))), varValue);\n+                super(NAME, varValue);\n@@ -1829,1 +1980,1 @@\n-                super(NAME, getresultType(checkIsVarOp(varValue)), List.of(varValue));\n+                super(NAME, List.of(varValue));\n@@ -1847,0 +1998,5 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                return getresultType(operands().get(0));\n+            }\n@@ -1870,1 +2026,1 @@\n-                super(NAME, getresultType(checkIsVarOp(values.get(0))),\n+                super(NAME,\n@@ -1881,1 +2037,1 @@\n-                super(NAME, getresultType(checkIsVarOp(varValue)),\n+                super(NAME,\n@@ -1900,0 +2056,5 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                return getresultType(operands().get(0));\n+            }\n@@ -1956,1 +2117,6 @@\n-            super(NAME, Tuple.typeFromValues(componentValues), componentValues);\n+            super(NAME, componentValues);\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return Tuple.typeFromValues(operands());\n@@ -1996,1 +2162,1 @@\n-            super(NAME, getresultType(values.get(0), that.index), values);\n+            super(NAME, values);\n@@ -2007,1 +2173,1 @@\n-            super(NAME, getresultType(tupleValue, index), List.of(tupleValue));\n+            super(NAME, List.of(tupleValue));\n@@ -2044,0 +2210,6 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            Value tupleValue = operands().get(0);\n+            return getresultType(tupleValue, index);\n+        }\n@@ -2082,1 +2254,1 @@\n-            super(NAME, getresultType(values.get(0), that.index, values.get(1)), values);\n+            super(NAME, values);\n@@ -2093,1 +2265,1 @@\n-            super(NAME, getresultType(tupleValue, index, value), List.of(tupleValue, value));\n+            super(NAME, List.of(tupleValue, value));\n@@ -2131,0 +2303,7 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            Value tupleValue = operands().get(0);\n+            Value value = operands().get(2);\n+            return getresultType(tupleValue, index, value);\n+        }\n@@ -2181,1 +2360,1 @@\n-            super(NAME, ExceptionRegion.EXCEPTION_REGION_TYPE, List.of());\n+            super(NAME, List.of());\n@@ -2202,0 +2381,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return ExceptionRegion.EXCEPTION_REGION_TYPE;\n+        }\n@@ -2239,1 +2423,1 @@\n-            super(NAME, TypeDesc.VOID, checkValue(exceptionRegion));\n+            super(NAME, checkValue(exceptionRegion));\n@@ -2270,0 +2454,4 @@\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -2291,2 +2479,2 @@\n-        protected ArithmeticOperation(String name, TypeDesc resultType, List<Value> operands) {\n-            super(name, resultType, operands);\n+        protected ArithmeticOperation(String name, List<Value> operands) {\n+            super(name, operands);\n@@ -2312,2 +2500,2 @@\n-        protected TestOperation(String name, TypeDesc resultType, List<Value> operands) {\n-            super(name, resultType, operands);\n+        protected TestOperation(String name, List<Value> operands) {\n+            super(name, operands);\n@@ -2333,2 +2521,7 @@\n-        protected BinaryOp(String name, TypeDesc resultType, Value lhs, Value rhs) {\n-            super(name, resultType, List.of(lhs, rhs));\n+        protected BinaryOp(String name, Value lhs, Value rhs) {\n+            super(name, List.of(lhs, rhs));\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return operands().get(0).type();\n@@ -2354,2 +2547,7 @@\n-        protected UnaryOp(String name, TypeDesc resultType, Value v) {\n-            super(name, resultType, List.of(v));\n+        protected UnaryOp(String name, Value v) {\n+            super(name, List.of(v));\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return operands().get(0).type();\n@@ -2376,1 +2574,1 @@\n-            super(name, TypeDesc.BOOLEAN, List.of(v));\n+            super(name, List.of(v));\n@@ -2397,1 +2595,6 @@\n-            super(name, TypeDesc.BOOLEAN, List.of(lhs, rhs));\n+            super(name, List.of(lhs, rhs));\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.BOOLEAN;\n@@ -2421,2 +2624,2 @@\n-        AddOp(TypeDesc resultType, Value lhs, Value rhs) {\n-            super(NAME, resultType, lhs, rhs);\n+        AddOp(Value lhs, Value rhs) {\n+            super(NAME, lhs, rhs);\n@@ -2446,2 +2649,2 @@\n-        SubOp(TypeDesc resultType, Value lhs, Value rhs) {\n-            super(NAME, resultType, lhs, rhs);\n+        SubOp(Value lhs, Value rhs) {\n+            super(NAME, lhs, rhs);\n@@ -2471,2 +2674,2 @@\n-        MulOp(TypeDesc resultType, Value lhs, Value rhs) {\n-            super(NAME, resultType, lhs, rhs);\n+        MulOp(Value lhs, Value rhs) {\n+            super(NAME, lhs, rhs);\n@@ -2496,2 +2699,2 @@\n-        DivOp(TypeDesc resultType, Value lhs, Value rhs) {\n-            super(NAME, resultType, lhs, rhs);\n+        DivOp(Value lhs, Value rhs) {\n+            super(NAME, lhs, rhs);\n@@ -2521,2 +2724,2 @@\n-        ModOp(TypeDesc resultType, Value lhs, Value rhs) {\n-            super(NAME, resultType, lhs, rhs);\n+        ModOp(Value lhs, Value rhs) {\n+            super(NAME, lhs, rhs);\n@@ -2547,1 +2750,1 @@\n-            super(NAME, resultType, v);\n+            super(NAME, v);\n@@ -2571,2 +2774,2 @@\n-        NotOp(TypeDesc resultType, Value v) {\n-            super(NAME, resultType, v);\n+        NotOp(Value v) {\n+            super(NAME, v);\n@@ -3232,13 +3435,1 @@\n-        return new CastOp(t, t, v);\n-    }\n-\n-    \/**\n-     * Creates a cast operation.\n-     *\n-     * @param resultType the result type of the operation\n-     * @param t the type descriptor of the type to cast to\n-     * @param v the value to cast\n-     * @return the cast operation\n-     *\/\n-    public static CastOp cast(TypeDesc resultType, TypeDesc t, Value v) {\n-        return new CastOp(resultType, t, v);\n+        return new CastOp(t, v);\n@@ -3254,12 +3445,1 @@\n-        return var(null, init.type(), init);\n-    }\n-\n-    \/**\n-     * Creates a var operation.\n-     *\n-     * @param type the type of the var's value\n-     * @param init the initial value of the var\n-     * @return the var operation\n-     *\/\n-    public static VarOp var(TypeDesc type, Value init) {\n-        return var(null, type, init);\n+        return var(null, init);\n@@ -3276,13 +3456,1 @@\n-        return var(name, init.type(), init);\n-    }\n-\n-    \/**\n-     * Creates a var operation.\n-     *\n-     * @param name the name of the var\n-     * @param type the type of the var's value\n-     * @param init the initial value of the var\n-     * @return the var operation\n-     *\/\n-    public static VarOp var(String name, TypeDesc type, Value init) {\n-        return new VarOp(name, type, init);\n+        return new VarOp(name, init);\n@@ -3366,13 +3534,1 @@\n-        return add(lhs.type(), lhs, rhs);\n-    }\n-\n-    \/**\n-     * Creates an add operation.\n-     *\n-     * @param resultType the operation's result type\n-     * @param lhs the first operand\n-     * @param rhs the second operand\n-     * @return the add operation\n-     *\/\n-    public static BinaryOp add(TypeDesc resultType, Value lhs, Value rhs) {\n-        return new AddOp(resultType, lhs, rhs);\n+        return new AddOp(lhs, rhs);\n@@ -3389,13 +3545,1 @@\n-        return sub(lhs.type(), lhs, rhs);\n-    }\n-\n-    \/**\n-     * Creates a sub operation.\n-     *\n-     * @param resultType the operation's result type\n-     * @param lhs the first operand\n-     * @param rhs the second operand\n-     * @return the sub operation\n-     *\/\n-    public static BinaryOp sub(TypeDesc resultType, Value lhs, Value rhs) {\n-        return new SubOp(resultType, lhs, rhs);\n+        return new SubOp(lhs, rhs);\n@@ -3412,13 +3556,1 @@\n-        return mul(lhs.type(), lhs, rhs);\n-    }\n-\n-    \/**\n-     * Creates a mul operation.\n-     *\n-     * @param resultType the operation's result type\n-     * @param lhs the first operand\n-     * @param rhs the second operand\n-     * @return the mul operation\n-     *\/\n-    public static BinaryOp mul(TypeDesc resultType, Value lhs, Value rhs) {\n-        return new MulOp(resultType, lhs, rhs);\n+        return new MulOp(lhs, rhs);\n@@ -3435,13 +3567,1 @@\n-        return div(lhs.type(), lhs, rhs);\n-    }\n-\n-    \/**\n-     * Creates a div operation.\n-     *\n-     * @param resultType the operation's result type\n-     * @param lhs the first operand\n-     * @param rhs the second operand\n-     * @return the div operation\n-     *\/\n-    public static BinaryOp div(TypeDesc resultType, Value lhs, Value rhs) {\n-        return new DivOp(resultType, lhs, rhs);\n+        return new DivOp(lhs, rhs);\n@@ -3458,13 +3578,1 @@\n-        return mod(lhs.type(), lhs, rhs);\n-    }\n-\n-    \/**\n-     * Creates a mod operation.\n-     *\n-     * @param resultType the operation's result type\n-     * @param lhs the first operand\n-     * @param rhs the second operand\n-     * @return the mod operation\n-     *\/\n-    public static BinaryOp mod(TypeDesc resultType, Value lhs, Value rhs) {\n-        return new ModOp(resultType, lhs, rhs);\n+        return new ModOp(lhs, rhs);\n@@ -3473,1 +3581,0 @@\n-\n@@ -3502,12 +3609,1 @@\n-        return not(v.type(), v);\n-    }\n-\n-    \/**\n-     * Creates a not operation.\n-     *\n-     * @param resultType the operation's result type\n-     * @param v the operand\n-     * @return the not operation\n-     *\/\n-    public static UnaryOp not(TypeDesc resultType, Value v) {\n-        return new NotOp(resultType, v);\n+        return new NotOp(v);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/CoreOps.java","additions":292,"deletions":196,"binary":false,"changes":488,"status":"modified"},{"patch":"@@ -97,1 +97,1 @@\n-            super(name, TypeDesc.VOID, checkLabel(label));\n+            super(name, checkLabel(label));\n@@ -163,0 +163,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return TypeDesc.VOID;\n+        }\n@@ -268,1 +273,1 @@\n-            super(NAME, TypeDesc.VOID,\n+            super(NAME,\n@@ -273,1 +278,1 @@\n-            super(NAME, TypeDesc.VOID, List.of(operand));\n+            super(NAME, List.of(operand));\n@@ -284,0 +289,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -320,1 +330,1 @@\n-            super(NAME, TypeDesc.VOID, List.of());\n+            super(NAME, List.of());\n@@ -361,0 +371,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -395,1 +410,1 @@\n-            super(NAME, TypeDesc.VOID, List.of());\n+            super(NAME, List.of());\n@@ -447,0 +462,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -567,1 +587,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -667,0 +687,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -676,0 +701,1 @@\n+        final TypeDesc type;\n@@ -688,0 +714,1 @@\n+            this.type = def.resultType();\n@@ -696,0 +723,1 @@\n+            this.type = that.type;\n@@ -704,1 +732,1 @@\n-            super(NAME, type, List.of(target));\n+            super(NAME, List.of(target));\n@@ -712,2 +740,3 @@\n-\n-            \/\/\n+            \/\/ I kept this for now to not affect code in ReflectMethods,\n+            \/\/ but I think resultType can be computed using: bodies.get(1).yieldType();\n+            this.type = type;\n@@ -725,0 +754,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return type;\n+        }\n@@ -749,1 +783,6 @@\n-            super(NAME, TypeDesc.VOID, List.of());\n+            super(NAME, List.of());\n+        }\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n@@ -889,1 +928,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -1005,0 +1044,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -1114,1 +1158,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -1260,0 +1304,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -1312,1 +1361,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -1318,1 +1367,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -1399,0 +1448,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -1452,1 +1506,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -1458,1 +1512,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -1538,0 +1592,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -1566,1 +1625,1 @@\n-            super(name, BOOLEAN, List.of());\n+            super(name, List.of());\n@@ -1645,0 +1704,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return BOOLEAN;\n+        }\n@@ -1765,0 +1829,1 @@\n+        final TypeDesc resultType;\n@@ -1778,0 +1843,1 @@\n+            this.resultType = def.resultType();\n@@ -1786,0 +1852,1 @@\n+            this.resultType = that.resultType;\n@@ -1794,1 +1861,1 @@\n-            super(NAME, expressionType, List.of());\n+            super(NAME, List.of());\n@@ -1797,0 +1864,3 @@\n+            \/\/ I kept this, to not affect code in ReflectMethods\n+            \/\/ I think it can be removed and resultType can be computed using: bodies().get(1).yieldType()\n+            this.resultType = expressionType;\n@@ -1850,0 +1920,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return resultType;\n+        }\n@@ -1975,1 +2050,1 @@\n-            super(NAME, VOID, List.of());\n+            super(NAME, List.of());\n@@ -2287,0 +2362,5 @@\n+\n+        @Override\n+        public TypeDesc resultType() {\n+            return VOID;\n+        }\n@@ -2358,2 +2438,2 @@\n-            PatternOp(String name, TypeDesc returnType, List<Value> operands) {\n-                super(name, returnType, operands);\n+            PatternOp(String name, List<Value> operands) {\n+                super(name, operands);\n@@ -2372,0 +2452,1 @@\n+            final TypeDesc resultType;\n@@ -2387,0 +2468,1 @@\n+                this.resultType = def.resultType();\n@@ -2393,0 +2475,1 @@\n+                this.resultType = that.resultType;\n@@ -2401,1 +2484,1 @@\n-                super(NAME, Pattern.bindingType(targetType), List.of());\n+                super(NAME, List.of());\n@@ -2404,0 +2487,1 @@\n+                this.resultType = Pattern.bindingType(targetType);\n@@ -2420,0 +2504,5 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                return resultType;\n+            }\n@@ -2464,1 +2553,1 @@\n-                super(NAME, Pattern.recordType(recordDescriptor.recordType()), List.copyOf(nestedPatterns));\n+                super(NAME, List.copyOf(nestedPatterns));\n@@ -2483,0 +2572,5 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                return Pattern.recordType(recordDescriptor.recordType());\n+            }\n@@ -2515,1 +2609,1 @@\n-                super(NAME, BOOLEAN,\n+                super(NAME,\n@@ -2641,0 +2735,5 @@\n+\n+            @Override\n+            public TypeDesc resultType() {\n+                return BOOLEAN;\n+            }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/ExtendedOps.java","additions":123,"deletions":24,"binary":false,"changes":147,"status":"modified"},{"patch":"@@ -58,3 +58,2 @@\n-     * @param name       the operation name.\n-     * @param resultType the operation result type.\n-     * @param operands   the list of operands, a copy of the list is performed if required.\n+     * @param name     the operation name.\n+     * @param operands the list of operands, a copy of the list is performed if required.\n@@ -62,2 +61,2 @@\n-    protected OpWithDefinition(String name, TypeDesc resultType, List<? extends Value> operands) {\n-        super(name, resultType, operands);\n+    protected OpWithDefinition(String name, List<? extends Value> operands) {\n+        super(name, operands);\n@@ -72,1 +71,1 @@\n-     * @implSpec This implementation invokes the {@link Op#Op(String, TypeDesc, List) constructor}\n+     * @implSpec This implementation invokes the {@link Op#Op(String, List) constructor}\n@@ -81,1 +80,1 @@\n-        super(def.name(), def.resultType(), def.operands());\n+        super(def.name(), def.operands());\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/OpWithDefinition.java","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -1466,1 +1466,1 @@\n-                        localResult = append(ExtendedOps.conditionalAnd(clBodies));\n+                        localResult = append(ExtendedOps.conditionalOr(clBodies));\n@@ -1770,1 +1770,0 @@\n-            Type trueType = condType(tree, truepart.type);\n@@ -1774,1 +1773,1 @@\n-                    MethodTypeDesc.methodType(typeToDesc(trueType)));\n+                    MethodTypeDesc.methodType(typeToDesc(condType)));\n@@ -1786,2 +1785,0 @@\n-            Type falseType = condType(tree, falsepart.type);\n-\n@@ -1790,1 +1787,1 @@\n-                    MethodTypeDesc.methodType(typeToDesc(falseType)));\n+                    MethodTypeDesc.methodType(typeToDesc(condType)));\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/ReflectMethods.java","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -221,1 +221,1 @@\n-        CoreOps.FuncOp f = func(\"f\", methodType(int[].class, int.class))\n+        CoreOps.FuncOp f = func(\"f\", methodType(void.class, int[].class))\n","filename":"test\/jdk\/java\/lang\/reflect\/code\/TestInline.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -192,1 +192,1 @@\n-                    ^truepart()java.lang.Integer -> {\n+                    ^truepart()int -> {\n@@ -223,1 +223,1 @@\n-                    ^falsepart()java.lang.Integer -> {\n+                    ^falsepart()int -> {\n","filename":"test\/langtools\/tools\/javac\/reflect\/BoxingConversionTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -76,1 +76,1 @@\n-                    ^truepart()int -> {\n+                    ^truepart()double -> {\n@@ -148,1 +148,1 @@\n-                            ^truepart()int -> {\n+                            ^truepart()double -> {\n","filename":"test\/langtools\/tools\/javac\/reflect\/ConditionalExpressionTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -100,1 +100,1 @@\n-                    ^falsepart()int -> {\n+                    ^falsepart()long -> {\n@@ -125,1 +125,1 @@\n-                   ^truepart()int -> {\n+                   ^truepart()long -> {\n","filename":"test\/langtools\/tools\/javac\/reflect\/ImplicitConversionTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -98,1 +98,1 @@\n-                        %5 : boolean = java.cand\n+                        %5 : boolean = java.cor\n@@ -198,1 +198,1 @@\n-                        %5 : boolean = java.cand\n+                        %5 : boolean = java.cor\n","filename":"test\/langtools\/tools\/javac\/reflect\/SwitchExpressionTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}