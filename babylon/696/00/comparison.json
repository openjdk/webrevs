{"files":[{"patch":"@@ -24,1 +24,4 @@\n---><project xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/xsd\/maven-4.0.0.xsd\" xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\">\n+-->\n+<project xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/xsd\/maven-4.0.0.xsd\"\n+         xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\">\n","filename":"hat\/examples\/view\/pom.xml","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+\n@@ -165,1 +166,1 @@\n-    record S32xN (Regex regex, Matcher matcher, boolean matched) implements Regex.OK {\n+    record S32xN(Regex regex, Matcher matcher, boolean matched) implements Regex.OK {\n@@ -179,2 +180,2 @@\n-                    switch(sm.state){\n-                        case State.awaiting_name s when s.r().matches(line, whoseMatcher -> whoseMatcher.group(1).equals(name))->{\n+                    switch (sm.state) {\n+                        case State.awaiting_name s when s.r().matches(line, whoseMatcher -> whoseMatcher.group(1).equals(name)) -> {\n@@ -182,1 +183,1 @@\n-                            mesh.set(F32Mesh3D.of(f32,name));\n+                            mesh.set(F32Mesh3D.of(f32, name));\n@@ -187,1 +188,1 @@\n-                        case State.awaiting_faces _ when State.vertexRegex.is(line, F32x3::new) instanceof F32x3 f32x3 ->{\n+                        case State.awaiting_faces _ when State.vertexRegex.is(line, F32x3::new) instanceof F32x3 f32x3 -> {\n@@ -193,2 +194,2 @@\n-                        case State.awaiting_hue_lig_sat _ when State.hexagonRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-                            mesh.get().hex(s32xN.asInts(6,6), 0xff7f00);\n+                        case State.awaiting_hue_lig_sat _ when State.hexagonRegex.is(line, S32xN::new) instanceof S32xN s32xN -> {\n+                            mesh.get().hex(s32xN.asInts(6, 6), 0xff7f00);\n@@ -196,2 +197,2 @@\n-                        case State.awaiting_hue_lig_sat _ when State.pentagonRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-                            mesh.get().pent(s32xN.asInts(6,5), 0x7fff00);\n+                        case State.awaiting_hue_lig_sat _ when State.pentagonRegex.is(line, S32xN::new) instanceof S32xN s32xN -> {\n+                            mesh.get().pent(s32xN.asInts(6, 5), 0x7fff00);\n@@ -199,2 +200,2 @@\n-                        case State.awaiting_hue_lig_sat _ when State.quadRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-                                mesh.get().quad(s32xN.asInts(6,4), 0x00ff7f);\n+                        case State.awaiting_hue_lig_sat _ when State.quadRegex.is(line, S32xN::new) instanceof S32xN s32xN -> {\n+                            mesh.get().quad(s32xN.asInts(6, 4), 0x00ff7f);\n@@ -203,2 +204,2 @@\n-                        case State.awaiting_hue_lig_sat _ when State.triangleRegex.is(line, S32xN::new) instanceof S32xN s32xN ->{\n-                                mesh.get().tri(s32xN.asInts(6,3), 0x007fff);\n+                        case State.awaiting_hue_lig_sat _ when State.triangleRegex.is(line, S32xN::new) instanceof S32xN s32xN -> {\n+                            mesh.get().tri(s32xN.asInts(6, 3), 0x007fff);\n@@ -210,2 +211,8 @@\n-                        case State.awaiting_hue_lig_sat _ when !State.remRegex.matches(line) ->{\n-                                System.out.println(\"UNHANDLED \" + line);\n+                        case State.awaiting_hue_lig_sat _ when !State.remRegex.matches(line) -> {\n+                            System.out.println(\"UNHANDLED \" + line);\n+                        }\n+                        case State.done _ -> {\n+                        }\n+                        case State _ when Regex.any(line, State.remRegex, State.emptyRegex, State.colonRegex).matched() -> {\n+                        }\n+                        case State _ -> {\n@@ -213,3 +220,0 @@\n-                        case State.done _-> {}\n-                        case State _ when Regex.any(line, State.remRegex, State.emptyRegex, State.colonRegex).matched()->{}\n-                        case State _ ->{}\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/EliteMeshParser.java","additions":22,"deletions":18,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-        Runnable cubeoctahedron =  () -> {\n+        Runnable cubeoctahedron = () -> {\n@@ -69,1 +69,1 @@\n-                            F32Mesh3D.of(f32,\"cubeoctahedron\").cubeoctahedron(x, y, z, 2).fin();\n+                        F32Mesh3D.of(f32, \"cubeoctahedron\").cubeoctahedron(x, y, z, 2).fin();\n@@ -74,1 +74,1 @@\n-        Runnable elite = ()->eliteReader.load(f32,args.getFirst());\n+        Runnable elite = () -> eliteReader.load(f32, args.getFirst());\n@@ -77,2 +77,2 @@\n-                ? ViewFrame.of(f32,\"view\",fill, elite)\n-                : ViewFrame.of(f32,\"true\", fill,cubeoctahedron));\n+                ? ViewFrame.of(f32, \"view\", wire, elite)\n+                : ViewFrame.of(f32, \"true\", fill, cubeoctahedron));\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/Main.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -35,2 +35,1 @@\n-import view.f32.pool.F32x2TrianglePool;\n-import view.f32.pool.Pool;\n+import view.f32.F32x2Triangle;\n@@ -41,0 +40,1 @@\n+import java.util.List;\n@@ -44,1 +44,1 @@\n-                                  int[] offscreenRgb) implements Renderer {\n+                                  int[] offscreenRgb, float[] zplane) implements Renderer {\n@@ -46,0 +46,1 @@\n+        var len = width * height;\n@@ -47,1 +48,3 @@\n-        return new RasterizingRenderer(f32,width, height, displayMode, image, new int[((DataBufferInt) image.getRaster().getDataBuffer()).getData().length]);\n+\n+        return new RasterizingRenderer(f32, width, height, displayMode, image,\n+                ((DataBufferInt) image.getRaster().getDataBuffer()).getData(), new float[len]);\n@@ -55,1 +58,1 @@\n-        return of(f32,width, height, DisplayMode.FILL);\n+        return of(f32, width, height, DisplayMode.FILL);\n@@ -58,1 +61,2 @@\n-    private void kernel(int gid) {\n+\n+    private void kernel(int gid, List<F32x2Triangle> zordered) {\n@@ -62,2 +66,2 @@\n-        for (int t = 0; t < ((Pool<?,?>) f32.f32x2TriangleFactory()).count(); t++) {\n-            col = F32.rgb(displayMode.filled,x, y, ((F32x2TrianglePool) f32.f32x2TriangleFactory()).entry(t),col);\n+        for (int t = 0; t < zordered.size(); t++) {\n+            col = F32.rgb(displayMode.fill, x, y, zordered.get(t), col);\n@@ -69,2 +73,4 @@\n-    public void render() {\n-        IntStream.range(0, width * height).parallel().forEach(this::kernel);\n+    public void render(List<F32x2Triangle> zordered) {\n+        IntStream.range(0, width * height).parallel().forEach(gid -> {\n+            kernel(gid, zordered);\n+        });\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/RasterizingRenderer.java","additions":16,"deletions":10,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -34,0 +34,2 @@\n+import view.f32.F32x2Triangle;\n+\n@@ -35,1 +37,1 @@\n-import java.awt.Image;\n+import java.util.List;\n@@ -44,1 +46,1 @@\n-        final public boolean filled;\n+        final public boolean fill;\n@@ -46,0 +48,1 @@\n+        final public boolean alwaysShow;\n@@ -47,1 +50,1 @@\n-        DisplayMode(boolean wire, boolean filled, boolean showHidden) {\n+        DisplayMode(boolean wire, boolean fill, boolean showHidden) {\n@@ -49,1 +52,1 @@\n-            this.filled = filled;\n+            this.fill = fill;\n@@ -51,0 +54,1 @@\n+            this.alwaysShow = !showHidden;\n@@ -56,1 +60,1 @@\n-    void render();\n+    void render(List<F32x2Triangle> triangles);\n@@ -60,1 +64,1 @@\n-  \/\/  Image image();\n+    \/\/  Image image();\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/Renderer.java","additions":10,"deletions":6,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -29,2 +29,1 @@\n-import view.f32.F32x4x4;\n-import view.f32.F32x3Triangle;\n+import view.f32.F32x2Triangle;\n@@ -32,0 +31,2 @@\n+import view.f32.F32x3Triangle;\n+import view.f32.F32x4x4;\n@@ -33,1 +34,0 @@\n-import view.f32.ZPos;\n@@ -50,0 +50,27 @@\n+    public enum ColourMode {\n+        NORMALIZED_COLOUR, NORMALIZED_INV_COLOUR, COLOUR, NORMALIZED_WHITE, NORMALIZED_INV_WHITE, WHITE;\n+\n+        int rgb(int rgb, float normal) {\n+            int r = ((rgb & 0xff0000) >> 16);\n+            int g = ((rgb & 0x00ff00) >> 8);\n+            int b = ((rgb & 0x0000ff));\n+            switch (this) {\n+                case NORMALIZED_COLOUR, NORMALIZED_INV_COLOUR -> {\n+                    r -= (int) (20 * normal);\n+                    g -= (int) (20 * normal);\n+                    b -= (int) (20 * normal);\n+                }\n+                case NORMALIZED_WHITE, NORMALIZED_INV_WHITE -> {\n+                    r = g = b = (int) (0x7f - (20 * normal));\n+                }\n+                case ColourMode.WHITE -> {\n+                    r = g = b = 0xff;\n+                }\n+                default -> {\n+                }\n+            }\n+            return (r & 0xff) << 16 | (g & 0xff) << 8 | (b & 0xff);\n+        }\n+    }\n+\n+    public static final ColourMode colourMode = ColourMode.COLOUR;\n@@ -74,2 +101,0 @@\n-\n-\n@@ -134,1 +159,1 @@\n-       \/\/ boolean showHidden = ;\n+        \/\/ boolean showHidden = ;\n@@ -136,1 +161,1 @@\n-        var xyzRot4x4 = f32.rot(theta * 2, theta \/ 2, theta);\n+        var xyzRot4x4 = f32.rot(theta * 2, theta \/ 2, theta*=.2f);\n@@ -138,2 +163,1 @@\n-        List<ZPos> zpos = new ArrayList<>();\n-        \/\/ Loop through the triangles\n+        List<F32x2Triangle> zordered = new ArrayList<>();\n@@ -141,2 +165,2 @@\n-        for (int i = 0; i < ((Pool<?,?>) f32.f32x3TriangleFactory()).count(); i++) {\n-            var f32x3Triangle = (F32x3Triangle) ((Pool<?,?>) f32.f32x3TriangleFactory()).entry(i);\n+        for (int i = 0; i < ((Pool<?, ?>) f32.f32x3TriangleFactory()).count(); i++) {\n+            var f32x3Triangle = (F32x3Triangle) ((Pool<?, ?>) f32.f32x3TriangleFactory()).entry(i);\n@@ -146,3 +170,3 @@\n-            float howVisible = 1f;\n-            boolean isVisible = renderer.displayMode().equals(Renderer.DisplayMode.WIRE_SHOW_HIDDEN);\n-            if (!isVisible) {\n+            var normal = 1f;\n+            boolean include=true;\n+            if (renderer.displayMode().alwaysShow) {\n@@ -160,2 +184,0 @@\n-\n-\n@@ -164,1 +186,0 @@\n-                howVisible = f32.dotProd(cameraDeltaVec3, f32.normal(f32x3Triangle));\n@@ -168,4 +189,1 @@\n-                isVisible = howVisible < 0.0;\n-            }\n-\n-            if (isVisible) {\n+                \/\/ isVisible = normal < 0.0;\n@@ -175,4 +193,17 @@\n-\n-                f32x3Triangle = f32.mul(f32x3Triangle, projF32Mat4x4);\/\/  projection matrix also scales to screen and translate half a screen\n-\n-                zpos.add(new ZPos(f32,f32x3Triangle, howVisible));\n+                normal =f32.dotProd(cameraDeltaVec3, f32.normal(f32x3Triangle));\n+                include = normal<0f;\n+            }\n+            if (include){\n+                f32x3Triangle = f32.mul(f32x3Triangle, projF32Mat4x4);\n+                \/\/  projection matrix also scales to screen and translate half a screen\n+                \/\/ zpos.add(ZPos.of(f32,f32.mul(f32x3Triangle, projF32Mat4x4), 1f));\n+                var v0 = f32x3Triangle.v0();\n+                var v1 = f32x3Triangle.v1();\n+                var v2 = f32x3Triangle.v2();\n+                zordered.add(f32.f32x2Triangle(\n+                        f32.f32x2(v0.x(), v0.y()),\n+                        f32.f32x2(v1.x(), v1.y()),\n+                        f32.f32x2(v2.x(), v2.y()),\n+                        Math.min(Math.min(v0.z(), v1.z()), v2.z()),\n+                        normal,\n+                        colourMode.rgb(f32x3Triangle.rgb(), normal)));\n@@ -180,1 +211,2 @@\n-            resetMark.reset3D(); \/\/ do not move this up.\n+            resetMark.reset3D();\n+            \/\/ do not move this up.\n@@ -183,5 +215,3 @@\n-        Collections.sort(zpos);\n-        for (ZPos z : zpos) {\n-            z.create();\n-        }\n-        renderer.render();\n+        \/\/ zpos.sort(Collections.reverseOrder());\n+        Collections.sort(zordered);\n+        renderer.render(zordered);\n@@ -190,0 +220,1 @@\n+\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/ViewFrame.java","additions":62,"deletions":31,"binary":false,"changes":93,"status":"modified"},{"patch":"@@ -0,0 +1,33 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package view.arity;\n+\n+@FunctionalInterface\n+public\n+interface Arity16<A0, A1, A2, A3, A4, A5, A6, A7, A8, A9, A10, A11, A12, A13, A14, A15, R> {\n+    R of(A0 a0, A1 a1, A2 a2, A3 a3, A4 a4, A5 a5, A6 a6, A7 a7, A8 a8,\n+         A9 a9, A10 a10, A11 a11, A12 a12, A13 a13, A14 a14, A15 a15\n+    );\n+}\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/arity\/Arity16.java","additions":33,"deletions":0,"binary":false,"changes":33,"status":"added"},{"patch":"@@ -25,1 +25,1 @@\n-package view.f32.factories;\n+package view.arity;\n@@ -29,2 +29,2 @@\n-interface Factory2<T1, T2, R> {\n-    R of(T1 var1, T2 var2);\n+interface Arity2<A0, A1, R> {\n+    R of(A0 a0, A1 a1);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/arity\/Arity2.java","additions":3,"deletions":3,"binary":false,"changes":6,"previous_filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/factories\/Factory2.java","status":"copied"},{"patch":"@@ -25,1 +25,1 @@\n-package view.f32.factories;\n+package view.arity;\n@@ -29,2 +29,2 @@\n-interface Factory3<T1, T2, T3, R> {\n-    R of(T1 var1, T2 var2, T3 var3);\n+interface Arity3<A0, A1, A2, R> {\n+    R of(A0 a0, A1 a1, A2 a2);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/arity\/Arity3.java","additions":3,"deletions":3,"binary":false,"changes":6,"previous_filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/factories\/Factory3.java","status":"renamed"},{"patch":"@@ -25,1 +25,1 @@\n-package view.f32.factories;\n+package view.arity;\n@@ -29,2 +29,2 @@\n-interface Factory4<T1, T2, T3, T4, R> {\n-    R of(T1 var1, T2 var2, T3 var3, T4 var4);\n+interface Arity4<A0, A1, A2, A3, R> {\n+    R of(A0 a0, A1 a1, A2 a2, A3 a3);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/arity\/Arity4.java","additions":3,"deletions":3,"binary":false,"changes":6,"previous_filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/factories\/Factory4.java","status":"renamed"},{"patch":"@@ -25,1 +25,1 @@\n-package view.f32.factories;\n+package view.arity;\n@@ -28,3 +28,2 @@\n-public\n-interface Factory2<T1, T2, R> {\n-    R of(T1 var1, T2 var2);\n+public interface Arity5<A0, A1, A2, A3, A4, R> {\n+    R of(A0 a0, A1 a1, A2 a2, A3 a3, A4 a4);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/arity\/Arity5.java","additions":3,"deletions":4,"binary":false,"changes":7,"previous_filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/factories\/Factory2.java","status":"copied"},{"patch":"@@ -25,1 +25,1 @@\n-package view.f32.factories;\n+package view.arity;\n@@ -28,3 +28,2 @@\n-public\n-interface Factory2<T1, T2, R> {\n-    R of(T1 var1, T2 var2);\n+public interface Arity6<A0, A1, A2, A3, A4, A5, R> {\n+    R of(A0 a0, A1 a1, A2 a2, A3 a3, A4 a4, A5 a5);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/arity\/Arity6.java","additions":3,"deletions":4,"binary":false,"changes":7,"previous_filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/factories\/Factory2.java","status":"renamed"},{"patch":"@@ -31,0 +31,1 @@\n+\n@@ -32,0 +33,1 @@\n+\n@@ -33,0 +35,1 @@\n+\n@@ -34,0 +37,1 @@\n+\n@@ -37,9 +41,9 @@\n-            float x0y0, float x1y0,float x2y0, float x3y0,\n-            float x0y1, float x1y1,float x2y1, float x3y1,\n-            float x0y2, float x1y2,float x2y2, float x3y2,\n-            float x0y3, float x1y3,float x2y3, float x3y3\n-    ){\n-        return f32x4x4Factory().of(x0y0, x1y0,x2y0, x3y0,\n-        x0y1, x1y1,x2y1, x3y1,\n-        x0y2, x1y2,x2y2, x3y2,\n-        x0y3, x1y3,x2y3, x3y3);\n+            float x0y0, float x1y0, float x2y0, float x3y0,\n+            float x0y1, float x1y1, float x2y1, float x3y1,\n+            float x0y2, float x1y2, float x2y2, float x3y2,\n+            float x0y3, float x1y3, float x2y3, float x3y3\n+    ) {\n+        return f32x4x4Factory().of(x0y0, x1y0, x2y0, x3y0,\n+                x0y1, x1y1, x2y1, x3y1,\n+                x0y2, x1y2, x2y2, x3y2,\n+                x0y3, x1y3, x2y3, x3y3);\n@@ -47,2 +51,3 @@\n-    default F32x2 f32x2(float x, float y){\n-        return f32x2Factory().of(x,y);\n+\n+    default F32x2 f32x2(float x, float y) {\n+        return f32x2Factory().of(x, y);\n@@ -50,2 +55,3 @@\n-    default F32x3 f32x3(float x, float y,float z){\n-        return f32x3Factory().of(x,y,z);\n+\n+    default F32x3 f32x3(float x, float y, float z) {\n+        return f32x3Factory().of(x, y, z);\n@@ -53,2 +59,3 @@\n-    default F32x3Triangle f32x3Triangle(F32x3 v0, F32x3 v1,F32x3 v2,int rgb){\n-        return f32x3TriangleFactory().of(v0,v1,v2,rgb);\n+\n+    default F32x3Triangle f32x3Triangle(F32x3 v0, F32x3 v1, F32x3 v2, int rgb) {\n+        return f32x3TriangleFactory().of(v0, v1, v2, rgb);\n@@ -56,2 +63,3 @@\n-    default F32x2Triangle f32x2Triangle(F32x2 v0, F32x2 v1,F32x2 v2,int rgb){\n-        return f32x2TriangleFactory().of(v0,v1,v2,rgb);\n+\n+    default F32x2Triangle f32x2Triangle(F32x2 v0, F32x2 v1, F32x2 v2, float zplane, float normal, int rgb) {\n+        return f32x2TriangleFactory().of(v0, v1, v2, zplane, normal, rgb);\n@@ -59,0 +67,1 @@\n+\n@@ -97,1 +106,1 @@\n-     default F32x4x4 transformation(float v) {\n+    default F32x4x4 transformation(float v) {\n@@ -110,1 +119,1 @@\n-     default F32x4x4 scale(float v) {\n+    default F32x4x4 scale(float v) {\n@@ -113,0 +122,1 @@\n+\n@@ -147,1 +157,1 @@\n-     default F32x4x4 rot(float thetaX, float thetaY, float thetaZ) {\n+    default F32x4x4 rot(float thetaX, float thetaY, float thetaZ) {\n@@ -154,1 +164,0 @@\n-\n@@ -179,2 +188,2 @@\n-   static float side(float x, float y, F32x2 v0, F32x2 v1) {\n-         return    (v1.y() - v0.y() * (x - v0.x()) + (-v1.x() + v0.x()) * (y - v0.y()));\n+    static float side(float x, float y, F32x2 v0, F32x2 v1) {\n+        return (v1.y() - v0.y() * (x - v0.x()) + (-v1.x() + v0.x()) * (y - v0.y()));\n@@ -206,4 +215,4 @@\n-   static boolean inside(float x, float y, float x0, float y0, float x1, float y1, float x2, float y2) {\n-        var denominator = ((y1 - y2)*(x0 - x2) + (x2 - x1)*(y0 - y2));\n-        var a = ((y1 - y2)*(x - x2) + (x2 - x1)*(y - y2)) \/ denominator;\n-        var b = ((y2 - y0)*(x - x2) + (x0 - x2)*(y - y2)) \/ denominator;\n+    static boolean inside(float x, float y, float x0, float y0, float x1, float y1, float x2, float y2) {\n+        var denominator = ((y1 - y2) * (x0 - x2) + (x2 - x1) * (y0 - y2));\n+        var a = ((y1 - y2) * (x - x2) + (x2 - x1) * (y - y2)) \/ denominator;\n+        var b = ((y2 - y0) * (x - x2) + (x0 - x2) * (y - y2)) \/ denominator;\n@@ -214,2 +223,2 @@\n-   static boolean inside(float x, float y, F32x2 v0, F32x2 v1, F32x2 v2) {\n-        return inside(x,y, v0.x(), v0.y(), v1.x(), v1.y(),v2.x(), v2.y());\n+    static boolean inside(float x, float y, F32x2 v0, F32x2 v1, F32x2 v2) {\n+        return inside(x, y, v0.x(), v0.y(), v1.x(), v1.y(), v2.x(), v2.y());\n@@ -219,1 +228,1 @@\n-       return inside(x,y, tri.v0(), tri.v1(),tri.v2());\n+        return inside(x, y, tri.v0(), tri.v1(), tri.v2());\n@@ -224,1 +233,2 @@\n-        float dyl = v1.y() - v0.y();;\n+        float dyl = v1.y() - v0.y();\n+        ;\n@@ -235,0 +245,1 @@\n+\n@@ -236,0 +247,1 @@\n+\n@@ -238,2 +250,2 @@\n-                || onLine(x, y,tri.v1(),tri.v2(), deltaSquare)\n-                || onLine(x, y, tri.v2(),tri.v0(), deltaSquare);\n+                || onLine(x, y, tri.v1(), tri.v2(), deltaSquare)\n+                || onLine(x, y, tri.v2(), tri.v0(), deltaSquare);\n@@ -242,2 +254,2 @@\n-    static   boolean useRgb(boolean filled, float x, float y, F32x2Triangle tri){\n-        return filled? inside(x,y,tri): onEdge(x,y,tri);\n+    static boolean useRgb(boolean filled, float x, float y, F32x2Triangle tri) {\n+        return filled ? inside(x, y, tri) : onEdge(x, y, tri);\n@@ -246,2 +258,2 @@\n-    static   int rgb(boolean filled, float x, float y, F32x2Triangle tri, int rgb){\n-        return useRgb(filled,x,y,tri)? tri.rgb() : rgb;\n+    static int rgb(boolean filled, float x, float y, F32x2Triangle tri, int rgb) {\n+        return useRgb(filled, x, y, tri) ? tri.rgb() : rgb;\n@@ -266,1 +278,1 @@\n-   default F32x3Triangle mul(F32x3Triangle i, F32x4x4 m4) {\n+    default F32x3Triangle mul(F32x3Triangle i, F32x4x4 m4) {\n@@ -278,1 +290,1 @@\n-   default F32x3Triangle add(F32x3Triangle i, float s) {\n+    default F32x3Triangle add(F32x3Triangle i, float s) {\n@@ -310,3 +322,3 @@\n-      \/\/  if (w!=0.0) {\n-            o = div(o, w);\n-       \/\/ }\n+        \/\/  if (w!=0.0) {\n+        o = div(o, w);\n+        \/\/ }\n@@ -326,1 +338,1 @@\n-        if (s==0){\n+        if (s == 0) {\n@@ -367,0 +379,1 @@\n+\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32.java","additions":56,"deletions":43,"binary":false,"changes":99,"status":"modified"},{"patch":"@@ -36,1 +36,2 @@\n-    private F32Mesh3D(F32 f32, String name){\n+\n+    private F32Mesh3D(F32 f32, String name) {\n@@ -40,2 +41,3 @@\n-    public static F32Mesh3D of(F32 f32, String name){\n-        return new F32Mesh3D(f32,name);\n+\n+    public static F32Mesh3D of(F32 f32, String name) {\n+        return new F32Mesh3D(f32, name);\n@@ -43,3 +45,4 @@\n-    public record Face (F32x3Triangle triangle, F32x3 centerVec3Idx, F32x3 normalIdx, F32x3 v0VecIdx){\n-        static Face of (F32 f32, F32x3Triangle tri){\n-           return  new Face(tri, f32.centre(tri), f32.normal(tri),tri.v0());\n+\n+    public record Face(F32x3Triangle triangle, F32x3 centerVec3Idx, F32x3 normalIdx, F32x3 v0VecIdx) {\n+        static Face of(F32 f32, F32x3Triangle tri) {\n+            return new Face(tri, f32.centre(tri), f32.normal(tri), tri.v0());\n@@ -53,3 +56,2 @@\n-\n-    public void fin(){\n-        var  triSumIdx =StreamMutable.of(faces.getFirst().centerVec3Idx);\n+    public void fin() {\n+        var triSumIdx = StreamMutable.of(faces.getFirst().centerVec3Idx);\n@@ -60,8 +62,8 @@\n-        faces.forEach(face ->{\n-            var v0CenterDiff = f32.sub(meshCenterVec3,face.v0VecIdx);\n-            float normDotProd = f32.dotProd(v0CenterDiff, face.normalIdx);\n-            if (normDotProd >0f) { \/\/ the normal from the center from the triangle was pointing out, so re wind it\n-                F32.rewind(face.triangle);\n-            }\n-        });\n-        cube(meshCenterVec3.x(),meshCenterVec3.y(), meshCenterVec3.z(), .1f );\n+      \/\/  faces.forEach(face -> {\n+        \/\/    var v0CenterDiff = f32.sub(meshCenterVec3, face.v0VecIdx);\n+          \/\/  float normDotProd = f32.dotProd(v0CenterDiff, face.normalIdx);\n+          \/\/  if (normDotProd > 0f) { \/\/ the normal from the center from the triangle was pointing out, so re wind it\n+            \/\/    F32.rewind(face.triangle);\n+           \/\/ }\n+       \/\/ });\n+        cube(meshCenterVec3.x(), meshCenterVec3.y(), meshCenterVec3.z(), .1f);\n@@ -69,2 +71,3 @@\n-    public F32Mesh3D tri(int[] indices,int rgb){\n-        return tri(indices[0], indices[1], indices[2],rgb);\n+\n+    public F32Mesh3D tri(int[] indices, int rgb) {\n+        return tri(indices[0], indices[1], indices[2], rgb);\n@@ -72,2 +75,3 @@\n-    private F32Mesh3D tri(int idx0, int idx1, int idx2,int rgb){\n-        return tri(vecEntries.get(idx0), vecEntries.get(idx1), vecEntries.get(idx2),rgb);\n+\n+    private F32Mesh3D tri(int idx0, int idx1, int idx2, int rgb) {\n+        return tri(vecEntries.get(idx0), vecEntries.get(idx1), vecEntries.get(idx2), rgb);\n@@ -75,0 +79,1 @@\n+\n@@ -76,1 +81,1 @@\n-        Face face =Face.of(f32, f32.f32x3Triangle(v0, v1, v2, rgb));\n+        Face face = Face.of(f32, f32.f32x3Triangle(v0, v1, v2, rgb));\n@@ -80,2 +85,3 @@\n-    public F32Mesh3D quad(int[] indices,int rgb){\n-        return quad(indices[0], indices[1], indices[2],indices[3],rgb);\n+\n+    public F32Mesh3D quad(int[] indices, int rgb) {\n+        return quad(indices[0], indices[1], indices[2], indices[3], rgb);\n@@ -83,1 +89,2 @@\n-    private F32Mesh3D quad(int idx0, int idx1, int idx2, int idx3,int rgb){\n+\n+    private F32Mesh3D quad(int idx0, int idx1, int idx2, int idx3, int rgb) {\n@@ -85,1 +92,1 @@\n-                vecEntries.get(idx2), vecEntries.get(idx3),rgb);\n+                vecEntries.get(idx2), vecEntries.get(idx3), rgb);\n@@ -103,2 +110,3 @@\n-    public F32Mesh3D pent(int[] indices,int rgb){\n-        return pent(indices[0], indices[1], indices[2],indices[3],indices[4],rgb);\n+\n+    public F32Mesh3D pent(int[] indices, int rgb) {\n+        return pent(indices[0], indices[1], indices[2], indices[3], indices[4], rgb);\n@@ -106,1 +114,2 @@\n-    private F32Mesh3D pent(int idx0, int idx1, int idx2, int idx3, int idx4,int rgb){\n+\n+    private F32Mesh3D pent(int idx0, int idx1, int idx2, int idx3, int idx4, int rgb) {\n@@ -108,1 +117,1 @@\n-                vecEntries.get(idx2), vecEntries.get(idx3),vecEntries.get(idx4),rgb);\n+                vecEntries.get(idx2), vecEntries.get(idx3), vecEntries.get(idx4), rgb);\n@@ -110,0 +119,1 @@\n+\n@@ -126,2 +136,3 @@\n-    public F32Mesh3D hex(int[] indices,int rgb){\n-        return hex(indices[0], indices[1], indices[2],indices[3],indices[4],indices[5],rgb);\n+\n+    public F32Mesh3D hex(int[] indices, int rgb) {\n+        return hex(indices[0], indices[1], indices[2], indices[3], indices[4], indices[5], rgb);\n@@ -129,1 +140,2 @@\n-    private F32Mesh3D hex(int idx0, int idx1, int idx2, int idx3, int idx4, int idx5,int rgb){\n+\n+    private F32Mesh3D hex(int idx0, int idx1, int idx2, int idx3, int idx4, int idx5, int rgb) {\n@@ -131,1 +143,1 @@\n-                vecEntries.get(idx2), vecEntries.get(idx3),vecEntries.get(idx4),vecEntries.get(idx5),rgb);\n+                vecEntries.get(idx2), vecEntries.get(idx3), vecEntries.get(idx4), vecEntries.get(idx5), rgb);\n@@ -133,0 +145,1 @@\n+\n@@ -236,1 +249,1 @@\n-     public F32Mesh3D rubric(float s) {\n+    public F32Mesh3D rubric(float s) {\n@@ -248,1 +261,1 @@\n-        var newVec = f32.f32x3(x,y, z);\n+        var newVec = f32.f32x3(x, y, z);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32Mesh3D.java","additions":49,"deletions":36,"binary":false,"changes":85,"status":"modified"},{"patch":"@@ -27,1 +27,2 @@\n-import view.f32.factories.Factory2;\n+\n+import view.arity.Arity2;\n@@ -31,0 +32,1 @@\n+\n@@ -32,0 +34,1 @@\n+\n@@ -33,1 +36,1 @@\n-    interface Factory extends Factory2<Float,Float,F32x2> {\n+    interface Factory extends Arity2<Float, Float, F32x2> {\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x2.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-import view.f32.factories.Factory4;\n+import view.arity.Arity6;\n@@ -29,1 +29,1 @@\n-public interface F32x2Triangle {\n+public interface F32x2Triangle extends Comparable<F32x2Triangle> {\n@@ -31,0 +31,1 @@\n+\n@@ -32,0 +33,1 @@\n+\n@@ -33,0 +35,5 @@\n+\n+    float zplane();\n+\n+    float normal();\n+\n@@ -34,0 +41,6 @@\n+\n+    @Override\n+    default int compareTo(F32x2Triangle f32x2Triangle) {\n+        return Float.compare(zplane(), f32x2Triangle.zplane());\n+    }\n+\n@@ -35,1 +48,1 @@\n-    interface Factory extends Factory4<F32x2,F32x2,F32x2,Integer,F32x2Triangle> {\n+    interface Factory extends Arity6<F32x2, F32x2, F32x2, Float, Float, Integer, F32x2Triangle> {\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x2Triangle.java","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -26,1 +26,2 @@\n-import view.f32.factories.Factory3;\n+\n+import view.arity.Arity3;\n@@ -30,0 +31,1 @@\n+\n@@ -31,0 +33,1 @@\n+\n@@ -32,0 +35,1 @@\n+\n@@ -35,0 +39,1 @@\n+\n@@ -36,1 +41,1 @@\n-    interface Factory extends Factory3<Float,Float,Float,F32x3> {\n+    interface Factory extends Arity3<Float, Float, Float, F32x3> {\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x3.java","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -27,2 +27,1 @@\n-import view.f32.factories.Factory4;\n-import view.f32.pool.F32x3TrianglePool;\n+import view.arity.Arity4;\n@@ -32,0 +31,1 @@\n+\n@@ -33,0 +33,1 @@\n+\n@@ -34,0 +35,1 @@\n+\n@@ -35,0 +37,1 @@\n+\n@@ -38,0 +41,1 @@\n+\n@@ -39,1 +43,1 @@\n-    interface Factory extends Factory4<F32x3,F32x3,F32x3,Integer,F32x3Triangle> {\n+    interface Factory extends Arity4<F32x3, F32x3, F32x3, Integer, F32x3Triangle> {\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x3Triangle.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -26,1 +26,2 @@\n-import view.f32.factories.Factory16;\n+\n+import view.arity.Arity16;\n@@ -76,5 +77,5 @@\n-    interface Factory extends Factory16<\n-            Float,Float,Float,Float,\n-            Float,Float,Float,Float,\n-            Float,Float,Float,Float,\n-            Float,Float,Float,Float,F32x4x4>{\n+    interface Factory extends Arity16<\n+            Float, Float, Float, Float,\n+            Float, Float, Float, Float,\n+            Float, Float, Float, Float,\n+            Float, Float, Float, Float, F32x4x4> {\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/F32x4x4.java","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+\n@@ -37,1 +38,1 @@\n-    public static ModelHighWaterMark of(F32PoolBased f32){\n+    public static ModelHighWaterMark of(F32PoolBased f32) {\n@@ -40,5 +41,5 @@\n-                ((Pool<?,?>) f32.f32x3TriangleFactory()).count(),\n-                ((Pool<?,?>) f32.f32x2TriangleFactory()).count(),\n-                ((Pool<?,?>) f32.f32x2Factory()).count(),\n-                ((Pool<?,?>) f32.f32x3Factory()).count(),\n-                ((Pool<?,?>) f32.f32x4x4Factory()).count()\n+                ((Pool<?, ?>) f32.f32x3TriangleFactory()).count(),\n+                ((Pool<?, ?>) f32.f32x2TriangleFactory()).count(),\n+                ((Pool<?, ?>) f32.f32x2Factory()).count(),\n+                ((Pool<?, ?>) f32.f32x3Factory()).count(),\n+                ((Pool<?, ?>) f32.f32x4x4Factory()).count()\n@@ -51,2 +52,2 @@\n-        ((Pool<?,?>) f32.f32x2TriangleFactory()).reset(markedTriangles2D);\n-        ((Pool<?,?>) f32.f32x2Factory()).reset(markedVec2);\n+        ((Pool<?, ?>) f32.f32x2TriangleFactory()).reset(markedTriangles2D);\n+        ((Pool<?, ?>) f32.f32x2Factory()).reset(markedVec2);\n@@ -56,3 +57,3 @@\n-        ((Pool<?,?>) f32.f32x3TriangleFactory()).reset(markedTriangles3D);\n-        ((Pool<?,?>) f32.f32x3Factory()).reset(markedVec3);\n-        ((Pool<?,?>) f32.f32x4x4Factory()).reset(markedMat4);\n+        ((Pool<?, ?>) f32.f32x3TriangleFactory()).reset(markedTriangles3D);\n+        ((Pool<?, ?>) f32.f32x3Factory()).reset(markedVec3);\n+        ((Pool<?, ?>) f32.f32x4x4Factory()).reset(markedMat4);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/ModelHighWaterMark.java","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -1,91 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package view.f32;\n-\n-public class ZPos implements Comparable<ZPos> {\n-    public enum ColourMode {NORMALIZED_COLOUR, NORMALIZED_INV_COLOUR, COLOUR, NORMALIZED_WHITE, NORMALIZED_INV_WHITE, WHITE}\n-    public static final ColourMode colourMode = ColourMode.COLOUR;\n-    F32 f32;\n-    final F32x3 v0;\n-    final F32x3 v1;\n-    final F32x3 v2;\n-    final float x0, y0, x1, y1, x2, y2;\n-    final float z0, z1, z2;\n-    final float z;\n-    final float howVisible;\n-    final int rgb;\n-\n-    @Override\n-    public int compareTo(ZPos zPos) {\n-        return Float.compare(z, zPos.z);\n-    }\n-\n-    public ZPos(F32 f32, F32x3Triangle t, float howVisible) {\n-        this.f32 = f32;\n-        this.v0 = t.v0();\n-        this.v1 = t.v1();\n-        this.v2 = t.v2();\n-        this.x0 = v0.x();\n-        this.y0 = v0.y();\n-        this.z0 = v0.z();\n-        this.x1 = v1.x();\n-        this.y1 =  v1.y();\n-        this.z1 = v1.z();\n-        this.x2 =  v2.x();\n-        this.y2 =  v2.y();\n-        this.z2 = v2.z();\n-        this.rgb = t.rgb();\n-        this.howVisible = howVisible;\n-        this.z = Math.min(z0, Math.min(z1, z2));\n-    }\n-\n-\n-    public F32x2Triangle create() {\n-        int r = ((rgb & 0xff0000) >> 16);\n-        int g = ((rgb & 0x00ff00) >> 8);\n-        int b = ((rgb & 0x0000ff) >> 0);\n-\n-        if (colourMode == ColourMode.NORMALIZED_COLOUR) {\n-            r = r - (int) (20 * howVisible);\n-            g = g - (int) (20 * howVisible);\n-            b = b - (int) (20 * howVisible);\n-        } else if (colourMode == ColourMode.NORMALIZED_INV_COLOUR) {\n-            r = r + (int) (20 * howVisible);\n-            g = g + (int) (20 * howVisible);\n-            b = b + (int) (20 * howVisible);\n-        } else if (colourMode == ColourMode.NORMALIZED_WHITE) {\n-            r = g = b = (int) (0x7f - (20 * howVisible));\n-        } else if (colourMode == ColourMode.NORMALIZED_INV_WHITE) {\n-            r = g = b = (int) (0x7f + (20 * howVisible));\n-        } else if (colourMode == ColourMode.WHITE) {\n-            r = g = b = 0xff;\n-        }\n-        F32x2 v0 = f32.f32x2(x0,y0);\n-        F32x2 v1 = f32.f32x2(x1,y1);\n-        F32x2 v2 = f32.f32x2(x2,y2);\n-        return f32.f32x2Triangle(v0,v1,v2, (r & 0xff) << 16 | (g & 0xff) << 8 | (b & 0xff));\n-    }\n-}\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/ZPos.java","additions":0,"deletions":91,"binary":false,"changes":91,"status":"deleted"},{"patch":"@@ -1,40 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-package view.f32.factories;\n-\n-@FunctionalInterface\n-public\n-interface Factory16<T1, T2, T3, T4,\n-                    T5, T6, T7, T8,\n-        T9, T10, T11, T12,\n-        T13, T14, T15, T16,\n-        R> {\n-    R of(\n-            T1 var1, T2 var2, T3 var3, T4 var4,\n-            T5 var5, T6 var6, T7 var7, T8 var8,\n-            T9 var9, T10 var10, T11 var11, T12 var12,\n-            T13 var13, T14 var14, T15 var15, T16 var16\n-    );\n-}\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/factories\/Factory16.java","additions":0,"deletions":40,"binary":false,"changes":40,"status":"deleted"},{"patch":"@@ -30,0 +30,1 @@\n+\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32Pool.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,3 +29,5 @@\n-public class F32x2Pool extends F32Pool<F32x2,F32x2Pool> implements F32x2.Factory {\n-    public static int X = 0;\n-    public static int Y = 1;\n+public class F32x2Pool extends F32Pool<F32x2, F32x2Pool> implements F32x2.Factory {\n+\n+    public record PoolEntry(F32x2Pool pool, int idx) implements Pool.PoolEntry<F32x2, F32x2Pool>, F32x2 {\n+        private static final int X = 0;\n+        private static final int Y = 1;\n@@ -33,1 +35,0 @@\n-    public record PoolEntry(F32x2Pool pool, int idx) implements Pool.PoolEntry<F32x2,F32x2Pool>, F32x2 {\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x2Pool.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -31,5 +31,9 @@\n-public class F32x2TrianglePool extends Pool<F32x2Triangle,F32x2TrianglePool> implements F32x2Triangle.Factory {\n-    static int V0 = 0;\n-    static int V1 = 1;\n-    static int V2 = 2;\n-    public record PoolEntry(F32x2TrianglePool pool, int idx) implements Pool.PoolEntry<F32x2Triangle,F32x2TrianglePool>, F32x2Triangle {\n+public class F32x2TrianglePool extends Pool<F32x2Triangle, F32x2TrianglePool> implements F32x2Triangle.Factory {\n+\n+    public record PoolEntry(F32x2TrianglePool pool,\n+                            int idx) implements Pool.PoolEntry<F32x2Triangle, F32x2TrianglePool>, F32x2Triangle {\n+\n+        private static final int V0 = 0;\n+        private static final int V1 = 1;\n+        private static final int V2 = 2;\n+\n@@ -37,1 +41,1 @@\n-            return pool.f32x2Stride * idx + V0;\n+            return f32x2Stride * idx + V0;\n@@ -39,0 +43,1 @@\n+\n@@ -42,0 +47,1 @@\n+\n@@ -43,1 +49,1 @@\n-            return pool.f32x2Stride * idx + V1;\n+            return f32x2Stride * idx + V1;\n@@ -45,0 +51,1 @@\n+\n@@ -48,0 +55,1 @@\n+\n@@ -49,1 +57,1 @@\n-            return pool.f32x2Stride * idx + V2;\n+            return f32x2Stride * idx + V2;\n@@ -51,0 +59,1 @@\n+\n@@ -54,0 +63,17 @@\n+\n+        private int zplaneIdx() {\n+            return idx * zplaneStride;\n+        }\n+\n+        public float zplane() {\n+            return pool.zplaneEntries[zplaneIdx()];\n+        }\n+\n+        private int normalIdx() {\n+            return idx * normalStride;\n+        }\n+\n+        public float normal() {\n+            return pool.normalEntries[rgbIdx()];\n+        }\n+\n@@ -55,1 +81,1 @@\n-            return idx;\n+            return idx * rgbStride;\n@@ -57,0 +83,1 @@\n+\n@@ -60,0 +87,2 @@\n+\n+\n@@ -63,3 +92,7 @@\n-    private final int f32x2Stride = 3;\n-    public final int rgbEntries[];\n-    private final int rgbStride = 1;\n+    public final float zplaneEntries[];\n+    public final float normalEntries[];\n+    private final int rgbEntries[];\n+    private static final int f32x2Stride = 3;\n+    private static final int rgbStride = 1;\n+    private static final int zplaneStride = 1;\n+    private static final int normalStride = 1;\n@@ -70,0 +103,2 @@\n+        this.zplaneEntries = new float[max * zplaneStride];\n+        this.normalEntries = new float[max * normalStride];\n@@ -80,1 +115,1 @@\n-    public F32x2Triangle of(F32x2 v0, F32x2 v1, F32x2 v2, Integer rgb) {\n+    public F32x2Triangle of(F32x2 v0, F32x2 v1, F32x2 v2, Float zplane, Float normal, Integer rgb) {\n@@ -86,0 +121,3 @@\n+\n+        zplaneEntries[i.zplaneIdx()] = zplane;\n+        normalEntries[i.normalIdx()] = normal;\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x2TrianglePool.java","additions":51,"deletions":13,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -29,4 +29,1 @@\n-public class F32x3Pool extends F32Pool<F32x3,F32x3Pool> implements F32x3.Factory {\n-    private final static int X = 0;\n-    private final static int Y = 1;\n-    private final static int Z = 2;\n+public class F32x3Pool extends F32Pool<F32x3, F32x3Pool> implements F32x3.Factory {\n@@ -35,0 +32,4 @@\n+        private final static int X = 0;\n+        private final static int Y = 1;\n+        private final static int Z = 2;\n+\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x3Pool.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+\n@@ -29,4 +30,2 @@\n-public class F32x3TrianglePool extends Pool<F32x3Triangle,F32x3TrianglePool> implements F32x3Triangle.Factory{\n-    private static final int V0 = 0;\n-    private static final int V1 = 1;\n-    private static final int V2 = 2;\n+public class F32x3TrianglePool extends Pool<F32x3Triangle, F32x3TrianglePool> implements F32x3Triangle.Factory {\n+\n@@ -35,1 +34,5 @@\n-            implements Pool.PoolEntry<F32x3Triangle,F32x3TrianglePool>, F32x3Triangle {\n+            implements Pool.PoolEntry<F32x3Triangle, F32x3TrianglePool>, F32x3Triangle {\n+        private static final int V0 = 0;\n+        private static final int V1 = 1;\n+        private static final int V2 = 2;\n+\n@@ -88,1 +91,1 @@\n-        var i = (PoolEntry)entry(count++);\n+        var i = (PoolEntry) entry(count++);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x3TrianglePool.java","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -29,17 +29,1 @@\n-public class F32x4x4Pool extends F32Pool<F32x4x4,F32x4x4Pool> implements F32x4x4.Factory {\n-    static int X0Y0 = 0;\n-    static int X1Y0 = 1;\n-    static int X2Y0 = 2;\n-    static int X3Y0 = 3;\n-    static int X0Y1 = 4;\n-    static int X1Y1 = 5;\n-    static int X2Y1 = 6;\n-    static int X3Y1 = 7;\n-    static int X0Y2 = 8;\n-    static int X1Y2 = 9;\n-    static int X2Y2 = 10;\n-    static int X3Y2 = 11;\n-    static int X0Y3 = 12;\n-    static int X1Y3 = 13;\n-    static int X2Y3 = 14;\n-    static int X3Y3 = 15;\n+public class F32x4x4Pool extends F32Pool<F32x4x4, F32x4x4Pool> implements F32x4x4.Factory {\n@@ -48,0 +32,17 @@\n+    public record PoolEntry(F32x4x4Pool pool, int idx) implements Pool.PoolEntry<F32x4x4, F32x4x4Pool>, F32x4x4 {\n+        private final static int X0Y0 = 0;\n+        private final static int X1Y0 = 1;\n+        private final static int X2Y0 = 2;\n+        private final static int X3Y0 = 3;\n+        private final static int X0Y1 = 4;\n+        private final static int X1Y1 = 5;\n+        private final static int X2Y1 = 6;\n+        private final static int X3Y1 = 7;\n+        private final static int X0Y2 = 8;\n+        private final static int X1Y2 = 9;\n+        private final static int X2Y2 = 10;\n+        private final static int X3Y2 = 11;\n+        private final static int X0Y3 = 12;\n+        private final static int X1Y3 = 13;\n+        private final static int X2Y3 = 14;\n+        private final static int X3Y3 = 15;\n@@ -50,1 +51,0 @@\n-    public record PoolEntry(F32x4x4Pool pool, int idx) implements Pool.PoolEntry<F32x4x4, F32x4x4Pool>, F32x4x4 {\n@@ -204,1 +204,2 @@\n-@Override\n+\n+    @Override\n@@ -209,1 +210,1 @@\n-        var i = (PoolEntry)entry(count++);\n+        var i = (PoolEntry) entry(count++);\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/F32x4x4Pool.java","additions":21,"deletions":20,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -27,2 +27,2 @@\n-public abstract class Pool<T, P extends Pool<T,P>> {\n-    interface PoolEntry<T, P >{\n+public abstract class Pool<T, P extends Pool<T, P>> {\n+    interface PoolEntry<T, P> {\n@@ -30,0 +30,1 @@\n+\n@@ -32,0 +33,1 @@\n+\n@@ -34,1 +36,2 @@\n-    public int count(){\n+\n+    public int count() {\n@@ -37,0 +40,1 @@\n+\n@@ -40,1 +44,2 @@\n-    Pool( int max) {\n+\n+    Pool(int max) {\n@@ -43,0 +48,1 @@\n+\n","filename":"hat\/examples\/view\/src\/main\/java\/view\/f32\/pool\/Pool.java","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"}]}