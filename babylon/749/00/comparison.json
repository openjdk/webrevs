{"files":[{"patch":"@@ -28,0 +28,1 @@\n+import java.util.Arrays;\n@@ -29,0 +30,1 @@\n+import java.util.Optional;\n@@ -150,2 +152,1 @@\n-    private int bits;\n-\n+    final private int bits;\n@@ -156,3 +157,0 @@\n-    public void bits(int bits){\n-        this.bits = bits;\n-    }\n@@ -160,2 +158,2 @@\n-    Config(int bits){\n-        bits(bits);\n+    Config(int bits, boolean junk){\n+        this.bits = bits;\n@@ -169,1 +167,1 @@\n-            System.out.println(\"From env \" + opts);\n+           \/\/ System.out.println(\"From env \" + opts);\n@@ -171,3 +169,2 @@\n-        }\n-        if (System.getProperty(\"HAT\") instanceof String opts) {\n-            System.out.println(\"From prop \" + opts);\n+        }else if (System.getProperty(\"HAT\") instanceof String opts) {\n+           \/\/ System.out.println(\"From prop \" + opts);\n@@ -175,0 +172,2 @@\n+        }else {\n+            return fromSpec(\"\");\n@@ -176,1 +175,0 @@\n-        return fromSpec(\"\");\n@@ -180,1 +178,1 @@\n-        return new Config(bits);\n+        return new Config(bits,false);\n@@ -183,21 +181,1 @@\n-    public static Config fromBits(List<Bit> configBits) {\n-        int allBits = 0;\n-        for (Bit configBit : configBits) {\n-            allBits |= configBit.mask();\n-        }\n-        return new Config(allBits);\n-    }\n-\n-    public static Config fromBits(Bit... configBits) {\n-        return fromBits(List.of(configBits));\n-    }\n-\n-    public Config and(Bit... configBits) {\n-        return Config.fromIntBits(Config.fromBits(List.of(configBits)).bits & bits);\n-    }\n-\n-    public Config or(Bit... configBits) {\n-        return Config.fromIntBits(Config.fromBits(List.of(configBits)).bits | bits);\n-    }\n-\n-    public record BitValue(Bit bit, int value){}\n+     record BitValue(Bit bit, int value){}\n@@ -205,0 +183,1 @@\n+    \/\/ recursive!!!\n@@ -206,6 +185,16 @@\n-        if (spec == null || spec.equals(\"\")) {\n-            return Config.fromIntBits(0);\n-        }\n-        for (Bit bit:bitList) {\n-            if (bit.name().equals(spec)) {\n-                return new Config(bit.mask());\n+        Optional<Config> returnValue=Optional.of(Config.fromIntBits(0));\n+        if (spec == null || spec.isEmpty()) {\n+           \/\/ default is good\n+        }else if (spec.contains(\",\")) {\n+            returnValue =  Arrays.stream(spec.split(\",\")).map(Config::fromSpec).reduce((lhs, rhs) -> Config.fromIntBits(lhs.bits() | rhs.bits()));\n+        } else if (!spec.contains(\":\")) {\n+            returnValue=  bitList.stream().filter(bit->bit.name().equals(spec)).findFirst().map(b->fromIntBits(b.mask()));\n+        }else{\n+            var split = spec.split(\":\");\n+            if (split.length==2) {\n+                var optBit = bitList.stream().filter(bit -> bit.name().equals(split[0])).findFirst();\n+                if (optBit.isPresent()) {\n+                    var bv = new BitValue(optBit.get(), Integer.parseInt(split[1]));\n+                    var bitz = bv.value << bv.bit().index();\n+                    returnValue= Optional.of(fromIntBits(bitz));\n+                }\n@@ -214,15 +203,3 @@\n-        if (spec.contains(\",\")) {\n-            var bits = 0;\n-            for (var opt: spec.split(\",\")) {\n-                var split = opt.split(\":\");\n-                var valName=split[0];\n-                var value=split.length==1?1:Integer.parseInt(split[1]);\n-                var bitValue = Config.bitList.stream()\n-                        .filter(bit ->bit.name().equals(valName))\n-                        .map(bit -> new BitValue(bit, value))\n-                        .findFirst()\n-                        .orElseThrow();\n-                bits |= bitValue.value << bitValue.bit.index();\n-            }\n-            return fromIntBits(bits);\n-        } else {\n+        if (returnValue.isPresent()) {\n+            return returnValue.get();\n+        }else {\n@@ -231,1 +208,0 @@\n-            return Config.fromIntBits(0);\n@@ -233,0 +209,1 @@\n+        return null;\n","filename":"hat\/core\/src\/main\/java\/hat\/Config.java","additions":33,"deletions":56,"binary":false,"changes":89,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n-  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_X\" project-jdk-name=\"Babylon-26-09-12-25\" project-jdk-type=\"JavaSDK\">\n+  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_X\" project-jdk-name=\"Babylon Dec15\" project-jdk-type=\"JavaSDK\">\n","filename":"hat\/intellij\/.idea\/misc.xml","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}