{"files":[{"patch":"@@ -31,1 +31,0 @@\n-import optkl.codebuilders.JavaCodeBuilder;\n@@ -42,1 +41,0 @@\n-import optkl.ifacemapper.Buffer;\n@@ -95,1 +93,1 @@\n-                    System.out.println(\"MappableIface.RO\");\n+                    \/\/System.out.println(\"MappableIface.RO\");\n@@ -105,1 +103,1 @@\n-                    System.out.println(\"MappableIface.RW\");\n+                    \/\/System.out.println(\"MappableIface.RW\");\n@@ -115,1 +113,1 @@\n-                    System.out.println(\"MappableIface.WO\");\n+                   \/\/ System.out.println(\"MappableIface.WO\");\n@@ -131,5 +129,2 @@\n-                  \/\/  .when(config().showComputeModel(), trxfmr -> trxfmr.toText(\"COMPUTE before injecting buffer tracking...\"))\n-                    .when(config().showComputeModel(), trxfmr ->{\n-                     var javaCodeBuilder = new JavaCodeBuilder<>(lookup(),trxfmr.funcOp());\n-                      System.out.println(javaCodeBuilder.toText());\n-                    })\n+                    .when(config().showComputeModel(), trxfmr -> trxfmr.toText(\"COMPUTE before injecting buffer tracking...\"))\n+                    .when(config().showComputeModelJavaCode(), trxfmr -> trxfmr.toJavaSource(lookup(),\"COMPUTE (Java) before injecting buffer tracking...\"))\n@@ -138,1 +133,1 @@\n-                        if (invoke.isMappableIface() && (invoke.returns(Buffer.class) || invoke.returnsPrimitive())) {\n+                        if (invoke.isMappableIface() && (invoke.returns(MappableIface.class) || invoke.returnsPrimitive())) {\n@@ -145,2 +140,0 @@\n-                            \/\/List<Value> list = invoke.op().operands();\n-                            \/\/if (!list.isEmpty()) {\n","filename":"hat\/backends\/ffi\/shared\/src\/main\/java\/hat\/backend\/ffi\/FFIBackend.java","additions":6,"deletions":13,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-It was auto generated 2025-11-04 15:18:52.357 by hat.FFIConfigCreator\n+It was auto generated 2026-01-06 18:19:54.731 by hat.FFIConfigCreator\n@@ -33,1 +33,0 @@\n-\n@@ -57,0 +56,1 @@\n+    static constexpr int SHOW_COMPUTE_MODEL_JAVA_CODE_BIT = 1<<0x1e;\n@@ -82,0 +82,1 @@\n+    bool showComputeModelJavaCode;\n@@ -109,0 +110,1 @@\n+        showComputeModelJavaCode((configBits & SHOW_COMPUTE_MODEL_JAVA_CODE_BIT)==SHOW_COMPUTE_MODEL_JAVA_CODE_BIT),\n@@ -135,0 +137,1 @@\n+                std::cout << \"native showComputeModelJavaCode \" << showComputeModelJavaCode << std::endl;\n@@ -166,0 +169,1 @@\n+    \"SHOW_COMPUTE_MODEL_JAVA_CODE_BIT\",\n@@ -190,0 +194,1 @@\n+    \"Show java code view of compute model\",\n","filename":"hat\/backends\/ffi\/shared\/src\/main\/native\/include\/config.h","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -122,1 +122,1 @@\n-    public boolean isProfileCUDAKernel() {\n+    public boolean profileCUDAKernel() {\n@@ -125,0 +125,5 @@\n+    private static final Bit SHOW_COMPUTE_MODEL_JAVA_CODE = Bit.nextBit(PROFILE_CUDA_KERNEL, \"SHOW_COMPUTE_MODEL_JAVA_CODE\", \"Show java code view of compute model\");\n+\n+    public boolean showComputeModelJavaCode() {\n+        return SHOW_COMPUTE_MODEL_JAVA_CODE.isSet(this);\n+    }\n@@ -149,1 +154,2 @@\n-            PROFILE_CUDA_KERNEL\n+            PROFILE_CUDA_KERNEL,\n+            SHOW_COMPUTE_MODEL_JAVA_CODE\n","filename":"hat\/core\/src\/main\/java\/hat\/Config.java","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -203,2 +203,1 @@\n-                    var javaCodeBuilder = new JavaCodeBuilder<>(lookup, trxfmr.funcOp());\n-                    System.out.println(javaCodeBuilder.toText());\n+                    trxfmr.toJavaSource(lookup);\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/CreateFuncOp.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -308,1 +308,1 @@\n-    static F32Array2D createF32Array2D(ComputeContext cc, int width, int height) {\n+    public static F32Array2D createF32Array2D(ComputeContext cc, int width, int height) {\n","filename":"hat\/examples\/violajones\/src\/main\/java\/violajones\/ViolaJonesCoreCompute.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+import optkl.codebuilders.JavaCodeBuilder;\n@@ -39,0 +40,1 @@\n+import java.lang.invoke.MethodHandles;\n@@ -88,0 +90,21 @@\n+    public Trxfmr toJavaSource(MethodHandles.Lookup lookup,String prefix, String suffix) {\n+        return run(trxfmr -> {\n+                    if (prefix != null && !prefix.isEmpty()){\n+                        System.out.println(prefix);\n+                    }\n+                    var javaCodeBuilder = new JavaCodeBuilder<>(lookup, trxfmr.funcOp());\n+                    System.out.println(javaCodeBuilder.toText());\n+                    if (suffix != null && !suffix.isEmpty()){\n+                        System.out.println(suffix);\n+                    }\n+                }\n+        );\n+\n+    }\n+    public Trxfmr toJavaSource(MethodHandles.Lookup lookup,String prefix) {\n+        return toJavaSource(lookup,prefix, null);\n+    }\n+    public Trxfmr toJavaSource(MethodHandles.Lookup lookup) {\n+        return toJavaSource(lookup,null, null);\n+    }\n+\n","filename":"hat\/optkl\/src\/main\/java\/optkl\/Trxfmr.java","additions":23,"deletions":0,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -35,1 +35,0 @@\n-import optkl.util.Regex;\n@@ -87,2 +86,0 @@\n-    \/\/\/ \/\n-\n@@ -132,3 +129,1 @@\n-            literal(fieldAccess.getStaticFinalPrimitiveValue().toString());\n-            blockInlineComment(\"Non HAT friendly field load?\"+fieldAccess.name());\n-            \/\/throw new IllegalStateException(\"Where did this field come from ?\" + fieldLoadOp1);\n+          identifier(fieldAccess.name());\n@@ -142,2 +137,4 @@\n-        \/\/  throw new IllegalStateException(\"What is this field store ?\" + fieldStoreOp);\n-        blockInlineComment(\"Non HAT friendly field load? \"+fieldAccess.name());\n+        identifier(fieldAccess.name()).space().equals().space();\n+        recurse(buildContext,((Op.Result)fieldAccess.op().operands().get(0)).op());\n+        dot();\n+        recurse(buildContext,((Op.Result)fieldAccess.op().operands().get(1)).op());\n","filename":"hat\/optkl\/src\/main\/java\/optkl\/codebuilders\/JavaOrC99StyleCodeBuilder.java","additions":5,"deletions":8,"binary":false,"changes":13,"status":"modified"}]}