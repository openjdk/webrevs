{"files":[{"patch":"@@ -90,2 +90,2 @@\n-                .buildStructSingleValueMember(\"F16\", \"half\")\n-                .buildStructSingleValueMember(\"BF16\",  \"BFLOAT16\");\n+                .typedefSingleValueStruct(\"F16\", \"half\")\n+                .typedefSingleValueStruct(\"BF16\",  \"BFLOAT16\");\n@@ -368,2 +368,2 @@\n-            case ReducedFloatType.HalfFloat _ -> halfType();\n-            case ReducedFloatType.BFloat16 _ -> bfloatType();\n+            case ReducedFloatType.HalfFloat _ -> f16Type();\n+            case ReducedFloatType.BFloat16 _ -> bf16Type();\n","filename":"hat\/backends\/ffi\/cuda\/src\/main\/java\/hat\/backend\/ffi\/CudaHATKernelBuilder.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -84,2 +84,2 @@\n-                .buildStructSingleValueMember(\"F16\",  \"half\")\n-                .buildStructSingleValueMember(\"BF16\",  \"BFLOAT16\")\n+                .typedefSingleValueStruct(\"F16\",  \"half\")\n+                .typedefSingleValueStruct(\"BF16\",  \"BFLOAT16\")\n@@ -204,1 +204,1 @@\n-               halfType();\n+               f16Type();\n@@ -206,1 +206,1 @@\n-               bfloatType();\n+               bf16Type();\n","filename":"hat\/backends\/ffi\/opencl\/src\/main\/java\/hat\/backend\/ffi\/OpenCLHATKernelBuilder.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -208,1 +208,1 @@\n-        return paren(_->halfType()).identifier(hatF16ToFloatConvOp.varName());\n+        return paren(_-> f16Type()).identifier(hatF16ToFloatConvOp.varName());\n","filename":"hat\/backends\/jextracted\/opencl\/src\/main\/java\/hat\/backend\/jextracted\/OpenCLJExtractedHATKernelBuilder.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-import hat.codebuilders.CodeBuilder;\n@@ -67,2 +66,2 @@\n-            cb.constKeyword().space().staticKeyword().space().charType().space().asterisk().bitNamesVar().osbrace().csbrace().semicolon().space().lineComment(\"See below for initialization\");\n-            cb.constKeyword().space().staticKeyword().space().charType().space().asterisk().bitDescriptionsVar().osbrace().csbrace().semicolon().space().lineComment(\"See below for initialization\");\n+            cb.constKeyword().space().staticKeyword().space().s08Type().space().asterisk().bitNamesVar().osbrace().csbrace().semicolon().space().lineComment(\"See below for initialization\");\n+            cb.constKeyword().space().staticKeyword().space().s08Type().space().asterisk().bitDescriptionsVar().osbrace().csbrace().semicolon().space().lineComment(\"See below for initialization\");\n@@ -70,1 +69,1 @@\n-            cb.intType().space().identifier(\"configBits\").semicolon().nl();\n+            cb.s32Type().space().identifier(\"configBits\").semicolon().nl();\n@@ -76,2 +75,2 @@\n-            cb.intType().space().identifier(\"platform\").semicolon().nl();\n-            cb.intType().space().identifier(\"device\").semicolon().nl();\n+            cb.s32Type().space().identifier(\"platform\").semicolon().nl();\n+            cb.s32Type().space().identifier(\"device\").semicolon().nl();\n@@ -80,1 +79,1 @@\n-            cb.explicitKeyword().space().className().paren((_) -> cb.intType().space().configBitsVar()).colon().nl().indent((_) -> {\n+            cb.explicitKeyword().space().className().paren((_) -> cb.s32Type().space().configBitsVar()).colon().nl().indent((_) -> {\n@@ -105,1 +104,1 @@\n-            cb.constKeyword().space().charType().space().asterisk().className().colon().colon().bitNamesVar().ocsbrace().equals().brace((_) -> {\n+            cb.constKeyword().space().s08Type().space().asterisk().className().colon().colon().bitNamesVar().ocsbrace().equals().brace((_) -> {\n@@ -111,1 +110,1 @@\n-            cb.constKeyword().space().charType().space().asterisk().className().colon().colon().bitDescriptionsVar().ocsbrace().equals().brace((_) -> {\n+            cb.constKeyword().space().s08Type().space().asterisk().className().colon().colon().bitDescriptionsVar().ocsbrace().equals().brace((_) -> {\n","filename":"hat\/core\/src\/main\/java\/hat\/FFIConfigCreator.java","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-import java.util.Arrays;\n@@ -170,2 +169,2 @@\n-    public final T unsignedCharType() {\n-        return typeName(\"unsigned\").space().charType();\n+    public final T u08Type() {\n+        return typeName(\"unsigned\").space().s08Type();\n@@ -173,2 +172,2 @@\n-    public final T unsignedCharType(String identifier) {\n-        return unsignedCharType().space().identifier(identifier);\n+    public final T u08Type(String identifier) {\n+        return u08Type().space().identifier(identifier);\n@@ -177,1 +176,1 @@\n-        return unsignedCharType().space().asterisk();\n+        return u08Type().space().asterisk();\n@@ -183,9 +182,0 @@\n-    public final T charTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> charType(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T unsignedCharTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> unsignedCharType(), _ -> identifier(name)));\n-        return self();\n-    }\n@@ -193,43 +183,0 @@\n-    public final T shortTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> shortType(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T unsignedShortTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> unsignedShortType(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T intTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> intType(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T unsignedIntTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> u32Type(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T floatTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> f32Type(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T longTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> longType(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T unsignedLongTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> unsignedLongType(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-    public final T doubleTypeDefs(String... names) {\n-        Arrays.stream(names).forEach(name -> typedef(_ -> doubleType(), _ -> identifier(name)));\n-        return self();\n-    }\n-\n-     public final  T typedef(Consumer<T> lhs, Consumer<T> rhs) {\n-        return semicolonNlTerminated(_ -> typedefKeyword().space().accept(lhs).space().accept(rhs));\n-    }\n@@ -238,1 +185,1 @@\n-        return typeName(\"unsigned\").space().intType();\n+        return typeName(\"unsigned\").space().s32Type();\n@@ -245,2 +192,2 @@\n-    public final T unsignedLongType() {\n-        return typeName(\"unsigned\").space().longType();\n+    public final T u64Type() {\n+        return typeName(\"unsigned\").space().s64Type();\n@@ -249,2 +196,2 @@\n-    public final T unsignedShortType() {\n-        return typeName(\"unsigned\").space().shortType();\n+    public final T u16Type() {\n+        return typeName(\"unsigned\").space().s16Type();\n@@ -252,2 +199,2 @@\n-    public final T unsignedShortType(String identifier) {\n-        return unsignedShortType().space().identifier(identifier);\n+    public final T u16Type(String identifier) {\n+        return u16Type().space().identifier(identifier);\n@@ -276,0 +223,73 @@\n+    public final T typedefStruct(Class<?>clazz, Consumer<T> consumer) {\n+        return typedefStruct(clazz.getSimpleName(), consumer);\n+    }\n+\n+\n+    public final T typedefSingleValueStruct(String structName, String type) {\n+        return typedefStruct(structName,_-> typeName(type).space().identifier(\"value\").semicolonNl());\n+    }\n+\n+    public final T funcDef(Consumer<T> type,Consumer<T> name, Consumer<T> args, Consumer<T> body){\n+        type.accept(self());\n+        space();\n+        name.accept(self());\n+        paren(args);\n+        braceNlIndented(body);\n+        return nl();\n+    }\n+    public final T assign(Consumer<T> lhs, Consumer<T> rhs){\n+        lhs.accept(self());\n+        space().equals().space();\n+        rhs.accept(self());\n+        return self();\n+    }\n+\n+    public final T cast(Consumer<T> type){\n+        return paren(_-> type.accept(self()));\n+    }\n+    public final T returnKeyword(Consumer<T> exp){\n+        return returnKeyword().space().paren(_-> exp.accept(self())).semicolon();\n+    }\n+\n+    public final T call(Consumer<T> name,Consumer<T> ...args){\n+        name.accept(self());\n+        return paren(_->commaSpaceSeparated(args));\n+    }\n+    public final T call(String name,Consumer<T> ...args){\n+        return call(_->identifier(name),args);\n+    }\n+\n+    public final T forLoop(Consumer<T> init, Consumer<T> test, Consumer<T>mutate, Consumer<T>body){\n+        return  forKeyword()\n+                .paren(_->{\n+                    init.accept(self());\n+                    semicolon().space();\n+                    test.accept(self());\n+                    semicolon().space();mutate.accept(self());\n+                })\n+                .braceNlIndented(body::accept)\n+                .nl();\n+    }\n+\n+\n+    public final T sizeof() {\n+        return emitText(\"sizeof\");\n+    }\n+    public final T sizeof(String identifier) {\n+        return sizeof(_->identifier(identifier));\n+    }\n+    public final T sizeof(Consumer<T> consumer) {\n+        return sizeof().paren(consumer);\n+    }\n+    public final T voidPtrType() {\n+        return voidType().space().asterisk();\n+    }\n+    public final T voidPtrType(String identifier) {\n+        return voidPtrType().identifier(identifier);\n+    }\n+    public final T sizeType() {\n+        return typeName(\"size_t\");\n+    }\n+    public final T sizeType(String identifier) {\n+        return sizeType().space().identifier(identifier);\n+    }\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/C99HATCodeBuilder.java","additions":85,"deletions":65,"binary":false,"changes":150,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-import jdk.incubator.code.Op;\n@@ -33,1 +32,1 @@\n-        staticKeyword().space().constexprKeyword().space().intType().space().identifier(name, padWidth).space().equals().space().intHexValue(value).semicolon().nl();\n+        staticKeyword().space().constexprKeyword().space().s32Type().space().identifier(name, padWidth).space().equals().space().intHexValue(value).semicolon().nl();\n@@ -38,1 +37,1 @@\n-        staticKeyword().space().constexprKeyword().space().intType().space().identifier(name, padWidth).space().equals().space().intValue(1).leftShift().intHexValue(shift).semicolon().nl();\n+        staticKeyword().space().constexprKeyword().space().s32Type().space().identifier(name, padWidth).space().equals().space().intValue(1).leftShift().intHexValue(shift).semicolon().nl();\n@@ -66,11 +65,0 @@\n-    public  String toCamelExceptFirst(String s) {\n-        String[] parts = s.split(\"_\");\n-        StringBuilder camelCaseString = new StringBuilder();\n-        for (String part : parts) {\n-            camelCaseString.append(camelCaseString.isEmpty()\n-                    ? part.toLowerCase()\n-                    : part.substring(0, 1).toUpperCase() + part.substring(1).toLowerCase());\n-        }\n-        return camelCaseString.toString();\n-    }\n-\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/C99HATConfigBuilder.java","additions":2,"deletions":14,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -30,1 +30,0 @@\n-import hat.buffer.Buffer;\n@@ -58,1 +57,0 @@\n-import jdk.incubator.code.Value;\n@@ -66,1 +64,0 @@\n-import java.util.function.Consumer;\n@@ -71,10 +68,1 @@\n-\n-    public T kernelDeclaration(CoreOp.FuncOp funcOp) {\n-        return kernelPrefix().voidType().space().funcName(funcOp);\n-    }\n-\n-    public T functionDeclaration(ScopedCodeBuilderContext codeBuilderContext, JavaType javaType, CoreOp.FuncOp funcOp) {\n-        return functionPrefix().type(codeBuilderContext,javaType).space().funcName(funcOp);\n-    }\n-\n-    public T kernelPrefix() {\n+    public T HAT_KERNEL() {\n@@ -83,2 +71,1 @@\n-\n-    public T functionPrefix() {\n+    public T HAT_FUNC() {\n@@ -88,1 +75,1 @@\n-    public T globalPtrPrefix() {\n+    public T HAT_GLOBAL_MEM() {\n@@ -91,0 +78,9 @@\n+    public T HAT_LOCAL_MEM() {\n+        return keyword(\"HAT_LOCAL_MEM\").space();\n+    }\n+    public T HAT_BARRIER() {\n+        return keyword(\"HAT_BARRIER\").space();\n+    }\n+    public T kernelDeclaration(CoreOp.FuncOp funcOp) {\n+        return HAT_KERNEL().voidType().space().funcName(funcOp);\n+    }\n@@ -92,0 +88,3 @@\n+    public T functionDeclaration(ScopedCodeBuilderContext codeBuilderContext, JavaType javaType, CoreOp.FuncOp funcOp) {\n+        return HAT_FUNC().type(codeBuilderContext,javaType).space().funcName(funcOp);\n+    }\n@@ -197,3 +196,1 @@\n-    public T localPtrPrefix() {\n-        return keyword(\"HAT_LOCAL_MEM\").space();\n-    }\n+\n@@ -201,1 +198,1 @@\n-        return localPtrPrefix() \/\/ we should be able to compose-call to privateDeclaration?\n+        return HAT_LOCAL_MEM() \/\/ we should be able to compose-call to privateDeclaration?\n@@ -209,1 +206,1 @@\n-        return identifier(\"HAT_BARRIER\");\n+        return HAT_BARRIER();\n@@ -213,1 +210,0 @@\n-\n@@ -226,6 +222,4 @@\n-        return charTypeDefs(\"byte\", \"boolean\")\n-                .nl()\n-                .typedefStructOrUnion(true, KernelContext.class, _ ->\n-                    intDeclaration(\"dimensions\").semicolon()\n-                )\n-                .nl();\n+        return\n+                 typedefKeyword().space().s08Type(\"byte\").semicolonNl()\n+                .typedefKeyword().space().s08Type(\"boolean\").semicolonNl()\n+                .typedefStruct(KernelContext.class, _ -> s32Type(\"dimensions\").semicolon()).nl();\n@@ -246,1 +240,1 @@\n-            globalPtrPrefix().suffix_t(classType).asterisk();\n+            HAT_GLOBAL_MEM().suffix_t(classType).asterisk();\n@@ -248,1 +242,1 @@\n-            globalPtrPrefix().suffix_t(KernelContext.class).asterisk();\n+            HAT_GLOBAL_MEM().suffix_t(KernelContext.class).asterisk();\n@@ -252,1 +246,1 @@\n-            globalPtrPrefix().suffix_t(F16Impl.class).asterisk();\n+            HAT_GLOBAL_MEM().suffix_t(F16Impl.class).asterisk();\n@@ -256,1 +250,1 @@\n-            globalPtrPrefix().suffix_t(BF16Array.BF16Impl.class).asterisk();\n+            HAT_GLOBAL_MEM().suffix_t(BF16Array.BF16Impl.class).asterisk();\n@@ -377,0 +371,3 @@\n+    public final T f16Type() {\n+        return suffix_t(F16.class);\n+    }\n@@ -378,0 +375,3 @@\n+    public final T bf16Type() {\n+        return suffix_t(BF16.class);\n+    }\n@@ -382,2 +382,2 @@\n-            case ReducedFloatType.HalfFloat _ -> halfType();\n-            case ReducedFloatType.BFloat16 _ ->  bfloatType();\n+            case ReducedFloatType.HalfFloat _ -> f16Type();\n+            case ReducedFloatType.BFloat16 _ ->  bf16Type();\n@@ -385,7 +385,3 @@\n-        })\n-                .space()\n-                .identifier(hatF16VarOp.varName())\n-                .space()\n-                .equals()\n-                .space()\n-                .recurse(buildContext, OpTk.asResultOrThrow(hatF16VarOp.operands().getFirst()).op());\n+        }).space().assign(\n+                _-> identifier(hatF16VarOp.varName()),\n+                _->recurse(buildContext, OpTk.asResultOrThrow(hatF16VarOp.operands().getFirst()).op()));\n@@ -412,1 +408,1 @@\n-        paren(_->bfloatType());\n+        paren(_-> bf16Type());\n@@ -463,1 +459,1 @@\n-        paren(_-> halfType());\n+        paren(_-> f16Type());\n@@ -510,7 +506,4 @@\n-        return suffix_t(hatPrivateInitVarOp.classType())\n-                .space()\n-                .identifier(hatPrivateInitVarOp.varName())\n-                .space()\n-                .equals()\n-                .space()\n-                .recurse(builderContext,OpTk.asResultOrThrow(hatPrivateInitVarOp.operands().getFirst()).op());\n+        return suffix_t(hatPrivateInitVarOp.classType()).space()\n+                .assign(\n+                        _-> identifier(hatPrivateInitVarOp.varName()),\n+                        _->recurse(builderContext,OpTk.asResultOrThrow(hatPrivateInitVarOp.operands().getFirst()).op()));\n@@ -528,43 +521,0 @@\n-    public final T buildStructSingleValueMember(String structName,  String type) {\n-       return typedefStruct(structName,_-> typeName(type).space().identifier(\"value\").semicolonNl());\n-    }\n-\n-    public final T buildForLoopHeader(String loopVar, String init, String loopBound) {\n-        forKeyword().paren(_ -> intType().space().identifier(loopVar).space().equals().identifier(init).semicolon().space()\n-                .identifier(loopVar).lt().identifier(loopBound).semicolon().space()\n-                .identifier(loopVar).plusplus());\n-        return self();\n-    }\n-\n-    \/\/public final T call_builtin_byteCopy(){\n-      \/\/  return identifier(\"\");\n-   \/\/ }\n-\n-    public final T funcDef(Consumer<T> type,Consumer<T> name, Consumer<T> args, Consumer<T> body){\n-         type.accept(self());\n-         space();\n-         name.accept(self());\n-         paren(args);\n-         braceNlIndented(body);\n-         return nl();\n-    }\n-    public final T assign(Consumer<T> lhs,Consumer<T> rhs){\n-        lhs.accept(self());\n-        space().equals().space();\n-        rhs.accept(self());\n-        return semicolonNl();\n-    }\n-    public final T cast(Consumer<T> type){\n-        return paren(_-> type.accept(self()));\n-    }\n-    public final T returnKeyword(Consumer<T> exp){\n-        return returnKeyword().space().paren(_-> exp.accept(self())).semicolon();\n-    }\n-\n-    public final T call(Consumer<T> name,Consumer<T> ...args){\n-        name.accept(self());\n-        return paren(_->commaSpaceSeparated(args));\n-    }\n-    public final T call(String name,Consumer<T> ...args){\n-        return call(_->identifier(name),args);\n-    }\n@@ -589,4 +539,4 @@\n-                _->commaSpaceSeparated(\n-                        _-> voidPtrType(\"dest\"),\n-                        _-> voidPtrType(\"src\"),\n-                        _-> size_t(\"size\")\n+                _->args(\n+                        _->voidPtrType(\"dest\"),\n+                        _->voidPtrType(\"src\"),\n+                        _->sizeType(\"size\")\n@@ -595,4 +545,7 @@\n-                   assign(_->u08PtrType(\"c\"), _->cast(_ -> u08PtrType()).identifier(\"dest\"))\n-                   .assign(_->u08PtrType(\"s\"), _->cast(_ -> u08PtrType()).identifier(\"src\"))\n-                   .buildForLoopHeader(\"i\", \"0\", \"size\").braceNlIndented(_ ->\n-                        dereference(\"c\").plusplus().equals().dereference(\"s\").plusplus().semicolon()\n+                    assign(_->u08PtrType(\"c\"), _->cast(_ -> u08PtrType()).identifier(\"dest\")).semicolonNl()\n+                   .assign(_->u08PtrType(\"s\"), _->cast(_ -> u08PtrType()).identifier(\"src\")).semicolonNl()\n+                   .forLoop(\n+                           _->assign(_-> s32Type(\"i\"), _->intConstZero()),\n+                           _->identifier(\"i\").lt().identifier(\"size\"),\n+                           _->identifier(\"i\").plusplus(),\n+                           _->dereference(\"c\").plusplus().equals().dereference(\"s\").plusplus().semicolon()\n@@ -619,2 +572,2 @@\n-                _->unsignedShortType(parameterName),\n-                 _ -> assign(_->u32Type(\"bits\"), _->identifier(parameterName).leftShift(16))\n+                _-> u16Type(parameterName),\n+                 _ -> assign(_->u32Type(\"bits\"), _->identifier(parameterName).leftShift(16)).semicolonNl()\n@@ -622,2 +575,1 @@\n-                      .call(\"byteCopy\",_->addressOf(\"r\"),_->addressOf(\"bits\"),_->sizeof(\"r\"))\n-                      .semicolonNl()\n+                      .call(\"byteCopy\",_->addressOf(\"r\"),_->addressOf(\"bits\"),_->sizeof(\"r\")).semicolonNl()\n@@ -642,1 +594,1 @@\n-                _->shortType(),\n+                _-> s16Type(),\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/C99HATKernelBuilder.java","additions":58,"deletions":106,"binary":false,"changes":164,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-import hat.buffer.BF16;\n-import hat.buffer.F16;\n@@ -488,0 +486,3 @@\n+    public T args(Consumer<T> ...consumers){\n+       return  commaSpaceSeparated(consumers);\n+    }\n@@ -524,1 +525,1 @@\n-    public final T intType() {\n+    public final T s32Type() {\n@@ -527,0 +528,3 @@\n+    public final T s32Type(String identifier) {\n+        return s32Type().space().identifier(identifier);\n+    }\n@@ -541,13 +545,2 @@\n-    public final T voidPtrType() {\n-        return voidType().space().asterisk();\n-    }\n-    public final T voidPtrType(String identifier) {\n-        return voidPtrType().identifier(identifier);\n-    }\n-    public final T size_t() {\n-        return typeName(\"size_t\");\n-    }\n-    public final T size_t(String identifier) {\n-        return size_t().space().identifier(identifier);\n-    }\n-    public final T charType() {\n+\n+    public final T s08Type() {\n@@ -556,0 +549,3 @@\n+    public final T s08Type(String name) {\n+        return s08Type().space().identifier(name);\n+    }\n@@ -564,1 +560,1 @@\n-    public final T longType() {\n+    public final T s64Type() {\n@@ -568,1 +564,1 @@\n-    public final T doubleType() {\n+    public final T f64Type() {\n@@ -572,1 +568,1 @@\n-    public final T booleanType() {\n+    public final T boolType() {\n@@ -577,1 +573,1 @@\n-    public final T shortType() {\n+    public final T s16Type() {\n@@ -580,2 +576,2 @@\n-    public final T shortType(String identifier) {\n-        return shortType().space().identifier(identifier);\n+    public final T s16Type(String identifier) {\n+        return s16Type().space().identifier(identifier);\n@@ -584,3 +580,0 @@\n-    public final T halfType() {\n-        return typeName(F16.class.getSimpleName() + \"_t\");\n-    }\n@@ -588,3 +581,0 @@\n-    public final T bfloatType() {\n-        return typeName(BF16.class.getSimpleName() + \"_t\");\n-    }\n@@ -648,8 +638,10 @@\n-    public T sizeof() {\n-        return emitText(\"sizeof\");\n-    }\n-    public T sizeof(String identifier) {\n-        return sizeof(_->identifier(identifier));\n-    }\n-    public T sizeof(Consumer<T> consumer) {\n-        return sizeof().paren(consumer);\n+\n+    public  String toCamelExceptFirst(String s) {\n+        String[] parts = s.split(\"_\");\n+        StringBuilder camelCaseString = new StringBuilder();\n+        for (String part : parts) {\n+            camelCaseString.append(camelCaseString.isEmpty()\n+                    ? part.toLowerCase()\n+                    : part.substring(0, 1).toUpperCase() + part.substring(1).toLowerCase());\n+        }\n+        return camelCaseString.toString();\n@@ -657,0 +649,2 @@\n+\n+\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/CodeBuilder.java","additions":30,"deletions":36,"binary":false,"changes":66,"status":"modified"},{"patch":"@@ -36,1 +36,1 @@\n-    public T oracleCopyright(){\n+    public final T oracleCopyright(){\n@@ -64,7 +64,3 @@\n-    public T intDeclaration(String name) {\n-        return intType().space().identifier(name);\n-    }\n-\n-    public T floatDeclaration(String name) {\n-        return f32Type().space().identifier(name);\n-    }\n+    \/\/public final T s32Declaration(String name) {\n+      \/\/  return s32Type(name);\n+   \/\/ }\n@@ -72,2 +68,2 @@\n-    public T doubleDeclaration(String name) {\n-        return doubleType().space().identifier(name);\n+    public final T varName(CoreOp.VarOp varOp) {\n+        return identifier(varOp.varName());\n@@ -75,7 +71,2 @@\n-\n-    public T longDeclaration(String name) {\n-        return longType().space().identifier(name);\n-    }\n-\n-    public T booleanDeclaration(String name) {\n-        return booleanType().space().identifier(name);\n+    public final  T funcName(CoreOp.FuncCallOp funcCallOp){\n+        return identifier(funcCallOp.funcName());\n@@ -83,3 +74,2 @@\n-\n-    public T byteDeclaration(String name) {\n-        return charType().space().identifier(name);\n+    public final T funcName(CoreOp.FuncOp funcOp) {\n+        return identifier(funcOp.funcName());\n@@ -87,3 +77,2 @@\n-\n-    public T shortDeclaration(String name) {\n-        return shortType().space().identifier(name);\n+    public final T fieldName(JavaOp.FieldAccessOp fieldAccessOp) {\n+        return identifier(OpTk.fieldName(fieldAccessOp));\n@@ -91,4 +80,2 @@\n-\n-    public T varName(CoreOp.VarOp varOp) {\n-        identifier(varOp.varName());\n-        return self();\n+    public final T funcName(JavaOp.InvokeOp invokeOp){\n+        return identifier(OpTk.funcName(invokeOp));\n@@ -97,1 +84,1 @@\n-    public T varName(HATMemoryOp hatLocalVarOp) {\n+    public final T varName(HATMemoryOp hatLocalVarOp) {\n@@ -102,1 +89,1 @@\n-    public T varName(HATVectorVarOp hatVectorVarOp) {\n+    public final T varName(HATVectorVarOp hatVectorVarOp) {\n@@ -107,1 +94,1 @@\n-    public T varName(HATVectorLoadOp vectorLoadOp) {\n+    public final T varName(HATVectorLoadOp vectorLoadOp) {\n@@ -112,1 +99,1 @@\n-    public T varName(HATVectorStoreView hatVectorStoreView) {\n+    public final T varName(HATVectorStoreView hatVectorStoreView) {\n@@ -117,1 +104,1 @@\n-    public T varName(HATVectorBinaryOp hatVectorBinaryOp) {\n+    public final T varName(HATVectorBinaryOp hatVectorBinaryOp) {\n@@ -122,1 +109,1 @@\n-    public T varName(HATVectorVarLoadOp hatVectorVarLoadOp) {\n+    public final T varName(HATVectorVarLoadOp hatVectorVarLoadOp) {\n@@ -127,1 +114,1 @@\n-    public T varName(HATF16VarOp hatF16VarOp) {\n+    public final T varName(HATF16VarOp hatF16VarOp) {\n@@ -132,1 +119,1 @@\n-    protected T camel(String value) {\n+    protected final T camel(String value) {\n@@ -136,1 +123,1 @@\n-    public T camelJoin(String prefix, String suffix) {\n+    public final T camelJoin(String prefix, String suffix) {\n@@ -140,26 +127,0 @@\n-    \/\/Unused?\n-  \/*  public T declareVarFromJavaType(JavaType type, String varName) {\n-        if (type.equals(JavaType.INT)) {\n-            intDeclaration(varName);\n-        } else if (type.equals(JavaType.LONG)) {\n-            longDeclaration(varName);\n-        } else  if (type.equals(JavaType.FLOAT)) {\n-            floatDeclaration(varName);\n-        } else if (type.equals(JavaType.DOUBLE)) {\n-            doubleDeclaration(varName);\n-        }\n-        return self();\n-    } *\/\n-    public T funcName(CoreOp.FuncCallOp funcCallOp){\n-        return identifier(funcCallOp.funcName());\n-    }\n-    public T funcName(CoreOp.FuncOp funcOp) {\n-        return identifier(funcOp.funcName());\n-    }\n-    public T fieldName(JavaOp.FieldAccessOp fieldAccessOp) {\n-        return identifier(OpTk.fieldName(fieldAccessOp));\n-    }\n-    public T funcName(JavaOp.InvokeOp invokeOp){\n-        return identifier(OpTk.funcName(invokeOp));\n-    }\n-\n","filename":"hat\/core\/src\/main\/java\/hat\/codebuilders\/HATCodeBuilder.java","additions":23,"deletions":62,"binary":false,"changes":85,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import java.util.function.Function;\n@@ -29,0 +30,1 @@\n+import java.util.function.Supplier;\n@@ -32,1 +34,1 @@\n-public record Regex(Pattern pattern) {\n+public record Regex(Function<Match,Match> factory,Pattern pattern) {\n@@ -76,1 +78,4 @@\n-        return new Regex(Pattern.compile(String.join(\"\", strings)));\n+        return of(m->m, strings);\n+    }\n+    public static Regex of(Function<Match,Match> factory, String... strings) {\n+        return new Regex(factory,Pattern.compile(String.join(\"\", strings)));\n@@ -78,1 +83,0 @@\n-\n@@ -94,0 +98,1 @@\n+\n","filename":"hat\/core\/src\/main\/java\/hat\/util\/Regex.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"}]}