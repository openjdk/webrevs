{"files":[{"patch":"@@ -75,0 +75,26 @@\n+    \/**\n+     * Returns this value as an operation result.\n+     *\n+     * @return the value as an operation result.\n+     * @throws IllegalStateException if the value is not an instance of an operation result.\n+     *\/\n+    public Op.Result result() {\n+        if (this instanceof Op.Result r) {\n+            return r;\n+        }\n+        throw new IllegalStateException(\"Value is not an instance of operation result\");\n+    }\n+\n+    \/**\n+     * Returns this value as a block parameter.\n+     *\n+     * @return the value as a block parameter.\n+     * @throws IllegalStateException if the value is not an instance of a block parameter.\n+     *\/\n+    public Block.Parameter parameter() {\n+        if (this instanceof Block.Parameter p) {\n+            return p;\n+        }\n+        throw new IllegalStateException(\"Value is not an instance of block parameter\");\n+    }\n+\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/Value.java","additions":26,"deletions":0,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -0,0 +1,85 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @modules jdk.incubator.code\n+ * @run junit TestValueCast\n+ * @run junit\/othervm -Dbabylon.ssa=cytron TestValueCast\n+ *\/\n+\n+import jdk.incubator.code.*;\n+import jdk.incubator.code.dialect.java.JavaOp;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.function.IntBinaryOperator;\n+import java.util.stream.Stream;\n+\n+public class TestValueCast {\n+\n+    public JavaOp.LambdaOp f() {\n+        IntBinaryOperator ibo = (@Reflect IntBinaryOperator) (a, b) -> {\n+            if (a > b) {\n+                a *= 2;\n+                return a % b;\n+            }\n+            return a + b;\n+        };\n+        return (JavaOp.LambdaOp) Op.ofQuotable(ibo).get().op();\n+    }\n+\n+    static Stream<Value> values(CodeElement<?, ?> r) {\n+        return r.elements().mapMulti((e, c) -> {\n+            switch (e) {\n+                case Block block -> block.parameters().forEach(c);\n+                case Op op -> c.accept(op.result());\n+                case Body _ -> { }\n+            }\n+        });\n+    }\n+\n+    @Test\n+    public void testCast() {\n+        JavaOp.LambdaOp f = f();\n+        Stream<Value> stream = values(f);\n+        stream.forEach(v -> {\n+            switch (v) {\n+                case Op.Result r -> Assertions.assertEquals(r, v.result());\n+                case Block.Parameter p -> Assertions.assertEquals(p, v.parameter());\n+            }\n+        });\n+    }\n+\n+    @Test\n+    public void testExceptions() {\n+        JavaOp.LambdaOp f = f();\n+        Stream<Value> stream = values(f);\n+        stream.forEach(v -> {\n+            switch (v) {\n+                case Op.Result r -> Assertions.assertThrows(IllegalStateException.class, () -> v.parameter());\n+                case Block.Parameter p -> Assertions.assertThrows(IllegalStateException.class, () -> v.result());\n+            }\n+        });\n+    }\n+}\n","filename":"test\/jdk\/java\/lang\/reflect\/code\/TestValueCast.java","additions":85,"deletions":0,"binary":false,"changes":85,"status":"added"}]}