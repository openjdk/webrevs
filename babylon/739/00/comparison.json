{"files":[{"patch":"@@ -160,1 +160,1 @@\n-     * The accelerator will be passed the doSomeWork entrypoint, wrapped in a {@code QuotableComputeContextConsumer}\n+     * The accelerator will be passed the doSomeWork entrypoint, wrapped in a {@code ComputeConsumer}\n@@ -168,1 +168,2 @@\n-    public interface QuotableComputeContextConsumer extends Consumer<ComputeContext> {\n+    @FunctionalInterface\n+    public interface ComputeConsumer extends Consumer<ComputeContext> {\n@@ -170,0 +171,1 @@\n+\n@@ -178,1 +180,1 @@\n-     * The entrypoint is wrapped in a <a href=\"QuotableComputeContextConsumer.html\">QuotableComputeContextConsumer<\/a> lambda.\n+     * The entrypoint is wrapped in a {@link ComputeConsumer} lambda.\n@@ -186,2 +188,2 @@\n-    public void compute(QuotableComputeContextConsumer quotableComputeContextConsumer) {\n-        Quoted quoted = Op.ofQuotable(quotableComputeContextConsumer).orElseThrow();\n+    public void compute(ComputeConsumer compute) {\n+        Quoted quoted = Op.ofQuotable(compute).orElseThrow();\n@@ -189,1 +191,1 @@\n-        Method method = OpTk.methodOrThrow(lookup,OpTk.getQuotableTargetInvokeOpWrapper(lambda));\n+        Method method = OpTk.methodOrThrow(lookup, OpTk.getTargetInvokeOp(lambda));\n@@ -195,2 +197,2 @@\n-        \/\/ Here we get the captured values  from the Quotable\n-        Object[] args = OpTk.getQuotableCapturedValues(lambda,quoted, method);\n+        \/\/ Here we get the captured values from the lambda\n+        Object[] args = OpTk.getQuotedCapturedValues(lambda, quoted, method);\n","filename":"hat\/core\/src\/main\/java\/hat\/Accelerator.java","additions":10,"deletions":8,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -110,2 +110,2 @@\n-    public void dispatchKernel(NDRange<?,?> ndRange, QuotableKernelContextConsumer quotableKernelContextConsumer) {\n-        dispatchKernelWithComputeRange(ndRange, quotableKernelContextConsumer);\n+    public void dispatchKernel(NDRange<?, ?> ndRange, KernelConsumer kernel) {\n+        dispatchKernelWithComputeRange(ndRange, kernel);\n@@ -116,2 +116,2 @@\n-    private CallGraph getKernelCallGraph(QuotableKernelContextConsumer quotableKernelContextConsumer) {\n-        Quoted quoted = Op.ofQuotable(quotableKernelContextConsumer).orElseThrow();\n+    private CallGraph getKernelCallGraph(KernelConsumer kernel) {\n+        Quoted quoted = Op.ofQuotable(kernel).orElseThrow();\n@@ -119,1 +119,1 @@\n-        MethodRef methodRef = OpTk.getQuotableTargetInvokeOpWrapper( lambdaOp).invokeDescriptor();\n+        MethodRef methodRef = OpTk.getTargetInvokeOp( lambdaOp).invokeDescriptor();\n@@ -127,2 +127,2 @@\n-    private void dispatchKernelWithComputeRange(NDRange<?,?> ndRange, QuotableKernelContextConsumer quotableKernelContextConsumer) {\n-        CallGraph cg = getKernelCallGraph(quotableKernelContextConsumer);\n+    private void dispatchKernelWithComputeRange(NDRange<?, ?> ndRange, KernelConsumer kernel) {\n+        CallGraph cg = getKernelCallGraph(kernel);\n@@ -130,1 +130,1 @@\n-            Object[] args = OpTk.getQuotableCapturedValues(cg.lambdaOp,cg.quoted, cg.kernelCallGraph.entrypoint.method);\n+            Object[] args = OpTk.getQuotedCapturedValues(cg.lambdaOp,cg.quoted, cg.kernelCallGraph.entrypoint.method);\n@@ -177,1 +177,2 @@\n-    public interface QuotableKernelContextConsumer extends Consumer<KernelContext> { }\n+    @FunctionalInterface\n+    public interface KernelConsumer extends Consumer<KernelContext> { }\n","filename":"hat\/core\/src\/main\/java\/hat\/ComputeContext.java","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -193,1 +193,1 @@\n-    public static JavaOp.InvokeOp getQuotableTargetInvokeOpWrapper(JavaOp.LambdaOp lambdaOp) {\n+    public static JavaOp.InvokeOp getTargetInvokeOp(JavaOp.LambdaOp lambdaOp) {\n@@ -200,1 +200,1 @@\n-    public static Object[] getQuotableCapturedValues(JavaOp.LambdaOp lambdaOp, Quoted quoted, Method method) {\n+    public static Object[] getQuotedCapturedValues(JavaOp.LambdaOp lambdaOp, Quoted quoted, Method method) {\n","filename":"hat\/core\/src\/main\/java\/hat\/optools\/OpTk.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -66,2 +66,2 @@\n-                cc -> SquaresTest.square(cc, arr)  \/\/QuotableComputeContextConsumer\n-        );                                     \/\/   extends Quotable, Consumer<ComputeContext>\n+                cc -> SquaresTest.square(cc, arr)\n+        );\n","filename":"hat\/core\/src\/main\/test\/hat\/SquaresTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -200,1 +200,1 @@\n-In reality. The Accelerator receives a `QuotableComputeContextConsumer`\n+In reality. The Accelerator receives a `ComputeConsumer`\n@@ -203,2 +203,1 @@\n-   public interface QuotableComputeContextConsumer\n-        extends Quotable,\n+    public interface ComputeConsumer\n@@ -211,19 +210,14 @@\n- public void  compute(QuotableComputeContextConsumer qccc) {\n-   Quoted quoted = Op.ofQuotable(qccc).orElseThrow();\n-   LambdaOpWrapper lambda = OpTools.wrap((CoreOps.LambdaOp)quoted.op());\n-\n-   Method method = lambda.getQuotableComputeContextTargetMethod();\n-\n-   \/\/ Get from the cache or create a compute context which closes over compute entryppint\n-   \/\/ and reachable kernels.\n-   \/\/ The models of all compute and kernel methods are passed to the backend during creation\n-   \/\/ The backend may well mutate the models.\n-   \/\/ It will also use this opportunity to generate ISA specific code for the kernels.\n-\n-   ComputeContext = this.cache.computeIfAbsent(method, (_) ->\n-           new ComputeContext(this\/*Accelerator*\/, method)\n-   );\n-\n-   \/\/ Here we get the captured args from the Quotable and 'jam' in the CLWrapComputeContext in slot[0]\n-   Object[] args = lambda.getQuotableComputeContextArgs(quoted, method, CLWrapComputeContext);\n-   this.compute(CLWrapComputeContext, args);\n+public void compute(ComputeConsumer compute) {\n+    Quoted quoted = Op.ofQuotable(compute).orElseThrow();\n+    JavaOp.LambdaOp lambda = (JavaOp.LambdaOp) quoted.op();\n+    Method method = OpTk.methodOrThrow(lookup,OpTk.getQuotableTargetInvokeOpWrapper(lambda));\n+    \/\/ Create (or get cached) a compute context which closes over compute entryppint and reachable kernels.\n+    \/\/ The models of all compute and kernel methods are passed to the backend during creation\n+    \/\/ The backend may well mutate the models.\n+    \/\/ It will also use this opportunity to generate ISA specific code for the kernels.\n+    ComputeContext computeContext = cache.computeIfAbsent(method, (_) -> new ComputeContext(this, method));\n+    \/\/ Here we get the captured values from the lambda\n+    Object[] args = OpTk.getQuotableCapturedValues(lambda, quoted, method);\n+    args[0] = computeContext;\n+    \/\/ now ask the backend to execute\n+    backend.dispatchCompute(computeContext, args);\n","filename":"hat\/docs\/hat-05-accelerator-compute.md","additions":16,"deletions":22,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -129,1 +129,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+        accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/blackscholes\/src\/main\/java\/blackscholes\/Main.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -95,2 +95,2 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n-                cc -> Compute.compute(cc, a)\n+        accelerator.compute((@Reflect ComputeConsumer)\n+                cc -> ForTests.Compute.compute(cc, a)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/ForTests.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -100,1 +100,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer) computeContext -> {\n+        accelerator.compute((@Reflect ComputeConsumer) computeContext -> {\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/LocalArray.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -84,1 +84,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+        accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/LocalIds.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -164,2 +164,2 @@\n-            accelerator.compute((@Reflect QuotableComputeContextConsumer)\n-                    cc -> Compute.buildMesh(cc, meshData));\n+            accelerator.compute((@Reflect ComputeConsumer)\n+                    cc -> Mesh.Compute.buildMesh(cc, meshData));\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/Mesh.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -65,2 +65,2 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n-                cc -> Compute.add(cc, s32Array, len, valueToAdd));\n+        accelerator.compute((@Reflect ComputeConsumer)\n+                cc -> MinBufferTest.Compute.add(cc, s32Array, len, valueToAdd));\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/MinBufferTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -383,1 +383,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+        accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/PrefixSum.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -59,1 +59,1 @@\n-            accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+            accelerator.compute((@Reflect ComputeConsumer)\n@@ -63,1 +63,1 @@\n-                accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+                accelerator.compute((@Reflect ComputeConsumer)\n@@ -66,1 +66,1 @@\n-                accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+                accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/QuotedArrayArg.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -56,1 +56,1 @@\n-            accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+            accelerator.compute((@Reflect ComputeConsumer)\n@@ -59,1 +59,1 @@\n-            accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+            accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/QuotedConstantArgs.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -156,1 +156,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+        accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/Reduction.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -124,1 +124,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+        accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/spirv\/GetBackend.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -136,1 +136,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+        accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/experiments\/src\/main\/java\/experiments\/spirv\/MatrixMultiply.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -49,1 +49,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -324,2 +324,2 @@\n-            accelerator.compute((@Reflect QuotableComputeContextConsumer)\n-                    cc -> Compute.bestFitCompute(cc, bestMatchOffset, s32Array2D, searchArea, selectionBox, xyrgbList\n+            accelerator.compute((@Reflect ComputeConsumer)\n+                    cc -> heal.Compute.bestFitCompute(cc, bestMatchOffset, s32Array2D, searchArea, selectionBox, xyrgbList\n","filename":"hat\/examples\/heal\/src\/main\/java\/heal\/Compute.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -203,1 +203,1 @@\n-                Compute.lifePerIdx(kc.gix, control, cellGrid);\n+                Main.Compute.lifePerIdx(kc.gix, control, cellGrid);\n@@ -216,1 +216,1 @@\n-                cc.dispatchKernel(NDRange.of1D(range), kc -> Compute.life(kc, ctrl, grid));\n+                cc.dispatchKernel(NDRange.of1D(range), kc -> Main.Compute.life(kc, ctrl, grid));\n@@ -259,2 +259,2 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n-                cc -> Compute.compute(cc, viewer, control, cellGrid));\n+        accelerator.compute((@Reflect ComputeConsumer)\n+                cc -> Main.Compute.compute(cc, viewer, control, cellGrid));\n","filename":"hat\/examples\/life\/src\/main\/java\/life\/Main.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -102,1 +102,1 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+        accelerator.compute((@Reflect ComputeConsumer)\n@@ -133,1 +133,1 @@\n-                        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+                        accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/mandel\/src\/main\/java\/mandel\/Main.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -900,1 +900,1 @@\n-                case _1D -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _1D -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n@@ -902,1 +902,1 @@\n-                case _1DFC -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _1DFC -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n@@ -904,1 +904,1 @@\n-                case _2D -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _2D -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n@@ -906,1 +906,1 @@\n-                case _2DLI -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _2DLI -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n@@ -908,1 +908,1 @@\n-                case _2DTILING -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _2DTILING -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n@@ -910,1 +910,1 @@\n-                case _2DREGISTER_TILING -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _2DREGISTER_TILING -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n@@ -912,1 +912,1 @@\n-                case _2DREGISTER_TILING_VECTORIZED -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _2DREGISTER_TILING_VECTORIZED -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n@@ -914,1 +914,1 @@\n-                case _2DREGISTER_TILING_FP16 -> accelerator.compute((@Reflect QuotableComputeContextConsumer) cc ->\n+                case _2DREGISTER_TILING_FP16 -> accelerator.compute((@Reflect ComputeConsumer) cc ->\n","filename":"hat\/examples\/matmul\/src\/main\/java\/matmul\/Main.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -372,1 +372,1 @@\n-            accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+            accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/nbody\/src\/main\/java\/nbody\/opencl\/OpenCLNBodyGLWindow.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n+import hat.Accelerator.ComputeConsumer;\n@@ -66,3 +66,3 @@\n-        accelerator.compute((@Reflect QuotableComputeContextConsumer)\n-                cc -> Main.square(cc, arr)  \/\/QuotableComputeContextConsumer\n-        );                                     \/\/   extends Quotable, Consumer<ComputeContext>\n+        accelerator.compute((@Reflect ComputeConsumer)\n+                cc -> Main.square(cc, arr)\n+        );\n","filename":"hat\/examples\/squares\/src\/main\/java\/squares\/Main.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -28,2 +28,1 @@\n-import hat.Accelerator.QuotableComputeContextConsumer;\n-import hat.Config;\n+import hat.Accelerator.ComputeConsumer;\n@@ -73,1 +72,1 @@\n-            accelerator.compute((@Reflect QuotableComputeContextConsumer)\n+            accelerator.compute((@Reflect ComputeConsumer)\n","filename":"hat\/examples\/violajones\/src\/main\/java\/violajones\/Main.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -75,2 +75,2 @@\n-                cc -> square(cc, arr)  \/\/QuotableComputeContextConsumer\n-        );                                     \/\/   extends Quotable, Consumer<ComputeContext>\n+                cc -> square(cc, arr)\n+        );\n@@ -108,2 +108,2 @@\n-                cc -> squareNoVarOp(cc, arr)  \/\/QuotableComputeContextConsumer\n-        );                                     \/\/   extends Quotable, Consumer<ComputeContext>\n+                cc -> squareNoVarOp(cc, arr)\n+        );\n@@ -142,2 +142,2 @@\n-                cc -> square2D(cc, arr)  \/\/QuotableComputeContextConsumer\n-        );                                     \/\/   extends Quotable, Consumer<ComputeContext>\n+                cc -> square2D(cc, arr)\n+        );\n@@ -646,2 +646,2 @@\n-                cc -> privateAndLocal(cc, arr)  \/\/QuotableComputeContextConsumer\n-        );                                     \/\/   extends Quotable, Consumer<ComputeContext>\n+                cc -> privateAndLocal(cc, arr)\n+        );\n","filename":"hat\/tests\/src\/main\/java\/hat\/test\/TestArrayView.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"}]}