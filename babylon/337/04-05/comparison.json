{"files":[{"patch":"@@ -80,2 +80,0 @@\n-    private Arena arena;\n-\n@@ -333,1 +331,1 @@\n-    private Tensor<Float> floatTensor(String resource, long... shape) throws IOException {\n+    private Tensor<Float> floatTensor(Arena arena, String resource, long... shape) throws IOException {\n@@ -341,1 +339,1 @@\n-        try (var _ = this.arena = Arena.ofConfined()) {\n+        try (var arena = Arena.ofConfined()) {\n@@ -355,14 +353,17 @@\n-        try (var _ = this.arena = Arena.ofConfined()) {\n-            var conv1Weight = floatTensor(\"mnist\/conv1-weight-float-le\", 6, 1, 5, 5);\n-            var conv1Bias = floatTensor(\"mnist\/conv1-bias-float-le\", 6);\n-            var conv2Weight = floatTensor(\"mnist\/conv2-weight-float-le\", 16, 6, 5, 5);\n-            var conv2Bias = floatTensor(\"mnist\/conv2-bias-float-le\", 16);\n-            var fc1Weight = floatTensor(\"mnist\/fc1-weight-float-le\", 120, 256);\n-            var fc1Bias = floatTensor(\"mnist\/fc1-bias-float-le\", 120);\n-            var fc2Weight = floatTensor(\"mnist\/fc2-weight-float-le\", 84, 120);\n-            var fc2Bias = floatTensor(\"mnist\/fc2-bias-float-le\", 84);\n-            var fc3Weight = floatTensor(\"mnist\/fc3-weight-float-le\", 10, 84);\n-            var fc3Bias = floatTensor(\"mnist\/fc3-bias-float-le\", 10);\n-            test(inputImage -> cnn(conv1Weight, conv1Bias, conv2Weight, conv2Bias,\n-                                   fc1Weight, fc1Bias, fc2Weight, fc2Bias, fc3Weight, fc3Bias,\n-                                   inputImage));\n+        try (var arena = Arena.ofConfined()) {\n+            var conv1Weight = floatTensor(arena, \"mnist\/conv1-weight-float-le\", 6, 1, 5, 5);\n+            var conv1Bias = floatTensor(arena, \"mnist\/conv1-bias-float-le\", 6);\n+            var conv2Weight = floatTensor(arena, \"mnist\/conv2-weight-float-le\", 16, 6, 5, 5);\n+            var conv2Bias = floatTensor(arena, \"mnist\/conv2-bias-float-le\", 16);\n+            var fc1Weight = floatTensor(arena, \"mnist\/fc1-weight-float-le\", 120, 256);\n+            var fc1Bias = floatTensor(arena, \"mnist\/fc1-bias-float-le\", 120);\n+            var fc2Weight = floatTensor(arena, \"mnist\/fc2-weight-float-le\", 84, 120);\n+            var fc2Bias = floatTensor(arena, \"mnist\/fc2-bias-float-le\", 84);\n+            var fc3Weight = floatTensor(arena, \"mnist\/fc3-weight-float-le\", 10, 84);\n+            var fc3Bias = floatTensor(arena, \"mnist\/fc3-bias-float-le\", 10);\n+            test(arena, inputImage -> cnn(conv1Weight, conv1Bias,\n+                                          conv2Weight, conv2Bias,\n+                                          fc1Weight, fc1Bias,\n+                                          fc2Weight, fc2Bias,\n+                                          fc3Weight, fc3Bias,\n+                                          inputImage));\n@@ -374,12 +375,12 @@\n-        try (var _ = this.arena = Arena.ofConfined()) {\n-            var conv1Weight = floatTensor(\"mnist\/conv1-weight-float-le\", 6, 1, 5, 5);\n-            var conv1Bias = floatTensor(\"mnist\/conv1-bias-float-le\", 6);\n-            var conv2Weight = floatTensor(\"mnist\/conv2-weight-float-le\", 16, 6, 5, 5);\n-            var conv2Bias = floatTensor(\"mnist\/conv2-bias-float-le\", 16);\n-            var fc1Weight = floatTensor(\"mnist\/fc1-weight-float-le\", 120, 256);\n-            var fc1Bias = floatTensor(\"mnist\/fc1-bias-float-le\", 120);\n-            var fc2Weight = floatTensor(\"mnist\/fc2-weight-float-le\", 84, 120);\n-            var fc2Bias = floatTensor(\"mnist\/fc2-bias-float-le\", 84);\n-            var fc3Weight = floatTensor(\"mnist\/fc3-weight-float-le\", 10, 84);\n-            var fc3Bias = floatTensor(\"mnist\/fc3-bias-float-le\", 10);\n-            test(inputImage -> OnnxRuntime.execute(MethodHandles.lookup(), () ->\n+        try (var arena = Arena.ofConfined()) {\n+            var conv1Weight = floatTensor(arena, \"mnist\/conv1-weight-float-le\", 6, 1, 5, 5);\n+            var conv1Bias = floatTensor(arena, \"mnist\/conv1-bias-float-le\", 6);\n+            var conv2Weight = floatTensor(arena, \"mnist\/conv2-weight-float-le\", 16, 6, 5, 5);\n+            var conv2Bias = floatTensor(arena, \"mnist\/conv2-bias-float-le\", 16);\n+            var fc1Weight = floatTensor(arena, \"mnist\/fc1-weight-float-le\", 120, 256);\n+            var fc1Bias = floatTensor(arena, \"mnist\/fc1-bias-float-le\", 120);\n+            var fc2Weight = floatTensor(arena, \"mnist\/fc2-weight-float-le\", 84, 120);\n+            var fc2Bias = floatTensor(arena, \"mnist\/fc2-bias-float-le\", 84);\n+            var fc3Weight = floatTensor(arena, \"mnist\/fc3-weight-float-le\", 10, 84);\n+            var fc3Bias = floatTensor(arena, \"mnist\/fc3-bias-float-le\", 10);\n+            test(arena, inputImage -> OnnxRuntime.execute(arena, MethodHandles.lookup(), () ->\n@@ -392,1 +393,1 @@\n-    private void test(Function<Tensor<Byte>, Tensor<Float>> executor) throws Exception {\n+    private void test(Arena arena, Function<Tensor<Byte>, Tensor<Float>> executor) throws Exception {\n","filename":"cr-examples\/onnx\/src\/test\/java\/oracle\/code\/onnx\/CNNTest.java","additions":32,"deletions":31,"binary":false,"changes":63,"status":"modified"}]}