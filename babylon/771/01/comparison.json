{"files":[{"patch":"@@ -1339,6 +1339,13 @@\n-            for (JCVariableDecl jcVar : variables) {\n-                \/\/ @@@ use uninitialized variable\n-                Value defaultValue = variablesStack.block.op(defaultValue(jcVar.type));\n-                Value init = convert(defaultValue, jcVar.type);\n-                Op.Result op = variablesStack.block.op(CoreOp.var(jcVar.name.toString(), typeToTypeElement(jcVar.type), init));\n-                variablesStack.localToOp.put(jcVar.sym, op);\n+            BodyStack previous = stack;\n+            \/\/ Temporarily position the stack to where the pattern variables are to be declared\n+            stack = variablesStack;\n+            try {\n+                for (JCVariableDecl jcVar : variables) {\n+                    \/\/ @@@ use uninitialized variable\n+                    Value defaultValue = append(defaultValue(jcVar.type));\n+                    Value init = convert(defaultValue, jcVar.type);\n+                    Op.Result op = append(CoreOp.var(jcVar.name.toString(), typeToTypeElement(jcVar.type), init));\n+                    stack.localToOp.put(jcVar.sym, op);\n+                }\n+            } finally {\n+                stack = previous;\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/internal\/ReflectMethods.java","additions":13,"deletions":6,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -447,0 +447,35 @@\n+\n+    @IR(\"\"\"\n+            func @\"m\" (%0 : java.type:\"int\")java.type:\"void\" -> {\n+                  %1 : Var<java.type:\"int\"> = var %0 @\"i\";\n+                  %2 : java.type:\"int\" = constant @0;\n+                  %3 : java.type:\"byte\" = conv %2;\n+                  %4 : Var<java.type:\"byte\"> = var %3 @\"b\";\n+                  java.if\n+                      ()java.type:\"boolean\" -> {\n+                          %5 : java.type:\"int\" = var.load %1;\n+                          %6 : java.type:\"boolean\" = pattern.match %5\n+                              ()java.type:\"jdk.incubator.code.dialect.java.JavaOp$Pattern$Type<byte>\" -> {\n+                                  %7 : java.type:\"jdk.incubator.code.dialect.java.JavaOp$Pattern$Type<byte>\" = pattern.type @\"b\";\n+                                  yield %7;\n+                              }\n+                              (%8 : java.type:\"byte\")java.type:\"void\" -> {\n+                                  var.store %4 %8;\n+                                  yield;\n+                              };\n+                          yield %6;\n+                      }\n+                      ()java.type:\"void\" -> {\n+                          yield;\n+                      }\n+                      ()java.type:\"void\" -> {\n+                          yield;\n+                      };\n+                  return;\n+              };\n+            \"\"\")\n+    @Reflect\n+    static void m(int i) {\n+        if (i instanceof byte b) {\n+        }\n+    }\n","filename":"test\/langtools\/tools\/javac\/reflect\/PatternsTest.java","additions":35,"deletions":0,"binary":false,"changes":35,"status":"modified"}]}