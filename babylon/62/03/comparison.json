{"files":[{"patch":"@@ -37,1 +37,1 @@\n-    static abstract class ArithMathOp extends OpWithDefinition {\n+    static abstract class ArithMathOp extends ExternalizableOp {\n@@ -40,1 +40,1 @@\n-        public ArithMathOp(OpDefinition def) {\n+        public ArithMathOp(ExternalizedOp def) {\n@@ -64,1 +64,1 @@\n-    @OpDeclaration(ConstantOp.NAME)\n+    @OpFactory.OpDeclaration(ConstantOp.NAME)\n@@ -71,1 +71,1 @@\n-        public static ConstantOp create(OpDefinition def) {\n+        public static ConstantOp create(ExternalizedOp def) {\n@@ -137,1 +137,1 @@\n-        ConstantOp(OpDefinition def, Object value) {\n+        ConstantOp(ExternalizedOp def, Object value) {\n@@ -172,1 +172,1 @@\n-    @OpDeclaration(AddOp.NAME)\n+    @OpFactory.OpDeclaration(AddOp.NAME)\n@@ -176,1 +176,1 @@\n-        public AddOp(OpDefinition def) {\n+        public AddOp(ExternalizedOp def) {\n@@ -194,1 +194,1 @@\n-    @OpDeclaration(SubOp.NAME)\n+    @OpFactory.OpDeclaration(SubOp.NAME)\n@@ -198,1 +198,1 @@\n-        public SubOp(OpDefinition def) {\n+        public SubOp(ExternalizedOp def) {\n@@ -216,1 +216,1 @@\n-    @OpDeclaration(MulOp.NAME)\n+    @OpFactory.OpDeclaration(MulOp.NAME)\n@@ -220,1 +220,1 @@\n-        public MulOp(OpDefinition def) {\n+        public MulOp(ExternalizedOp def) {\n@@ -238,1 +238,1 @@\n-    @OpDeclaration(DivOp.NAME)\n+    @OpFactory.OpDeclaration(DivOp.NAME)\n@@ -242,1 +242,1 @@\n-        public DivOp(OpDefinition def) {\n+        public DivOp(ExternalizedOp def) {\n@@ -260,1 +260,1 @@\n-    @OpDeclaration(RemOp.NAME)\n+    @OpFactory.OpDeclaration(RemOp.NAME)\n@@ -264,1 +264,1 @@\n-        public RemOp(OpDefinition def) {\n+        public RemOp(ExternalizedOp def) {\n@@ -282,1 +282,1 @@\n-    @OpDeclaration(AndOp.NAME)\n+    @OpFactory.OpDeclaration(AndOp.NAME)\n@@ -286,1 +286,1 @@\n-        public AndOp(OpDefinition def) {\n+        public AndOp(ExternalizedOp def) {\n@@ -304,1 +304,1 @@\n-    @OpDeclaration(MaxOp.NAME)\n+    @OpFactory.OpDeclaration(MaxOp.NAME)\n@@ -308,1 +308,1 @@\n-        public MaxOp(OpDefinition def) {\n+        public MaxOp(ExternalizedOp def) {\n@@ -327,1 +327,1 @@\n-    @OpDeclaration(MinOp.NAME)\n+    @OpFactory.OpDeclaration(MinOp.NAME)\n@@ -331,1 +331,1 @@\n-        public MinOp(OpDefinition def) {\n+        public MinOp(ExternalizedOp def) {\n@@ -350,1 +350,1 @@\n-    @OpDeclaration(ExpOp.NAME)\n+    @OpFactory.OpDeclaration(ExpOp.NAME)\n@@ -354,1 +354,1 @@\n-        public TruncOp(OpDefinition def) {\n+        public TruncOp(ExternalizedOp def) {\n@@ -373,1 +373,1 @@\n-    @OpDeclaration(ExpOp.NAME)\n+    @OpFactory.OpDeclaration(ExpOp.NAME)\n@@ -377,1 +377,1 @@\n-        public ExpOp(OpDefinition def) {\n+        public ExpOp(ExternalizedOp def) {\n@@ -395,1 +395,1 @@\n-    @OpDeclaration(CompareOp.NAME)\n+    @OpFactory.OpDeclaration(CompareOp.NAME)\n@@ -406,1 +406,1 @@\n-        public static CompareOp create(OpDefinition def) {\n+        public static CompareOp create(ExternalizedOp def) {\n@@ -416,1 +416,1 @@\n-        CompareOp(OpDefinition def, CompareKind ck) {\n+        CompareOp(ExternalizedOp def, CompareKind ck) {\n","filename":"cr-examples\/triton\/src\/main\/java\/oracle\/code\/triton\/ArithMathOps.java","additions":28,"deletions":28,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -39,2 +39,2 @@\n-    @OpDeclaration(ForOp.NAME)\n-    public static final class ForOp extends OpWithDefinition implements Op.Loop {\n+    @OpFactory.OpDeclaration(ForOp.NAME)\n+    public static final class ForOp extends ExternalizableOp implements Op.Loop {\n@@ -70,1 +70,1 @@\n-        public ForOp(OpDefinition def) {\n+        public ForOp(ExternalizedOp def) {\n@@ -109,2 +109,2 @@\n-    @OpDeclaration(YieldOp.NAME)\n-    public static class YieldOp extends OpWithDefinition implements Op.Terminating {\n+    @OpFactory.OpDeclaration(YieldOp.NAME)\n+    public static class YieldOp extends ExternalizableOp implements Op.Terminating {\n@@ -113,1 +113,1 @@\n-        public YieldOp(OpDefinition def) {\n+        public YieldOp(ExternalizedOp def) {\n","filename":"cr-examples\/triton\/src\/main\/java\/oracle\/code\/triton\/SCFOps.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -36,1 +36,1 @@\n-    static abstract class TritonOp extends OpWithDefinition {\n+    static abstract class TritonOp extends ExternalizableOp {\n@@ -39,1 +39,1 @@\n-        public TritonOp(OpDefinition def) {\n+        public TritonOp(ExternalizedOp def) {\n@@ -63,1 +63,1 @@\n-    @OpDeclaration(ModuleOp.NAME)\n+    @OpFactory.OpDeclaration(ModuleOp.NAME)\n@@ -70,1 +70,1 @@\n-        public ModuleOp(OpDefinition def) {\n+        public ModuleOp(ExternalizedOp def) {\n@@ -133,1 +133,1 @@\n-    @OpDeclaration(FuncOp.NAME)\n+    @OpFactory.OpDeclaration(FuncOp.NAME)\n@@ -160,1 +160,1 @@\n-        public static FuncOp create(OpDefinition def) {\n+        public static FuncOp create(ExternalizedOp def) {\n@@ -173,1 +173,1 @@\n-        FuncOp(OpDefinition def, String funcName) {\n+        FuncOp(ExternalizedOp def, String funcName) {\n@@ -247,1 +247,1 @@\n-    @OpDeclaration(CallOp.NAME)\n+    @OpFactory.OpDeclaration(CallOp.NAME)\n@@ -254,1 +254,1 @@\n-        public static CallOp create(OpDefinition def) {\n+        public static CallOp create(ExternalizedOp def) {\n@@ -264,1 +264,1 @@\n-        CallOp(OpDefinition def, String funcName) {\n+        CallOp(ExternalizedOp def, String funcName) {\n@@ -299,1 +299,1 @@\n-    @OpDeclaration(ReduceOp.NAME)\n+    @OpFactory.OpDeclaration(ReduceOp.NAME)\n@@ -330,1 +330,1 @@\n-        public static ReduceOp create(OpDefinition def) {\n+        public static ReduceOp create(ExternalizedOp def) {\n@@ -340,1 +340,1 @@\n-        ReduceOp(OpDefinition def, int axis) {\n+        ReduceOp(ExternalizedOp def, int axis) {\n@@ -387,1 +387,1 @@\n-    @OpDeclaration(ReduceReturnOp.NAME)\n+    @OpFactory.OpDeclaration(ReduceReturnOp.NAME)\n@@ -391,1 +391,1 @@\n-        public ReduceReturnOp(OpDefinition def) {\n+        public ReduceReturnOp(ExternalizedOp def) {\n@@ -409,1 +409,1 @@\n-    @OpDeclaration(GetProgramIdOp.NAME)\n+    @OpFactory.OpDeclaration(GetProgramIdOp.NAME)\n@@ -416,1 +416,1 @@\n-        public static GetProgramIdOp create(OpDefinition def) {\n+        public static GetProgramIdOp create(ExternalizedOp def) {\n@@ -426,1 +426,1 @@\n-        GetProgramIdOp(OpDefinition def, int axis) {\n+        GetProgramIdOp(ExternalizedOp def, int axis) {\n@@ -461,1 +461,1 @@\n-    @OpDeclaration(MakeRangeOp.NAME)\n+    @OpFactory.OpDeclaration(MakeRangeOp.NAME)\n@@ -470,1 +470,1 @@\n-        public static MakeRangeOp create(OpDefinition def) {\n+        public static MakeRangeOp create(ExternalizedOp def) {\n@@ -486,1 +486,1 @@\n-        MakeRangeOp(OpDefinition def, int start, int end) {\n+        MakeRangeOp(ExternalizedOp def, int start, int end) {\n@@ -525,1 +525,1 @@\n-    @OpDeclaration(ExpandOp.NAME)\n+    @OpFactory.OpDeclaration(ExpandOp.NAME)\n@@ -532,1 +532,1 @@\n-        public static ExpandOp create(OpDefinition def) {\n+        public static ExpandOp create(ExternalizedOp def) {\n@@ -542,1 +542,1 @@\n-        ExpandOp(OpDefinition def, int axis) {\n+        ExpandOp(ExternalizedOp def, int axis) {\n@@ -577,1 +577,1 @@\n-    @OpDeclaration(SplatOp.NAME)\n+    @OpFactory.OpDeclaration(SplatOp.NAME)\n@@ -581,1 +581,1 @@\n-        public SplatOp(OpDefinition def) {\n+        public SplatOp(ExternalizedOp def) {\n@@ -599,1 +599,1 @@\n-    @OpDeclaration(BroadcastOp.NAME)\n+    @OpFactory.OpDeclaration(BroadcastOp.NAME)\n@@ -603,1 +603,1 @@\n-        public BroadcastOp(OpDefinition def) {\n+        public BroadcastOp(ExternalizedOp def) {\n@@ -621,1 +621,1 @@\n-    @OpDeclaration(AddPtrOp.NAME)\n+    @OpFactory.OpDeclaration(AddPtrOp.NAME)\n@@ -625,1 +625,1 @@\n-        public AddPtrOp(OpDefinition def) {\n+        public AddPtrOp(ExternalizedOp def) {\n@@ -643,1 +643,1 @@\n-    @OpDeclaration(LoadOp.NAME)\n+    @OpFactory.OpDeclaration(LoadOp.NAME)\n@@ -647,1 +647,1 @@\n-        public LoadOp(OpDefinition def) {\n+        public LoadOp(ExternalizedOp def) {\n@@ -665,1 +665,1 @@\n-    @OpDeclaration(StoreOp.NAME)\n+    @OpFactory.OpDeclaration(StoreOp.NAME)\n@@ -669,1 +669,1 @@\n-        public StoreOp(OpDefinition def) {\n+        public StoreOp(ExternalizedOp def) {\n@@ -687,1 +687,1 @@\n-    @OpDeclaration(ReturnOp.NAME)\n+    @OpFactory.OpDeclaration(ReturnOp.NAME)\n@@ -691,1 +691,1 @@\n-        public ReturnOp(OpDefinition def) {\n+        public ReturnOp(ExternalizedOp def) {\n@@ -713,1 +713,1 @@\n-    @OpDeclaration(DotOp.NAME)\n+    @OpFactory.OpDeclaration(DotOp.NAME)\n@@ -717,1 +717,1 @@\n-        public DotOp(OpDefinition def) {\n+        public DotOp(ExternalizedOp def) {\n","filename":"cr-examples\/triton\/src\/main\/java\/oracle\/code\/triton\/TritonOps.java","additions":38,"deletions":38,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -32,2 +32,0 @@\n-import java.lang.reflect.code.op.OpDeclaration;\n-import java.lang.reflect.code.op.OpDefinition;\n@@ -35,1 +33,1 @@\n-import java.lang.reflect.code.op.OpWithDefinition;\n+import java.lang.reflect.code.op.ExternalizableOp;\n@@ -41,2 +39,2 @@\n-    @OpDeclaration(ConsumeOp.NAME)\n-    public static class ConsumeOp extends OpWithDefinition {\n+    @OpFactory.OpDeclaration(ConsumeOp.NAME)\n+    public static class ConsumeOp extends ExternalizableOp {\n@@ -45,1 +43,1 @@\n-        public ConsumeOp(OpDefinition def) {\n+        public ConsumeOp(ExternalizedOp def) {\n","filename":"cr-examples\/triton\/src\/main\/java\/oracle\/code\/triton\/TritonTestOps.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -364,16 +364,0 @@\n-    \/**\n-     * The attribute value that represents null.\n-     *\/\n-    public static final Object NULL_ATTRIBUTE_VALUE = new Object();\n-\n-    \/**\n-     * Returns the operation's attributes.\n-     *\n-     * <p>A null attribute value is represented by the constant value {@link #NULL_ATTRIBUTE_VALUE}.\n-     *\n-     * @return the operation's attributes, as an unmodifiable map\n-     *\/\n-    public Map<String, Object> attributes() {\n-        return Map.of();\n-    }\n-\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/Op.java","additions":0,"deletions":16,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -249,2 +249,2 @@\n-                        case IFNULL -> CoreOps.neq(operand, op(CoreOps.constant(JavaType.J_L_OBJECT, Op.NULL_ATTRIBUTE_VALUE)));\n-                        case IFNONNULL -> CoreOps.eq(operand, op(CoreOps.constant(JavaType.J_L_OBJECT, Op.NULL_ATTRIBUTE_VALUE)));\n+                        case IFNULL -> CoreOps.neq(operand, op(CoreOps.constant(JavaType.J_L_OBJECT, null)));\n+                        case IFNONNULL -> CoreOps.eq(operand, op(CoreOps.constant(JavaType.J_L_OBJECT, null)));\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/bytecode\/BytecodeLift.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -57,2 +57,2 @@\n-    @OpDeclaration(FuncOp.NAME)\n-    public static final class FuncOp extends OpWithDefinition implements Op.Invokable, Op.Isolated, Op.Lowerable {\n+    @OpFactory.OpDeclaration(FuncOp.NAME)\n+    public static final class FuncOp extends ExternalizableOp implements Op.Invokable, Op.Isolated, Op.Lowerable {\n@@ -84,1 +84,1 @@\n-        public static FuncOp create(OpDefinition def) {\n+        public static FuncOp create(ExternalizedOp def) {\n@@ -97,1 +97,1 @@\n-        FuncOp(OpDefinition def, String funcName) {\n+        FuncOp(ExternalizedOp def, String funcName) {\n@@ -181,2 +181,2 @@\n-    @OpDeclaration(FuncCallOp.NAME)\n-    public static final class FuncCallOp extends OpWithDefinition {\n+    @OpFactory.OpDeclaration(FuncCallOp.NAME)\n+    public static final class FuncCallOp extends ExternalizableOp {\n@@ -189,1 +189,1 @@\n-        public static FuncCallOp create(OpDefinition def) {\n+        public static FuncCallOp create(ExternalizedOp def) {\n@@ -199,1 +199,1 @@\n-        FuncCallOp(OpDefinition def, String funcName) {\n+        FuncCallOp(ExternalizedOp def, String funcName) {\n@@ -246,2 +246,2 @@\n-    @OpDeclaration(ModuleOp.NAME)\n-    public static final class ModuleOp extends OpWithDefinition implements Op.Isolated {\n+    @OpFactory.OpDeclaration(ModuleOp.NAME)\n+    public static final class ModuleOp extends ExternalizableOp implements Op.Isolated {\n@@ -254,1 +254,1 @@\n-        public static ModuleOp create(OpDefinition def) {\n+        public static ModuleOp create(ExternalizedOp def) {\n@@ -262,1 +262,1 @@\n-        ModuleOp(OpDefinition def) {\n+        ModuleOp(ExternalizedOp def) {\n@@ -330,2 +330,2 @@\n-    @OpDeclaration(QuotedOp.NAME)\n-    public static final class QuotedOp extends OpWithDefinition implements Op.Nested, Op.Lowerable, Op.Pure {\n+    @OpFactory.OpDeclaration(QuotedOp.NAME)\n+    public static final class QuotedOp extends ExternalizableOp implements Op.Nested, Op.Lowerable, Op.Pure {\n@@ -343,1 +343,1 @@\n-        public QuotedOp(OpDefinition def) {\n+        public QuotedOp(ExternalizedOp def) {\n@@ -416,2 +416,2 @@\n-    @OpDeclaration(LambdaOp.NAME)\n-    public static final class LambdaOp extends OpWithDefinition implements Op.Invokable, Op.Lowerable {\n+    @OpFactory.OpDeclaration(LambdaOp.NAME)\n+    public static final class LambdaOp extends ExternalizableOp implements Op.Invokable, Op.Lowerable {\n@@ -442,1 +442,1 @@\n-        public LambdaOp(OpDefinition def) {\n+        public LambdaOp(ExternalizedOp def) {\n@@ -650,2 +650,2 @@\n-    @OpDeclaration(ClosureOp.NAME)\n-    public static final class ClosureOp extends OpWithDefinition implements Op.Invokable, Op.Lowerable {\n+    @OpFactory.OpDeclaration(ClosureOp.NAME)\n+    public static final class ClosureOp extends ExternalizableOp implements Op.Invokable, Op.Lowerable {\n@@ -673,1 +673,1 @@\n-        public ClosureOp(OpDefinition def) {\n+        public ClosureOp(ExternalizedOp def) {\n@@ -742,2 +742,2 @@\n-    @OpDeclaration(ClosureCallOp.NAME)\n-    public static final class ClosureCallOp extends OpWithDefinition {\n+    @OpFactory.OpDeclaration(ClosureCallOp.NAME)\n+    public static final class ClosureCallOp extends ExternalizableOp {\n@@ -746,1 +746,1 @@\n-        public ClosureCallOp(OpDefinition def) {\n+        public ClosureCallOp(ExternalizedOp def) {\n@@ -775,2 +775,2 @@\n-    @OpDeclaration(ReturnOp.NAME)\n-    public static final class ReturnOp extends OpWithDefinition implements Op.BodyTerminating {\n+    @OpFactory.OpDeclaration(ReturnOp.NAME)\n+    public static final class ReturnOp extends ExternalizableOp implements Op.BodyTerminating {\n@@ -779,1 +779,1 @@\n-        public ReturnOp(OpDefinition def) {\n+        public ReturnOp(ExternalizedOp def) {\n@@ -822,2 +822,2 @@\n-    @OpDeclaration(ThrowOp.NAME)\n-    public static final class ThrowOp extends OpWithDefinition implements Op.BodyTerminating {\n+    @OpFactory.OpDeclaration(ThrowOp.NAME)\n+    public static final class ThrowOp extends ExternalizableOp implements Op.BodyTerminating {\n@@ -826,1 +826,1 @@\n-        public ThrowOp(OpDefinition def) {\n+        public ThrowOp(ExternalizedOp def) {\n@@ -860,2 +860,2 @@\n-    @OpDeclaration(AssertOp.NAME)\n-    public static final class AssertOp extends OpWithDefinition implements Op.Nested {\n+    @OpFactory.OpDeclaration(AssertOp.NAME)\n+    public static final class AssertOp extends ExternalizableOp implements Op.Nested {\n@@ -865,1 +865,1 @@\n-        public AssertOp(OpDefinition def) {\n+        public AssertOp(ExternalizedOp def) {\n@@ -911,2 +911,2 @@\n-    @OpDeclaration(UnreachableOp.NAME)\n-    public static class UnreachableOp extends OpWithDefinition implements Op.BodyTerminating {\n+    @OpFactory.OpDeclaration(UnreachableOp.NAME)\n+    public static class UnreachableOp extends ExternalizableOp implements Op.BodyTerminating {\n@@ -915,1 +915,1 @@\n-        public UnreachableOp(OpDefinition def) {\n+        public UnreachableOp(ExternalizedOp def) {\n@@ -948,2 +948,2 @@\n-    @OpDeclaration(YieldOp.NAME)\n-    public static class YieldOp extends OpWithDefinition implements Op.BodyTerminating {\n+    @OpFactory.OpDeclaration(YieldOp.NAME)\n+    public static class YieldOp extends ExternalizableOp implements Op.BodyTerminating {\n@@ -952,1 +952,1 @@\n-        public YieldOp(OpDefinition def) {\n+        public YieldOp(ExternalizedOp def) {\n@@ -997,2 +997,2 @@\n-    @OpDeclaration(BranchOp.NAME)\n-    public static class BranchOp extends OpWithDefinition implements Op.BlockTerminating {\n+    @OpFactory.OpDeclaration(BranchOp.NAME)\n+    public static class BranchOp extends ExternalizableOp implements Op.BlockTerminating {\n@@ -1003,1 +1003,1 @@\n-        public BranchOp(OpDefinition def) {\n+        public BranchOp(ExternalizedOp def) {\n@@ -1052,2 +1052,2 @@\n-    @OpDeclaration(ConditionalBranchOp.NAME)\n-    public static class ConditionalBranchOp extends OpWithDefinition implements Op.BlockTerminating {\n+    @OpFactory.OpDeclaration(ConditionalBranchOp.NAME)\n+    public static class ConditionalBranchOp extends ExternalizableOp implements Op.BlockTerminating {\n@@ -1059,1 +1059,1 @@\n-        public ConditionalBranchOp(OpDefinition def) {\n+        public ConditionalBranchOp(ExternalizedOp def) {\n@@ -1115,2 +1115,2 @@\n-    @OpDeclaration(ConstantOp.NAME)\n-    public static class ConstantOp extends OpWithDefinition implements Op.Pure {\n+    @OpFactory.OpDeclaration(ConstantOp.NAME)\n+    public static class ConstantOp extends ExternalizableOp implements Op.Pure {\n@@ -1124,1 +1124,1 @@\n-        public static ConstantOp create(OpDefinition def) {\n+        public static ConstantOp create(ExternalizedOp def) {\n@@ -1195,1 +1195,1 @@\n-        ConstantOp(OpDefinition def, Object value) {\n+        ConstantOp(ExternalizedOp def, Object value) {\n@@ -1250,2 +1250,2 @@\n-    @OpDeclaration(InvokeOp.NAME)\n-    public static final class InvokeOp extends OpWithDefinition implements ReflectiveOp {\n+    @OpFactory.OpDeclaration(InvokeOp.NAME)\n+    public static final class InvokeOp extends ExternalizableOp implements ReflectiveOp {\n@@ -1258,1 +1258,1 @@\n-        public static InvokeOp create(OpDefinition def) {\n+        public static InvokeOp create(ExternalizedOp def) {\n@@ -1269,1 +1269,1 @@\n-        InvokeOp(OpDefinition def, MethodRef invokeDescriptor) {\n+        InvokeOp(ExternalizedOp def, MethodRef invokeDescriptor) {\n@@ -1324,2 +1324,2 @@\n-    @OpDeclaration(ConvOp.NAME)\n-    public static final class ConvOp extends OpWithDefinition implements Op.Pure {\n+    @OpFactory.OpDeclaration(ConvOp.NAME)\n+    public static final class ConvOp extends ExternalizableOp implements Op.Pure {\n@@ -1330,1 +1330,1 @@\n-        public ConvOp(OpDefinition def) {\n+        public ConvOp(ExternalizedOp def) {\n@@ -1362,2 +1362,2 @@\n-    @OpDeclaration(NewOp.NAME)\n-    public static final class NewOp extends OpWithDefinition implements ReflectiveOp {\n+    @OpFactory.OpDeclaration(NewOp.NAME)\n+    public static final class NewOp extends ExternalizableOp implements ReflectiveOp {\n@@ -1370,1 +1370,1 @@\n-        public static NewOp create(OpDefinition def) {\n+        public static NewOp create(ExternalizedOp def) {\n@@ -1387,1 +1387,1 @@\n-        NewOp(OpDefinition def, FunctionType constructorType) {\n+        NewOp(ExternalizedOp def, FunctionType constructorType) {\n@@ -1447,1 +1447,1 @@\n-    public abstract static sealed class FieldAccessOp extends OpWithDefinition implements AccessOp, ReflectiveOp {\n+    public abstract static sealed class FieldAccessOp extends ExternalizableOp implements AccessOp, ReflectiveOp {\n@@ -1452,1 +1452,1 @@\n-        FieldAccessOp(OpDefinition def, FieldRef fieldDescriptor) {\n+        FieldAccessOp(ExternalizedOp def, FieldRef fieldDescriptor) {\n@@ -1486,1 +1486,1 @@\n-        @OpDeclaration(FieldLoadOp.NAME)\n+        @OpFactory.OpDeclaration(FieldLoadOp.NAME)\n@@ -1492,1 +1492,1 @@\n-            public static FieldLoadOp create(OpDefinition def) {\n+            public static FieldLoadOp create(ExternalizedOp def) {\n@@ -1507,1 +1507,1 @@\n-            FieldLoadOp(OpDefinition opdef, FieldRef fieldDescriptor) {\n+            FieldLoadOp(ExternalizedOp opdef, FieldRef fieldDescriptor) {\n@@ -1548,1 +1548,1 @@\n-        @OpDeclaration(FieldStoreOp.NAME)\n+        @OpFactory.OpDeclaration(FieldStoreOp.NAME)\n@@ -1552,1 +1552,1 @@\n-            public static FieldStoreOp create(OpDefinition def) {\n+            public static FieldStoreOp create(ExternalizedOp def) {\n@@ -1567,1 +1567,1 @@\n-            FieldStoreOp(OpDefinition opdef, FieldRef fieldDescriptor) {\n+            FieldStoreOp(ExternalizedOp opdef, FieldRef fieldDescriptor) {\n@@ -1603,2 +1603,2 @@\n-    @OpDeclaration(ArrayLengthOp.NAME)\n-    public static final class ArrayLengthOp extends OpWithDefinition implements ReflectiveOp {\n+    @OpFactory.OpDeclaration(ArrayLengthOp.NAME)\n+    public static final class ArrayLengthOp extends ExternalizableOp implements ReflectiveOp {\n@@ -1607,1 +1607,1 @@\n-        public ArrayLengthOp(OpDefinition def) {\n+        public ArrayLengthOp(ExternalizedOp def) {\n@@ -1633,2 +1633,2 @@\n-    public abstract static sealed class ArrayAccessOp extends OpWithDefinition implements AccessOp, ReflectiveOp {\n-        ArrayAccessOp(OpDefinition def) {\n+    public abstract static sealed class ArrayAccessOp extends ExternalizableOp implements AccessOp, ReflectiveOp {\n+        ArrayAccessOp(ExternalizedOp def) {\n@@ -1681,1 +1681,1 @@\n-        @OpDeclaration(ArrayLoadOp.NAME)\n+        @OpFactory.OpDeclaration(ArrayLoadOp.NAME)\n@@ -1685,1 +1685,1 @@\n-            public ArrayLoadOp(OpDefinition def) {\n+            public ArrayLoadOp(ExternalizedOp def) {\n@@ -1714,1 +1714,1 @@\n-        @OpDeclaration(ArrayStoreOp.NAME)\n+        @OpFactory.OpDeclaration(ArrayStoreOp.NAME)\n@@ -1718,1 +1718,1 @@\n-            public ArrayStoreOp(OpDefinition def) {\n+            public ArrayStoreOp(ExternalizedOp def) {\n@@ -1746,2 +1746,2 @@\n-    @OpDeclaration(InstanceOfOp.NAME)\n-    public static final class InstanceOfOp extends OpWithDefinition implements Op.Pure, ReflectiveOp {\n+    @OpFactory.OpDeclaration(InstanceOfOp.NAME)\n+    public static final class InstanceOfOp extends ExternalizableOp implements Op.Pure, ReflectiveOp {\n@@ -1753,1 +1753,1 @@\n-        public static InstanceOfOp create(OpDefinition def) {\n+        public static InstanceOfOp create(ExternalizedOp def) {\n@@ -1767,1 +1767,1 @@\n-        InstanceOfOp(OpDefinition def, TypeElement typeDescriptor) {\n+        InstanceOfOp(ExternalizedOp def, TypeElement typeDescriptor) {\n@@ -1811,2 +1811,2 @@\n-    @OpDeclaration(CastOp.NAME)\n-    public static final class CastOp extends OpWithDefinition implements Op.Pure, ReflectiveOp {\n+    @OpFactory.OpDeclaration(CastOp.NAME)\n+    public static final class CastOp extends ExternalizableOp implements Op.Pure, ReflectiveOp {\n@@ -1819,1 +1819,1 @@\n-        public static CastOp create(OpDefinition def) {\n+        public static CastOp create(ExternalizedOp def) {\n@@ -1833,1 +1833,1 @@\n-        CastOp(OpDefinition def, TypeElement typeDescriptor) {\n+        CastOp(ExternalizedOp def, TypeElement typeDescriptor) {\n@@ -1906,2 +1906,2 @@\n-    @OpDeclaration(VarOp.NAME)\n-    public static final class VarOp extends OpWithDefinition {\n+    @OpFactory.OpDeclaration(VarOp.NAME)\n+    public static final class VarOp extends ExternalizableOp {\n@@ -1914,1 +1914,1 @@\n-        public static VarOp create(OpDefinition def) {\n+        public static VarOp create(ExternalizedOp def) {\n@@ -1927,1 +1927,1 @@\n-        VarOp(OpDefinition def, String varName) {\n+        VarOp(ExternalizedOp def, String varName) {\n@@ -1986,2 +1986,2 @@\n-    public abstract static sealed class VarAccessOp extends OpWithDefinition implements AccessOp {\n-        VarAccessOp(OpDefinition opdef) {\n+    public abstract static sealed class VarAccessOp extends ExternalizableOp implements AccessOp {\n+        VarAccessOp(ExternalizedOp opdef) {\n@@ -2017,1 +2017,1 @@\n-        @OpDeclaration(VarLoadOp.NAME)\n+        @OpFactory.OpDeclaration(VarLoadOp.NAME)\n@@ -2021,1 +2021,1 @@\n-            public VarLoadOp(OpDefinition opdef) {\n+            public VarLoadOp(ExternalizedOp opdef) {\n@@ -2058,1 +2058,1 @@\n-        @OpDeclaration(VarStoreOp.NAME)\n+        @OpFactory.OpDeclaration(VarStoreOp.NAME)\n@@ -2062,1 +2062,1 @@\n-            public VarStoreOp(OpDefinition opdef) {\n+            public VarStoreOp(ExternalizedOp opdef) {\n@@ -2103,2 +2103,2 @@\n-    @OpDeclaration(TupleOp.NAME)\n-    public static final class TupleOp extends OpWithDefinition {\n+    @OpFactory.OpDeclaration(TupleOp.NAME)\n+    public static final class TupleOp extends ExternalizableOp {\n@@ -2107,1 +2107,1 @@\n-        public TupleOp(OpDefinition def) {\n+        public TupleOp(ExternalizedOp def) {\n@@ -2133,2 +2133,2 @@\n-    @OpDeclaration(TupleLoadOp.NAME)\n-    public static final class TupleLoadOp extends OpWithDefinition {\n+    @OpFactory.OpDeclaration(TupleLoadOp.NAME)\n+    public static final class TupleLoadOp extends ExternalizableOp {\n@@ -2140,1 +2140,1 @@\n-        public static TupleLoadOp create(OpDefinition def) {\n+        public static TupleLoadOp create(ExternalizedOp def) {\n@@ -2154,1 +2154,1 @@\n-        TupleLoadOp(OpDefinition def, int index) {\n+        TupleLoadOp(ExternalizedOp def, int index) {\n@@ -2204,2 +2204,2 @@\n-    @OpDeclaration(TupleWithOp.NAME)\n-    public static final class TupleWithOp extends OpWithDefinition {\n+    @OpFactory.OpDeclaration(TupleWithOp.NAME)\n+    public static final class TupleWithOp extends ExternalizableOp {\n@@ -2211,1 +2211,1 @@\n-        public static TupleWithOp create(OpDefinition def) {\n+        public static TupleWithOp create(ExternalizedOp def) {\n@@ -2225,1 +2225,1 @@\n-        TupleWithOp(OpDefinition def, int index) {\n+        TupleWithOp(ExternalizedOp def, int index) {\n@@ -2293,2 +2293,2 @@\n-    @OpDeclaration(ExceptionRegionEnter.NAME)\n-    public static final class ExceptionRegionEnter extends OpWithDefinition implements Op.BlockTerminating {\n+    @OpFactory.OpDeclaration(ExceptionRegionEnter.NAME)\n+    public static final class ExceptionRegionEnter extends ExternalizableOp implements Op.BlockTerminating {\n@@ -2303,1 +2303,1 @@\n-        public ExceptionRegionEnter(OpDefinition def) {\n+        public ExceptionRegionEnter(ExternalizedOp def) {\n@@ -2356,2 +2356,2 @@\n-    @OpDeclaration(ExceptionRegionExit.NAME)\n-    public static final class ExceptionRegionExit extends OpWithDefinition implements Op.BlockTerminating {\n+    @OpFactory.OpDeclaration(ExceptionRegionExit.NAME)\n+    public static final class ExceptionRegionExit extends ExternalizableOp implements Op.BlockTerminating {\n@@ -2362,1 +2362,1 @@\n-        public ExceptionRegionExit(OpDefinition def) {\n+        public ExceptionRegionExit(ExternalizedOp def) {\n@@ -2429,2 +2429,2 @@\n-    @OpDeclaration(ConcatOp.NAME)\n-    public static final class ConcatOp extends OpWithDefinition implements Op.Pure {\n+    @OpFactory.OpDeclaration(ConcatOp.NAME)\n+    public static final class ConcatOp extends ExternalizableOp implements Op.Pure {\n@@ -2437,1 +2437,1 @@\n-        public ConcatOp(OpDefinition def) {\n+        public ConcatOp(ExternalizedOp def) {\n@@ -2465,2 +2465,2 @@\n-    public static abstract class ArithmeticOperation extends OpWithDefinition implements Op.Pure {\n-        protected ArithmeticOperation(OpDefinition def) {\n+    public static abstract class ArithmeticOperation extends ExternalizableOp implements Op.Pure {\n+        protected ArithmeticOperation(ExternalizedOp def) {\n@@ -2486,2 +2486,2 @@\n-    public static abstract class TestOperation extends OpWithDefinition implements Op.Pure {\n-        protected TestOperation(OpDefinition def) {\n+    public static abstract class TestOperation extends ExternalizableOp implements Op.Pure {\n+        protected TestOperation(ExternalizedOp def) {\n@@ -2508,1 +2508,1 @@\n-        protected BinaryOp(OpDefinition def) {\n+        protected BinaryOp(ExternalizedOp def) {\n@@ -2534,1 +2534,1 @@\n-        protected UnaryOp(OpDefinition def) {\n+        protected UnaryOp(ExternalizedOp def) {\n@@ -2560,1 +2560,1 @@\n-        protected UnaryTestOp(OpDefinition def) {\n+        protected UnaryTestOp(ExternalizedOp def) {\n@@ -2581,1 +2581,1 @@\n-        protected BinaryTestOp(OpDefinition def) {\n+        protected BinaryTestOp(ExternalizedOp def) {\n@@ -2606,1 +2606,1 @@\n-    @OpDeclaration(AddOp.NAME)\n+    @OpFactory.OpDeclaration(AddOp.NAME)\n@@ -2610,1 +2610,1 @@\n-        public AddOp(OpDefinition def) {\n+        public AddOp(ExternalizedOp def) {\n@@ -2631,1 +2631,1 @@\n-    @OpDeclaration(SubOp.NAME)\n+    @OpFactory.OpDeclaration(SubOp.NAME)\n@@ -2635,1 +2635,1 @@\n-        public SubOp(OpDefinition opdef) {\n+        public SubOp(ExternalizedOp opdef) {\n@@ -2656,1 +2656,1 @@\n-    @OpDeclaration(MulOp.NAME)\n+    @OpFactory.OpDeclaration(MulOp.NAME)\n@@ -2660,1 +2660,1 @@\n-        public MulOp(OpDefinition opdef) {\n+        public MulOp(ExternalizedOp opdef) {\n@@ -2681,1 +2681,1 @@\n-    @OpDeclaration(DivOp.NAME)\n+    @OpFactory.OpDeclaration(DivOp.NAME)\n@@ -2685,1 +2685,1 @@\n-        public DivOp(OpDefinition opdef) {\n+        public DivOp(ExternalizedOp opdef) {\n@@ -2706,1 +2706,1 @@\n-    @OpDeclaration(ModOp.NAME)\n+    @OpFactory.OpDeclaration(ModOp.NAME)\n@@ -2710,1 +2710,1 @@\n-        public ModOp(OpDefinition opdef) {\n+        public ModOp(ExternalizedOp opdef) {\n@@ -2732,1 +2732,1 @@\n-    @OpDeclaration(OrOp.NAME)\n+    @OpFactory.OpDeclaration(OrOp.NAME)\n@@ -2736,1 +2736,1 @@\n-        public OrOp(OpDefinition opdef) {\n+        public OrOp(ExternalizedOp opdef) {\n@@ -2758,1 +2758,1 @@\n-    @OpDeclaration(AndOp.NAME)\n+    @OpFactory.OpDeclaration(AndOp.NAME)\n@@ -2762,1 +2762,1 @@\n-        public AndOp(OpDefinition opdef) {\n+        public AndOp(ExternalizedOp opdef) {\n@@ -2784,1 +2784,1 @@\n-    @OpDeclaration(XorOp.NAME)\n+    @OpFactory.OpDeclaration(XorOp.NAME)\n@@ -2788,1 +2788,1 @@\n-        public XorOp(OpDefinition opdef) {\n+        public XorOp(ExternalizedOp opdef) {\n@@ -2809,1 +2809,1 @@\n-    @OpDeclaration(LshlOp.NAME)\n+    @OpFactory.OpDeclaration(LshlOp.NAME)\n@@ -2813,1 +2813,1 @@\n-        public LshlOp(OpDefinition opdef) {\n+        public LshlOp(ExternalizedOp opdef) {\n@@ -2834,1 +2834,1 @@\n-    @OpDeclaration(AshrOp.NAME)\n+    @OpFactory.OpDeclaration(AshrOp.NAME)\n@@ -2838,1 +2838,1 @@\n-        public AshrOp(OpDefinition opdef) {\n+        public AshrOp(ExternalizedOp opdef) {\n@@ -2859,1 +2859,1 @@\n-    @OpDeclaration(LshrOp.NAME)\n+    @OpFactory.OpDeclaration(LshrOp.NAME)\n@@ -2863,1 +2863,1 @@\n-        public LshrOp(OpDefinition opdef) {\n+        public LshrOp(ExternalizedOp opdef) {\n@@ -2884,1 +2884,1 @@\n-    @OpDeclaration(NegOp.NAME)\n+    @OpFactory.OpDeclaration(NegOp.NAME)\n@@ -2888,1 +2888,1 @@\n-        public NegOp(OpDefinition opdef) {\n+        public NegOp(ExternalizedOp opdef) {\n@@ -2909,1 +2909,1 @@\n-    @OpDeclaration(NotOp.NAME)\n+    @OpFactory.OpDeclaration(NotOp.NAME)\n@@ -2913,1 +2913,1 @@\n-        public NotOp(OpDefinition opdef) {\n+        public NotOp(ExternalizedOp opdef) {\n@@ -2935,1 +2935,1 @@\n-    @OpDeclaration(EqOp.NAME)\n+    @OpFactory.OpDeclaration(EqOp.NAME)\n@@ -2939,1 +2939,1 @@\n-        public EqOp(OpDefinition opdef) {\n+        public EqOp(ExternalizedOp opdef) {\n@@ -2961,1 +2961,1 @@\n-    @OpDeclaration(NeqOp.NAME)\n+    @OpFactory.OpDeclaration(NeqOp.NAME)\n@@ -2965,1 +2965,1 @@\n-        public NeqOp(OpDefinition opdef) {\n+        public NeqOp(ExternalizedOp opdef) {\n@@ -2986,1 +2986,1 @@\n-    @OpDeclaration(GtOp.NAME)\n+    @OpFactory.OpDeclaration(GtOp.NAME)\n@@ -2990,1 +2990,1 @@\n-        public GtOp(OpDefinition opdef) {\n+        public GtOp(ExternalizedOp opdef) {\n@@ -3012,1 +3012,1 @@\n-    @OpDeclaration(GeOp.NAME)\n+    @OpFactory.OpDeclaration(GeOp.NAME)\n@@ -3016,1 +3016,1 @@\n-        public GeOp(OpDefinition opdef) {\n+        public GeOp(ExternalizedOp opdef) {\n@@ -3038,1 +3038,1 @@\n-    @OpDeclaration(LtOp.NAME)\n+    @OpFactory.OpDeclaration(LtOp.NAME)\n@@ -3042,1 +3042,1 @@\n-        public LtOp(OpDefinition opdef) {\n+        public LtOp(ExternalizedOp opdef) {\n@@ -3064,1 +3064,1 @@\n-    @OpDeclaration(LeOp.NAME)\n+    @OpFactory.OpDeclaration(LeOp.NAME)\n@@ -3068,1 +3068,1 @@\n-        public LeOp(OpDefinition opdef) {\n+        public LeOp(ExternalizedOp opdef) {\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/CoreOps.java","additions":161,"deletions":161,"binary":false,"changes":322,"status":"modified"},{"patch":"@@ -33,1 +33,0 @@\n-import java.lang.reflect.code.type.PrimitiveType;\n@@ -76,2 +75,2 @@\n-    public static sealed abstract class JavaLabelOp extends OpWithDefinition implements Op.Lowerable, Op.BodyTerminating {\n-        JavaLabelOp(OpDefinition def) {\n+    public static sealed abstract class JavaLabelOp extends ExternalizableOp implements Op.Lowerable, Op.BodyTerminating {\n+        JavaLabelOp(ExternalizedOp def) {\n@@ -166,1 +165,1 @@\n-    @OpDeclaration(JavaBreakOp.NAME)\n+    @OpFactory.OpDeclaration(JavaBreakOp.NAME)\n@@ -170,1 +169,1 @@\n-        public JavaBreakOp(OpDefinition def) {\n+        public JavaBreakOp(ExternalizedOp def) {\n@@ -196,1 +195,1 @@\n-    @OpDeclaration(JavaContinueOp.NAME)\n+    @OpFactory.OpDeclaration(JavaContinueOp.NAME)\n@@ -200,1 +199,1 @@\n-        public JavaContinueOp(OpDefinition def) {\n+        public JavaContinueOp(ExternalizedOp def) {\n@@ -248,2 +247,2 @@\n-    @OpDeclaration(JavaYieldOp.NAME)\n-    public static final class JavaYieldOp extends OpWithDefinition implements Op.BodyTerminating {\n+    @OpFactory.OpDeclaration(JavaYieldOp.NAME)\n+    public static final class JavaYieldOp extends ExternalizableOp implements Op.BodyTerminating {\n@@ -252,1 +251,1 @@\n-        public JavaYieldOp(OpDefinition def) {\n+        public JavaYieldOp(ExternalizedOp def) {\n@@ -292,1 +291,1 @@\n-    @OpDeclaration(JavaBlockOp.NAME)\n+    @OpFactory.OpDeclaration(JavaBlockOp.NAME)\n@@ -294,1 +293,1 @@\n-    public static final class JavaBlockOp extends OpWithDefinition implements Op.Nested, Op.Lowerable {\n+    public static final class JavaBlockOp extends ExternalizableOp implements Op.Nested, Op.Lowerable {\n@@ -299,1 +298,1 @@\n-        public JavaBlockOp(OpDefinition def) {\n+        public JavaBlockOp(ExternalizedOp def) {\n@@ -374,2 +373,2 @@\n-    @OpDeclaration(JavaLabeledOp.NAME)\n-    public static final class JavaLabeledOp extends OpWithDefinition implements Op.Nested, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaLabeledOp.NAME)\n+    public static final class JavaLabeledOp extends ExternalizableOp implements Op.Nested, Op.Lowerable {\n@@ -380,1 +379,1 @@\n-        public JavaLabeledOp(OpDefinition def) {\n+        public JavaLabeledOp(ExternalizedOp def) {\n@@ -465,2 +464,2 @@\n-    @OpDeclaration(JavaIfOp.NAME)\n-    public static final class JavaIfOp extends OpWithDefinition implements Op.Nested, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaIfOp.NAME)\n+    public static final class JavaIfOp extends ExternalizableOp implements Op.Nested, Op.Lowerable {\n@@ -554,1 +553,1 @@\n-        public JavaIfOp(OpDefinition def) {\n+        public JavaIfOp(ExternalizedOp def) {\n@@ -690,2 +689,2 @@\n-    @OpDeclaration(JavaSwitchExpressionOp.NAME)\n-    public static final class JavaSwitchExpressionOp extends OpWithDefinition implements Op.Nested, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaSwitchExpressionOp.NAME)\n+    public static final class JavaSwitchExpressionOp extends ExternalizableOp implements Op.Nested, Op.Lowerable {\n@@ -697,1 +696,1 @@\n-        public JavaSwitchExpressionOp(OpDefinition def) {\n+        public JavaSwitchExpressionOp(ExternalizedOp def) {\n@@ -757,2 +756,2 @@\n-    @OpDeclaration(JavaSwitchFallthroughOp.NAME)\n-    public static final class JavaSwitchFallthroughOp extends OpWithDefinition implements Op.BodyTerminating {\n+    @OpFactory.OpDeclaration(JavaSwitchFallthroughOp.NAME)\n+    public static final class JavaSwitchFallthroughOp extends ExternalizableOp implements Op.BodyTerminating {\n@@ -761,1 +760,1 @@\n-        public JavaSwitchFallthroughOp(OpDefinition def) {\n+        public JavaSwitchFallthroughOp(ExternalizedOp def) {\n@@ -787,2 +786,2 @@\n-    @OpDeclaration(JavaForOp.NAME)\n-    public static final class JavaForOp extends OpWithDefinition implements Op.Loop, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaForOp.NAME)\n+    public static final class JavaForOp extends ExternalizableOp implements Op.Loop, Op.Lowerable {\n@@ -889,1 +888,1 @@\n-        public static JavaForOp create(OpDefinition def) {\n+        public static JavaForOp create(ExternalizedOp def) {\n@@ -893,1 +892,1 @@\n-        public JavaForOp(OpDefinition def) {\n+        public JavaForOp(ExternalizedOp def) {\n@@ -1046,2 +1045,2 @@\n-    @OpDeclaration(JavaEnhancedForOp.NAME)\n-    public static final class JavaEnhancedForOp extends OpWithDefinition implements Op.Loop, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaEnhancedForOp.NAME)\n+    public static final class JavaEnhancedForOp extends ExternalizableOp implements Op.Loop, Op.Lowerable {\n@@ -1124,1 +1123,1 @@\n-        public static JavaEnhancedForOp create(OpDefinition def) {\n+        public static JavaEnhancedForOp create(ExternalizedOp def) {\n@@ -1128,1 +1127,1 @@\n-        public JavaEnhancedForOp(OpDefinition def) {\n+        public JavaEnhancedForOp(ExternalizedOp def) {\n@@ -1306,2 +1305,2 @@\n-    @OpDeclaration(JavaWhileOp.NAME)\n-    public static final class JavaWhileOp extends OpWithDefinition implements Op.Loop, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaWhileOp.NAME)\n+    public static final class JavaWhileOp extends ExternalizableOp implements Op.Loop, Op.Lowerable {\n@@ -1345,1 +1344,1 @@\n-        public JavaWhileOp(OpDefinition def) {\n+        public JavaWhileOp(ExternalizedOp def) {\n@@ -1451,2 +1450,2 @@\n-    @OpDeclaration(JavaDoWhileOp.NAME)\n-    public static final class JavaDoWhileOp extends OpWithDefinition implements Op.Loop, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaDoWhileOp.NAME)\n+    public static final class JavaDoWhileOp extends ExternalizableOp implements Op.Loop, Op.Lowerable {\n@@ -1490,1 +1489,1 @@\n-        public JavaDoWhileOp(OpDefinition def) {\n+        public JavaDoWhileOp(ExternalizedOp def) {\n@@ -1594,1 +1593,1 @@\n-    public static sealed abstract class JavaConditionalOp extends OpWithDefinition implements Op.Nested, Op.Lowerable {\n+    public static sealed abstract class JavaConditionalOp extends ExternalizableOp implements Op.Nested, Op.Lowerable {\n@@ -1597,1 +1596,1 @@\n-        public JavaConditionalOp(OpDefinition def) {\n+        public JavaConditionalOp(ExternalizedOp def) {\n@@ -1706,1 +1705,1 @@\n-    @OpDeclaration(JavaConditionalAndOp.NAME)\n+    @OpFactory.OpDeclaration(JavaConditionalAndOp.NAME)\n@@ -1735,1 +1734,1 @@\n-        public JavaConditionalAndOp(OpDefinition def) {\n+        public JavaConditionalAndOp(ExternalizedOp def) {\n@@ -1761,1 +1760,1 @@\n-    @OpDeclaration(JavaConditionalOrOp.NAME)\n+    @OpFactory.OpDeclaration(JavaConditionalOrOp.NAME)\n@@ -1790,1 +1789,1 @@\n-        public JavaConditionalOrOp(OpDefinition def) {\n+        public JavaConditionalOrOp(ExternalizedOp def) {\n@@ -1816,2 +1815,2 @@\n-    @OpDeclaration(JavaConditionalExpressionOp.NAME)\n-    public static final class JavaConditionalExpressionOp extends OpWithDefinition implements Op.Nested, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaConditionalExpressionOp.NAME)\n+    public static final class JavaConditionalExpressionOp extends ExternalizableOp implements Op.Nested, Op.Lowerable {\n@@ -1825,1 +1824,1 @@\n-        public JavaConditionalExpressionOp(OpDefinition def) {\n+        public JavaConditionalExpressionOp(ExternalizedOp def) {\n@@ -1921,2 +1920,2 @@\n-    @OpDeclaration(JavaTryOp.NAME)\n-    public static final class JavaTryOp extends OpWithDefinition implements Op.Nested, Op.Lowerable {\n+    @OpFactory.OpDeclaration(JavaTryOp.NAME)\n+    public static final class JavaTryOp extends ExternalizableOp implements Op.Nested, Op.Lowerable {\n@@ -1986,1 +1985,1 @@\n-        public static JavaTryOp create(OpDefinition def) {\n+        public static JavaTryOp create(ExternalizedOp def) {\n@@ -1990,1 +1989,1 @@\n-        public JavaTryOp(OpDefinition def) {\n+        public JavaTryOp(ExternalizedOp def) {\n@@ -2424,2 +2423,2 @@\n-        public static sealed abstract class PatternOp extends OpWithDefinition implements Op.Pure {\n-            PatternOp(OpDefinition def) {\n+        public static sealed abstract class PatternOp extends ExternalizableOp implements Op.Pure {\n+            PatternOp(ExternalizedOp def) {\n@@ -2441,1 +2440,1 @@\n-        @OpDeclaration(BindingPatternOp.NAME)\n+        @OpFactory.OpDeclaration(BindingPatternOp.NAME)\n@@ -2450,1 +2449,1 @@\n-            public static BindingPatternOp create(OpDefinition def) {\n+            public static BindingPatternOp create(ExternalizedOp def) {\n@@ -2459,1 +2458,1 @@\n-            BindingPatternOp(OpDefinition def, String bindingName) {\n+            BindingPatternOp(ExternalizedOp def, String bindingName) {\n@@ -2509,1 +2508,1 @@\n-        @OpDeclaration(RecordPatternOp.NAME)\n+        @OpFactory.OpDeclaration(RecordPatternOp.NAME)\n@@ -2517,1 +2516,1 @@\n-            public static RecordPatternOp create(OpDefinition def) {\n+            public static RecordPatternOp create(ExternalizedOp def) {\n@@ -2528,1 +2527,1 @@\n-            RecordPatternOp(OpDefinition def, RecordTypeRef recordDescriptor) {\n+            RecordPatternOp(ExternalizedOp def, RecordTypeRef recordDescriptor) {\n@@ -2577,2 +2576,2 @@\n-        @OpDeclaration(MatchOp.NAME)\n-        public static final class MatchOp extends OpWithDefinition implements Op.Isolated, Op.Lowerable {\n+        @OpFactory.OpDeclaration(MatchOp.NAME)\n+        public static final class MatchOp extends ExternalizableOp implements Op.Isolated, Op.Lowerable {\n@@ -2584,1 +2583,1 @@\n-            public MatchOp(OpDefinition def) {\n+            public MatchOp(ExternalizedOp def) {\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/ExtendedOps.java","additions":62,"deletions":63,"binary":false,"changes":125,"status":"modified"},{"patch":"@@ -0,0 +1,196 @@\n+\/*\n+ * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package java.lang.reflect.code.op;\n+\n+import java.lang.reflect.code.*;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+\/**\n+ * An operation that supports externalization of its content and reconstruction\n+ * via an instance of {@link ExternalizedOp}.\n+ * <p>\n+ * The specific content of an externalizable operation can be externalized to a\n+ * map of {@link #attributes attributes}, and is reconstructed from the\n+ * attributes component of an instance of {@link ExternalizedOp}.\n+ * <p>\n+ * An externalizable operation could be externalized via serialization to\n+ * a textual representation. That textual representation could then be deserialized,\n+ * via parsing, into an instance of {@link ExternalizedOp} from which a new\n+ * externalizable operation can be reconstructed that is identical to one that\n+ * was serialized.\n+ *\/\n+public abstract class ExternalizableOp extends Op {\n+\n+    \/**\n+     * An operation's externalized content (a record) that can be utilized to construct an instance\n+     * of an {@link ExternalizableOp} associated with the operation's name.\n+     *\n+     * @param name            the operation name\n+     * @param operands        the list of operands\n+     * @param successors      the list of successors\n+     * @param resultType      the operation result type\n+     * @param attributes      the operation's specific content as an attributes map, modifiable\n+     * @param bodyDefinitions the list of body builders for building the operation's bodies\n+     * @apiNote Deserializers of operations may utilize this record to construct operations,\n+     * thereby separating the specifics of deserializing from construction.\n+     *\/\n+    public record ExternalizedOp(String name,\n+                                 List<Value> operands,\n+                                 List<Block.Reference> successors,\n+                                 TypeElement resultType,\n+                                 Map<String, Object> attributes,\n+                                 List<Body.Builder> bodyDefinitions) {\n+\n+        \/**\n+         * Removes an attribute value from the attributes map, converts the value by applying it\n+         * to mapping function, and returns the result.\n+         *\n+         * <p>If the attribute is a default attribute then this method first attempts to\n+         * remove the attribute whose name is the empty string, otherwise if there is no such\n+         * attribute present or the attribute is not a default attribute then this method\n+         * attempts to remove the attribute with the given name.\n+         *\n+         * <p>On successful removal of the attribute its value is converted by applying the value\n+         * to the mapping function.\n+         *\n+         * @param name      the attribute name.\n+         * @param isDefault true if the attribute is a default attribute\n+         * @param <T>       the converted attribute value type\n+         * @return the converted attribute value\n+         * @throws IllegalArgumentException if there is no attribute present\n+         *\/\n+        public <T> T extractAttributeValue(String name, boolean isDefault, Function<Object, T> mapper) {\n+            Object value = attributes.remove(isDefault ? \"\" : name);\n+            if (value == null) {\n+                if (!isDefault) {\n+                    throw new IllegalArgumentException(\"Required attribute not present: \"\n+                            + name);\n+                }\n+\n+                value = attributes.remove(name);\n+            }\n+\n+            return mapper.apply(value);\n+        }\n+\n+        \/**\n+         * Externalizes an operation's content.\n+         * <p>\n+         * If the operation is an instanceof {@code ExternalizableOp} then the operation's\n+         * specific content is externalized to an attribute map, otherwise the attribute map\n+         * is empty.\n+         *\n+         * @param cc the copy context\n+         * @param op the operation\n+         * @return the operation's content.\n+         *\/\n+        public static ExternalizedOp externalizeOp(CopyContext cc, Op op) {\n+            return new ExternalizedOp(\n+                    op.opName(),\n+                    cc.getValues(op.operands()),\n+                    op.successors().stream().map(cc::getSuccessorOrCreate).toList(),\n+                    op.resultType(),\n+                    op instanceof ExternalizableOp exop ? new HashMap<>(exop.attributes()) : new HashMap<>(),\n+                    op.bodies().stream().map(b -> b.copy(cc)).toList()\n+            );\n+        }\n+    }\n+\n+    \/**\n+     * The attribute name associated with the location attribute.\n+     *\/\n+    public static final String ATTRIBUTE_LOCATION = \"loc\";\n+\n+    \/**\n+     * The attribute value that represents the external null value.\n+     *\/\n+    public static final Object NULL_ATTRIBUTE_VALUE = new Object();\n+\n+    \/**\n+     * Constructs an operation by copying given operation.\n+     *\n+     * @param that the operation to copy.\n+     * @param cc   the copy context.\n+     * @implSpec The default implementation calls the constructor with the operation's name, result type, and a list\n+     * values computed, in order, by mapping the operation's operands using the copy context.\n+     *\/\n+    protected ExternalizableOp(Op that, CopyContext cc) {\n+        super(that, cc);\n+    }\n+\n+    \/**\n+     * Constructs an operation with a name, operation result type, and list of operands.\n+     *\n+     * @param name     the operation name.\n+     * @param operands the list of operands, a copy of the list is performed if required.\n+     *\/\n+    protected ExternalizableOp(String name, List<? extends Value> operands) {\n+        super(name, operands);\n+    }\n+\n+    \/**\n+     * Constructs an operation from its external content.\n+     *\n+     * @param def the operation's external content.\n+     * @implSpec This implementation invokes the {@link Op#Op(String, List) constructor}\n+     * accepting the non-optional components of the operation's content, {@code name},\n+     * and {@code operands}:\n+     * <pre> {@code\n+     *  this(def.name(), def.operands());\n+     * }<\/pre>\n+     *\/\n+    @SuppressWarnings(\"this-escape\")\n+    protected ExternalizableOp(ExternalizedOp def) {\n+        super(def.name(), def.operands());\n+        setLocation(extractLocation(def));\n+    }\n+\n+    static Location extractLocation(ExternalizedOp def) {\n+        Object v = def.attributes().get(ATTRIBUTE_LOCATION);\n+        return switch (v) {\n+            case String s -> Location.fromString(s);\n+            case Location loc -> loc;\n+            case null -> null;\n+            default -> throw new UnsupportedOperationException(\"Unsupported location value:\" + v);\n+        };\n+    }\n+\n+    \/**\n+     * Externalizes the operation's specific content as a map of attributes.\n+     *\n+     * <p>A null attribute value is represented by the constant\n+     * value {@link #NULL_ATTRIBUTE_VALUE}.\n+     *\n+     * @return the operation's attributes, as an unmodifiable map\n+     *\/\n+    public Map<String, Object> attributes() {\n+        Location l = location();\n+        return l == null ? Map.of() : Map.of(ATTRIBUTE_LOCATION, l);\n+    }\n+}\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/ExternalizableOp.java","additions":196,"deletions":0,"binary":false,"changes":196,"status":"added"},{"patch":"@@ -1,49 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package java.lang.reflect.code.op;\n-\n-import java.lang.annotation.ElementType;\n-import java.lang.annotation.Retention;\n-import java.lang.annotation.RetentionPolicy;\n-import java.lang.annotation.Target;\n-import java.lang.reflect.code.Op;\n-\n-\/**\n- * An operation declaration annotation.\n- * <p>\n- * This annotation may be declared on a concrete class implementing an {@link Op operation} whose name is a constant\n- * that can be declared as this attribute's value.\n- * <p>\n- * Tooling can process declarations of this annotation to build a factory for constructing operations from their name.\n- *\/\n-@Retention(RetentionPolicy.RUNTIME)\n-@Target(ElementType.TYPE)\n-public @interface OpDeclaration {\n-    \/**\n-     * {@return the operation name}\n-     *\/\n-    String value();\n-}\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/OpDeclaration.java","additions":0,"deletions":49,"binary":false,"changes":49,"status":"deleted"},{"patch":"@@ -1,104 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package java.lang.reflect.code.op;\n-\n-import java.lang.reflect.code.*;\n-import java.lang.reflect.code.TypeElement;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.function.Function;\n-\n-\/**\n- * An operation in general form that is utilized to construct a concrete subclass of {@link Op},\n- * such as a subclass of {@link OpWithDefinition}, associated with the operation name.\n- *\n- * @param name            the operation name\n- * @param operands        the list of operands\n- * @param successors      the list of successors\n- * @param resultType      the operation result type\n- * @param attributes      the attribute map, modifiable\n- * @param bodyDefinitions the list of body builders for building the bodies\n- * @apiNote Deserializers of operations may utilize this record to construct operations,\n- * thereby separating the specifics of deserializing from construction.\n- *\/\n-public record OpDefinition(String name,\n-                           List<Value> operands,\n-                           List<Block.Reference> successors,\n-                           TypeElement resultType,\n-                           Map<String, Object> attributes,\n-                           List<Body.Builder> bodyDefinitions) {\n-\n-    \/**\n-     * Removes an attribute value from the attributes map, converts the value by applying it\n-     * to mapping function, and returns the result.\n-     *\n-     * <p>If the attribute is a default attribute then this method first attempts to\n-     * remove the attribute whose name is the empty string, otherwise if there is no such\n-     * attribute present or the attribute is not a default attribute then this method\n-     * attempts to remove the attribute with the given name.\n-     *\n-     * <p>On successful removal of the attribute its value is converted by applying the value\n-     * to the mapping function.\n-     *\n-     * @param name the attribute name.\n-     * @param isDefault true if the attribute is a default attribute\n-     * @return the converted attribute value\n-     * @param <T> the converted attribute value type\n-     * @throws IllegalArgumentException if there is no attribute present\n-     *\/\n-    public <T> T extractAttributeValue(String name, boolean isDefault, Function<Object, T> mapper) {\n-        Object value = attributes.remove(isDefault ? \"\" : name);\n-        if (value == null) {\n-            if (!isDefault) {\n-                throw new IllegalArgumentException(\"Required attribute not present: \"\n-                        + name);\n-            }\n-\n-            value = attributes.remove(name);\n-        }\n-\n-        return mapper.apply(value);\n-    }\n-\n-    \/**\n-     * Copies an operation to its operation definition.\n-     *\n-     * @param cc the copy context\n-     * @param op the operation\n-     * @return the copied operation definition.\n-     *\/\n-    public static OpDefinition fromOp(CopyContext cc, Op op) {\n-        return new OpDefinition(\n-                op.opName(),\n-                cc.getValues(op.operands()),\n-                op.successors().stream().map(cc::getSuccessorOrCreate).toList(),\n-                op.resultType(),\n-                new HashMap<>(op.attributes()),\n-                op.bodies().stream().map(b -> b.copy(cc)).toList()\n-        );\n-    }\n-}\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/OpDefinition.java","additions":0,"deletions":104,"binary":false,"changes":104,"status":"deleted"},{"patch":"@@ -28,0 +28,4 @@\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n@@ -39,1 +43,2 @@\n- * An operation factory for constructing an {@link Op operation} from its {@link OpDefinition operation definition}.\n+ * An operation factory for constructing an {@link Op operation} from its\n+ * {@link ExternalizableOp.ExternalizedOp external content}.\n@@ -43,0 +48,18 @@\n+\n+    \/**\n+     * An operation declaration annotation.\n+     * <p>\n+     * This annotation may be declared on a concrete class implementing an {@link Op operation} whose name is a constant\n+     * that can be declared as this attribute's value.\n+     * <p>\n+     * Tooling can process declarations of this annotation to build a factory for constructing operations from their name.\n+     *\/\n+    @Retention(RetentionPolicy.RUNTIME)\n+    @Target(ElementType.TYPE)\n+    @interface OpDeclaration {\n+        \/**\n+         * {@return the operation name}\n+         *\/\n+        String value();\n+    }\n+\n@@ -48,1 +71,1 @@\n-     * with one parameter type of {@link OpDefinition} and return type that is the concrete class type.\n+     * with one parameter type of {@link ExternalizableOp.ExternalizedOp} and return type that is the concrete class type.\n@@ -50,1 +73,1 @@\n-     * {@link OpDefinition}.\n+     * {@link ExternalizableOp.ExternalizedOp}.\n@@ -70,1 +93,1 @@\n-     * Constructs an {@link Op operation} from its operation definition.\n+     * Constructs an {@link Op operation} from its external content.\n@@ -72,1 +95,1 @@\n-     * If there is no mapping from the operation definition's name to a concrete\n+     * If there is no mapping from the operation's name to a concrete\n@@ -75,1 +98,1 @@\n-     * @param def the operation definition\n+     * @param def the operation's external content\n@@ -78,1 +101,1 @@\n-    Op constructOp(OpDefinition def);\n+    Op constructOp(ExternalizableOp.ExternalizedOp def);\n@@ -81,1 +104,1 @@\n-     * Constructs an {@link Op operation} from its operation definition.\n+     * Constructs an {@link Op operation} from its external content.\n@@ -83,1 +106,1 @@\n-     * If there is no mapping from the operation definition's name to a concrete\n+     * If there is no mapping from the operation's name to a concrete\n@@ -86,1 +109,1 @@\n-     * @param def the operation definition\n+     * @param def the operation's external content\n@@ -88,1 +111,1 @@\n-     * @throws UnsupportedOperationException if there is no mapping from the operation definition's\n+     * @throws UnsupportedOperationException if there is no mapping from the operation's\n@@ -91,1 +114,1 @@\n-    default Op constructOpOrFail(OpDefinition def) {\n+    default Op constructOpOrFail(ExternalizableOp.ExternalizedOp def) {\n@@ -149,1 +172,1 @@\n-            method = opClass.getMethod(\"create\", OpDefinition.class);\n+            method = opClass.getMethod(\"create\", ExternalizableOp.ExternalizedOp.class);\n@@ -168,1 +191,1 @@\n-            constructor = opClass.getConstructor(OpDefinition.class);\n+            constructor = opClass.getConstructor(ExternalizableOp.ExternalizedOp.class);\n@@ -181,1 +204,1 @@\n-    private static Op constructOp(Class<? extends Op> opClass, OpDefinition opDef) {\n+    private static Op constructOp(Class<? extends Op> opClass, ExternalizableOp.ExternalizedOp opDef) {\n@@ -183,1 +206,1 @@\n-            private static final ClassValue<Function<OpDefinition, Op>> OP_CONSTRUCTOR = new ClassValue<>() {\n+            private static final ClassValue<Function<ExternalizableOp.ExternalizedOp, Op>> OP_CONSTRUCTOR = new ClassValue<>() {\n@@ -185,1 +208,1 @@\n-                protected Function<OpDefinition, Op> computeValue(Class<?> opClass) {\n+                protected Function<ExternalizableOp.ExternalizedOp, Op> computeValue(Class<?> opClass) {\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/OpFactory.java","additions":40,"deletions":17,"binary":false,"changes":57,"status":"modified"},{"patch":"@@ -1,97 +0,0 @@\n-\/*\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package java.lang.reflect.code.op;\n-\n-import java.lang.reflect.code.*;\n-import java.util.List;\n-import java.util.Map;\n-\n-\/**\n- * An operation that may be constructed with an operation {@link OpDefinition definition}.\n- *\/\n-public abstract class OpWithDefinition extends Op {\n-\n-    \/**\n-     * The attribute name associated with the location attribute.\n-     *\/\n-    public static final String ATTRIBUTE_LOCATION = \"loc\";\n-\n-    \/**\n-     * Constructs an operation by copying given operation.\n-     *\n-     * @param that the operation to copy.\n-     * @param cc   the copy context.\n-     * @implSpec The default implementation calls the constructor with the operation's name, result type, and a list\n-     * values computed, in order, by mapping the operation's operands using the copy context.\n-     *\/\n-    protected OpWithDefinition(Op that, CopyContext cc) {\n-        super(that, cc);\n-    }\n-\n-    \/**\n-     * Constructs an operation with a name, operation result type, and list of operands.\n-     *\n-     * @param name     the operation name.\n-     * @param operands the list of operands, a copy of the list is performed if required.\n-     *\/\n-    protected OpWithDefinition(String name, List<? extends Value> operands) {\n-        super(name, operands);\n-    }\n-\n-    \/**\n-     * Constructs an operation from its operation definition.\n-     *\n-     * @param def the operation definition.\n-     * @implSpec This implementation invokes the {@link Op#Op(String, List) constructor}\n-     * accepting the non-optional components of the operation definition, {@code name}, {@code resultType},\n-     * and {@code operands}:\n-     * <pre> {@code\n-     *  this(def.name(), def.resultType(), def.operands());\n-     * }<\/pre>\n-     * If the attributes component of the operation definition is copied as if by {@code Map.copyOf}.\n-     *\/\n-    @SuppressWarnings(\"this-escape\")\n-    protected OpWithDefinition(OpDefinition def) {\n-        super(def.name(), def.operands());\n-        setLocation(extractLocation(def));\n-    }\n-\n-    static Location extractLocation(OpDefinition def) {\n-        Object v = def.attributes().get(ATTRIBUTE_LOCATION);\n-        return switch(v) {\n-            case String s -> Location.fromString(s);\n-            case Location loc -> loc;\n-            case null -> null;\n-            default -> throw new UnsupportedOperationException(\"Unsupported location value:\" + v);\n-        };\n-    }\n-\n-    @Override\n-    public Map<String, Object> attributes() {\n-        Location l = location();\n-        return l == null ? Map.of() : Map.of(ATTRIBUTE_LOCATION, l);\n-    }\n-}\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/OpWithDefinition.java","additions":0,"deletions":97,"binary":false,"changes":97,"status":"deleted"},{"patch":"@@ -242,1 +242,1 @@\n-        OpDefinition opdef = nodeToOpDef(opNode, rtype, c, ancestorBody);\n+        ExternalizableOp.ExternalizedOp opdef = nodeToOpDef(opNode, rtype, c, ancestorBody);\n@@ -246,1 +246,1 @@\n-    static OpDefinition nodeToOpDef(OpNode opNode, TypeDefinition rtype, Context c, Body.Builder ancestorBody) {\n+    static ExternalizableOp.ExternalizedOp nodeToOpDef(OpNode opNode, TypeDefinition rtype, Context c, Body.Builder ancestorBody) {\n@@ -253,1 +253,1 @@\n-        return new OpDefinition(operationName,\n+        return new ExternalizableOp.ExternalizedOp(operationName,\n@@ -432,1 +432,1 @@\n-            case NULL -> Op.NULL_ATTRIBUTE_VALUE;\n+            case NULL -> ExternalizableOp.NULL_ATTRIBUTE_VALUE;\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/parser\/OpParser.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-import java.lang.reflect.code.op.OpDefinition;\n@@ -31,0 +30,1 @@\n+import java.lang.reflect.code.op.ExternalizableOp;\n@@ -46,1 +46,1 @@\n-    static final JavaType J_C_O_OP_DEFINITION = type(OpDefinition.class);\n+    static final JavaType J_C_O_EXTERNALIZED_OP = type(ExternalizableOp.ExternalizedOp.class);\n@@ -49,1 +49,1 @@\n-            Op.class, OpDefinition.class);\n+            Op.class, ExternalizableOp.ExternalizedOp.class);\n@@ -112,2 +112,2 @@\n-    static final FunctionType OP_DEFINITION_F_TYPE = functionType(\n-            J_C_O_OP_DEFINITION,\n+    static final FunctionType EXTERNALIZED_OP_F_TYPE = functionType(\n+            J_C_O_EXTERNALIZED_OP,\n@@ -200,1 +200,1 @@\n-                inputOp.attributes(),\n+                inputOp instanceof ExternalizableOp exop ? exop.attributes() : Map.of(),\n@@ -219,1 +219,1 @@\n-        return builder.op(_new(OP_DEFINITION_F_TYPE, args));\n+        return builder.op(_new(EXTERNALIZED_OP_F_TYPE, args));\n@@ -325,2 +325,3 @@\n-            case Object o when value == Op.NULL_ATTRIBUTE_VALUE -> {\n-                yield builder.op(fieldLoad(FieldRef.field(Op.class, \"NULL_ATTRIBUTE_VALUE\", Object.class)));\n+            case Object o when value == ExternalizableOp.NULL_ATTRIBUTE_VALUE -> {\n+                yield builder.op(fieldLoad(FieldRef.field(ExternalizableOp.class,\n+                        \"NULL_ATTRIBUTE_VALUE\", Object.class)));\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/writer\/OpBuilder.java","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-import java.lang.reflect.code.op.OpWithDefinition;\n+import java.lang.reflect.code.op.ExternalizableOp;\n@@ -68,1 +68,1 @@\n-            return value == Op.NULL_ATTRIBUTE_VALUE\n+            return value == ExternalizableOp.NULL_ATTRIBUTE_VALUE\n@@ -354,1 +354,1 @@\n-        Map<String, Object> attributes = op.attributes();\n+        Map<String, Object> attributes = op instanceof ExternalizableOp exop ? exop.attributes() : Map.of();\n@@ -356,1 +356,1 @@\n-                attributes.containsKey(OpWithDefinition.ATTRIBUTE_LOCATION)) {\n+                attributes.containsKey(ExternalizableOp.ATTRIBUTE_LOCATION)) {\n@@ -358,1 +358,1 @@\n-            attributes.remove(OpWithDefinition.ATTRIBUTE_LOCATION);\n+            attributes.remove(ExternalizableOp.ATTRIBUTE_LOCATION);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/writer\/OpWriter.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+import java.lang.reflect.code.op.ExternalizableOp;\n@@ -152,9 +153,11 @@\n-        if (!op.attributes().isEmpty()) {\n-            space().spaceSeparatedList();\n-            for (var e : op.attributes().entrySet()) {\n-                spaceSeparator();\n-                String name = e.getKey();\n-                if (!name.isEmpty()) {\n-                    atIdentifier(name).equal().identifier(AttributeMapper.toString(e.getValue()));\n-                } else {\n-                    atIdentifier(AttributeMapper.toString(e.getValue()));\n+        if (op instanceof ExternalizableOp exop) {\n+            if (!exop.attributes().isEmpty()) {\n+                space().spaceSeparatedList();\n+                for (var e : exop.attributes().entrySet()) {\n+                    spaceSeparator();\n+                    String name = e.getKey();\n+                    if (!name.isEmpty()) {\n+                        atIdentifier(name).equal().identifier(AttributeMapper.toString(e.getValue()));\n+                    } else {\n+                        atIdentifier(AttributeMapper.toString(e.getValue()));\n+                    }\n","filename":"src\/jdk.code.tools\/share\/classes\/jdk\/code\/tools\/renderer\/SRRenderer.java","additions":12,"deletions":9,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -36,1 +36,1 @@\n-import java.lang.reflect.code.op.OpDefinition;\n+import java.lang.reflect.code.op.ExternalizableOp;\n@@ -63,1 +63,1 @@\n-        OpDefinition odef = OpDefinition.fromOp(CopyContext.create(), f);\n+        ExternalizableOp.ExternalizedOp odef = ExternalizableOp.ExternalizedOp.externalizeOp(CopyContext.create(), f);\n","filename":"test\/jdk\/java\/lang\/reflect\/code\/TestCopy.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}