{"files":[{"patch":"@@ -328,53 +328,0 @@\n-    record ArrayAccessInfo(Op.Result buffer, List<Op.Result> indices) {};\n-\n-    record Node<T>(T value, List<Node<T>> edges) {\n-        ArrayAccessInfo getInfo(Map<Op.Result, Op.Result> replaced) {\n-            List<Node<T>> wl = new ArrayList<>();\n-            Set<Node<T>> seen = new HashSet<>();\n-            Op.Result buffer = null;\n-            List<Op.Result> indices = new ArrayList<>();\n-            wl.add(this);\n-            while (!wl.isEmpty()) {\n-                Node<T> cur = wl.removeFirst();\n-                seen.add(cur);\n-                if (cur.value instanceof Op.Result res) {\n-                    if (res.op() instanceof JavaOp.ArrayAccessOp || res.op() instanceof JavaOp.ArrayLengthOp) {\n-                        buffer = res;\n-                        indices.addFirst(res.op() instanceof JavaOp.ArrayAccessOp ? ((Op.Result) res.op().operands().get(1)) : ((Op.Result) res.op().operands().get(0)));\n-                    }\n-                }\n-                for (Node<T> node : edges) {\n-                    if (!seen.contains(node)) wl.add(node);\n-                }\n-            }\n-            buffer = replaced.get((Op.Result) firstOperand(buffer.op()));\n-            return new ArrayAccessInfo(buffer, indices);\n-        }\n-    }\n-\n-    static ArrayAccessInfo arrayAccessInfo(Value value, Map<Op.Result, Op.Result> replaced) {\n-        return expressionGraph(value).getInfo(replaced);\n-    }\n-\n-    \/\/ TODO: check?\n-    static Node<Value> expressionGraph(Value value) {\n-        return expressionGraph(new HashMap<>(), value);\n-    }\n-\n-    static Node<Value> expressionGraph(Map<Value, Node<Value>> visited, Value value) {\n-        \/\/ If value has already been visited return its node\n-        if (visited.containsKey(value)) {\n-            return visited.get(value);\n-        }\n-\n-        \/\/ Find the expression graphs for each operand\n-        List<Node<Value>> edges = new ArrayList<>();\n-        for (Value operand : value.dependsOn()) {\n-            if (operand instanceof Op.Result res && res.op() instanceof JavaOp.InvokeOp iop && iop.invokeDescriptor().name().toLowerCase().contains(\"arrayview\")) continue;\n-            edges.add(expressionGraph(operand));\n-        }\n-        Node<Value> node = new Node<>(value, edges);\n-        visited.put(value, node);\n-        return node;\n-    }\n-\n@@ -385,10 +332,0 @@\n-    int getLane(String fieldName) {\n-        return switch (fieldName) {\n-            case \"x\" -> 0;\n-            case \"y\" -> 1;\n-            case \"z\" -> 2;\n-            case \"w\" -> 3;\n-            default -> -1;\n-        };\n-    }\n-\n@@ -420,4 +357,0 @@\n-    private CoreOp.VarOp findVarOp(Op op) {\n-        return (CoreOp.VarOp) searchForOp(op, Set.of(CoreOp.VarOp.class));\n-    }\n-\n","filename":"hat\/core\/src\/main\/java\/hat\/phases\/HATDialectifyArrayViewPhase.java","additions":0,"deletions":67,"binary":false,"changes":67,"status":"modified"}]}