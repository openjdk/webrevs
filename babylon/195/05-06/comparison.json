{"files":[{"patch":"@@ -836,0 +836,2 @@\n+            final int n = bodies().size();\n+\n@@ -837,1 +839,1 @@\n-            for (int i = 0; i < bodies().size(); i++) {\n+            for (int i = 0; i < n; i++) {\n@@ -856,1 +858,1 @@\n-            for (int i = 1; i < bodies().size() - 2; i+=2) {\n+            for (int i = 1; i < n - 2; i+=2) {\n@@ -860,20 +862,0 @@\n-            \/\/ move default case to the last position\n-            final int n = bodies().size();\n-            final List<Body> bodies = new ArrayList<>(n);\n-            int defaultLabelIndex = n - 2;\n-            for (int i = 0; i < n - 1; i+=2) {\n-                Body label = bodies().get(i);\n-                Body expr = bodies().get(i + 1);\n-                boolean isDefault = label.blocks().size() == 1 && label.entryBlock().terminatingOp() instanceof YieldOp yop\n-                        && yop.operands().isEmpty();\n-                boolean isLast = i == n - 2;\n-                if (isDefault && !isLast) {\n-                    defaultLabelIndex = i;\n-                    continue;\n-                }\n-                bodies.add(label);\n-                bodies.add(expr);\n-            }\n-            bodies.add(bodies().get(defaultLabelIndex));\n-            bodies.add(bodies().get(defaultLabelIndex + 1));\n-\n@@ -887,1 +869,1 @@\n-                    curr.transformBody(bodies.get(i), List.of(selectorExpression), opT.andThen((block, op) -> {\n+                    curr.transformBody(bodies().get(i), List.of(selectorExpression), opT.andThen((block, op) -> {\n@@ -906,1 +888,1 @@\n-                    curr.transformBody(bodies.get(i), blocks.get(i).parameters(), opT.andThen((block, op) -> {\n+                    curr.transformBody(bodies().get(i), blocks.get(i).parameters(), opT.andThen((block, op) -> {\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/ExtendedOp.java","additions":6,"deletions":24,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -1497,0 +1497,2 @@\n+            Body.Builder defaultLabel = null;\n+            Body.Builder defaultStatements = null;\n@@ -1587,1 +1589,1 @@\n-                    bodies.add(stack.body);\n+                    defaultLabel = stack.body;\n@@ -1613,1 +1615,5 @@\n-                        bodies.add(stack.body);\n+                        if (headCl instanceof JCTree.JCDefaultCaseLabel) {\n+                            defaultStatements = stack.body;\n+                        } else {\n+                            bodies.add(stack.body);\n+                        }\n@@ -1629,1 +1635,5 @@\n-                        bodies.add(stack.body);\n+                        if (headCl instanceof JCTree.JCDefaultCaseLabel) {\n+                            defaultStatements = stack.body;\n+                        } else {\n+                            bodies.add(stack.body);\n+                        }\n@@ -1637,2 +1647,4 @@\n-            \/\/ if no default label\n-            if (!tree.hasUnconditionalPattern) {\n+            if (defaultLabel != null) {\n+                bodies.add(defaultLabel);\n+                bodies.add(defaultStatements);\n+            } else if (!tree.hasUnconditionalPattern) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/ReflectMethods.java","additions":17,"deletions":5,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -907,7 +907,0 @@\n-                    ()void -> {\n-                        yield;\n-                    }\n-                    ()java.lang.String -> {\n-                        %4 : java.lang.String = constant @\"else\";\n-                        yield %4;\n-                    }\n@@ -931,0 +924,7 @@\n+                    }\n+                    ()void -> {\n+                        yield;\n+                    }\n+                    ()java.lang.String -> {\n+                        %4 : java.lang.String = constant @\"else\";\n+                        yield %4;\n","filename":"test\/langtools\/tools\/javac\/reflect\/SwitchExpressionTest2.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"}]}