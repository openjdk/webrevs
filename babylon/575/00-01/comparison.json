{"files":[{"patch":"@@ -54,1 +54,0 @@\n-                \/\/ obtain the result of the varOp\n@@ -56,7 +55,22 @@\n-                finalVars.put(varResult, varOp);\n-            } else if (codeElement instanceof CoreOp.VarAccessOp.VarStoreOp storeOp) {\n-                List<Value> operands = storeOp.operands();\n-                operands.stream().filter(finalVars::containsKey).forEach(finalVars::remove);\n-            } else if (codeElement instanceof CoreOp.YieldOp yieldOp) {\n-                List<Value> operands = yieldOp.operands();\n-                operands.stream().filter(finalVars::containsKey).forEach(finalVars::remove);\n+                Set<Op.Result> uses = varResult.uses();\n+                boolean isFinalVarOp = true;\n+                for (Op.Result use : uses) {\n+                    Op op = use.op();\n+                    switch (op) {\n+                        case CoreOp.VarAccessOp.VarStoreOp storeOp -> {\n+                            if (storeOp.operands().stream().anyMatch(operand -> operand.equals(varResult))) {\n+                                isFinalVarOp = false;\n+                            }\n+                        }\n+                        case CoreOp.YieldOp yieldOp -> {\n+                            if (yieldOp.operands().stream().anyMatch(operand -> operand.equals(varResult))) {\n+                                isFinalVarOp = false;\n+                            }\n+                        }\n+                        case null, default -> {\n+                        }\n+                    }\n+                }\n+                if (isFinalVarOp) {\n+                    finalVars.put(varResult, varOp);\n+                }\n","filename":"hat\/core\/src\/main\/java\/hat\/callgraph\/KernelCallGraph.java","additions":22,"deletions":8,"binary":false,"changes":30,"status":"modified"}]}