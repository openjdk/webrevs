{"files":[{"patch":"@@ -55,1 +55,1 @@\n-                    if (!retValue.isEmpty()) retValue = retValue.subList(0, retValue.size() - 1); \/\/ is this intended to drop the last one?\n+                    if (!retValue.isEmpty()) retValue = retValue.subList(0, retValue.size() - 1);\n","filename":"hat\/core\/src\/main\/java\/hat\/dialect\/HATPtrOp.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -41,0 +41,2 @@\n+\n+import static optkl.OpHelper.*;\n@@ -43,3 +45,0 @@\n-import static optkl.OpHelper.copyLocation;\n-import static optkl.OpHelper.opFromFirstOperandOrThrow;\n-import static optkl.OpHelper.resultFromFirstOperandOrNull;\n@@ -66,1 +65,1 @@\n-                                    invoke.varOpFromFirstUseOrThrow().varName(), \/\/ varNameFromInvokeFirstUseOrThrow(invoke)\n+                                    invoke.varOpFromFirstUseOrThrow().varName(),\n@@ -84,1 +83,1 @@\n-                        if (HATPhaseUtils.isBufferInitialize(varOp) && OpHelper.resultFromFirstOperandOrThrow(varOp) instanceof Op.Result result) {\n+                        if (HATPhaseUtils.isBufferInitialize(varOp) && resultFromFirstOperandOrThrow(varOp) instanceof Op.Result result) {\n@@ -105,1 +104,1 @@\n-                        if ((HATPhaseUtils.isBufferInitialize(varLoadOp)) && OpHelper.resultFromFirstOperandOrThrow(varLoadOp) instanceof Op.Result r) {\n+                        if ((HATPhaseUtils.isBufferInitialize(varLoadOp)) && resultFromFirstOperandOrThrow(varLoadOp) instanceof Op.Result r) {\n@@ -115,1 +114,1 @@\n-                                                blockBuilder.context().getValue(replaced.get(r))) \/\/ getValue(blockBuilder, replaced.get(r)))\n+                                                blockBuilder.context().getValue(replaced.get(r)))\n@@ -130,1 +129,1 @@\n-                                Op vop = opFromFirstOperandOrThrow(buffer.op()); \/\/ resultFromFirstOperandOrNull(buffer.op())).op();\n+                                Op vop = opFromFirstOperandOrThrow(buffer.op());\n@@ -165,1 +164,1 @@\n-                        if (HATPhaseUtils.isBufferArray(arrayStoreOp) && OpHelper.resultFromFirstOperandOrThrow(arrayStoreOp) instanceof Op.Result r) {\n+                        if (HATPhaseUtils.isBufferArray(arrayStoreOp) && resultFromFirstOperandOrThrow(arrayStoreOp) instanceof Op.Result r) {\n@@ -170,1 +169,0 @@\n-                                       \/\/ findVarOpOrHATVarOP(((Op.Result) arrayStoreOp.operands().getLast()).op());\n@@ -208,1 +206,1 @@\n-                        HATPhaseUtils.isBufferArray(arrayLengthOp) && OpHelper.resultFromFirstOperandOrThrow(arrayLengthOp) != null ->{\n+                        HATPhaseUtils.isBufferArray(arrayLengthOp) && resultFromFirstOperandOrThrow(arrayLengthOp) != null ->{\n@@ -250,2 +248,4 @@\n-                        indices.addFirst(res.op() instanceof JavaOp.ArrayAccessOp ? res.op().operands().get(1).result() : res.op().operands().get(0).result());\n-\n+                        \/\/ idx location differs between ArrayAccessOp and ArrayLengthOp\n+                        indices.addFirst(res.op() instanceof JavaOp.ArrayAccessOp\n+                                ? resultFromOperandN(res.op(), 1)\n+                                : resultFromFirstOperandOrThrow(res.op()));\n@@ -253,1 +253,0 @@\n-                \/\/ I think we need to comment this.  Not so obvious.\n","filename":"hat\/core\/src\/main\/java\/hat\/phases\/HATArrayViewPhase.java","additions":13,"deletions":14,"binary":false,"changes":27,"status":"modified"}]}