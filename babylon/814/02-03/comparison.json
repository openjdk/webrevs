{"files":[{"patch":"@@ -74,2 +74,3 @@\n-                        } else if (isBufferArray(invoke.op()) && invoke.firstOperandAsResultOrNull() instanceof Op.Result result) { \/\/ ensures we can use iop as key for replaced vvv\n-                            replaced.put(invoke.returnResult(), result);\n+                        } else if (isBufferArray(invoke.op())) { \/\/ ensures we can use iop as key for replaced vvv\n+                            Op.Result r = invoke.firstOperandAsResultOrNull().result();\n+                            replaced.put(invoke.returnResult(), r);\n@@ -77,1 +78,1 @@\n-                            bufferVarLoads.put((firstOperandAsResultOrNull(result.op())).op(), (CoreOp.VarAccessOp.VarLoadOp) result.op());\n+                            bufferVarLoads.put((firstOperandAsResultOrNull(r.op())).op(), (CoreOp.VarAccessOp.VarLoadOp) r.op());\n@@ -84,2 +85,3 @@\n-                        if (isBufferInitialize(varOp) && firstOperand(varOp) instanceof Op.Result result) { \/\/ makes sure we don't process a new int[] for example\n-                            Op bufferLoad = replaced.get(result).op(); \/\/ gets VarLoadOp associated w\/ og buffer\n+                        if (isBufferInitialize(varOp)) { \/\/ makes sure we don't process a new int[] for example\n+                            Op.Result r = firstOperand(varOp).result();\n+                            Op bufferLoad = replaced.get(r).op(); \/\/ gets VarLoadOp associated w\/ og buffer\n@@ -105,1 +107,2 @@\n-                        if ((isBufferInitialize(varLoadOp)) && firstOperand(varLoadOp) instanceof Op.Result r) {\n+                        if ((isBufferInitialize(varLoadOp))) {\n+                            Op.Result r = firstOperand(varLoadOp).result();\n@@ -125,2 +128,1 @@\n-                        if (isBufferArray(arrayLoadOp) && firstOperand(arrayLoadOp) instanceof Op.Result r) {\n-                            Op.Result buffer = replaced.getOrDefault(r, r);\n+                        if (isBufferArray(arrayLoadOp)) {\n@@ -128,0 +130,2 @@\n+                                Op.Result r = firstOperand(arrayLoadOp).result();\n+                                Op.Result buffer = replaced.getOrDefault(r, r);\n@@ -163,2 +167,1 @@\n-                        if (isBufferArray(arrayStoreOp) && firstOperand(arrayStoreOp) instanceof Op.Result r) {\n-                            Op.Result buffer = replaced.getOrDefault(r, r);\n+                        if (isBufferArray(arrayStoreOp)) {\n@@ -166,1 +169,3 @@\n-                                Op varOp = findVarOpOrHATVarOP(((Op.Result) arrayStoreOp.operands().getLast()).op());\n+                                Op.Result r = firstOperand(arrayStoreOp).result();\n+                                Op.Result buffer = replaced.getOrDefault(r, r);\n+                                Op varOp = findVarOpOrHATVarOP(arrayStoreOp.operands().getLast().result().op());\n@@ -204,1 +209,1 @@\n-                        if (isBufferArray(arrayLengthOp) && firstOperand(arrayLengthOp) instanceof Op.Result) {\n+                        if (isBufferArray(arrayLengthOp)) {\n@@ -258,1 +263,1 @@\n-                        indices.addFirst(res.op() instanceof JavaOp.ArrayAccessOp ? ((Op.Result) res.op().operands().get(1)) : ((Op.Result) res.op().operands().get(0)));\n+                        indices.addFirst(res.op() instanceof JavaOp.ArrayAccessOp ? res.op().operands().get(1).result() : res.op().operands().get(0).result());\n@@ -263,1 +268,1 @@\n-                    Node<T> next = node.edges().getFirst();\n+                    Node<T> next = node.edges().getFirst(); \/\/ we only traverse through the index-related ops\n@@ -269,2 +274,2 @@\n-            buffer = replaced.get((Op.Result) firstOperand(buffer.op()));\n-            String bufferName = hatPtrName(((Op.Result) firstOperand(buffer.op())).op());\n+            buffer = replaced.get(firstOperand(buffer.op()).result());\n+            String bufferName = hatPtrName((firstOperand(buffer.op()).result()).op());\n@@ -324,4 +329,4 @@\n-                        && _V.class.isAssignableFrom((Class<?>) ct.resolve(lookup())))\n-                        || (invoke.returnType() instanceof ArrayType at\n-                        && _V.class.isAssignableFrom((Class<?>) at.componentType().resolve(lookup()))))\n-                       &&invoke.operandCount() == 2;\n+                   && _V.class.isAssignableFrom((Class<?>) ct.resolve(lookup())))\n+                   || (invoke.returnType() instanceof ArrayType at\n+                   && _V.class.isAssignableFrom((Class<?>) at.componentType().resolve(lookup()))))\n+                   && invoke.operandCount() == 2;\n","filename":"hat\/core\/src\/main\/java\/hat\/phases\/HATArrayViewPhase.java","additions":25,"deletions":20,"binary":false,"changes":45,"status":"modified"}]}