{"files":[{"patch":"@@ -35,0 +35,1 @@\n+import java.util.stream.Stream;\n@@ -51,0 +52,1 @@\n+import jdk.incubator.code.dialect.java.JavaType;\n@@ -106,1 +108,11 @@\n-        block.op(new ConstantLabelSwitchOp(selector, labelsAndTargets.labels(), blocks.stream().map(Block.Builder::successor).toList()));\n+        if (ConstantLabelSwitchChecker.isIntegralReferenceType(selector.type())) {\n+            \/\/ unbox selector\n+            selector = block.op(JavaOp.invoke(MethodRef.method(selector.type(), \"intValue\", JavaType.INT), selector));\n+        }\n+        var labels = labelsAndTargets.labels();\n+        if (!labels.contains(null)) {\n+            \/\/ implicit default to exit\n+            labels.add(null);\n+            blocks.add(exit);\n+        }\n+        block.op(new ConstantLabelSwitchOp(selector, labels, blocks.stream().map(Block.Builder::successor).toList()));\n@@ -279,1 +291,6 @@\n-                block.op(((Op.Result) vop.initOperand()).op());\n+                Op cop = ((Op.Result) vop.initOperand()).op();\n+                if (cop instanceof JavaOp.ConvOp) {\n+                    \/\/ converted constant\n+                    block.op(((Op.Result)cop.operands().getFirst()).op());\n+                }\n+                block.op(cop);\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/bytecode\/impl\/LoweringTransform.java","additions":19,"deletions":2,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -21,0 +21,2 @@\n+ * @run main Unreflect TestSwitchExpressionOp\n+ * @run junit TestSwitchExpressionOp\n","filename":"test\/jdk\/java\/lang\/reflect\/code\/TestSwitchExpressionOp.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -18,4 +18,7 @@\n-* @test\n-* @modules jdk.incubator.code\n-* @run junit TestSwitchStatementOp\n-* *\/\n+ * @test\n+ * @modules jdk.incubator.code\n+ * @run junit TestSwitchStatementOp\n+ * @run main Unreflect TestSwitchStatementOp\n+ * @run junit TestSwitchStatementOp\n+ *\n+ *\/\n","filename":"test\/jdk\/java\/lang\/reflect\/code\/TestSwitchStatementOp.java","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"}]}