{"files":[{"patch":"@@ -24,0 +24,4 @@\n+import java.lang.classfile.ClassFile;\n+import java.lang.classfile.MethodModel;\n+import java.lang.classfile.instruction.LookupSwitchInstruction;\n+import java.lang.classfile.instruction.TableSwitchInstruction;\n@@ -34,1 +38,0 @@\n-import java.util.List;\n@@ -37,5 +40,0 @@\n-import jdk.incubator.code.Block;\n-import jdk.incubator.code.Value;\n-import jdk.incubator.code.bytecode.impl.ConstantLabelSwitchOp;\n-import jdk.incubator.code.dialect.core.CoreType;\n-import jdk.incubator.code.dialect.java.JavaType;\n@@ -61,2 +59,2 @@\n-    public void switchExpression() throws Throwable {\n-\/\/        CoreOp.FuncOp f = getFuncOp(\"switchExpression\");\n+    public void testSwitchExpression() throws Throwable {\n+        CoreOp.FuncOp f = getFuncOp(\"switchExpression\");\n@@ -64,45 +62,2 @@\n-        \/\/ @@@ manually constructed:\n-        \/\/ func @\"switchExpression\" (%0 : java.type:\"int\")java.type:\"java.lang.String\" -> {\n-        \/\/    %1 : Var<java.type:\"int\"> = var %0 @\"i\";\n-        \/\/    %2 : java.type:\"int\" = var.load %1;\n-        \/\/    ConstantLabelSwitchOp %2 @\"[7,42,101]\" ^block_1 ^block_2 ^block_3 ^block_4;\n-        \/\/\n-        \/\/  ^block_1:\n-        \/\/    %3 : java.type:\"java.lang.String\" = constant @\"magic number\";\n-        \/\/    branch ^block_5(%3);\n-        \/\/\n-        \/\/  ^block_2:\n-        \/\/    %4 : java.type:\"java.lang.String\" = constant @\"Answer to the Ultimate Question of Life, the Universe, and Everything\";\n-        \/\/    branch ^block_5(%4);\n-        \/\/\n-        \/\/  ^block_3:\n-        \/\/    %5 : java.type:\"java.lang.String\" = constant @\"introduction to a subject\";\n-        \/\/    branch ^block_5(%5);\n-        \/\/\n-        \/\/  ^block_4:\n-        \/\/    %6 : java.type:\"java.lang.String\" = constant @\"not important\";\n-        \/\/    branch ^block_5(%6);\n-        \/\/\n-        \/\/  ^block_5(%7 : java.type:\"java.lang.String\"):\n-        \/\/    return %7;\n-        \/\/};\n-        JavaType stringType = JavaType.type(String.class);\n-        CoreOp.FuncOp f = CoreOp.FuncOp.func(\"switchExpression\",\n-                CoreType.functionType(stringType, JavaType.INT)).body(bb -> {\n-                    Block.Builder b0 = bb.entryBlock(),\n-                                  b1 = bb.block(),\n-                                  b2 = bb.block(),\n-                                  b3 = bb.block(),\n-                                  b4 = bb.block(),\n-                                  b5 = bb.block(stringType);\n-                    Value v1 = b0.op(CoreOp.var(\"i\", JavaType.INT, b0.parameters().getFirst()));\n-                    Value v2 = b0.op(CoreOp.varLoad(v1));\n-                    b0.op(new ConstantLabelSwitchOp(v2,\n-                            List.of(7, 42, 101),\n-                            List.of(b1.successor(), b2.successor(), b3.successor(), b4.successor())));\n-                    b1.op(CoreOp.branch(b5.successor(b1.op(CoreOp.constant(stringType, \"magic number\")))));\n-                    b2.op(CoreOp.branch(b5.successor(b2.op(CoreOp.constant(stringType, \"Answer to the Ultimate Question of Life, the Universe, and Everything\")))));\n-                    b3.op(CoreOp.branch(b5.successor(b3.op(CoreOp.constant(stringType, \"introduction to a subject\")))));\n-                    b4.op(CoreOp.branch(b5.successor(b4.op(CoreOp.constant(stringType, \"not important\")))));\n-                    b5.op(CoreOp.return_(b5.parameters().getFirst()));\n-                });\n+        Assertions.assertTrue(getModel(f).code().get().elementStream()\n+                .anyMatch(i -> i instanceof TableSwitchInstruction || i instanceof LookupSwitchInstruction));\n@@ -111,1 +66,0 @@\n-\n@@ -123,0 +77,7 @@\n+    static MethodModel getModel(CoreOp.FuncOp f) {\n+        var clm = ClassFile.of().parse(BytecodeGenerator.generateClassData(MethodHandles.lookup(), f));\n+        var mm = clm.methods().getFirst();\n+        System.out.println(mm.toDebugString());\n+        return mm;\n+    }\n+\n@@ -124,1 +85,1 @@\n-        Optional<Method> om = Stream.of(TestTry.class.getDeclaredMethods())\n+        Optional<Method> om = Stream.of(TestSwitch.class.getDeclaredMethods())\n","filename":"test\/jdk\/java\/lang\/reflect\/code\/bytecode\/TestSwitch.java","additions":16,"deletions":55,"binary":false,"changes":71,"status":"modified"}]}