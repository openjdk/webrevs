{"files":[{"patch":"@@ -33,1 +33,2 @@\n-import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.ValueSource;\n@@ -49,1 +50,1 @@\n-    static String switchExpression(int i) {\n+    static String lookupSwitchExpression(int i) {\n@@ -51,1 +52,1 @@\n-            case 7 -> \"magic number\";\n+            case 7,8 -> \"magic number\";\n@@ -58,3 +59,81 @@\n-    @Test\n-    public void testSwitchExpression() throws Throwable {\n-        CoreOp.FuncOp f = getFuncOp(\"switchExpression\");\n+    @Reflect\n+    static String tableSwitchExpression(int i) {\n+        return switch (i) {\n+            case -1 -> \"?\";\n+            case 0 -> \"none\";\n+            case 1 -> \"one\";\n+            case 2 -> \"two\";\n+            case 3 -> \"three\";\n+            default -> \"many\";\n+        };\n+    }\n+\n+    @Reflect\n+    static String lookupSwitchStatement(int i) {\n+        String ret = null;\n+        switch (i) {\n+            case 7 : ret = \"magic number\"; break;\n+            case 42 : return \"Answer to the Ultimate Question of Life, the Universe, and Everything\";\n+            case 101 : ret = \"introduction to a subject\"; break;\n+            default : return \"not important\";\n+        }\n+        return ret;\n+    }\n+\n+    @Reflect\n+    static String tableSwitchStatement(int i) {\n+        String ret = null;\n+        switch (i) {\n+            case -1 : ret = \"?\"; break;\n+            case 0 : return \"none\";\n+            case 1 : ret = \"one\"; break;\n+            case 2 : return \"two\";\n+            case 3 : ret =\"three\"; break;\n+            default : return\"many\";\n+        }\n+        return ret;\n+    }\n+\n+    @Reflect\n+    static String outOfOrderFallThrought(int i) {\n+        String ret = \"\";\n+        switch (i) {\n+            default : ret += \"? \";\n+            case 4 : ret += \"four \";\n+            case 2 : ret += \"two \";\n+            case 3 : ret += \"three \";\n+            case 1 : ret += \"one\";\n+        }\n+        return ret;\n+    }\n+\n+    @Reflect\n+    static String nestedExpressions(int i) {\n+        return switch (i) {\n+            case -1 -> \"?\";\n+            case 0 -> \"none\";\n+            case 1 -> \"one\";\n+            case 2 -> \"two\";\n+            case 3 -> \"three\";\n+            default -> switch (i) {\n+                case 7,8 -> \"magic number\";\n+                case 42 -> \"Answer to the Ultimate Question of Life, the Universe, and Everything\";\n+                case 101 -> \"introduction to a subject\";\n+                default -> \"not important\";\n+            };\n+        };\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(strings = {\n+        \"lookupSwitchExpression\",\n+        \"tableSwitchExpression\",\n+\/\/        \"lookupSwitchStatement\", @@@ lower BreakOp\n+\/\/        \"tableSwitchStatement\", @@@ lower BreakOp\n+\/\/        \"outOfOrderFallThrought\", @@@ lower SwitchFallthroughOp\n+\/\/        \"nestedExpressions\", @@@ lower recursively\n+    })\n+\n+    public void testSwitch(String methodName) throws Throwable {\n+        Method m = getMethod(methodName);\n+        CoreOp.FuncOp f = Op.ofMethod(m).orElseThrow();\n@@ -66,2 +145,2 @@\n-        for (int i = 0; i < 110; i++) {\n-            Assertions.assertEquals(switchExpression(i), (String)mh.invokeExact(i));\n+        for (int i = -1; i < 110; i++) {\n+            Assertions.assertEquals((String)m.invoke(null, i), (String)mh.invokeExact(i));\n@@ -84,1 +163,1 @@\n-    static CoreOp.FuncOp getFuncOp(String name) {\n+    static Method getMethod(String name) {\n@@ -89,2 +168,1 @@\n-        Method m = om.get();\n-        return Op.ofMethod(m).get();\n+        return om.get();\n","filename":"test\/jdk\/java\/lang\/reflect\/code\/bytecode\/TestSwitch.java","additions":89,"deletions":11,"binary":false,"changes":100,"status":"modified"}]}