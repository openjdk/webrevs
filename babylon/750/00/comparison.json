{"files":[{"patch":"@@ -110,0 +110,1 @@\n+import static com.sun.tools.javac.code.TypeTag.ARRAY;\n@@ -1867,1 +1868,0 @@\n-            JavaType eType = typeToTypeElement(var.type);\n@@ -1873,2 +1873,5 @@\n-            pushBody(var, CoreType.functionType(varEType, eType));\n-            Op.Result varEResult = append(CoreOp.var(var.name.toString(), stack.block.parameters().get(0)));\n+            Type eType = tree.expr.type.hasTag(ARRAY) ?\n+                    types.elemtype(tree.expr.type) : types.asSuper(tree.expr.type, syms.iterableType.tsym).getTypeArguments().head;\n+            pushBody(var, CoreType.functionType(varEType, typeToTypeElement(eType)));\n+            var initVarExpr = convert(stack.block.parameters().get(0), var.type);\n+            Op.Result varEResult = append(CoreOp.var(var.name.toString(), initVarExpr));\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/internal\/ReflectMethods.java","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -25,0 +25,2 @@\n+\n+import java.util.List;\n@@ -720,0 +722,70 @@\n+\n+    @Reflect\n+    @IR(\"\"\"\n+            func @\"unboxForEachList\" (%0 : java.type:\"java.util.List<java.lang.Integer>\")java.type:\"int\" -> {\n+                %1 : Var<java.type:\"java.util.List<java.lang.Integer>\"> = var %0 @\"li\";\n+                %2 : java.type:\"int\" = constant @0;\n+                %3 : Var<java.type:\"int\"> = var %2 @\"j\";\n+                java.enhancedFor\n+                    ()java.type:\"java.util.List<java.lang.Integer>\" -> {\n+                        %4 : java.type:\"java.util.List<java.lang.Integer>\" = var.load %1;\n+                        yield %4;\n+                    }\n+                    (%5 : java.type:\"java.lang.Integer\")Var<java.type:\"int\"> -> {\n+                        %6 : java.type:\"int\" = invoke %5 @java.ref:\"java.lang.Integer::intValue():int\";\n+                        %7 : Var<java.type:\"int\"> = var %6 @\"i\";\n+                        yield %7;\n+                    }\n+                    (%8 : Var<java.type:\"int\">)java.type:\"void\" -> {\n+                        %9 : java.type:\"int\" = var.load %3;\n+                        %10 : java.type:\"int\" = var.load %8;\n+                        %11 : java.type:\"int\" = add %9 %10;\n+                        var.store %3 %11;\n+                        java.continue;\n+                    };\n+                %12 : java.type:\"int\" = var.load %3;\n+                return %12;\n+            };\n+            \"\"\")\n+    static int unboxForEachList(List<Integer> li) {\n+        int j = 0;\n+        for (int i : li) {\n+            j += i;\n+        }\n+        return j;\n+    }\n+\n+    @Reflect\n+    @IR(\"\"\"\n+            func @\"unboxForEachArray\" (%0 : java.type:\"java.lang.Integer[]\")java.type:\"int\" -> {\n+                %1 : Var<java.type:\"java.lang.Integer[]\"> = var %0 @\"is\";\n+                %2 : java.type:\"int\" = constant @0;\n+                %3 : Var<java.type:\"int\"> = var %2 @\"j\";\n+                java.enhancedFor\n+                    ()java.type:\"java.lang.Integer[]\" -> {\n+                        %4 : java.type:\"java.lang.Integer[]\" = var.load %1;\n+                        yield %4;\n+                    }\n+                    (%5 : java.type:\"java.lang.Integer\")Var<java.type:\"int\"> -> {\n+                        %6 : java.type:\"int\" = invoke %5 @java.ref:\"java.lang.Integer::intValue():int\";\n+                        %7 : Var<java.type:\"int\"> = var %6 @\"i\";\n+                        yield %7;\n+                    }\n+                    (%8 : Var<java.type:\"int\">)java.type:\"void\" -> {\n+                        %9 : java.type:\"int\" = var.load %3;\n+                        %10 : java.type:\"int\" = var.load %8;\n+                        %11 : java.type:\"int\" = add %9 %10;\n+                        var.store %3 %11;\n+                        java.continue;\n+                    };\n+                %12 : java.type:\"int\" = var.load %3;\n+                return %12;\n+            };\n+            \"\"\")\n+    static int unboxForEachArray(Integer[] is) {\n+        int j = 0;\n+        for (int i : is) {\n+            j += i;\n+        }\n+        return j;\n+    }\n","filename":"test\/langtools\/tools\/javac\/reflect\/BoxingConversionTest.java","additions":72,"deletions":0,"binary":false,"changes":72,"status":"modified"}]}