{"files":[{"patch":"@@ -82,0 +82,1 @@\n+import com.sun.tools.javac.util.JCDiagnostic.DiagnosticPosition;\n@@ -327,2 +328,2 @@\n-            BodyScanner bodyScanner = new BodyScanner(methodDecl, attributedBody);\n-            return bodyScanner.scanMethod();\n+            BodyScanner bodyScanner = new BodyScanner(methodDecl);\n+            return bodyScanner.scanMethod(attributedBody);\n@@ -372,1 +373,1 @@\n-        private final JCTree body;\n+        private final JCTree tree;\n@@ -381,1 +382,0 @@\n-        private JCTree currentNode;\n@@ -385,6 +385,1 @@\n-            this(tree, tree.body);\n-        }\n-\n-        BodyScanner(JCMethodDecl tree, JCBlock body) {\n-            this.currentNode = tree;\n-            this.body = body;\n+            this.tree = tree;\n@@ -423,2 +418,1 @@\n-            this.currentNode = tree;\n-            this.body = tree;\n+            this.tree = tree;\n@@ -532,11 +526,0 @@\n-        @Override\n-        public void scan(JCTree tree) {\n-            JCTree prev = currentNode;\n-            currentNode = tree;\n-            try {\n-                super.scan(tree);\n-            } finally {\n-                currentNode = prev;\n-            }\n-        }\n-\n@@ -579,0 +562,5 @@\n+        private DiagnosticPosition pos() {\n+            JCTree current = currentNode();\n+            return current != null ? current : tree;\n+        }\n+\n@@ -580,1 +568,1 @@\n-            return append(op, generateLocation(currentNode, false), stack);\n+            return append(op, generateLocation(pos(), false), stack);\n@@ -593,1 +581,1 @@\n-        Location generateLocation(JCTree node, boolean includeSourceReference) {\n+        Location generateLocation(DiagnosticPosition pos, boolean includeSourceReference) {\n@@ -598,3 +586,3 @@\n-            int pos = node.getStartPosition();\n-            int line = log.currentSource().getLineNumber(pos);\n-            int col = log.currentSource().getColumnNumber(pos, false);\n+            int startPos = pos.getStartPosition();\n+            int line = log.currentSource().getLineNumber(startPos);\n+            int col = log.currentSource().getColumnNumber(startPos, false);\n@@ -1394,1 +1382,1 @@\n-            boolean toQuote = (isQuoted && body == tree);\n+            boolean toQuote = (isQuoted && this.tree == tree);\n@@ -2401,2 +2389,2 @@\n-        CoreOp.FuncOp scanMethod() {\n-            scan(body, currentNode);\n+        CoreOp.FuncOp scanMethod(JCBlock body) {\n+            scan(body, ReflectMethods.this.currentNode());\n@@ -2405,1 +2393,1 @@\n-            func.setLocation(generateLocation(currentNode, true));\n+            func.setLocation(generateLocation(tree, true));\n@@ -2409,0 +2397,4 @@\n+        CoreOp.FuncOp scanMethod() {\n+            return scanMethod(((JCMethodDecl)tree).body);\n+        }\n+\n@@ -2410,1 +2402,1 @@\n-            scan(body, ReflectMethods.this.prevNode());\n+            scan(tree, ReflectMethods.this.prevNode());\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/internal\/ReflectMethods.java","additions":25,"deletions":33,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -30,0 +30,4 @@\n+    JCTree currentNode() {\n+        return prevNode;\n+    }\n+\n","filename":"src\/jdk.incubator.code\/share\/classes\/jdk\/incubator\/code\/internal\/TreeScannerPrev.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}