{"files":[{"patch":"@@ -3157,1 +3157,1 @@\n-                Op c; \/\/ op that perform conversion\n+                Op c = null; \/\/ op that perform conversion\n@@ -3165,1 +3165,1 @@\n-                            \/\/ e.g. Number -> int\n+                            \/\/ e.g. Number -> int, narrowing + unboxing\n@@ -3169,1 +3169,2 @@\n-                            \/\/ e.g. Float -> float\n+                            \/\/ e.g. Float -> float, unboxing\n+                            \/\/ e.g. Integer -> long, unboxing + widening\n@@ -3176,1 +3177,1 @@\n-                        if (isNarrowingPrimitiveConv(ps, pt) || isWideningPrimitiveConvThatNeedCheck(ps, pt)\n+                        if (isNarrowingPrimitiveConv(ps, pt) || isWideningPrimitiveConvWithCheck(ps, pt)\n@@ -3179,1 +3180,1 @@\n-                            \/\/ e,g. int -> float, widening that need check\n+                            \/\/ e,g. int -> float, widening with check\n@@ -3186,2 +3187,16 @@\n-                } else {\n-                    \/\/ e.g. byte -> Byte, Number -> Double, ...\n+                } else if (s instanceof PrimitiveType ps) {\n+                    \/\/ boxing conversions\n+                    ClassType ct = (ClassType) t;\n+                    ClassType box;\n+                    if (ct.unbox().isEmpty()) {\n+                        \/\/ e.g. int -> Number, boxing + widening\n+                        box = ps.box().orElseThrow();\n+                    } else {\n+                        \/\/ e.g. byte -> Byte, boxing\n+                        box = ct;\n+                    }\n+                    c = invoke(MethodRef.method(box, \"valueOf\", box, ps), target);\n+                } else if (!Objects.equals(s, t)) {\n+                    \/\/ reference to reference, but not identity\n+                    \/\/ e.g. Number -> Double, narrowing\n+                    \/\/ e.g. Short -> Object, widening\n@@ -3199,1 +3214,3 @@\n-                target = currentBlock.op(c);\n+                if (c != null) {\n+                    target = currentBlock.op(c);\n+                }\n@@ -3210,1 +3227,1 @@\n-            private static boolean isWideningPrimitiveConvThatNeedCheck(PrimitiveType s, PrimitiveType t) {\n+            private static boolean isWideningPrimitiveConvWithCheck(PrimitiveType s, PrimitiveType t) {\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/code\/op\/ExtendedOp.java","additions":26,"deletions":9,"binary":false,"changes":35,"status":"modified"}]}