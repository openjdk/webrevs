{"files":[{"patch":"@@ -162,9 +162,15 @@\n-        var kernelCallSite =  kernelCallSiteCache.computeIfAbsent(location, _-> {\n-            JavaOp.LambdaOp lambdaOp = (JavaOp.LambdaOp) quoted.op();\n-            MethodRef methodRef = getTargetInvoke(this.lookup(), lambdaOp, KernelContext.class).op().invokeDescriptor();\n-            KernelCallGraph kernelCallGraph = computeCallGraph.kernelCallGraphMap.get(methodRef);\n-            if (kernelCallGraph == null) {\n-                throw new RuntimeException(\"Failed to create KernelCallGraph (did you miss @Reflect annotation?).\");\n-            }\n-            return new KernelCallSite(quoted, lambdaOp, methodRef, kernelCallGraph);\n-        });\n+        KernelCallSite kernelCallSite;\n+        if (kernelCallSiteCache.containsKey(location)) {\n+            var oldKernelCallSite = kernelCallSiteCache.get(location);\n+            kernelCallSite = new KernelCallSite(quoted, oldKernelCallSite.lambdaOp(), oldKernelCallSite.methodRef(), oldKernelCallSite.kernelCallGraph());\n+        } else {\n+            kernelCallSite = kernelCallSiteCache.compute(location, (_, _)-> {\n+                JavaOp.LambdaOp lambdaOp = (JavaOp.LambdaOp) quoted.op();\n+                MethodRef methodRef = getTargetInvoke(this.lookup(), lambdaOp, KernelContext.class).op().invokeDescriptor();\n+                KernelCallGraph kernelCallGraph = computeCallGraph.kernelCallGraphMap.get(methodRef);\n+                if (kernelCallGraph == null) {\n+                    throw new RuntimeException(\"Failed to create KernelCallGraph (did you miss @Reflect annotation?).\");\n+                }\n+                return new KernelCallSite(quoted, lambdaOp, methodRef, kernelCallGraph);\n+            });\n+        }\n","filename":"hat\/core\/src\/main\/java\/hat\/ComputeContext.java","additions":15,"deletions":9,"binary":false,"changes":24,"status":"modified"}]}