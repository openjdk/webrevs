{"files":[{"patch":"@@ -167,1 +167,1 @@\n-        <javac includeantruntime=\"false\" encoding=\"iso-8859-1\" debug=\"true\" target=\"8\" source=\"8\"\n+        <javac includeantruntime=\"false\" encoding=\"iso-8859-1\" debug=\"true\"\n@@ -173,1 +173,1 @@\n-        <javac includeantruntime=\"true\" encoding=\"iso-8859-1\" debug=\"true\" target=\"8\" source=\"8\"\n+        <javac includeantruntime=\"true\" encoding=\"iso-8859-1\" debug=\"true\"\n@@ -239,1 +239,1 @@\n-        <javac includeantruntime=\"true\" encoding=\"iso-8859-1\" debug=\"true\" target=\"8\" source=\"8\"\n+        <javac includeantruntime=\"true\" encoding=\"iso-8859-1\" debug=\"true\"\n@@ -273,1 +273,1 @@\n-        <javac includeantruntime=\"true\" encoding=\"iso-8859-1\" debug=\"true\" target=\"8\" source=\"8\"\n+        <javac includeantruntime=\"true\" encoding=\"iso-8859-1\" debug=\"true\"\n@@ -292,2 +292,0 @@\n-               target=\"8\"\n-               source=\"8\"\n@@ -337,2 +335,0 @@\n-               target=\"8\"\n-               source=\"8\"\n","filename":"build\/build.xml","additions":4,"deletions":8,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,8 +29,2 @@\n-import java.io.BufferedInputStream;\n-import java.io.BufferedOutputStream;\n-import java.io.EOFException;\n-import java.io.File;\n-import java.io.FileInputStream;\n-import java.io.FileNotFoundException;\n-import java.io.FileOutputStream;\n-import java.io.IOException;\n+\n+import java.io.*;\n@@ -39,0 +33,1 @@\n+import java.nio.file.FileSystem;\n@@ -44,5 +39,1 @@\n-import java.util.zip.CRC32;\n-import java.util.zip.ZipEntry;\n-import java.util.zip.ZipException;\n-import java.util.zip.ZipInputStream;\n-import java.util.zip.ZipOutputStream;\n+import java.util.zip.*;\n@@ -57,2 +48,1 @@\n- * @see #instrument(byte[], int)\n- * @see #finishWork()\n+ *\n@@ -61,0 +51,2 @@\n+ * @see #instrument(byte[], int)\n+ * @see #finishWork()\n@@ -213,0 +205,4 @@\n+            if (outFile.isDirectory()) {\n+                \/\/ if outFile is a directory, then use the original file name\n+                outFile = new File(outFile, f.getName());\n+            }\n@@ -803,1 +799,1 @@\n-        }\n+    }\n","filename":"src\/classes\/com\/sun\/tdk\/jcov\/insert\/AbstractUniversalInstrumenter.java","additions":13,"deletions":17,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014,2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014,2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -103,2 +103,3 @@\n-                if (textLine.contains(\"class\") && textLine.contains(\"{\")) {\n-                    parsePackageAndClassNames(textLine);\n+                int classNameInd = isClassOrInterfaceLine(textLine);\n+                if (classNameInd != -1) {\n+                    parsePackageAndClassNames(textLine.substring(classNameInd).replaceFirst(\"[\\\\s].*\", \"\"));\n@@ -136,0 +137,1 @@\n+    final private static String[] JavaClassTokens = new String[]{\"class\", \"interface\"};\n@@ -139,0 +141,48 @@\n+    \/**\n+     * Checks if the given line is a class or interface declaration line in the Javap output.\n+     *\n+     * @param line the line to be checked\n+     * @return the index of the character after the class or interface keyword\n+     * if the line is a class or interface declaration, -1 otherwise\n+     *\/\n+    private static int isClassOrInterfaceLine(String line) {\n+        int ind = -1;\n+        if (line != null) {\n+            for (String s : JavaClassTokens) {\n+                int i = line.indexOf(s);\n+                if (i != -1 && line.indexOf('{') > 0) {\n+                    ind = i + s.length() + 1;\n+                    break;\n+                }\n+            }\n+        }\n+        return ind;\n+    }\n+\n+    \/**\n+     * Extracts the package name and class name from the given Javap class name.\n+     *\n+     * The method removes any generic type information from the class name,\n+     * then splits the remaining string into package name and class name based on the last occurrence of '.'.\n+     *\n+     * If '.' is not found or is the first character, the class name is set to the input string and\n+     * the package name is set to an empty string.\n+     *\n+     * @param javapClassName the Javap class name to be parsed\n+     *\/\n+    private void parsePackageAndClassNames(String javapClassName) {\n+        int i = javapClassName.indexOf('<');\n+        if (i != -1) {\n+            javapClassName = javapClassName.substring(0, i);\n+        }\n+\n+        i = javapClassName.lastIndexOf('.');\n+        if (i > 0) {\n+            this.packageName = javapClassName.substring(0, i);\n+            this.className = javapClassName.substring(i + 1);\n+        } else {\n+            this.className = javapClassName;\n+            this.packageName = \"\";\n+        }\n+    }\n+\n@@ -154,27 +204,0 @@\n-    final private static String[] JavaClassTokens = new String[]{\"implements\", \"extends\", \"{\"};\n-\n-    private void parsePackageAndClassNames(String textLine) {\n-\n-        for (String s : JavaClassTokens) {\n-            if (textLine.contains(s)) {\n-                textLine = textLine.substring(0, textLine.indexOf(s));\n-            }\n-        }\n-\n-        textLine = textLine.substring(textLine.indexOf(\"class\") + 5).trim();\n-\n-        int ind = textLine.indexOf('<');\n-        if (ind != -1) {\n-            textLine = textLine.substring(0, ind);\n-        }\n-\n-        ind = textLine.lastIndexOf('.');\n-        if (ind > 0) {\n-            packageName = textLine.substring(0, ind);\n-            className = textLine.substring(ind + 1);\n-        } else {\n-            className = textLine;\n-            packageName = \"\";\n-        }\n-    }\n-\n","filename":"src\/classes\/com\/sun\/tdk\/jcov\/report\/javap\/JavapClass.java","additions":53,"deletions":30,"binary":false,"changes":83,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -153,1 +153,7 @@\n-            classes.put(javapClass.getClassName(), javapClass);\n+            String className = javapClass.getClassName();\n+            if (className.isEmpty()) {\n+                JavapRepGen.printErrorMsg(\"Failed to extract class or interface name from javap output: \\\"javap -c %s\\\"\".\n+                        formatted(classFile.getAbsolutePath()));\n+            } else {\n+                classes.put(className, javapClass);\n+            }\n@@ -159,1 +165,7 @@\n-            classes.put(javapClass.getClassName(), javapClass);\n+            String className = javapClass.getClassName();\n+            if (className.isEmpty()) {\n+                JavapRepGen.printErrorMsg(\"Failed to extract class or interface name from javap output: \\\"javap -c %s:%s\\\"\".\n+                        formatted(rootFile.getAbsolutePath(), classFileInJar));\n+            } else {\n+                classes.put(className, javapClass);\n+            }\n","filename":"src\/classes\/com\/sun\/tdk\/jcov\/report\/javap\/JavapRepGen.java","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n-public class CoverageTarget {\n+public class CoverageTarget implements ICoverage, ITarget {\n@@ -32,1 +32,1 @@\n-        target.testBranching(5);\n+        target.testBranching(SIZES[0]);\n@@ -43,1 +43,1 @@\n-            return x * 2;\n+            return x * size();\n@@ -54,1 +54,1 @@\n-            if (i % 2 == 0) {\n+            if (i % size() == 0) {\n@@ -61,1 +61,1 @@\n-        while (i < 2) {\n+        while (i < size()) {\n","filename":"test\/unit\/com\/sun\/tdk\/jcov\/report\/CoverageTarget.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -43,0 +43,2 @@\n+    private String intfCoverageName = ICoverage.class.getName();\n+    private String intfTargetName = ITarget.class.getName();\n@@ -47,0 +49,2 @@\n+                intfCoverageName,\n+                intfTargetName,\n@@ -65,1 +69,1 @@\n-        assertTrue(Files.readAllLines(classHtml).stream().anyMatch(l -> l.contains(\"<b>84<\/b>%(42\/50)\")));\n+        assertTrue(Files.readAllLines(classHtml).stream().anyMatch(l -> l.contains(\"<b>82<\/b>%(41\/50)\")));\n@@ -68,1 +72,17 @@\n-}\n+    @Test\n+    void javapReport() throws IOException {\n+        Path report = test_dir.resolve(\"report.javap\");\n+        List<String> params = new ArrayList<>();\n+        params.add(\"-javap\");\n+        params.add(test_dir.toString());\n+        params.add(\"-o\");\n+        params.add(report.toString());\n+        params.add(result.toString());\n+        new RepGen().run(params.toArray(new String[0]));\n+        assertTrue(Files.isDirectory(report));\n+        Path classHtml = report.resolve(intfCoverageName.replace('.', '\/') + \".html\");\n+        assertTrue(Files.readAllLines(classHtml).stream().anyMatch(l -> l.contains(\"<b>100<\/b>%(2\/2)\")));\n+        classHtml = report.resolve(intfTargetName.replace('.', '\/') + \".html\");\n+        assertTrue(Files.readAllLines(classHtml).stream().anyMatch(l -> l.contains(\"<b>100<\/b>%(16\/16)\")));\n+    }\n+ }\n","filename":"test\/unit\/com\/sun\/tdk\/jcov\/report\/CoverageTargetTest.java","additions":22,"deletions":2,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -0,0 +1,11 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * ORACLE PROPRIETARY\/CONFIDENTIAL. Use is subject to license terms.\n+ *\/\n+package com.sun.tdk.jcov.report;\n+\n+public interface ICoverage {\n+    default int size() {\n+        return 2;\n+    }\n+}\n","filename":"test\/unit\/com\/sun\/tdk\/jcov\/report\/ICoverage.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"added"},{"patch":"@@ -0,0 +1,9 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * ORACLE PROPRIETARY\/CONFIDENTIAL. Use is subject to license terms.\n+ *\/\n+package com.sun.tdk.jcov.report;\n+\n+public interface ITarget {\n+    int[] SIZES = { 16, 24, 32 };\n+}\n","filename":"test\/unit\/com\/sun\/tdk\/jcov\/report\/ITarget.java","additions":9,"deletions":0,"binary":false,"changes":9,"status":"added"}]}