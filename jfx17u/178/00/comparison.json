{"files":[{"patch":"@@ -62,0 +62,15 @@\n+\/\/ Custom NSRunLoopMode constant that matches the one used by AWT in its\n+\/\/ doAWTRunLoopImpl method. This is not formally documented yet, but all\n+\/\/ versions of the JDK use it. We might consider a request to document it.\n+static NSString* JavaRunLoopMode = @\"AWTRunLoopMode\";\n+\n+\/\/ List of allowable runLoop modes that Java runnables can run in.\n+\/\/ This is used when calling performSelectorOnMainThread from\n+\/\/ the JNI _invokeAndWait and _submitForLaterInvocation methods.\n+\/\/ We include JavaRunLoopMode in the list of allowable run modes in case\n+\/\/ we are running on the AWT event thread. This will allow JavaFX\n+\/\/ runnables to be scheduled when AWT is running doAWTRunLoopImpl\n+\/\/ on the AppKit thread (which it does for IME callbacks) so that we\n+\/\/ don't deadlock.\n+static NSArray<NSString*> *runLoopModes = nil;\n+\n@@ -528,0 +543,13 @@\n+        \/\/ List of RunLoopModes in which we will run runnables passed\n+        \/\/ to _invokeAndWait and _invokeAndExit. This includes\n+        \/\/ JavaRunLoopMode to avoid a possible deadlock with AWT.\n+        \/\/ There is no harm always adding it, since it will have no\n+        \/\/ effect if the run loop that receives this message does not\n+        \/\/ specify it.\n+        runLoopModes = [[NSArray alloc] initWithObjects:\n+            NSDefaultRunLoopMode,\n+            NSModalPanelRunLoopMode,\n+            NSEventTrackingRunLoopMode,\n+            JavaRunLoopMode,\n+            nil];\n+\n@@ -974,1 +1002,1 @@\n-        [runnable performSelectorOnMainThread:@selector(run) withObject:nil waitUntilDone:NO];\n+        [runnable performSelectorOnMainThread:@selector(run) withObject:nil waitUntilDone:NO modes:runLoopModes];\n@@ -992,1 +1020,1 @@\n-        [runnable performSelectorOnMainThread:@selector(run) withObject:nil waitUntilDone:YES];\n+        [runnable performSelectorOnMainThread:@selector(run) withObject:nil waitUntilDone:YES modes:runLoopModes];\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassApplication.m","additions":30,"deletions":2,"binary":false,"changes":32,"status":"modified"}]}