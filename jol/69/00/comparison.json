{"files":[{"patch":"@@ -46,0 +46,3 @@\n+    private static final long G = 1024L*1024*1024;\n+    private static final long MAX = Long.MAX_VALUE;\n+\n@@ -67,1 +70,1 @@\n-        out.println(\"'JVM mode' is the relative footprint change compared to the best JVM mode in this JDK.\");\n+        out.println(\"'JVM mode' is the relative footprint change compared to the default JVM mode in this JDK.\");\n@@ -92,7 +95,7 @@\n-        final String msg_noCoops =          \"64-bit, no comp refs (>32 GB heap, default align)\";\n-        final String msg_noCoops_ccp =      \"64-bit, no comp refs, but comp class ptrs (>32 GB heap, default align)\";\n-        final String msg_coops =            \"64-bit, comp refs (<32 GB heap, default align)\";\n-        final String msg_coops_align16 =    \"64-bit, comp refs with large align (  32..64GB heap,  16-byte align)\";\n-        final String msg_coops_align32 =    \"64-bit, comp refs with large align ( 64..128GB heap,  32-byte align)\";\n-        final String msg_coops_align64 =    \"64-bit, comp refs with large align (128..256GB heap,  64-byte align)\";\n-        final String msg_coops_align128 =   \"64-bit, comp refs with large align (256..512GB heap, 128-byte align)\";\n+        final String msg_noCoops =          \"no comp refs (>32 GB max heap)\";\n+        final String msg_noCoops_ccp =      \"no comp refs, but comp class ptrs (>32 GB max heap)\";\n+        final String msg_coops =            \"comp refs (<32 GB max heap)\";\n+        final String msg_coops_align16 =    \"comp refs with large align ( <64GB max heap,  16-byte align)\";\n+        final String msg_coops_align32 =    \"comp refs with large align (<128GB max heap,  32-byte align)\";\n+        final String msg_coops_align64 =    \"comp refs with large align (<256GB max heap,  64-byte align)\";\n+        final String msg_coops_align128 =   \"comp refs with large align (<512GB max heap, 128-byte align)\";\n@@ -100,1 +103,1 @@\n-        out.println(\"=== Stock 32-bit OpenJDK\");\n+        out.println(\"=== 32-bit JDK, All versions\");\n@@ -103,1 +106,5 @@\n-        long jdk8_32 = computeWithLayouter(data, new HotSpotLayouter(new Model32(), 8));\n+        long jdk8_32 =  computeWithLayouter(data, new HotSpotLayouter(new Model32(), 8));\n+        long jdk11_32 = computeWithLayouter(data, new HotSpotLayouter(new Model32(), 11));\n+        long jdk17_32 = computeWithLayouter(data, new HotSpotLayouter(new Model32(), 17));\n+        long jdk21_32 = computeWithLayouter(data, new HotSpotLayouter(new Model32(), 21));\n+        long jdk25_32 = computeWithLayouter(data, new HotSpotLayouter(new Model32(), 25));\n@@ -109,1 +116,5 @@\n-            printLine(\"32-bit (<4 GB heap)\",              rawSize,    jdk8_32);\n+            printLine(\"<4 GB max heap, JDK 8\",  rawSize, 4*G, jdk8_32);\n+            printLine(\"<4 GB max heap, JDK 11\", rawSize, 4*G, jdk11_32);\n+            printLine(\"<4 GB max heap, JDK 17\", rawSize, 4*G, jdk17_32);\n+            printLine(\"<4 GB max heap, JDK 21\", rawSize, 4*G, jdk21_32);\n+            printLine(\"<4 GB max heap, JDK 25\", rawSize, 4*G, jdk25_32);\n@@ -113,1 +124,1 @@\n-        out.println(\"=== Stock 64-bit OpenJDK (JDK < 15)\");\n+        out.println(\"=== 64-bit JDK 8, 11: Basic\");\n@@ -128,6 +139,6 @@\n-            printLine(msg_noCoops,              rawSize,    jdk8_noCoops,           jdk8_coops);\n-            printLine(msg_coops,                rawSize,    jdk8_coops,             jdk8_coops);\n-            printLine(msg_coops_align16,        rawSize,    jdk8_coops_align16,     jdk8_coops);\n-            printLine(msg_coops_align32,        rawSize,    jdk8_coops_align32,     jdk8_coops);\n-            printLine(msg_coops_align64,        rawSize,    jdk8_coops_align64,     jdk8_coops);\n-            printLine(msg_coops_align128,       rawSize,    jdk8_coops_align128,    jdk8_coops);\n+            printLine(msg_noCoops,              rawSize, MAX,   jdk8_noCoops,           jdk8_coops);\n+            printLine(msg_coops,                rawSize, 32*G,  jdk8_coops,             jdk8_coops);\n+            printLine(msg_coops_align16,        rawSize, 64*G,  jdk8_coops_align16,     jdk8_coops);\n+            printLine(msg_coops_align32,        rawSize, 128*G, jdk8_coops_align32,     jdk8_coops);\n+            printLine(msg_coops_align64,        rawSize, 256*G, jdk8_coops_align64,     jdk8_coops);\n+            printLine(msg_coops_align128,       rawSize, 512*G, jdk8_coops_align128,    jdk8_coops);\n@@ -137,6 +148,6 @@\n-        long jdk15_noCoops =        computeWithLayouter(data, new HotSpotLayouter(new Model64(false, true,  8), 15));\n-        long jdk15_coops =          computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,   8), 15));\n-        long jdk15_coops_align16 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  16), 15));\n-        long jdk15_coops_align32 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  32), 15));\n-        long jdk15_coops_align64 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  64), 15));\n-        long jdk15_coops_align128 = computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true, 128), 15));\n+        long jdk17_noCoops =        computeWithLayouter(data, new HotSpotLayouter(new Model64(false, true,  8), 17));\n+        long jdk17_coops =          computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,   8), 17));\n+        long jdk17_coops_align16 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  16), 17));\n+        long jdk17_coops_align32 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  32), 17));\n+        long jdk17_coops_align64 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  64), 17));\n+        long jdk17_coops_align128 = computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true, 128), 17));\n@@ -144,1 +155,1 @@\n-        out.println(\"=== Stock 64-bit OpenJDK (JDK >= 15): Better Compressed Class Pointers, New Field Layouter\");\n+        out.println(\"=== 64-bit JDK 17, 21: Better Compressed Class Pointers, New Field Layouter\");\n@@ -148,1 +159,1 @@\n-            out.printf(\"%37s %s%n\", \"\", \"Upgrade From:\");\n+            out.printf(\"%36s %s%n\", \"\", \"Upgrade From:\");\n@@ -150,1 +161,26 @@\n-                    \"Footprint\", \"Overhead\", \"JVM Mode\", \"JDK < 15\", \"Description\"\n+                    \"Footprint\", \"Overhead\", \"JVM Mode\", \"JDK 8..11\", \"Description\"\n+            );\n+\n+            printLine(msg_noCoops_ccp,      rawSize,    MAX,    jdk17_noCoops,          jdk17_coops,    jdk8_noCoops);\n+            printLine(msg_coops,            rawSize,    32*G,   jdk17_coops,            jdk17_coops,    jdk8_coops);\n+            printLine(msg_coops_align16,    rawSize,    64*G,   jdk17_coops_align16,    jdk17_coops,    jdk8_coops_align16);\n+            printLine(msg_coops_align32,    rawSize,    128*G,  jdk17_coops_align32,    jdk17_coops,    jdk8_coops_align32);\n+            printLine(msg_coops_align64,    rawSize,    256*G,  jdk17_coops_align64,    jdk17_coops,    jdk8_coops_align64);\n+            printLine(msg_coops_align128,   rawSize,    512*G,  jdk17_coops_align128,   jdk17_coops,    jdk8_coops_align128);\n+        }\n+        out.println();\n+\n+        long jdk25_noCoops =        computeWithLayouter(data, new HotSpotLayouter(new Model64(false, true,  8), 25));\n+        long jdk25_coops =          computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,   8), 25));\n+        long jdk25_coops_align16 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  16), 25));\n+        long jdk25_coops_align32 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  32), 25));\n+        long jdk25_coops_align64 =  computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true,  64), 25));\n+        long jdk25_coops_align128 = computeWithLayouter(data, new HotSpotLayouter(new Model64(true, true, 128), 25));\n+\n+        out.println(\"=== 64-bit JDK 25: Array Base Improvements, Reference Fields Ordering\");\n+        out.println();\n+\n+        {\n+            out.printf(\"%36s %s%n\", \"\", \"Upgrade From:\");\n+            out.printf(\"%10s, %10s, %10s, %10s, %10s,     %s%n\",\n+                    \"Footprint\", \"Overhead\", \"JVM Mode\", \"JDK 8..11\", \"JDK 17..21\", \"Description\"\n@@ -153,6 +189,6 @@\n-            printLine(msg_noCoops_ccp,      rawSize,    jdk15_noCoops,          jdk15_coops,    jdk8_noCoops);\n-            printLine(msg_coops,            rawSize,    jdk15_coops,            jdk15_coops,    jdk8_coops);\n-            printLine(msg_coops_align16,    rawSize,    jdk15_coops_align16,    jdk15_coops,    jdk8_coops_align16);\n-            printLine(msg_coops_align32,    rawSize,    jdk15_coops_align32,    jdk15_coops,    jdk8_coops_align32);\n-            printLine(msg_coops_align64,    rawSize,    jdk15_coops_align64,    jdk15_coops,    jdk8_coops_align64);\n-            printLine(msg_coops_align128,   rawSize,    jdk15_coops_align128,   jdk15_coops,    jdk8_coops_align128);\n+            printLine(msg_noCoops_ccp,      rawSize,    MAX,    jdk25_noCoops,          jdk25_coops,    jdk8_noCoops,           jdk17_noCoops);\n+            printLine(msg_coops,            rawSize,    32*G,   jdk25_coops,            jdk25_coops,    jdk8_coops,             jdk17_coops);\n+            printLine(msg_coops_align16,    rawSize,    64*G,   jdk25_coops_align16,    jdk25_coops,    jdk8_coops_align16,     jdk17_coops_align16);\n+            printLine(msg_coops_align32,    rawSize,    128*G,  jdk25_coops_align32,    jdk25_coops,    jdk8_coops_align32,     jdk17_coops_align32);\n+            printLine(msg_coops_align64,    rawSize,    256*G,  jdk25_coops_align64,    jdk25_coops,    jdk8_coops_align64,     jdk17_coops_align64);\n+            printLine(msg_coops_align128,   rawSize,    512*G,  jdk25_coops_align128,   jdk25_coops,    jdk8_coops_align128,    jdk17_coops_align128);\n@@ -162,1 +198,1 @@\n-        out.println(\"=== Experimental 64-bit OpenJDK (JDK >= 24): Lilliput 1 (64-bit headers)\");\n+        out.println(\"=== 64-bit JDK 25: -XX:+UseCompactObjectHeaders (Lilliput 1, 64-bit headers)\");\n@@ -173,3 +209,3 @@\n-            out.printf(\"%37s %s%n\", \"\", \"Upgrade From:\");\n-            out.printf(\"%10s, %10s, %10s, %10s, %10s,     %s%n\",\n-                    \"Footprint\", \"Overhead\", \"JVM Mode\", \"JDK < 15\", \"JDK >= 15\", \"Description\"\n+            out.printf(\"%36s %s%n\", \"\", \"Upgrade From:\");\n+            out.printf(\"%10s, %10s, %10s, %10s, %10s, %10s,     %s%n\",\n+                    \"Footprint\", \"Overhead\", \"JVM Mode\", \"JDK 8..11\", \"JDK 17..21\", \"JDK 25\", \"Description\"\n@@ -178,6 +214,6 @@\n-            printLine(msg_noCoops_ccp,      rawSize, jdkLilliput_noCoops,          jdkLilliput_coops, jdk8_noCoops,           jdk15_noCoops);\n-            printLine(msg_coops,            rawSize, jdkLilliput_coops,            jdkLilliput_coops, jdk8_coops,             jdk15_coops);\n-            printLine(msg_coops_align16,    rawSize, jdkLilliput_coops_align16,    jdkLilliput_coops, jdk8_coops_align16,     jdk15_coops_align16);\n-            printLine(msg_coops_align32,    rawSize, jdkLilliput_coops_align32,    jdkLilliput_coops, jdk8_coops_align32,     jdk15_coops_align32);\n-            printLine(msg_coops_align64,    rawSize, jdkLilliput_coops_align64,    jdkLilliput_coops, jdk8_coops_align64,     jdk15_coops_align64);\n-            printLine(msg_coops_align128,   rawSize, jdkLilliput_coops_align128,   jdkLilliput_coops, jdk8_coops_align128,    jdk15_coops_align128);\n+            printLine(msg_noCoops_ccp,      rawSize,    MAX,    jdkLilliput_noCoops,          jdkLilliput_coops, jdk8_noCoops,           jdk17_noCoops,         jdk25_noCoops);\n+            printLine(msg_coops,            rawSize,    32*G,   jdkLilliput_coops,            jdkLilliput_coops, jdk8_coops,             jdk17_coops,           jdk25_coops);\n+            printLine(msg_coops_align16,    rawSize,    64*G,   jdkLilliput_coops_align16,    jdkLilliput_coops, jdk8_coops_align16,     jdk17_coops_align16,   jdk25_coops_align16);\n+            printLine(msg_coops_align32,    rawSize,    128*G,  jdkLilliput_coops_align32,    jdkLilliput_coops, jdk8_coops_align32,     jdk17_coops_align32,   jdk25_coops_align32);\n+            printLine(msg_coops_align64,    rawSize,    256*G,  jdkLilliput_coops_align64,    jdkLilliput_coops, jdk8_coops_align64,     jdk17_coops_align64,   jdk25_coops_align64);\n+            printLine(msg_coops_align128,   rawSize,    512*G,  jdkLilliput_coops_align128,   jdkLilliput_coops, jdk8_coops_align128,    jdk17_coops_align128,  jdk25_coops_align128);\n@@ -187,1 +223,1 @@\n-        out.println(\"=== Experimental 64-bit OpenJDK (Prototype): Lilliput 2 (32-bit headers)\");\n+        out.println(\"=== 64-bit Future JDK: -XX:+UseCompactObjectHeaders (Lilliput 2, 32-bit headers)\");\n@@ -198,3 +234,3 @@\n-            out.printf(\"%37s %s%n\", \"\", \"Upgrade From:\");\n-            out.printf(\"%10s, %10s, %10s, %10s, %10s, %10s,     %s%n\",\n-                    \"Footprint\", \"Overhead\", \"JVM Mode\", \"JDK < 15\", \"JDK >= 15\", \"Lilliput 1\", \"Description\"\n+            out.printf(\"%36s %s%n\", \"\", \"Upgrade From:\");\n+            out.printf(\"%10s, %10s, %10s, %10s, %10s, %10s, %10s,     %s%n\",\n+                    \"Footprint\", \"Overhead\", \"JVM Mode\", \"JDK 8..11\", \"JDK 17..21\", \"JDK 25\", \"JDK 25 L1\", \"Description\"\n@@ -203,6 +239,6 @@\n-            printLine(msg_noCoops_ccp,    rawSize,  jdkLilliput32_noCoops,        jdkLilliput32_coops, jdk8_noCoops,          jdk15_noCoops,          jdkLilliput_noCoops);\n-            printLine(msg_coops,          rawSize,  jdkLilliput32_coops,          jdkLilliput32_coops, jdk8_coops,            jdk15_coops,            jdkLilliput_coops);\n-            printLine(msg_coops_align16,  rawSize,  jdkLilliput32_coops_align16,  jdkLilliput32_coops, jdk8_coops_align16,    jdk15_coops_align16,    jdkLilliput_coops_align16);\n-            printLine(msg_coops_align32,  rawSize,  jdkLilliput32_coops_align32,  jdkLilliput32_coops, jdk8_coops_align32,    jdk15_coops_align32,    jdkLilliput_coops_align32);\n-            printLine(msg_coops_align64,  rawSize,  jdkLilliput32_coops_align64,  jdkLilliput32_coops, jdk8_coops_align64,    jdk15_coops_align64,    jdkLilliput_coops_align64);\n-            printLine(msg_coops_align128, rawSize,  jdkLilliput32_coops_align128, jdkLilliput32_coops, jdk8_coops_align128,   jdk15_coops_align128,   jdkLilliput_coops_align128);\n+            printLine(msg_noCoops_ccp,    rawSize,  MAX,    jdkLilliput32_noCoops,        jdkLilliput32_coops, jdk8_noCoops,          jdk17_noCoops,          jdk25_noCoops,        jdkLilliput_noCoops);\n+            printLine(msg_coops,          rawSize,  32*G,   jdkLilliput32_coops,          jdkLilliput32_coops, jdk8_coops,            jdk17_coops,            jdk25_coops,          jdkLilliput_coops);\n+            printLine(msg_coops_align16,  rawSize,  64*G,   jdkLilliput32_coops_align16,  jdkLilliput32_coops, jdk8_coops_align16,    jdk17_coops_align16,    jdk25_coops_align16,  jdkLilliput_coops_align16);\n+            printLine(msg_coops_align32,  rawSize,  128*G,  jdkLilliput32_coops_align32,  jdkLilliput32_coops, jdk8_coops_align32,    jdk17_coops_align32,    jdk25_coops_align32,  jdkLilliput_coops_align32);\n+            printLine(msg_coops_align64,  rawSize,  256*G,  jdkLilliput32_coops_align64,  jdkLilliput32_coops, jdk8_coops_align64,    jdk17_coops_align64,    jdk25_coops_align64,  jdkLilliput_coops_align64);\n+            printLine(msg_coops_align128, rawSize,  512*G,  jdkLilliput32_coops_align128, jdkLilliput32_coops, jdk8_coops_align128,   jdk17_coops_align128,   jdk25_coops_align128, jdkLilliput_coops_align128);\n@@ -213,4 +249,11 @@\n-    private static void printLine(String msg, long rawSize, long value, long... bases) {\n-        out.printf(\"%10s, %10s, \", MathUtil.inProperUnits(value), MathUtil.diffPercent(value, rawSize));\n-        for (long base : bases) {\n-            out.printf(\"%10s, \", MathUtil.diffPercent(value, base));\n+    private static void printLine(String msg, long rawSize, long cap, long value, long... bases) {\n+        if (rawSize < cap) {\n+            out.printf(\"%10s, %10s, \", MathUtil.inProperUnits(value), MathUtil.diffPercent(value, rawSize));\n+            for (long base : bases) {\n+                out.printf(\"%10s, \", MathUtil.diffPercent(value, base));\n+            }\n+        } else {\n+            out.printf(\"%10s, %10s, \", \"Unfit\", \"Unfit\");\n+            for (long base : bases) {\n+                out.printf(\"%10s, \", \"Unfit\");\n+            }\n","filename":"jol-cli\/src\/main\/java\/org\/openjdk\/jol\/operations\/HeapDumpEstimates.java","additions":100,"deletions":57,"binary":false,"changes":157,"status":"modified"}]}