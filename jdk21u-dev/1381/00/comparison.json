{"files":[{"patch":"@@ -70,0 +70,3 @@\n+    private static final String GC_PREFIX = \"-XX:+Use\";\n+    private static final String GC_SUFFIX = \"GC\";\n+\n@@ -347,2 +350,0 @@\n-        String GC_PREFIX  = \"-XX:+Use\";\n-        String GC_SUFFIX  = \"GC\";\n@@ -460,1 +461,25 @@\n-        return \"\" + (\"true\".equals(vmCDS()) && WB.canWriteJavaHeapArchive());\n+        return \"\" + (\"true\".equals(vmCDS()) && WB.canWriteJavaHeapArchive()\n+                     && isCDSRuntimeOptionsCompatible());\n+    }\n+\n+    \/**\n+     * @return true if the VM options specified via the \"test.cds.runtime.options\"\n+     * property is compatible with writing Java heap objects into the CDS archive\n+     *\/\n+    protected boolean isCDSRuntimeOptionsCompatible() {\n+        String jtropts = System.getProperty(\"test.cds.runtime.options\");\n+        if (jtropts == null) {\n+            return true;\n+        }\n+        String CCP_DISABLED = \"-XX:-UseCompressedClassPointers\";\n+        String G1GC_ENABLED = \"-XX:+UseG1GC\";\n+        for (String opt : jtropts.split(\",\")) {\n+            if (opt.equals(CCP_DISABLED)) {\n+                return false;\n+            }\n+            if (opt.startsWith(GC_PREFIX) && opt.endsWith(GC_SUFFIX) &&\n+                !opt.equals(G1GC_ENABLED)) {\n+                return false;\n+            }\n+        }\n+        return true;\n","filename":"test\/jtreg-ext\/requires\/VMProps.java","additions":28,"deletions":3,"binary":false,"changes":31,"status":"modified"}]}