{"files":[{"patch":"@@ -68,1 +68,2 @@\n-  intptr_t _cloned_vtable[1];\n+  intptr_t _cloned_vtable[1]; \/\/ Pseudo flexible array member.\n+  static size_t cloned_vtable_offset() { return offset_of(CppVtableInfo, _cloned_vtable); }\n@@ -70,3 +71,0 @@\n-  static int num_slots(int vtable_size) {\n-    return 1 + vtable_size; \/\/ Need to add the space occupied by _vtable_size;\n-  }\n@@ -75,2 +73,3 @@\n-  intptr_t* cloned_vtable()   { return &_cloned_vtable[0]; }\n-  void zero()                 { memset(_cloned_vtable, 0, sizeof(intptr_t) * vtable_size()); }\n+  \/\/ Using _cloned_vtable[i] for i > 0 causes undefined behavior. We use address calculation instead.\n+  intptr_t* cloned_vtable()   { return (intptr_t*)((char*)this + cloned_vtable_offset()); }\n+  void zero()                 { memset(cloned_vtable(), 0, sizeof(intptr_t) * vtable_size()); }\n@@ -79,2 +78,1 @@\n-    CppVtableInfo i;\n-    return pointer_delta(&i._cloned_vtable[vtable_size], &i, sizeof(u1));\n+    return cloned_vtable_offset() + (sizeof(intptr_t) * vtable_size);\n","filename":"src\/hotspot\/share\/cds\/cppVtables.cpp","additions":6,"deletions":8,"binary":false,"changes":14,"status":"modified"}]}