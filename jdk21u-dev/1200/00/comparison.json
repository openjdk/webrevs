{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -124,0 +124,3 @@\n+    \/\/ whether to allow legacy mechanisms\n+    private boolean allowLegacy = false;\n+\n@@ -254,0 +257,4 @@\n+    boolean getAllowLegacy() {\n+        return allowLegacy;\n+    }\n+\n@@ -456,0 +463,2 @@\n+            case \"allowLegacy\"->\n+                allowLegacy = parseBooleanEntry(st.sval);\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/Config.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -1215,19 +1215,0 @@\n-    private static boolean isLegacy(CK_MECHANISM_INFO mechInfo)\n-            throws PKCS11Exception {\n-        \/\/ assume full support if no mech info available\n-        \/\/ For vendor-specific mechanisms, often no mech info is provided\n-        boolean partialSupport = false;\n-\n-        if (mechInfo != null) {\n-            if ((mechInfo.flags & CKF_DECRYPT) != 0) {\n-                \/\/ non-legacy cipher mechs should support encryption\n-                partialSupport |= ((mechInfo.flags & CKF_ENCRYPT) == 0);\n-            }\n-            if ((mechInfo.flags & CKF_VERIFY) != 0) {\n-                \/\/ non-legacy signature mechs should support signing\n-                partialSupport |= ((mechInfo.flags & CKF_SIGN) == 0);\n-            }\n-        }\n-        return partialSupport;\n-    }\n-\n@@ -1284,6 +1265,0 @@\n-            if (isLegacy(mechInfo)) {\n-                if (showInfo) {\n-                    System.out.println(\"DISABLED due to legacy\");\n-                }\n-                continue;\n-            }\n@@ -1304,0 +1279,1 @@\n+            boolean allowLegacy = config.getAllowLegacy();\n@@ -1319,0 +1295,15 @@\n+\n+                    \/\/ assume full support if no mech info available\n+                    if (!allowLegacy && mechInfo != null) {\n+                        if ((d.type == CIP &&\n+                                (mechInfo.flags & CKF_ENCRYPT) == 0) ||\n+                                (d.type == SIG &&\n+                                (mechInfo.flags & CKF_SIGN) == 0)) {\n+                            if (showInfo) {\n+                                System.out.println(\"DISABLED \" +  d.type +\n+                                        \" \" + d.algorithm +\n+                                        \" due to partial support\");\n+                            }\n+                            continue;\n+                        }\n+                    }\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/SunPKCS11.java","additions":16,"deletions":25,"binary":false,"changes":41,"status":"modified"}]}