{"files":[{"patch":"@@ -1,1 +1,1 @@\n-## Little Color Management System (LCMS) v2.16\n+## Little Color Management System (LCMS) v2.17\n@@ -8,1 +8,1 @@\n-Copyright (C) 1998-2023 Marti Maria Saguer\n+Copyright (C) 1998-2025 Marti Maria Saguer\n@@ -29,1 +29,1 @@\n-The below license applies to the following files:\n+The below applies to the following file(s):\n@@ -32,1 +32,1 @@\n-Copyright 2001, softSurfer (www.softsurfer.com)\n+Copyright (C) 2001, softSurfer (www.softsurfer.com)\n@@ -102,2 +102,2 @@\n-\n-```\n+Amir Montazery and Open Source Technology Improvement Fund (ostif.org), Google, for fuzzer fundings.\n+```\n\\ No newline at end of file\n","filename":"src\/java.desktop\/share\/legal\/lcms.md","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -615,2 +615,2 @@\n-        cmsUInt32Number SourceStrideIncrement = 0;\n-        cmsUInt32Number DestStrideIncrement = 0;\n+        size_t SourceStrideIncrement = 0;\n+        size_t DestStrideIncrement = 0;\n@@ -643,2 +643,2 @@\n-        cmsUInt32Number SourceStrideIncrements[cmsMAXCHANNELS];\n-        cmsUInt32Number DestStrideIncrements[cmsMAXCHANNELS];\n+        size_t SourceStrideIncrements[cmsMAXCHANNELS];\n+        size_t DestStrideIncrements[cmsMAXCHANNELS];\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsalpha.c","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -120,2 +120,1 @@\n-static\n-cmsFloat64Number computeD(cmsCIECAM02* pMod)\n+static cmsFloat64Number computeD(cmsCIECAM02* pMod)\n@@ -123,1 +122,1 @@\n-    cmsFloat64Number D;\n+    cmsFloat64Number D, temp;\n@@ -125,1 +124,1 @@\n-    D = pMod->F - (1.0\/3.6)*(exp(((-pMod ->LA-42) \/ 92.0)));\n+    temp = 1.0 - ((1.0 \/ 3.6) * exp((-pMod->LA - 42) \/ 92.0));\n@@ -127,0 +126,1 @@\n+    D = pMod->F * temp;\n@@ -130,1 +130,0 @@\n-\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmscam02.c","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -447,0 +447,1 @@\n+    s->begin[0] = 0;\n@@ -450,1 +451,1 @@\n-void StringAppend(string* s, char c)\n+cmsBool StringAppend(string* s, char c)\n@@ -458,0 +459,2 @@\n+        if (new_ptr == NULL) return FALSE;\n+\n@@ -469,0 +472,2 @@\n+\n+    return TRUE;\n@@ -478,1 +483,1 @@\n-void StringCat(string* s, const char* c)\n+cmsBool StringCat(string* s, const char* c)\n@@ -482,1 +487,1 @@\n-        StringAppend(s, *c);\n+        if (!StringAppend(s, *c)) return FALSE;\n@@ -485,0 +490,2 @@\n+\n+    return TRUE;\n@@ -833,1 +840,6 @@\n-                StringAppend(it8->str, (char)it8->ch);\n+                if (!StringAppend(it8->str, (char)it8->ch)) {\n+\n+                    SynError(it8, \"Out of memory\");\n+                    return;\n+                }\n+\n@@ -863,1 +875,5 @@\n-                StringAppend(it8->id, (char) it8->ch);\n+                if (!StringAppend(it8->id, (char)it8->ch)) {\n+\n+                    SynError(it8, \"Out of memory\");\n+                    return;\n+                }\n@@ -907,1 +923,0 @@\n-                                it8->sy = SEOF;\n@@ -929,1 +944,0 @@\n-                                it8->sy = SEOF;\n@@ -982,1 +996,5 @@\n-                    StringCat(it8->id, buffer);\n+                    if (!StringCat(it8->id, buffer)) {\n+\n+                        SynError(it8, \"Out of memory\");\n+                        return;\n+                    }\n@@ -986,1 +1004,5 @@\n-                        StringAppend(it8->id, (char) it8->ch);\n+                        if (!StringAppend(it8->id, (char)it8->ch)) {\n+\n+                            SynError(it8, \"Out of memory\");\n+                            return;\n+                        }\n@@ -1041,1 +1063,0 @@\n-            it8->sy = SEOF;\n@@ -1056,1 +1077,0 @@\n-                    it8->sy = SEOF;\n@@ -1062,2 +1082,0 @@\n-                {\n-                    it8->sy = SEOF;\n@@ -1065,1 +1083,1 @@\n-                }\n+\n@@ -1072,0 +1090,1 @@\n+\n@@ -1073,1 +1092,0 @@\n-                        it8->sy = SEOF;\n@@ -1081,0 +1099,1 @@\n+\n@@ -1082,1 +1101,0 @@\n-                    it8->sy = SEOF;\n@@ -1090,1 +1108,0 @@\n-                        it8->sy = SEOF;\n@@ -1105,4 +1122,4 @@\n-        if (!Check(it8, SEOLN, \"Expected separator\")) return FALSE;\n-        while (it8 -> sy == SEOLN)\n-                        InSymbol(it8);\n-        return TRUE;\n+    if (!Check(it8, SEOLN, \"Expected separator\")) return FALSE;\n+    while (it8->sy == SEOLN)\n+        InSymbol(it8);\n+    return TRUE;\n@@ -1117,2 +1134,2 @@\n-        if (it8->sy == sy && it8->sy != SEOF)\n-                        InSymbol(it8);\n+    if (it8->sy == sy && it8->sy != SEOF && it8->sy != SSYNERROR)\n+        InSymbol(it8);\n@@ -1127,1 +1144,1 @@\n-             InSymbol(it8);\n+        InSymbol(it8);\n@@ -1238,0 +1255,1 @@\n+    if (size == 0) return NULL;\n@@ -1241,0 +1259,2 @@\n+        cmsUInt8Number* new_block;\n+\n@@ -1251,1 +1271,5 @@\n-        it8 ->Allocator.Block = (cmsUInt8Number*) AllocBigBlock(it8, it8 ->Allocator.BlockSize);\n+        new_block = (cmsUInt8Number*)AllocBigBlock(it8, it8->Allocator.BlockSize);\n+        if (new_block == NULL)\n+            return NULL;\n+\n+        it8->Allocator.Block = new_block;\n@@ -1261,1 +1285,0 @@\n-\n@@ -1269,1 +1292,1 @@\n-    cmsUInt32Number Size = (cmsUInt32Number) strlen(str)+1;\n+    cmsUInt32Number Size;\n@@ -1272,0 +1295,3 @@\n+    if (str == NULL) return NULL;\n+\n+    Size = (cmsUInt32Number)strlen(str) + 1;\n@@ -1407,1 +1433,1 @@\n-void AllocTable(cmsIT8* it8)\n+cmsBool AllocTable(cmsIT8* it8)\n@@ -1411,0 +1437,3 @@\n+    if (it8->TablesCount >= (MAXTABLES-1))\n+        return FALSE;\n+\n@@ -1418,0 +1447,1 @@\n+    return TRUE;\n@@ -1429,1 +1459,4 @@\n-             AllocTable(it8);\n+             if (!AllocTable(it8)) {\n+                 SynError(it8, \"Too many tables\");\n+                 return -1;\n+             }\n@@ -1613,2 +1646,2 @@\n-    if (n > 0x7fffffffL) return 0x7fffffffL;\n-    if (n < -0x7ffffffeL) return -0x7ffffffeL;\n+    if (n > 0x7ffffff0L) return 0x7ffffff0L;\n+    if (n < -0x7ffffff0L) return -0x7ffffff0L;\n@@ -1623,0 +1656,2 @@\n+    cmsUInt32Number size;\n+\n@@ -1625,1 +1660,1 @@\n-    if (t -> DataFormat) return TRUE;    \/\/ Already allocated\n+    if (t->DataFormat) return TRUE;    \/\/ Already allocated\n@@ -1627,1 +1662,1 @@\n-    t -> nSamples  = satoi(cmsIT8GetProperty(it8, \"NUMBER_OF_FIELDS\"));\n+    t->nSamples = satoi(cmsIT8GetProperty(it8, \"NUMBER_OF_FIELDS\"));\n@@ -1629,1 +1664,1 @@\n-    if (t -> nSamples <= 0) {\n+    if (t->nSamples <= 0 || t->nSamples > 0x7ffe) {\n@@ -1631,1 +1666,1 @@\n-        SynError(it8, \"AllocateDataFormat: Unknown NUMBER_OF_FIELDS\");\n+        SynError(it8, \"Wrong NUMBER_OF_FIELDS\");\n@@ -1633,1 +1668,3 @@\n-        }\n+    }\n+\n+    size = ((cmsUInt32Number)t->nSamples + 1) * sizeof(char*);\n@@ -1635,1 +1672,1 @@\n-    t -> DataFormat = (char**) AllocChunk (it8, ((cmsUInt32Number) t->nSamples + 1) * sizeof(char *));\n+    t->DataFormat = (char**)AllocChunk(it8, size);\n@@ -1638,1 +1675,1 @@\n-        SynError(it8, \"AllocateDataFormat: Unable to allocate dataFormat array\");\n+        SynError(it8, \"Unable to allocate dataFormat array\");\n@@ -1667,1 +1704,1 @@\n-    if (n > t -> nSamples) {\n+    if (n >= t -> nSamples) {\n@@ -1716,1 +1753,2 @@\n-    if (t -> nSamples < 0 || t->nSamples > 0x7ffe || t->nPatches < 0 || t->nPatches > 0x7ffe)\n+    if (t -> nSamples < 0 || t->nSamples > 0x7ffe || t->nPatches < 0 || t->nPatches > 0x7ffe ||\n+        (t->nPatches * t->nSamples) > 200000)\n@@ -1722,1 +1760,1 @@\n-        \/\/ Some dumb analizers warns of possible overflow here, just take a look couple of lines above.\n+        \/\/ Some dumb analyzers warns of possible overflow here, just take a look couple of lines above.\n@@ -1751,0 +1789,2 @@\n+    char* ptr;\n+\n@@ -1753,0 +1793,1 @@\n+\n@@ -1769,1 +1810,5 @@\n-    t->Data [nSet * t -> nSamples + nField] = AllocString(it8, Val);\n+    ptr = AllocString(it8, Val);\n+    if (ptr == NULL)\n+        return FALSE;\n+\n+    t->Data [nSet * t -> nSamples + nField] = ptr;\n@@ -2124,1 +2169,1 @@\n-    while (it8->sy != SEND_DATA && it8->sy != SEOF)\n+    while (it8->sy != SEND_DATA && it8->sy != SEOF && it8->sy != SSYNERROR)\n@@ -2132,1 +2177,1 @@\n-        if (it8->sy != SEND_DATA && it8->sy != SEOF) {\n+        if (it8->sy != SEND_DATA && it8->sy != SEOF && it8->sy != SSYNERROR) {\n@@ -2228,2 +2273,2 @@\n-                AddToList(it8, &GetTable(it8)->HeaderList, VarName, NULL, Buffer,\n-                    (it8->sy == SSTRING) ? WRITE_STRINGIFY : WRITE_UNCOOKED);\n+                if (AddToList(it8, &GetTable(it8)->HeaderList, VarName, NULL, Buffer,\n+                    (it8->sy == SSTRING) ? WRITE_STRINGIFY : WRITE_UNCOOKED) == NULL) return FALSE;\n@@ -2335,1 +2380,3 @@\n-                    if (it8 -> sy != SEOF) {\n+                    if (it8 -> sy != SEOF && it8->sy != SSYNERROR) {\n+\n+                            if (!AllocTable(it8)) return FALSE;\n@@ -2337,1 +2384,0 @@\n-                            AllocTable(it8);\n@@ -3067,1 +3113,2 @@\n-    while (cube->sy != SEOF) {\n+    while (cube->sy != SEOF && cube->sy != SSYNERROR) {\n+\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmscgats.c","additions":97,"deletions":50,"binary":false,"changes":147,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -753,1 +753,0 @@\n-            cmsGetColorSpace(hProfile) == cmsSigCmykData &&\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmscnvrt.c","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmserr.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsgamma.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2021 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -330,1 +330,1 @@\n-    cmsInt32Number nChannels;\n+    cmsInt32Number nChannels, nInputChannels;\n@@ -332,0 +332,1 @@\n+    cmsColorSpaceSignature InputColorSpace;\n@@ -377,1 +378,0 @@\n-\n@@ -381,1 +381,4 @@\n-    dwFormat    = (CHANNELS_SH(nChannels)|BYTES_SH(2));\n+\n+    InputColorSpace = cmsGetColorSpace(ProfileList[0]);\n+    nInputChannels  = cmsChannelsOfColorSpace(InputColorSpace);\n+    dwFormat        = (CHANNELS_SH(nInputChannels)|BYTES_SH(2));\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsgmt.c","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmshalf.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -527,1 +527,1 @@\n-    x0 = (int) floor(px); fx = px - (cmsFloat32Number) x0;  \/\/ We need full floor funcionality here\n+    x0 = (int) floor(px); fx = px - (cmsFloat32Number) x0;  \/\/ We need full floor functionality here\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsintrp.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -309,0 +309,5 @@\n+        if (Buffer == NULL) {\n+            cmsSignalError(ContextID, cmsERROR_WRITE, \"Couldn't write profile to NULL pointer\");\n+            goto Error;\n+        }\n+\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsio0.c","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsio1.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -1112,1 +1112,1 @@\n-\/\/ Fom XYZ to floating point PCS\n+\/\/ From XYZ to floating point PCS\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmslut.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -283,2 +283,2 @@\n-\/\/ In the header, rendering intentent, attributes and ID should be set to zero\n-\/\/ before computing MD5 checksum (per 6.1.13 in ICC spec)\n+\/\/ In the header, rendering intentent, flags and ID should be set to zero\n+\/\/ before computing MD5 checksum (per 7.2.18 of ICC spec 4.4)\n@@ -302,2 +302,2 @@\n-    \/\/ Set RI, attributes and ID\n-    memset(&Icc ->attributes, 0, sizeof(Icc ->attributes));\n+    \/\/ Set RI, flags and ID\n+    Icc ->flags = 0;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsmd5.c","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsmtrx.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -601,1 +601,1 @@\n-    \/\/ Precess each character\n+    \/\/ Process each character\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsnamed.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsopt.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -220,1 +220,1 @@\n-            alpha_factor = _cmsToFixedDomain(FROM_8_TO_16(accum[(nChan) * Stride]));\n+            alpha_factor = _cmsToFixedDomain(FROM_8_TO_16(accum[nChan * Stride]));\n@@ -609,2 +609,2 @@\n-   cmsUInt16Number alpha = (ExtraFirst ? accum[0] : accum[nChan - 1]);\n-   cmsUInt32Number alpha_factor = _cmsToFixedDomain(FROM_8_TO_16(alpha));\n+   cmsUInt16Number alpha = (ExtraFirst ? ((cmsUInt16Number*)accum)[0] : ((cmsUInt16Number*)accum)[nChan]);\n+   cmsUInt32Number alpha_factor = _cmsToFixedDomain(alpha);\n@@ -694,2 +694,2 @@\n-    cmsUInt16Number  alpha = (ExtraFirst ? accum[0] : accum[(nChan - 1) * Stride]);\n-    cmsUInt32Number alpha_factor = _cmsToFixedDomain(FROM_8_TO_16(alpha));\n+    cmsUInt16Number alpha = (ExtraFirst ? ((cmsUInt16Number*)accum)[0] : ((cmsUInt16Number*)accum)[nChan * Stride \/ 2]);\n+    cmsUInt32Number alpha_factor = _cmsToFixedDomain(alpha);\n@@ -1110,2 +1110,1 @@\n-static\n-cmsUInt32Number PixelSize(cmsUInt32Number Format)\n+cmsINLINE cmsUInt32Number PixelSize(cmsUInt32Number Format)\n@@ -1457,1 +1456,1 @@\n-            alpha_factor = (ExtraFirst ? ptr[0] : ptr[(nChan) * Stride]) \/ maximum;\n+            alpha_factor = (ExtraFirst ? ptr[0] : ptr[nChan * Stride]) \/ maximum;\n@@ -3055,0 +3054,1 @@\n+    Stride \/= 2;\n@@ -3118,1 +3118,1 @@\n-                     ((cmsFloat32Number*)output)[(i + start)* Stride] = (cmsFloat32Number)v;\n+                     ((cmsFloat32Number*)output)[(i + start) * Stride] = (cmsFloat32Number)v;\n@@ -3458,1 +3458,1 @@\n-    Stride \/= PixelSize(info->OutputFormat);\n+    Stride \/= PixelSize(info->InputFormat);\n@@ -4065,0 +4065,3 @@\n+    \/\/ Fix float spaces\n+    nBytes &= 7;\n+\n@@ -4082,0 +4085,3 @@\n+    \/\/ Fix float spaces\n+    nBytes &= 7;\n+\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmspack.c","additions":17,"deletions":11,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmspcs.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -938,1 +938,4 @@\n-    memcpy(&ctx->DefaultMemoryManager, &src->DefaultMemoryManager, sizeof(ctx->DefaultMemoryManager));\n+    if (ContextID == NULL)\n+        _cmsInstallAllocFunctions(NULL, &ctx->DefaultMemoryManager);\n+    else\n+        memcpy(&ctx->DefaultMemoryManager, &src->DefaultMemoryManager, sizeof(ctx->DefaultMemoryManager));\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsplugin.c","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -497,1 +497,1 @@\n-    \/\/ Emit intepolation code\n+    \/\/ Emit interpolation code\n@@ -621,1 +621,1 @@\n-    \/\/ Hadle the parenthesis on rows\n+    \/\/ Handle the parenthesis on rows\n@@ -697,2 +697,4 @@\n-        for (i = 0; i < sc.Pipeline->Params->nInputs; i++)\n-            _cmsIOPrintf(m, \" %d \", sc.Pipeline->Params->nSamples[i]);\n+        for (i = 0; i < sc.Pipeline->Params->nInputs; i++) {\n+            if (i < MAX_INPUT_DIMENSIONS)\n+                _cmsIOPrintf(m, \" %d \", sc.Pipeline->Params->nSamples[i]);\n+        }\n@@ -872,1 +874,1 @@\n-int WriteInputLUT(cmsIOHANDLER* m, cmsHPROFILE hProfile, cmsUInt32Number Intent, cmsUInt32Number dwFlags)\n+cmsBool WriteInputLUT(cmsIOHANDLER* m, cmsHPROFILE hProfile, cmsUInt32Number Intent, cmsUInt32Number dwFlags)\n@@ -878,1 +880,1 @@\n-    int rc;\n+\n@@ -903,1 +905,1 @@\n-        return 0;\n+        return FALSE;\n@@ -922,0 +924,1 @@\n+            cmsBool rc;\n@@ -924,1 +927,4 @@\n-            if (DeviceLink == NULL) return 0;\n+            if (DeviceLink == NULL) {\n+                cmsDeleteTransform(xform);\n+                return FALSE;\n+            }\n@@ -931,1 +937,4 @@\n-            if (rc == 0) return 0;\n+            if (!rc) {\n+                cmsDeleteTransform(xform);\n+                return FALSE;\n+            }\n@@ -937,0 +946,1 @@\n+        cmsDeleteTransform(xform);\n@@ -938,1 +948,1 @@\n-        return 0;\n+        return FALSE;\n@@ -941,1 +951,0 @@\n-\n@@ -943,2 +952,1 @@\n-\n-    return 1;\n+    return TRUE;\n@@ -1287,1 +1295,1 @@\n-int WriteOutputLUT(cmsIOHANDLER* m, cmsHPROFILE hProfile, cmsUInt32Number Intent, cmsUInt32Number dwFlags)\n+cmsBool WriteOutputLUT(cmsIOHANDLER* m, cmsHPROFILE hProfile, cmsUInt32Number Intent, cmsUInt32Number dwFlags)\n@@ -1305,1 +1313,1 @@\n-    if (hLab == NULL) return 0;\n+    if (hLab == NULL) return FALSE;\n@@ -1330,1 +1338,1 @@\n-        return 0;\n+        return FALSE;\n@@ -1338,1 +1346,2 @@\n-        return 0;\n+        cmsSignalError(m->ContextID, cmsERROR_CORRUPTION_DETECTED, \"Cannot access link for CRD\");\n+        return FALSE;\n@@ -1343,1 +1352,6 @@\n-    _cmsOptimizePipeline(m->ContextID, &DeviceLink, RelativeEncodingIntent, &InFrm, &OutputFormat, &dwFlags);\n+    if (!_cmsOptimizePipeline(m->ContextID, &DeviceLink, RelativeEncodingIntent, &InFrm, &OutputFormat, &dwFlags)) {\n+        cmsPipelineFree(DeviceLink);\n+        cmsDeleteTransform(xform);\n+        cmsSignalError(m->ContextID, cmsERROR_CORRUPTION_DETECTED, \"Cannot create CLUT table for CRD\");\n+        return FALSE;\n+    }\n@@ -1348,1 +1362,0 @@\n-\n@@ -1370,0 +1383,7 @@\n+        if (first->Type != cmsSigCLutElemType) {\n+            cmsPipelineFree(DeviceLink);\n+            cmsDeleteTransform(xform);\n+            cmsSignalError(m->ContextID, cmsERROR_CORRUPTION_DETECTED, \"Cannot create CLUT, revise your flags!\");\n+            return FALSE;\n+        }\n+\n@@ -1392,1 +1412,1 @@\n-    return 1;\n+    return TRUE;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsps2.c","additions":41,"deletions":21,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmssamp.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmssm.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -602,0 +602,172 @@\n+\/\/ ********************************************************************************\n+\/\/ Type cmsSigUInt8ArrayType\n+\/\/ ********************************************************************************\n+\/\/ This type represents an array of generic 1-byte\/8-bit quantity.\n+\n+static\n+void* Type_UInt8_Read(struct _cms_typehandler_struct* self, cmsIOHANDLER* io, cmsUInt32Number* nItems, cmsUInt32Number SizeOfTag)\n+{\n+    cmsUInt8Number* array;\n+    cmsUInt32Number i, n;\n+\n+    *nItems = 0;\n+    n = SizeOfTag \/ sizeof(cmsUInt8Number);\n+    array = (cmsUInt8Number*)_cmsCalloc(self->ContextID, n, sizeof(cmsUInt8Number));\n+    if (array == NULL) return NULL;\n+\n+    for (i = 0; i < n; i++) {\n+\n+        if (!_cmsReadUInt8Number(io, &array[i])) {\n+\n+            _cmsFree(self->ContextID, array);\n+            return NULL;\n+        }\n+    }\n+\n+    *nItems = n;\n+    return (void*)array;\n+}\n+\n+static\n+cmsBool Type_UInt8_Write(struct _cms_typehandler_struct* self, cmsIOHANDLER* io, void* Ptr, cmsUInt32Number nItems)\n+{\n+    cmsUInt8Number* Value = (cmsUInt8Number*)Ptr;\n+    cmsUInt32Number i;\n+\n+    for (i = 0; i < nItems; i++) {\n+\n+        if (!_cmsWriteUInt8Number(io, Value[i])) return FALSE;\n+    }\n+\n+    return TRUE;\n+\n+    cmsUNUSED_PARAMETER(self);\n+}\n+\n+static\n+void* Type_UInt8_Dup(struct _cms_typehandler_struct* self, const void* Ptr, cmsUInt32Number n)\n+{\n+    return _cmsDupMem(self->ContextID, Ptr, n * sizeof(cmsUInt8Number));\n+}\n+\n+\n+static\n+void Type_UInt8_Free(struct _cms_typehandler_struct* self, void* Ptr)\n+{\n+    _cmsFree(self->ContextID, Ptr);\n+}\n+\n+\/\/ ********************************************************************************\n+\/\/ Type cmsSigUInt32ArrayType\n+\/\/ ********************************************************************************\n+\/\/ This type represents an array of generic 4-byte\/32-bit quantity.\n+static\n+void* Type_UInt32_Read(struct _cms_typehandler_struct* self, cmsIOHANDLER* io, cmsUInt32Number* nItems, cmsUInt32Number SizeOfTag)\n+{\n+    cmsUInt32Number* array;\n+    cmsUInt32Number i, n;\n+\n+    *nItems = 0;\n+    n = SizeOfTag \/ sizeof(cmsUInt32Number);\n+    array = (cmsUInt32Number*)_cmsCalloc(self->ContextID, n, sizeof(cmsUInt32Number));\n+    if (array == NULL) return NULL;\n+\n+    for (i = 0; i < n; i++) {\n+\n+        if (!_cmsReadUInt32Number(io, &array[i])) {\n+\n+            _cmsFree(self->ContextID, array);\n+            return NULL;\n+        }\n+    }\n+\n+    *nItems = n;\n+    return (void*)array;\n+}\n+\n+static\n+cmsBool Type_UInt32_Write(struct _cms_typehandler_struct* self, cmsIOHANDLER* io, void* Ptr, cmsUInt32Number nItems)\n+{\n+    cmsUInt32Number* Value = (cmsUInt32Number*)Ptr;\n+    cmsUInt32Number i;\n+\n+    for (i = 0; i < nItems; i++) {\n+\n+        if (!_cmsWriteUInt32Number(io, Value[i])) return FALSE;\n+    }\n+\n+    return TRUE;\n+\n+    cmsUNUSED_PARAMETER(self);\n+}\n+\n+static\n+void* Type_UInt32_Dup(struct _cms_typehandler_struct* self, const void* Ptr, cmsUInt32Number n)\n+{\n+    return _cmsDupMem(self->ContextID, Ptr, n * sizeof(cmsUInt32Number));\n+}\n+\n+\n+static\n+void Type_UInt32_Free(struct _cms_typehandler_struct* self, void* Ptr)\n+{\n+    _cmsFree(self->ContextID, Ptr);\n+}\n+\n+\/\/ ********************************************************************************\n+\/\/ Type cmsSigUInt64ArrayType\n+\/\/ ********************************************************************************\n+\/\/ This type represents an array of generic 8-byte\/64-bit quantity.\n+static\n+void* Type_UInt64_Read(struct _cms_typehandler_struct* self, cmsIOHANDLER* io, cmsUInt32Number* nItems, cmsUInt32Number SizeOfTag)\n+{\n+    cmsUInt64Number* array;\n+    cmsUInt32Number i, n;\n+\n+    *nItems = 0;\n+    n = SizeOfTag \/ sizeof(cmsUInt64Number);\n+    array = (cmsUInt64Number*)_cmsCalloc(self->ContextID, n, sizeof(cmsUInt64Number));\n+    if (array == NULL) return NULL;\n+\n+    for (i = 0; i < n; i++) {\n+\n+        if (!_cmsReadUInt64Number(io, &array[i])) {\n+\n+            _cmsFree(self->ContextID, array);\n+            return NULL;\n+        }\n+    }\n+\n+    *nItems = n;\n+    return (void*)array;\n+}\n+\n+static\n+cmsBool Type_UInt64_Write(struct _cms_typehandler_struct* self, cmsIOHANDLER* io, void* Ptr, cmsUInt32Number nItems)\n+{\n+    cmsUInt64Number* Value = (cmsUInt64Number*)Ptr;\n+    cmsUInt32Number i;\n+\n+    for (i = 0; i < nItems; i++) {\n+\n+        if (!_cmsWriteUInt64Number(io, &Value[i])) return FALSE;\n+    }\n+\n+    return TRUE;\n+\n+    cmsUNUSED_PARAMETER(self);\n+}\n+\n+static\n+void* Type_UInt64_Dup(struct _cms_typehandler_struct* self, const void* Ptr, cmsUInt32Number n)\n+{\n+    return _cmsDupMem(self->ContextID, Ptr, n * sizeof(cmsUInt64Number));\n+}\n+\n+\n+static\n+void Type_UInt64_Free(struct _cms_typehandler_struct* self, void* Ptr)\n+{\n+    _cmsFree(self->ContextID, Ptr);\n+}\n+\n@@ -971,0 +1143,2 @@\n+    if (AsciiCount > 0x7ffff) return NULL;\n+\n@@ -1002,1 +1176,2 @@\n-    if (UnicodeCount == 0 || SizeOfTag < UnicodeCount*sizeof(cmsUInt16Number)) goto Done;\n+    if (UnicodeCount == 0 || UnicodeCount > 0x7ffff ||\n+        SizeOfTag < UnicodeCount*sizeof(cmsUInt16Number)) goto Done;\n@@ -1132,1 +1307,1 @@\n-    if(len_aligned - len_tag_requirement > 0)\n+    if (len_aligned > len_tag_requirement)\n@@ -5194,1 +5369,1 @@\n-\n+      if (nChars > 0x7ffff) return FALSE;\n@@ -5775,1 +5950,4 @@\n-{TYPE_HANDLER(cmsSigMHC2Type,                  MHC2),                NULL }\n+{TYPE_HANDLER(cmsSigMHC2Type,                  MHC2),               (_cmsTagTypeLinkedList*) &SupportedTagTypes[33] },\n+{TYPE_HANDLER(cmsSigUInt8ArrayType,            UInt8),              (_cmsTagTypeLinkedList*) &SupportedTagTypes[34] },\n+{TYPE_HANDLER(cmsSigUInt32ArrayType,           UInt32),             (_cmsTagTypeLinkedList*) &SupportedTagTypes[35] },\n+{TYPE_HANDLER(cmsSigUInt64ArrayType,           UInt64),             NULL }\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmstypes.c","additions":183,"deletions":5,"binary":false,"changes":188,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -415,1 +415,1 @@\n-    Out[3] = In[3];                                 \/\/ K (untouched)\n+    Out[3] = In[3];                                    \/\/ K (untouched)\n@@ -436,1 +436,1 @@\n-    if (Limit < 0.0 || Limit > 400) {\n+    if (Limit < 1.0 || Limit > 400) {\n@@ -708,1 +708,1 @@\n-cmsHPROFILE cmsCreate_OkLabProfile(cmsContext ctx)\n+cmsHPROFILE CMSEXPORT cmsCreate_OkLabProfile(cmsContext ctx)\n@@ -777,0 +777,2 @@\n+    if (!hProfile)            \/\/ can't allocate\n+        goto error;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsvirt.c","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmswtpnt.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -298,1 +298,1 @@\n-    cmsUInt32Number i, j, c, strideIn, strideOut;\n+    size_t i, j, c, strideIn, strideOut;\n@@ -325,0 +325,2 @@\n+                    _cmsAlarmCodesChunkType* ContextAlarmCodes = (_cmsAlarmCodesChunkType*)_cmsContextGetClientChunk(p->ContextID, AlarmCodesContext);\n+\n@@ -327,1 +329,1 @@\n-                        fOut[c] = -1.0;\n+                        fOut[c] = ContextAlarmCodes->AlarmCodes[c] \/ 65535.0F;\n@@ -364,1 +366,1 @@\n-    cmsUInt32Number i, j, strideIn, strideOut;\n+    size_t i, j, strideIn, strideOut;\n@@ -402,1 +404,1 @@\n-    cmsUInt32Number i, j, strideIn, strideOut;\n+    size_t i, j, strideIn, strideOut;\n@@ -412,2 +414,2 @@\n-           accum = (cmsUInt8Number*)in + strideIn;\n-           output = (cmsUInt8Number*)out + strideOut;\n+        accum = (cmsUInt8Number*)in + strideIn;\n+        output = (cmsUInt8Number*)out + strideOut;\n@@ -415,1 +417,1 @@\n-           for (j = 0; j < PixelsPerLine; j++) {\n+        for (j = 0; j < PixelsPerLine; j++) {\n@@ -417,3 +419,3 @@\n-                  accum = p->FromInput(p, wIn, accum, Stride->BytesPerPlaneIn);\n-                  output = p->ToOutput(p, wIn, output, Stride->BytesPerPlaneOut);\n-    }\n+            accum = p->FromInput(p, wIn, accum, Stride->BytesPerPlaneIn);\n+            output = p->ToOutput(p, wIn, output, Stride->BytesPerPlaneOut);\n+        }\n@@ -421,2 +423,2 @@\n-           strideIn += Stride->BytesPerLineIn;\n-           strideOut += Stride->BytesPerLineOut;\n+        strideIn += Stride->BytesPerLineIn;\n+        strideOut += Stride->BytesPerLineOut;\n@@ -440,1 +442,1 @@\n-    cmsUInt32Number i, j, strideIn, strideOut;\n+    size_t i, j, strideIn, strideOut;\n@@ -503,1 +505,1 @@\n-    cmsUInt32Number i, j, strideIn, strideOut;\n+    size_t i, j, strideIn, strideOut;\n@@ -514,2 +516,2 @@\n-           accum = (cmsUInt8Number*)in + strideIn;\n-           output = (cmsUInt8Number*)out + strideOut;\n+        accum = (cmsUInt8Number*)in + strideIn;\n+        output = (cmsUInt8Number*)out + strideOut;\n@@ -517,1 +519,1 @@\n-           for (j = 0; j < PixelsPerLine; j++) {\n+        for (j = 0; j < PixelsPerLine; j++) {\n@@ -519,4 +521,4 @@\n-                  accum = p->FromInput(p, wIn, accum, Stride->BytesPerPlaneIn);\n-                  TransformOnePixelWithGamutCheck(p, wIn, wOut);\n-                  output = p->ToOutput(p, wOut, output, Stride->BytesPerPlaneOut);\n-           }\n+            accum = p->FromInput(p, wIn, accum, Stride->BytesPerPlaneIn);\n+            TransformOnePixelWithGamutCheck(p, wIn, wOut);\n+            output = p->ToOutput(p, wOut, output, Stride->BytesPerPlaneOut);\n+        }\n@@ -524,2 +526,2 @@\n-           strideIn += Stride->BytesPerLineIn;\n-           strideOut += Stride->BytesPerLineOut;\n+        strideIn += Stride->BytesPerLineIn;\n+        strideOut += Stride->BytesPerLineOut;\n@@ -543,1 +545,1 @@\n-    cmsUInt32Number i, j, strideIn, strideOut;\n+    size_t i, j, strideIn, strideOut;\n@@ -598,1 +600,1 @@\n-    cmsUInt32Number i, j, strideIn, strideOut;\n+    size_t i, j, strideIn, strideOut;\n@@ -715,1 +717,1 @@\n-       cmsUInt32Number i, strideIn, strideOut;\n+       size_t i, strideIn, strideOut;\n@@ -1102,1 +1104,1 @@\n-    if (Space1 == PT_ANY) return TRUE;\n+    if (Space1 == PT_ANY) return (T_CHANNELS(dwFormat) == cmsChannelsOf(Check));\n@@ -1163,1 +1165,9 @@\n-    cmsUInt32Number LastIntent = Intents[nProfiles-1];\n+    cmsUInt32Number LastIntent;\n+\n+    \/\/ Safeguard\n+    if (nProfiles <= 0 || nProfiles > 255) {\n+        cmsSignalError(ContextID, cmsERROR_RANGE, \"Wrong number of profiles. 1..255 expected, %d found.\", nProfiles);\n+        return NULL;\n+    }\n+\n+    LastIntent = Intents[nProfiles - 1];\n","filename":"src\/java.desktop\/share\/native\/liblcms\/cmsxform.c","additions":39,"deletions":29,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2025 Marti Maria Saguer\n@@ -55,1 +55,1 @@\n-\/\/ Version 2.16\n+\/\/ Version 2.17\n@@ -96,0 +96,3 @@\n+\/\/ Uncomment this to remove visibility attribute when building shared objects\n+\/\/ #define CMS_NO_VISIBILITY 1\n+\n@@ -116,1 +119,1 @@\n-#define LCMS_VERSION        2160\n+#define LCMS_VERSION        2170\n@@ -280,1 +283,1 @@\n-#  ifdef HAVE_FUNC_ATTRIBUTE_VISIBILITY\n+#  if defined(HAVE_FUNC_ATTRIBUTE_VISIBILITY) && !defined(CMS_NO_VISIBILITY)\n@@ -990,1 +993,0 @@\n-#define TYPE_RGBA_HALF_FLT    (FLOAT_SH(1)|COLORSPACE_SH(PT_RGB)|EXTRA_SH(1)|CHANNELS_SH(3)|BYTES_SH(2))\n","filename":"src\/java.desktop\/share\/native\/liblcms\/lcms2.h","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+\n@@ -32,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n@@ -470,1 +471,1 @@\n-\/\/ Paralellization\n+\/\/ Parallelization\n@@ -1003,1 +1004,1 @@\n-\/\/ after the profile. I.e, BPC[0] refers to connexion between profile(0) and profile(1)\n+\/\/ after the profile. I.e, BPC[0] refers to connetion between profile(0) and profile(1)\n","filename":"src\/java.desktop\/share\/native\/liblcms\/lcms2_internal.h","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-\/\/  Copyright (c) 1998-2023 Marti Maria Saguer\n+\/\/  Copyright (c) 1998-2024 Marti Maria Saguer\n","filename":"src\/java.desktop\/share\/native\/liblcms\/lcms2_plugin.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}