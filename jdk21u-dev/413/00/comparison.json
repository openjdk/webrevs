{"files":[{"patch":"@@ -30,0 +30,1 @@\n+import java.util.Locale;\n@@ -226,0 +227,33 @@\n+\n+    \/**\n+     * Convenience method for fetching System property values that are booleans.\n+     *\n+     * @param prop the name of the System property\n+     * @param def a default value\n+     * @param dbg a Debug object, if null no debug messages will be sent\n+     *\n+     * @return a boolean value corresponding to the value in the System property.\n+     *      If the property value is neither \"true\" or \"false\", the default value\n+     *      will be returned.\n+     *\/\n+    public static boolean privilegedGetBooleanProp(String prop, boolean def, Debug dbg) {\n+        String rawPropVal = privilegedGetProperty(prop, \"\");\n+        if (\"\".equals(rawPropVal)) {\n+            return def;\n+        }\n+\n+        String lower = rawPropVal.toLowerCase(Locale.ROOT);\n+        if (\"true\".equals(lower)) {\n+            return true;\n+        } else if (\"false\".equals(lower)) {\n+            return false;\n+        } else {\n+            if (dbg != null) {\n+                dbg.println(\"Warning: Unexpected value for \" + prop +\n+                            \": \" + rawPropVal +\n+                            \". Using default value: \" + def);\n+            }\n+            return def;\n+        }\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/sun\/security\/action\/GetPropertyAction.java","additions":34,"deletions":0,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -88,0 +88,22 @@\n+    \/**\n+     * Boolean value indicating whether OCSP client can use GET for OCSP\n+     * requests. There is an ambiguity in RFC recommendations.\n+     *\n+     * RFC 5019 says a stronger thing, \"MUST\":\n+     *    \"When sending requests that are less than or equal to 255 bytes in\n+     *     total (after encoding) including the scheme and delimiters (http:\/\/),\n+     *     server name and base64-encoded OCSPRequest structure, clients MUST\n+     *     use the GET method (to enable OCSP response caching).\"\n+     *\n+     * RFC 6960 says a weaker thing, \"MAY\":\n+     *    \"HTTP-based OCSP requests can use either the GET or the POST method to\n+     *     submit their requests.  To enable HTTP caching, small requests (that\n+     *     after encoding are less than 255 bytes) MAY be submitted using GET.\"\n+     *\n+     * For performance reasons, we default to stronger behavior. But this\n+     * option also allows to fallback to weaker behavior in case of compatibility\n+     * problems.\n+     *\/\n+    private static final boolean USE_GET = initializeBoolean(\n+            \"com.sun.security.ocsp.useget\", true);\n+\n@@ -102,0 +124,9 @@\n+    private static boolean initializeBoolean(String prop, boolean def) {\n+        boolean value =\n+                GetPropertyAction.privilegedGetBooleanProp(prop, def, debug);\n+        if (debug != null) {\n+            debug.println(prop + \" set to \" + value);\n+        }\n+        return value;\n+    }\n+\n@@ -189,1 +220,1 @@\n-            if (encodedGetReq.length() <= 255) {\n+            if (USE_GET && encodedGetReq.length() <= 255) {\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/certpath\/OCSP.java","additions":33,"deletions":2,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8179503\n+ * @bug 8179503 8328638\n@@ -34,0 +34,2 @@\n+ * @run main\/othervm -Dcom.sun.security.ocsp.useget=false GetAndPostTests\n+ * @run main\/othervm -Dcom.sun.security.ocsp.useget=foo GetAndPostTests\n","filename":"test\/jdk\/java\/security\/cert\/CertPathValidator\/OCSP\/GetAndPostTests.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -707,0 +707,3 @@\n+        private final boolean USE_GET =\n+            !System.getProperty(\"com.sun.security.ocsp.useget\", \"\").equals(\"false\");\n+\n@@ -879,0 +882,6 @@\n+                if (USE_GET && length <= 255) {\n+                    \/\/ Received a small POST request. Check that our client code properly\n+                    \/\/ handled the relevant flag. We expect small GET requests, unless\n+                    \/\/ explicitly disabled.\n+                    throw new IOException(\"Should have received small GET, not POST.\");\n+                }\n","filename":"test\/jdk\/java\/security\/testlibrary\/SimpleOCSPServer.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -33,0 +33,3 @@\n+ *  -Dcom.sun.security.ocsp.useget=false\n+ *  CAInterop actalisauthenticationrootca OCSP\n+ * @run main\/othervm\/timeout=180 -Djava.security.debug=certpath,ocsp\n@@ -43,0 +46,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop amazonrootca1 OCSP\n@@ -53,0 +57,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop amazonrootca2 OCSP\n@@ -63,0 +68,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop amazonrootca3 OCSP\n@@ -73,0 +79,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop amazonrootca4 OCSP\n@@ -83,0 +90,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop buypassclass2ca OCSP\n@@ -93,0 +101,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop buypassclass3ca OCSP\n@@ -103,0 +112,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop comodorsaca OCSP\n@@ -113,0 +123,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop comodoeccca OCSP\n@@ -123,0 +134,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop usertrustrsaca OCSP\n@@ -133,0 +145,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop usertrusteccca OCSP\n@@ -143,0 +156,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop letsencryptisrgx1 DEFAULT\n@@ -152,0 +166,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop letsencryptisrgx2 DEFAULT\n@@ -161,0 +176,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop globalsignrootcar6 OCSP\n@@ -171,0 +187,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop entrustrootcaec1 OCSP\n@@ -181,0 +198,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop entrustrootcag4 OCSP\n@@ -191,0 +209,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop godaddyrootg2ca OCSP\n@@ -201,0 +220,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop starfieldrootg2ca OCSP\n@@ -211,0 +231,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop globalsigneccrootcar4 DEFAULT\n@@ -220,0 +241,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop gtsrootcar1 DEFAULT\n@@ -229,0 +251,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop gtsrootcar2 DEFAULT\n@@ -238,0 +261,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop gtsrootecccar3 DEFAULT\n@@ -246,0 +270,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop gtsrootecccar4 DEFAULT\n@@ -256,0 +281,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop microsoftecc2017 OCSP\n@@ -266,0 +292,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop microsoftrsa2017 OCSP\n@@ -276,0 +303,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop quovadisrootca1g3 OCSP\n@@ -286,0 +314,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop quovadisrootca2g3 OCSP\n@@ -296,0 +325,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop quovadisrootca3g3 OCSP\n@@ -306,0 +336,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop digicerttlseccrootg5 OCSP\n@@ -316,0 +347,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop digicerttlsrsarootg5 OCSP\n@@ -326,0 +358,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop sslrootrsaca OCSP\n@@ -336,0 +369,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop sslrootevrsaca OCSP\n@@ -346,0 +380,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop sslrooteccca OCSP\n@@ -356,0 +391,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop teliasonerarootcav1 OCSP\n@@ -366,0 +402,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop twcaglobalrootca OCSP\n@@ -376,0 +413,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop certignarootca OCSP\n@@ -386,0 +424,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop affirmtrustcommercialca OCSP\n@@ -396,0 +435,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop affirmtrustnetworkingca OCSP\n@@ -406,0 +446,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop affirmtrustpremiumca OCSP\n@@ -416,0 +457,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop affirmtrustpremiumeccca OCSP\n@@ -426,0 +468,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop teliarootcav2 OCSP\n@@ -436,0 +479,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop emsignrootcag1 OCSP\n@@ -446,0 +490,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop emsigneccrootcag3 OCSP\n@@ -456,0 +501,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop certainlyrootr1 DEFAULT\n@@ -465,0 +511,1 @@\n+ * @run main\/othervm -Djava.security.debug=certpath,ocsp -Dcom.sun.security.ocsp.useget=false CAInterop certainlyroote1 DEFAULT\n","filename":"test\/jdk\/security\/infra\/java\/security\/cert\/CertPathValidator\/certification\/CAInterop.java","additions":47,"deletions":0,"binary":false,"changes":47,"status":"modified"}]}