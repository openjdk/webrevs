{"files":[{"patch":"@@ -1092,1 +1092,4 @@\n-                    pt == null || (isLambdaOrMemberRef && !types.isFunctionalInterface(pt));\n+                    pt == null ||\n+                            ((dt instanceof ArgumentAttr.ArgumentType<?> at) &&\n+                            at.speculativeTypes.values().stream().allMatch(type -> type.hasTag(ERROR))) ||\n+                            (isLambdaOrMemberRef && !types.isFunctionalInterface(pt));\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/DeferredAttr.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -0,0 +1,29 @@\n+\/**\n+ * @test \/nodynamiccopyright\/\n+ * @bug 8320948\n+ * @summary NPE due to unreported compiler error\n+ * @compile\/fail\/ref=CrashDueToUnreportedError.out -XDrawDiagnostics CrashDueToUnreportedError.java\n+ *\/\n+\n+import java.util.List;\n+\n+public class CrashDueToUnreportedError {\n+    class Builder {\n+        private Builder(Person person, String unused) {}\n+        public Builder withTypes(Entity<String> entities) {\n+            return new Builder(Person.make(Entity.combineAll(entities)));\n+        }\n+    }\n+\n+    interface Person {\n+        static <E> Person make(List<? extends Entity<E>> eventSubtypes) {\n+            return null;\n+        }\n+    }\n+\n+    class Entity<E> {\n+        public static <Root> List<? extends Entity<Root>> combineAll(Entity<Root> subtypes) {\n+            return null;\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/recovery\/CrashDueToUnreportedError.java","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"},{"patch":"@@ -0,0 +1,2 @@\n+CrashDueToUnreportedError.java:14:43: compiler.err.prob.found.req: (compiler.misc.infer.no.conforming.assignment.exists: E,compiler.misc.type.captureof: 1, ? extends CrashDueToUnreportedError.Entity<Root>,Root, (compiler.misc.inconvertible.types: java.util.List<compiler.misc.type.captureof: 2, ? extends CrashDueToUnreportedError.Entity<Root>>, java.util.List<? extends CrashDueToUnreportedError.Entity<java.lang.Object>>))\n+1 error\n","filename":"test\/langtools\/tools\/javac\/recovery\/CrashDueToUnreportedError.out","additions":2,"deletions":0,"binary":false,"changes":2,"status":"added"}]}