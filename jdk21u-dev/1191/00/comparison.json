{"files":[{"patch":"@@ -2762,0 +2762,6 @@\n+#ifdef ASSERT\n+  \/\/ Check that unlocked label is reached with flag == EQ.\n+  Label flag_correct;\n+  beq(flag, flag_correct);\n+  stop(\"compiler_fast_lock_object: Flag != EQ\");\n+#endif\n@@ -2763,0 +2769,6 @@\n+#ifdef ASSERT\n+  \/\/ Check that slow_path label is reached with flag == NE.\n+  bne(flag, flag_correct);\n+  stop(\"compiler_fast_lock_object: Flag != NE\");\n+  bind(flag_correct);\n+#endif\n@@ -2830,1 +2842,4 @@\n-  ld(temp,             in_bytes(ObjectMonitor::owner_offset()), current_header);\n+\n+  if ((LockingMode == LM_LIGHTWEIGHT) || use_rtm) {\n+    ld(temp,             in_bytes(ObjectMonitor::owner_offset()), current_header);\n+  }\n@@ -2845,4 +2860,6 @@\n-  \/\/ In case of LM_LIGHTWEIGHT, we may reach here with (temp & ObjectMonitor::ANONYMOUS_OWNER) != 0.\n-  \/\/ This is handled like owner thread mismatches: We take the slow path.\n-  cmpd(flag, temp, R16_thread);\n-  bne(flag, failure);\n+  if (LockingMode == LM_LIGHTWEIGHT) {\n+    \/\/ In case of LM_LIGHTWEIGHT, we may reach here with (temp & ObjectMonitor::ANONYMOUS_OWNER) != 0.\n+    \/\/ This is handled like owner thread mismatches: We take the slow path.\n+    cmpd(flag, temp, R16_thread);\n+    bne(flag, failure);\n+  }\n@@ -2851,1 +2868,0 @@\n-\n@@ -2854,0 +2870,2 @@\n+\n+  \/\/ Recursive unlock\n@@ -2873,0 +2891,6 @@\n+#ifdef ASSERT\n+  \/\/ Check that unlocked label is reached with flag == EQ.\n+  Label flag_correct;\n+  beq(flag, flag_correct);\n+  stop(\"compiler_fast_unlock_object: Flag != EQ\");\n+#endif\n@@ -2874,0 +2898,6 @@\n+#ifdef ASSERT\n+  \/\/ Check that slow_path label is reached with flag == NE.\n+  bne(flag, flag_correct);\n+  stop(\"compiler_fast_unlock_object: Flag != NE\");\n+  bind(flag_correct);\n+#endif\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.cpp","additions":36,"deletions":6,"binary":false,"changes":42,"status":"modified"}]}