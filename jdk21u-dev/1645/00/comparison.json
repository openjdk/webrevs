{"files":[{"patch":"@@ -77,0 +77,1 @@\n+static int waitSuspended(const char* kind);\n@@ -128,1 +129,1 @@\n-            \/* check if all threads suspended on THREAD_START events *\/\n+            \/* check if all THREAD_START events are generated *\/\n@@ -136,0 +137,5 @@\n+            \/* wait until all threads are suspended *\/\n+            if (!NSK_VERIFY(waitSuspended(\"starting\"))) {\n+                return;\n+            }\n+\n@@ -178,1 +184,1 @@\n-            \/* check ia all threads suspended on THREAD_END event *\/\n+            \/* check if all THREAD_END event are generated *\/\n@@ -186,0 +192,5 @@\n+            \/* wait until all threads are suspended *\/\n+            if (!NSK_VERIFY(waitSuspended(\"finishing\"))) {\n+                return;\n+            }\n+\n@@ -213,0 +224,25 @@\n+static int waitSuspended(const char* kind) {\n+    NSK_DISPLAY1(\"Wait for %s threads to be suspended\\n\", kind);\n+    for (int i = 0; i < THREADS_COUNT; i++) {\n+        for (int j = 0; j * TIMEOUT_DELTA < timeout; j++) {\n+            jint state = 0;\n+            if (!NSK_JVMTI_VERIFY(jvmti->GetThreadState(threadsList[i], &state))) {\n+                nsk_jvmti_setFailStatus();\n+                break;\n+            }\n+            if ((state & JVMTI_THREAD_STATE_ALIVE) == 0) {\n+                NSK_COMPLAIN3(\"%s thread %s is not alive: %x\\n\", kind, threadsName[i], (int)state);\n+                nsk_jvmti_setFailStatus();\n+                break;\n+            }\n+            if ((state & JVMTI_THREAD_STATE_SUSPENDED) != 0) {\n+                NSK_DISPLAY2(\"  OK: %s thread %s is suspended\\n\", kind, threadsName[i]);\n+                break;\n+            }\n+            NSK_DISPLAY2(\"  %s thread %s is not suspended, waiting\\n\", kind, threadsName[i]);\n+            nsk_jvmti_sleep(TIMEOUT_DELTA);\n+        }\n+    }\n+    return NSK_TRUE;  \/\/ continue execution\n+}\n+\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/scenarios\/sampling\/SP05\/sp05t003\/sp05t003.cpp","additions":38,"deletions":2,"binary":false,"changes":40,"status":"modified"}]}