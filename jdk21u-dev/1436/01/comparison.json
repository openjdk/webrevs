{"files":[{"patch":"@@ -26,1 +26,1 @@\n- * @bug 4269775\n+ * @bug 4269775 8341535\n@@ -49,0 +49,2 @@\n+import javax.imageio.ImageIO;\n+import java.io.File;\n@@ -108,1 +110,5 @@\n-    static void compare(BufferedImage bi1, BufferedImage bi2) {\n+    static void compare(BufferedImage bi1, String name1, BufferedImage bi2, String name2) throws Exception {\n+        int nonWhite1 = 0;\n+        int nonWhite2 = 0;\n+        int differences = 0;\n+        int whitePixel = Color.white.getRGB();\n@@ -111,0 +117,4 @@\n+                int pix1 = bi1.getRGB(x, y);\n+                int pix2 = bi2.getRGB(x, y);\n+                if (pix1 != whitePixel) { nonWhite1++; }\n+                if (pix2 != whitePixel) { nonWhite2++; }\n@@ -112,1 +122,1 @@\n-                    throw new RuntimeException(\"Different rendering\");\n+                    differences++;\n@@ -116,0 +126,9 @@\n+        int nonWhite = (nonWhite1 < nonWhite2) ? nonWhite1 : nonWhite2;\n+        if (differences > 0 && ((nonWhite \/ differences) < 20)) {\n+             ImageIO.write(bi1, \"png\", new File(name1 + \".png\"));\n+             ImageIO.write(bi2, \"png\", new File(name2 + \".png\"));\n+             System.err.println(\"nonWhite image 1 = \" + nonWhite1);\n+             System.err.println(\"nonWhite image 2 = \" + nonWhite2);\n+             System.err.println(\"Number of non-white differing pixels=\" + differences);\n+             throw new RuntimeException(\"Different rendering: \" + differences + \" pixels differ.\");\n+        }\n@@ -118,1 +137,1 @@\n-    public static void main(String args[]) {\n+    public static void main(String args[]) throws Exception {\n@@ -151,3 +170,2 @@\n-\n-      compare(tl_Image, st_Image);\n-      compare(gv_Image, st_Image);\n+      compare(tl_Image, \"textlayout\", st_Image, \"string\");\n+      compare(gv_Image, \"glyphvector\", st_Image, \"string\");\n","filename":"test\/jdk\/sun\/awt\/font\/TestDevTransform.java","additions":25,"deletions":7,"binary":false,"changes":32,"status":"modified"}]}