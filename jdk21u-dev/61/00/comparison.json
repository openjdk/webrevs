{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -75,6 +75,0 @@\n-    @Override\n-    public void onDebuggeeError(String message) {\n-        System.err.println(\"Debuggee error: '\" + message + \"'\");\n-        System.exit(1);\n-    }\n-\n","filename":"test\/hotspot\/jtreg\/serviceability\/jdwp\/AllModulesCommandTest.java","additions":1,"deletions":7,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,0 @@\n-import jdk.test.lib.JDKToolFinder;\n@@ -28,0 +27,1 @@\n+import jdk.test.lib.process.ProcessTools;\n@@ -48,6 +48,0 @@\n-        \/**\n-         * Callback to handle any debuggee error\n-         *\n-         * @param line line from the debuggee's stderr\n-         *\/\n-        void onDebuggeeError(String line);\n@@ -57,1 +51,0 @@\n-    private static final String CLS_DIR = System.getProperty(\"test.classes\", \"\").trim();\n@@ -59,0 +52,2 @@\n+    private static final String JDWP_OPT = \"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=0\";\n+\n@@ -61,2 +56,0 @@\n-    private StreamHandler inputHandler;\n-    private StreamHandler errorHandler;\n@@ -73,1 +66,1 @@\n-     * debuggee's stdout and stderr outputs\n+     * debuggee's stdout output. stderr might contain jvm output, which is just printed to the log.\n@@ -79,1 +72,1 @@\n-        ProcessBuilder pb = new ProcessBuilder(getCommand());\n+        ProcessBuilder pb = ProcessTools.createTestJvm(JDWP_OPT, DEBUGGEE);\n@@ -81,2 +74,2 @@\n-        inputHandler = new StreamHandler(p.getInputStream(), this);\n-        errorHandler = new StreamHandler(p.getErrorStream(), this);\n+        StreamHandler inputHandler = new StreamHandler(p.getInputStream(), this);\n+        StreamHandler errorHandler = new StreamHandler(p.getErrorStream(), l -> System.out.println(\"[stderr]: \" + l));\n@@ -87,16 +80,0 @@\n-    \/**\n-     * Command to start the debuggee with the JDWP options and using the JDK\n-     * under test\n-     *\n-     * @return the command\n-     *\/\n-    private String[] getCommand() {\n-        return new String[]{\n-            JDKToolFinder.getTestJDKTool(\"java\"),\n-            getJdwpOptions(),\n-            \"-cp\",\n-            CLS_DIR,\n-            DEBUGGEE\n-        };\n-    }\n-\n@@ -112,9 +89,0 @@\n-    \/**\n-     * Debuggee JDWP options\n-     *\n-     * @return the JDWP options to start the debuggee with\n-     *\/\n-    private static String getJdwpOptions() {\n-        return \"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=0\";\n-    }\n-\n@@ -132,10 +100,2 @@\n-    public void onStringRead(StreamHandler handler, String line) {\n-        if (handler.equals(errorHandler)) {\n-            terminateDebuggee();\n-            listener.onDebuggeeError(line);\n-        } else {\n-            processDebuggeeOutput(line);\n-        }\n-    }\n-\n-    private void processDebuggeeOutput(String line) {\n+    public void onStringRead(String line) {\n+        System.out.println(\"[stdout]: \" + line);\n","filename":"test\/hotspot\/jtreg\/serviceability\/jdwp\/DebuggeeLauncher.java","additions":10,"deletions":50,"binary":false,"changes":60,"status":"modified"},{"patch":"@@ -40,1 +40,0 @@\n-         * @param handler this StreamHandler\n@@ -43,1 +42,1 @@\n-        void onStringRead(StreamHandler handler, String s);\n+        void onStringRead(String s);\n@@ -74,1 +73,1 @@\n-                listener.onStringRead(this, line);\n+                listener.onStringRead(line);\n","filename":"test\/hotspot\/jtreg\/serviceability\/jdwp\/StreamHandler.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"}]}