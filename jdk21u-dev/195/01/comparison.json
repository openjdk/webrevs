{"files":[{"patch":"@@ -392,0 +392,4 @@\n+                    \/\/ if the exception is thrown before connecting to the\n+                    \/\/ server, the test will time out and the exception will\n+                    \/\/ be lost\/hidden.\n+                    e.printStackTrace(System.err);\n","filename":"test\/jdk\/sun\/security\/pkcs11\/KeyStore\/ClientAuth.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -58,0 +58,3 @@\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.stream.Collectors;\n@@ -62,0 +65,1 @@\n+import jdk.test.lib.Platform;\n@@ -82,0 +86,5 @@\n+    \/\/ Version of the NSS artifact. This coincides with the version of\n+    \/\/ the NSS version\n+    private static final String NSS_BUNDLE_VERSION = \"3.91\";\n+    private static final String NSSLIB = \"jpg.tests.jdk.nsslib\";\n+\n@@ -810,3 +819,0 @@\n-            case \"Windows-x86-32\":\n-                return fetchNssLib(WINDOWS_X86.class);\n-\n@@ -819,0 +825,3 @@\n+            case \"MacOSX-aarch64-64\":\n+                return fetchNssLib(MACOSX_AARCH64.class);\n+\n@@ -820,1 +829,5 @@\n-                return fetchNssLib(LINUX_X64.class);\n+                if (Platform.isOracleLinux7()) {\n+                    throw new SkippedException(\"Skipping Oracle Linux prior to v8\");\n+                } else {\n+                    return fetchNssLib(LINUX_X64.class);\n+                }\n@@ -822,0 +835,6 @@\n+            case \"Linux-aarch64-64\":\n+                if (Platform.isOracleLinux7()) {\n+                    throw new SkippedException(\"Skipping Oracle Linux prior to v8\");\n+                } else {\n+                    return fetchNssLib(LINUX_AARCH64.class);\n+                }\n@@ -831,2 +850,2 @@\n-                    .findAny().get().getValue() + File.separator + \"nsslib\"\n-                    + File.separator;\n+                    .findAny().get().getValue() + File.separator + \"nss\"\n+                    + File.separator + \"lib\" + File.separator;\n@@ -934,1 +953,1 @@\n-            organization = \"jpg.tests.jdk.nsslib\",\n+            organization = NSSLIB,\n@@ -936,1 +955,1 @@\n-            revision = \"3.46-VS2017\",\n+            revision = NSS_BUNDLE_VERSION,\n@@ -942,3 +961,3 @@\n-            organization = \"jpg.tests.jdk.nsslib\",\n-            name = \"nsslib-windows_x86\",\n-            revision = \"3.46-VS2017\",\n+            organization = NSSLIB,\n+            name = \"nsslib-macosx_x64\",\n+            revision = NSS_BUNDLE_VERSION,\n@@ -946,1 +965,1 @@\n-    private static class WINDOWS_X86 {\n+    private static class MACOSX_X64 {\n@@ -950,3 +969,3 @@\n-            organization = \"jpg.tests.jdk.nsslib\",\n-            name = \"nsslib-macosx_x64\",\n-            revision = \"3.46\",\n+            organization = NSSLIB,\n+            name = \"nsslib-macosx_aarch64\",\n+            revision = NSS_BUNDLE_VERSION,\n@@ -954,1 +973,1 @@\n-    private static class MACOSX_X64 {\n+    private static class MACOSX_AARCH64 {\n@@ -958,1 +977,1 @@\n-            organization = \"jpg.tests.jdk.nsslib\",\n+            organization = NSSLIB,\n@@ -960,1 +979,1 @@\n-            revision = \"3.46\",\n+            revision = NSS_BUNDLE_VERSION,\n@@ -964,0 +983,9 @@\n+\n+    @Artifact(\n+            organization = NSSLIB,\n+            name = \"nsslib-linux_aarch64\",\n+            revision = NSS_BUNDLE_VERSION,\n+            extension = \"zip\"\n+    )\n+    private static class LINUX_AARCH64{\n+    }\n","filename":"test\/jdk\/sun\/security\/pkcs11\/PKCS11Test.java","additions":46,"deletions":18,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,1 @@\n+\n@@ -35,1 +36,0 @@\n-import java.util.Iterator;\n@@ -37,2 +37,0 @@\n-import java.util.ServiceConfigurationError;\n-import java.util.ServiceLoader;\n@@ -41,0 +39,1 @@\n+import jtreg.SkippedException;\n@@ -49,1 +48,7 @@\n-        String nssConfig = PKCS11Test.getNssConfig();\n+        String nssConfig = null;\n+        try {\n+            nssConfig = PKCS11Test.getNssConfig();\n+        } catch (SkippedException exc) {\n+            System.out.println(\"Skipping test: \" + exc.getMessage());\n+        }\n+\n","filename":"test\/jdk\/sun\/security\/pkcs11\/Provider\/MultipleLogins.java","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#        jdk.test.lib.Platform\n","filename":"test\/jdk\/sun\/security\/pkcs11\/Provider\/MultipleLogins.sh","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -56,1 +56,1 @@\n-                \"isHardenedOSX\", \"hasOSXPlistEntries\");\n+                \"isHardenedOSX\", \"hasOSXPlistEntries\", \"isOracleLinux7\");\n","filename":"test\/lib-test\/jdk\/test\/lib\/TestMutuallyExclusivePlatformPredicates.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+import java.util.regex.Matcher;\n@@ -351,0 +352,14 @@\n+    public static boolean isOracleLinux7() {\n+        if (System.getProperty(\"os.name\").toLowerCase().contains(\"linux\") &&\n+                System.getProperty(\"os.version\").toLowerCase().contains(\"el\")) {\n+            Pattern p = Pattern.compile(\"el(\\\\d+)\");\n+            Matcher m = p.matcher(System.getProperty(\"os.version\"));\n+            if (m.find()) {\n+                try {\n+                    return Integer.parseInt(m.group(1)) <= 7;\n+                } catch (NumberFormatException nfe) {}\n+            }\n+        }\n+        return false;\n+    }\n+\n","filename":"test\/lib\/jdk\/test\/lib\/Platform.java","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"}]}