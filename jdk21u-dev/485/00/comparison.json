{"files":[{"patch":"@@ -28,1 +28,0 @@\n-import java.util.Optional;\n@@ -37,0 +36,2 @@\n+import jdk.jpackage.test.Executor;\n+import jdk.jpackage.test.JavaTool;\n@@ -104,3 +105,19 @@\n-            cmd.addArguments(\"--runtime-image\", Optional.ofNullable(\n-                    JPackageCommand.DEFAULT_RUNTIME_IMAGE).orElse(Path.of(\n-                            System.getProperty(\"java.home\"))));\n+            final Path runtimeImageDir;\n+            if (JPackageCommand.DEFAULT_RUNTIME_IMAGE != null) {\n+                runtimeImageDir = JPackageCommand.DEFAULT_RUNTIME_IMAGE;\n+            } else {\n+                runtimeImageDir = TKit.createTempDirectory(\"runtime\").resolve(\"data\");\n+\n+                new Executor()\n+                .setToolProvider(JavaTool.JLINK)\n+                .dumpOutput()\n+                .addArguments(\n+                        \"--output\", runtimeImageDir.toString(),\n+                        \"--compress=0\",\n+                        \"--add-modules\", \"ALL-MODULE-PATH\",\n+                        \"--strip-debug\",\n+                        \"--no-header-files\",\n+                        \"--no-man-pages\")\n+                .execute();\n+            }\n+            cmd.addArguments(\"--runtime-image\", runtimeImageDir);\n","filename":"test\/jdk\/tools\/jpackage\/share\/RuntimePackageTest.java","additions":21,"deletions":4,"binary":false,"changes":25,"status":"modified"}]}