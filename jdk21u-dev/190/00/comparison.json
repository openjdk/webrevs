{"files":[{"patch":"@@ -24,7 +24,0 @@\n-\/*\n-   @test\n-   @key headful\n-   @bug 8041470\n-   @summary JButtons stay pressed after they have lost focus if you use the mouse wheel\n- *\/\n-\n@@ -38,0 +31,2 @@\n+import java.awt.event.FocusAdapter;\n+import java.awt.event.FocusEvent;\n@@ -41,0 +36,1 @@\n+import java.util.concurrent.TimeUnit;\n@@ -46,0 +42,6 @@\n+\/*\n+ * @test\n+ * @key headful\n+ * @bug 8041470\n+ * @summary JButtons stay pressed after they have lost focus if you use the mouse wheel\n+ *\/\n@@ -51,3 +53,4 @@\n-    CountDownLatch pressSema = new CountDownLatch(1);\n-    CountDownLatch exitSema = new CountDownLatch(1);\n-    CountDownLatch releaseSema = new CountDownLatch(1);\n+    final CountDownLatch focusSema = new CountDownLatch(1);\n+    final CountDownLatch pressSema = new CountDownLatch(1);\n+    final CountDownLatch exitSema = new CountDownLatch(1);\n+    final CountDownLatch releaseSema = new CountDownLatch(1);\n@@ -62,0 +65,8 @@\n+\n+        fb.addFocusListener(new FocusAdapter() {\n+            @Override\n+            public void focusGained(FocusEvent focusEvent) {\n+                focusSema.countDown();\n+            }\n+        });\n+\n@@ -72,1 +83,0 @@\n-\n@@ -109,0 +119,5 @@\n+        System.out.println(\"# Started\");\n+        if (!focusSema.await(2, TimeUnit.SECONDS)) {\n+            throw new RuntimeException(\"Didn't receive focus in time\");\n+        }\n+\n@@ -111,1 +126,0 @@\n-        System.out.println(\"# Started\");\n@@ -120,1 +134,3 @@\n-        pressSema.await();\n+        if (!pressSema.await(2, TimeUnit.SECONDS)) {\n+            throw new RuntimeException(\"Mouse is not pressed\");\n+        }\n@@ -124,1 +140,3 @@\n-        exitSema.await();\n+        if (!exitSema.await(1, TimeUnit.SECONDS)) {\n+            throw new RuntimeException(\"Mouse did not exit\");\n+        }\n@@ -129,1 +147,3 @@\n-        wheelSema.await();\n+        if (!wheelSema.await(1, TimeUnit.SECONDS)) {\n+            throw new RuntimeException(\"Mouse is not wheeled 1\");\n+        }\n@@ -134,1 +154,3 @@\n-        wheelSema.await();\n+        if (!wheelSema.await(1, TimeUnit.SECONDS)) {\n+            throw new RuntimeException(\"Mouse is not wheeled 2\");\n+        }\n@@ -138,1 +160,3 @@\n-        releaseSema.await();\n+        if (!releaseSema.await(1, TimeUnit.SECONDS)) {\n+            throw new RuntimeException(\"Mouse is not released\");\n+        }\n@@ -145,2 +169,10 @@\n-        SwingUtilities.invokeAndWait(() -> test.createGui());\n-        test.run();\n+        try {\n+            SwingUtilities.invokeAndWait(test::createGui);\n+            test.run();\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (test.f != null) {\n+                    test.f.dispose();\n+                }\n+            });\n+        }\n","filename":"test\/jdk\/java\/awt\/event\/MouseWheelEvent\/WheelModifier\/WheelModifier.java","additions":51,"deletions":19,"binary":false,"changes":70,"status":"modified"}]}