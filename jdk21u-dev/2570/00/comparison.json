{"files":[{"patch":"@@ -131,4 +131,2 @@\n-  \/\/ If a message is already set, free it.\n-  if (nest_host_error() != nullptr) {\n-    FREE_C_HEAP_ARRAY(char, _nest_host_error);\n-  }\n+  assert(_nest_host_error == nullptr, \"caller should have checked\");\n+  assert_lock_strong(SystemDictionary_lock);\n","filename":"src\/hotspot\/share\/classfile\/resolutionErrors.cpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1832,1 +1832,1 @@\n-                                           const char* message) {\n+                                           const stringStream& message) {\n@@ -1841,1 +1841,1 @@\n-      ResolutionErrorTable::add_entry(pool, which, message);\n+      ResolutionErrorTable::add_entry(pool, which, message.as_string(true \/* on C-heap *\/));\n@@ -1846,3 +1846,8 @@\n-      \/\/ the message, and set it again.\n-      assert(entry->nest_host_error() == nullptr || strcmp(entry->nest_host_error(), message) == 0, \"should be the same message\");\n-      entry->set_nest_host_error(message);\n+      \/\/ the message.\n+      const char* nhe = entry->nest_host_error();\n+      if (nhe == nullptr) {\n+        entry->set_nest_host_error(message.as_string(true \/* on C-heap *\/));\n+      } else {\n+        DEBUG_ONLY(const char* msg = message.base();)\n+        assert(strcmp(nhe, msg) == 0, \"New message %s, differs from original %s\", msg, nhe);\n+      }\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -285,1 +285,1 @@\n-                                  const char* message);\n+                                  const stringStream& message);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -293,1 +293,0 @@\n-      const char* msg = ss.as_string(true \/* on C-heap *\/);\n@@ -295,1 +294,1 @@\n-      SystemDictionary::add_nest_host_error(cph, _nest_host_index, msg);\n+      SystemDictionary::add_nest_host_error(cph, _nest_host_index, ss);\n@@ -298,1 +297,1 @@\n-      log_trace(class, nestmates)(\"%s\", msg);\n+      log_trace(class, nestmates)(\"%s\", ss.base());\n@@ -337,1 +336,0 @@\n-        const char* msg = ss.as_string(true \/* on C-heap *\/);\n@@ -339,2 +337,2 @@\n-        SystemDictionary::add_nest_host_error(cph, _nest_host_index, msg);\n-        log_trace(class, nestmates)(\"%s\", msg);\n+        SystemDictionary::add_nest_host_error(cph, _nest_host_index, ss);\n+        log_trace(class, nestmates)(\"%s\", ss.base());\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"}]}