{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,25 @@\n-\/**\n+import java.awt.Graphics;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n+import java.io.InputStream;\n+import java.io.Reader;\n+\n+import javax.print.Doc;\n+import javax.print.DocFlavor;\n+import javax.print.DocPrintJob;\n+import javax.print.PrintException;\n+import javax.print.PrintService;\n+import javax.print.PrintServiceLookup;\n+import javax.print.attribute.DocAttributeSet;\n+import javax.print.attribute.HashPrintRequestAttributeSet;\n+import javax.print.attribute.standard.Copies;\n+import javax.print.attribute.standard.SheetCollate;\n+import javax.swing.BorderFactory;\n+import javax.swing.Box;\n+import javax.swing.JButton;\n+import javax.swing.JComponent;\n+import javax.swing.JOptionPane;\n+\n+\/*\n@@ -29,0 +53,2 @@\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -31,15 +57,2 @@\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.awt.print.*;\n-import javax.print.attribute.standard.*;\n-import javax.print.attribute.*;\n-import javax.print.*;\n-import java.io.*;\n-\n-public class Collate2DPrintingTest\n-    extends Frame implements Doc, Printable, ActionListener {\n-\n-        Button print2D = new Button(\"2D Print\");\n-        Button printMerlin = new Button(\"PrintService\");\n-        PrinterJob pj = PrinterJob.getPrinterJob();\n-        PrintService defService = null;\n+public class Collate2DPrintingTest implements Doc, Printable {\n+    private static JComponent createTestUI() {\n@@ -47,0 +60,3 @@\n+        PrintService defService = PrintServiceLookup.lookupDefaultPrintService();\n+        prSet.add(SheetCollate.COLLATED);\n+        prSet.add(new Copies(2));\n@@ -48,10 +64,14 @@\n-    public Collate2DPrintingTest() {\n-\n-        Panel butPanel = new Panel();\n-        butPanel.add(print2D);\n-        butPanel.add(printMerlin);\n-        print2D.addActionListener(this);\n-        printMerlin.addActionListener(this);\n-        addWindowListener (new WindowAdapter() {\n-            public void windowClosing (WindowEvent e) {\n-                dispose();\n+        JButton print2D = new JButton(\"2D Print\");\n+        print2D.addActionListener((ae) -> {\n+            try {\n+                PrinterJob pj = PrinterJob.getPrinterJob();\n+                pj.setPrintable(new Collate2DPrintingTest());\n+                if (pj.printDialog(prSet)) {\n+                    pj.print(prSet);\n+                }\n+            } catch (PrinterException ex) {\n+                ex.printStackTrace();\n+                String msg = \"PrinterException: \" + ex.getMessage();\n+                JOptionPane.showMessageDialog(print2D, msg, \"Error occurred\",\n+                        JOptionPane.ERROR_MESSAGE);\n+                PassFailJFrame.forceFail(msg);\n@@ -60,1 +80,0 @@\n-        add(\"South\", butPanel);\n@@ -62,6 +81,11 @@\n-        defService = PrintServiceLookup.lookupDefaultPrintService();\n-        PrintService[] pservice;\n-        if (defService == null) {\n-            pservice = PrintServiceLookup.lookupPrintServices(null, null);\n-            if (pservice.length == 0) {\n-                throw new RuntimeException(\"No printer found.  TEST ABORTED\");\n+        JButton printMerlin = new JButton(\"PrintService\");\n+        printMerlin.addActionListener((ae) -> {\n+            try {\n+                DocPrintJob pj = defService.createPrintJob();\n+                pj.print(new Collate2DPrintingTest(), prSet);\n+            } catch (PrintException ex) {\n+                ex.printStackTrace();\n+                String msg = \"PrintException: \" + ex.getMessage();\n+                JOptionPane.showMessageDialog(printMerlin, msg, \"Error occurred\",\n+                        JOptionPane.ERROR_MESSAGE);\n+                PassFailJFrame.forceFail(msg);\n@@ -69,8 +93,1 @@\n-            defService = pservice[0];\n-        }\n-        prSet.add(SheetCollate.COLLATED);\n-        prSet.add(new Copies(2));\n-        pj.setPrintable(Collate2DPrintingTest.this);\n-        setSize(300, 200);\n-        setVisible(true);\n-    }\n+        });\n@@ -78,0 +95,9 @@\n+        Box main = Box.createVerticalBox();\n+        main.setBorder(BorderFactory.createEmptyBorder(8, 8, 8, 8));\n+        main.add(Box.createVerticalGlue());\n+        main.add(print2D);\n+        main.add(Box.createVerticalStrut(4));\n+        main.add(printMerlin);\n+        main.add(Box.createVerticalGlue());\n+        return main;\n+    }\n@@ -79,0 +105,1 @@\n+    @Override\n@@ -80,1 +107,1 @@\n-          throws PrinterException {\n+            throws PrinterException {\n@@ -89,16 +116,1 @@\n-    public void actionPerformed (ActionEvent ae) {\n-        try {\n-            if (ae.getSource() == print2D) {\n-                if (pj.printDialog(prSet)) {\n-                    pj.print(prSet);\n-                }\n-            } else {\n-                DocPrintJob pj = defService.createPrintJob();\n-                pj.print(this, prSet);\n-            }\n-            System.out.println (\"DONE\");\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-        }\n-    }\n-\n+    @Override\n@@ -109,0 +121,1 @@\n+    @Override\n@@ -110,2 +123,1 @@\n-        DocFlavor flavor = DocFlavor.SERVICE_FORMATTED.PRINTABLE;\n-        return flavor;\n+        return DocFlavor.SERVICE_FORMATTED.PRINTABLE;\n@@ -114,0 +126,1 @@\n+    @Override\n@@ -118,0 +131,1 @@\n+    @Override\n@@ -122,0 +136,1 @@\n+    @Override\n@@ -126,120 +141,13 @@\n-  public static void main( String[] args) {\n-\n-  String[] instructions =\n-        {\n-         \"You must have a printer available to perform this test\",\n-         \"The print result should be collated.\"\n-       };\n-      Sysout.createDialog( );\n-      Sysout.printInstructions( instructions );\n-\n-     new Collate2DPrintingTest();\n-  }\n-}\n-\n-\n-class Sysout {\n-   private static TestDialog dialog;\n-\n-   public static void createDialogWithInstructions( String[] instructions )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      dialog.printInstructions( instructions );\n-      dialog.setVisible(true);\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-   public static void createDialog( )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      String[] defInstr = { \"Instructions will appear here. \", \"\" } ;\n-      dialog.printInstructions( defInstr );\n-      dialog.setVisible(true);\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-\n-   public static void printInstructions( String[] instructions )\n-    {\n-      dialog.printInstructions( instructions );\n-    }\n-\n-\n-   public static void println( String messageIn )\n-    {\n-      dialog.displayMessage( messageIn );\n-    }\n-\n-}\/\/ Sysout  class\n-\n-\/**\n-  This is part of the standard test machinery.  It provides a place for the\n-   test instructions to be displayed, and a place for interactive messages\n-   to the user to be displayed.\n-  To have the test instructions displayed, see Sysout.\n-  To have a message to the user be displayed, see Sysout.\n-  Do not call anything in this dialog directly.\n-  *\/\n-class TestDialog extends Dialog {\n-\n-   TextArea instructionsText;\n-   TextArea messageText;\n-   int maxStringLength = 80;\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public TestDialog( Frame frame, String name )\n-    {\n-      super( frame, name );\n-      int scrollBoth = TextArea.SCROLLBARS_BOTH;\n-      instructionsText = new TextArea( \"\", 15, maxStringLength, scrollBoth );\n-      add( \"North\", instructionsText );\n-\n-      messageText = new TextArea( \"\", 5, maxStringLength, scrollBoth );\n-      add(\"Center\", messageText);\n-\n-      pack();\n-\n-      setVisible(true);\n-    }\/\/ TestDialog()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void printInstructions( String[] instructions )\n-    {\n-      \/\/Clear out any current instructions\n-      instructionsText.setText( \"\" );\n-\n-      \/\/Go down array of instruction strings\n-\n-      String printStr, remainingStr;\n-      for( int i=0; i < instructions.length; i++ )\n-       {\n-         \/\/chop up each into pieces maxSringLength long\n-         remainingStr = instructions[ i ];\n-         while( remainingStr.length() > 0 )\n-          {\n-            \/\/if longer than max then chop off first max chars to print\n-            if( remainingStr.length() >= maxStringLength )\n-             {\n-               \/\/Try to chop on a word boundary\n-               int posOfSpace = remainingStr.\n-                  lastIndexOf( ' ', maxStringLength - 1 );\n-\n-               if( posOfSpace <= 0 ) posOfSpace = maxStringLength - 1;\n-\n-               printStr = remainingStr.substring( 0, posOfSpace + 1 );\n-               remainingStr = remainingStr.substring( posOfSpace + 1 );\n-             }\n-            \/\/else just print\n-            else\n-             {\n-               printStr = remainingStr;\n-               remainingStr = \"\";\n-             }\n-\n-            instructionsText.append( printStr + \"\\n\" );\n-\n-          }\/\/ while\n-\n-       }\/\/ for\n-\n-    }\/\/printInstructions()\n+    private static final String INSTRUCTIONS =\n+            \"Click on the '2D Print' button.\\n\" +\n+            \"Choose copies as '2' with 'Collated' checkbox and Print\\n\" +\n+            \"\\n\" +\n+            \"Click on the 'PrintService', should get a print from default printer\\n\" +\n+            \"\\n\" +\n+            \"If you get only one copy or non 'Collated' prints from any of the above cases, \" +\n+            \"test failed\";\n+\n+    public static void main(String[] args) throws Exception {\n+        if (PrinterJob.lookupPrintServices().length == 0) {\n+            throw new RuntimeException(\"Printer not configured or available.\");\n+        }\n@@ -247,4 +155,7 @@\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void displayMessage( String messageIn )\n-    {\n-      messageText.append( messageIn + \"\\n\" );\n+        PassFailJFrame.builder()\n+                .instructions(INSTRUCTIONS)\n+                .splitUI(Collate2DPrintingTest::createTestUI)\n+                .rows((int) INSTRUCTIONS.lines().count() + 1)\n+                .columns(45)\n+                .build()\n+                .awaitAndCheck();\n@@ -252,2 +163,1 @@\n-\n- }\/\/ TestDialog  class\n+}\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/Collate2DPrintingTest.java","additions":97,"deletions":187,"binary":false,"changes":284,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,15 @@\n-\/**\n+import java.awt.Color;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.Rectangle;\n+import java.awt.RenderingHints;\n+import java.awt.geom.AffineTransform;\n+import java.awt.image.BufferedImage;\n+import java.awt.image.BufferedImageOp;\n+import java.awt.image.RescaleOp;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n+\n+\/*\n@@ -29,0 +43,2 @@\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -31,0 +47,2 @@\n+public class DrawImage {\n+    private static final int OBJECT_BORDER = 15;\n@@ -32,25 +50,4 @@\n-import java.util.*;\n-import java.text.*;\n-import java.io.*;\n-import java.net.*;\n-import java.awt.*;\n-import java.awt.font.*;\n-import java.awt.geom.*;\n-import java.awt.print.*;\n-import java.awt.event.*;\n-import java.awt.image.*;\n-import java.awt.image.renderable.*;\n-import javax.swing.*;\n-import javax.swing.text.*;\n-import javax.swing.border.*;\n-import javax.swing.event.*;\n-\n-public class DrawImage\n-{\n-    protected static final double _hwBorder = 72 \/ 4;       \/\/ 1\/4 inch\n-    protected static final double _border = 72 \/ 4;         \/\/ 1\/4 inch\n-    protected static final int _objectBorder = 15;\n-    protected static final int _verticalGap = 20;\n-    protected static final int _textIndent = 150;\n-\n-    protected BufferedImage _image;\n+    private static final String INSTRUCTIONS =\n+            \"This test will automatically initiate a print\\n\\n\" +\n+            \"Test passes if you get a printout of a gray rectangle\\n\" +\n+            \"with white text without any exception.\";\n@@ -58,1 +55,2 @@\n-    protected PageFormat  _pageFormat;\n+    private final BufferedImage image;\n+    private final PageFormat pageFormat;\n@@ -60,2 +58,2 @@\n-    public DrawImage(BufferedImage image) {\n-        _image = image;\n+    private DrawImage(BufferedImage image) {\n+        this.image = image;\n@@ -63,1 +61,2 @@\n-        _pageFormat = pj.defaultPage();\n+        pageFormat = pj.defaultPage();\n+    }\n@@ -65,1 +64,4 @@\n- }\n+    private int printImage(Graphics g, PageFormat pf, int pageIndex) {\n+        if (pageIndex > 0) {\n+            return Printable.NO_SUCH_PAGE;\n+        }\n@@ -67,0 +69,4 @@\n+        int paperW = (int) pageFormat.getImageableWidth();\n+        int paperH = (int) pageFormat.getImageableHeight();\n+        int x = (int) pageFormat.getImageableX();\n+        int y = (int) pageFormat.getImageableY();\n@@ -68,3 +74,3 @@\n-    protected int printImage(Graphics g, PageFormat pf, BufferedImage image) {\n-        Graphics2D g2D = (Graphics2D)g;\n-        g2D.transform(new AffineTransform(_pageFormat.getMatrix()));\n+        \/\/ Make the image slightly smaller (25) than max possible width\n+        float scaleFactor = ((float) ((paperW - 25) - OBJECT_BORDER - OBJECT_BORDER)\n+                                   \/ (float) (image.getWidth()));\n@@ -72,2 +78,1 @@\n-        int paperW = (int)pf.getImageableWidth(), paperH =\n-            (int)pf.getImageableHeight();\n+        BufferedImageOp scaleOp = new RescaleOp(scaleFactor, 0, null);\n@@ -75,1 +80,2 @@\n-        int x = (int)pf.getImageableX(), y = (int)pf.getImageableY();\n+        Graphics2D g2D = (Graphics2D) g;\n+        g2D.transform(new AffineTransform(pageFormat.getMatrix()));\n@@ -77,0 +83,1 @@\n+        g2D.drawImage(image, scaleOp, x + OBJECT_BORDER, y + OBJECT_BORDER);\n@@ -78,16 +85,1 @@\n-        \/\/ print images\n-        if (image != null ) {\n-            int imageH = image.getHeight(), imageW = image.getWidth();\n-            \/\/ make slightly smaller (25) than max possible width\n-            float scaleFactor = ((float)((paperW - 25) - _objectBorder -\n-                                         _objectBorder) \/ (float)(imageW));\n-            int scaledW = (int)(imageW * scaleFactor),\n-                scaledH = (int)(imageH *scaleFactor);\n-            BufferedImageOp scaleOp = new RescaleOp(scaleFactor, 0, null);\n-            g2D.drawImage(image, scaleOp, x + _objectBorder, y + _objectBorder);\n-            y += _objectBorder + scaledH + _objectBorder;\n-            return Printable.PAGE_EXISTS;\n-        }\n-        else {\n-            return Printable.NO_SUCH_PAGE;\n-        }\n+        return Printable.PAGE_EXISTS;\n@@ -96,23 +88,8 @@\n-    public void print() {\n-        try {\n-            final PrinterJob pj = PrinterJob.getPrinterJob();\n-            pj.setJobName(\"Print Image\");\n-            pj.setPrintable(new Printable() {\n-                public int print(Graphics g, PageFormat pf, int pageIndex) {\n-                    int result = NO_SUCH_PAGE;\n-                    if (pageIndex == 0) {\n-                        result = printImage(g, _pageFormat, _image);\n-                    }\n-                    return result;\n-                }\n-            });\n-            if (pj.printDialog()) {\n-                try { pj.print(); }\n-                catch (PrinterException e) {\n-                    System.out.println(e);\n-                }\n-            }\n-\n-        }\n-        catch (Exception e) {\n-            e.printStackTrace(System.out);\n+    private void print() throws PrinterException {\n+        final PrinterJob pj = PrinterJob.getPrinterJob();\n+        pj.setJobName(\"Print Image\");\n+        pj.setPrintable(this::printImage);\n+        if (pj.printDialog()) {\n+            pj.print();\n+        } else {\n+            PassFailJFrame.forceFail(\"User cancelled printing\");\n@@ -122,10 +99,4 @@\n-    public static void main(String[] args) {\n-                                String[] instructions =\n-           {\n-            \"You must have a printer available to perform this test.\",\n-            \"The test passes if you get a printout of a gray rectangle\",\n-                                                \"with white text without any exception.\"\n-          };\n-\n-         Sysout.createDialog( );\n-         Sysout.printInstructions( instructions );\n+    public static void main(String[] args) throws Exception {\n+        if (PrinterJob.lookupPrintServices().length == 0) {\n+            throw new RuntimeException(\"Printer not configured or available.\");\n+        }\n@@ -134,0 +105,7 @@\n+\n+        PassFailJFrame passFailJFrame = PassFailJFrame.builder()\n+                .instructions(INSTRUCTIONS)\n+                .rows((int) INSTRUCTIONS.lines().count() + 1)\n+                .columns(45)\n+                .build();\n+\n@@ -136,1 +114,1 @@\n-        \/\/      System.exit(0);\n+        passFailJFrame.awaitAndCheck();\n@@ -139,3 +117,1 @@\n-\n-\n-    public static BufferedImage prepareFrontImage() {\n+    private static BufferedImage prepareFrontImage() {\n@@ -144,1 +120,3 @@\n-                                                 BufferedImage.TYPE_BYTE_GRAY);\n+                                   BufferedImage.TYPE_BYTE_GRAY);\n+        int w = result.getWidth();\n+        int h = result.getHeight();\n@@ -146,1 +124,1 @@\n-        Graphics2D g2D = (Graphics2D)result.getGraphics();\n+        Graphics2D g2D = (Graphics2D) result.getGraphics();\n@@ -149,2 +127,0 @@\n-        int w = result.getWidth(), h = result.getHeight();\n-\n@@ -153,1 +129,0 @@\n-\n@@ -156,3 +131,2 @@\n-        AffineTransform original = g2D.getTransform();\n-        AffineTransform originXform = AffineTransform.getTranslateInstance(w \/\n-5, h \/ 5);\n+        AffineTransform originXform = AffineTransform.getTranslateInstance(\n+                w \/ 5.0, h \/ 5.0);\n@@ -160,2 +134,0 @@\n-\n-\n@@ -163,0 +135,1 @@\n+        g2D.dispose();\n@@ -166,2 +139,0 @@\n-\n-\n@@ -169,114 +140,0 @@\n-\n-class Sysout {\n-   private static TestDialog dialog;\n-\n-   public static void createDialogWithInstructions( String[] instructions )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      dialog.printInstructions( instructions );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-   public static void createDialog( )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      String[] defInstr = { \"Instructions will appear here. \", \"\" } ;\n-      dialog.printInstructions( defInstr );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-\n-   public static void printInstructions( String[] instructions )\n-    {\n-      dialog.printInstructions( instructions );\n-    }\n-\n-\n-   public static void println( String messageIn )\n-    {\n-      dialog.displayMessage( messageIn );\n-    }\n-\n-}\/\/ Sysout  class\n-\n-\/**\n-  This is part of the standard test machinery.  It provides a place for the\n-   test instructions to be displayed, and a place for interactive messages\n-   to the user to be displayed.\n-  To have the test instructions displayed, see Sysout.\n-  To have a message to the user be displayed, see Sysout.\n-  Do not call anything in this dialog directly.\n-  *\/\n-class TestDialog extends Dialog {\n-\n-   TextArea instructionsText;\n-   TextArea messageText;\n-   int maxStringLength = 80;\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public TestDialog( Frame frame, String name )\n-    {\n-      super( frame, name );\n-      int scrollBoth = TextArea.SCROLLBARS_BOTH;\n-      instructionsText = new TextArea( \"\", 15, maxStringLength, scrollBoth );\n-      add( \"North\", instructionsText );\n-\n-      messageText = new TextArea( \"\", 5, maxStringLength, scrollBoth );\n-      add(\"Center\", messageText);\n-\n-      pack();\n-\n-      show();\n-    }\/\/ TestDialog()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void printInstructions( String[] instructions )\n-    {\n-      \/\/Clear out any current instructions\n-      instructionsText.setText( \"\" );\n-\n-      \/\/Go down array of instruction strings\n-\n-      String printStr, remainingStr;\n-      for( int i=0; i < instructions.length; i++ )\n-       {\n-         \/\/chop up each into pieces maxSringLength long\n-         remainingStr = instructions[ i ];\n-         while( remainingStr.length() > 0 )\n-          {\n-            \/\/if longer than max then chop off first max chars to print\n-            if( remainingStr.length() >= maxStringLength )\n-             {\n-               \/\/Try to chop on a word boundary\n-               int posOfSpace = remainingStr.\n-                  lastIndexOf( ' ', maxStringLength - 1 );\n-\n-               if( posOfSpace <= 0 ) posOfSpace = maxStringLength - 1;\n-\n-               printStr = remainingStr.substring( 0, posOfSpace + 1 );\n-               remainingStr = remainingStr.substring( posOfSpace + 1 );\n-             }\n-            \/\/else just print\n-            else\n-             {\n-               printStr = remainingStr;\n-               remainingStr = \"\";\n-             }\n-\n-            instructionsText.append( printStr + \"\\n\" );\n-\n-          }\/\/ while\n-\n-       }\/\/ for\n-\n-    }\/\/printInstructions()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void displayMessage( String messageIn )\n-    {\n-      messageText.append( messageIn + \"\\n\" );\n-    }\n-\n- }\/\/ TestDialog  class\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/DrawImage.java","additions":74,"deletions":217,"binary":false,"changes":291,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,13 @@\n-\/**\n+import java.awt.Color;\n+import java.awt.Font;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.font.FontRenderContext;\n+import java.awt.print.Book;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterJob;\n+import java.text.AttributedCharacterIterator;\n+import java.text.AttributedString;\n+\n+\/*\n@@ -30,0 +42,2 @@\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -32,6 +46,0 @@\n-\n-import java.awt.*;\n-import java.text.*;\n-import java.awt.font.*;\n-import java.awt.print.*;\n-\n@@ -39,0 +47,11 @@\n+    private static final String INSTRUCTIONS =\n+            \" This test will automatically initiate a print.\\n\" +\n+            \"\\n\" +\n+            \" Confirm that the following methods are printed:\\n\" +\n+            \" For Graphics: drawString, drawString, drawChars, drawBytes\\n\" +\n+            \" For Graphics2D: drawString, drawString, drawGlyphVector\";\n+\n+    public static void main(String[] args) throws Exception {\n+        if (PrinterJob.lookupPrintServices().length == 0) {\n+            throw new RuntimeException(\"Printer not configured or available.\");\n+        }\n@@ -40,9 +59,5 @@\n-    public static void main(String args[]) {\n-        String[] instructions =\n-        {\n-            \"Confirm that the methods are printed.\",\n-            \" For Graphics: drawString, drawString, drawChars, drawBytes\",\n-            \" For Graphics2D: drawString, drawString, drawGlyphVector\"\n-        };\n-        Sysout.createDialogWithInstructions( instructions );\n-\n+        PassFailJFrame passFailJFrame = PassFailJFrame.builder()\n+                .instructions(INSTRUCTIONS)\n+                .rows((int) INSTRUCTIONS.lines().count() + 1)\n+                .columns(45)\n+                .build();\n@@ -56,0 +71,1 @@\n+        pjob.print();\n@@ -57,5 +73,1 @@\n-        try {\n-            pjob.print();\n-        } catch (PrinterException e) {\n-            throw new RuntimeException(e.getMessage());\n-        }\n+        passFailJFrame.awaitAndCheck();\n@@ -64,1 +76,1 @@\n-    public static AttributedCharacterIterator getIterator(String s) {\n+    private static AttributedCharacterIterator getIterator(String s) {\n@@ -68,0 +80,1 @@\n+    @Override\n@@ -96,1 +109,1 @@\n-        byte data[] = new byte[s.length()];\n+        byte[] data = new byte[s.length()];\n@@ -119,1 +132,1 @@\n-                           \"float x, float y)\";\n+                \"float x, float y)\";\n@@ -136,116 +149,0 @@\n-\n-class Sysout\n- {\n-   private static TestDialog dialog;\n-\n-   public static void createDialogWithInstructions( String[] instructions )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      dialog.printInstructions( instructions );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-   public static void createDialog( )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      String[] defInstr = { \"Instructions will appear here. \", \"\" } ;\n-      dialog.printInstructions( defInstr );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-\n-   public static void printInstructions( String[] instructions )\n-    {\n-      dialog.printInstructions( instructions );\n-    }\n-\n-\n-   public static void println( String messageIn )\n-    {\n-      dialog.displayMessage( messageIn );\n-    }\n-\n- }\/\/ Sysout  class\n-\n-\/**\n-  This is part of the standard test machinery.  It provides a place for the\n-   test instructions to be displayed, and a place for interactive messages\n-   to the user to be displayed.\n-  To have the test instructions displayed, see Sysout.\n-  To have a message to the user be displayed, see Sysout.\n-  Do not call anything in this dialog directly.\n-  *\/\n-class TestDialog extends Dialog\n- {\n-\n-   TextArea instructionsText;\n-   TextArea messageText;\n-   int maxStringLength = 80;\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public TestDialog( Frame frame, String name )\n-    {\n-      super( frame, name );\n-      int scrollBoth = TextArea.SCROLLBARS_BOTH;\n-      instructionsText = new TextArea( \"\", 15, maxStringLength, scrollBoth );\n-      add( \"North\", instructionsText );\n-\n-      messageText = new TextArea( \"\", 5, maxStringLength, scrollBoth );\n-      add(\"South\", messageText);\n-\n-      pack();\n-\n-      show();\n-    }\/\/ TestDialog()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void printInstructions( String[] instructions )\n-    {\n-      \/\/Clear out any current instructions\n-      instructionsText.setText( \"\" );\n-\n-      \/\/Go down array of instruction strings\n-\n-      String printStr, remainingStr;\n-      for( int i=0; i < instructions.length; i++ )\n-       {\n-     \/\/chop up each into pieces maxSringLength long\n-     remainingStr = instructions[ i ];\n-     while( remainingStr.length() > 0 )\n-      {\n-        \/\/if longer than max then chop off first max chars to print\n-        if( remainingStr.length() >= maxStringLength )\n-         {\n-           \/\/Try to chop on a word boundary\n-           int posOfSpace = remainingStr.\n-          lastIndexOf( ' ', maxStringLength - 1 );\n-\n-           if( posOfSpace <= 0 ) posOfSpace = maxStringLength - 1;\n-\n-           printStr = remainingStr.substring( 0, posOfSpace + 1 );\n-           remainingStr = remainingStr.substring( posOfSpace + 1 );\n-         }\n-        \/\/else just print\n-        else\n-         {\n-           printStr = remainingStr;\n-           remainingStr = \"\";\n-         }\n-\n-            instructionsText.append( printStr + \"\\n\" );\n-\n-      }\/\/ while\n-\n-       }\/\/ for\n-\n-    }\/\/printInstructions()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void displayMessage( String messageIn )\n-    {\n-      messageText.append( messageIn + \"\\n\" );\n-    }\n-\n- }\/\/ TestDialog  class\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/DrawStringMethods.java","additions":38,"deletions":141,"binary":false,"changes":179,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,16 @@\n-\/**\n+import java.awt.Color;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Paper;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n+\n+import javax.swing.BorderFactory;\n+import javax.swing.Box;\n+import javax.swing.JButton;\n+import javax.swing.JComponent;\n+import javax.swing.JOptionPane;\n+\n+\/*\n@@ -29,0 +44,2 @@\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -31,29 +48,13 @@\n-\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.awt.print.*;\n-\n-public class InvalidPage extends Frame implements Printable {\n-\n-  PrinterJob pJob;\n-  PageFormat pf;\n-\n-  public InvalidPage() {\n-    super (\"Validate Page Test\");\n-    pJob = PrinterJob.getPrinterJob();\n-    pf = pJob.defaultPage();\n-    Paper p = pf.getPaper();\n-    p.setImageableArea(0,0,p.getWidth(), p.getHeight());\n-    pf.setPaper(p);\n-    setLayout(new FlowLayout());\n-    Panel panel = new Panel();\n-    Button printButton = new Button (\"Print\");\n-    printButton.addActionListener(new ActionListener() {\n-                public void actionPerformed (ActionEvent e) {\n-                    try {\n-                         if (pJob.printDialog()) {\n-                             pJob.setPrintable(InvalidPage.this, pf);\n-                             pJob.print();\n-                    }\n-                    } catch (PrinterException pe ) {\n-                    }\n+public class InvalidPage implements Printable {\n+    private static JComponent createTestUI() {\n+        JButton b = new JButton(\"Print\");\n+        b.addActionListener((ae) -> {\n+            try {\n+                PrinterJob job = PrinterJob.getPrinterJob();\n+                PageFormat pf = job.defaultPage();\n+                Paper p = pf.getPaper();\n+                p.setImageableArea(0, 0, p.getWidth(), p.getHeight());\n+                pf.setPaper(p);\n+                job.setPrintable(new InvalidPage(), pf);\n+                if (job.printDialog()) {\n+                    job.print();\n@@ -61,79 +62,15 @@\n-    });\n-    panel.add (printButton);\n-    add(panel);\n-\n-    addWindowListener (new WindowAdapter() {\n-         public void windowClosing (WindowEvent e) {\n-            dispose();\n-            System.exit (0);\n-         }\n-\n-      });\n-      setSize (200, 200);\n-      setVisible (true);\n-  }\n-\n-  public int print(Graphics graphics, PageFormat pageFormat, int pageIndex) {\n-\n-     if (pageIndex > 1) {\n-        return Printable.NO_SUCH_PAGE;\n-     }\n-\n-     Graphics2D g2d = (Graphics2D)graphics;\n-\n-     g2d.translate(pageFormat.getImageableX(), pageFormat.getImageableY());\n-     g2d.drawString(\"ORIGIN\", 30, 30);\n-     g2d.drawString(\"X THIS WAY\", 200, 50);\n-     g2d.drawString(\"Y THIS WAY\", 60 , 200);\n-     g2d.drawRect(0,0,(int)pageFormat.getImageableWidth(),\n-                      (int)pageFormat.getImageableHeight());\n-     if (pageIndex == 0) {\n-        g2d.setColor(Color.black);\n-     } else {\n-        g2d.setColor(new Color(0,0,0,128));\n-     }\n-     g2d.drawRect(1,1,(int)pageFormat.getImageableWidth()-2,\n-                      (int)pageFormat.getImageableHeight()-2);\n-\n-     g2d.drawLine(0,0,\n-                  (int)pageFormat.getImageableWidth(),\n-                  (int)pageFormat.getImageableHeight());\n-     g2d.drawLine((int)pageFormat.getImageableWidth(),0,\n-                   0,(int)pageFormat.getImageableHeight());\n-     return  Printable.PAGE_EXISTS;\n-  }\n-\n-  public static void main( String[] args) {\n-  String[] instructions =\n-        {\n-         \"You must have a printer available to perform this test\",\n-         \"Press the print button, which brings up a print dialog and\",\n-         \"in the dialog select a printer and press the print button\",\n-         \"in the dialog. Repeat for as many printers as you have installed\",\n-         \"On solaris and linux just one printer is sufficient\",\n-         \"Collect the output and examine it, each print job has two pages\",\n-         \"of very similar output, except that the 2nd page of the job may\",\n-         \"appear in a different colour, and the output near the edge of\",\n-         \"the page may be clipped. This is OK. Hold up both pieces of paper\",\n-         \"to the light and confirm that the lines and text (where present)\",\n-         \"are positioned identically on both pages\",\n-         \"The test fails if the JRE crashes, or if the output from the two\",\n-         \"pages of a job is aligned differently\"\n-       };\n-      Sysout.createDialog( );\n-      Sysout.printInstructions( instructions );\n-\n-     new InvalidPage();\n-  }\n-\n-}\n-\n-class Sysout {\n-   private static TestDialog dialog;\n-\n-   public static void createDialogWithInstructions( String[] instructions )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      dialog.printInstructions( instructions );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n+            } catch (PrinterException ex) {\n+                ex.printStackTrace();\n+                String msg = \"PrinterException: \" + ex.getMessage();\n+                JOptionPane.showMessageDialog(b, msg, \"Error occurred\",\n+                        JOptionPane.ERROR_MESSAGE);\n+                PassFailJFrame.forceFail(msg);\n+            }\n+        });\n+\n+        Box main = Box.createHorizontalBox();\n+        main.setBorder(BorderFactory.createEmptyBorder(8, 8, 8, 8));\n+        main.add(Box.createHorizontalGlue());\n+        main.add(b);\n+        main.add(Box.createHorizontalGlue());\n+        return main;\n@@ -142,7 +79,29 @@\n-   public static void createDialog( )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      String[] defInstr = { \"Instructions will appear here. \", \"\" } ;\n-      dialog.printInstructions( defInstr );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n+    @Override\n+    public int print(Graphics graphics, PageFormat pageFormat, int pageIndex) {\n+        if (pageIndex > 1) {\n+            return Printable.NO_SUCH_PAGE;\n+        }\n+\n+        Graphics2D g2d = (Graphics2D) graphics;\n+        g2d.translate(pageFormat.getImageableX(), pageFormat.getImageableY());\n+        g2d.drawString(\"ORIGIN\", 30, 30);\n+        g2d.drawString(\"X THIS WAY\", 200, 50);\n+        g2d.drawString(\"Y THIS WAY\", 60, 200);\n+        g2d.drawRect(0, 0,\n+                (int) pageFormat.getImageableWidth(),\n+                (int) pageFormat.getImageableHeight());\n+        if (pageIndex == 0) {\n+            g2d.setColor(Color.black);\n+        } else {\n+            g2d.setColor(new Color(0, 0, 0, 128));\n+        }\n+        g2d.drawRect(1, 1,\n+                (int) pageFormat.getImageableWidth() - 2,\n+                (int) pageFormat.getImageableHeight() - 2);\n+        g2d.drawLine(0, 0,\n+                (int) pageFormat.getImageableWidth(),\n+                (int) pageFormat.getImageableHeight());\n+        g2d.drawLine((int) pageFormat.getImageableWidth(), 0,\n+                0, (int) pageFormat.getImageableHeight());\n+\n+        return Printable.PAGE_EXISTS;\n@@ -151,4 +110,27 @@\n-\n-   public static void printInstructions( String[] instructions )\n-    {\n-      dialog.printInstructions( instructions );\n+    private static final String INSTRUCTIONS =\n+            \" Press the print button, which brings up a print dialog.\\n\" +\n+            \" In the dialog select a printer and press the print button.\\n\\n\" +\n+            \" Repeat for all the printers as you have installed\\n\" +\n+            \" On Solaris and Linux just one printer is sufficient.\\n\\n\" +\n+            \" Collect the output and examine it, each print job has two pages\\n\" +\n+            \" of very similar output, except that the 2nd page of the job may\\n\" +\n+            \" appear in a different colour, and the output near the edge of\\n\" +\n+            \" the page may be clipped. This is OK. Hold up both pieces of paper\\n\" +\n+            \" to the light and confirm that the lines and text (where present)\\n\" +\n+            \" are positioned identically on both pages\\n\\n\" +\n+            \" The test fails if the output from the two\\n\" +\n+            \" pages of a job is aligned differently\";\n+\n+    public static void main(String[] args) throws Exception {\n+        if (PrinterJob.lookupPrintServices().length == 0) {\n+            throw new RuntimeException(\"Printer not configured or available.\");\n+        }\n+\n+        PassFailJFrame.builder()\n+                .instructions(INSTRUCTIONS)\n+                .testTimeOut(10)\n+                .splitUI(InvalidPage::createTestUI)\n+                .rows((int) INSTRUCTIONS.lines().count() + 1)\n+                .columns(45)\n+                .build()\n+                .awaitAndCheck();\n@@ -156,88 +138,1 @@\n-\n-\n-   public static void println( String messageIn )\n-    {\n-      dialog.displayMessage( messageIn );\n-    }\n-\n-}\/\/ Sysout  class\n-\n-\/**\n-  This is part of the standard test machinery.  It provides a place for the\n-   test instructions to be displayed, and a place for interactive messages\n-   to the user to be displayed.\n-  To have the test instructions displayed, see Sysout.\n-  To have a message to the user be displayed, see Sysout.\n-  Do not call anything in this dialog directly.\n-  *\/\n-class TestDialog extends Dialog {\n-\n-   TextArea instructionsText;\n-   TextArea messageText;\n-   int maxStringLength = 80;\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public TestDialog( Frame frame, String name )\n-    {\n-      super( frame, name );\n-      int scrollBoth = TextArea.SCROLLBARS_BOTH;\n-      instructionsText = new TextArea( \"\", 15, maxStringLength, scrollBoth );\n-      add( \"North\", instructionsText );\n-\n-      messageText = new TextArea( \"\", 5, maxStringLength, scrollBoth );\n-      add(\"Center\", messageText);\n-\n-      pack();\n-\n-      show();\n-    }\/\/ TestDialog()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void printInstructions( String[] instructions )\n-    {\n-      \/\/Clear out any current instructions\n-      instructionsText.setText( \"\" );\n-\n-      \/\/Go down array of instruction strings\n-\n-      String printStr, remainingStr;\n-      for( int i=0; i < instructions.length; i++ )\n-       {\n-         \/\/chop up each into pieces maxSringLength long\n-         remainingStr = instructions[ i ];\n-         while( remainingStr.length() > 0 )\n-          {\n-            \/\/if longer than max then chop off first max chars to print\n-            if( remainingStr.length() >= maxStringLength )\n-             {\n-               \/\/Try to chop on a word boundary\n-               int posOfSpace = remainingStr.\n-                  lastIndexOf( ' ', maxStringLength - 1 );\n-\n-               if( posOfSpace <= 0 ) posOfSpace = maxStringLength - 1;\n-\n-               printStr = remainingStr.substring( 0, posOfSpace + 1 );\n-               remainingStr = remainingStr.substring( posOfSpace + 1 );\n-             }\n-            \/\/else just print\n-            else\n-             {\n-               printStr = remainingStr;\n-               remainingStr = \"\";\n-             }\n-\n-            instructionsText.append( printStr + \"\\n\" );\n-\n-          }\/\/ while\n-\n-       }\/\/ for\n-\n-    }\/\/printInstructions()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void displayMessage( String messageIn )\n-    {\n-      messageText.append( messageIn + \"\\n\" );\n-    }\n-\n- }\/\/ TestDialog  class\n+}\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/InvalidPage.java","additions":104,"deletions":209,"binary":false,"changes":313,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,7 @@\n-\/**\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterJob;\n+\n+\/*\n@@ -29,0 +35,2 @@\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -31,4 +39,0 @@\n-\n-import java.awt.*;\n-import java.awt.print.*;\n-\n@@ -36,0 +40,23 @@\n+    private static final String THE_NAME = \"Testing the Job name setting\";\n+\n+    private static final String INSTRUCTIONS =\n+            \"This test prints a page with a banner\/job name of\\n\\n\" +\n+            THE_NAME;\n+\n+    public static void main(String[] args) throws Exception {\n+        if (PrinterJob.lookupPrintServices().length == 0) {\n+            throw new RuntimeException(\"Printer not configured or available.\");\n+        }\n+\n+        PassFailJFrame passFailJFrame = PassFailJFrame.builder()\n+                .instructions(INSTRUCTIONS)\n+                .rows((int) INSTRUCTIONS.lines().count() + 1)\n+                .columns(45)\n+                .build();\n+\n+        PrinterJob job = PrinterJob.getPrinterJob();\n+        job.setJobName(THE_NAME);\n+        job.setPrintable(new PrinterJobName());\n+        job.print();\n+        passFailJFrame.awaitAndCheck();\n+    }\n@@ -37,28 +64,1 @@\n-\n-  static String theName = \"Testing the Jobname setting\";\n-\n-  public static void main(String[] args) {\n-\n-       String[] instructions =\n-        {\n-         \"You must have a printer available to perform this test\",\n-         \"This test prints a page with a banner\/job name of\",\n-          theName\n-       };\n-\n-      Sysout.createDialog( );\n-      Sysout.printInstructions( instructions );\n-\n-      PrinterJob job = PrinterJob.getPrinterJob();\n-      job.setJobName(theName);\n-      job.setPrintable(new PrinterJobName());\n-      try {\n-          job.print();\n-          System.out.println(\"PRINTING DONE.\");\n-      }\n-      catch (Exception exc) {\n-          System.out.println(\"Printer Exception\");\n-      }\n-  }\n-\n-\n+    @Override\n@@ -66,10 +66,8 @@\n-      if (pgIndex > 0 ) {\n-          return Printable.NO_SUCH_PAGE;\n-      }\n-\n-      double iw = pgFmt.getImageableWidth();\n-      double ih = pgFmt.getImageableHeight();\n-      Graphics2D g2d = (Graphics2D)g;\n-      g2d.translate(pgFmt.getImageableX(), pgFmt.getImageableY());\n-      g2d.drawString(\"Name is: \"+theName,20,20 );\n-      return Printable.PAGE_EXISTS;\n+        if (pgIndex > 0) {\n+            return Printable.NO_SUCH_PAGE;\n+        }\n+\n+        Graphics2D g2d = (Graphics2D) g;\n+        g2d.translate(pgFmt.getImageableX(), pgFmt.getImageableY());\n+        g2d.drawString(\"Name is: \" + THE_NAME, 20, 20);\n+        return Printable.PAGE_EXISTS;\n@@ -77,1 +75,0 @@\n-\n@@ -79,115 +76,0 @@\n-\n-\n-class Sysout {\n-   private static TestDialog dialog;\n-\n-   public static void createDialogWithInstructions( String[] instructions )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      dialog.printInstructions( instructions );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-   public static void createDialog( )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      String[] defInstr = { \"Instructions will appear here. \", \"\" } ;\n-      dialog.printInstructions( defInstr );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-\n-   public static void printInstructions( String[] instructions )\n-    {\n-      dialog.printInstructions( instructions );\n-    }\n-\n-\n-   public static void println( String messageIn )\n-    {\n-      dialog.displayMessage( messageIn );\n-    }\n-\n-}\/\/ Sysout  class\n-\n-\/**\n-  This is part of the standard test machinery.  It provides a place for the\n-   test instructions to be displayed, and a place for interactive messages\n-   to the user to be displayed.\n-  To have the test instructions displayed, see Sysout.\n-  To have a message to the user be displayed, see Sysout.\n-  Do not call anything in this dialog directly.\n-  *\/\n-class TestDialog extends Dialog {\n-\n-   TextArea instructionsText;\n-   TextArea messageText;\n-   int maxStringLength = 80;\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public TestDialog( Frame frame, String name )\n-    {\n-      super( frame, name );\n-      int scrollBoth = TextArea.SCROLLBARS_BOTH;\n-      instructionsText = new TextArea( \"\", 15, maxStringLength, scrollBoth );\n-      add( \"North\", instructionsText );\n-\n-      messageText = new TextArea( \"\", 5, maxStringLength, scrollBoth );\n-      add(\"Center\", messageText);\n-\n-      pack();\n-\n-      show();\n-    }\/\/ TestDialog()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void printInstructions( String[] instructions )\n-    {\n-      \/\/Clear out any current instructions\n-      instructionsText.setText( \"\" );\n-\n-      \/\/Go down array of instruction strings\n-\n-      String printStr, remainingStr;\n-      for( int i=0; i < instructions.length; i++ )\n-       {\n-         \/\/chop up each into pieces maxSringLength long\n-         remainingStr = instructions[ i ];\n-         while( remainingStr.length() > 0 )\n-          {\n-            \/\/if longer than max then chop off first max chars to print\n-            if( remainingStr.length() >= maxStringLength )\n-             {\n-               \/\/Try to chop on a word boundary\n-               int posOfSpace = remainingStr.\n-                  lastIndexOf( ' ', maxStringLength - 1 );\n-\n-               if( posOfSpace <= 0 ) posOfSpace = maxStringLength - 1;\n-\n-               printStr = remainingStr.substring( 0, posOfSpace + 1 );\n-               remainingStr = remainingStr.substring( posOfSpace + 1 );\n-             }\n-            \/\/else just print\n-            else\n-             {\n-               printStr = remainingStr;\n-               remainingStr = \"\";\n-             }\n-\n-            instructionsText.append( printStr + \"\\n\" );\n-\n-          }\/\/ while\n-\n-       }\/\/ for\n-\n-    }\/\/printInstructions()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void displayMessage( String messageIn )\n-    {\n-      messageText.append( messageIn + \"\\n\" );\n-    }\n-\n- }\/\/ TestDialog  class\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/JobName\/PrinterJobName.java","additions":42,"deletions":160,"binary":false,"changes":202,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2024, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,8 @@\n-\/**\n+import java.awt.Color;\n+import java.awt.Graphics;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n+\n+\/*\n@@ -29,0 +36,2 @@\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -31,4 +40,0 @@\n-\n-import java.awt.*;\n-import java.awt.print.*;\n-\n@@ -36,19 +41,20 @@\n-\n-\n-  public static void main(String[] args) {\n-\n-  String[] instructions =\n-        {\n-         \"You must have a printer available to perform this test\",\n-         \"This test should print a total of four pages which are two\",\n-         \" copies of each of two pages which consist of the text :-\",\n-         \"'This is page number N', where N is 0 and 1.\",\n-         \"The pages should be uncollated.\"\n-       };\n-      Sysout.createDialog( );\n-      Sysout.printInstructions( instructions );\n-\n-    PrinterJob job = PrinterJob.getPrinterJob();\n-    job.setCopies(2);\n-    job.setPrintable(new NumCopies());\n-    try {\n+    private static final String INSTRUCTIONS =\n+            \"This test should print four pages, which are \\n\" +\n+            \"two copies of each page with the text :-\\n\" +\n+            \"'This is page number N', where N is 0 and 1.\\n\" +\n+            \"The pages should be uncollated.\";\n+\n+    public static void main(String[] args) throws Exception {\n+        if (PrinterJob.lookupPrintServices().length == 0) {\n+            throw new RuntimeException(\"Printer not configured or available.\");\n+        }\n+\n+        PassFailJFrame passFailJFrame = PassFailJFrame.builder()\n+                .instructions(INSTRUCTIONS)\n+                .rows((int) INSTRUCTIONS.lines().count() + 1)\n+                .columns(45)\n+                .build();\n+\n+        PrinterJob job = PrinterJob.getPrinterJob();\n+        job.setCopies(2);\n+        job.setPrintable(new NumCopies());\n@@ -56,0 +62,1 @@\n+        passFailJFrame.awaitAndCheck();\n@@ -57,4 +64,0 @@\n-    catch (Exception exc) {\n-        System.out.println(\"Printer Exception\");\n-    }\n-  }\n@@ -62,5 +65,10 @@\n-  public int print(Graphics g, PageFormat pf, int pageIndex)\n-                   throws PrinterException {\n-\n-    if (pageIndex > 1) {\n-         return NO_SUCH_PAGE;\n+    @Override\n+    public int print(Graphics g, PageFormat pf, int pageIndex)\n+            throws PrinterException {\n+        if (pageIndex > 1) {\n+            return NO_SUCH_PAGE;\n+        }\n+        g.translate((int) pf.getImageableX(), (int) pf.getImageableY());\n+        g.setColor(Color.black);\n+        g.drawString(\"This is page number \" + pageIndex, 50, 50);\n+        return PAGE_EXISTS;\n@@ -68,6 +76,0 @@\n-    g.translate((int)pf.getImageableX(), (int)pf.getImageableY());\n-    g.setColor(Color.black);\n-    g.drawString(\"This is page number \" + Integer.toString(pageIndex), 50, 50);\n-    return PAGE_EXISTS ;\n-   }\n-\n@@ -75,115 +77,0 @@\n-\n-class Sysout\n- {\n-   private static TestDialog dialog;\n-\n-   public static void createDialogWithInstructions( String[] instructions )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      dialog.printInstructions( instructions );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-   public static void createDialog( )\n-    {\n-      dialog = new TestDialog( new Frame(), \"Instructions\" );\n-      String[] defInstr = { \"Instructions will appear here. \", \"\" } ;\n-      dialog.printInstructions( defInstr );\n-      dialog.show();\n-      println( \"Any messages for the tester will display here.\" );\n-    }\n-\n-\n-   public static void printInstructions( String[] instructions )\n-    {\n-      dialog.printInstructions( instructions );\n-    }\n-\n-\n-   public static void println( String messageIn )\n-    {\n-      dialog.displayMessage( messageIn );\n-    }\n-\n- }\/\/ Sysout  class\n-\n-\/**\n-  This is part of the standard test machinery.  It provides a place for the\n-   test instructions to be displayed, and a place for interactive messages\n-   to the user to be displayed.\n-  To have the test instructions displayed, see Sysout.\n-  To have a message to the user be displayed, see Sysout.\n-  Do not call anything in this dialog directly.\n-  *\/\n-class TestDialog extends Dialog {\n-\n-   TextArea instructionsText;\n-   TextArea messageText;\n-   int maxStringLength = 80;\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public TestDialog( Frame frame, String name )\n-    {\n-      super( frame, name );\n-      int scrollBoth = TextArea.SCROLLBARS_BOTH;\n-      instructionsText = new TextArea( \"\", 15, maxStringLength, scrollBoth );\n-      add( \"North\", instructionsText );\n-\n-      messageText = new TextArea( \"\", 5, maxStringLength, scrollBoth );\n-      add(\"Center\", messageText);\n-\n-      pack();\n-\n-      show();\n-    }\/\/ TestDialog()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void printInstructions( String[] instructions )\n-    {\n-      \/\/Clear out any current instructions\n-      instructionsText.setText( \"\" );\n-\n-      \/\/Go down array of instruction strings\n-\n-      String printStr, remainingStr;\n-      for( int i=0; i < instructions.length; i++ )\n-       {\n-         \/\/chop up each into pieces maxSringLength long\n-         remainingStr = instructions[ i ];\n-         while( remainingStr.length() > 0 )\n-          {\n-            \/\/if longer than max then chop off first max chars to print\n-            if( remainingStr.length() >= maxStringLength )\n-             {\n-               \/\/Try to chop on a word boundary\n-               int posOfSpace = remainingStr.\n-                  lastIndexOf( ' ', maxStringLength - 1 );\n-\n-               if( posOfSpace <= 0 ) posOfSpace = maxStringLength - 1;\n-\n-               printStr = remainingStr.substring( 0, posOfSpace + 1 );\n-               remainingStr = remainingStr.substring( posOfSpace + 1 );\n-             }\n-            \/\/else just print\n-            else\n-             {\n-               printStr = remainingStr;\n-               remainingStr = \"\";\n-             }\n-\n-            instructionsText.append( printStr + \"\\n\" );\n-\n-          }\/\/ while\n-\n-       }\/\/ for\n-\n-    }\/\/printInstructions()\n-\n-   \/\/DO NOT call this directly, go through Sysout\n-   public void displayMessage( String messageIn )\n-    {\n-      messageText.append( messageIn + \"\\n\" );\n-    }\n-\n- }\/\/ TestDialog  class\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/NumCopies.java","additions":42,"deletions":155,"binary":false,"changes":197,"status":"modified"}]}