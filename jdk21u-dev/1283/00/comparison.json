{"files":[{"patch":"@@ -30,1 +30,1 @@\n-\n+import java.util.stream.Collectors;\n@@ -1238,0 +1238,1 @@\n+\n@@ -1239,0 +1240,3 @@\n+        Set<Long> supportedMechSet =\n+                Arrays.stream(supportedMechanisms).boxed().collect\n+                (Collectors.toCollection(HashSet::new));\n@@ -1247,1 +1251,1 @@\n-                                        new HashMap<Descriptor,Integer>();\n+                new HashMap<Descriptor,Integer>();\n@@ -1249,2 +1253,1 @@\n-        for (int i = 0; i < supportedMechanisms.length; i++) {\n-            long longMech = supportedMechanisms[i];\n+        for (long longMech : supportedMechanisms) {\n@@ -1284,0 +1287,1 @@\n+                    \/\/ check all required mechs are supported\n@@ -1285,6 +1289,11 @@\n-                        \/\/ Check that other mechanisms required for the\n-                        \/\/ service are supported before listing it as\n-                        \/\/ available for the first time.\n-                        for (int requiredMech : d.requiredMechs) {\n-                            if (token.getMechanismInfo(\n-                                    requiredMech & 0xFFFFFFFFL) == null) {\n+                        for (int reqMech : d.requiredMechs) {\n+                            long longReqMech = reqMech & 0xFFFFFFFFL;\n+                            if (!config.isEnabled(longReqMech) ||\n+                                    !supportedMechSet.contains(longReqMech) \/*||\n+                                    brokenMechanisms.contains(longReqMech)*\/) {\n+                                if (showInfo) {\n+                                    System.out.println(\"DISABLED \" + d.type +\n+                                        \" \" + d.algorithm +\n+                                        \" due to no support for req'd mech \" +\n+                                        Functions.getMechanismName(longReqMech));\n+                                }\n@@ -1303,1 +1312,1 @@\n-                                System.out.println(\"DISABLED \" +  d.type +\n+                                System.out.println(\"DISABLED \" + d.type +\n@@ -1327,1 +1336,0 @@\n-\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/SunPKCS11.java","additions":20,"deletions":12,"binary":false,"changes":32,"status":"modified"}]}