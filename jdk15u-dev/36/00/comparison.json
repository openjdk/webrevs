{"files":[{"patch":"@@ -243,1 +243,8 @@\n-  # leading spaces.\n+  # leading spaces. There may also be multiple entries on the same line, so start\n+  # with splitting such lines.\n+  # Non GNU sed (BSD on macosx) cannot substitue in literal \\n using regex.\n+  # Instead use a bash escaped literal newline. To avoid having unmatched quotes\n+  # ruin the ability for an editor to properly syntax highlight this file, define\n+  # that newline sequence as a separate variable and add the closing quote behind\n+  # a comment.\n+  sed_newline := \\'$$'\\n''#'\n@@ -246,3 +253,6 @@\n-\t    -e 's|^\\([ ]*\\)\\.\/|\\1|' \\\n-\t    -e '\/^[ ]*[^\/ ]\/s|^\\([ ]*\\)|\\1$(WORKSPACE_ROOT)\/|' \\\n-\t    $1.tmp > $1\n+\t    -e 's|\\([^ ]\\) \\{1,\\}\\([^\\\\:]\\)|\\1 \\\\$(sed_newline) \\2|g' \\\n+\t    $1.tmp \\\n+\t    | $(SED) \\\n+\t        -e 's|^\\([ ]*\\)\\.\/|\\1|' \\\n+\t        -e '\/^[ ]*[^\/ ]\/s|^\\([ ]*\\)|\\1$(WORKSPACE_ROOT)\/|' \\\n+\t        > $1\n","filename":"make\/common\/NativeCompilation.gmk","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -0,0 +1,66 @@\n+#\n+# Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.  Oracle designates this\n+# particular file as subject to the \"Classpath\" exception as provided\n+# by Oracle in the LICENSE file that accompanied this code.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+default: all\n+\n+include $(SPEC)\n+include MakeBase.gmk\n+include UtilsForTests.gmk\n+\n+THIS_FILE := $(TOPDIR)\/test\/make\/FixDepsFile.gmk\n+DEPS := $(THIS_FILE) \\\n+    $(TOPDIR)\/make\/common\/NativeCompilation.gmk \\\n+    #\n+\n+OUTPUT_DIR := $(TESTMAKE_OUTPUTDIR)\/fix-deps-file\n+$(call MakeDir, $(OUTPUT_DIR))\n+\n+################################################################################\n+# The relevant case to test is when absolute paths aren't allowed.\n+ALLOW_ABSOLUTE_PATHS_IN_OUTPUT := false\n+FILE_MACRO_CFLAGS :=\n+include NativeCompilation.gmk\n+\n+DEPS_FILE := $(OUTPUT_DIR)\/deps.d\n+\n+test-fix-deps-file:\n+\t$(ECHO) \"foo\/bar1: \\\\\" > $(DEPS_FILE).tmp\n+\t$(ECHO) \"foo\/baz1\" >> $(DEPS_FILE).tmp\n+\t$(ECHO) \"foo\/bar : bar \\\\\" >> $(DEPS_FILE).tmp\n+\t$(ECHO) \" .\/bar\/baz \/foo\/baz\" >> $(DEPS_FILE).tmp\n+\t$(call fix-deps-file, $(DEPS_FILE))\n+\t$(ECHO) \"$(WORKSPACE_ROOT)\/foo\/bar1: \\\\\" > $(DEPS_FILE).expected\n+\t$(ECHO) \"$(WORKSPACE_ROOT)\/foo\/baz1\" >> $(DEPS_FILE).expected\n+\t$(ECHO) \"$(WORKSPACE_ROOT)\/foo\/bar : \\\\\" >> $(DEPS_FILE).expected\n+\t$(ECHO) \" $(WORKSPACE_ROOT)\/bar \\\\\" >> $(DEPS_FILE).expected\n+\t$(ECHO) \" $(WORKSPACE_ROOT)\/bar\/baz \\\\\" >> $(DEPS_FILE).expected\n+\t$(ECHO) \" \/foo\/baz\" >> $(DEPS_FILE).expected\n+\t$(DIFF) $(DEPS_FILE).expected $(DEPS_FILE)\n+\n+TEST_TARGETS := test-fix-deps-file\n+\n+################################################################################\n+\n+all: $(TEST_TARGETS)\n","filename":"test\/make\/TestFixDepsFile.gmk","additions":66,"deletions":0,"binary":false,"changes":66,"status":"added"},{"patch":"@@ -39,0 +39,3 @@\n+fix-deps-file:\n+\t+$(MAKE) -f TestFixDepsFile.gmk $(TEST_SUBTARGET)\n+\n@@ -49,1 +52,2 @@\n-TARGETS += make-base java-compilation copy-files idea compile-commands configure\n+TARGETS += make-base java-compilation copy-files fix-deps-file idea \\\n+    compile-commands configure\n","filename":"test\/make\/TestMake.gmk","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"}]}