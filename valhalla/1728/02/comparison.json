{"files":[{"patch":"@@ -1261,1 +1261,2 @@\n-                                                PrologueVisitorMode.SUPER_CONSTRUCTOR);\n+                                                PrologueVisitorMode.SUPER_CONSTRUCTOR,\n+                                false);\n@@ -1285,0 +1286,1 @@\n+        boolean isInitializer;\n@@ -1286,1 +1288,1 @@\n-        CtorPrologueVisitor(Env<AttrContext> localEnv, PrologueVisitorMode mode) {\n+        CtorPrologueVisitor(Env<AttrContext> localEnv, PrologueVisitorMode mode, boolean isInitializer) {\n@@ -1290,0 +1292,1 @@\n+            this.isInitializer = isInitializer;\n@@ -1518,1 +1521,3 @@\n-                            (!localEnv.enclClass.sym.isValueClass() && (sym.flags_field & HASINIT) != 0))\n+                            (!localEnv.enclClass.sym.isValueClass() &&\n+                             (sym.flags_field & HASINIT) != 0 &&\n+                             !isInitializer))\n@@ -1645,0 +1650,1 @@\n+                Env<AttrContext> initEnv = memberEnter.initEnv(tree, env);\n@@ -1651,1 +1657,0 @@\n-                    Env<AttrContext> initEnv = memberEnter.initEnv(tree, env);\n@@ -1668,6 +1673,0 @@\n-                        if (allowValueClasses && v.owner.kind == TYP && !v.isStatic()) {\n-                            \/\/ strict field initializers are inlined in constructor's prologues\n-                            CtorPrologueVisitor ctorPrologueVisitor = new CtorPrologueVisitor(initEnv,\n-                                    !v.isStrict() ? PrologueVisitorMode.WARNINGS_ONLY : PrologueVisitorMode.SUPER_CONSTRUCTOR);\n-                            ctorPrologueVisitor.scan(tree.init);\n-                        }\n@@ -1678,0 +1677,7 @@\n+                if (allowValueClasses && v.owner.kind == TYP && !v.isStatic()) {\n+                    \/\/ strict field initializers are inlined in constructor's prologues\n+                    CtorPrologueVisitor ctorPrologueVisitor = new CtorPrologueVisitor(initEnv,\n+                            !v.isStrict() ? PrologueVisitorMode.WARNINGS_ONLY : PrologueVisitorMode.SUPER_CONSTRUCTOR,\n+                            true);\n+                    ctorPrologueVisitor.scan(tree.init);\n+                }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":16,"deletions":10,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -10,0 +10,1 @@\n+    int b = 5;\n@@ -12,1 +13,0 @@\n-\n@@ -181,0 +181,4 @@\n+\n+    \/\/ these two should FAIL\n+    int a = b;\n+    int aa = super.b;\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/ValueClassSuperInitFails.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -17,0 +17,2 @@\n+ValueClassSuperInitFails.java:183:13: compiler.err.cant.ref.before.ctor.called: b\n+ValueClassSuperInitFails.java:184:19: compiler.err.cant.ref.before.ctor.called: b\n@@ -28,1 +30,1 @@\n-25 errors\n+27 errors\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/ValueClassSuperInitFails.out","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"}]}