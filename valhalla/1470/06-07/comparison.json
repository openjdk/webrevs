{"files":[{"patch":"@@ -788,2 +788,10 @@\n-        const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n-        store_flat(kit, cast, ptr, ptr_type, true, false, true, decorators);\n+\n+        if (vk->get_field_by_offset(vk->payload_offset(), false) == nullptr) {\n+          \/\/ TODO 8357612 Weird layout\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+          store_flat(kit, cast, ptr, TypeRawPtr::BOTTOM, true, false, true, decorators | C2_MISMATCHED);\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+        } else {\n+          const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n+          store_flat(kit, cast, ptr, ptr_type, true, false, true, decorators);\n+        }\n@@ -802,2 +810,10 @@\n-        const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n-        store_flat(kit, cast, ptr, ptr_type, false, false, true, decorators);\n+\n+        if (vk->get_field_by_offset(vk->payload_offset(), false) == nullptr) {\n+          \/\/ TODO 8357612 Weird layout\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+          store_flat(kit, cast, ptr, TypeRawPtr::BOTTOM, false, false, true, decorators | C2_MISMATCHED);\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+        } else {\n+          const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n+          store_flat(kit, cast, ptr, ptr_type, false, false, true, decorators);\n+        }\n@@ -1350,2 +1366,10 @@\n-        const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n-        vt_null_free = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, ptr_type, true, false, true, decorators);\n+\n+        if (vk->get_field_by_offset(vk->payload_offset(), false) == nullptr) {\n+          \/\/ TODO 8357612 Weird layout\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+          vt_null_free = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, TypeRawPtr::BOTTOM, true, false, true, decorators | C2_MISMATCHED);\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+        } else {\n+          const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n+          vt_null_free = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, ptr_type, true, false, true, decorators);\n+        }\n@@ -1367,2 +1391,10 @@\n-        const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n-        vt_non_atomic = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, ptr_type, false, false, true, decorators);\n+\n+        if (vk->get_field_by_offset(vk->payload_offset(), false) == nullptr) {\n+          \/\/ TODO 8357612 Weird layout\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+          vt_non_atomic = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, TypeRawPtr::BOTTOM, false, false, true, decorators | C2_MISMATCHED);\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+        } else {\n+          const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n+          vt_non_atomic = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, ptr_type, false, false, true, decorators);\n+        }\n","filename":"src\/hotspot\/share\/opto\/inlinetypenode.cpp","additions":40,"deletions":8,"binary":false,"changes":48,"status":"modified"}]}