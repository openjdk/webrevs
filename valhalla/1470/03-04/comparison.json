{"files":[{"patch":"@@ -753,2 +753,9 @@\n-    const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n-    store_flat(kit, cast, ptr, ptr_type, true, false, false, decorators);\n+    if (vk->nof_nonstatic_fields() == 0 && vk->null_marker_offset_in_payload() != 0) {\n+      \/\/ Weird layout\n+      kit->insert_mem_bar(Op_MemBarCPUOrder);\n+      store_flat(kit, cast, ptr, TypeRawPtr::BOTTOM, true, false, false, decorators | C2_MISMATCHED);\n+      kit->insert_mem_bar(Op_MemBarCPUOrder);\n+    } else {\n+      const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n+      store_flat(kit, cast, ptr, ptr_type, true, false, false, decorators);\n+    }\n@@ -1305,2 +1312,9 @@\n-    const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n-    vt_nullable = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, ptr_type, true, false, false, decorators);\n+    if (vk->nof_nonstatic_fields() == 0 && vk->null_marker_offset_in_payload() != 0) {\n+      \/\/ Weird layout\n+      kit->insert_mem_bar(Op_MemBarCPUOrder);\n+      vt_nullable = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, TypeRawPtr::BOTTOM, true, false, false, decorators | C2_MISMATCHED);\n+      kit->insert_mem_bar(Op_MemBarCPUOrder);\n+    } else {\n+      const TypeAryPtr* ptr_type = gvn.type(cast)->is_aryptr()->with_field_offset(0)->with_offset(TypePtr::OffsetBot);\n+      vt_nullable = InlineTypeNode::make_from_flat(kit, vk, cast, ptr, ptr_type, true, false, false, decorators);\n+    }\n","filename":"src\/hotspot\/share\/opto\/inlinetypenode.cpp","additions":18,"deletions":4,"binary":false,"changes":22,"status":"modified"}]}