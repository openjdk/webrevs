{"files":[{"patch":"@@ -102,0 +102,3 @@\n+                if (U.hasNullMarker(f)) {\n+                    sink.accept(U.nullMarkerOffset(f) + memberOffsetDelta, byte.class);\n+                }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/value\/LayoutIteration.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -69,1 +69,1 @@\n-    void test() {\n+    void testExample() {\n@@ -89,0 +89,74 @@\n+\n+    static value class IntValue {\n+        int value;\n+\n+        static final int[] EDGE_CASES = {\n+                0, -1, 1,\n+                Integer.MIN_VALUE, Integer.MAX_VALUE\n+        };\n+\n+        public IntValue(int index) {\n+            value = EDGE_CASES[index];\n+        }\n+\n+        public String toString() {\n+            return \"IntValue(\" + value +\n+                    \", bits=0x\" + Integer.toHexString(value) + \")\";\n+        }\n+\n+        static boolean cmp(int i, int j) {\n+            return EDGE_CASES[i] == EDGE_CASES[j];\n+        }\n+    }\n+\n+    static value class NestedValue {\n+        SubstitutabilityTest.IntValue value;\n+\n+        static final SubstitutabilityTest.IntValue[] EDGE_CASES = {\n+                null, new SubstitutabilityTest.IntValue(0), new SubstitutabilityTest.IntValue(1), new SubstitutabilityTest.IntValue(2),\n+                new SubstitutabilityTest.IntValue(3), new SubstitutabilityTest.IntValue(0)\n+        };\n+\n+        public NestedValue(int index) {\n+            value = EDGE_CASES[index];\n+        }\n+\n+        public String toString() {\n+            return \"NestedValue(\" + value + \")\";\n+        }\n+\n+        static boolean cmp(int i, int j) {\n+            return EDGE_CASES[i] == EDGE_CASES[j];\n+        }\n+    }\n+\n+    @Test\n+    void testNested() {\n+        NestedValue v = new NestedValue(0);\n+        Map<Class<?>, Object> values = LayoutIteration.computeElementGetters(NestedValue.class).stream()\n+                .collect(Collectors.toMap(mh -> mh.type().returnType(), mh -> {\n+                    try {\n+                        return (Object) mh.invoke(v);\n+                    } catch (Throwable ex) {\n+                        return Assertions.fail(ex);\n+                    }\n+                }));\n+        assertEquals(Map.of(\n+                int.class, 0,\n+                byte.class, (byte) 0 \/\/ null marker\n+        ), values);\n+\n+        NestedValue v1 = new NestedValue(2);\n+        Map<Class<?>, Object> values1 = LayoutIteration.computeElementGetters(NestedValue.class).stream()\n+                .collect(Collectors.toMap(mh -> mh.type().returnType(), mh -> {\n+                    try {\n+                        return (Object) mh.invoke(v1);\n+                    } catch (Throwable ex) {\n+                        return Assertions.fail(ex);\n+                    }\n+                }));\n+        assertEquals(Map.of(\n+                int.class, NestedValue.EDGE_CASES[2].value,\n+                byte.class, (byte) 1 \/\/ null marker\n+        ), values1);\n+    }\n","filename":"test\/jdk\/valhalla\/valuetypes\/LayoutIterationTest.java","additions":75,"deletions":1,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -191,0 +191,60 @@\n+\n+    static value class IntValue {\n+        int value;\n+\n+        static final int[] EDGE_CASES = {\n+                0, -1, 1,\n+                Integer.MIN_VALUE, Integer.MAX_VALUE\n+        };\n+\n+        public IntValue(int index) {\n+            value = EDGE_CASES[index];\n+        }\n+\n+        public String toString() {\n+            return \"IntValue(\" + value +\n+                    \", bits=0x\" + Integer.toHexString(value) + \")\";\n+        }\n+\n+        static boolean cmp(int i, int j) {\n+            return EDGE_CASES[i] == EDGE_CASES[j];\n+        }\n+    }\n+\n+    static value class NestedValue {\n+        IntValue value;\n+\n+        static final IntValue[] EDGE_CASES = {\n+                null, new IntValue(0), new IntValue(1), new IntValue(2),\n+                new IntValue(3), new IntValue(0)\n+        };\n+\n+        public NestedValue(int index) {\n+            value = EDGE_CASES[index];\n+        }\n+\n+        public String toString() {\n+            return \"NestedValue(\" + value + \")\";\n+        }\n+\n+        static boolean cmp(int i, int j) {\n+            return EDGE_CASES[i] == EDGE_CASES[j];\n+        }\n+    }\n+\n+    public static boolean testNestedValue(NestedValue v1, NestedValue v2) {\n+        return v1 == v2;\n+    }\n+\n+    @Test\n+    void testNestedValue() {\n+        \/\/ NestedValue\n+        for (int i = 0; i < NestedValue.EDGE_CASES.length; ++i) {\n+            for (int j = 0; j < NestedValue.EDGE_CASES.length; ++j) {\n+                NestedValue val1 = new NestedValue(i);\n+                NestedValue val2 = new NestedValue(j);\n+                boolean res = testNestedValue(val1, val2);\n+                assertEquals(NestedValue.cmp(i, j), res, () -> val1 + \" == \" + val2);\n+            }\n+        }\n+    }\n","filename":"test\/jdk\/valhalla\/valuetypes\/SubstitutabilityTest.java","additions":60,"deletions":0,"binary":false,"changes":60,"status":"modified"}]}