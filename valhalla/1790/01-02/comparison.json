{"files":[{"patch":"@@ -69,1 +69,1 @@\n-    void test() {\n+    void testExample() {\n@@ -89,0 +89,74 @@\n+\n+    static value class IntValue {\n+        int value;\n+\n+        static final int[] EDGE_CASES = {\n+                0, -1, 1,\n+                Integer.MIN_VALUE, Integer.MAX_VALUE\n+        };\n+\n+        public IntValue(int index) {\n+            value = EDGE_CASES[index];\n+        }\n+\n+        public String toString() {\n+            return \"IntValue(\" + value +\n+                    \", bits=0x\" + Integer.toHexString(value) + \")\";\n+        }\n+\n+        static boolean cmp(int i, int j) {\n+            return EDGE_CASES[i] == EDGE_CASES[j];\n+        }\n+    }\n+\n+    static value class NestedValue {\n+        SubstitutabilityTest.IntValue value;\n+\n+        static final SubstitutabilityTest.IntValue[] EDGE_CASES = {\n+                null, new SubstitutabilityTest.IntValue(0), new SubstitutabilityTest.IntValue(1), new SubstitutabilityTest.IntValue(2),\n+                new SubstitutabilityTest.IntValue(3), new SubstitutabilityTest.IntValue(0)\n+        };\n+\n+        public NestedValue(int index) {\n+            value = EDGE_CASES[index];\n+        }\n+\n+        public String toString() {\n+            return \"NestedValue(\" + value + \")\";\n+        }\n+\n+        static boolean cmp(int i, int j) {\n+            return EDGE_CASES[i] == EDGE_CASES[j];\n+        }\n+    }\n+\n+    @Test\n+    void testNested() {\n+        NestedValue v = new NestedValue(0);\n+        Map<Class<?>, Object> values = LayoutIteration.computeElementGetters(NestedValue.class).stream()\n+                .collect(Collectors.toMap(mh -> mh.type().returnType(), mh -> {\n+                    try {\n+                        return (Object) mh.invoke(v);\n+                    } catch (Throwable ex) {\n+                        return Assertions.fail(ex);\n+                    }\n+                }));\n+        assertEquals(Map.of(\n+                int.class, 0,\n+                byte.class, (byte) 0 \/\/ null marker\n+        ), values);\n+\n+        NestedValue v1 = new NestedValue(2);\n+        Map<Class<?>, Object> values1 = LayoutIteration.computeElementGetters(NestedValue.class).stream()\n+                .collect(Collectors.toMap(mh -> mh.type().returnType(), mh -> {\n+                    try {\n+                        return (Object) mh.invoke(v1);\n+                    } catch (Throwable ex) {\n+                        return Assertions.fail(ex);\n+                    }\n+                }));\n+        assertEquals(Map.of(\n+                int.class, NestedValue.EDGE_CASES[2].value,\n+                byte.class, (byte) 1 \/\/ null marker\n+        ), values1);\n+    }\n","filename":"test\/jdk\/valhalla\/valuetypes\/LayoutIterationTest.java","additions":75,"deletions":1,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+import jdk.internal.value.ValueClass;\n@@ -234,21 +235,0 @@\n-    static value class OuterValue {\n-        NestedValue nested;\n-\n-        static final NestedValue[] EDGE_CASES = {\n-                null, new NestedValue(0), new NestedValue(1), new NestedValue(2),\n-                new NestedValue(3), new NestedValue(0)\n-        };\n-\n-        public OuterValue(int index) {\n-            nested = EDGE_CASES[index];\n-        }\n-\n-        public String toString() {\n-            return \"Outer(\" + nested + \")\";\n-        }\n-\n-        static boolean cmp(int i, int j) {\n-            return EDGE_CASES[i] == EDGE_CASES[j];\n-        }\n-    }\n-\n@@ -261,5 +241,7 @@\n-        for (int i = 0; i < OuterValue.EDGE_CASES.length; ++i) {\n-            for (int j = 0; j < OuterValue.EDGE_CASES.length; ++j) {\n-                OuterValue val1 = new OuterValue(i);\n-                OuterValue val2 = new OuterValue(j);\n-                assertEquals(NestedValue.cmp(i, j), val1 == val2, () -> val1 + \" == \" + val2);\n+        \/\/ NestedValue\n+        for (int i = 0; i < NestedValue.EDGE_CASES.length; ++i) {\n+            for (int j = 0; j < NestedValue.EDGE_CASES.length; ++j) {\n+                NestedValue val1 = new NestedValue(i);\n+                NestedValue val2 = new NestedValue(j);\n+                boolean res = testNestedValue(val1, val2);\n+                assertEquals(NestedValue.cmp(i, j), res, () -> val1 + \" == \" + val2);\n","filename":"test\/jdk\/valhalla\/valuetypes\/SubstitutabilityTest.java","additions":8,"deletions":26,"binary":false,"changes":34,"status":"modified"}]}