{"files":[{"patch":"@@ -737,2 +737,0 @@\n-      decorators |= C2_MISMATCHED;\n-\n@@ -743,1 +741,3 @@\n-        kit->access_store_at(base, adr, TypeRawPtr::BOTTOM, payload, val_type, bt, is_array ? (decorators | IS_ARRAY) : decorators, true, this);\n+        kit->insert_mem_bar(Op_MemBarCPUOrder);\n+        kit->access_store_at(base, adr, TypeRawPtr::BOTTOM, payload, val_type, bt, decorators | C2_MISMATCHED | (is_array ? IS_ARRAY : 0), true, this);\n+        kit->insert_mem_bar(Op_MemBarCPUOrder);\n@@ -765,3 +765,0 @@\n-        kit->set_control(kit->IfFalse(iff));\n-        region->init_req(1, kit->control());\n-\n@@ -769,0 +766,1 @@\n+        kit->set_control(kit->IfFalse(iff));\n@@ -771,1 +769,3 @@\n-          kit->access_store_at(base, ptr, TypeRawPtr::BOTTOM, payload, val_type, bt, is_array ? (decorators | IS_ARRAY) : decorators, true, this);\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n+          kit->access_store_at(base, ptr, TypeRawPtr::BOTTOM, payload, val_type, bt, decorators | C2_MISMATCHED | (is_array ? IS_ARRAY : 0), true, this);\n+          kit->insert_mem_bar(Op_MemBarCPUOrder);\n@@ -775,2 +775,1 @@\n-\n-        kit->set_control(kit->IfTrue(iff));\n+        region->init_req(1, kit->control());\n@@ -779,0 +778,1 @@\n+        kit->set_control(kit->IfTrue(iff));\n@@ -798,3 +798,0 @@\n-          kit->set_control(kit->IfTrue(iff));\n-          region_null_free->init_req(1, kit->control());\n-\n@@ -802,0 +799,1 @@\n+          kit->set_control(kit->IfTrue(iff));\n@@ -813,1 +811,3 @@\n-            kit->access_store_at(cast, adr, TypeRawPtr::BOTTOM, payload, val_type_null_free, bt_null_free, is_array ? (decorators | IS_ARRAY) : decorators, true, this);\n+            kit->insert_mem_bar(Op_MemBarCPUOrder);\n+            kit->access_store_at(cast, adr, TypeRawPtr::BOTTOM, payload, val_type_null_free, bt_null_free, decorators | C2_MISMATCHED | (is_array ? IS_ARRAY : 0), true, this);\n+            kit->insert_mem_bar(Op_MemBarCPUOrder);\n@@ -817,3 +817,1 @@\n-\n-          kit->set_control(kit->IfFalse(iff));\n-          region_null_free->init_req(2, kit->control());\n+          region_null_free->init_req(1, kit->control());\n@@ -822,0 +820,1 @@\n+          kit->set_control(kit->IfFalse(iff));\n@@ -828,1 +827,0 @@\n-\n@@ -832,0 +830,1 @@\n+          region_null_free->init_req(2, kit->control());\n@@ -846,2 +845,0 @@\n-      const TypePtr* adr_type = TypeRawPtr::BOTTOM;\n-      Node* mem = kit->memory(adr_type);\n@@ -851,2 +848,6 @@\n-      Node* st = kit->gvn().transform(new StoreLSpecialNode(kit->control(), mem, adr, adr_type, payload, oop_offset, MemNode::unordered));\n-      kit->set_memory(st, adr_type);\n+      kit->insert_mem_bar(Op_MemBarCPUOrder);\n+      Node* mem = kit->reset_memory();\n+      kit->set_all_memory(mem);\n+      Node* st = kit->gvn().transform(new StoreLSpecialNode(kit->control(), mem, adr, TypeRawPtr::BOTTOM, payload, oop_offset, MemNode::unordered));\n+      kit->set_memory(st, TypeRawPtr::BOTTOM);\n+      kit->insert_mem_bar(Op_MemBarCPUOrder);\n@@ -854,2 +855,0 @@\n-    \/\/ Prevent loads from floating above this mismatched store\n-    kit->insert_mem_bar(Op_MemBarCPUOrder);\n","filename":"src\/hotspot\/share\/opto\/inlinetypenode.cpp","additions":22,"deletions":23,"binary":false,"changes":45,"status":"modified"}]}