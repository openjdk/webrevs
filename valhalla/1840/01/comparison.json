{"files":[{"patch":"@@ -2799,2 +2799,2 @@\n-      Label is_flat, rewrite_inline;\n-      __ test_field_is_flat(flags, noreg \/*temp*\/, is_flat);\n+      Label is_flat;\n+      __ test_field_is_flat(flags, noreg \/* temp *\/, is_flat);\n@@ -2808,6 +2808,5 @@\n-        \/\/ field is flat (null-free or nullable with a null-marker)\n-        __ mov(r0, obj);\n-        __ read_flat_field(cache, field_index, off, inline_klass \/* temp *\/, r0);\n-        __ verify_oop(r0);\n-        __ push(atos);\n-      __ bind(rewrite_inline);\n+      \/\/ field is flat (null-free or nullable with a null-marker)\n+      __ mov(r0, obj);\n+      __ read_flat_field(cache, field_index, off, inline_klass \/* temp *\/, r0);\n+      __ verify_oop(r0);\n+      __ push(atos);\n@@ -2982,1 +2981,0 @@\n-  const Register inline_klass = r5;\n@@ -3040,1 +3038,1 @@\n-     if (!Arguments::is_valhalla_enabled()) {\n+    if (!Arguments::is_valhalla_enabled()) {\n@@ -3050,1 +3048,1 @@\n-     } else { \/\/ Valhalla\n+    } else { \/\/ Valhalla\n@@ -3054,5 +3052,5 @@\n-         __ test_field_is_not_null_free_inline_type(flags, noreg \/* temp *\/, is_nullable);\n-         __ null_check(r0);  \/\/ FIXME JDK-8341120\n-         __ bind(is_nullable);\n-         do_oop_store(_masm, field, r0, IN_HEAP);\n-         __ b(Done);\n+        __ test_field_is_not_null_free_inline_type(flags, noreg \/* temp *\/, is_nullable);\n+        __ null_check(r0);  \/\/ FIXME JDK-8341120\n+        __ bind(is_nullable);\n+        do_oop_store(_masm, field, r0, IN_HEAP);\n+        __ b(Done);\n@@ -3061,2 +3059,2 @@\n-        __ test_field_is_flat(flags, noreg \/*temp*\/, is_flat);\n-        __ test_field_is_null_free_inline_type(flags, noreg \/*temp*\/, null_free_reference);\n+        __ test_field_is_flat(flags, noreg \/* temp *\/, is_flat);\n+        __ test_field_is_null_free_inline_type(flags, noreg \/* temp *\/, null_free_reference);\n@@ -3081,1 +3079,1 @@\n-        __ write_flat_field(cache, off, r3, r6, r7);\n+        __ write_flat_field(cache, off, index, flags, r7);\n@@ -3088,1 +3086,1 @@\n-     }  \/\/ Valhalla\n+    } \/\/ Valhalla\n@@ -3227,1 +3225,1 @@\n-    case Bytecodes::_fast_vputfield: \/\/fall through\n+    case Bytecodes::_fast_vputfield: \/\/ fall through\n@@ -3254,1 +3252,1 @@\n-    case Bytecodes::_fast_vputfield: \/\/fall through\n+    case Bytecodes::_fast_vputfield: \/\/ fall through\n@@ -3304,1 +3302,1 @@\n-      Label is_flat, has_null_marker, done;\n+      Label is_flat, done;\n","filename":"src\/hotspot\/cpu\/aarch64\/templateTable_aarch64.cpp","additions":21,"deletions":23,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -263,1 +263,1 @@\n-  vk->write_value_to_addr(val_h(), ((char*)(oopDesc*)obj_h()) + entry->field_offset(), li->kind(), true, CHECK);\n+  vk->write_value_to_addr(val_h(), ((char*)(oopDesc*)obj_h()) + entry->field_offset(), li->kind(), CHECK);\n","filename":"src\/hotspot\/share\/interpreter\/interpreterRuntime.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -161,2 +161,1 @@\n-  assert(_desc->tos_in()  == tos_in,\n-         \"inconsistent tos_in  information\");\n+  assert(_desc->tos_in()  == tos_in , \"inconsistent tos_in  information\");\n","filename":"src\/hotspot\/share\/interpreter\/templateTable.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -85,1 +85,1 @@\n-  vk->write_value_to_addr(value, value_at_addr(index, faklass->layout_helper()), faklass->layout_kind(), true, CHECK);\n+  vk->write_value_to_addr(value, value_at_addr(index, faklass->layout_helper()), faklass->layout_kind(), CHECK);\n","filename":"src\/hotspot\/share\/oops\/flatArrayOop.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -200,1 +200,1 @@\n-    if (is_payload_marked_as_null((address)src)) {\n+      if (is_payload_marked_as_null((address)src)) {\n@@ -213,1 +213,0 @@\n-        mark_payload_as_non_null((address)src);\n@@ -266,1 +265,1 @@\n-void InlineKlass::write_value_to_addr(oop src, void* dst, LayoutKind lk, bool dest_is_initialized, TRAPS) {\n+void InlineKlass::write_value_to_addr(oop src, void* dst, LayoutKind lk, TRAPS) {\n@@ -290,1 +289,1 @@\n-  copy_payload_to_addr(src_addr, dst, lk, dest_is_initialized);\n+  copy_payload_to_addr(src_addr, dst, lk, true \/* dest_is_initialized *\/);\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.cpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -251,1 +251,1 @@\n-  void write_value_to_addr(oop src, void* dst, LayoutKind lk, bool dest_is_initialized, TRAPS);\n+  void write_value_to_addr(oop src, void* dst, LayoutKind lk, TRAPS);\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -69,2 +69,2 @@\n-\/\/ BUFFERED: this layout is only used in heap buffered instances of a value class. It is computed to be compatible\n-\/\/             to be compatible in size and alignment with all other flat layouts supported by the value class.\n+\/\/ BUFFERED:   This layout is only used in heap buffered instances of a value class. It is computed to be compatible\n+\/\/             in size and alignment with all other flat layouts supported by the value class.\n","filename":"src\/hotspot\/share\/oops\/layoutKind.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -83,1 +83,0 @@\n-  \/\/ Note: Only two flags exists at the moment but more could be added\n","filename":"src\/hotspot\/share\/oops\/resolvedFieldEntry.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -366,1 +366,1 @@\n-        vk->write_value_to_addr(h_init_val(), ((flatArrayOop)result)->value_at_addr(i, fak->layout_helper()), fak->layout_kind(), true, CHECK);\n+        vk->write_value_to_addr(h_init_val(), ((flatArrayOop)result)->value_at_addr(i, fak->layout_helper()), fak->layout_kind(), CHECK);\n","filename":"src\/hotspot\/share\/opto\/runtime.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1972,1 +1972,1 @@\n-    vklass->write_value_to_addr(v, ((char*)(oopDesc*)o) + offset, li->kind(), true, CHECK);\n+    vklass->write_value_to_addr(v, ((char*)(oopDesc*)o) + offset, li->kind(), CHECK);\n","filename":"src\/hotspot\/share\/prims\/jni.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -468,1 +468,1 @@\n-  vk->write_value_to_addr(v, ((char*)(oopDesc*)base) + offset, lk, true, CHECK);\n+  vk->write_value_to_addr(v, ((char*)(oopDesc*)base) + offset, lk, CHECK);\n","filename":"src\/hotspot\/share\/prims\/unsafe.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}