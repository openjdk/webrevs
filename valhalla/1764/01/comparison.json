{"files":[{"patch":"@@ -1805,1 +1805,1 @@\n-  __ verified_entry(C, 0);\n+  __ verified_entry(C, 0 DEBUG_ONLY(COMMA false));\n@@ -2205,1 +2205,1 @@\n-      __ verified_entry(ra_->C, 0);\n+      __ verified_entry(ra_->C, 0 DEBUG_ONLY(COMMA false));\n@@ -2214,1 +2214,1 @@\n-    __ verified_entry(ra_->C, sp_inc);\n+    __ verified_entry(ra_->C, sp_inc DEBUG_ONLY(COMMA true));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -256,1 +256,1 @@\n-  MacroAssembler::build_frame(frame_size_in_bytes);\n+  MacroAssembler::build_frame(frame_size_in_bytes DEBUG_ONLY(COMMA false));\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_MacroAssembler_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -818,5 +818,0 @@\n-#ifdef ASSERT\n-  \/\/ LR #2\n-  address sender_pc_copy = pauth_strip_verifiable((address) *(l_sender_sp - frame::return_addr_offset));\n-#endif\n-\n@@ -835,11 +830,0 @@\n-#ifdef ASSERT\n-  \/\/ when the stack was extended (so LR #1 and LR #2 are distinct) and LR #1 was patched\n-  if (*cfp.sender_pc_addr != sender_pc_copy) {\n-    \/\/ When extending the stack in the callee method entry to make room for unpacking of value\n-    \/\/ type args, we keep a copy of the sender pc at the expected location in the callee frame.\n-    \/\/ If the sender pc is patched due to deoptimization, the copy is not consistent anymore.\n-    nmethod* nm = CodeCache::find_blob(*cfp.sender_pc_addr)->as_nmethod();\n-    assert(*cfp.sender_pc_addr == nm->deopt_handler_entry(), \"unexpected sender pc\");\n-  }\n-#endif\n-\n","filename":"src\/hotspot\/cpu\/aarch64\/frame_aarch64.cpp","additions":0,"deletions":16,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -5900,1 +5900,1 @@\n-void MacroAssembler::build_frame(int framesize) {\n+void MacroAssembler::build_frame(int framesize DEBUG_ONLY(COMMA bool save_fake_rfp_lr)) {\n@@ -5906,1 +5906,10 @@\n-    stp(rfp, lr, Address(sp, framesize - 2 * wordSize));\n+#ifdef ASSERT\n+    if (save_fake_rfp_lr) {\n+      mov_immediate64(rscratch1, ((uint64_t)badRegWordVal) << 32 | (uint64_t)badRegWordVal);\n+      stp(rscratch1, rscratch1, Address(sp, framesize - 2 * wordSize));\n+    } else {\n+#endif\n+      stp(rfp, lr, Address(sp, framesize - 2 * wordSize));\n+#ifdef ASSERT\n+    }\n+#endif\n@@ -5909,1 +5918,10 @@\n-    stp(rfp, lr, Address(pre(sp, -2 * wordSize)));\n+#ifdef ASSERT\n+    if (save_fake_rfp_lr) {\n+      mov_immediate64(rscratch1, ((uint64_t)badRegWordVal) << 32 | (uint64_t)badRegWordVal);\n+      stp(rscratch1, rscratch1, Address(pre(sp, -2 * wordSize)));\n+    } else {\n+#endif\n+      stp(rfp, lr, Address(pre(sp, -2 * wordSize)));\n+#ifdef ASSERT\n+    }\n+#endif\n@@ -6925,1 +6943,1 @@\n-void MacroAssembler::verified_entry(Compile* C, int sp_inc) {\n+void MacroAssembler::verified_entry(Compile* C, int sp_inc DEBUG_ONLY(COMMA bool save_fake_rfp_lr)) {\n@@ -6947,1 +6965,1 @@\n-  build_frame(framesize);\n+  build_frame(framesize DEBUG_ONLY(COMMA save_fake_rfp_lr && C->needs_stack_repair()));\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.cpp","additions":23,"deletions":5,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -192,1 +192,1 @@\n-  void build_frame(int framesize);\n+  void build_frame(int framesize DEBUG_ONLY(COMMA bool save_fake_rfp_lr));\n@@ -1506,1 +1506,1 @@\n-  void verified_entry(Compile* C, int sp_inc);\n+  void verified_entry(Compile* C, int sp_inc DEBUG_ONLY(COMMA bool save_fake_rfp_lr));\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1047,0 +1047,1 @@\n+const juint    badRegWordVal      = 0xDEADDA7A;             \/\/ value used to zap registers\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}