{"files":[{"patch":"@@ -103,0 +103,1 @@\n+    private final NullChecksWriter nullChecksWriter;\n@@ -132,0 +133,1 @@\n+        nullChecksWriter = NullChecksWriter.instance(context);\n@@ -3395,1 +3397,2 @@\n-        if (boxingReq || depScanner.dependencyFound) {\n+        if (boxingReq || depScanner.dependencyFound ||\n+            nullChecksWriter.needsUseSiteNullCheck(tree.lhs, currentClass)) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Lower.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -189,7 +189,0 @@\n-    @Override\n-    public void visitAssignop(JCAssignOp tree) {\n-        tree.lhs = translate(tree.lhs, false);\n-        tree.rhs = translate(tree.rhs);\n-        result = tree;\n-    }\n-\n@@ -210,7 +203,2 @@\n-            Symbol sym = TreeInfo.symbolFor(tree);\n-            if (useSiteNullChecks.generateChecksForFields &&\n-                    sym.owner.kind == TYP &&\n-                    sym.kind == VAR &&\n-                    types.isNonNullable(sym.type) &&\n-                    sym.owner != currentClass &&\n-                    checkNulls) {\n+            if (needsUseSiteNullCheck(tree, currentClass) &&\n+                checkNulls) {\n@@ -344,0 +332,9 @@\n+    public boolean needsUseSiteNullCheck(JCTree tree, ClassSymbol currentClass) {\n+        Symbol sym = TreeInfo.symbolFor(tree);\n+        return sym != null &&\n+                useSiteNullChecks.generateChecksForFields &&\n+                sym.owner.kind == TYP &&\n+                sym.kind == VAR &&\n+                types.isNonNullable(sym.type) &&\n+                sym.owner != currentClass;\n+    }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/NullChecksWriter.java","additions":11,"deletions":14,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -734,0 +734,62 @@\n+        testUseSiteForFieldsSeparateCompilationHelper(base,\n+                \"\"\"\n+                package pkg;\n+                public class A {\n+                    String! value;\n+                    public A() {\n+                        this.value = \"test\";\n+                        super();\n+                    }\n+                }\n+                \"\"\",\n+                \"\"\"\n+                package pkg;\n+                public class A {\n+                    String value;\n+                    public A() {\n+                        this.value = null;\n+                        super();\n+                    }\n+                }\n+                \"\"\",\n+                \"\"\"\n+                package pkg;\n+                class Test {\n+                    public static void main(String... args) {\n+                        A a = new A();\n+                        a.value = a.value + \"\";\n+                        System.out.println(a.value);\n+                    }\n+                }\n+                \"\"\");\n+        testUseSiteForFieldsSeparateCompilationHelper(base,\n+                \"\"\"\n+                package pkg;\n+                public class A {\n+                    String! value;\n+                    public A() {\n+                        this.value = \"test\";\n+                        super();\n+                    }\n+                }\n+                \"\"\",\n+                \"\"\"\n+                package pkg;\n+                public class A {\n+                    String value;\n+                    public A() {\n+                        this.value = null;\n+                        super();\n+                    }\n+                }\n+                \"\"\",\n+                \"\"\"\n+                package pkg;\n+                class Test {\n+                    public static void main(String... args) {\n+                        A a = new A();\n+                        a.value += \"\";\n+                        System.out.println(a.value);\n+                    }\n+                }\n+                \"\"\");\n","filename":"test\/langtools\/tools\/javac\/nullability\/RuntimeNullChecks.java","additions":62,"deletions":0,"binary":false,"changes":62,"status":"modified"}]}