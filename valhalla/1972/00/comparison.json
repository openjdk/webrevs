{"files":[{"patch":"@@ -175,0 +175,2 @@\n+    boolean generateNullChecks = false;\n+\n@@ -178,5 +180,13 @@\n-        super.visitAssign(tree);\n-        Symbol lhsSym = TreeInfo.symbolFor(tree.lhs);\n-        if (lhsSym != null &&\n-                types.isNonNullable(lhsSym.type)) {\n-            tree.rhs = attr.makeNullCheck(tree.rhs, true);\n+        boolean prevGenerateNullChecks = generateNullChecks;\n+        try {\n+            generateNullChecks = false;\n+            tree.lhs = translate(tree.lhs);\n+            generateNullChecks = true;\n+            tree.rhs = translate(tree.rhs);\n+            Symbol lhsSym = TreeInfo.symbolFor(tree.lhs);\n+            if (lhsSym != null &&\n+                    types.isNonNullable(lhsSym.type)) {\n+                tree.rhs = attr.makeNullCheck(tree.rhs, true);\n+            }\n+        } finally {\n+            generateNullChecks = prevGenerateNullChecks;\n@@ -202,1 +212,2 @@\n-            if (useSiteNullChecks.generateChecksForFields &&\n+            if (generateNullChecks &&\n+                    useSiteNullChecks.generateChecksForFields &&\n@@ -215,3 +226,9 @@\n-        super.visitTypeCast(tree);\n-        if (tree.strict) {\n-            tree.expr = attr.makeNullCheck(tree.expr, true);\n+        boolean prevGenerateNullChecks = generateNullChecks;\n+        try {\n+            generateNullChecks = false;\n+            super.visitTypeCast(tree);\n+            if (tree.strict) {\n+                tree.expr = attr.makeNullCheck(tree.expr, true);\n+            }\n+        } finally {\n+            generateNullChecks = prevGenerateNullChecks;\n@@ -227,0 +244,1 @@\n+        boolean prevGenerateNullChecks = generateNullChecks;\n@@ -228,0 +246,1 @@\n+            generateNullChecks = true;\n@@ -243,0 +262,1 @@\n+            generateNullChecks = prevGenerateNullChecks;\n@@ -248,4 +268,7 @@\n-        super.visitReturn(tree);\n-        if (tree.expr != null && returnType != null && !returnType.hasTag(VOID)) {\n-            if (types.isNonNullable(returnType)) {\n-                tree.expr = attr.makeNullCheck(tree.expr, true);\n+        boolean prevGenerateNullChecks = generateNullChecks;\n+        try {\n+            super.visitReturn(tree);\n+            if (tree.expr != null && returnType != null && !returnType.hasTag(VOID)) {\n+                if (types.isNonNullable(returnType)) {\n+                    tree.expr = attr.makeNullCheck(tree.expr, true);\n+                }\n@@ -253,0 +276,2 @@\n+        } finally {\n+            generateNullChecks = prevGenerateNullChecks;\n@@ -259,9 +284,13 @@\n-        Symbol.MethodSymbol msym = (Symbol.MethodSymbol) TreeInfo.symbolFor(tree.meth);\n-        if (useSiteNullChecks.generateChecksForMethods) {\n-            tree.args = newArgs(msym, tree.args);\n-        }\n-        super.visitApply(tree);\n-        result = tree;\n-        if (useSiteNullChecks.generateChecksForMethods) {\n-            if (types.isNonNullable(msym.type.asMethodType().restype)) {\n-                result = attr.makeNullCheck(tree, true);\n+        boolean prevGenerateNullChecks = generateNullChecks;\n+        try {\n+            generateNullChecks = true;\n+            Symbol.MethodSymbol msym = (Symbol.MethodSymbol) TreeInfo.symbolFor(tree.meth);\n+            if (useSiteNullChecks.generateChecksForMethods) {\n+                tree.args = newArgs(msym, tree.args);\n+            }\n+            super.visitApply(tree);\n+            result = tree;\n+            if (useSiteNullChecks.generateChecksForMethods) {\n+                if (types.isNonNullable(msym.type.asMethodType().restype)) {\n+                    result = attr.makeNullCheck(tree, true);\n+                }\n@@ -269,0 +298,2 @@\n+        } finally {\n+            generateNullChecks = prevGenerateNullChecks;\n@@ -274,2 +305,10 @@\n-        if (useSiteNullChecks.generateChecksForMethods) {\n-            tree.args = newArgs((Symbol.MethodSymbol) tree.constructor, tree.args);\n+        boolean prevGenerateNullChecks = generateNullChecks;\n+        try {\n+            generateNullChecks = true;\n+            if (useSiteNullChecks.generateChecksForMethods) {\n+                tree.args = newArgs((Symbol.MethodSymbol) tree.constructor, tree.args);\n+            }\n+            super.visitNewClass(tree);\n+            result = tree;\n+        } finally {\n+            generateNullChecks = prevGenerateNullChecks;\n@@ -277,2 +316,1 @@\n-        super.visitNewClass(tree);\n-        result = tree;\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/NullChecksWriter.java","additions":64,"deletions":26,"binary":false,"changes":90,"status":"modified"}]}