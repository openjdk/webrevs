{"files":[{"patch":"@@ -31,0 +31,1 @@\n+import jdk.internal.value.ValueClass;\n@@ -119,0 +120,2 @@\n+    private static final int NULL_CHECKED = 0x0200;\n+\n@@ -120,1 +123,1 @@\n-     * Creates a new array with the specified component type, modifiers and\n+     * Creates a new array with the specified component type, modifiers, and\n@@ -123,0 +126,3 @@\n+     * <p>The number of dimensions of the new array must not\n+     * exceed 255.\n+     *\n@@ -131,1 +137,4 @@\n-     *         {@code componentType} parameter is null\n+     *         {@code componentType} or {@code sourceArray} parameter is null,\n+     *         or if the new array is null-checked and a component of\n+     *         {@code sourceArray} cannot be stored into the new array because\n+     *         it is null\n@@ -133,1 +142,7 @@\n-     * @throws IndexOutOfBoundsException if {@code sourceOffset} is not a valid index in {@code sourceArray}\n+     *         or if the number of dimensions of the requested array instance\n+     *         exceed 255.\n+     * @throws IndexOutOfBoundsException if {@code sourceOffset} or\n+     *         {@code sourceOffset + length} is not a valid index in\n+     *         {@code sourceArray}.\n+     * @throws ArrayStoreException if a component of {@code sourceArray} cannot\n+     *         be stored into the new array because of a type mismatch.\n@@ -139,1 +154,1 @@\n-        \/\/ modifiers are ignored for now\n+        \/\/ modifiers may be ignored for now\n@@ -146,4 +161,10 @@\n-        if (sourceLength > 0) {\n-            Objects.checkIndex(sourceOffset, sourceLength);\n-        } else if (sourceOffset != 0) {\n-            throw new IndexOutOfBoundsException(\"sourceOffset=\" + sourceOffset);\n+        Objects.checkFromIndexSize(sourceOffset, length, sourceLength);\n+        Object newArray;\n+        if ((modifiers & NULL_CHECKED) != 0 &&\n+            length > 0 &&\n+            componentType.isValue() &&\n+            Modifier.isFinal(componentType.getModifiers())) {\n+            newArray = ValueClass.newNullRestrictedAtomicArray(\n+                        componentType, length, get(sourceArray, 0));\n+        } else {\n+            newArray = newInstance(componentType, length);\n@@ -151,1 +172,0 @@\n-        Object newArray = newInstance(componentType, length);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/Array.java","additions":29,"deletions":9,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -30,1 +30,0 @@\n-\n@@ -32,0 +31,9 @@\n+import java.lang.reflect.Modifier;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Collections;\n+import java.util.function.IntFunction;\n+import java.lang.invoke.*;\n+import sun.invoke.util.Wrapper;\n+\n+import static java.lang.invoke.MethodHandles.*;\n@@ -34,1 +42,1 @@\n- * Bootstrap methods for strictly-initialized array creation.\n+ * Factory and bootstrap methods for strictly-initialized array creation.\n@@ -41,0 +49,2 @@\n+    \/* FACTORIES *\/\n+\n@@ -42,1 +52,1 @@\n-     * {@return an empty array with provided type and flags}\n+     * Create an empty array with the given component type and modifiers.\n@@ -44,2 +54,3 @@\n-     * @param componentType The array component type\n-     * @param flags         Kind of array to create (always 0 for now)\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @return a new array\n@@ -48,2 +59,3 @@\n-    public static Object empty(Class<?> componentType, int flags) {\n-        return copied(componentType, flags, 0, new Object[0]);\n+    public static Object empty(Class<?> componentType, int modifiers) {\n+        Object arr = alloc(componentType, modifiers, 0);\n+        return finish(arr, componentType, modifiers, 0);\n@@ -53,1 +65,2 @@\n-     * {@return an array filled with the provided values}\n+     * Create an array with the given component type and modifiers, with every\n+     * component initialized to {@code initial}.\n@@ -55,3 +68,5 @@\n-     * @param componentType The array component type\n-     * @param flags         Kind of array to create (always 0 for now)\n-     * @param v1            First value\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param length array length\n+     * @param initial initial value for each component\n+     * @return a new array\n@@ -59,0 +74,1 @@\n+     * @throws NegativeArraySizeException if {@code length < 0}\n@@ -60,2 +76,27 @@\n-    public static Object enumerated(Class<?> componentType, int flags, Object v1) {\n-        return copied(componentType, flags, 1, new Object[] { v1 });\n+    public static Object filled(Class<?> componentType, int modifiers,\n+                                int length, Object initial) {\n+        Object arr = alloc(componentType, modifiers, length);\n+        if (!isDefault(componentType, initial)) {\n+            if (arr instanceof Object[]) {\n+                initFilled(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof int[]) {\n+                initFilled_int(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof long[]) {\n+                initFilled_long(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof float[]) {\n+                initFilled_float(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof double[]) {\n+                initFilled_double(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof byte[]) {\n+                initFilled_byte(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof short[]) {\n+                initFilled_short(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof char[]) {\n+                initFilled_char(arr, componentType, modifiers, length, initial);\n+            } else if (arr instanceof boolean[]) {\n+                initFilled_boolean(arr, componentType, modifiers, length, initial);\n+            } else {\n+                throw new AssertionError();\n+            }\n+        }\n+        return finish(arr, componentType, modifiers, length);\n@@ -65,1 +106,2 @@\n-     * {@return an array filled with the provided values}\n+     * Create an array with the given component type and modifiers, with initial\n+     * components provided by an {@code IntFunction}.\n@@ -67,4 +109,5 @@\n-     * @param componentType The array component type\n-     * @param flags         Kind of array to create (always 0 for now)\n-     * @param v1            First value\n-     * @param v2            Second value\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param length array length\n+     * @param generator function to produce the initial value for each component\n+     * @return a new array\n@@ -72,0 +115,1 @@\n+     * @throws NegativeArraySizeException if {@code length < 0}\n@@ -73,2 +117,25 @@\n-    public static Object enumerated(Class<?> componentType, int flags, Object v1, Object v2) {\n-        return copied(componentType, flags, 2, new Object[] { v1, v2 });\n+    public static Object computed(Class<?> componentType, int modifiers,\n+                                  int length, IntFunction<?> generator) {\n+        Object arr = alloc(componentType, modifiers, length);\n+        if (arr instanceof Object[]) {\n+            initComputed(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof int[]) {\n+            initComputed_int(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof long[]) {\n+            initComputed_long(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof float[]) {\n+            initComputed_float(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof double[]) {\n+            initComputed_double(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof byte[]) {\n+            initComputed_byte(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof short[]) {\n+            initComputed_short(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof char[]) {\n+            initComputed_char(arr, componentType, modifiers, length, generator);\n+        } else if (arr instanceof boolean[]) {\n+            initComputed_boolean(arr, componentType, modifiers, length, generator);\n+        } else {\n+            throw new AssertionError();\n+        }\n+        return finish(arr, componentType, modifiers, length);\n@@ -78,1 +145,3 @@\n-     * {@return an array filled with the provided values}\n+     * Create an array with the given component type and modifiers, with initial\n+     * components provided by the first {@code length} components of\n+     * {@code sourceArray}.\n@@ -80,5 +149,5 @@\n-     * @param componentType The array component type\n-     * @param flags         Kind of array to create (always 0 for now)\n-     * @param v1            First value\n-     * @param v2            Second value\n-     * @param v3            Third value\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param length array length\n+     * @param sourceArray array to copy from\n+     * @return a new array\n@@ -86,0 +155,1 @@\n+     * @throws NegativeArraySizeException if {@code length < 0}\n@@ -87,2 +157,3 @@\n-    public static Object enumerated(Class<?> componentType, int flags, Object v1, Object v2, Object v3) {\n-        return copied(componentType, flags, 3, new Object[] { v1, v2, v3 });\n+    public static Object copied(Class<?> componentType, int modifiers,\n+                                int length, Object sourceArray) {\n+        return Array.newInstance(componentType, modifiers, length, sourceArray, 0);\n@@ -92,1 +163,3 @@\n-     * {@return an array filled with the provided values}\n+     * Create an array with the given component type and modifiers, with initial\n+     * components provided by {@code sourceArray}, from index {@code offset}\n+     * (inclusive) to index {@code offset + length} (exclusive).\n@@ -94,6 +167,6 @@\n-     * @param componentType The array component type\n-     * @param flags         Kind of array to create (always 0 for now)\n-     * @param v1            First value\n-     * @param v2            Second value\n-     * @param v3            Third value\n-     * @param v4            Fourth value\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param length array length\n+     * @param sourceArray array to copy from\n+     * @param offset first index in {@code sourceArray} to copy from\n+     * @return a new array\n@@ -101,0 +174,1 @@\n+     * @throws NegativeArraySizeException if {@code length < 0}\n@@ -102,2 +176,4 @@\n-    public static Object enumerated(Class<?> componentType, int flags, Object v1, Object v2, Object v3, Object v4) {\n-        return copied(componentType, flags, 4, new Object[] { v1, v2, v3, v4 });\n+    public static Object offsetCopied(Class<?> componentType, int modifiers,\n+                                      int length, Object sourceArray, int offset) {\n+        return Array.newInstance(componentType, modifiers, length,\n+                                 sourceArray, offset);\n@@ -107,1 +183,2 @@\n-     * {@return an array filled with the provided values}\n+     * Create array of length 1 with the given component type and modifiers,\n+     * initialized with the given component value.\n@@ -109,7 +186,4 @@\n-     * @param componentType The array component type\n-     * @param flags         Kind of array to create (always 0 for now)\n-     * @param v1            First value\n-     * @param v2            Second value\n-     * @param v3            Third value\n-     * @param v4            Fourth value\n-     * @param v5            Fifth value\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param v0 initial value for the component at index 0\n+     * @return a new array\n@@ -118,2 +192,5 @@\n-    public static Object enumerated(Class<?> componentType, int flags, Object v1, Object v2, Object v3, Object v4, Object v5) {\n-        return copied(componentType, flags, 5, new Object[] { v1, v2, v3, v4, v5 });\n+    public static Object enumerated(Class<?> componentType, int modifiers,\n+                                    Object v0) {\n+        Object arr = alloc(componentType, modifiers, 1);\n+        Array.set(arr, 0, v0);\n+        return finish(arr, componentType, modifiers, 1);\n@@ -123,2 +200,2 @@\n-     * {@return an array filled with values copied from another\n-     * array}\n+     * Create array of length 2 with the given component type and modifiers,\n+     * initialized with the given component values.\n@@ -126,4 +203,5 @@\n-     * @param componentType The array component type\n-     * @param flags         Kind of array to create (always 0 for now)\n-     * @param len           Length of the array\n-     * @param arr           The array from which values are copied\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param v0 initial value for the component at index 0\n+     * @param v1 initial value for the component at index 1\n+     * @return a new array\n@@ -131,1 +209,0 @@\n-     * @throws NegativeArraySizeException if {@code length < 0}\n@@ -133,2 +210,540 @@\n-    public static Object copied(Class<?> componentType, int flags, int len, Object arr) {\n-        return Array.newInstance(componentType, flags, len, arr, 0);\n+    public static Object enumerated(Class<?> componentType, int modifiers,\n+                                    Object v0, Object v1) {\n+        Object arr = alloc(componentType, modifiers, 2);\n+        Array.set(arr, 0, v0);\n+        Array.set(arr, 1, v1);\n+        return finish(arr, componentType, modifiers, 2);\n+    }\n+\n+    \/**\n+     * Create array of length 3 with the given component type and modifiers,\n+     * initialized with the given component values.\n+     *\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param v0 initial value for the component at index 0\n+     * @param v1 initial value for the component at index 1\n+     * @param v2 initial value for the component at index 2\n+     * @return a new array\n+     * @throws IllegalArgumentException if componentType is {@link Void#TYPE}\n+     *\/\n+    public static Object enumerated(Class<?> componentType, int modifiers,\n+                                    Object v0, Object v1, Object v2) {\n+        Object arr = alloc(componentType, modifiers, 3);\n+        Array.set(arr, 0, v0);\n+        Array.set(arr, 1, v1);\n+        Array.set(arr, 2, v2);\n+        return finish(arr, componentType, modifiers, 3);\n+    }\n+\n+    \/**\n+     * Create array of length 4 with the given component type and modifiers,\n+     * initialized with the given component values.\n+     *\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param v0 initial value for the component at index 0\n+     * @param v1 initial value for the component at index 1\n+     * @param v2 initial value for the component at index 2\n+     * @param v3 initial value for the component at index 3\n+     * @return a new array\n+     * @throws IllegalArgumentException if componentType is {@link Void#TYPE}\n+     *\/\n+    public static Object enumerated(Class<?> componentType, int modifiers,\n+                                    Object v0, Object v1, Object v2, Object v3) {\n+        Object arr = alloc(componentType, modifiers, 4);\n+        Array.set(arr, 0, v0);\n+        Array.set(arr, 1, v1);\n+        Array.set(arr, 2, v2);\n+        Array.set(arr, 3, v3);\n+        return finish(arr, componentType, modifiers, 4);\n+    }\n+\n+    \/**\n+     * Create array of length 5 with the given component type and modifiers,\n+     * initialized with the given component values.\n+     *\n+     * @param componentType array component type\n+     * @param modifiers array modifiers\n+     * @param v0 initial value for the component at index 0\n+     * @param v1 initial value for the component at index 1\n+     * @param v2 initial value for the component at index 2\n+     * @param v3 initial value for the component at index 3\n+     * @param v4 initial value for the component at index 4\n+     * @return a new array\n+     * @throws IllegalArgumentException if componentType is {@link Void#TYPE}\n+     *\/\n+    public static Object enumerated(Class<?> componentType, int modifiers,\n+                                    Object v0, Object v1, Object v2, Object v3,\n+                                    Object v4) {\n+        Object arr = alloc(componentType, modifiers, 5);\n+        Array.set(arr, 0, v0);\n+        Array.set(arr, 1, v1);\n+        Array.set(arr, 2, v2);\n+        Array.set(arr, 3, v3);\n+        Array.set(arr, 4, v4);\n+        return finish(arr, componentType, modifiers, 5);\n+    }\n+\n+    \/* BOOTSTRAPS *\/\n+\n+    \/**\n+     * Bootstrap method to create an empty array. Intended for use with\n+     * {@code invokedynamic} call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: no parameters, with\n+     *                      an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite empty(Lookup lookup, String methodName,\n+                                 MethodType type, Class<?> componentType,\n+                                 int modifiers) throws Throwable {\n+        var factory = foldArguments(FINISH_MH, ALLOC_MH);\n+        factory = insertArguments(factory, 0, componentType, modifiers, 0);\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/**\n+     * Bootstrap method to create an array filled with a given constant initial\n+     * value. Intended for use with {@code invokedynamic} call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: an {@code int} length,\n+     *                      if necessary, with an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @param length        Length of the array, or -1 for dynamic\n+     * @param initial       Initial value\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite constantFilled(Lookup lookup, String methodName,\n+                                          MethodType type, Class<?> componentType,\n+                                          int modifiers, int length, Object initial) throws Throwable {\n+        MethodHandle factory;\n+        if (isDefault(componentType, initial)) {\n+            factory = foldArguments(FINISH_MH, ALLOC_MH);\n+            factory = insertArguments(factory, 0, componentType, modifiers);\n+            if (length >= 0) {\n+                factory = insertArguments(factory, 0, length);\n+            }\n+        } else {\n+            String initName = \"initFilled\";\n+            if (componentType.isPrimitive()) {\n+                initName += \"_\" + componentType;\n+            }\n+            var init = LOOKUP.findStatic(ArrayCreation.class, initName, INIT_FILLED_TYPE);\n+            var alloc = dropArguments(ALLOC_MH, ALLOC_TYPE.parameterCount(),\n+                                      Object.class);\n+            var finish = dropArguments(FINISH_MH, FINISH_TYPE.parameterCount(),\n+                                       Object.class);\n+            factory = foldArguments(foldArguments(finish, init), alloc);\n+            factory = insertArguments(factory, 0, componentType, modifiers);\n+            factory = insertArguments(factory, 1, initial);\n+            if (length >= 0) {\n+                factory = insertArguments(factory, 0, length);\n+            }\n+        }\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/**\n+     * Bootstrap method to create an array filled with a dynamically-evaluated\n+     * initial value. Intended for use with {@code invokedynamic} call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: an {@code int} length,\n+     *                      if necessary, and an appropriately-typed initial value,\n+     *                      with an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @param length        Length of the array, or -1 for dynamic\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite dynamicFilled(Lookup lookup, String methodName,\n+                                         MethodType type, Class<?> componentType,\n+                                         int modifiers, int length) throws Throwable {\n+        String initName = \"initFilled\";\n+        if (componentType.isPrimitive()) {\n+            initName += \"_\" + componentType;\n+        }\n+        var init = LOOKUP.findStatic(ArrayCreation.class, initName, INIT_FILLED_TYPE);\n+        var alloc = dropArguments(ALLOC_MH, ALLOC_TYPE.parameterCount(),\n+                                  Object.class);\n+        var finish = dropArguments(FINISH_MH, FINISH_TYPE.parameterCount(),\n+                                   Object.class);\n+        var factory = foldArguments(foldArguments(finish, init), alloc);\n+        factory = insertArguments(factory, 0, componentType, modifiers);\n+        if (length >= 0) {\n+            factory = insertArguments(factory, 0, length);\n+        }\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/**\n+     * Bootstrap method to create an array filled with lazily-computed initial\n+     * values. Intended for use with {@code invokedynamic} call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: an {@code int} length,\n+     *                      if necessary, and an IntFunction producing initial values,\n+     *                      with an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @param length        Length of the array, or -1 for dynamic\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite computed(Lookup lookup, String methodName,\n+                                    MethodType type, Class<?> componentType,\n+                                    int modifiers, int length) throws Throwable {\n+        String initName = \"initComputed\";\n+        if (componentType.isPrimitive()) {\n+            initName += \"_\" + componentType;\n+        }\n+        var init = LOOKUP.findStatic(ArrayCreation.class, initName, INIT_COMPUTED_TYPE);\n+        var alloc = dropArguments(ALLOC_MH, ALLOC_TYPE.parameterCount(),\n+                                  IntFunction.class);\n+        var finish = dropArguments(FINISH_MH, FINISH_TYPE.parameterCount(),\n+                                   IntFunction.class);\n+        var factory = foldArguments(foldArguments(finish, init), alloc);\n+        factory = insertArguments(factory, 0, componentType, modifiers);\n+        if (length >= 0) {\n+            factory = insertArguments(factory, 0, length);\n+        }\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/**\n+     * Bootstrap method to create an array filled with values copied from\n+     * another array. Intended for use with {@code invokedynamic} call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: an {@code int} length,\n+     *                      if necessary, and a source array of initial values,\n+     *                      with an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @param length        Length of the array, or -1 for dynamic\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite copied(Lookup lookup, String methodName,\n+                                  MethodType type, Class<?> componentType,\n+                                  int modifiers, int length) throws Throwable {\n+        var factory = insertArguments(COPY_MH, 0, componentType, modifiers);\n+        factory = insertArguments(factory, 2, 0);\n+        if (length >= 0) {\n+            factory = insertArguments(factory, 0, length);\n+        }\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/**\n+     * Bootstrap method to create an array filled with values copied from\n+     * another array, starting at an offset. Intended for use with\n+     * {@code invokedynamic} call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: an {@code int} length,\n+     *                      if necessary, a source array of initial values, and\n+     *                      a start offset into the array, with an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @param length        Length of the array, or -1 for dynamic\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite offsetCopied(Lookup lookup, String methodName,\n+                                        MethodType type, Class<?> componentType,\n+                                        int modifiers, int length) throws Throwable {\n+        var factory = insertArguments(COPY_MH, 0, componentType, modifiers);\n+        if (length >= 0) {\n+            factory = insertArguments(factory, 0, length);\n+        }\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/**\n+     * Bootstrap method to create an array initialized to an enumerated list of\n+     * constant values. Intended for use with {@code invokedynamic} call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: no parameters, with\n+     *                      an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @param values        Initial values\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite constantEnumerated(Lookup lookup, String methodName,\n+                                              MethodType type, Class<?> componentType,\n+                                              int modifiers, Object... values) throws Throwable {\n+        Object src = values;\n+        if (componentType.isPrimitive()) {\n+            \/\/ unbox values\n+            src = Array.newInstance(componentType, values.length);\n+            for (int i = 0; i < values.length; i++) {\n+                Array.set(src, i, values[i]);\n+            }\n+        }\n+        var factory = insertArguments(COPY_MH, 0, componentType, modifiers,\n+                                      values.length, src, 0);\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/**\n+     * Bootstrap method to create an array initialized to an enumerated list of\n+     * dynamically-evaluated values. Intended for use with {@code invokedynamic}\n+     * call sites.\n+     *\n+     * @param lookup        Ignored\n+     * @param methodName    Ignored\n+     * @param type          MethodType for the MethodHandle: a parameter for each\n+     *                      array component, with an array return type\n+     * @param componentType Class representing the array component type\n+     * @param modifiers     Array modifiers\n+     * @return              a call site wrapping the array creation MethodHandle\n+     * @throws IllegalArgumentException if the bootstrap arguments are invalid\n+     *                                  or inconsistent\n+     * @throws NullPointerException if any argument is {@code null}\n+     * @throws Throwable if any exception is thrown during call site construction\n+     *\/\n+    public static CallSite dynamicEnumerated(Lookup lookup, String methodName,\n+                                             MethodType type, Class<?> componentType,\n+                                             int modifiers) throws Throwable {\n+        Class<?> acls = componentType.arrayType();\n+        int arity = type.parameterCount();\n+        List<Class<?>> initArgs = Collections.nCopies(arity, Object.class);\n+        MethodHandle binaryId = dropArguments(identity(acls), 1, componentType);\n+        \/\/ binaryId type: (acls, comp)->acls\n+\n+       var init = MethodHandles.empty(MethodType.methodType(void.class, acls));\n+        for (int i = arity - 1; i >= 0; i--) {\n+            var setter = arrayElementSetter(acls);\n+            setter = insertArguments(setter, 1, i);\n+            setter = foldArguments(binaryId, setter);\n+            \/\/ setter type: (acls, comp)->acls\n+            init = collectArguments(init, 0, setter);\n+            \/\/ init type: (acls, comp, ...)->void\n+        }\n+        init = init.asType(init.type().generic().changeReturnType(void.class));\n+        init = dropArguments(init, 1, Class.class, int.class, int.class);\n+        \/\/ init type: (Object, Class, int, int, Object, ...)->void\n+\n+        var alloc = dropArguments(ALLOC_MH, ALLOC_TYPE.parameterCount(), initArgs);\n+        var finish = dropArguments(FINISH_MH, FINISH_TYPE.parameterCount(), initArgs);\n+        var factory = foldArguments(foldArguments(finish, init), alloc);\n+        factory = insertArguments(factory, 0, componentType, modifiers, arity);\n+        return new ConstantCallSite(factory.asType(type));\n+    }\n+\n+    \/* SUPPORT CODE *\/\n+\n+    private static boolean isDefault(Class<?> componentType, Object value) {\n+        if (componentType.isPrimitive()) {\n+            return Wrapper.forPrimitiveType(componentType).zero().equals(value);\n+        } else {\n+            return value == null;\n+        }\n+    }\n+\n+    private static final Lookup LOOKUP = lookup();\n+\n+    \/\/ copy\n+\n+    private static final MethodType COPY_TYPE =\n+            MethodType.methodType(Object.class, Class.class, int.class, int.class,\n+                                  Object.class, int.class);\n+\n+    private static final MethodHandle COPY_MH;\n+    static {\n+        try {\n+            COPY_MH = LOOKUP.findStatic(Array.class, \"newInstance\", COPY_TYPE);\n+        } catch (ReflectiveOperationException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    \/\/ alloc\n+\n+    private static final MethodType ALLOC_TYPE =\n+            MethodType.methodType(Object.class, Class.class, int.class, int.class);\n+\n+    private static final MethodHandle ALLOC_MH;\n+    static {\n+        try {\n+            ALLOC_MH = LOOKUP.findStatic(ArrayCreation.class, \"alloc\", ALLOC_TYPE);\n+        } catch (ReflectiveOperationException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    private static Object alloc(Class<?> comp, int mods, int len) {\n+        return Array.newInstance(comp, len);\n+    }\n+\n+    \/\/ finish\n+\n+    private static final MethodType FINISH_TYPE =\n+            MethodType.methodType(Object.class, Object.class, Class.class, int.class, int.class);\n+\n+    private static final MethodHandle FINISH_MH;\n+    static {\n+        try {\n+            FINISH_MH = LOOKUP.findStatic(ArrayCreation.class, \"finish\", FINISH_TYPE);\n+        } catch (ReflectiveOperationException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    private static Object finish(Object arr, Class<?> comp, int mods, int len) {\n+        if (mods == 0) {\n+            return arr;\n+        } else {\n+            return Array.newInstance(comp, mods, len, arr, 0);\n+        }\n+    }\n+\n+    \/\/ initFilled\n+\n+    private static final MethodType INIT_FILLED_TYPE =\n+            MethodType.methodType(void.class, Object.class, Class.class, int.class, int.class,\n+                                  Object.class);\n+\n+    private static void initFilled(Object arr, Class<?> comp, int mods, int len,\n+                                     Object init) {\n+        Arrays.fill((Object[]) arr, init);\n+    }\n+\n+    private static void initFilled_int(Object arr, Class<?> comp, int mods, int len,\n+                                         Object init) {\n+        Arrays.fill((int[]) arr, (int) init);\n+    }\n+\n+    private static void initFilled_long(Object arr, Class<?> comp, int mods, int len,\n+                                          Object init) {\n+        Arrays.fill((long[]) arr, (long) init);\n+    }\n+\n+    private static void initFilled_float(Object arr, Class<?> comp, int mods, int len,\n+                                          Object init) {\n+        Arrays.fill((float[]) arr, (float) init);\n+    }\n+\n+    private static void initFilled_double(Object arr, Class<?> comp, int mods, int len,\n+                                            Object init) {\n+        Arrays.fill((double[]) arr, (double) init);\n+    }\n+\n+    private static void initFilled_byte(Object arr, Class<?> comp, int mods, int len,\n+                                          Object init) {\n+        Arrays.fill((byte[]) arr, (byte) init);\n+    }\n+\n+    private static void initFilled_short(Object arr, Class<?> comp, int mods, int len,\n+                                           Object init) {\n+        Arrays.fill((short[]) arr, (short) init);\n+    }\n+\n+    private static void initFilled_char(Object arr, Class<?> comp, int mods, int len,\n+                                          Object init) {\n+        Arrays.fill((char[]) arr, (char) init);\n+    }\n+\n+    private static void initFilled_boolean(Object arr, Class<?> comp, int mods, int len,\n+                                             Object init) {\n+        Arrays.fill((boolean[]) arr, (boolean) init);\n+    }\n+\n+    \/\/ initComputed\n+\n+    private static final MethodType INIT_COMPUTED_TYPE =\n+            MethodType.methodType(void.class, Object.class, Class.class, int.class, int.class,\n+                                  IntFunction.class);\n+\n+    private static void initComputed(Object arr, Class<?> comp, int mods, int len,\n+                                     IntFunction<?> f) {\n+        Arrays.setAll((Object[]) arr, f);\n+    }\n+\n+    private static void initComputed_int(Object arr, Class<?> comp, int mods, int len,\n+                                         IntFunction<?> f) {\n+        int[] a = (int[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (int) f.apply(i);\n+    }\n+\n+    private static void initComputed_long(Object arr, Class<?> comp, int mods, int len,\n+                                          IntFunction<?> f) {\n+        long[] a = (long[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (long) f.apply(i);\n+    }\n+\n+    private static void initComputed_float(Object arr, Class<?> comp, int mods, int len,\n+                                           IntFunction<?> f) {\n+        float[] a = (float[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (float) f.apply(i);\n+    }\n+\n+    private static void initComputed_double(Object arr, Class<?> comp, int mods, int len,\n+                                            IntFunction<?> f) {\n+        double[] a = (double[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (double) f.apply(i);\n+    }\n+\n+    private static void initComputed_byte(Object arr, Class<?> comp, int mods, int len,\n+                                          IntFunction<?> f) {\n+        byte[] a = (byte[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (byte) f.apply(i);\n+    }\n+\n+    private static void initComputed_short(Object arr, Class<?> comp, int mods, int len,\n+                                          IntFunction<?> f) {\n+        short[] a = (short[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (short) f.apply(i);\n+    }\n+\n+    private static void initComputed_char(Object arr, Class<?> comp, int mods, int len,\n+                                          IntFunction<?> f) {\n+        char[] a = (char[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (char) f.apply(i);\n+    }\n+\n+    private static void initComputed_boolean(Object arr, Class<?> comp, int mods, int len,\n+                                          IntFunction<?> f) {\n+        boolean[] a = (boolean[]) arr;\n+        for (int i = 0; i < len; i++) a[i] = (boolean) f.apply(i);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/runtime\/ArrayCreation.java","additions":671,"deletions":56,"binary":false,"changes":727,"status":"modified"},{"patch":"@@ -30,0 +30,27 @@\n+    public static Method emptyS:\"()[Ljava\/lang\/String;\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.empty\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0;\n+        areturn;\n+    }\n+\n+    public static Method emptyS_N:\"()[Ljava\/lang\/String;\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.empty\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200;\n+        areturn;\n+    }\n+\n+    public static Method emptyI:\"()[I\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.empty\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[I\"\n+                #1, int 0;\n+        areturn;\n+    }\n+\n@@ -33,1 +60,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -39,0 +66,9 @@\n+    public static Method constantFilled3S_N:\"()[Ljava\/lang\/String;\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.constantFilled\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 3, String \"c\";\n+        areturn;\n+    }\n+\n@@ -42,1 +78,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -51,1 +87,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -57,0 +93,9 @@\n+    public static Method constantFilled0S_N:\"()[Ljava\/lang\/String;\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.constantFilled\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 0, String \"c\";\n+        areturn;\n+    }\n+\n@@ -60,1 +105,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -70,1 +115,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -76,0 +121,10 @@\n+    public static Method constantFilledNS_N:\"(I)[Ljava\/lang\/String;\" stack 1 {\n+        iload_0;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.constantFilled\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(I)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int -1, String \"c\";\n+        areturn;\n+    }\n+\n@@ -80,1 +135,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;IILjava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -90,1 +145,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -96,0 +151,10 @@\n+    public static Method dynamicFilled3S_N:\"(Ljava\/lang\/String;)[Ljava\/lang\/String;\" stack 1 {\n+        aload_0;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.dynamicFilled\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(Ljava\/lang\/String;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 3;\n+        areturn;\n+    }\n+\n@@ -100,1 +165,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -110,1 +175,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -116,0 +181,10 @@\n+    public static Method dynamicFilled0S_N:\"(Ljava\/lang\/String;)[Ljava\/lang\/String;\" stack 1 {\n+        aload_0;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.dynamicFilled\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(Ljava\/lang\/String;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 0;\n+        areturn;\n+    }\n+\n@@ -120,1 +195,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -131,1 +206,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -137,0 +212,11 @@\n+    public static Method dynamicFilledNS_N:\"(ILjava\/lang\/String;)[Ljava\/lang\/String;\" stack 2 {\n+        iload_0;\n+        aload_1;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.dynamicFilled\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(ILjava\/lang\/String;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int -1;\n+        areturn;\n+    }\n+\n@@ -142,1 +228,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -152,1 +238,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -158,0 +244,10 @@\n+    public static Method computed3S_N:\"(Ljava\/util\/function\/IntFunction;)[Ljava\/lang\/String;\" stack 1 {\n+        aload_0;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.computed\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(Ljava\/util\/function\/IntFunction;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 3;\n+        areturn;\n+    }\n+\n@@ -162,1 +258,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -172,1 +268,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -178,0 +274,10 @@\n+    public static Method computed0S_N:\"(Ljava\/util\/function\/IntFunction;)[Ljava\/lang\/String;\" stack 1 {\n+        aload_0;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.computed\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(Ljava\/util\/function\/IntFunction;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 0;\n+        areturn;\n+    }\n+\n@@ -182,1 +288,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -193,1 +299,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -199,0 +305,11 @@\n+    public static Method computedNS_N:\"(ILjava\/util\/function\/IntFunction;)[Ljava\/lang\/String;\" stack 2 {\n+        iload_0;\n+        aload_1;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.computed\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(ILjava\/util\/function\/IntFunction;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int -1;\n+        areturn;\n+    }\n+\n@@ -204,1 +321,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -214,1 +331,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -220,0 +337,10 @@\n+    public static Method copied3S_N:\"([Ljava\/lang\/Object;)[Ljava\/lang\/String;\" stack 1 {\n+        aload_0;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.copied\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"([Ljava\/lang\/Object;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 3;\n+        areturn;\n+    }\n+\n@@ -224,1 +351,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -234,1 +361,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -240,0 +367,10 @@\n+    public static Method copied0S_N:\"([Ljava\/lang\/Object;)[Ljava\/lang\/String;\" stack 1 {\n+        aload_0;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.copied\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"([Ljava\/lang\/Object;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 0;\n+        areturn;\n+    }\n+\n@@ -244,1 +381,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -255,1 +392,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -261,0 +398,11 @@\n+    public static Method copiedNS_N:\"(I[Ljava\/lang\/Object;)[Ljava\/lang\/String;\" stack 2 {\n+        iload_0;\n+        aload_1;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.copied\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(I[Ljava\/lang\/Object;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int -1;\n+        areturn;\n+    }\n+\n@@ -266,1 +414,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -277,1 +425,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -283,0 +431,11 @@\n+    public static Method offsetCopied3S_N:\"([Ljava\/lang\/Object;I)[Ljava\/lang\/String;\" stack 2 {\n+        aload_0;\n+        iload_1;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.offsetCopied\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"([Ljava\/lang\/Object;I)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 3;\n+        areturn;\n+    }\n+\n@@ -288,1 +447,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -299,1 +458,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -305,0 +464,11 @@\n+    public static Method offsetCopied0S_N:\"([Ljava\/lang\/Object;I)[Ljava\/lang\/String;\" stack 2 {\n+        aload_0;\n+        iload_1;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.offsetCopied\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"([Ljava\/lang\/Object;I)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int 0;\n+        areturn;\n+    }\n+\n@@ -310,1 +480,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -322,1 +492,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -328,0 +498,12 @@\n+    public static Method offsetCopiedNS_N:\"(I[Ljava\/lang\/Object;I)[Ljava\/lang\/String;\" stack 3 {\n+        iload_0;\n+        aload_1;\n+        iload_2;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.offsetCopied\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(I[Ljava\/lang\/Object;I)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, int -1;\n+        areturn;\n+    }\n+\n@@ -334,1 +516,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;II)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;II)Ljava\/lang\/invoke\/CallSite;\"\n@@ -343,1 +525,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -349,0 +531,9 @@\n+    public static Method constantEnumerated3S_N:\"()[Ljava\/lang\/String;\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.constantEnumerated\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200, String \"c1\", String \"c2\", String \"c3\";\n+        areturn;\n+    }\n+\n@@ -352,1 +543,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -361,1 +552,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -367,0 +558,9 @@\n+    public static Method constantEnumerated0S_N:\"()[Ljava\/lang\/String;\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.constantEnumerated\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200;\n+        areturn;\n+    }\n+\n@@ -370,1 +570,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\"\n@@ -384,1 +584,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n@@ -390,0 +590,14 @@\n+    public static Method dynamicEnumerated3S_N\n+            :\"(Ljava\/lang\/String;Ljava\/lang\/String;Ljava\/lang\/String;)[Ljava\/lang\/String;\"\n+            stack 3 {\n+        aload_0;\n+        aload_1;\n+        aload_2;\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.dynamicEnumerated\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"(Ljava\/lang\/String;Ljava\/lang\/String;Ljava\/lang\/String;)[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200;\n+        areturn;\n+    }\n+\n@@ -396,1 +610,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n@@ -405,1 +619,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n@@ -411,0 +625,9 @@\n+    public static Method dynamicEnumerated0S_N:\"()[Ljava\/lang\/String;\" stack 1 {\n+        invokedynamic\n+            InvokeDynamic REF_invokeStatic:java\/lang\/runtime\/ArrayCreation.dynamicEnumerated\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :_:\"()[Ljava\/lang\/String;\"\n+                class java\/lang\/String, int 0x0200;\n+        areturn;\n+    }\n+\n@@ -414,1 +637,1 @@\n-                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/reflect\/RuntimeType;I)Ljava\/lang\/invoke\/CallSite;\"\n+                :\"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/Class;I)Ljava\/lang\/invoke\/CallSite;\"\n","filename":"test\/jdk\/java\/lang\/runtime\/ArrayCreationInvoker.jasm","additions":261,"deletions":38,"binary":false,"changes":299,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,1 @@\n+import java.util.List;\n@@ -25,0 +26,2 @@\n+import java.util.stream.IntStream;\n+import java.lang.runtime.ArrayCreation;\n@@ -28,1 +31,1 @@\n- * @summary invokedynamic usage of java.lang.runtime.ArrayCreation bootstraps\n+ * @summary java.lang.runtime.ArrayCreation factories and bootstraps\n@@ -34,0 +37,3 @@\n+    private static final int PLAIN = 0;\n+    private static final int CHECKED = 0x0200;\n+\n@@ -36,50 +42,120 @@\n-        checkArray(ArrayCreationInvoker.constantFilled3S(),\n-                   new String[]{ \"c\", \"c\", \"c\" });\n-        checkArray(ArrayCreationInvoker.constantFilled3I(),\n-                   new int[]{ 3, 3, 3 });\n-        checkArray(ArrayCreationInvoker.constantFilled0S(),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.constantFilled0I(),\n-                   new int[]{ });\n-        checkArray(ArrayCreationInvoker.constantFilledNS(5),\n-                   new String[]{ \"c\", \"c\", \"c\", \"c\", \"c\" });\n-        checkArray(ArrayCreationInvoker.constantFilledNS(0),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.constantFilledNI(5),\n-                   new int[]{ 3, 3, 3, 3, 3 });\n-        checkArray(ArrayCreationInvoker.constantFilledNI(0),\n-                   new int[]{ });\n-\n-        checkArray(ArrayCreationInvoker.dynamicFilled3S(\"hi\"),\n-                   new String[]{ \"hi\", \"hi\", \"hi\" });\n-        checkArray(ArrayCreationInvoker.dynamicFilled3I(23),\n-                   new int[]{ 23, 23, 23 });\n-        checkArray(ArrayCreationInvoker.dynamicFilled0S(\"hi\"),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.dynamicFilled0I(23),\n-                   new int[]{ });\n-        checkArray(ArrayCreationInvoker.dynamicFilledNS(2, \"hi\"),\n-                   new String[]{ \"hi\", \"hi\" });\n-        checkArray(ArrayCreationInvoker.dynamicFilledNS(0, \"hi\"),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.dynamicFilledNI(2, 23),\n-                   new int[]{ 23, 23 });\n-        checkArray(ArrayCreationInvoker.dynamicFilledNI(0, 23),\n-                   new int[]{ });\n-\n-        checkArray(ArrayCreationInvoker.computed3S(i -> \"x\"+i),\n-                   new String[]{ \"x0\", \"x1\", \"x2\" });\n-        checkArray(ArrayCreationInvoker.computed3I(i -> i+5),\n-                   new int[]{ 5, 6, 7 });\n-        checkArray(ArrayCreationInvoker.computed0S(i -> \"y\"+i),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.computed0I(i -> i+6),\n-                   new int[]{ });\n-        checkArray(ArrayCreationInvoker.computedNS(5, i -> \"z\"+i),\n-                   new String[]{ \"z0\", \"z1\", \"z2\", \"z3\", \"z4\" });\n-        checkArray(ArrayCreationInvoker.computedNS(0, i -> \"w\"+i),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.computedNI(5, i -> i+7),\n-                   new int[]{ 7, 8, 9, 10, 11 });\n-        checkArray(ArrayCreationInvoker.computedNI(0, i -> i+8),\n-                   new int[]{ });\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.empty(String.class, PLAIN),\n+                   ArrayCreationInvoker.emptyS());\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.empty(int.class, PLAIN),\n+                   ArrayCreationInvoker.emptyI());\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.empty(String.class, CHECKED),\n+                   ArrayCreationInvoker.emptyS_N());\n+\n+        checkArray(String.class, PLAIN, List.of(\"c\", \"c\", \"c\"),\n+                   ArrayCreation.filled(String.class, PLAIN, 3, \"c\"),\n+                   ArrayCreationInvoker.constantFilled3S());\n+        checkArray(int.class, PLAIN, List.of(3, 3, 3),\n+                   ArrayCreation.filled(int.class, PLAIN, 3, 3),\n+                   ArrayCreationInvoker.constantFilled3I());\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(String.class, PLAIN, 0, \"c\"),\n+                   ArrayCreationInvoker.constantFilled0S());\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(int.class, PLAIN, 0, 3),\n+                   ArrayCreationInvoker.constantFilled0I());\n+        checkArray(String.class, PLAIN, List.of(\"c\", \"c\", \"c\", \"c\", \"c\"),\n+                   ArrayCreation.filled(String.class, PLAIN, 5, \"c\"),\n+                   ArrayCreationInvoker.constantFilledNS(5));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(String.class, PLAIN, 0, \"c\"),\n+                   ArrayCreationInvoker.constantFilledNS(0));\n+        checkArray(int.class, PLAIN, List.of(3, 3, 3, 3, 3),\n+                   ArrayCreation.filled(int.class, PLAIN, 5, 3),\n+                   ArrayCreationInvoker.constantFilledNI(5));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(int.class, PLAIN, 0, 3),\n+                   ArrayCreationInvoker.constantFilledNI(0));\n+        checkArray(String.class, CHECKED, List.of(\"c\", \"c\", \"c\"),\n+                   ArrayCreation.filled(String.class, CHECKED, 3, \"c\"),\n+                   ArrayCreationInvoker.constantFilled3S_N());\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.filled(String.class, CHECKED, 0, \"c\"),\n+                   ArrayCreationInvoker.constantFilled0S_N());\n+        checkArray(String.class, CHECKED, List.of(\"c\", \"c\", \"c\", \"c\", \"c\"),\n+                   ArrayCreation.filled(String.class, CHECKED, 5, \"c\"),\n+                   ArrayCreationInvoker.constantFilledNS_N(5));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.filled(String.class, CHECKED, 0, \"c\"),\n+                   ArrayCreationInvoker.constantFilledNS_N(0));\n+\n+        checkArray(String.class, PLAIN, List.of(\"hi\", \"hi\", \"hi\"),\n+                   ArrayCreation.filled(String.class, PLAIN, 3, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilled3S(\"hi\"));\n+        checkArray(int.class, PLAIN, List.of(23, 23, 23),\n+                   ArrayCreation.filled(int.class, PLAIN, 3, 23),\n+                   ArrayCreationInvoker.dynamicFilled3I(23));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(String.class, PLAIN, 0, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilled0S(\"hi\"));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(int.class, PLAIN, 0, 23),\n+                   ArrayCreationInvoker.dynamicFilled0I(23));\n+        checkArray(String.class, PLAIN, List.of(\"hi\", \"hi\"),\n+                   ArrayCreation.filled(String.class, PLAIN, 2, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilledNS(2, \"hi\"));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(String.class, PLAIN, 0, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilledNS(0, \"hi\"));\n+        checkArray(int.class, PLAIN, List.of(23, 23),\n+                   ArrayCreation.filled(int.class, PLAIN, 2, 23),\n+                   ArrayCreationInvoker.dynamicFilledNI(2, 23));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.filled(int.class, PLAIN, 0, 23),\n+                   ArrayCreationInvoker.dynamicFilledNI(0, 23));\n+        checkArray(String.class, CHECKED, List.of(\"hi\", \"hi\", \"hi\"),\n+                   ArrayCreation.filled(String.class, CHECKED, 3, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilled3S_N(\"hi\"));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.filled(String.class, CHECKED, 0, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilled0S_N(\"hi\"));\n+        checkArray(String.class, CHECKED, List.of(\"hi\", \"hi\"),\n+                   ArrayCreation.filled(String.class, CHECKED, 2, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilledNS_N(2, \"hi\"));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.filled(String.class, CHECKED, 0, \"hi\"),\n+                   ArrayCreationInvoker.dynamicFilledNS_N(0, \"hi\"));\n+\n+        checkArray(String.class, PLAIN, List.of(\"x0\", \"x1\", \"x2\"),\n+                   ArrayCreation.computed(String.class, PLAIN, 3, i -> \"x\"+i),\n+                   ArrayCreationInvoker.computed3S(i -> \"x\"+i));\n+        checkArray(int.class, PLAIN, List.of(5, 6, 7),\n+                   ArrayCreation.computed(int.class, PLAIN, 3, i -> i+5),\n+                   ArrayCreationInvoker.computed3I(i -> i+5));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.computed(String.class, PLAIN, 0, i -> \"y\"+i),\n+                   ArrayCreationInvoker.computed0S(i -> \"y\"+i));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.computed(int.class, PLAIN, 0, i -> i+6),\n+                   ArrayCreationInvoker.computed0I(i -> i+6));\n+        checkArray(String.class, PLAIN, List.of(\"z0\", \"z1\", \"z2\", \"z3\", \"z4\"),\n+                   ArrayCreation.computed(String.class, PLAIN, 5, i -> \"z\"+i),\n+                   ArrayCreationInvoker.computedNS(5, i -> \"z\"+i));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.computed(String.class, PLAIN, 0, i -> \"w\"+i),\n+                   ArrayCreationInvoker.computedNS(0, i -> \"w\"+i));\n+        checkArray(int.class, PLAIN, List.of(7, 8, 9, 10, 11),\n+                   ArrayCreation.computed(int.class, PLAIN, 5, i -> i+7),\n+                   ArrayCreationInvoker.computedNI(5, i -> i+7));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.computed(int.class, PLAIN, 0, i -> i+8),\n+                   ArrayCreationInvoker.computedNI(0, i -> i+8));\n+        checkArray(String.class, CHECKED, List.of(\"x0\", \"x1\", \"x2\"),\n+                   ArrayCreation.computed(String.class, CHECKED, 3, i -> \"x\"+i),\n+                   ArrayCreationInvoker.computed3S_N(i -> \"x\"+i));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.computed(String.class, CHECKED, 0, i -> \"y\"+i),\n+                   ArrayCreationInvoker.computed0S_N(i -> \"y\"+i));\n+        checkArray(String.class, CHECKED, List.of(\"z0\", \"z1\", \"z2\", \"z3\", \"z4\"),\n+                   ArrayCreation.computed(String.class, CHECKED, 5, i -> \"z\"+i),\n+                   ArrayCreationInvoker.computedNS_N(5, i -> \"z\"+i));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.computed(String.class, CHECKED, 0, i -> \"w\"+i),\n+                   ArrayCreationInvoker.computedNS_N(0, i -> \"w\"+i));\n@@ -90,59 +166,129 @@\n-        checkArray(ArrayCreationInvoker.copied3S(srcS),\n-                   new String[]{ \"a\", \"b\", \"c\" });\n-        checkArray(ArrayCreationInvoker.copied3I(srcI),\n-                   new int[]{ 1, 2, 3 });\n-        checkArray(ArrayCreationInvoker.copied0S(srcS),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.copied0I(srcI),\n-                   new int[]{ });\n-        checkArray(ArrayCreationInvoker.copiedNS(4, srcS),\n-                   new String[]{ \"a\", \"b\", \"c\", \"d\" });\n-        checkArray(ArrayCreationInvoker.copiedNS(0, srcS),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.copiedNI(4, srcI),\n-                   new int[]{ 1, 2, 3, 4 });\n-        checkArray(ArrayCreationInvoker.copiedNI(0, srcI),\n-                   new int[]{ });\n-\n-        checkArray(ArrayCreationInvoker.offsetCopied3S(srcS, 0),\n-                   new String[]{ \"a\", \"b\", \"c\" });\n-        checkArray(ArrayCreationInvoker.offsetCopied3S(srcS, 2),\n-                   new String[]{ \"c\", \"d\", \"e\" });\n-        checkArray(ArrayCreationInvoker.offsetCopied3I(srcI, 0),\n-                   new int[]{ 1, 2, 3 });\n-        checkArray(ArrayCreationInvoker.offsetCopied3I(srcI, 2),\n-                   new int[]{ 3, 4, 5 });\n-        checkArray(ArrayCreationInvoker.offsetCopied0S(srcS, 0),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.offsetCopied0S(srcS, 2),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.offsetCopied0I(srcI, 0),\n-                   new int[]{ });\n-        checkArray(ArrayCreationInvoker.offsetCopied0I(srcI, 2),\n-                   new int[]{ });\n-        checkArray(ArrayCreationInvoker.offsetCopiedNS(4, srcS, 1),\n-                   new String[]{ \"b\", \"c\", \"d\", \"e\" });\n-        checkArray(ArrayCreationInvoker.offsetCopiedNS(0, srcS, 4),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.offsetCopiedNI(4, srcI, 1),\n-                   new int[]{ 2, 3, 4, 5 });\n-        checkArray(ArrayCreationInvoker.offsetCopiedNI(0, srcI, 4),\n-                   new int[]{ });\n-\n-        checkArray(ArrayCreationInvoker.constantEnumerated3S(),\n-                   new String[]{ \"c1\", \"c2\", \"c3\" });\n-        checkArray(ArrayCreationInvoker.constantEnumerated3I(),\n-                   new int[]{ 30, 40, 50 });\n-        checkArray(ArrayCreationInvoker.constantEnumerated0S(),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.constantEnumerated0I(),\n-                   new int[]{ });\n-\n-        checkArray(ArrayCreationInvoker.dynamicEnumerated3S(\"x\", \"y\", \"z\"),\n-                   new String[]{ \"x\", \"y\", \"z\" });\n-        checkArray(ArrayCreationInvoker.dynamicEnumerated3I(-12, 0, 583),\n-                   new int[]{ -12, 0, 583 });\n-        checkArray(ArrayCreationInvoker.dynamicEnumerated0S(),\n-                   new String[]{ });\n-        checkArray(ArrayCreationInvoker.dynamicEnumerated0I(),\n-                   new int[]{ });\n+        checkArray(String.class, PLAIN, List.of(\"a\", \"b\", \"c\"),\n+                   ArrayCreation.copied(String.class, PLAIN, 3, srcS),\n+                   ArrayCreationInvoker.copied3S(srcS));\n+        checkArray(int.class, PLAIN, List.of(1, 2, 3),\n+                   ArrayCreation.copied(int.class, PLAIN, 3, srcI),\n+                   ArrayCreationInvoker.copied3I(srcI));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.copied(String.class, PLAIN, 0, srcS),\n+                   ArrayCreationInvoker.copied0S(srcS));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.copied(int.class, PLAIN, 0, srcI),\n+                   ArrayCreationInvoker.copied0I(srcI));\n+        checkArray(String.class, PLAIN, List.of(\"a\", \"b\", \"c\", \"d\"),\n+                   ArrayCreation.copied(String.class, PLAIN, 4, srcS),\n+                   ArrayCreationInvoker.copiedNS(4, srcS));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.copied(String.class, PLAIN, 0, srcS),\n+                   ArrayCreationInvoker.copiedNS(0, srcS));\n+        checkArray(int.class, PLAIN, List.of(1, 2, 3, 4),\n+                   ArrayCreation.copied(int.class, PLAIN, 4, srcI),\n+                   ArrayCreationInvoker.copiedNI(4, srcI));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.copied(int.class, PLAIN, 0, srcI),\n+                   ArrayCreationInvoker.copiedNI(0, srcI));\n+        checkArray(String.class, CHECKED, List.of(\"a\", \"b\", \"c\"),\n+                   ArrayCreation.copied(String.class, CHECKED, 3, srcS),\n+                   ArrayCreationInvoker.copied3S_N(srcS));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.copied(String.class, CHECKED, 0, srcS),\n+                   ArrayCreationInvoker.copied0S_N(srcS));\n+        checkArray(String.class, CHECKED, List.of(\"a\", \"b\", \"c\", \"d\"),\n+                   ArrayCreation.copied(String.class, CHECKED, 4, srcS),\n+                   ArrayCreationInvoker.copiedNS_N(4, srcS));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.copied(String.class, CHECKED, 0, srcS),\n+                   ArrayCreationInvoker.copiedNS_N(0, srcS));\n+\n+        checkArray(String.class, PLAIN, List.of(\"a\", \"b\", \"c\"),\n+                   ArrayCreation.offsetCopied(String.class, PLAIN, 3, srcS, 0),\n+                   ArrayCreationInvoker.offsetCopied3S(srcS, 0));\n+        checkArray(String.class, PLAIN, List.of(\"c\", \"d\", \"e\"),\n+                   ArrayCreation.offsetCopied(String.class, PLAIN, 3, srcS, 2),\n+                   ArrayCreationInvoker.offsetCopied3S(srcS, 2));\n+        checkArray(int.class, PLAIN, List.of(1, 2, 3),\n+                   ArrayCreation.offsetCopied(int.class, PLAIN, 3, srcI, 0),\n+                   ArrayCreationInvoker.offsetCopied3I(srcI, 0));\n+        checkArray(int.class, PLAIN, List.of(3, 4, 5),\n+                   ArrayCreation.offsetCopied(int.class, PLAIN, 3, srcI, 2),\n+                   ArrayCreationInvoker.offsetCopied3I(srcI, 2));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.offsetCopied(String.class, PLAIN, 0, srcS, 0),\n+                   ArrayCreationInvoker.offsetCopied0S(srcS, 0));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.offsetCopied(String.class, PLAIN, 0, srcS, 2),\n+                   ArrayCreationInvoker.offsetCopied0S(srcS, 2));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.offsetCopied(int.class, PLAIN, 0, srcI, 0),\n+                   ArrayCreationInvoker.offsetCopied0I(srcI, 0));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.offsetCopied(int.class, PLAIN, 0, srcI, 2),\n+                   ArrayCreationInvoker.offsetCopied0I(srcI, 2));\n+        checkArray(String.class, PLAIN, List.of(\"b\", \"c\", \"d\", \"e\"),\n+                   ArrayCreation.offsetCopied(String.class, PLAIN, 4, srcS, 1),\n+                   ArrayCreationInvoker.offsetCopiedNS(4, srcS, 1));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.offsetCopied(String.class, PLAIN, 0, srcS, 4),\n+                   ArrayCreationInvoker.offsetCopiedNS(0, srcS, 4));\n+        checkArray(int.class, PLAIN, List.of(2, 3, 4, 5),\n+                   ArrayCreation.offsetCopied(int.class, PLAIN, 4, srcI, 1),\n+                   ArrayCreationInvoker.offsetCopiedNI(4, srcI, 1));\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.offsetCopied(int.class, PLAIN, 0, srcI, 4),\n+                   ArrayCreationInvoker.offsetCopiedNI(0, srcI, 4));\n+        checkArray(String.class, CHECKED, List.of(\"a\", \"b\", \"c\"),\n+                   ArrayCreation.offsetCopied(String.class, CHECKED, 3, srcS, 0),\n+                   ArrayCreationInvoker.offsetCopied3S_N(srcS, 0));\n+        checkArray(String.class, CHECKED, List.of(\"c\", \"d\", \"e\"),\n+                   ArrayCreation.offsetCopied(String.class, CHECKED, 3, srcS, 2),\n+                   ArrayCreationInvoker.offsetCopied3S_N(srcS, 2));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.offsetCopied(String.class, CHECKED, 0, srcS, 0),\n+                   ArrayCreationInvoker.offsetCopied0S_N(srcS, 0));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.offsetCopied(String.class, CHECKED, 0, srcS, 2),\n+                   ArrayCreationInvoker.offsetCopied0S_N(srcS, 2));\n+        checkArray(String.class, CHECKED, List.of(\"b\", \"c\", \"d\", \"e\"),\n+                   ArrayCreation.offsetCopied(String.class, CHECKED, 4, srcS, 1),\n+                   ArrayCreationInvoker.offsetCopiedNS_N(4, srcS, 1));\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.offsetCopied(String.class, CHECKED, 0, srcS, 4),\n+                   ArrayCreationInvoker.offsetCopiedNS_N(0, srcS, 4));\n+\n+        checkArray(String.class, PLAIN, List.of(\"c1\", \"c2\", \"c3\"),\n+                   ArrayCreation.enumerated(String.class, PLAIN, \"c1\", \"c2\", \"c3\"),\n+                   ArrayCreationInvoker.constantEnumerated3S());\n+        checkArray(int.class, PLAIN, List.of(30, 40, 50),\n+                   ArrayCreation.enumerated(int.class, PLAIN, 30, 40, 50),\n+                   ArrayCreationInvoker.constantEnumerated3I());\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.empty(String.class, PLAIN),\n+                   ArrayCreationInvoker.constantEnumerated0S());\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.empty(int.class, PLAIN),\n+                   ArrayCreationInvoker.constantEnumerated0I());\n+        checkArray(String.class, CHECKED, List.of(\"c1\", \"c2\", \"c3\"),\n+                   ArrayCreation.enumerated(String.class, CHECKED, \"c1\", \"c2\", \"c3\"),\n+                   ArrayCreationInvoker.constantEnumerated3S_N());\n+        checkArray(String.class, CHECKED, List.of(),\n+                   ArrayCreation.empty(String.class, CHECKED),\n+                   ArrayCreationInvoker.constantEnumerated0S_N());\n+\n+        checkArray(String.class, PLAIN, List.of(\"x\", \"y\", \"z\"),\n+                   ArrayCreation.enumerated(String.class, PLAIN, \"x\", \"y\", \"z\"),\n+                   ArrayCreationInvoker.dynamicEnumerated3S(\"x\", \"y\", \"z\"));\n+        checkArray(int.class, PLAIN, List.of(-12, 0, 583),\n+                   ArrayCreation.enumerated(int.class, PLAIN, -12, 0, 583),\n+                   ArrayCreationInvoker.dynamicEnumerated3I(-12, 0, 583));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.empty(String.class, PLAIN),\n+                   ArrayCreationInvoker.dynamicEnumerated0S());\n+        checkArray(int.class, PLAIN, List.of(),\n+                   ArrayCreation.empty(int.class, PLAIN),\n+                   ArrayCreationInvoker.dynamicEnumerated0I());\n+        checkArray(String.class, CHECKED, List.of(\"x\", \"y\", \"z\"),\n+                   ArrayCreation.enumerated(String.class, CHECKED, \"x\", \"y\", \"z\"),\n+                   ArrayCreationInvoker.dynamicEnumerated3S_N(\"x\", \"y\", \"z\"));\n+        checkArray(String.class, PLAIN, List.of(),\n+                   ArrayCreation.empty(String.class, CHECKED),\n+                   ArrayCreationInvoker.dynamicEnumerated0S_N());\n@@ -151,4 +297,9 @@\n-    private static void checkArray(Object[] arr, Object[] expected) {\n-        if (!arr.getClass().equals(expected.getClass()) || !Arrays.equals(arr, expected)) {\n-            throw new AssertionError(\"Unexpected result: %s, expected %s\".formatted(\n-                                     Arrays.toString(arr), Arrays.toString(expected)));\n+    private static void checkArray(Class<?> comp, int mods, List<?> expected, Object... actual) {\n+        for (Object o : actual) {\n+            if (!(o.getClass().isArray()) ||\n+                !o.getClass().getComponentType().equals(comp) ||\n+                \/\/ TODO: check modifiers once implemented\n+                !arrayToList(o).equals(expected)) {\n+                throw new AssertionError(\"Unexpected result: %s, expected %s\".formatted(\n+                                        arrayString(o), arrayString(comp, mods, expected)));\n+            }\n@@ -158,4 +309,22 @@\n-    private static void checkArray(int[] arr, int[] expected) {\n-        if (!Arrays.equals(arr, expected)) {\n-            throw new AssertionError(\"Unexpected result: %s, expected %s\".formatted(\n-                                     Arrays.toString(arr), Arrays.toString(expected)));\n+    private static List<?> arrayToList(Object arr) {\n+        return switch (arr) {\n+            case Object[] a -> Arrays.asList(a);\n+            case int[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            case long[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            case float[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            case double[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            case byte[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            case short[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            case char[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            case boolean[] a -> IntStream.range(0, a.length).mapToObj(i -> a[i]).toList();\n+            default -> throw new AssertionError();\n+        };\n+    }\n+\n+    private static String arrayString(Object o) {\n+        if (o.getClass().isArray()) {\n+            var comp = o.getClass().getComponentType();\n+            var mods = 0; \/\/ TODO\n+            return arrayString(comp, mods, arrayToList(o));\n+        } else {\n+            return \"object \" + o.toString();\n@@ -165,0 +334,4 @@\n+    private static String arrayString(Class<?> comp, int mods, List<?> contents) {\n+        return \"%s:%04x%s\".formatted(comp.getName(), mods, contents);\n+    }\n+\n","filename":"test\/jdk\/java\/lang\/runtime\/ArrayCreationTest.java","additions":292,"deletions":119,"binary":false,"changes":411,"status":"modified"}]}