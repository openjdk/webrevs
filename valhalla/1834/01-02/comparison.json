{"files":[{"patch":"@@ -25,1 +25,1 @@\n- * @test id=xcomp-core\n+ * @test\n@@ -69,0 +69,17 @@\n+\/*\n+The test reproduces scenarios when ObjectReference for value object is fetched during the object construction\n+and the object content is changed later. When \"this\" ObjectReference for value object is requested,\n+JDI returns existing reference if there are other references to the equal value object or create a new one otherwise.\n+The test debugs \"new Value(3,6)\" statement by setting breakpoints in Value class constructor at locations\n+when the object being constructed is (0,0), (3,0) and (3,6).\n+\n+Test scenarios are defined by test arguments; TestScaffold passes them creating debuggee process (TargetApp class).\n+Debugsee initializes static fields with value objects (0,0), (3,0), (3,6) depending on the passed arguments.\n+Debugger gets ObjectReferences for the fields before testing.\n+\n+Tested scenarios:\n+- no existing references;\n+- all 3 references exists;\n+- there are references for 1 and 3 breakpoints.\n+\n+*\/\n@@ -128,2 +145,1 @@\n-            System.out.println(\"ERROR: cannot get 'this' object: \" + ex);\n-            return null;\n+            throw new RuntimeException(\"Cannot get 'this' object\", ex);\n@@ -161,2 +177,2 @@\n-    \/\/ Sanoty testing ReferenceTypeImpl.isInlined() logic.\n-    void verifyClassIsInlined(ClassType theClass, boolean expected) {\n+    \/\/ Sanity testing for value object detection logic.\n+    void verifyClassIsValueClass(ClassType theClass, boolean expected) {\n@@ -172,5 +188,5 @@\n-        boolean isInlined = !isIdentity && !isInterface && !isAbstract;\n-        System.out.println(\"Class \" + theClass + \" is inlined: \" + (isInlined ? \"YES\" : \"NO\"));\n-        if (isInlined != expected) {\n-            throw new RuntimeException(\"IsInlined verification failed: \"\n-                                     + \" \" + isInlined + \", expected: \" + expected\n+        boolean isValueClass = !isIdentity && !isInterface && !isAbstract;\n+        System.out.println(\"Class \" + theClass + \" is value class: \" + (isValueClass ? \"YES\" : \"NO\"));\n+        if (isValueClass != expected) {\n+            throw new RuntimeException(\"IsValueClass verification failed: \"\n+                                     + \" \" + isValueClass + \", expected: \" + expected\n@@ -218,1 +234,1 @@\n-    \/\/ This halper class is a listener which resumes debuggee after breakpoints.\n+    \/\/ This helper class is a listener which resumes debuggee after breakpoints.\n@@ -262,1 +278,1 @@\n-        \/\/ Resumes the debuggee and go through all breackpoints until the location specified is reached.\n+        \/\/ Resumes the debuggee and goes through all breackpoints until the location specified is reached.\n@@ -344,2 +360,2 @@\n-        verifyClassIsInlined(valueClass, true);\n-        verifyClassIsInlined(targetClass, false);\n+        verifyClassIsValueClass(valueClass, true);\n+        verifyClassIsValueClass(targetClass, false);\n@@ -347,0 +363,1 @@\n+        \/\/ Get references for pre-created objects created by debuggee.\n@@ -353,0 +370,1 @@\n+        \/\/ Breakpoints for location when \"this\" is (0,0).\n@@ -359,0 +377,1 @@\n+        \/\/ Breakpoints for location when \"this\" is (3,0).\n@@ -365,0 +384,1 @@\n+        \/\/ Breakpoints for location when \"this\" is (3,6).\n@@ -371,0 +391,1 @@\n+        \/\/ Go through all breakpoints.\n@@ -375,0 +396,1 @@\n+        \/\/ Analyze gathered data depending on the testcase.\n","filename":"test\/jdk\/com\/sun\/jdi\/valhalla\/CtorDebuggingTest.java","additions":36,"deletions":14,"binary":false,"changes":50,"status":"modified"}]}