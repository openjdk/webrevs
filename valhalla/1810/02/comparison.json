{"files":[{"patch":"@@ -55,1 +55,10 @@\n-     * Creates a new instance of {@code ForwardingJavaFileManager}.\n+     * Whether the delegate is owned by this instance and should be closed when\n+     * this instance is closed.\n+     *\/\n+    private final boolean shouldClose;\n+\n+    \/**\n+     * Creates a new instance of {@code ForwardingJavaFileManager} which takes\n+     * ownership of the given delegate, and will close it when this instance is\n+     * closed.\n+     *\n@@ -59,0 +68,11 @@\n+        this(fileManager, true);\n+    }\n+\n+    \/**\n+     * Creates a new instance of {@code ForwardingJavaFileManager}.\n+     *\n+     * @param fileManager delegate to this file manager\n+     * @param shouldClose whether the delegate should be closed when this\n+     *     instance is closed.\n+     *\/\n+    protected ForwardingJavaFileManager(M fileManager, boolean shouldClose) {\n@@ -60,0 +80,1 @@\n+        this.shouldClose = shouldClose;\n@@ -250,1 +271,3 @@\n-        fileManager.close();\n+        if (shouldClose) {\n+            fileManager.close();\n+        }\n","filename":"src\/java.compiler\/share\/classes\/javax\/tools\/ForwardingJavaFileManager.java","additions":25,"deletions":2,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -110,8 +110,8 @@\n-            ToolBox.MemoryFileManager memoryFM1 = new ToolBox.MemoryFileManager(fm);\n-            new JavacTask(tb).fileManager(memoryFM1)\n-                              .sources(aJava, bJava)\n-                              .run();\n-            ToolBox.MemoryFileManager memoryFM2 = new ToolBox.MemoryFileManager(fm);\n-            new JavacTask(tb).fileManager(memoryFM2)\n-                              .sources(bJava, aJava)\n-                              .run();\n+            try (var memoryFM1 = new ToolBox.MemoryFileManager(fm, false);\n+                 var memoryFM2 = new ToolBox.MemoryFileManager(fm, false)) {\n+                new JavacTask(tb).fileManager(memoryFM1)\n+                        .sources(aJava, bJava)\n+                        .run();\n+                new JavacTask(tb).fileManager(memoryFM2)\n+                        .sources(bJava, aJava)\n+                        .run();\n@@ -119,2 +119,3 @@\n-            Assert.check(Arrays.equals(memoryFM1.getFileBytes(StandardLocation.CLASS_OUTPUT, \"B\"),\n-                                       memoryFM2.getFileBytes(StandardLocation.CLASS_OUTPUT, \"B\")));\n+                Assert.check(Arrays.equals(memoryFM1.getFileBytes(StandardLocation.CLASS_OUTPUT, \"B\"),\n+                        memoryFM2.getFileBytes(StandardLocation.CLASS_OUTPUT, \"B\")));\n+            }\n","filename":"test\/langtools\/tools\/javac\/classfiles\/InnerClasses\/T8068517.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -70,1 +70,0 @@\n-import toolbox.TestRunner.Test;\n@@ -177,1 +176,1 @@\n-                try (MemoryFileManager mfm = new MemoryFileManager(sjfm)) {\n+                try (MemoryFileManager mfm = new MemoryFileManager(sjfm, \/* shouldClose *\/ false)) {\n","filename":"test\/langtools\/tools\/javac\/processing\/filer\/TestOriginatingElements.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -859,1 +859,1 @@\n-            this(ToolProvider.getSystemJavaCompiler().getStandardFileManager(null, null, null));\n+            this(ToolProvider.getSystemJavaCompiler().getStandardFileManager(null, null, null), true);\n@@ -867,0 +867,2 @@\n+         * @param shouldClose whether the delegate file manager should be closed\n+         *     when this instance is closed\n@@ -868,2 +870,2 @@\n-        public MemoryFileManager(JavaFileManager fileManager) {\n-            super(fileManager);\n+        public MemoryFileManager(JavaFileManager fileManager, boolean shouldClose) {\n+            super(fileManager, shouldClose);\n","filename":"test\/langtools\/tools\/lib\/toolbox\/ToolBox.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"}]}