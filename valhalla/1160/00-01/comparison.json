{"files":[{"patch":"@@ -309,15 +309,2 @@\n-#define CHECK_THROW_NOSYNC_IE(obj) \\\n-  if (obj->klass()->is_inline_klass()) { \\\n-    ResourceMark rm(THREAD); \\\n-    const char* desc = \"Cannot synchronize on an instance of value class \"; \\\n-    const char* className = obj->klass()->external_name(); \\\n-    size_t msglen = strlen(desc) + strlen(className) + 1; \\\n-    char* message = NEW_RESOURCE_ARRAY(char, msglen); \\\n-    if (nullptr == message) { \\\n-      THROW_MSG(vmSymbols::java_lang_IdentityException(), className); \\\n-    } else { \\\n-      jio_snprintf(message, msglen, \"%s%s\", desc, className); \\\n-      THROW_MSG(vmSymbols::java_lang_IdentityException(), message); \\\n-    } \\\n-  }\n-\n+\/\/ These checks are required for wait, notify and exit to avoid inflating the monitor to\n+\/\/ find out this inline type object cannot be locked.\n@@ -558,4 +545,1 @@\n-  if (obj->klass()->is_inline_klass()) {\n-    \/\/ JITed code should never have locked an instance of a value class\n-    ShouldNotReachHere();\n-  }\n+  assert(!EnableValhalla || !obj->klass()->is_inline_klass(), \"JITed code should never have locked an instance of a value class\");\n@@ -581,1 +565,1 @@\n-  CHECK_THROW_NOSYNC_IE(obj);\n+  assert(!EnableValhalla || !obj->klass()->is_inline_klass(), \"This method should never be called on an instance of an inline class\");\n@@ -790,1 +774,9 @@\n-  CHECK_THROW_NOSYNC_IE(obj);\n+  if (EnableValhalla && obj->klass()->is_inline_klass()) {\n+    ResourceMark rm(THREAD);\n+    const char* desc = \"Cannot synchronize on an instance of value class \";\n+    const char* className = obj->klass()->external_name();\n+    size_t msglen = strlen(desc) + strlen(className) + 1;\n+    char* message = NEW_RESOURCE_ARRAY(char, msglen);\n+    assert(message != nullptr, \"NEW_RESOURCE_ARRAY should have called vm_exit_out_of_memory and not return nullptr\");\n+    THROW_MSG(vmSymbols::java_lang_IdentityException(), className);\n+  }\n","filename":"src\/hotspot\/share\/runtime\/synchronizer.cpp","additions":13,"deletions":21,"binary":false,"changes":34,"status":"modified"}]}