{"files":[{"patch":"@@ -238,1 +238,1 @@\n-      if (is_payload_marked_as_null((address)((char*)(oopDesc*)src + offset))) {\n+      if (is_payload_marked_as_null(cast_from_oop<address>(src) + offset)) {\n@@ -247,1 +247,7 @@\n-      copy_payload_to_addr((void*)(cast_from_oop<char*>(obj_h()) + offset), payload_addr(res), lk, false);\n+      copy_payload_to_addr((void*)(cast_from_oop<address>(obj_h()) + offset), payload_addr(res), lk, false);\n+\n+      \/\/ After copying, re-check if the payload is now marked as null. Another\n+      \/\/ thread could have marked the src object as null after the initial check\n+      \/\/ but before the copy operation, causing the null-marker to be marked in\n+      \/\/ the destination. In this case, discard the allocated object and\n+      \/\/ return nullptr.\n@@ -249,1 +255,1 @@\n-        if(is_payload_marked_as_null(payload_addr(res))) {\n+        if (is_payload_marked_as_null(payload_addr(res))) {\n@@ -253,0 +259,1 @@\n+\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.cpp","additions":10,"deletions":3,"binary":false,"changes":13,"status":"modified"}]}