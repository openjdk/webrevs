{"files":[{"patch":"@@ -957,1 +957,0 @@\n-        JCClassDecl localClassPrev = env.info.localClass;\n@@ -959,1 +958,0 @@\n-            env.info.localClass = env.enclMethod != null ? tree : null;\n@@ -993,1 +991,0 @@\n-            env.info.localClass = localClassPrev;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -135,5 +135,0 @@\n-    \/**\n-     *  Local class being attributed if any\n-     *\/\n-    JCTree.JCClassDecl localClass = null;\n-\n@@ -165,1 +160,0 @@\n-        info.localClass = localClass;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/AttrContext.java","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -220,1 +220,0 @@\n-    private final LocalProxyVarsGen localProxyVarsGen;\n@@ -349,1 +348,0 @@\n-        localProxyVarsGen = LocalProxyVarsGen.instance(context);\n@@ -3229,3 +3227,0 @@\n-            if (localProxyVarsGen.hasAST(currentMethod, tree)) {\n-                checkInit(tree.pos(), (VarSymbol)tree.sym);\n-            }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Flow.java","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1544,1 +1544,1 @@\n-                        EarlyReferenceKind erk =  isAllowedEarlyReference(pos, env1, (VarSymbol)sym);\n+                        EarlyReferenceKind erk = isAllowedEarlyReference(pos, env1, env1 == env, (VarSymbol)sym);\n@@ -3855,1 +3855,1 @@\n-                    } else if (env1.info.ctorPrologue && isAllowedEarlyReference(pos, env1, (VarSymbol)sym) != EarlyReferenceKind.ACCEPTABLE) {\n+                    } else if (env1.info.ctorPrologue && isAllowedEarlyReference(pos, env1, env1 == env, (VarSymbol)sym) != EarlyReferenceKind.ACCEPTABLE) {\n@@ -3917,1 +3917,1 @@\n-                        EarlyReferenceKind erk = isAllowedEarlyReference(pos, env1, (VarSymbol)sym);\n+                        EarlyReferenceKind erk = isAllowedEarlyReference(pos, env1, env1 == env, (VarSymbol)sym);\n@@ -4026,1 +4026,1 @@\n-    private EarlyReferenceKind isAllowedEarlyReference(DiagnosticPosition pos, Env<AttrContext> env, VarSymbol v) {\n+    private EarlyReferenceKind isAllowedEarlyReference(DiagnosticPosition pos, Env<AttrContext> env, boolean originalEnv, VarSymbol v) {\n@@ -4032,1 +4032,1 @@\n-        if (env.info.isLambda || env.info.localClass != null) {\n+        if (env.info.isLambda || !originalEnv) {\n@@ -4035,0 +4035,1 @@\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Resolve.java","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -32,0 +32,31 @@\n+\n+    class Inner2 {\n+        Inner2() {\n+            class Sup {\n+                int x;\n+            }\n+            class Local extends Sup {\n+                Local() {\n+                    x = 42;   \/\/ x is declared in a super type, error\n+                    super();\n+                }\n+            }\n+            super();\n+        }\n+    }\n+\n+    class Inner3 {\n+        Inner3() {\n+            class Local {\n+                class Foo {\n+                    int x;\n+\n+                    Foo() {\n+                        x = 42;  \/\/ this is OK `x` belongs to Foo\n+                        super();\n+                    }\n+                }\n+            }\n+            super();\n+        }\n+    }\n","filename":"test\/langtools\/tools\/javac\/LocalClassCtorPrologue.java","additions":31,"deletions":0,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,0 +2,1 @@\n+LocalClassCtorPrologue.java:40:21: compiler.err.cant.ref.before.ctor.called: x\n@@ -4,1 +5,1 @@\n-1 error\n+2 errors\n","filename":"test\/langtools\/tools\/javac\/LocalClassCtorPrologue.out","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}