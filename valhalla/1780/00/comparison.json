{"files":[{"patch":"@@ -5915,71 +5915,0 @@\n-#if COMPILER2_OR_JVMCI\n-\n-\/\/ clear memory of size 'cnt' qwords, starting at 'base' using XMM\/YMM\/ZMM registers\n-void MacroAssembler::xmm_clear_mem(Register base, Register cnt, Register val, XMMRegister xtmp, KRegister mask) {\n-  \/\/ cnt - number of qwords (8-byte words).\n-  \/\/ base - start address, qword aligned.\n-  Label L_zero_64_bytes, L_loop, L_sloop, L_tail, L_end;\n-  bool use64byteVector = (MaxVectorSize == 64) && (VM_Version::avx3_threshold() == 0);\n-  if (use64byteVector) {\n-    evpbroadcastq(xtmp, val, AVX_512bit);\n-  } else if (MaxVectorSize >= 32) {\n-    movdq(xtmp, val);\n-    punpcklqdq(xtmp, xtmp);\n-    vinserti128_high(xtmp, xtmp);\n-  } else {\n-    movdq(xtmp, val);\n-    punpcklqdq(xtmp, xtmp);\n-  }\n-  jmp(L_zero_64_bytes);\n-\n-  BIND(L_loop);\n-  if (MaxVectorSize >= 32) {\n-    fill64(base, 0, xtmp, use64byteVector);\n-  } else {\n-    movdqu(Address(base,  0), xtmp);\n-    movdqu(Address(base, 16), xtmp);\n-    movdqu(Address(base, 32), xtmp);\n-    movdqu(Address(base, 48), xtmp);\n-  }\n-  addptr(base, 64);\n-\n-  BIND(L_zero_64_bytes);\n-  subptr(cnt, 8);\n-  jccb(Assembler::greaterEqual, L_loop);\n-\n-  \/\/ Copy trailing 64 bytes\n-  if (use64byteVector) {\n-    addptr(cnt, 8);\n-    jccb(Assembler::equal, L_end);\n-    fill64_masked(3, base, 0, xtmp, mask, cnt, val, true);\n-    jmp(L_end);\n-  } else {\n-    addptr(cnt, 4);\n-    jccb(Assembler::less, L_tail);\n-    if (MaxVectorSize >= 32) {\n-      vmovdqu(Address(base, 0), xtmp);\n-    } else {\n-      movdqu(Address(base,  0), xtmp);\n-      movdqu(Address(base, 16), xtmp);\n-    }\n-  }\n-  addptr(base, 32);\n-  subptr(cnt, 4);\n-\n-  BIND(L_tail);\n-  addptr(cnt, 4);\n-  jccb(Assembler::lessEqual, L_end);\n-  if (UseAVX > 2 && MaxVectorSize >= 32 && VM_Version::supports_avx512vl()) {\n-    fill32_masked(3, base, 0, xtmp, mask, cnt, val);\n-  } else {\n-    decrement(cnt);\n-\n-    BIND(L_sloop);\n-    movq(Address(base, 0), xtmp);\n-    addptr(base, 8);\n-    decrement(cnt);\n-    jccb(Assembler::greaterEqual, L_sloop);\n-  }\n-  BIND(L_end);\n-}\n-\n@@ -6396,0 +6325,71 @@\n+#if COMPILER2_OR_JVMCI\n+\n+\/\/ clear memory of size 'cnt' qwords, starting at 'base' using XMM\/YMM\/ZMM registers\n+void MacroAssembler::xmm_clear_mem(Register base, Register cnt, Register val, XMMRegister xtmp, KRegister mask) {\n+  \/\/ cnt - number of qwords (8-byte words).\n+  \/\/ base - start address, qword aligned.\n+  Label L_zero_64_bytes, L_loop, L_sloop, L_tail, L_end;\n+  bool use64byteVector = (MaxVectorSize == 64) && (VM_Version::avx3_threshold() == 0);\n+  if (use64byteVector) {\n+    evpbroadcastq(xtmp, val, AVX_512bit);\n+  } else if (MaxVectorSize >= 32) {\n+    movdq(xtmp, val);\n+    punpcklqdq(xtmp, xtmp);\n+    vinserti128_high(xtmp, xtmp);\n+  } else {\n+    movdq(xtmp, val);\n+    punpcklqdq(xtmp, xtmp);\n+  }\n+  jmp(L_zero_64_bytes);\n+\n+  BIND(L_loop);\n+  if (MaxVectorSize >= 32) {\n+    fill64(base, 0, xtmp, use64byteVector);\n+  } else {\n+    movdqu(Address(base,  0), xtmp);\n+    movdqu(Address(base, 16), xtmp);\n+    movdqu(Address(base, 32), xtmp);\n+    movdqu(Address(base, 48), xtmp);\n+  }\n+  addptr(base, 64);\n+\n+  BIND(L_zero_64_bytes);\n+  subptr(cnt, 8);\n+  jccb(Assembler::greaterEqual, L_loop);\n+\n+  \/\/ Copy trailing 64 bytes\n+  if (use64byteVector) {\n+    addptr(cnt, 8);\n+    jccb(Assembler::equal, L_end);\n+    fill64_masked(3, base, 0, xtmp, mask, cnt, val, true);\n+    jmp(L_end);\n+  } else {\n+    addptr(cnt, 4);\n+    jccb(Assembler::less, L_tail);\n+    if (MaxVectorSize >= 32) {\n+      vmovdqu(Address(base, 0), xtmp);\n+    } else {\n+      movdqu(Address(base,  0), xtmp);\n+      movdqu(Address(base, 16), xtmp);\n+    }\n+  }\n+  addptr(base, 32);\n+  subptr(cnt, 4);\n+\n+  BIND(L_tail);\n+  addptr(cnt, 4);\n+  jccb(Assembler::lessEqual, L_end);\n+  if (UseAVX > 2 && MaxVectorSize >= 32 && VM_Version::supports_avx512vl()) {\n+    fill32_masked(3, base, 0, xtmp, mask, cnt, val);\n+  } else {\n+    decrement(cnt);\n+\n+    BIND(L_sloop);\n+    movq(Address(base, 0), xtmp);\n+    addptr(base, 8);\n+    decrement(cnt);\n+    jccb(Assembler::greaterEqual, L_sloop);\n+  }\n+  BIND(L_end);\n+}\n+\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":71,"deletions":71,"binary":false,"changes":142,"status":"modified"}]}