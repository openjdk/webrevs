{"files":[{"patch":"@@ -1440,2 +1440,7 @@\n-                            if (!isInLHS)\n-                                localProxyVarsGen.addFieldReadInPrologue(localEnv.enclMethod, sym);\n+                            if (!isInLHS) {\n+                                if (allowValueClasses) {\n+                                    localProxyVarsGen.addFieldReadInPrologue(localEnv.enclMethod, sym);\n+                                } else {\n+                                    reportPrologueError(tree, sym);\n+                                }\n+                            }\n@@ -1460,1 +1465,0 @@\n-            JCTree base = tree instanceof JCFieldAccess fa ? fa.selected : null;\n@@ -1465,2 +1469,2 @@\n-                if (base != null) {\n-                    return TreeInfo.isExplicitThisReference(types, (ClassType)env.enclClass.type, base);\n+                if (tree instanceof JCFieldAccess fa) {\n+                    return TreeInfo.isExplicitThisReference(types, (ClassType)env.enclClass.type, fa.selected);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-EarlyAssignmentNoPreview1.java:13:13: compiler.err.feature.not.supported.in.source: (compiler.misc.feature.flexible.constructors), 24, 25\n+EarlyAssignmentNoPreview1.java:13:14: compiler.err.feature.not.supported.in.source: (compiler.misc.feature.flexible.constructors), 24, 25\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignmentNoPreview1.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-EarlyAssignmentNoPreview2.java:13:13: compiler.err.feature.not.supported.in.source: (compiler.misc.feature.flexible.constructors), 24, 25\n+EarlyAssignmentNoPreview2.java:13:18: compiler.err.feature.not.supported.in.source: (compiler.misc.feature.flexible.constructors), 24, 25\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignmentNoPreview2.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-EarlyAssignmentNoPreview3.java:13:13: compiler.err.feature.not.supported.in.source: (compiler.misc.feature.flexible.constructors), 24, 25\n+EarlyAssignmentNoPreview3.java:13:44: compiler.err.feature.not.supported.in.source: (compiler.misc.feature.flexible.constructors), 24, 25\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignmentNoPreview3.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -6,0 +6,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignments.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1,22 +1,22 @@\n-EarlyAssignments.java:30:26: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:31:21: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:32:26: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:33:34: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:35:36: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:39:17: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:43:21: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:47:22: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:65:13: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:66:17: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:67:25: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:68:31: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:118:17: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:123:22: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:128:29: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:133:22: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:138:28: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:147:13: compiler.err.cant.assign.initialized.before.ctor.called: x\n-EarlyAssignments.java:156:13: compiler.err.cant.assign.val.to.var: final, x\n-EarlyAssignments.java:167:13: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:167:18: compiler.err.cant.ref.before.ctor.called: EarlyAssignments.Inner8\n-EarlyAssignments.java:176:17: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:31:26: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:32:21: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:33:26: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:34:34: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:36:36: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:40:17: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:44:21: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:48:22: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:66:13: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:67:17: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:68:25: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:69:31: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:119:17: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:124:22: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:129:29: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:134:22: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:139:28: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:148:13: compiler.err.cant.assign.initialized.before.ctor.called: x\n+EarlyAssignments.java:157:13: compiler.err.cant.assign.val.to.var: final, x\n+EarlyAssignments.java:168:13: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:168:18: compiler.err.cant.ref.before.ctor.called: EarlyAssignments.Inner8\n+EarlyAssignments.java:177:17: compiler.err.cant.ref.before.ctor.called: x\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignments.out","additions":22,"deletions":22,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -6,0 +6,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/SuperInitFails.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1,36 +1,36 @@\n-SuperInitFails.java:56:9: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:61:13: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:66:14: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:71:28: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:76:29: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:98:33: compiler.err.cant.ref.before.ctor.called: this\n-SuperInitFails.java:103:14: compiler.err.cant.ref.before.ctor.called: this\n-SuperInitFails.java:107:20: compiler.err.not.encl.class: java.lang.Object\n-SuperInitFails.java:111:23: compiler.err.cant.ref.before.ctor.called: spliterator()\n-SuperInitFails.java:118:22: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:124:9: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n-SuperInitFails.java:132:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record1\n-SuperInitFails.java:137:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record2\n-SuperInitFails.java:154:50: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:158:15: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n-SuperInitFails.java:167:13: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:171:17: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:175:24: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:179:18: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:185:32: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:194:36: compiler.err.cant.ref.before.ctor.called: xx\n-SuperInitFails.java:205:25: compiler.err.return.before.superclass.initialized\n-SuperInitFails.java:210:33: compiler.err.ctor.calls.not.allowed.here\n-SuperInitFails.java:215:29: compiler.err.redundant.superclass.init\n-SuperInitFails.java:228:41: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:229:16: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:238:35: compiler.err.cant.ref.before.ctor.called: this\n-SuperInitFails.java:32:13: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:36:14: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:40:14: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:44:13: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:48:33: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:52:32: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:82:18: compiler.err.ctor.calls.not.allowed.here\n-SuperInitFails.java:88:13: compiler.err.return.before.superclass.initialized\n-SuperInitFails.java:149:18: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:57:9: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:62:13: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:67:14: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:72:28: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:77:29: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:99:33: compiler.err.cant.ref.before.ctor.called: this\n+SuperInitFails.java:104:14: compiler.err.cant.ref.before.ctor.called: this\n+SuperInitFails.java:108:20: compiler.err.not.encl.class: java.lang.Object\n+SuperInitFails.java:112:23: compiler.err.cant.ref.before.ctor.called: spliterator()\n+SuperInitFails.java:119:22: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:125:9: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n+SuperInitFails.java:133:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record1\n+SuperInitFails.java:138:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record2\n+SuperInitFails.java:155:50: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:159:15: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n+SuperInitFails.java:168:13: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:172:17: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:176:24: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:180:18: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:186:32: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:195:36: compiler.err.cant.ref.before.ctor.called: xx\n+SuperInitFails.java:206:25: compiler.err.return.before.superclass.initialized\n+SuperInitFails.java:211:33: compiler.err.ctor.calls.not.allowed.here\n+SuperInitFails.java:216:29: compiler.err.redundant.superclass.init\n+SuperInitFails.java:229:41: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:230:16: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:239:35: compiler.err.cant.ref.before.ctor.called: this\n+SuperInitFails.java:33:13: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:37:14: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:41:14: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:45:13: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:49:33: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:53:32: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:83:18: compiler.err.ctor.calls.not.allowed.here\n+SuperInitFails.java:89:13: compiler.err.return.before.superclass.initialized\n+SuperInitFails.java:150:18: compiler.err.call.must.only.appear.in.ctor\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/SuperInitFails.out","additions":36,"deletions":36,"binary":false,"changes":72,"status":"modified"}]}