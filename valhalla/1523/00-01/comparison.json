{"files":[{"patch":"@@ -1428,1 +1428,1 @@\n-                            localProxyVarsGen.addStrictFieldReadInPrologue(localEnv.enclMethod, sym);\n+                            localProxyVarsGen.addFinalOrStrictFieldReadInPrologue(localEnv.enclMethod, sym);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -91,2 +91,2 @@\n-    private java.util.List<JCVariableDecl> strictInstanceFields;\n-    private Map<JCMethodDecl, Set<Symbol>> strictFieldsReadInPrologue = new HashMap<>();\n+    private java.util.List<JCVariableDecl> finalOrStrictInstanceFields;\n+    private Map<JCMethodDecl, Set<Symbol>> finalOrStrictFieldsReadInPrologue = new HashMap<>();\n@@ -108,2 +108,2 @@\n-    public void addStrictFieldReadInPrologue(JCMethodDecl constructor, Symbol sym) {\n-        Set<Symbol> fieldSet = strictFieldsReadInPrologue.getOrDefault(constructor, new HashSet<>());\n+    public void addFinalOrStrictFieldReadInPrologue(JCMethodDecl constructor, Symbol sym) {\n+        Set<Symbol> fieldSet = finalOrStrictFieldsReadInPrologue.getOrDefault(constructor, new HashSet<>());\n@@ -111,1 +111,1 @@\n-        strictFieldsReadInPrologue.put(constructor, fieldSet);\n+        finalOrStrictFieldsReadInPrologue.put(constructor, fieldSet);\n@@ -131,1 +131,1 @@\n-        java.util.List<JCVariableDecl> prevStrictInstanceFields = strictInstanceFields;\n+        java.util.List<JCVariableDecl> prevFinalOrStrictInstanceFields = finalOrStrictInstanceFields;\n@@ -134,1 +134,1 @@\n-            strictInstanceFields = tree.defs.stream()\n+            finalOrStrictInstanceFields = tree.defs.stream()\n@@ -137,1 +137,1 @@\n-                    .filter(vd -> vd.sym.isStrict() && !vd.sym.isStatic())\n+                    .filter(vd -> (vd.sym.isStrict() || vd.sym.isFinal()) && !vd.sym.isStatic())\n@@ -142,1 +142,1 @@\n-            strictInstanceFields = prevStrictInstanceFields;\n+            finalOrStrictInstanceFields = prevFinalOrStrictInstanceFields;\n@@ -147,6 +147,6 @@\n-        if (strictFieldsReadInPrologue.get(tree) != null) {\n-            Set<Symbol> fieldSet = strictFieldsReadInPrologue.get(tree);\n-            java.util.List<JCVariableDecl> strictFieldsRead = new ArrayList<>();\n-            for (JCVariableDecl sfield : strictInstanceFields) {\n-                if (fieldSet.contains(sfield.sym)) {\n-                    strictFieldsRead.add(sfield);\n+        if (finalOrStrictFieldsReadInPrologue.get(tree) != null) {\n+            Set<Symbol> fieldSet = finalOrStrictFieldsReadInPrologue.get(tree);\n+            java.util.List<JCVariableDecl> finalOrStrictFieldsRead = new ArrayList<>();\n+            for (JCVariableDecl field : finalOrStrictInstanceFields) {\n+                if (fieldSet.contains(field.sym)) {\n+                    finalOrStrictFieldsRead.add(field);\n@@ -155,2 +155,2 @@\n-            addLocalProxiesFor(tree, strictFieldsRead);\n-            strictFieldsReadInPrologue.remove(tree);\n+            addLocalProxiesFor(tree, finalOrStrictFieldsRead);\n+            finalOrStrictFieldsReadInPrologue.remove(tree);\n@@ -161,1 +161,1 @@\n-    void addLocalProxiesFor(JCMethodDecl constructor, java.util.List<JCVariableDecl> multiAssignedStrictFields) {\n+    void addLocalProxiesFor(JCMethodDecl constructor, java.util.List<JCVariableDecl> finalOrStrictFields) {\n@@ -165,1 +165,1 @@\n-        for (JCVariableDecl fieldDecl : multiAssignedStrictFields) {\n+        for (JCVariableDecl fieldDecl : finalOrStrictFields) {\n@@ -214,1 +214,1 @@\n-    Name newLocalName(String name) {\n+    private Name newLocalName(String name) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/LocalProxyVarsGen.java","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -20,1 +20,1 @@\n-EarlyAssignments.java:168:18: compiler.err.cant.ref.before.ctor.called: EarlyAssignments.Inner8.Inner8a()\n+EarlyAssignments.java:168:18: compiler.err.cant.ref.before.ctor.called: EarlyAssignments.Inner8\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignments.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -11,1 +11,1 @@\n-SuperInitFails.java:125:9: compiler.err.cant.ref.before.ctor.called: SuperInitFails.Inner1()\n+SuperInitFails.java:125:9: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n@@ -15,1 +15,1 @@\n-SuperInitFails.java:159:15: compiler.err.cant.ref.before.ctor.called: SuperInitFails.Inner1()\n+SuperInitFails.java:159:15: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/SuperInitFails.out","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -11,1 +11,1 @@\n-ValueClassSuperInitFails.java:135:9: compiler.err.cant.ref.before.ctor.called: ValueClassSuperInitFails.Inner1()\n+ValueClassSuperInitFails.java:135:9: compiler.err.cant.ref.before.ctor.called: ValueClassSuperInitFails\n@@ -16,1 +16,1 @@\n-ValueClassSuperInitFails.java:179:15: compiler.err.cant.ref.before.ctor.called: ValueClassSuperInitFails.Inner1()\n+ValueClassSuperInitFails.java:179:15: compiler.err.cant.ref.before.ctor.called: ValueClassSuperInitFails\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/ValueClassSuperInitFails.out","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-NewBeforeOuterConstructed.java:27:21: compiler.err.cant.ref.before.ctor.called: NewBeforeOuterConstructed.NullOutputStream()\n+NewBeforeOuterConstructed.java:27:21: compiler.err.cant.ref.before.ctor.called: NewBeforeOuterConstructed\n","filename":"test\/langtools\/tools\/javac\/implicitThis\/NewBeforeOuterConstructed.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-NewBeforeOuterConstructed2.java:20:35: compiler.err.cant.ref.before.ctor.called: NewBeforeOuterConstructed2.Middle(int)\n+NewBeforeOuterConstructed2.java:20:35: compiler.err.cant.ref.before.ctor.called: NewBeforeOuterConstructed2\n","filename":"test\/langtools\/tools\/javac\/implicitThis\/NewBeforeOuterConstructed2.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}