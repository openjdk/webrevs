{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -1067,19 +1067,3 @@\n-  if (_layout->super_has_fields() && !_is_abstract_value) {  \/\/ non-static field layout\n-    if (!_has_nonstatic_fields) {\n-      assert(_is_abstract_value, \"Concrete value types have at least one field\");\n-      \/\/ Nothing to do\n-    } else {\n-      \/\/ decide which alignment to use, then set first allowed field offset\n-\n-      assert(_layout->super_alignment() >= _payload_alignment, \"Incompatible alignment\");\n-      assert(_layout->super_alignment() % _payload_alignment == 0, \"Incompatible alignment\");\n-\n-      if (_payload_alignment < _layout->super_alignment()) {\n-        int new_alignment = _payload_alignment > _layout->super_min_align_required() ? _payload_alignment : _layout->super_min_align_required();\n-        assert(new_alignment % _payload_alignment == 0, \"Must be\");\n-        assert(new_alignment % _layout->super_min_align_required() == 0, \"Must be\");\n-        _payload_alignment = new_alignment;\n-      }\n-      _layout->set_start(_layout->first_field_block());\n-    }\n-  } else {\n+  if (!_layout->super_has_fields()) {\n+    \/\/ No inherited fields, the layout must be empty except for the RESERVED block\n+    \/\/ PADDING is inserted if needed to ensure the correct alignment of the payload.\n@@ -1087,0 +1071,4 @@\n+      \/\/ non-static fields of the abstract class must be laid out without knowning\n+      \/\/ the alignment constraints of the fields of the sub-classes, so the worst\n+      \/\/ case scenario is assumed, which is currently the alignment of T_LONG.\n+      \/\/ PADDING is added if needed to ensure the payload will respect this alignment.\n@@ -1089,1 +1077,1 @@\n-    assert(_layout->start()->next_block()->block_kind() == LayoutRawBlock::EMPTY || !UseCompressedClassPointers, \"Unexpected\");\n+    assert(_layout->start()->next_block()->block_kind() == LayoutRawBlock::EMPTY, \"Unexpected\");\n@@ -1099,0 +1087,23 @@\n+  } else { \/\/ the class has inherited some fields from its super(s)\n+    if (!_is_abstract_value) {\n+      \/\/ This is the step where the layout of the final concrete value class' layout\n+      \/\/ is computed. Super abstract value classes might have been too conservative\n+      \/\/ regarding alignment constraints, but now that the full set of non-static fields is\n+      \/\/ known, compute which alignment to use, then set first allowed field offset\n+\n+      assert(_has_nonstatic_fields, \"Concrete value classes must have at least one field\");\n+      if (_payload_alignment == -1) { \/\/ current class declares no local nonstatic fields\n+        _payload_alignment = _layout->super_min_align_required();\n+      }\n+\n+      assert(_layout->super_alignment() >= _payload_alignment, \"Incompatible alignment\");\n+      assert(_layout->super_alignment() % _payload_alignment == 0, \"Incompatible alignment\");\n+\n+      if (_payload_alignment < _layout->super_alignment()) {\n+        int new_alignment = _payload_alignment > _layout->super_min_align_required() ? _payload_alignment : _layout->super_min_align_required();\n+        assert(new_alignment % _payload_alignment == 0, \"Must be\");\n+        assert(new_alignment % _layout->super_min_align_required() == 0, \"Must be\");\n+        _payload_alignment = new_alignment;\n+      }\n+      _layout->set_start(_layout->first_field_block());\n+    }\n","filename":"src\/hotspot\/share\/classfile\/fieldLayoutBuilder.cpp","additions":32,"deletions":21,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,1 @@\n- * @test id=Oops32\n+ * @test id=32\n@@ -32,1 +32,1 @@\n- * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 0\n+ * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 32\n@@ -35,2 +35,13 @@\n-  \/*\n- * @test id=CompressedOops\n+\/*\n+ * @test id=64_COOP_CCP_NCOH\n+ * @requires vm.bits == 64\n+ * @requires vm.flagless\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @enablePreview\n+ * @compile FieldLayoutAnalyzer.java FieldAlignmentTest.java\n+ * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 64_COOP_CCP_NCOH\n+ *\/\n+\n+\/*\n+ * @test id=64_NCOOP_CCP_NCOH\n@@ -43,1 +54,1 @@\n- * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 1\n+ * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 64_NCOOP_CCP_NCOH\n@@ -46,2 +57,2 @@\n-  \/*\n- * @test id=NoCompressedOops\n+\/*\n+ * @test id=64_NCOOP_NCCP_NCOH\n@@ -54,1 +65,23 @@\n- * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 2\n+ * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 64_NCOOP_NCCP_NCOH\n+ *\/\n+\n+\/*\n+ * @test id=64_COOP_CCP_COH\n+ * @requires vm.bits == 64\n+ * @requires vm.flagless\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @enablePreview\n+ * @compile FieldLayoutAnalyzer.java FieldAlignmentTest.java\n+ * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 64_COOP_CCP_COH\n+ *\/\n+\n+\/*\n+ * @test id=64_NCOOP_CCP_COH\n+ * @requires vm.bits == 64\n+ * @requires vm.flagless\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @enablePreview\n+ * @compile FieldLayoutAnalyzer.java FieldAlignmentTest.java\n+ * @run main runtime.valhalla.inlinetypes.field_layout.FieldAlignmentTest 64_NCOOP_CCP_COH\n@@ -155,1 +188,4 @@\n-  static ProcessBuilder exec(String compressedOopsArg, String... args) throws Exception {\n+  static ProcessBuilder exec(String compressedOopsArg,\n+                             String compressedKlassPointersArg,\n+                             String compactObjectHeader,\n+                             String... args) throws Exception {\n@@ -164,0 +200,6 @@\n+    if (compressedKlassPointersArg != null) {\n+      Collections.addAll(argsList, compressedKlassPointersArg);\n+    }\n+    if (compactObjectHeader != null) {\n+      Collections.addAll(argsList, compactObjectHeader);\n+    }\n@@ -172,0 +214,2 @@\n+    String compressedKlassPointersArg;\n+    String compactObjectHeaderArg;\n@@ -174,6 +218,30 @@\n-      case \"0\": compressedOopsArg = null;\n-                break;\n-      case \"1\": compressedOopsArg = \"-XX:+UseCompressedOops\";\n-                break;\n-      case \"2\": compressedOopsArg = \"-XX:-UseCompressedOops\";\n-                break;\n+      case \"32\":\n+        compressedOopsArg = null;\n+        compressedKlassPointersArg = null;\n+        compactObjectHeaderArg = null;\n+        break;\n+      case \"64_COOP_CCP_NCOH\":\n+        compressedOopsArg = \"-XX:+UseCompressedOops\";\n+        compressedKlassPointersArg =  \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_CCP_NCOH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_NCCP_NCOH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:-UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_COOP_CCP_COH\":\n+        compressedOopsArg = \"-XX:+UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:+UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_CCP_COH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:+UseCompactObjectHeaders\";\n+        break;\n@@ -189,1 +257,1 @@\n-    ProcessBuilder pb = exec(compressedOopsArg, \"TestRunner\");\n+    ProcessBuilder pb = exec(compressedOopsArg, compressedKlassPointersArg, compactObjectHeaderArg, \"TestRunner\");\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/field_layout\/FieldAlignmentTest.java","additions":85,"deletions":17,"binary":false,"changes":102,"status":"modified"},{"patch":"@@ -81,5 +81,11 @@\n-  static enum LayoutKind {\n-    NON_FLAT,\n-    NULL_FREE_NON_ATOMIC_FLAT,\n-    NULL_FREE_ATOMIC_FLAT,\n-    NULLABLE_ATOMIC_FLAT;\n+  static public enum LayoutKind {\n+    NON_FLAT(false),\n+    NULL_FREE_NON_ATOMIC_FLAT(false),\n+    NULL_FREE_ATOMIC_FLAT(false),\n+    NULLABLE_ATOMIC_FLAT(true);\n+\n+    private final boolean hasNullMarker;\n+\n+    private LayoutKind(boolean hasNullMarker) {\n+      this.hasNullMarker = hasNullMarker;\n+    }\n@@ -97,0 +103,4 @@\n+\n+    boolean hasNullMarker() {\n+      return this.hasNullMarker;\n+    }\n@@ -127,0 +137,1 @@\n+    boolean hasNullMarker() { return layoutKind.hasNullMarker(); }\n@@ -246,1 +257,1 @@\n-        Asserts.assertTrue(block.type != BlockType.INHERITED); \/\/ static fields cannotbe inherited\n+        Asserts.assertTrue(block.type != BlockType.INHERITED); \/\/ static fields cannot be inherited\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/field_layout\/FieldLayoutAnalyzer.java","additions":17,"deletions":6,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,2 +25,1 @@\n- * @test id=NullMarker32\n- * @ignore\n+ * @test id=32\n@@ -28,0 +27,1 @@\n+ * @requires vm.flagless\n@@ -32,1 +32,1 @@\n- * @run main NullMarkersTest 0\n+ * @run main runtime.valhalla.inlinetypes.field_layout.NullMarkersTest 32\n@@ -36,2 +36,1 @@\n- * @test id=NullMarker64CompressedOops\n- * @ignore\n+ * @test id=64_COOP_CCP_NCOH\n@@ -39,0 +38,1 @@\n+ * @requires vm.flagless\n@@ -43,1 +43,1 @@\n- * @run main NullMarkersTest 1\n+ * @run main runtime.valhalla.inlinetypes.field_layout.NullMarkersTest 64_COOP_CCP_NCOH\n@@ -47,2 +47,1 @@\n- * @test id=NullMarker64NoCompressedOops\n- * @ignore\n+ * @test id=64_NCOOP_CCP_NCOH\n@@ -50,0 +49,1 @@\n+ * @requires vm.flagless\n@@ -54,1 +54,1 @@\n- * @run main NullMarkersTest 2\n+ * @run main runtime.valhalla.inlinetypes.field_layout.NullMarkersTest 64_NCOOP_CCP_NCOH\n@@ -58,2 +58,1 @@\n- * @test id=NullMarker64NoCompressedOopsNoCompressedKlassPointers\n- * @ignore\n+ * @test id=64_NCOOP_NCCP_NCOH\n@@ -61,0 +60,1 @@\n+ * @requires vm.flagless\n@@ -65,1 +65,1 @@\n- * @run main NullMarkersTest 3\n+ * @run main runtime.valhalla.inlinetypes.field_layout.NullMarkersTest 64_NCOOP_NCCP_NCOH\n@@ -68,0 +68,24 @@\n+\/*\n+ * @test id=64_COOP_CCP_COH\n+ * @requires vm.bits == 64\n+ * @requires vm.flagless\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @enablePreview\n+ * @compile FieldLayoutAnalyzer.java NullMarkersTest.java\n+ * @run main runtime.valhalla.inlinetypes.field_layout.NullMarkersTest 64_COOP_CCP_COH\n+ *\/\n+\n+\/*\n+ * @test id=64_NCOOP_CCP_COH\n+ * @requires vm.bits == 64\n+ * @requires vm.flagless\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @enablePreview\n+ * @compile FieldLayoutAnalyzer.java NullMarkersTest.java\n+ * @run main runtime.valhalla.inlinetypes.field_layout.NullMarkersTest 64_NCOOP_CCP_COH\n+ *\/\n+\n+package runtime.valhalla.inlinetypes.field_layout;\n+\n@@ -73,0 +97,1 @@\n+import jdk.internal.vm.annotation.LooselyConsistentValue;\n@@ -83,0 +108,2 @@\n+static final String pkg = \"runtime\/valhalla\/inlinetypes\/field_layout\/\";\n+static final String pkg_path = \"runtime.valhalla.inlinetypes.field_layout.\";\n@@ -86,1 +113,1 @@\n-      Class testClass = Class.forName(\"NullMarkersTest\");\n+      Class testClass = Class.forName(pkg_path+\"NullMarkersTest\");\n@@ -114,1 +141,1 @@\n-    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(\"NullMarkersTest$Container0\");\n+    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container0\");\n@@ -137,1 +164,1 @@\n-    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(\"NullMarkersTest$Container1\");\n+    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container1\");\n@@ -149,2 +176,6 @@\n-  static value class Value2 {\n-    long l = 0;\n+  static abstract value class Value2a {\n+    byte b = 0;\n+  }\n+\n+  static value class Value2 extends Value2a{\n+    int i = 0;\n@@ -166,1 +197,1 @@\n-    FieldLayoutAnalyzer.ClassLayout cla = fla.getClassLayoutFromName(\"NullMarkersTest$Container2a\");\n+    FieldLayoutAnalyzer.ClassLayout cla = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container2a\");\n@@ -170,1 +201,1 @@\n-    FieldLayoutAnalyzer.ClassLayout clb = fla.getClassLayoutFromName(\"NullMarkersTest$Container2b\");\n+    FieldLayoutAnalyzer.ClassLayout clb = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container2b\");\n@@ -177,1 +208,1 @@\n-    double d = 0.0d;\n+    float f = 0.0f;\n@@ -204,1 +235,1 @@\n-    FieldLayoutAnalyzer.ClassLayout cla = fla.getClassLayoutFromName(\"NullMarkersTest$Container3a\");\n+    FieldLayoutAnalyzer.ClassLayout cla = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container3a\");\n@@ -211,1 +242,1 @@\n-    FieldLayoutAnalyzer.ClassLayout clb = fla.getClassLayoutFromName(\"NullMarkersTest$Container3b\");\n+    FieldLayoutAnalyzer.ClassLayout clb = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container3b\");\n@@ -218,1 +249,1 @@\n-    FieldLayoutAnalyzer.ClassLayout clc = fla.getClassLayoutFromName(\"NullMarkersTest$Container3c\");\n+    FieldLayoutAnalyzer.ClassLayout clc = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container3c\");\n@@ -243,1 +274,1 @@\n-    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(\"NullMarkersTest$Container4\");\n+    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container4\");\n@@ -279,1 +310,1 @@\n-    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(\"NullMarkersTest$Container5\");\n+    FieldLayoutAnalyzer.ClassLayout cl = fla.getClassLayoutFromName(pkg+\"NullMarkersTest$Container5\");\n@@ -305,1 +336,1 @@\n-    Collections.addAll(argsList, \"-cp\", System.getProperty(\"java.class.path\") + System.getProperty(\"path.separator\") + \".\");\n+   Collections.addAll(argsList, \"-cp\", System.getProperty(\"java.class.path\") + System.getProperty(\"path.separator\") + \".\");\n@@ -313,0 +344,1 @@\n+    String compactObjectHeaderArg;\n@@ -315,12 +347,30 @@\n-      case \"0\": compressedOopsArg = null;\n-                compressedKlassPointersArg = null;\n-                break;\n-      case \"1\": compressedOopsArg = \"-XX:+UseCompressedOops\";\n-                compressedKlassPointersArg =  \"-XX:+UseCompressedClassPointers\";\n-                break;\n-      case \"2\": compressedOopsArg = \"-XX:-UseCompressedOops\";\n-                compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n-                break;\n-      case \"3\": compressedOopsArg = \"-XX:-UseCompressedOops\";\n-                compressedKlassPointersArg = \"-XX:-UseCompressedClassPointers\";\n-                break;\n+      case \"32\":\n+        compressedOopsArg = null;\n+        compressedKlassPointersArg = null;\n+        compactObjectHeaderArg = null;\n+        break;\n+      case \"64_COOP_CCP_NCOH\":\n+        compressedOopsArg = \"-XX:+UseCompressedOops\";\n+        compressedKlassPointersArg =  \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_CCP_NCOH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_NCCP_NCOH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:-UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_COOP_CCP_COH\":\n+        compressedOopsArg = \"-XX:+UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:+UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_CCP_COH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeaderArg = \"-XX:+UseCompactObjectHeaders\";\n+        break;\n@@ -334,1 +384,1 @@\n-    ProcessBuilder pb = exec(compressedOopsArg, compressedKlassPointersArg, \"NullMarkersTest$TestRunner\");\n+    ProcessBuilder pb = exec(compressedOopsArg, compressedKlassPointersArg, pkg+\"NullMarkersTest$TestRunner\");\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/field_layout\/NullMarkersTest.java","additions":90,"deletions":40,"binary":false,"changes":130,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2024, 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2024, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,1 @@\n- * @test id=32bits\n+ * @test id=32\n@@ -32,1 +32,1 @@\n- * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 0\n+ * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 32\n@@ -36,1 +36,1 @@\n- * @test id=64bitsCompressedOops\n+ * @test id=64_COOP_CCP_NCOH\n@@ -43,1 +43,1 @@\n- * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 1\n+ * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 64_COOP_CCP_NCOH\n@@ -47,1 +47,1 @@\n- * @test id=64bitsNoCompressedOops\n+ * @test id=64_NCOOP_CCP_NCOH\n@@ -54,1 +54,1 @@\n- * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 2\n+ * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 64_NCOOP_CCP_NCOH\n@@ -58,1 +58,1 @@\n- * @test id=64bitsNoCompressedOopsNoCompressKlassPointers\n+ * @test id=64_NCOOP_NCCP_NCOH\n@@ -65,1 +65,23 @@\n- * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 3\n+ * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 64_NCOOP_NCCP_NCOH\n+ *\/\n+\n+\/*\n+ * @test id=64_COOP_CCP_COH\n+ * @requires vm.bits == 64\n+ * @library \/test\/lib\n+ * @requires vm.flagless\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @enablePreview\n+ * @compile FieldLayoutAnalyzer.java ValueFieldInheritanceTest.java\n+ * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 64_COOP_CCP_COH\n+ *\/\n+\n+\/*\n+ * @test id=64_NCOOP_CCP_COH\n+ * @requires vm.bits == 64\n+ * @library \/test\/lib\n+ * @requires vm.flagless\n+ * @modules java.base\/jdk.internal.vm.annotation\n+ * @enablePreview\n+ * @compile FieldLayoutAnalyzer.java ValueFieldInheritanceTest.java\n+ * @run main runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest 64_NCOOP_CCP_COH\n@@ -174,1 +196,4 @@\n-  static ProcessBuilder exec(String compressedOopsArg, String compressedKlassPointersArg, String... args) throws Exception {\n+  static ProcessBuilder exec(String compressedOopsArg,\n+                             String compressedKlassPointersArg,\n+                             String compactObjectHeader,\n+                             String... args) throws Exception {\n@@ -186,0 +211,3 @@\n+    if (compactObjectHeader != null) {\n+      Collections.addAll(argsList, compactObjectHeader);\n+    }\n@@ -195,0 +223,1 @@\n+    String compactObjectHeader;\n@@ -197,12 +226,30 @@\n-      case \"0\": compressedOopsArg = null;\n-                compressedKlassPointersArg = null;\n-                break;\n-      case \"1\": compressedOopsArg = \"-XX:+UseCompressedOops\";\n-                compressedKlassPointersArg =  \"-XX:+UseCompressedClassPointers\";\n-                break;\n-      case \"2\": compressedOopsArg = \"-XX:-UseCompressedOops\";\n-                compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n-                break;\n-      case \"3\": compressedOopsArg = \"-XX:-UseCompressedOops\";\n-                compressedKlassPointersArg = \"-XX:-UseCompressedClassPointers\";\n-                break;\n+      case \"32\":\n+        compressedOopsArg = null;\n+        compressedKlassPointersArg = null;\n+        compactObjectHeader = null;\n+        break;\n+      case \"64_COOP_CCP_NCOH\":\n+        compressedOopsArg = \"-XX:+UseCompressedOops\";\n+        compressedKlassPointersArg =  \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeader = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_CCP_NCOH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeader = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_NCCP_NCOH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:-UseCompressedClassPointers\";\n+        compactObjectHeader = \"-XX:-UseCompactObjectHeaders\";\n+        break;\n+      case \"64_COOP_CCP_COH\":\n+        compressedOopsArg = \"-XX:+UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeader = \"-XX:+UseCompactObjectHeaders\";\n+        break;\n+      case \"64_NCOOP_CCP_COH\":\n+        compressedOopsArg = \"-XX:-UseCompressedOops\";\n+        compressedKlassPointersArg = \"-XX:+UseCompressedClassPointers\";\n+        compactObjectHeader = \"-XX:+UseCompactObjectHeaders\";\n+        break;\n@@ -212,3 +259,0 @@\n-    \/\/ Generate test classes\n-    \/\/ NullMarkersTest fat = new NullMarkersTest();\n-\n@@ -216,1 +260,2 @@\n-    ProcessBuilder pb = exec(compressedOopsArg, compressedKlassPointersArg, \"runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest$TestRunner\");\n+    ProcessBuilder pb = exec(compressedOopsArg, compressedKlassPointersArg, compactObjectHeader,\n+                             \"runtime.valhalla.inlinetypes.field_layout.ValueFieldInheritanceTest$TestRunner\");\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/field_layout\/ValueFieldInheritanceTest.java","additions":71,"deletions":26,"binary":false,"changes":97,"status":"modified"}]}