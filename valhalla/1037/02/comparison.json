{"files":[{"patch":"@@ -149,1 +149,2 @@\n-            --system none, \\\n+            --system none \\\n+            --enable-preview -source $(JDK_SOURCE_TARGET_VERSION), \\\n","filename":"make\/CompileJavaModules.gmk","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n-DISABLED_WARNINGS_java += this-escape restricted\n+DISABLED_WARNINGS_java += this-escape restricted preview\n","filename":"make\/modules\/java.base\/Java.gmk","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -6038,0 +6038,5 @@\n+  \/\/ Fixing ACC_SUPER\/ACC_IDENTITY for old class files\n+  if ((!(flags & JVM_ACC_INTERFACE)) && _major_version <= JAVA_22_VERSION && _minor_version != JAVA_PREVIEW_MINOR_VERSION) {\n+    flags |= JVM_ACC_IDENTITY;\n+  }\n+\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2495,0 +2495,4 @@\n+      \/\/ --enable-preview enables Valhalla, EnableValhalla VM option will eventually be removed before integration\n+      if (FLAG_SET_CMDLINE(EnableValhalla, true) != JVMFlag::SUCCESS) {\n+        return JNI_EINVAL;\n+      }\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-        @JEP(number=8277163, title=\"Value Objects\")\n+        @JEP(number=401, title=\"Value Classes and Objects\", status = \"Preview\")\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/javac\/PreviewFeature.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -215,0 +215,1 @@\n+            case VALUE_CLASSES -> true;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Preview.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -248,1 +248,0 @@\n-        VALUE_CLASSES(JDK21, Fragments.FeatureValueClasses, DiagKind.PLURAL),\n@@ -253,0 +252,1 @@\n+        VALUE_CLASSES(JDK22, Fragments.FeatureValueClasses, DiagKind.PLURAL),\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Source.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -294,1 +294,2 @@\n-        allowValueClasses = Feature.VALUE_CLASSES.allowedInSource(source);\n+        allowValueClasses = (!preview.isPreview(Feature.VALUE_CLASSES) || preview.isEnabled()) &&\n+                Feature.VALUE_CLASSES.allowedInSource(source);\n@@ -3144,1 +3145,2 @@\n-        if ((flags & ACC_STRICT) != 0) {\n+        boolean previewClassFile = minorVersion == ClassFile.PREVIEW_MINOR_VERSION;\n+        if (allowValueClasses && previewClassFile && (flags & ACC_STRICT) != 0) {\n@@ -3164,0 +3166,1 @@\n+        boolean previewClassFile = minorVersion == ClassFile.PREVIEW_MINOR_VERSION;\n@@ -3168,1 +3171,1 @@\n-        if ((flags & ACC_IDENTITY) != 0 || (majorVersion <= V66.major && (flags & INTERFACE) == 0)) {\n+        if ((flags & ACC_IDENTITY) != 0 || (majorVersion < V66.major && (flags & INTERFACE) == 0)) {\n@@ -3170,1 +3173,1 @@\n-        } else if ((flags & INTERFACE) == 0 && allowValueClasses && majorVersion > V66.major) {\n+        } else if ((flags & INTERFACE) == 0 && allowValueClasses && previewClassFile && majorVersion >= V66.major) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/jvm\/ClassReader.java","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -198,1 +198,2 @@\n-        this.allowValueClasses = Feature.VALUE_CLASSES.allowedInSource(source);\n+        this.allowValueClasses = (!preview.isPreview(Feature.VALUE_CLASSES) || preview.isEnabled()) &&\n+                Feature.VALUE_CLASSES.allowedInSource(source);\n@@ -2575,3 +2576,0 @@\n-            long badModifiers = mods.flags & ~(Flags.VALUE_CLASS | Flags.FINAL);\n-            if (badModifiers != 0)\n-                log.error(token.pos, Errors.ModNotAllowedHere(asFlagSet(badModifiers)));\n@@ -2932,0 +2930,1 @@\n+            checkSourceLevel(Feature.VALUE_CLASSES);\n@@ -3529,0 +3528,1 @@\n+                    checkSourceLevel(Feature.VALUE_CLASSES);\n@@ -3800,1 +3800,1 @@\n-                return Source.JDK18;\n+                return Source.JDK22;\n@@ -3802,1 +3802,1 @@\n-                log.warning(pos, Warnings.RestrictedTypeNotAllowedPreview(name, Source.JDK18));\n+                log.warning(pos, Warnings.RestrictedTypeNotAllowedPreview(name, Source.JDK22));\n@@ -4927,1 +4927,1 @@\n-                        next.name() == names.value;\n+                        allowValueClasses && next.name() == names.value;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/parser\/JavacParser.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -57,1 +57,1 @@\n- * @run main\/othervm\/timeout=450 -XX:+EnableValhalla compiler.valhalla.inlinetypes.TestLWorld\n+ * @run main\/othervm\/timeout=450 -XX:+EnableValhalla --enable-preview compiler.valhalla.inlinetypes.TestLWorld\n@@ -4180,1 +4180,1 @@\n-    static abstract class MyAbstract2 implements MyInterface2 {\n+    static abstract value class MyAbstract2 implements MyInterface2 {\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestLWorld.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+ * @enablePreview\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/AbstractValueClassTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+ * @enablePreview\n@@ -41,1 +42,1 @@\n- * @run main\/othervm -XX:+EnableValhalla AnnotationsTests\n+ * @run main\/othervm AnnotationsTests\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/AnnotationsTests.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+ * @enablePreview\n@@ -36,1 +37,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.CircularityTest\n+ * @run main\/othervm runtime.valhalla.inlinetypes.CircularityTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/CircularityTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+ * @enablePreview\n@@ -38,1 +39,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.ClassInitializationFailuresTest\n+ * @run main\/othervm runtime.valhalla.inlinetypes.ClassInitializationFailuresTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/ClassInitializationFailuresTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+ * @enablePreview\n@@ -39,1 +40,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.ClassPrintLayoutDcmd\n+ * @run main\/othervm runtime.valhalla.inlinetypes.ClassPrintLayoutDcmd\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/ClassPrintLayoutDcmd.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -41,0 +41,1 @@\n+ * @enablePreview\n@@ -42,1 +43,1 @@\n- * @run main\/othervm -XX:+EnableValhalla -XX:InlineFieldMaxFlatSize=128 runtime.valhalla.inlinetypes.EmptyInlineTest\n+ * @run main\/othervm -XX:InlineFieldMaxFlatSize=128 runtime.valhalla.inlinetypes.EmptyInlineTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/EmptyInlineTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+ * @enablePreview\n@@ -37,2 +38,2 @@\n- * @run main\/othervm -XX:+EnableValhalla -XX:InlineFieldMaxFlatSize=64 runtime.valhalla.inlinetypes.FlattenableSemanticTest\n- * @run main\/othervm -XX:+EnableValhalla -XX:+UnlockDiagnosticVMOptions -XX:ForceNonTearable=* runtime.valhalla.inlinetypes.FlattenableSemanticTest\n+ * @run main\/othervm -XX:InlineFieldMaxFlatSize=64 runtime.valhalla.inlinetypes.FlattenableSemanticTest\n+ * @run main\/othervm -XX:+UnlockDiagnosticVMOptions -XX:ForceNonTearable=* runtime.valhalla.inlinetypes.FlattenableSemanticTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/FlattenableSemanticTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -28,1 +28,2 @@\n- * @run main\/othervm -XX:+EnableValhalla HiddenInlineClassTest\n+ * @enablePreview\n+ * @run main\/othervm HiddenInlineClassTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/HiddenInlineClassTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -36,4 +36,3 @@\n- * @compile --source 22 --enable-preview Ifacmp.java\n- * @run main\/othervm --enable-preview\n- *                   -XX:+EnableValhalla -Xms16m -Xmx16m -XX:+UseSerialGC\n- *                   runtime.valhalla.inlinetypes.Ifacmp\n+ * @enablePreview\n+ * @compile --source 22 Ifacmp.java\n+ * @run main\/othervm -Xms16m -Xmx16m -XX:+UseSerialGC runtime.valhalla.inlinetypes.Ifacmp\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/Ifacmp.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -53,0 +53,1 @@\n+ * @enablePreview\n@@ -56,2 +57,1 @@\n- * @run main\/othervm -XX:+EnableValhalla --enable-preview\n- *                   -XX:+UseSerialGC -Xmx128m -XX:InlineFieldMaxFlatSize=128\n+ * @run main\/othervm -XX:+UseSerialGC -Xmx128m -XX:InlineFieldMaxFlatSize=128\n@@ -71,0 +71,1 @@\n+ * @enablePreview\n@@ -74,2 +75,1 @@\n- * @run main\/othervm -XX:+EnableValhalla --enable-preview\n- *                   -XX:+UseG1GC -Xmx128m -XX:InlineFieldMaxFlatSize=128\n+ * @run main\/othervm -XX:+UseG1GC -Xmx128m -XX:InlineFieldMaxFlatSize=128\n@@ -89,0 +89,1 @@\n+ * @enablePreview\n@@ -92,2 +93,1 @@\n- * @run main\/othervm -XX:+EnableValhalla --enable-preview\n- *                   -XX:+UseParallelGC -Xmx128m -XX:InlineFieldMaxFlatSize=128\n+ * @run main\/othervm -XX:+UseParallelGC -Xmx128m -XX:InlineFieldMaxFlatSize=128\n@@ -107,0 +107,1 @@\n+ * @enablePreview\n@@ -110,2 +111,1 @@\n- * @run main\/othervm -XX:+EnableValhalla --enable-preview\n- *                   -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -Xmx128m\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -Xmx128m\n@@ -126,0 +126,1 @@\n+ * @enablePreview\n@@ -129,2 +130,1 @@\n- * @run main\/othervm -XX:+EnableValhalla --enable-preview\n- *                   -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -XX:+ZGenerational -Xmx128m\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -XX:+ZGenerational -Xmx128m\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineOops.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -44,4 +44,5 @@\n- * @compile --source 22 --enable-preview InlineTypeArray.java Point.java Long8Inline.java Person.java\n- * @run main\/othervm -XX:+EnableValhalla -XX:FlatArrayElementMaxSize=-1 --enable-preview runtime.valhalla.inlinetypes.InlineTypeArray\n- * @run main\/othervm -XX:+EnableValhalla -XX:FlatArrayElementMaxSize=0 --enable-preview runtime.valhalla.inlinetypes.InlineTypeArray\n- * @run main\/othervm -XX:+EnableValhalla -XX:+UnlockDiagnosticVMOptions --enable-preview -XX:ForceNonTearable=* runtime.valhalla.inlinetypes.InlineTypeArray\n+ * @enablePreview\n+ * @compile --source 22 InlineTypeArray.java Point.java Long8Inline.java Person.java\n+ * @run main\/othervm -XX:FlatArrayElementMaxSize=-1 runtime.valhalla.inlinetypes.InlineTypeArray\n+ * @run main\/othervm -XX:FlatArrayElementMaxSize=0 runtime.valhalla.inlinetypes.InlineTypeArray\n+ * @run main\/othervm -XX:+UnlockDiagnosticVMOptions -XX:ForceNonTearable=* runtime.valhalla.inlinetypes.InlineTypeArray\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineTypeArray.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+ * @enablePreview\n@@ -36,1 +37,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.InlineTypeCreation\n+ * @run main\/othervm runtime.valhalla.inlinetypes.InlineTypeCreation\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineTypeCreation.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+ * @enablePreview\n@@ -45,2 +46,1 @@\n- * @run main\/othervm -XX:+EnableValhalla\n- *                   -XX:FlatArrayElementMaxSize=-1 -XX:+UseCompressedOops\n+ * @run main\/othervm -XX:FlatArrayElementMaxSize=-1 -XX:+UseCompressedOops\n@@ -49,2 +49,1 @@\n- * @run main\/othervm -XX:+EnableValhalla\n- *                   -XX:FlatArrayElementMaxSize=-1 -XX:-UseCompressedOops\n+ * @run main\/othervm -XX:FlatArrayElementMaxSize=-1 -XX:-UseCompressedOops\n@@ -53,2 +52,1 @@\n- * @run main\/othervm -XX:+EnableValhalla\n- *                   -XX:FlatArrayElementMaxSize=-1\n+ * @run main\/othervm -XX:FlatArrayElementMaxSize=-1\n@@ -57,2 +55,1 @@\n- * @run main\/othervm -XX:+EnableValhalla\n- *                   -XX:+UnlockDiagnosticVMOptions -XX:FlatArrayElementMaxSize=-1\n+ * @run main\/othervm -XX:+UnlockDiagnosticVMOptions -XX:FlatArrayElementMaxSize=-1\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineTypeDensity.java","additions":5,"deletions":8,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+ * @enablePreview\n@@ -34,1 +35,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.InlineTypeGetField\n+ * @run main\/othervm runtime.valhalla.inlinetypes.InlineTypeGetField\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineTypeGetField.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -62,0 +62,1 @@\n+ * @enablePreview\n@@ -63,2 +64,1 @@\n- * @run main\/othervm -XX:+EnableValhalla --enable-preview\n- *                   -Xmx128m -XX:+ExplicitGCInvokesConcurrent\n+ * @run main\/othervm -Xmx128m -XX:+ExplicitGCInvokesConcurrent\n@@ -67,2 +67,1 @@\n- * @run main\/othervm -XX:+EnableValhalla --enable-preview\n- *                   -Xmx128m -XX:+ExplicitGCInvokesConcurrent\n+ * @run main\/othervm -Xmx128m -XX:+ExplicitGCInvokesConcurrent\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineTypesTest.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -28,1 +28,2 @@\n- * @run main\/othervm\/native -XX:+EnableValhalla runtime.valhalla.inlinetypes.InlineWithJni\n+ * @enablePreview\n+ * @run main\/othervm\/native runtime.valhalla.inlinetypes.InlineWithJni\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineWithJni.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -41,1 +41,2 @@\n- * @run main\/othervm -XX:+EnableValhalla NullRestrictedArrayTest\n+ * @enablePreview\n+ * @run main\/othervm NullRestrictedArrayTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/NullRestrictedArrayTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+ * @enablePreview\n@@ -36,3 +37,3 @@\n- * @run main\/othervm -XX:+EnableValhalla -XX:+UseCompressedClassPointers --enable-preview runtime.valhalla.inlinetypes.ObjectMethods\n- * @run main\/othervm -XX:+EnableValhalla -XX:-UseCompressedClassPointers --enable-preview runtime.valhalla.inlinetypes.ObjectMethods\n- * @run main\/othervm -XX:+EnableValhalla -noverify --enable-preview runtime.valhalla.inlinetypes.ObjectMethods noverify\n+ * @run main\/othervm -XX:+UseCompressedClassPointers runtime.valhalla.inlinetypes.ObjectMethods\n+ * @run main\/othervm -XX:-UseCompressedClassPointers runtime.valhalla.inlinetypes.ObjectMethods\n+ * @run main\/othervm -noverify runtime.valhalla.inlinetypes.ObjectMethods noverify\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/ObjectMethods.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+ * @enablePreview\n@@ -37,1 +38,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.QuickeningTest\n+ * @run main\/othervm runtime.valhalla.inlinetypes.QuickeningTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/QuickeningTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+ * @enablePreview\n@@ -36,1 +37,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.StaticFieldsTest\n+ * @run main\/othervm runtime.valhalla.inlinetypes.StaticFieldsTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/StaticFieldsTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+ * @enablePreview\n@@ -37,1 +38,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.Test8186715\n+ * @run main\/othervm runtime.valhalla.inlinetypes.Test8186715\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/Test8186715.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+ * @enablePreview\n@@ -29,1 +30,1 @@\n- * @run main\/othervm -XX:+EnableValhalla  -Xmx128m -XX:InlineFieldMaxFlatSize=32\n+ * @run main\/othervm -Xmx128m -XX:InlineFieldMaxFlatSize=32\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/TestFieldNullability.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+ * @enablePreview\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/TestFieldTypeMismatch.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+ * @enablePreview\n@@ -35,1 +36,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.TestInheritedInlineTypeFields\n+ * @run main\/othervm runtime.valhalla.inlinetypes.TestInheritedInlineTypeFields\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/TestInheritedInlineTypeFields.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+ * @enablePreview\n@@ -38,1 +39,1 @@\n- * @run main\/othervm\/native -XX:+EnableValhalla TestJNIIsSameObject\n+ * @run main\/othervm\/native TestJNIIsSameObject\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/TestJNIIsSameObject.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+ * @enablePreview\n@@ -34,1 +35,1 @@\n- * @run main\/othervm -XX:+EnableValhalla -XX:InlineFieldMaxFlatSize=64 runtime.valhalla.inlinetypes.UninitializedInlineFieldsTest\n+ * @run main\/othervm -XX:InlineFieldMaxFlatSize=64 runtime.valhalla.inlinetypes.UninitializedInlineFieldsTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/UninitializedInlineFieldsTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+ * @enablePreview\n@@ -35,1 +36,1 @@\n- * @run main\/othervm -XX:+EnableValhalla  -XX:FlatArrayElementMaxSize=-1 -XX:InlineFieldMaxFlatSize=-1 runtime.valhalla.inlinetypes.UnsafeTest\n+ * @run main\/othervm -XX:FlatArrayElementMaxSize=-1 -XX:InlineFieldMaxFlatSize=-1 runtime.valhalla.inlinetypes.UnsafeTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/UnsafeTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+ * @enablePreview\n@@ -42,1 +43,1 @@\n-        Collections.addAll(argsList, \"-XX:+EnableValhalla\");\n+        Collections.addAll(argsList, \"--enable-preview\");\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/ValuePreloadTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+ * @enablePreview\n@@ -41,1 +42,1 @@\n- * @run main\/othervm -XX:+EnableValhalla runtime.valhalla.inlinetypes.VarArgsArray\n+ * @run main\/othervm runtime.valhalla.inlinetypes.VarArgsArray\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/VarArgsArray.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+ * @enablePreview\n@@ -33,1 +34,1 @@\n- * @run main\/othervm -XX:+EnableValhalla -XX:InlineFieldMaxFlatSize=128 runtime.valhalla.inlinetypes.VolatileTest\n+ * @run main\/othervm -XX:InlineFieldMaxFlatSize=128 runtime.valhalla.inlinetypes.VolatileTest\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/VolatileTest.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+ * @enablePreview\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/verifier\/VTMonitor.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -82,8 +82,1 @@\n-tools\/javac\/valhalla\/primitive-classes\/ArrayCreationWithQuestion.java 8323785    generic-all\n-tools\/javac\/valhalla\/primitive-classes\/BoxValCastTest.java            8323785    generic-all\n-tools\/javac\/valhalla\/primitive-classes\/ConstantPropagationTest.java   8323785    generic-all\n-tools\/javac\/valhalla\/primitive-classes\/ProjectedArrayDotClass.java    8323785    generic-all\n-tools\/javac\/valhalla\/primitive-classes\/QTypeTest.java                 8323785    generic-all\n-tools\/javac\/valhalla\/primitive-classes\/UnifiedPrimitiveClassBytecodeTest.java 8323785    generic-all\n-tools\/javac\/valhalla\/primitive-classes\/ValueCreationTest.java         8323785    generic-all\n-tools\/javac\/valhalla\/value-objects\/ValueCreationTest.java             8323786    generic-all\n+tools\/javac\/valhalla\/value-objects\/ValueCreationTest.java                       8323786    generic-all\n@@ -92,0 +85,2 @@\n+\n+\n","filename":"test\/langtools\/ProblemList.txt","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -56,0 +56,1 @@\n+                \"--enable-preview\", \"-source\", String.valueOf(Runtime.version().feature()),\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testValueClasses\/TestValueClasses.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -5,0 +5,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/DefiniteAssignment\/DA_DUConstructors.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1,3 +1,5 @@\n-DA_DUConstructors.java:22:17: compiler.err.var.might.already.be.assigned: x\n-DA_DUConstructors.java:41:23: compiler.err.var.might.not.have.been.initialized: x\n-DA_DUConstructors.java:63:20: compiler.err.var.might.already.be.assigned: x\n+DA_DUConstructors.java:23:17: compiler.err.var.might.already.be.assigned: x\n+DA_DUConstructors.java:42:23: compiler.err.var.might.not.have.been.initialized: x\n+DA_DUConstructors.java:64:20: compiler.err.var.might.already.be.assigned: x\n+- compiler.note.preview.filename: DA_DUConstructors.java, DEFAULT\n+- compiler.note.preview.recompile\n","filename":"test\/langtools\/tools\/javac\/DefiniteAssignment\/DA_DUConstructors.out","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -26,0 +26,2 @@\n+- compiler.note.preview.filename: ValueClassSuperInitFails.java, DEFAULT\n+- compiler.note.preview.recompile\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/ValueClassSuperInitFails.out","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -25,0 +25,3 @@\n+\/\/ key: compiler.note.preview.filename\n+\/\/ key: compiler.note.preview.recompile\n+\/\/ options: --enable-preview -source ${jdk.version}\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/ConcreteSuperclassOfValueClass.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -25,0 +25,3 @@\n+\/\/ key: compiler.note.preview.filename\n+\/\/ key: compiler.note.preview.recompile\n+\/\/ options: --enable-preview -source ${jdk.version}\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/SuperClassMethodCannotBeSynchronized.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -25,0 +25,3 @@\n+\/\/ key: compiler.note.preview.filename\n+\/\/ key: compiler.note.preview.recompile\n+\/\/ options: --enable-preview -source ${jdk.version}\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/ThisExposedPrematurely.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -26,0 +26,3 @@\n+\/\/ key: compiler.note.preview.filename\n+\/\/ key: compiler.note.preview.recompile\n+\/\/ options: --enable-preview -source ${jdk.version}\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/TypeReqIdentity.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -25,0 +25,3 @@\n+\/\/ key: compiler.note.preview.filename\n+\/\/ key: compiler.note.preview.recompile\n+\/\/ options: --enable-preview -source ${jdk.version}\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/ValueWithIdentitySuper.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -115,1 +115,3 @@\n-                \"- compiler.note.proc.messager:     constructor modifiers: []\"\n+                \"- compiler.note.proc.messager:     constructor modifiers: []\",\n+                \"- compiler.note.preview.filename: Interface.java, DEFAULT\",\n+                \"- compiler.note.preview.recompile\"\n@@ -120,1 +122,1 @@\n-                    .options(\"-processor\", ValueClassesProcessor.class.getName(),\n+                    .options(\"--enable-preview\", \"-source\", String.valueOf(Runtime.version().feature()), \"-processor\", ValueClassesProcessor.class.getName(),\n","filename":"test\/langtools\/tools\/javac\/processing\/model\/element\/TestValueClasses.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n- * @run main\/othervm -XX:+EnableValhalla -XX:+EnablePrimitiveClasses SideEffectTest\n+ * @run main\/othervm -XX:+EnablePrimitiveClasses SideEffectTest\n","filename":"test\/langtools\/tools\/javac\/valhalla\/primitive-classes\/SideEffectTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n- * @summary Check array creation with V and V.ref\n+ * @summary Check array creation with value classes\n@@ -30,2 +30,2 @@\n- * @compile ArrayCreationWithQuestion.java\n- * @run main ArrayCreationWithQuestion\n+ * @compile --enable-preview -source ${jdk.version} ArrayCreationWithQuestion.java\n+ * @run main\/othervm --enable-preview ArrayCreationWithQuestion\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/ArrayCreationWithQuestion.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/AsSuperTests.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -31,1 +31,1 @@\n- * @run main\/othervm -XX:+EnableValhalla -XX:+EnablePrimitiveClasses ConstructorRefTest\n+ * @run main\/othervm -XX:+EnablePrimitiveClasses ConstructorRefTest\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/ConstructorRefTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1,14 +0,0 @@\n-\/*\n- * @test \/nodynamiccopyright\/\n- * @bug 8282107\n- * @summary Check that javac can compile against value classes at lower source levels\n- * @compile GenericPoint.java\n- * @compile ConsumeValueClassAtLowerLevel.java\n- * @compile --source 16 -XDrawDiagnostics ConsumeValueClassAtLowerLevel.java\n- *\/\n-\n-public class ConsumeValueClassAtLowerLevel {\n-    void m() {\n-        GenericPoint<Integer> gl = new GenericPoint<>(0, 0);\n-    }\n-}\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/ConsumeValueClassAtLowerLevel.java","additions":0,"deletions":14,"binary":false,"changes":14,"status":"deleted"},{"patch":"@@ -1,4 +0,0 @@\n-- compiler.warn.source.no.system.modules.path: 16\n-ConsumeValueClassAtLowerLevel.java:16:36: compiler.err.cant.resolve.location.args: kindname.constructor, GenericPoint, , int,int, (compiler.misc.location: kindname.class, GenericPoint<T>, null)\n-1 error\n-1 warning\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/ConsumeValueClassAtLowerLevel.out","additions":0,"deletions":4,"binary":false,"changes":4,"status":"deleted"},{"patch":"@@ -5,0 +5,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/DualNonDuplicateErrors.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -1,2 +1,4 @@\n-DualNonDuplicateErrors.java:17:13: compiler.err.cant.ref.before.ctor.called: this\n-DualNonDuplicateErrors.java:17:9: compiler.err.cant.ref.before.ctor.called: foo(DualNonDuplicateErrors)\n+DualNonDuplicateErrors.java:18:13: compiler.err.cant.ref.before.ctor.called: this\n+DualNonDuplicateErrors.java:18:9: compiler.err.cant.ref.before.ctor.called: foo(DualNonDuplicateErrors)\n+- compiler.note.preview.filename: DualNonDuplicateErrors.java, DEFAULT\n+- compiler.note.preview.recompile\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/DualNonDuplicateErrors.out","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/NoAutoInheritanceOfIdentityFlagBit.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/NoUnnecessaryPreloadsTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/PermitsValueTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/PreloadAttributeTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+ * @enablePreview\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/ValueCreationTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -63,1 +63,0 @@\n-\n@@ -65,1 +64,0 @@\n-\n@@ -70,0 +68,3 @@\n+    private static String[] PREVIEW_OPTIONS = {\"--enable-preview\", \"-source\",\n+            Integer.toString(Runtime.version().feature())};\n+\n@@ -72,0 +73,1 @@\n+        setCompileOptions(PREVIEW_OPTIONS);\n@@ -114,12 +116,0 @@\n-    @Test\n-    void testCheckFeatureSourceLevel() {\n-        setCompileOptions(new String[]{\"--release\", \"13\"});\n-        assertFail(\"compiler.err.feature.not.supported.in.source.plural\",\n-                \"\"\"\n-                value class V {\n-                    public int v = 42;\n-                }\n-                \"\"\");\n-        setCompileOptions(new String[]{});\n-    }\n-\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/ValueObjectCompilationTests.java","additions":4,"deletions":14,"binary":false,"changes":18,"status":"modified"}]}