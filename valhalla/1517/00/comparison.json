{"files":[{"patch":"@@ -6230,0 +6230,11 @@\n+        } else {\n+          \/\/ Just poking the system dictionary to see if the class has already be loaded\n+          \/\/ TODO FIXME: Need logging here?\n+          oop loader = loader_data()->class_loader();\n+          InstanceKlass* klass = SystemDictionary::find_instance_klass(THREAD, name, Handle(THREAD, loader));\n+          if (UseNewCode) {\n+            assert(!name->equals(\"java\/lang\/Integer\") || klass != nullptr, \"Integer should be loaded\");\n+          }\n+          if (klass != nullptr && klass->is_inline_klass()) {\n+            _inline_layout_info_array->adr_at(fieldinfo.index())->set_klass(InlineKlass::cast(klass));\n+          }\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -194,0 +194,7 @@\n+#define ADD_WRAPPER_CLASS(name)                                                      \\\n+  {                                                                                  \\\n+    InstanceKlass* ik = SystemDictionary::find_instance_klass(Thread::current(), vmSymbols::java_lang_##name(), Handle(Thread::current(), nullptr)); \\\n+    assert(ik != nullptr, \"Must exist\");                                             \\\n+    SystemDictionary::add_to_initiating_loader(JavaThread::current(), ik, cld);      \\\n+  }\n+\n@@ -195,0 +202,1 @@\n+  ClassLoaderData* cld = nullptr;\n@@ -197,1 +205,1 @@\n-    return ClassLoaderDataGraph::add(class_loader, true);\n+    cld = ClassLoaderDataGraph::add(class_loader, true);\n@@ -199,1 +207,1 @@\n-    return (class_loader() == nullptr) ? ClassLoaderData::the_null_class_loader_data() :\n+    cld = (class_loader() == nullptr) ? ClassLoaderData::the_null_class_loader_data() :\n@@ -202,0 +210,12 @@\n+  if (class_loader() != nullptr && cld->dictionary() != nullptr) {\n+    MonitorLocker mu1(SystemDictionary_lock);\n+    ADD_WRAPPER_CLASS(Boolean);\n+    ADD_WRAPPER_CLASS(Byte);\n+    ADD_WRAPPER_CLASS(Character);\n+    ADD_WRAPPER_CLASS(Short);\n+    ADD_WRAPPER_CLASS(Integer);\n+    ADD_WRAPPER_CLASS(Long);\n+    ADD_WRAPPER_CLASS(Float);\n+    ADD_WRAPPER_CLASS(Double);\n+  }\n+  return cld;\n@@ -204,0 +224,2 @@\n+#undef ADD_WRAPPER_CLASS\n+\n@@ -1749,1 +1771,0 @@\n-#if INCLUDE_CDS\n@@ -1752,1 +1773,3 @@\n-\/\/ This API should be used only by AOTLinkedClassBulkLoader\n+\/\/ This API is used by AOTLinkedClassBulkLoader and to register boxing\n+\/\/ classes from java.lang in all class loaders to enable more value\n+\/\/ classes optimizations\n@@ -1756,1 +1779,0 @@\n-  assert(CDSConfig::is_using_aot_linked_classes(), \"must be\");\n@@ -1762,2 +1784,3 @@\n-  assert(dictionary->find_class(current, name) == nullptr, \"sanity\");\n-  dictionary->add_klass(current, name, k);\n+  if (dictionary->find_class(current, name) == nullptr) {\n+    dictionary->add_klass(current, name, k);\n+  }\n@@ -1765,1 +1788,0 @@\n-#endif\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":30,"deletions":8,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -290,1 +290,1 @@\n-                                       ClassLoaderData* loader_data) NOT_CDS_RETURN;\n+                                       ClassLoaderData* loader_data);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}