{"files":[{"patch":"@@ -324,0 +324,1 @@\n+\n","filename":"src\/hotspot\/share\/cds\/aotConstantPoolResolver.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -5549,1 +5549,1 @@\n-    _acmp_maps_array = MetadataFactory::new_array<int>(loader_data(), acmp_map_size, CHECK);\n+    Array<int>* acmp_maps_array = MetadataFactory::new_array<int>(loader_data(), acmp_map_size, CHECK);\n@@ -5553,1 +5553,1 @@\n-    _acmp_maps_array->at_put(0, _layout_info->_nonoop_acmp_map->length());\n+    acmp_maps_array->at_put(0, _layout_info->_nonoop_acmp_map->length());\n@@ -5558,2 +5558,3 @@\n-      _acmp_maps_array->at_put(i * 2 + 1, _layout_info->_nonoop_acmp_map->at(i).first);\n-      _acmp_maps_array->at_put(i * 2 + 2, _layout_info->_nonoop_acmp_map->at(i).second);\n+      \/\/ Also store acmp maps as metadata for regeneration when using dynamic archive or AOT training data.\n+      acmp_maps_array->at_put(i * 2 + 1, _layout_info->_nonoop_acmp_map->at(i).first);\n+      acmp_maps_array->at_put(i * 2 + 2, _layout_info->_nonoop_acmp_map->at(i).second);\n@@ -5564,1 +5565,1 @@\n-      _acmp_maps_array->at_put(oop_map_start + i, _layout_info->_oop_acmp_map->at(i));\n+      acmp_maps_array->at_put(oop_map_start + i, _layout_info->_oop_acmp_map->at(i));\n@@ -5566,1 +5567,1 @@\n-    assert(_acmp_maps_array->length() == map->length(), \"sanity\");\n+    assert(acmp_maps_array->length() == map->length(), \"sanity\");\n@@ -5568,4 +5569,1 @@\n-    ik->set_acmp_maps_array(_acmp_maps_array);\n-\n-    \/\/ Clear out this field so it doesn't get deallocated by the destructor\n-    _acmp_maps_array = nullptr;\n+    ik->set_acmp_maps_array(acmp_maps_array);\n@@ -5655,1 +5653,0 @@\n-  _acmp_maps_array(nullptr),\n@@ -5795,4 +5792,0 @@\n-  if (_acmp_maps_array != nullptr) {\n-    MetadataFactory::free_array<int>(_loader_data, _acmp_maps_array);\n-  }\n-\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":8,"deletions":15,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -159,1 +159,0 @@\n-  Array<int>* _acmp_maps_array;\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -3142,1 +3142,1 @@\n-  \/\/ restore acmp_maps java array from the version stored in metadata\n+  \/\/ Restore acmp_maps java array from the version stored in metadata.\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}