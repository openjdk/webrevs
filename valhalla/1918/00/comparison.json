{"files":[{"patch":"@@ -251,0 +251,1 @@\n+    public final Type nullRestrictedType;\n@@ -638,0 +639,1 @@\n+        nullRestrictedType = enterClass(\"jdk.internal.vm.annotation.NullRestricted\");\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Symtab.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import com.sun.tools.javac.code.Attribute;\n@@ -29,0 +30,2 @@\n+import com.sun.tools.javac.code.SymbolMetadata;\n+import com.sun.tools.javac.code.Symtab;\n@@ -36,0 +39,1 @@\n+import com.sun.tools.javac.util.List;\n@@ -62,0 +66,1 @@\n+    private final Symtab syms;\n@@ -69,0 +74,1 @@\n+        syms = Symtab.instance(context);\n@@ -93,0 +99,8 @@\n+        \/\/ temporary hack, this is only to test null restriction in the VM for fields of value classes\n+        if (tree.sym.type.isValueClass() && types.isNonNullable(tree.sym.type)) {\n+            List<Attribute.Compound> rawAttrs = tree.sym.getRawAttributes();\n+            if (rawAttrs.isEmpty() || !rawAttrs.stream().anyMatch(ac -> ac.type.tsym == syms.nullRestrictedType.tsym)) {\n+                Attribute.Compound ac = new Attribute.Compound(syms.nullRestrictedType, List.nil());\n+                tree.sym.appendAttributes(List.of(ac));\n+            }\n+        }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/NullChecksWriter.java","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -31,1 +31,0 @@\n-import jdk.internal.vm.annotation.NullRestricted;\n@@ -3242,2 +3241,1 @@\n-    @NullRestricted\n-    static final MyValueEmpty empty = new MyValueEmpty();\n+    static final MyValueEmpty! empty = new MyValueEmpty();\n@@ -3265,2 +3263,1 @@\n-        @NullRestricted\n-        MyValueEmpty empty = new MyValueEmpty();\n+        MyValueEmpty! empty = new MyValueEmpty();\n@@ -3792,2 +3789,1 @@\n-        @NullRestricted\n-        MyValue152Inline val = new MyValue152Inline(); \/\/ Not flat\n+        MyValue152Inline! val = new MyValue152Inline(); \/\/ Not flat\n@@ -3814,2 +3810,1 @@\n-        @NullRestricted\n-        MyValue152Inline val = new MyValue152Inline(); \/\/ Not flat\n+        MyValue152Inline! val = new MyValue152Inline(); \/\/ Not flat\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestArrays.java","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-import jdk.internal.vm.annotation.NullRestricted;\n@@ -76,2 +75,1 @@\n-    @NullRestricted\n-    static Point fsp = new Point();\n+    static Point! fsp = new Point();\n@@ -81,2 +79,1 @@\n-    @NullRestricted\n-    Point fip;\n+    Point! fip;\n@@ -86,2 +83,1 @@\n-    @NullRestricted\n-    static JumboInline fsj = new JumboInline();\n+    static JumboInline! fsj = new JumboInline();\n@@ -91,2 +87,1 @@\n-    @NullRestricted\n-    JumboInline fij;\n+    JumboInline! fij;\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/FlattenableSemanticTest.java","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -31,1 +31,0 @@\n-import jdk.internal.vm.annotation.NullRestricted;\n@@ -62,2 +61,1 @@\n-        @NullRestricted\n-        One one = new One(5, (short) 3);\n+        One! one = new One(5, (short) 3);\n","filename":"test\/jdk\/valhalla\/valuetypes\/LayoutIterationTest.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -41,1 +41,0 @@\n-import jdk.internal.vm.annotation.NullRestricted;\n@@ -62,4 +61,4 @@\n-        @NullRestricted  @Strict\n-        Point p1;\n-        @NullRestricted  @Strict\n-        Point p2;\n+        @Strict\n+        Point! p1;\n+        @Strict\n+        Point! p2;\n@@ -74,2 +73,2 @@\n-        @NullRestricted  @Strict\n-        Point p;\n+        @Strict\n+        Point! p;\n","filename":"test\/jdk\/valhalla\/valuetypes\/MethodHandleTest.java","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -39,1 +39,0 @@\n-import jdk.internal.vm.annotation.NullRestricted;\n@@ -57,2 +56,2 @@\n-        @NullRestricted  @Strict\n-        EmptyValue empty;\n+        @Strict\n+        EmptyValue! empty;\n@@ -71,4 +70,10 @@\n-        @NullRestricted  @Strict\n-        EmptyValue empty = new EmptyValue();\n-        @NullRestricted  @Strict\n-        volatile EmptyValue vempty = new EmptyValue();\n+        @Strict\n+        EmptyValue! empty;\n+        @Strict\n+        volatile EmptyValue! vempty;\n+\n+        Mutable() {\n+            empty = new EmptyValue();\n+            vempty = new EmptyValue();\n+            super();\n+        }\n","filename":"test\/jdk\/valhalla\/valuetypes\/NullRestrictedTest.java","additions":12,"deletions":7,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -43,1 +43,0 @@\n-import jdk.internal.vm.annotation.NullRestricted;\n@@ -63,4 +62,4 @@\n-        @NullRestricted  @Strict\n-        Point p1;\n-        @NullRestricted  @Strict\n-        Point p2;\n+        @Strict\n+        Point! p1;\n+        @Strict\n+        Point! p2;\n@@ -75,2 +74,2 @@\n-        @NullRestricted  @Strict\n-        Point p;\n+        @Strict\n+        Point! p;\n@@ -85,4 +84,4 @@\n-        @NullRestricted  @Strict\n-        Point p;\n-        @NullRestricted  @Strict\n-        Line l;\n+        @Strict\n+        Point! p;\n+        @Strict\n+        Line! l;\n","filename":"test\/jdk\/valhalla\/valuetypes\/ValueObjectMethodsTest.java","additions":10,"deletions":11,"binary":false,"changes":21,"status":"modified"}]}