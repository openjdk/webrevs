{"files":[{"patch":"@@ -136,1 +136,1 @@\n-    if (fak->element_klass()->is_naturally_atomic() || fak->layout_kind() == LayoutKind::ATOMIC_FLAT || fak->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT) {\n+    if (fak->element_klass()->is_naturally_atomic() || LayoutKindHelper::is_atomic_flat(fak->layout_kind())) {\n","filename":"src\/hotspot\/share\/ci\/ciArray.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -221,0 +221,18 @@\n+ArrayKlass::ArrayProperties ArrayKlass::array_properties_from_layout(LayoutKind lk) {\n+  ArrayKlass::ArrayProperties props = ArrayKlass::ArrayProperties::DEFAULT;\n+  switch(lk) {\n+    case LayoutKind::ATOMIC_FLAT:\n+      props = ArrayKlass::ArrayProperties::NULL_RESTRICTED;\n+    break;\n+    case LayoutKind::NON_ATOMIC_FLAT:\n+      props = (ArrayKlass::ArrayProperties)(ArrayKlass::ArrayProperties::NULL_RESTRICTED | ArrayKlass::ArrayProperties::NON_ATOMIC);\n+    break;\n+    case LayoutKind::NULLABLE_ATOMIC_FLAT:\n+      props = ArrayKlass::ArrayProperties::NON_ATOMIC;\n+    break;\n+    default:\n+      ShouldNotReachHere();\n+  }\n+  return props;\n+}\n+\n","filename":"src\/hotspot\/share\/oops\/arrayKlass.cpp","additions":18,"deletions":0,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"oops\/layoutKind.hpp\"\n@@ -53,0 +54,2 @@\n+  static ArrayProperties array_properties_from_layout(LayoutKind lk);\n+\n","filename":"src\/hotspot\/share\/oops\/arrayKlass.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -60,1 +60,1 @@\n-  assert(lk == LayoutKind::NON_ATOMIC_FLAT || lk == LayoutKind::ATOMIC_FLAT || lk == LayoutKind::NULLABLE_ATOMIC_FLAT, \"Must be a flat layout\");\n+  assert(LayoutKindHelper::is_flat(lk), \"Must be a flat layout\");\n@@ -154,1 +154,1 @@\n-  bool null_free = lk != LayoutKind::NULLABLE_ATOMIC_FLAT;\n+  bool null_free = !LayoutKindHelper::is_nullable_flat(lk);\n@@ -289,1 +289,1 @@\n-        bool need_null_check = fsk->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT && fdk->layout_kind() != LayoutKind::NULLABLE_ATOMIC_FLAT;\n+        bool need_null_check = LayoutKindHelper::is_nullable_flat(fsk->layout_kind()) && !LayoutKindHelper::is_nullable_flat(fdk->layout_kind());\n","filename":"src\/hotspot\/share\/oops\/flatArrayKlass.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"memory\/allStatic.hpp\"\n@@ -84,0 +85,13 @@\n+class LayoutKindHelper : AllStatic {\n+ public:\n+  static bool is_flat(LayoutKind lk) {\n+    return lk == LayoutKind::NON_ATOMIC_FLAT || lk == LayoutKind::ATOMIC_FLAT || lk == LayoutKind::NULLABLE_ATOMIC_FLAT;\n+  }\n+  static bool is_atomic_flat(LayoutKind lk) {\n+    return lk == LayoutKind::ATOMIC_FLAT || lk == LayoutKind::NULLABLE_ATOMIC_FLAT;\n+  }\n+  static bool is_nullable_flat(LayoutKind lk) {\n+    return lk == LayoutKind::NULLABLE_ATOMIC_FLAT;\n+  }\n+};\n+\n","filename":"src\/hotspot\/share\/oops\/layoutKind.hpp","additions":14,"deletions":0,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2890,2 +2890,2 @@\n-        bool is_null_free = layout != LayoutKind::NULLABLE_ATOMIC_FLAT;\n-        bool is_atomic = layout != LayoutKind::NON_ATOMIC_FLAT;\n+        bool is_null_free = !LayoutKindHelper::is_nullable_flat(layout);\n+        bool is_atomic = LayoutKindHelper::is_atomic_flat(layout);\n@@ -2927,2 +2927,2 @@\n-      bool atomic = layout != LayoutKind::NON_ATOMIC_FLAT;\n-      bool null_free = layout != LayoutKind::NULLABLE_ATOMIC_FLAT;\n+      bool atomic = LayoutKindHelper::is_atomic_flat(layout);\n+      bool null_free = !LayoutKindHelper::is_nullable_flat(layout);\n@@ -2941,2 +2941,2 @@\n-      bool atomic = layout != LayoutKind::NON_ATOMIC_FLAT;\n-      bool null_free = layout != LayoutKind::NULLABLE_ATOMIC_FLAT;\n+      bool atomic = LayoutKindHelper::is_atomic_flat(layout);\n+      bool null_free = !LayoutKindHelper::is_nullable_flat(layout);\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -381,14 +381,1 @@\n-    ArrayKlass::ArrayProperties props = ArrayKlass::ArrayProperties::DEFAULT;\n-    switch(fak->layout_kind()) {\n-      case LayoutKind::ATOMIC_FLAT:\n-        props = ArrayKlass::ArrayProperties::NULL_RESTRICTED;\n-      break;\n-      case LayoutKind::NON_ATOMIC_FLAT:\n-        props = (ArrayKlass::ArrayProperties)(ArrayKlass::ArrayProperties::NULL_RESTRICTED | ArrayKlass::ArrayProperties::NON_ATOMIC);\n-      break;\n-      case LayoutKind::NULLABLE_ATOMIC_FLAT:\n-      props = ArrayKlass::ArrayProperties::NON_ATOMIC;\n-      break;\n-      default:\n-        ShouldNotReachHere();\n-    }\n+    ArrayKlass::ArrayProperties props = ArrayKlass::array_properties_from_layout(fak->layout_kind());\n","filename":"src\/hotspot\/share\/opto\/runtime.cpp","additions":1,"deletions":14,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -448,14 +448,1 @@\n-    ArrayKlass::ArrayProperties props = ArrayKlass::ArrayProperties::DEFAULT;\n-    switch(lk) {\n-      case LayoutKind::ATOMIC_FLAT:\n-        props = ArrayKlass::ArrayProperties::NULL_RESTRICTED;\n-      break;\n-      case LayoutKind::NON_ATOMIC_FLAT:\n-        props = (ArrayKlass::ArrayProperties)(ArrayKlass::ArrayProperties::NULL_RESTRICTED | ArrayKlass::ArrayProperties::NON_ATOMIC);\n-      break;\n-      case LayoutKind::NULLABLE_ATOMIC_FLAT:\n-      props = ArrayKlass::ArrayProperties::NON_ATOMIC;\n-      break;\n-      default:\n-        ShouldNotReachHere();\n-    }\n+    ArrayKlass::ArrayProperties props = ArrayKlass::array_properties_from_layout(lk);\n@@ -559,3 +546,1 @@\n-    if (fak->layout_kind() == LayoutKind::ATOMIC_FLAT || fak->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT) {\n-      return true;\n-    }\n+    if (LayoutKindHelper::is_atomic_flat(fak->layout_kind())) return true;\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":2,"deletions":17,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -1401,2 +1401,1 @@\n-    bool can_be_null = field->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT;\n-    if (can_be_null) {\n+    if (LayoutKindHelper::is_nullable_flat(field->layout_kind())) {\n@@ -1424,1 +1423,1 @@\n-  bool need_null_check = faklass->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT;\n+  bool need_null_check = LayoutKindHelper::is_nullable_flat(faklass->layout_kind());\n@@ -2879,1 +2878,1 @@\n-  bool need_null_check = faklass->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT;\n+  bool need_null_check = LayoutKindHelper::is_nullable_flat(faklass->layout_kind());\n@@ -3103,2 +3102,1 @@\n-        bool can_be_null = field->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT;\n-        if (can_be_null) {\n+        if (LayoutKindHelper::is_nullable_flat(field->layout_kind())) {\n","filename":"src\/hotspot\/share\/prims\/jvmtiTagMap.cpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -436,14 +436,1 @@\n-  ArrayKlass::ArrayProperties props = ArrayKlass::ArrayProperties::DEFAULT;\n-  switch(lk) {\n-    case LayoutKind::ATOMIC_FLAT:\n-      props = ArrayKlass::ArrayProperties::NULL_RESTRICTED;\n-    break;\n-    case LayoutKind::NON_ATOMIC_FLAT:\n-      props = (ArrayKlass::ArrayProperties)(ArrayKlass::ArrayProperties::NULL_RESTRICTED | ArrayKlass::ArrayProperties::NON_ATOMIC);\n-    break;\n-    case LayoutKind::NULLABLE_ATOMIC_FLAT:\n-    props = ArrayKlass::ArrayProperties::NON_ATOMIC;\n-    break;\n-    default:\n-      ShouldNotReachHere();\n-  }\n+  ArrayKlass::ArrayProperties props = ArrayKlass::array_properties_from_layout(lk);\n","filename":"src\/hotspot\/share\/prims\/unsafe.cpp","additions":1,"deletions":14,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -869,1 +869,1 @@\n-    bool is_flat_nullable() const     { return _layout_kind == LayoutKind::NULLABLE_ATOMIC_FLAT; }\n+    bool is_flat_nullable() const     { return LayoutKindHelper::is_nullable_flat(_layout_kind); }\n@@ -1484,1 +1484,1 @@\n-    bool need_null_check = faklass->layout_kind() == LayoutKind::NULLABLE_ATOMIC_FLAT;\n+    bool need_null_check = LayoutKindHelper::is_nullable_flat(faklass->layout_kind());\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}