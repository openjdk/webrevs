{"files":[{"patch":"@@ -28,2 +28,0 @@\n-\n-\n@@ -192,0 +190,1 @@\n+        Symbol.ClassSymbol currentClassSym = (Symbol.ClassSymbol)(types.erasure(currentClass)).tsym;\n@@ -199,1 +198,3 @@\n-                       ident.name == names._super;\n+                       ident.name == names._super &&\n+                               (tree.type.tsym == currentClass.tsym ||\n+                                currentClassSym.isSubClass(tree.type.tsym, types));\n@@ -206,2 +207,1 @@\n-                Symbol.ClassSymbol currentClassSym = (Symbol.ClassSymbol)((Type.ClassType)types.erasure(currentClass)).tsym;\n-                Symbol.ClassSymbol selectedClassSym = (Symbol.ClassSymbol)((Type.ClassType)selectedType).tsym;\n+                Symbol.ClassSymbol selectedClassSym = (Symbol.ClassSymbol)(selectedType).tsym;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/tree\/TreeInfo.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -5,1 +5,0 @@\n- * @compile\/fail\/ref=EarlyAssignments.out -XDrawDiagnostics EarlyAssignments.java\n@@ -7,0 +6,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @compile\/fail\/ref=EarlyAssignments.out -XDrawDiagnostics EarlyAssignments.java\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyAssignments\n@@ -153,9 +164,0 @@\n-    public static class Inner7 {\n-        public final int x = 1;\n-\n-        public Inner7() {\n-            x = 2;                              \/\/ FAIL - illegal early access\n-            super();\n-        }\n-    }\n-\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignments.java","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -1,23 +1,22 @@\n-EarlyAssignments.java:31:26: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:32:21: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:33:26: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:34:34: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:36:36: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:40:17: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:44:21: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:48:22: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:66:13: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:67:17: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:68:25: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:69:31: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:119:17: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:124:22: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:129:29: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:134:22: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:139:28: compiler.err.cant.ref.before.ctor.called: x\n-EarlyAssignments.java:148:13: compiler.err.cant.assign.initialized.before.ctor.called: x\n-EarlyAssignments.java:157:13: compiler.err.cant.assign.val.to.var: final, x\n-EarlyAssignments.java:168:13: compiler.err.cant.ref.before.ctor.called: this\n-EarlyAssignments.java:168:18: compiler.err.cant.ref.before.ctor.called: EarlyAssignments.Inner8\n-EarlyAssignments.java:177:17: compiler.err.cant.ref.before.ctor.called: x\n-22 errors\n+EarlyAssignments.java:42:26: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:43:21: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:44:26: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:45:34: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:47:36: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:51:17: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:55:21: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:59:22: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:77:13: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:78:17: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:79:25: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:80:31: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:130:17: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:135:22: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:140:29: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:145:22: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:150:28: compiler.err.cant.ref.before.ctor.called: x\n+EarlyAssignments.java:159:13: compiler.err.cant.assign.initialized.before.ctor.called: x\n+EarlyAssignments.java:170:13: compiler.err.cant.ref.before.ctor.called: this\n+EarlyAssignments.java:170:18: compiler.err.cant.ref.before.ctor.called: EarlyAssignments.Inner8\n+EarlyAssignments.java:179:17: compiler.err.cant.ref.before.ctor.called: x\n+21 errors\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyAssignments.out","additions":22,"deletions":23,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -5,0 +5,9 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n@@ -6,0 +15,2 @@\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyIndirectOuterCapture\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyIndirectOuterCapture.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -5,0 +5,9 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n@@ -6,0 +15,2 @@\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyInnerAccessErrorMessageTest\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyInnerAccessErrorMessageTest.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-EarlyInnerAccessErrorMessageTest.java:11:34: compiler.err.cant.ref.before.ctor.called: x\n+EarlyInnerAccessErrorMessageTest.java:22:34: compiler.err.cant.ref.before.ctor.called: x\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyInnerAccessErrorMessageTest.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLambdaReturn\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLambdaReturn\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLambdaReturn.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -5,0 +5,9 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n@@ -6,0 +15,2 @@\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalClass\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalClass.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-EarlyLocalClass.java:11:37: compiler.err.cant.ref.before.ctor.called: hashCode()\n+EarlyLocalClass.java:22:37: compiler.err.cant.ref.before.ctor.called: hashCode()\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalClass.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest1\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest1\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest1.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest2\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest2\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest2.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest3\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest3\n@@ -28,0 +40,1 @@\n+\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest3.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest4\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest4\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest4.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest5\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest5\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest5.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest6\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest6\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest6.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest7\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest7\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest7.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main EarlyLocalTest8\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester EarlyLocalTest8\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/EarlyLocalTest8.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,3 +28,1 @@\n-public @interface Foo {\n-    int value();\n-}\n+public @interface ErrorExpected {}\n\\ No newline at end of file\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/ErrorExpected.java","additions":2,"deletions":4,"binary":false,"changes":6,"previous_filename":"test\/langtools\/tools\/javac\/processing\/model\/element\/repeatingAnnotations\/supportingAnnotations\/Foo.java","status":"copied"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,3 +28,1 @@\n-public @interface Foo {\n-    int value();\n-}\n+public @interface IgnoreMethod {}\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/IgnoreMethod.java","additions":2,"deletions":4,"binary":false,"changes":6,"previous_filename":"test\/langtools\/tools\/javac\/processing\/model\/element\/repeatingAnnotations\/supportingAnnotations\/Foo.java","status":"copied"},{"patch":"@@ -1,29 +0,0 @@\n-\/*\n- * @test \/nodynamiccopyright\/\n- * @bug 8367698\n- * @summary New lint category `initialization` for code that would not be allowed in the prologue\n- * @compile\/fail\/ref=InitializationWarningTest.out -XDrawDiagnostics -Xlint:initialization -Werror InitializationWarningTest.java\n- * @enablePreview\n- *\/\n-\n-class InitializationWarningTest implements Iterable<Object> {\n-    InitializationWarningTest self = this;\n-    Object o = null;\n-\n-    InitializationWarningTest(Object oo, InitializationWarningTest other) {\n-        this.o = oo;                                  \/\/ warning, field has initializer\n-        m();                                          \/\/ warning, instance method\n-        InitializationWarningTest.this.m();           \/\/ warning, instance method\n-        InitializationWarningTest.super.hashCode();   \/\/ warning\n-        other.m();                                    \/\/ good\n-        sm();                                         \/\/ good too\n-        System.identityHashCode(this);                \/\/ warning\n-        Iterable.super.spliterator();                 \/\/ warning\n-        new Inner();\n-    }\n-\n-    class Inner {}\n-\n-    void m() {}\n-    static void sm() {}\n-}\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/InitializationWarningTest.java","additions":0,"deletions":29,"binary":false,"changes":29,"status":"deleted"},{"patch":"@@ -1,11 +0,0 @@\n-InitializationWarningTest.java:9:1: compiler.err.does.not.override.abstract: InitializationWarningTest, iterator(), java.lang.Iterable\n-InitializationWarningTest.java:10:38: compiler.warn.would.not.be.allowed.in.prologue: this\n-InitializationWarningTest.java:14:13: compiler.warn.would.not.be.allowed.in.prologue: o\n-InitializationWarningTest.java:15:9: compiler.warn.would.not.be.allowed.in.prologue: m()\n-InitializationWarningTest.java:16:39: compiler.warn.would.not.be.allowed.in.prologue: m()\n-InitializationWarningTest.java:17:40: compiler.warn.would.not.be.allowed.in.prologue: hashCode()\n-InitializationWarningTest.java:20:33: compiler.warn.would.not.be.allowed.in.prologue: this\n-InitializationWarningTest.java:21:23: compiler.warn.would.not.be.allowed.in.prologue: spliterator()\n-InitializationWarningTest.java:22:9: compiler.warn.would.not.be.allowed.in.prologue: InitializationWarningTest\n-1 error\n-8 warnings\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/InitializationWarningTest.out","additions":0,"deletions":11,"binary":false,"changes":11,"status":"deleted"},{"patch":"@@ -0,0 +1,228 @@\n+\/*\n+ * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.io.PrintWriter;\n+import java.io.IOException;\n+\n+import java.io.IOException;\n+import java.nio.file.DirectoryStream;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.stream.Stream;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.charset.Charset;\n+\n+import javax.tools.Diagnostic;\n+import javax.tools.DiagnosticListener;\n+import javax.tools.JavaFileObject;\n+import javax.tools.SimpleJavaFileObject;\n+\n+import com.sun.tools.javac.code.Attribute;\n+import com.sun.tools.javac.comp.Attr;\n+import com.sun.tools.javac.comp.AttrContext;\n+import com.sun.tools.javac.comp.CompileStates;\n+import com.sun.tools.javac.comp.Env;\n+import com.sun.tools.javac.comp.Modules;\n+import com.sun.tools.javac.file.JavacFileManager;\n+import com.sun.tools.javac.file.PathFileObject;\n+import com.sun.tools.javac.main.JavaCompiler;\n+import com.sun.tools.javac.tree.JCTree;\n+import com.sun.tools.javac.tree.JCTree.*;\n+import com.sun.tools.javac.tree.TreeInfo;\n+import com.sun.tools.javac.util.Assert;\n+import com.sun.tools.javac.util.Context;\n+import com.sun.tools.javac.util.DiagnosticSource;\n+import com.sun.tools.javac.util.JCDiagnostic;\n+import com.sun.tools.javac.util.List;\n+import com.sun.tools.javac.util.ListBuffer;\n+import com.sun.tools.javac.util.Log;\n+import com.sun.tools.javac.util.Options;\n+\n+public class InitializationWarningTester {\n+    Context context;\n+    Options options;\n+    MyJavaCompiler javaCompiler;\n+    JavacFileManager javacFileManager;\n+    PrintWriter errOut;\n+    DiagnosticListener<JavaFileObject> diagnosticListener;\n+\n+    public static void main(String... args) throws Throwable {\n+        String testSrc = System.getProperty(\"test.src\");\n+        Path baseDir = Paths.get(testSrc);\n+        InitializationWarningTester tester = new InitializationWarningTester();\n+        Assert.check(args.length > 0, \"no args, ending\");\n+        tester.test(baseDir, args[0]);\n+    }\n+\n+    java.util.List<String> compilationOutput = new ArrayList<>();\n+\n+    public InitializationWarningTester() {\n+        context = new Context();\n+        diagnosticListener = new DiagnosticListener<JavaFileObject>() {\n+            public void report(Diagnostic<? extends JavaFileObject> message) {\n+                if (!ignoreDiagnostics &&\n+                    (message.getCode().contains(warningKey) ||\n+                     message.getCode().contains(errorKey1) ||\n+                     message.getCode().contains(errorKey2))) {\n+                    if ((message.getCode().contains(errorKey1) ||\n+                            message.getCode().contains(errorKey2)) &&\n+                            !errorExpected) {\n+                        throw new AssertionError(\"error key not expected \" + message);\n+                    }\n+                    JCDiagnostic diagnostic = (JCDiagnostic) message;\n+                    String msgData = ((PathFileObject)diagnostic.getDiagnosticSource().getFile()).getShortName() +\n+                            \":\" + diagnostic.getLineNumber() + \":\" + diagnostic.getColumnNumber() + \": \" + diagnostic.getCode() + \": \" +\n+                            diagnostic.getArgs()[0];\n+                    compilationOutput.add(msgData);\n+                }\n+            }\n+        };\n+        context.put(DiagnosticListener.class, diagnosticListener);\n+        JavacFileManager.preRegister(context);\n+        MyAttr.preRegister(context, this);\n+        options = Options.instance(context);\n+        options.put(\"--enable-preview\", \"--enable-preview\");\n+        options.put(\"--source\", Integer.toString(Runtime.version().feature()));\n+        options.put(\"-Xlint:initialization\", \"-Xlint:initialization\");\n+        javaCompiler = new MyJavaCompiler(context);\n+        javacFileManager = new JavacFileManager(context, false, Charset.defaultCharset());\n+    }\n+\n+    static final String errorKey1 = \"compiler.err.cant.ref.before.ctor.called\";\n+    static final String errorKey2 = \"compiler.err.cant.assign.initialized.before.ctor.called\";\n+    static final String warningKey = \"compiler.warn.would.not.be.allowed.in.prologue\";\n+\n+    void test(Path baseDir, String className) throws Throwable {\n+        DirectoryStream<Path> paths = null;\n+        try {\n+            paths = Files.newDirectoryStream(baseDir,\n+                    p -> (!Files.isDirectory(p) &&\n+                            (p.endsWith(className + \".java\") ||\n+                            p.endsWith(className + \".out\"))\n+                    )\n+            );\n+        } catch (IOException e) {\n+            throw new AssertionError(\"Error accessing directory: \" + e.getMessage());\n+        }\n+\n+        Path javaFile = null;\n+        Path goldenFile = null;\n+        for (Path p: paths) {\n+            if (p.toString().endsWith(\"java\")) {\n+                javaFile = p;\n+            } else if (p.toString().endsWith(\"out\")) {\n+                goldenFile = p;\n+            }\n+        }\n+        \/\/ compile\n+        javaCompiler.compile(com.sun.tools.javac.util.List.of(javacFileManager.getJavaFileObject(javaFile)));\n+        if (goldenFile != null) {\n+            java.util.List<String> goldenFileContent = Files.readAllLines(goldenFile);\n+            goldenFileContent = goldenFileContent.stream()\n+                    .filter(s -> s.contains(errorKey1) || s.contains(errorKey2))\n+                    .collect(Collectors.toList());\n+            Assert.check(goldenFileContent.size() == compilationOutput.size(), \"compilation output length mismatch\");\n+            for (int i = 0; i < goldenFileContent.size(); i++) {\n+                String goldenLine = goldenFileContent.get(i);\n+                String warningLine = compilationOutput.get(i);\n+                if (warningLine.contains(warningKey)) {\n+                    goldenLine = goldenLine.replace(errorKey1, warningKey);\n+                    goldenLine = goldenLine.replace(errorKey2, warningKey);\n+                }\n+                Assert.check(warningLine.equals(goldenLine), \"error for line \" + warningLine);\n+            }\n+        } else {\n+            Assert.check(compilationOutput.size() == 0);\n+        }\n+    }\n+\n+    static class MyJavaCompiler extends JavaCompiler {\n+        MyJavaCompiler(Context context) {\n+            super(context);\n+            \/\/ do not generate code\n+            this.shouldStopPolicyIfNoError = CompileStates.CompileState.LOWER;\n+        }\n+    }\n+\n+    \/\/ ignore diagnostics\n+    boolean ignoreDiagnostics = false;\n+    \/\/ even when compiling with warnings on, an error will be produced\n+    boolean errorExpected = false;\n+\n+    static class MyAttr extends Attr {\n+        InitializationWarningTester tester;\n+        static void preRegister(Context context, InitializationWarningTester tester) {\n+            context.put(attrKey, (com.sun.tools.javac.util.Context.Factory<Attr>) c -> new MyAttr(c, tester));\n+        }\n+\n+        MyAttr(Context context, InitializationWarningTester tester) {\n+            super(context);\n+            this.tester = tester;\n+        }\n+\n+        @Override\n+        public void visitMethodDef(JCMethodDecl tree) {\n+            boolean previousIgnoreDiags = tester.ignoreDiagnostics;\n+            boolean previousErrExpected = tester.errorExpected;\n+            try {\n+                if (TreeInfo.isConstructor(tree)) {\n+                    \/\/ remove the super constructor call if it is a no arguments invocation\n+                    List<Attribute.Compound> attributes = tree.sym.getDeclarationAttributes();\n+                    for (Attribute.Compound attribute : attributes) {\n+                        if (attribute.toString().equals(\"@IgnoreMethod\")) {\n+                            tester.ignoreDiagnostics = true;\n+                        } else if (attribute.toString().equals(\"@ErrorExpected\")) {\n+                            tester.errorExpected = true;\n+                        }\n+                    }\n+                    if (TreeInfo.hasAnyConstructorCall(tree) && !tester.errorExpected) {\n+                        ListBuffer<JCStatement> newStats = new ListBuffer<>();\n+                        for (JCStatement statement : tree.body.stats) {\n+                            if (statement instanceof JCExpressionStatement expressionStatement &&\n+                                    expressionStatement.expr instanceof JCMethodInvocation methodInvocation) {\n+                                if (TreeInfo.isConstructorCall(methodInvocation) && methodInvocation.args.isEmpty()) {\n+                                    continue;\n+                                }\n+                            }\n+                            newStats.add(statement);\n+                        }\n+                        tree.body.stats = newStats.toList();\n+                    }\n+                }\n+                super.visitMethodDef(tree);\n+            } finally {\n+                tester.ignoreDiagnostics = previousIgnoreDiags;\n+                tester.errorExpected = previousErrExpected;\n+            }\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/InitializationWarningTester.java","additions":228,"deletions":0,"binary":false,"changes":228,"status":"added"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main LambdaLocalEarlyCrash\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester LambdaLocalEarlyCrash\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/LambdaLocalEarlyCrash.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main LambdaOuterCapture\n+ * @build InitializationWarningTester\n+ * @run main InitializationWarningTester LambdaOuterCapture\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/LambdaOuterCapture.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -5,1 +5,0 @@\n- * @compile\/fail\/ref=SuperInitFails.out -XDrawDiagnostics SuperInitFails.java\n@@ -7,0 +6,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @compile\/fail\/ref=SuperInitFails.out -XDrawDiagnostics SuperInitFails.java\n+ * @build ErrorExpected InitializationWarningTester\n+ * @run main InitializationWarningTester SuperInitFails\n@@ -102,1 +113,1 @@\n-\n+    @ErrorExpected\n@@ -153,1 +164,1 @@\n-\n+    @ErrorExpected\n@@ -157,1 +168,1 @@\n-\n+    @ErrorExpected\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/SuperInitFails.java","additions":15,"deletions":4,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -1,35 +1,35 @@\n-SuperInitFails.java:57:9: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:62:13: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:67:14: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:72:28: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:77:29: compiler.err.cant.ref.before.ctor.called: hashCode()\n-SuperInitFails.java:99:33: compiler.err.cant.ref.before.ctor.called: this\n-SuperInitFails.java:104:14: compiler.err.cant.ref.before.ctor.called: this\n-SuperInitFails.java:108:20: compiler.err.not.encl.class: java.lang.Object\n-SuperInitFails.java:112:23: compiler.err.cant.ref.before.ctor.called: spliterator()\n-SuperInitFails.java:119:22: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:125:9: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n-SuperInitFails.java:133:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record1\n-SuperInitFails.java:138:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record2\n-SuperInitFails.java:155:50: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:159:15: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n-SuperInitFails.java:168:13: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:172:17: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:176:24: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:180:18: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:186:32: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:206:25: compiler.err.return.before.superclass.initialized\n-SuperInitFails.java:211:33: compiler.err.ctor.calls.not.allowed.here\n-SuperInitFails.java:216:29: compiler.err.redundant.superclass.init\n-SuperInitFails.java:229:41: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:230:16: compiler.err.cant.ref.before.ctor.called: x\n-SuperInitFails.java:239:35: compiler.err.cant.ref.before.ctor.called: this\n-SuperInitFails.java:33:13: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:37:14: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:41:14: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:45:13: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:49:33: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:53:32: compiler.err.call.must.only.appear.in.ctor\n-SuperInitFails.java:83:18: compiler.err.ctor.calls.not.allowed.here\n-SuperInitFails.java:89:13: compiler.err.return.before.superclass.initialized\n-SuperInitFails.java:150:18: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:68:9: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:73:13: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:78:14: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:83:28: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:88:29: compiler.err.cant.ref.before.ctor.called: hashCode()\n+SuperInitFails.java:110:33: compiler.err.cant.ref.before.ctor.called: this\n+SuperInitFails.java:115:14: compiler.err.cant.ref.before.ctor.called: this\n+SuperInitFails.java:119:20: compiler.err.not.encl.class: java.lang.Object\n+SuperInitFails.java:123:23: compiler.err.cant.ref.before.ctor.called: spliterator()\n+SuperInitFails.java:130:22: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:136:9: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n+SuperInitFails.java:144:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record1\n+SuperInitFails.java:149:9: compiler.err.non.canonical.constructor.invoke.another.constructor: SuperInitFails.Record2\n+SuperInitFails.java:166:50: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:170:15: compiler.err.cant.ref.before.ctor.called: SuperInitFails\n+SuperInitFails.java:179:13: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:183:17: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:187:24: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:191:18: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:197:32: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:217:25: compiler.err.return.before.superclass.initialized\n+SuperInitFails.java:222:33: compiler.err.ctor.calls.not.allowed.here\n+SuperInitFails.java:227:29: compiler.err.redundant.superclass.init\n+SuperInitFails.java:240:41: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:241:16: compiler.err.cant.ref.before.ctor.called: x\n+SuperInitFails.java:250:35: compiler.err.cant.ref.before.ctor.called: this\n+SuperInitFails.java:44:13: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:48:14: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:52:14: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:56:13: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:60:33: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:64:32: compiler.err.call.must.only.appear.in.ctor\n+SuperInitFails.java:94:18: compiler.err.ctor.calls.not.allowed.here\n+SuperInitFails.java:100:13: compiler.err.return.before.superclass.initialized\n+SuperInitFails.java:161:18: compiler.err.call.must.only.appear.in.ctor\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/SuperInitFails.out","additions":35,"deletions":35,"binary":false,"changes":70,"status":"modified"},{"patch":"@@ -27,0 +27,12 @@\n+ * @modules jdk.compiler\/com.sun.tools.javac.api\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.jlink\n+ *          jdk.compiler\/com.sun.tools.javac.code\n+ *          jdk.compiler\/com.sun.tools.javac.comp\n+ *          jdk.compiler\/com.sun.tools.javac.file\n+ *          jdk.compiler\/com.sun.tools.javac.main\n+ *          jdk.compiler\/com.sun.tools.javac.tree\n+ *          jdk.compiler\/com.sun.tools.javac.util\n+ * @run main SuperInitGood\n+ * @build InitializationWarningTester IgnoreMethod\n+ * @run main InitializationWarningTester SuperInitGood\n@@ -47,0 +59,1 @@\n+        @IgnoreMethod\n","filename":"test\/langtools\/tools\/javac\/SuperInit\/SuperInitGood.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"}]}