{"files":[{"patch":"@@ -329,0 +329,4 @@\n+    protected void selectTypeModeWithBangs() {\n+        setMode(ALLOW_BANGS | (mode & NOLAMBDA) | TYPE);\n+    }\n+\n@@ -850,1 +854,3 @@\n-            checkNullRestrictionLocation(BAD_BANG_LOCATION_QUALIDENT);\n+            if (checkNullRestrictionLocation(BAD_BANG_LOCATION_QUALIDENT)) {\n+                setNullMarker(t);\n+            }\n@@ -865,1 +871,3 @@\n-                checkNullRestrictionLocation(BAD_BANG_LOCATION_QUALIDENT);\n+                if (checkNullRestrictionLocation(BAD_BANG_LOCATION_QUALIDENT)) {\n+                    setNullMarker(t);\n+                }\n@@ -2287,2 +2295,2 @@\n-    protected Predicate<TokenKind> BAD_BANG_LOCATION = t -> t == LBRACKET || t == MONKEYS_AT || t == DOT || t == LPAREN;\n-    protected Predicate<TokenKind> BAD_BANG_LOCATION_QUALIDENT = t -> t == MONKEYS_AT || t == DOT || t == LPAREN;\n+    protected Predicate<TokenKind> BAD_BANG_LOCATION = t -> t == LT || t == LBRACKET || t == MONKEYS_AT || t == DOT || t == LPAREN;\n+    protected Predicate<TokenKind> BAD_BANG_LOCATION_QUALIDENT = t -> t == LT || t == MONKEYS_AT || t == DOT || t == LPAREN;\n@@ -2803,1 +2811,1 @@\n-        selectTypeMode();\n+        selectTypeModeWithBangs();\n@@ -2806,4 +2814,0 @@\n-        if (allowNullRestrictedTypes && EMOTIONAL_QUALIFIER.test(token.kind)) {\n-            setNullMarker(t);\n-            nextToken();\n-        }\n@@ -2813,0 +2817,6 @@\n+            if (allowNullRestrictedTypes && EMOTIONAL_QUALIFIER.test(token.kind)) {\n+                if (checkNullRestrictionLocation(BAD_BANG_LOCATION_QUALIDENT)) {\n+                    setNullMarker(t);\n+                }\n+                nextToken();\n+            }\n@@ -2830,2 +2840,3 @@\n-                checkNullRestrictonAllowed();\n-                setNullMarker(t);\n+                if (checkNullRestrictionLocation(BAD_BANG_LOCATION_QUALIDENT)) {\n+                    setNullMarker(t);\n+                }\n@@ -2838,0 +2849,6 @@\n+                if (allowNullRestrictedTypes && EMOTIONAL_QUALIFIER.test(token.kind)) {\n+                    if (checkNullRestrictionLocation(BAD_BANG_LOCATION_QUALIDENT)) {\n+                        setNullMarker(t);\n+                    }\n+                    nextToken();\n+                }\n@@ -2909,0 +2926,4 @@\n+            if (allowNullRestrictedTypes && EMOTIONAL_QUALIFIER.test(token.kind)) {\n+                unsupportedNullRestriction();\n+                nextToken();\n+            }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/parser\/JavacParser.java","additions":32,"deletions":11,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -31,0 +31,7 @@\n+    void testNewArrayWithInit() {\n+        var z = new Foo![] { null }; \/\/ ok\n+        var y = new Foo![]! { null }; \/\/ bad, bang can't appear at the end\n+        var x = new Foo![]![] { null }; \/\/ bad, bang can't appear in the middle\n+        var x = new Foo![]![]! { null }; \/\/ bad, bang can't appear in the middle or at the end\n+    }\n+\n","filename":"test\/langtools\/tools\/javac\/nullability\/NullRestrictionNegParserTest.java","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -17,7 +17,11 @@\n-NullRestrictionNegParserTest.java:32:10: compiler.err.unsupported.null.restriction\n-NullRestrictionNegParserTest.java:33:10: compiler.err.unsupported.null.restriction\n-NullRestrictionNegParserTest.java:33:13: compiler.err.unsupported.null.restriction\n-NullRestrictionNegParserTest.java:34:10: compiler.err.unsupported.null.restriction\n-NullRestrictionNegParserTest.java:35:12: compiler.err.unsupported.null.restriction\n-NullRestrictionNegParserTest.java:39:24: compiler.err.unsupported.null.restriction\n-22 errors\n+NullRestrictionNegParserTest.java:33:27: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:34:27: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:35:27: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:35:30: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:39:10: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:40:10: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:40:13: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:41:10: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:42:12: compiler.err.unsupported.null.restriction\n+NullRestrictionNegParserTest.java:46:24: compiler.err.unsupported.null.restriction\n+26 errors\n","filename":"test\/langtools\/tools\/javac\/nullability\/NullRestrictionNegParserTest.out","additions":11,"deletions":7,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -78,2 +78,4 @@\n-        NN_LIST_STRING(\"#{ANNO}List<String>!\", 0);\n-        \/\/NN_LIST_STRING_ARR(\"#{ANNO}List<String>[]!\", 0); \/\/ this doesn't work because of an issue (see JDK-8374629)\n+        NN_LIST_STRING(\"#{ANNO}List<String>!\", 0),\n+        NN_LIST_STRING_BAD_POS(\"#{ANNO}List!<#{ANNO}String>\", 1),\n+        LIST_NN_STRING(\"#{ANNO}List<#{ANNO}String!>\", 1);\n+        \/\/NN_LIST_STRING_ARR(\"#{ANNO}List<#{ANNO}String>[]!\", 0); \/\/ this doesn't work because of an issue (see JDK-8374629)\n","filename":"test\/langtools\/tools\/javac\/nullability\/NullRestrictionParserTest.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"}]}