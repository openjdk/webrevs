{"files":[{"patch":"@@ -5198,1 +5198,2 @@\n-      const Type* akls = TypeAryKlassPtr::make(TypePtr::NotNull, ak, Type::Offset(0), Type::trust_interfaces, not_flat, false, false, false, not_flat, true);\n+      bool not_null_free = !Arguments::is_valhalla_enabled();\n+      const Type* akls = TypeAryKlassPtr::make(TypePtr::NotNull, ak, Type::Offset(0), Type::trust_interfaces, not_flat, not_null_free, false, false, not_flat, true);\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -3936,11 +3936,48 @@\n-  if (!is_valhalla_enabled() || (is_interpreter_only() && !CDSConfig::is_dumping_archive() && !UseSharedSpaces)) {\n-    \/\/ Disable calling convention optimizations if inline types are not supported.\n-    \/\/ Also these aren't useful in -Xint. However, don't disable them when dumping or using\n-    \/\/ the CDS archive, as the values must match between dumptime and runtime.\n-    FLAG_SET_DEFAULT(InlineTypePassFieldsAsArgs, false);\n-    FLAG_SET_DEFAULT(InlineTypeReturnedAsFields, false);\n-  }\n-  if (!UseNonAtomicValueFlattening && !UseNullableValueFlattening && !UseAtomicValueFlattening) {\n-    \/\/ Flattening is disabled\n-    FLAG_SET_DEFAULT(UseArrayFlattening, false);\n-    FLAG_SET_DEFAULT(UseFieldFlattening, false);\n+  if (!is_valhalla_enabled()) {\n+#define WARN_IF_NOT_DEFAULT_FLAG(flag)                                                                       \\\n+    if (!FLAG_IS_DEFAULT(flag)) {                                                                            \\\n+      warning(\"Valhalla-specific flag \\\"%s\\\" has no effect when --enable-preview is not specified.\", #flag); \\\n+    }\n+\n+#define DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(flag)  \\\n+    WARN_IF_NOT_DEFAULT_FLAG(flag)                  \\\n+    FLAG_SET_DEFAULT(flag, false);\n+\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(InlineTypePassFieldsAsArgs);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(InlineTypeReturnedAsFields);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(UseArrayFlattening);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(UseFieldFlattening);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(UseNonAtomicValueFlattening);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(UseNullableValueFlattening);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(UseAtomicValueFlattening);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(PrintInlineLayout);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(PrintFlatArrayLayout);\n+    WARN_IF_NOT_DEFAULT_FLAG(FlatArrayElementMaxOops);\n+    WARN_IF_NOT_DEFAULT_FLAG(UseAltSubstitutabilityMethod);\n+#ifdef ASSERT\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(StressCallingConvention);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(PreloadClasses);\n+    WARN_IF_NOT_DEFAULT_FLAG(PrintInlineKlassFields);\n+#endif\n+#ifdef COMPILER1\n+    DEBUG_ONLY(DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(C1UseDelayedFlattenedFieldReads);)\n+#endif\n+#ifdef COMPILER2\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(UseArrayLoadStoreProfile);\n+    DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT(UseACmpProfile);\n+#endif\n+#undef DISABLE_FLAG_AND_WARN_IF_NOT_DEFAULT\n+#undef WARN_IF_NOT_DEFAULT_FLAG\n+  } else {\n+    if (is_interpreter_only() && !CDSConfig::is_dumping_archive() && !UseSharedSpaces) {\n+      \/\/ Disable calling convention optimizations if inline types are not supported.\n+      \/\/ Also these aren't useful in -Xint. However, don't disable them when dumping or using\n+      \/\/ the CDS archive, as the values must match between dumptime and runtime.\n+      FLAG_SET_DEFAULT(InlineTypePassFieldsAsArgs, false);\n+      FLAG_SET_DEFAULT(InlineTypeReturnedAsFields, false);\n+    }\n+    if (!UseNonAtomicValueFlattening && !UseNullableValueFlattening && !UseAtomicValueFlattening) {\n+      \/\/ Flattening is disabled\n+      FLAG_SET_DEFAULT(UseArrayFlattening, false);\n+      FLAG_SET_DEFAULT(UseFieldFlattening, false);\n+    }\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":48,"deletions":11,"binary":false,"changes":59,"status":"modified"}]}