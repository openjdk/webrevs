{"files":[{"patch":"@@ -37,0 +37,2 @@\n+import java.util.ArrayList;\n+import java.util.Arrays;\n@@ -46,12 +48,4 @@\n-        String tests[];\n-        \/\/ IntegerCache does not exist in preview mode so it should not be expected in the output\n-        if (PreviewFeatures.isEnabled()) {\n-            tests = new String[] {\n-                \/\/ Try to replace classes that are used by the archived subgraph graphs. (CDS should be disabled)\n-                \"-early -notshared -subgraph java\/lang\/module\/ResolvedModule jdk.internal.module.ArchivedModuleGraph\",\n-                \"-early -notshared -subgraph java\/lang\/Integer java.lang.Integer$IntegerCache\",\n-\n-                \/\/ CDS should not be disabled -- these critical classes cannot be replaced because\n-                \/\/ JvmtiExport::early_class_hook_env() is false.\n-                \"-subgraph java\/lang\/module\/Configuration java.lang.module.Configuration\",\n-                \"-subgraph java\/lang\/ModuleLayer java.lang.ModuleLayer\",\n+        ArrayList<String> tests = new ArrayList<String>(Arrays.asList(\n+            \/\/ Try to replace classes that are used by the archived subgraph graphs. (CDS should be disabled)\n+            \"-early -notshared -subgraph java\/lang\/module\/ResolvedModule jdk.internal.module.ArchivedModuleGraph\",\n+            \"-early -notshared -subgraph java\/lang\/Integer java.lang.Integer$IntegerCache\",\n@@ -59,12 +53,4 @@\n-                \/\/ Tests for archived full module graph. We cannot use whitebox, which requires appending to bootclasspath.\n-                \/\/ VM will disable full module graph if bootclasspath is appended.\n-                \"-nowhitebox -early -notshared -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n-                \"-nowhitebox -early -notshared -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n-                \"-nowhitebox -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n-                \"-nowhitebox -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n-            };\n-        } else {\n-            tests = new String[] {\n-                \/\/ Try to replace classes that are used by the archived subgraph graphs. (CDS should be disabled)\n-                \"-early -notshared -subgraph java\/lang\/module\/ResolvedModule jdk.internal.module.ArchivedModuleGraph\",\n-                \"-early -notshared -subgraph java\/lang\/Integer java.lang.Integer$IntegerCache\",\n+            \/\/ CDS should not be disabled -- these critical classes cannot be replaced because\n+            \/\/ JvmtiExport::early_class_hook_env() is false.\n+            \"-subgraph java\/lang\/module\/Configuration java.lang.module.Configuration\",\n+            \"-subgraph java\/lang\/ModuleLayer java.lang.ModuleLayer\",\n@@ -72,5 +58,6 @@\n-                \/\/ CDS should not be disabled -- these critical classes cannot be replaced because\n-                \/\/ JvmtiExport::early_class_hook_env() is false.\n-                \"-subgraph java\/lang\/module\/Configuration java.lang.module.Configuration\",\n-                \"-subgraph java\/lang\/ModuleLayer java.lang.ModuleLayer\",\n-                \"-subgraph java\/lang\/Integer java.lang.Integer$IntegerCache\",\n+            \/\/ Tests for archived full module graph. We cannot use whitebox, which requires appending to bootclasspath.\n+            \/\/ VM will disable full module graph if bootclasspath is appended.\n+            \"-nowhitebox -early -notshared -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n+            \"-nowhitebox -early -notshared -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n+            \"-nowhitebox -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n+            \"-nowhitebox -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\"));\n@@ -78,7 +65,5 @@\n-                \/\/ Tests for archived full module graph. We cannot use whitebox, which requires appending to bootclasspath.\n-                \/\/ VM will disable full module graph if bootclasspath is appended.\n-                \"-nowhitebox -early -notshared -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n-                \"-nowhitebox -early -notshared -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n-                \"-nowhitebox -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n-                \"-nowhitebox -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n-            };\n+        \/\/ IntegerCache does not exist in preview mode so it should not be expected in the output\n+        if (!PreviewFeatures.isEnabled()) {\n+            \/\/ CDS should not be disabled -- these critical classes cannot be replaced because\n+            \/\/ JvmtiExport::early_class_hook_env() is false.\n+            tests.add(\"-subgraph java\/lang\/Integer java.lang.Integer$IntegerCache\");\n@@ -86,1 +71,2 @@\n-        return tests;\n+\n+        return tests.toArray(new String[0]);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/serviceability\/ReplaceCriticalClassesForSubgraphs.java","additions":23,"deletions":37,"binary":false,"changes":60,"status":"modified"}]}