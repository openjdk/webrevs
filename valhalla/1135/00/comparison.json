{"files":[{"patch":"@@ -38,0 +38,1 @@\n+import java.lang.reflect.AccessFlag;\n@@ -359,8 +360,10 @@\n-        LoadableDescriptorsAttributeBuilder builder = new LoadableDescriptorsAttributeBuilder(targetClass);\n-        builder.add(factoryType)\n-               .add(interfaceMethodType)\n-               .add(implMethodType)\n-               .add(dynamicMethodType)\n-               .add(altMethods);\n-        if (!builder.isEmpty())\n-            cw.visitAttribute(builder.build());\n+        if (PreviewFeatures.isEnabled()) {\n+            LoadableDescriptorsAttributeBuilder builder = new LoadableDescriptorsAttributeBuilder(targetClass);\n+            builder.add(factoryType)\n+                    .add(interfaceMethodType)\n+                    .add(implMethodType)\n+                    .add(dynamicMethodType)\n+                    .add(altMethods);\n+            if (!builder.isEmpty())\n+                cw.visitAttribute(builder.build());\n+        }\n@@ -618,1 +621,1 @@\n-            return cls.isValue();\n+            return cls.isValue() && cls.accessFlags().contains(AccessFlag.FINAL);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/InnerClassLambdaMetafactory.java","additions":12,"deletions":9,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -246,1 +246,1 @@\n-        return this.isValueClass();\n+        return this.isValueClass() && this.isFinal();\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/Type.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1118,1 +1118,1 @@\n-            poolWriter.enterLoadableDescriptorsClass((ClassSymbol) localType.tsym);\n+            poolWriter.enterLoadableDescriptorsClass(localType.tsym);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/jvm\/Gen.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8280164\n+ * @bug 8280164 8334313\n@@ -38,9 +38,10 @@\n-    final value class V1 {}\n-    final value class V2 {}\n-    final value class V3 {}\n-    final value class V4 {}\n-    final value class V5 {}\n-    final value class V6 {}\n-    final value class V7 {}\n-    final value class V8 {}\n-    final value class V9 {}\n+    value class V1 {}\n+    value class V2 {}\n+    value class V3 {}\n+    value class V4 {}\n+    value class V5 {}\n+    value class V6 {}\n+    value class V7 {}\n+    value class V8 {}\n+    value class V9 {}\n+    abstract value class V10 {}\n@@ -70,0 +71,1 @@\n+        V10 v10 = null; \/\/ abstract shouldn't be in the loadable descriptors attr\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/LoadableDescriptorsAttributeTest.java","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"}]}