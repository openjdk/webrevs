{"files":[{"patch":"@@ -40,1 +40,0 @@\n-import java.util.NoSuchElementException;\n@@ -42,1 +41,0 @@\n-import java.util.function.Predicate;\n@@ -44,2 +42,0 @@\n-import java.util.stream.Stream;\n-\n@@ -333,81 +329,0 @@\n-    \/**\n-     * Returns the \"raw\" API for accessing underlying jimage resource entries.\n-     *\n-     * <p>This is only meaningful for use by code dealing directly with jimage\n-     * files, and cannot be used to reliably lookup resources used at runtime.\n-     *\n-     * <p>This API remains valid until the image reader from which it was\n-     * obtained is closed.\n-     *\/\n-    \/\/ Package visible for use by ImageReader.\n-    ResourceEntries getResourceEntries() {\n-        return new ResourceEntries() {\n-            @Override\n-            public Stream<String> entryNamesIn(String module) {\n-                if (module.isEmpty() || module.equals(\"modules\") || module.equals(\"packages\")) {\n-                    throw new IllegalArgumentException(\"Invalid module name: \" + module);\n-                }\n-                return IntStream.range(0, offsets.capacity())\n-                        .map(offsets::get)\n-                        .filter(offset -> offset != 0)\n-                        \/\/ Reusing a location instance or getting the module\n-                        \/\/ offset directly would save a lot of allocations here.\n-                        .mapToObj(offset -> ImageLocation.readFrom(BasicImageReader.this, offset))\n-                        \/\/ Reverse lookup of module offset would be faster here.\n-                        .filter(loc -> module.equals(loc.getModule()))\n-                        .map(ImageLocation::getFullName);\n-            }\n-\n-            private ImageLocation getResourceLocation(String name) {\n-                \/\/ Other types of invalid name just result in no entry being found.\n-                if (name.startsWith(\"\/modules\/\") || name.startsWith(\"\/packages\/\")) {\n-                    throw new IllegalArgumentException(\"Invalid entry name: \" + name);\n-                }\n-                ImageLocation location = BasicImageReader.this.findLocation(name);\n-                if (location == null) {\n-                    throw new NoSuchElementException(\"No such resource entry: \" + name);\n-                }\n-                return location;\n-            }\n-\n-            @Override\n-            public long sizeOf(String name) {\n-                return getResourceLocation(name).getUncompressedSize();\n-            }\n-\n-            @Override\n-            public InputStream open(String name) {\n-                return BasicImageReader.this.getResourceStream(getResourceLocation(name));\n-            }\n-        };\n-    }\n-\n-    \/**\n-     * Returns a sorted array of all matching entry names in the jimage file.\n-     *\n-     * <p>Entry names are of one of the following forms:\n-     * <ul>\n-     *     <li>{@code \"\/modules\/<mod-name>\/path\/to\/class-or-resource\"}\n-     *     <li>{@code \"\/<mod-name>\/path\/to\/directory\"}\n-     *     <li>{@code \"\/packages\/<package-name>\"}\n-     * <\/ul>\n-     *\n-     * <p>Note that the module names {@code \"modules\"} or {@code \"packages\"} are\n-     * not representable in a jimage file, so can never exist.\n-     *\n-     * <p>The resulting array is sorted lexicographically, and the resulting\n-     * order need not match that of a breadth or depth first search.\n-     *\n-     * @param matcher a predicate for entry names to be returned.\n-     *\/\n-    public String[] getEntryNames(Predicate<String> matcher) {\n-        int[] attributeOffsets = new int[offsets.capacity()];\n-        offsets.get(attributeOffsets);\n-        return IntStream.of(attributeOffsets)\n-                .filter(o -> o != 0)\n-                .mapToObj(o -> ImageLocation.readFrom(this, o).getFullName())\n-                .filter(matcher)\n-                .sorted()\n-                .toArray(String[]::new);\n-    }\n-\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/BasicImageReader.java","additions":0,"deletions":85,"binary":false,"changes":85,"status":"modified"},{"patch":"@@ -72,1 +72,1 @@\n-            int locationsSize, int stringsSize) {\n+                       int locationsSize, int stringsSize) {\n@@ -78,3 +78,2 @@\n-                int flags, int resourceCount,\n-                int tableLength, int locationsSize, int stringsSize)\n-    {\n+                       int flags, int resourceCount,\n+                       int tableLength, int locationsSize, int stringsSize) {\n@@ -92,1 +91,1 @@\n-       return HEADER_SLOTS * 4;\n+        return HEADER_SLOTS * 4;\n@@ -100,1 +99,1 @@\n-                \"jimage header not the correct size: \" + buffer.capacity());\n+                    \"jimage header not the correct size: \" + buffer.capacity());\n@@ -114,1 +113,1 @@\n-            resourceCount, tableLength, locationsSize, stringsSize);\n+                resourceCount, tableLength, locationsSize, stringsSize);\n@@ -176,4 +175,4 @@\n-               getRedirectSize() +\n-               getOffsetsSize() +\n-               getLocationsSize() +\n-               getStringsSize();\n+                getRedirectSize() +\n+                getOffsetsSize() +\n+                getLocationsSize() +\n+                getStringsSize();\n@@ -188,1 +187,1 @@\n-               getRedirectSize();\n+                getRedirectSize();\n@@ -193,1 +192,1 @@\n-               getOffsetsSize();\n+                getOffsetsSize();\n@@ -198,1 +197,1 @@\n-               getLocationsSize();\n+                getLocationsSize();\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ImageHeader.java","additions":13,"deletions":14,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -231,1 +231,1 @@\n-                    \"Invalid jimage attribute kind: \" + kind);\n+                        \"Invalid jimage attribute kind: \" + kind);\n@@ -253,1 +253,1 @@\n-                    stream.put((int)(value >> (i << 3)));\n+                    stream.put((int) (value >> (i << 3)));\n@@ -261,1 +261,1 @@\n-     }\n+    }\n@@ -276,1 +276,1 @@\n-        int moduleOffset = (int)attributes[ATTRIBUTE_MODULE];\n+        int moduleOffset = (int) attributes[ATTRIBUTE_MODULE];\n@@ -347,1 +347,1 @@\n-            ImageStrings strings) {\n+                          ImageStrings strings) {\n@@ -359,1 +359,1 @@\n-            int moduleOffset, int parentOffset, int baseOffset, int extOffset, ImageStrings strings) {\n+                                      int moduleOffset, int parentOffset, int baseOffset, int extOffset, ImageStrings strings) {\n@@ -399,1 +399,1 @@\n-                \"Invalid jimage attribute kind: \" + kind);\n+                    \"Invalid jimage attribute kind: \" + kind);\n@@ -407,1 +407,1 @@\n-                \"Invalid jimage attribute kind: \" + kind);\n+                    \"Invalid jimage attribute kind: \" + kind);\n@@ -409,1 +409,1 @@\n-        return getStrings().get((int)attributes[kind]);\n+        return getStrings().get((int) attributes[kind]);\n@@ -417,1 +417,1 @@\n-        return (int)getAttribute(ATTRIBUTE_MODULE);\n+        return (int) getAttribute(ATTRIBUTE_MODULE);\n@@ -425,1 +425,1 @@\n-        return (int)getAttribute(ATTRIBUTE_BASE);\n+        return (int) getAttribute(ATTRIBUTE_BASE);\n@@ -433,1 +433,1 @@\n-        return (int)getAttribute(ATTRIBUTE_PARENT);\n+        return (int) getAttribute(ATTRIBUTE_PARENT);\n@@ -441,1 +441,1 @@\n-        return (int)getAttribute(ATTRIBUTE_EXTENSION);\n+        return (int) getAttribute(ATTRIBUTE_EXTENSION);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ImageLocation.java","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -233,13 +233,0 @@\n-    \/**\n-     * Returns the \"raw\" API for accessing underlying jimage resource entries.\n-     *\n-     * <p>This is only meaningful for use by code dealing directly with jimage\n-     * files, and cannot be used to reliably lookup resources used at runtime.\n-     *\n-     * <p>This API remains valid until the image reader from which it was\n-     * obtained is closed.\n-     *\/\n-    public ResourceEntries getResourceEntries() {\n-        return reader.getResourceEntries();\n-    }\n-\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ImageReader.java","additions":0,"deletions":13,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -73,1 +73,1 @@\n-    public static ModuleReference forPackageIn(String moduleName, boolean isPreview) {\n+    public static ModuleReference forPackage(String moduleName, boolean isPreview) {\n@@ -82,1 +82,1 @@\n-    public static ModuleReference forEmptyPackageIn(String moduleName, boolean isPreview) {\n+    public static ModuleReference forEmptyPackage(String moduleName, boolean isPreview) {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ModuleReference.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -59,1 +59,1 @@\n-        if (!ENABLE_PREVIEW_MODE) {\n+        if (!DISABLE_PREVIEW_PATCHING) {\n@@ -89,1 +89,0 @@\n-    ;\n@@ -95,1 +94,1 @@\n-    private static final boolean ENABLE_PREVIEW_MODE = Boolean.parseBoolean(\n+    private static final boolean DISABLE_PREVIEW_PATCHING = Boolean.parseBoolean(\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/PreviewMode.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1,41 +0,0 @@\n-package jdk.internal.jimage;\n-\n-import java.io.InputStream;\n-import java.util.stream.Stream;\n-\n-\/**\n- * Accesses the underlying resource entries in a jimage file.\n- *\n- * <p>This API is designed only for use by the jlink classes, which manipulate\n- * jimage files directly. For inspection of runtime resources, it is vital that\n- * {@code previewMode} is correctly observed, making this API unsuitable.\n- *\n- * <p>This API ignores the {@code previewMode} of the {@link ImageReader} from\n- * which it is obtained, and returns an unmapped view of entries (e.g. allowing\n- * for direct access of resources in the {@code META-INF\/preview\/...} namespace).\n- *\n- * <p>It disallows access to resource directories (i.e. {@code \"\/modules\/...\"}\n- * or packages (i.e. {@code \"\/packages\/...\"}.\n- *\/\n-public interface ResourceEntries {\n-    \/**\n-     * Returns the full entry names for all resources in the given module, in\n-     * random order. Entry names will always be prefixed by the given module\n-     * name (e.g. \"\/<module-name\/...\").\n-     *\/\n-    Stream<String> entryNamesIn(String module);\n-\n-    \/**\n-     * Returns the (uncompressed) size of a resource given its full entry name.\n-     *\n-     * @throws java.util.NoSuchElementException if the resource does not exist.\n-     *\/\n-    long sizeOf(String name);\n-\n-    \/**\n-     * Returns an {@link InputStream} for a resource given its full entry name.\n-     *\n-     * @throws java.util.NoSuchElementException if the resource does not exist.\n-     *\/\n-    InputStream open(String name);\n-}\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ResourceEntries.java","additions":0,"deletions":41,"binary":false,"changes":41,"status":"deleted"},{"patch":"@@ -64,0 +64,1 @@\n+\n@@ -177,1 +178,1 @@\n-                    new HashSet<String>(Arrays.asList(\"basic\", \"jrt\")));\n+            new HashSet<String>(Arrays.asList(\"basic\", \"jrt\")));\n@@ -208,2 +209,2 @@\n-                throw new UnsupportedOperationException(\"Syntax '\" + syntax\n-                        + \"' not recognized\");\n+            throw new UnsupportedOperationException(\"Syntax '\" + syntax\n+                    + \"' not recognized\");\n@@ -301,1 +302,1 @@\n-                    \"option class: \" + option.getClass());\n+                        \"option class: \" + option.getClass());\n@@ -305,1 +306,1 @@\n-            options.contains(StandardOpenOption.APPEND)) {\n+                options.contains(StandardOpenOption.APPEND)) {\n@@ -346,2 +347,2 @@\n-            Set<? extends OpenOption> options,\n-            FileAttribute<?>... attrs)\n+                                     Set<? extends OpenOption> options,\n+                                     FileAttribute<?>... attrs)\n@@ -357,2 +358,2 @@\n-            Set<? extends OpenOption> options,\n-            FileAttribute<?>... attrs)\n+                                             Set<? extends OpenOption> options,\n+                                             FileAttribute<?>... attrs)\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jrtfs\/JrtFileSystem.java","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -74,1 +74,1 @@\n-        @SuppressWarnings({ \"removal\", \"suppression\" })\n+        @SuppressWarnings({\"removal\", \"suppression\"})\n@@ -110,1 +110,1 @@\n-            return newFileSystem((String)env.get(\"java.home\"), uri, env);\n+            return newFileSystem((String) env.get(\"java.home\"), uri, env);\n@@ -136,1 +136,1 @@\n-        Map<String,?> newEnv = new HashMap<>(env);\n+        Map<String, ?> newEnv = new HashMap<>(env);\n@@ -141,1 +141,1 @@\n-            @SuppressWarnings({ \"deprecation\", \"suppression\" })\n+            @SuppressWarnings({\"deprecation\", \"suppression\"})\n@@ -143,1 +143,1 @@\n-            return ((FileSystemProvider)tmp).newFileSystem(uri, newEnv);\n+            return ((FileSystemProvider) tmp).newFileSystem(uri, newEnv);\n@@ -157,2 +157,1 @@\n-                throws ClassNotFoundException\n-        {\n+                throws ClassNotFoundException {\n@@ -174,1 +173,1 @@\n-    @SuppressWarnings({ \"removal\", \"suppression\" })\n+    @SuppressWarnings({\"removal\", \"suppression\"})\n@@ -183,1 +182,1 @@\n-        final URL[] urls = new URL[] { url };\n+        final URL[] urls = new URL[]{url};\n@@ -281,1 +280,1 @@\n-            getFileAttributeView(Path path, Class<V> type, LinkOption... options) {\n+    getFileAttributeView(Path path, Class<V> type, LinkOption... options) {\n@@ -308,3 +307,3 @@\n-            Set<? extends OpenOption> options,\n-            ExecutorService exec,\n-            FileAttribute<?>... attrs)\n+                                                              Set<? extends OpenOption> options,\n+                                                              ExecutorService exec,\n+                                                              FileAttribute<?>... attrs)\n@@ -317,2 +316,2 @@\n-            Set<? extends OpenOption> options,\n-            FileAttribute<?>... attrs)\n+                                              Set<? extends OpenOption> options,\n+                                              FileAttribute<?>... attrs)\n@@ -331,2 +330,2 @@\n-            Set<? extends OpenOption> options,\n-            FileAttribute<?>... attrs)\n+                                      Set<? extends OpenOption> options,\n+                                      FileAttribute<?>... attrs)\n@@ -352,1 +351,1 @@\n-            readAttributes(Path path, Class<A> type, LinkOption... options)\n+    readAttributes(Path path, Class<A> type, LinkOption... options)\n@@ -362,1 +361,1 @@\n-            readAttributes(Path path, String attribute, LinkOption... options)\n+    readAttributes(Path path, String attribute, LinkOption... options)\n@@ -369,1 +368,1 @@\n-            Object value, LinkOption... options)\n+                             Object value, LinkOption... options)\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jrtfs\/JrtFileSystemProvider.java","additions":19,"deletions":20,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -51,1 +51,1 @@\n-@SuppressWarnings({ \"removal\", \"suppression\"} )\n+@SuppressWarnings({\"removal\", \"suppression\"})\n@@ -104,6 +104,6 @@\n-            new PrivilegedAction<Boolean>() {\n-                @Override\n-                public Boolean run() {\n-                    return Files.isRegularFile(moduleImageFile);\n-                }\n-            });\n+                new PrivilegedAction<Boolean>() {\n+                    @Override\n+                    public Boolean run() {\n+                        return Files.isRegularFile(moduleImageFile);\n+                    }\n+                });\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jrtfs\/SystemImage.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -89,1 +89,1 @@\n-    private SystemModuleFinders() { }\n+    private SystemModuleFinders() {}\n@@ -151,1 +151,1 @@\n-            = (Map.Entry<String, ModuleReference>[])new Map.Entry[moduleCount];\n+                = (Map.Entry<String, ModuleReference>[]) new Map.Entry[moduleCount];\n@@ -159,4 +159,4 @@\n-                                                     targets[i],\n-                                                     recordedHashes[i],\n-                                                     hashSupplier,\n-                                                     moduleResolutions[i]);\n+                    targets[i],\n+                    recordedHashes[i],\n+                    hashSupplier,\n+                    moduleResolutions[i]);\n@@ -239,4 +239,4 @@\n-                                                     attrs.target(),\n-                                                     attrs.recordedHashes(),\n-                                                     hashSupplier,\n-                                                     attrs.moduleResolution());\n+                    attrs.target(),\n+                    attrs.recordedHashes(),\n+                    hashSupplier,\n+                    attrs.moduleResolution());\n@@ -334,7 +334,7 @@\n-                                                       uri,\n-                                                       readerSupplier,\n-                                                       null,\n-                                                       target,\n-                                                       recordedHashes,\n-                                                       hasher,\n-                                                       mres);\n+                uri,\n+                readerSupplier,\n+                null,\n+                target,\n+                recordedHashes,\n+                hasher,\n+                mres);\n@@ -518,1 +518,1 @@\n-            for (;;) {\n+            for (; ; ) {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/SystemModuleFinders.java","additions":18,"deletions":18,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -124,1 +124,1 @@\n-        return len > Integer.MAX_VALUE ? -1 : (int)len;\n+        return len > Integer.MAX_VALUE ? -1 : (int) len;\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/jrt\/JavaRuntimeURLConnection.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -52,0 +52,1 @@\n+\n@@ -53,0 +54,1 @@\n+\n@@ -59,3 +61,3 @@\n-        new Option<JImageTask>(true, (task, option, arg) -> {\n-            task.options.directory = arg;\n-        }, \"--dir\"),\n+            new Option<JImageTask>(true, (task, option, arg) -> {\n+                task.options.directory = arg;\n+            }, \"--dir\"),\n@@ -63,3 +65,3 @@\n-        new Option<JImageTask>(true, (task, option, arg) -> {\n-            task.options.include = arg;\n-        }, \"--include\"),\n+            new Option<JImageTask>(true, (task, option, arg) -> {\n+                task.options.include = arg;\n+            }, \"--include\"),\n@@ -67,3 +69,3 @@\n-        new Option<JImageTask>(false, (task, option, arg) -> {\n-            task.options.fullVersion = true;\n-        }, true, \"--full-version\"),\n+            new Option<JImageTask>(false, (task, option, arg) -> {\n+                task.options.fullVersion = true;\n+            }, true, \"--full-version\"),\n@@ -71,3 +73,3 @@\n-        new Option<JImageTask>(false, (task, option, arg) -> {\n-            task.options.help = true;\n-        }, \"--help\", \"-h\", \"-?\"),\n+            new Option<JImageTask>(false, (task, option, arg) -> {\n+                task.options.help = true;\n+            }, \"--help\", \"-h\", \"-?\"),\n@@ -75,3 +77,3 @@\n-        new Option<JImageTask>(false, (task, option, arg) -> {\n-            task.options.verbose = true;\n-        }, \"--verbose\"),\n+            new Option<JImageTask>(false, (task, option, arg) -> {\n+                task.options.verbose = true;\n+            }, \"--verbose\"),\n@@ -79,3 +81,3 @@\n-        new Option<JImageTask>(false, (task, option, arg) -> {\n-            task.options.version = true;\n-        }, \"--version\")\n+            new Option<JImageTask>(false, (task, option, arg) -> {\n+                task.options.version = true;\n+            }, \"--version\")\n@@ -121,1 +123,2 @@\n-    };\n+    }\n+    ;\n@@ -184,1 +187,1 @@\n-                                            : new String[0];\n+                        : new String[0];\n@@ -198,1 +201,1 @@\n-                    command != null ? command : \"<unspecified>\");\n+                        command != null ? command : \"<unspecified>\");\n@@ -205,5 +208,5 @@\n-                        .filter(option -> !option.isHidden())\n-                        .sorted()\n-                        .forEach(option -> {\n-                             log.println(TASK_HELPER.getMessage(option.resourceName()));\n-                        });\n+                            .filter(option -> !option.isHidden())\n+                            .sorted()\n+                            .forEach(option -> {\n+                                log.println(TASK_HELPER.getMessage(option.resourceName()));\n+                            });\n@@ -225,1 +228,1 @@\n-                        Stream.of(args).collect(Collectors.joining(\" \")));\n+                            Stream.of(args).collect(Collectors.joining(\" \")));\n@@ -275,2 +278,2 @@\n-         public void apply(BasicImageReader reader,\n-                 String oldModule, String newModule) throws IOException, BadArgs;\n+        public void apply(BasicImageReader reader,\n+                          String oldModule, String newModule) throws IOException, BadArgs;\n@@ -281,1 +284,1 @@\n-                ImageLocation location) throws IOException, BadArgs;\n+                          ImageLocation location) throws IOException, BadArgs;\n@@ -285,1 +288,1 @@\n-            ImageLocation location) throws IOException, BadArgs {\n+                         ImageLocation location) throws IOException, BadArgs {\n@@ -288,1 +291,1 @@\n-        File resource =  new File(directory, name);\n+        File resource = new File(directory, name);\n@@ -294,1 +297,1 @@\n-                                            parent.getAbsolutePath());\n+                        parent.getAbsolutePath());\n@@ -298,1 +301,1 @@\n-                                        parent.getAbsolutePath());\n+                    parent.getAbsolutePath());\n@@ -301,1 +304,1 @@\n-        if (!ImageResourcesTree.isTreeInfoResource(name)) {\n+        if (location.getType() == ImageLocation.LocationType.RESOURCE) {\n@@ -366,1 +369,1 @@\n-      void verify(BasicImageReader reader, String name, ImageLocation location) {\n+    void verify(BasicImageReader reader, String name, ImageLocation location) {\n@@ -384,2 +387,2 @@\n-            ModuleAction moduleAction,\n-            ResourceAction resourceAction) throws IOException, BadArgs {\n+                         ModuleAction moduleAction,\n+                         ResourceAction resourceAction) throws IOException, BadArgs {\n@@ -418,1 +421,2 @@\n-                        if (!ImageResourcesTree.isTreeInfoResource(name)) {\n+                        ImageLocation location = reader.findLocation(name);\n+                        if (location.getType() == ImageLocation.LocationType.RESOURCE) {\n@@ -420,6 +424,4 @@\n-                                int offset = name.indexOf('\/', 1);\n-\n-                                String newModule = offset != -1 ?\n-                                        name.substring(1, offset) :\n-                                        \"<unknown>\";\n-\n+                                String newModule = location.getModule();\n+                                if (newModule.isEmpty()) {\n+                                    newModule = \"<unknown>\";\n+                                }\n@@ -431,2 +433,0 @@\n-\n-                            ImageLocation location = reader.findLocation(name);\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jimage\/JImageTask.java","additions":47,"deletions":47,"binary":false,"changes":94,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-import java.io.Closeable;\n@@ -38,1 +37,1 @@\n-public interface Archive extends Closeable {\n+public interface Archive {\n@@ -63,6 +62,5 @@\n-         * Constructs an entry of the given archive.\n-         *\n-         * @param archive the archive in which this entry exists.\n-         * @param path the complete path of the entry, including the module.\n-         * @param name an entry name relative to its containing module.\n-         * @param type the entry type.\n+         * Constructs an entry of the given archive\n+         * @param archive archive\n+         * @param path\n+         * @param name an entry name that does not contain the module name\n+         * @param type\n@@ -77,0 +75,4 @@\n+        public final Archive archive() {\n+            return archive;\n+        }\n+\n@@ -88,5 +90,0 @@\n-        \/**\n-         * Returns the path of this entry.\n-         *\/\n-        public final String path() {return path;}\n-\n@@ -140,1 +137,0 @@\n-    @Override\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/Archive.java","additions":10,"deletions":14,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+\n@@ -93,1 +94,1 @@\n-            new PerfectHashBuilder<>(\n+                new PerfectHashBuilder<>(\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/BasicImageWriter.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -87,1 +87,1 @@\n-    private static final byte[] EMPTY_RESOURCE_BYTES = new byte[] {};\n+    private static final byte[] EMPTY_RESOURCE_BYTES = new byte[]{};\n@@ -117,5 +117,4 @@\n-            ByteOrder byteOrder,\n-            ImagePluginStack plugins,\n-            boolean generateRuntimeImage)\n-            throws IOException\n-    {\n+                                         ByteOrder byteOrder,\n+                                         ImagePluginStack plugins,\n+                                         boolean generateRuntimeImage)\n+            throws IOException {\n@@ -123,1 +122,1 @@\n-                                                      generateRuntimeImage);\n+                generateRuntimeImage);\n@@ -159,3 +158,3 @@\n-            Set<Archive> archives,\n-            ImagePluginStack pluginSupport,\n-            boolean generateRuntimeImage)\n+                                      Set<Archive> archives,\n+                                      ImagePluginStack pluginSupport,\n+                                      boolean generateRuntimeImage)\n@@ -166,6 +165,6 @@\n-                                    Archive::moduleName,\n-                                    a -> {\n-                                        try (Stream<Entry> entries = a.entries()) {\n-                                            return entries.toList();\n-                                        }\n-                                    }));\n+                    Archive::moduleName,\n+                    a -> {\n+                        try (Stream<Entry> entries = a.entries()) {\n+                            return entries.toList();\n+                        }\n+                    }));\n@@ -176,2 +175,2 @@\n-                    BufferedOutputStream bos = new BufferedOutputStream(fos);\n-                    DataOutputStream out = new DataOutputStream(bos)) {\n+                 BufferedOutputStream bos = new BufferedOutputStream(fos);\n+                 DataOutputStream out = new DataOutputStream(bos)) {\n@@ -189,1 +188,1 @@\n-            ByteOrder byteOrder)\n+                            ByteOrder byteOrder)\n@@ -226,4 +225,4 @@\n-            BasicImageWriter writer,\n-            ImagePluginStack pluginSupport,\n-            DataOutputStream out,\n-            boolean generateRuntimeImage\n+                                               BasicImageWriter writer,\n+                                               ImagePluginStack pluginSupport,\n+                                               DataOutputStream out,\n+                                               boolean generateRuntimeImage\n@@ -352,2 +351,2 @@\n-                                                        .map(a -> a.name())\n-                                                        .collect(Collectors.toSet());\n+                .map(a -> a.name())\n+                .collect(Collectors.toSet());\n@@ -359,2 +358,2 @@\n-                                    .setName(resourceName)\n-                                    .build();\n+                    .setName(resourceName)\n+                    .build();\n@@ -364,1 +363,1 @@\n-                                                                            modules);\n+                modules);\n@@ -378,1 +377,1 @@\n-                                                                      a -> new ArrayList<>());\n+                    a -> new ArrayList<>());\n@@ -410,1 +409,1 @@\n-                                         \" for module \" + module, e);\n+                        \" for module \" + module, e);\n@@ -435,1 +434,1 @@\n-                                                               .findModule(JLINK_MOD_NAME);\n+                .findModule(JLINK_MOD_NAME);\n@@ -463,2 +462,2 @@\n-                                                  .map(rm -> rm.name())\n-                                                  .collect(Collectors.toSet());\n+                .map(rm -> rm.name())\n+                .collect(Collectors.toSet());\n@@ -477,1 +476,1 @@\n-                                               .collect(Collectors.joining(\"\\n\"));\n+                        .collect(Collectors.joining(\"\\n\"));\n@@ -479,1 +478,1 @@\n-                                                 mResContent.getBytes(StandardCharsets.UTF_8)));\n+                        mResContent.getBytes(StandardCharsets.UTF_8)));\n@@ -508,1 +507,1 @@\n-                                                                       a -> new ArrayList<>());\n+                        a -> new ArrayList<>());\n@@ -510,1 +509,1 @@\n-                                                                                  platform);\n+                        platform);\n@@ -525,3 +524,3 @@\n-            Map<String, List<Entry>> entriesForModule,\n-            ByteOrder byteOrder,\n-            BasicImageWriter writer) throws IOException {\n+                                                         Map<String, List<Entry>> entriesForModule,\n+                                                         ByteOrder byteOrder,\n+                                                         BasicImageWriter writer) throws IOException {\n@@ -533,3 +532,3 @@\n-                    entriesForModule.get(mn).stream()\n-                            .map(e -> new ArchiveEntryResourcePoolEntry(mn,\n-                                    e.getResourcePoolEntryName(), e)))\n+                        entriesForModule.get(mn).stream()\n+                                .map(e -> new ArchiveEntryResourcePoolEntry(mn,\n+                                        e.getResourcePoolEntryName(), e)))\n@@ -567,1 +566,1 @@\n-                                                                       writer);\n+                writer);\n@@ -575,0 +574,58 @@\n+\n+    \/**\n+     * Helper method that splits a Resource path onto 3 items: module, parent\n+     * and resource name.\n+     *\n+     * @param path\n+     * @return An array containing module, parent and name.\n+     *\/\n+    public static String[] splitPath(String path) {\n+        Objects.requireNonNull(path);\n+        String noRoot = path.substring(1);\n+        int pkgStart = noRoot.indexOf(\"\/\");\n+        String module = noRoot.substring(0, pkgStart);\n+        List<String> result = new ArrayList<>();\n+        result.add(module);\n+        String pkg = noRoot.substring(pkgStart + 1);\n+        String resName;\n+        int pkgEnd = pkg.lastIndexOf(\"\/\");\n+        if (pkgEnd == -1) { \/\/ No package.\n+            resName = pkg;\n+        } else {\n+            resName = pkg.substring(pkgEnd + 1);\n+        }\n+\n+        pkg = toPackage(pkg, false);\n+        result.add(pkg);\n+        result.add(resName);\n+\n+        String[] array = new String[result.size()];\n+        return result.toArray(array);\n+    }\n+\n+    \/**\n+     * Returns the path of the resource.\n+     *\/\n+    public static String resourceName(String path) {\n+        Objects.requireNonNull(path);\n+        String s = path.substring(1);\n+        int index = s.indexOf(\"\/\");\n+        return s.substring(index + 1);\n+    }\n+\n+    public static String toPackage(String name) {\n+        return toPackage(name, false);\n+    }\n+\n+    private static String toPackage(String name, boolean log) {\n+        int index = name.lastIndexOf('\/');\n+        if (index > 0) {\n+            return name.substring(0, index).replace('\/', '.');\n+        } else {\n+            \/\/ ## unnamed package\n+            if (log) {\n+                System.err.format(\"Warning: %s in unnamed package%n\", name);\n+            }\n+            return \"\";\n+        }\n+    }\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/ImageFileCreator.java","additions":101,"deletions":44,"binary":false,"changes":145,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-               kind < ATTRIBUTE_COUNT : \"Invalid attribute kind\";\n+                kind < ATTRIBUTE_COUNT : \"Invalid attribute kind\";\n@@ -71,1 +71,1 @@\n-        } else if ( fullName.startsWith(\"\/packages\/\")) {\n+        } else if (fullName.startsWith(\"\/packages\/\")) {\n@@ -149,3 +149,3 @@\n-               getParentOffset() == other.getParentOffset() &&\n-               getBaseOffset() == other.getBaseOffset() &&\n-               getExtensionOffset() == other.getExtensionOffset();\n+                getParentOffset() == other.getParentOffset() &&\n+                getBaseOffset() == other.getBaseOffset() &&\n+                getExtensionOffset() == other.getExtensionOffset();\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/ImageLocationWriter.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -50,4 +50,0 @@\n-    public static boolean isTreeInfoResource(String path) {\n-        return path.startsWith(\"\/packages\/\") || path.startsWith(\"\/modules\/\");\n-    }\n-\n@@ -134,3 +130,2 @@\n-     * <p>If all entries in a package are preview-only, then the package's flags\n-     * have {@link ImageLocation#FLAGS_IS_PREVIEW_ONLY FLAGS_IS_PREVIEW_ONLY}\n-     * set, and the entire package must be ignored.\n+     * <p>If all references in a package are preview-only, then the entire\n+     * package is marked as preview-only, and must be ignored.\n@@ -204,1 +199,1 @@\n-                } catch (InvalidTreeException err) {\n+                } catch (InvalidTreeException ex) {\n@@ -207,1 +202,1 @@\n-                    System.err.println(err.getMessage());\n+                    System.err.println(ex.getMessage());\n@@ -261,1 +256,1 @@\n-            ModuleReference emptyRef = ModuleReference.forEmptyPackageIn(modName, isPreviewPath);\n+            ModuleReference emptyRef = ModuleReference.forEmptyPackage(modName, isPreviewPath);\n@@ -274,1 +269,1 @@\n-                ModuleReference resourceRef = ModuleReference.forPackageIn(modName, isPreviewPath);\n+                ModuleReference resourceRef = ModuleReference.forPackage(modName, isPreviewPath);\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/ImageResourcesTree.java","additions":6,"deletions":11,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/ImageStringsWriter.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -54,2 +54,0 @@\n-import jdk.internal.jimage.ResourceEntries;\n-import jdk.internal.jimage.SystemImageReader;\n@@ -68,0 +66,1 @@\n+\n@@ -70,1 +69,1 @@\n-    private final ResourceEntries imageResources;\n+    private final ModuleReference ref;\n@@ -103,5 +102,6 @@\n-        ModuleFinder.ofSystem()\n-                .find(module)\n-                .orElseThrow(() -> new IllegalArgumentException(\n-                        \"Module \" + module + \" not part of the JDK install\"));\n-        this.imageResources = SystemImageReader.get().getResourceEntries();\n+        this.ref = ModuleFinder.ofSystem()\n+                               .find(module)\n+                               .orElseThrow(() ->\n+                                    new IllegalArgumentException(\n+                                            \"Module \" + module +\n+                                            \" not part of the JDK install\"));\n@@ -162,11 +162,0 @@\n-    private boolean isNormalOrModifiedDiff(String name) {\n-        ResourceDiff rd = resDiff.get(name);\n-        \/\/ Filter all resources with a resource diff of kind MODIFIED.\n-        \/\/ Note that REMOVED won't happen since in that case the module listing\n-        \/\/ won't have the resource anyway.\n-        \/\/ Note as well that filter removes files of kind ADDED. Those files are\n-        \/\/ not in the packaged modules, so ought not to get returned from the\n-        \/\/ pipeline.\n-        return (rd == null || rd.getKind() == ResourceDiff.Kind.MODIFIED);\n-    }\n-\n@@ -176,1 +165,0 @@\n-\n@@ -179,6 +167,25 @@\n-            imageResources.entryNamesIn(module)\n-                    .filter(this::isNormalOrModifiedDiff)\n-                    .sorted()\n-                    .map(name -> new JrtModuleFile(this, name, resDiff.get(name)))\n-                    .forEach(files::add);\n-\n+            files.addAll(ref.open().list()\n+                                   .filter(i -> {\n+                                           String lookupKey = String.format(\"\/%s\/%s\", module, i);\n+                                           ResourceDiff rd = resDiff.get(lookupKey);\n+                                           \/\/ Filter all resources with a resource diff\n+                                           \/\/ that are of kind MODIFIED.\n+                                           \/\/ Note that REMOVED won't happen since in\n+                                           \/\/ that case the module listing won't have\n+                                           \/\/ the resource anyway.\n+                                           \/\/ Note as well that filter removes files\n+                                           \/\/ of kind ADDED. Those files are not in\n+                                           \/\/ the packaged modules, so ought not to\n+                                           \/\/ get returned from the pipeline.\n+                                           return (rd == null ||\n+                                                   rd.getKind() == ResourceDiff.Kind.MODIFIED);\n+                                   })\n+                                   .map(s -> {\n+                                           String lookupKey = String.format(\"\/%s\/%s\", module, s);\n+                                           return new JRTArchiveFile(JRTArchive.this, s,\n+                                                           EntryType.CLASS_OR_RESOURCE,\n+                                                           null \/* hashOrTarget *\/,\n+                                                           false \/* symlink *\/,\n+                                                           resDiff.get(lookupKey));\n+                                   })\n+                                   .toList());\n@@ -188,3 +195,13 @@\n-                    .filter(rd -> rd.getKind() == ResourceDiff.Kind.REMOVED)\n-                    .map(rd -> new JrtModuleFile(this, rd.getName(), rd))\n-                    .toList());\n+                                         .filter(rd -> rd.getKind() == ResourceDiff.Kind.REMOVED)\n+                                         .map(s -> {\n+                                                 int secondSlash = s.getName().indexOf(\"\/\", 1);\n+                                                 assert secondSlash != -1;\n+                                                 String pathWithoutModule = s.getName().substring(secondSlash + 1);\n+                                                 return new JRTArchiveFile(JRTArchive.this,\n+                                                         pathWithoutModule,\n+                                                         EntryType.CLASS_OR_RESOURCE,\n+                                                         null  \/* hashOrTarget *\/,\n+                                                         false \/* symlink *\/,\n+                                                         s);\n+                                         })\n+                                         .toList());\n@@ -220,4 +237,9 @@\n-                        return new JrtOtherFile(\n-                                this, m.resPath, toEntryType(m.resType), m.hashOrTarget, m.symlink);\n-                    })\n-                    .toList());\n+                        return new JRTArchiveFile(JRTArchive.this,\n+                                                  m.resPath,\n+                                                  toEntryType(m.resType),\n+                                                  m.hashOrTarget,\n+                                                  m.symlink,\n+                                                  \/* diff only for resources *\/\n+                                                  null);\n+                 })\n+                 .toList());\n@@ -305,1 +327,1 @@\n-         *  line: {@code <int>|<int>|<hashOrTarget>|<path>}\n+         *  line: <int>|<int>|<hashOrTarget>|<path>\n@@ -307,1 +329,1 @@\n-         *  <p>Take the integer before {@code '|'} convert it to a Type. The second\n+         *  Take the integer before '|' convert it to a Type. The second\n@@ -418,55 +440,6 @@\n-    record JrtModuleFile(\n-            JRTArchive archive,\n-            String resPath,\n-            ResourceDiff diff) implements JRTFile {\n-        @Override\n-        public Entry toEntry() {\n-            assert resPath.startsWith(\"\/\" + archive.moduleName() + \"\/\");\n-            String resName = resPath.substring(archive.moduleName().length() + 2);\n-\n-            \/\/ If the resource has a diff to the packaged modules, use the diff.\n-            \/\/ Diffs of kind ADDED have been filtered out in collectFiles();\n-            if (diff != null) {\n-                assert diff.getKind() != ResourceDiff.Kind.ADDED;\n-                assert diff.getName().equals(resPath);\n-\n-                return new Entry(archive, resPath, resName, EntryType.CLASS_OR_RESOURCE) {\n-                    @Override\n-                    public long size() {\n-                        return diff.getResourceBytes().length;\n-                    }\n-                    @Override\n-                    public InputStream stream() {\n-                        return new ByteArrayInputStream(diff.getResourceBytes());\n-                    }\n-                };\n-            } else {\n-                return new Entry(archive, resPath, resName, EntryType.CLASS_OR_RESOURCE) {\n-                    @Override\n-                    public long size() {\n-                        return archive.imageResources.sizeOf(path());\n-                    }\n-\n-                    @Override\n-                    public InputStream stream() {\n-                        return archive.imageResources.open(path());\n-                    }\n-                };\n-            }\n-        }\n-    }\n-\n-    record JrtOtherFile(\n-            JRTArchive archive,\n-            String resPath,\n-            EntryType resType,\n-            String sha,\n-            boolean symlink) implements JRTFile {\n-\n-        \/\/ Read from the base JDK image, special casing\n-        \/\/ symlinks, which have the link target in the\n-        \/\/ hashOrTarget field.\n-        Path targetPath() {\n-            return BASE.resolve(symlink ? sha : resPath);\n-        }\n-\n+    record JRTArchiveFile(Archive archive,\n+                          String resPath,\n+                          EntryType resType,\n+                          String sha,\n+                          boolean symlink,\n+                          ResourceDiff diff) implements JRTFile {\n@@ -474,8 +447,6 @@\n-            assert resType != EntryType.CLASS_OR_RESOURCE;\n-\n-            return new Entry(\n-                    archive,\n-                    String.format(\"\/%s\/%s\", archive.moduleName(), resPath),\n-                    resPath,\n-                    resType) {\n-\n+            return new Entry(archive,\n+                             String.format(\"\/%s\/%s\",\n+                                           archive.moduleName(),\n+                                           resPath),\n+                             resPath,\n+                             resType) {\n@@ -485,1 +456,25 @@\n-                        return Files.size(targetPath());\n+                        if (resType != EntryType.CLASS_OR_RESOURCE) {\n+                            \/\/ Read from the base JDK image, special casing\n+                            \/\/ symlinks, which have the link target in the\n+                            \/\/ hashOrTarget field\n+                            if (symlink) {\n+                                return Files.size(BASE.resolve(sha));\n+                            }\n+                            return Files.size(BASE.resolve(resPath));\n+                        } else {\n+                            if (diff != null) {\n+                                \/\/ If the resource has a diff to the\n+                                \/\/ packaged modules, use the diff. Diffs of kind\n+                                \/\/ ADDED have been filtered out in collectFiles();\n+                                assert diff.getKind() != ResourceDiff.Kind.ADDED;\n+                                assert diff.getName().equals(String.format(\"\/%s\/%s\",\n+                                                                           archive.moduleName(),\n+                                                                           resPath));\n+                                return diff.getResourceBytes().length;\n+                            }\n+                            \/\/ Read from the module image. This works, because\n+                            \/\/ the underlying base path is a JrtPath with the\n+                            \/\/ JrtFileSystem underneath which is able to handle\n+                            \/\/ this size query.\n+                            return Files.size(archive.getPath().resolve(resPath));\n+                        }\n@@ -493,1 +488,20 @@\n-                    return Files.newInputStream(targetPath());\n+                    if (resType != EntryType.CLASS_OR_RESOURCE) {\n+                        \/\/ Read from the base JDK image.\n+                        Path path = symlink ? BASE.resolve(sha) : BASE.resolve(resPath);\n+                        return Files.newInputStream(path);\n+                    } else {\n+                        \/\/ Read from the module image. Use the diff to the\n+                        \/\/ packaged modules if we have one. Diffs of kind\n+                        \/\/ ADDED have been filtered out in collectFiles();\n+                        if (diff != null) {\n+                            assert diff.getKind() != ResourceDiff.Kind.ADDED;\n+                            assert diff.getName().equals(String.format(\"\/%s\/%s\",\n+                                                                       archive.moduleName(),\n+                                                                       resPath));\n+                            return new ByteArrayInputStream(diff.getResourceBytes());\n+                        }\n+                        String module = archive.moduleName();\n+                        ModuleReference mRef = ModuleFinder.ofSystem()\n+                                                    .find(module).orElseThrow();\n+                        return mRef.open().open(resPath).orElseThrow();\n+                    }\n@@ -495,0 +509,1 @@\n+\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/JRTArchive.java","additions":115,"deletions":100,"binary":false,"changes":215,"status":"modified"},{"patch":"@@ -352,16 +352,15 @@\n-        try (ImageHelper imageProvider =\n-                     createImageProvider(config,\n-                             null,\n-                             IGNORE_SIGNING_DEFAULT,\n-                             false,\n-                             null,\n-                             false,\n-                             new OptionsValues(),\n-                             null)) {\n-\n-            \/\/ Then create the Plugin Stack\n-            ImagePluginStack stack = ImagePluginConfiguration.parseConfiguration(plugins);\n-\n-            \/\/Ask the stack to proceed;\n-            stack.operate(imageProvider);\n-        }\n+        ImageProvider imageProvider =\n+                createImageProvider(config,\n+                                    null,\n+                                    IGNORE_SIGNING_DEFAULT,\n+                                    false,\n+                                    null,\n+                                    false,\n+                                    new OptionsValues(),\n+                                    null);\n+\n+        \/\/ Then create the Plugin Stack\n+        ImagePluginStack stack = ImagePluginConfiguration.parseConfiguration(plugins);\n+\n+        \/\/Ask the stack to proceed;\n+        stack.operate(imageProvider);\n@@ -490,19 +489,16 @@\n-        try (ImageHelper imageProvider = createImageProvider(config,\n-                options.packagedModulesPath,\n-                options.ignoreSigning,\n-                options.bindServices,\n-                options.endian,\n-                options.verbose,\n-                options,\n-                log)) {\n-            \/\/ Then create the Plugin Stack\n-            ImagePluginStack stack = ImagePluginConfiguration.parseConfiguration(\n-                    taskHelper.getPluginsConfig(\n-                            options.output,\n-                            options.launchers,\n-                            imageProvider.targetPlatform));\n-\n-            \/\/Ask the stack to proceed\n-            stack.operate(imageProvider);\n-        }\n-\n+        ImageHelper imageProvider = createImageProvider(config,\n+                                                        options.packagedModulesPath,\n+                                                        options.ignoreSigning,\n+                                                        options.bindServices,\n+                                                        options.endian,\n+                                                        options.verbose,\n+                                                        options,\n+                                                        log);\n+\n+        \/\/ Then create the Plugin Stack\n+        ImagePluginStack stack = ImagePluginConfiguration.parseConfiguration(\n+            taskHelper.getPluginsConfig(options.output, options.launchers,\n+                    imageProvider.targetPlatform));\n+\n+        \/\/Ask the stack to proceed\n+        stack.operate(imageProvider);\n@@ -1034,5 +1030,4 @@\n-    private record ImageHelper(Set<Archive> archives,\n-                               Platform targetPlatform,\n-                               Path packagedModulesPath,\n-                               boolean generateRuntimeImage)\n-            implements ImageProvider, AutoCloseable {\n+    private static record ImageHelper(Set<Archive> archives,\n+                                      Platform targetPlatform,\n+                                      Path packagedModulesPath,\n+                                      boolean generateRuntimeImage) implements ImageProvider {\n@@ -1054,7 +1049,0 @@\n-\n-        @Override\n-        public void close() throws IOException {\n-            for (Archive archive : archives) {\n-                archive.close();\n-            }\n-        }\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/JlinkTask.java","additions":35,"deletions":47,"binary":false,"changes":82,"status":"modified"},{"patch":"@@ -69,0 +69,13 @@\n+    \/**\n+     * Returns true if a resource is located in a named package.\n+     *\/\n+    public static boolean isNamedPackageResource(String name) {\n+        int index = name.lastIndexOf(\"\/\");\n+        if (index == -1) {\n+            return false;\n+        } else {\n+            String pn = name.substring(0, index).replace('\/', '.');\n+            return Checks.isPackageName(pn);\n+        }\n+    }\n+\n@@ -70,1 +83,0 @@\n-        private static final String PREVIEW_PREFIX = \"META-INF\/preview\/\";\n@@ -123,2 +135,10 @@\n-                    .filter(m -> m.type() == ResourcePoolEntry.Type.CLASS_OR_RESOURCE)\n-                    .forEach(res -> inferPackageName(res).ifPresent(pkgs::add));\n+                .filter(m -> m.type() == ResourcePoolEntry.Type.CLASS_OR_RESOURCE)\n+                .forEach(res -> {\n+                    String name = ImageFileCreator.resourceName(res.path());\n+                    if (isNamedPackageResource(name)) {\n+                        String pkg = ImageFileCreator.toPackage(name);\n+                        if (!pkg.isEmpty()) {\n+                            pkgs.add(pkg);\n+                        }\n+                    }\n+                });\n@@ -142,33 +162,0 @@\n-\n-        \/**\n-         * Returns a valid non-empty package name, inferred from a resource pool\n-         * entry's path.\n-         *\n-         * <p>If the resource pool entry is for a preview resource (i.e. with\n-         * path {@code \"\/mod-name\/META-INF\/preview\/pkg-path\/resource-name\"})\n-         * the package name is the non-preview name based on {@code \"pkg-path\"}.\n-         *\n-         * @return the inferred package name, or {@link Optional#empty() empty}\n-         *     if no name could be inferred.\n-         *\/\n-        private static Optional<String> inferPackageName(ResourcePoolEntry res) {\n-            \/\/ Expect entry paths to be \"\/mod-name\/pkg-path\/resource-name\", but\n-            \/\/ may also get \"\/mod-name\/META-INF\/preview\/pkg-path\/resource-name\"\n-            String name = res.path();\n-            if (name.charAt(0) == '\/') {\n-                int pkgStart = name.indexOf('\/', 1) + 1;\n-                int pkgEnd = name.lastIndexOf('\/');\n-                if (pkgStart > 0 && pkgEnd > pkgStart) {\n-                    String pkgPath = name.substring(pkgStart, pkgEnd);\n-                    \/\/ Handle preview paths by removing the prefix.\n-                    if (pkgPath.startsWith(PREVIEW_PREFIX)) {\n-                        pkgPath = pkgPath.substring(PREVIEW_PREFIX.length());\n-                    }\n-                    String pkgName = pkgPath.replace('\/', '.');\n-                    if (Checks.isPackageName(pkgName)) {\n-                        return Optional.of(pkgName);\n-                    }\n-                }\n-            }\n-            return Optional.empty();\n-        }\n","filename":"src\/jdk.jlink\/share\/classes\/jdk\/tools\/jlink\/internal\/ResourcePoolManager.java","additions":23,"deletions":36,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -82,1 +82,2 @@\n-    static value class MyInt {\n+    static value\n+    class MyInt {\n@@ -343,1 +344,1 @@\n-        MyInt[] src = (MyInt[])ValueClass.newNullableAtomicArray(MyInt.class, len);\n+        MyInt[] src = (MyInt[]) ValueClass.newNullableAtomicArray(MyInt.class, len);\n@@ -362,1 +363,1 @@\n-        MyInt[] src = (MyInt[])ValueClass.newNullableAtomicArray(MyInt.class, len);\n+        MyInt[] src = (MyInt[]) ValueClass.newNullableAtomicArray(MyInt.class, len);\n@@ -383,1 +384,1 @@\n-        MyInt[] src = (MyInt[])ValueClass.newNullableAtomicArray(MyInt.class, len);\n+        MyInt[] src = (MyInt[]) ValueClass.newNullableAtomicArray(MyInt.class, len);\n@@ -403,1 +404,1 @@\n-        MyInt[] src = (MyInt[])ValueClass.newNullableAtomicArray(MyInt.class, len);\n+        MyInt[] src = (MyInt[]) ValueClass.newNullableAtomicArray(MyInt.class, len);\n@@ -424,1 +425,1 @@\n-        MyInt[] src = (MyInt[])ValueClass.newNullableAtomicArray(MyInt.class, len);\n+        MyInt[] src = (MyInt[]) ValueClass.newNullableAtomicArray(MyInt.class, len);\n@@ -444,1 +445,1 @@\n-        MyInt[] src = (MyInt[])ValueClass.newNullableAtomicArray(MyInt.class, len);\n+        MyInt[] src = (MyInt[]) ValueClass.newNullableAtomicArray(MyInt.class, len);\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestArrayCopy.java","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -155,3 +155,3 @@\n-                   .addScenarios(scenarios[Integer.parseInt(args[0])])\n-                   .addHelperClasses(MyValue1.class, MyValue2.class, MyValue2Inline.class)\n-                   .start();\n+                .addScenarios(scenarios[Integer.parseInt(args[0])])\n+                .addHelperClasses(MyValue1.class, MyValue2.class, MyValue2Inline.class)\n+                .start();\n@@ -192,1 +192,2 @@\n-    static value class NotFlattenable {\n+    static value\n+    class NotFlattenable {\n@@ -206,1 +207,1 @@\n-        counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"})\n+            counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"})\n@@ -208,2 +209,2 @@\n-        counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"},\n-        failOn = {LOAD_OF_ANY_KLASS})\n+            counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"},\n+            failOn = {LOAD_OF_ANY_KLASS})\n@@ -211,1 +212,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -231,1 +232,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -257,1 +258,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n@@ -281,1 +282,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n@@ -296,1 +297,1 @@\n-            va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 5, MyValue1.DEFAULT);\n+            va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 5, MyValue1.DEFAULT);\n@@ -301,1 +302,1 @@\n-            va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n+            va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n@@ -335,1 +336,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -341,1 +342,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -350,1 +351,1 @@\n-        return (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        return (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -356,1 +357,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -367,1 +368,1 @@\n-        return (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT);\n+        return (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT);\n@@ -387,1 +388,1 @@\n-        test9_va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        test9_va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -400,1 +401,1 @@\n-                    arr[i][j][k] = MyValue1.createWithFieldsDontInline(rI + i , rL + j + k);\n+                    arr[i][j][k] = MyValue1.createWithFieldsDontInline(rI + i, rL + j + k);\n@@ -413,1 +414,1 @@\n-                    Asserts.assertEQ(arr[i][j][k].hash(), MyValue1.createWithFieldsDontInline(rI + i , rL + j + k).hash());\n+                    Asserts.assertEQ(arr[i][j][k].hash(), MyValue1.createWithFieldsDontInline(rI + i, rL + j + k).hash());\n@@ -435,2 +436,2 @@\n-        long[] res = new long[2*3*4];\n-        long[] verif = new long[2*3*4];\n+        long[] res = new long[2 * 3 * 4];\n+        long[] verif = new long[2 * 3 * 4];\n@@ -457,1 +458,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n@@ -479,1 +480,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n@@ -499,1 +500,1 @@\n-    public int test14(MyValue1[] va, int index)  {\n+    public int test14(MyValue1[] va, int index) {\n@@ -506,1 +507,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n@@ -527,1 +528,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n@@ -548,1 +549,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n@@ -567,1 +568,1 @@\n-    public int test17(MyValue1[] va, int index, MyValue1 vt)  {\n+    public int test17(MyValue1[] va, int index, MyValue1 vt) {\n@@ -575,1 +576,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, arraySize, MyValue1.DEFAULT);\n@@ -606,1 +607,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -621,1 +622,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -647,2 +648,2 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -667,2 +668,2 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -670,1 +671,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -682,1 +683,1 @@\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, src.length, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, src.length, MyValue1.DEFAULT);\n@@ -690,1 +691,1 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -704,1 +705,1 @@\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, src.length + 10, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, src.length + 10, MyValue1.DEFAULT);\n@@ -712,1 +713,1 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -731,2 +732,2 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n-        MyValue1[] dst1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] dst1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -743,1 +744,1 @@\n-            Asserts.assertEQ(src[i].hash(), ((MyValue1)dst2[i]).hash());\n+            Asserts.assertEQ(src[i].hash(), ((MyValue1) dst2[i]).hash());\n@@ -755,2 +756,2 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -758,1 +759,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -774,2 +775,2 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -793,2 +794,2 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -800,1 +801,1 @@\n-            Asserts.assertEQ(src[i-1].hash(), dst[i].hash());\n+            Asserts.assertEQ(src[i - 1].hash(), dst[i].hash());\n@@ -808,1 +809,1 @@\n-        failOn = {ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, LOAD_OF_ANY_KLASS, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n+            failOn = {ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, LOAD_OF_ANY_KLASS, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n@@ -810,1 +811,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -812,1 +813,1 @@\n-        MyValue2[] dst = (MyValue2[])src.clone();\n+        MyValue2[] dst = (MyValue2[]) src.clone();\n@@ -828,1 +829,1 @@\n-        failOn = {ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, LOAD_OF_ANY_KLASS, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n+            failOn = {ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, LOAD_OF_ANY_KLASS, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n@@ -830,1 +831,1 @@\n-        failOn = {ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n+            failOn = {ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n@@ -832,1 +833,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -839,1 +840,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -841,1 +842,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -851,1 +852,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -853,1 +854,1 @@\n-        if (flag) { }\n+        if (flag) {}\n@@ -860,1 +861,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -862,1 +863,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -873,1 +874,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 1, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 1, MyValue2.DEFAULT);\n@@ -877,1 +878,1 @@\n-            src[0] = MyValue2.createWithFieldsInline(rI+1, rD+1);\n+            src[0] = MyValue2.createWithFieldsInline(rI + 1, rD + 1);\n@@ -906,1 +907,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -910,1 +911,1 @@\n-        MyValue1[] result = (MyValue1[])test32(va);\n+        MyValue1[] result = (MyValue1[]) test32(va);\n@@ -912,1 +913,1 @@\n-            Asserts.assertEQ(((MyValue1)result[i]).hash(), ((MyValue1)va[i]).hash());\n+            Asserts.assertEQ(((MyValue1) result[i]).hash(), ((MyValue1) va[i]).hash());\n@@ -930,1 +931,1 @@\n-            Asserts.assertEQ(((MyValue1)result[i]).hash(), ((MyValue1)va[i]).hash());\n+            Asserts.assertEQ(((MyValue1) result[i]).hash(), ((MyValue1) va[i]).hash());\n@@ -943,1 +944,1 @@\n-            va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+            va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -996,2 +997,2 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n-        MyValue1[] dst1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] dst1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1020,2 +1021,2 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -1023,1 +1024,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1041,2 +1042,2 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -1044,1 +1045,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1064,1 +1065,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -1066,1 +1067,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1088,1 +1089,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -1091,1 +1092,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1111,1 +1112,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -1113,1 +1114,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1135,1 +1136,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -1138,1 +1139,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1159,1 +1160,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1176,2 +1177,2 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -1196,2 +1197,2 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -1199,1 +1200,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1216,2 +1217,2 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -1219,1 +1220,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1238,1 +1239,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -1240,1 +1241,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1261,1 +1262,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -1264,1 +1265,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1283,1 +1284,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -1285,1 +1286,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1306,1 +1307,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -1309,1 +1310,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1329,1 +1330,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1348,1 +1349,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1356,1 +1357,1 @@\n-    static final MyValue1[] test52_va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+    static final MyValue1[] test52_va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -1382,1 +1383,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1398,1 +1399,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1414,1 +1415,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1447,1 +1448,1 @@\n-        Object[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        Object[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1463,1 +1464,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1479,1 +1480,1 @@\n-        return Arrays.copyOf(va, va.length+1, va.getClass());\n+        return Arrays.copyOf(va, va.length + 1, va.getClass());\n@@ -1485,2 +1486,2 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullableAtomicArray(MyValue1.class, len);\n-        MyValue1[] verif = (MyValue1[])ValueClass.newNullableAtomicArray(MyValue1.class, len + 1);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullableAtomicArray(MyValue1.class, len);\n+        MyValue1[] verif = (MyValue1[]) ValueClass.newNullableAtomicArray(MyValue1.class, len + 1);\n@@ -1497,1 +1498,1 @@\n-        return Arrays.copyOf(va, va.length+1, klass);\n+        return Arrays.copyOf(va, va.length + 1, klass);\n@@ -1503,2 +1504,2 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullableAtomicArray(MyValue1.class, len);\n-        MyValue1[] verif = (MyValue1[])ValueClass.newNullableAtomicArray(MyValue1.class, len + 1);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullableAtomicArray(MyValue1.class, len);\n+        MyValue1[] verif = (MyValue1[]) ValueClass.newNullableAtomicArray(MyValue1.class, len + 1);\n@@ -1507,1 +1508,1 @@\n-            verif[i] = (MyValue1)va[i];\n+            verif[i] = (MyValue1) va[i];\n@@ -1515,1 +1516,1 @@\n-        return Arrays.copyOf(va, va.length+1, klass);\n+        return Arrays.copyOf(va, va.length + 1, klass);\n@@ -1545,1 +1546,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -1549,1 +1550,1 @@\n-        return Arrays.copyOf(arr, arr.length+1, arr.getClass());\n+        return Arrays.copyOf(arr, arr.length + 1, arr.getClass());\n@@ -1555,1 +1556,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1581,1 +1582,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -1585,1 +1586,1 @@\n-        return Arrays.copyOf(arr, arr.length+1, arr.getClass());\n+        return Arrays.copyOf(arr, arr.length + 1, arr.getClass());\n@@ -1591,2 +1592,2 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullableAtomicArray(MyValue1.class, len);\n-        MyValue1[] verif = (MyValue1[])ValueClass.newNullableAtomicArray(MyValue1.class, len + 1);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullableAtomicArray(MyValue1.class, len);\n+        MyValue1[] verif = (MyValue1[]) ValueClass.newNullableAtomicArray(MyValue1.class, len + 1);\n@@ -1606,1 +1607,1 @@\n-        return (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        return (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -1611,1 +1612,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -1621,1 +1622,1 @@\n-        return (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 32, MyValue1.DEFAULT);\n+        return (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 32, MyValue1.DEFAULT);\n@@ -1626,1 +1627,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 32, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 32, MyValue1.DEFAULT);\n@@ -1637,1 +1638,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -1652,1 +1653,1 @@\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 16, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 16, MyValue1.DEFAULT);\n@@ -1659,1 +1660,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 16, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 16, MyValue1.DEFAULT);\n@@ -1669,1 +1670,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -1676,1 +1677,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -1686,1 +1687,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 4, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 4, MyValue1.DEFAULT);\n@@ -1695,1 +1696,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 4, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 4, MyValue1.DEFAULT);\n@@ -1708,1 +1709,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -1716,1 +1717,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -1727,2 +1728,2 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -1730,1 +1731,1 @@\n-            src[i] = MyValue2.createWithFieldsDontInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsDontInline(rI + i, rD + i);\n@@ -1777,2 +1778,2 @@\n-        MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI+1, rL+1);\n-        MyValue1[] arr = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 3, MyValue1.DEFAULT);\n+        MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI + 1, rL + 1);\n+        MyValue1[] arr = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 3, MyValue1.DEFAULT);\n@@ -1790,1 +1791,1 @@\n-    public static void test74Callee(MyValue1[] va) { }\n+    public static void test74Callee(MyValue1[] va) {}\n@@ -1802,1 +1803,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT);\n@@ -1821,1 +1822,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -1830,1 +1831,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1859,1 +1860,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -1868,2 +1869,2 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n-        MyValue1[] verif = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] verif = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1892,2 +1893,2 @@\n-        MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI+1, rL+1);\n-        MyValue1[] arr = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI + 1, rL + 1);\n+        MyValue1[] arr = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -1916,1 +1917,1 @@\n-        MyValue1[] a = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, n, MyValue1.DEFAULT);\n+        MyValue1[] a = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, n, MyValue1.DEFAULT);\n@@ -1918,1 +1919,1 @@\n-        for (int i = 0; i<n; i++) {\n+        for (int i = 0; i < n; i++) {\n@@ -1934,1 +1935,1 @@\n-        counts = {LOAD_UNKNOWN_INLINE, \"= 1\"})\n+            counts = {LOAD_UNKNOWN_INLINE, \"= 1\"})\n@@ -1936,1 +1937,1 @@\n-        failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE})\n+            failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE})\n@@ -1938,1 +1939,1 @@\n-        NonValueClass i1 = (NonValueClass)array[0];\n+        NonValueClass i1 = (NonValueClass) array[0];\n@@ -1955,1 +1956,1 @@\n-        counts = {LOAD_UNKNOWN_INLINE, \"= 1\"})\n+            counts = {LOAD_UNKNOWN_INLINE, \"= 1\"})\n@@ -1957,1 +1958,1 @@\n-        failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE})\n+            failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE})\n@@ -1959,1 +1960,1 @@\n-        NotFlattenable vt = (NotFlattenable)array[0];\n+        NotFlattenable vt = (NotFlattenable) array[0];\n@@ -1967,1 +1968,1 @@\n-        NotFlattenable[] array = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n+        NotFlattenable[] array = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n@@ -1978,1 +1979,1 @@\n-          return null;\n+            return null;\n@@ -2006,1 +2007,1 @@\n-        failOn = {ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE})\n+            failOn = {ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE})\n@@ -2008,1 +2009,1 @@\n-        failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE})\n+            failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE})\n@@ -2019,1 +2020,1 @@\n-        NotFlattenable[] array1 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 3, NotFlattenable.DEFAULT);\n+        NotFlattenable[] array1 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 3, NotFlattenable.DEFAULT);\n@@ -2036,2 +2037,2 @@\n-        counts = {LOAD_UNKNOWN_INLINE, \"= 1\"},\n-        failOn = {ALLOC_ARRAY, STORE_UNKNOWN_INLINE, INLINE_ARRAY_NULL_GUARD})\n+            counts = {LOAD_UNKNOWN_INLINE, \"= 1\"},\n+            failOn = {ALLOC_ARRAY, STORE_UNKNOWN_INLINE, INLINE_ARRAY_NULL_GUARD})\n@@ -2041,1 +2042,1 @@\n-        NonValueClass i = (NonValueClass)array[0];\n+        NonValueClass i = (NonValueClass) array[0];\n@@ -2059,4 +2060,4 @@\n-        failOn = {ALLOC, ALLOC_ARRAY},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 1\", \/\/ Null check on first store, no check on second store\n-                  STORE_UNKNOWN_INLINE, \"= 2\",\n-                  LOAD_UNKNOWN_INLINE, \"= 1\"})\n+            failOn = {ALLOC, ALLOC_ARRAY},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 1\", \/\/ Null check on first store, no check on second store\n+                    STORE_UNKNOWN_INLINE, \"= 2\",\n+                    LOAD_UNKNOWN_INLINE, \"= 1\"})\n@@ -2064,2 +2065,3 @@\n-        failOn = {ALLOC, ALLOC_ARRAY, STORE_UNKNOWN_INLINE, LOAD_UNKNOWN_INLINE},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 1\"}) \/\/ Null check on first store, no check on second store\n+            failOn = {ALLOC, ALLOC_ARRAY, STORE_UNKNOWN_INLINE, LOAD_UNKNOWN_INLINE},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 1\"})\n+    \/\/ Null check on first store, no check on second store\n@@ -2083,1 +2085,1 @@\n-            NotFlattenable[] array3 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n+            NotFlattenable[] array3 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n@@ -2096,3 +2098,3 @@\n-        failOn = {ALLOC, ALLOC_ARRAY},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\",\n-                  STORE_UNKNOWN_INLINE, \"<= 3\"})\n+            failOn = {ALLOC, ALLOC_ARRAY},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\",\n+                    STORE_UNKNOWN_INLINE, \"<= 3\"})\n@@ -2100,2 +2102,2 @@\n-        failOn = {ALLOC, ALLOC_ARRAY, STORE_UNKNOWN_INLINE, LOAD_UNKNOWN_INLINE},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\"})\n+            failOn = {ALLOC, ALLOC_ARRAY, STORE_UNKNOWN_INLINE, LOAD_UNKNOWN_INLINE},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\"})\n@@ -2125,1 +2127,1 @@\n-            NotFlattenable[] array3 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n+            NotFlattenable[] array3 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n@@ -2138,2 +2140,2 @@\n-        failOn = {ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\", ALLOC, \"= 1\"})\n+            failOn = {ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\", ALLOC, \"= 1\"})\n@@ -2141,2 +2143,2 @@\n-        failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\"})\n+            failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\"})\n@@ -2161,1 +2163,1 @@\n-            NotFlattenable[] array2 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n+            NotFlattenable[] array2 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 2, NotFlattenable.DEFAULT);\n@@ -2174,2 +2176,2 @@\n-        failOn = {ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\", ALLOC, \"= 1\"})\n+            failOn = {ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\", ALLOC, \"= 1\"})\n@@ -2177,2 +2179,2 @@\n-        failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n-        counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\"})\n+            failOn = {ALLOC, ALLOC_ARRAY, LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE},\n+            counts = {INLINE_ARRAY_NULL_GUARD, \"= 2\"})\n@@ -2197,1 +2199,1 @@\n-            MyValue1[] array2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+            MyValue1[] array2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2222,1 +2224,1 @@\n-            MyValue1[] array3 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+            MyValue1[] array3 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2235,1 +2237,1 @@\n-        array[0] = (MyValue1)o;\n+        array[0] = (MyValue1) o;\n@@ -2244,1 +2246,1 @@\n-            MyValue1[] array2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+            MyValue1[] array2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2258,1 +2260,1 @@\n-        MyValue1[] qArray = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT);\n+        MyValue1[] qArray = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT);\n@@ -2264,1 +2266,1 @@\n-        MyValue1[][] qArray2 = { (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT) };\n+        MyValue1[][] qArray2 = {(MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 0, MyValue1.DEFAULT)};\n@@ -2279,1 +2281,2 @@\n-    static value class Test91Value {\n+    static value\n+    class Test91Value {\n@@ -2318,1 +2321,1 @@\n-        Test91Value[] array = (Test91Value[])ValueClass.newNullRestrictedNonAtomicArray(Test91Value.class, 5, new Test91Value(0));\n+        Test91Value[] array = (Test91Value[]) ValueClass.newNullRestrictedNonAtomicArray(Test91Value.class, 5, new Test91Value(0));\n@@ -2336,2 +2339,2 @@\n-        MyValue1[] a = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n-        MyValue1[] b = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] a = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] b = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2356,1 +2359,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -2358,1 +2361,1 @@\n-        if (flag) {  }\n+        if (flag) {}\n@@ -2360,1 +2363,1 @@\n-               dst[5].hash() + dst[6].hash() + dst[7].hash() + dst[8].hash() + dst[9].hash();\n+                dst[5].hash() + dst[6].hash() + dst[7].hash() + dst[8].hash() + dst[9].hash();\n@@ -2366,1 +2369,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -2368,1 +2371,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -2381,1 +2384,1 @@\n-        MyValue2[] dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -2383,1 +2386,1 @@\n-        if (flag) {  }\n+        if (flag) {}\n@@ -2385,1 +2388,1 @@\n-               dst[5].hash() + dst[6].hash() + dst[7].hash() + dst[8].hash() + dst[9].hash();\n+                dst[5].hash() + dst[6].hash() + dst[7].hash() + dst[8].hash() + dst[9].hash();\n@@ -2391,1 +2394,1 @@\n-        MyValue2[] src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -2393,1 +2396,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -2397,1 +2400,1 @@\n-            long expected = src[i].hash() + 9*MyValue2.createDefaultInline().hash();\n+            long expected = src[i].hash() + 9 * MyValue2.createDefaultInline().hash();\n@@ -2402,1 +2405,1 @@\n-    static final MyValue1[] nullFreeArray = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+    static final MyValue1[] nullFreeArray = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2413,1 +2416,1 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2439,1 +2442,1 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2468,1 +2471,1 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2501,1 +2504,1 @@\n-        failOn = IRNode.SUBTYPE_CHECK)\n+            failOn = IRNode.SUBTYPE_CHECK)\n@@ -2507,1 +2510,1 @@\n-        return (MyValue1[])array;\n+        return (MyValue1[]) array;\n@@ -2512,2 +2515,2 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n-        NotFlattenable[] array2 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        NotFlattenable[] array2 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n@@ -2533,1 +2536,1 @@\n-        failOn = IRNode.SUBTYPE_CHECK)\n+            failOn = IRNode.SUBTYPE_CHECK)\n@@ -2539,1 +2542,1 @@\n-        MyValue1[] casted = (MyValue1[])array;\n+        MyValue1[] casted = (MyValue1[]) array;\n@@ -2545,2 +2548,2 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n-        NotFlattenable[] array2 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        NotFlattenable[] array2 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n@@ -2566,1 +2569,1 @@\n-        failOn = IRNode.SUBTYPE_CHECK)\n+            failOn = IRNode.SUBTYPE_CHECK)\n@@ -2577,2 +2580,2 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n-        NotFlattenable[] array2 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        NotFlattenable[] array2 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n@@ -2593,1 +2596,1 @@\n-    @IR(counts = { IRNode.SUBTYPE_CHECK, \"1\" })\n+    @IR(counts = {IRNode.SUBTYPE_CHECK, \"1\"})\n@@ -2601,2 +2604,2 @@\n-        NotFlattenable[] array2 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n-        MyValue1[] array3 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        NotFlattenable[] array2 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n+        MyValue1[] array3 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2610,1 +2613,1 @@\n-    @IR(counts = { IRNode.SUBTYPE_CHECK, \"1\" })\n+    @IR(counts = {IRNode.SUBTYPE_CHECK, \"1\"})\n@@ -2618,2 +2621,2 @@\n-        NotFlattenable[] array2 = (NotFlattenable[])ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n-        MyValue1[] array3 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        NotFlattenable[] array2 = (NotFlattenable[]) ValueClass.newNullRestrictedNonAtomicArray(NotFlattenable.class, 1, NotFlattenable.DEFAULT);\n+        MyValue1[] array3 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2633,5 +2636,5 @@\n-    static final MyValue2[] val_src = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n-    static final MyValue2[] val_dst = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n-    static final Object[]   obj_src = new Object[8];\n-    static final Object[]   obj_null_src = new Object[8];\n-    static final Object[]   obj_dst = new Object[8];\n+    static final MyValue2[] val_src = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+    static final MyValue2[] val_dst = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+    static final Object[] obj_src = new Object[8];\n+    static final Object[] obj_null_src = new Object[8];\n+    static final Object[] obj_dst = new Object[8];\n@@ -2640,1 +2643,1 @@\n-    static Object get_val_src() { return val_src; }\n+    static Object get_val_src() {return val_src;}\n@@ -2642,1 +2645,1 @@\n-    static Object get_val_dst() { return val_dst; }\n+    static Object get_val_dst() {return val_dst;}\n@@ -2644,1 +2647,1 @@\n-    static Class get_val_class() { return val_src.getClass(); }\n+    static Class get_val_class() {return val_src.getClass();}\n@@ -2646,1 +2649,1 @@\n-    static Class get_non_val_class() { return NonValueClass[].class; }\n+    static Class get_non_val_class() {return NonValueClass[].class;}\n@@ -2648,1 +2651,1 @@\n-    static Object get_obj_src() { return obj_src; }\n+    static Object get_obj_src() {return obj_src;}\n@@ -2650,1 +2653,1 @@\n-    static Object get_obj_null_src() { return obj_null_src; }\n+    static Object get_obj_null_src() {return obj_null_src;}\n@@ -2652,1 +2655,1 @@\n-    static Object get_obj_dst() { return obj_dst; }\n+    static Object get_obj_dst() {return obj_dst;}\n@@ -2654,1 +2657,1 @@\n-    static Class get_obj_class() { return Object[].class; }\n+    static Class get_obj_class() {return Object[].class;}\n@@ -2658,3 +2661,3 @@\n-            val_src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            obj_src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            obj_null_src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            val_src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            obj_src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            obj_null_src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -2668,1 +2671,1 @@\n-        counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n+            counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n@@ -2670,1 +2673,1 @@\n-        failOn = INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP)\n+            failOn = INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP)\n@@ -2742,1 +2745,1 @@\n-        counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n+            counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n@@ -2744,1 +2747,1 @@\n-        failOn = INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP)\n+            failOn = INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP)\n@@ -2759,1 +2762,1 @@\n-        failOn = INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP)\n+            failOn = INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP)\n@@ -2813,1 +2816,1 @@\n-        counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n+            counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n@@ -2815,1 +2818,1 @@\n-        failOn = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, CLASS_CHECK_TRAP})\n+            failOn = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, CLASS_CHECK_TRAP})\n@@ -2883,1 +2886,1 @@\n-        counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n+            counts = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, \"= 1\"})\n@@ -2885,1 +2888,1 @@\n-        failOn = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, CLASS_CHECK_TRAP})\n+            failOn = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, CLASS_CHECK_TRAP})\n@@ -2887,1 +2890,1 @@\n-        return Arrays.copyOf((Object[])get_val_src(), 8, get_obj_class());\n+        return Arrays.copyOf((Object[]) get_val_src(), 8, get_obj_class());\n@@ -2900,1 +2903,1 @@\n-        failOn = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, CLASS_CHECK_TRAP})\n+            failOn = {INTRINSIC_OR_TYPE_CHECKED_INLINING_TRAP, CLASS_CHECK_TRAP})\n@@ -2902,1 +2905,1 @@\n-        return Arrays.copyOf((Object[])get_val_src(), 8, get_val_class());\n+        return Arrays.copyOf((Object[]) get_val_src(), 8, get_val_class());\n@@ -2914,1 +2917,1 @@\n-        return Arrays.copyOf((Object[])get_obj_src(), 8, get_obj_class());\n+        return Arrays.copyOf((Object[]) get_obj_src(), 8, get_obj_class());\n@@ -2927,1 +2930,1 @@\n-        return Arrays.copyOf((Object[])get_obj_src(), 8, val_src2.getClass());\n+        return Arrays.copyOf((Object[]) get_obj_src(), 8, val_src2.getClass());\n@@ -2940,1 +2943,1 @@\n-        return Arrays.copyOf((Object[])get_obj_null_src(), 8, val_src2.getClass());\n+        return Arrays.copyOf((Object[]) get_obj_null_src(), 8, val_src2.getClass());\n@@ -2946,1 +2949,1 @@\n-        verify((Object[])get_obj_null_src(), res);\n+        verify((Object[]) get_obj_null_src(), res);\n@@ -3094,1 +3097,1 @@\n-        verify((Object[])arr, res);\n+        verify((Object[]) arr, res);\n@@ -3118,2 +3121,2 @@\n-        counts = {JLONG_ARRAYCOPY, \"= 1\"},\n-        failOn = {CHECKCAST_ARRAYCOPY, CLONE_INTRINSIC_SLOW_PATH})\n+            counts = {JLONG_ARRAYCOPY, \"= 1\"},\n+            failOn = {CHECKCAST_ARRAYCOPY, CLONE_INTRINSIC_SLOW_PATH})\n@@ -3121,1 +3124,1 @@\n-        failOn = CLONE_INTRINSIC_SLOW_PATH)\n+            failOn = CLONE_INTRINSIC_SLOW_PATH)\n@@ -3154,1 +3157,2 @@\n-    static value class Test127aValue {\n+    static value\n+    class Test127aValue {\n@@ -3167,2 +3171,2 @@\n-    static final Test127aValue[] srcTest127a = (Test127aValue[])ValueClass.newNullRestrictedNonAtomicArray(Test127aValue.class, 8, valueTest127a);\n-    static final Test127aValue[] destTest127a = (Test127aValue[])ValueClass.newNullRestrictedNonAtomicArray(Test127aValue.class, 8, valueTest127a);\n+    static final Test127aValue[] srcTest127a = (Test127aValue[]) ValueClass.newNullRestrictedNonAtomicArray(Test127aValue.class, 8, valueTest127a);\n+    static final Test127aValue[] destTest127a = (Test127aValue[]) ValueClass.newNullRestrictedNonAtomicArray(Test127aValue.class, 8, valueTest127a);\n@@ -3180,1 +3184,1 @@\n-        test127a(0,1, 7);\n+        test127a(0, 1, 7);\n@@ -3199,2 +3203,2 @@\n-        counts = {JLONG_ARRAYCOPY, \"= 1\"},\n-        failOn = CHECKCAST_ARRAYCOPY)\n+            counts = {JLONG_ARRAYCOPY, \"= 1\"},\n+            failOn = CHECKCAST_ARRAYCOPY)\n@@ -3248,1 +3252,1 @@\n-        failOn = {LOAD_OF_ANY_KLASS})\n+            failOn = {LOAD_OF_ANY_KLASS})\n@@ -3256,1 +3260,1 @@\n-        MyValueEmpty[] array = (MyValueEmpty[])ValueClass.newNullRestrictedNonAtomicArray(MyValueEmpty.class, 2, empty);\n+        MyValueEmpty[] array = (MyValueEmpty[]) ValueClass.newNullRestrictedNonAtomicArray(MyValueEmpty.class, 2, empty);\n@@ -3263,1 +3267,2 @@\n-    static value class EmptyContainer {\n+    static value\n+    class EmptyContainer {\n@@ -3279,1 +3284,1 @@\n-        EmptyContainer[] array = (EmptyContainer[])ValueClass.newNullRestrictedNonAtomicArray(EmptyContainer.class, 2, new EmptyContainer());\n+        EmptyContainer[] array = (EmptyContainer[]) ValueClass.newNullRestrictedNonAtomicArray(EmptyContainer.class, 2, new EmptyContainer());\n@@ -3294,1 +3299,1 @@\n-        Object[] array = (MyValueEmpty[])ValueClass.newNullRestrictedNonAtomicArray(MyValueEmpty.class, 2, empty);\n+        Object[] array = (MyValueEmpty[]) ValueClass.newNullRestrictedNonAtomicArray(MyValueEmpty.class, 2, empty);\n@@ -3314,1 +3319,1 @@\n-        Object[] array = (EmptyContainer[])ValueClass.newNullRestrictedNonAtomicArray(EmptyContainer.class, 2, new EmptyContainer());\n+        Object[] array = (EmptyContainer[]) ValueClass.newNullRestrictedNonAtomicArray(EmptyContainer.class, 2, new EmptyContainer());\n@@ -3327,1 +3332,1 @@\n-        failOn = {ALLOC_OF_MYVALUE_KLASS, ALLOC_ARRAY_OF_MYVALUE_KLASS, LOAD_OF_ANY_KLASS, STORE_OF_ANY_KLASS})\n+            failOn = {ALLOC_OF_MYVALUE_KLASS, ALLOC_ARRAY_OF_MYVALUE_KLASS, LOAD_OF_ANY_KLASS, STORE_OF_ANY_KLASS})\n@@ -3349,1 +3354,1 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -3353,1 +3358,1 @@\n-            Asserts.assertEquals(((MyValue1)res).hash(), array1[1].hash());\n+            Asserts.assertEquals(((MyValue1) res).hash(), array1[1].hash());\n@@ -3378,1 +3383,1 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -3381,1 +3386,1 @@\n-        Asserts.assertEquals(((MyValue1)res).hash(), array1[1].hash());\n+        Asserts.assertEquals(((MyValue1) res).hash(), array1[1].hash());\n@@ -3403,1 +3408,1 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 100, MyValue1.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 100, MyValue1.DEFAULT);\n@@ -3446,1 +3451,1 @@\n-        MyValue1[] array1 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 100, MyValue1.DEFAULT);\n+        MyValue1[] array1 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 100, MyValue1.DEFAULT);\n@@ -3468,1 +3473,1 @@\n-                  STORE_UNKNOWN_INLINE, INLINE_ARRAY_NULL_GUARD})\n+            STORE_UNKNOWN_INLINE, INLINE_ARRAY_NULL_GUARD})\n@@ -3470,1 +3475,1 @@\n-        Object[]  array = null;\n+        Object[] array = null;\n@@ -3472,1 +3477,1 @@\n-        Object[] varray = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        Object[] varray = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -3489,1 +3494,1 @@\n-                  LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE, INLINE_ARRAY_NULL_GUARD})\n+            LOAD_UNKNOWN_INLINE, STORE_UNKNOWN_INLINE, INLINE_ARRAY_NULL_GUARD})\n@@ -3491,1 +3496,1 @@\n-        Object[]  array = null;\n+        Object[] array = null;\n@@ -3493,1 +3498,1 @@\n-        Object[] varray = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        Object[] varray = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -3516,1 +3521,1 @@\n-        Object[]  array = null;\n+        Object[] array = null;\n@@ -3518,1 +3523,1 @@\n-        Object[] varray = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        Object[] varray = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -3537,1 +3542,1 @@\n-        Object[]  array = null;\n+        Object[] array = null;\n@@ -3539,1 +3544,1 @@\n-        Object[] varray = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        Object[] varray = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -3567,1 +3572,1 @@\n-        public int hash() { return 42; }\n+        public int hash() {return 42;}\n@@ -3621,2 +3626,2 @@\n-        Object[] array = (EmptyContainer[])ValueClass.newNullRestrictedNonAtomicArray(EmptyContainer.class, 1, new EmptyContainer());\n-        EmptyContainer empty = (EmptyContainer)test145(array);\n+        Object[] array = (EmptyContainer[]) ValueClass.newNullRestrictedNonAtomicArray(EmptyContainer.class, 1, new EmptyContainer());\n+        EmptyContainer empty = (EmptyContainer) test145(array);\n@@ -3631,1 +3636,1 @@\n-        MyValue2[] array = { vt };\n+        MyValue2[] array = {vt};\n@@ -3653,1 +3658,1 @@\n-        MyValue2[] array = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 1, MyValue2.DEFAULT);\n+        MyValue2[] array = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 1, MyValue2.DEFAULT);\n@@ -3684,2 +3689,2 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -3689,1 +3694,1 @@\n-          throw new RuntimeException(\"Unexpected hash\");\n+            throw new RuntimeException(\"Unexpected hash\");\n@@ -3706,1 +3711,2 @@\n-        public int get() { return x; };\n+        public int get() {return x;}\n+        ;\n@@ -3734,1 +3740,2 @@\n-    static value class Test150Value {\n+    static value\n+    class Test150Value {\n@@ -3745,1 +3752,1 @@\n-        Test150Value[] array = (Test150Value[])ValueClass.newNullRestrictedNonAtomicArray(Test150Value.class, 1, new Test150Value(\"test\"));\n+        Test150Value[] array = (Test150Value[]) ValueClass.newNullRestrictedNonAtomicArray(Test150Value.class, 1, new Test150Value(\"test\"));\n@@ -3747,1 +3754,1 @@\n-        return (String)array[0].s;\n+        return (String) array[0].s;\n@@ -3755,1 +3762,2 @@\n-    static value class Test151Value {\n+    static value\n+    class Test151Value {\n@@ -3771,1 +3779,1 @@\n-        failOn = {ALLOC_OF_MYVALUE_KLASS,})\n+            failOn = {ALLOC_OF_MYVALUE_KLASS,})\n@@ -3782,1 +3790,2 @@\n-    static value class MyValue152Inline {\n+    static value\n+    class MyValue152Inline {\n@@ -3788,1 +3797,2 @@\n-    static value class MyValue152 {\n+    static value\n+    class MyValue152 {\n@@ -3802,1 +3812,1 @@\n-        MyValue152[] array = (MyValue152[])ValueClass.newNullRestrictedNonAtomicArray(MyValue152.class, 1, new MyValue152());\n+        MyValue152[] array = (MyValue152[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue152.class, 1, new MyValue152());\n@@ -3812,1 +3822,2 @@\n-    static value class MyValue153 {\n+    static value\n+    class MyValue153 {\n@@ -3824,1 +3835,1 @@\n-        MyValue153[] array = (MyValue153[])ValueClass.newNullRestrictedNonAtomicArray(MyValue153.class, 1, new MyValue153());\n+        MyValue153[] array = (MyValue153[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue153.class, 1, new MyValue153());\n@@ -3838,1 +3849,1 @@\n-        MyValue152[] array = (MyValue152[])ValueClass.newNullRestrictedNonAtomicArray(MyValue152.class, 1, new MyValue152());\n+        MyValue152[] array = (MyValue152[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue152.class, 1, new MyValue152());\n@@ -3852,1 +3863,2 @@\n-        failOn = {IRNode.MEMBAR}, counts = {IRNode.IF, \"3\"}) \/\/ null check, class check, range check\n+            failOn = {IRNode.MEMBAR}, counts = {IRNode.IF, \"3\"})\n+    \/\/ null check, class check, range check\n@@ -3859,1 +3871,1 @@\n-        test155((Test151Value[])ValueClass.newNullRestrictedNonAtomicArray(Test151Value.class, 1, Test151Value.DEFAULT));\n+        test155((Test151Value[]) ValueClass.newNullRestrictedNonAtomicArray(Test151Value.class, 1, Test151Value.DEFAULT));\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestArrays.java","additions":334,"deletions":322,"binary":false,"changes":656,"status":"modified"},{"patch":"@@ -84,13 +84,13 @@\n-        Class<?>[] classes = new Class<?>[] {\n-            Object.class, MyInterface.class, MyClass0.class, MyClass1.class, MyClass2.class, MyClass3.class, MyClass4.class,\n-            MyClass5.class, MyClass6.class, MyClass7.class, MyClass8.class, MyClass9.class, MyClass10.class, Integer.class };\n-\n-        Class<?>[] arrayClasses = new Class<?>[] {\n-            java.lang.Cloneable.class, java.io.Serializable.class, Object.class, Object[].class,\n-            MyInterface[].class, MyClass0[].class, MyClass1[].class, MyClass2[].class, MyClass3[].class, MyClass4[].class,\n-            MyClass5[].class, MyClass6[].class, MyClass7[].class, MyClass8[].class, MyClass9[].class, MyClass10[].class, Integer[].class };\n-\n-        Class<?>[] multiDimArrayClasses = new Class<?>[] {\n-            java.lang.Cloneable.class, java.lang.Cloneable[].class, java.io.Serializable.class, java.io.Serializable[].class, Object.class, Object[].class, Object[].class,\n-            MyInterface[][].class, MyClass0[][].class, MyClass1[][].class, MyClass2[][].class, MyClass3[][].class, MyClass4[][].class,\n-            MyClass5[][].class, MyClass6[][].class, MyClass7[][].class, MyClass8[][].class, MyClass9[][].class, MyClass10[][].class, Integer[][].class };\n+        Class<?>[] classes = new Class<?>[]{\n+                Object.class, MyInterface.class, MyClass0.class, MyClass1.class, MyClass2.class, MyClass3.class, MyClass4.class,\n+                MyClass5.class, MyClass6.class, MyClass7.class, MyClass8.class, MyClass9.class, MyClass10.class, Integer.class};\n+\n+        Class<?>[] arrayClasses = new Class<?>[]{\n+                java.lang.Cloneable.class, java.io.Serializable.class, Object.class, Object[].class,\n+                MyInterface[].class, MyClass0[].class, MyClass1[].class, MyClass2[].class, MyClass3[].class, MyClass4[].class,\n+                MyClass5[].class, MyClass6[].class, MyClass7[].class, MyClass8[].class, MyClass9[].class, MyClass10[].class, Integer[].class};\n+\n+        Class<?>[] multiDimArrayClasses = new Class<?>[]{\n+                java.lang.Cloneable.class, java.lang.Cloneable[].class, java.io.Serializable.class, java.io.Serializable[].class, Object.class, Object[].class, Object[].class,\n+                MyInterface[][].class, MyClass0[][].class, MyClass1[][].class, MyClass2[][].class, MyClass3[][].class, MyClass4[][].class,\n+                MyClass5[][].class, MyClass6[][].class, MyClass7[][].class, MyClass8[][].class, MyClass9[][].class, MyClass10[][].class, Integer[][].class};\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestIsInstance.java","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -145,5 +145,5 @@\n-                   .addScenarios(scenarios[Integer.parseInt(args[0])])\n-                   .addHelperClasses(MyValue1.class,\n-                                     MyValue2.class,\n-                                     MyValue2Inline.class)\n-                   .start();\n+                .addScenarios(scenarios[Integer.parseInt(args[0])])\n+                .addHelperClasses(MyValue1.class,\n+                        MyValue2.class,\n+                        MyValue2Inline.class)\n+                .start();\n@@ -172,1 +172,1 @@\n-        counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"})\n+            counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"})\n@@ -174,2 +174,2 @@\n-        counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"},\n-        failOn = {LOAD_OF_ANY_KLASS})\n+            counts = {ALLOC_ARRAY_OF_MYVALUE_KLASS, \"= 1\"},\n+            failOn = {LOAD_OF_ANY_KLASS})\n@@ -380,1 +380,1 @@\n-                    arr[i][j][k] = MyValue1.createWithFieldsDontInline(rI + i , rL + j + k);\n+                    arr[i][j][k] = MyValue1.createWithFieldsDontInline(rI + i, rL + j + k);\n@@ -399,1 +399,1 @@\n-                        Asserts.assertEQ(arr[i][j][k].hash(), MyValue1.createWithFieldsDontInline(rI + i , rL + j + k).hash());\n+                        Asserts.assertEQ(arr[i][j][k].hash(), MyValue1.createWithFieldsDontInline(rI + i, rL + j + k).hash());\n@@ -426,2 +426,2 @@\n-        long[] res = new long[2*3*4];\n-        long[] verif = new long[2*3*4];\n+        long[] res = new long[2 * 3 * 4];\n+        long[] verif = new long[2 * 3 * 4];\n@@ -492,1 +492,1 @@\n-    public int test14(MyValue1[] va, int index)  {\n+    public int test14(MyValue1[] va, int index) {\n@@ -560,1 +560,1 @@\n-    public int test17(MyValue1[] va, int index, MyValue1 vt)  {\n+    public int test17(MyValue1[] va, int index, MyValue1 vt) {\n@@ -600,1 +600,1 @@\n-        MyValue1[] va2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -663,2 +663,2 @@\n-        MyValue1[] src3 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n-        MyValue1[] src4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src3 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -666,1 +666,1 @@\n-        MyValue1[] dst2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] dst2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -668,1 +668,1 @@\n-        MyValue1[] dst4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] dst4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -707,2 +707,2 @@\n-        MyValue2[] src3 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n-        MyValue2[] src4 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src3 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] src4 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -710,1 +710,1 @@\n-        MyValue2[] dst2 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst2 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -712,1 +712,1 @@\n-        MyValue2[] dst4 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n+        MyValue2[] dst4 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, len, MyValue2.DEFAULT);\n@@ -717,4 +717,4 @@\n-            src1[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src2[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src3[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src4[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src1[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src2[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src3[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src4[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -753,1 +753,1 @@\n-        MyValue1[] src2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -783,1 +783,1 @@\n-        MyValue1[] src2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -811,2 +811,2 @@\n-        MyValue1[] src3 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n-        MyValue1[] src4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src3 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] src4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -814,1 +814,1 @@\n-        MyValue1[] dst2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] dst2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -816,1 +816,1 @@\n-        MyValue1[] dst4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] dst4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -854,2 +854,2 @@\n-        MyValue2[] src3 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n-        MyValue2[] src4 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] src3 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] src4 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -857,1 +857,1 @@\n-        MyValue2[] dst2 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] dst2 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -859,1 +859,1 @@\n-        MyValue2[] dst4 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n+        MyValue2[] dst4 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 8, MyValue2.DEFAULT);\n@@ -862,4 +862,4 @@\n-            src1[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src2[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src3[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src4[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src1[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src2[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src3[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src4[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -893,2 +893,2 @@\n-        MyValue1[] src3 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n-        MyValue1[] src4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] src3 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] src4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -896,1 +896,1 @@\n-        MyValue1[] dst2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -898,1 +898,1 @@\n-        MyValue1[] dst4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -932,2 +932,2 @@\n-        MyValue1[] src3 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n-        MyValue1[] src4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] src3 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] src4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -935,1 +935,1 @@\n-        MyValue1[] dst2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -937,1 +937,1 @@\n-        MyValue1[] dst4 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst4 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -966,1 +966,1 @@\n-        failOn = {ALLOC_OF_MYVALUE_KLASS, ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, LOAD_OF_ANY_KLASS, STORE_OF_ANY_KLASS, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n+            failOn = {ALLOC_OF_MYVALUE_KLASS, ALLOC_ARRAY_OF_MYVALUE_KLASS, LOOP, LOAD_OF_ANY_KLASS, STORE_OF_ANY_KLASS, UNSTABLE_IF_TRAP, PREDICATE_TRAP})\n@@ -970,1 +970,1 @@\n-        MyValue2[] dst = (MyValue2[])src.clone();\n+        MyValue2[] dst = (MyValue2[]) src.clone();\n@@ -994,1 +994,1 @@\n-        MyValue2[] src2 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] src2 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -996,2 +996,2 @@\n-            src1[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src2[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src1[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src2[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1013,1 +1013,1 @@\n-        if (flag) { }\n+        if (flag) {}\n@@ -1021,1 +1021,1 @@\n-        MyValue2[] src2 = (MyValue2[])ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n+        MyValue2[] src2 = (MyValue2[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue2.class, 10, MyValue2.DEFAULT);\n@@ -1023,2 +1023,2 @@\n-            src1[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n-            src2[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src1[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n+            src2[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1043,1 +1043,1 @@\n-            src[0] = MyValue2.createWithFieldsInline(rI+1, rD+1);\n+            src[0] = MyValue2.createWithFieldsInline(rI + 1, rD + 1);\n@@ -1057,1 +1057,1 @@\n-        MyValue2 v2 = MyValue2.createWithFieldsInline(rI+1, rD+1);\n+        MyValue2 v2 = MyValue2.createWithFieldsInline(rI + 1, rD + 1);\n@@ -1073,1 +1073,1 @@\n-        MyValue1[] va2 = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n+        MyValue1[] va2 = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, len, MyValue1.DEFAULT);\n@@ -1078,2 +1078,2 @@\n-        MyValue1[] result1 = (MyValue1[])test32(va1);\n-        MyValue1[] result2 = (MyValue1[])test32(va2);\n+        MyValue1[] result1 = (MyValue1[]) test32(va1);\n+        MyValue1[] result2 = (MyValue1[]) test32(va2);\n@@ -1085,2 +1085,2 @@\n-            Asserts.assertEQ(((MyValue1)result1[i]).hash(), ((MyValue1)va1[i]).hash());\n-            Asserts.assertEQ(((MyValue1)result2[i]).hash(), ((MyValue1)va2[i]).hash());\n+            Asserts.assertEQ(((MyValue1) result1[i]).hash(), ((MyValue1) va1[i]).hash());\n+            Asserts.assertEQ(((MyValue1) result2[i]).hash(), ((MyValue1) va2[i]).hash());\n@@ -1104,1 +1104,1 @@\n-            Asserts.assertEQ(((MyValue1)result[i]).hash(), ((MyValue1)va[i]).hash());\n+            Asserts.assertEQ(((MyValue1) result[i]).hash(), ((MyValue1) va[i]).hash());\n@@ -1148,1 +1148,1 @@\n-                Asserts.assertEQ(((MyInterface)src[i]).hash(), ((MyInterface)dst[i]).hash());\n+                Asserts.assertEQ(((MyInterface) src[i]).hash(), ((MyInterface) dst[i]).hash());\n@@ -1168,1 +1168,1 @@\n-                Asserts.assertEQ(src[i].hash(), ((MyInterface)dst[i]).hash());\n+                Asserts.assertEQ(src[i].hash(), ((MyInterface) dst[i]).hash());\n@@ -1188,1 +1188,1 @@\n-                Asserts.assertEQ(src[i].hash(), ((MyInterface)dst[i]).hash());\n+                Asserts.assertEQ(src[i].hash(), ((MyInterface) dst[i]).hash());\n@@ -1238,1 +1238,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1259,1 +1259,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1281,1 +1281,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1306,1 +1306,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1328,1 +1328,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1353,1 +1353,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1374,1 +1374,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1415,1 +1415,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1435,1 +1435,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1456,1 +1456,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1480,1 +1480,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1501,1 +1501,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1525,1 +1525,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1545,1 +1545,1 @@\n-            src[i] = MyValue2.createWithFieldsInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsInline(rI + i, rD + i);\n@@ -1651,1 +1651,1 @@\n-   @Test\n+    @Test\n@@ -1691,1 +1691,1 @@\n-        return Arrays.copyOf(va, va.length+1, MyValue1[].class);\n+        return Arrays.copyOf(va, va.length + 1, MyValue1[].class);\n@@ -1698,1 +1698,1 @@\n-        MyValue1[] verif = new MyValue1[len+1];\n+        MyValue1[] verif = new MyValue1[len + 1];\n@@ -1709,1 +1709,1 @@\n-        return Arrays.copyOf(va, va.length+1, klass);\n+        return Arrays.copyOf(va, va.length + 1, klass);\n@@ -1716,1 +1716,1 @@\n-        MyValue1[] verif = new MyValue1[len+1];\n+        MyValue1[] verif = new MyValue1[len + 1];\n@@ -1719,1 +1719,1 @@\n-            verif[i] = (MyValue1)va[i];\n+            verif[i] = (MyValue1) va[i];\n@@ -1727,1 +1727,1 @@\n-        return Arrays.copyOf(va, va.length+1, klass);\n+        return Arrays.copyOf(va, va.length + 1, klass);\n@@ -1757,1 +1757,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -1761,1 +1761,1 @@\n-        return Arrays.copyOf(arr, arr.length+1, arr.getClass());\n+        return Arrays.copyOf(arr, arr.length + 1, arr.getClass());\n@@ -1793,1 +1793,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -1797,1 +1797,1 @@\n-        return Arrays.copyOf(arr, arr.length+1, arr.getClass());\n+        return Arrays.copyOf(arr, arr.length + 1, arr.getClass());\n@@ -1804,1 +1804,1 @@\n-        MyValue1[] verif = new MyValue1[len+1];\n+        MyValue1[] verif = new MyValue1[len + 1];\n@@ -1939,1 +1939,1 @@\n-            src[i] = MyValue2.createWithFieldsDontInline(rI+i, rD+i);\n+            src[i] = MyValue2.createWithFieldsDontInline(rI + i, rD + i);\n@@ -1990,1 +1990,1 @@\n-        MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI+1, rL+1);\n+        MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI + 1, rL + 1);\n@@ -2018,1 +2018,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -2056,1 +2056,1 @@\n-        for (; i < 10; i++);\n+        for (; i < 10; i++) ;\n@@ -2090,1 +2090,1 @@\n-            result = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n+            result = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n@@ -2103,2 +2103,2 @@\n-        MyValue1[] vva = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n-        MyValue1[] vva_r = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n+        MyValue1[] vva = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n+        MyValue1[] vva_r = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n@@ -2132,1 +2132,1 @@\n-            va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n+            va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 10, MyValue1.DEFAULT);\n@@ -2137,1 +2137,1 @@\n-        long sum = ((MyValue1)va[0]).hashInterpreted();\n+        long sum = ((MyValue1) va[0]).hashInterpreted();\n@@ -2150,1 +2150,1 @@\n-        Asserts.assertEQ(((MyValue1)va[0]).hash(), hash(rI, hash()));\n+        Asserts.assertEQ(((MyValue1) va[0]).hash(), hash(rI, hash()));\n@@ -2152,1 +2152,1 @@\n-            Asserts.assertEQ(((MyValue1)va[i]).hash(), hash());\n+            Asserts.assertEQ(((MyValue1) va[i]).hash(), hash());\n@@ -2156,1 +2156,1 @@\n-        Asserts.assertEQ(((MyValue1)va[0]).hash(), hash(rI + 1, hash(rI, rL) + 1));\n+        Asserts.assertEQ(((MyValue1) va[0]).hash(), hash(rI + 1, hash(rI, rL) + 1));\n@@ -2158,1 +2158,1 @@\n-            Asserts.assertEQ(((MyValue1)va[i]).hash(), hash(rI + i, rL + i));\n+            Asserts.assertEQ(((MyValue1) va[i]).hash(), hash(rI + i, rL + i));\n@@ -2171,1 +2171,1 @@\n-            result = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n+            result = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n@@ -2187,2 +2187,2 @@\n-        MyValue1[] vva = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n-        MyValue1[] vva_r = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n+        MyValue1[] vva = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n+        MyValue1[] vva_r = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n@@ -2219,1 +2219,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2237,1 +2237,1 @@\n-        return (MyValue1[])va;\n+        return (MyValue1[]) va;\n@@ -2242,1 +2242,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2245,1 +2245,1 @@\n-        Asserts.assertEquals(((MyValue1)res[0]).hash(), testValue1.hash());\n+        Asserts.assertEquals(((MyValue1) res[0]).hash(), testValue1.hash());\n@@ -2270,1 +2270,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2297,1 +2297,1 @@\n-            result = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+            result = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2314,1 +2314,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2344,1 +2344,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 42, MyValue1.DEFAULT);\n@@ -2352,2 +2352,2 @@\n-        failOn = {ALLOC_OF_MYVALUE_KLASS, LOOP, UNSTABLE_IF_TRAP, PREDICATE_TRAP},\n-        counts = {STORE_OF_ANY_KLASS, \"= 38\"})\n+            failOn = {ALLOC_OF_MYVALUE_KLASS, LOOP, UNSTABLE_IF_TRAP, PREDICATE_TRAP},\n+            counts = {STORE_OF_ANY_KLASS, \"= 38\"})\n@@ -2355,1 +2355,1 @@\n-        MyValue1[] result = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] result = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2382,1 +2382,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2403,1 +2403,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2443,1 +2443,1 @@\n-        return (MyValue1[])c.cast(va);\n+        return (MyValue1[]) c.cast(va);\n@@ -2448,1 +2448,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2465,1 +2465,1 @@\n-        return (MyValue1[])c.cast(va);\n+        return (MyValue1[]) c.cast(va);\n@@ -2470,1 +2470,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2474,1 +2474,1 @@\n-        Asserts.assertEquals(((MyValue1)res[0]).hash(), testValue1.hash());\n+        Asserts.assertEquals(((MyValue1) res[0]).hash(), testValue1.hash());\n@@ -2485,1 +2485,1 @@\n-        return (MyValue1[])va;\n+        return (MyValue1[]) va;\n@@ -2490,1 +2490,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2493,2 +2493,2 @@\n-          \/\/ Trigger some ClassCastExceptions so C2 does not add an uncommon trap\n-          test90(new NonValueClass[0]);\n+            \/\/ Trigger some ClassCastExceptions so C2 does not add an uncommon trap\n+            test90(new NonValueClass[0]);\n@@ -2496,1 +2496,1 @@\n-          \/\/ Expected\n+            \/\/ Expected\n@@ -2505,1 +2505,1 @@\n-        return (MyValue1[])va;\n+        return (MyValue1[]) va;\n@@ -2510,1 +2510,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2513,2 +2513,2 @@\n-          \/\/ Trigger some ClassCastExceptions so C2 does not add an uncommon trap\n-          test91(new NonValueClass[0]);\n+            \/\/ Trigger some ClassCastExceptions so C2 does not add an uncommon trap\n+            test91(new NonValueClass[0]);\n@@ -2516,1 +2516,1 @@\n-          \/\/ Expected\n+            \/\/ Expected\n@@ -2531,1 +2531,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2547,1 +2547,1 @@\n-        MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n+        MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 2, MyValue1.DEFAULT);\n@@ -2561,1 +2561,1 @@\n-        MyValue1[] dst = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n+        MyValue1[] dst = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 8, MyValue1.DEFAULT);\n@@ -2596,1 +2596,2 @@\n-    static value class Complex {\n+    static value\n+    class Complex {\n@@ -2611,1 +2612,1 @@\n-                               this.re * that.im + this.im * that.re);\n+                    this.re * that.im + this.im * that.re);\n@@ -2623,1 +2624,1 @@\n-                    R[i][j] = B[i][j].add(aik.mul((Complex)B[k][j]));\n+                    R[i][j] = B[i][j].add(aik.mul((Complex) B[k][j]));\n@@ -2671,1 +2672,1 @@\n-        result = test97((Object[])myInt);\n+        result = test97((Object[]) myInt);\n@@ -2688,1 +2689,1 @@\n-        result = test98((Object[])myInt);\n+        result = test98((Object[]) myInt);\n@@ -2691,1 +2692,1 @@\n-            MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+            MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2693,3 +2694,3 @@\n-            result = test98((Object[])va);\n-            Asserts.assertEquals(((MyValue1)result).hash(), MyValue1.createDefaultInline().hash());\n-            result = test98((Object[])vab);\n+            result = test98((Object[]) va);\n+            Asserts.assertEquals(((MyValue1) result).hash(), MyValue1.createDefaultInline().hash());\n+            result = test98((Object[]) vab);\n@@ -2713,1 +2714,1 @@\n-        result = test99((Object[])myInt);\n+        result = test99((Object[]) myInt);\n@@ -2717,1 +2718,1 @@\n-                test99((Object[])null);\n+                test99((Object[]) null);\n@@ -2738,1 +2739,1 @@\n-        result = test100((Object[])myInt);\n+        result = test100((Object[]) myInt);\n@@ -2763,1 +2764,1 @@\n-        test101(otherObj, (Object[])myInt);\n+        test101(otherObj, (Object[]) myInt);\n@@ -2765,1 +2766,1 @@\n-        test101(null, (Object[])myInt);\n+        test101(null, (Object[]) myInt);\n@@ -2780,1 +2781,1 @@\n-        test102(otherObj, (Object[])myInt);\n+        test102(otherObj, (Object[]) myInt);\n@@ -2782,1 +2783,1 @@\n-        test102(null, (Object[])myInt);\n+        test102(null, (Object[]) myInt);\n@@ -2785,1 +2786,1 @@\n-            MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+            MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2787,1 +2788,1 @@\n-            test102(testValue1, (Object[])va);\n+            test102(testValue1, (Object[]) va);\n@@ -2789,1 +2790,1 @@\n-            test102(testValue1, (Object[])vab);\n+            test102(testValue1, (Object[]) vab);\n@@ -2791,1 +2792,1 @@\n-            test102(null, (Object[])vab);\n+            test102(null, (Object[]) vab);\n@@ -2807,1 +2808,1 @@\n-        test103(otherObj, (Object[])myInt);\n+        test103(otherObj, (Object[]) myInt);\n@@ -2809,1 +2810,1 @@\n-        test103(null, (Object[])myInt);\n+        test103(null, (Object[]) myInt);\n@@ -2812,1 +2813,1 @@\n-            MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+            MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2814,1 +2815,1 @@\n-                test103(null, (Object[])va);\n+                test103(null, (Object[]) va);\n@@ -2833,1 +2834,1 @@\n-        test104(otherObj, (Object[])myInt);\n+        test104(otherObj, (Object[]) myInt);\n@@ -2835,1 +2836,1 @@\n-        test104(null, (Object[])myInt);\n+        test104(null, (Object[]) myInt);\n@@ -2858,1 +2859,1 @@\n-        test105(otherObj, (Object[])myInt);\n+        test105(otherObj, (Object[]) myInt);\n@@ -2860,1 +2861,1 @@\n-        test105(null, (Object[])myInt);\n+        test105(null, (Object[]) myInt);\n@@ -2864,1 +2865,1 @@\n-                test105(testValue1, (Object[])null);\n+                test105(testValue1, (Object[]) null);\n@@ -2896,1 +2897,1 @@\n-        result = test106(myInt, (Object[])myInt);\n+        result = test106(myInt, (Object[]) myInt);\n@@ -2899,1 +2900,1 @@\n-            MyValue1[] va = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+            MyValue1[] va = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2901,4 +2902,4 @@\n-            result = test106(va, (Object[])va);\n-            Asserts.assertEquals(((MyValue1)result[0]).hash(), MyValue1.createDefaultInline().hash());\n-            result = test106(vab, (Object[])vab);\n-            Asserts.assertEquals(((MyValue1)result[0]).hash(), testValue1.hash());\n+            result = test106(va, (Object[]) va);\n+            Asserts.assertEquals(((MyValue1) result[0]).hash(), MyValue1.createDefaultInline().hash());\n+            result = test106(vab, (Object[]) vab);\n+            Asserts.assertEquals(((MyValue1) result[0]).hash(), testValue1.hash());\n@@ -2954,1 +2955,1 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2969,1 +2970,1 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2984,1 +2985,1 @@\n-        MyValue1[] src = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+        MyValue1[] src = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -2996,1 +2997,1 @@\n-    static final MyValue1[] flatArray = (MyValue1[])ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n+    static final MyValue1[] flatArray = (MyValue1[]) ValueClass.newNullRestrictedNonAtomicArray(MyValue1.class, 1, MyValue1.DEFAULT);\n@@ -3011,1 +3012,1 @@\n-        refArray[0] = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+        refArray[0] = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3039,1 +3040,1 @@\n-        refArray[0] = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+        refArray[0] = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3065,1 +3066,1 @@\n-        refArray[0] = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+        refArray[0] = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3091,1 +3092,1 @@\n-        refArray[0] = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+        refArray[0] = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3103,1 +3104,1 @@\n-            refArray[0] = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+            refArray[0] = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3124,1 +3125,1 @@\n-        refArray[0] = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+        refArray[0] = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3130,1 +3131,1 @@\n-            refArray[0] = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+            refArray[0] = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3219,2 +3220,2 @@\n-        failOn = {ALLOC},\n-        counts = {STORE_OF_ANY_KLASS, \"= 19\"})\n+            failOn = {ALLOC},\n+            counts = {STORE_OF_ANY_KLASS, \"= 19\"})\n@@ -3231,1 +3232,1 @@\n-        flatArray[0] = (MyValue1)o;\n+        flatArray[0] = (MyValue1) o;\n@@ -3237,1 +3238,1 @@\n-        MyValue1 vt = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+        MyValue1 vt = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3252,2 +3253,2 @@\n-        failOn = {ALLOC},\n-        counts = {STORE_OF_ANY_KLASS, \"= 19\"})\n+            failOn = {ALLOC},\n+            counts = {STORE_OF_ANY_KLASS, \"= 19\"})\n@@ -3264,1 +3265,1 @@\n-        flatArray[0] = (MyValue1)o;\n+        flatArray[0] = (MyValue1) o;\n@@ -3272,1 +3273,1 @@\n-        MyValue1 vt = MyValue1.createWithFieldsInline(rI+1, rL+1);\n+        MyValue1 vt = MyValue1.createWithFieldsInline(rI + 1, rL + 1);\n@@ -3298,1 +3299,1 @@\n-        return ((MyValue1)res).hash();\n+        return ((MyValue1) res).hash();\n@@ -3323,1 +3324,1 @@\n-            res = MyValue2.createWithFieldsInline(rI+1, rD+1);\n+            res = MyValue2.createWithFieldsInline(rI + 1, rD + 1);\n@@ -3331,1 +3332,1 @@\n-        return ((MyValue2)res).hash();\n+        return ((MyValue2) res).hash();\n@@ -3338,1 +3339,1 @@\n-        MyValue2 val2 = MyValue2.createWithFieldsInline(rI+1, rD+1);\n+        MyValue2 val2 = MyValue2.createWithFieldsInline(rI + 1, rD + 1);\n@@ -3356,1 +3357,1 @@\n-            res[0] = MyValue2.createWithFieldsInline(rI+1, rD+1);\n+            res[0] = MyValue2.createWithFieldsInline(rI + 1, rD + 1);\n@@ -3360,1 +3361,1 @@\n-        val = ((MyValue2)res[0]);\n+        val = ((MyValue2) res[0]);\n@@ -3372,1 +3373,1 @@\n-        MyValue2 val2 = MyValue2.createWithFieldsInline(rI+1, rD+1);\n+        MyValue2 val2 = MyValue2.createWithFieldsInline(rI + 1, rD + 1);\n@@ -3382,1 +3383,2 @@\n-    static value class MyValue126  {\n+    static value\n+    class MyValue126 {\n@@ -3410,1 +3412,1 @@\n-        oFld = (MyValue126)array[i];\n+        oFld = (MyValue126) array[i];\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestNullableArrays.java","additions":207,"deletions":205,"binary":false,"changes":412,"status":"modified"},{"patch":"@@ -209,1 +209,2 @@\n-value class MyValueTearing {\n+value\n+class MyValueTearing {\n@@ -228,1 +229,1 @@\n-    static final MyValueTearing DEFAULT = new MyValueTearing((short)0, (short)0);\n+    static final MyValueTearing DEFAULT = new MyValueTearing((short) 0, (short) 0);\n@@ -237,1 +238,1 @@\n-        return new MyValueTearing((short)(x + 1), (short)(y + 1));\n+        return new MyValueTearing((short) (x + 1), (short) (y + 1));\n@@ -243,2 +244,2 @@\n-        U.putShort(vt, X_OFFSET, (short)(x + 1));\n-        U.putShort(vt, Y_OFFSET, (short)(y + 1));\n+        U.putShort(vt, X_OFFSET, (short) (x + 1));\n+        U.putShort(vt, Y_OFFSET, (short) (y + 1));\n@@ -252,5 +253,5 @@\n-        (WHITE_BOX.getIntxVMFlag(\"TieredStopAtLevel\").intValue() < 4) ||\n-         WHITE_BOX.getBooleanVMFlag(\"SafepointALot\") ||\n-         WHITE_BOX.getBooleanVMFlag(\"DeoptimizeALot\") ||\n-         WHITE_BOX.getBooleanVMFlag(\"DeoptimizeNMethodBarriersALot\") ||\n-        !WHITE_BOX.getBooleanVMFlag(\"UseTLAB\");\n+            (WHITE_BOX.getIntxVMFlag(\"TieredStopAtLevel\").intValue() < 4) ||\n+                    WHITE_BOX.getBooleanVMFlag(\"SafepointALot\") ||\n+                    WHITE_BOX.getBooleanVMFlag(\"DeoptimizeALot\") ||\n+                    WHITE_BOX.getBooleanVMFlag(\"DeoptimizeNMethodBarriersALot\") ||\n+                    !WHITE_BOX.getBooleanVMFlag(\"UseTLAB\");\n@@ -267,2 +268,2 @@\n-    static MyValueTearing field3 = new MyValueTearing((short)0, (short)0);\n-    MyValueTearing field4 = new MyValueTearing((short)0, (short)0);\n+    static MyValueTearing field3 = new MyValueTearing((short) 0, (short) 0);\n+    MyValueTearing field4 = new MyValueTearing((short) 0, (short) 0);\n@@ -271,2 +272,2 @@\n-    static final MyValueTearing[] array1 = (MyValueTearing[])ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n-    static final MyValueTearing[] array2 = (MyValueTearing[])ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n+    static final MyValueTearing[] array1 = (MyValueTearing[]) ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n+    static final MyValueTearing[] array2 = (MyValueTearing[]) ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n@@ -274,1 +275,1 @@\n-        array2[0] = new MyValueTearing((short)0, (short)0);\n+        array2[0] = new MyValueTearing((short) 0, (short) 0);\n@@ -276,1 +277,1 @@\n-    static final MyValueTearing[] array3 = new MyValueTearing[] { new MyValueTearing((short)0, (short)0) };\n+    static final MyValueTearing[] array3 = new MyValueTearing[]{new MyValueTearing((short) 0, (short) 0)};\n@@ -279,2 +280,2 @@\n-    static MyValueTearing[] array4 = (MyValueTearing[])ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n-    static MyValueTearing[] array5 = (MyValueTearing[])ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n+    static MyValueTearing[] array4 = (MyValueTearing[]) ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n+    static MyValueTearing[] array5 = (MyValueTearing[]) ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n@@ -282,1 +283,1 @@\n-        array5[0] = new MyValueTearing((short)0, (short)0);\n+        array5[0] = new MyValueTearing((short) 0, (short) 0);\n@@ -284,1 +285,1 @@\n-    static MyValueTearing[] array6 = new MyValueTearing[] { new MyValueTearing((short)0, (short)0) };\n+    static MyValueTearing[] array6 = new MyValueTearing[]{new MyValueTearing((short) 0, (short) 0)};\n@@ -287,2 +288,2 @@\n-    static Object[] array7 = (MyValueTearing[])ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n-    static Object[] array8 = (MyValueTearing[])ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n+    static Object[] array7 = (MyValueTearing[]) ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n+    static Object[] array8 = (MyValueTearing[]) ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n@@ -290,1 +291,1 @@\n-        array8[0] = new MyValueTearing((short)0, (short)0);\n+        array8[0] = new MyValueTearing((short) 0, (short) 0);\n@@ -292,1 +293,1 @@\n-    static Object[] array9 = new MyValueTearing[] { new MyValueTearing((short)0, (short)0) };\n+    static Object[] array9 = new MyValueTearing[]{new MyValueTearing((short) 0, (short) 0)};\n@@ -295,2 +296,2 @@\n-    static volatile Object[] array10 = (MyValueTearing[])ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n-    static volatile Object[] array11 = (MyValueTearing[])ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n+    static volatile Object[] array10 = (MyValueTearing[]) ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n+    static volatile Object[] array11 = (MyValueTearing[]) ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n@@ -298,1 +299,1 @@\n-        array11[0] = new MyValueTearing((short)0, (short)0);\n+        array11[0] = new MyValueTearing((short) 0, (short) 0);\n@@ -300,1 +301,1 @@\n-    static volatile Object[] array12 = new MyValueTearing[] { new MyValueTearing((short)0, (short)0) };\n+    static volatile Object[] array12 = new MyValueTearing[]{new MyValueTearing((short) 0, (short) 0)};\n@@ -329,4 +330,4 @@\n-                MyValueTearing[] localArray1 = (MyValueTearing[])ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n-                MyValueTearing[] localArray2 = (MyValueTearing[])ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n-                localArray2[0] = new MyValueTearing((short)0, (short)0);\n-                MyValueTearing[] localArray3 = new MyValueTearing[] { new MyValueTearing((short)0, (short)0) };\n+                MyValueTearing[] localArray1 = (MyValueTearing[]) ValueClass.newNullRestrictedAtomicArray(MyValueTearing.class, 1, MyValueTearing.DEFAULT);\n+                MyValueTearing[] localArray2 = (MyValueTearing[]) ValueClass.newNullableAtomicArray(MyValueTearing.class, 1);\n+                localArray2[0] = new MyValueTearing((short) 0, (short) 0);\n+                MyValueTearing[] localArray3 = new MyValueTearing[]{new MyValueTearing((short) 0, (short) 0)};\n@@ -360,6 +361,6 @@\n-                array7[0] = ((MyValueTearing)array7[0]).incrementAndCheck();\n-                array8[0] = ((MyValueTearing)array8[0]).incrementAndCheck();\n-                array9[0] = ((MyValueTearing)array9[0]).incrementAndCheck();\n-                array10[0] = ((MyValueTearing)array10[0]).incrementAndCheck();\n-                array11[0] = ((MyValueTearing)array11[0]).incrementAndCheck();\n-                array12[0] = ((MyValueTearing)array12[0]).incrementAndCheck();\n+                array7[0] = ((MyValueTearing) array7[0]).incrementAndCheck();\n+                array8[0] = ((MyValueTearing) array8[0]).incrementAndCheck();\n+                array9[0] = ((MyValueTearing) array9[0]).incrementAndCheck();\n+                array10[0] = ((MyValueTearing) array10[0]).incrementAndCheck();\n+                array11[0] = ((MyValueTearing) array11[0]).incrementAndCheck();\n+                array12[0] = ((MyValueTearing) array12[0]).incrementAndCheck();\n@@ -377,6 +378,6 @@\n-                array7[0] = ((MyValueTearing)array7[0]).incrementAndCheckUnsafe();\n-                array8[0] = ((MyValueTearing)array8[0]).incrementAndCheckUnsafe();\n-                array9[0] = ((MyValueTearing)array9[0]).incrementAndCheckUnsafe();\n-                array10[0] = ((MyValueTearing)array10[0]).incrementAndCheckUnsafe();\n-                array11[0] = ((MyValueTearing)array11[0]).incrementAndCheckUnsafe();\n-                array12[0] = ((MyValueTearing)array12[0]).incrementAndCheckUnsafe();\n+                array7[0] = ((MyValueTearing) array7[0]).incrementAndCheckUnsafe();\n+                array8[0] = ((MyValueTearing) array8[0]).incrementAndCheckUnsafe();\n+                array9[0] = ((MyValueTearing) array9[0]).incrementAndCheckUnsafe();\n+                array10[0] = ((MyValueTearing) array10[0]).incrementAndCheckUnsafe();\n+                array11[0] = ((MyValueTearing) array11[0]).incrementAndCheckUnsafe();\n+                array12[0] = ((MyValueTearing) array12[0]).incrementAndCheckUnsafe();\n@@ -385,16 +386,16 @@\n-                    test.field1 = (MyValueTearing)incrementAndCheck_mh.invokeExact(test.field1);\n-                    test.field2 = (MyValueTearing)incrementAndCheck_mh.invokeExact(test.field2);\n-                    test.field3 = (MyValueTearing)incrementAndCheck_mh.invokeExact(test.field1);\n-                    test.field4 = (MyValueTearing)incrementAndCheck_mh.invokeExact(test.field2);\n-                    array1[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact(array1[0]);\n-                    array2[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact(array2[0]);\n-                    array3[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact(array3[0]);\n-                    array4[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact(array4[0]);\n-                    array5[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact(array5[0]);\n-                    array6[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact(array6[0]);\n-                    array7[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact((MyValueTearing)array7[0]);\n-                    array8[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact((MyValueTearing)array8[0]);\n-                    array9[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact((MyValueTearing)array9[0]);\n-                    array10[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact((MyValueTearing)array10[0]);\n-                    array11[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact((MyValueTearing)array11[0]);\n-                    array12[0] = (MyValueTearing)incrementAndCheck_mh.invokeExact((MyValueTearing)array12[0]);\n+                    test.field1 = (MyValueTearing) incrementAndCheck_mh.invokeExact(test.field1);\n+                    test.field2 = (MyValueTearing) incrementAndCheck_mh.invokeExact(test.field2);\n+                    test.field3 = (MyValueTearing) incrementAndCheck_mh.invokeExact(test.field1);\n+                    test.field4 = (MyValueTearing) incrementAndCheck_mh.invokeExact(test.field2);\n+                    array1[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact(array1[0]);\n+                    array2[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact(array2[0]);\n+                    array3[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact(array3[0]);\n+                    array4[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact(array4[0]);\n+                    array5[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact(array5[0]);\n+                    array6[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact(array6[0]);\n+                    array7[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact((MyValueTearing) array7[0]);\n+                    array8[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact((MyValueTearing) array8[0]);\n+                    array9[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact((MyValueTearing) array9[0]);\n+                    array10[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact((MyValueTearing) array10[0]);\n+                    array11[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact((MyValueTearing) array11[0]);\n+                    array12[0] = (MyValueTearing) incrementAndCheck_mh.invokeExact((MyValueTearing) array12[0]);\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestTearing.java","additions":61,"deletions":60,"binary":false,"changes":121,"status":"modified"},{"patch":"@@ -228,1 +228,2 @@\n-    static value class SmallValue {\n+    static value\n+    class SmallValue {\n@@ -259,1 +260,2 @@\n-    static value class LargeValue {\n+    static value\n+    class LargeValue {\n@@ -280,1 +282,1 @@\n-                   \", x6 = \" + x6 + \", x7 = \" + x7;\n+                    \", x6 = \" + x6 + \", x7 = \" + x7;\n@@ -285,1 +287,1 @@\n-                x6 != i || x7 != i) {\n+                    x6 != i || x7 != i) {\n@@ -302,1 +304,2 @@\n-    static value class LargeValue2 {\n+    static value\n+    class LargeValue2 {\n@@ -311,2 +314,2 @@\n-            this.x1 = (byte)i;\n-            this.x2 = (short)i;\n+            this.x1 = (byte) i;\n+            this.x2 = (short) i;\n@@ -321,1 +324,1 @@\n-                   \", x6 = \" + x6;\n+                    \", x6 = \" + x6;\n@@ -325,2 +328,2 @@\n-            if (x1 != (byte)i || x2 != (short)i || x3 != i || x4 != i || x5 != i ||\n-                x6 != ((i % 2) == 0)) {\n+            if (x1 != (byte) i || x2 != (short) i || x3 != i || x4 != i || x5 != i ||\n+                    x6 != ((i % 2) == 0)) {\n@@ -343,1 +346,2 @@\n-    static value class LargeValueWithOops {\n+    static value\n+    class LargeValueWithOops {\n@@ -379,1 +383,2 @@\n-    public static value class DoubleValue {\n+    public static value\n+    class DoubleValue {\n@@ -399,1 +404,1 @@\n-                    throw new RuntimeException(\"Incorrect result at \" + loc + \" for d = \" + d+ \": \" + val);\n+                    throw new RuntimeException(\"Incorrect result at \" + loc + \" for d = \" + d + \": \" + val);\n@@ -407,1 +412,2 @@\n-    public static value class DoubleValue2 {\n+    public static value\n+    class DoubleValue2 {\n@@ -427,1 +433,1 @@\n-            if (this.d1 != d || this.d2 != (d+1) || this.d3 != (d+2) || this.d4 != (d+3) || this.d5 != (d+4)) {\n+            if (this.d1 != d || this.d2 != (d + 1) || this.d3 != (d + 2) || this.d4 != (d + 3) || this.d5 != (d + 4)) {\n@@ -443,1 +449,2 @@\n-    static abstract value class BaseValue {\n+    static abstract value\n+    class BaseValue {\n@@ -447,1 +454,2 @@\n-    static value class ValueExtendsAbstract extends BaseValue {\n+    static value\n+    class ValueExtendsAbstract extends BaseValue {\n@@ -468,1 +476,1 @@\n-                   \", x6 = \" + x6 + \", x7 = \" + x7;\n+                    \", x6 = \" + x6 + \", x7 = \" + x7;\n@@ -473,1 +481,1 @@\n-                x6 != i || x7 != i) {\n+                    x6 != i || x7 != i) {\n@@ -479,1 +487,1 @@\n-    public static void dontInline() { }\n+    public static void dontInline() {}\n@@ -733,1 +741,1 @@\n-            for (;;) {\n+            for (; ; ) {\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestVirtualThreads.java","additions":29,"deletions":21,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -24,1 +24,0 @@\n-\n@@ -44,1 +43,1 @@\n- * @run junit\/othervm -esa -DDISABLE_PREVIEW_PATCHING=false ImageLocationTest\n+ * @run junit\/othervm -esa -DDISABLE_PREVIEW_PATCHING=true ImageLocationTest\n","filename":"test\/jdk\/jdk\/internal\/jimage\/ImageLocationTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n- * @run junit\/othervm -esa -DDISABLE_PREVIEW_PATCHING=false ImageReaderTest\n+ * @run junit\/othervm -esa -DDISABLE_PREVIEW_PATCHING=true ImageReaderTest\n","filename":"test\/jdk\/jdk\/internal\/jimage\/ImageReaderTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-    @DataProvider(name=\"classes\")\n+    @DataProvider(name = \"classes\")\n@@ -64,1 +64,1 @@\n-        return new Object[][] {\n+        return new Object[][]{\n@@ -82,1 +82,1 @@\n-    @Test(dataProvider=\"classes\")\n+    @Test(dataProvider = \"classes\")\n@@ -107,2 +107,2 @@\n-                    + moduleName\n-                    + \", or class: \" + className);\n+                            + moduleName\n+                            + \", or class: \" + className);\n@@ -234,1 +234,1 @@\n-            System.arraycopy(nativeNames,0, combined, names.length, nativeNames.length);\n+            System.arraycopy(nativeNames, 0, combined, names.length, nativeNames.length);\n@@ -358,1 +358,1 @@\n-        Class<?>[] testclass = { JImageReadTest.class};\n+        Class<?>[] testclass = {JImageReadTest.class};\n","filename":"test\/jdk\/jdk\/internal\/jimage\/JImageReadTest.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -37,2 +37,2 @@\n-import static jdk.internal.jimage.ModuleReference.forEmptyPackageIn;\n-import static jdk.internal.jimage.ModuleReference.forPackageIn;\n+import static jdk.internal.jimage.ModuleReference.forEmptyPackage;\n+import static jdk.internal.jimage.ModuleReference.forPackage;\n@@ -60,1 +60,1 @@\n-        ModuleReference ref = forEmptyPackageIn(\"module\", isPreview);\n+        ModuleReference ref = forEmptyPackage(\"module\", isPreview);\n@@ -71,1 +71,1 @@\n-        ModuleReference ref = forPackageIn(\"module\", isPreview);\n+        ModuleReference ref = forPackage(\"module\", isPreview);\n@@ -82,2 +82,2 @@\n-        ModuleReference emptyRef = forEmptyPackageIn(\"module\", true);\n-        ModuleReference resourceRef = forPackageIn(\"module\", isPreview);\n+        ModuleReference emptyRef = forEmptyPackage(\"module\", true);\n+        ModuleReference resourceRef = forPackage(\"module\", isPreview);\n@@ -95,4 +95,4 @@\n-                forEmptyPackageIn(\"alpha\", true),\n-                forEmptyPackageIn(\"beta\", false).merge(forEmptyPackageIn(\"beta\", true)),\n-                forPackageIn(\"gamma\", false),\n-                forEmptyPackageIn(\"zeta\", false));\n+                forEmptyPackage(\"alpha\", true),\n+                forEmptyPackage(\"beta\", false).merge(forEmptyPackage(\"beta\", true)),\n+                forPackage(\"gamma\", false),\n+                forEmptyPackage(\"zeta\", false));\n@@ -122,2 +122,2 @@\n-                forPackageIn(\"first\", false),\n-                forEmptyPackageIn(\"alpha\", false));\n+                forPackage(\"first\", false),\n+                forEmptyPackage(\"alpha\", false));\n@@ -135,2 +135,2 @@\n-                forPackageIn(\"alpha\", false),\n-                forPackageIn(\"beta\", false));\n+                forPackage(\"alpha\", false),\n+                forPackage(\"beta\", false));\n@@ -148,2 +148,2 @@\n-                forEmptyPackageIn(\"alpha\", false),\n-                forEmptyPackageIn(\"beta\", true));\n+                forEmptyPackage(\"alpha\", false),\n+                forEmptyPackage(\"beta\", true));\n@@ -161,2 +161,2 @@\n-                forEmptyPackageIn(\"duplicate\", true),\n-                forEmptyPackageIn(\"duplicate\", false));\n+                forEmptyPackage(\"duplicate\", true),\n+                forEmptyPackage(\"duplicate\", false));\n@@ -208,4 +208,4 @@\n-                forEmptyPackageIn(\"normal.beta\", false),\n-                forPackageIn(\"preview.beta\", true),\n-                forEmptyPackageIn(\"preview.alpha\", true),\n-                forEmptyPackageIn(\"normal.alpha\", false));\n+                forEmptyPackage(\"normal.beta\", false),\n+                forPackage(\"preview.beta\", true),\n+                forEmptyPackage(\"preview.alpha\", true),\n+                forEmptyPackage(\"normal.alpha\", false));\n","filename":"test\/jdk\/jdk\/internal\/jimage\/ModuleReferenceTest.java","additions":22,"deletions":22,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -24,0 +24,10 @@\n+\/*\n+ * @test\n+ * @summary Test a pool containing jimage resources and classes.\n+ * @author Jean-Francois Denise\n+ * @modules jdk.jlink\/jdk.tools.jlink.internal\n+ *          jdk.jlink\/jdk.tools.jlink.plugin\n+ * @run build ResourcePoolTest\n+ * @run main ResourcePoolTest\n+ *\/\n+\n@@ -27,0 +37,1 @@\n+import java.util.HashSet;\n@@ -28,1 +39,0 @@\n-import java.util.Map;\n@@ -36,1 +46,0 @@\n-import org.junit.jupiter.api.Test;\n@@ -38,14 +47,0 @@\n-import static org.junit.jupiter.api.Assertions.assertEquals;\n-import static org.junit.jupiter.api.Assertions.assertFalse;\n-import static org.junit.jupiter.api.Assertions.assertNotEquals;\n-import static org.junit.jupiter.api.Assertions.assertThrows;\n-import static org.junit.jupiter.api.Assertions.assertTrue;\n-\n-\/*\n- * @test\n- * @summary Test a pool containing jimage resources and classes.\n- * @author Jean-Francois Denise\n- * @modules jdk.jlink\/jdk.tools.jlink.internal\n- *          jdk.jlink\/jdk.tools.jlink.plugin\n- * @run junit ResourcePoolTest\n- *\/\n@@ -53,0 +48,11 @@\n+\n+    public static void main(String[] args) throws Exception {\n+        new ResourcePoolTest().test();\n+    }\n+\n+    public void test() throws Exception {\n+        checkResourceAdding();\n+        checkResourceVisitor();\n+        checkResourcesAfterCompression();\n+    }\n+\n@@ -55,2 +61,1 @@\n-    @Test\n-    public void resourceVisitor() throws Exception {\n+    private void checkResourceVisitor() throws Exception {\n@@ -67,3 +72,11 @@\n-        assertNotEquals(0, visitor.getAmountBefore(), \"Resources not found\");\n-        assertEquals(visitor.getAmountBefore(), input.entryCount(), \"Number of visited resources\");\n-        assertEquals(visitor.getAmountAfter(), output.entryCount(), \"Number of added resources\");\n+        if (visitor.getAmountBefore() == 0) {\n+            throw new AssertionError(\"Resources not found\");\n+        }\n+        if (visitor.getAmountBefore() != input.entryCount()) {\n+            throw new AssertionError(\"Number of visited resources. Expected: \" +\n+                    visitor.getAmountBefore() + \", got: \" + input.entryCount());\n+        }\n+        if (visitor.getAmountAfter() != output.entryCount()) {\n+            throw new AssertionError(\"Number of added resources. Expected: \" +\n+                    visitor.getAmountAfter() + \", got: \" + output.entryCount());\n+        }\n@@ -72,1 +85,3 @@\n-            assertTrue(input.findEntry(path).isPresent(), \"Unknown resource: \" + path);\n+            if (!input.findEntry(path).isPresent()) {\n+                throw new AssertionError(\"Unknown resource: \" + path);\n+            }\n@@ -105,5 +120,8 @@\n-    @Test\n-    public void resourceAdding() {\n-        Map<String, List<String>> samples = Map.of(\n-                \"java.base\", List.of(\"java\/lang\/Object\", \"java\/lang\/String\"),\n-                \"java.management\", List.of(\"javax\/management\/ObjectName\"));\n+    private void checkResourceAdding() {\n+        List<String> samples = new ArrayList<>();\n+        samples.add(\"java.base\");\n+        samples.add(\"java\/lang\/Object\");\n+        samples.add(\"java.base\");\n+        samples.add(\"java\/lang\/String\");\n+        samples.add(\"java.management\");\n+        samples.add(\"javax\/management\/ObjectName\");\n@@ -129,9 +147,22 @@\n-    @Test\n-    public void packageInference() {\n-        Map<String, List<String>> samples = Map.of(\n-                \"java.base\", List.of(\"NoPackage\", \"java\/lang\/String\", \"java\/util\/List\"));\n-        ResourcePoolManager manager = test(samples, (resources, module, path) -> {\n-            try {\n-                resources.add(ResourcePoolEntry.create(path, new byte[0]));\n-            } catch (Exception ex) {\n-                throw new RuntimeException(ex);\n+    private void test(List<String> samples, ResourceAdder adder) {\n+        if (samples.isEmpty()) {\n+            throw new AssertionError(\"No sample to test\");\n+        }\n+        ResourcePoolManager resources = new ResourcePoolManager();\n+        Set<String> modules = new HashSet<>();\n+        for (int i = 0; i < samples.size(); i++) {\n+            String module = samples.get(i);\n+            modules.add(module);\n+            i++;\n+            String clazz = samples.get(i);\n+            String path = \"\/\" + module + \"\/\" + clazz + \".class\";\n+            adder.add(resources, module, path);\n+        }\n+        for (int i = 0; i < samples.size(); i++) {\n+            String module = samples.get(i);\n+            i++;\n+            String clazz = samples.get(i);\n+            String path = \"\/\" + module + \"\/\" + clazz + \".class\";\n+            Optional<ResourcePoolEntry> res = resources.findEntry(path);\n+            if (!res.isPresent()) {\n+                throw new AssertionError(\"Resource not found \" + path);\n@@ -139,22 +170,3 @@\n-        });\n-\n-        Optional<ResourcePoolModule> modBase = manager.moduleView().findModule(\"java.base\");\n-        assertTrue(modBase.isPresent());\n-        \/\/ Empty packages are not included (and should normally not exist).\n-        assertEquals(Set.of(\"java.lang\", \"java.util\"), modBase.get().packages());\n-    }\n-\n-    @Test\n-    public void packageInference_previewOnly() {\n-        Map<String, List<String>> samples = Map.of(\n-                \"java.base\", List.of(\n-                        \"java\/lang\/Object\",\n-                        \"java\/lang\/String\",\n-                        \"java\/util\/List\",\n-                        \"META-INF\/preview\/java\/lang\/String\",\n-                        \"META-INF\/preview\/java\/extra\/PreviewOnly\"));\n-        ResourcePoolManager manager = test(samples, (resources, module, path) -> {\n-            try {\n-                resources.add(ResourcePoolEntry.create(path, new byte[0]));\n-            } catch (Exception ex) {\n-                throw new RuntimeException(ex);\n+            checkModule(resources.resourcePool(), res.get());\n+            if (resources.findEntry(clazz).isPresent()) {\n+                throw new AssertionError(\"Resource found \" + clazz);\n@@ -162,32 +174,4 @@\n-        });\n-\n-        Optional<ResourcePoolModule> modBase = manager.moduleView().findModule(\"java.base\");\n-        assertTrue(modBase.isPresent());\n-        \/\/ Preview only package is included, and no packages start with 'META-INF'.\n-        assertEquals(Set.of(\"java.lang\", \"java.util\", \"java.extra\"), modBase.get().packages());\n-        \/\/ But the preview resources exist in the META-INF\/preview namespace.\n-        assertTrue(modBase.get().findEntry(\"\/java.base\/META-INF\/preview\/java\/extra\/PreviewOnly.class\").isPresent());\n-    }\n-\n-    private ResourcePoolManager test(Map<String, List<String>> samples, ResourceAdder adder) {\n-        assertFalse(samples.isEmpty(), \"No sample to test\");\n-        ResourcePoolManager resources = new ResourcePoolManager();\n-        samples.forEach((module, clazzes) -> {\n-            clazzes.forEach(clazz -> {\n-                String path = \"\/\" + module + \"\/\" + clazz + \".class\";\n-                adder.add(resources, module, path);\n-            });\n-        });\n-        samples.forEach((module, clazzes) -> {\n-            clazzes.forEach(clazz -> {\n-                String path = \"\/\" + module + \"\/\" + clazz + \".class\";\n-                Optional<ResourcePoolEntry> res = resources.findEntry(path);\n-                assertTrue(res.isPresent(), \"Resource not found \" + path);\n-                checkModule(resources.resourcePool(), res.get());\n-                assertTrue(resources.findEntry(clazz).isEmpty(), \"Resource found \" + clazz);\n-            });\n-        });\n-        long resourcesCount = samples.values().stream().mapToInt(List::size).sum();\n-        assertEquals(resourcesCount, resources.entryCount(), \"Invalid number of resources\");\n-        assertEquals(samples.size(), resources.moduleCount(), \"Invalid number of modules\");\n-        return resources;\n+        }\n+        if (resources.entryCount() != samples.size() \/ 2) {\n+            throw new AssertionError(\"Invalid number of resources\");\n+        }\n@@ -198,1 +182,3 @@\n-        assertTrue(optMod.isPresent(), \"No module \" + res.moduleName());\n+        if (!optMod.isPresent()) {\n+            throw new AssertionError(\"No module \" + res.moduleName());\n+        }\n@@ -200,3 +186,7 @@\n-        assertEquals(res.moduleName(), m.name(), \"Not right module name \" + res.moduleName());\n-        assertTrue(m.findEntry(res.path()).isPresent(),\n-                \"resource \" + res.path() + \" not in module \" + m.name());\n+        if (!m.name().equals(res.moduleName())) {\n+            throw new AssertionError(\"Not right module name \" + res.moduleName());\n+        }\n+        if (!m.findEntry(res.path()).isPresent()) {\n+            throw new AssertionError(\"resource \" + res.path()\n+                    + \" not in module \" + m.name());\n+        }\n@@ -205,2 +195,1 @@\n-    @Test\n-    public void resourcesAfterCompression() throws Exception {\n+    private void checkResourcesAfterCompression() throws Exception {\n@@ -229,6 +218,22 @@\n-            assertTrue(resources.contains(res), \"Resource not found: \" + res);\n-            assertTrue(resources.findEntry(res.path()).isPresent(), \"Resource not found: \" + res);\n-            assertTrue(modules.contains(res.moduleName()), \"Module not found: \" + res.moduleName());\n-            assertTrue(modules.contains(res.moduleName()), \"Module not found: \" + res.moduleName());\n-            assertThrows(RuntimeException.class, () -> resources.add(res),\n-                    res + \" already present, but an exception is not thrown\");\n+            if (!resources.contains(res)) {\n+                throw new AssertionError(\"Resource not found: \" + res);\n+            }\n+\n+            if (!resources.findEntry(res.path()).isPresent()) {\n+                throw new AssertionError(\"Resource not found: \" + res);\n+            }\n+\n+            if (!modules.contains(res.moduleName())) {\n+                throw new AssertionError(\"Module not found: \" + res.moduleName());\n+            }\n+\n+            if (!resources.contains(res)) {\n+                throw new AssertionError(\"Resources not found: \" + res);\n+            }\n+\n+            try {\n+                resources.add(res);\n+                throw new AssertionError(res + \" already present, but an exception is not thrown\");\n+            } catch (Exception ex) {\n+                \/\/ Expected\n+            }\n@@ -237,3 +242,6 @@\n-        ResourcePoolEntry toAdd = ResourcePoolEntry.create(\"\/module2\/toto1\", new byte[0]);\n-        assertThrows(RuntimeException.class, () -> resources.add(toAdd),\n-                \"ResourcePool is read-only, but an exception is not thrown\");\n+        try {\n+            resources.add(ResourcePoolEntry.create(\"\/module2\/toto1\", new byte[0]));\n+            throw new AssertionError(\"ResourcePool is read-only, but an exception is not thrown\");\n+        } catch (Exception ex) {\n+            \/\/ Expected\n+        }\n","filename":"test\/jdk\/tools\/jlink\/ResourcePoolTest.java","additions":113,"deletions":105,"binary":false,"changes":218,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-import java.util.stream.Collectors;\n@@ -51,1 +50,0 @@\n- *          jdk.jlink\n@@ -54,1 +52,1 @@\n- * @run main\/othervm\/timeout=1200 -ea -esa -DDISABLE_PREVIEW_PATCHING=false -Xmx1g PackagedModulesVsRuntimeImageLinkTest\n+ * @run main\/othervm\/timeout=1200 -Xmx1g PackagedModulesVsRuntimeImageLinkTest\n@@ -75,0 +73,1 @@\n+\n@@ -124,2 +123,3 @@\n-        assertSameContent(\"jmod-less\", jimageContentJmodLess, \"jmod-full\", jimageContentJmodFull);\n-        \/\/ Both lists are same size, with same names, so enumerate either.\n+        if (jimageContentJmodLess.size() != jimageContentJmodFull.size()) {\n+            throw new AssertionError(String.format(\"Size of jimage content differs for jmod-less (%d) v. jmod-full (%d)\", jimageContentJmodLess.size(), jimageContentJmodFull.size()));\n+        }\n@@ -148,41 +148,0 @@\n-    \/\/ Helper to assert the content of two jimage files are the same and provide\n-    \/\/ useful debug information otherwise.\n-    private static void assertSameContent(\n-            String lhsLabel, List<String> lhsNames, String rhsLabel, List<String> rhsNames) {\n-        int lhsSize = lhsNames.size();\n-        int rhsSize = rhsNames.size();\n-        \/\/ Both input lists are sorted, enumerate the differences for debugging.\n-        List<String> lhsOnly = new ArrayList<>();\n-        List<String> rhsOnly = new ArrayList<>();\n-        int i = 0;\n-        int j = 0;\n-        while (i < lhsSize && j < rhsSize) {\n-            String lhsName = lhsNames.get(i);\n-            String rhsName = rhsNames.get(j);\n-            int signum = lhsName.compareTo(rhsName);\n-            if (signum == 0) {\n-                i += 1;\n-                j += 1;\n-            } else if (signum < 0) {\n-                lhsOnly.add(lhsName);\n-                i += 1;\n-            } else {\n-                rhsOnly.add(rhsName);\n-                j += 1;\n-            }\n-        }\n-        lhsOnly.addAll(lhsNames.subList(i, lhsSize));\n-        rhsOnly.addAll(rhsNames.subList(j, rhsSize));\n-        if (!lhsOnly.isEmpty() || !rhsOnly.isEmpty()) {\n-            String message = String.format(\n-                    \"jimage content differs for %s (%d) v. %s (%d)\", lhsLabel, lhsSize, rhsLabel, rhsSize);\n-            if (!lhsOnly.isEmpty()) {\n-                message += \"\\nOnly in \" + lhsLabel + \":\\n\\t\" + String.join(\"\\n\\t\", lhsOnly);\n-            }\n-            if (!rhsOnly.isEmpty()) {\n-                message += \"\\nOnly in \" + rhsLabel + \":\\n\\t\" + String.join(\"\\n\\t\", rhsOnly);\n-            }\n-            throw new AssertionError(message);\n-        }\n-    }\n-\n@@ -190,7 +149,1 @@\n-        return pathStartsWith(path, \"\/packages\") || pathStartsWith(path, \"\/modules\");\n-    }\n-\n-    \/\/ Handle both \"<prefix>\" and \"<prefix>\/...\".\n-    private static boolean pathStartsWith(String path, String prefix) {\n-        int plen = prefix.length();\n-        return path.startsWith(prefix) && (path.length() == plen || path.charAt(plen) == '\/');\n+        return path.startsWith(\"\/packages\") || path.startsWith(\"\/modules\");\n","filename":"test\/jdk\/tools\/jlink\/runtimeImage\/PackagedModulesVsRuntimeImageLinkTest.java","additions":6,"deletions":53,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -86,0 +86,1 @@\n+                \"\/java.base\/module-info.class\",\n@@ -89,0 +90,1 @@\n+                \"\/java.logging\/module-info.class\",\n@@ -99,0 +101,1 @@\n+        assertContainsResources(nodes.get(\"\/modules\/java.base\"), \"module-info.class\");\n@@ -103,0 +106,1 @@\n+        assertContainsResources(nodes.get(\"\/modules\/java.logging\"), \"module-info.class\");\n","filename":"test\/jdk\/tools\/jlink\/whitebox\/jdk.jlink\/jdk\/tools\/jlink\/internal\/ImageResourcesTreeTest.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}