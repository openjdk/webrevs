{"files":[{"patch":"@@ -27,0 +27,1 @@\n+ * @library \/test\/lib \/\n@@ -30,1 +31,6 @@\n- * @run main\/othervm -XX:+UseSerialGC -Xmx50M -Xlog:gc*=info runtime.valhalla.inlinetypes.LarvalMarkWordTest\n+            java.management\n+ * @build jdk.test.whitebox.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ * @run main\/othervm -XX:+UseSerialGC -Xlog:gc*=info\n+                     -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI\n+                     runtime.valhalla.inlinetypes.LarvalMarkWordTest\n@@ -32,0 +38,1 @@\n+\n@@ -35,0 +42,1 @@\n+ * @library \/test\/lib \/\n@@ -38,1 +46,6 @@\n- * @run main\/othervm -XX:+UseParallelGC -Xmx50M -Xlog:gc*=info runtime.valhalla.inlinetypes.LarvalMarkWordTest\n+            java.management\n+ * @build jdk.test.whitebox.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ * @run main\/othervm -XX:+UseParallelGC -Xlog:gc*=info\n+                     -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI\n+                     runtime.valhalla.inlinetypes.LarvalMarkWordTest\n@@ -40,0 +53,1 @@\n+\n@@ -43,0 +57,1 @@\n+ * @library \/test\/lib \/\n@@ -46,1 +61,6 @@\n- * @run main\/othervm -XX:+UseG1GC -Xmx50M -Xlog:gc*=info runtime.valhalla.inlinetypes.LarvalMarkWordTest\n+            java.management\n+ * @build jdk.test.whitebox.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ * @run main\/othervm -XX:+UseG1GC -Xlog:gc*=info\n+                     -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI\n+                     runtime.valhalla.inlinetypes.LarvalMarkWordTest\n@@ -48,0 +68,1 @@\n+\n@@ -51,0 +72,1 @@\n+ * @library \/test\/lib \/\n@@ -54,1 +76,6 @@\n- * @run main\/othervm -XX:+UseZGC -Xmx50M -Xlog:gc*=info runtime.valhalla.inlinetypes.LarvalMarkWordTest\n+            java.management\n+ * @build jdk.test.whitebox.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ * @run main\/othervm -XX:+UseZGC -Xlog:gc*=info\n+                     -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI\n+                     runtime.valhalla.inlinetypes.LarvalMarkWordTest\n@@ -56,1 +83,0 @@\n-\n@@ -59,0 +85,2 @@\n+import jdk.test.whitebox.WhiteBox;\n+\n@@ -63,0 +91,1 @@\n+  private static final WhiteBox WB = WhiteBox.getWhiteBox();\n@@ -74,6 +103,4 @@\n-    \/\/ Now we make a bunch of objects.\n-    \/\/ Ideally, we want the object to be relocated, but this isn't guaranteed.\n-    stressTheGC();\n-    \/\/ Hopefully the GC has already decided to do a GC, but if not we\n-    \/\/ suggest it do one. This suggestion may be ignored.\n-    System.gc();\n+\n+    \/\/ Explicitly cause a full GC.\n+    \/\/ This will cause relocations to happen, which is what we want to test.\n+    WB.fullGC();\n@@ -91,14 +118,0 @@\n-  private static void stressTheGC() {\n-    int ignore = 0;\n-    for (int i = 0; i < 100_000_000; i++) {\n-      Object obj = new Object();\n-      \/\/ Arbitrary operation, has no meaning.\n-      ignore %= obj.getClass().getName().length();\n-    }\n-    if (ignore == -1) {\n-      \/\/ Will never be thrown.\n-      throw new RuntimeException(\"will never throw\");\n-    }\n-  }\n-\n-\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/LarvalMarkWordTest.java","additions":38,"deletions":25,"binary":false,"changes":63,"status":"modified"}]}