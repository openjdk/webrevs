{"files":[{"patch":"@@ -1,106 +0,0 @@\n-\/*\n- * Copyright (c) 2025, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package compiler.valhalla.inlinetypes;\n-\n-import compiler.lib.ir_framework.*;\n-import jdk.internal.misc.Unsafe;\n-\n-import java.lang.reflect.Field;\n-\n-\/*\n- * @test\n- * @key randomness\n- * @summary Test intrinsic support for value classes.\n- * @library \/test\/lib \/\n- * @requires (os.simpleArch == \"x64\" | os.simpleArch == \"aarch64\")\n- * @enablePreview\n- * @modules java.base\/jdk.internal.misc\n- *          java.base\/jdk.internal.value\n- *          java.base\/jdk.internal.vm.annotation\n- * @build jdk.test.whitebox.WhiteBox\n- * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n- * @run main\/othervm\/timeout=300 -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI\n- *      compiler.valhalla.inlinetypes.TestCompareAndExchange\n- *\/\n-\n-\/*\n- * My command line: java -cp \/home\/chagedor\/JTwork\/classes\/compiler\/valhalla\/inlinetypes\/TestCompareAndExchange.d:\/home\/chagedor\/valhalla3\/open\/test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes:\/home\/chagedor\/JTwork\/classes\/compiler\/valhalla\/inlinetypes\/TestCompareAndExchange.d\/test\/lib:\/home\/chagedor\/valhalla3\/open\/test\/lib:\/home\/chagedor\/valhalla3\/open\/test\/hotspot\/jtreg:\/home\/chagedor\/jtreg\/lib\/javatest.jar:\/home\/chagedor\/jtreg\/lib\/jtreg.jar -Djava.library.path=. -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Dir.framework.server.port=35391 --enable-preview --add-exports java.base\/jdk.internal.value=ALL-UNNAMED --add-exports java.base\/jdk.internal.vm.annotation=ALL-UNNAMED --add-exports java.base\/jdk.internal.misc=ALL-UNNAMED -XX:-BackgroundCompilation -DWarmup=10000 -XX:CompileCommand=dontinline,*Unsafe*::getFlatValue* -XX:CompileCommand=dontinline,*Unsafe*::putFlatValue* -DIgnoreCompilerControls=true -XX:-TieredCompilation -XX:CompileOnly=*Small*::*,*::test70 -XX:CompileCommand=dontinline,*Unsafe::array* -XX:DisableIntrinsic=_compareAndSetLong,_compareAndSetInt,_compareAndSetByte,_compareAndSetShort -DReproduce=true compiler.lib.ir_framework.test.TestVM compiler.valhalla.inlinetypes.TestCompareAndExchange\n- *\/\n-@ForceCompileClassInitializer\n-public class TestCompareAndExchange {\n-\n-\n-    public static void main(String[] args) {\n-        InlineTypes.getFramework()\n-                .addFlags(\"--enable-preview\",\n-                          \"--add-exports\", \"java.base\/jdk.internal.value=ALL-UNNAMED\",\n-                          \"--add-exports\", \"java.base\/jdk.internal.vm.annotation=ALL-UNNAMED\",\n-                          \"--add-exports\", \"java.base\/jdk.internal.misc=ALL-UNNAMED\")\n-                .addFlags(\"-XX:-BackgroundCompilation -DWarmup=10000 -XX:CompileCommand=dontinline,*Unsafe*::getFlatValue* -XX:CompileCommand=dontinline,*Unsafe*::putFlatValue* -DIgnoreCompilerControls=true -XX:-TieredCompilation -XX:CompileOnly=*Small*::*,*::test70 -XX:CompileCommand=dontinline,*Unsafe::array* -XX:DisableIntrinsic=_compareAndSetLong,_compareAndSetInt,_compareAndSetByte,_compareAndSetShort -DReproduce=true\".split(\" \"))\n-                .start();\n-    }\n-\n-    private static final Unsafe U = Unsafe.getUnsafe();\n-\n-    static public value class SmallValue {\n-        byte a = (byte)0x12;\n-        byte b = (byte)0x34;\n-        byte c = (byte)0x56;\n-        byte d = (byte)0x78;\n-        byte e = (byte)0x9a;\n-\n-        @ForceInline\n-        static SmallValue create() {\n-            return new SmallValue();\n-        }\n-\n-        @Override\n-        public String toString() {\n-            return \"a: \" + a + \", b: \" + b;\n-        }\n-    }\n-\n-    SmallValue test63_vt;\n-    private static final long TEST63_VT_OFFSET;\n-    static {\n-        try {\n-            Field test63_vt_Field = TestCompareAndExchange.class.getDeclaredField(\"test63_vt\");\n-            TEST63_VT_OFFSET = U.objectFieldOffset(test63_vt_Field);\n-        } catch (Exception e) {\n-            throw new RuntimeException(e);\n-        }\n-    }\n-\n-    \/\/ compareAndExchange to flattened field in object, non-inline arguments to compare and set\n-    @Test\n-    public Object test70(Object expected, Object x) {\n-        return U.compareAndExchangeFlatValue(this, TEST63_VT_OFFSET, 4, SmallValue.class, expected, x);\n-    }\n-\n-    @Run(test = \"test70\")\n-    public void test70_verifier() {\n-        test63_vt = SmallValue.create();\n-        test70(SmallValue.create(), SmallValue.create());\n-    }\n-}\n\\ No newline at end of file\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestCompareAndExchange.java","additions":0,"deletions":106,"binary":false,"changes":106,"status":"deleted"}]}