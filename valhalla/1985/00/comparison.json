{"files":[{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2014, 2025, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2014, 2026, Oracle and\/or its affiliates. All rights reserved.\n@@ -143,10 +143,0 @@\n-\n-  # Temporarily compile valueclasses into a separate directory with the form:\n-  #   <tempdir>\/<module>\/<classpath>\n-  # and then copy the class files into:\n-  #   <outdir>\/<module>\/META-INF\/preview\/<classpath>\n-  # We cannot compile directly into the desired directory because it's the\n-  # compiler which creates the original '<module>\/<classpath>\/...' hierarchy.\n-  VALUECLASS_OUTPUTDIR := $(SUPPORT_OUTPUTDIR)\/$(VALUECLASSES_STR)\n-  PREVIEW_OUTPUTDIR := $(COMPILATION_OUTPUTDIR)\/$(MODULE)\/META-INF\/preview\n-\n@@ -154,0 +144,8 @@\n+    # Temporarily compile valueclasses into a separate directory with the form:\n+    #   <tempdir>\/<module>\/<classpath>\n+    # and then copy the class files into:\n+    #   <outdir>\/<module>\/META-INF\/preview\/<classpath>\n+    # We cannot compile directly into the desired directory because it's the\n+    # compiler which creates the original '<module>\/<classpath>\/...' hierarchy.\n+    TEMP_OUTPUTDIR := $(SUPPORT_OUTPUTDIR)\/$(VALUECLASSES_STR)\n+\n@@ -160,2 +158,1 @@\n-        BIN := $(VALUECLASS_OUTPUTDIR)\/, \\\n-        JAR := $(JDK_OUTPUTDIR)\/lib\/$(VALUECLASSES_STR)\/$(MODULE)-$(VALUECLASSES_STR).jar, \\\n+        BIN := $(TEMP_OUTPUTDIR)\/, \\\n@@ -176,11 +173,15 @@\n-    TARGETS += $($(MODULE)-$(VALUECLASSES_STR))\n-\n-    # Restructure the value class hierarchy from \"<module>\/<classpath>\/...\"\n-    # to \"<module>\/META-INF\/preview\/<classpath>\/...\"\n-    # When module patching is removed, this could probably be a move rather than a copy.\n-\n-    # FIXME: The marker file should probably go in modules root dir.\n-    # FIXME: Copying value classes should not also copy marker files.\n-    $(PREVIEW_OUTPUTDIR)\/_the.copy_valueclasses.marker: $($(MODULE)-$(VALUECLASSES_STR))\n-\t\t$(call MakeTargetDir)\n-\t\t$(CP) -R $(VALUECLASS_OUTPUTDIR)\/$(MODULE)\/. $(@D)\/\n+    # Don't add '$($(MODULE)-$(VALUECLASSES_STR))' to TARGETS (it's transient).\n+    # The 'valueclasses' target below depends on it, and that's the non-transient\n+    # result we care about.\n+\n+    # Copy compiled output from \"<tempdir>\/<module>\/<classpath>\/...\" directories\n+    # to \"<outdir>\/<module>\/META-INF\/preview\/<classpath>\/...\".\n+    MOD_SRC := $(TEMP_OUTPUTDIR)\/$(MODULE)\n+    MOD_DST := $(COMPILATION_OUTPUTDIR)\/$(MODULE)\n+\n+    # NOTE: We cannot use '$(CP) -R $(MOD_SRC)\/*\/ ...' to select sub-directories (it\n+    # does not work on MacOS\/BSD). Use 'filter-out' to explicitly exclude marker files.\n+    $(MOD_DST)\/_the.$(MODULE).valueclasses: $($(MODULE)-$(VALUECLASSES_STR))\n+\t\t$(RM) -r $(@D)\/META-INF\/preview\n+\t\t$(MKDIR) -p $(@D)\/META-INF\/preview\n+\t\t$(CP) -R $(filter-out $(MOD_SRC)\/_%, $(wildcard $(MOD_SRC)\/*)) $(@D)\/META-INF\/preview\n@@ -189,8 +190,1 @@\n-    TARGETS += $(PREVIEW_OUTPUTDIR)\/_the.copy_valueclasses.marker\n-\n-    $(eval $(call SetupCopyFiles, $(MODULE)-copy-valueclass-jar, \\\n-        FILES := $(JDK_OUTPUTDIR)\/lib\/$(VALUECLASSES_STR)\/$(MODULE)-$(VALUECLASSES_STR).jar, \\\n-        DEST := $(SUPPORT_OUTPUTDIR)\/modules_libs\/$(MODULE)\/$(VALUECLASSES_STR), \\\n-    ))\n-\n-    TARGETS += $($(MODULE)-copy-valueclass-jar)\n+    TARGETS += $(MOD_DST)\/_the.$(MODULE).valueclasses\n","filename":"make\/CompileJavaModules.gmk","additions":26,"deletions":32,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -798,2 +798,0 @@\n-build\/CheckFiles.java 8376088  generic-all\n-\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"}]}