{"files":[{"patch":"@@ -32,1 +32,0 @@\n-import com.sun.tools.javac.jvm.Target;\n@@ -40,1 +39,0 @@\n-import com.sun.tools.javac.util.Options;\n@@ -102,11 +100,0 @@\n-    private Type pt;\n-\n-    public <T extends JCTree> T translate(T tree, Type pt) {\n-        Type prevPt = this.pt;\n-        try {\n-            this.pt = pt;\n-            return translate(tree);\n-        } finally {\n-            this.pt = prevPt;\n-        }\n-    }\n@@ -117,1 +104,1 @@\n-            tree.init = translate(tree.init, tree.sym.erasure(types));\n+            tree.init = translate(tree.init);\n@@ -129,5 +116,3 @@\n-            rhsSym != null &&\n-            types.isNonNullable(lhsSym.type) &&\n-            !types.isNonNullable(rhsSym.type)) {\n-            tree.rhs = translate(tree.rhs, types.erasure(tree.lhs.type));\n-            tree.rhs = attr.makeNullCheck(tree.rhs, true);\n+                rhsSym != null) {\n+            tree.rhs = translate(tree.rhs);\n+            tree.rhs = generateNullCheckIfNeeded(tree.rhs, lhsSym.type.getNullMarker());\n@@ -143,5 +128,3 @@\n-            rhsSym != null &&\n-            types.isNonNullable(lhsSym.type) &&\n-            !types.isNonNullable(rhsSym.type)) {\n-            tree.rhs = translate(tree.rhs, types.erasure(tree.lhs.type));\n-            tree.rhs = attr.makeNullCheck(tree.rhs, true);\n+                rhsSym != null) {\n+            tree.rhs = translate(tree.rhs);\n+            tree.rhs = generateNullCheckIfNeeded(tree.rhs, lhsSym.type.getNullMarker());\n@@ -171,1 +154,3 @@\n-                            make.at(tree.body.pos()).Exec(attr.makeNullCheck(make.at(tree.body.pos()).Ident(param), true))\n+                            make.at(tree.body.pos())\n+                                    .Exec(generateNullCheckIfNeeded(make.at(tree.body.pos()).Ident(param),\n+                                    JCNullableTypeExpression.NullMarker.NOT_NULL))\n@@ -178,1 +163,1 @@\n-            tree.body = translate(tree.body, tree.sym.erasure(types).getReturnType());\n+            tree.body = translate(tree.body);\n@@ -188,2 +173,3 @@\n-            if (types.isNonNullable(returnType) && !types.isNonNullable(tree.expr.type)) {\n-                tree.expr = attr.makeNullCheck(tree.expr, true);\n+            Symbol sym = TreeInfo.symbolFor(tree.expr);\n+            if (sym != null && !types.isNonNullable(sym.type)) {\n+                tree.expr = generateNullCheckIfNeeded(tree.expr, returnType.getNullMarker());\n@@ -191,1 +177,1 @@\n-            tree.expr = translate(tree.expr, returnType);\n+            tree.expr = translate(tree.expr);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/NullChecksWriter.java","additions":15,"deletions":29,"binary":false,"changes":44,"status":"modified"}]}