{"files":[{"patch":"@@ -4524,0 +4524,3 @@\n+        if (types.isNonNullable(clazztype)) {\n+            tree.strict = true;\n+        }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -135,4 +135,4 @@\n-    \/*public void visitTypeCast(JCTypeCast tree) {\n-        if (types.isNonNullable(tree.clazz.type) && !types.isNonNullable(tree.expr.type)) {\n-            tree.expr = translate(tree.expr, tree.type);\n-            tree.expr = attr.makeNullCheck(tree.expr, true);\n+    public void visitTypeCast(JCTypeCast tree) {\n+        if (tree.strict) {\n+            tree.expr = translate(tree.expr);\n+            tree.expr = generateNullCheckIfNeeded(tree.expr, JCNullableTypeExpression.NullMarker.NOT_NULL);\n@@ -141,1 +141,1 @@\n-    }*\/\n+    }\n@@ -153,5 +153,2 @@\n-                    paramNullChecks.add(\n-                            make.at(tree.body.pos())\n-                                    .Exec(generateNullCheckIfNeeded(make.at(tree.body.pos()).Ident(param),\n-                                    JCNullableTypeExpression.NullMarker.NOT_NULL))\n-                    );\n+                    paramNullChecks.add(make.at(tree.body.pos())\n+                            .Exec(attr.makeNullCheck(make.at(tree.body.pos()).Ident(param), true)));\n@@ -172,1 +169,1 @@\n-        if (returnType != null && !returnType.hasTag(VOID)) {\n+        if (tree.expr != null && returnType != null && !returnType.hasTag(VOID)) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/NullChecksWriter.java","additions":8,"deletions":11,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -1040,3 +1040,0 @@\n-        if (types.isNonNullable(tree.clazz.type) && !types.isNonNullable(tree.expr.type)) {\n-            tree.expr = attr.makeNullCheck(tree.expr, true);\n-        }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/TransTypes.java","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2266,0 +2266,1 @@\n+        public boolean strict = false;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/tree\/JCTree.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -316,9 +316,13 @@\n-            String output = new JavaTask(tb)\n-                    .classpath(out.toString())\n-                    .classArgs(\"Test\")\n-                    .vmOptions(\"--enable-preview\")\n-                    .run(Task.Expect.FAIL)\n-                    .writeAll()\n-                    .getOutput(Task.OutputKind.STDERR);\n-            if (!output.startsWith(\"Exception in thread \\\"main\\\" \" + expectedError.getName())) {\n-                throw new AssertionError(expectedError.getName() + \" expected\");\n+            try {\n+                String output = new JavaTask(tb)\n+                        .classpath(out.toString())\n+                        .classArgs(\"Test\")\n+                        .vmOptions(\"--enable-preview\")\n+                        .run(Task.Expect.FAIL)\n+                        .writeAll()\n+                        .getOutput(Task.OutputKind.STDERR);\n+                if (!output.startsWith(\"Exception in thread \\\"main\\\" \" + expectedError.getName())) {\n+                    throw new AssertionError(expectedError.getName() + \" expected\");\n+                }\n+            } catch (Throwable t) {\n+                throw new AssertionError(\"failing for test case \" + testCode);\n","filename":"test\/langtools\/tools\/javac\/nullability\/RuntimeNullChecks.java","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"}]}