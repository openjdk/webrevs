{"files":[{"patch":"@@ -28,0 +28,1 @@\n+import com.sun.tools.javac.code.Flags;\n@@ -193,3 +194,4 @@\n-        List<Type> declaredArgTypes = msym.type.asMethodType().argtypes;\n-        int externalArgsLength = msym.externalType(types).getParameterTypes().size() - declaredArgTypes.size();\n-        Type varArgsArg = msym.isVarArgs() ? declaredArgTypes.last() : null;\n+        \/\/ skip signature polymorphic methods they won't have null restricted fields arguments\n+        if ((msym.flags_field & Flags.SIGNATURE_POLYMORPHIC) != 0) {\n+            return actualArgs;\n+        }\n@@ -197,6 +199,13 @@\n-        for (JCExpression arg : actualArgs) {\n-            if (externalArgsLength > 0) {\n-                newArgs.add(arg);\n-                externalArgsLength--;\n-                continue;\n-            }\n+        List<Type> declaredArgTypes = msym.type.asMethodType().argtypes;\n+        \/* there can be prefix arguments added by Lower, for example captured variables, etc\n+         * nothing to check for them\n+         *\/\n+        int prefixArgsLength = msym.externalType(types).getParameterTypes().size() - declaredArgTypes.size();\n+        List<JCExpression> actualArgsTmp = actualArgs;\n+        while (prefixArgsLength-- > 0) {\n+            newArgs.add(actualArgsTmp.head);\n+            actualArgsTmp = actualArgsTmp.tail;\n+        }\n+        int declaredArgSize = declaredArgTypes.size();\n+        int argsToCheck = msym.isVarArgs() ? declaredArgSize - 1 : declaredArgSize;\n+        while (argsToCheck-- > 0) {\n@@ -204,4 +213,0 @@\n-            if (msym.isVarArgs() && formalArgType == varArgsArg) {\n-                newArgs.add(arg);\n-                continue;\n-            }\n@@ -209,1 +214,1 @@\n-                newArgs.add(attr.makeNullCheck(arg, true));\n+                newArgs.add(attr.makeNullCheck(actualArgsTmp.head, true));\n@@ -211,1 +216,1 @@\n-                newArgs.add(arg);\n+                newArgs.add(actualArgsTmp.head);\n@@ -213,1 +218,5 @@\n-            declaredArgTypes = declaredArgTypes.tail;\n+            actualArgsTmp = actualArgsTmp.tail;\n+        }\n+        \/\/ now add the last vararg argument if applicable\n+        if (msym.isVarArgs()) {\n+            newArgs.add(actualArgsTmp.head);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/NullChecksWriter.java","additions":25,"deletions":16,"binary":false,"changes":41,"status":"modified"}]}