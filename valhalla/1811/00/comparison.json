{"files":[{"patch":"@@ -49,0 +49,13 @@\n+  if (ArrayKlass::cast(_klass)->is_flatArray_klass() &&\n+      FlatArrayKlass::cast(_klass)->contains_oops()) {\n+    \/\/ Flat arrays containing oops are not supported in ZGC without relying on\n+    \/\/ internal-only features such as loose-consistency and null-restriction.\n+    \/\/ A value object that contains an oop and a null-marker will always exceed\n+    \/\/ 64 bits when using ZGC. As a result, such objects will not be flattened\n+    \/\/ in practice due to the 64-bit atomicity limit.\n+    \/\/\n+    \/\/ We only need to support flat arrays containing oops when\/if value objects\n+    \/\/ can be user-declared as loosely consistent and\/or null-restricted.\n+    return ObjArrayAllocator::initialize(mem);\n+  }\n+\n@@ -54,2 +67,2 @@\n-  if (_word_size <= segment_max || ArrayKlass::cast(_klass)->is_flatArray_klass()) {\n-    \/\/ To small to use segmented clearing\n+  if (_word_size <= segment_max) {\n+    \/\/ Too small to use segmented clearing\n","filename":"src\/hotspot\/share\/gc\/z\/zObjArrayAllocator.cpp","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"}]}