{"files":[{"patch":"@@ -32,0 +32,1 @@\n+#include \"oops\/flatArrayKlass.hpp\"\n","filename":"src\/hotspot\/share\/oops\/flatArrayOop.inline.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -49,0 +49,1 @@\n+#include \"runtime\/registerMap.hpp\"\n@@ -98,0 +99,7 @@\n+oop InlineKlass::null_reset_value() {\n+  assert(is_initialized() || is_being_initialized() || is_in_error_state(), \"null reset value is set at the beginning of initialization\");\n+  oop val = java_mirror()->obj_field_acquire(null_reset_value_offset());\n+  assert(val != nullptr, \"Sanity check\");\n+  return val;\n+}\n+\n@@ -107,3 +115,1 @@\n-  int size = size_helper();  \/\/ Query before forming handle.\n-\n-  instanceOop oop = (instanceOop)Universe::heap()->obj_allocate(this, size, CHECK_NULL);\n+  instanceOop oop = InstanceKlass::allocate_instance(CHECK_NULL);\n@@ -650,3 +656,0 @@\n-void InlineKlass::metaspace_pointers_do(MetaspaceClosure* it) {\n-  InstanceKlass::metaspace_pointers_do(it);\n-}\n@@ -670,7 +673,0 @@\n-void InlineKlass::remove_java_mirror() {\n-  InstanceKlass::remove_java_mirror();\n-}\n-\n-void InlineKlass::restore_unshareable_info(ClassLoaderData* loader_data, Handle protection_domain, PackageEntry* pkg_entry, TRAPS) {\n-  InstanceKlass::restore_unshareable_info(loader_data, protection_domain, pkg_entry, CHECK);\n-}\n@@ -678,1 +674,2 @@\n-\/\/ oop verify\n+\n+\/\/ Verification\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.cpp","additions":11,"deletions":14,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -28,3 +28,0 @@\n-#include \"classfile\/classFileParser.hpp\"\n-#include \"classfile\/javaClasses.hpp\"\n-#include \"oops\/arrayKlass.hpp\"\n@@ -32,3 +29,12 @@\n-#include \"oops\/method.hpp\"\n-#include \"runtime\/registerMap.hpp\"\n-\n+#include \"oops\/layoutKind.hpp\"\n+#include \"oops\/oopsHierarchy.hpp\"\n+#include \"utilities\/exceptions.hpp\"\n+#include \"utilities\/globalDefinitions.hpp\"\n+\n+template <typename T>\n+class Array;\n+class ClassFileParser;\n+template <typename T>\n+class GrowableArray;\n+class Method;\n+class RegisterMap;\n@@ -43,1 +49,0 @@\n-  friend class ClassFileParser;\n@@ -180,1 +185,1 @@\n-  bool is_payload_marked_as_null(address payload) {\n+  jbyte* null_marker_address(address payload) {\n@@ -182,1 +187,5 @@\n-    return *((jbyte*)payload + null_marker_offset_in_payload()) == 0;\n+    return (jbyte*)payload + null_marker_offset_in_payload();\n+  }\n+\n+  bool is_payload_marked_as_null(address payload) {\n+    return *null_marker_address(payload) == 0;\n@@ -186,2 +195,1 @@\n-    assert(has_nullable_atomic_layout(), \" Must have\");\n-    *((jbyte*)payload + null_marker_offset_in_payload()) = 1;\n+    *null_marker_address(payload) = 1;\n@@ -191,2 +199,1 @@\n-    assert(has_nullable_atomic_layout(), \" Must have\");\n-    *((jbyte*)payload + null_marker_offset_in_payload()) = 0;\n+    *null_marker_address(payload) = 0;\n@@ -202,3 +209,0 @@\n-  void remove_java_mirror() override;\n-  void restore_unshareable_info(ClassLoaderData* loader_data, Handle protection_domain, PackageEntry* pkg_entry, TRAPS) override;\n-  void metaspace_pointers_do(MetaspaceClosure* it) override;\n@@ -228,7 +232,1 @@\n-  \/\/ Use this to return the size of an instance in heap words.\n-  \/\/ Note that this size only applies to heap allocated stand-alone instances.\n-  int size_helper() const override {\n-    return layout_helper_to_size_helper(layout_helper());\n-  }\n-\n-  \/\/ allocate_instance() allocates a stand alone value in the Java heap\n+  \/\/ Allocates a stand alone value in the Java heap\n@@ -247,0 +245,1 @@\n+  \/\/\n@@ -303,0 +302,1 @@\n+  oop null_reset_value();\n@@ -305,7 +305,0 @@\n-  oop null_reset_value() {\n-    assert(is_initialized() || is_being_initialized() || is_in_error_state(), \"null reset value is set at the beginning of initialization\");\n-    oop val = java_mirror()->obj_field_acquire(null_reset_value_offset());\n-    assert(val != nullptr, \"Sanity check\");\n-    return val;\n-  }\n-\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.hpp","additions":23,"deletions":30,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -29,2 +29,0 @@\n-#include \"memory\/iterator.hpp\"\n-#include \"oops\/flatArrayKlass.hpp\"\n@@ -32,1 +30,0 @@\n-#include \"oops\/oop.inline.hpp\"\n@@ -34,1 +31,0 @@\n-#include \"utilities\/macros.hpp\"\n@@ -37,1 +33,1 @@\n-  return ((address) (void*) o) + payload_offset();\n+  return cast_from_oop<address>(o) + payload_offset();\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.inline.hpp","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1062,1 +1062,1 @@\n-  virtual int size_helper() const {\n+  int size_helper() const {\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}