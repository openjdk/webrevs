{"files":[{"patch":"@@ -665,0 +665,1 @@\n+      _strength_reduction(false),\n@@ -2744,0 +2745,1 @@\n+  set_strength_reduction(true);\n@@ -2761,0 +2763,1 @@\n+  set_strength_reduction(false);\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -340,0 +340,1 @@\n+  bool                  _strength_reduction;    \/\/ Are we doing strength reduction to direct call\n@@ -608,0 +609,2 @@\n+  void          set_strength_reduction(bool z)  { _strength_reduction = z; }\n+  bool              strength_reduction() const  { return _strength_reduction; }\n","filename":"src\/hotspot\/share\/opto\/compile.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2036,17 +2036,16 @@\n-      ideal.if_then(ret, BoolTest::eq, ideal.makecon(TypePtr::NULL_PTR)); {\n-        \/\/ Return value is null\n-        ideal.set(res, makecon(TypePtr::NULL_PTR));\n-      } ideal.else_(); {\n-        \/\/ Return value is non-null\n-        sync_kit(ideal);\n-\n-        \/\/ Change return type of call to scalarized return\n-        const TypeFunc* tf = call->_tf;\n-        const TypeTuple* domain = OptoRuntime::store_inline_type_fields_Type()->domain_cc();\n-        const TypeFunc* new_tf = TypeFunc::make(tf->domain_sig(), tf->domain_cc(), tf->range_sig(), domain);\n-        call->_tf = new_tf;\n-        _gvn.set_type(call, call->Value(&_gvn));\n-        _gvn.set_type(ret, ret->Value(&_gvn));\n-\n-        \/\/ Don't add store to buffer call if we are strength reducing\n-        if (!_gvn.is_IterGVN() || C->inlining_incrementally()) {\n+      \/\/ Change return type of call to scalarized return\n+      const TypeFunc* tf = call->_tf;\n+      const TypeTuple* domain = OptoRuntime::store_inline_type_fields_Type()->domain_cc();\n+      const TypeFunc* new_tf = TypeFunc::make(tf->domain_sig(), tf->domain_cc(), tf->range_sig(), domain);\n+      call->_tf = new_tf;\n+      _gvn.set_type(call, call->Value(&_gvn));\n+      _gvn.set_type(ret, ret->Value(&_gvn));\n+      \/\/ Don't add store to buffer call if we are strength reducing\n+      if (!C->strength_reduction()) {\n+        ideal.if_then(ret, BoolTest::eq, ideal.makecon(TypePtr::NULL_PTR)); {\n+          \/\/ Return value is null\n+          ideal.set(res, makecon(TypePtr::NULL_PTR));\n+        } ideal.else_(); {\n+          \/\/ Return value is non-null\n+          sync_kit(ideal);\n+\n@@ -2075,5 +2074,5 @@\n-        } else {\n-          for (uint i = TypeFunc::Parms+1; i < domain->cnt(); i++) {\n-            Node* proj =_gvn.transform(new ProjNode(call, i));\n-          }\n-          ideal.set(res, ret);\n+          ideal.sync_kit(this);\n+        } ideal.end_if();\n+      } else {\n+        for (uint i = TypeFunc::Parms+1; i < domain->cnt(); i++) {\n+          Node* proj =_gvn.transform(new ProjNode(call, i));\n@@ -2081,2 +2080,2 @@\n-        ideal.sync_kit(this);\n-      } ideal.end_if();\n+        ideal.set(res, ret);\n+      }\n@@ -2224,1 +2223,1 @@\n-           ((_gvn.is_IterGVN() && !C->inlining_incrementally()) && InlineTypeReturnedAsFields && !call->as_CallJava()->method()->return_type()->is_loaded()),\n+           (C->strength_reduction() && InlineTypeReturnedAsFields && !call->as_CallJava()->method()->return_type()->is_loaded()),\n@@ -2228,1 +2227,1 @@\n-    if ((_gvn.is_IterGVN() && !C->inlining_incrementally()) && InlineTypeReturnedAsFields && !call->as_CallJava()->method()->return_type()->is_loaded()) {\n+    if (C->strength_reduction() && InlineTypeReturnedAsFields && !call->as_CallJava()->method()->return_type()->is_loaded()) {\n","filename":"src\/hotspot\/share\/opto\/graphKit.cpp","additions":25,"deletions":26,"binary":false,"changes":51,"status":"modified"}]}