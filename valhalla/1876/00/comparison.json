{"files":[{"patch":"@@ -3551,0 +3551,16 @@\n+\n+        if (types.isNonNullable(elemtype) && tree.elems == null) {\n+            \/\/ Null-restricted array requires an initializer unless either\n+            \/\/ (a) innermost dimension is missing, or (b) one of the provided dimensions\n+            \/\/ is the constant value 0.\n+            int dimsGiven = tree.dims.size();\n+            int arrayRank = types.dimensions(owntype);\n+            if (tree.dims.nonEmpty() && dimsGiven == arrayRank) {\n+                boolean hasZeroDims = tree.dims.stream()\n+                        .anyMatch(d -> d.type.constValue() instanceof Integer v && v == 0);\n+                if (!hasZeroDims) {\n+                    log.error(tree.pos(), Errors.RestrictedArrayMissingInit(elemtype));\n+                }\n+            }\n+        }\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -4392,0 +4392,4 @@\n+\n+# 0: type\n+compiler.err.restricted.array.missing.init =\\\n+   Non-empty null-restricted array of type {0} must specify an initializer\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler.properties","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -234,1 +234,2 @@\n-compiler.warn.suspicious.nullness.conversion\n\\ No newline at end of file\n+compiler.warn.suspicious.nullness.conversion\n+compiler.err.restricted.array.missing.init\n","filename":"test\/langtools\/tools\/javac\/diags\/examples.not-yet.txt","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,25 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @summary Smoke test for null-restricted array creation type-checking\n+ * @enablePreview\n+ * @compile\/fail\/ref=NullRestrictedArrayCreationTest.out -XDrawDiagnostics NullRestrictedArrayCreationTest.java\n+ *\/\n+\n+public class NullRestrictedArrayCreationTest {\n+    void testSimple(int n) {\n+        var t1 = new String![10];             \/\/ Fail (no init, n > 0)\n+        var t2 = new String![0];              \/\/ Pass (no init, n == 0)\n+        var t3 = new String![] { \"x\", \"y\" };  \/\/ Pass (init)\n+        var t4 = new String![n];              \/\/ Fail (no init, n not constant)\n+    }\n+\n+    void testMulti(int n) {\n+        var t1 = new String![3][2];           \/\/ Fail (no init, innermost length > 0)\n+        var t2 = new String![3][0];           \/\/ Pass (no init, innermost length == 0)\n+        var t3 = new String![0][10];          \/\/ Pass (no init, outer length == 0, no array created)\n+        var t4 = new String![][] { {\"x\"} };   \/\/ Pass (init)\n+        var t5 = new String![10][];           \/\/ Pass (no init, no innermost length)\n+        var t6 = new String![2][][];          \/\/ Pass (no init, no innermost length)\n+        var t7 = new String![3][n];           \/\/ Fail (no init, innermost length not constant)\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/nullability\/NullRestrictedArrayCreationTest.java","additions":25,"deletions":0,"binary":false,"changes":25,"status":"added"},{"patch":"@@ -0,0 +1,7 @@\n+NullRestrictedArrayCreationTest.java:10:18: compiler.err.restricted.array.missing.init: java.lang.String\n+NullRestrictedArrayCreationTest.java:13:18: compiler.err.restricted.array.missing.init: java.lang.String\n+NullRestrictedArrayCreationTest.java:17:18: compiler.err.restricted.array.missing.init: java.lang.String\n+NullRestrictedArrayCreationTest.java:23:18: compiler.err.restricted.array.missing.init: java.lang.String\n+- compiler.note.preview.filename: NullRestrictedArrayCreationTest.java, DEFAULT\n+- compiler.note.preview.recompile\n+4 errors\n","filename":"test\/langtools\/tools\/javac\/nullability\/NullRestrictedArrayCreationTest.out","additions":7,"deletions":0,"binary":false,"changes":7,"status":"added"},{"patch":"@@ -409,1 +409,1 @@\n-                                        arr_local = new String![3][4];\n+                                        arr_local = new String![][] { { \"\" } };\n@@ -415,1 +415,1 @@\n-                                        arr_local = new String![3][4];\n+                                        arr_local = new String![][] { { \"\" } };\n","filename":"test\/langtools\/tools\/javac\/nullability\/NullabilityCompilationTests.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}