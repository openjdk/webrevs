{"files":[{"patch":"@@ -6293,3 +6293,4 @@\n-          Klass* klass = SystemDictionary::resolve_super_or_fail(_class_name, name,\n-                                                                 Handle(THREAD, loader),\n-                                                                 false, THREAD);\n+          InstanceKlass* klass = SystemDictionary::resolve_super_or_fail(_class_name, name,\n+                                                                         Handle(THREAD, loader),\n+                                                                         false, THREAD);\n+\n@@ -6297,0 +6298,8 @@\n+            \/\/ Loads triggered by the LoadableDescriptors attribute are speculative, failures must not\n+            \/\/ impact loading of current class. We need to clear the exception before setting the klass\n+            \/\/ in the array of InlineLayoutInfo, since it might throw a new exception during Metaspace\n+            \/\/ allocation.\n+            if (HAS_PENDING_EXCEPTION) {\n+              CLEAR_PENDING_EXCEPTION;\n+            }\n+\n@@ -6305,2 +6314,2 @@\n-                                          \"(cause: field type in LoadableDescriptors attribute) but loaded class is not a value class\",\n-                                          name->as_C_string(), _class_name->as_C_string());\n+                                       \"(cause: field type in LoadableDescriptors attribute) but loaded class is not a value class\",\n+                                       name->as_C_string(), _class_name->as_C_string());\n@@ -6310,6 +6319,4 @@\n-                                        \"(cause: field type in LoadableDescriptors attribute) failed : %s\",\n-                                        name->as_C_string(), _class_name->as_C_string(),\n-                                        PENDING_EXCEPTION->klass()->name()->as_C_string());\n-          }\n-          \/\/ Loads triggered by the LoadableDescriptors attribute are speculative, failures must not impact loading of current class\n-          if (HAS_PENDING_EXCEPTION) {\n+                                     \"(cause: field type in LoadableDescriptors attribute) failed : %s\",\n+                                     name->as_C_string(), _class_name->as_C_string(),\n+                                     PENDING_EXCEPTION->klass()->name()->as_C_string());\n+\n@@ -6393,2 +6400,2 @@\n-void ClassFileParser::set_inline_layout_info_klass(int field_index, Klass* klass, TRAPS) {\n-  assert(field_index >= 0 && field_index < java_fields_count(), \"IOOB\");\n+void ClassFileParser::set_inline_layout_info_klass(int field_index, InstanceKlass* klass, TRAPS) {\n+  assert(field_index >= 0 && field_index < java_fields_count(), \"IOOB: 0 <= %d < %d\", field_index, (int)java_fields_count());\n@@ -6405,1 +6412,1 @@\n-  InlineKlass *ik = InlineKlass::cast(klass);\n+  InlineKlass* ik = InlineKlass::cast(klass);\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":21,"deletions":14,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -252,1 +252,1 @@\n-  void set_inline_layout_info_klass(int field_index, Klass* klass, TRAPS);\n+  void set_inline_layout_info_klass(int field_index, InstanceKlass* klass, TRAPS);\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -856,1 +856,2 @@\n-        assert(_inline_layout_info_array != nullptr && _inline_layout_info_array->adr_at(field_index)->klass() != nullptr, \"Array must have been set up\");\n+        assert(_inline_layout_info_array != nullptr, \"Array must have been created\");\n+        assert(_inline_layout_info_array->adr_at(field_index)->klass() != nullptr, \"Klass must have been set\");\n@@ -946,1 +947,2 @@\n-        assert(_inline_layout_info_array != nullptr && _inline_layout_info_array->adr_at(field_index)->klass() != nullptr, \"Array must have been set up\");\n+        assert(_inline_layout_info_array != nullptr, \"Array must have been created\");\n+        assert(_inline_layout_info_array->adr_at(field_index)->klass() != nullptr, \"Klass must have been set\");\n","filename":"src\/hotspot\/share\/classfile\/fieldLayoutBuilder.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"}]}