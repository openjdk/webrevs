{"files":[{"patch":"@@ -76,1 +76,1 @@\n-  _resolution_error_table->put(key, entry);\n+  _resolution_error_table->put_when_absent(key, entry);\n@@ -88,1 +88,1 @@\n-  _resolution_error_table->put(key, entry);\n+  _resolution_error_table->put_when_absent(key, entry);\n@@ -129,0 +129,9 @@\n+void ResolutionErrorEntry::set_nest_host_error(const char* message) {\n+  \/\/ If a message is already set, free it.\n+  if (nest_host_error() != nullptr) {\n+    FREE_C_HEAP_ARRAY(char, _nest_host_error);\n+  }\n+  _nest_host_error = message;\n+}\n+\n+\n","filename":"src\/hotspot\/share\/classfile\/resolutionErrors.cpp","additions":11,"deletions":2,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2024, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2025, Oracle and\/or its affiliates. All rights reserved.\n@@ -94,4 +94,1 @@\n-  void set_nest_host_error(const char* message) {\n-    _nest_host_error = message;\n-  }\n-\n+  void set_nest_host_error(const char* message);\n","filename":"src\/hotspot\/share\/classfile\/resolutionErrors.hpp","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -58,0 +58,1 @@\n+#include \"oops\/constantPool.inline.hpp\"\n@@ -1813,1 +1814,7 @@\n-    if (entry != nullptr && entry->nest_host_error() == nullptr) {\n+    if (entry == nullptr) {\n+      \/\/ Only add a new entry to the resolution error table if one hasn't been found for this\n+      \/\/ constant pool index. In this case resolution succeeded but there's an error in this nest host\n+      \/\/ that we use the table to record.\n+      assert(pool->resolved_klass_at(which) != nullptr, \"klass should be resolved if there is no entry\");\n+      ResolutionErrorTable::add_entry(pool, which, message);\n+    } else {\n@@ -1817,1 +1824,2 @@\n-      \/\/ the message. If we see it is already set then we can ignore it.\n+      \/\/ the message, and set it again.\n+      assert(entry->nest_host_error() == nullptr || strcmp(entry->nest_host_error(), message) == 0, \"should be the same message\");\n@@ -1819,2 +1827,0 @@\n-    } else {\n-      ResolutionErrorTable::add_entry(pool, which, message);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"}]}