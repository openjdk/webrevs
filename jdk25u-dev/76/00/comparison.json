{"files":[{"patch":"@@ -105,0 +105,11 @@\n+#define CONTAINER_READ_NUMERICAL_KEY_VALUE_CHECKED(controller, filename, key, log_string, retval) \\\n+{                                                                                     \\\n+  bool is_ok;                                                                         \\\n+  is_ok = controller->read_numerical_key_value(filename, key, &retval);               \\\n+  if (!is_ok) {                                                                       \\\n+    log_trace(os, container)(log_string \" failed: %d\", OSCONTAINER_ERROR);            \\\n+    return OSCONTAINER_ERROR;                                                         \\\n+  }                                                                                   \\\n+  log_trace(os, container)(log_string \" is: \" JULONG_FORMAT, retval);                 \\\n+}\n+\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.hpp","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -126,0 +126,6 @@\n+jlong CgroupV1MemoryController::uses_mem_hierarchy() {\n+  julong use_hierarchy;\n+  CONTAINER_READ_NUMBER_CHECKED(reader(), \"\/memory.use_hierarchy\", \"Use Hierarchy\", use_hierarchy);\n+  return (jlong)use_hierarchy;\n+}\n+\n@@ -163,0 +169,5 @@\n+    if (uses_mem_hierarchy()) {\n+      CONTAINER_READ_NUMERICAL_KEY_VALUE_CHECKED(reader(), \"\/memory.stat\",\n+                                                 \"hierarchical_memory_limit\", \"Hierarchical Memory Limit\",\n+                                                 memlimit);\n+    }\n@@ -164,1 +175,1 @@\n-    return (jlong)-1;\n+    return (jlong)((memlimit < phys_mem) ? memlimit : -1);\n@@ -187,0 +198,9 @@\n+    if (uses_mem_hierarchy()) {\n+      CONTAINER_READ_NUMERICAL_KEY_VALUE_CHECKED(reader(), \"\/memory.stat\",\n+                                                 \"hierarchical_memsw_limit\", \"Hierarchical Memory and Swap Limit\",\n+                                                 memswlimit);\n+      if (memswlimit < host_total_memsw) {\n+        log_trace(os, container)(\"Memory and Swap Limit is: \" JULONG_FORMAT, memswlimit);\n+        return (jlong)memswlimit;\n+      } \/\/ fall through to unlimited\n+    }\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":21,"deletions":1,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -102,0 +102,1 @@\n+    jlong uses_mem_hierarchy();\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}