{"files":[{"patch":"@@ -168,11 +168,4 @@\n-  if (memlimit >= phys_mem) {\n-    if (uses_mem_hierarchy()) {\n-      CONTAINER_READ_NUMERICAL_KEY_VALUE_CHECKED(reader(), \"\/memory.stat\",\n-                                                 \"hierarchical_memory_limit\", \"Hierarchical Memory Limit\",\n-                                                 memlimit);\n-    }\n-    verbose_log(memlimit, phys_mem);\n-    return (jlong)((memlimit < phys_mem) ? memlimit : -1);\n-  } else {\n-    verbose_log(memlimit, phys_mem);\n-    return (jlong)memlimit;\n+  if (memlimit >= phys_mem && uses_mem_hierarchy()) {\n+    CONTAINER_READ_NUMERICAL_KEY_VALUE_CHECKED(reader(), \"\/memory.stat\",\n+                                               \"hierarchical_memory_limit\", \"Hierarchical Memory Limit\",\n+                                               memlimit);\n@@ -180,0 +173,2 @@\n+  verbose_log(memlimit, phys_mem);\n+  return (jlong)((memlimit < phys_mem) ? memlimit : -1);\n@@ -197,14 +192,4 @@\n-  if (memswlimit >= host_total_memsw) {\n-    if (uses_mem_hierarchy()) {\n-      CONTAINER_READ_NUMERICAL_KEY_VALUE_CHECKED(reader(), \"\/memory.stat\",\n-                                                 \"hierarchical_memsw_limit\", \"Hierarchical Memory and Swap Limit\",\n-                                                 memswlimit);\n-      if (memswlimit < host_total_memsw) {\n-        log_trace(os, container)(\"Memory and Swap Limit is: \" JULONG_FORMAT, memswlimit);\n-        return (jlong)memswlimit;\n-      } \/\/ fall through to unlimited\n-    }\n-    log_trace(os, container)(\"Memory and Swap Limit is: Unlimited\");\n-    return (jlong)-1;\n-  } else {\n-    return (jlong)memswlimit;\n+  if (memswlimit >= host_total_memsw && uses_mem_hierarchy()) {\n+    CONTAINER_READ_NUMERICAL_KEY_VALUE_CHECKED(reader(), \"\/memory.stat\",\n+                                               \"hierarchical_memsw_limit\", \"Hierarchical Memory and Swap Limit\",\n+                                               memswlimit);\n@@ -212,0 +197,2 @@\n+  verbose_log(memswlimit, host_total_memsw);\n+  return (jlong)((memswlimit < host_total_memsw) ? memswlimit : -1);\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":12,"deletions":25,"binary":false,"changes":37,"status":"modified"}]}