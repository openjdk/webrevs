{"files":[{"patch":"@@ -32,0 +32,1 @@\n+#include \"runtime\/os.hpp\"\n@@ -35,2 +36,4 @@\n-  const char *libodmname = \"\/usr\/lib\/libodm.a(shr_64.o)\";\n-  _libhandle = dlopen(libodmname, RTLD_MEMBER | RTLD_NOW);\n+  const char* libodmname = \"\/usr\/lib\/libodm.a(shr_64.o)\";\n+  char ebuf[512];\n+  void* _libhandle = os::dll_load(libodmname, ebuf, sizeof(ebuf));\n+\n@@ -38,1 +41,1 @@\n-    trcVerbose(\"Couldn't open %s\", libodmname);\n+    trcVerbose(\"Cannot load %s (error %s)\", libodmname, ebuf);\n","filename":"src\/hotspot\/os\/aix\/libodm_aix.cpp","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"runtime\/os.hpp\"\n@@ -74,3 +75,3 @@\n-\n-  \/\/ Dynamically load the libperfstat porting library.\n-  g_libhandle = dlopen(\"\/usr\/lib\/libperfstat.a(shr_64.o)\", RTLD_MEMBER | RTLD_NOW);\n+  const char* libperfstat = \"\/usr\/lib\/libperfstat.a(shr_64.o)\";\n+  char ebuf[512];\n+  g_libhandle = os::dll_load(libperfstat, ebuf, sizeof(ebuf));\n@@ -78,1 +79,1 @@\n-    trcVerbose(\"Cannot load libperfstat.a (dlerror: %s)\", dlerror());\n+    trcVerbose(\"Cannot load %s (error: %s)\", libperfstat, ebuf);\n","filename":"src\/hotspot\/os\/aix\/libperfstat_aix.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -1101,2 +1101,0 @@\n-\/\/ Loads .dll\/.so and in case of error it checks if .dll\/.so was built\n-\/\/ for the same architecture as Hotspot is running on.\n@@ -1117,2 +1115,11 @@\n-  \/\/ RTLD_LAZY is currently not implemented. The dl is loaded immediately with all its dependants.\n-  void * result= ::dlopen(filename, RTLD_LAZY);\n+  \/\/ RTLD_LAZY has currently the same behavior as RTLD_NOW\n+  \/\/ The dl is loaded immediately with all its dependants.\n+  int dflags = RTLD_LAZY;\n+  \/\/ check for filename ending with ')', it indicates we want to load\n+  \/\/ a MEMBER module that is a member of an archive.\n+  int flen = strlen(filename);\n+  if (flen > 0 && filename[flen - 1] == ')') {\n+    dflags |= RTLD_MEMBER;\n+  }\n+\n+  void * result= ::dlopen(filename, dflags);\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":11,"deletions":4,"binary":false,"changes":15,"status":"modified"}]}