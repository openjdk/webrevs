{"files":[{"patch":"@@ -54,1 +54,2 @@\n-  _abbreviated(false) {\n+  _abbreviated(false),\n+  _consecutive_degen_with_bad_progress(0) {\n@@ -310,2 +311,11 @@\n-  \/\/ Check for futility and fail. There is no reason to do several back-to-back Degenerated cycles,\n-  \/\/ because that probably means the heap is overloaded and\/or fragmented.\n+  \/\/ The most common scenario for lack of good progress following a degenerated GC is an accumulation of floating\n+  \/\/ garbage during the most recently aborted concurrent GC effort.  With generational GC, it is far more effective to\n+  \/\/ reclaim this floating garbage with another degenerated cycle (which focuses on young generation and might require\n+  \/\/ a pause of 200 ms) rather than a full GC cycle (which may require over 2 seconds with a 10 GB old generation).\n+  \/\/\n+  \/\/ In generational mode, we'll only upgrade to full GC if we've done two degen cycles in a row and both indicated\n+  \/\/ bad progress.  In non-generational mode, we'll preserve the original behavior, which is to upgrade to full\n+  \/\/ immediately following a degenerated cycle with bad progress.  This preserves original behavior of non-generational\n+  \/\/ Shenandoah so as to avoid introducing \"surprising new behavior.\"  It also makes less sense with non-generational\n+  \/\/ Shenandoah to replace a full GC with a degenerated GC, because both have similar pause times in non-generational\n+  \/\/ mode.\n@@ -313,0 +323,6 @@\n+    _consecutive_degen_with_bad_progress++;\n+  } else {\n+    _consecutive_degen_with_bad_progress = 0;\n+  }\n+  if (!heap->mode()->is_generational() ||\n+      ((heap->shenandoah_policy()->consecutive_degenerated_gc_count() > 1) && (_consecutive_degen_with_bad_progress >= 2))) {\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahDegeneratedGC.cpp","additions":19,"deletions":3,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -39,0 +39,1 @@\n+  size_t _consecutive_degen_with_bad_progress;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahDegeneratedGC.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}